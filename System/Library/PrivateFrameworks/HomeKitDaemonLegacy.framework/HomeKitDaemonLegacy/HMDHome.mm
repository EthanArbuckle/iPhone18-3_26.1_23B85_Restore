@interface HMDHome
+ (BOOL)isObjectContainedInHome:(id)home;
+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)model forAddedHAPAccessoryServer:(id)server;
+ (id)decodedMigrationBulletinBoardNotifications:(id)notifications;
+ (id)decodedMigrationCameraNotificationSettings:(id)settings;
+ (id)encodedMigrationBulletinBoardNotifications:(id)notifications;
+ (id)encodedMigrationCameraNotificationSettings:(id)settings;
+ (id)filterUsersSupportingPresence:(id)presence;
+ (id)getBuiltinActionSets;
+ (id)logCategory;
+ (id)migrationBulletinBoardNotificationsForHome:(id)home;
+ (id)migrationCameraNotificationSettingsForHome:(id)home;
+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)identity;
+ (id)notificationPayloadForChangedCharacteristics:(id)characteristics destinationIsXPCTransport:(BOOL)transport;
+ (id)shortDescription;
+ (id)supportedAccessoryClasses;
+ (id)zoneIDFromHomeUUID:(id)d;
+ (unint64_t)privilegeFromUserInviteInformation:(id)information;
+ (void)_initialize;
+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteRead:(id)read;
+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteWrite:(id)write message:(id)message;
+ (void)updateCHIPPropertiesOnAccessoryModel:(id)model forAddedHAPAccessoryServer:(id)server;
- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)message error:(id *)error;
- (BOOL)_addAccessory:(id)accessory;
- (BOOL)_addOwnerToPrimaryAccessory:(id)accessory error:(id *)error;
- (BOOL)_canCurrentDeviceRegisterForReachabilityEventNotification;
- (BOOL)_doesUsersHaveCATID;
- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)handled;
- (BOOL)_hasPairedReachableBTLEAccessories;
- (BOOL)_isAccessToHomeAllowed;
- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)accessory;
- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)accessory;
- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice;
- (BOOL)_isReadRequestAllowForCharacteristics:(id)characteristics message:(id)message error:(id *)error;
- (BOOL)_isRegisteredForNotificationsForClients:(id)clients;
- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)gateway;
- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)accessory linkType:(int64_t)type;
- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)characteristics;
- (BOOL)_isSharedHomeVersionTrustZoneCapable;
- (BOOL)_isUserValid:(id)valid error:(id *)error;
- (BOOL)_loadBalanceWriteRequestOnResidentForAccessory:(id)accessory accessoryWriteRequestMapTable:(id)table requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)tuples withCompletionHandler:(id)handler;
- (BOOL)_passReadRequestToCompanion:(id)companion requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses remoteAccessories:(id)accessories withCompletionHandler:(id)handler;
- (BOOL)_passWriteRequestToCompanion:(id)companion requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource remoteAccessories:(id)accessories responseTuples:(id)tuples withCompletionHandler:(id)handler;
- (BOOL)_populateTriggerModel:(id)model fromBuilderMessage:(id)message transaction:(id)transaction responsePayload:(id)payload;
- (BOOL)_processTestModeHomeAccessControlOverride:(id)override error:(id *)error;
- (BOOL)_processTestModeHomeLocationStatusOverride:(id)override error:(id *)error;
- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)override error:(id *)error;
- (BOOL)_processTestModeUpdateHomeLocation:(id)location error:(id *)error;
- (BOOL)_removeAccessory:(id)accessory;
- (BOOL)_residentDeviceAvailable;
- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)category requestMessage:(id)message error:(id *)error;
- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)description requestMessage:(id)message error:(id *)error;
- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)server accessory:(id)accessory;
- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)request;
- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)characteristic;
- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)device;
- (BOOL)_shouldSendToDestination:(id)destination device:(id)device remoteSourceDevice:(id)sourceDevice;
- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)message minimumVersion:(id)version primaryResident:(id)resident shouldRelayMessages:(BOOL)messages;
- (BOOL)_shouldWaitForAccessoriesToBeReachable;
- (BOOL)_validateAddingNewTriggerWithName:(id)name message:(id)message;
- (BOOL)_verifyUserManagementPermissionForAccessory:(id)accessory error:(id *)error;
- (BOOL)applyDeviceLockStatus:(id)status;
- (BOOL)areAllResidentsUnreachable;
- (BOOL)areAllThreadResidentNodesUnreachable;
- (BOOL)attemptToUpdateThreadNetworkID:(id)d;
- (BOOL)auditStorageWithFabricData:(id)data;
- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk;
- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk;
- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)resident;
- (BOOL)checkForNetworkRouterSupport:(unint64_t)support error:(id *)error;
- (BOOL)configureWithHomeManager:(id)manager accessoriesPresent:(id)present uncommittedTransactions:(id)transactions source:(unint64_t)source;
- (BOOL)containsRemovedUser:(id)user;
- (BOOL)currentDeviceSupportsSidekickSettings;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)controller;
- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)controller;
- (BOOL)currentRemoteReachabilityRegistration;
- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)d;
- (BOOL)doesHomeContainResident;
- (BOOL)doesThisHomeHaveCameras;
- (BOOL)enabledResidentsSupportsHomeHub;
- (BOOL)evaluatePredicate:(id)predicate;
- (BOOL)getUpdateTransactionForAccessory:(id)accessory hapAccessory:(id)hapAccessory accessoryTransaction:(id)transaction addSvcTransactions:(id *)transactions updateSvcTransactions:(id *)svcTransactions removeSvcTransactions:(id *)removeSvcTransactions;
- (BOOL)hasActiveWACPairing;
- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport;
- (BOOL)hasAnyAccessoryWithWalletKeySupport;
- (BOOL)hasAnyReachableAccessories;
- (BOOL)hasCharacteristicNotificationRegistrations;
- (BOOL)hasNeverAddedAnyHAPAccessory;
- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory;
- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)monitor;
- (BOOL)hasSharedUser;
- (BOOL)hasSiriEndpointAccessory;
- (BOOL)hasThreadCapableResident;
- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)message;
- (BOOL)isActiveNetworkRouterInitialSetupNeeded;
- (BOOL)isAdminUser;
- (BOOL)isAnyBTLEAccessoryReachable;
- (BOOL)isAppleMediaAccessory:(id)accessory;
- (BOOL)isAutomaticSoftwareUpdateEnabled;
- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled;
- (BOOL)isCarPlayAccessAllowedForActionSet:(id)set withMessage:(id)message fromSource:(unint64_t)source;
- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)characteristic withMessage:(id)message fromSource:(unint64_t)source;
- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)state;
- (BOOL)isCompanionReachable;
- (BOOL)isCurrentDeviceAvailableResident;
- (BOOL)isCurrentDeviceConfirmedPrimaryResident;
- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)controller;
- (BOOL)isCurrentDevicePrimaryResident;
- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)controller;
- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)controller;
- (BOOL)isCurrentDeviceThreadBorderRouterCapable;
- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident;
- (BOOL)isDeviceIdentifierPrimaryResident:(id)resident;
- (BOOL)isDevicePrimaryResident:(id)resident;
- (BOOL)isMediaPeerToPeerEnabled;
- (BOOL)isMediaSystem:(id)system;
- (BOOL)isOwnerUser;
- (BOOL)isPrimaryResidentNodeReachable;
- (BOOL)isRemoteAccessDeviceReachable;
- (BOOL)isResidentReachable:(id)reachable;
- (BOOL)isResidentSupported;
- (BOOL)isSharedAdmin;
- (BOOL)isSidekickAccessory:(id)accessory;
- (BOOL)isSiriPhraseOptionsHeySiriEnabled;
- (BOOL)isSiriPhraseOptionsJustSiriEnabled;
- (BOOL)isSmokeAlarmEnabled;
- (BOOL)isThisHomeMigratedToHH2;
- (BOOL)isThreadCapable;
- (BOOL)isThreadNetworkUp;
- (BOOL)ownerTrustZoneCapable;
- (BOOL)remoteAccessIsEnabled;
- (BOOL)remoteEventAllowedForTopic:(id)topic deviceType:(unint64_t)type userType:(unint64_t)userType;
- (BOOL)requiresUnlockToAccessCharacteristics:(id)characteristics withMessage:(id)message;
- (BOOL)router:(id)router shouldHandleMessage:(id)message usingRouter:(id)usingRouter;
- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)data ownerDataSnapshot:(id)snapshot error:(id *)error;
- (BOOL)setUpOperationalFabricDataWithError:(id *)error;
- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)error accessory:(id)accessory;
- (BOOL)shouldAllowTopic:(id)topic forDeviceWithMessageIdentifier:(id)identifier;
- (BOOL)shouldEnableResidentFirstAccessoryCommunication;
- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)d;
- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)source;
- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)user;
- (BOOL)storeIntoLegacyStorageWithFabricData:(id)data;
- (BOOL)storeNewFabricData:(id)data;
- (BOOL)storeSharedHomeFabricData:(id)data;
- (BOOL)supportsDeviceWithCapabilities:(id)capabilities;
- (BOOL)supportsRouterManagement;
- (BOOL)supportsSiriEndpointOnBoarding;
- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus;
- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork;
- (BOOL)updateFabricUsingHomeModel:(id)model;
- (BOOL)validateActionsDoNotConflict:(id)conflict;
- (BOOL)watchSkipVersionCheck;
- (HMDAccessory)currentAccessory;
- (HMDAccessoryCount)accessoryCount;
- (HMDActionSet)_createActionSetWithUUID:(void *)d name:(void *)name type:(void *)type fromDictionary:(void *)dictionary transaction:(void *)transaction response:(void *)response error:;
- (HMDBackingStore)backingStore;
- (HMDDevice)companionDevice;
- (HMDDevice)currentDevice;
- (HMDFeaturesDataSource)featuresDataSource;
- (HMDHAPAccessory)activeNetworkRouterAccessory;
- (HMDHome)initWithCoder:(id)coder;
- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source;
- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source logEventSubmitter:(id)self0 carPlayDataSource:(id)self1 administratorHandlerFactory:(id)self2 localCapabilitiesDataSource:(id)self3 notificationCenter:(id)self4 keychainStore:(id)self5;
- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange;
- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion;
- (HMDHomeManager)homeManager;
- (HMDHomeNFCReaderKey)nfcReaderKey;
- (HMDHomePersonManager)personManager;
- (HMDNaturalLightingContext)naturalLightingContext;
- (HMDNetworkRouterClientManager)routerClientManager;
- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController;
- (HMDUser)currentUser;
- (HMEEventForwarder)eventForwarder;
- (HMFMessageDestination)messageDestination;
- (HMFWiFiManager)wifiManager;
- (HMHomePersonManagerSettings)personManagerSettings;
- (HMMDailyScheduler)dailyScheduler;
- (NSArray)accessories;
- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval;
- (NSArray)accessoriesWithWalletKeySupport;
- (NSArray)actionSets;
- (NSArray)appleMediaAccessories;
- (NSArray)cameraAccessories;
- (NSArray)enabledResidents;
- (NSArray)hapAccessories;
- (NSArray)hapAccessoriesForLegacyDataBlobEncoding;
- (NSArray)matterAccessories;
- (NSArray)mediaSessionStates;
- (NSArray)mediaSessions;
- (NSArray)mediaSystems;
- (NSArray)outgoingInvitations;
- (NSArray)removedUsers;
- (NSArray)residentCapableDevices;
- (NSArray)residentEnabledDevices;
- (NSArray)rooms;
- (NSArray)serviceGroups;
- (NSArray)triggerOwnedActionSets;
- (NSArray)triggers;
- (NSArray)users;
- (NSArray)usersPendingUserManagementOperations;
- (NSArray)usersSupportingPresence;
- (NSArray)wiFiRouterAccessories;
- (NSArray)zones;
- (NSData)threadOperationalDataset;
- (NSDictionary)assistantObject;
- (NSHashTable)removeAccessoryInProgressForHMDAccessories;
- (NSMapTable)addPendingAccessories;
- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers;
- (NSNumber)availableBSPsCount;
- (NSNumber)availableBorderRouters;
- (NSNumber)matterFabricID;
- (NSNumber)overriddenHomeAccessControl;
- (NSSet)notificationDeregistrations;
- (NSSet)notificationRegistrations;
- (NSString)contextID;
- (NSString)name;
- (NSString)threadNetworkID;
- (NSString)unfilteredThreadNetworkID;
- (NSString)urlString;
- (NSUUID)activeNetworkRouterUUID;
- (NSUUID)contextSPIUniqueIdentifier;
- (NSUUID)primaryNetworkRouterManagingDeviceUUID;
- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)user;
- (id)__readWriteResponseHandler:(id)handler unhandledRequests:(id)requests;
- (id)__residentDeviceForAccessory:(id)accessory fromMap:(id)map;
- (id)_addMediaSessionForCurrentAccessory:(id)accessory;
- (id)_appDataContainerForMessage:(id)message;
- (id)_buildRequestMapTableFromRequests:(id)requests pendingResponses:(id)responses;
- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast accessoryServer:(id)server;
- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)transports;
- (id)_checkResidentCapabilitiesForCredentialSharing:(id)sharing;
- (id)_createBuiltinActionSets;
- (id)_createEventsPayload:(uint64_t)payload;
- (id)_createMediaSessionWithEndpoint:(id)endpoint;
- (id)_createMessageForReadWriteRequest:(id)request source:(unint64_t)source withCompletionHandler:(id)handler;
- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)notifications;
- (id)_enqueueRetrievalTupleForAccessory:(id)accessory linkType:(int64_t)type inProgress:(BOOL *)progress completion:(id)completion;
- (id)_getReachabilityTupleForAccessoryUUID:(id)d;
- (id)_handleRenameHomeModel:(id)model message:(id)message;
- (id)_hasConfirmedPrimaryResidentDevice;
- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)characteristics accessoryServer:(id)server;
- (id)_initWithCoder:(id)coder;
- (id)_outgoingInvitationForUserWithHandle:(id)handle;
- (id)_primaryAccessoryForServer:(id)server;
- (id)_productDataFromHAPAccessory:(id)accessory;
- (id)_readRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests;
- (id)_removeAccessoriesCommon:(id)common;
- (id)_residentDeviceForResidentUser:(id)user;
- (id)_residentUserForResidentDevice:(id)device;
- (id)_residentUsers;
- (id)_retrieveTupleForPrimaryAccessory:(id)accessory linkType:(int64_t)type;
- (id)_setupCodeProviderForMessage:(id)message;
- (id)_setupDescriptionFromData:(id)data error:(id *)error;
- (id)_setupPendingResponseTimerIdentifier:(id)identifier originalRequestIdentifier:(id)requestIdentifier;
- (id)_splitCharacteristicChanges:(id)changes changedAccessories:(id)accessories;
- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)notifications;
- (id)_updateAndGetOwnedTriggers;
- (id)_userForDevice:(id)device;
- (id)accessoriesWithUUIDs:(id)ds;
- (id)accessoryAdministerPrivilegeCATID:(BOOL)d;
- (id)accessoryForMediaProfileUniqueIdentifier:(id)identifier;
- (id)accessoryOperatePrivilegeCATID:(BOOL)d;
- (id)accessorySettingsMessengerMessageTargetUUID;
- (id)accessoryWithDeviceIdentifier:(id)identifier;
- (id)accessoryWithEndpointIdentifier:(id)identifier;
- (id)accessoryWithIdentifier:(id)identifier;
- (id)accessoryWithSPIClientIdentifier:(id)identifier;
- (id)accessoryWithUUID:(id)d;
- (id)actionSetWithName:(id)name;
- (id)actionSetWithUUID:(id)d;
- (id)actionWithDictionaryRepresentation:(id)representation;
- (id)addActionSetName:(id)name;
- (id)addName:(id)name;
- (id)allNewlyConfiguredAccessories;
- (id)audioDestinationControllerDataForDestination:(id)destination;
- (id)backingStoreObjects:(int64_t)objects;
- (id)balancedResidentMapForAccessories:(id)accessories;
- (id)builtInActionSetInfo;
- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)d languageValuesDataProvider:(id)provider;
- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler logEventSubmitter:(id)submitter legacyMessageReceiver:(id)receiver;
- (id)createActionSetWithName:(id)name uuid:(id)uuid type:(id)type;
- (id)createAppleMediaAccessoriesStateManagerMetricsDispatcherWithIdentifier:(id)identifier logEventSubmitter:(id)submitter;
- (id)createAppleMediaAccessoriesStateManagerWithIdentifier:(id)identifier messenger:(id)messenger metricsDispatcher:(id)dispatcher;
- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)identifier messageDispatcher:(id)dispatcher;
- (id)createMultiuserSettingsMessenger:(id)messenger messageDispatcher:(id)dispatcher;
- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)snapshot operationalKeyPair:(id)pair error:(id *)error;
- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)submitter;
- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)d messageDispatcher:(id)dispatcher metricsDispatcher:(id)metricsDispatcher;
- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)d;
- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler;
- (id)createUnifiedLanguageValueListSettingDataProvider;
- (id)currentAccessoryHomeUUID;
- (id)currentAccessorySetupMetricDispatcher;
- (id)deletedBackingStoreObject;
- (id)descriptionWithPointer:(BOOL)pointer;
- (id)destinationControllerDataForAppleMediaAccessory:(id)accessory;
- (id)destinationControllerWithCommittedDestinationIdentifier:(id)identifier;
- (id)destinationControllerWithDestinationIdentifier:(id)identifier;
- (id)destinationControllerWithIdentifier:(id)identifier;
- (id)destinationControllers;
- (id)destinationForAppleMediaAccessory:(id)accessory;
- (id)destinationForMediaSystem:(id)system;
- (id)destinationManagerPassingTest:(id)test;
- (id)destinationManagerWithDestinationIdentifier:(id)identifier;
- (id)destinationManagerWithParentIdentifier:(id)identifier;
- (id)destinationManagersWithDestinationIdentifiers:(id)identifiers supportedOptions:(unint64_t)options;
- (id)deviceForAccessoryUUID:(id)d forRemoteEventRouterClientController:(id)controller;
- (id)deviceForAppleMediaAccessoryMessageRouter:(id)router message:(id)message;
- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)controller;
- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)level;
- (id)dumpCharacteristicNotificationRegistry;
- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)level;
- (id)dumpStateWithPrivacyLevel:(unint64_t)level;
- (id)emptyModelObjectWithChangeType:(unint64_t)type;
- (id)eventRouterDumpStateInfo;
- (id)eventRouterServerDiagnosticInfo;
- (id)eventSourceForMediaGroupsAggregator:(id)aggregator;
- (id)eventStoreReadHandle;
- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)controller;
- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)controller;
- (id)expandedTopicsWithTopics:(id)topics;
- (id)fabricDataInLegacyStorage;
- (id)fetchOperationalFabricDataWithError:(id *)error;
- (id)filterBuiltinActionSets:(id)sets;
- (id)getBulletinBoardNotificationSerializedFileName;
- (id)getCameraNotificationSettingsSerializedFileName;
- (id)getServiceTransaction:(id)transaction parentUUID:(id)d changeType:(unint64_t)type;
- (id)getTransactionFromHAPAccessory:(id)accessory hmdAccessory:(id)hmdAccessory uuid:(id)uuid hostAccessoryUUID:(id)d objectChangeType:(unint64_t)type;
- (id)hapAccessoriesForServer:(id)server;
- (id)hapAccessoriesForServer:(id)server linkType:(int64_t)type;
- (id)hapAccessoryServerIdentifiers;
- (id)hapAccessoryUniqueIdentifiers;
- (id)hapAccessoryWithIdentifier:(id)identifier;
- (id)hapAccessoryWithIdentifier:(id)identifier instanceID:(id)d;
- (id)hmdHAPAccessoryWithHAPAccessory:(id)accessory;
- (id)homeBulletinContext;
- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)type;
- (id)homeConfigurationUUID;
- (id)homeLocationWithPrivacyLevel:(unint64_t)level;
- (id)hubAccessories;
- (id)iCloudIdentifier;
- (id)lightProfileWithUUID:(id)d;
- (id)loadMigrationBulletinBoardNotificationsFromDisk;
- (id)loadMigrationCameraNotificationSettingsFromDisk;
- (id)localAndRemoteSubscriptionProvider;
- (id)matterAccessoriesWithNewFirmwareInstalledInHome;
- (id)matterAccessoryWithIdentifier:(id)identifier;
- (id)matterAccessoryWithNodeID:(id)d;
- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions;
- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)options;
- (id)mediaDestinationsInRoom:(id)room;
- (id)mediaGroupsAggregateDataTopicName;
- (id)mediaNotificationPayloadForProfile:(void *)profile;
- (id)mediaPassword;
- (id)mediaProfileWithUUID:(id)d;
- (id)mediaSessionStateWithIdentifier:(id)identifier;
- (id)mediaSessionWithIdentifier:(id)identifier;
- (id)mediaSessionWithUUID:(id)d;
- (id)mediaSystemController:(id)controller accessoryForUUID:(id)d;
- (id)mediaSystemForAppleMediaAccessory:(id)accessory;
- (id)mediaSystemWithUUID:(id)d;
- (id)mediaSystemsWithUUIDs:(id)ds;
- (id)messageTargetForDeviceIdentifier:(id)identifier;
- (id)migrateOwnedTriggers;
- (id)modelObjectWithChangeType:(unint64_t)type version:(int64_t)version;
- (id)multiUserSettings;
- (id)namesOfServicesWithNewFirmwareAvailableInHome;
- (id)newFabricData;
- (id)notificationRegistrationsForAppleMediaAccessories;
- (id)operationalKeyPairForPairing;
- (id)outgoingInvitationWithUUID:(id)d;
- (id)owner;
- (id)participantDataTopicForAccessory:(id)accessory mediaGroupsAggregator:(id)aggregator;
- (id)performReadRequests:(id)requests loggingObject:(id)object flow:(id)flow;
- (id)performReadRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow;
- (id)performWriteRequests:(id)requests loggingObject:(id)object flow:(id)flow;
- (id)performWriteRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow;
- (id)playbackArchiveWithSessionIdentifier:(id)identifier;
- (id)prepareUserManagementOperationForUser:(id)user accessories:(id)accessories type:(unint64_t)type error:(id *)error;
- (id)prepareUserManagementOperationForUser:(id)user accessory:(id)accessory type:(unint64_t)type model:(id)model error:(id *)error;
- (id)primaryResident;
- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)controller;
- (id)propertiesRegisteredForMediaProfileUniqueIdentifier:(id)identifier;
- (id)receiverForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage;
- (id)removeName:(id)name;
- (id)replaceActionSetName:(id)name withNewName:(id)newName;
- (id)replaceName:(id)name withNewName:(id)newName;
- (id)resolveReceiverForMessageTargetUUID:(id)d;
- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)identifier;
- (id)roomForAccessoryUUID:(id)d;
- (id)roomForAllDestinationParentIdentifiers:(id)identifiers;
- (id)roomWithName:(id)name;
- (id)roomWithUUID:(id)d;
- (id)roomWithUniqueIdentifier:(id)identifier forClientIdentifierSalt:(id)salt;
- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)identifier;
- (id)routerForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage;
- (id)routerServerUserAccessControlProviderForIdentifier:(id)identifier;
- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)message;
- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)data mediaGroupsAggregator:(id)aggregator;
- (id)serviceGroupWithName:(id)name;
- (id)serviceGroupWithUUID:(id)d;
- (id)sharedHomeModel;
- (id)sharedUsers;
- (id)shortDescription;
- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)store error:(id *)error;
- (id)storedOperationalKeyPair;
- (id)storedSharedHomeFabricData;
- (id)targetAccessoriesWithDestinationIdentifiers:(id)identifiers;
- (id)timerWithTimerInterval:(double)interval;
- (id)triggerOwnedActionSetWithUUID:(id)d;
- (id)triggerWithName:(id)name;
- (id)triggerWithUUID:(id)d;
- (id)updateHomeWithModel:(id)model message:(id)message;
- (id)updatePersonManagerSettings:(id)settings;
- (id)userWithMergeID:(id)d;
- (id)userWithPairingIdentity:(id)identity;
- (id)userWithPairingIdentityIdentifier:(id)identifier;
- (id)userWithUUID:(id)d;
- (id)validateName:(id)name;
- (id)writeRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests;
- (id)zoneWithName:(id)name;
- (id)zoneWithUUID:(id)d;
- (int64_t)atHomeLevel;
- (int64_t)destinationTypeForDestinationWithIdentifier:(id)identifier;
- (int64_t)homeLocation;
- (int64_t)minimumMediaUserPrivilege;
- (int64_t)protectionMode;
- (int64_t)reachableAccessoriesCount;
- (int64_t)reachableAccessoriesCountExcludingMatter;
- (int64_t)reachableAppleMediaAccessoriesCount;
- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)access;
- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)access source:;
- (uint64_t)supportsUnifiedMediaNotificationsOnResidents;
- (unint64_t)accessNotAllowedReasonCode;
- (unint64_t)accessoryCountForRoom:(id)room;
- (unint64_t)accessorySettingsLocalMessageHandler:(id)handler callerPrivilegeWithMessage:(id)message;
- (unint64_t)assistantAccessCapableAccessoryCount;
- (unint64_t)deriveNetworkRouterSupport:(unint64_t)support;
- (unint64_t)networkRouterSupport;
- (unint64_t)networkRouterSupportDisableReason;
- (unint64_t)numMatterV2Keys;
- (unint64_t)threadNetworkSequenceNumber;
- (void)__addMediaSession:(id)session;
- (void)__encodeAccessoriesWithCoder:(id)coder options:(unint64_t)options;
- (void)__handleAcceptedOutgoingInvitationResponse:(id)response destinationAddress:(id)address publicKey:(id)key username:(id)username issuerPublicKeyER:(id)r presenceAuthStatus:(id)status completionHandler:(id)handler;
- (void)__handleAddHAPAccessoryModel:(id)model message:(id)message;
- (void)__handleAddMediaAccessoryModel:(id)model message:(id)message;
- (void)__handleCancelledOutgoingInvitation:(id)invitation;
- (void)__handleCompletedOutgoingInvitation:(id)invitation;
- (void)__handleProcessStateChange:(id)change;
- (void)__removeAccessory:(void *)accessory isBeingReplaced:(void *)replaced isForceUpdate:(char)update message:(void *)message;
- (void)__requestAccessoryBrowsing;
- (void)__saveConfigurationVersionTransaction;
- (void)__updateServiceTransaction:(id)transaction accessoryTransaction:(id)accessoryTransaction service:(id)service accessory:(id)accessory hapService:(id)hapService;
- (void)_accessoryPairingDidComplete:(id)complete configuration:(id)configuration pairingEvent:(id)event accessoryServer:(id)server certificationStatus:(int64_t)status requestMessage:(id)message;
- (void)_addAccessories:(id)accessories;
- (void)_addAccessoryToBalancedResidentMap:(id)map residentDevice:(id)device balancedResidentMap:(id)residentMap;
- (void)_addAllUsersToAccessory:(id)accessory;
- (void)_addAndMaybeAssociateMediaAccessory:(void *)accessory message:;
- (void)_addMediaAccessory:(id)accessory message:(id)message;
- (void)_addNewTrigger:(id)trigger message:(id)message payloadAnnex:(id)annex triggerModel:(id)model;
- (void)_addOutgoingInvitations:(id)invitations message:(id)message transactionCompleted:(id)completed;
- (void)_addResidentWithUsername:(id)username publicKey:(id)key destination:(id)destination;
- (void)_addResponseTuplesFromDictionary:(id)dictionary accessoryRequestMapTable:(id)table responseTuples:(id)tuples completedGroup:(id)group logEvents:(id)events;
- (void)_addRetrievalCompletionTuple:(id)tuple;
- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)change message:(id)message;
- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)version message:(id)message;
- (void)_addTransactionWithProtectionMode:(id)mode message:(id)message;
- (void)_addUserToContainer:(id)container;
- (void)_addUserToIdentityRegistry:(id)registry;
- (void)_addUsers:(id)users accessory:(id)accessory;
- (void)_addUsersWithInviteInformations:(id)informations message:(id)message;
- (void)_applyDeviceLockCheck:(uint64_t)check forSource:(void *)source message:(void *)message completion:;
- (void)_applyNotificationDeregistrations;
- (void)_areWriteRequestsAllowed:(id)allowed message:(id)message completion:(id)completion;
- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)accessory;
- (void)_auditChangedCharacteristics:(id)characteristics;
- (void)_buildCharacteristicWriteRequest:(id)request accessoryWriteRequestMapTable:(id)table accessoryList:(id)list responseTuples:(id)tuples user:(id)user;
- (void)_cancelPairingWithAccessoryDescription:(id)description context:(id)context;
- (void)_cancelPairingWithAccessoryUUID:(id)d context:(id)context completionHandler:(id)handler;
- (void)_cleanAddAccessoryOperations;
- (void)_cleanRemovedUsers:(id)users;
- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)transaction;
- (void)_clearCHIPStorageWithCompletion:(id)completion;
- (void)_configureBulletinNotification;
- (void)_configureConfiguredResident:(id)resident desiredConfigState:(unint64_t)state message:(id)message;
- (void)_configureNetworkRouterClientManager:(id)manager;
- (void)_configureUnconfiguredResident:(id)resident desiredConfigState:(unint64_t)state;
- (void)_continueLegacyAddAccessoryWithUUID:(id)d unassociatedAccessory:(id)accessory setupCode:(id)code appID:(id)iD message:(id)message;
- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)description progressHandlerDelegate:(id)delegate message:(id)message;
- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)d orUnassociatedAccessory:(id)accessory message:(id)message;
- (void)_createModifyNotificationsCoalesceTimerIfNeeded;
- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)message pairingEvent:(id)event completion:(id)completion;
- (void)_dequeueRetrievalForAccessory:(id)accessory linkType:(int64_t)type error:(id)error;
- (void)_deregisterDeviceForReachabilityNotification:(id)notification;
- (void)_deregisterPairedAccessory:(id)accessory;
- (void)_disableDirectCharacteristicNotificationsForClient:(id)client;
- (void)_disableNotificationsForClient:(id)client;
- (void)_disableNotificationsForDevices:(id)devices;
- (void)_dispatchCHIPReport:(id)report destination:(id)destination;
- (void)_enableMediaNotifications:(void *)notifications directlyOnMediaAccessory:(void *)accessory completion:;
- (void)_enableMediaNotifications:(void *)notifications forMediaAccessory:;
- (void)_enableMultiUserWithMessage:(void *)message;
- (void)_enableNotificationsForDevices:(id)devices;
- (void)_encodeActionSets:(id)sets coder:(id)coder;
- (void)_encodeObjectsWithAccessoriesWithCoder:(id)coder;
- (void)_encodeWithCoder:(id)coder;
- (void)_evaluateNetworkProtectionAndRouterManagement;
- (void)_evaluateNetworkProtectionSupport;
- (void)_evaluateNetworkRouterManagementForTransaction:(id)transaction;
- (void)_evaluateOwnerTrustZoneCapabilityAndNotify;
- (void)_evaluateShouldRelaunchAndSetRelaunch;
- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)completion;
- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)completion;
- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)completion;
- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion;
- (void)_handleAccessoryReachabilityChange:(id)change;
- (void)_handleAccessoryReachabilityEventNotificationsRegistration:(id)registration;
- (void)_handleAccessoryReachabilityUpdatesTimerFired;
- (void)_handleAddAccessories:(id)accessories;
- (void)_handleAddAccessory:(id)accessory;
- (void)_handleAddAccessoryModel:(id)model message:(id)message;
- (void)_handleAddAccessoryWithDescription:(id)description;
- (void)_handleAddAccessoryWithDescription:(void *)description progressHandlerDelegate:(void *)delegate message:;
- (void)_handleAddActionSet:(id)set;
- (void)_handleAddActionSetFromBuilder:(id)builder;
- (void)_handleAddActionSetModel:(id)model message:(id)message;
- (void)_handleAddEventTrigger:(id)trigger;
- (void)_handleAddEventTriggerModel:(id)model message:(id)message;
- (void)_handleAddHomeOwnedActionSet:(id)set;
- (void)_handleAddOutgoingHomeInvitationModel:(id)model message:(id)message;
- (void)_handleAddRoom:(id)room;
- (void)_handleAddRoomModel:(id)model message:(id)message;
- (void)_handleAddServiceGroup:(id)group;
- (void)_handleAddServiceGroupModel:(id)model message:(id)message;
- (void)_handleAddTimerTrigger:(id)trigger;
- (void)_handleAddTimerTriggerModel:(id)model message:(id)message;
- (void)_handleAddTriggerOwnedActionSet:(id)set;
- (void)_handleAddTriggers:(id)triggers;
- (void)_handleAddUserModel:(id)model message:(id)message;
- (void)_handleAddZone:(id)zone;
- (void)_handleAddZoneModel:(id)model message:(id)message;
- (void)_handleAllowUserManagementMessage:(id)message;
- (void)_handleAssistantAccessControlUpdate:(id)update;
- (void)_handleCHIPSendRemoteRequestMessage:(id)message;
- (void)_handleCancelPairingAccessory:(id)accessory;
- (void)_handleCharacteristicEnableNotification:(id)notification;
- (void)_handleCharacteristicRead:(id)read;
- (void)_handleCharacteristicWrite:(id)write;
- (void)_handleCharacteristicsChangedNotification:(id)notification;
- (void)_handleCoalescedModifyNotifications;
- (void)_handleConfirmResidentRequest:(id)request;
- (void)_handleCreateUniquePSKClientConfiguration:(id)configuration;
- (void)_handleDidOnboardLocationServicesChange:(id)change message:(id)message;
- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)address;
- (void)_handleDisableNotificationsTimerFired;
- (void)_handleEnableMultiUserRequest:(id)request;
- (void)_handleEnableNotifications:(id)notifications;
- (void)_handleExecuteActionSet:(id)set;
- (void)_handleExecuteConfirmationOfTrigger:(id)trigger;
- (void)_handleFailedAccessories:(id)accessories requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses fastFailedAccessories:(id)failedAccessories slowFailedAccessories:(id)slowFailedAccessories tmpErrorResponseTuples:(id)tuples waitGroup:(id)self0 failureWaitGroup:(id)self1 activity:(id)self2;
- (void)_handleFetchTriggerNameRequest:(id)request;
- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)identifier;
- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)change message:(id)message;
- (void)_handleHomeDataRequest:(id)request;
- (void)_handleHomeLocationChange:(int64_t)change previousLocation:(int64_t)location;
- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)admin;
- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)request;
- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)request;
- (void)_handleJoinOrFormThreadNetworkMessage:(id)message;
- (void)_handleLegacyAddAccessory:(id)accessory;
- (void)_handleLocationServicesEnabledChange:(id)change message:(id)message;
- (void)_handleMediaContentProfileAccessControlUpdate:(id)update;
- (void)_handleMediaPropertiesRead:(id)read;
- (void)_handleMediaPropertiesWrite:(id)write;
- (void)_handleModifyCharacteristicNotifications:(id)notifications;
- (void)_handleMultiUserEnabledChange:(id)change message:(id)message;
- (void)_handleMultipleCharacteristicRead:(id)read;
- (void)_handleMultipleCharacteristicWrite:(id)write;
- (void)_handleNetworkProtectionModeChangeForTransaction:(id)transaction;
- (void)_handleQueryResidentReachabilityForAccessories:(id)accessories;
- (void)_handleReadMediaProperties:(id)properties source:(unint64_t)source message:(id)message completionHandler:(id)handler;
- (void)_handleReceivedNonCloudSourcedSharedHomeModel;
- (void)_handleRemoteGatewayNotificationRegistration:(id)registration enable:(BOOL)enable;
- (void)_handleRemoteReachabilityNotificationTimerFired;
- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)request;
- (void)_handleRemoteUserClientCloudShareRequest:(id)request;
- (void)_handleRemoveAccessoryAfterUserConsent:(id)consent message:(id)message;
- (void)_handleRemoveAccessoryMessage:(id)message;
- (void)_handleRemoveAccessoryModel:(id)model message:(id)message;
- (void)_handleRemoveActionSet:(id)set;
- (void)_handleRemoveActionSetModel:(id)model message:(id)message;
- (void)_handleRemoveAppDataModel:(id)model message:(id)message;
- (void)_handleRemoveClientConfiguration:(id)configuration;
- (void)_handleRemoveOutgoingHomeInvitationModel:(id)model message:(id)message;
- (void)_handleRemoveRoom:(id)room;
- (void)_handleRemoveRoomModel:(id)model message:(id)message;
- (void)_handleRemoveServiceGroup:(id)group;
- (void)_handleRemoveServiceGroupModel:(id)model message:(id)message;
- (void)_handleRemoveTrigger:(id)trigger;
- (void)_handleRemoveTriggerModel:(id)model message:(id)message;
- (void)_handleRemoveUser:(id)user;
- (void)_handleRemoveUserModel:(id)model message:(id)message;
- (void)_handleRemoveZone:(id)zone;
- (void)_handleRemoveZoneModel:(id)model message:(id)message;
- (void)_handleRename:(id)rename;
- (void)_handleRequestHomeDataSync:(id)sync;
- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)message;
- (void)_handleResetMatterStorageRequest:(id)request;
- (void)_handleResidentChange;
- (void)_handleResolveThreadNetworkRequest:(id)request;
- (void)_handleResponseForElectMessageToResident:(id)resident error:(id)error;
- (void)_handleRetrieveAsyncResults:(id)results;
- (void)_handleRetrieveHomeLocationForFeedback:(id)feedback;
- (void)_handleRollReaderKey:(id)key;
- (void)_handleSendingNotificationsForRequest:(id)request requestIdentifier:(id)identifier supportsMultiPartResponse:(BOOL)response characteristicUpdates:(id)updates completion:(id)completion;
- (void)_handleSetAppData:(id)data;
- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)request;
- (void)_handleSetHasOnboardedForAccessCodeChange:(id)change message:(id)message;
- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)message;
- (void)_handleSetHasOnboardedForWalletKeyChange:(id)change message:(id)message;
- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change;
- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)version;
- (void)_handleSiriPhraseOptionsStatusChange:(id)change message:(id)message;
- (void)_handleSiriPhraseOptionsUpdateRequest:(id)request;
- (void)_handleSoundCheckChange:(id)change message:(id)message;
- (void)_handleSoundCheckUpdateRequest:(id)request;
- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)message;
- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)message;
- (void)_handleTestUpgradeToROAR:(id)r;
- (void)_handleThreadNetworkCredentialsRequest:(id)request;
- (void)_handleUnjoinThreadNetworkMessage:(id)message;
- (void)_handleUpdateAppDataModel:(id)model message:(id)message;
- (void)_handleUpdateAutomaticSoftwareUpdate:(id)update;
- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)update;
- (void)_handleUpdateMediaPassword:(id)password;
- (void)_handleUpdateMediaPeerToPeerEnabled:(id)enabled;
- (void)_handleUpdateMinimumMediaUserPrivilege:(id)privilege;
- (void)_handleUpdateNetworkProtection:(id)protection;
- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)model message:(id)message;
- (void)_handleUpdateOutgoingInvitationState:(id)state;
- (void)_handleUpdatePresenceConsent:(id)consent;
- (void)_handleUpdateRequestForHomeInvitation:(id)invitation controllerPublicKey:(id)key controllerUsername:(id)username invitationState:(int64_t)state presenceAuthStatus:(id)status preferredUserID:(id)d fromHandle:(id)handle fromAddress:(id)self0 issuerPublicKeyER:(id)self1 message:(id)self2 messageResponseHandler:(id)self3;
- (void)_handleUpdateRequestForHomeInvitationFromInvitee:(id)invitee;
- (void)_handleUpdateUserAccess:(id)access;
- (void)_handleUpdateUserAnnounceAccess:(id)access;
- (void)_handleUpdateUserCamerasAccessLevel:(id)level;
- (void)_handleUserConsentForAccessoryReplacement:(id)replacement consent:(BOOL)consent message:(id)message;
- (void)_handleUserConsentResponseForAccessory:(id)accessory;
- (void)_handleUserInvitations:(id)invitations;
- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)ds;
- (void)_handleWriteMediaProperties:(id)properties source:(unint64_t)source requestMessage:(id)message completionHandler:(id)handler;
- (void)_incrementCurrentSequenceNumber;
- (void)_loadBalancedRedispatchForAccessories:(id)accessories source:(unint64_t)source biomeSource:(unint64_t)biomeSource dispatchGroup:(id)group writeRequestMap:(id)map requestMessage:(id)message responseTuples:(id)tuples;
- (void)_migrateAppleMediaAccessoriesWithCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion;
- (void)_migrateHomeAllObjectsCloudZone:(id)zone migrationGroup:(id)group migrationQueue:(id)queue saveModels:(id)models runModels:(id)runModels;
- (void)_migrateHomeMediaSettingsCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion;
- (void)_migrateHomeObjectCloudZone:(id)zone defaultModel:(id)model completion:(id)completion;
- (void)_migrateHomeSettingsCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion;
- (void)_migrateHomeUsersCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion;
- (void)_migrateResidentDevicesCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion;
- (void)_migrateUnknownAccessoriesWithCloudZone:(id)zone accessoryUUIDs:(id)ds migrationQueue:(id)queue completion:(id)completion;
- (void)_modifyCharacteristicNotificationsOnResident:(id)resident mediaNotifications:(id)notifications actionSetNotificationPayload:(id)payload enableNotification:(BOOL)notification;
- (void)_notificationPayloadsForRemoteGateway:(void *)gateway accessories:(void *)accessories enableCharacteristicNotificationPayload:(void *)payload characteristicNotificationThresholdsPayload:(void *)thresholdsPayload disableCharacteristicNotificationPayload:(void *)notificationPayload enableMediaNotificationPayload:(void *)mediaNotificationPayload disableMediaNotificationPayload:;
- (void)_notifyChangedProperties:(id)properties withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address;
- (void)_notifyClientOfNewlyAddedAccessories:(id)accessories requestMessage:(id)message;
- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories shouldRefreshBadge:(BOOL)badge withCompletion:(id)completion;
- (void)_notifyClientsOfUpdatedResidentUser:(id)user;
- (void)_notifyOwnerOfAddedAccessories:(id)accessories completion:(id)completion;
- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast;
- (void)_notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information;
- (void)_notifyRetrievalError:(id)error accessoryServer:(id)server linkType:(int64_t)type accessoryOperationBlock:(id)block;
- (void)_notifyThreadLayerOfResidentChange;
- (void)_notifyUpdatedCharacteristic:(id)characteristic withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address completion:(id)completion;
- (void)_pairAccessoryWithAccessoryDescription:(id)description configuration:(id)configuration pairingEvent:(id)event progressHandler:(id)handler requestMessage:(id)message;
- (void)_pairAccessoryWithAccessoryDescription:(id)description unpairedAccessory:(id)accessory configuration:(id)configuration pairingEvent:(id)event requestMessage:(id)message;
- (void)_performAllowedWriteCharacteristicValues:(uint64_t)values source:(void *)source identifier:(uint64_t)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:;
- (void)_performOperation:(id)operation completion:(id)completion;
- (void)_performPostSaveActionsWithReason:(id)reason;
- (void)_postInternalNotificationForChangedCharacteristics:(id)characteristics previouslyNilChangedCharacteristics:(id)changedCharacteristics modifiedCharacteristics:(id)modifiedCharacteristics changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message broadcast:(BOOL)broadcast;
- (void)_processAccessoriesToAddForUnpairedAccessory:(id)accessory certificationStatus:(int64_t)status accessoryServer:(id)server networkCredential:(id)credential pairingEvent:(id)event message:(id)message completionHandler:(id)handler;
- (void)_processLegacyPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context;
- (void)_processOutgoingInvitationsRequest:(id)request;
- (void)_processPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context;
- (void)_processProductDataForNewlyAddedAccessory:(id)accessory transaction:(id)transaction;
- (void)_processUpdatedAccessoryServer:(id)server reAddServices:(BOOL)services;
- (void)_processUpdatedProductDataForAccessory:(id)accessory hapAccessory:(id)hapAccessory transaction:(id)transaction;
- (void)_purgeResidentUsers;
- (void)_reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable;
- (void)_readCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source withCompletionHandler:(id)handler;
- (void)_readCharacteristicValuesForAccessories:(id)accessories readRequestMap:(id)map responseTuples:(id)tuples requestMessage:(id)message source:(unint64_t)source viaDevice:(id)device completionHandler:(id)handler;
- (void)_readProfileState:(void *)state viaDevice:;
- (void)_reallyRedispatchReadsToDevice:(id)device accessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source responseTuples:(id)tuples activity:(id)self0;
- (void)_reallyRedispatchWritesToDevice:(id)device accessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)self0 activity:(id)self1;
- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)completion;
- (void)_redispatchReadForAccessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source responseTuples:(id)tuples errorResponseTuples:(id)responseTuples;
- (void)_redispatchWriteForAccessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)tuples;
- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)refresh;
- (void)_refreshCharacteristicValuesOnHomeNotificationEnable;
- (void)_refreshMediaProfilesOnHomeNotificationEnable;
- (void)_refreshUserDisplayNames;
- (void)_registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)handler;
- (void)_registerDeviceForReachabilityNotification:(id)notification accessoryList:(id)list;
- (void)_registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier;
- (void)_registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier;
- (void)_registerForMessages;
- (void)_registerForNotifications;
- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)enabled completionHandler:(id)handler;
- (void)_registerForThreadNetworkEvents;
- (void)_registerPairedAccessory:(id)accessory transports:(unint64_t)transports setupHash:(id)hash;
- (void)_registerResidentReachabilityNotificationWithEnableAccessories:(id)accessories disableAccessories:(id)disableAccessories completionHandler:(id)handler;
- (void)_registerThreadResidentCommissioningMessageHandlers;
- (void)_relayAddTriggerToResident:(id)resident;
- (void)_remoteAccessEnabled:(BOOL)enabled;
- (void)_remoteAccessHealthMonitorTimerDidFire;
- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds;
- (void)_removeAccessories:(id)accessories message:(id)message;
- (void)_removeAccessoriesForPrimaryAccessory:(id)accessory error:(id)error completionHandler:(id)handler;
- (void)_removeAccessoriesFromContainers:(id)containers;
- (void)_removeAccessory:(id)accessory completionHandler:(id)handler;
- (void)_removeAccessoryWithUUID:(id)d message:(id)message;
- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler;
- (void)_removeCharacteristic:(id)characteristic;
- (void)_removeClientConfigurationWithIdentifier:(id)identifier;
- (void)_removeClientConfigurationWithIdentifier:(id)identifier completion:(id)completion;
- (void)_removeCloudData;
- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)devices;
- (void)_removeCorruptAccessories;
- (void)_removeMediaSessionWithIdentifier:(id)identifier;
- (void)_removeOutgoingInvitationForUser:(id)user;
- (void)_removePendingAccessoryAdd:(id)add;
- (void)_removeRetrievalCompletionTuple:(id)tuple;
- (void)_removeService:(id)service;
- (void)_removeTrigger:(id)trigger message:(id)message;
- (void)_removeUser:(id)user;
- (void)_removeUser:(id)user message:(id)message;
- (void)_removeUserFromContainer:(id)container;
- (void)_removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler;
- (void)_requestRemoveClientConfigurationWithIdentifier:(id)identifier;
- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)completion;
- (void)_resubscribeForNotificationsOnResident:(id)resident;
- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve completion:(id)completion;
- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)completion;
- (void)_retryStartThreadNetwork:(double)network;
- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)completion;
- (void)_saveSharedHomeToAccountWithReason:(id)reason postSyncNotification:(BOOL)notification options:(id)options;
- (void)_scheduleApplyNetworkRouterSettingsAction:(id)action;
- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)identifier requestMessage:(id)message multiPartResponse:(BOOL)response moreInMultiPartResponse:(BOOL)partResponse characteristicChanges:(id)changes completionHandler:(id)handler;
- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)message accessories:(id)accessories;
- (void)_sendInvitation:(id)invitation message:(id)message shareURL:(id)l shareToken:(id)token suppressHomeInviteNotification:(BOOL)notification logEventBuilder:(id)builder;
- (void)_sendInvitationCancelationRequestToInvitee:(id)invitee;
- (void)_sendReadRequestToAccessoryServer:(id)server requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses slowFailedAccessories:(id)accessories fastFailedAccessories:(id)failedAccessories unreachableWaitGroup:(id)group waitGroup:(id)self0 activity:(id)self1;
- (void)_sendRemoteMessageUsingNodeId:(unint64_t)id payload:(id)payload completion:(id)completion;
- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)accessories withCompletion:(id)completion error:(id)error;
- (void)_sendResidentInviteWithDestination:(id)destination;
- (void)_sendWriteRequestToAccessoryServer:(id)server requestMessage:(id)message source:(unint64_t)source failedAccessories:(id)accessories responseTuples:(id)tuples activity:(id)activity waitGroup:(id)group unreachableWaitGroup:(id)self0;
- (void)_setAccessories:(id)accessories;
- (void)_setupActiveNetworkRouterAccessory:(id)accessory existingRouterAccessories:(id)accessories;
- (void)_sharedAdminDidFailToAddAccessories:(id)accessories;
- (void)_startHomeNotificationDeregistrationTimer;
- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)completion;
- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)dataset completion:(id)completion;
- (void)_startThreadNetworkOnControllerWithCompletion:(id)completion;
- (void)_startThreadNetworkOnResidentWithCompletion:(id)completion;
- (void)_startThreadNetworkWithCompletion:(id)completion;
- (void)_stopThreadNetworkWithCompletion:(id)completion;
- (void)_subscribeForHomeAppleMediaNotificationsOnDirectTransports:(void *)transports;
- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)gateway accessories:(id)accessories;
- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)transports;
- (void)_subscribeForNotificationFromRemoteGateway:(void *)gateway;
- (void)_unconfigureNetworkRouterClientManager;
- (void)_unconfigurePairedAccessoriesForServer:(id)server updateReachability:(BOOL)reachability;
- (void)_unitTest_setRetrievalCompletionsTimeout:(double)timeout;
- (void)_unjoinThreadNetworkWithCompletion:(id)completion;
- (void)_unregisterForThreadNetworkEvents;
- (void)_updateActiveNetworkRouterAccessory:(id)accessory isReplacement:(BOOL)replacement withTransaction:(id)transaction;
- (void)_updateConfigurationStateForResidentDevice:(id)device desiredConfigState:(unint64_t)state message:(id)message;
- (void)_updateConfigurationVersion;
- (void)_updateCurrentUserForSharedHome;
- (void)_updateDirectAppleMediaNotificationsOnResidentChange:(void *)change previousResidentDevice:;
- (void)_updateExpectConfigurationVersion;
- (void)_updateHomeLocation;
- (void)_updateOutgoingInvitationsWithCompleteUserManagementOperation:(id)operation;
- (void)_updateReachabilityChangeToRegisteredDevices:(id)devices;
- (void)_updateResidentFirstAccessoryCommunicationEnabled;
- (void)_updateThreadNetworkWithModel:(id)model message:(id)message;
- (void)_updateWoWState:(id)state;
- (void)_waitForEarlyDispatchTimeout:(id)timeout requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource failedAccessories:(id)accessories responseTuples:(id)tuples activity:(id)activity unreachableWaitGroup:(id)self0 failureWaitGroup:(id)self1;
- (void)_waitForEarlyDispatchTimeoutOnReadRequest:(id)request requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses activity:(id)activity slowFailedAccessories:(id)accessories tmpErrorResponseTuples:(id)tuples unreachableWaitGroup:(id)self0 failureWaitGroup:(id)self1;
- (void)_waitForWriteRequestFanOut:(id)out requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)tuples failedAccessories:(id)accessories activity:(id)activity waitGroup:(id)self0 failureWaitGroup:(id)self1;
- (void)_wol_processChangedCharacteristicResponses:(id)responses;
- (void)_writeCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource withCompletionHandler:(id)handler;
- (void)_writeCharacteristicValues:(void *)values source:(void *)source message:(void *)message identifier:(void *)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:;
- (void)_writeCharacteristicValuesForAccessories:(id)accessories writeRequestMap:(id)map responseTuples:(id)tuples requestMessage:(id)message viaDevice:(id)device source:(unint64_t)source biomeSource:(unint64_t)biomeSource completionHandler:(id)self0;
- (void)_writeLogData:(id)data logName:(id)name completion:(id)completion;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didDiscoverAccessories:(id)accessories transaction:(id)transaction error:(id)error;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didStopPairingWithError:(id)error;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateCategory:(id)category;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateHasPairings:(BOOL)pairings;
- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateValuesForCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast;
- (void)accessoryBrowser:(id)browser didAddAccessoryAdvertisement:(id)advertisement;
- (void)accessoryBrowser:(id)browser didFindAccessoryServer:(id)server stateChanged:(BOOL)changed stateNumber:(id)number completion:(id)completion;
- (void)accessoryBrowser:(id)browser didFindAccessoryServerNeedingReprovisioning:(id)reprovisioning error:(id)error;
- (void)accessoryBrowser:(id)browser didFinishPairingForAccessoryServer:(id)server;
- (void)accessoryBrowser:(id)browser didFinishWACForAccessoryWithIdentifier:(id)identifier error:(id)error;
- (void)accessoryBrowser:(id)browser didRemoveAccessoryAdvertisement:(id)advertisement;
- (void)accessoryBrowser:(id)browser didRemoveAccessoryServer:(id)server error:(id)error;
- (void)accessoryBrowser:(id)browser didTombstoneAccessoryServer:(id)server;
- (void)accessoryBrowser:(id)browser didUpdateEndpoint:(id)endpoint;
- (void)accessoryBrowser:(id)browser discoveryFailedWithError:(id)error accessoryServer:(id)server linkType:(int64_t)type;
- (void)addAccessory:(id)accessory;
- (void)addCompanionAsResidentUser:(id)user;
- (void)addMediaSession:(id)session;
- (void)addMediaSessionState:(id)state;
- (void)addNewlyConfiguredAccessories:(id)accessories addSessionIdentifier:(id)identifier;
- (void)addNotificationDeregistrationForClientIdentifier:(id)identifier;
- (void)addNotificationRegistrationForClientIdentifier:(id)identifier includesAppleMediaAccessories:(BOOL)accessories;
- (void)addOutgoingInvitation:(id)invitation;
- (void)addResidentCapableDevice:(id)device;
- (void)addSharedUserEventBuilder:(id)builder;
- (void)addSharedUserResponseEventBuilder:(id)builder;
- (void)addToCurrentTriggers:(id)triggers;
- (void)addUnconfiguredResidentDevice:(id)device;
- (void)addUser:(id)user;
- (void)aggregator:(id)aggregator changedAccessoryCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD;
- (void)aggregator:(id)aggregator changedResidentCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD;
- (void)auditUsersForNotifications:(id)notifications;
- (void)btleAccessoryReachabilityProbeTimer:(BOOL)timer;
- (void)checkTimerTriggers;
- (void)cleanChangesIfNoAddChangeObjectID:(id)d completion:(id)completion;
- (void)clearAccessoryServerBrowserOperationalFabricData;
- (void)clientController:(id)controller didReceiveFetchedCachedEvents:(id)events source:(id)source;
- (void)completePotentialFabricDataCreation;
- (void)computeBridgedAccessoriesForAllBridges;
- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory;
- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)accessory accessories:(id)accessories uncommittedTransactions:(id)transactions;
- (void)configureAppleMediaAccessoriesStateManagerWithStateManagerWithFactory:(id)factory messengerFactory:(id)messengerFactory metricsDispatcherFactory:(id)dispatcherFactory;
- (void)configureBulletinNotification;
- (void)configureMediaDestinationControllersForAccessories:(id)accessories;
- (void)configureMediaGroupObjects;
- (void)configureMediaGroupsAggregateConsumer;
- (void)configureMediaGroupsAggregator;
- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager;
- (void)configureMediaSystems;
- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)factory;
- (void)configureNaturalLightingForDemoMode;
- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)enabled;
- (void)configurePrimaryResidentMessageRouterWithFactory:(id)factory metricsDispatcherFactory:(id)dispatcherFactory;
- (void)configureRemoteEventRouterClientControllerForAccessories:(id)accessories;
- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory;
- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)factory;
- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)address completion:(id)completion;
- (void)createRemoteEventRouterServerIfNeeded;
- (void)dealloc;
- (void)didReceiveAccessorySetting:(id)setting accessoryUUID:(id)d;
- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)consumer;
- (void)disableNotificationsForDevices:(id)devices;
- (void)dispatchRequestToEvaluateCondition:(id)condition forCharacteristics:(id)characteristics completion:(id)completion;
- (void)downloadLogWithController:(id)controller nodeId:(id)id type:(int64_t)type timeout:(double)timeout completion:(id)completion;
- (void)dropAllChangesWithArrayOfObjectIDs:(id)ds;
- (void)dropAllChangesWithObjectID:(id)d;
- (void)enableHomeNotificationsForMediaAccessory:(id)accessory;
- (void)enableMediaNotifications:(BOOL)notifications directlyOnMediaAccessory:(id)accessory completion:(id)completion;
- (void)enableMultiUser;
- (void)enableNotificationsForDevices:(id)devices;
- (void)enableUserListeningHistoryForAccessoryUUID:(id)d userUUID:(id)iD;
- (void)encodeMediaSystemsWithCoder:(id)coder modifiedOptions:(unint64_t)options;
- (void)encodeWithCoder:(id)coder;
- (void)endReportingSessionForMessage:(id)message;
- (void)evaluateNotificationConditionForCharacteristics:(id)characteristics homePresence:(id)presence completion:(id)completion;
- (void)evaluateResidentUpdate;
- (void)evaluateShouldRelaunchAndSetRelaunch;
- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion;
- (void)executeActionSet:(id)set;
- (void)executeActionsFromMessage:(id)message;
- (void)fetchAllMigratedObjectsForCloudZone:(id)zone completion:(id)completion;
- (void)fetchFabricDataForPairingWithCompletion:(id)completion;
- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)d publicKey:(id)key fetchFromResident:(BOOL)resident completion:(id)completion;
- (void)filterServiceTransactions:(id)transactions removedServiceUUIDs:(id)ds;
- (void)finishPairingForServer:(id)server;
- (void)fixupHomeAfterDecoding;
- (void)getReachableIPAccessories:(unint64_t *)accessories btleAccessories:(unint64_t *)btleAccessories mediaAccessories:(unint64_t *)mediaAccessories;
- (void)getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion;
- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)notification;
- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)notification;
- (void)handleAccessoryReachabilityChangeNotification:(id)notification;
- (void)handleAccountHandlesUpdated:(id)updated;
- (void)handleActiveAccountChanged:(id)changed;
- (void)handleCATUpdate;
- (void)handleCHIPSendRemoteRequestMessage:(id)message;
- (void)handleCHIPSendReportMessage:(id)message;
- (void)handleClearMatterControllerPrivateStorageRequest:(id)request;
- (void)handleClientProcessDisconnectedNotification:(id)notification;
- (void)handleCommissioningCertificateRequest:(id)request;
- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion;
- (void)handleCurrentUserPrivilegeChanged:(id)changed;
- (void)handleCurrentWiFiNetworkChangedNotification:(id)notification;
- (void)handleDeviceCapabilitiesUpdated:(id)updated;
- (void)handleDidReceiveIDSMessageWithNoListener:(id)listener;
- (void)handleEvaluatePredicateMessage:(id)message;
- (void)handleFetchLightProfileSettingsMessage:(id)message;
- (void)handleFetchLightProfileSettingsMessage:(id)message withLightProfileUUIDs:(id)ds;
- (void)handleFirstProcessDidBecomeActiveNotification:(id)notification;
- (void)handleHomeWasRemoved;
- (void)handleLastProcessDidBecomeInactiveNotification:(id)notification;
- (void)handleMatterPairingCompletionNotification:(id)notification;
- (void)handlePrimaryResidentChangeNotification:(id)notification;
- (void)handleRemoteDeviceBecameReachableNotification:(id)notification;
- (void)handleRemoveAccessory:(id)accessory completion:(id)completion;
- (void)handleRemoveAccessoryMessage:(id)message;
- (void)handleRemovedMediaSessions:(id)sessions;
- (void)handleReportingSessionResponseMessage:(id)message;
- (void)handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)message;
- (void)handleResetMatterStorageRequest:(id)request;
- (void)handleSetPreferredPrimaryMessage:(id)message;
- (void)handleSignificantTimeChange;
- (void)handleSiriEndPointAddedNotification:(id)notification;
- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)model actions:(id)actions;
- (void)handleUpdatedCharacteristics:(id)characteristics accessoryServer:(id)server;
- (void)handleUserFabricKeyUpdate:(id)update;
- (void)handleXPCConnectionInvalidated:(id)invalidated;
- (void)incrementOperatePrivilegeCATVersion:(id)version;
- (void)invokeCommandWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId commandId:(id)commandId fields:(id)fields timedInvokeTimeout:(id)timeout source:(unint64_t)source completion:(id)self0;
- (void)mediaSystemController:(id)controller didRemoveMediaSystem:(id)system;
- (void)mediaSystemController:(id)controller removeAccessories:(id)accessories fromAssistantAccessControl:(id)control;
- (void)mergeMediaDestinationControllerDataWithConsumer:(id)consumer;
- (void)mergeMediaDestinationsWithConsumer:(id)consumer;
- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)consumer;
- (void)migrateAfterCloudMerge:(id)merge;
- (void)migrateAfterResidentChange;
- (void)migrateCloudZone:(id)zone completion:(id)completion;
- (void)migrateLegacyLocationServiceSettings;
- (void)modifyCharacteristicNotifications:(id)notifications mediaNotifications:(id)mediaNotifications actionSetNotificationPayload:(id)payload enableNotification:(BOOL)notification withDevice:(id)device;
- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)manufacturers withCompletion:(id)completion;
- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories;
- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)accessory;
- (void)notifyNewRemotePeersFound:(BOOL)found remoteUsersRemoved:(id)removed forceRemoteNotificationRegistration:(BOOL)registration;
- (void)notifyOfAddedAccessory:(id)accessory;
- (void)notifyOfChangedCharacteristic:(id)characteristic changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message;
- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)device;
- (void)notifyOfRemovedAccessory:(id)accessory source:(unint64_t)source;
- (void)notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast;
- (void)notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information;
- (void)onThreadNetworkCallStateChange:(BOOL)change;
- (void)onThreadNetworkConnectionStateChange:(int64_t)change;
- (void)onThreadNetworkNodeTypeStateChange:(int64_t)change;
- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)change;
- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)change;
- (void)performLocalAddAccessoryWithDescription:(id)description progressHandlerDelegate:(id)delegate completion:(id)completion;
- (void)performPostSaveActionsWithReason:(id)reason;
- (void)prepareOperationalFabricData;
- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)controller;
- (void)queryPrimaryResidentReachabilityForAccessories:(id)accessories completion:(id)completion;
- (void)reEvaluateHomeHubState;
- (void)reEvaluateTriggers;
- (void)reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable;
- (void)readAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId params:(id)params completion:(id)completion;
- (void)readCharacteristicValues:(id)values identifier:(id)identifier source:(unint64_t)source qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
- (void)readCharacteristicValues:(id)values source:(unint64_t)source sourceForLogging:(id)logging qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
- (void)readProfileState:(id)state viaDevice:(id)device;
- (void)redispatchMediaReadRequests:(id)requests viaDevice:(id)device completion:(id)completion;
- (void)redispatchMediaWriteRequests:(id)requests viaDevice:(id)device completion:(id)completion;
- (void)redispatchToResidentMessage:(id)message target:(id)target responseQueue:(id)queue viaDevice:(id)device;
- (void)reevaluateAccessoryInfo;
- (void)refreshUserDisplayNames;
- (void)regionStateUpdated;
- (void)registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)handler;
- (void)registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier;
- (void)registerForDeviceWithCapabilities;
- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier;
- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier;
- (void)remoteAccessEnabled:(BOOL)enabled;
- (void)remoteAccessHealthMonitorTimerDidFire;
- (void)remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds;
- (void)removeAccessory:(id)accessory;
- (void)removeAccessory:(id)accessory completionHandler:(id)handler;
- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler;
- (void)removeAllUsersAndCloudDataFromAccessory:(id)accessory completionHandler:(id)handler;
- (void)removeBulletinBoardNotificationsMigrationFileFromDisk;
- (void)removeCameraNotificationSettingsMigrationFileFromDisk;
- (void)removeCharacteristic:(id)characteristic;
- (void)removeFromCurrentTriggers:(id)triggers;
- (void)removeMediaSession:(id)session;
- (void)removeMediaSessionState:(id)state;
- (void)removeNotificationDeregistrationForClientIdentifier:(id)identifier;
- (void)removeOutgoingInvitation:(id)invitation;
- (void)removeRemovedUser:(id)user;
- (void)removeResidentCapableDevice:(id)device;
- (void)removeService:(id)service;
- (void)removeSharedHomeFabricData;
- (void)removeSharedUserEventBuilder:(id)builder;
- (void)removeSharedUserResponseEventBuilder:(id)builder;
- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)completion;
- (void)removeTrigger:(id)trigger;
- (void)removeTriggerNoNotification:(id)notification;
- (void)removeUnconfiguredResidentDeviceWithUserID:(id)d;
- (void)removeUser:(id)user;
- (void)removeUserWithUserID:(id)d;
- (void)removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler;
- (void)resetAccessoryHashedRouteIdentifiers;
- (void)resetConfiguration;
- (void)residentDeviceManager:(id)manager didUpdatePrimaryResident:(id)resident previousPrimaryResident:(id)primaryResident;
- (void)residentDeviceManager:(id)manager didUpdateResidentAvailable:(BOOL)available;
- (void)residentDeviceManagerDidUpdateResidents:(id)residents;
- (void)respondMessage:(id)message withSettingResults:(id)results;
- (void)resubscribeForNotificationsOnResident:(id)resident;
- (void)retrieveHAPAccessoryForHMDAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve queue:(id)queue completion:(id)completion;
- (void)retrieveOperationalCertificatesForFabricID:(id)d commissioneeNodeID:(id)iD publicKey:(id)key completion:(id)completion;
- (void)retrieveOperationalCertificatesForFabricID:(id)d commissionerNodeID:(id)iD commissioneeNodeID:(id)nodeID publicKey:(id)key completion:(id)completion;
- (void)retrieveStateForTrackedAccessory:(id)accessory stateNumber:(id *)number isReachable:(BOOL *)reachable linkQuality:(unint64_t *)quality lastSeen:(id *)seen;
- (void)retrieveThreadNetworkMetadataWithCompletion:(id)completion;
- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)completion;
- (void)runPotentialFabricDataCreationBlock:(id)block;
- (void)saveAndSyncWithThreadOperationalDataset:(id)dataset forceUpdate:(BOOL)update;
- (void)saveSharedHomeToAccountWithReason:(id)reason postSyncNotification:(BOOL)notification options:(id)options;
- (void)saveToCurrentAccountWithReason:(id)reason;
- (void)scheduleRemoval;
- (void)sendFirmwareUpdateUINotification:(id)notification;
- (void)setAccessories:(id)accessories;
- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)needed;
- (void)setActiveNetworkRouterUUID:(id)d;
- (void)setAnyBTLEAccessoryReachable:(BOOL)reachable;
- (void)setAtHomeLevel:(int64_t)level;
- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)enabled;
- (void)setAvailableBSPsCount:(id)count;
- (void)setAvailableBorderRouters:(id)routers;
- (void)setBackingStore:(id)store;
- (void)setCHIPReportHandlerWithSubscriber:(id)subscriber handler:(id)handler;
- (void)setCameraReachabilityEventNotificationsEnabled:(BOOL)enabled forAccessory:(id)accessory completionHandler:(id)handler;
- (void)setCurrentUser:(id)user;
- (void)setHomeLocation:(int64_t)location;
- (void)setHomeUpdatedToROARAndInformClients;
- (void)setMediaPassword:(id)password;
- (void)setMediaPeerToPeerEnabled:(BOOL)enabled;
- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change;
- (void)setMinimumMediaUserPrivilege:(int64_t)privilege;
- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)version;
- (void)setName:(id)name;
- (void)setNaturalLightingContext:(id)context;
- (void)setNetworkRouterSupport:(unint64_t)support;
- (void)setNetworkRouterSupportDisableReason:(unint64_t)reason;
- (void)setNfcReaderKey:(id)key;
- (void)setOutgoingInvitations:(id)invitations;
- (void)setOverriddenHomeAccessControl:(id)control;
- (void)setOwner:(id)owner;
- (void)setOwnerTrustZoneCapable:(BOOL)capable;
- (void)setOwnerUser:(BOOL)user;
- (void)setPersonManagerSettings:(id)settings;
- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)d;
- (void)setProtectionMode:(int64_t)mode;
- (void)setRemoteAccessEnabled:(BOOL)enabled;
- (void)setRouterClientManager:(id)manager;
- (void)setThreadNetworkID:(id)d;
- (void)setThreadNetworkSequenceNumber:(unint64_t)number;
- (void)setThreadOperationalDataset:(id)dataset;
- (void)setUpFabricForPairingWithCompletion:(id)completion;
- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)fetch completion:(id)completion;
- (void)setWatchSkipVersionCheck:(BOOL)check;
- (void)setupBackingStore;
- (void)startReportingSessionForMessage:(id)message;
- (void)startThreadNetwork:(BOOL)network;
- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)completion;
- (void)stopThreadAccessoryPairingWithCompletion:(id)completion;
- (void)stopThreadNetworkWithCompletion:(BOOL)completion completion:(id)a4;
- (void)storeMigrationBulletinBoardNotificationsToDisk;
- (void)storeMigrationCameraNotificationSettingsToDisk;
- (void)storeMigrationCharacteristicsAuthorizationData;
- (void)submitLogEventForCommandResponse:(id)response nodeID:(unint64_t)d endpointID:(id)iD clusterID:(id)clusterID commandID:(id)commandID source:(unint64_t)source error:(id)error;
- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout error:(id)error;
- (void)subscribeForNotificationsFromRemoteGateway;
- (void)suspendedStateChangedForAccessory:(id)accessory suspendedState:(unint64_t)state;
- (void)test_addActionSets:(id)sets;
- (void)test_addRooms:(id)rooms;
- (void)test_addServiceGroups:(id)groups;
- (void)test_addTriggerOwnedActionSets:(id)sets;
- (void)test_addZones:(id)zones;
- (void)timerDidFire:(id)fire;
- (void)transactionObjectRemoved:(id)removed message:(id)message;
- (void)transactionObjectUpdated:(id)updated newValues:(id)values message:(id)message;
- (void)unconfigure;
- (void)unsetFabricForPairing;
- (void)updateAppData:(id)data identifierKey:(id)key lookup:(id)lookup;
- (void)updateCATIDsForUsersIfNeeded:(BOOL)needed completion:(id)completion;
- (void)updateHasOnboardedForWalletKey:(BOOL)key message:(id)message;
- (void)updateHomeConfigurationWithModel:(id)model message:(id)message;
- (void)updateHomeFirstHAPAccessoryAddedDateToNow;
- (void)updateHomeLocation;
- (void)updateLightProfilesSettings:(id)settings;
- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)enabled;
- (void)updateMediaStateWithResponses:(void *)responses requestMessageInformation:;
- (void)updateNetworkConnectivity:(BOOL)connectivity companionReachable:(BOOL)reachable;
- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)model message:(id)message;
- (void)updateNetworkRouterSettingsWithModel:(id)model message:(id)message;
- (void)updateROARStatus:(id)status message:(id)message;
- (void)updateThreadOperationalDatasetWithHomeModel:(id)model message:(id)message;
- (void)updateUserCATWithOperatePrivilege:(id)privilege administerPrivilege:(id)administerPrivilege completion:(id)completion;
- (void)userAssistantAccessControlDidUpdate:(id)update accessories:(id)accessories;
- (void)userManagementOperationDidFinish:(id)finish;
- (void)writeAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout completion:(id)completion;
- (void)writeCharacteristicValues:(id)values message:(id)message withCompletionHandler:(id)handler;
- (void)writeCharacteristicValues:(id)values source:(unint64_t)source biomeSource:(unint64_t)biomeSource identifier:(id)identifier transport:(id)transport qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
- (void)writeCharacteristicValues:(id)values source:(unint64_t)source message:(id)message identifier:(id)identifier qualityOfService:(int64_t)service withCompletionHandler:(id)handler;
@end

@implementation HMDHome

- (id)resolveReceiverForMessageTargetUUID:(id)d
{
  v4 = sub_253CCFF58();
  v5 = *(v4 - 8);
  v6 = *(v5 + 64);
  MEMORY[0x28223BE20](v4);
  v8 = (&v12 - ((v7 + 15) & 0xFFFFFFFFFFFFFFF0));
  sub_253CCFF38();
  selfCopy = self;
  v10 = sub_25320612C(v8);

  (*(v5 + 8))(v8, v4);

  return v10;
}

- (void)submitLogEventForWriteAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout error:(id)error
{
  endpointIdCopy = endpointId;
  clusterIdCopy = clusterId;
  attributeIdCopy = attributeId;
  swift_unknownObjectRetain();
  selfCopy = self;
  timeoutCopy = timeout;
  errorCopy = error;
  sub_253CD0E18();
  swift_unknownObjectRelease();
  sub_2532086C0(id, endpointIdCopy, clusterIdCopy, attributeIdCopy, v20, timeout, error);

  __swift_destroy_boxed_opaque_existential_0(v20);
}

- (void)submitLogEventForCommandResponse:(id)response nodeID:(unint64_t)d endpointID:(id)iD clusterID:(id)clusterID commandID:(id)commandID source:(unint64_t)source error:(id)error
{
  if (response)
  {
    sub_253CD08D8();
  }

  iDCopy = iD;
  clusterIDCopy = clusterID;
  commandIDCopy = commandID;
  errorCopy = error;
  selfCopy = self;
  sub_253208D18(d, iDCopy, clusterIDCopy, commandIDCopy, source, error);
}

- (id)homeBulletinContext
{
  v10[2] = *MEMORY[0x277D85DE8];
  v9[0] = @"home";
  contextID = [(HMDHome *)self contextID];
  v10[0] = contextID;
  v9[1] = *MEMORY[0x277CCF328];
  contextSPIUniqueIdentifier = [(HMDHome *)self contextSPIUniqueIdentifier];
  uUIDString = [contextSPIUniqueIdentifier UUIDString];
  v10[1] = uUIDString;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];

  v7 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSUUID)contextSPIUniqueIdentifier
{
  v3 = +[HMDProcessInfo privateClientIdentifierSalt];
  v4 = MEMORY[0x277CCAD78];
  uuid = [(HMDHome *)self uuid];
  v6 = [v4 hm_deriveUUIDFromBaseUUID:uuid identifierSalt:v3];

  return v6;
}

- (NSString)contextID
{
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];

  return uUIDString;
}

- (void)updateHasOnboardedForWalletKey:(BOOL)key message:(id)message
{
  keyCopy = key;
  v32 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([(HMDHome *)self hasOnboardedForWalletKey]!= keyCopy)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy hasOnboardedForWalletKey];
      v11 = HMFBooleanToString();
      v12 = HMFBooleanToString();
      v24 = 138544130;
      v25 = v10;
      v26 = 2112;
      v27 = v11;
      v28 = 2112;
      v29 = v12;
      v30 = 2112;
      v31 = messageCopy;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Updating has onboarded for wallet key from %@ to %@ with message: %@", &v24, 0x2Au);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [HMDHomeModel alloc];
    uuid = [(HMDHome *)selfCopy uuid];
    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid2 = [homeManager uuid];
    v17 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

    if (keyCopy)
    {
      v18 = MEMORY[0x277CBEC38];
    }

    else
    {
      v18 = MEMORY[0x277CBEC28];
    }

    [(HMDHomeModel *)v17 setHasOnboardedForWalletKey:v18];
    backingStore = [(HMDHome *)selfCopy backingStore];
    name = [messageCopy name];
    v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v22 = [backingStore transaction:name options:v21];

    [v22 add:v17 withMessage:messageCopy];
    [v22 run];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)hasPostedWalletKeyOnboardingBulletinForAnyAccessory
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_153_1468];

  return v3;
}

uint64_t __70__HMDHome_Wallet__hasPostedWalletKeyOnboardingBulletinForAnyAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 hasPostedBulletinForWalletKeyOnboarding];

  return v5;
}

- (NSArray)accessoriesWithWalletKeySupport
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_151];

  return v3;
}

id __50__HMDHome_Wallet__accessoriesWithWalletKeySupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = 0;
  if ([v4 supportsWalletKey])
  {
    v5 = v4;
  }

  return v5;
}

- (BOOL)hasAnyAccessoryWithWalletKeyAndAccessCodeSupport
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_148];

  return v3;
}

uint64_t __67__HMDHome_Wallet__hasAnyAccessoryWithWalletKeyAndAccessCodeSupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 supportsAccessCode];
  v6 = [v4 supportsWalletKey];

  return v6 & v5;
}

- (BOOL)hasAnyAccessoryWithWalletKeySupport
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_1469];

  return v3;
}

uint64_t __54__HMDHome_Wallet__hasAnyAccessoryWithWalletKeySupport__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 supportsWalletKey];

  return v5;
}

+ (id)nfcIssuerKeyIdentifierWithPairingIdentity:(id)identity
{
  publicKey = [identity publicKey];
  data = [publicKey data];
  v5 = [HMDHomeNFCReaderKey identifierForKey:data];

  return v5;
}

- (id)createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:(id)snapshot operationalKeyPair:(id)pair error:(id *)error
{
  v40 = *MEMORY[0x277D85DE8];
  snapshotCopy = snapshot;
  pairCopy = pair;
  currentDeviceControllerNodeID = [(HMDHome *)self currentDeviceControllerNodeID];
  v10 = [(HMDHome *)self accessoryAdministerPrivilegeCATID:0];
  if (v10)
  {
    v11 = [MEMORY[0x277CBEB98] setWithObject:v10];
    if (!currentDeviceControllerNodeID)
    {
      goto LABEL_6;
    }

LABEL_5:
    if (![currentDeviceControllerNodeID isEqual:&unk_2866276B8])
    {
      goto LABEL_7;
    }

    goto LABEL_6;
  }

  v11 = 0;
  if (currentDeviceControllerNodeID)
  {
    goto LABEL_5;
  }

LABEL_6:
  v12 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(MEMORY[0x277D17B90], "randomNodeID")}];

  v13 = [(HMDHome *)self privateDataSourceForNode:v12];
  currentDeviceControllerNodeID = v12;
LABEL_7:
  v14 = objc_autoreleasePoolPush();
  selfCopy = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v17 = v28 = pairCopy;
    rootCert = [snapshotCopy rootCert];
    fabricID = [snapshotCopy fabricID];
    *buf = 138544386;
    v31 = v17;
    v32 = 2112;
    v33 = currentDeviceControllerNodeID;
    v34 = 2112;
    v35 = v11;
    v36 = 2112;
    v37 = rootCert;
    v38 = 2112;
    v39 = fabricID;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Creating operational certificate for controller node ID %@ CAT %@ root cert %@, fabric ID %@", buf, 0x34u);

    pairCopy = v28;
  }

  objc_autoreleasePoolPop(v14);
  v20 = MEMORY[0x277CD5230];
  rootKeyPair = [snapshotCopy rootKeyPair];
  rootCert2 = [snapshotCopy rootCert];
  publicKey = [pairCopy publicKey];
  fabricID2 = [snapshotCopy fabricID];
  v25 = [v20 createOperationalCertificate:rootKeyPair signingCertificate:rootCert2 operationalPublicKey:publicKey fabricID:fabricID2 nodeID:currentDeviceControllerNodeID caseAuthenticatedTags:v11 error:error];

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (id)fetchOperationalFabricDataWithError:(id *)error
{
  v47 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self storedFabricDataWithError:error];
    if (*error)
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        v10 = *error;
        v43 = 138543618;
        v44 = v9;
        v45 = 2112;
        v46 = v10;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data from local storage: %@", &v43, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      v11 = 0;
      goto LABEL_38;
    }

    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      residentOperationalCert = [v5 residentOperationalCert];
      residentOperationalKeyPair = [v5 residentOperationalKeyPair];
      goto LABEL_19;
    }

    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      residentOperationalKeyPair = [(HMDHome *)self storedOperationalKeyPair];
      if (residentOperationalKeyPair)
      {
        residentOperationalCert = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v5 operationalKeyPair:residentOperationalKeyPair error:error];
        if (*error)
        {
          v18 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v21 = HMFGetLogIdentifier();
            v22 = *error;
            v43 = 138543618;
            v44 = v21;
            v45 = 2112;
            v46 = v22;
            _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data due to cert generation failure: %@", &v43, 0x16u);
          }

          objc_autoreleasePoolPop(v18);
          v11 = 0;
          goto LABEL_37;
        }

LABEL_19:
        rootCert = [v5 rootCert];

        if (rootCert)
        {
          if (residentOperationalCert)
          {
            goto LABEL_21;
          }
        }

        else
        {
          v24 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            v27 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v27;
            _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while root cert is missing from storage", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          if (residentOperationalCert)
          {
LABEL_21:
            if (residentOperationalKeyPair)
            {
LABEL_32:
              rootCert2 = [v5 rootCert];

              if (residentOperationalKeyPair && residentOperationalCert && rootCert2)
              {
                v37 = objc_alloc(MEMORY[0x277D17B58]);
                rootCert3 = [v5 rootCert];
                v39 = [v5 ipk];
                residentNodeID = [v5 residentNodeID];
                v11 = [v37 initWithRootCert:rootCert3 ipk:v39 residentNodeID:residentNodeID operationalCert:residentOperationalCert operationalKeyPair:residentOperationalKeyPair];
              }

              else
              {
                [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
                *error = v11 = 0;
              }

LABEL_37:

LABEL_38:
              goto LABEL_39;
            }

LABEL_29:
            v32 = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
            {
              v35 = HMFGetLogIdentifier();
              v43 = 138543362;
              v44 = v35;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational key pair is missing", &v43, 0xCu);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_32;
          }
        }

        v28 = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
        {
          v31 = HMFGetLogIdentifier();
          v43 = 138543362;
          v44 = v31;
          _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch operational fabric data while operational cert is missing from storage", &v43, 0xCu);
        }

        objc_autoreleasePoolPop(v28);
        if (residentOperationalKeyPair)
        {
          goto LABEL_32;
        }

        goto LABEL_29;
      }
    }

    else
    {
      residentOperationalKeyPair = 0;
    }

    residentOperationalCert = 0;
    goto LABEL_19;
  }

  v12 = objc_autoreleasePoolPush();
  selfCopy6 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    v15 = HMFGetLogIdentifier();
    v43 = 138543362;
    v44 = v15;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Fetching operational fabric data failed for shared user while caching is not supported", &v43, 0xCu);
  }

  objc_autoreleasePoolPop(v12);
  [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
  *error = v11 = 0;
LABEL_39:
  v41 = *MEMORY[0x277D85DE8];

  return v11;
}

void __102__HMDHome_CHIP__fetchOrCreateFabricDataForPairingWithOperationalKeyPair_fetchFromResident_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v65 = *MEMORY[0x277D85DE8];
  v11 = a2;
  v55 = a3;
  v12 = a4;
  v13 = a5;
  v14 = a6;
  if (!v14)
  {
    v19 = *(a1 + 32);
    v56 = 0;
    v20 = [v19 storedFabricDataWithError:&v56];
    v54 = v56;
    if (v54)
    {
      v21 = objc_autoreleasePoolPush();
      v22 = *(a1 + 32);
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v25 = v24 = v11;
        *buf = 138543618;
        v58 = v25;
        v59 = 2112;
        v60 = v54;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@No stored fabric data for pairing: %@", buf, 0x16u);

        v11 = v24;
      }

      objc_autoreleasePoolPop(v21);
    }

    v53 = v11;
    v26 = [objc_alloc(MEMORY[0x277D17B58]) initWithRootCert:v11 ipk:v13 residentNodeID:v12 operationalCert:v55 operationalKeyPair:*(a1 + 40)];
    v27 = [v26 fabricID];

    if (!v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        HMFGetLogIdentifier();
        v36 = v51 = v33;
        *buf = 138543362;
        v58 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Fabric data for pairing fetched from a resident is corrupt", buf, 0xCu);

        v33 = v51;
      }

      objc_autoreleasePoolPop(v33);
      v37 = *(a1 + 48);
      v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
      (*(v37 + 16))(v37, 0, 0, v38);

      goto LABEL_22;
    }

    v28 = [v20 rootKeyPair];
    if (v28)
    {
      v29 = v28;
      v30 = [v20 rootCert];
      if (v30)
      {
        v31 = v30;
        v32 = [v20 fabricID];

        if (v32)
        {
LABEL_21:
          (*(*(a1 + 48) + 16))();
LABEL_22:
          v11 = v53;

          goto LABEL_23;
        }
      }

      else
      {
      }
    }

    v39 = objc_autoreleasePoolPush();
    v40 = *(a1 + 32);
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v42 = v50 = v26;
      v48 = [v20 rootKeyPair];
      HMFBooleanToString();
      v43 = v49 = v40;
      v47 = [v20 rootCert];
      v44 = HMFBooleanToString();
      [v20 fabricID];
      v45 = v52 = v39;
      *buf = 138544130;
      v58 = v42;
      v59 = 2112;
      v60 = v43;
      v61 = 2112;
      v62 = v44;
      v63 = 2112;
      v64 = v45;
      _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

      v39 = v52;
      v40 = v49;

      v26 = v50;
    }

    objc_autoreleasePoolPop(v39);
    v20 = 0;
    goto LABEL_21;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = *(a1 + 32);
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    *buf = 138543618;
    v58 = v18;
    v59 = 2112;
    v60 = v14;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data for pairing from resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  (*(*(a1 + 48) + 16))();
LABEL_23:

  v46 = *MEMORY[0x277D85DE8];
}

- (void)fetchFabricDataForPairingWithCompletion:(id)completion
{
  v81 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (![(HMDHome *)self doesHomeContainResident])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      fabric = [(HMDHome *)self fabric];

      if (fabric)
      {
        operationalKeyPairForPairing = [(HMDHome *)self operationalKeyPairForPairing];
        v65[0] = MEMORY[0x277D85DD0];
        v65[1] = 3221225472;
        v65[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_329;
        v65[3] = &unk_279721B00;
        v65[4] = self;
        v66 = completionCopy;
        [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:operationalKeyPairForPairing fetchFromResident:0 completion:v65];

        v13 = v66;
        goto LABEL_10;
      }
    }

    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v74 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing without a resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    initUnassociated = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(completionCopy + 2))(completionCopy, 0, 0, initUnassociated);
    goto LABEL_18;
  }

  primaryResident = [(HMDHome *)self primaryResident];
  if (primaryResident)
  {
    v6 = primaryResident;
    primaryResident2 = [(HMDHome *)self primaryResident];
    capabilities = [primaryResident2 capabilities];

    if (capabilities)
    {
      if ([(HMDHome *)self isOwnerUser])
      {
        primaryResident3 = [(HMDHome *)self primaryResident];
        capabilities2 = [primaryResident3 capabilities];
        supportsMatterOwnerCertFetch = [capabilities2 supportsMatterOwnerCertFetch];

        if (supportsMatterOwnerCertFetch)
        {
          operationalKeyPairForPairing2 = [(HMDHome *)self operationalKeyPairForPairing];
          v69[0] = MEMORY[0x277D85DD0];
          v69[1] = 3221225472;
          v69[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_2;
          v69[3] = &unk_279721C58;
          v70 = completionCopy;
          [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:operationalKeyPairForPairing2 fetchFromResident:1 completion:v69];

          v13 = v70;
LABEL_10:

          goto LABEL_19;
        }

        v68 = 0;
        v29 = [(HMDHome *)self storedFabricDataWithError:&v68];
        v30 = v68;
        if (v30)
        {
          v31 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v74 = v34;
            v75 = 2112;
            v76 = v30;
            _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Could to retrieve stored fabric data for pairing: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          (*(completionCopy + 2))(completionCopy, 0, 0, v30);
LABEL_35:

          goto LABEL_19;
        }

        residentOperationalKeyPair = [v29 residentOperationalKeyPair];
        if (!residentOperationalKeyPair)
        {
          goto LABEL_32;
        }

        v36 = residentOperationalKeyPair;
        rootKeyPair = [v29 rootKeyPair];
        if (rootKeyPair)
        {
          v38 = rootKeyPair;
          rootCert = [v29 rootCert];
          if (rootCert)
          {
            v40 = rootCert;
            fabricID = [v29 fabricID];

            if (fabricID)
            {
              residentOperationalKeyPair2 = [v29 residentOperationalKeyPair];
              v67 = 0;
              v43 = [(HMDHome *)self createNewOperationalCertForLocalDeviceWithFabricDataSnapshot:v29 operationalKeyPair:residentOperationalKeyPair2 error:&v67];
              v44 = v67;
              if (v43)
              {
                v45 = objc_alloc(MEMORY[0x277D17B58]);
                rootCert2 = [v29 rootCert];
                v47 = [v29 ipk];
                residentNodeID = [v29 residentNodeID];
                v49 = [v45 initWithRootCert:rootCert2 ipk:v47 residentNodeID:residentNodeID operationalCert:v43 operationalKeyPair:residentOperationalKeyPair2];

                (*(completionCopy + 2))(completionCopy, v49, 0, 0);
              }

              else
              {
                v58 = objc_autoreleasePoolPush();
                selfCopy3 = self;
                v60 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v60, OS_LOG_TYPE_ERROR))
                {
                  v61 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v74 = v61;
                  v75 = 2112;
                  v76 = v44;
                  _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_ERROR, "%{public}@Could not generate operational certificate for pairing: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v58);
                (*(completionCopy + 2))(completionCopy, 0, 0, v44);
              }

              goto LABEL_19;
            }

LABEL_32:
            v50 = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v52 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
            {
              v53 = HMFGetLogIdentifier();
              rootKeyPair2 = [v29 rootKeyPair];
              v54 = HMFBooleanToString();
              rootCert3 = [v29 rootCert];
              HMFBooleanToString();
              v55 = v64 = v50;
              fabricID2 = [v29 fabricID];
              *buf = 138544130;
              v74 = v53;
              v75 = 2112;
              v76 = v54;
              v77 = 2112;
              v78 = v55;
              v79 = 2112;
              v80 = fabricID2;
              _os_log_impl(&dword_2531F8000, v52, OS_LOG_TYPE_ERROR, "%{public}@Stored fabric data insufficient for pairing: rootKeyPair %@, rootCert %@, fabricID %@", buf, 0x2Au);

              v50 = v64;
            }

            objc_autoreleasePoolPop(v50);
            v57 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
            (*(completionCopy + 2))(completionCopy, 0, 0, v57);

            goto LABEL_35;
          }
        }

        goto LABEL_32;
      }

      initUnassociated = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
      v71[0] = MEMORY[0x277D85DD0];
      v71[1] = 3221225472;
      v71[2] = __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke;
      v71[3] = &unk_279721C58;
      v72 = completionCopy;
      [(HMDHome *)self fetchOrCreateFabricDataForPairingWithOperationalKeyPair:initUnassociated fetchFromResident:1 completion:v71];

LABEL_18:
      goto LABEL_19;
    }
  }

  v21 = objc_autoreleasePoolPush();
  selfCopy5 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v74 = v24;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot fetch fabric data for pairing when a primary resident is unreachable", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  v25 = MEMORY[0x277CCA9B8];
  v26 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
  v27 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v26];
  (*(completionCopy + 2))(completionCopy, 0, 0, v27);

LABEL_19:
  v28 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_CHIP__fetchFabricDataForPairingWithCompletion___block_invoke_329(uint64_t a1, void *a2, void *a3, void *a4)
{
  v24 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (v8 | v9)
  {
    v10 = v9;
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Cannot use fetched operational fabric data without stored fabric data for owner local pairing", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];

    v7 = 0;
  }

  v15 = MEMORY[0x277CD5230];
  v16 = [v8 residentOperationalKeyPair];
  v17 = [v7 operationalCert];
  LODWORD(v15) = [v15 keypair:v16 matchesCertificate:v17];

  if (v15)
  {
    v18 = *(a1 + 32);
    v19 = [v7 operationalNodeID];
    v20 = [v18 privateDataSourceForNode:v19];
  }

  (*(*(a1 + 40) + 16))();

  v21 = *MEMORY[0x277D85DE8];
}

- (void)clearAccessoryServerBrowserOperationalFabricData
{
  homeManager = [(HMDHome *)self homeManager];
  accessoryBrowser = [homeManager accessoryBrowser];
  chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
  targetFabricUUID = [(HMDHome *)self targetFabricUUID];
  [chipAccessoryServerBrowser clearOperationalFabricDataForTargetFabricUUID:targetFabricUUID];
}

- (BOOL)setUpAccessoryServerBrowserWithOperationalFabricData:(id)data ownerDataSnapshot:(id)snapshot error:(id *)error
{
  v54 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  snapshotCopy = snapshot;
  v9 = objc_alloc(MEMORY[0x277D17B50]);
  if (snapshotCopy)
  {
    rootKeyPair = [snapshotCopy rootKeyPair];
    rootCert = [dataCopy rootCert];
    fabricID = [dataCopy fabricID];
    v13 = [v9 initWithRootKeyPair:rootKeyPair rootCertificate:rootCert fabricID:fabricID];
  }

  else
  {
    rootKeyPair = [dataCopy fabricID];
    v13 = [v9 initWithRemoteDelegate:self fabricID:rootKeyPair];
  }

  targetFabricUUID = [(HMDHome *)self targetFabricUUID];
  homeManager = [(HMDHome *)self homeManager];
  chipDataSource = [homeManager chipDataSource];
  allTargetFabricUUIDs = [chipDataSource allTargetFabricUUIDs];

  operationalNodeID = [dataCopy operationalNodeID];
  v19 = [(HMDHome *)self privateDataSourceForNode:operationalNodeID];

  isFeatureMatterLocalFabricConfigEnabled = [(HMDHome *)self isFeatureMatterLocalFabricConfigEnabled];
  if (v19)
  {
    LODWORD(chipAccessoryServerBrowser) = 0;
  }

  else
  {
    LODWORD(chipAccessoryServerBrowser) = isFeatureMatterLocalFabricConfigEnabled;
  }

  if (chipAccessoryServerBrowser == 1)
  {
    v40 = allTargetFabricUUIDs;
    v22 = objc_autoreleasePoolPush();
    selfCopy = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v25 = chipAccessoryServerBrowser = v13;
      *buf = 138543362;
      v47 = v25;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot set up operational fabric data without private data source", buf, 0xCu);

      v13 = chipAccessoryServerBrowser;
      LOBYTE(chipAccessoryServerBrowser) = 1;
    }

    objc_autoreleasePoolPop(v22);
    *error = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
    allTargetFabricUUIDs = v40;
  }

  else
  {
    rootKeyPair2 = [snapshotCopy rootKeyPair];

    if (rootKeyPair2)
    {
      rootKeyPair3 = [snapshotCopy rootKeyPair];
      v45 = SecKeyCopyExternalRepresentation([rootKeyPair3 publicKey], 0);
    }

    else
    {
      v45 = 0;
    }

    v42 = v13;
    v43 = targetFabricUUID;
    if ([(HMDHome *)self isCurrentDevicePrimaryResident])
    {
      matterAccessories = [(HMDHome *)self matterAccessories];
      v29 = [matterAccessories na_map:&__block_literal_global_325];
      v39 = [v29 na_filter:&__block_literal_global_327];
    }

    else
    {
      v39 = 0;
    }

    v41 = chipAccessoryServerBrowser;
    v30 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      v33 = HMFGetLogIdentifier();
      v34 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[__CFData hash](v45, "hash")}];
      *buf = 138544130;
      v47 = v33;
      v48 = 2112;
      v49 = dataCopy;
      v50 = 2112;
      v51 = v43;
      v52 = 2112;
      v53 = v34;
      _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Setting operational fabric data %@ for target fabric UUID %@, signing key: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v30);
    accessoryBrowser = [homeManager accessoryBrowser];
    chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
    uuid = [(HMDHome *)selfCopy2 uuid];
    v13 = v42;
    [chipAccessoryServerBrowser setOperationalFabricData:dataCopy operationalCertIssuer:v42 storageDataSource:v19 allTargetFabricUUIDs:allTargetFabricUUIDs entityIdentifier:uuid accessoryServerNodeIDs:v39 forTargetFabricUUID:v43];

    targetFabricUUID = v43;
    LOBYTE(chipAccessoryServerBrowser) = v41;
  }

  v37 = *MEMORY[0x277D85DE8];
  return chipAccessoryServerBrowser ^ 1;
}

- (id)storedSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  fabricData = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 fabricData];

  return fabricData;
}

- (void)removeSharedHomeFabricData
{
  v3 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v3 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  [(HMDCHIPSharedHomeKeychainFabricDataStore *)v6 removeFabricData];
}

- (BOOL)storeSharedHomeFabricData:(id)data
{
  dataCopy = data;
  v5 = [HMDCHIPSharedHomeKeychainFabricDataStore alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v8 = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v5 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  LOBYTE(iCloudIdentifier) = [(HMDCHIPSharedHomeKeychainFabricDataStore *)v8 storeFabricData:dataCopy];
  return iCloudIdentifier;
}

- (BOOL)auditStorageWithFabricData:(id)data
{
  v40 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  fabricID = [dataCopy fabricID];
  if (fabricID)
  {
    v6 = fabricID;
    fabricID2 = [dataCopy fabricID];
    v8 = [fabricID2 isEqual:&unk_2866276B8];

    if (!v8)
    {
      fabricDataInLegacyStorage = [(HMDHome *)self fabricDataInLegacyStorage];
      rootCert = [fabricDataInLegacyStorage rootCert];
      if (!rootCert)
      {
        goto LABEL_15;
      }

      v17 = rootCert;
      residentOperationalCert = [fabricDataInLegacyStorage residentOperationalCert];
      if (residentOperationalCert)
      {
        v19 = residentOperationalCert;
        v20 = MEMORY[0x277CD5230];
        rootCert2 = [fabricDataInLegacyStorage rootCert];
        rootCert3 = [dataCopy rootCert];
        if ([v20 isCertificate:rootCert2 equalTo:rootCert3])
        {
          v23 = MEMORY[0x277CD5230];
          residentOperationalCert2 = [fabricDataInLegacyStorage residentOperationalCert];
          residentOperationalCert3 = [dataCopy residentOperationalCert];
          if ([v23 isCertificate:residentOperationalCert2 equalTo:residentOperationalCert3])
          {
            [fabricDataInLegacyStorage ipk];
            v26 = v34 = residentOperationalCert2;
            v27 = [dataCopy ipk];
            v35 = [v26 isEqual:v27];

            if (v35)
            {
              v14 = 1;
LABEL_18:

              goto LABEL_19;
            }

LABEL_15:
            v28 = objc_autoreleasePoolPush();
            selfCopy = self;
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v37 = v31;
              _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Updating fabric data in legacy storage", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v14 = [(HMDHome *)selfCopy storeIntoLegacyStorageWithFabricData:dataCopy];
            goto LABEL_18;
          }
        }
      }

      goto LABEL_15;
    }
  }

  v9 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
  {
    v12 = HMFGetLogIdentifier();
    fabricID3 = [dataCopy fabricID];
    *buf = 138543618;
    v37 = v12;
    v38 = 2112;
    v39 = fabricID3;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot audit storage with invalid fabricID: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v14 = 0;
LABEL_19:

  v32 = *MEMORY[0x277D85DE8];
  return v14;
}

- (BOOL)storeIntoLegacyStorageWithFabricData:(id)data
{
  dataCopy = data;
  v5 = [HMDCHIPHomeDataSource alloc];
  fabricID = [dataCopy fabricID];
  v7 = [(HMDCHIPHomeDataSource *)v5 initWithFabricID:fabricID home:self];

  v8 = objc_alloc_init(MEMORY[0x277D17B00]);
  v9 = objc_alloc_init(MEMORY[0x277D17B40]);
  v10 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:dataCopy chipStorageDelegate:v7 keychainDelegate:v8 v2FabricDataStoreDelegate:v9];

  LOBYTE(dataCopy) = [v10 commit];
  return dataCopy;
}

- (id)fabricDataInLegacyStorage
{
  v3 = [HMDCHIPHomeDataSource alloc];
  matterFabricID = [(HMDHome *)self matterFabricID];
  v5 = [(HMDCHIPHomeDataSource *)v3 initWithFabricID:matterFabricID home:self];

  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = objc_alloc_init(MEMORY[0x277D17B30]);
  v8 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6 v2FabricDataStoreDelegate:v7];
  v11 = 0;
  v9 = [v8 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:0 error:&v11];

  return v9;
}

- (BOOL)storeNewFabricData:(id)data
{
  v30 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  fabricID = [dataCopy fabricID];
  if (fabricID && (v6 = fabricID, [dataCopy fabricID], v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isEqual:", &unk_2866276B8), v7, v6, !v8))
  {
    v15 = [HMDCHIPHomeDataSource alloc];
    fabricID2 = [dataCopy fabricID];
    v17 = [(HMDCHIPHomeDataSource *)v15 initWithFabricID:fabricID2 home:self];

    v18 = objc_alloc_init(MEMORY[0x277D17B00]);
    v19 = [HMDCHIPHomeKeychainFabricData alloc];
    uuid = [(HMDHome *)self uuid];
    iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
    v22 = [(HMDCHIPHomeKeychainFabricData *)v19 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

    v23 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:dataCopy chipStorageDelegate:v17 keychainDelegate:v18 v2FabricDataStoreDelegate:v22];
    commit = [v23 commit];
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      fabricID3 = [dataCopy fabricID];
      v26 = 138543618;
      v27 = v12;
      v28 = 2112;
      v29 = fabricID3;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot store new fabric data with invalid fabricID: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    commit = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return commit;
}

- (id)newFabricData
{
  v19 = *MEMORY[0x277D85DE8];
  matterFabricID = [(HMDHome *)self matterFabricID];
  if (matterFabricID)
  {
    v4 = matterFabricID;
  }

  else
  {
    v4 = &unk_2866276B8;
  }

  v5 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v4 home:self];
  v6 = objc_alloc_init(MEMORY[0x277D17B00]);
  v7 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v5 keychainDelegate:v6];
  newFabricData = [v7 newFabricData];
  if (!newFabricData)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to create new fabric data";
LABEL_11:
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, v14, &v17, 0xCu);
    }

LABEL_12:

    objc_autoreleasePoolPop(v10);
    v9 = 0;
    goto LABEL_13;
  }

  if (![(HMDHome *)self storeNewFabricData:newFabricData])
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v13;
      v14 = "%{public}@Failed to store newly created fabric data";
      goto LABEL_11;
    }

    goto LABEL_12;
  }

  v9 = newFabricData;
LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)storedFabricDataWithDataPresentInV2FabricDataStore:(BOOL *)store error:(id *)error
{
  matterFabricID = [(HMDHome *)self matterFabricID];
  if (matterFabricID)
  {
    v8 = matterFabricID;
  }

  else
  {
    v8 = &unk_2866276B8;
  }

  v9 = [[HMDCHIPHomeDataSource alloc] initWithFabricID:v8 home:self];
  v10 = objc_alloc_init(MEMORY[0x277D17B00]);
  v11 = [HMDCHIPHomeKeychainFabricData alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v14 = [(HMDCHIPHomeKeychainFabricData *)v11 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  v15 = [objc_alloc(MEMORY[0x277D17B28]) initWithCHIPStorageDelegate:v9 keychainDelegate:v10 v2FabricDataStoreDelegate:v14];
  v16 = [v15 locallyStoredFabricDataWithDataPresentInV2FabricDataStore:store error:error];

  return v16;
}

- (id)iCloudIdentifier
{
  homeManager = [(HMDHome *)self homeManager];
  appleAccountManager = [homeManager appleAccountManager];

  if (![appleAccountManager isLoggedInToPrimaryAccount] || (objc_msgSend(appleAccountManager, "accountContext"), v4 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v4, "identifier"), v5 = objc_claimAutoreleasedReturnValue(), v4, !v5))
  {
    v5 = @"NOT-LOGGED-IN";
    v6 = @"NOT-LOGGED-IN";
  }

  return v5;
}

- (id)storedOperationalKeyPair
{
  v21 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser])
  {
    v16 = 0;
    v3 = [(HMDHome *)self storedFabricDataWithError:&v16];
    v4 = v16;
    if (!v3)
    {
      v5 = objc_autoreleasePoolPush();
      selfCopy = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543618;
        v18 = v8;
        v19 = 2112;
        v20 = v4;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Failed to fetch sstored operational key pair, which may happen when owner never created the key: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v5);
    }

    residentOperationalKeyPair = [v3 residentOperationalKeyPair];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Unexpected call to storedOperationalKeyPair for shared user", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    residentOperationalKeyPair = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return residentOperationalKeyPair;
}

- (id)operationalKeyPairForPairing
{
  storedOperationalKeyPair = [(HMDHome *)self storedOperationalKeyPair];
  if (!storedOperationalKeyPair)
  {
    storedOperationalKeyPair = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
  }

  return storedOperationalKeyPair;
}

- (BOOL)isPrimaryResidentNodeReachable
{
  primaryResident = [(HMDHome *)self primaryResident];
  isReachable = [primaryResident isReachable];

  return isReachable;
}

- (BOOL)areAllThreadResidentNodesUnreachable
{
  enabledResidents = [(HMDHome *)self enabledResidents];
  v3 = [enabledResidents na_allObjectsPassTest:&__block_literal_global_317];

  return v3;
}

uint64_t __53__HMDHome_CHIP__areAllThreadResidentNodesUnreachable__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 capabilities];
  if ([v3 supportsThreadBorderRouter])
  {
    v4 = [v2 isReachable] ^ 1;
  }

  else
  {
    v4 = 1;
  }

  return v4;
}

- (void)updateUserCATWithOperatePrivilege:(id)privilege administerPrivilege:(id)administerPrivilege completion:(id)completion
{
  privilegeCopy = privilege;
  administerPrivilegeCopy = administerPrivilege;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke;
  v15[3] = &unk_279734578;
  v15[4] = self;
  v16 = privilegeCopy;
  v17 = administerPrivilegeCopy;
  v18 = completionCopy;
  v12 = completionCopy;
  v13 = administerPrivilegeCopy;
  v14 = privilegeCopy;
  dispatch_async(workQueue, v15);
}

void __82__HMDHome_CHIP__updateUserCATWithOperatePrivilege_administerPrivilege_completion___block_invoke(uint64_t a1)
{
  v1 = a1;
  v48 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) backingStore];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v33 = [v2 transaction:@"UpdatingUserCATIDs" options:v3];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v4 = [*(v1 + 32) users];
  v5 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v5)
  {

    goto LABEL_23;
  }

  v7 = v5;
  v8 = 0;
  v9 = *v36;
  v34 = (v1 + 48);
  v32 = v1;
  v10 = (v1 + 40);
  *&v6 = 138544130;
  v29 = v6;
  v31 = v4;
  do
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(v4);
      }

      v12 = *(*(&v35 + 1) + 8 * i);
      v13 = [v12 privilege];
      if (v13 != 4)
      {
        if (v13 == 3)
        {
          if (!*v34)
          {
            continue;
          }

          v17 = [v12 matterCASEAuthenticatedTagID];
          v18 = [v17 isEqual:*v34];

          v16 = v34;
          if (v18)
          {
            continue;
          }

          goto LABEL_14;
        }

        if (v13)
        {
          continue;
        }
      }

      if (!*v10)
      {
        continue;
      }

      v14 = [v12 matterCASEAuthenticatedTagID];
      v15 = [v14 isEqual:*v10];

      v16 = v10;
      if (v15)
      {
        continue;
      }

LABEL_14:
      v19 = *v16;
      if (v19)
      {
        v20 = v19;
        v21 = [v12 newModelWithChangeType:2];
        [v21 setMatterCASEAuthenticatedTagID:v20];
        [v33 add:v21];
        v22 = objc_autoreleasePoolPush();
        v23 = *(v32 + 32);
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v25 = v30 = v22;
          v26 = [v20 integerValue];
          *buf = v29;
          v40 = v25;
          v41 = 2112;
          v42 = v12;
          v43 = 2048;
          v44 = v26;
          v45 = 2112;
          v46 = v20;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Updated CATID transaction for user %@ to 0x%lX (%@)", buf, 0x2Au);

          v22 = v30;
        }

        objc_autoreleasePoolPop(v22);
        v8 = 1;
        v4 = v31;
      }
    }

    v7 = [v4 countByEnumeratingWithState:&v35 objects:v47 count:16];
  }

  while (v7);

  v1 = v32;
  if (v8)
  {
    [v33 run:*(v32 + 56)];
    goto LABEL_25;
  }

LABEL_23:
  v27 = *(v1 + 56);
  if (v27)
  {
    (*(v27 + 16))(v27, 0);
  }

LABEL_25:

  v28 = *MEMORY[0x277D85DE8];
}

- (void)incrementOperatePrivilegeCATVersion:(id)version
{
  v20 = *MEMORY[0x277D85DE8];
  versionCopy = version;
  v5 = [(HMDHome *)self accessoryOperatePrivilegeCATID:1];
  v13 = 0;
  [MEMORY[0x277D17B90] parseCaseAuthenticatedTag:v5 identifier:&v13 + 2 version:&v13];
  v6 = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:HIWORD(v13) version:(v13 + 1)];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    integerValue = [v6 integerValue];
    *buf = 138543874;
    v15 = v10;
    v16 = 2048;
    v17 = integerValue;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Bumping tag version for operate as 0x%lX (%@)", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  versionCopy[2](versionCopy, v6);

  v12 = *MEMORY[0x277D85DE8];
}

- (id)accessoryAdministerPrivilegeCATID:(BOOL)d
{
  dCopy = d;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  users = [(HMDHome *)self users];
  v6 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    currentAdministerCATID = [(HMDHome *)self currentAdministerCATID];

    if (currentAdministerCATID)
    {
      currentAdministerCATID = [(HMDHome *)self currentAdministerCATID];
    }

    if (!currentAdministerCATID && dCopy)
    {
      currentAdministerCATID = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      selfCopy = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        integerValue = [currentAdministerCATID integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = integerValue;
        v43 = 2112;
        v44 = currentAdministerCATID;
        _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory administer 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = dCopy;
  currentAdministerCATID = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(users);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if ([v11 privilege] == 3)
      {
        if (currentAdministerCATID || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          matterCASEAuthenticatedTagID = [v11 matterCASEAuthenticatedTagID];
          v13 = [matterCASEAuthenticatedTagID isEqual:currentAdministerCATID];

          if ((v13 & 1) == 0)
          {
            matterCASEAuthenticatedTagID2 = [v11 matterCASEAuthenticatedTagID];
            if (matterCASEAuthenticatedTagID2)
            {
              v15 = matterCASEAuthenticatedTagID2;
              matterCASEAuthenticatedTagID3 = [v11 matterCASEAuthenticatedTagID];
              v17 = [matterCASEAuthenticatedTagID3 isEqual:currentAdministerCATID];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  integerValue2 = [currentAdministerCATID integerValue];
                  matterCASEAuthenticatedTagID4 = [v11 matterCASEAuthenticatedTagID];
                  integerValue3 = [matterCASEAuthenticatedTagID4 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = integerValue2;
                  v43 = 2048;
                  v44 = integerValue3;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                dCopy = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          currentAdministerCATID = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  dCopy = v34;
  if (!currentAdministerCATID)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentAdministerCATID:currentAdministerCATID];
  v32 = *MEMORY[0x277D85DE8];

  return currentAdministerCATID;
}

- (id)accessoryOperatePrivilegeCATID:(BOOL)d
{
  dCopy = d;
  v48 = *MEMORY[0x277D85DE8];
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  users = [(HMDHome *)self users];
  v6 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (!v6)
  {
LABEL_21:

LABEL_22:
    currentOperateCATID = [(HMDHome *)self currentOperateCATID];

    if (currentOperateCATID)
    {
      currentOperateCATID = [(HMDHome *)self currentOperateCATID];
    }

    if (!currentOperateCATID && dCopy)
    {
      currentOperateCATID = [MEMORY[0x277D17B90] caseAuthenticatedTagWithIdentifier:objc_msgSend(MEMORY[0x277D17B90] version:{"randomCASEAuthenticatedTagIdentifier"), 1}];
      v27 = objc_autoreleasePoolPush();
      selfCopy = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        integerValue = [currentOperateCATID integerValue];
        *buf = 138543874;
        v40 = v30;
        v41 = 2048;
        v42 = integerValue;
        v43 = 2112;
        v44 = currentOperateCATID;
        _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Generated new CAT for accessory operate 0x%lX (%@)", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v27);
    }

    goto LABEL_29;
  }

  v7 = v6;
  v34 = dCopy;
  currentOperateCATID = 0;
  v9 = *v36;
  while (2)
  {
    for (i = 0; i != v7; ++i)
    {
      if (*v36 != v9)
      {
        objc_enumerationMutation(users);
      }

      v11 = *(*(&v35 + 1) + 8 * i);
      if (([v11 privilege] | 4) == 4)
      {
        if (currentOperateCATID || ([v11 matterCASEAuthenticatedTagID], v18 = objc_claimAutoreleasedReturnValue(), v18, !v18))
        {
          matterCASEAuthenticatedTagID = [v11 matterCASEAuthenticatedTagID];
          v13 = [matterCASEAuthenticatedTagID isEqual:currentOperateCATID];

          if ((v13 & 1) == 0)
          {
            matterCASEAuthenticatedTagID2 = [v11 matterCASEAuthenticatedTagID];
            if (matterCASEAuthenticatedTagID2)
            {
              v15 = matterCASEAuthenticatedTagID2;
              matterCASEAuthenticatedTagID3 = [v11 matterCASEAuthenticatedTagID];
              v17 = [matterCASEAuthenticatedTagID3 isEqual:currentOperateCATID];

              if ((v17 & 1) == 0)
              {
                v19 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v21 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
                {
                  v23 = HMFGetLogIdentifier();
                  integerValue2 = [currentOperateCATID integerValue];
                  matterCASEAuthenticatedTagID4 = [v11 matterCASEAuthenticatedTagID];
                  integerValue3 = [matterCASEAuthenticatedTagID4 integerValue];
                  *buf = 138544130;
                  v40 = v23;
                  v41 = 2048;
                  v42 = integerValue2;
                  v43 = 2048;
                  v44 = integerValue3;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@CATID mismatch between users - current 0x%lX userCAT 0x%lX user %@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v19);
                dCopy = v34;
                goto LABEL_21;
              }
            }
          }
        }

        else
        {
          currentOperateCATID = [v11 matterCASEAuthenticatedTagID];
        }
      }
    }

    v7 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
    if (v7)
    {
      continue;
    }

    break;
  }

  dCopy = v34;
  if (!currentOperateCATID)
  {
    goto LABEL_22;
  }

LABEL_29:
  [(HMDHome *)self setCurrentOperateCATID:currentOperateCATID];
  v32 = *MEMORY[0x277D85DE8];

  return currentOperateCATID;
}

- (BOOL)hasSharedUser
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  users = [(HMDHome *)self users];
  v3 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(users);
        }

        v7 = *(*(&v11 + 1) + 8 * i);
        if ([v7 privilege] == 4 || !objc_msgSend(v7, "privilege"))
        {
          v8 = 1;
          goto LABEL_13;
        }
      }

      v4 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
      v8 = 0;
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v8 = 0;
  }

LABEL_13:

  v9 = *MEMORY[0x277D85DE8];
  return v8;
}

- (void)updateCATIDsForUsersIfNeeded:(BOOL)needed completion:(id)completion
{
  if (completion)
  {
    (*(completion + 2))(completion, 0);
  }
}

- (BOOL)_doesUsersHaveCATID
{
  v18 = *MEMORY[0x277D85DE8];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  users = [(HMDHome *)self users];
  v3 = [users countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v14;
LABEL_3:
    v6 = 0;
    while (1)
    {
      if (*v14 != v5)
      {
        objc_enumerationMutation(users);
      }

      v7 = *(*(&v13 + 1) + 8 * v6);
      matterCASEAuthenticatedTagID = [v7 matterCASEAuthenticatedTagID];
      if (!matterCASEAuthenticatedTagID)
      {
        break;
      }

      matterCASEAuthenticatedTagID2 = [v7 matterCASEAuthenticatedTagID];
      intValue = [matterCASEAuthenticatedTagID2 intValue];

      if (!intValue)
      {
        LOBYTE(matterCASEAuthenticatedTagID) = 0;
        break;
      }

      if (v4 == ++v6)
      {
        v4 = [users countByEnumeratingWithState:&v13 objects:v17 count:16];
        LOBYTE(matterCASEAuthenticatedTagID) = 1;
        if (v4)
        {
          goto LABEL_3;
        }

        break;
      }
    }
  }

  else
  {
    LOBYTE(matterCASEAuthenticatedTagID) = 1;
  }

  v11 = *MEMORY[0x277D85DE8];
  return matterCASEAuthenticatedTagID;
}

- (void)_clearCHIPStorageWithCompletion:(id)completion
{
  completionCopy = completion;
  chipStorage = [(HMDHome *)self chipStorage];
  keyValueStore = [chipStorage keyValueStore];
  v7 = [keyValueStore count];

  if (v7)
  {
    v8 = [HMDCHIPHomeDataSource alloc];
    matterFabricID = [(HMDHome *)self matterFabricID];
    v10 = [(HMDCHIPHomeDataSource *)v8 initWithFabricID:matterFabricID home:self];

    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke;
    v11[3] = &unk_279733F30;
    v11[4] = self;
    v12 = completionCopy;
    [(HMDCHIPHomeDataSource *)v10 updateKeyValueStore:MEMORY[0x277CBEC10] completion:v11];
  }

  else
  {
    (*(completionCopy + 2))(completionCopy, 0);
  }
}

void __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP___clearCHIPStorageWithCompletion___block_invoke_2;
  v7[3] = &unk_279735738;
  v5 = *(a1 + 40);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

- (void)_handleResetMatterStorageRequest:(id)request
{
  v81 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [requestCopy stringForKey:*MEMORY[0x277CD0538]];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v9;
    v79 = 2112;
    v80 = v5;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Handling request to reset Matter storage with corruption option: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0530]])
  {
    v10 = [HMDCHIPHomeDataSource alloc];
    matterFabricID = [(HMDHome *)selfCopy matterFabricID];
    initUnassociated = [(HMDCHIPHomeDataSource *)v10 initWithFabricID:matterFabricID home:selfCopy];

    v13 = objc_alloc_init(MEMORY[0x277D17AF8]);
    v14 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:initUnassociated keychainDelegate:v13];
    newFabricData = [v14 newFabricData];
    if (newFabricData)
    {
      v16 = objc_alloc_init(MEMORY[0x277D17B40]);
      v17 = [objc_alloc(MEMORY[0x277D17B38]) initWithFabricData:newFabricData chipStorageDelegate:initUnassociated keychainDelegate:v13 v2FabricDataStoreDelegate:v16];
      v72 = v5;
      if ([v17 commit])
      {
        if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
        {
          fabric = [(HMDHome *)selfCopy fabric];
          [fabric invalidateCachedData];
        }

        v19 = objc_autoreleasePoolPush();
        v20 = selfCopy;
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v22 = v69 = requestCopy;
          *buf = 138543362;
          v78 = v22;
          _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Stored bad fabric data into CHIP storage", buf, 0xCu);

          requestCopy = v69;
        }

        objc_autoreleasePoolPop(v19);
        v76 = 0;
        [(HMDHome *)v20 setUpOperationalFabricDataWithError:&v76];
        v23 = v76;
        [requestCopy respondWithSuccess];
      }

      else
      {
        v47 = objc_autoreleasePoolPush();
        v48 = selfCopy;
        v49 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v50 = v71 = requestCopy;
          *buf = 138543362;
          v78 = v50;
          _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_ERROR, "%{public}@Failed to store bad fabric data", buf, 0xCu);

          requestCopy = v71;
        }

        objc_autoreleasePoolPop(v47);
        v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [requestCopy respondWithError:v23];
      }

      v5 = v72;
    }

    else
    {
      v43 = objc_autoreleasePoolPush();
      v44 = selfCopy;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
      {
        v46 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v46;
        _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate bad fabric data", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v43);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [requestCopy respondWithError:v16];
    }
  }

  else
  {
    if ([(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0528]])
    {
      initUnassociated = [requestCopy numberForKey:*MEMORY[0x277CD0540]];
      if (initUnassociated)
      {
        v73 = v5;
        v13 = objc_alloc_init(MEMORY[0x277D17B08]);
        v24 = objc_alloc_init(MEMORY[0x277D17AF8]);
        v25 = [objc_alloc(MEMORY[0x277D17AF0]) initWithCHIPStorageDelegate:v13 keychainDelegate:v24];
        newFabricData2 = [v25 newFabricData];
        if (newFabricData2)
        {
          v70 = v24;
          v27 = requestCopy;
          v28 = [HMDCHIPHomeKeychainFabricData alloc];
          uuid = [(HMDHome *)selfCopy uuid];
          iCloudIdentifier = [(HMDHome *)selfCopy iCloudIdentifier];
          v31 = [(HMDCHIPHomeKeychainFabricData *)v28 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

          LOBYTE(v28) = [(HMDCHIPHomeKeychainFabricData *)v31 storeFabricData:newFabricData2 dataVersion:initUnassociated];
          context = objc_autoreleasePoolPush();
          v32 = selfCopy;
          v33 = HMFGetOSLogHandle();
          v34 = v33;
          if (v28)
          {
            requestCopy = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              *buf = 138543618;
              v78 = v35;
              v79 = 2112;
              v80 = initUnassociated;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Stored additional V2 fabric data item to keychain with data version: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(context);
            [v27 respondWithSuccess];
          }

          else
          {
            requestCopy = v27;
            if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
            {
              v64 = HMFGetLogIdentifier();
              *buf = 138543362;
              v78 = v64;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Failed to store additional fabric data", buf, 0xCu);
            }

            objc_autoreleasePoolPop(context);
            v65 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
            [v27 respondWithError:v65];
          }

          v24 = v70;
        }

        else
        {
          v60 = objc_autoreleasePoolPush();
          v61 = selfCopy;
          v62 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
          {
            v63 = HMFGetLogIdentifier();
            *buf = 138543362;
            v78 = v63;
            _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate additional fabric data", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v60);
          v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          [requestCopy respondWithError:v31];
        }

        v5 = v73;
      }

      else
      {
        v52 = objc_autoreleasePoolPush();
        v53 = selfCopy;
        v54 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
        {
          v55 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v55;
          _os_log_impl(&dword_2531F8000, v54, OS_LOG_TYPE_ERROR, "%{public}@Data version is missing for additional V2 key request", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v52);
        v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        [requestCopy respondWithError:v13];
      }

      goto LABEL_34;
    }

    if (![(HMDCHIPHomeDataSource *)v5 isEqual:*MEMORY[0x277CD0520]])
    {
      v74[0] = MEMORY[0x277D85DD0];
      v74[1] = 3221225472;
      v74[2] = __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke;
      v74[3] = &unk_2797358C8;
      v74[4] = selfCopy;
      v75 = requestCopy;
      [(HMDHome *)selfCopy _clearCHIPStorageWithCompletion:v74];

      goto LABEL_35;
    }

    initUnassociated = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    initUnassociated2 = [objc_alloc(MEMORY[0x277D17B20]) initUnassociated];
    v13 = initUnassociated2;
    if (initUnassociated && initUnassociated2)
    {
      v14 = objc_alloc_init(MEMORY[0x277D17B00]);
      v37 = [v14 forceUpdateNocSigner:initUnassociated ownerSharedOperationalKeyPair:v13];
      v38 = objc_autoreleasePoolPush();
      v39 = selfCopy;
      v40 = HMFGetOSLogHandle();
      v41 = v40;
      if (v37)
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v42;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Stored new V0 keys to keychain", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        [requestCopy respondWithSuccess];
      }

      else
      {
        if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
        {
          v66 = HMFGetLogIdentifier();
          *buf = 138543362;
          v78 = v66;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_ERROR, "%{public}@Failed to write new V0 keys", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v38);
        v67 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [requestCopy respondWithError:v67];
      }
    }

    else
    {
      v56 = objc_autoreleasePoolPush();
      v57 = selfCopy;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v59;
        _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new V0 keys", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v56);
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [requestCopy respondWithError:v14];
    }
  }

LABEL_34:
LABEL_35:

  v51 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome_CHIP___handleResetMatterStorageRequest___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v18 = v7;
      v19 = 2112;
      v20 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to clear CHIP storage: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 40) respondWithError:v3];
  }

  else
  {
    if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
    {
      v8 = [*(a1 + 32) fabric];
      [v8 invalidateCachedData];
    }

    v9 = *(a1 + 32);
    v16 = 0;
    [v9 setUpOperationalFabricDataWithError:&v16];
    v10 = v16;
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v18 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Cleared and left CHIP storage as empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    [*(a1 + 40) respondWithSuccess];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)handleMatterPairingCompletionNotification:(id)notification
{
  v37 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v5 = [notificationCopy numberForKey:@"HMDHomePairingCompletionNodeIDMessageKey"];
  v6 = [notificationCopy numberForKey:@"HMDHomePairingCompletionFabricIDMessageKey"];
  v7 = [notificationCopy numberForKey:@"HMDHomePairingCompletionVendorIDMessageKey"];
  v8 = [notificationCopy numberForKey:@"HMDHomePairingCompletionProductIDMessageKey"];
  v9 = [notificationCopy numberForKey:@"HMDHomePairingCompletionConfigNumberMessageKey"];
  v10 = [notificationCopy numberForKey:@"HMDHomePairingCompletionCategoryMessageKey"];
  v11 = [notificationCopy dataForKey:@"HMDHomePairingCompletionTopologyMessageKey"];
  v12 = v11;
  if (v5 && v6)
  {
    homeManager = [(HMDHome *)self homeManager];
    accessoryBrowserInternal = [homeManager accessoryBrowserInternal];
    [accessoryBrowserInternal chipAccessoryServerBrowser];
    v13 = v5;
    v14 = v6;
    v15 = v10;
    v16 = v9;
    v17 = v8;
    v19 = v18 = v7;
    targetFabricUUID = [(HMDHome *)self targetFabricUUID];
    [v19 handlePairingCompletionForAccessoryWithNodeID:v13 targetFabricUUID:targetFabricUUID fabricID:v14 vendorID:v18 productID:v17 configNumber:v16 category:v15 topology:v12];

    v7 = v18;
    v8 = v17;
    v9 = v16;
    v10 = v15;
    v6 = v14;
    v5 = v13;

    [notificationCopy respondWithSuccess];
  }

  else
  {
    v30 = v11;
    v21 = objc_autoreleasePoolPush();
    selfCopy = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v24 = v28 = v21;
      *buf = 138543874;
      v32 = v24;
      v33 = 2112;
      v34 = v5;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Resident cannot establish connection with accessory with accessory node ID = %@, fabric ID = %@", buf, 0x20u);

      v21 = v28;
    }

    objc_autoreleasePoolPop(v21);
    v25 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [notificationCopy respondWithError:v25];

    v12 = v30;
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)completePotentialFabricDataCreation
{
  os_unfair_recursive_lock_lock_with_options();
  potentialFabricDataCreationBlocks = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v4 = [potentialFabricDataCreationBlocks count];

  if (v4)
  {
    potentialFabricDataCreationBlocks2 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    [potentialFabricDataCreationBlocks2 removeObjectAtIndex:0];
  }

  potentialFabricDataCreationBlocks3 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = [potentialFabricDataCreationBlocks3 count];

  if (v7)
  {
    potentialFabricDataCreationBlocks4 = [(HMDHome *)self potentialFabricDataCreationBlocks];
    v9 = [potentialFabricDataCreationBlocks4 objectAtIndexedSubscript:0];

    os_unfair_recursive_lock_unlock();
    if (v9)
    {
      v9[2]();
    }
  }

  else
  {

    os_unfair_recursive_lock_unlock();
  }
}

- (void)runPotentialFabricDataCreationBlock:(id)block
{
  aBlock = block;
  os_unfair_recursive_lock_lock_with_options();
  potentialFabricDataCreationBlocks = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v5 = [potentialFabricDataCreationBlocks count];

  potentialFabricDataCreationBlocks2 = [(HMDHome *)self potentialFabricDataCreationBlocks];
  v7 = _Block_copy(aBlock);
  [potentialFabricDataCreationBlocks2 addObject:v7];

  os_unfair_recursive_lock_unlock();
  if (!v5)
  {
    aBlock[2]();
  }
}

- (void)exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion
{
  v71 = *MEMORY[0x277D85DE8];
  dCopy = d;
  iDCopy = iD;
  fabricIDCopy = fabricID;
  keyCopy = key;
  senderCopy = sender;
  completionCopy = completion;
  if (![(HMDHome *)self isOwnerUser])
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543362;
    v66 = v27;
    v29 = "%{public}@Non-owner user cannot handle request to generate certificates";
    v30 = v26;
    v31 = 12;
LABEL_15:
    _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_ERROR, v29, buf, v31);
LABEL_16:

    goto LABEL_17;
  }

  if (!keyCopy)
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v26 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_17;
    }

    v27 = HMFGetLogIdentifier();
    *buf = 138543618;
    v66 = v27;
    v67 = 2112;
    v68 = 0;
    v29 = "%{public}@Cannot handle remote request to retrieve certificates with public Key: %@";
    v30 = v26;
    v31 = 22;
    goto LABEL_15;
  }

  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    if (([fabricIDCopy isEqual:&unk_2866276B8] & 1) == 0)
    {
      if (fabricIDCopy)
      {
        chipStorage = [(HMDHome *)self chipStorage];
        fabricID = [chipStorage fabricID];
        if (!fabricID)
        {
          goto LABEL_21;
        }

        v22 = fabricID;
        chipStorage2 = [(HMDHome *)self chipStorage];
        fabricID2 = [chipStorage2 fabricID];
        if ([fabricID2 isEqual:&unk_2866276B8])
        {
LABEL_36:

          goto LABEL_21;
        }

        chipStorage3 = [(HMDHome *)self chipStorage];
        fabricID3 = [chipStorage3 fabricID];
        v54 = [fabricIDCopy isEqual:fabricID3];

        if ((v54 & 1) == 0)
        {
          v24 = objc_autoreleasePoolPush();
          selfCopy6 = self;
          v26 = HMFGetOSLogHandle();
          if (!os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_17;
          }

          v27 = HMFGetLogIdentifier();
          chipStorage4 = [(HMDHome *)selfCopy6 chipStorage];
          v56 = v24;
          fabricID4 = [chipStorage4 fabricID];
          *buf = 138543874;
          v66 = v27;
          v67 = 2112;
          v68 = fabricIDCopy;
          v69 = 2112;
          v70 = fabricID4;
          goto LABEL_46;
        }
      }

LABEL_22:
      if ([dCopy isEqualToNumber:&unk_2866276B8])
      {

        dCopy = 0;
      }

      if (iDCopy && !fabricIDCopy)
      {
        v34 = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
LABEL_29:

          objc_autoreleasePoolPop(v34);
          fabricIDCopy = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, fabricIDCopy);
          goto LABEL_18;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543874;
        v66 = v37;
        v67 = 2112;
        v68 = iDCopy;
        v69 = 2112;
        v70 = 0;
        v38 = "%{public}@Cannot handle remote request to retrieve certificates with device Node ID %@ and fabricID %@";
        v39 = v36;
        v40 = 32;
LABEL_28:
        _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_ERROR, v38, buf, v40);

        goto LABEL_29;
      }

      if (isFeatureMatterLocalFabricConfigEnabled())
      {
        fabric = [(HMDHome *)self fabric];
        fabricID5 = [fabric fabricID];

        isOwner = [senderCopy isOwner];
        if (fabricID5)
        {
          goto LABEL_42;
        }
      }

      else
      {
        chipStorage5 = [(HMDHome *)self chipStorage];
        fabricID5 = [chipStorage5 fabricID];

        isOwner = 0;
        if (fabricID5)
        {
          goto LABEL_42;
        }
      }

      if (![(HMDHome *)self isCurrentDevicePrimaryResident]&& [(HMDHome *)self doesHomeContainResident])
      {
        v34 = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v36 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_29;
        }

        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v66 = v37;
        v38 = "%{public}@Failing commissioning cert because operational cert creation is not allowed in this device while there is a resident in Home";
        v39 = v36;
        v40 = 12;
        goto LABEL_28;
      }

LABEL_42:
      homeManager = [(HMDHome *)self homeManager];
      v57[0] = MEMORY[0x277D85DD0];
      v57[1] = 3221225472;
      v57[2] = __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
      v57[3] = &unk_279721C10;
      v57[4] = self;
      v58 = fabricID5;
      v63 = completionCopy;
      v59 = homeManager;
      dCopy = dCopy;
      v60 = dCopy;
      v61 = iDCopy;
      v64 = isOwner;
      v62 = keyCopy;
      v47 = homeManager;
      fabricIDCopy = fabricID5;
      [(HMDHome *)self updateCATIDsForUsersIfNeeded:1 completion:v57];

      goto LABEL_18;
    }

LABEL_20:
    chipStorage = fabricIDCopy;
    fabricIDCopy = 0;
LABEL_21:

    goto LABEL_22;
  }

  if ([fabricIDCopy isEqualToNumber:&unk_2866276B8])
  {
    goto LABEL_20;
  }

  if (!fabricIDCopy)
  {
    goto LABEL_22;
  }

  chipStorage = [(HMDHome *)self fabric];
  fabricID6 = [chipStorage fabricID];
  if (!fabricID6)
  {
    goto LABEL_21;
  }

  v22 = fabricID6;
  chipStorage2 = [(HMDHome *)self fabric];
  fabricID2 = [chipStorage2 fabricID];
  if ([fabricID2 isEqual:&unk_2866276B8])
  {
    goto LABEL_36;
  }

  fabric2 = [(HMDHome *)self fabric];
  fabricID7 = [fabric2 fabricID];
  v52 = [fabricIDCopy isEqual:fabricID7];

  if (v52)
  {
    goto LABEL_22;
  }

  v24 = objc_autoreleasePoolPush();
  selfCopy6 = self;
  v26 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
  {
    v27 = HMFGetLogIdentifier();
    chipStorage4 = [(HMDHome *)selfCopy6 fabric];
    v56 = v24;
    fabricID4 = [chipStorage4 fabricID];
    *buf = 138543874;
    v66 = v27;
    v67 = 2112;
    v68 = fabricIDCopy;
    v69 = 2112;
    v70 = fabricID4;
LABEL_46:
    _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle remote request to retrieve certificates for unknown fabricID %@. Current home fabric ID %@", buf, 0x20u);

    v24 = v56;
    goto LABEL_16;
  }

LABEL_17:

  objc_autoreleasePoolPop(v24);
  v32 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
  (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, v32);

LABEL_18:
  v33 = *MEMORY[0x277D85DE8];
}

void __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1, void *a2)
{
  v48 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v43 = 0;
  v4 = *(a1 + 32);
  v42 = 0;
  v5 = [v4 storedFabricDataWithDataPresentInV2FabricDataStore:&v43 error:&v42];
  v6 = v42;
  v7 = v6;
  if (!v5)
  {
    v8 = [v6 underlyingErrors];
    if ([v8 na_any:&__block_literal_global_301])
    {
    }

    else
    {
      v30 = [v7 domain];
      if ([v30 isEqual:*MEMORY[0x277D0F1A0]])
      {
        v31 = [v7 code];

        if (v31 == 2)
        {
          goto LABEL_4;
        }
      }

      else
      {
      }

      v34 = *(a1 + 40);
      if (!v34 || ([v34 isEqual:&unk_2866276B8] & 1) != 0 || (objc_msgSend(v7, "underlyingErrors"), v35 = objc_claimAutoreleasedReturnValue(), v36 = objc_msgSend(v35, "na_any:", &__block_literal_global_303), v35, (v36 & 1) == 0))
      {
        v37 = objc_autoreleasePoolPush();
        v38 = *(a1 + 32);
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_DEFAULT))
        {
          v40 = HMFGetLogIdentifier();
          *buf = 138543618;
          v45 = v40;
          v46 = 2112;
          v47 = v7;
          _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot handle commissioning cert request due to fabric data fetch error: %@", buf, 0x16u);
        }

        v33 = v37;
        goto LABEL_28;
      }
    }

LABEL_4:
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v12;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Creating new fabric data", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v5 = [*(a1 + 32) newFabricData];
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT);
    if (v5)
    {
      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v17;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@New fabric data created and stored", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      v43 = 1;
      v18 = [v5 fabricID];
      v19 = [*(a1 + 32) fabric];
      [v19 setFabricID:v18];

      v20 = [v5 fabricID];
      v21 = [*(a1 + 32) chipStorage];
      [v21 setFabricID:v20];

      goto LABEL_10;
    }

    if (v16)
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v32;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to create new fabric data when handling commissioning cert request", buf, 0xCu);
    }

    v33 = v13;
LABEL_28:
    objc_autoreleasePoolPop(v33);
    (*(*(a1 + 80) + 16))();
    goto LABEL_29;
  }

LABEL_10:
  if ((v43 & 1) == 0)
  {
    v22 = objc_autoreleasePoolPush();
    v23 = *(a1 + 32);
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v25;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating fabric data to V2 fabric data store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
    [*(a1 + 32) storeNewFabricData:v5];
  }

  v26 = [*(a1 + 32) accessoryAdministerPrivilegeCATID:0];
  v27 = [*(a1 + 32) accessoryOperatePrivilegeCATID:0];
  v28 = [*(a1 + 48) accessoryBrowser];
  v29 = [v28 chipAccessoryServerBrowser];
  [v29 fetchCertificatesForMatterNodeWithCommissionerNodeID:*(a1 + 56) commissioneeNodeID:*(a1 + 64) forOwner:*(a1 + 88) publicKey:*(a1 + 72) fabricData:v5 adminCAT:v26 opCAT:v27 completionHandler:*(a1 + 80)];

LABEL_29:
  v41 = *MEMORY[0x277D85DE8];
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_3(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 1;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

BOOL __144__HMDHome_CHIP__exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 domain];
  if ([v3 isEqual:*MEMORY[0x277D17A00]])
  {
    v4 = [v2 code] == 2;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)handleCommissioningCertificateRequestWithCommissionerNodeID:(id)d commissioneeNodeID:(id)iD fabricID:(id)fabricID publicKey:(id)key sender:(id)sender completion:(id)completion
{
  dCopy = d;
  iDCopy = iD;
  fabricIDCopy = fabricID;
  keyCopy = key;
  senderCopy = sender;
  completionCopy = completion;
  objc_initWeak(&location, self);
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke;
  v26[3] = &unk_279723038;
  objc_copyWeak(&v33, &location);
  v20 = dCopy;
  v27 = v20;
  v21 = iDCopy;
  v28 = v21;
  v22 = fabricIDCopy;
  v29 = v22;
  v23 = keyCopy;
  v30 = v23;
  v24 = senderCopy;
  v31 = v24;
  v25 = completionCopy;
  v32 = v25;
  [(HMDHome *)self runPotentialFabricDataCreationBlock:v26];

  objc_destroyWeak(&v33);
  objc_destroyWeak(&location);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v7 = *(a1 + 64);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2;
  v8[3] = &unk_279721BC8;
  objc_copyWeak(&v10, (a1 + 80));
  v9 = *(a1 + 72);
  [WeakRetained exclusivelyHandleCommissioningCertificateRequestWithCommissionerNodeID:v3 commissioneeNodeID:v4 fabricID:v5 publicKey:v6 sender:v7 completion:v8];

  objc_destroyWeak(&v10);
}

void __133__HMDHome_CHIP__handleCommissioningCertificateRequestWithCommissionerNodeID_commissioneeNodeID_fabricID_publicKey_sender_completion___block_invoke_2(uint64_t a1, void *a2, void *a3, void *a4, void *a5, void *a6)
{
  v11 = a6;
  v12 = a5;
  v13 = a4;
  v14 = a3;
  v15 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  (*(*(a1 + 32) + 16))();

  [WeakRetained completePotentialFabricDataCreation];
}

- (void)handleCommissioningCertificateRequest:(id)request
{
  requestCopy = request;
  v5 = [requestCopy numberForKey:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
  v6 = [requestCopy numberForKey:@"HMDHomeCommissioningFabricIDMessageKey"];
  v7 = [requestCopy dataForKey:@"HMDHomeCommissioningPublicKeyMessageKey"];
  v8 = [requestCopy userForHome:self];
  if (!isFeatureMatterLocalFabricConfigEnabled())
  {
    goto LABEL_4;
  }

  v9 = [requestCopy numberForKey:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
  if ([v9 isEqualToNumber:&unk_2866276B8])
  {

LABEL_4:
    v9 = 0;
  }

  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke;
  v11[3] = &unk_279721BA0;
  v12 = requestCopy;
  v10 = requestCopy;
  [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:v9 commissioneeNodeID:v5 fabricID:v6 publicKey:v7 sender:v8 completion:v11];
}

void __55__HMDHome_CHIP__handleCommissioningCertificateRequest___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5, uint64_t a6)
{
  v15 = a2;
  v11 = a3;
  v12 = a4;
  v13 = a5;
  if (a6)
  {
    [*(a1 + 32) respondWithError:a6];
  }

  else
  {
    v14 = [MEMORY[0x277CBEB38] dictionary];
    [v14 setObject:v15 forKeyedSubscript:@"HMDHomeCommissioningRootCertMessageKey"];
    [v14 setObject:v11 forKeyedSubscript:@"HMDHomeCommissioningOperationalCertMessageKey"];
    [v14 setObject:v12 forKeyedSubscript:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
    [v14 setObject:v13 forKeyedSubscript:@"HMDHomeCommissioningIPKMessageKey"];
    [*(a1 + 32) respondWithPayload:v14];
  }
}

- (void)_dispatchCHIPReport:(id)report destination:(id)destination
{
  v35 = *MEMORY[0x277D85DE8];
  reportCopy = report;
  destinationCopy = destination;
  v8 = [HMDDeviceHandle deviceHandleForDestination:destinationCopy];
  v9 = +[HMDAccountRegistry sharedRegistry];
  v10 = [v9 deviceForHandle:v8];

  account = [v10 account];

  if (account)
  {
    if (![v10 isCurrentDevice])
    {
      objc_initWeak(buf, self);
      homeManager = [(HMDHome *)self homeManager];
      v21 = [reportCopy copy];
      uuid = [(HMDHome *)self uuid];
      workQueue = [(HMDHome *)self workQueue];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke;
      v25[3] = &unk_279735248;
      objc_copyWeak(&v28, buf);
      v26 = reportCopy;
      v27 = destinationCopy;
      [homeManager sendSecureMessage:v21 target:uuid userID:v27 destination:v27 responseQueue:workQueue responseHandler:v25];

      objc_destroyWeak(&v28);
      objc_destroyWeak(buf);
      goto LABEL_10;
    }

    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v15;
      v31 = 2112;
      v32 = destinationCopy;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Skipping device %@ - ourselves", buf, 0x16u);
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      shortDescription = [v10 shortDescription];
      *buf = 138543874;
      v30 = v18;
      v31 = 2112;
      v32 = shortDescription;
      v33 = 2112;
      v34 = destinationCopy;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Device %@ for CHIP report destination %@ has no user attached to it. Destination removed.", buf, 0x20u);
    }
  }

  objc_autoreleasePoolPop(v12);
  notificationRegistry = [(HMDHome *)selfCopy2 notificationRegistry];
  chipRemoteSubscribers = [notificationRegistry chipRemoteSubscribers];
  [chipRemoteSubscribers removeObject:destinationCopy];

LABEL_10:
  v24 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome_CHIP___dispatchCHIPReport_destination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
    if (v5)
    {
      if (v11)
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 40);
        v17 = 138543874;
        v18 = v12;
        v19 = 2112;
        v20 = v13;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Failed to send CHIP report to user %@ due to error %@", &v17, 0x20u);
LABEL_7:
      }
    }

    else if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) messagePayload];
      v15 = *(a1 + 40);
      v17 = 138543874;
      v18 = v12;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = v15;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Sent CHIP report: %@ to user %@", &v17, 0x20u);

      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleCHIPSendRemoteRequestMessage:(id)message
{
  v60 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v48 = [messageCopy numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  if (v48)
  {
    v46 = messageCopy;
    v51 = 0u;
    v52 = 0u;
    v49 = 0u;
    v50 = 0u;
    matterAccessories = [(HMDHome *)self matterAccessories];
    v6 = [matterAccessories countByEnumeratingWithState:&v49 objects:v59 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v50;
      while (2)
      {
        v9 = 0;
        v47 = v7;
        do
        {
          if (*v50 != v8)
          {
            objc_enumerationMutation(matterAccessories);
          }

          v10 = *(*(&v49 + 1) + 8 * v9);
          v11 = objc_autoreleasePoolPush();
          selfCopy = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
          {
            HMFGetLogIdentifier();
            v14 = v8;
            selfCopy2 = self;
            v17 = v16 = matterAccessories;
            matterNodeID = [v10 matterNodeID];
            *buf = 138543874;
            v54 = v17;
            v55 = 2112;
            v56 = matterNodeID;
            v57 = 2112;
            v58 = v48;
            _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Remote request dispatch compares %@ with %@", buf, 0x20u);

            matterAccessories = v16;
            self = selfCopy2;
            v8 = v14;
            v7 = v47;
          }

          objc_autoreleasePoolPop(v11);
          matterNodeID2 = [v10 matterNodeID];
          if ([matterNodeID2 isEqual:&unk_2866276B8])
          {
          }

          else
          {
            matterNodeID3 = [v10 matterNodeID];
            v21 = [matterNodeID3 isEqualToNumber:v48];

            if (v21)
            {
              v32 = objc_autoreleasePoolPush();
              v33 = selfCopy;
              v34 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
              {
                v35 = HMFGetLogIdentifier();
                identifier = [v10 identifier];
                *buf = 138543618;
                v54 = v35;
                v55 = 2112;
                v56 = identifier;
                _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Dispatching remote request to accessory %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v32);
              messageCopy = v46;
              v37 = [v46 dictionaryForKey:@"HMDHomeCHIPRequestMessageKey"];
              cHIPRemoteCommand = [v37 CHIPRemoteCommand];
              v39 = [cHIPRemoteCommand isEqualToString:*MEMORY[0x277D17C88]];

              if (v39)
              {
                v40 = objc_autoreleasePoolPush();
                v41 = v33;
                v42 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
                {
                  v43 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v54 = v43;
                  v55 = 2112;
                  v56 = v46;
                  _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, "%{public}@Rejecting CHIP remote request as subscription using this interface is not supported: %@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v40);
                v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
                [v46 respondWithError:v44];
              }

              else
              {
                [v10 handleCHIPSendRemoteRequestMessage:v46];
              }

              goto LABEL_29;
            }
          }

          ++v9;
        }

        while (v7 != v9);
        v7 = [matterAccessories countByEnumeratingWithState:&v49 objects:v59 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }

    v22 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v24 = HMFGetOSLogHandle();
    messageCopy = v46;
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v54 = v25;
      v55 = 2112;
      v56 = v46;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory for CHIP remote request: %@", buf, 0x16u);
    }

    v26 = v22;
  }

  else
  {
    v27 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      messagePayload = [messageCopy messagePayload];
      *buf = 138543618;
      v54 = v30;
      v55 = 2112;
      v56 = messagePayload;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Cannot find node ID in CHIP remote request message payload: %@", buf, 0x16u);
    }

    v26 = v27;
  }

  objc_autoreleasePoolPop(v26);
  matterAccessories = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  [messageCopy respondWithError:matterAccessories];
LABEL_29:

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)message
{
  v31 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = [messageCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v5)
  {
    matterAccessories = [(HMDHome *)self matterAccessories];
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke;
    v25[3] = &unk_27972B940;
    v7 = v5;
    v26 = v7;
    v8 = [matterAccessories na_firstObjectPassingTest:v25];

    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    v12 = v11;
    if (v8)
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v13;
        v29 = 2112;
        v30 = v8;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Resetting and removing all CHIP pairings from accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_296;
      v23[3] = &unk_2797358C8;
      v23[4] = selfCopy;
      v24 = messageCopy;
      [v8 removeAllCHIPPairingsWithCompletion:v23];
    }

    else
    {
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v20;
        v29 = 2112;
        v30 = v7;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory with UUID %@ for reset and remove all CHIP pairings message", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v9);
      v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [messageCopy respondWithError:v21];
    }

    v19 = v26;
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      messagePayload = [messageCopy messagePayload];
      *buf = 138543618;
      v28 = v17;
      v29 = 2112;
      v30 = messagePayload;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot find accessory UUID in reset and remove all CHIP pairings message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:v19];
  }

  v22 = *MEMORY[0x277D85DE8];
}

uint64_t __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

void __74__HMDHome_CHIP___handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke_296(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Ignoring remove all CHIP pairings error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 32) handleRemoveAccessoryMessage:*(a1 + 40)];

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldFallbackLocallyForRemoteMatterRequest:(id)request
{
  requestCopy = request;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    code = [requestCopy code];
    v5 = 1;
    if (code > 8 || ((1 << code) & 0x11C) == 0)
    {
      v5 = code == 3201;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (void)_sendRemoteMessageUsingNodeId:(unint64_t)id payload:(id)payload completion:(id)completion
{
  v32[2] = *MEMORY[0x277D85DE8];
  payloadCopy = payload;
  completionCopy = completion;
  v10 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v12 = [v10 initWithTarget:uuid];

  v31[0] = @"HMDHomeCHIPNodeIDMessageKey";
  v13 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:id];
  v31[1] = @"HMDHomeCHIPRequestMessageKey";
  v32[0] = v13;
  v32[1] = payloadCopy;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v32 forKeys:v31 count:2];

  v15 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:v12 payload:v14];
  cHIPRemoteMessageTimeout = [payloadCopy CHIPRemoteMessageTimeout];

  if (cHIPRemoteMessageTimeout)
  {
    cHIPRemoteMessageTimeout2 = [payloadCopy CHIPRemoteMessageTimeout];
    [cHIPRemoteMessageTimeout2 doubleValue];
    [v15 setTimeout:?];
  }

  v22 = MEMORY[0x277D85DD0];
  v23 = 3221225472;
  v24 = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke;
  v25 = &unk_279721B78;
  v29 = completionCopy;
  idCopy = id;
  selfCopy = self;
  v27 = v12;
  v28 = v14;
  v18 = v14;
  v19 = v12;
  v20 = completionCopy;
  [v15 setResponseHandler:&v22];
  [(HMDHome *)self handleCHIPSendRemoteRequestMessage:v15, v22, v23, v24, v25, selfCopy];

  v21 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    if ([*(a1 + 32) _shouldFallbackLocallyForRemoteMatterRequest:v5])
    {
      v7 = [MEMORY[0x277D0F848] messageWithName:@"HMDHomeCHIPSendRemoteRequestMessage" destination:*(a1 + 40) payload:*(a1 + 48)];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_294;
      v23[3] = &unk_279721B50;
      v9 = *(a1 + 56);
      v8 = *(a1 + 64);
      v23[4] = *(a1 + 32);
      v25 = v8;
      v24 = v9;
      [v7 setResponseHandler:v23];
      [*(a1 + 32) _handleCHIPSendRemoteRequestMessage:v7];
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = *(a1 + 32);
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        v20 = *(a1 + 64);
        *buf = 138543874;
        v27 = v19;
        v28 = 2048;
        v29 = v20;
        v30 = 2112;
        v31 = v5;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute CHIP remote operation for nodeID=%llu: error=%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = *(a1 + 56);
      v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
      (*(v21 + 16))(v21, v7, v5);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 32);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 64);
      *buf = 138543618;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully executed CHIP remote operation for nodeID=%llu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = *(a1 + 56);
    v7 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
    (*(v15 + 16))(v15, v7, 0);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __66__HMDHome_CHIP___sendRemoteMessageUsingNodeId_payload_completion___block_invoke_294(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 48);
      v21 = 138543874;
      v22 = v11;
      v23 = 2048;
      v24 = v12;
      v25 = 2112;
      v26 = v5;
      v13 = "%{public}@Failed to execute CHIP local fallback operation for nodeID=%llu: error=%@";
      v14 = v10;
      v15 = OS_LOG_TYPE_ERROR;
      v16 = 32;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v14, v15, v13, &v21, v16);
    }
  }

  else if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v17 = *(a1 + 48);
    v21 = 138543618;
    v22 = v11;
    v23 = 2048;
    v24 = v17;
    v13 = "%{public}@Successfully executed CHIP local fallback operation for nodeID=%llu";
    v14 = v10;
    v15 = OS_LOG_TYPE_INFO;
    v16 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v18 = *(a1 + 40);
  v19 = [v6 objectForKeyedSubscript:@"HMDHomeCHIPResponseMessageKey"];
  (*(v18 + 16))(v18, v19, v5);

  v20 = *MEMORY[0x277D85DE8];
}

- (unint64_t)numMatterV2Keys
{
  v3 = [HMDCHIPHomeKeychainFabricData alloc];
  uuid = [(HMDHome *)self uuid];
  iCloudIdentifier = [(HMDHome *)self iCloudIdentifier];
  v6 = [(HMDCHIPHomeKeychainFabricData *)v3 initWithHomeUUID:uuid iCloudIdentifier:iCloudIdentifier];

  fabricDataItems = [(HMDCHIPHomeKeychainFabricData *)v6 fabricDataItems];
  v8 = [fabricDataItems count];

  return v8;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)d commissioneeNodeID:(id)iD publicKey:(id)key completion:(id)completion
{
  completionCopy = completion;
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __100__HMDHome_CHIP__retrieveOperationalCertificatesForFabricID_commissioneeNodeID_publicKey_completion___block_invoke;
  v12[3] = &unk_279721B28;
  v13 = completionCopy;
  v11 = completionCopy;
  [(HMDHome *)self retrieveOperationalCertificatesForFabricID:d commissionerNodeID:0 commissioneeNodeID:iD publicKey:key completion:v12];
}

- (void)fetchOperationalCertificatesForNewFabricWithFabricID:(id)d publicKey:(id)key fetchFromResident:(BOOL)resident completion:(id)completion
{
  v24 = *MEMORY[0x277D85DE8];
  dCopy = d;
  keyCopy = key;
  completionCopy = completion;
  if (resident)
  {
    [(HMDHome *)self retrieveOperationalCertificatesForFabricID:dCopy commissionerNodeID:0 commissioneeNodeID:0 publicKey:keyCopy completion:completionCopy];
  }

  else
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      currentUser = [(HMDHome *)self currentUser];
      [(HMDHome *)self handleCommissioningCertificateRequestWithCommissionerNodeID:0 commissioneeNodeID:0 fabricID:dCopy publicKey:keyCopy sender:currentUser completion:completionCopy];
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      selfCopy = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        currentUser2 = [(HMDHome *)selfCopy currentUser];
        v20 = 138543618;
        v21 = v17;
        v22 = 2112;
        v23 = currentUser2;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Current user %@ is not the owner. Therefore it must request NOC from the primary resident", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      currentUser = [MEMORY[0x277CCA9B8] hmErrorWithCode:10];
      (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, currentUser);
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)handleClearMatterControllerPrivateStorageRequest:(id)request
{
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = requestCopy;
  v6 = requestCopy;
  dispatch_async(workQueue, v7);
}

void __66__HMDHome_CHIP__handleClearMatterControllerPrivateStorageRequest___block_invoke(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
  {
    v5 = HMFGetLogIdentifier();
    v9 = 138543362;
    v10 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_ERROR, "%{public}@Matter controller private storage is not available to clear", &v9, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = *(a1 + 40);
  v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  [v6 respondWithError:v7];

  v8 = *MEMORY[0x277D85DE8];
}

- (void)handleResetMatterStorageRequest:(id)request
{
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = requestCopy;
  v6 = requestCopy;
  dispatch_async(workQueue, v7);
}

void __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) primaryResidentMessageRouter];
  v3 = v2;
  if (v2)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __49__HMDHome_CHIP__handleResetMatterStorageRequest___block_invoke_289;
    v12[3] = &unk_279733FD8;
    v4 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    [v2 routeMessage:v4 localHandler:v12];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle request to reset Matter storage", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleCHIPSendReportMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

void __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke(uint64_t a1)
{
  v46 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) isCurrentDevicePrimaryResident])
  {
    v2 = [*(a1 + 32) notificationRegistry];
    v3 = [v2 chipRemoteSubscribers];
    v4 = [v3 copy];

    v38 = 0u;
    v39 = 0u;
    v36 = 0u;
    v37 = 0u;
    v5 = v4;
    v6 = [v5 countByEnumeratingWithState:&v36 objects:v45 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v37;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v37 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v36 + 1) + 8 * i);
          v11 = objc_autoreleasePoolPush();
          v12 = *(a1 + 32);
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            v14 = HMFGetLogIdentifier();
            *buf = 138543618;
            v42 = v14;
            v43 = 2112;
            v44 = v10;
            _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Dispatch CHIP report to %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v11);
          [*(a1 + 32) _dispatchCHIPReport:*(a1 + 40) destination:v10];
        }

        v7 = [v5 countByEnumeratingWithState:&v36 objects:v45 count:16];
      }

      while (v7);
    }
  }

  v15 = [*(a1 + 40) numberForKey:@"HMDHomeCHIPNodeIDMessageKey"];
  v31 = [v15 unsignedIntegerValue];

  v16 = [*(a1 + 40) arrayForKey:@"HMDHomeCHIPReportMessageKey"];
  v17 = [v16 na_filter:&__block_literal_global_288];

  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = [*(a1 + 32) chipLocalSubscribers];
  v18 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v33;
    do
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v33 != v20)
        {
          objc_enumerationMutation(obj);
        }

        v22 = *(*(&v32 + 1) + 8 * j);
        v23 = objc_autoreleasePoolPush();
        v24 = *(a1 + 32);
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543618;
          v42 = v26;
          v43 = 2112;
          v44 = v22;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_DEBUG, "%{public}@Calling CHIP report handler for subscriber %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
        v27 = [*(a1 + 32) chipLocalSubscribers];
        v28 = [v27 objectForKeyedSubscript:v22];
        (v28)[2](v28, v31, v17);
      }

      v19 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
    }

    while (v19);
  }

  [*(a1 + 40) respondWithSuccess];
  v29 = *MEMORY[0x277D85DE8];
}

uint64_t __45__HMDHome_CHIP__handleCHIPSendReportMessage___block_invoke_285(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v2 != 0);
}

- (void)handleCHIPSendRemoteRequestMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

void __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) primaryResidentMessageRouter];
  v3 = v2;
  if (v2)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __52__HMDHome_CHIP__handleCHIPSendRemoteRequestMessage___block_invoke_284;
    v12[3] = &unk_279733FD8;
    v4 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    [v2 routeMessage:v4 localHandler:v12];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle CHIP remote request", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage:(id)message
{
  v16 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  primaryResidentMessageRouter = [(HMDHome *)self primaryResidentMessageRouter];
  v6 = primaryResidentMessageRouter;
  if (primaryResidentMessageRouter)
  {
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __73__HMDHome_CHIP__handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage___block_invoke;
    v13[3] = &unk_279733FD8;
    v13[4] = self;
    [primaryResidentMessageRouter routeMessage:messageCopy localHandler:v13];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v15 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to handle reset and remove all CHIP pairings message", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v11];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)hasThreadCapableResident
{
  enabledResidents = [(HMDHome *)self enabledResidents];
  v3 = [enabledResidents na_any:&__block_literal_global_282];

  return v3;
}

uint64_t __41__HMDHome_CHIP__hasThreadCapableResident__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsThreadBorderRouter];

  return v3;
}

- (void)setUpSharedUserFabricDataWithForceFetch:(BOOL)fetch completion:(id)completion
{
  v13 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (![(HMDHome *)self isOwnerUser])
  {
    goto LABEL_5;
  }

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v11 = 138543362;
    v12 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Owner doesn't set up shared user fabric data", &v11, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  if (completionCopy)
  {
LABEL_5:
    completionCopy[2](completionCopy, 0);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)prepareOperationalFabricData
{
  v17 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v12 = 0;
    v3 = [(HMDHome *)self setUpOperationalFabricDataWithError:&v12];
    v4 = v12;
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
    if (v3)
    {
      if (v8)
      {
        v9 = HMFGetLogIdentifier();
        fabric = [(HMDHome *)selfCopy fabric];
        *buf = 138543618;
        v14 = v9;
        v15 = 2112;
        v16 = fabric;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully set up operational fabric data for fabric %@", buf, 0x16u);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v9;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Delay setting up operational fabric data, matter data source not yet configured", buf, 0xCu);
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v5);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)setUpOperationalFabricDataWithError:(id *)error
{
  v44 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self fabricSetUpForPairing])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Operational fabric data set up is deferred till pairing is complete", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [MEMORY[0x277CCA9B8] hmfErrorWithCode:9];
    *error = v9 = 0;
  }

  else
  {
    v10 = [(HMDHome *)self fetchOperationalFabricDataWithError:error];
    if (*error)
    {
      v11 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v15 = *error;
        *buf = 138543618;
        v41 = v14;
        v42 = 2112;
        v43 = v15;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to set up operational fabric data due to failure to fetch data with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v11);
      if ([(HMDHome *)selfCopy2 retainFabricDataWhenLocallyUnavailable])
      {
        v16 = objc_autoreleasePoolPush();
        v17 = selfCopy2;
        v18 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
        {
          v19 = HMFGetLogIdentifier();
          *buf = 138543362;
          v41 = v19;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Will keep using fabric data set up by pairing while fabric data isn't locally available", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v16);
      }

      else
      {
        [(HMDHome *)selfCopy2 clearAccessoryServerBrowserOperationalFabricData];
      }

      v20 = [*error copy];
      [(HMDHome *)selfCopy2 setOperationalFabricError:v20];
      v9 = 0;
    }

    else
    {
      [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:0];
      if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self doesHomeContainResident])
      {
        v39 = 0;
        v20 = [(HMDHome *)self storedFabricDataWithError:&v39];
        v33 = v39;
        if (v33)
        {
          v34 = v33;
          v35 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v37 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v38 = HMFGetLogIdentifier();
            *buf = 138543618;
            v41 = v38;
            v42 = 2112;
            v43 = v20;
            _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Ignoring error %@ while fetching owner stored fabric data to set up operational fabric data", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v35);
        }
      }

      else
      {
        v20 = 0;
      }

      matterFabricID = [(HMDHome *)self matterFabricID];
      if (!matterFabricID)
      {
        goto LABEL_17;
      }

      v22 = matterFabricID;
      matterFabricID2 = [(HMDHome *)self matterFabricID];
      fabricID = [v10 fabricID];
      v25 = [matterFabricID2 isEqual:fabricID];

      if ((v25 & 1) == 0)
      {
LABEL_17:
        fabricID2 = [v10 fabricID];
        fabric = [(HMDHome *)self fabric];
        [fabric setFabricID:fabricID2];

        fabricID3 = [v10 fabricID];
        chipStorage = [(HMDHome *)self chipStorage];
        [chipStorage setFabricID:fabricID3];
      }

      v9 = [(HMDHome *)self setUpAccessoryServerBrowserWithOperationalFabricData:v10 ownerDataSnapshot:v20 error:error];
      if (*error)
      {
        v30 = [*error copy];
        [(HMDHome *)self setOperationalFabricError:v30];
      }

      else
      {
        [(HMDHome *)self setOperationalFabricError:0];
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)unsetFabricForPairing
{
  v11 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setRetainFabricDataWhenLocallyUnavailable:[(HMDHome *)self fabricSetUpForPairing]];
  [(HMDHome *)self setFabricSetUpForPairing:0];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v10 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Attempting to set operational fabric data after pairing completion", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v8 = 0;
  [(HMDHome *)selfCopy setUpOperationalFabricDataWithError:&v8];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)setUpFabricForPairingWithCompletion:(id)completion
{
  completionCopy = completion;
  [(HMDHome *)self setFabricSetUpForPairing:1];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke;
  v6[3] = &unk_279721B00;
  v6[4] = self;
  v7 = completionCopy;
  v5 = completionCopy;
  [(HMDHome *)self fetchFabricDataForPairingWithCompletion:v6];
}

void __53__HMDHome_CHIP__setUpFabricForPairingWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v31 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = *(a1 + 32);
  if (v9)
  {
    [v10 setFabricSetUpForPairing:0];
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 32);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v14;
      v29 = 2112;
      v30 = v9;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to fetch fabric data to set up fabric for pairing: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

  else
  {
    v15 = [v10 matterFabricID];
    if (!v15)
    {
      goto LABEL_7;
    }

    v16 = v15;
    v17 = [*(a1 + 32) matterFabricID];
    v18 = [v7 fabricID];
    v19 = [v17 isEqual:v18];

    if ((v19 & 1) == 0)
    {
LABEL_7:
      v20 = [v7 fabricID];
      v21 = [*(a1 + 32) fabric];
      [v21 setFabricID:v20];

      v22 = [v7 fabricID];
      v23 = [*(a1 + 32) chipStorage];
      [v23 setFabricID:v22];
    }

    v24 = *(a1 + 32);
    v26 = 0;
    [v24 setUpAccessoryServerBrowserWithOperationalFabricData:v7 ownerDataSnapshot:v8 error:&v26];
    v9 = v26;
    if (v9)
    {
      [*(a1 + 32) setFabricSetUpForPairing:0];
    }
  }

  (*(*(a1 + 40) + 16))();

  v25 = *MEMORY[0x277D85DE8];
}

- (void)handleUserFabricKeyUpdate:(id)update
{
  v15 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v14 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling user fabric key update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  homeManager = [(HMDHome *)selfCopy homeManager];
  hasLoadedData = [homeManager hasLoadedData];

  if ([(HMDHome *)selfCopy isCurrentDevicePrimaryResident]|| (isFeatureMatteriPhoneOnlyPairingControlEnabled() & hasLoadedData) == 1)
  {
    v12 = 0;
    [(HMDHome *)selfCopy setUpOperationalFabricDataWithError:&v12];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)handleCATUpdate
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v14 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Handling CAT update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  homeManager = [(HMDHome *)selfCopy homeManager];
  if ([(HMDHome *)selfCopy isOwnerUser])
  {
    if ([(HMDHome *)selfCopy isCurrentDevicePrimaryResident])
    {
      accessoryBrowser = [homeManager accessoryBrowser];
      chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
      fabric = [(HMDHome *)selfCopy fabric];
      [chipAccessoryServerBrowser updateAccessoryACLForFabric:fabric];
    }

    else
    {
      v12 = 0;
      [(HMDHome *)selfCopy setUpOperationalFabricDataWithError:&v12];
    }
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)setCHIPReportHandlerWithSubscriber:(id)subscriber handler:(id)handler
{
  subscriberCopy = subscriber;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke;
  block[3] = &unk_2797355D0;
  v12 = subscriberCopy;
  v13 = handlerCopy;
  block[4] = self;
  v9 = subscriberCopy;
  v10 = handlerCopy;
  dispatch_async(workQueue, block);
}

void __60__HMDHome_CHIP__setCHIPReportHandlerWithSubscriber_handler___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 48);
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v16 = 138543618;
      v17 = v7;
      v18 = 2112;
      v19 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Register CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v9 = [*(a1 + 32) chipLocalSubscribers];

    if (!v9)
    {
      v10 = objc_alloc_init(MEMORY[0x277CBEB38]);
      [*(a1 + 32) setChipLocalSubscribers:v10];
    }

    v11 = _Block_copy(*(a1 + 48));
    v12 = [*(a1 + 32) chipLocalSubscribers];
    [v12 setObject:v11 forKeyedSubscript:*(a1 + 40)];
  }

  else
  {
    if (v6)
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = v14;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEBUG, "%{public}@Deregister CHIP report handler for subscriber %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v11 = [*(a1 + 32) chipLocalSubscribers];
    [v11 setObject:0 forKeyedSubscript:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)finishPairingForServer:(id)server
{
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = serverCopy;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  [v4 finishPairing];
}

- (void)_saveAndSyncMatterFabricIDWithCompletion:(id)completion
{
  completionCopy = completion;
  if ([(HMDHome *)self isOwnerUser])
  {
    v5 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    fabric = [(HMDHome *)self fabric];
    fabricID = [fabric fabricID];
    [v5 setMatterFabricID:fabricID];

    backingStore = [(HMDHome *)self backingStore];
    v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v10 = [backingStore transaction:@"Update Matter Fabric ID" options:v9];

    [v10 add:v5];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke;
    v12[3] = &unk_279733F30;
    v12[4] = self;
    v13 = completionCopy;
    [v10 run:v12];
  }

  else
  {
    v11 = _Block_copy(completionCopy);
    v5 = v11;
    if (v11)
    {
      (*(v11 + 2))(v11, 0);
    }
  }
}

void __58__HMDHome_CHIP___saveAndSyncMatterFabricIDWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Failed to sync Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_ERROR;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v9 = [*(a1 + 32) fabric];
    v10 = [v9 fabricID];
    v17 = 138543618;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v11 = "%{public}@Successfully sync'ed Matter Fabric ID to %@";
    v12 = v7;
    v13 = OS_LOG_TYPE_INFO;
  }

  _os_log_impl(&dword_2531F8000, v12, v13, v11, &v17, 0x16u);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v14 = _Block_copy(*(a1 + 40));
  v15 = v14;
  if (v14)
  {
    (*(v14 + 2))(v14, v3);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)updateFabricUsingHomeModel:(id)model
{
  v54 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  setProperties = [modelCopy setProperties];
  if (![setProperties containsObject:@"matterFabricID"])
  {
    goto LABEL_11;
  }

  fabric = [(HMDHome *)self fabric];
  fabricID = [fabric fabricID];
  matterFabricID = [modelCopy matterFabricID];
  v9 = HMFEqualObjects();

  if (v9 || ([modelCopy matterFabricID], (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
LABEL_11:

    goto LABEL_12;
  }

  v11 = v10;
  v12 = [v10 isEqualToNumber:&unk_2866276B8];

  if (v12)
  {
LABEL_12:
    v25 = 0;
    goto LABEL_13;
  }

  fabric2 = [(HMDHome *)self fabric];
  fabricID2 = [fabric2 fabricID];

  v15 = objc_autoreleasePoolPush();
  selfCopy = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    fabric3 = [(HMDHome *)selfCopy fabric];
    fabricID3 = [fabric3 fabricID];
    matterFabricID2 = [modelCopy matterFabricID];
    v48 = 138543874;
    v49 = v18;
    v50 = 2112;
    v51 = fabricID3;
    v52 = 2112;
    v53 = matterFabricID2;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from %@ to %@", &v48, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  matterFabricID3 = [modelCopy matterFabricID];
  fabric4 = [(HMDHome *)selfCopy fabric];
  [fabric4 setFabricID:matterFabricID3];

  if (fabricID2 && ([fabricID2 isEqualToNumber:&unk_2866276B8] & 1) == 0)
  {
    fabric5 = [(HMDHome *)selfCopy fabric];
    [fabric5 invalidateCachedData];
  }

  v25 = 1;
LABEL_13:
  chipStorage = [(HMDHome *)self chipStorage];
  fabricID4 = [chipStorage fabricID];
  v28 = fabricID4;
  if (fabricID4 && ([fabricID4 isEqualToNumber:&unk_2866276B8] & 1) == 0)
  {
    fabric6 = [(HMDHome *)self fabric];
    fabricID5 = [fabric6 fabricID];
    chipStorage2 = [(HMDHome *)self chipStorage];
    fabricID6 = [chipStorage2 fabricID];
    v34 = HMFEqualObjects();

    if (v34)
    {
      if (!v25)
      {
        goto LABEL_16;
      }
    }

    else
    {
      v35 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
      {
        v38 = HMFGetLogIdentifier();
        fabric7 = [(HMDHome *)selfCopy2 fabric];
        fabricID7 = [fabric7 fabricID];
        chipStorage3 = [(HMDHome *)selfCopy2 chipStorage];
        fabricID8 = [chipStorage3 fabricID];
        v48 = 138543874;
        v49 = v38;
        v50 = 2112;
        v51 = fabricID7;
        v52 = 2112;
        v53 = fabricID8;
        _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Updating fabric ID from CHIPStorage from %@ to %@", &v48, 0x20u);
      }

      objc_autoreleasePoolPop(v35);
      chipStorage4 = [(HMDHome *)selfCopy2 chipStorage];
      fabricID9 = [chipStorage4 fabricID];
      fabric8 = [(HMDHome *)selfCopy2 fabric];
      [fabric8 setFabricID:fabricID9];
    }

LABEL_23:
    [(HMDHome *)self _saveAndSyncMatterFabricIDWithCompletion:0];
    v29 = 1;
    goto LABEL_24;
  }

  if (v25)
  {
    goto LABEL_23;
  }

LABEL_16:
  v29 = 0;
LABEL_24:

  v46 = *MEMORY[0x277D85DE8];
  return v29;
}

- (void)handleUpdatedCHIPPropertiesOnHomeModel:(id)model actions:(id)actions
{
  modelCopy = model;
  actionsCopy = actions;
  chipStorage = [(HMDHome *)self chipStorage];
  v9 = [chipStorage updateUsingHomeModel:modelCopy];

  if (isFeatureMatterLocalFabricConfigEnabled() && [(HMDHome *)self updateFabricUsingHomeModel:modelCopy])
  {
    [actionsCopy markChanged];
  }

  if (v9)
  {
    workQueue = [(HMDHome *)self workQueue];
    v12 = MEMORY[0x277D85DD0];
    v13 = 3221225472;
    v14 = __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke;
    v15 = &unk_2797359B0;
    selfCopy = self;
    v11 = actionsCopy;
    v17 = v11;
    dispatch_async(workQueue, &v12);

    [v11 markChanged];
  }
}

void __64__HMDHome_CHIP__handleUpdatedCHIPPropertiesOnHomeModel_actions___block_invoke(uint64_t a1)
{
  v21 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if (![v2 hasLoadedData])
  {

    goto LABEL_5;
  }

  if (([*(a1 + 32) isCurrentDevicePrimaryResident] & 1) == 0)
  {
    v4 = isFeatureMatteriPhoneOnlyPairingControlEnabled();

    if (v4)
    {
      goto LABEL_7;
    }

LABEL_5:
    v3 = 0;
    goto LABEL_10;
  }

LABEL_7:
  v5 = *(a1 + 32);
  v14 = 0;
  [v5 setUpOperationalFabricDataWithError:&v14];
  v3 = v14;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v18 = v9;
    v19 = 2112;
    v20 = v3;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Set up operational fabric data per CHIP properties change on home model with error: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
LABEL_10:
  v10 = [*(a1 + 40) source] < 2;
  v15 = @"HMDHomeCHIPStorageIsLocalChangeNotificationKey";
  v11 = [MEMORY[0x277CCABB0] numberWithBool:v10];
  v16 = v11;
  v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v16 forKeys:&v15 count:1];

  logAndPostNotification(@"HMDHomeCHIPStorageUpdatedNotification", *(a1 + 32), v12);
  v13 = *MEMORY[0x277D85DE8];
}

- (void)_writeLogData:(id)data logName:(id)name completion:(id)completion
{
  v44 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  nameCopy = name;
  completionCopy = completion;
  v11 = completionCopy;
  if (dataCopy && nameCopy)
  {
    homeManager = [(HMDHome *)self homeManager];
    chipDataSource = [homeManager chipDataSource];
    fileManager = [chipDataSource fileManager];

    v15 = MEMORY[0x277CBEBC0];
    v16 = HMDCreateHomeKitDaemonCacheDirectory();
    v17 = [v15 fileURLWithPath:v16];

    v18 = [v17 URLByAppendingPathComponent:@"MatterDiagnostics"];

    v37 = 0;
    LOBYTE(v16) = [fileManager createDirectoryAtURL:v18 withIntermediateDirectories:1 attributes:0 error:&v37];
    v19 = v37;
    if (v16)
    {
      v20 = [v18 URLByAppendingPathComponent:nameCopy];
      v36 = v19;
      v21 = [fileManager writeData:dataCopy toURL:v20 options:0 error:&v36];
      v22 = v36;

      if ((v21 & 1) == 0)
      {
        v23 = objc_autoreleasePoolPush();
        selfCopy = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v26 = v35 = v23;
          *buf = 138543874;
          v39 = v26;
          v40 = 2112;
          v41 = v20;
          v42 = 2112;
          v43 = v22;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Failed to write log file to path: %@ error: %@", buf, 0x20u);

          v23 = v35;
        }

        objc_autoreleasePoolPop(v23);
        v20 = 0;
      }

      v27 = _Block_copy(v11);
      if (v27)
      {
        path = [v20 path];
        v27[2](v27, path, v22);
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v39 = v32;
        v40 = 2112;
        v41 = v18;
        v42 = 2112;
        v43 = v19;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Failed to create directory at path: %@ error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
      v33 = _Block_copy(v11);
      v20 = v33;
      if (v33)
      {
        (*(v33 + 2))(v33, 0, v19);
      }

      v22 = v19;
    }

    goto LABEL_19;
  }

  fileManager = _Block_copy(completionCopy);
  if (fileManager)
  {
    v18 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (fileManager)[2](fileManager, 0, v18);
LABEL_19:
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)downloadLogWithController:(id)controller nodeId:(id)id type:(int64_t)type timeout:(double)timeout completion:(id)completion
{
  idCopy = id;
  completionCopy = completion;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  [dictionary setCHIPRemoteCommand:*MEMORY[0x277D17C70]];
  v14 = [MEMORY[0x277CCABB0] numberWithInteger:type];
  [dictionary setCHIPDownloadLogType:v14];

  v15 = [MEMORY[0x277CCABB0] numberWithDouble:timeout];
  [dictionary setCHIPDownloadTimeout:v15];

  if (timeout)
  {
    v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:(timeout + 10.0)];
    [dictionary setCHIPRemoteMessageTimeout:v16];
  }

  unsignedLongValue = [idCopy unsignedLongValue];
  v18 = [dictionary copy];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke;
  v20[3] = &unk_279725E38;
  v20[4] = self;
  v21 = completionCopy;
  v19 = completionCopy;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:unsignedLongValue payload:v18 completion:v20];
}

void __74__HMDHome_CHIP__downloadLogWithController_nodeId_type_timeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v16 = 138543874;
    v17 = v10;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Download log response: %@, error: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [v5 hmf_dataForKey:*MEMORY[0x277D17C98]];
  v12 = [v5 hmf_stringForKey:*MEMORY[0x277D17CA0]];
  if (v6)
  {
    v13 = _Block_copy(*(a1 + 40));
    v14 = v13;
    if (v13)
    {
      (*(v13 + 2))(v13, 0, v6);
    }
  }

  else
  {
    [*(a1 + 32) _writeLogData:v11 logName:v12 completion:*(a1 + 40)];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)invokeCommandWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId commandId:(id)commandId fields:(id)fields timedInvokeTimeout:(id)timeout source:(unint64_t)source completion:(id)self0
{
  endpointIdCopy = endpointId;
  clusterIdCopy = clusterId;
  commandIdCopy = commandId;
  fieldsCopy = fields;
  timeoutCopy = timeout;
  completionCopy = completion;
  v22 = objc_alloc_init(MEMORY[0x277CBEB38]);
  [v22 setCHIPRemoteCommand:*MEMORY[0x277D17C68]];
  [v22 setCHIPEndpointId:endpointIdCopy clusterId:clusterIdCopy commandId:commandIdCopy];
  if (fieldsCopy)
  {
    [v22 setCHIPCommandFields:fieldsCopy];
  }

  if (timeoutCopy)
  {
    [v22 setCHIPTimedInvokeTimeout:timeoutCopy];
  }

  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke;
  v27[3] = &unk_279721AD8;
  v31 = completionCopy;
  idCopy = id;
  v27[4] = self;
  v28 = endpointIdCopy;
  v29 = clusterIdCopy;
  v30 = commandIdCopy;
  sourceCopy = source;
  v23 = commandIdCopy;
  v24 = clusterIdCopy;
  v25 = endpointIdCopy;
  v26 = completionCopy;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:id payload:v22 completion:v27];
}

void __116__HMDHome_CHIP__invokeCommandWithNodeId_endpointId_clusterId_commandId_fields_timedInvokeTimeout_source_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Invoke command response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 64);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForCommandResponse:v5 nodeID:*(a1 + 72) endpointID:*(a1 + 40) clusterID:*(a1 + 48) commandID:*(a1 + 56) source:*(a1 + 80) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)writeAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId value:(id)value timedWriteTimeout:(id)timeout completion:(id)completion
{
  endpointIdCopy = endpointId;
  clusterIdCopy = clusterId;
  attributeIdCopy = attributeId;
  valueCopy = value;
  timeoutCopy = timeout;
  completionCopy = completion;
  v21 = objc_alloc_init(MEMORY[0x277CBEB38]);
  [v21 setCHIPRemoteCommand:*MEMORY[0x277D17C90]];
  [v21 setCHIPEndpointId:endpointIdCopy clusterId:clusterIdCopy attributeId:attributeIdCopy];
  [v21 setCHIPData:valueCopy];
  if (timeoutCopy)
  {
    [v21 setCHIPTimedWriteTimeout:timeoutCopy];
  }

  v28[0] = MEMORY[0x277D85DD0];
  v28[1] = 3221225472;
  v28[2] = __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke;
  v28[3] = &unk_279721AB0;
  v34 = completionCopy;
  idCopy = id;
  v28[4] = self;
  v29 = endpointIdCopy;
  v30 = clusterIdCopy;
  v31 = attributeIdCopy;
  v32 = valueCopy;
  v33 = timeoutCopy;
  v22 = timeoutCopy;
  v23 = valueCopy;
  v24 = attributeIdCopy;
  v25 = clusterIdCopy;
  v26 = endpointIdCopy;
  v27 = completionCopy;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:id payload:v21 completion:v28];
}

void __110__HMDHome_CHIP__writeAttributeWithNodeId_endpointId_clusterId_attributeId_value_timedWriteTimeout_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Write attribute response: %@, error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 80);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  [*(a1 + 32) submitLogEventForWriteAttributeWithNodeId:*(a1 + 88) endpointId:*(a1 + 40) clusterId:*(a1 + 48) attributeId:*(a1 + 56) value:*(a1 + 64) timedWriteTimeout:*(a1 + 72) error:v6];
  v13 = *MEMORY[0x277D85DE8];
}

- (void)readAttributeWithNodeId:(unint64_t)id endpointId:(id)endpointId clusterId:(id)clusterId attributeId:(id)attributeId params:(id)params completion:(id)completion
{
  completionCopy = completion;
  v15 = MEMORY[0x277CBEB38];
  paramsCopy = params;
  attributeIdCopy = attributeId;
  clusterIdCopy = clusterId;
  endpointIdCopy = endpointId;
  v20 = objc_alloc_init(v15);
  [v20 setCHIPRemoteCommand:*MEMORY[0x277D17C80]];
  [v20 setCHIPEndpointId:endpointIdCopy clusterId:clusterIdCopy attributeId:attributeIdCopy];

  [v20 setCHIPEncodedParams:paramsCopy];
  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke;
  v22[3] = &unk_279725E38;
  v22[4] = self;
  v23 = completionCopy;
  v21 = completionCopy;
  [(HMDHome *)self _sendRemoteMessageUsingNodeId:id payload:v20 completion:v22];
}

void __92__HMDHome_CHIP__readAttributeWithNodeId_endpointId_clusterId_attributeId_params_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    v10 = HMFGetLogIdentifier();
    v14 = 138543874;
    v15 = v10;
    v16 = 2112;
    v17 = v5;
    v18 = 2112;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Read attribute response: %@, error: %@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v11 = *(a1 + 40);
  v12 = [v5 objectForKeyedSubscript:@"results"];
  (*(v11 + 16))(v11, v12, v6);

  v13 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoryWithNodeID:(id)d
{
  dCopy = d;
  matterAccessories = [(HMDHome *)self matterAccessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke;
  v9[3] = &unk_27972B940;
  v10 = dCopy;
  v6 = dCopy;
  v7 = [matterAccessories na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __43__HMDHome_CHIP__matterAccessoryWithNodeID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 matterNodeID];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

+ (void)updateCHIPPropertiesOnAccessoryModel:(id)model forAddedHAPAccessoryServer:(id)server
{
  modelCopy = model;
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = serverCopy;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;
  v8 = v7;
  if (v7)
  {
    nodeID = [v7 nodeID];
    [modelCopy setChipNodeID:nodeID];
  }
}

+ (BOOL)updateCHIPPropertiesOnHomeModel:(id)model forAddedHAPAccessoryServer:(id)server
{
  modelCopy = model;
  serverCopy = server;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = serverCopy;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  fabricID = [v8 fabricID];

  if (fabricID)
  {
    fabricID2 = [v8 fabricID];
    [modelCopy setChipFabricID:fabricID2];

    fabricID3 = [v8 fabricID];
    [modelCopy setChipFabricIndex:fabricID3];
  }

  return fabricID != 0;
}

- (void)removeCameraNotificationSettingsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  getCameraNotificationSettingsSerializedFileName = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [v3 initFileURLWithPath:getCameraNotificationSettingsSerializedFileName];

  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [defaultManager removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing camera notification settings migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeBulletinBoardNotificationsMigrationFileFromDisk
{
  v18 = *MEMORY[0x277D85DE8];
  v3 = objc_alloc(MEMORY[0x277CBEBC0]);
  getBulletinBoardNotificationSerializedFileName = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [v3 initFileURLWithPath:getBulletinBoardNotificationSerializedFileName];

  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  v13 = 0;
  [defaultManager removeItemAtURL:v5 error:&v13];
  v7 = v13;

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v15 = v11;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Error occurred while removing bulletin board notification migration file from disk : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (id)loadMigrationCameraNotificationSettingsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  getCameraNotificationSettingsSerializedFileName = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:getCameraNotificationSettingsSerializedFileName options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationCameraNotificationSettings:v4];
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Camera notification settings for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = getCameraNotificationSettingsSerializedFileName;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)loadMigrationBulletinBoardNotificationsFromDisk
{
  v24 = *MEMORY[0x277D85DE8];
  getBulletinBoardNotificationSerializedFileName = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v17 = 0;
  v4 = [MEMORY[0x277CBEA90] dataWithContentsOfFile:getBulletinBoardNotificationSerializedFileName options:2 error:&v17];
  v5 = v17;
  v6 = v5;
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 0;
  }

  if (v7)
  {
    v12 = [HMDHome decodedMigrationBulletinBoardNotifications:v4];
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Bulletin board notifications for migration: [%@]", buf, 0x16u);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = getBulletinBoardNotificationSerializedFileName;
      v22 = 2112;
      v23 = v6;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to read data from file : %@ / %@", buf, 0x20u);
    }

    v12 = 0;
  }

  objc_autoreleasePoolPop(v8);
  v15 = *MEMORY[0x277D85DE8];

  return v12;
}

- (void)storeMigrationCameraNotificationSettingsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationCameraNotificationSettingsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      name = [(HMDHome *)selfCopy name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = name;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving camera notification settings for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationCameraNotificationSettings:v4];
    if (v12)
    {
      getCameraNotificationSettingsSerializedFileName = [(HMDHome *)selfCopy getCameraNotificationSettingsSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:getCameraNotificationSettingsSerializedFileName dataLabel:@"CameraNotificationSettings"];
      v15 = objc_autoreleasePoolPush();
      v16 = selfCopy;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = getCameraNotificationSettingsSerializedFileName;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored camera notification settings ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = selfCopy;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store camera notification settings during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      name2 = [(HMDHome *)selfCopy name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = name2;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@No camera notification settings to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (void)storeMigrationBulletinBoardNotificationsToDisk
{
  v32 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  v4 = [HMDHome migrationBulletinBoardNotificationsForHome:self];
  v5 = [v4 count];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v9 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v9)
    {
      v10 = HMFGetLogIdentifier();
      name = [(HMDHome *)selfCopy name];
      v26 = 138543874;
      v27 = v10;
      v28 = 2112;
      v29 = name;
      v30 = 2112;
      v31 = v4;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Archiving bulletin board notifications for migration for home: %@, [%@]", &v26, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    v12 = [HMDHome encodedMigrationBulletinBoardNotifications:v4];
    if (v12)
    {
      getBulletinBoardNotificationSerializedFileName = [(HMDHome *)selfCopy getBulletinBoardNotificationSerializedFileName];
      v14 = [HMDPersistentStore writeData:v12 toStorePath:getBulletinBoardNotificationSerializedFileName dataLabel:@"BulletinBoardNotifications"];
      v15 = objc_autoreleasePoolPush();
      v16 = selfCopy;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v18;
        v28 = 2112;
        v29 = v14;
        v30 = 2112;
        v31 = getBulletinBoardNotificationSerializedFileName;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Stored bulletin board notifications ([%@] bytes) to [%@]", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      v22 = selfCopy;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        v26 = 138543362;
        v27 = v24;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to store bulletin board notifications during migration, archived data is nil", &v26, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
    }
  }

  else
  {
    if (v9)
    {
      v19 = HMFGetLogIdentifier();
      name2 = [(HMDHome *)selfCopy name];
      v26 = 138543618;
      v27 = v19;
      v28 = 2112;
      v29 = name2;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@No bulletin board notifications to migrate for home: %@", &v26, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  objc_autoreleasePoolPop(v3);
  v25 = *MEMORY[0x277D85DE8];
}

- (id)getCameraNotificationSettingsSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  uuid = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Camera-Notification-Settings-%@.plist", v4, uuid];

  return v6;
}

- (id)getBulletinBoardNotificationSerializedFileName
{
  v3 = MEMORY[0x277CCACA8];
  v4 = hh1ToHH2PerDeviceMigrationDirectoryPath;
  uuid = [(HMDHome *)self uuid];
  v6 = [v3 stringWithFormat:@"%@/HMDHome-Bulletin-Board-Notifications-%@.plist", v4, uuid];

  return v6;
}

- (BOOL)cameraNotificationSettingsMigrationFileExistsOnDisk
{
  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  getCameraNotificationSettingsSerializedFileName = [(HMDHome *)self getCameraNotificationSettingsSerializedFileName];
  v5 = [defaultManager fileExistsAtPath:getCameraNotificationSettingsSerializedFileName];

  return v5;
}

- (BOOL)bulletinBoardNotificationsMigrationFileExistsOnDisk
{
  defaultManager = [MEMORY[0x277CCAA00] defaultManager];
  getBulletinBoardNotificationSerializedFileName = [(HMDHome *)self getBulletinBoardNotificationSerializedFileName];
  v5 = [defaultManager fileExistsAtPath:getBulletinBoardNotificationSerializedFileName];

  return v5;
}

+ (id)decodedMigrationCameraNotificationSettings:(id)settings
{
  v31[10] = *MEMORY[0x277D85DE8];
  settingsCopy = settings;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v31[9] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:10];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:settingsCopy error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive camera notification settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)decodedMigrationBulletinBoardNotifications:(id)notifications
{
  v31[9] = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  v5 = MEMORY[0x277CBEB98];
  v31[0] = objc_opt_class();
  v31[1] = objc_opt_class();
  v31[2] = objc_opt_class();
  v31[3] = objc_opt_class();
  v31[4] = objc_opt_class();
  v31[5] = objc_opt_class();
  v31[6] = objc_opt_class();
  v31[7] = objc_opt_class();
  v31[8] = objc_opt_class();
  v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v31 count:9];
  v7 = [v5 setWithArray:v6];

  v26 = 0;
  v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClasses:v7 fromData:notificationsCopy error:&v26];
  v9 = v26;
  v10 = v9;
  if (!v8 || v9)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v19;
      v29 = 2112;
      v30 = v10;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to unarchive bulletin board notifications: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v15 = 0;
  }

  else
  {
    v11 = v8;
    objc_opt_class();
    v12 = objc_opt_isKindOfClass() & 1;
    if (v12)
    {
      v13 = v11;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    if (v12)
    {
      v15 = v11;
    }

    else
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v23;
        v29 = 2112;
        v30 = v11;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unarchived data is the wrong type : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
      v15 = 0;
    }
  }

  v24 = *MEMORY[0x277D85DE8];

  return v15;
}

+ (id)encodedMigrationCameraNotificationSettings:(id)settings
{
  v3 = MEMORY[0x277CCAAB0];
  settingsCopy = settings;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:settingsCopy forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  encodedData = [v5 encodedData];

  return encodedData;
}

+ (id)encodedMigrationBulletinBoardNotifications:(id)notifications
{
  v3 = MEMORY[0x277CCAAB0];
  notificationsCopy = notifications;
  v5 = [[v3 alloc] initRequiringSecureCoding:1];
  [v5 encodeObject:notificationsCopy forKey:*MEMORY[0x277CCA308]];

  [v5 finishEncoding];
  encodedData = [v5 encodedData];

  return encodedData;
}

+ (id)migrationCameraNotificationSettingsForHome:(id)home
{
  v4 = MEMORY[0x277CBEB18];
  homeCopy = home;
  array = [v4 array];
  cameraAccessories = [homeCopy cameraAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke;
  v14 = &unk_279721ED8;
  v15 = array;
  selfCopy = self;
  v8 = array;
  [cameraAccessories na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationCameraNotificationSettingsForHome___block_invoke(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 cameraProfileNotificationSettings];
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 40);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      v10 = [v3 uuid];
      *buf = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding camera notification settings entry for migration: accessoryUUID: %@ cameraProfileNotificationSettings: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 32);
    v12 = [v3 uuid];
    v16[1] = @"HMD.CNS";
    v17[0] = v12;
    v17[1] = v4;
    v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:v16 count:2];
    [v11 addObject:v13];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Camera accessory: %@ missing camera profile notification settings during migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v15 = *MEMORY[0x277D85DE8];
}

+ (id)migrationBulletinBoardNotificationsForHome:(id)home
{
  v4 = MEMORY[0x277CBEB18];
  homeCopy = home;
  array = [v4 array];
  hapAccessories = [homeCopy hapAccessories];

  v11 = MEMORY[0x277D85DD0];
  v12 = 3221225472;
  v13 = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke;
  v14 = &unk_279721ED8;
  v15 = array;
  selfCopy = self;
  v8 = array;
  [hapAccessories na_each:&v11];

  v9 = [v8 copy];

  return v9;
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2;
  v8[3] = &unk_279721EB0;
  v9 = v3;
  v7 = *(a1 + 32);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  [v4 na_each:v8];
}

void __77__HMDHome_BulletinNotifications__migrationBulletinBoardNotificationsForHome___block_invoke_2(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 bulletinBoardNotification];
  if (v4)
  {
    v5 = [MEMORY[0x277CBEB68] null];
    v6 = [v4 condition];

    if (v6)
    {
      v7 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      v8 = [v4 condition];
      [v7 encodeObject:v8 forKey:*MEMORY[0x277CCA308]];

      [v7 finishEncoding];
      v9 = [v7 encodedData];

      v5 = v9;
    }

    v10 = objc_autoreleasePoolPush();
    v11 = *(a1 + 48);
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) uuid];
      v15 = [v3 instanceID];
      [v4 isEnabled];
      HMFBooleanToString();
      v16 = v23 = v10;
      *buf = 138544386;
      v27 = v13;
      v28 = 2112;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v5;
      v34 = 2112;
      v35 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Adding bulletin board notification entry for migration: accessoryUUID: %@ serviceInstanceID: %@ predicate: %@ enabled: %@", buf, 0x34u);

      v10 = v23;
    }

    objc_autoreleasePoolPop(v10);
    v24[0] = @"HMD.BBN.A";
    v17 = *(a1 + 40);
    v18 = [*(a1 + 32) uuid];
    v25[0] = v18;
    v24[1] = @"HMD.BBN.S";
    v19 = [v3 instanceID];
    v25[1] = v19;
    v25[2] = v5;
    v24[2] = @"HMD.BBN.P";
    v24[3] = @"HMD.BBN.E";
    v20 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v4, "isEnabled")}];
    v25[3] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v25 forKeys:v24 count:4];
    [v17 addObject:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (HMDHomeManager)homeManager
{
  WeakRetained = objc_loadWeakRetained(&self->_homeManager);

  return WeakRetained;
}

- (void)removeSharedUserResponseEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v5 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserResponseEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    builderCopy = v5;
  }
}

- (void)addSharedUserResponseEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v8 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    if (!sharedUserResponseEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserResponseEventBuilders;
      self->_sharedUserResponseEventBuilders = v6;

      sharedUserResponseEventBuilders = self->_sharedUserResponseEventBuilders;
    }

    [(NSMutableSet *)sharedUserResponseEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    builderCopy = v8;
  }
}

- (void)removeSharedUserEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v5 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableSet *)self->_sharedUserInviteEventBuilders removeObject:v5];
    os_unfair_recursive_lock_unlock();
    builderCopy = v5;
  }
}

- (void)addSharedUserEventBuilder:(id)builder
{
  builderCopy = builder;
  if (builderCopy)
  {
    v8 = builderCopy;
    os_unfair_recursive_lock_lock_with_options();
    sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    if (!sharedUserInviteEventBuilders)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v7 = self->_sharedUserInviteEventBuilders;
      self->_sharedUserInviteEventBuilders = v6;

      sharedUserInviteEventBuilders = self->_sharedUserInviteEventBuilders;
    }

    [(NSMutableSet *)sharedUserInviteEventBuilders addObject:v8];
    os_unfair_recursive_lock_unlock();
    builderCopy = v8;
  }
}

- (void)_handleFetchTriggerNameRequest:(id)request
{
  v27 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [requestCopy uuidForKey:@"triggerUUID"];
  if (v5)
  {
    triggers = [(HMDHome *)self triggers];
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __42__HMDHome__handleFetchTriggerNameRequest___block_invoke;
    v21[3] = &unk_27972A1C0;
    v22 = v5;
    v7 = [triggers na_firstObjectPassingTest:v21];

    configuredName = [v7 configuredName];
    if (configuredName || ([v7 name], (configuredName = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v9 = configuredName;
      v23 = *MEMORY[0x277CD2758];
      v24 = configuredName;
      v10 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v24 forKeys:&v23 count:1];
      [requestCopy respondWithPayload:v10];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      selfCopy = self;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543362;
        v26 = v20;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@trigger name is nil.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [requestCopy respondWithError:v9];
    }

    v11 = v22;
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@message does not contain the trigger SPI identifier", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [requestCopy respondWithError:v11];
  }

  v16 = *MEMORY[0x277D85DE8];
}

uint64_t __42__HMDHome__handleFetchTriggerNameRequest___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = *(a1 + 32);
  v5 = HMFEqualObjects();

  return v5;
}

- (BOOL)defaultRoomContainsAccessoryWithUUID:(id)d
{
  v4 = [(HMDHome *)self accessoryWithUUID:d];
  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  room = [v4 room];
  v7 = [roomForEntireHome isEqual:room];

  return v7;
}

- (BOOL)hasActiveWACPairing
{
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  hasActiveWACPairing = [accessoryBrowser hasActiveWACPairing];

  return hasActiveWACPairing;
}

- (id)destinationForAppleMediaAccessory:(id)accessory
{
  accessoryCopy = accessory;
  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  uuid = [accessoryCopy uuid];

  v7 = [mediaGroupsAggregateConsumer destinationWithParentIdentifier:uuid];

  return v7;
}

- (id)destinationControllerDataForAppleMediaAccessory:(id)accessory
{
  accessoryCopy = accessory;
  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  uuid = [accessoryCopy uuid];

  v7 = [mediaGroupsAggregateConsumer destinationControllerDataWithParentIdentifier:uuid];

  return v7;
}

- (id)mediaGroupsAggregateDataTopicName
{
  v2 = MEMORY[0x277CD1A78];
  v3 = *MEMORY[0x277CCFF30];
  uuid = [(HMDHome *)self uuid];
  v5 = [v2 topicFromSuffixID:v3 homeUUID:uuid];

  return v5;
}

- (void)_handleRetrieveHomeLocationForFeedback:(id)feedback
{
  v24 = *MEMORY[0x277D85DE8];
  feedbackCopy = feedback;
  homeLocationHandler = [(HMDHome *)self homeLocationHandler];

  if (homeLocationHandler)
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    homeLocationHandler2 = [(HMDHome *)self homeLocationHandler];
    locationUpdateTimestamp = [homeLocationHandler2 locationUpdateTimestamp];

    if (locationUpdateTimestamp)
    {
      homeLocationHandler3 = [(HMDHome *)self homeLocationHandler];
      locationUpdateTimestamp2 = [homeLocationHandler3 locationUpdateTimestamp];
      [dictionary setObject:locationUpdateTimestamp2 forKeyedSubscript:*MEMORY[0x277CD0048]];
    }

    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v20 = 138543618;
      v21 = v14;
      v22 = 2112;
      v23 = dictionary;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Retrieve home location for feedback : %@", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [feedbackCopy respondWithPayload:dictionary];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v20 = 138543362;
      v21 = v18;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Home Location Handler does not exist.", &v20, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
    dictionary = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [feedbackCopy respondWithError:dictionary];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeHomeAccessControlOverride:(id)override error:(id *)error
{
  v26 = *MEMORY[0x277D85DE8];
  overrideCopy = override;
  v7 = [overrideCopy hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [overrideCopy hmf_numberForKey:@"kConfigTestingHomeAccessControlKey"];
  if (v8)
  {
    v9 = 1;
  }

  else
  {
    v9 = v7;
  }

  if (v9)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {

      v8 = 0;
    }

    overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
    v11 = HMFEqualObjects();
    objc_storeStrong(&self->_overriddenHomeAccessControl, v8);
    os_unfair_recursive_lock_unlock();
    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v22 = 138543618;
        v23 = v15;
        v24 = 2112;
        v25 = overrideCopy;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Home Access Control overridden to %@", &v22, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home access control override: missing data in payload", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    if (error)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      *error = v8 = 0;
    }

    else
    {
      v8 = 0;
    }
  }

  v20 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_processTestModeUpdateHomeLocation:(id)location error:(id *)error
{
  v44 = *MEMORY[0x277D85DE8];
  locationCopy = location;
  if (isInternalBuild())
  {
    v7 = [locationCopy dataForKey:@"kHomeLocationDataKey"];
    if (v7)
    {
      v37 = 0;
      v8 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v7 error:&v37];
      v9 = v37;
      v10 = v9;
      v11 = v8 != 0;
      if (v8)
      {
        v36 = v9;
        v12 = [locationCopy hmf_numberForKey:@"homeLocationSource"];
        intValue = [v12 intValue];

        v14 = objc_autoreleasePoolPush();
        selfCopy = self;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          v17 = HMFGetLogIdentifier();
          v18 = HMDHomeLocationSourceToString(intValue);
          *buf = 138543874;
          v39 = v17;
          v40 = 2112;
          v41 = v8;
          v42 = 2112;
          v43 = v18;
          _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Received new home location override from shared admin: %@, source : %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v14);
        homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
        date = [MEMORY[0x277CBEAA8] date];
        [homeLocationHandler runTransactionWithLocation:v8 updatedTime:date source:intValue];

        v10 = v36;
      }

      else
      {
        v29 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v31 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
        {
          v32 = HMFGetLogIdentifier();
          *buf = 138543874;
          v39 = v32;
          v40 = 2112;
          v41 = v7;
          v42 = 2112;
          v43 = v10;
          _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: failed to unarchive location from data %@: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v29);
        if (error)
        {
          v33 = v10;
          *error = v10;
        }
      }
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v39 = v28;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: no home location data found in payload", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
      if (error)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *error = v11 = 0;
      }

      else
      {
        v11 = 0;
      }
    }
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v39 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location override: not running on an internal build", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    if (error)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      *error = v11 = 0;
    }

    else
    {
      v11 = 0;
    }
  }

  v34 = *MEMORY[0x277D85DE8];
  return v11;
}

- (BOOL)_processTestModeHomeLocationStatusOverride:(id)override error:(id *)error
{
  v23 = *MEMORY[0x277D85DE8];
  overrideCopy = override;
  v7 = [overrideCopy hmf_BOOLForKey:@"kConfigTestingResetOverrideKey"];
  v8 = [overrideCopy hmf_numberForKey:@"kConfigTestingHomeLocationStatusKey"];
  v9 = v8;
  if (v8)
  {
    v10 = 1;
  }

  else
  {
    v10 = v7;
  }

  if (v10)
  {
    unsignedIntegerValue = [v8 unsignedIntegerValue];
    homeLocation = [(HMDHome *)self homeLocation];
    os_unfair_recursive_lock_lock_with_options();
    if (v7)
    {
      if (!self->_overrideHomeLocation)
      {
        self->_overriddenHomeLocation = unsignedIntegerValue;
        os_unfair_recursive_lock_unlock();
        goto LABEL_16;
      }

      v13 = 0;
    }

    else
    {
      v13 = 1;
    }

    self->_overrideHomeLocation = v13;
    self->_overriddenHomeLocation = unsignedIntegerValue;
    os_unfair_recursive_lock_unlock();
    homeLocation2 = [(HMDHome *)self homeLocation];
    if (homeLocation2 != homeLocation)
    {
      [(HMDHome *)self _handleHomeLocationChange:homeLocation2 previousLocation:homeLocation];
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v17;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Cannot set home location status override: missing data in payload", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    if (error)
    {
      *error = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    }
  }

LABEL_16:

  v19 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)aggregator:(id)aggregator changedResidentCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD
{
  v26 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  capabilitiesCopy = capabilities;
  rawCapabilitiesCopy = rawCapabilities;
  dCopy = d;
  iDCopy = iD;
  v17 = objc_autoreleasePoolPush();
  selfCopy = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = dCopy;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received resident capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)selfCopy _writeResidentCapabilities:rawCapabilitiesCopy accessoryUUID:dCopy homeUUID:iDCopy];

  v21 = *MEMORY[0x277D85DE8];
}

- (void)aggregator:(id)aggregator changedAccessoryCapabilities:(id)capabilities rawCapabilities:(id)rawCapabilities accessoryUUID:(id)d homeUUID:(id)iD
{
  v26 = *MEMORY[0x277D85DE8];
  aggregatorCopy = aggregator;
  capabilitiesCopy = capabilities;
  rawCapabilitiesCopy = rawCapabilities;
  dCopy = d;
  iDCopy = iD;
  v17 = objc_autoreleasePoolPush();
  selfCopy = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    v22 = 138543618;
    v23 = v20;
    v24 = 2112;
    v25 = dCopy;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Aggregator: Received accessory capabilities for accessory: %@", &v22, 0x16u);
  }

  objc_autoreleasePoolPop(v17);
  [(HMDHome *)selfCopy _writeAccessoryCapabilities:rawCapabilitiesCopy accessoryUUID:dCopy homeUUID:iDCopy];

  v21 = *MEMORY[0x277D85DE8];
}

- (id)localAndRemoteSubscriptionProvider
{
  homeManager = [(HMDHome *)self homeManager];
  localAndRemoteSubscriptionProvider = [homeManager localAndRemoteSubscriptionProvider];

  return localAndRemoteSubscriptionProvider;
}

- (id)eventStoreReadHandle
{
  homeManager = [(HMDHome *)self homeManager];
  eventStoreReadHandle = [homeManager eventStoreReadHandle];

  return eventStoreReadHandle;
}

- (HMEEventForwarder)eventForwarder
{
  homeManager = [(HMDHome *)self homeManager];
  eventForwarder = [homeManager eventForwarder];

  return eventForwarder;
}

- (void)didReceiveAccessorySetting:(id)setting accessoryUUID:(id)d
{
  v35 = *MEMORY[0x277D85DE8];
  settingCopy = setting;
  dCopy = d;
  v8 = settingCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10 && ([v10 keyPath], v11 = objc_claimAutoreleasedReturnValue(), v12 = objc_msgSend(v11, "isEqualToString:", @"root.siri.availableLanguages"), v11, (v12 & 1) != 0))
  {
    v13 = [(HMDHome *)self accessoryWithUUID:dCopy];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      notificationCenter = [(HMDHome *)self notificationCenter];
      v27 = @"HMDHomeNotificationKey";
      selfCopy = self;
      v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&selfCopy forKeys:&v27 count:1];
      [notificationCenter postNotificationName:@"HMDAppleMediaAccessoryLanguagesChangedNotification" object:self userInfo:v17];
    }

    else
    {
      v22 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543874;
        v30 = v25;
        v31 = 2112;
        v32 = v8;
        v33 = 2112;
        v34 = dCopy;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Received accessory setting %@ that is not for an accessory %@ in this home", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v22);
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543618;
      v30 = v21;
      v31 = 2112;
      v32 = v8;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Unexpectedly received accessory setting %@ that is not for available languages", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)deviceForAppleMediaAccessoryMessageRouter:(id)router message:(id)message
{
  messagePayload = [message messagePayload];
  v6 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  device = [v9 device];

  return device;
}

- (BOOL)isCurrentDevicePairedWithWatchForSiriSecureAccessoryAccessController:(id)controller
{
  homeManager = [(HMDHome *)self homeManager];
  isPairedWithWatch = [homeManager isPairedWithWatch];

  return isPairedWithWatch;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithWatchAuthForSiriSecureAccessoryAccessController:(id)controller
{
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsSiriUnsecuringActionsWithWatchAuth = [localCapabilitiesDataSource supportsSiriUnsecuringActionsWithWatchAuth];

  return supportsSiriUnsecuringActionsWithWatchAuth;
}

- (BOOL)currentDeviceSupportsSiriUnsecuringActionsWithNoPasscodeForSiriSecureAccessoryAccessController:(id)controller
{
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsSiriUnsecuringActionsWithNoPasscode = [localCapabilitiesDataSource supportsSiriUnsecuringActionsWithNoPasscode];

  return supportsSiriUnsecuringActionsWithNoPasscode;
}

- (HMDSiriSecureAccessoryAccessController)siriSecureAccessoryAccessController
{
  dataSource = [(HMDHome *)self dataSource];
  v4 = [dataSource makeSiriSecureAccessoryAccessControllerWithDataSource:self];

  return v4;
}

- (BOOL)isMediaSystem:(id)system
{
  systemCopy = system;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __25__HMDHome_isMediaSystem___block_invoke;
  v9[3] = &unk_279726148;
  v10 = systemCopy;
  v6 = systemCopy;
  v7 = [mediaSystems na_firstObjectPassingTest:v9];

  return v7 != 0;
}

uint64_t __25__HMDHome_isMediaSystem___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (BOOL)isSidekickAccessory:(id)accessory
{
  v3 = [(HMDHome *)self accessoryWithUUID:accessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    siriEndpointProfile = [v5 siriEndpointProfile];
    v8 = siriEndpointProfile != 0;
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (BOOL)isAppleMediaAccessory:(id)accessory
{
  v3 = [(HMDHome *)self accessoryWithUUID:accessory];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & (v3 != 0);
}

- (BOOL)router:(id)router shouldHandleMessage:(id)message usingRouter:(id)usingRouter
{
  v35 = *MEMORY[0x277D85DE8];
  routerCopy = router;
  messageCopy = message;
  usingRouterCopy = usingRouter;
  accessoryMessageRouterViaPrimary = [(HMDHome *)self accessoryMessageRouterViaPrimary];

  if (accessoryMessageRouterViaPrimary != routerCopy)
  {
    v12 = 0;
    goto LABEL_18;
  }

  messagePayload = [messageCopy messagePayload];
  v14 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B8]];

  v15 = [(HMDHome *)self accessoryWithUUID:v14];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v16 = v15;
  }

  else
  {
    v16 = 0;
  }

  v17 = v16;

  currentAccessory = [(HMDHome *)self currentAccessory];
  uuid = [currentAccessory uuid];
  uuid2 = [v17 uuid];
  v21 = [uuid hmf_isEqualToUUID:uuid2];

  if (v17)
  {
    appleDeviceRouter = [(HMDHome *)self appleDeviceRouter];
    v23 = appleDeviceRouter;
    if (appleDeviceRouter == usingRouterCopy)
    {
      v24 = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident]| v21;

      if (v24)
      {
        v25 = objc_autoreleasePoolPush();
        selfCopy = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
        {
          v28 = HMFGetLogIdentifier();
          v33 = 138543362;
          v34 = v28;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEBUG, "%{public}@accepting accessory router", &v33, 0xCu);
        }

        objc_autoreleasePoolPop(v25);
        v29 = 1;
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v29 = 0;
LABEL_14:
  primaryResidentMessageRouter = [(HMDHome *)self primaryResidentMessageRouter];

  if (primaryResidentMessageRouter == usingRouterCopy)
  {
    v12 = 1;
  }

  else
  {
    v12 = v29;
  }

LABEL_18:
  v31 = *MEMORY[0x277D85DE8];
  return v12;
}

- (BOOL)remoteEventAllowedForTopic:(id)topic deviceType:(unint64_t)type userType:(unint64_t)userType
{
  topicCopy = topic;
  homeRemoteEventAccessController = [(HMDHome *)self homeRemoteEventAccessController];
  LOBYTE(userType) = [homeRemoteEventAccessController remoteEventAllowedForTopic:topicCopy deviceType:type userType:userType];

  return userType;
}

- (id)currentAccessoryHomeUUID
{
  currentAccessory = [(HMDHome *)self currentAccessory];

  if (currentAccessory)
  {
    uuid = [(HMDHome *)self uuid];
  }

  else
  {
    uuid = 0;
  }

  return uuid;
}

- (id)currentAccessorySetupMetricDispatcher
{
  homeManager = [(HMDHome *)self homeManager];
  currentAccessorySetupMetricDispatcher = [homeManager currentAccessorySetupMetricDispatcher];

  return currentAccessorySetupMetricDispatcher;
}

- (id)expandedTopicsWithTopics:(id)topics
{
  topicsCopy = topics;
  homeManager = [(HMDHome *)self homeManager];
  v6 = [HMDHomeEventsGenerated expandedTopicsWithTopics:topicsCopy homeManager:homeManager];

  return v6;
}

- (BOOL)canTopicBeForwardedToPrimaryFromResident:(id)resident
{
  residentCopy = resident;
  currentAccessory = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = currentAccessory;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    if (self)
    {
      v8 = MEMORY[0x277CD16F0];
      v9 = v7;
      uuid = [(HMDHome *)self uuid];
      uuid2 = [v9 uuid];

      self = [v8 topicPrefixWithHomeUUID:uuid accessoryUUID:uuid2];
    }

    v12 = [residentCopy hasPrefix:self];
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

- (id)messageTargetForDeviceIdentifier:(id)identifier
{
  identifierCopy = identifier;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke;
  v11[3] = &unk_27972AE10;
  v12 = identifierCopy;
  v7 = identifierCopy;
  v8 = [residentDevices na_firstObjectPassingTest:v11];
  device = [v8 device];

  return device;
}

uint64_t __44__HMDHome_messageTargetForDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 device];
  v4 = [v3 identifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (BOOL)isDeviceIdentifierPrimaryResident:(id)resident
{
  residentCopy = resident;
  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];
  identifier = [device identifier];
  v8 = [identifier hmf_isEqualToUUID:residentCopy];

  return v8;
}

- (BOOL)isDevicePrimaryResident:(id)resident
{
  residentCopy = resident;
  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];
  v7 = [device isEqual:residentCopy];

  return v7;
}

- (BOOL)shouldAllowTopic:(id)topic forDeviceWithMessageIdentifier:(id)identifier
{
  v14[1] = *MEMORY[0x277D85DE8];
  topicCopy = topic;
  v7 = [(HMDHome *)self accessoryWithDeviceIdentifier:identifier];
  if (v7)
  {
    v14[0] = topicCopy;
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v14 count:1];
    uuid = [v7 uuid];
    v10 = [HMDAccessoryEventsGenerated topicsRemovingAccessoryTopics:v8 accessoryUUID:uuid];
    v11 = [v10 count] != 0;
  }

  else
  {
    v11 = 1;
  }

  v12 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)routerServerUserAccessControlProviderForIdentifier:(id)identifier
{
  identifierCopy = identifier;
  users = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke;
  v9[3] = &unk_27972E540;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [users na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __62__HMDHome_routerServerUserAccessControlProviderForIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uuid];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)routerServerUserAccessControlProviderIdentifierForMessage:(id)message
{
  v3 = [message matchingRemoteIdentityUserForHome:self];
  uuid = [v3 uuid];

  return uuid;
}

- (void)primaryResidentClientHasConnectivityDidChangeForRemoteEventRouterClientController:(id)controller
{
  v17 = *MEMORY[0x277D85DE8];
  controllerCopy = controller;
  remoteEventRouterClientController = [(HMDHome *)self remoteEventRouterClientController];

  if (remoteEventRouterClientController == controllerCopy)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      primaryResidentClientHasConnectivity = [controllerCopy primaryResidentClientHasConnectivity];
      v11 = @"down";
      if (primaryResidentClientHasConnectivity)
      {
        v11 = @"up";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Connectivity to primary resident is %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)selfCopy canReachPrimaryResidentChanged];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDevicePrimaryResidentForRemoteEventRouterClientController:(id)controller
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDevicePrimaryResident = [residentDeviceManager isCurrentDevicePrimaryResident];

  return isCurrentDevicePrimaryResident;
}

- (BOOL)isCurrentDeviceResidentCapableForRemoteEventRouterClientController:(id)controller
{
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  isResidentCapable = [localCapabilitiesDataSource isResidentCapable];

  return isResidentCapable;
}

- (id)deviceForPrimaryResidentForRemoteEventRouterClientController:(id)controller
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];

  if ([device isCurrentDevice])
  {
    v6 = 0;
  }

  else
  {
    v6 = device;
  }

  return v6;
}

- (id)deviceForAccessoryUUID:(id)d forRemoteEventRouterClientController:(id)controller
{
  controller = [(HMDHome *)self accessoryWithUUID:d, controller];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = controller;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    deviceForDirectMessaging = [v6 deviceForDirectMessaging];
  }

  else
  {
    deviceForDirectMessaging = 0;
  }

  return deviceForDirectMessaging;
}

- (id)eventStoreWriteHandleForRemoteEventRouterClientController:(id)controller
{
  homeManager = [(HMDHome *)self homeManager];
  eventStoreWriteHandle = [homeManager eventStoreWriteHandle];

  return eventStoreWriteHandle;
}

- (id)eventStoreReadHandleForRemoteEventRouterClientController:(id)controller
{
  homeManager = [(HMDHome *)self homeManager];
  eventStoreReadHandle = [homeManager eventStoreReadHandle];

  return eventStoreReadHandle;
}

- (id)primaryResidentDeviceIdentifierForRemoteEventRouterClientController:(id)controller
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];
  identifier = [device identifier];

  return identifier;
}

- (void)clientController:(id)controller didReceiveFetchedCachedEvents:(id)events source:(id)source
{
  sourceCopy = source;
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke;
  v9[3] = &unk_279722E70;
  v9[4] = self;
  v10 = sourceCopy;
  v8 = sourceCopy;
  [events hmf_enumerateKeysAndObjectsWithAutoreleasePoolUsingBlock:v9];
}

void __65__HMDHome_clientController_didReceiveFetchedCachedEvents_source___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = *(a1 + 32);
  v6 = a3;
  v7 = a2;
  v9 = [v5 homeManager];
  v8 = [v9 memoryEventConsumer];
  [v8 didReceiveCachedEvent:v6 topic:v7 source:*(a1 + 40)];
}

- (id)eventRouterDumpStateInfo
{
  v20[1] = *MEMORY[0x277D85DE8];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];

  v19 = uUIDString;
  v17[0] = @"RemoteClientController";
  remoteEventRouterClientController = [(HMDHome *)self remoteEventRouterClientController];
  dumpStateDescription = [remoteEventRouterClientController dumpStateDescription];
  v7 = dumpStateDescription;
  if (dumpStateDescription)
  {
    v8 = dumpStateDescription;
  }

  else
  {
    v8 = &stru_286509E58;
  }

  v17[1] = @"RemoteServer";
  v18[0] = v8;
  remoteEventRouterServer = [(HMDHome *)self remoteEventRouterServer];
  dumpStateDescription2 = [remoteEventRouterServer dumpStateDescription];
  v11 = dumpStateDescription2;
  if (dumpStateDescription2)
  {
    v12 = dumpStateDescription2;
  }

  else
  {
    v12 = &stru_286509E58;
  }

  v18[1] = v12;
  v13 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v18 forKeys:v17 count:2];
  v20[0] = v13;
  v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v20 forKeys:&v19 count:1];

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

- (void)_handleRetrieveAsyncResults:(id)results
{
  v60 = *MEMORY[0x277D85DE8];
  resultsCopy = results;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    shortDescription = [resultsCopy shortDescription];
    *buf = 138543618;
    v54 = v8;
    v55 = 2112;
    v56 = shortDescription;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling retrieve async results message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = [resultsCopy dataForKey:*MEMORY[0x277CD0510]];
  if (v10)
  {
    reportingSessionManager = [(HMDHome *)selfCopy reportingSessionManager];
    v12 = [reportingSessionManager consumeResponseMessagePayloadsForSessionWithReportContextRequestInfo:v10];

    if ([v12 count])
    {
      v45 = v10;
      v51 = 0u;
      v52 = 0u;
      v49 = 0u;
      v50 = 0u;
      v13 = v12;
      v48 = [v13 countByEnumeratingWithState:&v49 objects:v59 count:16];
      if (v48)
      {
        v47 = *v50;
        obj = v13;
        do
        {
          for (i = 0; i != v48; ++i)
          {
            if (*v50 != v47)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v49 + 1) + 8 * i);
            v16 = objc_autoreleasePoolPush();
            v17 = [v15 mutableCopy];
            [v17 setObject:MEMORY[0x277CBEC28] forKeyedSubscript:@"kMultiPartResponseKey"];
            v18 = objc_autoreleasePoolPush();
            v19 = selfCopy;
            v20 = selfCopy;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543874;
              v54 = v22;
              v55 = 2112;
              v56 = v15;
              v57 = 2112;
              v58 = v17;
              _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Overriding payload in last cached message from %@ to %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v18);
            if ([resultsCopy qualityOfService] < 17)
            {
              qualityOfService = 17;
            }

            else
            {
              qualityOfService = [resultsCopy qualityOfService];
            }

            v24 = objc_alloc(MEMORY[0x277D0F820]);
            uuid = [(HMDHome *)v20 uuid];
            v26 = [v24 initWithTarget:uuid];

            v27 = objc_alloc(MEMORY[0x277D0F848]);
            v28 = [v17 copy];
            v29 = [v27 initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:qualityOfService destination:v26 payload:v28];

            transport = [resultsCopy transport];
            [v29 setTransport:transport];
            identifier = [resultsCopy identifier];
            [v29 setIdentifier:identifier];

            msgDispatcher = [(HMDHome *)v20 msgDispatcher];
            [msgDispatcher sendMessage:v29];

            objc_autoreleasePoolPop(v16);
            selfCopy = v19;
          }

          v13 = obj;
          v48 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
        }

        while (v48);
      }

      [resultsCopy respondWithSuccess];
      v10 = v45;
    }

    else
    {
      v38 = v12;
      v39 = objc_autoreleasePoolPush();
      v40 = selfCopy;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v42;
        _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_DEFAULT, "%{public}@Did not find any response message payloads to retrieve", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v39);
      v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [resultsCopy respondWithError:v43];

      v13 = v38;
    }
  }

  else
  {
    v33 = objc_autoreleasePoolPush();
    v34 = selfCopy;
    v35 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
    {
      v36 = HMFGetLogIdentifier();
      messagePayload = [resultsCopy messagePayload];
      *buf = 138543618;
      v54 = v36;
      v55 = 2112;
      v56 = messagePayload;
      _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Could not find request info in message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v33);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [resultsCopy respondWithError:v13];
  }

  v44 = *MEMORY[0x277D85DE8];
}

- (void)endReportingSessionForMessage:(id)message
{
  messageCopy = message;
  v4 = reportContextFromMessage(messageCopy);
  if (v4)
  {
    v5 = messageCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (!v7)
    {
      reportingSessionManager = [(HMDHome *)self reportingSessionManager];
      identifier = [v5 identifier];
      [reportingSessionManager endSessionWithUUID:identifier];
    }
  }
}

- (void)handleReportingSessionResponseMessage:(id)message
{
  messageCopy = message;
  reportingSessionManager = [(HMDHome *)self reportingSessionManager];
  messagePayload = [messageCopy messagePayload];
  identifier = [messageCopy identifier];

  [reportingSessionManager addResponseMessagePayload:messagePayload toSessionWithUUID:identifier];
}

- (void)startReportingSessionForMessage:(id)message
{
  messageCopy = message;
  v4 = reportContextFromMessage(messageCopy);
  if (v4)
  {
    transport = [messageCopy transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = transport;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      reportingSessionManager = [(HMDHome *)self reportingSessionManager];
      identifier = [messageCopy identifier];
      [reportingSessionManager startSessionWithUUID:identifier reportContext:v4 xpcClientConnection:v7];
    }
  }
}

- (BOOL)hasCharacteristicNotificationRegistrations
{
  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  v3 = [notificationRegistrations count] != 0;

  return v3;
}

- (void)_applyNotificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories minusSet:self->_notificationDeregistrations];
  [(NSMutableSet *)self->_notificationDeregistrations removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)removeNotificationDeregistrationForClientIdentifier:(id)identifier
{
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations removeObject:identifierCopy];
  os_unfair_recursive_lock_unlock();
}

- (void)addNotificationDeregistrationForClientIdentifier:(id)identifier
{
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationDeregistrations addObject:identifierCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSSet)notificationDeregistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationDeregistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isClientIdentifierSubscribedToAppleMediaAccessoryState:(id)state
{
  stateCopy = state;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories containsObject:stateCopy];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)addNotificationRegistrationForClientIdentifier:(id)identifier includesAppleMediaAccessories:(BOOL)accessories
{
  accessoriesCopy = accessories;
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableSet *)self->_notificationRegistrations addObject:identifierCopy];
  if (accessoriesCopy)
  {
    [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories addObject:identifierCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)notificationRegistrationsForAppleMediaAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrationsForAppleMediaAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSSet)notificationRegistrations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableSet *)self->_notificationRegistrations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleSetPreferredPrimaryMessage:(id)message
{
  v15 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    messagePayload = [messageCopy messagePayload];
    v11 = 138543618;
    v12 = v8;
    v13 = 2112;
    v14 = messagePayload;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@SetPreferredPrimary - Received set preferred primary message with payload: %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [messageCopy respondWithSuccess];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRollReaderKey:(id)key
{
  v20 = *MEMORY[0x277D85DE8];
  keyCopy = key;
  internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    uUID = [internalOnlyInitializer UUID];
    *buf = 138543618;
    v17 = v9;
    v18 = 2112;
    v19 = uUID;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Home Key}] Homeutil command received to roll reader key in this home", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  nfcReaderKeyManager = [(HMDHome *)selfCopy nfcReaderKeyManager];
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __32__HMDHome__handleRollReaderKey___block_invoke;
  v14[3] = &unk_2797359D8;
  v15 = keyCopy;
  v12 = keyCopy;
  [nfcReaderKeyManager rollReaderKeyWithFlow:internalOnlyInitializer withCompletion:v14];

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __32__HMDHome__handleRollReaderKey___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)_handleTestUpgradeToROAR:(id)r
{
  v23 = *MEMORY[0x277D85DE8];
  rCopy = r;
  v5 = [rCopy numberForKey:*MEMORY[0x277CD0608]];
  v6 = v5;
  if (v5)
  {
    if ([v5 BOOLValue])
    {
      v7 = [HMDHomeUpgradedToROAR defaultModelForHome:self];
    }

    else
    {
      [(HMDHome *)self setIsUpdatedToHH2:0];
      v13 = [HMDHomeUpgradedToROAR alloc];
      v14 = [HMDHomeUpgradedToROAR modelIDForHome:self];
      uuid = [(HMDHome *)self uuid];
      v7 = [(HMDBackingStoreModelObject *)v13 initWithObjectChangeType:3 uuid:v14 parentUUID:uuid];

      [(HMDHome *)self saveWithReason:@"Downgrading To HH1" postSyncNotification:0 objectChange:1];
    }

    backingStore = [(HMDHome *)self backingStore];
    name = [rCopy name];
    v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v19 = [backingStore transaction:name options:v18];

    [v19 add:v7 withMessage:rCopy];
    [v19 run];
    [rCopy respondWithSuccess];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v11;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Update flag is needed.", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
    [rCopy respondWithError:v12];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (HMDHomeNFCReaderKey)nfcReaderKey
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_nfcReaderKey;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNfcReaderKey:(id)key
{
  keyCopy = key;
  os_unfair_recursive_lock_lock_with_options();
  nfcReaderKey = self->_nfcReaderKey;
  self->_nfcReaderKey = keyCopy;

  os_unfair_recursive_lock_unlock();
}

- (void)configureNaturalLightingForDemoMode
{
  v10 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Setting up natural lighting for demo mode", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)selfCopy configureNaturalLightingWithDemoModeEnabled:1];
  v7 = *MEMORY[0x277D85DE8];
}

- (HMDNaturalLightingContext)naturalLightingContext
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_naturalLightingContext;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNaturalLightingContext:(id)context
{
  contextCopy = context;
  os_unfair_recursive_lock_lock_with_options();
  if ([(HMDNaturalLightingContext *)self->_naturalLightingContext isEqual:contextCopy])
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [contextCopy copy];
    naturalLightingContext = self->_naturalLightingContext;
    self->_naturalLightingContext = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomeNaturalLightingContextUpdatedNotification", self, 0);
  }
}

- (NSArray)mediaSystems
{
  mediaSystemController = [(HMDHome *)self mediaSystemController];
  mediaSystems = [mediaSystemController mediaSystems];

  return mediaSystems;
}

- (BOOL)isResidentReachable:(id)reachable
{
  v32 = *MEMORY[0x277D85DE8];
  reachableCopy = reachable;
  if (-[HMDHome isCurrentDevicePrimaryResident](self, "isCurrentDevicePrimaryResident") || (-[HMDHome primaryResident](self, "primaryResident"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 isEqual:reachableCopy], v5, v6))
  {
    isReachable = [reachableCopy isReachable];
  }

  else
  {
    v25 = 0u;
    v26 = 0u;
    v23 = 0u;
    v24 = 0u;
    appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
    v11 = [appleMediaAccessories countByEnumeratingWithState:&v23 objects:v31 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v24;
      while (2)
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v24 != v13)
          {
            objc_enumerationMutation(appleMediaAccessories);
          }

          v15 = *(*(&v23 + 1) + 8 * i);
          device = [v15 device];
          device2 = [reachableCopy device];
          v18 = [device isEqual:device2];

          if (v18)
          {
            if ([v15 isReachable])
            {
              isReachable = 1;
            }

            else
            {
              isReachable = [v15 isDeviceReachable];
            }

            goto LABEL_4;
          }
        }

        v12 = [appleMediaAccessories countByEnumeratingWithState:&v23 objects:v31 count:16];
        if (v12)
        {
          continue;
        }

        break;
      }
    }

    v19 = objc_autoreleasePoolPush();
    selfCopy = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v28 = v22;
      v29 = 2112;
      v30 = reachableCopy;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEBUG, "%{public}@Could not find matching accessory for resident %@ so assuming unreachable", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    isReachable = 0;
  }

LABEL_4:

  v8 = *MEMORY[0x277D85DE8];
  return isReachable;
}

- (BOOL)isCompanionReachable
{
  homeManager = [(HMDHome *)self homeManager];
  companionReachable = [homeManager companionReachable];

  return companionReachable;
}

- (HMDDevice)companionDevice
{
  homeManager = [(HMDHome *)self homeManager];
  companionDevice = [homeManager companionDevice];

  return companionDevice;
}

- (void)_wol_processChangedCharacteristicResponses:(id)responses
{
  v24 = *MEMORY[0x277D85DE8];
  responsesCopy = responses;
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v4 = [responsesCopy countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v20;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v20 != v6)
        {
          objc_enumerationMutation(responsesCopy);
        }

        v8 = *(*(&v19 + 1) + 8 * i);
        request = [v8 request];
        characteristic = [request characteristic];

        accessory = [characteristic accessory];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = accessory;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if ([v13 canWakeUpViaWoL])
        {
          request2 = [v8 request];
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          v16 = (request2 == 0) | ~isKindOfClass;
          error = [v8 error];
          [v13 _wol_processReadWriteResponseForCharacteristic:characteristic isRead:v16 & 1 response:v8 error:error];
        }
      }

      v5 = [responsesCopy countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v5);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)attemptToUpdateThreadNetworkID:(id)d
{
  v23 = *MEMORY[0x277D85DE8];
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  unfilteredThreadNetworkID = self->_unfilteredThreadNetworkID;
  v7 = HMFEqualObjects();
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  if (v7)
  {
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v11 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = dCopy;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_DEBUG, "%{public}@unfilteredThreadNetworkID did not change (%@)", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = self->_unfilteredThreadNetworkID;
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = v14;
      v21 = 2112;
      v22 = dCopy;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@unfilteredThreadNetworkID changed: %@ -> %@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    objc_storeStrong(&self->_unfilteredThreadNetworkID, d);
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 ^ 1;
}

- (NSString)unfilteredThreadNetworkID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_unfilteredThreadNetworkID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setThreadNetworkSequenceNumber:(unint64_t)number
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  self->_threadNetworkSequenceNumber = number;
}

- (unint64_t)threadNetworkSequenceNumber
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  return self->_threadNetworkSequenceNumber;
}

- (void)_handleRemoteUserClientCloudShareRepairRequest:(id)request
{
  requestCopy = request;
  homeManager = [(HMDHome *)self homeManager];
  [homeManager handleRemoteUserClientCloudShareRepairRequest:requestCopy];
}

- (void)_handleRemoteUserClientCloudShareRequest:(id)request
{
  requestCopy = request;
  homeManager = [(HMDHome *)self homeManager];
  [homeManager handleRemoteUserClientCloudShareRequest:requestCopy];
}

- (void)handleXPCConnectionInvalidated:(id)invalidated
{
  invalidatedCopy = invalidated;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_handleXPCConnectionInvalidated___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = invalidatedCopy;
  selfCopy = self;
  v6 = invalidatedCopy;
  dispatch_async(workQueue, v7);
}

void __42__HMDHome_handleXPCConnectionInvalidated___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"connection"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (v5)
  {
    [*(a1 + 40) _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v5];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v12 = 138543618;
      v13 = v9;
      v14 = 2112;
      v15 = v10;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Received connection invalidated notification, but no connection object was found: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (id)updatePersonManagerSettings:(id)settings
{
  settingsCopy = settings;
  personDataManager = [(HMDHome *)self personDataManager];
  v6 = [personDataManager updateSettingsModelWithSettings:settingsCopy];

  return v6;
}

- (HMDHomePersonManager)personManager
{
  personDataManager = [(HMDHome *)self personDataManager];
  personManager = [personDataManager personManager];

  return personManager;
}

- (void)setPersonManagerSettings:(id)settings
{
  settingsCopy = settings;
  os_unfair_recursive_lock_lock_with_options();
  if (([(HMHomePersonManagerSettings *)self->_personManagerSettings isEqual:settingsCopy]& 1) != 0)
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    v4 = [settingsCopy copy];
    personManagerSettings = self->_personManagerSettings;
    self->_personManagerSettings = v4;

    os_unfair_recursive_lock_unlock();
    logAndPostNotification(@"HMDHomePersonManagerSettingsDidChangeNotification", self, 0);
  }
}

- (HMHomePersonManagerSettings)personManagerSettings
{
  os_unfair_recursive_lock_lock_with_options();
  personManagerSettings = self->_personManagerSettings;
  if (personManagerSettings)
  {
    v4 = personManagerSettings;
  }

  else
  {
    v4 = objc_alloc_init(MEMORY[0x277CD1AB0]);
  }

  v5 = v4;
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (void)_removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:(id)devices
{
  devicesCopy = devices;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:devicesCopy])
  {
    [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices removeObject:devicesCopy];
    v4 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
    os_unfair_recursive_lock_unlock();
    if (!v4)
    {
      v5 = +[HMDMainDriver driver];
      symptomManager = [v5 symptomManager];
      [symptomManager stopDiscoveringSymptomsRequiringNearbyInfo];
    }
  }

  else
  {
    os_unfair_recursive_lock_unlock();
  }
}

- (void)_handleStopDiscoveringSymptomsForNearbyDevicesMessage:(id)message
{
  v15 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:messageCopy])
  {
    transport = [messageCopy transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = transport;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      [(HMDHome *)self _removeConnectionFromConnectionsDiscoveringSymptomsForNearbyDevices:v7];
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v13 = 138543362;
        v14 = v11;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to stop discovering symptoms, but no connection proxy was available", &v13, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [messageCopy respondWithPayload:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleStartDiscoveringSymptomsForNearbyDevicesMessage:(id)message
{
  v18 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([(HMDHome *)self _ensureDevicesSymptomDiscoveryMessageCanBeHandled:messageCopy])
  {
    transport = [messageCopy transport];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = transport;
    }

    else
    {
      v6 = 0;
    }

    v7 = v6;

    if (v7)
    {
      os_unfair_recursive_lock_lock_with_options();
      if ([(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices containsObject:v7])
      {
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices addObject:v7];
        v12 = [(NSHashTable *)self->_connectionsDiscoveringSymptomsForNearbyDevices count];
        os_unfair_recursive_lock_unlock();
        if (v12 == 1)
        {
          v13 = +[HMDMainDriver driver];
          symptomManager = [v13 symptomManager];
          [symptomManager startDiscoveringSymptomsRequiringNearbyInfo];
        }
      }
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        v16 = 138543362;
        v17 = v11;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Asked to start discovering symptoms, but no connection proxy was available", &v16, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
    }

    [messageCopy respondWithPayload:0];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (BOOL)_ensureDevicesSymptomDiscoveryMessageCanBeHandled:(id)handled
{
  v20 = *MEMORY[0x277D85DE8];
  handledCopy = handled;
  if ([handledCopy isEntitledForSPIAccess])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      LOBYTE(responseHandler) = 1;
      goto LABEL_13;
    }

    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Only owners may start discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    responseHandler = [handledCopy responseHandler];

    if (responseHandler)
    {
      v10 = 17;
      goto LABEL_12;
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      v18 = 138543362;
      v19 = v9;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Only entitled clients may stop discovering symptoms for nearby devices", &v18, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    responseHandler = [handledCopy responseHandler];

    if (responseHandler)
    {
      v10 = 10;
LABEL_12:
      responseHandler = [MEMORY[0x277CCA9B8] hmErrorWithCode:v10];
      responseHandler2 = [handledCopy responseHandler];
      (responseHandler2)[2](responseHandler2, responseHandler, 0);

      LOBYTE(responseHandler) = 0;
    }
  }

LABEL_13:

  v16 = *MEMORY[0x277D85DE8];
  return responseHandler;
}

- (void)mediaSystemController:(id)controller didRemoveMediaSystem:(id)system
{
  systemCopy = system;
  homeManager = [(HMDHome *)self homeManager];
  lastEventStoreController = [homeManager lastEventStoreController];
  [lastEventStoreController didRemoveMediaSystem:systemCopy];
}

- (void)mediaSystemController:(id)controller removeAccessories:(id)accessories fromAssistantAccessControl:(id)control
{
  accessoriesCopy = accessories;
  controlCopy = control;
  currentUser = [(HMDHome *)self currentUser];
  v9 = [currentUser isEqual:controlCopy];

  if (v9)
  {
    currentUser2 = [(HMDHome *)self currentUser];
    [currentUser2 removeAccessoriesFromAssistantAccessControlList:accessoriesCopy];
  }
}

- (id)mediaSystemController:(id)controller accessoryForUUID:(id)d
{
  dCopy = d;
  accessories = [(HMDHome *)self accessories];
  v7 = [accessories hmf_firstObjectWithUUID:dCopy];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

- (id)destinationForMediaSystem:(id)system
{
  systemCopy = system;
  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  uuid = [systemCopy uuid];

  v7 = [mediaGroupsAggregateConsumer destinationWithParentIdentifier:uuid];

  return v7;
}

- (void)userAssistantAccessControlDidUpdate:(id)update accessories:(id)accessories
{
  updateCopy = update;
  accessoriesCopy = accessories;
  currentUser = [(HMDHome *)self currentUser];
  v9 = [currentUser isEqual:updateCopy];

  if (v9)
  {
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke;
    block[3] = &unk_279734960;
    block[4] = self;
    v12 = updateCopy;
    v13 = accessoriesCopy;
    dispatch_async(workQueue, block);
  }
}

void __59__HMDHome_userAssistantAccessControlDidUpdate_accessories___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) mediaSystemController];
  [v2 _userAssistantAccessControlDidUpdate:*(a1 + 40) accessories:*(a1 + 48)];
}

- (NSArray)cameraAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_2131];

  return v3;
}

id __28__HMDHome_cameraAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 cameraProfiles];
  v6 = [v5 count];

  if (v6)
  {
    v7 = v4;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (NSArray)hapAccessoriesForLegacyDataBlobEncoding
{
  hapAccessories = [(HMDHome *)self hapAccessories];
  v3 = [hapAccessories na_filter:&__block_literal_global_2129];

  return v3;
}

uint64_t __50__HMDHome_hapAccessoriesForLegacyDataBlobEncoding__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  v3 = (v2 == 0) | ~objc_opt_isKindOfClass();

  return v3 & 1;
}

- (id)matterAccessoryWithIdentifier:(id)identifier
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:identifier];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (NSArray)matterAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_1999];

  return v3;
}

id __28__HMDHome_matterAccessories__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 conformsToProtocol:&unk_286699378])
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 supportsCHIP];
  if ((v6 & 1) != 0 || ([v5 matterNodeID], v2 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v2, "unsignedIntValue")))
  {
    v7 = v5;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = v7;
    }

    else
    {
      v8 = 0;
    }

    v9 = v8;

    if (v6)
    {
      goto LABEL_13;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_13:

  return v9;
}

- (NSArray)hapAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_1996];

  return v3;
}

void *__25__HMDHome_hapAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_handleMediaPropertiesWrite:(id)write
{
  writeCopy = write;
  source = [writeCopy source];
  v6 = [writeCopy dictionaryForKey:@"kMediaPropertiesListKey"];
  objc_initWeak(&location, self);
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __39__HMDHome__handleMediaPropertiesWrite___block_invoke;
  v8[3] = &unk_279729BD8;
  objc_copyWeak(&v10, &location);
  v7 = writeCopy;
  v9 = v7;
  [(HMDHome *)self _handleWriteMediaProperties:v6 source:source requestMessage:v7 completionHandler:v8];

  objc_destroyWeak(&v10);
  objc_destroyWeak(&location);
}

void __39__HMDHome__handleMediaPropertiesWrite___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media write with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 32) responseHandler];
    (v9)[2](v9, 0, v3);
  }

  else
  {
    v9 = [*(a1 + 32) responseHandler];
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (v9)[2](v9, v10, 0);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleWriteMediaProperties:(id)properties source:(unint64_t)source requestMessage:(id)message completionHandler:(id)handler
{
  v63 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  messageCopy = message;
  handlerCopy = handler;
  v41 = propertiesCopy;
  v40 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(propertiesCopy, "count")}];
  group = dispatch_group_create();
  objc_initWeak(&location, self);
  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  allKeys = [propertiesCopy allKeys];
  v10 = [allKeys countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v10)
  {
    v39 = *v52;
    obj = allKeys;
    do
    {
      v42 = v10;
      for (i = 0; i != v42; ++i)
      {
        if (*v52 != v39)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v51 + 1) + 8 * i);
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v12, messageCopy}];
        v14 = [(HMDHome *)self mediaProfileWithUUID:v13];
        v15 = [v41 hmf_dictionaryForKey:v12];
        v16 = [HMDMediaPropertyWriteRequest deserializeWriteRequests:v15 mediaProfile:v14];
        if ([v16 count])
        {
          mediaSession = [v14 mediaSession];
          if (mediaSession)
          {
            dispatch_group_enter(group);
            v47[0] = MEMORY[0x277D85DD0];
            v47[1] = 3221225472;
            v47[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke;
            v47[3] = &unk_2797353D0;
            objc_copyWeak(&v50, &location);
            v48 = v40;
            v49 = group;
            [mediaSession writeProperties:v16 completion:v47];

            objc_destroyWeak(&v50);
          }

          else
          {
            v20 = objc_autoreleasePoolPush();
            selfCopy = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
            {
              log = v22;
              v36 = v20;
              v23 = HMFGetLogIdentifier();
              accessory = [v14 accessory];
              name = [accessory name];
              *buf = 138543874;
              v57 = v23;
              v58 = 2112;
              v59 = name;
              v60 = 2112;
              v61 = v12;
              _os_log_impl(&dword_2531F8000, log, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for writing", buf, 0x20u);

              v20 = v36;
              v22 = log;
            }

            objc_autoreleasePoolPop(v20);
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v27 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:v26];
            v28 = [HMDMediaPropertyResponse serializeResponses:v27];
            [v40 addEntriesFromDictionary:v28];

            mediaSession = 0;
          }
        }

        else
        {
          mediaSession = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v18 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v16 error:mediaSession];
          v19 = [HMDMediaPropertyResponse serializeResponses:v18];
          [v40 addEntriesFromDictionary:v19];
        }
      }

      allKeys = obj;
      v10 = [obj countByEnumeratingWithState:&v51 objects:v62 count:16];
    }

    while (v10);
  }

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3;
  block[3] = &unk_279735738;
  v45 = v40;
  v46 = handlerCopy;
  v30 = v40;
  v31 = handlerCopy;
  dispatch_group_notify(group, workQueue, block);

  objc_destroyWeak(&location);
  v32 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2;
    block[3] = &unk_279734960;
    v8 = a1[4];
    v9 = v3;
    v10 = a1[5];
    dispatch_async(v6, block);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __79__HMDHome__handleWriteMediaProperties_source_requestMessage_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaWriteRequests:(id)requests viaDevice:(id)device completion:(id)completion
{
  v29[1] = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  deviceCopy = device;
  completionCopy = completion;
  v10 = [HMDMediaPropertyWriteRequest serializeWriteRequests:requestsCopy];
  if ([v10 count])
  {
    uuid = [(HMDHome *)self uuid];
    uUIDString = [uuid UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = uUIDString;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    messageDestination = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesWriteRequestKey" qualityOfService:25 destination:messageDestination payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_279731AF8;
    objc_copyWeak(&v25, &location);
    v24 = completionCopy;
    v23 = requestsCopy;
    [v17 setResponseHandler:v22];
    uuid2 = [(HMDHome *)self uuid];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:uuid2 responseQueue:workQueue viaDevice:deviceCopy];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (completionCopy)
  {
    uUIDString = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:requestsCopy error:uUIDString];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(completionCopy + 2))(completionCopy, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome_redispatchMediaWriteRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_handleMediaPropertiesRead:(id)read
{
  location[3] = *MEMORY[0x277D85DE8];
  readCopy = read;
  v5 = [readCopy dictionaryForKey:@"kMediaPropertiesListKey"];
  if ([v5 count])
  {
    source = [readCopy source];
    objc_initWeak(location, self);
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __38__HMDHome__handleMediaPropertiesRead___block_invoke;
    v13[3] = &unk_279729BD8;
    objc_copyWeak(&v15, location);
    v14 = readCopy;
    [(HMDHome *)self _handleReadMediaProperties:v5 source:source message:v14 completionHandler:v13];

    objc_destroyWeak(&v15);
    objc_destroyWeak(location);
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@None of the properties in media properties read are valid", location, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [readCopy respondWithError:v11];
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleMediaPropertiesRead___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Responding to media read with %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 32) respondWithPayload:v3];
  }

  else
  {
    v9 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [v9 respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleReadMediaProperties:(id)properties source:(unint64_t)source message:(id)message completionHandler:(id)handler
{
  v119 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  messageCopy = message;
  handlerCopy = handler;
  group = dispatch_group_create();
  v73 = propertiesCopy;
  v70 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(propertiesCopy, "count")}];
  objc_initWeak(&location, self);
  v103 = 0u;
  v104 = 0u;
  v101 = 0u;
  v102 = 0u;
  obj = [propertiesCopy allKeys];
  v76 = [obj countByEnumeratingWithState:&v101 objects:v110 count:16];
  if (v76)
  {
    v75 = *v102;
    v89 = *MEMORY[0x277CD0910];
    v88 = *MEMORY[0x277CD0938];
    v87 = *MEMORY[0x277CD0990];
    v86 = *MEMORY[0x277CD0960];
    v83 = *MEMORY[0x277CD09B0];
    v80 = *MEMORY[0x277CD0920];
    do
    {
      v84 = 0;
      do
      {
        if (*v102 != v75)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v101 + 1) + 8 * v84);
        v82 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v9];
        v85 = [(HMDHome *)self mediaProfileWithUUID:?];
        if (v85)
        {
          v78 = [v73 hmf_arrayForKey:v9];
          v10 = [HMDMediaPropertyRequest deserializeReadRequests:"deserializeReadRequests:mediaProfile:" mediaProfile:?];
          if (![v10 count])
          {
            goto LABEL_51;
          }

          mediaSession = [v85 mediaSession];
          accessory = [v85 accessory];
          v77 = v10;
          v74 = accessory;
          if (accessory)
          {
            identifier = [accessory identifier];
            v13 = [(HMDHome *)self mediaSessionStateWithIdentifier:identifier];

            if (!mediaSession && v13)
            {
              if ([(HMDHome *)self isCurrentDevicePrimaryResident])
              {
                v14 = objc_autoreleasePoolPush();
                selfCopy = self;
                v15 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
                {
                  v16 = HMFGetLogIdentifier();
                  accessory2 = [v85 accessory];
                  name = [accessory2 name];
                  *buf = 138543874;
                  v112 = v16;
                  v113 = 2112;
                  v114 = name;
                  v115 = 2112;
                  v116 = v9;
                  _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ has no session, returning local state", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v14);
                v13 = v13;
                v19 = v77;
                v68 = v19;
                if (self)
                {
                  v20 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v19, "count")}];
                  v21 = [MEMORY[0x277CBEAA8] now];
                  v108 = 0u;
                  v109 = 0u;
                  v106 = 0u;
                  v107 = 0u;
                  v22 = v68;
                  v23 = [v22 countByEnumeratingWithState:&v106 objects:buf count:16];
                  if (!v23)
                  {
                    goto LABEL_40;
                  }

                  v24 = *v107;
                  while (1)
                  {
                    for (i = 0; i != v23; ++i)
                    {
                      if (*v107 != v24)
                      {
                        objc_enumerationMutation(v22);
                      }

                      v26 = *(*(&v106 + 1) + 8 * i);
                      property = [v26 property];
                      v28 = [property isEqualToString:v89];

                      if (v28)
                      {
                        sessionIdentifier = [v13 sessionIdentifier];
                        v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                      }

                      else
                      {
                        property2 = [v26 property];
                        v32 = [property2 isEqualToString:v88];

                        if (v32)
                        {
                          sessionIdentifier = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "playbackState")}];
                          v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                        }

                        else
                        {
                          property3 = [v26 property];
                          v34 = [property3 isEqualToString:v87];

                          if (v34)
                          {
                            sessionIdentifier = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "shuffleState")}];
                            v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                          }

                          else
                          {
                            property4 = [v26 property];
                            v36 = [property4 isEqualToString:v86];

                            if (v36)
                            {
                              sessionIdentifier = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v13, "repeatState")}];
                              v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                            }

                            else
                            {
                              property5 = [v26 property];
                              if ([property5 isEqualToString:v83])
                              {
                                volume = [v13 volume];
                                v39 = volume == 0;

                                if (!v39)
                                {
                                  sessionIdentifier = [v13 volume];
                                  v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                                  goto LABEL_35;
                                }
                              }

                              else
                              {
                              }

                              property6 = [v26 property];
                              if (![property6 isEqualToString:v80])
                              {
                                goto LABEL_37;
                              }

                              mediaUniqueIdentifier = [v13 mediaUniqueIdentifier];
                              v42 = mediaUniqueIdentifier == 0;

                              if (v42)
                              {
                                continue;
                              }

                              sessionIdentifier = [v13 mediaUniqueIdentifier];
                              v30 = [HMDMediaPropertyResponse responseWithRequest:v26 value:sessionIdentifier updatedTime:v21];
                            }
                          }
                        }
                      }

LABEL_35:
                      property6 = v30;

                      if (!property6)
                      {
                        continue;
                      }

                      [v20 addObject:property6];
LABEL_37:
                    }

                    v23 = [v22 countByEnumeratingWithState:&v106 objects:buf count:16];
                    if (!v23)
                    {
LABEL_40:

                      v43 = [v20 copy];
                      goto LABEL_41;
                    }
                  }
                }

                v43 = 0;
LABEL_41:

                dispatch_group_enter(group);
                workQueue = [(HMDHome *)selfCopy workQueue];
                block[0] = MEMORY[0x277D85DD0];
                block[1] = 3221225472;
                block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke;
                block[3] = &unk_279734960;
                v98 = v70;
                v99 = v43;
                v100 = group;
                v45 = v43;
                dispatch_async(workQueue, block);

LABEL_50:
                v10 = v77;
LABEL_51:

                goto LABEL_52;
              }

LABEL_47:
              v52 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v54 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
              {
                v55 = HMFGetLogIdentifier();
                accessory3 = [v85 accessory];
                name2 = [accessory3 name];
                *buf = 138543874;
                v112 = v55;
                v113 = 2112;
                v114 = name2;
                v115 = 2112;
                v116 = v9;
                _os_log_impl(&dword_2531F8000, v54, OS_LOG_TYPE_INFO, "%{public}@Accessory with media profile %@/%@ not reachable for reading", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v52);
              v58 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v59 = [HMDMediaPropertyResponse propertyResponsesFromRequests:v77 error:v58];
              v60 = [HMDMediaPropertyResponse serializeResponses:v59];
              [v70 addEntriesFromDictionary:v60];

              goto LABEL_50;
            }
          }

          else
          {
            v13 = 0;
          }

          if (mediaSession)
          {
            dispatch_group_enter(group);
            v46 = objc_autoreleasePoolPush();
            selfCopy3 = self;
            v48 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
            {
              v49 = HMFGetLogIdentifier();
              accessory4 = [v85 accessory];
              name3 = [accessory4 name];
              *buf = 138544130;
              v112 = v49;
              v113 = 2112;
              v114 = name3;
              v115 = 2112;
              v116 = v9;
              v117 = 2112;
              v118 = mediaSession;
              _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Reading state for accessory with media profile %@/%@ from media session: %@", buf, 0x2Au);
            }

            objc_autoreleasePoolPop(v46);
            v93[0] = MEMORY[0x277D85DD0];
            v93[1] = 3221225472;
            v93[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_1992;
            v93[3] = &unk_2797353D0;
            objc_copyWeak(&v96, &location);
            v94 = group;
            v95 = v70;
            [mediaSession readProperties:v77 completion:v93];

            objc_destroyWeak(&v96);
            goto LABEL_50;
          }

          goto LABEL_47;
        }

LABEL_52:

        ++v84;
      }

      while (v84 != v76);
      v61 = [obj countByEnumeratingWithState:&v101 objects:v110 count:16];
      v76 = v61;
    }

    while (v61);
  }

  workQueue2 = [(HMDHome *)self workQueue];
  v90[0] = MEMORY[0x277D85DD0];
  v90[1] = 3221225472;
  v90[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3;
  v90[3] = &unk_279735738;
  v91 = v70;
  v92 = handlerCopy;
  v63 = v70;
  v64 = handlerCopy;
  dispatch_group_notify(group, workQueue2, v90);

  objc_destroyWeak(&location);
  v65 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_1992(id *a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2;
    block[3] = &unk_279734960;
    v8 = a1[5];
    v9 = v3;
    v10 = a1[4];
    dispatch_async(v6, block);
  }

  else
  {
    dispatch_group_leave(a1[4]);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_3(uint64_t a1)
{
  v1 = *(a1 + 40);
  if (v1)
  {
    v2 = [*(a1 + 32) copy];
    (*(v1 + 16))(v1, v2);
  }
}

void __71__HMDHome__handleReadMediaProperties_source_message_completionHandler___block_invoke_2(void *a1)
{
  v2 = a1[4];
  v3 = [HMDMediaPropertyResponse serializeResponses:a1[5]];
  [v2 addEntriesFromDictionary:v3];

  v4 = a1[6];

  dispatch_group_leave(v4);
}

- (void)redispatchMediaReadRequests:(id)requests viaDevice:(id)device completion:(id)completion
{
  v29[1] = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  deviceCopy = device;
  completionCopy = completion;
  v10 = [HMDMediaPropertyRequest serializeReadRequests:requestsCopy];
  if ([v10 count])
  {
    uuid = [(HMDHome *)self uuid];
    uUIDString = [uuid UUIDString];

    v13 = *MEMORY[0x277CD0640];
    v27[0] = @"kMediaPropertiesListKey";
    v27[1] = v13;
    v28[0] = v10;
    v28[1] = uUIDString;
    v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];
    v15 = MEMORY[0x277D0F848];
    messageDestination = [(HMDHome *)self messageDestination];
    v17 = [v15 messageWithName:@"kMediaPropertiesReadRequestKey" qualityOfService:33 destination:messageDestination payload:v14];

    objc_initWeak(&location, self);
    v22[0] = MEMORY[0x277D85DD0];
    v22[1] = 3221225472;
    v22[2] = __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke;
    v22[3] = &unk_279731AF8;
    objc_copyWeak(&v25, &location);
    v24 = completionCopy;
    v23 = requestsCopy;
    [v17 setResponseHandler:v22];
    uuid2 = [(HMDHome *)self uuid];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v17 target:uuid2 responseQueue:workQueue viaDevice:deviceCopy];

    objc_destroyWeak(&v25);
    objc_destroyWeak(&location);
LABEL_5:

    goto LABEL_6;
  }

  if (completionCopy)
  {
    uUIDString = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    v14 = [HMDMediaPropertyResponse propertyResponsesFromRequests:requestsCopy error:uUIDString];
    v29[0] = v14;
    v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v29 count:1];
    (*(completionCopy + 2))(completionCopy, v17);
    goto LABEL_5;
  }

LABEL_6:

  v20 = *MEMORY[0x277D85DE8];
}

void __60__HMDHome_redispatchMediaReadRequests_viaDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v13[1] = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v8 = *(a1 + 40);
    if (v5)
    {
      if (v8)
      {
        v9 = [HMDMediaPropertyResponse propertyResponsesFromRequests:*(a1 + 32) error:v5];
        v10 = *(a1 + 40);
        v13[0] = v9;
        v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
        (*(v10 + 16))(v10, v11);

LABEL_7:
      }
    }

    else if (v8)
    {
      v9 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v6 requests:*(a1 + 32) home:WeakRetained];
      (*(*(a1 + 40) + 16))();
      goto LABEL_7;
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeMediaSessionState:(id)state
{
  stateCopy = state;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessionStates containsObject:stateCopy])
  {
    [(NSMutableArray *)self->_mediaSessionStates removeObject:stateCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSessionState:(id)state
{
  stateCopy = state;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessionStates containsObject:stateCopy]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessionStates addObject:stateCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionStateWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  if ([identifierCopy hasPrefix:@"direct://"])
  {
    identifierCopy = identifierCopy;
    v6 = [identifierCopy substringFromIndex:8];
  }

  else
  {
    identifierCopy = [MEMORY[0x277CCACA8] stringWithFormat:@"direct://%@", identifierCopy];
    v6 = identifierCopy;
  }

  v7 = v6;
  mediaSessionStates = [(HMDHome *)self mediaSessionStates];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke;
  v13[3] = &unk_279722E28;
  v14 = identifierCopy;
  v15 = v7;
  v9 = v7;
  v10 = identifierCopy;
  v11 = [mediaSessionStates na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __43__HMDHome_mediaSessionStateWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 sessionIdentifier];
  if ([v4 isEqualToString:*(a1 + 32)])
  {
    v5 = 1;
  }

  else
  {
    v6 = [v3 sessionIdentifier];
    v5 = [v6 isEqualToString:*(a1 + 40)];
  }

  return v5;
}

- (NSArray)mediaSessionStates
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessionStates copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeMediaSession:(id)session
{
  sessionCopy = session;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_mediaSessions containsObject:sessionCopy])
  {
    [(NSMutableArray *)self->_mediaSessions removeObject:sessionCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addMediaSession:(id)session
{
  sessionCopy = session;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_mediaSessions containsObject:sessionCopy]& 1) == 0)
  {
    [(NSMutableArray *)self->_mediaSessions addObject:sessionCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (id)mediaSessionWithUUID:(id)d
{
  dCopy = d;
  mediaSessions = [(HMDHome *)self mediaSessions];
  v6 = [mediaSessions hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)mediaSessionWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  mediaSessions = [(HMDHome *)self mediaSessions];
  v6 = [mediaSessions hmf_firstObjectWithValue:identifierCopy forKeyPath:@"sessionIdentifier"];

  return v6;
}

- (NSArray)mediaSessions
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_mediaSessions copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)migrateAfterCloudMerge:(id)merge
{
  mergeCopy = merge;
  [(HMDHome *)self setMigrationNeeded:0];
  if ([(HMDHome *)self isOwnerUser])
  {
    array = [MEMORY[0x277CBEB18] array];
    array2 = [MEMORY[0x277CBEB18] array];
    v7 = HMDispatchQueueNameString();
    uTF8String = [v7 UTF8String];
    v9 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
    v10 = dispatch_queue_create(uTF8String, v9);

    v11 = dispatch_group_create();
    objc_initWeak(location, self);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke;
    aBlock[3] = &unk_279732670;
    objc_copyWeak(&v42, location);
    v12 = array;
    v40 = v12;
    v13 = array2;
    v41 = v13;
    v14 = _Block_copy(aBlock);
    dispatch_group_enter(v11);
    v34[0] = MEMORY[0x277D85DD0];
    v34[1] = 3221225472;
    v34[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_4;
    v34[3] = &unk_27972A0E0;
    objc_copyWeak(&v38, location);
    v15 = v12;
    v35 = v15;
    v16 = v13;
    v36 = v16;
    v17 = v11;
    v37 = v17;
    [(HMDHome *)self _migrateHomeSettingsCloudZone:mergeCopy migrationQueue:v10 completion:v34];
    dispatch_group_enter(v17);
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_5;
    v29[3] = &unk_27972A0E0;
    objc_copyWeak(&v33, location);
    v18 = v15;
    v30 = v18;
    v19 = v16;
    v31 = v19;
    v20 = v17;
    v32 = v20;
    [(HMDHome *)self _migrateHomeMediaSettingsCloudZone:mergeCopy migrationQueue:v10 completion:v29];
    dispatch_group_enter(v20);
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_6;
    v24[3] = &unk_27972A0E0;
    objc_copyWeak(&v28, location);
    v21 = v18;
    v25 = v21;
    v22 = v19;
    v26 = v22;
    v23 = v20;
    v27 = v23;
    [(HMDHome *)self _migrateHomeUsersCloudZone:mergeCopy migrationQueue:v10 completion:v24];
    dispatch_group_notify(v23, v10, v14);

    objc_destroyWeak(&v28);
    objc_destroyWeak(&v33);

    objc_destroyWeak(&v38);
    objc_destroyWeak(&v42);
    objc_destroyWeak(location);
  }
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke(id *a1)
{
  v1 = a1;
  v67 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v37 = WeakRetained;
    v39 = v1;
    if ([v1[4] count])
    {
      v3 = objc_autoreleasePoolPush();
      v43 = WeakRetained;
      v4 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        v5 = HMFGetLogIdentifier();
        *buf = 138543362;
        v61 = v5;
        _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@General Merge Migrating (Save Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v3);
      v6 = [v43 backingStore];
      v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v45 = [v6 transaction:@"generalMergeHomeSaveMigration" options:v7];

      v57 = 0u;
      v58 = 0u;
      v55 = 0u;
      v56 = 0u;
      obj = v39[4];
      v8 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
      if (v8)
      {
        v9 = *v56;
        do
        {
          for (i = 0; i != v8; ++i)
          {
            if (*v56 != v9)
            {
              objc_enumerationMutation(obj);
            }

            v11 = *(*(&v55 + 1) + 8 * i);
            v12 = objc_autoreleasePoolPush();
            v13 = v43;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              v16 = [v13 uuid];
              v17 = [v16 UUIDString];
              *buf = 138543874;
              v61 = v15;
              v62 = 2112;
              v63 = v17;
              v64 = 2112;
              v65 = v11;
              _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@[General Merge Home Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v12);
            [v45 add:v11 withMessage:0];
          }

          v8 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
        }

        while (v8);
      }

      v18 = [v43 metricsDispatcher];
      [v18 submitMigrationEventMetricsForModels:v39[4] reason:@"generalMergeHomeSaveMigration"];

      v1 = v39;
    }

    else
    {
      v45 = 0;
    }

    if ([v1[5] count])
    {
      v19 = objc_autoreleasePoolPush();
      obja = v38;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543362;
        v61 = v21;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@General Merge New Object Migrating (Run Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v19);
      v22 = [obja backingStore];
      v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v44 = [v22 transaction:@"generalMergeHomeRunNewObjectMigration" options:v23];

      v54 = 0u;
      v52 = 0u;
      v53 = 0u;
      v51 = 0u;
      v40 = v39[5];
      v24 = [v40 countByEnumeratingWithState:&v51 objects:v59 count:16];
      if (v24)
      {
        v25 = *v52;
        do
        {
          for (j = 0; j != v24; ++j)
          {
            if (*v52 != v25)
            {
              objc_enumerationMutation(v40);
            }

            v27 = *(*(&v51 + 1) + 8 * j);
            v28 = objc_autoreleasePoolPush();
            v29 = obja;
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
            {
              v31 = HMFGetLogIdentifier();
              v32 = [v29 uuid];
              v33 = [v32 UUIDString];
              *buf = 138543874;
              v61 = v31;
              v62 = 2112;
              v63 = v33;
              v64 = 2112;
              v65 = v27;
              _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEBUG, "%{public}@[General Merge Home New Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v28);
            [v44 add:v27 withMessage:0];
          }

          v24 = [v40 countByEnumeratingWithState:&v51 objects:v59 count:16];
        }

        while (v24);
      }

      v34 = [obja metricsDispatcher];
      [v34 submitMigrationEventMetricsForModels:v39[5] reason:@"generalMergeHomeRunNewObjectMigration"];

      if (!v45)
      {
        if (v44)
        {
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v46[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_3;
          v46[3] = &unk_279734708;
          v35 = &v47;
          objc_copyWeak(&v47, v39 + 6);
          [v44 run:v46];
LABEL_34:
          objc_destroyWeak(v35);
        }

LABEL_35:

        WeakRetained = v38;
        goto LABEL_36;
      }
    }

    else
    {
      if (!v45)
      {
        goto LABEL_35;
      }

      v44 = 0;
    }

    v48[0] = MEMORY[0x277D85DD0];
    v48[1] = 3221225472;
    v48[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_1981;
    v48[3] = &unk_2797338E8;
    v35 = &v50;
    objc_copyWeak(&v50, v39 + 6);
    v44 = v44;
    v49 = v44;
    [v45 save:v48];

    goto LABEL_34;
  }

LABEL_36:

  v36 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_4(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_5(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_6(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_1981(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = WeakRetained;
  v6 = *(a1 + 32);
  if (v6)
  {
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __34__HMDHome_migrateAfterCloudMerge___block_invoke_2;
    v9[3] = &unk_279734708;
    objc_copyWeak(&v10, (a1 + 40));
    [v6 run:v9];
    objc_destroyWeak(&v10);
  }

  else
  {
    v7 = [WeakRetained homeManager];
    v8 = [v5 zoneID];
    [v7 uploadHomeToCloudZone:v8 withDelay:0.0];
  }
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

void __34__HMDHome_migrateAfterCloudMerge___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

- (void)migrateCloudZone:(id)zone completion:(id)completion
{
  zoneCopy = zone;
  completionCopy = completion;
  [(HMDHome *)self setMigrationNeeded:0];
  if ([(HMDHome *)self isOwnerUser])
  {
    array = [MEMORY[0x277CBEB18] array];
    array2 = [MEMORY[0x277CBEB18] array];
    [(HMDHome *)self setupBackingStore];
    v10 = HMDispatchQueueNameString();
    uTF8String = [v10 UTF8String];
    v12 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
    v13 = dispatch_queue_create(uTF8String, v12);

    v14 = dispatch_group_create();
    objc_initWeak(location, self);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke;
    aBlock[3] = &unk_279733CA8;
    objc_copyWeak(&v38, location);
    v15 = completionCopy;
    v37 = v15;
    v16 = array;
    v35 = v16;
    v17 = array2;
    v36 = v17;
    v18 = _Block_copy(aBlock);
    v25[0] = MEMORY[0x277D85DD0];
    v25[1] = 3221225472;
    v25[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_4;
    v25[3] = &unk_279722E00;
    objc_copyWeak(&v33, location);
    v31 = v15;
    v24 = zoneCopy;
    v26 = zoneCopy;
    v19 = v14;
    v27 = v19;
    v20 = v13;
    v28 = v20;
    v21 = v16;
    v29 = v21;
    v22 = v17;
    v30 = v22;
    v23 = v18;
    v32 = v23;
    [(HMDHome *)self fetchAllMigratedObjectsForCloudZone:v26 completion:v25];

    objc_destroyWeak(&v33);
    objc_destroyWeak(&v38);
    objc_destroyWeak(location);

    zoneCopy = v24;
  }

  else if (completionCopy)
  {
    (*(completionCopy + 2))(completionCopy, 0);
  }
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke(id *a1)
{
  v1 = a1;
  v70 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  if (WeakRetained)
  {
    v39 = WeakRetained;
    v41 = v1;
    if ([v1[4] count])
    {
      v3 = objc_autoreleasePoolPush();
      v45 = WeakRetained;
      v4 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        v5 = HMFGetLogIdentifier();
        *buf = 138543362;
        v64 = v5;
        _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@General Migrating (Save Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v3);
      v6 = [v45 backingStore];
      v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v47 = [v6 transaction:@"generalHomeSaveMigration" options:v7];

      v60 = 0u;
      v61 = 0u;
      v58 = 0u;
      v59 = 0u;
      obj = v41[4];
      v8 = [obj countByEnumeratingWithState:&v58 objects:v69 count:16];
      if (v8)
      {
        v9 = *v59;
        do
        {
          for (i = 0; i != v8; ++i)
          {
            if (*v59 != v9)
            {
              objc_enumerationMutation(obj);
            }

            v11 = *(*(&v58 + 1) + 8 * i);
            v12 = objc_autoreleasePoolPush();
            v13 = v45;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              v16 = [v13 uuid];
              v17 = [v16 UUIDString];
              *buf = 138543874;
              v64 = v15;
              v65 = 2112;
              v66 = v17;
              v67 = 2112;
              v68 = v11;
              _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@[General Home Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v12);
            [v47 add:v11 withMessage:0];
          }

          v8 = [obj countByEnumeratingWithState:&v58 objects:v69 count:16];
        }

        while (v8);
      }

      v18 = [v45 metricsDispatcher];
      [v18 submitMigrationEventMetricsForModels:v41[4] reason:@"generalHomeSaveMigration"];

      v1 = v41;
    }

    else
    {
      v47 = 0;
    }

    if ([v1[5] count])
    {
      v20 = objc_autoreleasePoolPush();
      obja = v40;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543362;
        v64 = v22;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@General New Object Migrating (Run Transactions)", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v23 = [obja backingStore];
      v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v46 = [v23 transaction:@"generalHomeRunNewObjectMigration" options:v24];

      v56 = 0u;
      v57 = 0u;
      v54 = 0u;
      v55 = 0u;
      v42 = v41[5];
      v25 = [v42 countByEnumeratingWithState:&v54 objects:v62 count:16];
      if (v25)
      {
        v26 = *v55;
        do
        {
          for (j = 0; j != v25; ++j)
          {
            if (*v55 != v26)
            {
              objc_enumerationMutation(v42);
            }

            v28 = *(*(&v54 + 1) + 8 * j);
            v29 = objc_autoreleasePoolPush();
            v30 = obja;
            v31 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
            {
              v32 = HMFGetLogIdentifier();
              v33 = [v30 uuid];
              v34 = [v33 UUIDString];
              *buf = 138543874;
              v64 = v32;
              v65 = 2112;
              v66 = v34;
              v67 = 2112;
              v68 = v28;
              _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEBUG, "%{public}@[General Home New Migration %@] Object Change: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v29);
            [v46 add:v28 withMessage:0];
          }

          v25 = [v42 countByEnumeratingWithState:&v54 objects:v62 count:16];
        }

        while (v25);
      }

      v35 = [obja metricsDispatcher];
      [v35 submitMigrationEventMetricsForModels:v41[5] reason:@"generalHomeRunNewObjectMigration"];

      if (v47)
      {
        v36 = v41;
LABEL_33:
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_1964;
        v50[3] = &unk_2797346E0;
        objc_copyWeak(&v53, v36 + 7);
        v46 = v46;
        v51 = v46;
        v52 = v41[6];
        [v47 save:v50];

        objc_destroyWeak(&v53);
LABEL_39:

        WeakRetained = v40;
        goto LABEL_40;
      }

      v36 = v41;
      if (v46)
      {
        v48[0] = MEMORY[0x277D85DD0];
        v48[1] = 3221225472;
        v48[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_3;
        v48[3] = &unk_279734708;
        objc_copyWeak(&v49, v41 + 7);
        [v46 run:v48];
        objc_destroyWeak(&v49);
        v36 = v41;
      }

      else
      {
        v46 = 0;
      }
    }

    else
    {
      v46 = 0;
      v36 = v41;
      if (v47)
      {
        goto LABEL_33;
      }
    }

    v37 = v36[6];
    if (v37)
    {
      v37[2](v37, 0);
    }

    goto LABEL_39;
  }

  v19 = v1[6];
  if (v19)
  {
    v19[2](v19, 0);
  }

LABEL_40:

  v38 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_4(uint64_t a1, void *a2, void *a3)
{
  v96 = *MEMORY[0x277D85DE8];
  v47 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  v7 = WeakRetained;
  v46 = v5;
  if (WeakRetained)
  {
    v48 = a1;
    v49 = WeakRetained;
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = v49;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v90 = v11;
        v91 = 2112;
        v92 = v46;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Unable to fetch migration changes in this house because of error (%@).", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
    }

    if (![v47 count])
    {
      goto LABEL_20;
    }

    v12 = objc_autoreleasePoolPush();
    v52 = v49;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v90 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@General Object Migrating (Run Transactions)", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v15 = [v52 backingStore];
    v16 = +[HMDBackingStoreTransactionOptions defaultCloudOptions];
    v51 = [v15 transaction:@"generalHomeRunObjectMigration" options:v16];

    v87 = 0u;
    v88 = 0u;
    v85 = 0u;
    v86 = 0u;
    obj = v47;
    v17 = [obj countByEnumeratingWithState:&v85 objects:v95 count:16];
    if (v17)
    {
      v18 = *v86;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v86 != v18)
          {
            objc_enumerationMutation(obj);
          }

          v20 = *(*(&v85 + 1) + 8 * i);
          v21 = objc_autoreleasePoolPush();
          v22 = v52;
          v23 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
          {
            v24 = HMFGetLogIdentifier();
            v25 = [v22 uuid];
            v26 = [v25 UUIDString];
            *buf = 138543874;
            v90 = v24;
            v91 = 2112;
            v92 = v26;
            v93 = 2112;
            v94 = v20;
            _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_DEBUG, "%{public}@[General Home Migration %@] Object Change: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v21);
          [v51 add:v20 withMessage:0];
        }

        v17 = [obj countByEnumeratingWithState:&v85 objects:v95 count:16];
      }

      while (v17);
    }

    if (v51)
    {
      v78[0] = MEMORY[0x277D85DD0];
      v78[1] = 3221225472;
      v78[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_1968;
      v78[3] = &unk_279722DD8;
      objc_copyWeak(&v84, v48 + 11);
      v82 = v48[9];
      v27 = v48[4];
      v28 = v48[5];
      v29 = v48[6];
      v30 = v48[7];
      *&v31 = v29;
      *(&v31 + 1) = v30;
      *&v32 = v27;
      *(&v32 + 1) = v28;
      v79 = v32;
      v80 = v31;
      v81 = v48[8];
      v83 = v48[10];
      [v51 run:v78];

      objc_destroyWeak(&v84);
    }

    else
    {
LABEL_20:
      dispatch_group_enter(v48[5]);
      v33 = v48[4];
      v34 = v48[6];
      v73[0] = MEMORY[0x277D85DD0];
      v73[1] = 3221225472;
      v73[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_7;
      v73[3] = &unk_27972A0E0;
      objc_copyWeak(&v77, v48 + 11);
      v74 = v48[7];
      v75 = v48[8];
      v76 = v48[5];
      [v49 _migrateResidentDevicesCloudZone:v33 migrationQueue:v34 completion:v73];
      dispatch_group_enter(v48[5]);
      v35 = v48[4];
      v36 = v48[6];
      v68[0] = MEMORY[0x277D85DD0];
      v68[1] = 3221225472;
      v68[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_8;
      v68[3] = &unk_27972A0E0;
      objc_copyWeak(&v72, v48 + 11);
      v69 = v48[7];
      v70 = v48[8];
      v71 = v48[5];
      [v49 _migrateHomeSettingsCloudZone:v35 migrationQueue:v36 completion:v68];
      dispatch_group_enter(v48[5]);
      v37 = v48[4];
      v38 = v48[6];
      v63[0] = MEMORY[0x277D85DD0];
      v63[1] = 3221225472;
      v63[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_9;
      v63[3] = &unk_27972A0E0;
      objc_copyWeak(&v67, v48 + 11);
      v64 = v48[7];
      v65 = v48[8];
      v66 = v48[5];
      [v49 _migrateHomeMediaSettingsCloudZone:v37 migrationQueue:v38 completion:v63];
      dispatch_group_enter(v48[5]);
      v39 = v48[4];
      v40 = v48[6];
      v58[0] = MEMORY[0x277D85DD0];
      v58[1] = 3221225472;
      v58[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_10;
      v58[3] = &unk_27972A0E0;
      objc_copyWeak(&v62, v48 + 11);
      v59 = v48[7];
      v60 = v48[8];
      v61 = v48[5];
      [v49 _migrateHomeUsersCloudZone:v39 migrationQueue:v40 completion:v58];
      dispatch_group_enter(v48[5]);
      v41 = v48[4];
      v42 = v48[6];
      v53[0] = MEMORY[0x277D85DD0];
      v53[1] = 3221225472;
      v53[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_11;
      v53[3] = &unk_27972A0E0;
      objc_copyWeak(&v57, v48 + 11);
      v43 = v48;
      v54 = v48[7];
      v55 = v48[8];
      v56 = v48[5];
      [v49 _migrateAppleMediaAccessoriesWithCloudZone:v41 migrationQueue:v42 completion:v53];
      [v49 _migrateHomeAllObjectsCloudZone:v43[4] migrationGroup:v43[5] migrationQueue:v43[6] saveModels:v43[7] runModels:v43[8]];
      dispatch_group_notify(v43[5], v43[6], v43[10]);

      objc_destroyWeak(&v57);
      objc_destroyWeak(&v62);

      objc_destroyWeak(&v67);
      objc_destroyWeak(&v72);

      objc_destroyWeak(&v77);
    }

    v7 = v49;
  }

  else
  {
    v44 = *(a1 + 72);
    if (v44)
    {
      (*(v44 + 16))(v44, 0);
    }
  }

  v45 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_1968(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  if (WeakRetained)
  {
    [*(a1 + 32) markMigratedObjectsAsMigrated];
    dispatch_group_enter(*(a1 + 40));
    v5 = *(a1 + 32);
    v6 = *(a1 + 48);
    v36[0] = MEMORY[0x277D85DD0];
    v36[1] = 3221225472;
    v36[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_2_1969;
    v36[3] = &unk_27972A0E0;
    objc_copyWeak(v40, (a1 + 88));
    v37 = *(a1 + 56);
    v38 = *(a1 + 64);
    v39 = *(a1 + 40);
    [WeakRetained _migrateResidentDevicesCloudZone:v5 migrationQueue:v6 completion:v36];
    dispatch_group_enter(*(a1 + 40));
    v7 = *(a1 + 32);
    v8 = *(a1 + 48);
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_3_1970;
    v31[3] = &unk_27972A0E0;
    objc_copyWeak(&v35, (a1 + 88));
    v32 = *(a1 + 56);
    v33 = *(a1 + 64);
    v34 = *(a1 + 40);
    [WeakRetained _migrateHomeSettingsCloudZone:v7 migrationQueue:v8 completion:v31];
    dispatch_group_enter(*(a1 + 40));
    v9 = *(a1 + 32);
    v10 = *(a1 + 48);
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_4_1971;
    v26[3] = &unk_27972A0E0;
    objc_copyWeak(&v30, (a1 + 88));
    v27 = *(a1 + 56);
    v28 = *(a1 + 64);
    v29 = *(a1 + 40);
    [WeakRetained _migrateHomeMediaSettingsCloudZone:v9 migrationQueue:v10 completion:v26];
    dispatch_group_enter(*(a1 + 40));
    v11 = *(a1 + 32);
    v12 = *(a1 + 48);
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_5;
    v21[3] = &unk_27972A0E0;
    objc_copyWeak(&v25, (a1 + 88));
    v22 = *(a1 + 56);
    v23 = *(a1 + 64);
    v24 = *(a1 + 40);
    [WeakRetained _migrateHomeUsersCloudZone:v11 migrationQueue:v12 completion:v21];
    dispatch_group_enter(*(a1 + 40));
    v13 = *(a1 + 32);
    v14 = *(a1 + 48);
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_6;
    v16[3] = &unk_27972A0E0;
    objc_copyWeak(&v20, (a1 + 88));
    v17 = *(a1 + 56);
    v18 = *(a1 + 64);
    v19 = *(a1 + 40);
    [WeakRetained _migrateAppleMediaAccessoriesWithCloudZone:v13 migrationQueue:v14 completion:v16];
    [WeakRetained _migrateHomeAllObjectsCloudZone:*(a1 + 32) migrationGroup:*(a1 + 40) migrationQueue:*(a1 + 48) saveModels:*(a1 + 56) runModels:*(a1 + 64)];
    dispatch_group_notify(*(a1 + 40), *(a1 + 48), *(a1 + 80));

    objc_destroyWeak(&v20);
    objc_destroyWeak(&v25);

    objc_destroyWeak(&v30);
    objc_destroyWeak(&v35);

    objc_destroyWeak(v40);
  }

  else
  {
    v15 = *(a1 + 72);
    if (v15)
    {
      (*(v15 + 16))(v15, 0);
    }
  }
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_7(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_8(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_9(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_10(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_11(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_2_1969(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_3_1970(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_4_1971(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_5(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_6(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_1964(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = WeakRetained;
  v6 = *(a1 + 32);
  if (v6)
  {
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __39__HMDHome_migrateCloudZone_completion___block_invoke_2;
    v10[3] = &unk_279734708;
    objc_copyWeak(&v11, (a1 + 48));
    [v6 run:v10];
    objc_destroyWeak(&v11);
  }

  else
  {
    v7 = [WeakRetained homeManager];
    v8 = [v5 zoneID];
    [v7 uploadHomeToCloudZone:v8 withDelay:0.0];
  }

  v9 = *(a1 + 40);
  if (v9)
  {
    (*(v9 + 16))(v9, 0);
  }
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

void __39__HMDHome_migrateCloudZone_completion___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained homeManager];
  v2 = [WeakRetained zoneID];
  [v1 uploadHomeToCloudZone:v2 withDelay:0.0];
}

- (void)fetchAllMigratedObjectsForCloudZone:(id)zone completion:(id)completion
{
  zoneCopy = zone;
  completionCopy = completion;
  v41[0] = 0;
  v41[1] = v41;
  v41[2] = 0x3032000000;
  v41[3] = __Block_byref_object_copy__10664;
  v41[4] = __Block_byref_object_dispose__10665;
  array = [MEMORY[0x277CBEB18] array];
  v39[0] = 0;
  v39[1] = v39;
  v39[2] = 0x3032000000;
  v39[3] = __Block_byref_object_copy__10664;
  v39[4] = __Block_byref_object_dispose__10665;
  v40 = [MEMORY[0x277CBEB58] set];
  v37[0] = 0;
  v37[1] = v37;
  v37[2] = 0x3032000000;
  v37[3] = __Block_byref_object_copy__10664;
  v37[4] = __Block_byref_object_dispose__10665;
  array2 = [MEMORY[0x277CBEB18] array];
  v35[0] = 0;
  v35[1] = v35;
  v35[2] = 0x3032000000;
  v35[3] = __Block_byref_object_copy__10664;
  v35[4] = __Block_byref_object_dispose__10665;
  v36 = 0;
  v8 = HMDispatchQueueNameString();
  uTF8String = [v8 UTF8String];
  v10 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v11 = dispatch_queue_create(uTF8String, v10);

  v12 = dispatch_group_create();
  dispatch_group_enter(v12);
  objc_initWeak(&location, self);
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke;
  v27[3] = &unk_279722D60;
  objc_copyWeak(&v33, &location);
  v29 = v35;
  v13 = v12;
  v28 = v13;
  v30 = v41;
  v31 = v39;
  v32 = v37;
  [zoneCopy fetchMigratedObjects:v27];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_1954;
  block[3] = &unk_279722DB0;
  v22 = v37;
  v23 = v41;
  v24 = v35;
  block[4] = self;
  v19 = zoneCopy;
  v14 = completionCopy;
  v20 = v11;
  v21 = completionCopy;
  v15 = v11;
  v16 = zoneCopy;
  v17 = v14;
  objc_copyWeak(&v26, &location);
  v25 = v39;
  dispatch_group_notify(v13, v15, block);
  objc_destroyWeak(&v26);

  objc_destroyWeak(&v33);
  objc_destroyWeak(&location);

  _Block_object_dispose(v35, 8);
  _Block_object_dispose(v37, 8);

  _Block_object_dispose(v39, 8);
  _Block_object_dispose(v41, 8);
}

void __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v53 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  v8 = WeakRetained;
  if (v6 || !WeakRetained)
  {
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a3);
  }

  else if ([v5 count])
  {
    v9 = objc_autoreleasePoolPush();
    v43 = v8;
    v10 = v8;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v52 = v12;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Found General Objects to Migrate", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [MEMORY[0x277CBEB18] array];
    v14 = *(*(a1 + 48) + 8);
    v15 = *(v14 + 40);
    *(v14 + 40) = v13;

    v16 = [MEMORY[0x277CBEB58] set];
    v17 = *(*(a1 + 56) + 8);
    v18 = *(v17 + 40);
    *(v17 + 40) = v16;

    v19 = [MEMORY[0x277CBEB18] array];
    v20 = *(*(a1 + 64) + 8);
    v21 = *(v20 + 40);
    *(v20 + 40) = v19;

    v48 = 0u;
    v49 = 0u;
    v46 = 0u;
    v47 = 0u;
    v44 = v5;
    obj = v5;
    v22 = [obj countByEnumeratingWithState:&v46 objects:v50 count:16];
    if (v22)
    {
      v23 = v22;
      v24 = *v47;
      do
      {
        for (i = 0; i != v23; ++i)
        {
          if (*v47 != v24)
          {
            objc_enumerationMutation(obj);
          }

          v26 = *(*(&v46 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v27 = v26;
          }

          else
          {
            v27 = 0;
          }

          v28 = v27;

          if (v28)
          {
            v29 = [v28 uuid];
            v30 = [v10 accessoryWithUUID:v29];

            if (!v30)
            {
              v31 = *(*(*(a1 + 64) + 8) + 40);
              v32 = [v28 uuid];
              [v31 addObject:v32];
            }
          }

          v33 = v26;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v34 = v33;
          }

          else
          {
            v34 = 0;
          }

          v35 = v34;

          if (v35)
          {
            v36 = [v35 uuid];
            v37 = [v10 accessoryWithUUID:v36];

            if (!v37)
            {
              v38 = *(*(*(a1 + 64) + 8) + 40);
              v39 = [v35 uuid];
              [v38 addObject:v39];
            }
          }

          [*(*(*(a1 + 48) + 8) + 40) addObject:{v33, v43}];
          v40 = *(*(*(a1 + 56) + 8) + 40);
          v41 = [v33 uuid];
          [v40 addObject:v41];
        }

        v23 = [obj countByEnumeratingWithState:&v46 objects:v50 count:16];
      }

      while (v23);
    }

    v6 = 0;
    v5 = v44;
    v8 = v43;
  }

  dispatch_group_leave(*(a1 + 32));

  v42 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_1954(uint64_t a1)
{
  if ([*(*(*(a1 + 64) + 8) + 40) count])
  {
    v2 = *(a1 + 32);
    v3 = *(a1 + 40);
    v4 = *(*(*(a1 + 64) + 8) + 40);
    v5 = *(a1 + 48);
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_2;
    v12[3] = &unk_279722D88;
    objc_copyWeak(&v17, (a1 + 96));
    v6 = *(a1 + 72);
    v14 = *(a1 + 88);
    v15 = v6;
    v7 = *(a1 + 56);
    v8 = *(a1 + 80);
    v13 = v7;
    v16 = v8;
    [v2 _migrateUnknownAccessoriesWithCloudZone:v3 accessoryUUIDs:v4 migrationQueue:v5 completion:v12];

    objc_destroyWeak(&v17);
  }

  else
  {
    v9 = *(*(*(a1 + 72) + 8) + 40);
    v10 = *(*(*(a1 + 80) + 8) + 40);
    v11 = *(*(a1 + 56) + 16);

    v11();
  }
}

void __58__HMDHome_fetchAllMigratedObjectsForCloudZone_completion___block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v7 = WeakRetained;
  if (!a3 && WeakRetained)
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v8 = v5;
    v9 = [v8 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v22;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v22 != v11)
          {
            objc_enumerationMutation(v8);
          }

          v13 = *(*(&v21 + 1) + 8 * i);
          v14 = *(*(*(a1 + 40) + 8) + 40);
          v15 = [v13 uuid];
          LOBYTE(v14) = [v14 containsObject:v15];

          if ((v14 & 1) == 0)
          {
            [*(*(*(a1 + 48) + 8) + 40) addObject:v13];
            v16 = *(*(*(a1 + 40) + 8) + 40);
            v17 = [v13 uuid];
            [v16 addObject:v17];
          }
        }

        v10 = [v8 countByEnumeratingWithState:&v21 objects:v25 count:16];
      }

      while (v10);
    }
  }

  v18 = *(*(*(a1 + 48) + 8) + 40);
  v19 = *(*(*(a1 + 56) + 8) + 40);
  (*(*(a1 + 32) + 16))();

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_migrateUnknownAccessoriesWithCloudZone:(id)zone accessoryUUIDs:(id)ds migrationQueue:(id)queue completion:(id)completion
{
  v40 = *MEMORY[0x277D85DE8];
  zoneCopy = zone;
  dsCopy = ds;
  queue = queue;
  completionCopy = completion;
  array = [MEMORY[0x277CBEB18] array];
  v11 = HMDispatchQueueNameString();
  uTF8String = [v11 UTF8String];
  v13 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v14 = dispatch_queue_create(uTF8String, v13);

  v15 = dispatch_group_create();
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  obj = dsCopy;
  v16 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v36;
    do
    {
      v19 = 0;
      do
      {
        if (*v36 != v18)
        {
          objc_enumerationMutation(obj);
        }

        v20 = *(*(&v35 + 1) + 8 * v19);
        dispatch_group_enter(v15);
        v31[0] = MEMORY[0x277D85DD0];
        v31[1] = 3221225472;
        v31[2] = __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke;
        v31[3] = &unk_279733F88;
        v32 = v14;
        v33 = array;
        v34 = v15;
        [zoneCopy allDescendentsCloudRecordsForParentID:v20 completionHandler:v31];

        ++v19;
      }

      while (v17 != v19);
      v17 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
    }

    while (v17);
  }

  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke_3;
  block[3] = &unk_279735738;
  v29 = array;
  v30 = completionCopy;
  v21 = array;
  v22 = completionCopy;
  dispatch_group_notify(v15, queue, block);

  v23 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v5, "count")}];
  if (!a3)
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v7 = v5;
    v8 = [v7 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v22;
      do
      {
        v11 = 0;
        do
        {
          if (*v22 != v10)
          {
            objc_enumerationMutation(v7);
          }

          v12 = [*(*(&v21 + 1) + 8 * v11) extractObjectChange];
          v13 = v12;
          if (v12)
          {
            [v12 setObjectChangeType:1];
            [v6 addObject:v13];
          }

          ++v11;
        }

        while (v9 != v11);
        v9 = [v7 countByEnumeratingWithState:&v21 objects:v25 count:16];
      }

      while (v9);
    }
  }

  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke_2;
  block[3] = &unk_279734960;
  v14 = *(a1 + 32);
  v18 = *(a1 + 40);
  v19 = v6;
  v20 = *(a1 + 48);
  v15 = v6;
  dispatch_async(v14, block);

  v16 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome__migrateUnknownAccessoriesWithCloudZone_accessoryUUIDs_migrationQueue_completion___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) addObjectsFromArray:*(a1 + 40)];
  v2 = *(a1 + 48);

  dispatch_group_leave(v2);
}

- (void)_migrateHomeAllObjectsCloudZone:(id)zone migrationGroup:(id)group migrationQueue:(id)queue saveModels:(id)models runModels:(id)runModels
{
  v90 = *MEMORY[0x277D85DE8];
  zoneCopy = zone;
  groupCopy = group;
  queueCopy = queue;
  modelsCopy = models;
  runModelsCopy = runModels;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke;
  aBlock[3] = &unk_279722D10;
  v65 = queueCopy;
  v79 = v65;
  objc_copyWeak(&v83, &location);
  v64 = modelsCopy;
  v80 = v64;
  v66 = runModelsCopy;
  v81 = v66;
  v17 = groupCopy;
  v82 = v17;
  v18 = _Block_copy(aBlock);
  v73[0] = MEMORY[0x277D85DD0];
  v73[1] = 3221225472;
  v73[2] = __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_3;
  v73[3] = &unk_279722D38;
  group = v17;
  groupCopy2 = group;
  selfCopy = self;
  v63 = zoneCopy;
  v76 = v63;
  v68 = v18;
  v77 = v68;
  v69 = _Block_copy(v73);
  uuid = [(HMDHome *)self uuid];
  v20 = [HMDHomeNetworkRouterManagingDeviceSettingsModel defaultModelForHomeUUID:uuid];
  v69[2](v69, v20);

  uuid2 = [(HMDHome *)self uuid];
  v70 = [HMDHomeNetworkRouterSettingsModel defaultModelForHomeUUID:uuid2];

  activeNetworkRouterUUID = [(HMDHome *)self activeNetworkRouterUUID];
  uUIDString = [activeNetworkRouterUUID UUIDString];
  [v70 setActiveNetworkRouterAccessoryUUID:uUIDString];

  minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
  versionString = [minimumNetworkRouterSupportHomeKitVersion versionString];
  [v70 setMinimumNetworkRouterSupportHomeKitVersion:versionString];

  minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHome *)self minHomeKitVersionForAccessoryNetworkProtectionChange];
  versionString2 = [minHomeKitVersionForAccessoryNetworkProtectionChange versionString];
  [v70 setMinHomeKitVersionForAccessoryNetworkProtectionChange:versionString2];

  v69[2](v69, v70);
  v28 = MEMORY[0x277CBEB18];
  accessories = [(HMDHome *)self accessories];
  v30 = [v28 arrayWithCapacity:{objc_msgSend(accessories, "count")}];

  selfCopy2 = self;
  v71 = v30;
  v72 = selfCopy2;
  v85 = 0u;
  v86 = 0u;
  v87 = 0u;
  v88 = 0u;
  accessories2 = [(HMDHome *)selfCopy2 accessories];
  v33 = [accessories2 countByEnumeratingWithState:&v85 objects:v89 count:16];
  if (v33)
  {
    v34 = *v86;
    do
    {
      v35 = 0;
      do
      {
        if (*v86 != v34)
        {
          objc_enumerationMutation(accessories2);
        }

        v36 = *(*(&v85 + 1) + 8 * v35);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v37 = v36;
        }

        else
        {
          v37 = 0;
        }

        v38 = v37;

        if (v38)
        {
          v39 = objc_alloc([objc_opt_class() transactionClass]);
          uuid3 = [v38 uuid];
          uuid4 = [(HMDHome *)v72 uuid];
          v42 = [v39 initWithObjectChangeType:2 uuid:uuid3 parentUUID:uuid4];

          initialManufacturer = [v38 initialManufacturer];
          if (initialManufacturer)
          {
            v44 = 0;
            goto LABEL_14;
          }

          manufacturer = [v38 manufacturer];
          v46 = manufacturer == 0;

          if (v46)
          {
            v44 = 0;
          }

          else
          {
            initialManufacturer = [v38 manufacturer];
            [v42 setInitialManufacturer:initialManufacturer];
            v44 = 1;
LABEL_14:
          }

          initialModel = [v38 initialModel];
          if (initialModel)
          {
LABEL_18:
          }

          else
          {
            model = [v38 model];
            v49 = model == 0;

            if (!v49)
            {
              initialModel = [v38 model];
              [v42 setInitialModel:initialModel];
              v44 = 1;
              goto LABEL_18;
            }
          }

          initialCategoryIdentifier = [v38 initialCategoryIdentifier];
          if (initialCategoryIdentifier)
          {
LABEL_20:
          }

          else
          {
            category = [v38 category];
            v54 = category == 0;

            if (!v54)
            {
              v55 = MEMORY[0x277CD1680];
              category2 = [v38 category];
              initialCategoryIdentifier = [v55 categoryIdentifierForCategory:category2];

              if (initialCategoryIdentifier)
              {
                v57 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:1];
                v58 = [initialCategoryIdentifier isEqualToNumber:v57];

                if ((v58 & 1) == 0)
                {
                  [v42 setInitialCategoryIdentifier:initialCategoryIdentifier];
                  v44 = 1;
                }
              }

              goto LABEL_20;
            }
          }

          initialServiceTypeUUIDs = [v38 initialServiceTypeUUIDs];
          v52 = initialServiceTypeUUIDs == 0;

          if (v52)
          {
            serviceTypeUUIDs = [v38 serviceTypeUUIDs];
            [v42 setInitialServiceTypeUUIDs:serviceTypeUUIDs];
          }

          else if (!v44)
          {
            goto LABEL_30;
          }

          [v71 addObject:v42];
LABEL_30:
        }

        ++v35;
      }

      while (v33 != v35);
      v60 = [accessories2 countByEnumeratingWithState:&v85 objects:v89 count:16];
      v33 = v60;
    }

    while (v60);
  }

  if ([v71 count])
  {
    dispatch_group_enter(group);
    array = [MEMORY[0x277CBEA60] array];
    (*(v68 + 2))(v68, array, v71, 0);
  }

  objc_destroyWeak(&v83);
  objc_destroyWeak(&location);

  v62 = *MEMORY[0x277D85DE8];
}

void __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_2;
  block[3] = &unk_279722CE8;
  objc_copyWeak(&v21, (a1 + 64));
  v15 = v9;
  v16 = *(a1 + 40);
  v17 = v7;
  v18 = *(a1 + 48);
  v19 = v8;
  v20 = *(a1 + 56);
  v11 = v8;
  v12 = v7;
  v13 = v9;
  dispatch_async(v10, block);

  objc_destroyWeak(&v21);
}

void __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_3(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  dispatch_group_enter(v3);
  [*(a1 + 40) _migrateHomeObjectCloudZone:*(a1 + 48) defaultModel:v4 completion:*(a1 + 56)];
}

void __94__HMDHome__migrateHomeAllObjectsCloudZone_migrationGroup_migrationQueue_saveModels_runModels___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (WeakRetained && !*(a1 + 32))
  {
    [*(a1 + 40) addObjectsFromArray:*(a1 + 48)];
    [*(a1 + 56) addObjectsFromArray:*(a1 + 64)];
  }

  dispatch_group_leave(*(a1 + 72));
}

- (void)_migrateHomeObjectCloudZone:(id)zone defaultModel:(id)model completion:(id)completion
{
  zoneCopy = zone;
  modelCopy = model;
  completionCopy = completion;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  objc_initWeak(&location, self);
  uuid = [modelCopy uuid];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke;
  v18[3] = &unk_279722CC0;
  objc_copyWeak(&v23, &location);
  v14 = completionCopy;
  v22 = v14;
  v15 = array;
  v19 = v15;
  v16 = array2;
  v20 = v16;
  v17 = modelCopy;
  v21 = v17;
  [zoneCopy cloudRecordWithObjectID:uuid completionHandler:v18];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);
}

void __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 8);
  if (WeakRetained && !v5)
  {
    v10 = [a1[6] uuid];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke_2;
    v16[3] = &unk_279730C48;
    objc_copyWeak(&v19, a1 + 8);
    v11 = a1[4];
    v12 = a1[6];
    v13 = a1[7];
    *&v14 = a1[5];
    *(&v14 + 1) = v13;
    *&v15 = v11;
    *(&v15 + 1) = v12;
    v17 = v15;
    v18 = v14;
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v10 completion:v16];

    objc_destroyWeak(&v19);
  }

  else
  {
    v8 = a1[4];
    v9 = a1[5];
    (*(a1[7] + 2))();
  }
}

void __63__HMDHome__migrateHomeObjectCloudZone_defaultModel_completion___block_invoke_2(uint64_t a1, char a2)
{
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (a2 & 1) == 0)
  {
    [*(a1 + 32) addObject:*(a1 + 40)];
  }

  v4 = *(a1 + 32);
  v5 = *(a1 + 48);
  (*(*(a1 + 56) + 16))();
}

- (void)_migrateAppleMediaAccessoriesWithCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion
{
  zoneCopy = zone;
  completionCopy = completion;
  queueCopy = queue;
  currentAccessory = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = currentAccessory;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  if (v13)
  {
    [v13 migrateWithCloudZone:zoneCopy migrationQueue:queueCopy completion:completionCopy];
  }

  else
  {
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __80__HMDHome__migrateAppleMediaAccessoriesWithCloudZone_migrationQueue_completion___block_invoke;
    block[3] = &unk_2797348C0;
    v15 = completionCopy;
    dispatch_async(queueCopy, block);

    queueCopy = v15;
  }
}

- (void)_migrateHomeUsersCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion
{
  v39 = *MEMORY[0x277D85DE8];
  zoneCopy = zone;
  queue = queue;
  completionCopy = completion;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  v10 = dispatch_group_create();
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  users = [(HMDHome *)self users];
  v12 = [users copy];

  v13 = [v12 countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v13)
  {
    v14 = *v35;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v35 != v14)
        {
          objc_enumerationMutation(v12);
        }

        v16 = *(*(&v34 + 1) + 8 * i);
        dispatch_group_enter(v10);
        objc_initWeak(&location, self);
        v28[0] = MEMORY[0x277D85DD0];
        v28[1] = 3221225472;
        v28[2] = __64__HMDHome__migrateHomeUsersCloudZone_migrationQueue_completion___block_invoke;
        v28[3] = &unk_27972A0E0;
        objc_copyWeak(&v32, &location);
        v29 = array;
        v30 = array2;
        v31 = v10;
        [v16 migrateCloudZone:zoneCopy migrationQueue:queue completion:v28];

        objc_destroyWeak(&v32);
        objc_destroyWeak(&location);
      }

      v13 = [v12 countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v13);
  }

  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __64__HMDHome__migrateHomeUsersCloudZone_migrationQueue_completion___block_invoke_2;
  block[3] = &unk_2797355D0;
  v26 = array2;
  v27 = completionCopy;
  v25 = array;
  v17 = array2;
  v18 = array;
  v19 = completionCopy;
  dispatch_group_notify(v10, queue, block);

  v20 = *MEMORY[0x277D85DE8];
}

void __64__HMDHome__migrateHomeUsersCloudZone_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v10 = a2;
  v7 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v9 = WeakRetained;
  if (!a4 && WeakRetained)
  {
    [*(a1 + 32) addObjectsFromArray:v10];
    [*(a1 + 40) addObjectsFromArray:v7];
  }

  dispatch_group_leave(*(a1 + 48));
}

- (void)_migrateHomeMediaSettingsCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion
{
  zoneCopy = zone;
  queueCopy = queue;
  completionCopy = completion;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  uuid = [(HMDHome *)self uuid];
  v14 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid];

  objc_initWeak(&location, self);
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke;
  v20[3] = &unk_279722C98;
  objc_copyWeak(&v26, &location);
  v15 = queueCopy;
  v21 = v15;
  v16 = completionCopy;
  v25 = v16;
  v17 = array;
  v22 = v17;
  v18 = array2;
  v23 = v18;
  v19 = v14;
  v24 = v19;
  [zoneCopy cloudRecordWithObjectID:v19 completionHandler:v20];

  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);
}

void __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  if (!WeakRetained)
  {
    v11 = *(a1 + 32);
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_2;
    v23[3] = &unk_2797355D0;
    v26 = *(a1 + 64);
    v24 = *(a1 + 40);
    v25 = *(a1 + 48);
    dispatch_async(v11, v23);

    v10 = v26;
    goto LABEL_6;
  }

  if (!v5)
  {
    v12 = *(a1 + 56);
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_3;
    v17[3] = &unk_279730C48;
    objc_copyWeak(&v22, (a1 + 72));
    v18 = *(a1 + 48);
    v21 = *(a1 + 64);
    v19 = *(a1 + 32);
    v20 = *(a1 + 40);
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v12 completion:v17];

    objc_destroyWeak(&v22);
    goto LABEL_8;
  }

  v8 = *(a1 + 64);
  if (v8)
  {
    v9 = *(a1 + 32);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_2_1945;
    block[3] = &unk_2797355D0;
    v16 = v8;
    v14 = *(a1 + 40);
    v15 = *(a1 + 48);
    dispatch_async(v9, block);

    v10 = v16;
LABEL_6:
  }

LABEL_8:
}

void __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_3(uint64_t a1, char a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (a2 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating home media settings and adding transaction to push to cloud", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [v8 uuid];
    v12 = [HMDHomeMediaSettingsModel defaultModelForHomeUUID:v11];

    [*(a1 + 32) addObject:v12];
  }

  v13 = *(a1 + 56);
  if (v13)
  {
    v14 = *(a1 + 40);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __72__HMDHome__migrateHomeMediaSettingsCloudZone_migrationQueue_completion___block_invoke_1944;
    block[3] = &unk_2797355D0;
    v19 = v13;
    v17 = *(a1 + 48);
    v18 = *(a1 + 32);
    dispatch_async(v14, block);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_migrateHomeSettingsCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion
{
  zoneCopy = zone;
  queueCopy = queue;
  completionCopy = completion;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  uuid = [(HMDHome *)self uuid];
  v14 = [HMDHomeSettingsModel modelIDForHomeUUID:uuid];

  objc_initWeak(&location, self);
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke;
  v20[3] = &unk_279722C98;
  objc_copyWeak(&v26, &location);
  v15 = queueCopy;
  v21 = v15;
  v16 = completionCopy;
  v25 = v16;
  v17 = array;
  v22 = v17;
  v18 = array2;
  v23 = v18;
  v19 = v14;
  v24 = v19;
  [zoneCopy cloudRecordWithObjectID:v19 completionHandler:v20];

  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);
}

void __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  if (!WeakRetained)
  {
    v11 = *(a1 + 32);
    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_2;
    v23[3] = &unk_2797355D0;
    v26 = *(a1 + 64);
    v24 = *(a1 + 40);
    v25 = *(a1 + 48);
    dispatch_async(v11, v23);

    v10 = v26;
    goto LABEL_6;
  }

  if (!v5)
  {
    v12 = *(a1 + 56);
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_3;
    v17[3] = &unk_279730C48;
    objc_copyWeak(&v22, (a1 + 72));
    v18 = *(a1 + 48);
    v21 = *(a1 + 64);
    v19 = *(a1 + 32);
    v20 = *(a1 + 40);
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v12 completion:v17];

    objc_destroyWeak(&v22);
    goto LABEL_8;
  }

  v8 = *(a1 + 64);
  if (v8)
  {
    v9 = *(a1 + 32);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_2_1943;
    block[3] = &unk_2797355D0;
    v16 = v8;
    v14 = *(a1 + 40);
    v15 = *(a1 + 48);
    dispatch_async(v9, block);

    v10 = v16;
LABEL_6:
  }

LABEL_8:
}

void __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_3(uint64_t a1, char a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (a2 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating home settings and adding transaction to push to cloud", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [v8 uuid];
    v12 = [HMDHomeSettingsModel defaultModelForHomeUUID:v11];

    [*(a1 + 32) addObject:v12];
  }

  v13 = *(a1 + 56);
  if (v13)
  {
    v14 = *(a1 + 40);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome__migrateHomeSettingsCloudZone_migrationQueue_completion___block_invoke_1942;
    block[3] = &unk_2797355D0;
    v19 = v13;
    v17 = *(a1 + 48);
    v18 = *(a1 + 32);
    dispatch_async(v14, block);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_migrateResidentDevicesCloudZone:(id)zone migrationQueue:(id)queue completion:(id)completion
{
  v42 = *MEMORY[0x277D85DE8];
  zoneCopy = zone;
  queueCopy = queue;
  completionCopy = completion;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  v39 = 0u;
  v40 = 0u;
  v37 = 0u;
  v38 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v14 = [residentDevices countByEnumeratingWithState:&v37 objects:v41 count:16];
  if (v14)
  {
    v15 = *v38;
LABEL_3:
    v16 = 0;
    while (1)
    {
      if (*v38 != v15)
      {
        objc_enumerationMutation(residentDevices);
      }

      v17 = *(*(&v37 + 1) + 8 * v16);
      if ([v17 isCurrentDevice])
      {
        break;
      }

      if (v14 == ++v16)
      {
        v14 = [residentDevices countByEnumeratingWithState:&v37 objects:v41 count:16];
        if (v14)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }

    v18 = v17;

    if (!v18)
    {
      goto LABEL_12;
    }

    identifier = [v18 identifier];
    objc_initWeak(&location, self);
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_2;
    v24[3] = &unk_279722C70;
    objc_copyWeak(&v31, &location);
    v25 = queueCopy;
    v30 = completionCopy;
    v26 = array;
    v27 = array2;
    v20 = identifier;
    v28 = v20;
    v21 = v18;
    v29 = v21;
    [zoneCopy cloudRecordWithObjectID:v20 completionHandler:v24];

    objc_destroyWeak(&v31);
    objc_destroyWeak(&location);

    goto LABEL_14;
  }

LABEL_9:

LABEL_12:
  if (completionCopy)
  {
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke;
    block[3] = &unk_2797355D0;
    v36 = completionCopy;
    v34 = array;
    v35 = array2;
    dispatch_async(queueCopy, block);

    v21 = v36;
LABEL_14:
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (!WeakRetained)
  {
    v11 = *(a1 + 32);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_3;
    block[3] = &unk_2797355D0;
    v27 = *(a1 + 72);
    v25 = *(a1 + 40);
    v26 = *(a1 + 48);
    dispatch_async(v11, block);

    v10 = v27;
    goto LABEL_6;
  }

  if (!v5)
  {
    v12 = *(a1 + 56);
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_4;
    v17[3] = &unk_279722C48;
    objc_copyWeak(&v23, (a1 + 80));
    v18 = *(a1 + 64);
    v19 = *(a1 + 40);
    v22 = *(a1 + 72);
    v20 = *(a1 + 32);
    v21 = *(a1 + 48);
    [WeakRetained cleanChangesIfNoAddChangeObjectID:v12 completion:v17];

    objc_destroyWeak(&v23);
    goto LABEL_8;
  }

  v8 = *(a1 + 72);
  if (v8)
  {
    v9 = *(a1 + 32);
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_2_1940;
    v13[3] = &unk_2797355D0;
    v16 = v8;
    v14 = *(a1 + 40);
    v15 = *(a1 + 48);
    dispatch_async(v9, v13);

    v10 = v16;
LABEL_6:
  }

LABEL_8:
}

void __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_4(uint64_t a1, char a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  if (WeakRetained && (a2 & 1) == 0)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Creating resident device and adding transaction to push to cloud", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [*(a1 + 32) modelObjectWithChangeType:1 version:4];
    [*(a1 + 40) addObject:v11];
  }

  v12 = *(a1 + 64);
  if (v12)
  {
    v13 = *(a1 + 48);
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __70__HMDHome__migrateResidentDevicesCloudZone_migrationQueue_completion___block_invoke_1939;
    block[3] = &unk_2797355D0;
    v18 = v12;
    v16 = *(a1 + 40);
    v17 = *(a1 + 56);
    dispatch_async(v13, block);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)cleanChangesIfNoAddChangeObjectID:(id)d completion:(id)completion
{
  v48 = *MEMORY[0x277D85DE8];
  dCopy = d;
  completionCopy = completion;
  if (dCopy)
  {
    *&v45 = 0;
    *(&v45 + 1) = &v45;
    v46 = 0x2020000000;
    v47 = 0;
    v8 = [MEMORY[0x277CBEB58] set];
    objc_initWeak(&location, self);
    v9 = [HMDBackingStoreLogFetchOperation alloc];
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke;
    v35[3] = &unk_279722C20;
    v10 = dCopy;
    v36 = v10;
    v11 = v8;
    selfCopy = self;
    v39 = &v45;
    v37 = v11;
    v12 = [(HMDBackingStoreLogFetchOperation *)v9 initWithNeedsPushTo:2 result:v35];
    v26 = MEMORY[0x277D85DD0];
    v27 = 3221225472;
    v28 = __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_1938;
    v29 = &unk_279732DE0;
    objc_copyWeak(&v34, &location);
    v33 = &v45;
    v13 = v11;
    v30 = v13;
    v14 = v10;
    v31 = v14;
    v32 = completionCopy;
    [(HMDBackingStoreOperation *)v12 setResultBlock:&v26];
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v42 = v18;
      v43 = 2112;
      v44 = v14;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEBUG, "%{public}@Cleaning of objects for %@ from datastore started", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v19 = [(HMDHome *)selfCopy2 backingStore:v26];
    [v19 submit:v12];

    objc_destroyWeak(&v34);
    objc_destroyWeak(&location);

    _Block_object_dispose(&v45, 8);
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      LODWORD(v45) = 138543362;
      *(&v45 + 4) = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@ObjectID must be defined", &v45, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    (*(completionCopy + 2))(completionCopy, 0, v24);
  }

  v25 = *MEMORY[0x277D85DE8];
}

uint64_t __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v38 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v29 = 0u;
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v10 = v7;
  v11 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v11)
  {
    v12 = v11;
    v27 = v9;
    v28 = v8;
    v13 = *v30;
    while (2)
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v30 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v29 + 1) + 8 * i);
        v16 = [v15 uuid];
        v17 = [v16 isEqual:*(a1 + 32)];

        if (v17)
        {
          if ([v15 objectChangeType] == 1 && !objc_msgSend(*(a1 + 40), "count"))
          {
            v24 = 0;
            *(*(*(a1 + 56) + 8) + 24) = 1;
            goto LABEL_16;
          }

          v18 = objc_autoreleasePoolPush();
          v19 = *(a1 + 48);
          v20 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
          {
            v21 = HMFGetLogIdentifier();
            *buf = 138543618;
            v34 = v21;
            v35 = 2112;
            v36 = v15;
            _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Removing object change from homes transaction store %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v18);
          v22 = *(a1 + 40);
          v23 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(v15, "bsoLogRowID")}];
          [v22 addObject:v23];
        }
      }

      v12 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
      if (v12)
      {
        continue;
      }

      break;
    }

    v24 = 1;
LABEL_16:
    v9 = v27;
    v8 = v28;
  }

  else
  {
    v24 = 1;
  }

  v25 = *MEMORY[0x277D85DE8];
  return v24;
}

void __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_1938(uint64_t a1, void *a2)
{
  v30 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained && (*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 32) count])
  {
    v5 = [HMDBackingStoreLogUpdateOperation alloc];
    v6 = [*(a1 + 32) allObjects];
    v7 = [(HMDBackingStoreLogUpdateOperation *)v5 initWithRowIDs:v6 successfullyPushedTo:3];

    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_2;
    v21 = &unk_279732DB8;
    objc_copyWeak(&v25, (a1 + 64));
    v22 = *(a1 + 40);
    v8 = *(a1 + 48);
    v9 = *(a1 + 56);
    v23 = v8;
    v24 = v9;
    [(HMDBackingStoreOperation *)v7 setResultBlock:&v18];
    v10 = objc_autoreleasePoolPush();
    v11 = WeakRetained;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 40);
      *buf = 138543618;
      v27 = v13;
      v28 = 2112;
      v29 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Scheduling cleanup of objects for %@ in home in datastore", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = [v11 backingStore];
    [v15 submit:v7];

    objc_destroyWeak(&v25);
  }

  else
  {
    v16 = *(a1 + 48);
    if (v16)
    {
      (*(v16 + 16))(v16, *(*(*(a1 + 56) + 8) + 24), v3);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_cleanChangesIfNoAddChangeObjectID_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    v9 = *(a1 + 32);
    v12 = 138543618;
    v13 = v8;
    v14 = 2112;
    v15 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Cleaned objects for %@ in home in datastore", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = *(a1 + 40);
  if (v10)
  {
    (*(v10 + 16))(v10, *(*(*(a1 + 48) + 8) + 24), v3);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)dropAllChangesWithObjectID:(id)d
{
  v15 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v5 = dCopy;
  if (dCopy)
  {
    v12 = dCopy;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:&v12 count:1];
    [(HMDHome *)self dropAllChangesWithArrayOfObjectIDs:v6];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v14 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@ObjectID must be defined", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)dropAllChangesWithArrayOfObjectIDs:(id)ds
{
  v31 = *MEMORY[0x277D85DE8];
  dsCopy = ds;
  v5 = [MEMORY[0x277CBEB58] set];
  objc_initWeak(&location, self);
  v6 = [HMDBackingStoreLogFetchOperation alloc];
  v22[0] = MEMORY[0x277D85DD0];
  v22[1] = 3221225472;
  v22[2] = __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke;
  v22[3] = &unk_279722BF8;
  v7 = dsCopy;
  v23 = v7;
  selfCopy = self;
  v8 = v5;
  v25 = v8;
  v9 = [(HMDBackingStoreLogFetchOperation *)v6 initWithNeedsPushTo:2 result:v22];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_1936;
  v18[3] = &unk_279731988;
  objc_copyWeak(&v21, &location);
  v10 = v8;
  v19 = v10;
  v11 = v7;
  v20 = v11;
  [(HMDBackingStoreOperation *)v9 setResultBlock:v18];
  v12 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    *buf = 138543618;
    v28 = v15;
    v29 = 2112;
    v30 = v11;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Dropping of changes datastore started for %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v12);
  backingStore = [(HMDHome *)selfCopy2 backingStore];
  [backingStore submit:v9];

  objc_destroyWeak(&v21);
  objc_destroyWeak(&location);

  v17 = *MEMORY[0x277D85DE8];
}

uint64_t __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v35 = *MEMORY[0x277D85DE8];
  v7 = a2;
  v25 = a3;
  v24 = a4;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v8 = v7;
  v9 = [v8 countByEnumeratingWithState:&v26 objects:v34 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v27;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v27 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v26 + 1) + 8 * i);
        v14 = *(a1 + 32);
        v15 = [v13 uuid];
        LODWORD(v14) = [v14 containsObject:v15];

        if (v14)
        {
          v16 = objc_autoreleasePoolPush();
          v17 = *(a1 + 40);
          v18 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v19 = HMFGetLogIdentifier();
            *buf = 138543618;
            v31 = v19;
            v32 = 2112;
            v33 = v13;
            _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Removing object change from homes transaction store %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v16);
          v20 = *(a1 + 48);
          v21 = [MEMORY[0x277CCABB0] numberWithUnsignedLongLong:{objc_msgSend(v13, "bsoLogRowID")}];
          [v20 addObject:v21];
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v26 objects:v34 count:16];
    }

    while (v10);
  }

  v22 = *MEMORY[0x277D85DE8];
  return 1;
}

void __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_1936(id *a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained && [a1[4] count])
  {
    v5 = [HMDBackingStoreLogUpdateOperation alloc];
    v6 = [a1[4] allObjects];
    v7 = [(HMDBackingStoreLogUpdateOperation *)v5 initWithRowIDs:v6 successfullyPushedTo:3];

    v15 = MEMORY[0x277D85DD0];
    v16 = 3221225472;
    v17 = __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_2;
    v18 = &unk_2797338E8;
    objc_copyWeak(&v20, a1 + 6);
    v19 = a1[5];
    [(HMDBackingStoreOperation *)v7 setResultBlock:&v15];
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = a1[5];
      *buf = 138543618;
      v22 = v11;
      v23 = 2112;
      v24 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Scheduling dropping of changes in home in datastore for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = [v9 backingStore];
    [v13 submit:v7];

    objc_destroyWeak(&v20);
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_dropAllChangesWithArrayOfObjectIDs___block_invoke_2(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v9 = *(a1 + 32);
    v11 = 138543618;
    v12 = v8;
    v13 = 2112;
    v14 = v9;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Dropped changes in home in datastore for %@", &v11, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v10 = *MEMORY[0x277D85DE8];
}

- (id)homeConfigurationModelObjectWithChangeType:(unint64_t)type
{
  v5 = [HMDHomeConfigurationModel alloc];
  homeConfigurationUUID = [(HMDHome *)self homeConfigurationUUID];
  uuid = [(HMDHome *)self uuid];
  v8 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:type uuid:homeConfigurationUUID parentUUID:uuid];

  v9 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDHomeConfigurationModel *)v8 setConfigurationVersion:v9];

  return v8;
}

- (id)homeConfigurationUUID
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CCAD78];
  uuid = [(HMDHome *)self uuid];
  v8[0] = @"6741775F-2ED4-4DF8-B582-1F64BB3D1C75";
  v4 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
  v5 = [v2 hm_deriveUUIDFromBaseUUID:uuid identifierSalt:0 withSalts:v4];

  v6 = *MEMORY[0x277D85DE8];

  return v5;
}

- (id)emptyModelObjectWithChangeType:(unint64_t)type
{
  v5 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  v7 = objc_alloc(MEMORY[0x277CCAD78]);
  v8 = [v7 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v9 = [(HMDBackingStoreModelObject *)v5 initWithObjectChangeType:type uuid:uuid parentUUID:v8];

  return v9;
}

- (id)modelObjectWithChangeType:(unint64_t)type version:(int64_t)version
{
  v6 = [(HMDHome *)self emptyModelObjectWithChangeType:type];
  name = [(HMDHome *)self name];
  [v6 setName:name];

  ownerName = [(HMDHome *)self ownerName];
  if (ownerName)
  {
    v9 = ownerName;
    owner = [(HMDHome *)self owner];
    publicKey = [owner publicKey];

    if (publicKey)
    {
      ownerName2 = [(HMDHome *)self ownerName];
      [v6 setOwnerName:ownerName2];

      owner2 = [(HMDHome *)self owner];
      uuid = [owner2 uuid];
      uUIDString = [uuid UUIDString];
      [v6 setOwnerUUID:uUIDString];

      owner3 = [(HMDHome *)self owner];
      userID = [owner3 userID];
      [v6 setOwnerUserID:userID];

      owner4 = [(HMDHome *)self owner];
      publicKey2 = [owner4 publicKey];
      [v6 setOwnerPublicKey:publicKey2];
    }
  }

  creationDate = [(HMDHome *)self creationDate];

  if (creationDate)
  {
    creationDate2 = [(HMDHome *)self creationDate];
    [v6 setCreationDate:creationDate2];
  }

  firstHAPAccessoryAddedDate = [(HMDHome *)self firstHAPAccessoryAddedDate];

  if (firstHAPAccessoryAddedDate)
  {
    firstHAPAccessoryAddedDate2 = [(HMDHome *)self firstHAPAccessoryAddedDate];
    [v6 setFirstHAPAccessoryAddedDate:firstHAPAccessoryAddedDate2];
  }

  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid2 = [roomForEntireHome uuid];
  uUIDString2 = [uuid2 UUIDString];
  [v6 setDefaultRoomUUID:uUIDString2];

  homeLocationHandler = [(HMDHome *)self homeLocationHandler];
  locationData = [homeLocationHandler locationData];
  v29 = encodeRootObject();
  [v6 setHomeLocationData:v29];

  if (version >= 3)
  {
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    primaryResidentUUID = [residentDeviceManager primaryResidentUUID];
    uUIDString3 = [primaryResidentUUID UUIDString];
    [v6 setPrimaryResidentUUID:uUIDString3];

    if (version != 3)
    {
      presenceAuthStatus = [(HMDHome *)self presenceAuthStatus];

      if (presenceAuthStatus)
      {
        presenceAuthStatus2 = [(HMDHome *)self presenceAuthStatus];
        number = [presenceAuthStatus2 number];
        [v6 setPresenceAuthorizationStatus:number];
      }

      presenceComputeStatus = [(HMDHome *)self presenceComputeStatus];

      if (presenceComputeStatus)
      {
        presenceComputeStatus2 = [(HMDHome *)self presenceComputeStatus];
        number2 = [presenceComputeStatus2 number];
        [v6 setPresenceComputeStatus:number2];
      }

      sharedHomeSourceVersion = [(HMDHome *)self sharedHomeSourceVersion];

      if (sharedHomeSourceVersion)
      {
        sharedHomeSourceVersion2 = [(HMDHome *)self sharedHomeSourceVersion];
        [v6 setSharedHomeSourceVersion:sharedHomeSourceVersion2];
      }

      v41 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome protectionMode](self, "protectionMode")}];
      [v6 setNetworkProtectionMode:v41];
    }
  }

  if ([(HMDHome *)self isMultiUserEnabled])
  {
    v42 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMultiUserEnabled](self, "isMultiUserEnabled")}];
    [v6 setMultiUserEnabled:v42];
  }

  hasAnyUserAcknowledgedCameraRecordingOnboarding = [v6 hasAnyUserAcknowledgedCameraRecordingOnboarding];

  if (hasAnyUserAcknowledgedCameraRecordingOnboarding)
  {
    v44 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasAnyUserAcknowledgedCameraRecordingOnboarding](self, "hasAnyUserAcknowledgedCameraRecordingOnboarding")}];
    [v6 setHasAnyUserAcknowledgedCameraRecordingOnboarding:v44];
  }

  if ([(HMDHome *)self hasOnboardedForAccessCode])
  {
    v45 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForAccessCode](self, "hasOnboardedForAccessCode")}];
    [v6 setHasOnboardedForAccessCode:v45];
  }

  if ([(HMDHome *)self shouldEncodeHasOnboardedForWalletKey])
  {
    v46 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome hasOnboardedForWalletKey](self, "hasOnboardedForWalletKey")}];
    [v6 setHasOnboardedForWalletKey:v46];
  }

  naturalLightingContext = [(HMDHome *)self naturalLightingContext];
  if (naturalLightingContext)
  {
    [v6 setNaturalLightingContext:naturalLightingContext];
  }

  chipStorage = [(HMDHome *)self chipStorage];
  [chipStorage updateHomeModel:v6];

  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    fabric = [(HMDHome *)self fabric];
    fabricID = [fabric fabricID];
    [v6 setMatterFabricID:fabricID];
  }

  v51 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome soundCheckEnabled](self, "soundCheckEnabled")}];
  [v6 setSoundCheckEnabled:v51];

  v52 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [v6 setSiriPhraseOptions:v52];

  v53 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome locationServicesEnabled](self, "locationServicesEnabled")}];
  [v6 setLocationServicesEnabled:v53];

  v54 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome didOnboardLocationServices](self, "didOnboardLocationServices")}];
  [v6 setDidOnboardLocationServices:v54];

  return v6;
}

- (id)backingStoreObjects:(int64_t)objects
{
  v209 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v6 = [(HMDHome *)self modelObjectWithChangeType:1 version:objects];
  [array addObject:v6];

  v7 = [(HMDHome *)self homeConfigurationModelObjectWithChangeType:1];
  [array addObject:v7];

  v192 = 0u;
  v193 = 0u;
  v190 = 0u;
  v191 = 0u;
  accessories = [(HMDHome *)self accessories];
  v9 = [accessories countByEnumeratingWithState:&v190 objects:v208 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v191;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v191 != v11)
        {
          objc_enumerationMutation(accessories);
        }

        v13 = *(*(&v190 + 1) + 8 * i);
        if (objects <= 3)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
            continue;
          }
        }

        v14 = [v13 backingStoreObjects:objects];
        [array addObjectsFromArray:v14];
      }

      v10 = [accessories countByEnumeratingWithState:&v190 objects:v208 count:16];
    }

    while (v10);
  }

  v188 = 0u;
  v189 = 0u;
  v186 = 0u;
  v187 = 0u;
  selfCopy = self;
  actionSets = [(HMDHome *)self actionSets];
  v16 = [actionSets countByEnumeratingWithState:&v186 objects:v207 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v187;
    do
    {
      for (j = 0; j != v17; ++j)
      {
        if (*v187 != v18)
        {
          objc_enumerationMutation(actionSets);
        }

        v20 = *(*(&v186 + 1) + 8 * j);
        if (objects <= 1)
        {
          v21 = MEMORY[0x277CD1800];
          type = [*(*(&v186 + 1) + 8 * j) type];
          LOBYTE(v21) = [v21 isBuiltinActionSetType:type];

          if (v21)
          {
            continue;
          }
        }

        v23 = [v20 backingStoreObjects:objects];
        [array addObjectsFromArray:v23];
      }

      v17 = [actionSets countByEnumeratingWithState:&v186 objects:v207 count:16];
    }

    while (v17);
  }

  if (objects >= 3 && !isWatch())
  {
    v184 = 0u;
    v185 = 0u;
    v182 = 0u;
    v183 = 0u;
    triggerOwnedActionSets = [(HMDHome *)selfCopy triggerOwnedActionSets];
    v25 = [triggerOwnedActionSets countByEnumeratingWithState:&v182 objects:v206 count:16];
    if (v25)
    {
      v26 = v25;
      v27 = *v183;
      do
      {
        for (k = 0; k != v26; ++k)
        {
          if (*v183 != v27)
          {
            objc_enumerationMutation(triggerOwnedActionSets);
          }

          v29 = [*(*(&v182 + 1) + 8 * k) backingStoreObjects:objects];
          [array addObjectsFromArray:v29];
        }

        v26 = [triggerOwnedActionSets countByEnumeratingWithState:&v182 objects:v206 count:16];
      }

      while (v26);
    }

    v180 = 0u;
    v181 = 0u;
    v178 = 0u;
    v179 = 0u;
    triggers = [(HMDHome *)selfCopy triggers];
    v31 = [triggers countByEnumeratingWithState:&v178 objects:v205 count:16];
    if (v31)
    {
      v32 = v31;
      v33 = *v179;
      do
      {
        for (m = 0; m != v32; ++m)
        {
          if (*v179 != v33)
          {
            objc_enumerationMutation(triggers);
          }

          v35 = *(*(&v178 + 1) + 8 * m);
          requiresDataVersion4 = [v35 requiresDataVersion4];
          if (objects > 3 || (requiresDataVersion4 & 1) == 0)
          {
            v37 = [v35 backingStoreObjects:objects];
            [array addObjectsFromArray:v37];
          }
        }

        v32 = [triggers countByEnumeratingWithState:&v178 objects:v205 count:16];
      }

      while (v32);
    }
  }

  v176 = 0u;
  v177 = 0u;
  v174 = 0u;
  v175 = 0u;
  rooms = [(HMDHome *)selfCopy rooms];
  v39 = [rooms countByEnumeratingWithState:&v174 objects:v204 count:16];
  if (v39)
  {
    v40 = v39;
    v41 = *v175;
    do
    {
      for (n = 0; n != v40; ++n)
      {
        if (*v175 != v41)
        {
          objc_enumerationMutation(rooms);
        }

        v43 = [*(*(&v174 + 1) + 8 * n) backingStoreObjects:objects];
        [array addObjectsFromArray:v43];
      }

      v40 = [rooms countByEnumeratingWithState:&v174 objects:v204 count:16];
    }

    while (v40);
  }

  v172 = 0u;
  v173 = 0u;
  v170 = 0u;
  v171 = 0u;
  zones = [(HMDHome *)selfCopy zones];
  v45 = [zones countByEnumeratingWithState:&v170 objects:v203 count:16];
  if (v45)
  {
    v46 = v45;
    v47 = *v171;
    do
    {
      for (ii = 0; ii != v46; ++ii)
      {
        if (*v171 != v47)
        {
          objc_enumerationMutation(zones);
        }

        v49 = [*(*(&v170 + 1) + 8 * ii) backingStoreObjects:objects];
        [array addObjectsFromArray:v49];
      }

      v46 = [zones countByEnumeratingWithState:&v170 objects:v203 count:16];
    }

    while (v46);
  }

  v168 = 0u;
  v169 = 0u;
  v166 = 0u;
  v167 = 0u;
  serviceGroups = [(HMDHome *)selfCopy serviceGroups];
  v51 = [serviceGroups countByEnumeratingWithState:&v166 objects:v202 count:16];
  if (v51)
  {
    v52 = v51;
    v53 = *v167;
    do
    {
      for (jj = 0; jj != v52; ++jj)
      {
        if (*v167 != v53)
        {
          objc_enumerationMutation(serviceGroups);
        }

        v55 = [*(*(&v166 + 1) + 8 * jj) backingStoreObjects:objects];
        [array addObjectsFromArray:v55];
      }

      v52 = [serviceGroups countByEnumeratingWithState:&v166 objects:v202 count:16];
    }

    while (v52);
  }

  v56 = objc_autoreleasePoolPush();
  v57 = selfCopy;
  v58 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
  {
    v59 = HMFGetLogIdentifier();
    [(HMDHome *)v57 isUpdatedToHH2];
    v60 = HMFBooleanToString();
    *buf = 138543618;
    v199 = v59;
    v200 = 2112;
    v201 = v60;
    _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, "%{public}@HH2 status : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v56);
  if ([(HMDHome *)v57 isUpdatedToHH2])
  {
    v61 = [HMDHomeUpgradedToROAR defaultModelForHome:v57];
    [array addObject:v61];
  }

  v164 = 0u;
  v165 = 0u;
  v162 = 0u;
  v163 = 0u;
  users = [(HMDHome *)v57 users];
  v63 = [users countByEnumeratingWithState:&v162 objects:v197 count:16];
  if (v63)
  {
    v64 = v63;
    v65 = *v163;
    do
    {
      for (kk = 0; kk != v64; ++kk)
      {
        if (*v163 != v65)
        {
          objc_enumerationMutation(users);
        }

        v67 = *(*(&v162 + 1) + 8 * kk);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        v69 = isKindOfClass;
        if ((objects > 1 || (isKindOfClass & 1) == 0) && (!isWatch() || (v69 & 1) == 0 && [v67 isOwner]) && (objects > 3 || (objc_msgSend(v67, "requiresMakoSupport") & 1) == 0))
        {
          v70 = [v67 backingStoreObjects:objects];
          [array addObjectsFromArray:v70];
        }
      }

      v64 = [users countByEnumeratingWithState:&v162 objects:v197 count:16];
    }

    while (v64);
  }

  if (objects >= 2)
  {
    v160 = 0u;
    v161 = 0u;
    v158 = 0u;
    v159 = 0u;
    v149 = v57;
    outgoingInvitations = [(HMDHome *)v57 outgoingInvitations];
    v72 = [outgoingInvitations countByEnumeratingWithState:&v158 objects:v196 count:16];
    if (v72)
    {
      v73 = v72;
      v74 = *v159;
      do
      {
        for (mm = 0; mm != v73; ++mm)
        {
          if (*v159 != v74)
          {
            objc_enumerationMutation(outgoingInvitations);
          }

          v76 = *(*(&v158 + 1) + 8 * mm);
          if (objects <= 3)
          {
            user = [*(*(&v158 + 1) + 8 * mm) user];
            requiresMakoSupport = [user requiresMakoSupport];

            if (requiresMakoSupport)
            {
              continue;
            }
          }

          v79 = [v76 modelObjectWithChangeType:1 version:objects];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v80 = v79;
          }

          else
          {
            v80 = 0;
          }

          v81 = v80;

          if (v81)
          {
            [array addObject:v81];
          }
        }

        v73 = [outgoingInvitations countByEnumeratingWithState:&v158 objects:v196 count:16];
      }

      while (v73);
    }

    if (objects >= 3)
    {
      v156 = 0u;
      v157 = 0u;
      v154 = 0u;
      v155 = 0u;
      residentDeviceManager = [(HMDHome *)v57 residentDeviceManager];
      residentDevices = [residentDeviceManager residentDevices];

      v84 = [residentDevices countByEnumeratingWithState:&v154 objects:v195 count:16];
      if (v84)
      {
        v85 = v84;
        v86 = *v155;
        do
        {
          for (nn = 0; nn != v85; ++nn)
          {
            if (*v155 != v86)
            {
              objc_enumerationMutation(residentDevices);
            }

            v88 = [*(*(&v154 + 1) + 8 * nn) modelObjectWithChangeType:1 version:objects];
            [array addObject:v88];
          }

          v85 = [residentDevices countByEnumeratingWithState:&v154 objects:v195 count:16];
        }

        while (v85);
      }

      appData = [(HMDHome *)v57 appData];

      if (appData)
      {
        appData2 = [(HMDHome *)v57 appData];
        v91 = [appData2 modelObjectWithChangeType:1];
        [array addObject:v91];
      }

      if (objects >= 4)
      {
        v92 = [HMDHomeSettingsModel alloc];
        uuid = [(HMDHome *)v57 uuid];
        v94 = [HMDHomeSettingsModel modelIDForHomeUUID:uuid];
        uuid2 = [(HMDHome *)v57 uuid];
        v96 = [(HMDBackingStoreModelObject *)v92 initWithObjectChangeType:1 uuid:v94 parentUUID:uuid2];

        v97 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticSoftwareUpdateEnabled](v57, "isAutomaticSoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v96 setAutomaticSoftwareUpdateEnabled:v97];

        v98 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isAutomaticThirdPartyAccessorySoftwareUpdateEnabled](v57, "isAutomaticThirdPartyAccessorySoftwareUpdateEnabled")}];
        [(HMDHomeSettingsModel *)v96 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v98];

        [array addObject:v96];
        v99 = [HMDHomeMediaSettingsModel alloc];
        uuid3 = [(HMDHome *)v57 uuid];
        v101 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid3];
        uuid4 = [(HMDHome *)v57 uuid];
        v103 = [(HMDBackingStoreModelObject *)v99 initWithObjectChangeType:1 uuid:v101 parentUUID:uuid4];

        v104 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome minimumMediaUserPrivilege](v57, "minimumMediaUserPrivilege")}];
        [(HMDHomeMediaSettingsModel *)v103 setMinimumMediaUserPrivilege:v104];

        v105 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome isMediaPeerToPeerEnabled](v57, "isMediaPeerToPeerEnabled")}];
        [(HMDHomeMediaSettingsModel *)v103 setMediaPeerToPeerEnabled:v105];

        mediaPassword = [(HMDHome *)v57 mediaPassword];
        [(HMDHomeMediaSettingsModel *)v103 setMediaPassword:mediaPassword];

        [array addObject:v103];
        mediaSystemController = [(HMDHome *)v57 mediaSystemController];
        v108 = [mediaSystemController backingStoreObjectsForVersion:objects];

        if ([v108 count])
        {
          [array addObjectsFromArray:v108];
        }

        uuid5 = [(HMDHome *)v57 uuid];
        v110 = [HMDHomeNetworkRouterManagingDeviceSettingsModel defaultModelForHomeUUID:uuid5];

        primaryNetworkRouterManagingDeviceUUID = [(HMDHome *)v57 primaryNetworkRouterManagingDeviceUUID];
        uUIDString = [primaryNetworkRouterManagingDeviceUUID UUIDString];
        [v110 setPrimaryNetworkRouterManagingDeviceUUID:uUIDString];

        [array addObject:v110];
        uuid6 = [(HMDHome *)v57 uuid];
        v114 = [HMDHomeNetworkRouterSettingsModel defaultModelForHomeUUID:uuid6];

        activeNetworkRouterUUID = [(HMDHome *)v57 activeNetworkRouterUUID];
        uUIDString2 = [activeNetworkRouterUUID UUIDString];
        [v114 setActiveNetworkRouterAccessoryUUID:uUIDString2];

        v117 = +[HMDHomeKitVersion version6];
        minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)v57 minimumNetworkRouterSupportHomeKitVersion];
        if (!minimumNetworkRouterSupportHomeKitVersion)
        {
          goto LABEL_113;
        }

        v119 = minimumNetworkRouterSupportHomeKitVersion;
        minimumNetworkRouterSupportHomeKitVersion2 = [(HMDHome *)v57 minimumNetworkRouterSupportHomeKitVersion];
        v121 = [minimumNetworkRouterSupportHomeKitVersion2 compare:v117];

        v122 = v121 == -1;
        v57 = v149;
        if (v122)
        {
LABEL_113:
          versionString = [v117 versionString];
          [v114 setMinimumNetworkRouterSupportHomeKitVersion:versionString];
        }

        minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHome *)v57 minHomeKitVersionForAccessoryNetworkProtectionChange];
        versionString2 = [minHomeKitVersionForAccessoryNetworkProtectionChange versionString];
        [v114 setMinHomeKitVersionForAccessoryNetworkProtectionChange:versionString2];

        [array addObject:v114];
        v152 = 0u;
        v153 = 0u;
        v150 = 0u;
        v151 = 0u;
        networkProtectionGroupRegistry = [(HMDHome *)v57 networkProtectionGroupRegistry];
        persistedGroups = [networkProtectionGroupRegistry persistedGroups];

        v128 = [persistedGroups countByEnumeratingWithState:&v150 objects:v194 count:16];
        if (v128)
        {
          v129 = v128;
          v130 = *v151;
          do
          {
            for (i1 = 0; i1 != v129; ++i1)
            {
              if (*v151 != v130)
              {
                objc_enumerationMutation(persistedGroups);
              }

              v132 = [*(*(&v150 + 1) + 8 * i1) modelForVersion:objects];
              [array addObject:v132];
            }

            v129 = [persistedGroups countByEnumeratingWithState:&v150 objects:v194 count:16];
          }

          while (v129);
        }

        v133 = [HMDHomeThreadNetworkModel defaultModelForHome:v149];
        unfilteredThreadNetworkID = [(HMDHome *)v149 unfilteredThreadNetworkID];
        [v133 setThreadNetworkID:unfilteredThreadNetworkID];

        [array addObject:v133];
        uuid7 = [(HMDHome *)v149 uuid];
        v136 = [HMDHomePersonManagerSettingsModel defaultModelForHomeUUID:uuid7];

        personManagerZoneUUID = [(HMDHome *)v149 personManagerZoneUUID];
        [v136 setZoneUUID:personManagerZoneUUID];

        [array addObject:v136];
        labelsByAccessCode = [(HMDHome *)v149 labelsByAccessCode];
        v139 = [HMDAccessCodeDataManager createHomeAccessCodeModelsFromLabelsByAccessCode:labelsByAccessCode forHome:v149];

        [array addObjectsFromArray:v139];
        removedUserInfoByAccessCode = [(HMDHome *)v149 removedUserInfoByAccessCode];
        v141 = [HMDAccessCodeDataManager createRemovedUserInfoModelsFromRemovedUserInfoByAccessCode:removedUserInfoByAccessCode forHome:v149];

        [array addObjectsFromArray:v141];
        v142 = [HMDHomeNFCReaderKeyModel defaultModelForHome:v149];
        if ([(HMDHome *)v149 shouldEncodeNFCReaderKey])
        {
          nfcReaderKey = [(HMDHome *)v149 nfcReaderKey];
          [v142 setNfcReaderKey:nfcReaderKey];
        }

        [array addObject:v142];
      }
    }
  }

  v144 = array;

  v145 = *MEMORY[0x277D85DE8];
  return array;
}

- (id)sharedHomeModel
{
  v3 = [HMDSharedHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  v5 = objc_alloc(MEMORY[0x277CCAD78]);
  v6 = [v5 initWithUUIDString:*MEMORY[0x277CD23C8]];
  v7 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:1 uuid:uuid parentUUID:v6];

  homeManager = [(HMDHome *)self homeManager];
  v9 = [homeManager generateDataForSharedHomeModel:self];
  [(HMDSharedHomeModel *)v7 setHomeData:v9];

  v10 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome configurationVersion](self, "configurationVersion")}];
  [(HMDSharedHomeModel *)v7 setConfigurationVersion:v10];

  return v7;
}

- (id)deletedBackingStoreObject
{
  homeManager = [(HMDHome *)self homeManager];
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v5 = off_27971A150;
  if (!isOwnerUser)
  {
    v5 = off_27971A238;
  }

  v6 = objc_alloc(*v5);
  uuid = [(HMDHome *)self uuid];
  uuid2 = [homeManager uuid];
  v9 = [v6 initWithObjectChangeType:3 uuid:uuid parentUUID:uuid2];

  return v9;
}

- (void)transactionObjectRemoved:(id)removed message:(id)message
{
  v56 = *MEMORY[0x277D85DE8];
  removedCopy = removed;
  messageCopy = message;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = removedCopy;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  if (!v9)
  {
    v11 = removedCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    residentDeviceManager = v12;

    if (!residentDeviceManager)
    {
      v21 = v11;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v22 = v21;
      }

      else
      {
        v22 = 0;
      }

      internalOnlyInitializer2 = v22;

      if (!internalOnlyInitializer2)
      {
        homeObjectChangeHandler = [(HMDHome *)self homeObjectChangeHandler];
        [homeObjectChangeHandler handleObjectRemove:v21 message:messageCopy];

        internalOnlyInitializer2 = 0;
LABEL_38:

        goto LABEL_39;
      }

      messagePayload = [messageCopy messagePayload];
      internalOnlyInitializer = [messagePayload hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      if (internalOnlyInitializer)
      {
        v25 = objc_autoreleasePoolPush();
        selfCopy = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          [internalOnlyInitializer UUID];
          v29 = v49 = v25;
          *buf = 138543618;
          v53 = v28;
          v54 = 2112;
          v55 = v29;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v49;
        }
      }

      else
      {
        internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        v25 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v39 = v50 = v25;
          uUID = [internalOnlyInitializer UUID];
          *buf = 138543618;
          v53 = v39;
          v54 = 2112;
          v55 = uUID;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed removed-user access code model", buf, 0x16u);

          v25 = v50;
        }
      }

      objc_autoreleasePoolPop(v25);
      accessCodeManager = [(HMDHome *)self accessCodeManager];
      dataManager = [accessCodeManager dataManager];

      if (dataManager)
      {
        [dataManager handleRemovedHMDRemovedUserAccessCodeModel:internalOnlyInitializer2 message:messageCopy flow:internalOnlyInitializer];
      }

      else
      {
        v43 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v46 = v51 = v43;
          *buf = 138543362;
          v53 = v46;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);

          v43 = v51;
        }

        objc_autoreleasePoolPop(v43);
        v47 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [messageCopy respondWithError:v47];
      }

LABEL_37:
      goto LABEL_38;
    }

    messagePayload2 = [messageCopy messagePayload];
    internalOnlyInitializer2 = [messagePayload2 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    if (internalOnlyInitializer2)
    {
      v15 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      uUID2 = [internalOnlyInitializer2 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = uUID2;
      v20 = "%{public}@[Flow: %@] Handling removed home access code model";
    }

    else
    {
      internalOnlyInitializer2 = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v15 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      v17 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        goto LABEL_23;
      }

      v18 = HMFGetLogIdentifier();
      uUID2 = [internalOnlyInitializer2 UUID];
      *buf = 138543618;
      v53 = v18;
      v54 = 2112;
      v55 = uUID2;
      v20 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling removed home access code model";
    }

    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, v20, buf, 0x16u);

LABEL_23:
    objc_autoreleasePoolPop(v15);
    accessCodeManager2 = [(HMDHome *)self accessCodeManager];
    internalOnlyInitializer = [accessCodeManager2 dataManager];

    if (internalOnlyInitializer)
    {
      [internalOnlyInitializer handleRemovedHomeAccessCodeModel:residentDeviceManager message:messageCopy flow:internalOnlyInitializer2];
    }

    else
    {
      v32 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543362;
        v53 = v35;
        _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v32);
      v36 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [messageCopy respondWithError:v36];
    }

    goto LABEL_37;
  }

  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  [residentDeviceManager transactionObjectRemoved:removedCopy message:messageCopy];
LABEL_39:

  v48 = *MEMORY[0x277D85DE8];
}

- (void)transactionObjectUpdated:(id)updated newValues:(id)values message:(id)message
{
  v119 = *MEMORY[0x277D85DE8];
  updatedCopy = updated;
  valuesCopy = values;
  messageCopy = message;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = valuesCopy;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;
  if (!v12)
  {
    v14 = valuesCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;

    if (v16)
    {
      [(HMDHome *)self updateHomeConfigurationWithModel:v16 message:messageCopy];
LABEL_114:

      goto LABEL_115;
    }

    v17 = v14;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (v19)
    {
      residentDeviceManager = [(HMDHome *)self residentDeviceManager];
      [residentDeviceManager transactionObjectUpdated:updatedCopy newValues:v17 message:messageCopy];

LABEL_113:
      goto LABEL_114;
    }

    v21 = v17;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    if (v23)
    {
      homeManager = [(HMDHome *)self homeManager];
      [homeManager transactionObjectUpdated:updatedCopy newValues:v21 message:messageCopy];

LABEL_112:
      goto LABEL_113;
    }

    v25 = v21;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v26 = v25;
    }

    else
    {
      v26 = 0;
    }

    v27 = v26;

    if (v27)
    {
      __transactionHomeSettingsUpdated(self, v27, messageCopy);
      v23 = 0;
LABEL_111:

      goto LABEL_112;
    }

    v28 = v25;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v29 = v28;
    }

    else
    {
      v29 = 0;
    }

    v30 = v29;

    if (v30)
    {
      __transactionHomeMediaSettingsUpdated(self, v30, messageCopy);
      v31 = v30;
      v23 = 0;
LABEL_110:

      goto LABEL_111;
    }

    v32 = v28;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v33 = v32;
    }

    else
    {
      v33 = 0;
    }

    v34 = v33;

    if (v34)
    {
      [(HMDHome *)self updateNetworkRouterSettingsWithModel:v34 message:messageCopy];
      v35 = v34;
      v23 = 0;
LABEL_109:

      v31 = 0;
      goto LABEL_110;
    }

    v36 = v32;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v37 = v36;
    }

    else
    {
      v37 = 0;
    }

    v38 = v37;

    if (v38)
    {
      [(HMDHome *)self updateNetworkRouterManagingDeviceSettingsWithModel:v38 message:messageCopy];
      v39 = v38;
      v23 = 0;
LABEL_108:

      v35 = 0;
      goto LABEL_109;
    }

    v40 = v36;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v41 = v40;
    }

    else
    {
      v41 = 0;
    }

    v42 = v41;

    if (v42)
    {
      [(HMDHome *)self _updateThreadNetworkWithModel:v42 message:messageCopy];
      v43 = v42;
      v23 = 0;
LABEL_107:

      v39 = 0;
      goto LABEL_108;
    }

    v44 = v40;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v45 = v44;
    }

    else
    {
      v45 = 0;
    }

    v46 = v45;

    if (v46)
    {
      v47 = updatedCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v48 = v47;
      }

      else
      {
        v48 = 0;
      }

      v109 = v48;

      personDataManager = [(HMDHome *)self personDataManager];
      [personDataManager handleUpdatedSettingsModel:v46 previousSettingsModel:v109 message:messageCopy];

      goto LABEL_106;
    }

    v50 = v44;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v51 = v50;
    }

    else
    {
      v51 = 0;
    }

    v52 = v51;

    v105 = v52;
    if (v52)
    {
      messagePayload = [messageCopy messagePayload];
      v54 = [messagePayload hmf_flowForKey:*MEMORY[0x277D0F1C8]];

      internalOnlyInitializer = v54;
      if (v54)
      {
        context = objc_autoreleasePoolPush();
        selfCopy = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          uUID = [v54 UUID];
          *buf = 138543618;
          v114 = v56;
          v115 = 2112;
          v116 = uUID;
          v58 = "%{public}@[Flow: %@] Handling updated home access code model";
LABEL_70:
          _os_log_impl(&dword_2531F8000, log, OS_LOG_TYPE_INFO, v58, buf, 0x16u);
        }
      }

      else
      {
        internalOnlyInitializer = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
        context = objc_autoreleasePoolPush();
        selfCopy2 = self;
        log = HMFGetOSLogHandle();
        if (os_log_type_enabled(log, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          uUID = [internalOnlyInitializer UUID];
          *buf = 138543618;
          v114 = v56;
          v115 = 2112;
          v116 = uUID;
          v58 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated home access code model";
          goto LABEL_70;
        }
      }

      objc_autoreleasePoolPop(context);
      accessCodeManager = [(HMDHome *)self accessCodeManager];
      dataManager = [accessCodeManager dataManager];

      loga = dataManager;
      if (!dataManager)
      {
        logb = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v72 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
        {
          v73 = HMFGetLogIdentifier();
          *buf = 138543362;
          v114 = v73;
          _os_log_impl(&dword_2531F8000, v72, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDHomeAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(logb);
        v74 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        [messageCopy respondWithError:v74];

        goto LABEL_105;
      }

      [dataManager handleUpdatedHomeAccessCodeModel:v105 message:messageCopy flow:internalOnlyInitializer];
LABEL_104:

LABEL_105:
      v46 = 0;
LABEL_106:

      v23 = 0;
      v43 = 0;
      goto LABEL_107;
    }

    v59 = v50;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v60 = v59;
    }

    else
    {
      v60 = 0;
    }

    v61 = v60;

    internalOnlyInitializer = v61;
    if (!v61)
    {
      v75 = v59;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v76 = v75;
      }

      else
      {
        v76 = 0;
      }

      v77 = v76;

      loga = v77;
      if (v77)
      {
        nfcReaderKey = [v77 nfcReaderKey];
        setProperties = [v77 setProperties];
        if ([setProperties containsObject:@"encodedNfcReaderKey"])
        {
          nfcReaderKey2 = [(HMDHome *)self nfcReaderKey];
          contextd = HMFEqualObjects();

          if ((contextd & 1) == 0)
          {
            contextb = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v81 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v81, OS_LOG_TYPE_INFO))
            {
              v98 = HMFGetLogIdentifier();
              [(HMDHome *)selfCopy4 nfcReaderKey];
              *buf = 138543874;
              v114 = v98;
              v116 = v115 = 2112;
              v82 = v116;
              v117 = 2112;
              v118 = nfcReaderKey;
              _os_log_impl(&dword_2531F8000, v81, OS_LOG_TYPE_INFO, "%{public}@Updating nfc reader key from %@ -> %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(contextb);
            dictionary = [MEMORY[0x277CBEB38] dictionary];
            nfcReaderKey3 = [(HMDHome *)selfCopy4 nfcReaderKey];
            [dictionary setObject:nfcReaderKey3 forKeyedSubscript:@"HMDHomeDidUpdateNFCReaderKeyNotificationKeyPreviousNFCReaderKey"];

            [(HMDHome *)selfCopy4 setNfcReaderKey:nfcReaderKey];
            logAndPostNotification(@"HMDHomeDidUpdateNFCReaderKeyNotification", selfCopy4, dictionary);
            transactionResult = [messageCopy transactionResult];
            [transactionResult markChanged];
          }
        }

        else
        {
        }

        [messageCopy respondWithSuccess];
      }

      else
      {
        v92 = v75;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v93 = v92;
        }

        else
        {
          v93 = 0;
        }

        v94 = v93;
        v112 = v92;

        if (v94)
        {
          [(HMDHome *)self updateROARStatus:v94 message:messageCopy];
          [messageCopy respondWithSuccess];
        }

        else
        {
          homeObjectChangeHandler = [(HMDHome *)self homeObjectChangeHandler];
          [homeObjectChangeHandler handleObjectUpdate:updatedCopy newValues:v112 message:messageCopy];
        }

        loga = 0;
      }

      internalOnlyInitializer = 0;
      goto LABEL_104;
    }

    messagePayload2 = [messageCopy messagePayload];
    v63 = [messagePayload2 hmf_flowForKey:*MEMORY[0x277D0F1C8]];

    loga = v63;
    if (v63)
    {
      v97 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        uUID2 = [v63 UUID];
        *buf = 138543618;
        v114 = v65;
        v115 = 2112;
        v116 = uUID2;
        v67 = "%{public}@[Flow: %@] Handling updated removed-user access code model";
LABEL_87:
        _os_log_impl(&dword_2531F8000, contexta, OS_LOG_TYPE_INFO, v67, buf, 0x16u);
      }
    }

    else
    {
      loga = [MEMORY[0x277D0F7B8] internalOnlyInitializer];
      v97 = objc_autoreleasePoolPush();
      selfCopy6 = self;
      contexta = HMFGetOSLogHandle();
      if (os_log_type_enabled(contexta, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        uUID2 = [loga UUID];
        *buf = 138543618;
        v114 = v65;
        v115 = 2112;
        v116 = uUID2;
        v67 = "%{public}@[NewFlow: %@ {Feature:Pin Codes}] Handling updated removed-user access code model";
        goto LABEL_87;
      }
    }

    objc_autoreleasePoolPop(v97);
    accessCodeManager2 = [(HMDHome *)self accessCodeManager];
    dataManager2 = [accessCodeManager2 dataManager];

    if (dataManager2)
    {
      [dataManager2 handleUpdatedHMDRemovedUserAccessCodeModel:internalOnlyInitializer message:messageCopy flow:loga];
    }

    else
    {
      contextc = objc_autoreleasePoolPush();
      selfCopy7 = self;
      v90 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v90, OS_LOG_TYPE_ERROR))
      {
        v99 = HMFGetLogIdentifier();
        *buf = 138543362;
        v114 = v99;
        _os_log_impl(&dword_2531F8000, v90, OS_LOG_TYPE_ERROR, "%{public}@Not handling removed HMDRemovedUserAccessCodeModel because self.accessCodeManager.dataManager is nil", buf, 0xCu);
      }

      objc_autoreleasePoolPop(contextc);
      v91 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
      [messageCopy respondWithError:v91];
    }

    goto LABEL_104;
  }

  v13 = [(HMDHome *)self updateHomeWithModel:v12 message:messageCopy];
LABEL_115:

  v96 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterManagingDeviceSettingsWithModel:(id)model message:(id)message
{
  modelCopy = model;
  messageCopy = message;
  setProperties = [modelCopy setProperties];
  if ([setProperties containsObject:@"primaryNetworkRouterManagingDeviceUUID"])
  {
    primaryNetworkRouterManagingDeviceUUID = [(HMDHome *)self primaryNetworkRouterManagingDeviceUUID];
    uUIDString = [primaryNetworkRouterManagingDeviceUUID UUIDString];
    primaryNetworkRouterManagingDeviceUUID2 = [modelCopy primaryNetworkRouterManagingDeviceUUID];
    v11 = HMFEqualObjects();

    if (v11)
    {
      goto LABEL_5;
    }

    v12 = objc_alloc(MEMORY[0x277CCAD78]);
    primaryNetworkRouterManagingDeviceUUID3 = [modelCopy primaryNetworkRouterManagingDeviceUUID];
    setProperties = [v12 initWithUUIDString:primaryNetworkRouterManagingDeviceUUID3];

    [(HMDHome *)self setPrimaryNetworkRouterManagingDeviceUUID:setProperties];
    transactionResult = [messageCopy transactionResult];
    [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:transactionResult];
    [transactionResult markChanged];
  }

LABEL_5:
  [messageCopy respondWithPayload:0];
}

- (void)setHomeUpdatedToROARAndInformClients
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isUpdatedToHH2])
  {
    v3 = objc_autoreleasePoolPush();
    selfCopy = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is already set on this home. Not doing anything.", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else if (![(HMDHome *)self isUpdatedToHH2])
  {
    [(HMDHome *)self setIsUpdatedToHH2:1];
    v7 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Marked home upgraded to HH2 & informing clients about the status", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [(HMDHome *)selfCopy2 saveWithReason:@"Upgraded To HH2" postSyncNotification:0 objectChange:1];
    homeManager = [(HMDHome *)selfCopy2 homeManager];
    [homeManager checkAndMoveDirectlyToHH2IfOnlyHH2SharedHomesExistAllowEmptyOwnedHomes:1];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)updateROARStatus:(id)status message:(id)message
{
  v20 = *MEMORY[0x277D85DE8];
  statusCopy = status;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v17 = v11;
    v18 = 2112;
    v19 = statusCopy;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Found ROAR Model : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  transactionResult = [messageCopy transactionResult];
  workQueue = [(HMDHome *)selfCopy workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __36__HMDHome_updateROARStatus_message___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = selfCopy;
  dispatch_async(workQueue, block);

  [transactionResult markSaveToAssistant];
  [transactionResult markChanged];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)updateNetworkRouterSettingsWithModel:(id)model message:(id)message
{
  v59 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionResult = [messageCopy transactionResult];
  setProperties = [modelCopy setProperties];
  v10 = [setProperties containsObject:@"activeNetworkRouterAccessoryUUID"];

  if (v10)
  {
    v11 = objc_alloc(MEMORY[0x277CCAD78]);
    activeNetworkRouterAccessoryUUID = [modelCopy activeNetworkRouterAccessoryUUID];
    v13 = [v11 initWithUUIDString:activeNetworkRouterAccessoryUUID];

    activeNetworkRouterUUID = [(HMDHome *)self activeNetworkRouterUUID];
    v15 = HMFEqualObjects();

    if ((v15 & 1) == 0)
    {
      [(HMDHome *)self setActiveNetworkRouterUUID:v13];
      if (v13)
      {
        activeNetworkRouterAccessoryUUID2 = [modelCopy activeNetworkRouterAccessoryUUID];
        activeNetworkRouterInitialSetupNeededUUID = [modelCopy activeNetworkRouterInitialSetupNeededUUID];
        -[HMDHome setActiveNetworkRouterInitialSetupNeeded:](self, "setActiveNetworkRouterInitialSetupNeeded:", [activeNetworkRouterAccessoryUUID2 isEqual:activeNetworkRouterInitialSetupNeededUUID]);
      }

      else
      {
        [(HMDHome *)self setActiveNetworkRouterInitialSetupNeeded:0];
      }
    }

    v18 = v15 ^ 1;
  }

  else
  {
    v18 = 0;
  }

  setProperties2 = [modelCopy setProperties];
  v20 = [setProperties2 containsObject:@"minimumNetworkRouterSupportHomeKitVersion"];

  if (v20)
  {
    minimumNetworkRouterSupportHomeKitVersion = [modelCopy minimumNetworkRouterSupportHomeKitVersion];

    if (minimumNetworkRouterSupportHomeKitVersion)
    {
      v22 = [HMDHomeKitVersion alloc];
      minimumNetworkRouterSupportHomeKitVersion2 = [modelCopy minimumNetworkRouterSupportHomeKitVersion];
      minimumNetworkRouterSupportHomeKitVersion = [(HMDHomeKitVersion *)v22 initWithString:minimumNetworkRouterSupportHomeKitVersion2];
    }

    v24 = +[HMDHomeKitVersion version6];
    if (-[HMDHome isOwnerUser](self, "isOwnerUser") && [transactionResult source] != 1 && -[HMDHomeKitVersion isGreaterThanVersion:](minimumNetworkRouterSupportHomeKitVersion, "isGreaterThanVersion:", v24))
    {
      v25 = objc_autoreleasePoolPush();
      selfCopy = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v45 = v25;
        v29 = v28 = v24;
        *buf = 138543874;
        v54 = v29;
        v55 = 2112;
        v56 = minimumNetworkRouterSupportHomeKitVersion;
        v57 = 2112;
        v58 = v28;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Overriding minimum router support HomeKit version to enable network router support from %@ in cloud to our version %@", buf, 0x20u);

        v24 = v28;
        v25 = v45;
      }

      objc_autoreleasePoolPop(v25);
      workQueue = [(HMDHome *)selfCopy workQueue];
      block = MEMORY[0x277D85DD0];
      v47 = 3221225472;
      v48 = __56__HMDHome_updateNetworkRouterSettingsWithModel_message___block_invoke;
      v49 = &unk_279734960;
      v50 = selfCopy;
      v51 = minimumNetworkRouterSupportHomeKitVersion;
      v52 = messageCopy;
      dispatch_async(workQueue, &block);
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        [(HMDHome *)selfCopy2 minimumNetworkRouterSupportHomeKitVersion];
        v45 = transactionResult;
        v36 = v35 = v24;
        *buf = 138543874;
        v54 = v34;
        v55 = 2112;
        v56 = v36;
        v57 = 2112;
        v58 = minimumNetworkRouterSupportHomeKitVersion;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Updating minimum router support HomeKit version to enable network router support from %@ to cloud version %@", buf, 0x20u);

        v24 = v35;
        transactionResult = v45;
      }

      objc_autoreleasePoolPop(v31);
      [(HMDHome *)selfCopy2 setMinimumNetworkRouterSupportHomeKitVersion:minimumNetworkRouterSupportHomeKitVersion];
      v18 = 1;
    }
  }

  setProperties3 = [modelCopy setProperties];
  v38 = [setProperties3 containsObject:@"minHomeKitVersionForAccessoryNetworkProtectionChange"];

  if (v38)
  {
    minHomeKitVersionForAccessoryNetworkProtectionChange = [modelCopy minHomeKitVersionForAccessoryNetworkProtectionChange];

    if (minHomeKitVersionForAccessoryNetworkProtectionChange)
    {
      v40 = [HMDHomeKitVersion alloc];
      minHomeKitVersionForAccessoryNetworkProtectionChange2 = [modelCopy minHomeKitVersionForAccessoryNetworkProtectionChange];
      minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHomeKitVersion *)v40 initWithString:minHomeKitVersionForAccessoryNetworkProtectionChange2];
    }

    minHomeKitVersionForAccessoryNetworkProtectionChange3 = [(HMDHome *)self minHomeKitVersionForAccessoryNetworkProtectionChange];
    v43 = HMFEqualObjects();

    if (v43)
    {

      if ((v18 & 1) == 0)
      {
        goto LABEL_31;
      }
    }

    else
    {
      [(HMDHome *)self setMinHomeKitVersionForAccessoryNetworkProtectionChange:minHomeKitVersionForAccessoryNetworkProtectionChange];
    }
  }

  else if (!v18)
  {
    goto LABEL_31;
  }

  [(HMDHome *)self _evaluateNetworkRouterManagementForTransaction:transactionResult];
  [transactionResult markChanged];
LABEL_31:
  [messageCopy respondWithPayload:0];

  v44 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeConfigurationWithModel:(id)model message:(id)message
{
  v31 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionResult = [messageCopy transactionResult];
  setProperties = [modelCopy setProperties];
  v10 = [setProperties containsObject:@"configurationVersion"];

  if (v10)
  {
    configurationVersion = [modelCopy configurationVersion];
    integerValue = [configurationVersion integerValue];

    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = 138544130;
      v24 = v16;
      v25 = 2048;
      v26 = integerValue;
      v27 = 2048;
      lastSyncedConfigurationVersion = [(HMDHome *)selfCopy lastSyncedConfigurationVersion];
      v29 = 2048;
      configurationVersion2 = [(HMDHome *)selfCopy configurationVersion];
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Received incoming configuration version %lu, last synced was %lu, and current is %lu", &v23, 0x2Au);
    }

    objc_autoreleasePoolPop(v13);
    if ([(HMDHome *)selfCopy isOwnerUser])
    {
      if (integerValue >= [(HMDHome *)selfCopy configurationVersion])
      {
        configurationVersion3 = [(HMDHome *)selfCopy configurationVersion];
        if (configurationVersion3 <= [(HMDHome *)selfCopy lastSyncedConfigurationVersion])
        {
          [(HMDHome *)selfCopy setConfigurationVersion:integerValue];
        }

        else
        {
          [(HMDHome *)selfCopy setConfigurationVersion:integerValue + 1];
          [(HMDHome *)selfCopy __saveConfigurationVersionTransaction];
        }

        [(HMDHome *)selfCopy setLastSyncedConfigurationVersion:integerValue];
      }

      else
      {
        [(HMDHome *)selfCopy __saveConfigurationVersionTransaction];
      }
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = selfCopy;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v20 = HMFGetLogIdentifier();
        v23 = 138543362;
        v24 = v20;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Shared user will use incoming configuration version", &v23, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      [(HMDHome *)v18 setConfigurationVersion:integerValue];
      [(HMDHome *)v18 setLastSyncedConfigurationVersion:integerValue];
      [(HMDHome *)v18 setExpectedConfigurationVersion:0];
    }
  }

  [messageCopy respondWithPayload:0];
  [transactionResult markChanged];

  v22 = *MEMORY[0x277D85DE8];
}

- (id)updateHomeWithModel:(id)model message:(id)message
{
  v207 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionResult = [(HMDHome *)messageCopy transactionResult];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138543874;
    v202 = v12;
    v203 = 2112;
    v204 = modelCopy;
    v205 = 2112;
    v206 = messageCopy;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Updating home with model: %@ / %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v9);
  setProperties = [(__CFString *)modelCopy setProperties];
  v14 = [setProperties containsObject:@"primaryResidentUUID"];

  v186 = transactionResult;
  if (v14)
  {
    primaryResidentUUID = [(__CFString *)modelCopy primaryResidentUUID];

    if (primaryResidentUUID)
    {
      v16 = objc_alloc(MEMORY[0x277CCAD78]);
      primaryResidentUUID2 = [(__CFString *)modelCopy primaryResidentUUID];
      primaryResidentUUID = [v16 initWithUUIDString:primaryResidentUUID2];
    }

    residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
    primaryResidentUUID3 = [residentDeviceManager primaryResidentUUID];

    primaryResident = [(HMDHome *)selfCopy primaryResident];
    device = [primaryResident device];

    residentDeviceManager2 = [(HMDHome *)selfCopy residentDeviceManager];
    [residentDeviceManager2 updatePrimaryResidentWithUUID:primaryResidentUUID actions:transactionResult];

    if (HMFEqualObjects())
    {
      v23 = objc_autoreleasePoolPush();
      v24 = selfCopy;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543362;
        v202 = v26;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Not resubscribing since the primary resident did not change", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      transactionResult = v186;
    }

    else
    {
      backingStore = [(HMDHome *)selfCopy backingStore];
      v195[0] = MEMORY[0x277D85DD0];
      v195[1] = 3221225472;
      v195[2] = __39__HMDHome_updateHomeWithModel_message___block_invoke;
      v195[3] = &unk_279730430;
      v195[4] = selfCopy;
      v196 = primaryResidentUUID;
      v197 = primaryResidentUUID3;
      v198 = device;
      [backingStore submitBlock:v195];
    }

    if ([transactionResult source] == 1)
    {
      residentDeviceManager3 = [(HMDHome *)selfCopy residentDeviceManager];
      primaryResidentDevice = [residentDeviceManager3 primaryResidentDevice];
      isReachable = [primaryResidentDevice isReachable];

      if ((isReachable & 1) == 0)
      {
        residentDeviceManager4 = [(HMDHome *)selfCopy residentDeviceManager];
        [residentDeviceManager4 electResidentDevice:1];
      }
    }
  }

  currentUser = [(HMDHome *)selfCopy currentUser];
  setProperties2 = [(__CFString *)modelCopy setProperties];
  v33 = [setProperties2 containsObject:@"presenceAuthorizationStatus"];

  if (v33)
  {
    v34 = MEMORY[0x277CD1F00];
    presenceAuthorizationStatus = [(__CFString *)modelCopy presenceAuthorizationStatus];
    v36 = [v34 authWithNumber:presenceAuthorizationStatus];

    if (isPresenceAuthorizationValid())
    {
      presenceAuthStatus = [(HMDHome *)selfCopy presenceAuthStatus];
      v38 = HMFEqualObjects();

      if (v38)
      {
        v39 = objc_autoreleasePoolPush();
        v40 = selfCopy;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          presenceAuthStatus2 = [(HMDHome *)v40 presenceAuthStatus];
          *buf = 138543618;
          v202 = v42;
          v203 = 2112;
          v204 = presenceAuthStatus2;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Presence auth is not changing from %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        transactionResult = v186;
      }

      else
      {
        [(HMDHome *)selfCopy setPresenceAuthStatus:v36];
        [currentUser setPresenceAuthStatus:v36];
        [transactionResult markChanged];
      }

      v182 = v38 ^ 1;
      if (![(HMDHome *)selfCopy isOwnerUser])
      {
        [transactionResult markSaveToSharedUserAccount];
      }
    }

    else
    {
      v44 = objc_autoreleasePoolPush();
      v45 = selfCopy;
      v46 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
      {
        v47 = HMFGetLogIdentifier();
        presenceAuthorizationStatus2 = [(__CFString *)modelCopy presenceAuthorizationStatus];
        *buf = 138543618;
        v202 = v47;
        v203 = 2112;
        v204 = presenceAuthorizationStatus2;
        _os_log_impl(&dword_2531F8000, v46, OS_LOG_TYPE_INFO, "%{public}@Ignoring the value for presence auth in home model: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v44);
      v182 = 0;
    }
  }

  else
  {
    v182 = 0;
  }

  setProperties3 = [(__CFString *)modelCopy setProperties];
  v50 = [setProperties3 containsObject:@"presenceComputeStatus"];

  if (v50)
  {
    v51 = MEMORY[0x277CD1F08];
    presenceComputeStatus = [(__CFString *)modelCopy presenceComputeStatus];
    v53 = [v51 computeWithNumber:presenceComputeStatus];

    if (v53)
    {
      presenceComputeStatus2 = [(HMDHome *)selfCopy presenceComputeStatus];
      v55 = HMFEqualObjects();

      if ((v55 & 1) == 0)
      {
        [(HMDHome *)selfCopy setPresenceComputeStatus:v53];
        if (![(HMDHome *)selfCopy isOwnerUser])
        {
          [transactionResult markSaveToSharedUserAccount];
        }

        [transactionResult markChanged];
      }
    }
  }

  setProperties4 = [(__CFString *)modelCopy setProperties];
  v57 = [setProperties4 containsObject:@"homeLocationData"];

  v183 = messageCopy;
  if (v57)
  {
    homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
    v59 = [homeLocationHandler _handleHomeLocationData:modelCopy message:messageCopy];

    if (v59)
    {
      v60 = v59;
    }

    else
    {
      v61 = [MEMORY[0x277CBEB58] set];
      v191 = 0u;
      v192 = 0u;
      v193 = 0u;
      v194 = 0u;
      dataSource = [(HMDHome *)selfCopy dataSource];
      xpcMessageTransport = [dataSource xpcMessageTransport];
      connections = [xpcMessageTransport connections];

      v65 = [connections countByEnumeratingWithState:&v191 objects:v200 count:16];
      if (v65)
      {
        v66 = v65;
        v67 = *v192;
        do
        {
          for (i = 0; i != v66; ++i)
          {
            if (*v192 != v67)
            {
              objc_enumerationMutation(connections);
            }

            processInfo = [*(*(&v191 + 1) + 8 * i) processInfo];
            locationAuthorization = [processInfo locationAuthorization];

            if (locationAuthorization)
            {
              [v61 addObject:locationAuthorization];
            }
          }

          v66 = [connections countByEnumeratingWithState:&v191 objects:v200 count:16];
        }

        while (v66);
      }

      v189 = 0u;
      v190 = 0u;
      v187 = 0u;
      v188 = 0u;
      v71 = v61;
      v72 = [v71 countByEnumeratingWithState:&v187 objects:v199 count:16];
      transactionResult = v186;
      if (v72)
      {
        v73 = v72;
        v74 = *v188;
        do
        {
          for (j = 0; j != v73; ++j)
          {
            if (*v188 != v74)
            {
              objc_enumerationMutation(v71);
            }

            v76 = *(*(&v187 + 1) + 8 * j);
            if ([v76 isAuthorized])
            {
              [v76 mark];
            }
          }

          v73 = [v71 countByEnumeratingWithState:&v187 objects:v199 count:16];
        }

        while (v73);
      }

      v60 = 0;
      messageCopy = v183;
    }
  }

  else
  {
    v60 = 0;
  }

  naturalLightingContext = [(__CFString *)modelCopy naturalLightingContext];
  setProperties5 = [(__CFString *)modelCopy setProperties];
  v184 = naturalLightingContext;
  if ([setProperties5 containsObject:@"encodedNaturalLightingContext"])
  {
    naturalLightingContext2 = [(HMDHome *)selfCopy naturalLightingContext];
    v80 = [naturalLightingContext2 isEqual:naturalLightingContext];

    if ((v80 & 1) == 0)
    {
      v81 = objc_autoreleasePoolPush();
      v82 = selfCopy;
      v83 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v83, OS_LOG_TYPE_INFO))
      {
        v84 = HMFGetLogIdentifier();
        naturalLightingContext3 = [(HMDHome *)v82 naturalLightingContext];
        *buf = 138543874;
        v202 = v84;
        v203 = 2112;
        v204 = naturalLightingContext3;
        v205 = 2112;
        v206 = naturalLightingContext;
        _os_log_impl(&dword_2531F8000, v83, OS_LOG_TYPE_INFO, "%{public}@Updating natural lighting context from %@ -> %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v81);
      [(HMDHome *)v82 setNaturalLightingContext:naturalLightingContext];
      transactionResult = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  setProperties6 = [(__CFString *)modelCopy setProperties];
  if (![setProperties6 containsObject:@"name"])
  {
    goto LABEL_71;
  }

  name = [(__CFString *)modelCopy name];
  name2 = [(HMDHome *)selfCopy name];
  v89 = [name isEqualToString:name2];

  if ((v89 & 1) == 0)
  {
    v90 = [(HMDHome *)selfCopy _handleRenameHomeModel:modelCopy message:messageCopy];
    setProperties6 = v90;
    if (v90)
    {
      v91 = v90;

      v60 = v91;
    }

    [transactionResult markSaveToAssistant];
    [transactionResult markChanged];
LABEL_71:
  }

  creationDate = [(__CFString *)modelCopy creationDate];
  if (creationDate)
  {
    v93 = creationDate;
    creationDate2 = [(__CFString *)modelCopy creationDate];
    creationDate3 = [(HMDHome *)selfCopy creationDate];
    v96 = [creationDate2 isEqualToDate:creationDate3];

    if ((v96 & 1) == 0)
    {
      creationDate4 = [(__CFString *)modelCopy creationDate];
      [(HMDHome *)selfCopy setCreationDate:creationDate4];

      [transactionResult markChanged];
    }
  }

  firstHAPAccessoryAddedDate = [(__CFString *)modelCopy firstHAPAccessoryAddedDate];
  if (firstHAPAccessoryAddedDate)
  {
    v99 = firstHAPAccessoryAddedDate;
    firstHAPAccessoryAddedDate2 = [(__CFString *)modelCopy firstHAPAccessoryAddedDate];
    firstHAPAccessoryAddedDate3 = [(HMDHome *)selfCopy firstHAPAccessoryAddedDate];
    v102 = [firstHAPAccessoryAddedDate2 isEqualToDate:firstHAPAccessoryAddedDate3];

    if ((v102 & 1) == 0)
    {
      firstHAPAccessoryAddedDate4 = [(__CFString *)modelCopy firstHAPAccessoryAddedDate];
      [(HMDHome *)selfCopy setFirstHAPAccessoryAddedDate:firstHAPAccessoryAddedDate4];

      [transactionResult markChanged];
    }
  }

  setProperties7 = [(__CFString *)modelCopy setProperties];
  if ([setProperties7 containsObject:@"multiUserEnabled"])
  {
    multiUserEnabled = [(__CFString *)modelCopy multiUserEnabled];
    bOOLValue = [multiUserEnabled BOOLValue];
    isMultiUserEnabled = [(HMDHome *)selfCopy isMultiUserEnabled];

    if (bOOLValue != isMultiUserEnabled)
    {
      v108 = objc_autoreleasePoolPush();
      v109 = selfCopy;
      v110 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v110, OS_LOG_TYPE_INFO))
      {
        v111 = HMFGetLogIdentifier();
        multiUserEnabled2 = [(__CFString *)modelCopy multiUserEnabled];
        v113 = @"YES";
        *buf = 138543874;
        v202 = v111;
        v203 = 2112;
        if (!multiUserEnabled2)
        {
          v113 = @"NO";
        }

        v204 = v113;
        v205 = 2112;
        v206 = v109;
        _os_log_impl(&dword_2531F8000, v110, OS_LOG_TYPE_INFO, "%{public}@Merging multi-user enabled value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v108);
      [(HMDHome *)v109 _handleMultiUserEnabledChange:modelCopy message:messageCopy];
      transactionResult = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  if ([(__CFString *)modelCopy propertyWasSet:@"soundCheckEnabled"])
  {
    soundCheckEnabled = [(__CFString *)modelCopy soundCheckEnabled];
    bOOLValue2 = [soundCheckEnabled BOOLValue];
    soundCheckEnabled2 = [(HMDHome *)selfCopy soundCheckEnabled];

    if (bOOLValue2 != soundCheckEnabled2)
    {
      [(HMDHome *)selfCopy _handleSoundCheckChange:modelCopy message:messageCopy];
      [transactionResult markChanged];
    }
  }

  if ([(__CFString *)modelCopy propertyWasSet:@"siriPhraseOptions"])
  {
    siriPhraseOptions = [(__CFString *)modelCopy siriPhraseOptions];
    unsignedIntegerValue = [siriPhraseOptions unsignedIntegerValue];
    siriPhraseOptions2 = [(HMDHome *)selfCopy siriPhraseOptions];

    if (unsignedIntegerValue != siriPhraseOptions2)
    {
      [(HMDHome *)selfCopy _handleSiriPhraseOptionsStatusChange:modelCopy message:messageCopy];
      [transactionResult markChanged];
    }
  }

  if ([(__CFString *)modelCopy propertyWasSet:@"locationServicesEnabled"])
  {
    locationServicesEnabled = [(__CFString *)modelCopy locationServicesEnabled];
    bOOLValue3 = [locationServicesEnabled BOOLValue];
    locationServicesEnabled2 = [(HMDHome *)selfCopy locationServicesEnabled];

    if (bOOLValue3 != locationServicesEnabled2)
    {
      [(HMDHome *)selfCopy _handleLocationServicesEnabledChange:modelCopy message:messageCopy];
      [transactionResult markChanged];
    }
  }

  if ([(__CFString *)modelCopy propertyWasSet:@"didOnboardLocationServices"])
  {
    didOnboardLocationServices = [(__CFString *)modelCopy didOnboardLocationServices];
    bOOLValue4 = [didOnboardLocationServices BOOLValue];
    didOnboardLocationServices2 = [(HMDHome *)selfCopy didOnboardLocationServices];

    if (bOOLValue4 != didOnboardLocationServices2)
    {
      [(HMDHome *)selfCopy _handleDidOnboardLocationServicesChange:modelCopy message:messageCopy];
      [transactionResult markChanged];
    }
  }

  setProperties8 = [(__CFString *)modelCopy setProperties];
  if ([setProperties8 containsObject:@"hasAnyUserAcknowledgedCameraRecordingOnboarding"])
  {
    hasAnyUserAcknowledgedCameraRecordingOnboarding = [(__CFString *)modelCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];
    bOOLValue5 = [hasAnyUserAcknowledgedCameraRecordingOnboarding BOOLValue];
    hasAnyUserAcknowledgedCameraRecordingOnboarding2 = [(HMDHome *)selfCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];

    if (bOOLValue5 != hasAnyUserAcknowledgedCameraRecordingOnboarding2)
    {
      v130 = objc_autoreleasePoolPush();
      v131 = selfCopy;
      v132 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v132, OS_LOG_TYPE_INFO))
      {
        v133 = HMFGetLogIdentifier();
        hasAnyUserAcknowledgedCameraRecordingOnboarding3 = [(__CFString *)modelCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];
        v135 = @"YES";
        *buf = 138543874;
        v202 = v133;
        v203 = 2112;
        if (!hasAnyUserAcknowledgedCameraRecordingOnboarding3)
        {
          v135 = @"NO";
        }

        v204 = v135;
        v205 = 2112;
        v206 = v131;
        _os_log_impl(&dword_2531F8000, v132, OS_LOG_TYPE_INFO, "%{public}@Merging home's has any user acknowledged camera recording onboarding value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v130);
      [(HMDHome *)v131 _handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:modelCopy message:messageCopy];
      transactionResult = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  setProperties9 = [(__CFString *)modelCopy setProperties];
  if ([setProperties9 containsObject:@"hasOnboardedForAccessCode"])
  {
    hasOnboardedForAccessCode = [(__CFString *)modelCopy hasOnboardedForAccessCode];
    bOOLValue6 = [hasOnboardedForAccessCode BOOLValue];
    hasOnboardedForAccessCode2 = [(HMDHome *)selfCopy hasOnboardedForAccessCode];

    if (bOOLValue6 != hasOnboardedForAccessCode2)
    {
      v140 = objc_autoreleasePoolPush();
      v141 = selfCopy;
      v142 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v142, OS_LOG_TYPE_INFO))
      {
        v143 = HMFGetLogIdentifier();
        hasOnboardedForAccessCode3 = [(__CFString *)modelCopy hasOnboardedForAccessCode];
        [hasOnboardedForAccessCode3 BOOLValue];
        v145 = HMFBooleanToString();
        *buf = 138543874;
        v202 = v143;
        v203 = 2112;
        v204 = v145;
        v205 = 2112;
        v206 = v141;
        _os_log_impl(&dword_2531F8000, v142, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for access code value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v140);
      [(HMDHome *)v141 _handleSetHasOnboardedForAccessCodeChange:modelCopy message:messageCopy];
      transactionResult = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  setProperties10 = [(__CFString *)modelCopy setProperties];
  if ([setProperties10 containsObject:@"hasOnboardedForWalletKey"])
  {
    hasOnboardedForWalletKey = [(__CFString *)modelCopy hasOnboardedForWalletKey];
    bOOLValue7 = [hasOnboardedForWalletKey BOOLValue];
    hasOnboardedForWalletKey2 = [(HMDHome *)selfCopy hasOnboardedForWalletKey];

    if (bOOLValue7 != hasOnboardedForWalletKey2)
    {
      v150 = objc_autoreleasePoolPush();
      v151 = selfCopy;
      v152 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v152, OS_LOG_TYPE_INFO))
      {
        v153 = HMFGetLogIdentifier();
        hasOnboardedForWalletKey3 = [(__CFString *)modelCopy hasOnboardedForWalletKey];
        [hasOnboardedForWalletKey3 BOOLValue];
        v155 = HMFBooleanToString();
        *buf = 138543874;
        v202 = v153;
        v203 = 2112;
        v204 = v155;
        v205 = 2112;
        v206 = v151;
        _os_log_impl(&dword_2531F8000, v152, OS_LOG_TYPE_INFO, "%{public}@Merging home's has onboarded for wallet key value %@ into home: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v150);
      [(HMDHome *)v151 _handleSetHasOnboardedForWalletKeyChange:modelCopy message:messageCopy];
      transactionResult = v186;
      [v186 markChanged];
    }
  }

  else
  {
  }

  setProperties11 = [(__CFString *)modelCopy setProperties];
  v157 = [setProperties11 containsObject:@"networkProtectionMode"];

  if (v157)
  {
    [(HMDHome *)selfCopy _handleUpdateNetworkProtectionWithHomeModel:modelCopy message:messageCopy];
  }

  if (![(HMDHome *)selfCopy isOwnerUser])
  {
    v165 = [transactionResult source] != 2 && objc_msgSend(transactionResult, "source") != 3;
    setProperties12 = [(__CFString *)modelCopy setProperties];
    v171 = [setProperties12 containsObject:@"sharedHomeSourceVersion"];

    if (v171)
    {
      if (v165)
      {
        [(HMDHome *)selfCopy _handleReceivedNonCloudSourcedSharedHomeModel];
        v172 = objc_autoreleasePoolPush();
        v173 = selfCopy;
        v174 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v174, OS_LOG_TYPE_INFO))
        {
          v175 = HMFGetLogIdentifier();
          sharedHomeSourceVersion = [(HMDHome *)v173 sharedHomeSourceVersion];
          sharedHomeSourceVersion2 = [(__CFString *)modelCopy sharedHomeSourceVersion];
          *buf = 138543874;
          v202 = v175;
          v203 = 2112;
          v204 = sharedHomeSourceVersion;
          v205 = 2112;
          v206 = sharedHomeSourceVersion2;
          _os_log_impl(&dword_2531F8000, v174, OS_LOG_TYPE_INFO, "%{public}@Updating shared home source version from %@ to %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v172);
        sharedHomeSourceVersion3 = [(HMDHome *)v173 sharedHomeSourceVersion];
        sharedHomeSourceVersion4 = [(__CFString *)modelCopy sharedHomeSourceVersion];
        v180 = HMFEqualObjects();

        transactionResult = v186;
        if ((v180 & 1) == 0)
        {
          sharedHomeSourceVersion5 = [(__CFString *)modelCopy sharedHomeSourceVersion];
          [(HMDHome *)v173 setSharedHomeSourceVersion:sharedHomeSourceVersion5];

          [v186 markChanged];
        }
      }
    }
  }

  if ([(__CFString *)modelCopy propertyWasSet:@"threadOperationalDataset"])
  {
    threadOperationalDataset = [(__CFString *)modelCopy threadOperationalDataset];

    if (threadOperationalDataset)
    {
      [(HMDHome *)selfCopy updateThreadOperationalDatasetWithHomeModel:modelCopy message:v183];
    }
  }

  [(HMDHome *)selfCopy handleUpdatedCHIPPropertiesOnHomeModel:modelCopy actions:transactionResult];
  responseHandler = [(HMDHome *)v183 responseHandler];

  if (responseHandler)
  {
    responseHandler2 = [(HMDHome *)v183 responseHandler];
    (responseHandler2)[2](responseHandler2, v60, 0);
  }

  if (v182)
  {
    name3 = [(HMDHome *)v183 name];
    v162 = HMFEqualObjects();

    presenceFeeder = [(HMDHome *)selfCopy presenceFeeder];
    v164 = presenceFeeder;
    if (v162)
    {
      [presenceFeeder presenceAuthChanged];
    }

    else
    {
      presenceAuthStatus3 = [(HMDHome *)selfCopy presenceAuthStatus];
      [v164 presenceAuthStatusChangedForUser:currentUser presenceAuthStatus:presenceAuthStatus3];
    }
  }

  v167 = v60;

  v168 = *MEMORY[0x277D85DE8];
  return v60;
}

void __39__HMDHome_updateHomeWithModel_message___block_invoke(uint64_t a1, void *a2)
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = *(a1 + 48);
    v11 = 138543874;
    v12 = v7;
    v13 = 2112;
    v14 = v8;
    v15 = 2112;
    v16 = v9;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Scheduling resubscription for new primary resident: %@, old primary: %@", &v11, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 32) resubscribeForNotificationsOnResident:*(a1 + 56)];

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateNetworkProtectionWithHomeModel:(id)model message:(id)message
{
  messageCopy = message;
  networkProtectionMode = [model networkProtectionMode];
  unsignedIntegerValue = [networkProtectionMode unsignedIntegerValue];

  if ([(HMDHome *)self protectionMode]!= unsignedIntegerValue)
  {
    [(HMDHome *)self setProtectionMode:unsignedIntegerValue];
    transactionResult = [messageCopy transactionResult];
    [(HMDHome *)self _handleNetworkProtectionModeChangeForTransaction:transactionResult];
    [transactionResult markChanged];
  }
}

- (id)timerWithTimerInterval:(double)interval
{
  v3 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:interval];

  return v3;
}

- (id)propertiesRegisteredForMediaProfileUniqueIdentifier:(id)identifier
{
  identifierCopy = identifier;
  notificationRegistry = [(HMDHome *)self notificationRegistry];
  v6 = [notificationRegistry propertiesRegisteredForMediaProfileUniqueIdentifier:identifierCopy];

  return v6;
}

- (id)accessoryForMediaProfileUniqueIdentifier:(id)identifier
{
  v3 = [(HMDHome *)self mediaProfileWithUUID:identifier];
  accessory = [v3 accessory];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = accessory;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  return v5;
}

- (NSNumber)availableBorderRouters
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBorderRouters;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBorderRouters:(id)routers
{
  routersCopy = routers;
  os_unfair_recursive_lock_lock_with_options();
  availableBorderRouters = self->_availableBorderRouters;
  self->_availableBorderRouters = routersCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)availableBSPsCount
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_availableBSPsCount;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setAvailableBSPsCount:(id)count
{
  countCopy = count;
  os_unfair_recursive_lock_lock_with_options();
  availableBSPsCount = self->_availableBSPsCount;
  self->_availableBSPsCount = countCopy;

  os_unfair_recursive_lock_unlock();
}

- (id)dumpMediaSessionDescriptionWithPrivacyLevel:(unint64_t)level
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  mediaSessionStates = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(mediaSessionStates, "count")}];

  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  mediaSessionStates2 = [(HMDHome *)self mediaSessionStates];
  v9 = [mediaSessionStates2 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v17;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v17 != v11)
        {
          objc_enumerationMutation(mediaSessionStates2);
        }

        v13 = [*(*(&v16 + 1) + 8 * i) dumpStateWithPrivacyLevel:level];
        [v7 addObject:v13];
      }

      v10 = [mediaSessionStates2 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v10);
  }

  v14 = *MEMORY[0x277D85DE8];

  return v7;
}

- (id)dumpCharacteristicNotificationRegistry
{
  v3 = MEMORY[0x277CCAB68];
  name = [(HMDHome *)self name];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  v7 = [v3 stringWithFormat:@"Home %@/%@:", name, uUIDString];

  notificationRegistry = [(HMDHome *)self notificationRegistry];
  shortDescription = [notificationRegistry shortDescription];
  [v7 appendString:shortDescription];

  return v7;
}

- (id)dumpActionSetDescriptionWithPrivacyLevel:(unint64_t)level
{
  v33 = *MEMORY[0x277D85DE8];
  v5 = MEMORY[0x277CBEB18];
  mediaSessionStates = [(HMDHome *)self mediaSessionStates];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(mediaSessionStates, "count")}];

  actionSets = [(HMDHome *)self actionSets];
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  v30 = 0u;
  v9 = [actionSets countByEnumeratingWithState:&v27 objects:v32 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v28;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v28 != v11)
        {
          objc_enumerationMutation(actionSets);
        }

        v13 = [*(*(&v27 + 1) + 8 * i) dumpStateWithPrivacyLevel:level];
        [v7 addObject:v13];
      }

      v10 = [actionSets countByEnumeratingWithState:&v27 objects:v32 count:16];
    }

    while (v10);
  }

  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v15 = [triggerOwnedActionSets countByEnumeratingWithState:&v23 objects:v31 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v24;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v24 != v17)
        {
          objc_enumerationMutation(triggerOwnedActionSets);
        }

        v19 = [*(*(&v23 + 1) + 8 * j) dumpStateWithPrivacyLevel:level];
        [v7 addObject:v19];
      }

      v16 = [triggerOwnedActionSets countByEnumeratingWithState:&v23 objects:v31 count:16];
    }

    while (v16);
  }

  v20 = [v7 copy];

  v21 = *MEMORY[0x277D85DE8];

  return v20;
}

- (void)_handleResponseForElectMessageToResident:(id)resident error:(id)error
{
  v44 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  errorCopy = error;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
LABEL_5:

      objc_autoreleasePoolPop(v9);
      goto LABEL_19;
    }

    v12 = HMFGetLogIdentifier();
    userID = [residentCopy userID];
    v38 = 138543618;
    v39 = v12;
    v40 = 2112;
    v41 = userID;
    v14 = "%{public}@Received response for ping message to resident %@. Remote access is already setup, dropping response";
LABEL_4:
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, v14, &v38, 0x16u);

    goto LABEL_5;
  }

  if (errorCopy)
  {
    domain = [errorCopy domain];
    if ([domain isEqualToString:*MEMORY[0x277D18538]])
    {
      if ([errorCopy code] == 16)
      {

LABEL_21:
        v9 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v11 = HMFGetOSLogHandle();
        if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          goto LABEL_5;
        }

        v12 = HMFGetLogIdentifier();
        userID = [residentCopy userID];
        v38 = 138543618;
        v39 = v12;
        v40 = 2112;
        v41 = userID;
        v14 = "%{public}@Failed to ping resident %@, will try again at next heartbeat";
        goto LABEL_4;
      }

      code = [errorCopy code];

      if (code == 23)
      {
        goto LABEL_21;
      }
    }

    else
    {
    }

    v29 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      v32 = HMFGetLogIdentifier();
      userID2 = [residentCopy userID];
      v38 = 138543874;
      v39 = v32;
      v40 = 2112;
      v41 = userID2;
      v42 = 2112;
      v43 = errorCopy;
      _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Failed to ping resident %@, but error %@ is not specific IDS error, will not re-try at next heartbeat", &v38, 0x20u);
    }

    objc_autoreleasePoolPop(v29);
    heartbeatPingMessagesQueuedWithServer = [(HMDHome *)selfCopy3 heartbeatPingMessagesQueuedWithServer];
    userID3 = [residentCopy userID];
    [heartbeatPingMessagesQueuedWithServer addObject:userID3];
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      userID4 = [residentCopy userID];
      v38 = 138543618;
      v39 = v19;
      v40 = 2112;
      v41 = userID4;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Successfully sent ping message to resident %@, remembering queued message", &v38, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    heartbeatPingMessagesQueuedWithServer2 = [(HMDHome *)selfCopy4 heartbeatPingMessagesQueuedWithServer];
    userID5 = [residentCopy userID];
    [heartbeatPingMessagesQueuedWithServer2 addObject:userID5];

    v23 = objc_autoreleasePoolPush();
    v24 = selfCopy4;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      v38 = 138543362;
      v39 = v26;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", &v38, 0xCu);
    }

    objc_autoreleasePoolPop(v23);
    homeManager = [(HMDHome *)v24 homeManager];
    uuid = [(HMDHome *)v24 uuid];
    [homeManager electRemoteAccessPeerForHome:uuid];
  }

LABEL_19:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessHealthMonitorTimerDidFire
{
  v40 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    _residentUsers = [(HMDHome *)self _residentUsers];
    objc_initWeak(&location, self);
    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    obj = _residentUsers;
    v5 = [obj countByEnumeratingWithState:&v30 objects:v39 count:16];
    if (v5)
    {
      v27 = *v31;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v31 != v27)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v30 + 1) + 8 * i);
          heartbeatPingMessagesQueuedWithServer = [(HMDHome *)self heartbeatPingMessagesQueuedWithServer];
          userID = [v7 userID];
          v10 = [heartbeatPingMessagesQueuedWithServer containsObject:userID];

          v11 = objc_autoreleasePoolPush();
          selfCopy = self;
          if (v10)
          {
            v13 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              v14 = HMFGetLogIdentifier();
              userID2 = [v7 userID];
              *buf = 138543618;
              v36 = v14;
              v37 = 2112;
              v38 = userID2;
              _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, but we already have a ping queued with server to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
          }

          else
          {
            v16 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              v17 = HMFGetLogIdentifier();
              userID3 = [v7 userID];
              *buf = 138543618;
              v36 = v17;
              v37 = 2112;
              v38 = userID3;
              _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Remote access health monitor fired, sending ping elect message to %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v11);
            aBlock[0] = MEMORY[0x277D85DD0];
            aBlock[1] = 3221225472;
            aBlock[2] = __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke;
            aBlock[3] = &unk_279722BD0;
            objc_copyWeak(&v29, &location);
            aBlock[4] = v7;
            v19 = _Block_copy(aBlock);
            homeManager = [(HMDHome *)selfCopy homeManager];
            messageDispatcher = [homeManager messageDispatcher];
            userID4 = [v7 userID];
            userID5 = [v7 userID];
            workQueue2 = [(HMDHome *)selfCopy workQueue];
            [messageDispatcher electDeviceForHH1User:userID4 destination:userID5 deviceCapabilities:0 responseTimeout:workQueue2 responseQueue:v19 responseHandler:600.0];

            objc_destroyWeak(&v29);
          }
        }

        v5 = [obj countByEnumeratingWithState:&v30 objects:v39 count:16];
      }

      while (v5);
    }

    objc_destroyWeak(&location);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __49__HMDHome__remoteAccessHealthMonitorTimerDidFire__block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v6)
    {
      v4 = [v6 userInfo];
      v5 = [v4 objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:v5];
    }

    else
    {
      [WeakRetained _handleResponseForElectMessageToResident:*(a1 + 32) error:0];
    }
  }
}

- (void)remoteAccessHealthMonitorTimerDidFire
{
  if (isiOSDevice())
  {
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __48__HMDHome_remoteAccessHealthMonitorTimerDidFire__block_invoke;
    block[3] = &unk_279735D00;
    block[4] = self;
    dispatch_async(workQueue, block);
  }
}

- (void)_handleDidReceiveIDSMessageWithNoListenerFromAddress:(id)address
{
  v36 = *MEMORY[0x277D85DE8];
  addressCopy = address;
  v5 = shouldLogPrivateInformation();
  v6 = @"...";
  if (v5)
  {
    v6 = addressCopy;
  }

  v7 = v6;
  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Received IDS message from %@ but home has remote access enabled, ignoring notification", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v29 = 0u;
    v30 = 0u;
    v27 = 0u;
    v28 = 0u;
    _residentUsers = [(HMDHome *)self _residentUsers];
    v13 = [_residentUsers countByEnumeratingWithState:&v27 objects:v31 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v28;
      while (2)
      {
        for (i = 0; i != v14; ++i)
        {
          if (*v28 != v15)
          {
            objc_enumerationMutation(_residentUsers);
          }

          v17 = *(*(&v27 + 1) + 8 * i);
          if ([v17 configurationState] == 2)
          {
            userID = [v17 userID];
            v19 = [userID isEqualToString:addressCopy];

            if (v19)
            {
              v20 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v22 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
              {
                v23 = HMFGetLogIdentifier();
                *buf = 138543618;
                v33 = v23;
                v34 = 2112;
                v35 = v7;
                _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled but we received a message from resident at %@, requesting electing a remote peer", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v20);
              homeManager = [(HMDHome *)selfCopy2 homeManager];
              uuid = [(HMDHome *)selfCopy2 uuid];
              [homeManager electRemoteAccessPeerForHome:uuid];

              goto LABEL_20;
            }
          }
        }

        v14 = [_residentUsers countByEnumeratingWithState:&v27 objects:v31 count:16];
        if (v14)
        {
          continue;
        }

        break;
      }
    }

LABEL_20:
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)handleDidReceiveIDSMessageWithNoListener:(id)listener
{
  listenerCopy = listener;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = listenerCopy;
  selfCopy = self;
  v6 = listenerCopy;
  dispatch_async(workQueue, v7);
}

void __52__HMDHome_handleDidReceiveIDSMessageWithNoListener___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];

  if (v2)
  {
    v3 = [*(a1 + 32) userInfo];
    v5 = [v3 hmf_stringForKey:@"kIDSMessageSourceIDKey"];

    v4 = v5;
    if (v5)
    {
      [*(a1 + 40) _handleDidReceiveIDSMessageWithNoListenerFromAddress:v5];
      v4 = v5;
    }
  }
}

- (void)handleActiveAccountChanged:(id)changed
{
  userInfo = [changed userInfo];
  v5 = [userInfo objectForKeyedSubscript:@"HMDAccountNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  workQueue = [(HMDHome *)self workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __38__HMDHome_handleActiveAccountChanged___block_invoke;
  v10[3] = &unk_2797359B0;
  v10[4] = self;
  v11 = v7;
  v9 = v7;
  dispatch_async(workQueue, v10);
}

- (void)handleAccountHandlesUpdated:(id)updated
{
  updatedCopy = updated;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __39__HMDHome_handleAccountHandlesUpdated___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = updatedCopy;
  selfCopy = self;
  v6 = updatedCopy;
  dispatch_async(workQueue, v7);
}

void __39__HMDHome_handleAccountHandlesUpdated___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v7 = v3;

  v4 = +[HMDAppleAccountManager sharedManager];
  v5 = [v4 account];
  v6 = [v7 isEqualToAccount:v5];

  if (v6)
  {
    __updateAccountHandleForCurrentUser(*(a1 + 40), v7);
  }
}

- (void)removeUnconfiguredResidentDeviceWithUserID:(id)d
{
  dCopy = d;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = dCopy;
  v6 = dCopy;
  dispatch_async(workQueue, v7);
}

void __54__HMDHome_removeUnconfiguredResidentDeviceWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  if (v4)
  {
    [v4 setConfigurationState:2];
    v3 = [*(a1 + 32) unconfiguredResidentDevices];
    [v3 removeObject:v4];
  }
}

- (void)addUnconfiguredResidentDevice:(id)device
{
  deviceCopy = device;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_addUnconfiguredResidentDevice___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = deviceCopy;
  v6 = deviceCopy;
  dispatch_async(workQueue, v7);
}

void __41__HMDHome_addUnconfiguredResidentDevice___block_invoke(uint64_t a1)
{
  v42 = *MEMORY[0x277D85DE8];
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v2 = [*(a1 + 32) unconfiguredResidentDevices];
  v3 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v33;
LABEL_3:
    v6 = 0;
    while (1)
    {
      if (*v33 != v5)
      {
        objc_enumerationMutation(v2);
      }

      v7 = [*(*(&v32 + 1) + 8 * v6) device];
      v8 = [v7 isEqual:*(a1 + 40)];

      if (v8)
      {
        break;
      }

      if (v4 == ++v6)
      {
        v4 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v32 objects:v41 count:16];
        if (v4)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists";
  }

  else
  {
LABEL_9:

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v2 = [*(a1 + 32) _residentUsers];
    v9 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (!v9)
    {
LABEL_17:

      v15 = objc_autoreleasePoolPush();
      v16 = *(a1 + 32);
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        v19 = [*(a1 + 40) shortDescription];
        *buf = 138543618;
        v38 = v18;
        v39 = 2112;
        v40 = v19;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Adding resident device, %@, to unconfigured list and posting notification", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v2 = [[HMDResidentUser alloc] initWithDevice:*(a1 + 40) home:*(a1 + 32) pairingIdentity:0 configurationState:1];
      v20 = [*(a1 + 32) unconfiguredResidentDevices];
      [v20 addObject:v2];

      [(HMDUser *)v2 setHome:*(a1 + 32)];
      [*(a1 + 32) _configureUnconfiguredResident:v2 desiredConfigState:2];
      goto LABEL_26;
    }

    v10 = v9;
    v11 = *v29;
LABEL_11:
    v12 = 0;
    while (1)
    {
      if (*v29 != v11)
      {
        objc_enumerationMutation(v2);
      }

      v13 = [*(*(&v28 + 1) + 8 * v12) device];
      v14 = [v13 isEqual:*(a1 + 40)];

      if (v14)
      {
        break;
      }

      if (v10 == ++v12)
      {
        v10 = [(HMDResidentUser *)v2 countByEnumeratingWithState:&v28 objects:v36 count:16];
        if (v10)
        {
          goto LABEL_11;
        }

        goto LABEL_17;
      }
    }

    v21 = objc_autoreleasePoolPush();
    v22 = *(a1 + 32);
    v23 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      goto LABEL_25;
    }

    v24 = HMFGetLogIdentifier();
    v25 = [*(a1 + 40) shortDescription];
    *buf = 138543618;
    v38 = v24;
    v39 = 2112;
    v40 = v25;
    v26 = "%{public}@Not adding resident device, %@, to unconfigured list since it already exists in users";
  }

  _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, v26, buf, 0x16u);

LABEL_25:
  objc_autoreleasePoolPop(v21);
LABEL_26:

  v27 = *MEMORY[0x277D85DE8];
}

- (void)timerDidFire:(id)fire
{
  v17 = *MEMORY[0x277D85DE8];
  fireCopy = fire;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  modifyNotificationsCoalesceTimer = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (modifyNotificationsCoalesceTimer == fireCopy)
  {
    [(HMDHome *)self _handleCoalescedModifyNotifications];
  }

  else
  {
    disableNotificationTimer = [(HMDHome *)self disableNotificationTimer];

    if (disableNotificationTimer == fireCopy)
    {
      [(HMDHome *)self _handleDisableNotificationsTimerFired];
    }

    else
    {
      reachabilityNotificationTimer = [(HMDHome *)self reachabilityNotificationTimer];

      if (reachabilityNotificationTimer == fireCopy)
      {
        [(HMDHome *)self _handleRemoteReachabilityNotificationTimerFired];
      }

      else
      {
        pendingResponsesTimer = [(HMDHome *)self pendingResponsesTimer];

        if (pendingResponsesTimer == fireCopy)
        {
          [(HMDHome *)self _handlePendingResponsesTimerFired:0];
        }

        else if (self->_homeLocationTimer == fireCopy)
        {
          v10 = objc_autoreleasePoolPush();
          selfCopy = self;
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            v15 = 138543362;
            v16 = v13;
            _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Evaluating home location", &v15, 0xCu);
          }

          objc_autoreleasePoolPop(v10);
          [(HMDHome *)selfCopy updateHomeLocation];
        }

        else if (self->_accessoryReachabilityUpdatesTimer == fireCopy)
        {
          [(HMDHome *)self _handleAccessoryReachabilityUpdatesTimerFired];
        }
      }
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityUpdatesTimerFired
{
  v102 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  allObjects = [(NSMutableSet *)self->_reachabilityUpdatedAccessories allObjects];
  [(NSMutableSet *)self->_reachabilityUpdatedAccessories removeAllObjects];
  os_unfair_recursive_lock_unlock();
  selfCopy = self;
  v69 = allObjects;
  v59 = [v69 count];
  v5 = objc_autoreleasePoolPush();
  v72 = selfCopy;
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (v59)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v99 = v8;
      v100 = 2048;
      v101 = v59;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Sending accessory reachability updates - number of entries %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v71 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v61 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
    v70 = [MEMORY[0x277CBEB18] arrayWithCapacity:v59];
    v87 = 0u;
    v88 = 0u;
    v85 = 0u;
    v86 = 0u;
    obj = [(HMDHome *)v72 accessories];
    v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
    if (v9)
    {
      v66 = *v86;
      v62 = *MEMORY[0x277CCEC80];
      v60 = *MEMORY[0x277CCF048];
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v86 != v66)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v85 + 1) + 8 * i);
          uuid = [v11 uuid];
          uUIDString = [uuid UUIDString];

          if ([v69 containsObject:uUIDString])
          {
            v14 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v11, "isReachableForXPCClients")}];
            messageSendPolicy = [v11 messageSendPolicy];
            v16 = [v71 hmf_mutableDictionaryForKey:messageSendPolicy];
            if (!v16)
            {
              v16 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
              [v71 setObject:v16 forKey:messageSendPolicy];
            }

            v17 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:3];
            [v17 setObject:v14 forKeyedSubscript:@"kAccessoryIsReachableKey"];
            v18 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v11, "reachableTransports")}];
            [v17 setObject:v18 forKeyedSubscript:v62];

            v19 = v11;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v20 = v19;
            }

            else
            {
              v20 = 0;
            }

            v21 = v20;

            if (v21)
            {
              v22 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v21, "suspendedState")}];
              [v17 setObject:v22 forKeyedSubscript:v60];
            }

            v23 = [v17 copy];
            [v16 setObject:v23 forKeyedSubscript:uUIDString];

            if (([messageSendPolicy entitlements] & 4) == 0)
            {
              v24 = [v61 hmf_mutableDictionaryForKey:messageSendPolicy];
              if (!v24)
              {
                v24 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:v59];
                [v61 setObject:v24 forKey:messageSendPolicy];
              }

              v96 = @"kAccessoryIsReachableKey";
              v97 = v14;
              v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v97 forKeys:&v96 count:1];
              [v24 setObject:v25 forKeyedSubscript:uUIDString];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v85 objects:buf count:16];
      }

      while (v9);
    }

    v83 = 0u;
    v84 = 0u;
    v81 = 0u;
    v82 = 0u;
    obja = [v71 allKeys];
    v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
    if (v26)
    {
      v27 = *v82;
      v28 = *MEMORY[0x277CCE9C0];
      v67 = *MEMORY[0x277CCE7A8];
      do
      {
        for (j = 0; j != v26; ++j)
        {
          if (*v82 != v27)
          {
            objc_enumerationMutation(obja);
          }

          v30 = *(*(&v81 + 1) + 8 * j);
          v31 = [v71 hmf_mutableDictionaryForKey:{v30, v59}];
          if ([v31 count])
          {
            v32 = MEMORY[0x277D0F848];
            messageDestination = [(HMDHome *)v72 messageDestination];
            v93 = v67;
            v34 = [v31 copy];
            v94 = v34;
            v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v94 forKeys:&v93 count:1];
            v36 = [v32 messageWithName:v28 destination:messageDestination payload:v35];

            if (([v30 entitlements] & 4) != 0)
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements], objc_msgSend(v30, "options"), 1);
            }

            else
            {
              v37 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v30 entitlements] | 4, objc_msgSend(v30, "options"), 1);
            }

            v38 = v37;
            [v36 setSendPolicy:v37];

            [v70 addObject:v36];
          }
        }

        v26 = [obja countByEnumeratingWithState:&v81 objects:v95 count:16];
      }

      while (v26);
    }

    v79 = 0u;
    v80 = 0u;
    v77 = 0u;
    v78 = 0u;
    objb = [v61 allKeys];
    v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
    if (v39)
    {
      v40 = *v78;
      v41 = *MEMORY[0x277CCE9C0];
      v68 = *MEMORY[0x277CCE7A8];
      do
      {
        for (k = 0; k != v39; ++k)
        {
          if (*v78 != v40)
          {
            objc_enumerationMutation(objb);
          }

          v43 = *(*(&v77 + 1) + 8 * k);
          v44 = [v71 hmf_mutableDictionaryForKey:{v43, v59}];
          if ([v44 count])
          {
            v45 = MEMORY[0x277D0F848];
            messageDestination2 = [(HMDHome *)v72 messageDestination];
            v90 = v68;
            v47 = [v44 copy];
            v91 = v47;
            v48 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v91 forKeys:&v90 count:1];
            v49 = [v45 messageWithName:v41 destination:messageDestination2 payload:v48];

            [v49 setRequiresNoSPIEntitlement:1];
            v50 = -[HMDHomeManagerXPCMessageSendPolicy initWithEntitlements:options:active:]([HMDHomeManagerXPCMessageSendPolicy alloc], "initWithEntitlements:options:active:", [v43 entitlements], objc_msgSend(v43, "options"), 1);
            [v49 setSendPolicy:v50];
            [v70 addObject:v49];
          }
        }

        v39 = [objb countByEnumeratingWithState:&v77 objects:v92 count:16];
      }

      while (v39);
    }

    v51 = [v70 copy];
  }

  else
  {
    if (v7)
    {
      v52 = HMFGetLogIdentifier();
      *buf = 138543362;
      v99 = v52;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability update timer fired but no entries", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v51 = MEMORY[0x277CBEBF8];
  }

  v73 = 0u;
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
  if (v53)
  {
    v54 = *v74;
    do
    {
      for (m = 0; m != v53; ++m)
      {
        if (*v74 != v54)
        {
          objc_enumerationMutation(v51);
        }

        v56 = *(*(&v73 + 1) + 8 * m);
        msgDispatcher = [(HMDHome *)v72 msgDispatcher];
        [msgDispatcher sendMessage:v56];
      }

      v53 = [v51 countByEnumeratingWithState:&v73 objects:v89 count:16];
    }

    while (v53);
  }

  v58 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfReachabilityUpdateForAccessory:(id)accessory
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = accessoryCopy;
  selfCopy = self;
  v6 = accessoryCopy;
  dispatch_async(workQueue, v7);
}

void __57__HMDHome_notifyClientsOfReachabilityUpdateForAccessory___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) uuid];
  v3 = [v2 UUIDString];

  if (v3)
  {
    v4 = *(a1 + 40);
    os_unfair_recursive_lock_lock_with_options();
    if ([*(*(a1 + 40) + 184) containsObject:v3])
    {
      v5 = 0;
    }

    else
    {
      [*(*(a1 + 40) + 184) addObject:v3];
      v5 = [*(*(a1 + 40) + 184) count] == 1;
    }

    os_unfair_recursive_lock_unlock();
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v16 = HMFBooleanToString();
      v18 = 138543874;
      v19 = v14;
      v20 = 2112;
      v21 = v15;
      v22 = 2112;
      v23 = v16;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Queuing up reachability update for accessory %@. Started timer: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    if (v5)
    {
      [*(*(a1 + 40) + 176) resume];
    }
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 40);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543618;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Attempt to queue reachability update for accessory with no UUID - %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleDisableNotificationsTimerFired
{
  v38 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  v5 = [notificationRegistrations copy];

  notificationDeregistrations = [(HMDHome *)self notificationDeregistrations];
  v7 = [notificationDeregistrations copy];

  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    shortDescription = [v5 shortDescription];
    shortDescription2 = [v7 shortDescription];
    v32 = 138543874;
    v33 = v11;
    v34 = 2112;
    v35 = shortDescription;
    v36 = 2112;
    v37 = shortDescription2;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Notification disable timer fired - registrations %@  deregistrations %@", &v32, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [(HMDHome *)selfCopy setDisableNotificationTimer:0];
  notificationRegistrationsForAppleMediaAccessories = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
  v15 = [notificationRegistrationsForAppleMediaAccessories count];

  [(HMDHome *)selfCopy _applyNotificationDeregistrations];
  notificationRegistrations2 = [(HMDHome *)selfCopy notificationRegistrations];
  v17 = [notificationRegistrations2 count];

  notificationRegistrationsForAppleMediaAccessories2 = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
  v19 = [notificationRegistrationsForAppleMediaAccessories2 count];

  if (!v19 && v15)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = selfCopy;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      v32 = 138543362;
      v33 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying Apple Media notification registrations with devices due to HomeKit client no longer active", &v32, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    [(HMDHome *)v21 _subscribeForHomeAppleMediaNotificationsOnDirectTransports:?];
  }

  if (!v17)
  {
    v24 = objc_autoreleasePoolPush();
    v25 = selfCopy;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      v32 = 138543362;
      v33 = v27;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client no longer active", &v32, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
    [(HMDHome *)v25 _subscribeForHomeNotificationsFromRemoteGateway:0];
    [(HMDHome *)v25 _subscribeForHomeNotificationsOnDirectTransports:?];
    date = [MEMORY[0x277CBEAA8] date];
    [(HMDHome *)v25 setNotificationsUpdatedTime:date];

    homeManager = [(HMDHome *)v25 homeManager];
    chipDataSource = [homeManager chipDataSource];
    [chipDataSource updateNotificationsEnabled:0 forHome:v25 keepAliveOnly:0];

    logAndPostNotification(@"HMDHomeDidDisableCharacteristicNotifyEventNotification", v25, 0);
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForHomeAppleMediaNotificationsOnDirectTransports:(void *)transports
{
  v15 = *MEMORY[0x277D85DE8];
  if (transports)
  {
    workQueue = [transports workQueue];
    dispatch_assert_queue_V2(workQueue);

    if (([(HMDHome *)transports supportsUnifiedMediaNotificationsOnResidents]& 1) == 0)
    {
      v5 = objc_autoreleasePoolPush();
      transportsCopy = transports;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543362;
        v14 = v8;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Registering for apple media notifications on direct transports since we have no primary resident that supports unified notifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      accessories = [transportsCopy accessories];
      v11[0] = MEMORY[0x277D85DD0];
      v11[1] = 3221225472;
      v11[2] = __70__HMDHome__subscribeForHomeAppleMediaNotificationsOnDirectTransports___block_invoke;
      v11[3] = &unk_279722088;
      v11[4] = transportsCopy;
      v12 = a2;
      [accessories na_each:v11];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForHomeNotificationsOnDirectTransports:(void *)transports
{
  v62 = *MEMORY[0x277D85DE8];
  if (transports)
  {
    v2 = a2;
    v4 = [transports _characteristicNotificationPayloadsOnDirectTransports:a2];
    v5 = [v4 objectAtIndex:0];
    v6 = [v4 objectAtIndex:1];
    if ([v5 count] || objc_msgSend(v6, "count"))
    {
      if ([v5 count])
      {
        v7 = objc_autoreleasePoolPush();
        transportsCopy = transports;
        v9 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
        {
          v10 = HMFGetLogIdentifier();
          shortDescription = [v5 shortDescription];
          *buf = 138543618;
          v59 = v10;
          v60 = 2112;
          v61 = shortDescription;
          _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Deregistering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v7);
      }

      v47 = v2;
      v46 = v6;
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      v45 = v5;
      v12 = v5;
      v13 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v53;
        do
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v53 != v15)
            {
              objc_enumerationMutation(v12);
            }

            v17 = *(*(&v52 + 1) + 8 * i);
            v18 = [v12 objectForKey:{v17, v45}];
            v19 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v17];
            v20 = [transports accessoryWithUUID:v19];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v21 = v20;
            }

            else
            {
              v21 = 0;
            }

            v22 = v21;

            [v22 enableNotification:0 forCharacteristics:v18 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
          }

          v14 = [v12 countByEnumeratingWithState:&v52 objects:v57 count:16];
        }

        while (v14);
      }

      if ([v46 count])
      {
        v23 = objc_autoreleasePoolPush();
        transportsCopy2 = transports;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          v26 = HMFGetLogIdentifier();
          shortDescription2 = [v46 shortDescription];
          *buf = 138543618;
          v59 = v26;
          v60 = 2112;
          v61 = shortDescription2;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_DEBUG, "%{public}@Registering notifications %@ with direct transports", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
      }

      v50 = 0u;
      v51 = 0u;
      v48 = 0u;
      v49 = 0u;
      v28 = v46;
      v29 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
      v5 = v45;
      if (v29)
      {
        v30 = v29;
        v31 = *v49;
        do
        {
          for (j = 0; j != v30; ++j)
          {
            if (*v49 != v31)
            {
              objc_enumerationMutation(v28);
            }

            v33 = *(*(&v48 + 1) + 8 * j);
            v34 = [v28 objectForKey:{v33, v45}];
            v35 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v33];
            v36 = [transports accessoryWithUUID:v35];

            v37 = v36;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v38 = v37;
            }

            else
            {
              v38 = 0;
            }

            v39 = v38;

            if (v39)
            {
              if (v47)
              {
                [v39 enableNotification:1 forCharacteristics:v34 message:0 clientIdentifier:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              else
              {
                [v39 updateNotificationEnabled:0 forCharacteristics:v34 onBehalfOf:@"com.apple.HomeKitDaemon.homeNotifications"];
              }

              [v39 checkHAPSessionRestore];
            }
          }

          v30 = [v28 countByEnumeratingWithState:&v48 objects:v56 count:16];
        }

        while (v30);
      }

      v6 = v46;
    }

    else
    {
      v41 = objc_autoreleasePoolPush();
      transportsCopy3 = transports;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        *buf = 138543362;
        v59 = v44;
        _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications on direct transports since we have no modifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v41);
    }
  }

  v40 = *MEMORY[0x277D85DE8];
}

- (uint64_t)supportsUnifiedMediaNotificationsOnResidents
{
  if (!self)
  {
    return 0;
  }

  primaryResident = [self primaryResident];
  device = [primaryResident device];
  if (device)
  {
    capabilities = [primaryResident capabilities];
    supportsUnifiedMediaNotifications = [capabilities supportsUnifiedMediaNotifications];
  }

  else
  {
    supportsUnifiedMediaNotifications = 0;
  }

  return supportsUnifiedMediaNotifications;
}

void __70__HMDHome__subscribeForHomeAppleMediaNotificationsOnDirectTransports___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v5;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  if (v4)
  {
    [(HMDHome *)*(a1 + 32) _enableMediaNotifications:v4 forMediaAccessory:?];
  }
}

- (void)_enableMediaNotifications:(void *)notifications forMediaAccessory:
{
  v9[1] = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  if (self)
  {
    workQueue = [self workQueue];
    dispatch_assert_queue_V2(workQueue);

    if (([self isCurrentDevicePrimaryResident] & 1) != 0 || !-[HMDHome supportsUnifiedMediaNotificationsOnResidents](self))
    {
      [(HMDHome *)self _enableMediaNotifications:a2 directlyOnMediaAccessory:notificationsCopy completion:0];
    }

    else
    {
      v9[0] = notificationsCopy;
      v7 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:1];
      [self _subscribeForHomeNotificationsFromRemoteGateway:a2 accessories:v7];
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_enableMediaNotifications:(void *)notifications directlyOnMediaAccessory:(void *)accessory completion:
{
  v33 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  accessoryCopy = accessory;
  if (self)
  {
    workQueue = [self workQueue];
    dispatch_assert_queue_V2(workQueue);

    device = [notificationsCopy device];
    mediaProfile = [notificationsCopy mediaProfile];
    v12 = mediaProfile;
    if (device && mediaProfile)
    {
      v13 = [(HMDHome *)self mediaNotificationPayloadForProfile:mediaProfile];
      v14 = objc_autoreleasePoolPush();
      selfCopy = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v17 = HMFGetLogIdentifier();
        HMFBooleanToString();
        v18 = v24 = v14;
        *buf = 138544130;
        v26 = v17;
        v27 = 2112;
        v28 = v18;
        v29 = 2112;
        v30 = v12;
        v31 = 2112;
        v32 = device;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Registering for media notifications (enabled: %@) on profile %@ with device %@", buf, 0x2Au);

        v14 = v24;
      }

      objc_autoreleasePoolPop(v14);
      [selfCopy _modifyCharacteristicNotifications:MEMORY[0x277CBEC10] mediaNotifications:v13 actionSetNotificationPayload:MEMORY[0x277CBEBF8] enableNotification:a2 withDevice:device completion:accessoryCopy];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138544130;
        v26 = v22;
        v27 = 2112;
        v28 = notificationsCopy;
        v29 = 2112;
        v30 = device;
        v31 = 2112;
        v32 = v12;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Unable to enable media notifications on apple media accessory %@ due to no device (%@) or profile (%@)", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v19);
      if (!accessoryCopy)
      {
        goto LABEL_12;
      }

      v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
      accessoryCopy[2](accessoryCopy, v13);
    }

LABEL_12:
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (id)mediaNotificationPayloadForProfile:(void *)profile
{
  v11[1] = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (profile)
  {
    if (!v3)
    {
      _HMFPreconditionFailure();
    }

    uniqueIdentifier = [v3 uniqueIdentifier];
    uUIDString = [uniqueIdentifier UUIDString];

    v10 = uUIDString;
    v7 = +[HMDMediaSession mediaPropertyMessageKeys];
    v11[0] = v7;
    profile = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  }

  v8 = *MEMORY[0x277D85DE8];

  return profile;
}

- (void)_handleCoalescedModifyNotifications
{
  v17 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self setModifyNotificationsCoalesceTimer:0];
  v4 = objc_autoreleasePoolPush();
  selfCopy = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v7;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to notification coalesce timer firing", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __46__HMDHome__handleCoalescedModifyNotifications__block_invoke;
  aBlock[3] = &unk_279722BA8;
  aBlock[4] = selfCopy;
  v8 = _Block_copy(aBlock);
  enableNotificationPayload = [(HMDHome *)selfCopy enableNotificationPayload];
  array = [MEMORY[0x277CBEB18] array];
  v8[2](v8, enableNotificationPayload, array, 1);

  disableNotificationPayload = [(HMDHome *)selfCopy disableNotificationPayload];
  array2 = [MEMORY[0x277CBEB18] array];
  v8[2](v8, disableNotificationPayload, array2, 0);

  v13 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleCoalescedModifyNotifications__block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v11 = a2;
  v7 = a3;
  if ([v11 count] || objc_msgSend(v7, "count"))
  {
    v8 = [v11 na_dictionaryByMappingValues:&__block_literal_global_1836];
    v9 = [v8 copy];

    v10 = [v7 copy];
    [*(a1 + 32) _modifyCharacteristicNotificationsOnResident:v9 mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:v10 enableNotification:a4];
    [v11 removeAllObjects];
    [v7 removeAllObjects];
  }
}

id __46__HMDHome__handleCoalescedModifyNotifications__block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v3 = [a3 copy];

  return v3;
}

- (void)userManagementOperationDidFinish:(id)finish
{
  finishCopy = finish;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __44__HMDHome_userManagementOperationDidFinish___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = finishCopy;
  selfCopy = self;
  v6 = finishCopy;
  dispatch_async(workQueue, v7);
}

void __44__HMDHome_userManagementOperationDidFinish___block_invoke(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) isAuditOperation];
  v3 = *(a1 + 40);
  if (v2)
  {
    v4 = [v3 backingStore];
    v5 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v6 = [v4 transaction:@"HMDUserManagementOperationDelete" options:v5];

    v7 = *(a1 + 40);
    v8 = [*(a1 + 32) accessory];
    v9 = [v8 uuid];
    v10 = [v7 accessoryWithUUID:v9];

    v11 = [v10 home];
    v12 = v11;
    if (!v10 || !v11)
    {
      goto LABEL_15;
    }

    if ([*(a1 + 32) isExpired])
    {
      v13 = [v10 transactionWithObjectChangeType:2];
      v14 = [HMDUserManagementOperationTimestamp alloc];
      v15 = [*(a1 + 40) currentDevice];
      v16 = [(HMDUserManagementOperationTimestamp *)v14 initWithDevice:v15 state:2];
      [v13 setPairingsAuditedTimestamp:v16];

      v17 = objc_autoreleasePoolPush();
      v18 = *(a1 + 40);
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        v20 = [v10 name];
        [v10 uuid];
        v42 = v46 = v17;
        v21 = [v42 UUIDString];
        [v13 pairingsAuditedTimestamp];
        v22 = v44 = v13;
        *buf = 138544130;
        v49 = v40;
        v50 = 2112;
        v51 = v20;
        v52 = 2112;
        v53 = v21;
        v23 = v21;
        v54 = 2112;
        v55 = v22;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ pairings audit failed %@", buf, 0x2Au);

        v13 = v44;
        v17 = v46;
      }
    }

    else
    {
      if ([*(a1 + 32) isCancelled])
      {
        goto LABEL_15;
      }

      v13 = [v10 transactionWithObjectChangeType:2];
      v26 = [HMDUserManagementOperationTimestamp alloc];
      v27 = [*(a1 + 40) currentDevice];
      v28 = [(HMDUserManagementOperationTimestamp *)v26 initWithDevice:v27 state:0];
      [v13 setPairingsAuditedTimestamp:v28];

      v17 = objc_autoreleasePoolPush();
      v18 = *(a1 + 40);
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v41 = HMFGetLogIdentifier();
        v29 = [v10 name];
        [v10 uuid];
        v43 = v47 = v17;
        v30 = [v43 UUIDString];
        [v13 pairingsAuditedTimestamp];
        v31 = v45 = v13;
        *buf = 138544130;
        v49 = v41;
        v50 = 2112;
        v51 = v29;
        v52 = 2112;
        v53 = v30;
        v32 = v30;
        v54 = 2112;
        v55 = v31;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ pairings audit completed %@", buf, 0x2Au);

        v13 = v45;
        v17 = v47;
      }
    }

    objc_autoreleasePoolPop(v17);
    [v6 add:v13];

LABEL_15:
    v33 = *(a1 + 32);
    v34 = [v33 accessory];
    v35 = [v34 uuid];
    v36 = [v33 modelObjectWithChangeType:3 parentUUID:v35];

    [v6 add:v36];
    [v6 run];
    if (v10 && ([*(a1 + 32) isCancelled] & 1) == 0 && (objc_msgSend(*(a1 + 32), "isExpired") & 1) == 0)
    {
      v37 = *(a1 + 40);
      v38 = [*(a1 + 32) auditUsersToBeAdded];
      [v37 _addUsers:v38 accessory:v10];
    }

    v39 = *MEMORY[0x277D85DE8];
    return;
  }

  v24 = *(a1 + 32);
  v25 = *MEMORY[0x277D85DE8];

  [v3 _updateOutgoingInvitationsWithCompleteUserManagementOperation:v24];
}

- (id)balancedResidentMapForAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  homeManager = [(HMDHome *)self homeManager];
  residentMesh = [homeManager residentMesh];
  v7 = [residentMesh balancedResidentMapForAccessories:accessoriesCopy];

  return v7;
}

- (void)residentDeviceManagerDidUpdateResidents:(id)residents
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome_residentDeviceManagerDidUpdateResidents___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __51__HMDHome_residentDeviceManagerDidUpdateResidents___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _evaluateOwnerTrustZoneCapabilityAndNotify];
  v2 = *(a1 + 32);

  return [v2 _updateResidentFirstAccessoryCommunicationEnabled];
}

- (void)residentDeviceManager:(id)manager didUpdatePrimaryResident:(id)resident previousPrimaryResident:(id)primaryResident
{
  v6 = [(HMDHome *)self workQueue:manager];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(v6, block);
}

void __82__HMDHome_residentDeviceManager_didUpdatePrimaryResident_previousPrimaryResident___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _registerCameraReachabilityEventNotificationsWithCompletionHandler:0];
  [*(a1 + 32) migrateAfterResidentChange];
  [*(a1 + 32) reEvaluateHomeHubState];
  v2 = [*(a1 + 32) stagedRemoteReachabilityRegistration];
  [v2 resetAndStagePriorValue];
}

- (void)residentDeviceManager:(id)manager didUpdateResidentAvailable:(BOOL)available
{
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke;
  v7[3] = &unk_279735D28;
  v7[4] = self;
  availableCopy = available;
  dispatch_async(workQueue, v7);
}

uint64_t __60__HMDHome_residentDeviceManager_didUpdateResidentAvailable___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) shortDescription];
    v7 = v6;
    v8 = *(a1 + 40);
    *buf = 138543874;
    v25 = v5;
    if (v8)
    {
      v9 = @"available";
    }

    else
    {
      v9 = @"unavailable";
    }

    v26 = 2112;
    v27 = v6;
    v28 = 2112;
    v29 = v9;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@[%@] Resident devices are %@ for this home", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v2);
  if ((*(a1 + 40) & 1) == 0)
  {
    [*(a1 + 32) migrateAfterResidentChange];
    if ((*(a1 + 40) & 1) == 0)
    {
      v21 = 0u;
      v22 = 0u;
      v19 = 0u;
      v20 = 0u;
      v10 = [*(a1 + 32) _residentUsers];
      v11 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v20;
        do
        {
          v14 = 0;
          do
          {
            if (*v20 != v13)
            {
              objc_enumerationMutation(v10);
            }

            [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v19 + 1) + 8 * v14++)];
          }

          while (v12 != v14);
          v12 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
        }

        while (v12);
      }

      v15 = [*(a1 + 32) homeManager];
      v16 = [*(a1 + 32) uuid];
      [v15 electRemoteAccessPeerForHome:v16];
    }
  }

  result = [*(a1 + 32) reEvaluateHomeHubState];
  v18 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)retrieveOperationalCertificatesForFabricID:(id)d commissionerNodeID:(id)iD commissioneeNodeID:(id)nodeID publicKey:(id)key completion:(id)completion
{
  v48 = *MEMORY[0x277D85DE8];
  dCopy = d;
  iDCopy = iD;
  nodeIDCopy = nodeID;
  keyCopy = key;
  completionCopy = completion;
  primaryResident = [(HMDHome *)self primaryResident];
  v15 = primaryResident;
  if (primaryResident && ([primaryResident device], (v16 = objc_claimAutoreleasedReturnValue()) != 0) && (-[HMDHome primaryResident](self, "primaryResident"), v17 = objc_claimAutoreleasedReturnValue(), v18 = objc_msgSend(v17, "isReachable"), v17, v16, (v18 & 1) != 0))
  {
    v19 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    device = [v15 device];
    v22 = [(HMDRemoteDeviceMessageDestination *)v19 initWithTarget:uuid device:device];

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    [dictionary setObject:nodeIDCopy forKeyedSubscript:@"HMDHomeCommissioningDeviceNodeIDMessageKey"];
    [dictionary setObject:dCopy forKeyedSubscript:@"HMDHomeCommissioningFabricIDMessageKey"];
    [dictionary setObject:dCopy forKeyedSubscript:@"HMDHomeCommissioningFabricIndexMessageKey"];
    [dictionary setObject:keyCopy forKeyedSubscript:@"HMDHomeCommissioningPublicKeyMessageKey"];
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      [dictionary setObject:iDCopy forKeyedSubscript:@"HMDHomeCommissioningCommissionerNodeIDMessageKey"];
    }

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeRequestCommissioningCertificatesMessage" destination:v22 payload:dictionary];
    [v24 setRemote:1];
    [v24 setSecureRemote:1];
    objc_initWeak(&location, self);
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke;
    v40[3] = &unk_2797355F8;
    objc_copyWeak(&v42, &location);
    v41 = completionCopy;
    [v24 setResponseHandler:v40];
    context = objc_autoreleasePoolPush();
    selfCopy = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      shortDescription = [v24 shortDescription];
      *buf = 138543618;
      v45 = v27;
      v46 = 2112;
      v47 = shortDescription;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to fetch Matter operational certificates from the primary resident", buf, 0x16u);
    }

    objc_autoreleasePoolPop(context);
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    [msgDispatcher sendMessage:v24];

    objc_destroyWeak(&v42);
    objc_destroyWeak(&location);
  }

  else
  {
    v30 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v32 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      v33 = HMFGetLogIdentifier();
      *buf = 138543362;
      v45 = v33;
      _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available or it is unreachable", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v30);
    v34 = MEMORY[0x277CCA9B8];
    v22 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
    dictionary = [v34 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v22];
    (*(completionCopy + 2))(completionCopy, 0, 0, 0, 0, dictionary);
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __113__HMDHome_retrieveOperationalCertificatesForFabricID_commissionerNodeID_commissioneeNodeID_publicKey_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v28 = v11;
        v29 = 2112;
        v30 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for operational certificates failed with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDHomeCommissioningRootCertMessageKey"];
      v13 = [v6 hmf_dataForKey:@"HMDHomeCommissioningOperationalCertMessageKey"];
      v14 = [v6 hmf_numberForKey:@"HMDHomeCommissioningOwnerNodeIDMessageKey"];
      v15 = [v6 hmf_dataForKey:@"HMDHomeCommissioningIPKMessageKey"];
      context = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      if (v12 && v13)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          HMFGetLogIdentifier();
          v19 = v24 = v15;
          *buf = 138544130;
          v28 = v19;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for operational certificates successful. rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v24;
        }

        objc_autoreleasePoolPop(context);
        (*(*(a1 + 32) + 16))();
      }

      else
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v20 = v25 = v15;
          *buf = 138544130;
          v28 = v20;
          v29 = 2112;
          v30 = v12;
          v31 = 2112;
          v32 = v13;
          v33 = 2112;
          v34 = v14;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Primary resident returned unexpected values for rootCertificate %@, operationalCert %@, ownerNodeID %@", buf, 0x2Au);

          v15 = v25;
        }

        objc_autoreleasePoolPop(context);
        v21 = *(a1 + 32);
        v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v21 + 16))(v21, 0, 0, 0, 0, v22);
      }
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataFromPrimaryResidentWithCompletion:(id)completion
{
  v26 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  primaryResident = [(HMDHome *)self primaryResident];
  v6 = [(HMDHome *)self _checkResidentCapabilitiesForCredentialSharing:primaryResident];
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v25 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find compatible resident to fetch Thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    completionCopy[2](completionCopy, 0, v6);
  }

  else
  {
    v11 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    device = [primaryResident device];
    v14 = [(HMDRemoteDeviceMessageDestination *)v11 initWithTarget:uuid device:device];

    v15 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeThreadNetworkCredentialsRequestKey" destination:v14 payload:0];
    [v15 setRemote:1];
    [v15 setSecureRemote:1];
    objc_initWeak(buf, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke;
    v21 = &unk_2797355F8;
    objc_copyWeak(&v23, buf);
    v22 = completionCopy;
    [v15 setResponseHandler:&v18];
    v16 = [(HMDHome *)self msgDispatcher:v18];
    [v16 sendMessage:v15 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(buf);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome__fetchMetadataFromPrimaryResidentWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v11;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for Thread Network credentials failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:*MEMORY[0x277CD0620]];
      v40 = 0;
      v13 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v12 error:&v40];
      v38 = v40;
      v14 = [v6 hmf_dataForKey:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];
      v15 = objc_autoreleasePoolPush();
      v16 = WeakRetained;
      v17 = HMFGetOSLogHandle();
      v18 = v17;
      v39 = v14;
      if (v13)
      {
        v19 = v14 == 0;
      }

      else
      {
        v19 = 1;
      }

      if (v19)
      {
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v21 = v20 = v12;
          v22 = [v39 length];
          *buf = 138543874;
          v42 = v21;
          v43 = 2112;
          v44 = v13;
          v45 = 2048;
          v46 = v22;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Missing metadata (%@)/masterKeyData (length %zu) in response", buf, 0x20u);

          v12 = v20;
        }

        objc_autoreleasePoolPop(v15);
        v23 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        (*(v23 + 16))(v23, 0, v24);
        v14 = v39;
      }

      else
      {
        v36 = v6;
        v37 = v12;
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v26;
          _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Request for Thread Network Metadata successful", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v15);
        v35 = objc_alloc(MEMORY[0x277CD1EA8]);
        v33 = [v13 name];
        v34 = [v13 channel];
        v32 = [v13 PANID];
        v27 = [v13 extendedPANID];
        v28 = [v13 passPhrase];
        v29 = [v13 PSKc];
        v30 = [v13 operationalDataset];
        v24 = [v35 initWithName:v33 channel:v34 PANID:v32 extendedPANID:v27 masterKey:v14 passPhrase:v28 PSKc:v29 operationalDataset:v30];

        (*(*(a1 + 32) + 16))();
        v6 = v36;
        v12 = v37;
      }
    }
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (id)_checkResidentCapabilitiesForCredentialSharing:(id)sharing
{
  v21 = *MEMORY[0x277D85DE8];
  sharingCopy = sharing;
  v5 = sharingCopy;
  if (sharingCopy && ([sharingCopy device], v6 = objc_claimAutoreleasedReturnValue(), v6, v6))
  {
    capabilities = [v5 capabilities];
    supportsThreadNetworkCredentialSharing = [capabilities supportsThreadNetworkCredentialSharing];

    if (supportsThreadNetworkCredentialSharing)
    {
      v9 = 0;
      goto LABEL_12;
    }

    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Primary resident doesn't support Thread Network Credential sharing", &v19, 0xCu);
    }

    v14 = 92;
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request thread credentials from", &v19, 0xCu);
    }

    v14 = 91;
  }

  objc_autoreleasePoolPop(v10);
  v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v14];
LABEL_12:

  v17 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)removeThreadNetworkPreferredNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  v4 = +[HMDThreadNetworkMetadataStore defaultStore];
  [v4 removePreferredNetworkWithCompletion:completionCopy];
}

- (void)retrieveThreadNetworkMetadataWithNoFallbackWithCompletion:(id)completion
{
  v31 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (![(HMDHome *)self isSharedAdmin]&& ![(HMDHome *)self isOwnerUser])
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v20;
      _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@Unexpected user. Returning without retrieving thread network credentials", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
    residentDevices = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    completionCopy[2](completionCopy, 0, residentDevices);
    goto LABEL_23;
  }

  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    if ([residentDevices count])
    {
      primaryResident = [(HMDHome *)self primaryResident];
      isReachable = [primaryResident isReachable];

      if (isReachable)
      {
        v27[0] = MEMORY[0x277D85DD0];
        v27[1] = 3221225472;
        v27[2] = __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke;
        v27[3] = &unk_27972EFA0;
        v27[4] = self;
        v28 = completionCopy;
        [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:v27];

LABEL_23:
        goto LABEL_24;
      }
    }

    if ([(HMDHome *)self isSharedAdmin])
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v12;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@No resident available. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v13 = [residentDevices count];
      v14 = MEMORY[0x277CCA9B8];
      if (!v13)
      {
        v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
        completionCopy[2](completionCopy, 0, v15);
        goto LABEL_22;
      }

      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v14 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      completionCopy[2](completionCopy, 0, v16);
    }

    else
    {
      if (![residentDevices count])
      {
        [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:completionCopy];
        goto LABEL_23;
      }

      v21 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        v24 = HMFGetLogIdentifier();
        *buf = 138543362;
        v30 = v24;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not reachable. Returning without retrieving thread network credentials", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v21);
      v25 = MEMORY[0x277CCA9B8];
      v15 = [MEMORY[0x277CCA9B8] hmdErrorWithCode:2];
      v16 = [v25 hmErrorWithCode:52 description:0 reason:0 suggestion:0 underlyingError:v15];
      completionCopy[2](completionCopy, 0, v16);
    }

LABEL_22:
    goto LABEL_23;
  }

  [(HMDHome *)self _fetchMetadataOnCurrentDeviceWithCompletion:completionCopy];
LABEL_24:

  v26 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_retrieveThreadNetworkMetadataWithNoFallbackWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543618;
      v14 = v11;
      v15 = 2112;
      v16 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to get thread network credentials from resident. Not falling back. Error: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
  }

  (*(*(a1 + 40) + 16))();

  v12 = *MEMORY[0x277D85DE8];
}

- (void)retrieveThreadNetworkMetadataWithCompletion:(id)completion
{
  v14 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (![(HMDHome *)self isSharedAdmin])
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      v10 = +[HMDThreadNetworkMetadataStore defaultStore];
      [v10 retrieveMetadataWithCompletion:completionCopy];
LABEL_12:

      goto LABEL_13;
    }

    v5 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Unexpected user. Returning without retrieving thread network credentials";
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v5);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:47];
    completionCopy[2](completionCopy, 0, v10);
    goto LABEL_12;
  }

  if ([(HMDHome *)self isCurrentDevicePrimaryResident])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v8;
      v9 = "%{public}@Running as a shared admin on primary resident; This is unexpected. Returning without retrieving thread network credentials";
LABEL_10:
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, v9, &v12, 0xCu);

      goto LABEL_11;
    }

    goto LABEL_11;
  }

  [(HMDHome *)self _fetchMetadataFromPrimaryResidentWithCompletion:completionCopy];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_fetchMetadataOnCurrentDeviceWithCompletion:(id)completion
{
  completionCopy = completion;
  v6 = +[HMDThreadNetworkMetadataStore defaultStore];
  threadOperationalDataset = [(HMDHome *)self threadOperationalDataset];
  [v6 retrieveMetadata:threadOperationalDataset homeHasResident:-[HMDHome doesHomeContainResident](self completion:{"doesHomeContainResident"), completionCopy}];
}

- (void)_unconfigurePairedAccessoriesForServer:(id)server updateReachability:(BOOL)reachability
{
  reachabilityCopy = reachability;
  v24 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  if ([serverCopy isPaired])
  {
    if (reachabilityCopy)
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v21 = v10;
        v22 = 2112;
        v23 = serverCopy;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting reachability to false for all paired accessories associated with %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
    }

    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    identifier = [serverCopy identifier];
    linkType = [serverCopy linkType];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __69__HMDHome__unconfigurePairedAccessoriesForServer_updateReachability___block_invoke;
    v16[3] = &unk_279722B60;
    v17 = identifier;
    v18 = linkType;
    v19 = reachabilityCopy;
    v14 = identifier;
    [(HMDHome *)self _notifyRetrievalError:v11 accessoryServer:v14 linkType:linkType accessoryOperationBlock:v16];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedAccessoryServer:(id)server reAddServices:(BOOL)services
{
  v303 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v292 = v8;
    v293 = 2112;
    v294 = serverCopy;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating existing HMDAccessory objects from HAPAccessory objects for server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v212 = [(HMDHome *)selfCopy _primaryAccessoryForServer:serverCopy];
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  configNumber = [v212 configNumber];
  v9 = MEMORY[0x277CBEB18];
  accessories = [serverCopy accessories];
  v195 = [v9 arrayWithArray:accessories];

  v11 = MEMORY[0x277CBEB18];
  v12 = [(HMDHome *)selfCopy hapAccessoriesForServer:serverCopy];
  v208 = [v11 arrayWithArray:v12];

  v13 = objc_autoreleasePoolPush();
  v226 = selfCopy;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    v16 = [v208 count];
    identifier = [serverCopy identifier];
    accessories2 = [serverCopy accessories];
    v19 = [accessories2 count];
    *buf = 138544130;
    v292 = v15;
    v293 = 2050;
    v294 = v16;
    v295 = 2114;
    v296 = identifier;
    v297 = 2050;
    v298 = v19;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Found %{public}tu existing HMDAccessory objects associated with the server: '%{public}@' and discovered %{public}tu HAPAccessory objects", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v13);
  array3 = [MEMORY[0x277CBEB18] array];
  array4 = [MEMORY[0x277CBEB18] array];
  array5 = [MEMORY[0x277CBEB18] array];
  array6 = [MEMORY[0x277CBEB18] array];
  array7 = [MEMORY[0x277CBEB18] array];
  context = [MEMORY[0x277CBEB18] array];
  v272 = 0u;
  v273 = 0u;
  v270 = 0u;
  v271 = 0u;
  obj = [serverCopy accessories];
  v214 = [obj countByEnumeratingWithState:&v270 objects:v289 count:16];
  if (v214)
  {
    v209 = *v271;
    do
    {
      for (i = 0; i != v214; ++i)
      {
        if (*v271 != v209)
        {
          objc_enumerationMutation(obj);
        }

        v21 = *(*(&v270 + 1) + 8 * i);
        v266 = 0u;
        v267 = 0u;
        v268 = 0u;
        v269 = 0u;
        v22 = v208;
        v23 = [v22 countByEnumeratingWithState:&v266 objects:v288 count:16];
        if (!v23)
        {
          goto LABEL_21;
        }

        v24 = *v267;
        while (2)
        {
          for (j = 0; j != v23; ++j)
          {
            if (*v267 != v24)
            {
              objc_enumerationMutation(v22);
            }

            v26 = *(*(&v266 + 1) + 8 * j);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v27 = v26;
            }

            else
            {
              v27 = 0;
            }

            v28 = v27;

            if ([v28 matchesHAPAccessory:v21])
            {

              if (!v28)
              {
                goto LABEL_56;
              }

              if (([v28 isPrimary] & 1) == 0 && (objc_msgSend(v28, "isPaired") & 1) == 0)
              {
                v60 = objc_autoreleasePoolPush();
                v61 = v226;
                v62 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
                {
                  v63 = HMFGetLogIdentifier();
                  shortDescription = [v28 shortDescription];
                  *buf = 138543618;
                  v292 = v63;
                  v293 = 2114;
                  v294 = shortDescription;
                  _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@Skipping configuring unpaired secondary accessory with identifier: %{public}@", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v60);
                goto LABEL_55;
              }

              [array addObject:v21];
              [array2 addObject:v28];
              uuid = [v28 uuid];
              hostAccessory = [v28 hostAccessory];
              uuid2 = [hostAccessory uuid];
              v32 = [(HMDHome *)v226 getTransactionFromHAPAccessory:v21 hmdAccessory:v28 uuid:uuid hostAccessoryUUID:uuid2 objectChangeType:2];

              v33 = v21;
              v34 = v28;
              v35 = v32;
              initialManufacturer = [v34 initialManufacturer];
              if (initialManufacturer)
              {
LABEL_28:
              }

              else
              {
                manufacturer = [v33 manufacturer];
                v38 = manufacturer == 0;

                if (!v38)
                {
                  initialManufacturer = [v33 manufacturer];
                  [v35 setInitialManufacturer:initialManufacturer];
                  goto LABEL_28;
                }
              }

              initialModel = [v34 initialModel];
              if (initialModel)
              {
LABEL_32:
              }

              else
              {
                model = [v33 model];
                v41 = model == 0;

                if (!v41)
                {
                  initialModel = [v33 model];
                  [v35 setInitialModel:initialModel];
                  goto LABEL_32;
                }
              }

              initialCategoryIdentifier = [v34 initialCategoryIdentifier];
              if (initialCategoryIdentifier)
              {
LABEL_36:
              }

              else
              {
                category = [v33 category];
                v44 = category == 0;

                if (!v44)
                {
                  initialCategoryIdentifier = [v33 category];
                  [v35 setInitialCategoryIdentifier:initialCategoryIdentifier];
                  goto LABEL_36;
                }
              }

              initialServiceTypeUUIDs = [v34 initialServiceTypeUUIDs];
              v46 = initialServiceTypeUUIDs == 0;

              if (v46)
              {
                v47 = serviceTypeUUIDsForAccessory(v33);
                if (v47)
                {
                  [v35 setInitialServiceTypeUUIDs:v47];
                }
              }

              v265 = array6;
              v264 = array7;
              v263 = context;
              [(HMDHome *)v226 getUpdateTransactionForAccessory:v34 hapAccessory:v33 accessoryTransaction:v35 addSvcTransactions:&v265 updateSvcTransactions:&v264 removeSvcTransactions:&v263];
              val = v265;

              v224 = v264;
              v221 = v263;

              if ([v33 isPrimary])
              {
                setupHash = [serverCopy setupHash];
                if (setupHash)
                {
                  contexta = objc_autoreleasePoolPush();
                  v49 = v226;
                  v50 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
                  {
                    v51 = HMFGetLogIdentifier();
                    shortDescription2 = [v34 shortDescription];
                    *buf = 138543874;
                    v292 = v51;
                    v293 = 2112;
                    v294 = setupHash;
                    v295 = 2112;
                    v296 = shortDescription2;
                    _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Saving setup hash '%@ for accessory %@", buf, 0x20u);
                  }

                  objc_autoreleasePoolPop(contexta);
                  [v35 setAccessorySetupHash:setupHash];
                }

                [(HMDHome *)v226 _processUpdatedProductDataForAccessory:v34 hapAccessory:v33 transaction:v35];
              }

              v53 = [v34 modelObjectWithChangeType:1];
              v262 = 0;
              [v53 diff:v35 differingFields:&v262];
              v54 = v262;

              if ([(__CFString *)v54 count])
              {
                v55 = objc_autoreleasePoolPush();
                v56 = v226;
                v57 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
                {
                  v58 = HMFGetLogIdentifier();
                  shortDescription3 = [v212 shortDescription];
                  *buf = 138544130;
                  v292 = v58;
                  v293 = 2114;
                  v294 = shortDescription3;
                  v295 = 2114;
                  v296 = v35;
                  v297 = 2114;
                  v298 = v54;
                  _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v55);
                [array4 addObject:v35];
              }

              context = v221;
              array7 = v224;
              array6 = val;
              goto LABEL_55;
            }
          }

          v23 = [v22 countByEnumeratingWithState:&v266 objects:v288 count:16];
          if (v23)
          {
            continue;
          }

          break;
        }

LABEL_21:
        v26 = v22;
LABEL_55:

LABEL_56:
        ;
      }

      v214 = [obj countByEnumeratingWithState:&v270 objects:v289 count:16];
    }

    while (v214);
  }

  v65 = objc_autoreleasePoolPush();
  vala = v226;
  v66 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
  {
    v67 = HMFGetLogIdentifier();
    *buf = 138543618;
    v292 = v67;
    v293 = 2112;
    v294 = serverCopy;
    _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@Finished updating paired accessories for server: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v65);
  [v195 removeObjectsInArray:array];
  [v208 removeObjectsInArray:array2];
  accessories3 = [(HMDHome *)vala accessories];
  v260 = 0u;
  v261 = 0u;
  v258 = 0u;
  v259 = 0u;
  v194 = v195;
  obja = [v194 countByEnumeratingWithState:&v258 objects:v287 count:16];
  if (obja)
  {
    v200 = *v259;
    do
    {
      v68 = 0;
      do
      {
        if (*v259 != v200)
        {
          v69 = v68;
          objc_enumerationMutation(v194);
          v68 = v69;
        }

        v210 = v68;
        v70 = *(*(&v258 + 1) + 8 * v68);
        v254 = 0u;
        v255 = 0u;
        v256 = 0u;
        v257 = 0u;
        v71 = accessories3;
        v72 = [v71 countByEnumeratingWithState:&v254 objects:v286 count:16];
        if (v72)
        {
          v73 = *v255;
LABEL_67:
          v74 = 0;
          while (1)
          {
            if (*v255 != v73)
            {
              objc_enumerationMutation(v71);
            }

            v75 = *(*(&v254 + 1) + 8 * v74);
            objc_opt_class();
            v76 = (objc_opt_isKindOfClass() & 1) != 0 ? v75 : 0;
            v77 = v76;

            identifier2 = [v70 identifier];
            instanceID = [v70 instanceID];
            v80 = [v77 matchesHAPAccessoryWithServerIdentifier:identifier2 instanceID:instanceID];

            if (v80)
            {
              break;
            }

            if (v72 == ++v74)
            {
              v72 = [v71 countByEnumeratingWithState:&v254 objects:v286 count:16];
              if (v72)
              {
                goto LABEL_67;
              }

              goto LABEL_76;
            }
          }

          v227 = objc_autoreleasePoolPush();
          v215 = vala;
          v81 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v81, OS_LOG_TYPE_INFO))
          {
            v196 = HMFGetLogIdentifier();
            server = [v70 server];
            identifier3 = [server identifier];
            instanceID2 = [v70 instanceID];
            linkType = [v70 linkType];
            v85 = @"Undefined";
            if (linkType <= 2)
            {
              v85 = off_279727440[linkType];
            }

            v86 = v85;
            name = [v77 name];
            uniqueIdentifier = [v77 uniqueIdentifier];
            *buf = 138544642;
            v292 = v196;
            v293 = 2114;
            v294 = identifier3;
            v295 = 2114;
            v296 = instanceID2;
            v297 = 2112;
            v298 = v86;
            v299 = 2112;
            v300 = name;
            v301 = 2112;
            v302 = uniqueIdentifier;
            _os_log_impl(&dword_2531F8000, v81, OS_LOG_TYPE_INFO, "%{public}@HAPAccessory %{public}@/%{public}@/%@ matches existing HMDAccessory %@(%@)", buf, 0x3Eu);
          }

          objc_autoreleasePoolPop(v227);
          if (v77)
          {
            [v208 removeObject:v77];
            uuid3 = [v77 uuid];
            hostAccessory2 = [v77 hostAccessory];
            uuid4 = [hostAccessory2 uuid];
            v228 = [(HMDHome *)v215 getTransactionFromHAPAccessory:v70 hmdAccessory:v77 uuid:uuid3 hostAccessoryUUID:uuid4 objectChangeType:2];

            v253 = array6;
            v252 = array7;
            v251 = context;
            [(HMDHome *)v215 getUpdateTransactionForAccessory:v77 hapAccessory:v70 accessoryTransaction:v228 addSvcTransactions:&v253 updateSvcTransactions:&v252 removeSvcTransactions:&v251];
            v92 = v253;

            v93 = v252;
            v94 = v251;

            v95 = [v77 modelObjectWithChangeType:1];
            v250 = 0;
            [v95 diff:v228 differingFields:&v250];
            v96 = v250;

            if ([(__CFString *)v96 count])
            {
              v97 = objc_autoreleasePoolPush();
              v98 = v215;
              v99 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v99, OS_LOG_TYPE_INFO))
              {
                v100 = HMFGetLogIdentifier();
                uuid5 = [v212 uuid];
                *buf = 138544130;
                v292 = v100;
                v293 = 2114;
                v294 = uuid5;
                v295 = 2114;
                v296 = v228;
                v297 = 2114;
                v298 = v96;
                _os_log_impl(&dword_2531F8000, v99, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Received accessory update %{public}@ due to diff %{public}@", buf, 0x2Au);
              }

              objc_autoreleasePoolPop(v97);
              [array4 addObject:v228];
            }

            goto LABEL_94;
          }
        }

        else
        {
LABEL_76:
        }

        if (v212)
        {
          instanceID3 = [v70 instanceID];
          stringValue = [instanceID3 stringValue];
          v285 = stringValue;
          v75 = [MEMORY[0x277CBEA60] arrayWithObjects:&v285 count:1];

          v104 = MEMORY[0x277CCAD78];
          uuid6 = [v212 uuid];
          v228 = [v104 hm_deriveUUIDFromBaseUUID:uuid6 withSalts:v75];

          if (!v228)
          {
            v106 = objc_autoreleasePoolPush();
            v107 = vala;
            v108 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v108, OS_LOG_TYPE_ERROR))
            {
              v109 = HMFGetLogIdentifier();
              shortDescription4 = [v212 shortDescription];
              *buf = 138543618;
              v292 = v109;
              v293 = 2112;
              v294 = shortDescription4;
              _os_log_impl(&dword_2531F8000, v108, OS_LOG_TYPE_ERROR, "%{public}@Error during _processUpdatedAccessoryServer: Primary Accessory for Server has nil UUID: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v106);
            v111 = +[HMDTTRManager sharedManager];
            [v111 requestRadarWithDisplayReason:@"accessory has null identifier" radarTitle:@"PrimaryAccessoryForServer results in nil uuid during processUpdatedAccessoryServer"];
          }

          v112 = objc_autoreleasePoolPush();
          v113 = vala;
          v114 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v114, OS_LOG_TYPE_INFO))
          {
            v115 = HMFGetLogIdentifier();
            shortDescription5 = [v212 shortDescription];
            instanceID4 = [v70 instanceID];
            uUIDString = [v228 UUIDString];
            *buf = 138544130;
            v292 = v115;
            v293 = 2114;
            v294 = shortDescription5;
            v295 = 2114;
            v296 = instanceID4;
            v297 = 2114;
            v298 = uUIDString;
            _os_log_impl(&dword_2531F8000, v114, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding a new bridged accessory instanceID %{public}@ and uuid %{public}@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v112);
          uuid7 = [v212 uuid];
          v96 = [(HMDHome *)v113 getTransactionFromHAPAccessory:v70 hmdAccessory:0 uuid:v228 hostAccessoryUUID:uuid7 objectChangeType:1];

          v249 = array6;
          v248 = array7;
          v247 = context;
          [(HMDHome *)v113 getUpdateTransactionForAccessory:0 hapAccessory:v70 accessoryTransaction:v96 addSvcTransactions:&v249 updateSvcTransactions:&v248 removeSvcTransactions:&v247];
          v92 = v249;

          v93 = v248;
          v94 = v247;

          v120 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v212, "certificationStatus")}];
          [(__CFString *)v96 setCertificationStatus:v120];

          uuidToHAPAccessoryConfigTable = [(HMDHome *)v113 uuidToHAPAccessoryConfigTable];
          [uuidToHAPAccessoryConfigTable setObject:v70 forKey:v228];

          [array3 addObject:v96];
LABEL_94:

          context = v94;
          array7 = v93;
          array6 = v92;
        }

        v68 = v210 + 1;
      }

      while ((v210 + 1) != obja);
      obja = [v194 countByEnumeratingWithState:&v258 objects:v287 count:16];
    }

    while (obja);
  }

  if ([v208 count])
  {
    v245 = 0u;
    v246 = 0u;
    v243 = 0u;
    v244 = 0u;
    v122 = v208;
    v123 = [v122 countByEnumeratingWithState:&v243 objects:v284 count:16];
    if (v123)
    {
      v124 = *v244;
      do
      {
        for (k = 0; k != v123; ++k)
        {
          if (*v244 != v124)
          {
            objc_enumerationMutation(v122);
          }

          v126 = *(*(&v243 + 1) + 8 * k);
          if (([v126 isPrimary] & 1) == 0)
          {
            v127 = [v126 transactionWithObjectChangeType:3];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v128 = v127;
            }

            else
            {
              v128 = 0;
            }

            v129 = v128;

            v130 = objc_autoreleasePoolPush();
            v131 = vala;
            v132 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v132, OS_LOG_TYPE_INFO))
            {
              v133 = HMFGetLogIdentifier();
              shortDescription6 = [v212 shortDescription];
              *buf = 138543874;
              v292 = v133;
              v293 = 2114;
              v294 = shortDescription6;
              v295 = 2114;
              v296 = v129;
              _os_log_impl(&dword_2531F8000, v132, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing a secondary accessory %{public}@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v130);
            if (v129)
            {
              [array5 addObject:v129];
            }
          }
        }

        v123 = [v122 countByEnumeratingWithState:&v243 objects:v284 count:16];
      }

      while (v123);
    }
  }

  v135 = dispatch_group_create();
  v211 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v216 = serverCopy;
  v136 = v212;
  v225 = array6;
  v222 = array7;
  v229 = context;
  contextb = v136;
  configNumber2 = [v136 configNumber];
  if ([v216 configNumber] != configNumber2)
  {

LABEL_123:
    v146 = @"Add Accessory";
    goto LABEL_124;
  }

  if (![v229 count] && !objc_msgSend(v225, "count"))
  {
    v280 = 0u;
    v281 = 0u;
    v278 = 0u;
    v279 = 0u;
    v199 = v222;
    v197 = [v199 countByEnumeratingWithState:&v278 objects:buf count:16];
    if (v197)
    {
      v167 = *v279;
      v213 = *MEMORY[0x277CD2138];
      objb = *MEMORY[0x277CD21A8];
      v188 = *v279;
      while (2)
      {
        v168 = 0;
        do
        {
          if (*v279 != v167)
          {
            v169 = v168;
            objc_enumerationMutation(v199);
            v168 = v169;
          }

          v189 = v168;
          v170 = *(*(&v278 + 1) + 8 * v168);
          instanceID5 = [v170 instanceID];
          v172 = [contextb findService:instanceID5];

          serviceType = [v172 serviceType];
          serviceType2 = [v170 serviceType];
          v175 = [serviceType isEqualToString:serviceType2];

          if (!v175)
          {
LABEL_157:

            goto LABEL_119;
          }

          v276 = 0u;
          v277 = 0u;
          v274 = 0u;
          v275 = 0u;
          characteristics = [v170 characteristics];
          v176 = [characteristics countByEnumeratingWithState:&v274 objects:v290 count:16];
          if (v176)
          {
            v177 = *v275;
            while (2)
            {
              for (m = 0; m != v176; ++m)
              {
                if (*v275 != v177)
                {
                  objc_enumerationMutation(characteristics);
                }

                v179 = *(*(&v274 + 1) + 8 * m);
                v180 = [v179 objectForKeyedSubscript:v213];
                v181 = [v179 objectForKeyedSubscript:objb];
                v182 = [v172 findCharacteristic:v180];
                characteristicType = [v182 characteristicType];
                v184 = [characteristicType isEqualToString:v181];

                if (!v184)
                {

                  goto LABEL_157;
                }
              }

              v176 = [characteristics countByEnumeratingWithState:&v274 objects:v290 count:16];
              if (v176)
              {
                continue;
              }

              break;
            }
          }

          v168 = v189 + 1;
          v167 = v188;
        }

        while (v189 + 1 != v197);
        v197 = [v199 countByEnumeratingWithState:&v278 objects:buf count:16];
        v167 = v188;
        if (v197)
        {
          continue;
        }

        break;
      }
    }

    goto LABEL_123;
  }

LABEL_119:
  v138 = objc_autoreleasePoolPush();
  v139 = vala;
  v140 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v140, OS_LOG_TYPE_ERROR))
  {
    v141 = HMFGetLogIdentifier();
    shortDescription7 = [contextb shortDescription];
    v143 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:configNumber];
    *buf = 138543874;
    v292 = v141;
    v293 = 2112;
    v294 = shortDescription7;
    v295 = 2112;
    v296 = v143;
    _os_log_impl(&dword_2531F8000, v140, OS_LOG_TYPE_ERROR, "%{public}@Only storing the update locally since the accessory %@ didn't update its config number: %@ after updating its services/characteristics.", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v138);
  v144 = @"Add Accessory Locally";
  v145 = +[HMDBackingStoreTransactionOptions defaultLocalOptions];

  v146 = @"Add Accessory Locally";
  v211 = v145;
LABEL_124:
  backingStore = [(HMDHome *)vala backingStore];
  v148 = [backingStore transaction:v146 options:v211];

  v149 = [array4 arrayByAddingObjectsFromArray:array3];
  v150 = [v149 arrayByAddingObjectsFromArray:array5];

  v241 = 0u;
  v242 = 0u;
  v239 = 0u;
  v240 = 0u;
  v151 = v150;
  v152 = [v151 countByEnumeratingWithState:&v239 objects:v283 count:16];
  if (v152)
  {
    v153 = *v240;
    do
    {
      for (n = 0; n != v152; ++n)
      {
        if (*v240 != v153)
        {
          objc_enumerationMutation(v151);
        }

        v155 = *(*(&v239 + 1) + 8 * n);
        [v155 setConfigurationTracker:v135];
        [v148 add:v155 withMessage:0];
      }

      v152 = [v151 countByEnumeratingWithState:&v239 objects:v283 count:16];
    }

    while (v152);
  }

  v156 = [v222 arrayByAddingObjectsFromArray:v225];
  v157 = [v156 arrayByAddingObjectsFromArray:v229];

  v237 = 0u;
  v238 = 0u;
  v235 = 0u;
  v236 = 0u;
  v158 = v157;
  v159 = [v158 countByEnumeratingWithState:&v235 objects:v282 count:16];
  if (v159)
  {
    v160 = *v236;
    do
    {
      for (ii = 0; ii != v159; ++ii)
      {
        if (*v236 != v160)
        {
          objc_enumerationMutation(v158);
        }

        v162 = *(*(&v235 + 1) + 8 * ii);
        [v162 setConfigurationTracker:v135];
        [v148 add:v162 withMessage:0];
      }

      v159 = [v158 countByEnumeratingWithState:&v235 objects:v282 count:16];
    }

    while (v159);
  }

  objc_initWeak(buf, vala);
  v230[0] = MEMORY[0x277D85DD0];
  v230[1] = 3221225472;
  v230[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke;
  v230[3] = &unk_27972F820;
  objc_copyWeak(&v234, buf);
  v163 = v216;
  v231 = v163;
  v164 = v135;
  v232 = v164;
  v165 = array3;
  v233 = v165;
  [v148 run:v230];

  objc_destroyWeak(&v234);
  objc_destroyWeak(buf);

  v166 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v29 = a1;
    v3 = [*(a1 + 32) accessories];
    v31 = WeakRetained;
    v30 = [WeakRetained accessories];
    v4 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v47 = 0u;
    v48 = 0u;
    v49 = 0u;
    v50 = 0u;
    obj = v3;
    v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
    if (v32)
    {
      v28 = *v48;
      do
      {
        v5 = 0;
        do
        {
          if (*v48 != v28)
          {
            objc_enumerationMutation(obj);
          }

          v6 = *(*(&v47 + 1) + 8 * v5);
          v43 = 0u;
          v44 = 0u;
          v45 = 0u;
          v46 = 0u;
          v7 = v30;
          v8 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
          if (v8)
          {
            v9 = v8;
            v10 = *v44;
            do
            {
              v11 = 0;
              do
              {
                if (*v44 != v10)
                {
                  objc_enumerationMutation(v7);
                }

                v12 = *(*(&v43 + 1) + 8 * v11);
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v13 = v12;
                }

                else
                {
                  v13 = 0;
                }

                v14 = v13;

                if (v14 && [v14 matchesHAPAccessory:v6])
                {
                  [v4 setObject:v6 forKey:v14];
                }

                ++v11;
              }

              while (v9 != v11);
              v9 = [v7 countByEnumeratingWithState:&v43 objects:v52 count:16];
            }

            while (v9);
          }

          ++v5;
        }

        while (v5 != v32);
        v32 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
      }

      while (v32);
    }

    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v15 = v4;
    v16 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
    if (v16)
    {
      v17 = v16;
      v33 = *v40;
      do
      {
        v18 = 0;
        do
        {
          if (*v40 != v33)
          {
            objc_enumerationMutation(v15);
          }

          v19 = *(*(&v39 + 1) + 8 * v18);
          dispatch_group_enter(*(v29 + 40));
          v20 = [v15 objectForKey:v19];
          v21 = [v31 notificationRegistrations];
          v22 = [v21 count] != 0;
          v23 = [v31 workQueue];
          v37[0] = MEMORY[0x277D85DD0];
          v37[1] = 3221225472;
          v37[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2;
          v37[3] = &unk_2797359B0;
          v37[4] = v19;
          v38 = *(v29 + 40);
          [v19 configureWithAccessory:v20 homeNotificationsEnabled:v22 queue:v23 completion:v37];

          ++v18;
        }

        while (v17 != v18);
        v17 = [v15 countByEnumeratingWithState:&v39 objects:v51 count:16];
      }

      while (v17);
    }

    v24 = *(v29 + 40);
    WeakRetained = v31;
    v25 = [v31 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3;
    block[3] = &unk_279734960;
    block[4] = v31;
    v35 = *(v29 + 32);
    v36 = *(v29 + 48);
    dispatch_group_notify(v24, v25, block);
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_2(uint64_t a1)
{
  logAndPostNotification(@"HMDAccessoryConnectedNotification", *(a1 + 32), 0);
  [*(a1 + 32) updateLightProfilesSettings];
  v2 = *(a1 + 40);

  dispatch_group_leave(v2);
}

uint64_t __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v46 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) identifier];
  v4 = [v1[5] linkType];
  v38[0] = MEMORY[0x277D85DD0];
  v38[1] = 3221225472;
  v38[2] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4;
  v38[3] = &unk_27972F628;
  v38[4] = v1[4];
  [v2 _notifyRetrievalError:0 accessoryServer:v3 linkType:v4 accessoryOperationBlock:v38];

  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v1[6];
  v5 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v5)
  {
    v7 = v5;
    v8 = *v35;
    v9 = v32;
    *&v6 = 138543874;
    v27 = v6;
    v28 = *v35;
    do
    {
      v10 = 0;
      do
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v11 = v1[4];
        v12 = [*(*(&v34 + 1) + 8 * v10) uuid];
        v13 = [v11 accessoryWithUUID:v12];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = objc_autoreleasePoolPush();
          v17 = v1[4];
          v18 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
          {
            v19 = HMFGetLogIdentifier();
            v20 = [v15 shortDescription];
            [v15 supportsTargetController];
            HMFBooleanToString();
            v30 = v16;
            v21 = v7;
            v22 = v1;
            v24 = v23 = v9;
            *buf = v27;
            v40 = v19;
            v41 = 2112;
            v42 = v20;
            v43 = 2112;
            v44 = v24;
            _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Bridged accessory %@ (supportsTargetController %@) being added to home", buf, 0x20u);

            v8 = v28;
            v9 = v23;
            v1 = v22;
            v7 = v21;
            v16 = v30;
          }

          objc_autoreleasePoolPop(v16);
          v31[0] = MEMORY[0x277D85DD0];
          v31[1] = 3221225472;
          v32[0] = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_1823;
          v32[1] = &unk_2797359D8;
          v33 = v15;
          [v33 readInitialRequiredCharacteristicsForAccessory:v31];
        }

        ++v10;
      }

      while (v7 != v10);
      v7 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v7);
  }

  result = [v1[4] _evaluateShouldRelaunchAndSetRelaunch];
  v26 = *MEMORY[0x277D85DE8];
  return result;
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_4(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 isPrimary])
  {
    v4 = MEMORY[0x277D85DD0];
    v5 = 3221225472;
    v6 = __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5;
    v7 = &unk_2797358C8;
    v8 = *(a1 + 32);
    v9 = v3;
    [v9 maybeCommissionToThreadNetworkWithCompletion:&v4];
  }

  [v3 handleUpdatedServicesForThreadManagementWithCompletion:{0, v4, v5, v6, v7, v8}];
}

void __56__HMDHome__processUpdatedAccessoryServer_reAddServices___block_invoke_5(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) shortDescription];
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Commissioning finished for %@ with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)_processUpdatedProductDataForAccessory:(id)accessory hapAccessory:(id)hapAccessory transaction:(id)transaction
{
  v54 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  hapAccessoryCopy = hapAccessory;
  transactionCopy = transaction;
  productData = [accessoryCopy productData];
  v12 = [(HMDHome *)self _productDataFromHAPAccessory:hapAccessoryCopy];
  v13 = v12;
  if (productData)
  {
    if (v12)
    {
      if (([v12 isEqualToString:productData] & 1) == 0)
      {
        v14 = +[HMDVendorDataManager sharedVendorDataManager];
        v15 = [v14 vendorModelEntryForProductData:productData];

        if (v15)
        {
          productDataAlternates = [v15 productDataAlternates];
          v17 = [productDataAlternates containsObject:v13];

          v18 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v20 = HMFGetOSLogHandle();
          v21 = v20;
          if (v17)
          {
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v22 = v41 = v18;
              shortDescription = [accessoryCopy shortDescription];
              *buf = 138544130;
              v45 = v22;
              v46 = 2112;
              v47 = shortDescription;
              v48 = 2112;
              v49 = productData;
              v50 = 2112;
              v51 = v13;
              _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ has changed its product data to a value that is allowed, binding: %@ -> %@", buf, 0x2Au);

              v18 = v41;
            }

            objc_autoreleasePoolPop(v18);
            [transactionCopy setProductDataV2:v13];
            goto LABEL_22;
          }

          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            v34 = HMFGetLogIdentifier();
            [accessoryCopy shortDescription];
            v38 = v43 = v18;
            *buf = 138544130;
            v45 = v34;
            v46 = 2112;
            v47 = v38;
            v48 = 2112;
            v49 = productData;
            v50 = 2112;
            v51 = v13;
            _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has changed its productData to a value that is not allowed, keeping previous product data: %@ -> %@", buf, 0x2Au);

            v18 = v43;
            goto LABEL_20;
          }
        }

        else
        {
          v18 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            shortDescription2 = [accessoryCopy shortDescription];
            [accessoryCopy manufacturer];
            v36 = v40 = selfCopy2;
            [accessoryCopy model];
            v37 = v42 = v18;
            *buf = 138544386;
            v45 = v34;
            v46 = 2112;
            v47 = shortDescription2;
            v48 = 2112;
            v49 = v36;
            v50 = 2112;
            v51 = v37;
            v52 = 2112;
            v53 = productData;
            _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ could not be found in the VIDB, keeping previous product data (manufacturer: '%@', model: '%@', productData: '%@')", buf, 0x34u);

            v18 = v42;
            selfCopy2 = v40;

            v15 = 0;
LABEL_20:
          }
        }

        objc_autoreleasePoolPop(v18);
LABEL_22:
      }
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        shortDescription3 = [accessoryCopy shortDescription];
        *buf = 138543874;
        v45 = v32;
        v46 = 2112;
        v47 = shortDescription3;
        v48 = 2112;
        v49 = productData;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is no longer advertising product data, keeping previous product data %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }
  }

  else if (v12)
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
    {
      v27 = HMFGetLogIdentifier();
      shortDescription4 = [accessoryCopy shortDescription];
      *buf = 138543874;
      v45 = v27;
      v46 = 2112;
      v47 = shortDescription4;
      v48 = 2112;
      v49 = v13;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to product data %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v24);
    [transactionCopy setProductDataV2:v13];
    [transactionCopy setProductData:v13];
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (void)_processProductDataForNewlyAddedAccessory:(id)accessory transaction:(id)transaction
{
  v21 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  transactionCopy = transaction;
  v8 = [(HMDHome *)self _productDataFromHAPAccessory:accessoryCopy];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      v15 = 138543874;
      v16 = v12;
      v17 = 2112;
      v18 = shortDescription;
      v19 = 2112;
      v20 = v8;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Accessory %@ is now bound to productData %@", &v15, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [transactionCopy setProductDataV2:v8];
    [transactionCopy setProductData:v8];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_productDataFromHAPAccessory:(id)accessory
{
  v61 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  server = [accessoryCopy server];
  productData = [server productData];

  if (productData)
  {
    productData2 = [server productData];
    v8 = [HMDAccessory validateProductData:productData2];

    if (v8)
    {
      productData3 = [accessoryCopy productData];
      if (productData3)
      {
        v10 = productData3;
        productData4 = [server productData];
        productData5 = [accessoryCopy productData];
        v13 = [productData4 isEqualToString:productData5];

        if ((v13 & 1) == 0)
        {
          v14 = objc_autoreleasePoolPush();
          selfCopy = self;
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            v17 = HMFGetLogIdentifier();
            shortDescription = [accessoryCopy shortDescription];
            productData6 = [server productData];
            productData7 = [accessoryCopy productData];
            v53 = 138544130;
            v54 = v17;
            v55 = 2112;
            v56 = shortDescription;
            v57 = 2112;
            v58 = productData6;
            v59 = 2112;
            v60 = productData7;
            _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ is using productData from pair setup that differs from productData published on AIS: %@ != %@", &v53, 0x2Au);
          }

          objc_autoreleasePoolPop(v14);
        }
      }

      v21 = server;
      goto LABEL_15;
    }

    v22 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      shortDescription2 = [accessoryCopy shortDescription];
      productData8 = [server productData];
      v53 = 138543874;
      v54 = v25;
      v55 = 2112;
      v56 = shortDescription2;
      v57 = 2112;
      v58 = productData8;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData from pair setup: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  productData9 = [accessoryCopy productData];

  if (productData9)
  {
    productData10 = [accessoryCopy productData];
    v30 = [HMDAccessory validateProductData:productData10];

    if (v30)
    {
      v21 = accessoryCopy;
LABEL_15:
      productData11 = [v21 productData];
      goto LABEL_29;
    }

    v32 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      shortDescription3 = [accessoryCopy shortDescription];
      productData12 = [accessoryCopy productData];
      v53 = 138543874;
      v54 = v35;
      v55 = 2112;
      v56 = shortDescription3;
      v57 = 2112;
      v58 = productData12;
      _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Accessory %@ has invalid productData published on AIS: %@", &v53, 0x20u);
    }

    objc_autoreleasePoolPop(v32);
  }

  v38 = +[HMDVendorDataManager sharedVendorDataManager];
  manufacturer = [accessoryCopy manufacturer];
  model = [accessoryCopy model];
  v41 = [v38 vendorModelEntryForManufacturer:manufacturer model:model];

  if (!v41)
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy5 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      shortDescription4 = [accessoryCopy shortDescription];
      manufacturer2 = [accessoryCopy manufacturer];
      model2 = [accessoryCopy model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = shortDescription4;
      v57 = 2112;
      v58 = manufacturer2;
      v59 = 2112;
      v60 = model2;
      v50 = "%{public}@Accessory %@ could not be found in the VIDB (manufacturer: '%@', model: '%@')";
LABEL_26:
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, v50, &v53, 0x2Au);
    }

LABEL_27:

    objc_autoreleasePoolPop(v43);
    productData11 = 0;
    goto LABEL_28;
  }

  productData13 = [v41 productData];

  if (!productData13)
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy5 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      shortDescription4 = [accessoryCopy shortDescription];
      manufacturer2 = [accessoryCopy manufacturer];
      model2 = [accessoryCopy model];
      v53 = 138544130;
      v54 = v46;
      v55 = 2112;
      v56 = shortDescription4;
      v57 = 2112;
      v58 = manufacturer2;
      v59 = 2112;
      v60 = model2;
      v50 = "%{public}@Accessory %@ does not have productData in the VIDB (manufacturer: '%@', model: '%@')";
      goto LABEL_26;
    }

    goto LABEL_27;
  }

  productData11 = [v41 productData];
LABEL_28:

LABEL_29:
  v51 = *MEMORY[0x277D85DE8];

  return productData11;
}

- (void)filterServiceTransactions:(id)transactions removedServiceUUIDs:(id)ds
{
  v41 = *MEMORY[0x277D85DE8];
  transactionsCopy = transactions;
  dsCopy = ds;
  if (transactionsCopy && [transactionsCopy count] && objc_msgSend(dsCopy, "count"))
  {
    indexSet = [MEMORY[0x277CCAB58] indexSet];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    v26 = transactionsCopy;
    v9 = transactionsCopy;
    v10 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v31;
      v27 = *v31;
      v28 = v9;
      do
      {
        v13 = 0;
        v29 = v11;
        do
        {
          if (*v31 != v12)
          {
            objc_enumerationMutation(v9);
          }

          v14 = *(*(&v30 + 1) + 8 * v13);
          uuid = [v14 uuid];
          v16 = [dsCopy containsObject:uuid];

          if (v16)
          {
            [indexSet addIndex:{objc_msgSend(v9, "indexOfObject:", v14)}];
            v17 = objc_autoreleasePoolPush();
            selfCopy = self;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
            {
              v20 = HMFGetLogIdentifier();
              [v14 uuid];
              v21 = indexSet;
              selfCopy2 = self;
              v24 = v23 = dsCopy;
              *buf = 138543874;
              v35 = v20;
              v36 = 2114;
              v37 = v24;
              v38 = 2114;
              v39 = v14;
              _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] Removing duplicate service transaction %{public}@", buf, 0x20u);

              dsCopy = v23;
              self = selfCopy2;
              indexSet = v21;
              v9 = v28;

              v12 = v27;
            }

            objc_autoreleasePoolPop(v17);
            v11 = v29;
          }

          ++v13;
        }

        while (v11 != v13);
        v11 = [v9 countByEnumeratingWithState:&v30 objects:v40 count:16];
      }

      while (v11);
    }

    [v9 removeObjectsAtIndexes:indexSet];
    transactionsCopy = v26;
  }

  v25 = *MEMORY[0x277D85DE8];
}

- (BOOL)getUpdateTransactionForAccessory:(id)accessory hapAccessory:(id)hapAccessory accessoryTransaction:(id)transaction addSvcTransactions:(id *)transactions updateSvcTransactions:(id *)svcTransactions removeSvcTransactions:(id *)removeSvcTransactions
{
  v170 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  hapAccessoryCopy = hapAccessory;
  transactionCopy = transaction;
  services = [accessoryCopy services];
  v14 = [services mutableCopy];

  v155 = 0u;
  v156 = 0u;
  v153 = 0u;
  v154 = 0u;
  v116 = hapAccessoryCopy;
  services2 = [hapAccessoryCopy services];
  v16 = [services2 countByEnumeratingWithState:&v153 objects:v169 count:16];
  v126 = accessoryCopy;
  v122 = transactionCopy;
  if (!v16)
  {
    goto LABEL_65;
  }

  v17 = v16;
  v18 = *v154;
  parentUUID2 = 138544130;
  v121 = services2;
  v123 = *v154;
  while (2)
  {
    v19 = 0;
    v124 = v17;
    do
    {
      v127 = v14;
      if (*v154 != v18)
      {
        objc_enumerationMutation(services2);
      }

      v125 = v19;
      v20 = *(*(&v153 + 1) + 8 * v19);
      dataSource = [(HMDHome *)self dataSource];
      hapMetadata = [dataSource hapMetadata];
      type = [v20 type];
      v24 = [hapMetadata shouldFilterServiceOfType:type];

      if (v24)
      {
        v14 = v127;
        goto LABEL_63;
      }

      v151 = 0u;
      v152 = 0u;
      v149 = 0u;
      v150 = 0u;
      services3 = [accessoryCopy services];
      v26 = [services3 countByEnumeratingWithState:&v149 objects:v168 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v150;
        while (2)
        {
          for (i = 0; i != v27; ++i)
          {
            if (*v150 != v28)
            {
              objc_enumerationMutation(services3);
            }

            v30 = *(*(&v149 + 1) + 8 * i);
            instanceID = [v30 instanceID];
            instanceID2 = [v20 instanceID];
            v33 = [instanceID isEqual:instanceID2];

            if (v33)
            {
              v34 = v30;
              goto LABEL_18;
            }
          }

          v27 = [services3 countByEnumeratingWithState:&v149 objects:v168 count:16];
          if (v27)
          {
            continue;
          }

          break;
        }

        v34 = 0;
LABEL_18:
        services2 = v121;
        transactionCopy = v122;
      }

      else
      {
        v34 = 0;
      }

      uuid = [transactionCopy uuid];
      if (v34)
      {
        v36 = 2;
      }

      else
      {
        v36 = 1;
      }

      v37 = [(HMDHome *)self getServiceTransaction:v20 parentUUID:uuid changeType:v36];

      type2 = [(HMDServiceTransaction *)v34 type];
      if (type2)
      {
        v39 = type2;
        type3 = [(HMDServiceTransaction *)v34 type];
        serviceType = [(HMDServiceTransaction *)v37 serviceType];
        v42 = [type3 isEqualToString:serviceType];

        if ((v42 & 1) == 0)
        {

          v111 = 0;
          v94 = v127;
          goto LABEL_82;
        }
      }

      [(HMDHome *)self __updateServiceTransaction:v37 accessoryTransaction:transactionCopy service:v34 accessory:accessoryCopy hapService:v20];
      accessory = [(HMDServiceTransaction *)v34 accessory];
      shortDescription = [accessory shortDescription];
      v45 = shortDescription;
      v46 = v37;
      if (shortDescription)
      {
        uUIDString = shortDescription;
      }

      else
      {
        parentUUID = [(HMDBackingStoreModelObject *)v37 parentUUID];
        uUIDString = [parentUUID UUIDString];
      }

      if (!v34)
      {
        goto LABEL_59;
      }

      uuid2 = [(HMDBackingStoreModelObject *)v34 uuid];
      uuid3 = [(HMDBackingStoreModelObject *)v37 uuid];
      v50 = [uuid2 isEqual:uuid3];

      if ((v50 & 1) == 0)
      {
        v84 = objc_autoreleasePoolPush();
        selfCopy = self;
        v86 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v86, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v88 = v87 = v37;
          uuid4 = [(HMDBackingStoreModelObject *)v37 uuid];
          *buf = 138544130;
          v161 = v88;
          v162 = 2114;
          v163 = uuid4;
          v164 = 2114;
          v165 = v34;
          v166 = 2114;
          v167 = v87;
          _os_log_impl(&dword_2531F8000, v86, OS_LOG_TYPE_ERROR, "%{public}@[Pair-Verify %{public}@] matched service %{public}@ doesn't match the service transaction: %{public}@. Removing it to re-add.", buf, 0x2Au);

          v46 = v87;
        }

        objc_autoreleasePoolPop(v84);
LABEL_59:
        v90 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v92 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
        {
          v93 = HMFGetLogIdentifier();
          *buf = 138543874;
          v161 = v93;
          v162 = 2114;
          v163 = uUIDString;
          v164 = 2114;
          v165 = v46;
          _os_log_impl(&dword_2531F8000, v92, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Adding service %{public}@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v90);
        [*transactions addObject:v46];
        v14 = v127;
        goto LABEL_62;
      }

      v51 = [(HMDServiceTransaction *)v34 modelObjectWithChangeType:1];
      v148 = 0;
      v131 = v51;
      [v51 diff:v37 differingFields:&v148];
      v52 = v148;
      v119 = v52;
      v132 = v37;
      if (svcTransactions)
      {
        v53 = v52;
        if ([(HMDServiceTransaction *)v52 count])
        {
          v117 = v34;
          v54 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            *buf = 138544130;
            v161 = v57;
            v162 = 2112;
            v163 = uUIDString;
            v164 = 2114;
            v165 = v46;
            v166 = 2114;
            v167 = v53;
            _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %@] Received service update %{public}@ due to diff %{public}@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v54);
          v146 = 0u;
          v147 = 0u;
          v144 = 0u;
          v145 = 0u;
          obj = v53;
          v58 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
          if (v58)
          {
            v59 = v58;
            v60 = *v145;
            do
            {
              for (j = 0; j != v59; ++j)
              {
                if (*v145 != v60)
                {
                  objc_enumerationMutation(obj);
                }

                v62 = *(*(&v144 + 1) + 8 * j);
                v63 = objc_autoreleasePoolPush();
                v64 = selfCopy3;
                v65 = selfCopy3;
                v66 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
                {
                  v67 = HMFGetLogIdentifier();
                  v68 = [v131 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v67;
                  v162 = 2114;
                  v163 = uUIDString;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v68;
                  _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] LOCAL %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v63);
                v69 = objc_autoreleasePoolPush();
                v70 = v65;
                v71 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
                {
                  v72 = HMFGetLogIdentifier();
                  v73 = [(HMDServiceTransaction *)v132 valueForKeyPath:v62];
                  *buf = 138544130;
                  v161 = v72;
                  v162 = 2114;
                  v163 = uUIDString;
                  v164 = 2114;
                  v165 = v62;
                  v166 = 2114;
                  v167 = v73;
                  _os_log_impl(&dword_2531F8000, v71, OS_LOG_TYPE_INFO, "%{public}@[%{public}@] UPDATE %{public}@: %{public}@", buf, 0x2Au);
                }

                objc_autoreleasePoolPop(v69);
                selfCopy3 = v64;
              }

              v59 = [(HMDServiceTransaction *)obj countByEnumeratingWithState:&v144 objects:v159 count:16];
            }

            while (v59);
          }

          [*svcTransactions addObject:v132];
          v34 = v117;
        }
      }

      v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v127, "count")}];
      v140 = 0u;
      v141 = 0u;
      v142 = 0u;
      v143 = 0u;
      v75 = v127;
      v76 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
      if (v76)
      {
        v77 = v76;
        v78 = *v141;
        do
        {
          for (k = 0; k != v77; ++k)
          {
            if (*v141 != v78)
            {
              objc_enumerationMutation(v75);
            }

            v80 = *(*(&v140 + 1) + 8 * k);
            uuid5 = [v80 uuid];
            uuid6 = [(HMDBackingStoreModelObject *)v34 uuid];
            v83 = [uuid5 isEqual:uuid6];

            if ((v83 & 1) == 0)
            {
              [v74 addObject:v80];
            }
          }

          v77 = [v75 countByEnumeratingWithState:&v140 objects:v158 count:16];
        }

        while (v77);
      }

      uUIDString = v132;
      v46 = v34;
      v14 = v74;
      accessoryCopy = v126;
      services2 = v121;
      transactionCopy = v122;
LABEL_62:
      v18 = v123;
      v17 = v124;

LABEL_63:
      v19 = v125 + 1;
    }

    while (v125 + 1 != v17);
    v17 = [services2 countByEnumeratingWithState:&v153 objects:v169 count:16];
    if (v17)
    {
      continue;
    }

    break;
  }

LABEL_65:

  v138 = 0u;
  v139 = 0u;
  v136 = 0u;
  v137 = 0u;
  v94 = v14;
  v95 = [v94 countByEnumeratingWithState:&v136 objects:v157 count:16];
  if (v95)
  {
    v96 = v95;
    v128 = v94;
    v97 = *v137;
    do
    {
      for (m = 0; m != v96; ++m)
      {
        if (*v137 != v97)
        {
          objc_enumerationMutation(v128);
        }

        v99 = *(*(&v136 + 1) + 8 * m);
        v100 = [HMDServiceTransaction alloc];
        uuid7 = [v99 uuid];
        uuid8 = [accessoryCopy uuid];
        v103 = [(HMDBackingStoreModelObject *)v100 initWithObjectChangeType:3 uuid:uuid7 parentUUID:uuid8];

        v104 = objc_autoreleasePoolPush();
        selfCopy4 = self;
        v106 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v106, OS_LOG_TYPE_INFO))
        {
          v107 = HMFGetLogIdentifier();
          accessory2 = [v99 accessory];
          shortDescription2 = [accessory2 shortDescription];
          v110 = shortDescription2;
          if (!shortDescription2)
          {
            parentUUID2 = [(HMDBackingStoreModelObject *)v103 parentUUID];
            v110 = parentUUID2;
          }

          *buf = 138543874;
          v161 = v107;
          v162 = 2114;
          v163 = v110;
          v164 = 2114;
          v165 = v103;
          _os_log_impl(&dword_2531F8000, v106, OS_LOG_TYPE_INFO, "%{public}@[Pair-Verify %{public}@] Removing service %{public}@", buf, 0x20u);
          if (!shortDescription2)
          {
          }

          accessoryCopy = v126;
        }

        objc_autoreleasePoolPop(v104);
        [*removeSvcTransactions addObject:v103];
      }

      v96 = [v128 countByEnumeratingWithState:&v136 objects:v157 count:16];
    }

    while (v96);
    v94 = v128;

    transactionCopy = v122;
    goto LABEL_81;
  }

  if (removeSvcTransactions)
  {
LABEL_81:
    v112 = MEMORY[0x277CBEB98];
    v113 = [*removeSvcTransactions na_map:&__block_literal_global_1811];
    services2 = [v112 setWithArray:v113];

    [(HMDHome *)self filterServiceTransactions:*transactions removedServiceUUIDs:services2];
    [(HMDHome *)self filterServiceTransactions:*svcTransactions removedServiceUUIDs:services2];
    v111 = 1;
LABEL_82:
  }

  else
  {
    v111 = 1;
  }

  v114 = *MEMORY[0x277D85DE8];
  return v111;
}

- (void)__updateServiceTransaction:(id)transaction accessoryTransaction:(id)accessoryTransaction service:(id)service accessory:(id)accessory hapService:(id)hapService
{
  v102 = *MEMORY[0x277D85DE8];
  transactionCopy = transaction;
  accessoryTransactionCopy = accessoryTransaction;
  serviceCopy = service;
  accessoryCopy = accessory;
  hapServiceCopy = hapService;
  v14 = MEMORY[0x277CBEB18];
  v72 = hapServiceCopy;
  characteristics = [hapServiceCopy characteristics];
  v16 = [v14 arrayWithArray:characteristics];

  if ([v16 count])
  {
    v17 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v16, "count")}];
    v94 = 0u;
    v95 = 0u;
    v96 = 0u;
    v97 = 0u;
    v69 = v16;
    obj = v16;
    v18 = [obj countByEnumeratingWithState:&v94 objects:v101 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = 0x277CBE000uLL;
      v80 = *MEMORY[0x277CD2138];
      v79 = *MEMORY[0x277CD21A8];
      v85 = *MEMORY[0x277CD2190];
      v86 = *v95;
      v78 = *MEMORY[0x277CD2148];
      v70 = *MEMORY[0x277CD2100];
      v71 = serviceCopy;
      v81 = v17;
      selfCopy = self;
      do
      {
        v21 = 0;
        v83 = v19;
        do
        {
          if (*v95 != v86)
          {
            objc_enumerationMutation(obj);
          }

          v87 = v21;
          v22 = *(*(&v94 + 1) + 8 * v21);
          dataSource = [(HMDHome *)self dataSource];
          hapMetadata = [dataSource hapMetadata];
          type = [v22 type];
          v26 = [hapMetadata shouldFilterCharacteristicOfType:type];

          if ((v26 & 1) == 0)
          {
            metadata = [v22 metadata];
            v28 = [*(v20 + 2872) dictionaryWithCapacity:8];
            format = [metadata format];
            [v28 setObject:format forKeyedSubscript:@"metadataFormat"];

            units = [metadata units];
            [v28 setObject:units forKeyedSubscript:@"metadataUnits"];

            manufacturerDescription = [metadata manufacturerDescription];
            [v28 setObject:manufacturerDescription forKeyedSubscript:@"metadataUserDescription"];

            constraints = [metadata constraints];

            if (constraints)
            {
              constraints2 = [metadata constraints];
              minimumValue = [constraints2 minimumValue];
              [v28 setObject:minimumValue forKeyedSubscript:@"metadataMinimumValue"];

              constraints3 = [metadata constraints];
              maximumValue = [constraints3 maximumValue];
              [v28 setObject:maximumValue forKeyedSubscript:@"metadataMaximumValue"];

              constraints4 = [metadata constraints];
              stepValue = [constraints4 stepValue];
              [v28 setObject:stepValue forKeyedSubscript:@"metadataStepValue"];

              constraints5 = [metadata constraints];
              maxLength = [constraints5 maxLength];
              [v28 setObject:maxLength forKeyedSubscript:@"metadataMaxLength"];

              constraints6 = [metadata constraints];
              validValues = [constraints6 validValues];
              [v28 setObject:validValues forKeyedSubscript:@"metadataValidValues"];
            }

            v43 = *(v20 + 2872);
            v99[0] = v80;
            instanceID = [v22 instanceID];
            v100[0] = instanceID;
            v99[1] = v79;
            type2 = [v22 type];
            v100[1] = type2;
            v99[2] = v85;
            v46 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:{objc_msgSend(v22, "properties")}];
            v99[3] = v78;
            v100[2] = v46;
            v100[3] = v28;
            v47 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v100 forKeys:v99 count:4];
            v48 = [v43 dictionaryWithDictionary:v47];

            if (serviceCopy)
            {
              v92 = 0u;
              v93 = 0u;
              v90 = 0u;
              v91 = 0u;
              characteristics2 = [serviceCopy characteristics];
              v50 = [characteristics2 countByEnumeratingWithState:&v90 objects:v98 count:16];
              if (v50)
              {
                v75 = v48;
                v76 = metadata;
                v51 = *v91;
LABEL_13:
                v52 = 0;
                while (1)
                {
                  if (*v91 != v51)
                  {
                    objc_enumerationMutation(characteristics2);
                  }

                  v53 = *(*(&v90 + 1) + 8 * v52);
                  instanceID2 = [v53 instanceID];
                  instanceID3 = [v22 instanceID];
                  v56 = [instanceID2 isEqual:instanceID3];

                  if (v56)
                  {
                    break;
                  }

                  if (v50 == ++v52)
                  {
                    v50 = [characteristics2 countByEnumeratingWithState:&v90 objects:v98 count:16];
                    if (v50)
                    {
                      goto LABEL_13;
                    }

                    serviceCopy = v71;
                    v48 = v75;
                    metadata = v76;
                    goto LABEL_25;
                  }
                }

                v50 = v53;

                if (v50)
                {
                  authorizationData = [v50 authorizationData];

                  serviceCopy = v71;
                  v48 = v75;
                  metadata = v76;
                  if (authorizationData)
                  {
                    authorizationData2 = [v50 authorizationData];
                    [v75 setObject:authorizationData2 forKeyedSubscript:v70];
                  }

                  v59 = [accessoryCopy findServiceWithServiceType:@"00000701-0000-1000-8000-0026BB765291"];

                  if (v59)
                  {
                    properties = [v22 properties];
                    properties2 = [v50 properties];
                    characteristics2 = [MEMORY[0x277CCABB0] numberWithUnsignedShort:properties2 & 0x80 | properties];
                    [v75 setObject:characteristics2 forKeyedSubscript:v85];
                    goto LABEL_25;
                  }
                }

                else
                {
                  serviceCopy = v71;
                  v48 = v75;
                  metadata = v76;
                }
              }

              else
              {
LABEL_25:
              }
            }

            v17 = v81;
            [v81 addObject:v48];
            value = [v22 value];

            if (value)
            {
              aBlock[0] = MEMORY[0x277D85DD0];
              aBlock[1] = 3221225472;
              aBlock[2] = __88__HMDHome___updateServiceTransaction_accessoryTransaction_service_accessory_hapService___block_invoke;
              aBlock[3] = &unk_2797288A8;
              v89 = transactionCopy;
              v63 = _Block_copy(aBlock);
              type3 = [v22 type];
              value2 = [v22 value];
              type4 = [v72 type];
              [HMDService processUpdateForCharacteristicType:type3 value:value2 serviceType:type4 service:serviceCopy serviceTransactionGetter:v63 accessory:accessoryCopy accessoryTransaction:accessoryTransactionCopy accessoryTransactionChanged:0];
            }

            self = selfCopy;
            v19 = v83;
            v20 = 0x277CBE000;
          }

          v21 = v87 + 1;
        }

        while (v87 + 1 != v19);
        v19 = [obj countByEnumeratingWithState:&v94 objects:v101 count:16];
      }

      while (v19);
    }

    v16 = v69;
  }

  else
  {
    v17 = 0;
  }

  v67 = +[HMDCharacteristic sortComparatorForCharacteristicDictionary];
  [v17 sortUsingComparator:v67];

  [transactionCopy setCharacteristics:v17];
  v68 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didFinishPairingForAccessoryServer:(id)server
{
  v53 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  primaryResident = [(HMDHome *)self primaryResident];
  v8 = primaryResident;
  if (primaryResident && ([primaryResident device], v9 = objc_claimAutoreleasedReturnValue(), v9, v9))
  {
    v10 = objc_alloc(MEMORY[0x277D0F820]);
    uuid = [(HMDHome *)self uuid];
    v42 = [v10 initWithTarget:uuid];

    v12 = serverCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v13 = v12;
    }

    else
    {
      v13 = 0;
    }

    v14 = v13;

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    nodeID = [v14 nodeID];
    [dictionary setObject:nodeID forKeyedSubscript:@"HMDHomePairingCompletionNodeIDMessageKey"];

    fabricID = [v14 fabricID];
    [dictionary setObject:fabricID forKeyedSubscript:@"HMDHomePairingCompletionFabricIDMessageKey"];

    fabricID2 = [v14 fabricID];
    [dictionary setObject:fabricID2 forKeyedSubscript:@"HMDHomePairingCompletionFabricIndexMessageKey"];

    vendorID = [v14 vendorID];
    [dictionary setObject:vendorID forKeyedSubscript:@"HMDHomePairingCompletionVendorIDMessageKey"];

    productID = [v14 productID];
    [dictionary setObject:productID forKeyedSubscript:@"HMDHomePairingCompletionProductIDMessageKey"];

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v14, "configNumber")}];
    [dictionary setObject:v21 forKeyedSubscript:@"HMDHomePairingCompletionConfigNumberMessageKey"];

    category = [v14 category];
    [dictionary setObject:category forKeyedSubscript:@"HMDHomePairingCompletionCategoryMessageKey"];

    topology = [v14 topology];
    [dictionary setObject:topology forKeyedSubscript:@"HMDHomePairingCompletionTopologyMessageKey"];

    v24 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeNotificationPairingCompletionMessage" destination:v42 payload:dictionary];
    objc_initWeak(&location, self);
    v45[0] = MEMORY[0x277D85DD0];
    v45[1] = 3221225472;
    v45[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke;
    v45[3] = &unk_279733AE8;
    objc_copyWeak(&v47, &location);
    v46 = v12;
    [v24 setResponseHandler:v45];
    v25 = objc_autoreleasePoolPush();
    selfCopy = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      shortDescription = [v24 shortDescription];
      *buf = 138543618;
      v50 = v28;
      v51 = 2112;
      v52 = shortDescription;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Sending message %@ to notify pairing completion", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    primaryResidentMessageRouter = [(HMDHome *)selfCopy primaryResidentMessageRouter];
    v31 = primaryResidentMessageRouter;
    if (primaryResidentMessageRouter)
    {
      v44[0] = MEMORY[0x277D85DD0];
      v44[1] = 3221225472;
      v44[2] = __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke_1806;
      v44[3] = &unk_279733FD8;
      v44[4] = selfCopy;
      [primaryResidentMessageRouter routeMessage:v24 localHandler:v44];
    }

    else
    {
      v36 = objc_autoreleasePoolPush();
      v37 = selfCopy;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v39;
        _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_ERROR, "%{public}@Could not find primary resident message router to send HMDHomeNotificationPairingCompletionMessage", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v36);
      v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [v24 respondWithError:v40];
    }

    objc_destroyWeak(&v47);
    objc_destroyWeak(&location);
  }

  else
  {
    v32 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543362;
      v50 = v35;
      _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not available", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v32);
  }

  v41 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome_accessoryBrowser_didFinishPairingForAccessoryServer___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Failed to notify pairing completion for accessory server %@ to the primary resident with error %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_2531F8000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Successfully notified the primary resident of pairing completion for accessory server %@";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 isEqualToString:*(a1 + 32)];

  return v4;
}

id __89__HMDHome_accessoryBrowser_didUpdateReachability_forBTLEAccessoriesWithServerIdentifier___block_invoke_1801(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = [v2 identifier];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateCategory:(id)category
{
  v25 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  categoryCopy = category;
  identifier = [serverCopy identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      shortDescription = [v12 shortDescription];
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = shortDescription;
      v23 = 2112;
      v24 = categoryCopy;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Paired Accessory: %@, Updated Category to %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    [v12 updateCategory:categoryCopy];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateHasPairings:(BOOL)pairings
{
  pairingsCopy = pairings;
  v25 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  identifier = [serverCopy identifier];
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      identifier2 = [serverCopy identifier];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = identifier2;
      v23 = 1024;
      v24 = pairingsCopy;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating accessory server %@ with new value of hasPairings: %d", &v19, 0x1Cu);
    }

    objc_autoreleasePoolPop(v12);
    if ([serverCopy isPaired] == pairingsCopy)
    {
      accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
      [accessoryBrowser resurrectAccessoryServer:serverCopy];
    }

    else
    {
      [(HMDHome *)selfCopy _unconfigurePairedAccessoriesForServer:serverCopy updateReachability:1];
      accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
      [accessoryBrowser tombstoneAccessoryServer:serverCopy];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSecureClassTriggeredByCharacteristics:(id)characteristics
{
  v70 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  v5 = MEMORY[0x277CBEB18];
  triggers = [(HMDHome *)self triggers];
  v7 = [v5 arrayWithCapacity:{objc_msgSend(triggers, "count")}];

  v58 = 0u;
  v59 = 0u;
  v56 = 0u;
  v57 = 0u;
  selfCopy = self;
  obj = [(HMDHome *)self triggers];
  v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
  if (v41)
  {
    v40 = *v57;
    do
    {
      for (i = 0; i != v41; ++i)
      {
        if (*v57 != v40)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v56 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v54 = 0u;
        v55 = 0u;
        v52 = 0u;
        v53 = 0u;
        v42 = v11;
        characteristicBaseEvents = [v11 characteristicBaseEvents];
        v13 = [characteristicBaseEvents countByEnumeratingWithState:&v52 objects:v68 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v53;
          do
          {
            for (j = 0; j != v14; ++j)
            {
              if (*v53 != v15)
              {
                objc_enumerationMutation(characteristicBaseEvents);
              }

              characteristic = [*(*(&v52 + 1) + 8 * j) characteristic];
              v18 = [characteristicsCopy containsObject:characteristic];

              if (v18)
              {
                [v7 addObject:v9];
              }
            }

            v14 = [characteristicBaseEvents countByEnumeratingWithState:&v52 objects:v68 count:16];
          }

          while (v14);
        }
      }

      v41 = [obj countByEnumeratingWithState:&v56 objects:v69 count:16];
    }

    while (v41);
  }

  v50 = 0u;
  v51 = 0u;
  v48 = 0u;
  v49 = 0u;
  v19 = v7;
  v20 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v49;
    v43 = *v49;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v49 != v22)
        {
          objc_enumerationMutation(v19);
        }

        v24 = *(*(&v48 + 1) + 8 * k);
        v44 = 0u;
        v45 = 0u;
        v46 = 0u;
        v47 = 0u;
        actionSets = [v24 actionSets];
        v26 = [actionSets countByEnumeratingWithState:&v44 objects:v66 count:16];
        if (v26)
        {
          v27 = v26;
          v28 = *v45;
          while (2)
          {
            for (m = 0; m != v27; ++m)
            {
              if (*v45 != v28)
              {
                objc_enumerationMutation(actionSets);
              }

              v30 = *(*(&v44 + 1) + 8 * m);
              if ([v30 containsSecureCharacteristic])
              {
                v32 = objc_autoreleasePoolPush();
                v33 = selfCopy;
                v34 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
                {
                  v35 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v61 = v35;
                  v62 = 2112;
                  v63 = v24;
                  v64 = 2112;
                  v65 = v30;
                  _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_DEBUG, "%{public}@Trigger %@ has action set %@ with security class", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v32);
                v31 = 1;
                goto LABEL_40;
              }
            }

            v27 = [actionSets countByEnumeratingWithState:&v44 objects:v66 count:16];
            if (v27)
            {
              continue;
            }

            break;
          }
        }

        v22 = v43;
      }

      v21 = [v19 countByEnumeratingWithState:&v48 objects:v67 count:16];
      v31 = 0;
    }

    while (v21);
  }

  else
  {
    v31 = 0;
  }

LABEL_40:

  v36 = *MEMORY[0x277D85DE8];
  return v31;
}

- (void)handleUpdatedCharacteristics:(id)characteristics accessoryServer:(id)server
{
  characteristicsCopy = characteristics;
  serverCopy = server;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_handleUpdatedCharacteristics_accessoryServer___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v12 = characteristicsCopy;
  v13 = serverCopy;
  v9 = serverCopy;
  v10 = characteristicsCopy;
  dispatch_async(workQueue, block);
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didUpdateValuesForCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast
{
  serverCopy = server;
  characteristicsCopy = characteristics;
  numberCopy = number;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome_accessoryBrowser_accessoryServer_didUpdateValuesForCharacteristics_stateNumber_broadcast___block_invoke;
  block[3] = &unk_279731590;
  block[4] = self;
  v19 = characteristicsCopy;
  v20 = serverCopy;
  v21 = numberCopy;
  broadcastCopy = broadcast;
  v15 = numberCopy;
  v16 = serverCopy;
  v17 = characteristicsCopy;
  dispatch_async(workQueue, block);
}

- (id)_changedHMDCharacteristicsForHAPCharacteristics:(id)characteristics stateNumber:(id)number broadcast:(BOOL)broadcast accessoryServer:(id)server
{
  broadcastCopy = broadcast;
  v182 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  numberCopy = number;
  serverCopy = server;
  strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v159 = 0u;
  v160 = 0u;
  v161 = 0u;
  v162 = 0u;
  obj = characteristicsCopy;
  selfCopy = self;
  v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
  if (v149)
  {
    context = *v160;
    v141 = broadcastCopy;
    do
    {
      for (i = 0; i != v149; ++i)
      {
        if (*v160 != context)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v159 + 1) + 8 * i);
        service = [v12 service];
        accessory = [service accessory];
        dataSource = [(HMDHome *)self dataSource];
        hapMetadata = [dataSource hapMetadata];
        if (broadcastCopy)
        {
          type = [v12 type];
          v18 = [hapMetadata shouldFilterCharacteristicOfType:type];

          if (v18)
          {
            goto LABEL_16;
          }

          primaryAccessory = [serverCopy primaryAccessory];

          accessory = primaryAccessory;
        }

        else
        {
          type2 = [service type];
          v21 = [hapMetadata shouldFilterServiceOfType:type2];

          if (v21)
          {
            goto LABEL_16;
          }
        }

        v22 = [(HMDHome *)self hmdHAPAccessoryWithHAPAccessory:accessory];
        instanceID = [v12 instanceID];
        v24 = [v22 hmdCharacteristicForInstanceId:instanceID];

        if (v24)
        {
          [strongToStrongObjectsMapTable setObject:v24 forKey:v12];
        }

        else
        {
          v25 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v27 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
          {
            HMFGetLogIdentifier();
            v28 = v132 = selfCopy2;
            [serverCopy identifier];
            v29 = loga = v27;
            instanceID2 = [service instanceID];
            [v12 instanceID];
            v31 = v135 = v25;
            type3 = [v12 type];
            *buf = 138544386;
            v165 = v28;
            v166 = 2112;
            v167 = v29;
            v168 = 2112;
            v169 = instanceID2;
            v170 = 2112;
            v171 = v31;
            v172 = 2112;
            v173 = type3;
            _os_log_impl(&dword_2531F8000, loga, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot map HAPCharacteristic %@/%@/%@/%@ to a HMDCharacteristic", buf, 0x34u);

            v25 = v135;
            v27 = loga;

            selfCopy2 = v132;
          }

          objc_autoreleasePoolPop(v25);
          self = selfCopy;
        }

        broadcastCopy = v141;
LABEL_16:
      }

      v149 = [obj countByEnumeratingWithState:&v159 objects:v181 count:16];
    }

    while (v149);
  }

  v136 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(obj, "count")}];
  v127 = [MEMORY[0x277CBEB58] set];
  v155 = 0u;
  v156 = 0u;
  v157 = 0u;
  v158 = 0u;
  keyEnumerator = [strongToStrongObjectsMapTable keyEnumerator];
  allObjects = [keyEnumerator allObjects];

  v133 = allObjects;
  v142 = [allObjects countByEnumeratingWithState:&v155 objects:v180 count:16];
  v36 = 0;
  if (!v142)
  {
    v37 = numberCopy;
    goto LABEL_71;
  }

  log = *v156;
  *&v35 = 138543618;
  v126 = v35;
  v37 = numberCopy;
  do
  {
    v38 = 0;
    do
    {
      if (*v156 != log)
      {
        objc_enumerationMutation(v133);
      }

      v39 = *(*(&v155 + 1) + 8 * v38);
      v40 = [strongToStrongObjectsMapTable objectForKey:{v39, v126}];
      stateNumber = [v40 stateNumber];
      v42 = HMFEqualObjects();

      if (v42)
      {
        v150 = v38;
        value = [v39 value];
        lastKnownValue = [v40 lastKnownValue];
        v45 = [HMDCharacteristic value:value differentThan:lastKnownValue];

        if (v37 && v45)
        {
          contexta = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v47 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
          {
            v129 = HMFGetLogIdentifier();
            type4 = [v40 type];
            instanceID3 = [v40 instanceID];
            lastKnownValue2 = [v40 lastKnownValue];
            stateNumber2 = [v40 stateNumber];
            value2 = [v39 value];
            identifier = [serverCopy identifier];
            *buf = 138545154;
            v165 = v129;
            v166 = 2112;
            v167 = type4;
            v168 = 2112;
            v169 = instanceID3;
            v54 = instanceID3;
            v170 = 2112;
            v171 = lastKnownValue2;
            v172 = 2112;
            v173 = stateNumber2;
            v174 = 2112;
            v175 = value2;
            v176 = 2112;
            v177 = numberCopy;
            v178 = 2112;
            v179 = identifier;
            _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value at same state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

            self = selfCopy;
          }

          goto LABEL_32;
        }

        if ([v40 shouldUpdateValueFromHAPCharacteristic:v39] && (objc_msgSend(v39, "value"), v76 = objc_claimAutoreleasedReturnValue(), v76, v76))
        {
          v77 = objc_autoreleasePoolPush();
          selfCopy4 = self;
          v79 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v79, OS_LOG_TYPE_DEFAULT))
          {
            v80 = HMFGetLogIdentifier();
            type5 = [v40 type];
            [v40 instanceID];
            v82 = v130 = selfCopy4;
            [v40 lastKnownValue];
            v83 = contextb = v77;
            value3 = [v39 value];
            identifier2 = [serverCopy identifier];
            *buf = 138544898;
            v165 = v80;
            v166 = 2112;
            v167 = type5;
            v168 = 2112;
            v169 = v82;
            v170 = 2112;
            v171 = v83;
            v172 = 2112;
            v173 = value3;
            v174 = 2112;
            v175 = numberCopy;
            v176 = 2112;
            v177 = identifier2;
            _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value from %@ to %@ at same state number %@ for accessory: %@", buf, 0x48u);

            v77 = contextb;
            selfCopy4 = v130;
          }

          objc_autoreleasePoolPop(v77);
          [v136 addObject:v40];
          accessory2 = [v40 accessory];
          if (([accessory2 supportsWoL] & 1) == 0 && !objc_msgSend(accessory2, "custom1WoBLE"))
          {
            goto LABEL_48;
          }

          v87 = objc_autoreleasePoolPush();
          v88 = selfCopy4;
          v89 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v89, OS_LOG_TYPE_INFO))
          {
            v90 = HMFGetLogIdentifier();
            identifier3 = [serverCopy identifier];
            *buf = 138544130;
            v165 = v90;
            v166 = 2112;
            v167 = v39;
            v168 = 2112;
            v169 = v40;
            v170 = 2112;
            v171 = identifier3;
            _os_log_impl(&dword_2531F8000, v89, OS_LOG_TYPE_INFO, "%{public}@Checking if we should update value hapCharacteristic %@ to hmdCharacteristic %@ for accessory: %@", buf, 0x2Au);
          }

          objc_autoreleasePoolPop(v87);
          if (v45 || ([v40 lastKnownValueUpdateTime], v92 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v39, "valueUpdatedTime"), v93 = objc_claimAutoreleasedReturnValue(), v94 = objc_msgSend(v92, "compare:", v93), v93, v92, v94))
          {
LABEL_48:

            self = selfCopy;
            goto LABEL_33;
          }

          v113 = objc_autoreleasePoolPush();
          v114 = v88;
          v115 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v115, OS_LOG_TYPE_INFO))
          {
            v116 = HMFGetLogIdentifier();
            identifier4 = [serverCopy identifier];
            *buf = v126;
            v165 = v116;
            v166 = 2112;
            v167 = identifier4;
            _os_log_impl(&dword_2531F8000, v115, OS_LOG_TYPE_INFO, "%{public}@Not updating value because update times and values are the same for accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v113);
          v37 = numberCopy;
          [v40 setStateNumber:numberCopy];
          v36 = 1;
        }

        else
        {
          v95 = objc_autoreleasePoolPush();
          selfCopy5 = self;
          v97 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v97, OS_LOG_TYPE_DEBUG))
          {
            v128 = HMFGetLogIdentifier();
            type6 = [v40 type];
            instanceID4 = [v40 instanceID];
            [v40 stateNumber];
            v100 = v131 = v36;
            [v40 lastKnownValue];
            v101 = contextc = v95;
            value4 = [v39 value];
            identifier5 = [serverCopy identifier];
            *buf = 138544898;
            v165 = v128;
            v166 = 2112;
            v167 = type6;
            v104 = type6;
            v168 = 2112;
            v169 = instanceID4;
            v170 = 2112;
            v171 = v100;
            v172 = 2112;
            v173 = v101;
            v174 = 2112;
            v175 = value4;
            v176 = 2112;
            v177 = identifier5;
            _os_log_impl(&dword_2531F8000, v97, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring the update for characteristic: '%@'/%@/%@ from %@ to %@ for accessory: %@", buf, 0x48u);

            v95 = contextc;
            v36 = v131;

            v37 = numberCopy;
          }

          objc_autoreleasePoolPop(v95);
        }

        self = selfCopy;
LABEL_53:
        v38 = v150;
        if (!v37)
        {
          goto LABEL_59;
        }

LABEL_54:
        if ((v36 & 1) != 0 && ([v40 shouldIgnoreCacheValueForRead] & 1) == 0)
        {
          accessory3 = [v40 accessory];
          if (accessory3)
          {
            [v127 addObject:accessory3];
          }
        }

        goto LABEL_59;
      }

      value5 = [v39 value];
      if (!value5 || (v56 = value5, v57 = [v40 shouldUpdateValueFromHAPCharacteristic:v39], v56, (v57 & 1) != 0))
      {
        contexta = objc_autoreleasePoolPush();
        selfCopy6 = self;
        v47 = HMFGetOSLogHandle();
        v150 = v38;
        if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
        {
          v59 = HMFGetLogIdentifier();
          type7 = [v40 type];
          instanceID5 = [v40 instanceID];
          lastKnownValue3 = [v40 lastKnownValue];
          stateNumber3 = [v40 stateNumber];
          value6 = [v39 value];
          identifier6 = [serverCopy identifier];
          *buf = 138545154;
          v165 = v59;
          v166 = 2112;
          v167 = type7;
          v168 = 2112;
          v169 = instanceID5;
          v170 = 2112;
          v171 = lastKnownValue3;
          v172 = 2112;
          v173 = stateNumber3;
          v174 = 2112;
          v175 = value6;
          v176 = 2112;
          v177 = numberCopy;
          v178 = 2112;
          v179 = identifier6;
          _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_DEFAULT, "%{public}@Characteristic: '%@'/%@ updated value / state number from %@/%@ to %@/%@ for accessory: %@", buf, 0x52u);

          self = selfCopy;
        }

LABEL_32:

        objc_autoreleasePoolPop(contexta);
        [v136 addObject:v40];
LABEL_33:
        v37 = numberCopy;
        [v40 setStateNumber:numberCopy];
        notificationContext = [v39 notificationContext];

        if (notificationContext)
        {
          v67 = objc_autoreleasePoolPush();
          selfCopy7 = self;
          v69 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
          {
            v70 = HMFGetLogIdentifier();
            value7 = [v39 value];
            notificationContext2 = [v39 notificationContext];
            *buf = 138543874;
            v165 = v70;
            v166 = 2112;
            v167 = value7;
            v168 = 2112;
            v169 = notificationContext2;
            _os_log_impl(&dword_2531F8000, v69, OS_LOG_TYPE_INFO, "%{public}@Updating HMD characteristic with value: %@ and notification context: %@", buf, 0x20u);

            self = selfCopy;
          }

          objc_autoreleasePoolPop(v67);
        }

        value8 = [v39 value];
        valueUpdatedTime = [v39 valueUpdatedTime];
        notificationContext3 = [v39 notificationContext];
        [v40 updateValue:value8 updatedTime:valueUpdatedTime stateNumber:numberCopy notificationContext:notificationContext3];

        v36 = 1;
        goto LABEL_53;
      }

      v106 = objc_autoreleasePoolPush();
      selfCopy8 = self;
      v108 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v108, OS_LOG_TYPE_INFO))
      {
        v109 = HMFGetLogIdentifier();
        value9 = [v39 value];
        shortDescription = [v40 shortDescription];
        identifier7 = [serverCopy identifier];
        *buf = 138544130;
        v165 = v109;
        v166 = 2112;
        v167 = value9;
        v168 = 2112;
        v169 = shortDescription;
        v170 = 2112;
        v171 = identifier7;
        _os_log_impl(&dword_2531F8000, v108, OS_LOG_TYPE_INFO, "%{public}@Ignoring same value %@ updates from local for characteristic: '%@' for accessory: %@", buf, 0x2Au);

        v37 = numberCopy;
        self = selfCopy;
      }

      objc_autoreleasePoolPop(v106);
      [v40 setStateNumber:v37];
      v36 = 1;
      if (v37)
      {
        goto LABEL_54;
      }

LABEL_59:

      ++v38;
    }

    while (v142 != v38);
    v118 = [v133 countByEnumeratingWithState:&v155 objects:v180 count:16];
    v142 = v118;
  }

  while (v118);
LABEL_71:

  v153 = 0u;
  v154 = 0u;
  v151 = 0u;
  v152 = 0u;
  v119 = v127;
  v120 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
  if (v120)
  {
    v121 = v120;
    v122 = *v152;
    do
    {
      for (j = 0; j != v121; ++j)
      {
        if (*v152 != v122)
        {
          objc_enumerationMutation(v119);
        }

        [*(*(&v151 + 1) + 8 * j) notifyingCharacteristicStateNumberUpdated:v37];
      }

      v121 = [v119 countByEnumeratingWithState:&v151 objects:v163 count:16];
    }

    while (v121);
  }

  if (v37 != 0 && (v36 & 1) != 0)
  {
    [(HMDHome *)self saveToCurrentAccountWithReason:*MEMORY[0x277CD21D0]];
  }

  v124 = *MEMORY[0x277D85DE8];

  return v136;
}

- (id)_hmdCharacteristicsForUpdatedHAPCharacteristics:(id)characteristics accessoryServer:(id)server
{
  v39 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  serverCopy = server;
  v28 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
  accessories = [(HMDHome *)self accessories];
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = characteristicsCopy;
  v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v23 = *v34;
    do
    {
      v7 = 0;
      do
      {
        if (*v34 != v23)
        {
          objc_enumerationMutation(obj);
        }

        v27 = v7;
        v8 = *(*(&v33 + 1) + 8 * v7);
        primaryAccessory = [serverCopy primaryAccessory];
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v10 = accessories;
        v11 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v30;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v30 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v16 = v15;
              }

              else
              {
                v16 = 0;
              }

              v17 = v16;

              if ([v17 matchesHAPAccessory:primaryAccessory])
              {
                instanceID = [v8 instanceID];
                v19 = [v17 hmdCharacteristicForInstanceId:instanceID];

                if ([v19 shouldUpdateValueFromHAPCharacteristic:v8])
                {
                  [v28 addObject:v19];
                }
              }
            }

            v12 = [v10 countByEnumeratingWithState:&v29 objects:v37 count:16];
          }

          while (v12);
        }

        v7 = v27 + 1;
      }

      while (v27 + 1 != v26);
      v26 = [obj countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  v20 = *MEMORY[0x277D85DE8];

  return v28;
}

- (void)accessoryBrowser:(id)browser didUpdateEndpoint:(id)endpoint
{
  v87 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  endpointCopy = endpoint;
  v7 = MEMORY[0x277CBEB18];
  selfCopy = self;
  accessories = [(HMDHome *)self accessories];
  v9 = [v7 arrayWithCapacity:{objc_msgSend(accessories, "count")}];

  v55 = endpointCopy;
  [endpointCopy advertisements];
  v70 = 0u;
  v71 = 0u;
  v72 = 0u;
  obj = v73 = 0u;
  v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
  if (v59)
  {
    v57 = *v71;
    do
    {
      v10 = 0;
      do
      {
        if (*v71 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v60 = v10;
        identifier = [*(*(&v70 + 1) + 8 * v10) identifier];
        v66 = 0u;
        v67 = 0u;
        v68 = 0u;
        v69 = 0u;
        accessories2 = [(HMDHome *)selfCopy accessories];
        v13 = [accessories2 countByEnumeratingWithState:&v66 objects:v85 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v67;
          do
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v67 != v15)
              {
                objc_enumerationMutation(accessories2);
              }

              v17 = *(*(&v66 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              identifier2 = [v19 identifier];
              v21 = [identifier2 isEqual:identifier];

              if (v21)
              {
                [v9 addObject:v19];
              }
            }

            v14 = [accessories2 countByEnumeratingWithState:&v66 objects:v85 count:16];
          }

          while (v14);
        }

        v10 = v60 + 1;
      }

      while (v60 + 1 != v59);
      v59 = [obj countByEnumeratingWithState:&v70 objects:v86 count:16];
    }

    while (v59);
  }

  v22 = objc_autoreleasePoolPush();
  v23 = selfCopy;
  v24 = HMFGetOSLogHandle();
  v25 = v55;
  if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
  {
    v26 = HMFGetLogIdentifier();
    sessionIdentifier = [v55 sessionIdentifier];
    *buf = 138544130;
    v76 = v26;
    v77 = 2112;
    v78 = sessionIdentifier;
    v79 = 2112;
    v80 = obj;
    v81 = 2112;
    v82 = v9;
    _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Endpoint %@ with advertisements %@ matches accessories %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v22);
  if ([v9 count])
  {
    sessionIdentifier2 = [v55 sessionIdentifier];
    if (!sessionIdentifier2)
    {
      v39 = objc_autoreleasePoolPush();
      v40 = v23;
      v41 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
      {
        v42 = HMFGetLogIdentifier();
        *buf = 138543618;
        v76 = v42;
        v77 = 2112;
        v78 = 0;
        _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Nil session identifier - dropping update for endpoint %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v39);
      goto LABEL_46;
    }

    v29 = [(HMDHome *)v23 mediaSessionWithIdentifier:sessionIdentifier2];
    v61 = sessionIdentifier2;
    if (v29)
    {
      v30 = v29;
      v31 = objc_autoreleasePoolPush();
      v32 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        uuid = [v30 uuid];
        uUIDString = [uuid UUIDString];
        v37 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = uUIDString;
        v79 = 2112;
        v80 = sessionIdentifier2;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v37;
        v38 = "%{public}@Updated the endpoint for mediaSession %@ with sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
LABEL_32:
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, v38, buf, 0x34u);
      }
    }

    else
    {
      v30 = [(HMDHome *)v23 _createMediaSessionWithEndpoint:v55];
      v31 = objc_autoreleasePoolPush();
      v43 = v23;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        uuid = [v30 uuid];
        uUIDString = [uuid UUIDString];
        v44 = [v9 count];
        *buf = 138544386;
        v76 = v34;
        v77 = 2112;
        v78 = uUIDString;
        v79 = 2112;
        v80 = sessionIdentifier2;
        v81 = 2112;
        v82 = obj;
        v83 = 2048;
        v84 = v44;
        v38 = "%{public}@Creating mediaSession %@ for sessionIdentifier %@ (%@ advertisements for %tu accessories) ";
        goto LABEL_32;
      }
    }

    objc_autoreleasePoolPop(v31);
    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v45 = v9;
    v46 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
    if (v46)
    {
      v47 = v46;
      v48 = *v63;
      do
      {
        for (j = 0; j != v47; ++j)
        {
          if (*v63 != v48)
          {
            objc_enumerationMutation(v45);
          }

          v50 = *(*(&v62 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v51 = v50;
          }

          else
          {
            v51 = 0;
          }

          v52 = v51;

          if (!v52)
          {
            [v50 setReachable:1];
          }

          [v50 updateMediaSession:v30];
        }

        v47 = [v45 countByEnumeratingWithState:&v62 objects:v74 count:16];
      }

      while (v47);
    }

    v25 = v55;
    sessionIdentifier2 = v61;
LABEL_46:
  }

  v53 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didDiscoverAccessories:(id)accessories transaction:(id)transaction error:(id)error
{
  v43 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  accessoriesCopy = accessories;
  transactionCopy = transaction;
  errorCopy = error;
  identifier = [serverCopy identifier];
  v18 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v18)
  {
    v19 = objc_autoreleasePoolPush();
    selfCopy = self;
    v21 = HMFGetOSLogHandle();
    v22 = v21;
    if (errorCopy)
    {
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543874;
        v38 = v23;
        v39 = 2112;
        v40 = serverCopy;
        v41 = 2114;
        v42 = errorCopy;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Failed HAP service discovery on accessory server %@ with error: %{public}@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v19);
      identifier2 = [serverCopy identifier];
      linkType = [serverCopy linkType];
      v33[0] = MEMORY[0x277D85DD0];
      v33[1] = 3221225472;
      v33[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke;
      v33[3] = &unk_279722B18;
      v26 = identifier2;
      v35 = selfCopy;
      v36 = linkType;
      v34 = v26;
      [(HMDHome *)selfCopy _notifyRetrievalError:errorCopy accessoryServer:v26 linkType:linkType accessoryOperationBlock:v33];
      domain = [errorCopy domain];
      if ([domain isEqualToString:*MEMORY[0x277CCFD28]])
      {
        code = [errorCopy code];

        if (code == 66)
        {
          [v18 didEncounterError:errorCopy];
LABEL_15:

          goto LABEL_16;
        }
      }

      else
      {
      }

      v30 = serverCopy;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      if (v30 && (isKindOfClass & 1) != 0)
      {
        [v18 _forceEnableReachabilityPingForPrimaryResident:v30];
      }

      goto LABEL_15;
    }

    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543618;
      v38 = v29;
      v39 = 2112;
      v40 = serverCopy;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Completed HAP service discovery on accessory server %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    [v18 setLastPairingFailureTime:0.0];
    [v18 setConsecutivePairingFailures:0];
    -[HMDHome _configurePairedAccessoriesForServer:reAddServices:](selfCopy, "_configurePairedAccessoriesForServer:reAddServices:", serverCopy, [accessoriesCopy count] == 0);
  }

LABEL_16:

  v32 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke(uint64_t a1, void *a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v3 = a2;
  [v3 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 48)];
  if ([v3 hasBTLELink] && *(a1 + 48) == 2)
  {
    v4 = [*(a1 + 40) accessoryBrowser];
    v9[0] = *(a1 + 32);
    v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v9 count:1];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __85__HMDHome_accessoryBrowser_accessoryServer_didDiscoverAccessories_transaction_error___block_invoke_2;
    v7[3] = &unk_279722AF0;
    v8 = v3;
    [v4 probeReachabilityForBTLEAccessoryServersWithIdentifiers:v5 forceScan:1 withCompletion:v7];
  }

  v6 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser accessoryServer:(id)server didStopPairingWithError:(id)error
{
  v44 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  errorCopy = error;
  identifier = [serverCopy identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v12)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      shortDescription = [serverCopy shortDescription];
      *buf = 138543874;
      v39 = v16;
      v40 = 2112;
      v41 = shortDescription;
      v42 = 2112;
      v43 = errorCopy;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ stopped pairing with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = objc_autoreleasePoolPush();
    v19 = selfCopy;
    v20 = HMFGetOSLogHandle();
    v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
    if (errorCopy)
    {
      if (v21)
      {
        v22 = HMFGetLogIdentifier();
        shortDescription2 = [serverCopy shortDescription];
        *buf = 138543874;
        v39 = v22;
        v40 = 2112;
        v41 = shortDescription2;
        v42 = 2112;
        v43 = errorCopy;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ failed to pair with error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
      userInfo = [errorCopy userInfo];
      v25 = [userInfo objectForKeyedSubscript:*MEMORY[0x277CCA7E8]];

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v26 = v25;
      }

      else
      {
        v26 = 0;
      }

      accessoryBrowser = v26;

      domain = [accessoryBrowser domain];
      v29 = *MEMORY[0x277CCA590];
      v30 = HMFEqualObjects();

      if (!v30 || [accessoryBrowser code] != -6754)
      {
        [v12 setLastPairingFailureTime:CFAbsoluteTimeGetCurrent()];
        [v12 setConsecutivePairingFailures:{objc_msgSend(v12, "consecutivePairingFailures") + 1}];
      }

      identifier2 = [serverCopy identifier];
      linkType = [serverCopy linkType];
      v36[0] = MEMORY[0x277D85DD0];
      v36[1] = 3221225472;
      v36[2] = __68__HMDHome_accessoryBrowser_accessoryServer_didStopPairingWithError___block_invoke;
      v36[3] = &unk_279733780;
      v37 = errorCopy;
      [(HMDHome *)v19 _notifyRetrievalError:v37 accessoryServer:identifier2 linkType:linkType accessoryOperationBlock:v36];
    }

    else
    {
      if (v21)
      {
        v33 = HMFGetLogIdentifier();
        shortDescription3 = [serverCopy shortDescription];
        *buf = 138543618;
        v39 = v33;
        v40 = 2112;
        v41 = shortDescription3;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory server %@ pairing completed successfully", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      accessoryBrowser = [(HMDHome *)v19 accessoryBrowser];
      [accessoryBrowser discoverAccessories:serverCopy];
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser discoveryFailedWithError:(id)error accessoryServer:(id)server linkType:(int64_t)type
{
  errorCopy = error;
  serverCopy = server;
  v11 = [(HMDHome *)self hapAccessoryWithIdentifier:serverCopy];
  if (v11)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke;
    v12[3] = &unk_279722AC8;
    typeCopy = type;
    v13 = serverCopy;
    [(HMDHome *)self _notifyRetrievalError:errorCopy accessoryServer:v13 linkType:type accessoryOperationBlock:v12];
  }
}

void __78__HMDHome_accessoryBrowser_discoveryFailedWithError_accessoryServer_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 40) != 2)
  {
    v6 = v3;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v4 = v6;
    }

    else
    {
      v4 = 0;
    }

    v5 = v4;
    [v5 setReachability:0 serverIdentifier:*(a1 + 32) linkType:*(a1 + 40)];

    v3 = v6;
  }
}

- (void)accessoryBrowser:(id)browser didFinishWACForAccessoryWithIdentifier:(id)identifier error:(id)error
{
  identifierCopy = identifier;
  errorCopy = error;
  v8 = [(HMDHome *)self accessoryWithIdentifier:identifierCopy];
  if (v8)
  {
    homeReprovisionHandler = [(HMDHome *)self homeReprovisionHandler];
    [homeReprovisionHandler handleReprovionedAccessory:v8 identifier:identifierCopy error:errorCopy];
  }
}

- (void)accessoryBrowser:(id)browser didFindAccessoryServerNeedingReprovisioning:(id)reprovisioning error:(id)error
{
  v24 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  reprovisioningCopy = reprovisioning;
  errorCopy = error;
  if ([reprovisioningCopy isPaired])
  {
    identifier = [reprovisioningCopy identifier];
    v12 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        shortDescription = [v12 shortDescription];
        v20 = 138543618;
        v21 = v16;
        v22 = 2112;
        v23 = shortDescription;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ needs reprovisioning is found", &v20, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
      homeReprovisionHandler = [(HMDHome *)selfCopy homeReprovisionHandler];
      [homeReprovisionHandler handleFoundAccessoryNeedingReprovisioning:v12 error:errorCopy];
    }
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didTombstoneAccessoryServer:(id)server
{
  v22 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  identifier = [serverCopy identifier];
  v9 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      shortDescription = [v9 shortDescription];
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = serverCopy;
      v20 = 2112;
      v21 = shortDescription;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ tombstoned - unconfiguring all paired accessories for %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    [(HMDHome *)selfCopy _unconfigurePairedAccessoriesForServer:serverCopy updateReachability:1];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didRemoveAccessoryServer:(id)server error:(id)error
{
  v30 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  errorCopy = error;
  identifier = [serverCopy identifier];
  v12 = [(HMDHome *)self hapAccessoryWithIdentifier:identifier];

  if (v12)
  {
    if ([serverCopy linkType] == 1)
    {
      [v12 _wol_processDidRemoveHPAccessoryServer:serverCopy];
    }

    linkType = [serverCopy linkType];
    if (errorCopy)
    {
      v14 = 0;
    }

    else
    {
      v14 = linkType == 2;
    }

    v15 = !v14;
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = @"not updating";
      v24 = 138543874;
      v25 = v19;
      v26 = 2112;
      if (v15)
      {
        v20 = @"updating";
      }

      v27 = serverCopy;
      v28 = 2112;
      v29 = v20;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@AccessoryServer %@ removed - %@ reachability", &v24, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    [(HMDHome *)selfCopy _unconfigurePairedAccessoriesForServer:serverCopy updateReachability:v15];
    v21 = objc_alloc_init(HMDHAPMetricsLogEvent);
    [(HMDHAPMetricsLogEvent *)v21 updateWithHAPAccessoryServer:serverCopy];
    logEventSubmitter = [(HMDHome *)selfCopy logEventSubmitter];
    [logEventSubmitter submitLogEvent:v21];
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didFindAccessoryServer:(id)server stateChanged:(BOOL)changed stateNumber:(id)number completion:(id)completion
{
  changedCopy = changed;
  v164 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  serverCopy = server;
  numberCopy = number;
  completionCopy = completion;
  v15 = objc_autoreleasePoolPush();
  selfCopy = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    shortDescription = [serverCopy shortDescription];
    v20 = HMFBooleanToString();
    *buf = 138544130;
    v153 = v18;
    v154 = 2112;
    v155 = shortDescription;
    v156 = 2112;
    v157 = numberCopy;
    v158 = 2112;
    v159 = v20;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Found paired accessory server %@. State: %@/%@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v15);
  identifier = [serverCopy identifier];
  v22 = [(HMDHome *)selfCopy hapAccessoryWithIdentifier:identifier];

  v23 = [(HMDHome *)selfCopy _shouldAvoidTombstoningAccessoryServer:serverCopy accessory:v22];
  v24 = v23;
  if (!v22)
  {
    v45 = 0;
    v33 = completionCopy;
LABEL_84:
    v33[2](v33, v24, v45 & 1);
    goto LABEL_85;
  }

  v143 = changedCopy;
  v147 = v23;
  residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
  isCurrentDeviceAvailableResident = [residentDeviceManager isCurrentDeviceAvailableResident];

  v26 = objc_autoreleasePoolPush();
  v27 = selfCopy;
  v28 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
  {
    v29 = HMFGetLogIdentifier();
    shortDescription2 = [v22 shortDescription];
    HMFBooleanToString();
    v32 = v31 = v22;
    *buf = 138543874;
    v153 = v29;
    v154 = 2112;
    v155 = shortDescription2;
    v156 = 2112;
    v157 = v32;
    _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Performing accessory/service discovery on paired accessory %@. isResidentDevice: %@", buf, 0x20u);

    v22 = v31;
  }

  objc_autoreleasePoolPop(v26);
  v148 = numberCopy;
  v33 = completionCopy;
  if ((![v22 canWakeUpViaWoL] || objc_msgSend(v22, "shouldDiscoverSuspendCapableAccessoryServer:", serverCopy)) && !objc_msgSend(serverCopy, "wakeNumber"))
  {
    v141 = browserCopy;
    v46 = serverCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v47 = v46;
    }

    else
    {
      v47 = 0;
    }

    v142 = v47;

    if ([v46 isReachable] && (objc_msgSend(v142, "isCached") & 1) == 0)
    {
      v48 = [MEMORY[0x277CBEB18] arrayWithObject:v22];
      v150[0] = MEMORY[0x277D85DD0];
      v150[1] = 3221225472;
      v150[2] = __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke;
      v150[3] = &unk_279733780;
      v151 = v46;
      [v48 na_each:v150];
    }

    v49 = objc_autoreleasePoolPush();
    v50 = v27;
    v51 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v52 = contexta = v46;
      shortDescription3 = [v22 shortDescription];
      [(HMDHome *)v50 isCurrentDevicePrimaryResident];
      v54 = HMFBooleanToString();
      [(HMDHome *)v50 isCurrentDeviceAvailableResident];
      HMFBooleanToString();
      v56 = v55 = v22;
      [(HMDHome *)v50 areAllResidentsUnreachable];
      v57 = HMFBooleanToString();
      *buf = 138544386;
      v153 = v52;
      v154 = 2112;
      v155 = shortDescription3;
      v156 = 2114;
      v157 = v54;
      v158 = 2114;
      v159 = v56;
      v160 = 2114;
      v161 = *&v57;
      _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@Evaluating disconnect on idle status for %@ using - isCurrentDevicePrimaryResident = %{public}@, isCurrentDeviceAvailableResident = %{public}@, areAllResidentsUnreachable = %{public}@", buf, 0x34u);

      v22 = v55;
      v33 = completionCopy;

      v46 = contexta;
    }

    objc_autoreleasePoolPop(v49);
    v58 = shouldDisconnectOnIdleForAccessory(v22);
    if (v58 != [v22 shouldDisconnectOnIdle])
    {
      [v22 setShouldDisconnectOnIdle:v58];
    }

    [v46 setShouldDisconnectOnIdle:v58];
    identifier2 = [v46 identifier];
    supportedTransports = [v22 supportedTransports];
    setupHash = [v46 setupHash];
    [(HMDHome *)v50 _registerPairedAccessory:identifier2 transports:supportedTransports setupHash:setupHash];

    DiscoveryBackoffPeriod = 0.0;
    v63 = v143;
    if (isCurrentDeviceAvailableResident)
    {
      numberCopy = v148;
      goto LABEL_41;
    }

    Current = CFAbsoluteTimeGetCurrent();
    [v22 lastPairingFailureTime];
    v66 = Current - v65;
    consecutivePairingFailures = [v22 consecutivePairingFailures];
    numberCopy = v148;
    if (v66 < getDiscoveryBackoffPeriod() || consecutivePairingFailures >= 6)
    {
      if (consecutivePairingFailures <= 5)
      {
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
      }

      else
      {
        DiscoveryBackoffPeriod = 1800.0;
      }

      [v22 setResetOnBackoffExpiry:consecutivePairingFailures > 5];
      v75 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
      identifier3 = [v46 identifier];
      [(HMDHome *)v50 _notifyRetrievalError:v75 accessoryServer:identifier3 linkType:0 accessoryOperationBlock:0];

      goto LABEL_38;
    }

    if (!v142 || !v143)
    {
      goto LABEL_41;
    }

    if ([(HMDHome *)v50 _isRegisteredForNotificationsWithRemoteGateway:v22])
    {
      v68 = objc_autoreleasePoolPush();
      v69 = v50;
      v70 = v50;
      v71 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
      {
LABEL_33:

        objc_autoreleasePoolPop(v68);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
        v50 = v69;
LABEL_38:
        if (DiscoveryBackoffPeriod != 0.0)
        {
          v45 = 0;
LABEL_79:

          browserCopy = v141;
          if (DiscoveryBackoffPeriod > 0.0)
          {
            v126 = objc_autoreleasePoolPush();
            v127 = v50;
            v128 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v128, OS_LOG_TYPE_INFO))
            {
              v129 = HMFGetLogIdentifier();
              shortDescription4 = [v22 shortDescription];
              HMFBooleanToString();
              v132 = v131 = v22;
              *buf = 138544386;
              v153 = v129;
              v154 = 2112;
              v155 = shortDescription4;
              v156 = 2112;
              v157 = v148;
              v158 = 2112;
              v159 = v132;
              v160 = 2048;
              v161 = DiscoveryBackoffPeriod;
              _os_log_impl(&dword_2531F8000, v128, OS_LOG_TYPE_INFO, "%{public}@Backing off discovery for accessory %@ with s# %@, state changed: %@ for %.2f sec", buf, 0x34u);

              numberCopy = v148;
              v22 = v131;
              v33 = completionCopy;
            }

            objc_autoreleasePoolPop(v126);
            [v22 backOffAccessoryForStateNumber:numberCopy backoffPeriod:DiscoveryBackoffPeriod];
          }

LABEL_83:
          v24 = v147;
          goto LABEL_84;
        }

        v63 = v143;
LABEL_41:
        if ([v22 shouldAutoDiscoverAccessoryServer])
        {
          v146 = 1;
        }

        else
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) != 0 && ([v22 hasIPLink] & 1) == 0)
          {
            v77 = objc_autoreleasePoolPush();
            v137 = v50;
            v78 = v50;
            v79 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v79, OS_LOG_TYPE_INFO))
            {
              v80 = HMFGetLogIdentifier();
              linkType = [v46 linkType];
              v82 = v33;
              if (linkType > 2)
              {
                v83 = @"Undefined";
              }

              else
              {
                v83 = off_279727440[linkType];
              }

              v98 = v83;
              [v22 shortDescription];
              v100 = v99 = v22;
              *buf = 138543874;
              v153 = v80;
              v154 = 2112;
              v155 = v98;
              v156 = 2112;
              v157 = v100;
              _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_INFO, "%{public}@Adding %@ transport for Thread accessory: %@", buf, 0x20u);

              v22 = v99;
              v33 = v82;
              v63 = v143;
            }

            objc_autoreleasePoolPop(v77);
            v101 = MEMORY[0x277CFE9F8];
            uniqueIdentifier = [v22 uniqueIdentifier];
            v103 = [v101 instanceIDForUniqueIdentifier:uniqueIdentifier];

            v104 = [HMDAccessoryTransportInformation alloc];
            identifier4 = [v46 identifier];
            v106 = -[HMDAccessoryTransportInformation initWithServerIdentifier:instanceID:linkType:](v104, "initWithServerIdentifier:instanceID:linkType:", identifier4, v103, [v46 linkType]);
            [v22 addTransportInformationInstance:v106];

            if ([v46 isReachable])
            {
              identifier5 = [v46 identifier];
              [v22 setReachability:1 serverIdentifier:identifier5 linkType:{objc_msgSend(v46, "linkType")}];
            }

            numberCopy = v148;
            v50 = v137;
          }

          if (v142)
          {
            v108 = isCurrentDeviceAvailableResident;
          }

          else
          {
            v108 = 0;
          }

          if (v108 == 1 && (v63 || [v142 connectReason] == 2))
          {
            v109 = objc_autoreleasePoolPush();
            v110 = v50;
            v111 = v50;
            v112 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v112, OS_LOG_TYPE_INFO))
            {
              v113 = HMFGetLogIdentifier();
              shortDescription5 = [v22 shortDescription];
              *buf = 138543618;
              v153 = v113;
              v154 = 2112;
              v155 = shortDescription5;
              _os_log_impl(&dword_2531F8000, v112, OS_LOG_TYPE_INFO, "%{public}@Enabling auto discovery for BTLE accessory: %@", buf, 0x16u);

              numberCopy = v148;
            }

            objc_autoreleasePoolPop(v109);
            v146 = 1;
            v50 = v110;
          }

          else
          {
            v146 = 0;
          }
        }

        enhancedAuthMethod = [v22 enhancedAuthMethod];
        v116 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](v50, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v22, [v46 linkType]);
        context = objc_autoreleasePoolPush();
        v117 = v50;
        v118 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
        {
          v138 = v50;
          v134 = HMFGetLogIdentifier();
          identifier6 = [v46 identifier];
          linkType2 = [v46 linkType];
          v135 = v117;
          v136 = v22;
          if (linkType2 > 2)
          {
            v121 = @"Undefined";
          }

          else
          {
            v121 = off_279727440[linkType2];
          }

          v122 = v121;
          v123 = HMFBooleanToString();
          v124 = HMFBooleanToString();
          v125 = HMFBooleanToString();
          *buf = 138544642;
          v153 = v134;
          v154 = 2112;
          v155 = identifier6;
          v156 = 2112;
          v157 = v122;
          v158 = 2112;
          v159 = v123;
          v160 = 2112;
          v161 = *&v124;
          v162 = 2112;
          v163 = v125;
          _os_log_impl(&dword_2531F8000, v118, OS_LOG_TYPE_INFO, "%{public}@Evaluating need to discover accessories from found accessory server %@/%@, autoDiscoveryEnabled =  %@, hasExplicitRetrieveRequest = %@ discoverForEAuth = %@", buf, 0x3Eu);

          numberCopy = v148;
          v33 = completionCopy;
          v22 = v136;
          v50 = v138;
          v117 = v135;
        }

        objc_autoreleasePoolPop(context);
        v45 = v146 | v116 | (enhancedAuthMethod == 0);
        goto LABEL_79;
      }

      v72 = HMFGetLogIdentifier();
      shortDescription6 = [v22 shortDescription];
      *buf = 138543618;
      v153 = v72;
      v154 = 2112;
      v155 = shortDescription6;
      v74 = "%{public}@Backing off since notifications for %@ are registered with remote gateway";
    }

    else
    {
      if (![(HMDHome *)v50 _isEventTriggerOnRemoteGatewayForAccessory:v22]|| [(HMDHome *)v50 _isRegisteredForNotificationsForClients:v22]|| [(HMDHome *)v50 _isEventTriggerOnLocalDeviceForAccessory:v22])
      {
        v84 = [(HMDHome *)v50 _isEventTriggerOnRemoteGatewayForAccessory:v22];
        v85 = objc_autoreleasePoolPush();
        v86 = v50;
        v87 = HMFGetOSLogHandle();
        v88 = os_log_type_enabled(v87, OS_LOG_TYPE_INFO);
        if (!v84)
        {
          if (v88)
          {
            v91 = HMFGetLogIdentifier();
            shortDescription7 = [v22 shortDescription];
            v93 = v85;
            stateNumber = [v142 stateNumber];
            [v142 stateChanged];
            HMFBooleanToString();
            v95 = v33;
            v97 = v96 = v22;
            *buf = 138544130;
            v153 = v91;
            v154 = 2112;
            v155 = shortDescription7;
            v156 = 2112;
            v157 = stateNumber;
            v158 = 2112;
            v159 = v97;
            _os_log_impl(&dword_2531F8000, v87, OS_LOG_TYPE_INFO, "%{public}@Discovering BLE Accessory: %@, State Number: %@, State Changed: %@", buf, 0x2Au);

            numberCopy = v148;
            v22 = v96;
            v33 = v95;
            v85 = v93;
          }

          objc_autoreleasePoolPop(v85);
          v45 = 1;
          browserCopy = v141;
          goto LABEL_83;
        }

        if (v88)
        {
          v89 = HMFGetLogIdentifier();
          shortDescription8 = [v22 shortDescription];
          *buf = 138543618;
          v153 = v89;
          v154 = 2112;
          v155 = shortDescription8;
          _os_log_impl(&dword_2531F8000, v87, OS_LOG_TYPE_INFO, "%{public}@Backing off since triggers are on resident and have clients interested for accessory: %@", buf, 0x16u);

          numberCopy = v148;
        }

        objc_autoreleasePoolPop(v85);
        DiscoveryBackoffPeriod = getDiscoveryBackoffPeriod();
        goto LABEL_38;
      }

      v68 = objc_autoreleasePoolPush();
      v69 = v50;
      v70 = v50;
      v71 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v71, OS_LOG_TYPE_INFO))
      {
        goto LABEL_33;
      }

      v72 = HMFGetLogIdentifier();
      shortDescription6 = [v22 shortDescription];
      *buf = 138543618;
      v153 = v72;
      v154 = 2112;
      v155 = shortDescription6;
      v74 = "%{public}@Not discovering accessory (%@) as trigger is active on resident and no clients and no local triggers locally";
    }

    _os_log_impl(&dword_2531F8000, v71, OS_LOG_TYPE_INFO, v74, buf, 0x16u);

    numberCopy = v148;
    goto LABEL_33;
  }

  v34 = objc_autoreleasePoolPush();
  v35 = v27;
  v36 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
  {
    v37 = HMFGetLogIdentifier();
    shortDescription9 = [serverCopy shortDescription];
    lpmProfile = [v22 lpmProfile];
    [v22 connectivityInfo];
    v145 = serverCopy;
    v41 = v40 = browserCopy;
    woWLANInfo = [v41 woWLANInfo];
    *buf = 138544130;
    v153 = v37;
    v154 = 2112;
    v155 = shortDescription9;
    v156 = 2112;
    v157 = lpmProfile;
    v158 = 2112;
    v159 = woWLANInfo;
    _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Not discovering the suspended accessory server: %@ with LPM Profile: %@ and WoWInfo: %@.", buf, 0x2Au);

    browserCopy = v40;
    serverCopy = v145;

    v33 = completionCopy;
  }

  objc_autoreleasePoolPop(v34);
  v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  identifier7 = [serverCopy identifier];
  -[HMDHome _notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:](v35, "_notifyRetrievalError:accessoryServer:linkType:accessoryOperationBlock:", v43, identifier7, [serverCopy linkType], 0);

  v33[2](v33, v147, 0);
  numberCopy = v148;
LABEL_85:

  v133 = *MEMORY[0x277D85DE8];
}

void __87__HMDHome_accessoryBrowser_didFindAccessoryServer_stateChanged_stateNumber_completion___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v6;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [*(a1 + 32) identifier];
  [v4 setReachability:1 serverIdentifier:v5 linkType:{objc_msgSend(*(a1 + 32), "linkType")}];
}

- (void)handleRemovedMediaSessions:(id)sessions
{
  sessionsCopy = sessions;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_handleRemovedMediaSessions___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = sessionsCopy;
  selfCopy = self;
  v6 = sessionsCopy;
  dispatch_async(workQueue, v7);
}

void __38__HMDHome_handleRemovedMediaSessions___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_arrayForKey:@"kRemovedMediaSessionIdentifiersKey"];

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = v3;
  v5 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(a1 + 40) _removeMediaSessionWithIdentifier:{*(*(&v10 + 1) + 8 * v8++), v10}];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didRemoveAccessoryAdvertisement:(id)advertisement
{
  v19 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  advertisementCopy = advertisement;
  identifier = [advertisementCopy identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:identifier];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = advertisementCopy;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling removed advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 removeAdvertisement:advertisementCopy];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)accessoryBrowser:(id)browser didAddAccessoryAdvertisement:(id)advertisement
{
  v19 = *MEMORY[0x277D85DE8];
  browserCopy = browser;
  advertisementCopy = advertisement;
  identifier = [advertisementCopy identifier];
  v9 = [(HMDHome *)self accessoryWithIdentifier:identifier];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = advertisementCopy;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Handling added advertisement: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    [v9 addAdvertisement:advertisementCopy];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceAvailableResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDeviceAvailableResident = [residentDeviceManager isCurrentDeviceAvailableResident];

  return isCurrentDeviceAvailableResident;
}

- (BOOL)_shouldAvoidTombstoningAccessoryServer:(id)server accessory:(id)accessory
{
  v42 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  accessoryCopy = accessory;
  v8 = accessoryCopy;
  v9 = 0;
  if (serverCopy && accessoryCopy)
  {
    removeAccessoryInProgressForHMDAccessories = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v11 = [removeAccessoryInProgressForHMDAccessories containsObject:v8];

    if (v11)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        name = [serverCopy name];
        identifier = [serverCopy identifier];
        *buf = 138543874;
        v37 = v15;
        v38 = 2112;
        v39 = name;
        v40 = 2112;
        v41 = identifier;
        v18 = "%{public}@Accessory %@/%@ being removed from home - not tombstoning";
LABEL_9:
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, v18, buf, 0x20u);
      }
    }

    else
    {
      addPendingAccessorySetupCodeHandlers = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
      uuid = [v8 uuid];
      v21 = [addPendingAccessorySetupCodeHandlers objectForKey:uuid];

      if (!v21)
      {
        addPendingAccessories = [(HMDHome *)self addPendingAccessories];
        hm_allKeys = [addPendingAccessories hm_allKeys];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke;
        v34[3] = &unk_279722568;
        v26 = v8;
        v35 = v26;
        v27 = [hm_allKeys na_any:v34];

        if (!v27)
        {

          v9 = -[HMDHome _isRetrievalInProgressForPrimaryAccessory:linkType:](self, "_isRetrievalInProgressForPrimaryAccessory:linkType:", v26, [serverCopy linkType]);
          goto LABEL_12;
        }

        v28 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
        {
          v31 = HMFGetLogIdentifier();
          name2 = [serverCopy name];
          identifier2 = [serverCopy identifier];
          *buf = 138543874;
          v37 = v31;
          v38 = 2112;
          v39 = name2;
          v40 = 2112;
          v41 = identifier2;
          _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ being added to home (via setupDescription) - not tombstoning", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v28);
        goto LABEL_11;
      }

      v12 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        name = [serverCopy name];
        identifier = [serverCopy identifier];
        *buf = 138543874;
        v37 = v15;
        v38 = 2112;
        v39 = name;
        v40 = 2112;
        v41 = identifier;
        v18 = "%{public}@Accessory %@/%@ being added to home - not tombstoning";
        goto LABEL_9;
      }
    }

    objc_autoreleasePoolPop(v12);
LABEL_11:
    v9 = 1;
  }

LABEL_12:

  v22 = *MEMORY[0x277D85DE8];
  return v9;
}

uint64_t __60__HMDHome__shouldAvoidTombstoningAccessoryServer_accessory___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 accessoryUUID];
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (BOOL)_isEventTriggerOnLocalDeviceForAccessory:(id)accessory
{
  v20 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(triggers);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnLocalDeviceForAccessory:accessoryCopy];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isEventTriggerOnRemoteGatewayForAccessory:(id)accessory
{
  v20 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(triggers);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        v12 = [v11 isEventTriggerOnRemoteGatewayForAccessory:accessoryCopy];
        if (v12)
        {
          LOBYTE(v6) = 1;
          goto LABEL_14;
        }
      }

      v6 = [triggers countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_14:

  v13 = *MEMORY[0x277D85DE8];
  return v6;
}

- (BOOL)_isRegisteredForNotificationsForClients:(id)clients
{
  clientsCopy = clients;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = clientsCopy;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  isClientRegisteredForNotifications = [v5 isClientRegisteredForNotifications];

  return isClientRegisteredForNotifications;
}

- (BOOL)_isRegisteredForNotificationsWithRemoteGateway:(id)gateway
{
  v32 = *MEMORY[0x277D85DE8];
  gatewayCopy = gateway;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = gatewayCopy;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v29 = 0u;
  services = [v5 services];
  v7 = [services copy];

  v8 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v27;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v27 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v26 + 1) + 8 * i);
        v22 = 0u;
        v23 = 0u;
        v24 = 0u;
        v25 = 0u;
        characteristics = [v12 characteristics];
        v14 = [characteristics copy];

        v15 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
        if (v15)
        {
          v16 = v15;
          v17 = *v23;
          while (2)
          {
            for (j = 0; j != v16; ++j)
            {
              if (*v23 != v17)
              {
                objc_enumerationMutation(v14);
              }

              if ([*(*(&v22 + 1) + 8 * j) notificationRegisteredWithRemoteGateway])
              {

                v19 = 1;
                goto LABEL_22;
              }
            }

            v16 = [v14 countByEnumeratingWithState:&v22 objects:v30 count:16];
            if (v16)
            {
              continue;
            }

            break;
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v26 objects:v31 count:16];
      v19 = 0;
    }

    while (v9);
  }

  else
  {
    v19 = 0;
  }

LABEL_22:

  v20 = *MEMORY[0x277D85DE8];
  return v19;
}

- (void)retrieveHAPAccessoryForHMDAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve queue:(id)queue completion:(id)completion
{
  accessoryCopy = accessory;
  queueCopy = queue;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  v19[0] = MEMORY[0x277D85DD0];
  v19[1] = 3221225472;
  v19[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke;
  v19[3] = &unk_2797268F8;
  v19[4] = self;
  v20 = accessoryCopy;
  v22 = completionCopy;
  typeCopy = type;
  retrieveCopy = retrieve;
  v21 = queueCopy;
  v16 = queueCopy;
  v17 = completionCopy;
  v18 = accessoryCopy;
  dispatch_async(workQueue, v19);
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = *(a1 + 72);
  v4 = *(a1 + 64);
  if (*(a1 + 56))
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2;
    v7[3] = &unk_279733F30;
    v8 = *(a1 + 48);
    v9 = *(a1 + 56);
    [v1 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:v7];
  }

  else
  {
    v6 = *(a1 + 32);

    [v6 _retrieveHAPAccessoryForHMDHAPAccessory:v2 linkType:v4 forceRetrieve:v3 completion:0];
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  if (v4)
  {
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3;
    v7[3] = &unk_279735738;
    v9 = *(a1 + 40);
    v8 = v3;
    dispatch_async(v4, v7);
  }

  else
  {
    v5 = _Block_copy(*(a1 + 40));
    v6 = v5;
    if (v5)
    {
      (*(v5 + 2))(v5, v3);
    }
  }
}

void __87__HMDHome_retrieveHAPAccessoryForHMDAccessory_linkType_forceRetrieve_queue_completion___block_invoke_3(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, *(a1 + 32));
    v2 = v3;
  }
}

- (HMFMessageDestination)messageDestination
{
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  messageTargetUUID = [(HMDHome *)self messageTargetUUID];
  v5 = [v3 initWithTarget:messageTargetUUID];

  return v5;
}

- (void)_removeCorruptAccessories
{
  selfCopy = self;
  v43 = *MEMORY[0x277D85DE8];
  accessories = [(HMDHome *)self accessories];
  v26 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v4 = accessories;
  v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
  if (v29)
  {
    v6 = *v31;
    *&v5 = 138544130;
    v23 = v5;
    v24 = v4;
    v25 = selfCopy;
    do
    {
      v7 = 0;
      do
      {
        if (*v31 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v30 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        identifier = [v8 identifier];
        if (identifier)
        {
          v12 = identifier;
          if (!v10)
          {

LABEL_16:
            [v26 addObject:{v8, v23}];
            goto LABEL_17;
          }

          uniqueIdentifier = [v10 uniqueIdentifier];

          if (uniqueIdentifier)
          {
            goto LABEL_16;
          }
        }

        v14 = objc_autoreleasePoolPush();
        v15 = selfCopy;
        v16 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
        {
          v27 = HMFGetLogIdentifier();
          uuid = [v8 uuid];
          uUIDString = [uuid UUIDString];
          identifier2 = [v8 identifier];
          [v10 uniqueIdentifier];
          v28 = v14;
          v21 = v20 = v6;
          *buf = v23;
          v35 = v27;
          v36 = 2112;
          v37 = uUIDString;
          v38 = 2112;
          v39 = identifier2;
          v40 = 2112;
          v41 = v21;
          _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Incomplete accessory: %@ (%@ / %@)", buf, 0x2Au);

          v6 = v20;
          v14 = v28;

          v4 = v24;
          selfCopy = v25;
        }

        objc_autoreleasePoolPop(v14);
LABEL_17:

        ++v7;
      }

      while (v29 != v7);
      v29 = [v4 countByEnumeratingWithState:&v30 objects:v42 count:16];
    }

    while (v29);
  }

  [(HMDHome *)selfCopy setAccessories:v26];
  v22 = *MEMORY[0x277D85DE8];
}

- (void)_encodeActionSets:(id)sets coder:(id)coder
{
  setsCopy = sets;
  coderCopy = coder;
  if ([(HMDHome *)self shouldWeSendAutomationsToClients])
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithArray:setsCopy];
    v8 = [MEMORY[0x277CCAC30] predicateWithFormat:@"type == %@", *MEMORY[0x277CCF1A8]];
    v9 = [v7 filteredArrayUsingPredicate:v8];
    if ([v9 count])
    {
      v10 = [v9 copy];
      [coderCopy encodeObject:v10 forKey:@"actionSets"];
    }

    if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      v11 = [v7 arrayByExcludingObjectsInArray:v9];
      [coderCopy encodeObject:v11 forKey:@"builtinActionSets"];
    }
  }
}

- (void)encodeMediaSystemsWithCoder:(id)coder modifiedOptions:(unint64_t)options
{
  optionsCopy = options;
  coderCopy = coder;
  if ((optionsCopy & 0xC0) != 0)
  {
    v9 = coderCopy;
    if ([coderCopy hmd_isForXPCTransport])
    {
      mediaSystems = [(HMDHome *)self mediaSystems];
      v8 = MEMORY[0x277CD2480];
    }

    else
    {
      mediaSystems = [(HMDHome *)self mediaSystemController];
      v8 = MEMORY[0x277CD2448];
    }

    [v9 encodeObject:mediaSystems forKey:*v8];

    coderCopy = v9;
  }
}

- (void)_encodeObjectsWithAccessoriesWithCoder:(id)coder
{
  v120 = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  hmd_isForXPCTransport = [coderCopy hmd_isForXPCTransport];
  hmd_isForLocalStore = [coderCopy hmd_isForLocalStore];
  hmd_isForRemoteTransport = [coderCopy hmd_isForRemoteTransport];
  hmd_isForRemoteTransportOnSameAccount = [coderCopy hmd_isForRemoteTransportOnSameAccount];
  hmd_isForRemoteGatewayCoder = [coderCopy hmd_isForRemoteGatewayCoder];
  hmd_isForXPCTransportEntitledForSPIAccess = [coderCopy hmd_isForXPCTransportEntitledForSPIAccess];
  hmd_homeManagerOptions = [coderCopy hmd_homeManagerOptions];
  v12 = hmd_homeManagerOptions;
  if (hmd_homeManagerOptions)
  {
    v13 = hmd_homeManagerOptions | 0x9FD0;
    if (!hmd_isForXPCTransportEntitledForSPIAccess)
    {
      v13 = hmd_homeManagerOptions;
    }

    if (hmd_isForRemoteTransportOnSameAccount)
    {
      v14 = hmd_homeManagerOptions;
    }

    else
    {
      v14 = -1;
    }

    if (!hmd_isForRemoteTransport)
    {
      v14 = hmd_homeManagerOptions;
    }

    if (hmd_isForXPCTransport)
    {
      v15 = v13;
    }

    else
    {
      v15 = v14;
    }

    [(HMDHome *)self __encodeAccessoriesWithCoder:coderCopy options:v15];
    [(HMDHome *)self encodeMediaSystemsWithCoder:coderCopy modifiedOptions:v15];
    if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
    {
      serviceGroups = [(HMDHome *)self serviceGroups];
      [coderCopy encodeObject:serviceGroups forKey:*MEMORY[0x277CD25E8]];
    }

    actionSets = [(HMDHome *)self actionSets];
    selfCopy = self;
    [(HMDHome *)self _encodeActionSets:actionSets coder:coderCopy];

    if ((((hmd_isForXPCTransport | hmd_isForLocalStore) & 1) != 0 || ((hmd_isForRemoteTransport ^ 1 | hmd_isForRemoteTransportOnSameAccount) & 1) == 0 || ((hmd_isForRemoteTransportOnSameAccount ^ 1 | hmd_isForRemoteGatewayCoder) & 1) == 0) && [(HMDHome *)self shouldWeSendAutomationsToClients])
    {
      triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
      [coderCopy encodeObject:triggerOwnedActionSets forKey:@"HM.triggerOwnedActionSets"];
    }

    if (!isWatch())
    {
      v84 = coderCopy;
      if (hmd_isForXPCTransport && hmd_isForXPCTransportEntitledForSPIAccess & 1 | !isAppleTV())
      {
        v19 = MEMORY[0x277CBEB18];
        triggers = [(HMDHome *)self triggers];
        v21 = [v19 arrayWithCapacity:{objc_msgSend(triggers, "count")}];

        v111 = 0u;
        v112 = 0u;
        v109 = 0u;
        v110 = 0u;
        triggers2 = [(HMDHome *)self triggers];
        v23 = [triggers2 countByEnumeratingWithState:&v109 objects:v119 count:16];
        if (v23)
        {
          v24 = v23;
          v25 = *v110;
          do
          {
            for (i = 0; i != v24; ++i)
            {
              if (*v110 != v25)
              {
                objc_enumerationMutation(triggers2);
              }

              v27 = *(*(&v109 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v28 = v27;
              }

              else
              {
                v28 = 0;
              }

              v29 = v28;

              if (v29)
              {
                [v21 addObject:v27];
              }

              else
              {
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v30 = v27;
                  significantEvent = [v30 significantEvent];

                  if ((significantEvent == 0) | hmd_isForXPCTransportEntitledForSPIAccess & 1)
                  {
                    [v21 addObject:v30];
                  }
                }
              }
            }

            v24 = [triggers2 countByEnumeratingWithState:&v109 objects:v119 count:16];
          }

          while (v24);
        }

        coderCopy = v84;
        if ([(HMDHome *)self shouldWeSendAutomationsToClients])
        {
          v32 = [v21 copy];
          [v84 encodeObject:v32 forKey:@"triggers"];
        }
      }

      else if (([coderCopy hmd_isForLocalStore] & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteTransport") && (objc_msgSend(coderCopy, "hmd_isForRemoteTransportOnSameAccount") & 1) == 0 && (objc_msgSend(coderCopy, "hmd_isForRemoteUserAdministrator") & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteTransportOnSameAccount") && (objc_msgSend(coderCopy, "hmd_isForRemoteGatewayCoder") & 1) == 0)
      {
        array = [MEMORY[0x277CBEB18] array];
        array2 = [MEMORY[0x277CBEB18] array];
        array3 = [MEMORY[0x277CBEB18] array];
        array4 = [MEMORY[0x277CBEB18] array];
        v105 = 0u;
        v106 = 0u;
        v107 = 0u;
        v108 = 0u;
        obj = [(HMDHome *)self triggers];
        v33 = [obj countByEnumeratingWithState:&v105 objects:v118 count:16];
        if (v33)
        {
          v34 = v33;
          v35 = *v106;
          v81 = *v106;
          do
          {
            v36 = 0;
            v82 = v34;
            do
            {
              if (*v106 != v35)
              {
                objc_enumerationMutation(obj);
              }

              v37 = *(*(&v105 + 1) + 8 * v36);
              owningDevice = [v37 owningDevice];

              if (owningDevice)
              {
                v39 = v37;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v40 = v39;
                }

                else
                {
                  v40 = 0;
                }

                v41 = v40;

                if (([coderCopy hmd_isForLocalStore] & 1) == 0)
                {
                  v103 = 0u;
                  v104 = 0u;
                  v101 = 0u;
                  v102 = 0u;
                  characteristicBaseEvents = [v41 characteristicBaseEvents];
                  v43 = [characteristicBaseEvents countByEnumeratingWithState:&v101 objects:v117 count:16];
                  if (v43)
                  {
                    v44 = v43;
                    v45 = *v102;
                    while (2)
                    {
                      for (j = 0; j != v44; ++j)
                      {
                        if (*v102 != v45)
                        {
                          objc_enumerationMutation(characteristicBaseEvents);
                        }

                        characteristic = [*(*(&v101 + 1) + 8 * j) characteristic];
                        accessory = [characteristic accessory];

                        objc_opt_class();
                        LOBYTE(characteristic) = objc_opt_isKindOfClass();

                        if ((characteristic & 1) != 0 && accessory)
                        {

                          v49 = array3;
                          v35 = v81;
                          v34 = v82;
                          coderCopy = v84;
                          goto LABEL_68;
                        }
                      }

                      v44 = [characteristicBaseEvents countByEnumeratingWithState:&v101 objects:v117 count:16];
                      if (v44)
                      {
                        continue;
                      }

                      break;
                    }
                  }

                  v34 = v82;
                  coderCopy = v84;
                  v35 = v81;
                }

                if ([v39 requiresDataVersion4])
                {
                  v49 = array4;
                }

                else
                {
                  v49 = array2;
                }

LABEL_68:
                [v49 addObject:v39];
              }

              else
              {
                [array addObject:v37];
              }

              ++v36;
            }

            while (v36 != v34);
            v34 = [obj countByEnumeratingWithState:&v105 objects:v118 count:16];
          }

          while (v34);
        }

        v50 = [array2 copy];
        [coderCopy encodeObject:v50 forKey:@"HM.triggers"];

        v51 = [array3 copy];
        [coderCopy encodeObject:v51 forKey:@"HM.homePodTriggers"];

        v52 = [array4 copy];
        [coderCopy encodeObject:v52 forKey:@"HM.sharedActivationTriggers"];

        if ([coderCopy hmd_isForLocalStore])
        {
          v53 = [array copy];
          [coderCopy encodeObject:v53 forKey:@"triggers"];

          _updateAndGetOwnedTriggers = [(HMDHome *)selfCopy _updateAndGetOwnedTriggers];
          [coderCopy encodeObject:_updateAndGetOwnedTriggers forKey:@"HM.deviceOwnedTriggers"];
        }
      }

      else if ([coderCopy hmd_isForNonAdminSharedUser])
      {
        v56 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          *buf = 138543362;
          v116 = v59;
          _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, "%{public}@Syncing triggers to remote transport", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v56);
        array5 = [MEMORY[0x277CBEB18] array];
        array6 = [MEMORY[0x277CBEB18] array];
        v97 = 0u;
        v98 = 0u;
        v99 = 0u;
        v100 = 0u;
        triggers3 = [(HMDHome *)selfCopy2 triggers];
        obja = [triggers3 countByEnumeratingWithState:&v97 objects:v114 count:16];
        if (obja)
        {
          v90 = *v98;
          do
          {
            for (k = 0; k != obja; k = k + 1)
            {
              if (*v98 != v90)
              {
                objc_enumerationMutation(triggers3);
              }

              v61 = *(*(&v97 + 1) + 8 * k);
              owningDevice2 = [v61 owningDevice];

              if (owningDevice2)
              {
                v63 = v61;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v64 = v63;
                }

                else
                {
                  v64 = 0;
                }

                v65 = v64;

                v95 = 0u;
                v96 = 0u;
                v93 = 0u;
                v94 = 0u;
                characteristicBaseEvents2 = [v65 characteristicBaseEvents];
                v67 = [characteristicBaseEvents2 countByEnumeratingWithState:&v93 objects:v113 count:16];
                if (v67)
                {
                  v68 = v67;
                  v69 = *v94;
                  while (2)
                  {
                    for (m = 0; m != v68; ++m)
                    {
                      if (*v94 != v69)
                      {
                        objc_enumerationMutation(characteristicBaseEvents2);
                      }

                      characteristic2 = [*(*(&v93 + 1) + 8 * m) characteristic];
                      accessory2 = [characteristic2 accessory];

                      objc_opt_class();
                      LOBYTE(characteristic2) = objc_opt_isKindOfClass();

                      if ((characteristic2 & 1) != 0 && accessory2)
                      {

                        v76 = array6;
                        goto LABEL_104;
                      }
                    }

                    v68 = [characteristicBaseEvents2 countByEnumeratingWithState:&v93 objects:v113 count:16];
                    if (v68)
                    {
                      continue;
                    }

                    break;
                  }
                }

                hmd_supportedFeatures = [v84 hmd_supportedFeatures];
                hmd_user = [v84 hmd_user];
                v75 = [v63 compatible:hmd_supportedFeatures user:hmd_user];

                v76 = array5;
                if (v75)
                {
LABEL_104:
                  [v76 addObject:v63];
                }
              }
            }

            obja = [triggers3 countByEnumeratingWithState:&v97 objects:v114 count:16];
          }

          while (obja);
        }

        v77 = [array5 copy];
        coderCopy = v84;
        [v84 encodeObject:v77 forKey:@"HM.triggers"];

        v78 = [array6 copy];
        [v84 encodeObject:v78 forKey:@"HM.homePodTriggers"];
      }
    }
  }

  else
  {
    [(HMDHome *)self __encodeAccessoriesWithCoder:coderCopy options:hmd_homeManagerOptions];
    [(HMDHome *)self encodeMediaSystemsWithCoder:coderCopy modifiedOptions:v12];
  }

  v55 = *MEMORY[0x277D85DE8];
}

- (void)__encodeAccessoriesWithCoder:(id)coder options:(unint64_t)options
{
  optionsCopy = options;
  v112 = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  selfCopy = self;
  accessories = [(HMDHome *)self accessories];
  v83 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v79 = coderCopy;
  hmd_isForXPCTransport = [coderCopy hmd_isForXPCTransport];
  v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v10 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v80 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v97 = 0u;
  v98 = 0u;
  v99 = 0u;
  v100 = 0u;
  obj = accessories;
  v11 = [obj countByEnumeratingWithState:&v97 objects:v111 count:16];
  v84 = v7;
  v85 = v9;
  v86 = v10;
  if (v11)
  {
    v12 = v11;
    v13 = *v98;
    do
    {
      v14 = 0;
      do
      {
        if (*v98 != v13)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v97 + 1) + 8 * v14);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v16 = v15;
        }

        else
        {
          v16 = 0;
        }

        v17 = v16;

        v18 = v15;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!((v20 == 0) | hmd_isForXPCTransport & 1))
        {
          v22 = v10;
          v23 = v20;
          goto LABEL_19;
        }

        if (!((v17 == 0) | hmd_isForXPCTransport & 1))
        {
          v22 = v9;
          v23 = v17;
          goto LABEL_19;
        }

        isCurrentAccessory = [v18 isCurrentAccessory];
        if ((optionsCopy & 0x10) != 0 && isCurrentAccessory)
        {
          v22 = v7;
          v23 = v18;
LABEL_19:
          [v22 addObject:v23];
          goto LABEL_20;
        }

        v24 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v25 = v24;
        }

        else
        {
          v25 = 0;
        }

        v26 = v25;

        if (v26)
        {
          v10 = v86;
          if ((optionsCopy & 0x100) != 0)
          {
            [v83 addObject:v26];
          }

          goto LABEL_63;
        }

        v27 = v24;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v28 = v27;
        }

        else
        {
          v28 = 0;
        }

        v29 = v28;

        if (v29)
        {
          v7 = v84;
          if ((optionsCopy & 0x40) != 0 || (optionsCopy & 0x800) != 0 && ([v29 device], v30 = objc_claimAutoreleasedReturnValue(), v30, v30))
          {
            [v84 addObject:v29];
          }

          goto LABEL_62;
        }

        v31 = v27;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v32 = v31;
        }

        else
        {
          v32 = 0;
        }

        v33 = v32;
        v81 = v31;

        if (v33)
        {
          v82 = v33;
          v34 = v33;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v36 = v34;
          }

          else
          {
            v36 = 0;
          }

          v37 = v36;

          if (isKindOfClass)
          {
            if (hmd_isForXPCTransport)
            {
              hostAccessory = [v34 hostAccessory];

              if (!hostAccessory)
              {
                goto LABEL_46;
              }

LABEL_60:

              v33 = v82;
              goto LABEL_61;
            }

            v40 = v80;
            v41 = v34;
          }

          else
          {
LABEL_46:
            if ([v34 hasTelevisionService])
            {
              if ((optionsCopy & 0x400) == 0)
              {
                goto LABEL_60;
              }
            }

            else
            {
              networkRouterController = [v34 networkRouterController];

              if (networkRouterController)
              {
                if ((optionsCopy & 0x1000) == 0)
                {
                  goto LABEL_60;
                }
              }

              else if ((optionsCopy & 0x200) == 0)
              {
                hasSmartSpeakerService = [v34 hasSmartSpeakerService];
                if ((optionsCopy & 0x100) == 0 || !hasSmartSpeakerService)
                {
                  siriEndpointProfile = [v34 siriEndpointProfile];

                  if ((optionsCopy & 0x8000) == 0 || !siriEndpointProfile)
                  {
                    goto LABEL_60;
                  }
                }
              }
            }

            v40 = v84;
            v41 = v81;
          }

          [v40 addObject:v41];
          goto LABEL_60;
        }

LABEL_61:

        v7 = v84;
        v29 = 0;
LABEL_62:

        v10 = v86;
LABEL_63:

        v9 = v85;
LABEL_20:

        ++v14;
      }

      while (v12 != v14);
      v44 = [obj countByEnumeratingWithState:&v97 objects:v111 count:16];
      v12 = v44;
    }

    while (v44);
  }

  v45 = objc_autoreleasePoolPush();
  v46 = selfCopy;
  v47 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v47, OS_LOG_TYPE_DEBUG))
  {
    v48 = HMFGetLogIdentifier();
    hmd_clientIdentifier = [v79 hmd_clientIdentifier];
    v50 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(v84, "count")}];
    shortDescription = [v84 shortDescription];
    *buf = 138544130;
    v104 = v48;
    v105 = 2112;
    v106 = hmd_clientIdentifier;
    v107 = 2112;
    v108 = v50;
    v109 = 2112;
    v110 = shortDescription;
    _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_DEBUG, "%{public}@encoded Accessories [%@]: %@, %@", buf, 0x2Au);

    v7 = v84;
    v9 = v85;
  }

  objc_autoreleasePoolPop(v45);
  v52 = [v7 copy];
  [v79 encodeObject:v52 forKey:@"accessories"];

  v53 = v7;
  v54 = [v83 copy];
  [v79 encodeObject:v54 forKey:@"accessories.airplay"];

  v55 = [v9 copy];
  [v79 encodeObject:v55 forKey:@"accessories.homepod"];

  v56 = v86;
  v57 = [v86 copy];
  [v79 encodeObject:v57 forKey:@"accessories.homepod_6_1"];

  v58 = [v80 copy];
  [v79 encodeObject:v58 forKey:@"HM.AppleMediaAccessorySensor"];

  if ((optionsCopy & 5) == 0)
  {
    v59 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(obj, "count")}];
    v93 = 0u;
    v94 = 0u;
    v95 = 0u;
    v96 = 0u;
    v60 = v7;
    v61 = [v60 countByEnumeratingWithState:&v93 objects:v102 count:16];
    if (v61)
    {
      v62 = v61;
      v63 = *v94;
      do
      {
        for (i = 0; i != v62; ++i)
        {
          if (*v94 != v63)
          {
            objc_enumerationMutation(v60);
          }

          v65 = *(*(&v93 + 1) + 8 * i);
          room = [v65 room];

          if (room)
          {
            room2 = [v65 room];
            [v59 addObject:room2];
          }
        }

        v62 = [v60 countByEnumeratingWithState:&v93 objects:v102 count:16];
      }

      while (v62);
    }

    v91 = 0u;
    v92 = 0u;
    v89 = 0u;
    v90 = 0u;
    v68 = v83;
    v69 = [v68 countByEnumeratingWithState:&v89 objects:v101 count:16];
    if (v69)
    {
      v70 = v69;
      v71 = *v90;
      do
      {
        for (j = 0; j != v70; ++j)
        {
          if (*v90 != v71)
          {
            objc_enumerationMutation(v68);
          }

          v73 = *(*(&v89 + 1) + 8 * j);
          room3 = [v73 room];

          if (room3)
          {
            room4 = [v73 room];
            [v59 addObject:room4];
          }
        }

        v70 = [v68 countByEnumeratingWithState:&v89 objects:v101 count:16];
      }

      while (v70);
    }

    allObjects = [v59 allObjects];
    [v79 encodeObject:allObjects forKey:@"rooms"];

    v53 = v84;
    v9 = v85;
    v56 = v86;
  }

  v77 = *MEMORY[0x277D85DE8];
}

- (void)_encodeWithCoder:(id)coder
{
  v314 = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  hmd_isForXPCTransport = [coderCopy hmd_isForXPCTransport];
  hmd_isForLocalStore = [coderCopy hmd_isForLocalStore];
  hmd_isForXPCTransportEntitledForSPIAccess = [coderCopy hmd_isForXPCTransportEntitledForSPIAccess];
  hmd_isForRemoteTransportOnSameAccount = [coderCopy hmd_isForRemoteTransportOnSameAccount];
  hmd_homeManagerOptions = [coderCopy hmd_homeManagerOptions];
  v246 = hmd_isForLocalStore;
  if (hmd_isForLocalStore)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy isOwnerUser];
      v11 = HMFBooleanToString();
      *buf = 138543618;
      v298 = v10;
      v299 = 2112;
      v300 = v11;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Encoding isOwnerUser : %@ for HH2 migration", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [coderCopy encodeBool:-[HMDHome isOwnerUser](selfCopy forKey:{"isOwnerUser"), @"HM.Owner.HH2.MI"}];
  }

  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  [coderCopy encodeObject:uUIDString forKey:@"homeUUID"];

  ownerName = [(HMDHome *)self ownerName];
  [coderCopy encodeObject:ownerName forKey:@"homeAdmin"];

  owner = [(HMDHome *)self owner];
  uuid2 = [owner uuid];
  uUIDString2 = [uuid2 UUIDString];
  [coderCopy encodeObject:uUIDString2 forKey:@"kHomeOwnerUUID"];

  creationDate = [(HMDHome *)self creationDate];
  [coderCopy encodeObject:creationDate forKey:@"creationDate"];

  firstHAPAccessoryAddedDate = [(HMDHome *)self firstHAPAccessoryAddedDate];
  [coderCopy encodeObject:firstHAPAccessoryAddedDate forKey:@"firstHAPAccessoryAddedDate"];

  configurationVersion = [(HMDHome *)self configurationVersion];
  hmd_supportedFeatures = [coderCopy hmd_supportedFeatures];
  LODWORD(uUIDString2) = [hmd_supportedFeatures containsObject:&unk_286627898];

  if (uUIDString2)
  {
    mEMORY[0x277D0F8D0] = [MEMORY[0x277D0F8D0] sharedPreferences];
    v23 = [mEMORY[0x277D0F8D0] preferenceForKey:@"homeHH2MigrationConfigurationVersionIncrement"];
    numberValue = [v23 numberValue];

    if (numberValue)
    {
      v25 = numberValue;
    }

    else
    {
      v25 = &unk_2866278B0;
    }

    configurationVersion += [v25 intValue];
  }

  v26 = [MEMORY[0x277CCABB0] numberWithInteger:configurationVersion];
  [coderCopy encodeObject:v26 forKey:@"homeConfigVersion"];

  name = [(HMDHome *)self name];
  [coderCopy encodeObject:name forKey:@"homeName"];

  homeHubState = [(HMDHome *)self homeHubState];
  [coderCopy encodeInteger:homeHubState forKey:*MEMORY[0x277CCFFE8]];
  isMultiUserEnabled = [(HMDHome *)self isMultiUserEnabled];
  [coderCopy encodeBool:isMultiUserEnabled forKey:*MEMORY[0x277CD0450]];
  if (isFeatureHomeTheaterQFAEnabledForTests)
  {
    bOOLValue = [isFeatureHomeTheaterQFAEnabledForTests BOOLValue];
  }

  else
  {
    bOOLValue = 0;
  }

  [coderCopy encodeBool:bOOLValue forKey:*MEMORY[0x277CD0618]];
  soundCheckEnabled = [(HMDHome *)self soundCheckEnabled];
  [coderCopy encodeBool:soundCheckEnabled forKey:*MEMORY[0x277CD05F0]];
  v32 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome siriPhraseOptions](self, "siriPhraseOptions")}];
  [coderCopy encodeObject:v32 forKey:*MEMORY[0x277CD05E0]];

  locationServicesEnabled = [(HMDHome *)self locationServicesEnabled];
  [coderCopy encodeBool:locationServicesEnabled forKey:*MEMORY[0x277CD0050]];
  didOnboardLocationServices = [(HMDHome *)self didOnboardLocationServices];
  [coderCopy encodeBool:didOnboardLocationServices forKey:*MEMORY[0x277CCFEB0]];
  hasAnyUserAcknowledgedCameraRecordingOnboarding = [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  [coderCopy encodeBool:hasAnyUserAcknowledgedCameraRecordingOnboarding forKey:*MEMORY[0x277CCFFD0]];
  hasOnboardedForAccessCode = [(HMDHome *)self hasOnboardedForAccessCode];
  [coderCopy encodeBool:hasOnboardedForAccessCode forKey:*MEMORY[0x277CCFFD8]];
  hasOnboardedForWalletKey = [(HMDHome *)self hasOnboardedForWalletKey];
  [coderCopy encodeBool:hasOnboardedForWalletKey forKey:*MEMORY[0x277CCFFE0]];
  hmd_supportedFeatures2 = [coderCopy hmd_supportedFeatures];
  v39 = [hmd_supportedFeatures2 containsObject:&unk_286627898];

  v40 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v42 = HMFGetOSLogHandle();
  v43 = os_log_type_enabled(v42, OS_LOG_TYPE_INFO);
  if (v39)
  {
    if (v43)
    {
      v44 = HMFGetLogIdentifier();
      *buf = 138543362;
      v298 = v44;
      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Forcing isUpdatedToHH2 to YES", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v40);
    isUpdatedToHH2 = 1;
  }

  else
  {
    if (v43)
    {
      v46 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy2 isUpdatedToHH2];
      v47 = HMFBooleanToString();
      *buf = 138543618;
      v298 = v46;
      v299 = 2112;
      v300 = v47;
      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@isUpdatedToHH2 is set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v40);
    isUpdatedToHH2 = [(HMDHome *)selfCopy2 isUpdatedToHH2];
  }

  [coderCopy encodeBool:isUpdatedToHH2 forKey:*MEMORY[0x277CD0698]];
  if ([coderCopy hmd_isForXPCTransportEntitledForSPIAccess])
  {
    bulletinNotificationsSupported = [(HMDHome *)selfCopy2 bulletinNotificationsSupported];
    [coderCopy encodeBool:bulletinNotificationsSupported forKey:*MEMORY[0x277CCFE90]];
  }

  if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    if ((hmd_isForXPCTransport & hmd_isForXPCTransportEntitledForSPIAccess) != 1)
    {
      homeLocationHandler = [(HMDHome *)selfCopy2 homeLocationHandler];
      v56 = &kHomeLocationHandlerCodingKey;
      goto LABEL_30;
    }

    if ([coderCopy hmd_isForXPCTransportAuthorizedForLocationAccess])
    {
      homeLocationHandler2 = [(HMDHome *)selfCopy2 homeLocationHandler];
      location = [homeLocationHandler2 location];
      [coderCopy encodeObject:location forKey:@"homeLocation"];

      if ([coderCopy hmd_isForXPCTransportEntitledForHomeLocationAccess])
      {
        homeLocation = [(HMDHome *)selfCopy2 homeLocation];
        [coderCopy encodeInteger:homeLocation forKey:*MEMORY[0x277CD0060]];
      }
    }

    primaryResident = [(HMDHome *)selfCopy2 primaryResident];
    capabilities = [primaryResident capabilities];
    supportsSiriEndpointSetup = [capabilities supportsSiriEndpointSetup];

    if (supportsSiriEndpointSetup)
    {
      homeLocationHandler = [objc_alloc(MEMORY[0x277D0F940]) initWithMajorVersion:7 minorVersion:2 updateVersion:2];
      v56 = MEMORY[0x277CD05D8];
LABEL_30:
      [coderCopy encodeObject:homeLocationHandler forKey:*v56];
    }
  }

  if (v246)
  {
    v57 = [MEMORY[0x277CCABB0] numberWithInteger:{-[HMDHome lastSyncedConfigurationVersion](selfCopy2, "lastSyncedConfigurationVersion")}];
    [coderCopy encodeObject:v57 forKey:@"lastSyncedHomeConfigVersion"];

    reachabilityNotificationManager = [(HMDHome *)selfCopy2 reachabilityNotificationManager];
    reachabilityContext = [reachabilityNotificationManager reachabilityContext];
    [coderCopy encodeObject:reachabilityContext forKey:@"HMHH.residentReachabilityContext"];
  }

  v60 = hmd_homeManagerOptions;
  v250 = selfCopy2;
  if ((hmd_homeManagerOptions & 9) != 0)
  {
    v241 = hmd_isForXPCTransport;
    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v292 = 0u;
    v293 = 0u;
    v294 = 0u;
    v295 = 0u;
    _residentUsers = [(HMDHome *)selfCopy2 _residentUsers];
    v62 = [_residentUsers countByEnumeratingWithState:&v292 objects:v313 count:16];
    if (v62)
    {
      v63 = v62;
      v64 = *v293;
      do
      {
        for (i = 0; i != v63; ++i)
        {
          if (*v293 != v64)
          {
            objc_enumerationMutation(_residentUsers);
          }

          v66 = *(*(&v292 + 1) + 8 * i);
          userID = [v66 userID];
          v68 = [HMDDevice deviceWithDestination:userID];

          if (v68)
          {
            [strongToStrongObjectsMapTable setObject:v66 forKey:v68];
          }
        }

        v63 = [_residentUsers countByEnumeratingWithState:&v292 objects:v313 count:16];
      }

      while (v63);
    }

    v290 = 0u;
    v291 = 0u;
    v288 = 0u;
    v289 = 0u;
    residentDeviceManager = [(HMDHome *)selfCopy2 residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    v71 = [residentDevices countByEnumeratingWithState:&v288 objects:v312 count:16];
    if (v71)
    {
      v72 = v71;
      v73 = *v289;
      do
      {
        for (j = 0; j != v72; ++j)
        {
          if (*v289 != v73)
          {
            objc_enumerationMutation(residentDevices);
          }

          v75 = *(*(&v288 + 1) + 8 * j);
          device = [v75 device];
          capabilities2 = [device capabilities];
          isRemoteGatewayCapable = [capabilities2 isRemoteGatewayCapable];

          if (isRemoteGatewayCapable)
          {
            v79 = [(HMDHome *)selfCopy2 _residentUserForResidentDevice:v75];
            if (v79)
            {
              device2 = [v75 device];
              [strongToStrongObjectsMapTable setObject:v79 forKey:device2];
            }
          }
        }

        v72 = [residentDevices countByEnumeratingWithState:&v288 objects:v312 count:16];
      }

      while (v72);
    }

    objectEnumerator = [strongToStrongObjectsMapTable objectEnumerator];
    allObjects = [objectEnumerator allObjects];

    hmd_isForXPCTransport = v241;
    if (!v241 || !(hmd_isForXPCTransportEntitledForSPIAccess & 1 | !isAppleTV()))
    {
      v60 = hmd_homeManagerOptions;
      if ((v246 | hmd_isForRemoteTransportOnSameAccount))
      {
        v105 = MEMORY[0x277CBEB18];
        users = [(HMDHome *)selfCopy2 users];
        array = [v105 arrayWithArray:users];

        if ([coderCopy hmd_isForRemoteTransportOnSameAccount])
        {
          hmd_supportedFeatures3 = [coderCopy hmd_supportedFeatures];
          v109 = [hmd_supportedFeatures3 containsObject:&unk_2866278C8];

          if ((v109 & 1) == 0)
          {
            v278 = 0u;
            v279 = 0u;
            v276 = 0u;
            v277 = 0u;
            users2 = [(HMDHome *)selfCopy2 users];
            v111 = [users2 copy];

            v112 = [v111 countByEnumeratingWithState:&v276 objects:v309 count:16];
            if (v112)
            {
              v113 = v112;
              v114 = *v277;
              do
              {
                for (k = 0; k != v113; ++k)
                {
                  if (*v277 != v114)
                  {
                    objc_enumerationMutation(v111);
                  }

                  v116 = *(*(&v276 + 1) + 8 * k);
                  if ([v116 requiresMakoSupport])
                  {
                    [array removeObject:v116];
                  }
                }

                v113 = [v111 countByEnumeratingWithState:&v276 objects:v309 count:16];
              }

              while (v113);
            }
          }
        }

        v117 = [allObjects mutableCopy];
        [array removeObjectsInArray:allObjects];
        if (([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
        {
          usersPendingUserManagementOperations = [(HMDHome *)selfCopy2 usersPendingUserManagementOperations];
          [array removeObjectsInArray:usersPendingUserManagementOperations];

          usersPendingUserManagementOperations2 = [(HMDHome *)selfCopy2 usersPendingUserManagementOperations];
          [v117 removeObjectsInArray:usersPendingUserManagementOperations2];
        }

        v274 = 0u;
        v275 = 0u;
        v272 = 0u;
        v273 = 0u;
        users6 = v117;
        v121 = [users6 countByEnumeratingWithState:&v272 objects:v308 count:16];
        if (v121)
        {
          v122 = v121;
          v123 = *v273;
          do
          {
            for (m = 0; m != v122; ++m)
            {
              if (*v273 != v123)
              {
                objc_enumerationMutation(users6);
              }

              legacyUser = [*(*(&v272 + 1) + 8 * m) legacyUser];
              [array addObject:legacyUser];
            }

            v122 = [users6 countByEnumeratingWithState:&v272 objects:v308 count:16];
          }

          while (v122);
        }

        v126 = [array copy];
        [coderCopy encodeObject:v126 forKey:@"users"];

        v127 = [users6 copy];
        [coderCopy encodeObject:v127 forKey:@"residentDevices"];
      }

      else
      {
        if (![coderCopy hmd_isForRemoteTransport])
        {
LABEL_152:

          goto LABEL_153;
        }

        array = [MEMORY[0x277CBEB18] array];
        owner2 = [(HMDHome *)selfCopy2 owner];

        if (owner2)
        {
          owner3 = [(HMDHome *)selfCopy2 owner];
          [array addObject:owner3];

          hmd_user = [coderCopy hmd_user];

          if (hmd_user)
          {
            hmd_user2 = [coderCopy hmd_user];
            [array addObject:hmd_user2];
          }
        }

        v270 = 0u;
        v271 = 0u;
        v268 = 0u;
        v269 = 0u;
        v132 = allObjects;
        v133 = [v132 countByEnumeratingWithState:&v268 objects:v307 count:16];
        if (v133)
        {
          v134 = v133;
          v135 = *v269;
          do
          {
            for (n = 0; n != v134; ++n)
            {
              if (*v269 != v135)
              {
                objc_enumerationMutation(v132);
              }

              legacyUser2 = [*(*(&v268 + 1) + 8 * n) legacyUser];
              [array addObject:legacyUser2];
            }

            v134 = [v132 countByEnumeratingWithState:&v268 objects:v307 count:16];
          }

          while (v134);
        }

        v138 = [array copy];
        [coderCopy encodeObject:v138 forKey:@"users"];

        [coderCopy encodeObject:v132 forKey:@"residentDevices"];
        v252 = array;
        if ([coderCopy hmd_isForRemoteUserAdministrator])
        {
          v139 = MEMORY[0x277CBEB18];
          users3 = [(HMDHome *)selfCopy2 users];
          v141 = [v139 arrayWithCapacity:{objc_msgSend(users3, "count")}];

          v266 = 0u;
          v267 = 0u;
          v264 = 0u;
          v265 = 0u;
          users4 = [(HMDHome *)selfCopy2 users];
          v143 = [users4 countByEnumeratingWithState:&v264 objects:v306 count:16];
          if (v143)
          {
            v144 = v143;
            v145 = *v265;
            do
            {
              for (ii = 0; ii != v144; ++ii)
              {
                if (*v265 != v145)
                {
                  objc_enumerationMutation(users4);
                }

                v147 = *(*(&v264 + 1) + 8 * ii);
                if (([v147 isRemoteGateway] & 1) == 0 && (objc_msgSend(v147, "privilege") == 4 || !objc_msgSend(v147, "privilege")))
                {
                  if (![v147 requiresMakoSupport] || (objc_msgSend(coderCopy, "hmd_supportedFeatures"), v148 = objc_claimAutoreleasedReturnValue(), v149 = objc_msgSend(v148, "containsObject:", &unk_2866278C8), v148, v149))
                  {
                    [v141 addObject:v147];
                  }
                }
              }

              v144 = [users4 countByEnumeratingWithState:&v264 objects:v306 count:16];
            }

            while (v144);
          }

          v150 = [v141 copy];
          [coderCopy encodeObject:v150 forKey:@"HM.sharedUsers"];

          hmd_isForXPCTransport = v241;
          selfCopy2 = v250;
          array = v252;
        }

        v151 = objc_autoreleasePoolPush();
        v152 = selfCopy2;
        v153 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v153, OS_LOG_TYPE_INFO))
        {
          v154 = HMFGetLogIdentifier();
          users5 = [(HMDHome *)v152 users];
          hmd_user3 = [coderCopy hmd_user];
          *buf = 138543874;
          v298 = v154;
          v299 = 2112;
          v300 = users5;
          v301 = 2112;
          v302 = hmd_user3;
          _os_log_impl(&dword_2531F8000, v153, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v151);
        v262 = 0u;
        v263 = 0u;
        v260 = 0u;
        v261 = 0u;
        users6 = [(HMDHome *)v152 users];
        v254 = [users6 countByEnumeratingWithState:&v260 objects:v305 count:16];
        if (v254)
        {
          v157 = *v261;
          v247 = users6;
          v249 = *v261;
          do
          {
            for (jj = 0; jj != v254; ++jj)
            {
              if (*v261 != v157)
              {
                objc_enumerationMutation(users6);
              }

              v159 = *(*(&v260 + 1) + 8 * jj);
              hmd_user4 = [coderCopy hmd_user];
              v161 = [v159 isEqual:hmd_user4];

              if (v161)
              {
                v162 = objc_autoreleasePoolPush();
                v163 = v152;
                v164 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v164, OS_LOG_TYPE_INFO))
                {
                  HMFGetLogIdentifier();
                  v165 = v248 = v162;
                  users7 = [(HMDHome *)v163 users];
                  [coderCopy hmd_user];
                  v167 = v152;
                  v169 = v168 = coderCopy;
                  presenceAuthStatus = [v159 presenceAuthStatus];
                  *buf = 138544130;
                  v298 = v165;
                  v299 = 2112;
                  v300 = users7;
                  v301 = 2112;
                  v302 = v169;
                  v303 = 2112;
                  v304 = presenceAuthStatus;
                  _os_log_impl(&dword_2531F8000, v164, OS_LOG_TYPE_INFO, "%{public}@encode users: %@, coder username: %@, %@", buf, 0x2Au);

                  array = v252;
                  coderCopy = v168;
                  v152 = v167;

                  users6 = v247;
                  v162 = v248;
                }

                objc_autoreleasePoolPop(v162);
                presenceAuthStatus2 = [v159 presenceAuthStatus];
                [presenceAuthStatus2 addToCoder:coderCopy];

                v157 = v249;
                selfCopy2 = v250;
              }
            }

            v254 = [users6 countByEnumeratingWithState:&v260 objects:v305 count:16];
          }

          while (v254);
          hmd_isForXPCTransport = v241;
        }
      }

      v60 = hmd_homeManagerOptions;
      goto LABEL_150;
    }

    array2 = [MEMORY[0x277CBEB18] array];
    if (hmd_isForXPCTransportEntitledForSPIAccess)
    {
      v253 = coderCopy;
      owner4 = [(HMDHome *)selfCopy2 owner];
      isOwnerUser = [(HMDHome *)selfCopy2 isOwnerUser];
      v284 = 0u;
      v285 = 0u;
      v286 = 0u;
      v287 = 0u;
      users8 = [(HMDHome *)selfCopy2 users];
      v85 = [users8 countByEnumeratingWithState:&v284 objects:v311 count:16];
      if (v85)
      {
        v86 = v85;
        v87 = *v285;
        do
        {
          for (kk = 0; kk != v86; ++kk)
          {
            if (*v285 != v87)
            {
              objc_enumerationMutation(users8);
            }

            v89 = *(*(&v284 + 1) + 8 * kk);
            if (!isOwnerUser || ([*(*(&v284 + 1) + 8 * kk) isEqual:owner4] & 1) == 0)
            {
              userID2 = [v89 userID];
              if (!userID2)
              {
                continue;
              }

              v91 = userID2;
              isRemoteGateway = [v89 isRemoteGateway];

              if (isRemoteGateway)
              {
                continue;
              }
            }

            [array2 addObject:v89];
          }

          v86 = [users8 countByEnumeratingWithState:&v284 objects:v311 count:16];
        }

        while (v86);
      }

      selfCopy2 = v250;
      coderCopy = v253;
      hmd_isForXPCTransport = v241;
      v60 = hmd_homeManagerOptions;
      if (![(HMDHome *)v250 isAdminUser])
      {
        goto LABEL_146;
      }

      v93 = MEMORY[0x277CBEB18];
      outgoingInvitations = [(HMDHome *)v250 outgoingInvitations];
      v95 = [v93 arrayWithCapacity:{objc_msgSend(outgoingInvitations, "count")}];

      v282 = 0u;
      v283 = 0u;
      v280 = 0u;
      v281 = 0u;
      outgoingInvitations2 = [(HMDHome *)v250 outgoingInvitations];
      v97 = [outgoingInvitations2 countByEnumeratingWithState:&v280 objects:v310 count:16];
      if (v97)
      {
        v98 = v97;
        v99 = *v281;
        do
        {
          for (mm = 0; mm != v98; ++mm)
          {
            if (*v281 != v99)
            {
              objc_enumerationMutation(outgoingInvitations2);
            }

            v101 = *(*(&v280 + 1) + 8 * mm);
            user = [v101 user];
            isRemoteGateway2 = [user isRemoteGateway];

            if ((isRemoteGateway2 & 1) == 0)
            {
              [v95 addObject:v101];
            }
          }

          v98 = [outgoingInvitations2 countByEnumeratingWithState:&v280 objects:v310 count:16];
        }

        while (v98);
      }

      v104 = [v95 copy];
      [v253 encodeObject:v104 forKey:@"HM.invitations"];

      hmd_isForXPCTransport = v241;
    }

    else
    {
      [(HMDHome *)selfCopy2 isAdminUser];
    }

    v60 = hmd_homeManagerOptions;
LABEL_146:
    array = array2;
    v172 = [array2 copy];
    [coderCopy encodeObject:v172 forKey:@"users"];

    [coderCopy encodeBool:-[HMDHome isAdminUser](selfCopy2 forKey:{"isAdminUser"), @"isAdminUser"}];
    [coderCopy encodeBool:-[HMDHome isOwnerUser](selfCopy2 forKey:{"isOwnerUser"), @"HM.isOwnerUser"}];
    isAccessToHomeAllowed = [(HMDHome *)selfCopy2 isAccessToHomeAllowed];
    [coderCopy encodeBool:isAccessToHomeAllowed forKey:*MEMORY[0x277CD0018]];
    if ((isAccessToHomeAllowed & 1) == 0)
    {
      accessNotAllowedReasonCode = [(HMDHome *)selfCopy2 accessNotAllowedReasonCode];
      [coderCopy encodeInteger:accessNotAllowedReasonCode forKey:*MEMORY[0x277CCFD90]];
    }

    overriddenHomeAccessControl = [(HMDHome *)selfCopy2 overriddenHomeAccessControl];

    if (!overriddenHomeAccessControl)
    {
      goto LABEL_151;
    }

    users6 = [(HMDHome *)selfCopy2 overriddenHomeAccessControl];
    unsignedIntegerValue = [users6 unsignedIntegerValue];
    [coderCopy encodeInteger:unsignedIntegerValue forKey:*MEMORY[0x277CCFD88]];
LABEL_150:

LABEL_151:
    goto LABEL_152;
  }

LABEL_153:
  if ((v60 & 0x9FD1) != 0)
  {
    [(HMDHome *)selfCopy2 _encodeObjectsWithAccessoriesWithCoder:coderCopy];
  }

  roomForEntireHome = [(HMDHome *)selfCopy2 roomForEntireHome];
  [coderCopy encodeObject:roomForEntireHome forKey:@"roomForEntireHome"];

  if ((v60 & 5) != 0 && ([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
  {
    rooms = [(HMDHome *)selfCopy2 rooms];
    [coderCopy encodeObject:rooms forKey:@"rooms"];

    zones = [(HMDHome *)selfCopy2 zones];
    [coderCopy encodeObject:zones forKey:@"zones"];
  }

  if ((v60 & 0x801) != 0)
  {
    if (hmd_isForXPCTransport)
    {
      if (!hmd_isForXPCTransportEntitledForSPIAccess)
      {
        goto LABEL_164;
      }

      residentDeviceManager2 = [(HMDHome *)selfCopy2 residentDeviceManager];
      residentDevices2 = [residentDeviceManager2 residentDevices];

      v182 = @"residentDevices";
    }

    else
    {
      residentDeviceManager3 = [(HMDHome *)selfCopy2 residentDeviceManager];
      [coderCopy encodeObject:residentDeviceManager3 forKey:@"HM.residentDeviceManager"];

      enabledResidents = [(HMDHome *)selfCopy2 enabledResidents];
      v185 = [enabledResidents na_filter:&__block_literal_global_1782];

      [coderCopy encodeInteger:objc_msgSend(v185 forKey:{"count"), @"HMD.nonIPadResidentDeviceCount"}];
      residentDevices2 = [(HMDHome *)selfCopy2 primaryNetworkRouterManagingDeviceUUID];
      v182 = @"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey";
    }

    [coderCopy encodeObject:residentDevices2 forKey:v182];
  }

LABEL_164:
  if ((v60 & 0x85D1) != 0 && (![coderCopy hmd_isForXPCTransport] || objc_msgSend(coderCopy, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    minimumMediaUserPrivilege = [(HMDHome *)selfCopy2 minimumMediaUserPrivilege];
    [coderCopy encodeInteger:minimumMediaUserPrivilege forKey:*MEMORY[0x277CD03F8]];
    isMediaPeerToPeerEnabled = [(HMDHome *)selfCopy2 isMediaPeerToPeerEnabled];
    [coderCopy encodeBool:isMediaPeerToPeerEnabled forKey:*MEMORY[0x277CD0410]];
    if (([coderCopy hmd_isForNonAdminSharedUser] & 1) == 0)
    {
      mediaPassword = [(HMDHome *)selfCopy2 mediaPassword];
      [coderCopy encodeObject:mediaPassword forKey:*MEMORY[0x277CD0400]];
    }
  }

  if ((v60 & 0x11) != 0 && (![coderCopy hmd_isForXPCTransport] || objc_msgSend(coderCopy, "hmd_isForXPCTransportEntitledForSPIAccess")))
  {
    isAutomaticSoftwareUpdateEnabled = [(HMDHome *)selfCopy2 isAutomaticSoftwareUpdateEnabled];
    [coderCopy encodeBool:isAutomaticSoftwareUpdateEnabled forKey:*MEMORY[0x277CCFE80]];
    isAutomaticThirdPartyAccessorySoftwareUpdateEnabled = [(HMDHome *)selfCopy2 isAutomaticThirdPartyAccessorySoftwareUpdateEnabled];
    [coderCopy encodeBool:isAutomaticThirdPartyAccessorySoftwareUpdateEnabled forKey:*MEMORY[0x277CCFE88]];
  }

  matterFabricID = [(HMDHome *)selfCopy2 matterFabricID];
  [coderCopy encodeObject:matterFabricID forKey:@"HM.matterFabricID"];

  if (v60)
  {
    if (v246)
    {
      presenceMonitor = [(HMDHome *)selfCopy2 presenceMonitor];
      [coderCopy encodeObject:presenceMonitor forKey:@"kHMDHomePresenceMonitorCodingKey"];

      unfilteredThreadNetworkID = [(HMDHome *)selfCopy2 unfilteredThreadNetworkID];
      [coderCopy encodeObject:unfilteredThreadNetworkID forKey:@"HMHM.threadNetworkID"];
    }

    if ([coderCopy hmd_isForRemoteGatewayCoder])
    {
      if (!hmd_isForXPCTransport)
      {
        goto LABEL_184;
      }
    }

    else
    {
      if ((hmd_isForXPCTransport & 1) == 0)
      {
        v197 = [MEMORY[0x277CCABB0] numberWithBool:{-[HMDHome allowsRemoteAccess](selfCopy2, "allowsRemoteAccess")}];
        [coderCopy encodeObject:v197 forKey:@"HM.allowsRemoteAccess"];

        networkProtectionGroupRegistry = [(HMDHome *)selfCopy2 networkProtectionGroupRegistry];
        persistedGroups = [networkProtectionGroupRegistry persistedGroups];
        [coderCopy encodeObject:persistedGroups forKey:*MEMORY[0x277CCFDB0]];

LABEL_184:
        appData = [(HMDHome *)selfCopy2 appData];
        [coderCopy encodeObject:appData forKey:@"HM.appDataRepository"];
LABEL_185:

        if (v246)
        {
          removedUsers = [(HMDHome *)selfCopy2 removedUsers];
          [coderCopy encodeObject:removedUsers forKey:@"HM.removedUsersCodingKey"];
        }

        else if (!hmd_isForRemoteTransportOnSameAccount)
        {
          goto LABEL_189;
        }

        presenceAuthStatus3 = [(HMDHome *)selfCopy2 presenceAuthStatus];
        [presenceAuthStatus3 addToCoder:coderCopy];

        presenceComputeStatus = [(HMDHome *)selfCopy2 presenceComputeStatus];
        [presenceComputeStatus addToCoder:coderCopy];

LABEL_189:
        if ((v246 | hmd_isForRemoteTransportOnSameAccount))
        {
          if (!isWatch() && ([coderCopy hmd_isForRemoteTransportOnSameAccount] & 1) == 0)
          {
            notificationRegistry = [(HMDHome *)selfCopy2 notificationRegistry];
            [coderCopy encodeObject:notificationRegistry forKey:@"characteristicNotificationRegistryCodingKey"];
          }

          if (!isWatch() && ([coderCopy hmd_isForRemoteGatewayCoder] & 1) == 0)
          {
            v204 = MEMORY[0x277CBEB18];
            outgoingInvitations3 = [(HMDHome *)selfCopy2 outgoingInvitations];
            v206 = [v204 arrayWithArray:outgoingInvitations3];

            if ([coderCopy hmd_isForRemoteTransportOnSameAccount])
            {
              hmd_supportedFeatures4 = [coderCopy hmd_supportedFeatures];
              v208 = [hmd_supportedFeatures4 containsObject:&unk_2866278C8];

              if ((v208 & 1) == 0)
              {
                v209 = selfCopy2;
                v210 = hmd_isForXPCTransport;
                v258 = 0u;
                v259 = 0u;
                v256 = 0u;
                v257 = 0u;
                outgoingInvitations4 = [(HMDHome *)v209 outgoingInvitations];
                v212 = [outgoingInvitations4 countByEnumeratingWithState:&v256 objects:v296 count:16];
                if (v212)
                {
                  v213 = v212;
                  v214 = *v257;
                  do
                  {
                    for (nn = 0; nn != v213; ++nn)
                    {
                      if (*v257 != v214)
                      {
                        objc_enumerationMutation(outgoingInvitations4);
                      }

                      v216 = *(*(&v256 + 1) + 8 * nn);
                      user2 = [v216 user];
                      if ([user2 requiresMakoSupport])
                      {
                        [v206 removeObject:v216];
                      }
                    }

                    v213 = [outgoingInvitations4 countByEnumeratingWithState:&v256 objects:v296 count:16];
                  }

                  while (v213);
                }

                hmd_isForXPCTransport = v210;
                selfCopy2 = v250;
              }
            }

            v218 = [v206 copy];
            [coderCopy encodeObject:v218 forKey:@"HM.invitations"];
          }
        }

        if (![coderCopy hmd_isForXPCTransport] || objc_msgSend(coderCopy, "hmd_isForXPCTransportEntitledForSPIAccess"))
        {
          protectionMode = [(HMDHome *)selfCopy2 protectionMode];
          [coderCopy encodeInteger:protectionMode forKey:*MEMORY[0x277CD0458]];
        }

        if ([coderCopy hmd_isForXPCTransport])
        {
          if ([coderCopy hmd_isForXPCTransportEntitledForSPIAccess])
          {
            networkRouterSupportDisableReason = [(HMDHome *)selfCopy2 networkRouterSupportDisableReason];
            [coderCopy encodeInteger:networkRouterSupportDisableReason forKey:*MEMORY[0x277CD0460]];
          }

          networkRouterSupport = [(HMDHome *)selfCopy2 networkRouterSupport];
          [coderCopy encodeBool:(networkRouterSupport >> 2) & 1 forKey:*MEMORY[0x277CCFE10]];
        }

        threadNetworkID = [(HMDHome *)selfCopy2 threadNetworkID];
        if (threadNetworkID && [coderCopy hmd_isForXPCTransport])
        {
          hmd_isForXPCTransportEntitledForSPIAccess2 = [coderCopy hmd_isForXPCTransportEntitledForSPIAccess];

          if (!hmd_isForXPCTransportEntitledForSPIAccess2)
          {
            goto LABEL_220;
          }

          threadNetworkID = [(HMDHome *)selfCopy2 threadNetworkID];
          [coderCopy encodeObject:threadNetworkID forKey:*MEMORY[0x277CD0628]];
        }

LABEL_220:
        if (([coderCopy hmd_isForXPCTransport] & 1) == 0)
        {
          activeNetworkRouterUUID = [(HMDHome *)selfCopy2 activeNetworkRouterUUID];
          uUIDString3 = [activeNetworkRouterUUID UUIDString];
          [coderCopy encodeObject:uUIDString3 forKey:@"HMHM.activeNetworkRouter"];

          minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)selfCopy2 minimumNetworkRouterSupportHomeKitVersion];
          versionString = [minimumNetworkRouterSupportHomeKitVersion versionString];
          [coderCopy encodeObject:versionString forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];

          minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHome *)selfCopy2 minHomeKitVersionForAccessoryNetworkProtectionChange];
          versionString2 = [minHomeKitVersionForAccessoryNetworkProtectionChange versionString];
          [coderCopy encodeObject:versionString2 forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];
        }

        if (hmd_isForXPCTransport)
        {
          if (![coderCopy hmd_isForXPCTransportEntitledForSPIAccess])
          {
LABEL_230:
            if ((v246 | hmd_isForRemoteTransportOnSameAccount))
            {
              chipStorage = [(HMDHome *)selfCopy2 chipStorage];
              [coderCopy encodeObject:chipStorage forKey:@"HMHM.chipStorage"];
            }

            if (!-[HMDHome isOwnerUser](selfCopy2, "isOwnerUser") && (([coderCopy hmd_isForLocalStore] & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteTransportOnSameAccount")))
            {
              sharedHomeSourceVersion = [(HMDHome *)selfCopy2 sharedHomeSourceVersion];
              [coderCopy encodeObject:sharedHomeSourceVersion forKey:@"kHomeKitVersionStringKey"];
            }

            goto LABEL_236;
          }

          personManagerSettings = [(HMDHome *)selfCopy2 personManagerSettings];
          [coderCopy encodeObject:personManagerSettings forKey:*MEMORY[0x277CD04A0]];

          personManagerZoneUUID = [(HMDHome *)selfCopy2 personManagerZoneUUID];
          v232 = *MEMORY[0x277CD04B8];
        }

        else
        {
          personManagerSettings2 = [(HMDHome *)selfCopy2 personManagerSettings];
          [coderCopy encodeObject:personManagerSettings2 forKey:*MEMORY[0x277CD04A0]];

          personManagerZoneUUID2 = [(HMDHome *)selfCopy2 personManagerZoneUUID];
          [coderCopy encodeObject:personManagerZoneUUID2 forKey:*MEMORY[0x277CD04B8]];

          naturalLightingContext = [(HMDHome *)selfCopy2 naturalLightingContext];
          [coderCopy encodeObject:naturalLightingContext forKey:@"HM.nlcck"];

          if (([coderCopy hmd_isForLocalStore] & 1) != 0 || objc_msgSend(coderCopy, "hmd_isForRemoteUserAdministrator"))
          {
            labelsByAccessCode = [(HMDHome *)selfCopy2 labelsByAccessCode];
            [coderCopy encodeObject:labelsByAccessCode forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];

            removedUserInfoByAccessCode = [(HMDHome *)selfCopy2 removedUserInfoByAccessCode];
            [coderCopy encodeObject:removedUserInfoByAccessCode forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];
          }

          personManagerZoneUUID = [(HMDHome *)selfCopy2 nfcReaderKey];
          v232 = @"HMDHomeNFCReaderKeyCodingKey";
        }

        [coderCopy encodeObject:personManagerZoneUUID forKey:v232];

        goto LABEL_230;
      }

      if (hmd_isForXPCTransportEntitledForSPIAccess)
      {
        networkProtectionGroupRegistry2 = [(HMDHome *)selfCopy2 networkProtectionGroupRegistry];
        activeGroups = [networkProtectionGroupRegistry2 activeGroups];
        [coderCopy encodeObject:activeGroups forKey:*MEMORY[0x277CCFDB0]];
      }
    }

    appData = [(HMDHome *)selfCopy2 appData];
    [appData encodeForXPCTransportWithCoder:coderCopy key:@"HM.appData"];
    goto LABEL_185;
  }

LABEL_236:

  v240 = *MEMORY[0x277D85DE8];
}

BOOL __28__HMDHome__encodeWithCoder___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 device];
  v3 = [v2 productInfo];
  v4 = [v3 productClass] != 3;

  return v4;
}

- (void)encodeWithCoder:(id)coder
{
  coderCopy = coder;
  v4 = objc_autoreleasePoolPush();
  [(HMDHome *)self _encodeWithCoder:coderCopy];
  objc_autoreleasePoolPop(v4);
}

- (id)_initWithCoder:(id)coder
{
  v372[2] = *MEMORY[0x277D85DE8];
  coderCopy = coder;
  v5 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"homeName"];
  v6 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"homeUUID"];
  v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v6];
  v8 = objc_alloc_init(HMDHomeDefaultDataSource);
  v312 = v7;
  v9 = [(HMDHome *)self initWithName:v5 uuid:v7 defaultRoomUUID:0 owner:0 homeManager:0 presenceAuth:0 dataSource:v8];

  if (!v9)
  {
    goto LABEL_213;
  }

  v309 = v6;
  v310 = v5;
  v10 = [HMDHome zoneIDFromHomeUUID:v9->_uuid];
  zoneID = v9->_zoneID;
  v9->_zoneID = v10;

  v316 = v9;
  v12 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"creationDate"];
  creationDate = v9->_creationDate;
  v9->_creationDate = v12;

  v14 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"firstHAPAccessoryAddedDate"];
  firstHAPAccessoryAddedDate = v9->_firstHAPAccessoryAddedDate;
  v9->_firstHAPAccessoryAddedDate = v14;

  v16 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"homeAdmin"];
  ownerName = v9->_ownerName;
  v9->_ownerName = v16;

  v18 = [HMDHomeManager isThisDeviceAdminOfHome:v9];
  v9->_ownerUser = v18;
  v313 = coderCopy;
  if (v18)
  {
    localCapabilitiesDataSource = [(HMDHome *)v9 localCapabilitiesDataSource];
    isResidentCapable = [localCapabilitiesDataSource isResidentCapable];

    v9 = v316;
    if (isResidentCapable)
    {
      v21 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:@"kHMDHomePresenceMonitorCodingKey"];
      makeHomePresenceMonitor = v21;
      if (!v21)
      {
        isResidentCapable = [(HMDHome *)v316 dataSource];
        makeHomePresenceMonitor = [isResidentCapable makeHomePresenceMonitor];
      }

      objc_storeStrong(&v316->_presenceMonitor, makeHomePresenceMonitor);
      if (!v21)
      {
      }

      v23 = objc_alloc_init(HMDHomePeriodicReader);
      periodicReader = v316->_periodicReader;
      v316->_periodicReader = v23;

      coderCopy = v313;
      v9 = v316;
    }
  }

  v25 = [[HMDHomeAdministratorHandler alloc] initWithHome:v9];
  administratorHandler = v9->_administratorHandler;
  v9->_administratorHandler = v25;

  if (v9->_ownerUser || isWatch())
  {
    sharedHomeUpdateHandler = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = 0;
  }

  else
  {
    v129 = objc_alloc_init(HMDSharedHomeUpdateHandler);
    v130 = v9->_sharedHomeUpdateHandler;
    v9->_sharedHomeUpdateHandler = v129;

    [(HMDSharedHomeUpdateHandler *)v9->_sharedHomeUpdateHandler configureWithHome:v9];
  }

  v28 = [coderCopy decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD2448]];
  mediaSystemController = v28;
  v30 = coderCopy;
  if (!v28)
  {
    mediaSystemController = v316->_mediaSystemController;
  }

  objc_storeStrong(&v316->_mediaSystemController, mediaSystemController);

  rooms = v316->_rooms;
  v32 = MEMORY[0x277CBEB98];
  v372[0] = objc_opt_class();
  v372[1] = objc_opt_class();
  v33 = [MEMORY[0x277CBEA60] arrayWithObjects:v372 count:2];
  v34 = [v32 setWithArray:v33];
  v35 = [v30 decodeObjectOfClasses:v34 forKey:@"rooms"];
  [(NSMutableArray *)rooms setArray:v35];

  zones = v316->_zones;
  v37 = MEMORY[0x277CBEB98];
  v371[0] = objc_opt_class();
  v371[1] = objc_opt_class();
  v38 = [MEMORY[0x277CBEA60] arrayWithObjects:v371 count:2];
  v39 = [v37 setWithArray:v38];
  v40 = [v30 decodeObjectOfClasses:v39 forKey:@"zones"];
  [(NSMutableArray *)zones setArray:v40];

  if ([v30 containsValueForKey:@"accessories"])
  {
    v41 = +[HMDHome supportedAccessoryClasses];
    v42 = [v30 decodeObjectOfClasses:v41 forKey:@"accessories"];
    [(HMDHome *)v316 _addAccessories:v42];
  }

  if ([v30 containsValueForKey:@"accessories.airplay"])
  {
    v43 = +[HMDHome supportedAccessoryClasses];
    v44 = [v30 decodeObjectOfClasses:v43 forKey:@"accessories.airplay"];
    [(HMDHome *)v316 _addAccessories:v44];
  }

  if ([v30 containsValueForKey:@"accessories.homepod"])
  {
    v45 = +[HMDHome supportedAccessoryClasses];
    v46 = [v30 decodeObjectOfClasses:v45 forKey:@"accessories.homepod"];
    [(HMDHome *)v316 _addAccessories:v46];
  }

  if ([v30 containsValueForKey:@"accessories.homepod_6_1"])
  {
    v47 = +[HMDHome supportedAccessoryClasses];
    v48 = [v30 decodeObjectOfClasses:v47 forKey:@"accessories.homepod_6_1"];
    [(HMDHome *)v316 _addAccessories:v48];
  }

  if ([v30 containsValueForKey:@"HM.AppleMediaAccessorySensor"])
  {
    v49 = +[HMDHome supportedAccessoryClasses];
    v50 = [v30 decodeObjectOfClasses:v49 forKey:@"HM.AppleMediaAccessorySensor"];
    [(HMDHome *)v316 _addAccessories:v50];
  }

  v51 = *MEMORY[0x277CD0450];
  if ([v30 containsValueForKey:*MEMORY[0x277CD0450]])
  {
    -[HMDHome setMultiUserEnabled:](v316, "setMultiUserEnabled:", [v30 decodeBoolForKey:v51]);
  }

  v316->_soundCheckEnabled = [v30 decodeBoolForKey:*MEMORY[0x277CD05F0]];
  v52 = [v30 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD05E0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v53 = v52;
  }

  else
  {
    v53 = 0;
  }

  v54 = v53;

  v316->_siriPhraseOptions = [v54 unsignedIntegerValue];
  v316->_locationServicesEnabled = [v30 decodeBoolForKey:*MEMORY[0x277CD0050]];
  v316->_didOnboardLocationServices = [v30 decodeBoolForKey:*MEMORY[0x277CCFEB0]];
  v55 = *MEMORY[0x277CCFFD0];
  if ([v30 containsValueForKey:*MEMORY[0x277CCFFD0]])
  {
    -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](v316, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [v30 decodeBoolForKey:v55]);
  }

  v56 = *MEMORY[0x277CCFFD8];
  if ([v30 containsValueForKey:*MEMORY[0x277CCFFD8]])
  {
    v316->_hasOnboardedForAccessCode = [v30 decodeBoolForKey:v56];
  }

  v57 = *MEMORY[0x277CCFFE0];
  if ([v30 containsValueForKey:*MEMORY[0x277CCFFE0]])
  {
    v316->_hasOnboardedForWalletKey = [v30 decodeBoolForKey:v57];
  }

  else
  {
    v316->_shouldEncodeHasOnboardedForWalletKey = 0;
  }

  serviceGroups = v316->_serviceGroups;
  v59 = MEMORY[0x277CBEB98];
  v370[0] = objc_opt_class();
  v370[1] = objc_opt_class();
  v60 = [MEMORY[0x277CBEA60] arrayWithObjects:v370 count:2];
  v61 = [v59 setWithArray:v60];
  v62 = [v30 decodeObjectOfClasses:v61 forKey:*MEMORY[0x277CD25E8]];
  [(NSMutableArray *)serviceGroups setArray:v62];

  v63 = MEMORY[0x277CBEB98];
  v369[0] = objc_opt_class();
  v369[1] = objc_opt_class();
  v64 = [MEMORY[0x277CBEA60] arrayWithObjects:v369 count:2];
  v65 = [v63 setWithArray:v64];

  actionSets = v316->_actionSets;
  v67 = [v30 decodeObjectOfClasses:v65 forKey:@"actionSets"];
  [(NSMutableArray *)actionSets setArray:v67];

  triggerOwnedActionSets = v316->_triggerOwnedActionSets;
  v69 = [v30 decodeObjectOfClasses:v65 forKey:@"HM.triggerOwnedActionSets"];
  [(NSMutableArray *)triggerOwnedActionSets setArray:v69];

  array = [MEMORY[0x277CBEB18] array];
  v308 = v65;
  v71 = [v30 decodeObjectOfClasses:v65 forKey:@"builtinActionSets"];
  [array setArray:v71];

  v307 = array;
  if ([array count])
  {
    [(NSMutableArray *)v316->_actionSets addObjectsFromArray:array];
  }

  else if ([(HMDHome *)v316 isOwnerUser])
  {
    v72 = objc_autoreleasePoolPush();
    v73 = v316;
    v74 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v74, OS_LOG_TYPE_INFO))
    {
      v75 = HMFGetLogIdentifier();
      v76 = [(NSMutableArray *)v316->_actionSets count];
      *buf = 138543618;
      v366 = v75;
      v367 = 2048;
      v368 = v76;
      _os_log_impl(&dword_2531F8000, v74, OS_LOG_TYPE_INFO, "%{public}@init: %ld user-defined actionSets; no builtin actionSets - creating....", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v72);
    v77 = v316->_actionSets;
    _createBuiltinActionSets = [(HMDHome *)v73 _createBuiltinActionSets];
    [(NSMutableArray *)v77 addObjectsFromArray:_createBuiltinActionSets];
  }

  removedUsers = v316->_removedUsers;
  v80 = MEMORY[0x277CBEB98];
  v364[0] = objc_opt_class();
  v364[1] = objc_opt_class();
  v81 = [MEMORY[0x277CBEA60] arrayWithObjects:v364 count:2];
  v82 = [v80 setWithArray:v81];
  v83 = v313;
  v84 = [v313 decodeObjectOfClasses:v82 forKey:@"HM.removedUsersCodingKey"];
  [(NSMutableArray *)removedUsers setArray:v84];

  v321 = [MEMORY[0x277CBEB58] set];
  v85 = [MEMORY[0x277CBEB58] set];
  if ([v313 containsValueForKey:@"residentDevices"])
  {
    v86 = MEMORY[0x277CBEB98];
    v363[0] = objc_opt_class();
    v363[1] = objc_opt_class();
    v87 = [MEMORY[0x277CBEA60] arrayWithObjects:v363 count:2];
    v88 = [v86 setWithArray:v87];
    v89 = [v313 decodeObjectOfClasses:v88 forKey:@"residentDevices"];
    [v321 addObjectsFromArray:v89];

    v83 = v313;
  }

  if ([v83 containsValueForKey:@"HM.sharedUsers"])
  {
    v90 = MEMORY[0x277CBEB98];
    v362[0] = objc_opt_class();
    v362[1] = objc_opt_class();
    v91 = [MEMORY[0x277CBEA60] arrayWithObjects:v362 count:2];
    v92 = [v90 setWithArray:v91];
    v93 = [v83 decodeObjectOfClasses:v92 forKey:@"HM.sharedUsers"];
    [v85 addObjectsFromArray:v93];
  }

  v94 = MEMORY[0x277CBEB98];
  v361[0] = objc_opt_class();
  v361[1] = objc_opt_class();
  v95 = [MEMORY[0x277CBEA60] arrayWithObjects:v361 count:2];
  v96 = [v94 setWithArray:v95];
  v97 = [v83 decodeObjectOfClasses:v96 forKey:@"users"];
  [v85 addObjectsFromArray:v97];

  v344 = 0u;
  v345 = 0u;
  v342 = 0u;
  v343 = 0u;
  obj = v85;
  v98 = [obj countByEnumeratingWithState:&v342 objects:v360 count:16];
  if (v98)
  {
    v99 = v98;
    v317 = *v343;
    do
    {
      for (i = 0; i != v99; ++i)
      {
        if (*v343 != v317)
        {
          objc_enumerationMutation(obj);
        }

        v101 = *(*(&v342 + 1) + 8 * i);
        v338 = 0u;
        v339 = 0u;
        v340 = 0u;
        v341 = 0u;
        v102 = v321;
        v103 = [v102 countByEnumeratingWithState:&v338 objects:v359 count:16];
        if (v103)
        {
          v104 = v103;
          v105 = *v339;
          while (2)
          {
            for (j = 0; j != v104; ++j)
            {
              if (*v339 != v105)
              {
                objc_enumerationMutation(v102);
              }

              userID = [*(*(&v338 + 1) + 8 * j) userID];
              userID2 = [v101 userID];
              v109 = [userID isEqualToString:userID2];

              if (v109)
              {

                goto LABEL_61;
              }
            }

            v104 = [v102 countByEnumeratingWithState:&v338 objects:v359 count:16];
            if (v104)
            {
              continue;
            }

            break;
          }
        }

        [(NSMutableArray *)v316->_users addObject:v101];
LABEL_61:
        ;
      }

      v99 = [obj countByEnumeratingWithState:&v342 objects:v360 count:16];
    }

    while (v99);
  }

  users = v316->_users;
  allObjects = [v321 allObjects];
  [(NSMutableArray *)users addObjectsFromArray:allObjects];

  v112 = objc_autoreleasePoolPush();
  v113 = v316;
  v114 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v114, OS_LOG_TYPE_DEBUG))
  {
    v115 = HMFGetLogIdentifier();
    v116 = v316->_users;
    *buf = 138543618;
    v366 = v115;
    v367 = 2112;
    v368 = v116;
    _os_log_impl(&dword_2531F8000, v114, OS_LOG_TYPE_DEBUG, "%{public}@Received users in the home data: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v112);
  v117 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"roomForEntireHome"];
  v118 = HMDDefaultRoomName();
  v311 = v118;
  if (v117)
  {
    [(HMDRoom *)v117 setName:v118];
  }

  else
  {
    v119 = objc_autoreleasePoolPush();
    v120 = v113;
    v121 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v121, OS_LOG_TYPE_INFO))
    {
      v122 = HMFGetLogIdentifier();
      *buf = 138543362;
      v366 = v122;
      _os_log_impl(&dword_2531F8000, v121, OS_LOG_TYPE_INFO, "%{public}@Missing roomForEntireHome - creating one", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v119);
    v117 = [[HMDRoom alloc] initWithName:v311 uuid:0 home:v120];
  }

  v306 = v117;
  objc_storeStrong(v113 + 147, v117);
  if (!isWatch())
  {
    v123 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"homeLocationHandler"];
    if (v123)
    {
      objc_storeStrong(v113 + 70, v123);
    }
  }

  v124 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"homeConfigVersion"];
  v113[148] = [v124 integerValue];

  if ([v313 containsValueForKey:@"lastSyncedHomeConfigVersion"])
  {
    v125 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"lastSyncedHomeConfigVersion"];
    v113[149] = [v125 integerValue];
  }

  if (!isWatch())
  {
    v126 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"characteristicNotificationRegistryCodingKey"];
    v127 = v126;
    if (v126)
    {
      v128 = v126;
    }

    else
    {
      v128 = objc_alloc_init(HMDNotificationRegistry);
    }

    v131 = v113[154];
    v113[154] = v128;

    [v113[154] configureWithHome:v113];
  }

  if (isiOSDevice() || isTVOSDevice())
  {
    v132 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.allowsRemoteAccess"];
    v133 = v132;
    if (v132)
    {
      *(v113 + 306) = [v132 BOOLValue];
    }
  }

  if (!isWatch())
  {
    v134 = v113[7];
    v135 = MEMORY[0x277CBEB98];
    v358[0] = objc_opt_class();
    v358[1] = objc_opt_class();
    v136 = [MEMORY[0x277CBEA60] arrayWithObjects:v358 count:2];
    v137 = [v135 setWithArray:v136];
    v138 = [v313 decodeObjectOfClasses:v137 forKey:@"HM.invitations"];
    [v134 setArray:v138];

    v336 = 0u;
    v337 = 0u;
    v334 = 0u;
    v335 = 0u;
    v318 = [v113[7] copy];
    v139 = [v318 countByEnumeratingWithState:&v334 objects:v357 count:16];
    if (v139)
    {
      v140 = v139;
      v141 = *v335;
      do
      {
        for (k = 0; k != v140; ++k)
        {
          if (*v335 != v141)
          {
            objc_enumerationMutation(v318);
          }

          v143 = *(*(&v334 + 1) + 8 * k);
          v330 = 0u;
          v331 = 0u;
          v332 = 0u;
          v333 = 0u;
          operations = [v143 operations];
          v145 = [operations countByEnumeratingWithState:&v330 objects:v356 count:16];
          if (v145)
          {
            v146 = v145;
            v147 = *v331;
            do
            {
              for (m = 0; m != v146; ++m)
              {
                if (*v331 != v147)
                {
                  objc_enumerationMutation(operations);
                }

                [*(*(&v330 + 1) + 8 * m) setDelegate:v113];
              }

              v146 = [operations countByEnumeratingWithState:&v330 objects:v356 count:16];
            }

            while (v146);
          }

          user = [v143 user];
          v150 = user;
          if (user)
          {
            v151 = v316->_users;
            userID3 = [user userID];
            v153 = [(NSMutableArray *)v151 hmf_firstObjectWithValue:userID3 forKeyPath:@"userID"];

            if (v153 && [v143 isComplete])
            {
              [v113[7] removeObject:v143];
            }

            else if ([v143 isAccepted])
            {
              [(NSMutableArray *)v316->_users addObject:v150];
              [v113[4] addObject:v150];
              [v150 setHome:v113];
            }
          }
        }

        v140 = [v318 countByEnumeratingWithState:&v334 objects:v357 count:16];
      }

      while (v140);
    }
  }

  v154 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.residentDeviceManager"];
  if (v154)
  {
    objc_storeStrong(v113 + 159, v154);
    [v113 _purgeResidentUsers];
  }

  v305 = v154;
  v113[171] = [v313 decodeIntegerForKey:@"HMD.nonIPadResidentDeviceCount"];
  if ([v113 isOwnerUser])
  {
    dataSource = [v113 dataSource];
    v156 = [dataSource makeCurrentUserWithUserPrivilege:3 home:v113];

    v157 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v157)
    {
      v158 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v157];
      [v156 setUUID:v158];
    }

    v303 = v157;
    array2 = [MEMORY[0x277CBEB18] array];
    v326 = 0u;
    v327 = 0u;
    v328 = 0u;
    v329 = 0u;
    v160 = v316->_users;
    v161 = [(NSMutableArray *)v160 countByEnumeratingWithState:&v326 objects:v355 count:16];
    if (v161)
    {
      v162 = v161;
      v163 = 0;
      v164 = *v327;
      v319 = v160;
      do
      {
        for (n = 0; n != v162; ++n)
        {
          if (*v327 != v164)
          {
            objc_enumerationMutation(v160);
          }

          v166 = *(*(&v326 + 1) + 8 * n);
          if ([v166 privilege] == 3 && (objc_msgSend(v166, "isRemoteGateway") & 1) == 0)
          {
            if (v163)
            {
              goto LABEL_125;
            }

            pairingUsername = [v166 pairingUsername];
            [v156 pairingUsername];
            v168 = array2;
            v170 = v169 = v156;
            v171 = [pairingUsername isEqual:v170];

            v156 = v169;
            array2 = v168;
            v163 = 0;

            v160 = v319;
            if (!v171)
            {
LABEL_125:
              [array2 addObject:v166];
            }

            else
            {
              v163 = v166;
            }
          }
        }

        v162 = [(NSMutableArray *)v160 countByEnumeratingWithState:&v326 objects:v355 count:16];
      }

      while (v162);
    }

    else
    {
      v163 = 0;
    }

    [(NSMutableArray *)v316->_users removeObjectsInArray:array2];
    v304 = v156;
    v302 = array2;
    v314 = v163;
    if (v163)
    {
      [v113 setOwner:v163];
    }

    else
    {
      [v113 setOwner:v156];
      [(NSMutableArray *)v316->_users addObject:v156];
      [v156 setHome:v113];
    }

    owner = [v113 owner];
    [v113 setCurrentUser:owner];

    array3 = [MEMORY[0x277CBEB18] array];
    v322 = 0u;
    v323 = 0u;
    v324 = 0u;
    v325 = 0u;
    v320 = v316->_users;
    v183 = [(NSMutableArray *)v320 countByEnumeratingWithState:&v322 objects:v354 count:16];
    if (v183)
    {
      v184 = v183;
      v185 = *v323;
      do
      {
        for (ii = 0; ii != v184; ++ii)
        {
          if (*v323 != v185)
          {
            objc_enumerationMutation(v320);
          }

          v187 = *(*(&v322 + 1) + 8 * ii);
          pairingUsername2 = [v187 pairingUsername];
          owner2 = [v113 owner];
          pairingUsername3 = [owner2 pairingUsername];
          if ([pairingUsername2 isEqual:pairingUsername3])
          {
            if (![v187 privilege])
            {

              goto LABEL_155;
            }

            privilege = [v187 privilege];

            if (privilege == 4)
            {
              goto LABEL_155;
            }
          }

          else
          {
          }

          if ([v187 isValid])
          {
            continue;
          }

          v192 = objc_autoreleasePoolPush();
          v193 = v113;
          v194 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v194, OS_LOG_TYPE_DEFAULT))
          {
            v195 = HMFGetLogIdentifier();
            *buf = 138543618;
            v366 = v195;
            v367 = 2112;
            v368 = v187;
            _os_log_impl(&dword_2531F8000, v194, OS_LOG_TYPE_DEFAULT, "%{public}@Removing invalid user %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v192);
LABEL_155:
          [array3 addObject:v187];
        }

        v184 = [(NSMutableArray *)v320 countByEnumeratingWithState:&v322 objects:v354 count:16];
      }

      while (v184);
    }

    [(NSMutableArray *)v316->_users removeObjectsInArray:array3];
    v179 = v303;
    v178 = v304;
LABEL_159:

    goto LABEL_160;
  }

  currentUser = [v113 currentUser];

  if (!currentUser)
  {
    v173 = objc_autoreleasePoolPush();
    v174 = v113;
    v175 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v175, OS_LOG_TYPE_DEFAULT))
    {
      v176 = HMFGetLogIdentifier();
      *buf = 138543362;
      v366 = v176;
      _os_log_impl(&dword_2531F8000, v175, OS_LOG_TYPE_DEFAULT, "%{public}@Current user not found, creating", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v173);
    dataSource2 = [v174 dataSource];
    v178 = [dataSource2 makeCurrentUserWithUserPrivilege:0 home:v174];

    if (!v178)
    {
      v298 = objc_autoreleasePoolPush();
      v299 = v174;
      v300 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v300, OS_LOG_TYPE_ERROR))
      {
        v301 = HMFGetLogIdentifier();
        *buf = 138543362;
        v366 = v301;
        _os_log_impl(&dword_2531F8000, v300, OS_LOG_TYPE_ERROR, "%{public}@Current user cannot be found or created, failing to deserialize home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v298);
      v293 = 0;
      v6 = v309;
      goto LABEL_211;
    }

    v179 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeOwnerUUID"];
    if (v179)
    {
      v180 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v179];
      [v178 setUUID:v180];
    }

    [v174 setCurrentUser:v178];
    [(NSMutableArray *)v316->_users addObject:v178];
    [v178 setHome:v174];
    goto LABEL_159;
  }

LABEL_160:
  v196 = [MEMORY[0x277CD1F00] authWithCoder:v313];
  v197 = v113[71];
  v113[71] = v196;

  v198 = v113[71];
  currentUser2 = [v113 currentUser];
  [currentUser2 setPresenceAuthStatus:v198];

  v200 = [MEMORY[0x277CD1F08] computeWithCoder:v313];
  v201 = v113[72];
  v113[72] = v200;

  v202 = objc_autoreleasePoolPush();
  v203 = v113;
  v204 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v204, OS_LOG_TYPE_INFO))
  {
    v205 = HMFGetLogIdentifier();
    currentUser3 = [v203 currentUser];
    *buf = 138543618;
    v366 = v205;
    v367 = 2112;
    v368 = currentUser3;
    _os_log_impl(&dword_2531F8000, v204, OS_LOG_TYPE_INFO, "%{public}@Current user is %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v202);
  array4 = [MEMORY[0x277CBEB18] array];
  if ([v313 containsValueForKey:@"triggers"])
  {
    v208 = MEMORY[0x277CBEB98];
    v353[0] = objc_opt_class();
    v353[1] = objc_opt_class();
    v353[2] = objc_opt_class();
    v353[3] = objc_opt_class();
    v209 = [MEMORY[0x277CBEA60] arrayWithObjects:v353 count:4];
    v210 = [v208 setWithArray:v209];
    v211 = [v313 decodeObjectOfClasses:v210 forKey:@"triggers"];
    [array4 addObjectsFromArray:v211];
  }

  if ([v313 containsValueForKey:@"HM.triggers"])
  {
    v212 = MEMORY[0x277CBEB98];
    v352[0] = objc_opt_class();
    v352[1] = objc_opt_class();
    v352[2] = objc_opt_class();
    v352[3] = objc_opt_class();
    v213 = [MEMORY[0x277CBEA60] arrayWithObjects:v352 count:4];
    v214 = [v212 setWithArray:v213];
    v215 = [v313 decodeObjectOfClasses:v214 forKey:@"HM.triggers"];
    [array4 addObjectsFromArray:v215];
  }

  if ([v313 containsValueForKey:@"HM.homePodTriggers"])
  {
    v216 = MEMORY[0x277CBEB98];
    v351[0] = objc_opt_class();
    v351[1] = objc_opt_class();
    v217 = [MEMORY[0x277CBEA60] arrayWithObjects:v351 count:2];
    v218 = [v216 setWithArray:v217];
    v219 = [v313 decodeObjectOfClasses:v218 forKey:@"HM.homePodTriggers"];
    [array4 addObjectsFromArray:v219];
  }

  if ([v313 containsValueForKey:@"HM.sharedActivationTriggers"])
  {
    v220 = MEMORY[0x277CBEB98];
    v350[0] = objc_opt_class();
    v350[1] = objc_opt_class();
    v350[2] = objc_opt_class();
    v350[3] = objc_opt_class();
    v221 = [MEMORY[0x277CBEA60] arrayWithObjects:v350 count:4];
    v222 = [v220 setWithArray:v221];
    v223 = [v313 decodeObjectOfClasses:v222 forKey:@"HM.sharedActivationTriggers"];
    [array4 addObjectsFromArray:v223];
  }

  [v203[55] setArray:array4];
  v224 = v203[12];
  v225 = MEMORY[0x277CBEB98];
  v349[0] = objc_opt_class();
  v349[1] = objc_opt_class();
  v226 = [MEMORY[0x277CBEA60] arrayWithObjects:v349 count:2];
  v227 = [v225 setWithArray:v226];
  v228 = [v313 decodeObjectOfClasses:v227 forKey:@"HM.deviceOwnedTriggers"];
  [v224 setArray:v228];

  v229 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.appDataRepository"];
  v230 = v203[131];
  v203[131] = v229;

  [v203[131] updateParentUUIDIfNil:v316->_uuid];
  v231 = *MEMORY[0x277CCFE80];
  if ([v313 containsValueForKey:*MEMORY[0x277CCFE80]])
  {
    *(v203 + 128) = [v313 decodeBoolForKey:v231];
  }

  v232 = *MEMORY[0x277CCFE88];
  if ([v313 containsValueForKey:*MEMORY[0x277CCFE88]])
  {
    *(v203 + 129) = [v313 decodeBoolForKey:v232];
  }

  v233 = *MEMORY[0x277CD03F8];
  if ([v313 containsValueForKey:*MEMORY[0x277CD03F8]])
  {
    v203[17] = [v313 decodeIntegerForKey:v233];
  }

  v234 = *MEMORY[0x277CD0410];
  if ([v313 containsValueForKey:*MEMORY[0x277CD0410]])
  {
    *(v203 + 144) = [v313 decodeBoolForKey:v234];
  }

  v235 = *MEMORY[0x277CD0400];
  if ([v313 containsValueForKey:*MEMORY[0x277CD0400]])
  {
    v236 = [v313 decodeObjectOfClass:objc_opt_class() forKey:v235];
    v237 = v203[19];
    v203[19] = v236;
  }

  v238 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"kHomeKitVersionStringKey"];
  v239 = v203[166];
  v203[166] = v238;

  v240 = v203[166];
  if (v240)
  {
    v241 = +[HMDHomeKitVersion version6];
    v242 = [v240 isAtLeastVersion:v241];

    if (v242)
    {
      *(v203 + 283) = 1;
    }
  }

  v243 = *MEMORY[0x277CD0458];
  if ([v313 containsValueForKey:*MEMORY[0x277CD0458]])
  {
    v244 = [v313 decodeIntegerForKey:v243];
  }

  else
  {
    v244 = 0;
  }

  v203[42] = v244;
  v245 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minimumNetworkRouterSupportHomeKitVersion"];
  if (v245)
  {
    v246 = [[HMDHomeKitVersion alloc] initWithString:v245];
    v247 = v203[50];
    v203[50] = v246;
  }

  v248 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.minHomeKitVersionForAccessoryNetworkProtectionChangeCodingKey"];

  if (v248)
  {
    v249 = [[HMDHomeKitVersion alloc] initWithString:v248];
    v250 = v203[51];
    v203[51] = v249;
  }

  v6 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.activeNetworkRouter"];

  if (v6)
  {
    v251 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v6];
    v252 = v203[45];
    v203[45] = v251;
  }

  if ([v313 containsValueForKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"])
  {
    v253 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomePrimaryNetworkRouterManagingDeviceUUIDCodingKey"];
    v254 = v203[48];
    v203[48] = v253;
  }

  v255 = MEMORY[0x277CBEB98];
  v348[0] = objc_opt_class();
  v348[1] = objc_opt_class();
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v348 count:2];
  v257 = [v255 setWithArray:v256];
  v258 = [v313 decodeObjectOfClasses:v257 forKey:*MEMORY[0x277CCFDB0]];

  v259 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
  notificationCenter = [v203 notificationCenter];
  v261 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v259 initWithHome:v203 notificationCenter:notificationCenter persistedGroups:v258];
  v262 = v203[44];
  v203[44] = v261;

  v263 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHH.residentReachabilityContext"];
  v264 = v263;
  if (v263)
  {
    v265 = v263;
  }

  else
  {
    v265 = objc_alloc_init(HMDResidentReachabilityContext);
  }

  v266 = [[HMDResidentReachabilityNotificationManager alloc] initWithResidentReachabilityContext:v265 workQueue:v203[138]];
  v267 = v203[169];
  v203[169] = v266;

  if ([v313 containsValueForKey:@"HMHM.threadNetworkID"])
  {
    v268 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.threadNetworkID"];
    v269 = v203[56];
    v203[56] = v268;
  }

  v270 = [v313 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04A0]];
  v271 = v203[64];
  v203[64] = v270;

  v272 = [v313 decodeObjectOfClass:objc_opt_class() forKey:*MEMORY[0x277CD04B8]];
  v273 = v203[168];
  v203[168] = v272;

  v274 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HM.nlcck"];
  v275 = v203[65];
  v203[65] = v274;

  if ([v313 containsValueForKey:@"HMDHomeLabelsByAccessCodeCodingKey"])
  {
    v276 = MEMORY[0x277CBEB98];
    v347[0] = objc_opt_class();
    v347[1] = objc_opt_class();
    v277 = [MEMORY[0x277CBEA60] arrayWithObjects:v347 count:2];
    v278 = [v276 setWithArray:v277];
    v279 = [v313 decodeObjectOfClasses:v278 forKey:@"HMDHomeLabelsByAccessCodeCodingKey"];

    v280 = [v279 mutableCopy];
    v281 = v203[89];
    v203[89] = v280;
  }

  if ([v313 containsValueForKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"])
  {
    v282 = MEMORY[0x277CBEB98];
    v346[0] = objc_opt_class();
    v346[1] = objc_opt_class();
    v346[2] = objc_opt_class();
    v283 = [MEMORY[0x277CBEA60] arrayWithObjects:v346 count:3];
    v284 = [v282 setWithArray:v283];
    v285 = [v313 decodeObjectOfClasses:v284 forKey:@"HMDHomeRemovedUserInfoByAccessCodeCodingKey"];

    v286 = [v285 mutableCopy];
    v287 = v203[90];
    v203[90] = v286;
  }

  if ([v313 containsValueForKey:@"HMDHomeNFCReaderKeyCodingKey"])
  {
    v288 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMDHomeNFCReaderKeyCodingKey"];
    v289 = v203[59];
    v203[59] = v288;
  }

  else
  {
    *(v203 + 298) = 0;
  }

  v290 = [v313 decodeObjectOfClass:objc_opt_class() forKey:@"HMHM.chipStorage"];
  if (v290)
  {
    objc_storeStrong(v203 + 173, v290);
    if (isFeatureMatterLocalFabricConfigEnabled())
    {
      fabricID = [v290 fabricID];

      if (fabricID)
      {
        fabricID2 = [v290 fabricID];
        [v203[175] setFabricID:fabricID2];
      }
    }
  }

  *(v203 + 309) = [v313 decodeBoolForKey:*MEMORY[0x277CD0698]];

  v293 = 1;
LABEL_211:
  v5 = v310;

  if (!v293)
  {
    v295 = 0;
    coderCopy = v313;
    v294 = v316;
    goto LABEL_215;
  }

  coderCopy = v313;
  v9 = v316;
LABEL_213:
  v294 = v9;
  v295 = v9;
LABEL_215:

  v296 = *MEMORY[0x277D85DE8];
  return v295;
}

- (HMDHome)initWithCoder:(id)coder
{
  coderCopy = coder;
  v5 = objc_autoreleasePoolPush();
  v6 = [(HMDHome *)self _initWithCoder:coderCopy];
  objc_autoreleasePoolPop(v5);

  return v6;
}

- (void)fixupHomeAfterDecoding
{
  v125 = *MEMORY[0x277D85DE8];
  v92 = +[HMDProcessInfo privateClientIdentifierSalt];
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  selfCopy = self;
  if ([(HMDHome *)self isOwnerUser])
  {
    v110 = 0u;
    v111 = 0u;
    v108 = 0u;
    v109 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories countByEnumeratingWithState:&v108 objects:v124 count:16];
    if (v4)
    {
      v6 = v4;
      v7 = *v109;
      v8 = HMDIDSActivityMonitorHomeManagerDataSource;
      *&v5 = 138543874;
      v80 = v5;
      v84 = accessories;
      v85 = *v109;
      do
      {
        v9 = 0;
        v86 = v6;
        do
        {
          if (*v109 != v7)
          {
            objc_enumerationMutation(accessories);
          }

          v10 = *(*(&v108 + 1) + 8 * v9);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v11 = v10;
          }

          else
          {
            v11 = 0;
          }

          v12 = v11;

          bridge = [v12 bridge];
          v14 = bridge;
          if (v12)
          {
            v15 = bridge == 0;
          }

          else
          {
            v15 = 1;
          }

          if (!v15)
          {
            uniqueIdentifier = [v12 uniqueIdentifier];

            if (uniqueIdentifier)
            {
              v87 = v14;
              v88 = v9;
              v17 = MEMORY[0x277CCAD78];
              uuid = [v14 uuid];
              v19 = MEMORY[0x277CFE9F8];
              uniqueIdentifier2 = [v12 uniqueIdentifier];
              v21 = [v19 instanceIDForUniqueIdentifier:uniqueIdentifier2];
              stringValue = [v21 stringValue];
              v123 = stringValue;
              v23 = [MEMORY[0x277CBEA60] arrayWithObjects:&v123 count:1];
              v24 = [v17 hm_deriveUUIDFromBaseUUID:uuid withSalts:v23];

              uuid2 = [v12 uuid];
              LOBYTE(v17) = [v24 isEqual:uuid2];

              if (v17)
              {

                v6 = v86;
                v14 = v87;
                v9 = v88;
                v7 = v85;
              }

              else
              {
                v36 = objc_autoreleasePoolPush();
                v37 = selfCopy;
                v38 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
                {
                  v39 = HMFGetLogIdentifier();
                  uuid3 = [v12 uuid];
                  *buf = v80;
                  v118 = v39;
                  v119 = 2112;
                  v120 = uuid3;
                  v121 = 2112;
                  v122 = v24;
                  _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of accessory uuid from legacy archive %@ -> %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v36);
                uuid4 = [v12 uuid];
                [v12 setUuid:v24];
                appData = [v12 appData];

                if (appData)
                {
                  uuid5 = [v12 uuid];
                  appData2 = [v12 appData];
                  [appData2 setParentUUID:uuid5];
                }

                v81 = uuid4;
                v94 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:uuid4 identifierSalt:v92 withSalts:{0, v80}];
                v82 = v24;
                v93 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:v24 identifierSalt:v92 withSalts:0];
                v104 = 0u;
                v105 = 0u;
                v106 = 0u;
                v107 = 0u;
                v83 = v12;
                obj = [v12 services];
                v45 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                if (v45)
                {
                  v46 = v45;
                  v91 = *v105;
                  do
                  {
                    for (i = 0; i != v46; ++i)
                    {
                      if (*v105 != v91)
                      {
                        objc_enumerationMutation(obj);
                      }

                      v48 = *(*(&v104 + 1) + 8 * i);
                      [v48 _recalculateUUID];
                      v49 = MEMORY[0x277CCAD78];
                      instanceID = [v48 instanceID];
                      stringValue2 = [instanceID stringValue];
                      v115 = stringValue2;
                      v52 = [MEMORY[0x277CBEA60] arrayWithObjects:&v115 count:1];
                      v53 = [v49 hm_deriveUUIDFromBaseUUID:v94 identifierSalt:v92 withSalts:v52];

                      v54 = MEMORY[0x277CCAD78];
                      instanceID2 = [v48 instanceID];
                      stringValue3 = [instanceID2 stringValue];
                      v114 = stringValue3;
                      v57 = [MEMORY[0x277CBEA60] arrayWithObjects:&v114 count:1];
                      v58 = [v54 hm_deriveUUIDFromBaseUUID:v93 identifierSalt:v92 withSalts:v57];

                      uUIDString = [v58 UUIDString];
                      uUIDString2 = [v53 UUIDString];
                      [dictionary setObject:uUIDString forKey:uUIDString2];

                      appData3 = [v48 appData];

                      if (appData3)
                      {
                        uuid6 = [v48 uuid];
                        appData4 = [v48 appData];
                        [appData4 setParentUUID:uuid6];
                      }
                    }

                    v46 = [obj countByEnumeratingWithState:&v104 objects:v116 count:16];
                  }

                  while (v46);
                }

                accessories = v84;
                v7 = v85;
                v8 = HMDIDSActivityMonitorHomeManagerDataSource;
                v6 = v86;
                v14 = v87;
                v9 = v88;
                v12 = v83;
              }
            }

            else
            {
              v26 = v14;
              v27 = objc_autoreleasePoolPush();
              v28 = selfCopy;
              v29 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
              {
                v30 = HMFGetLogIdentifier();
                uuid7 = [v12 uuid];
                [uuid7 UUIDString];
                v32 = v8;
                v33 = v12;
                v35 = v34 = v9;
                *buf = 138543618;
                v118 = v30;
                v119 = 2112;
                v120 = v35;
                _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to check validity of uuid %@ (accessory has nil uniqueIdentifier)", buf, 0x16u);

                v9 = v34;
                v12 = v33;
                v8 = v32;

                v6 = v86;
                v7 = v85;
              }

              objc_autoreleasePoolPop(v27);
              v14 = v26;
              accessories = v84;
            }
          }

          ++v9;
        }

        while (v9 != v6);
        v6 = [accessories countByEnumeratingWithState:&v108 objects:v124 count:16];
      }

      while (v6);
    }

    v102 = 0u;
    v103 = 0u;
    v100 = 0u;
    v101 = 0u;
    rooms = [(HMDHome *)selfCopy rooms];
    v65 = [rooms countByEnumeratingWithState:&v100 objects:v113 count:16];
    if (v65)
    {
      v66 = v65;
      v67 = *v101;
      do
      {
        for (j = 0; j != v66; ++j)
        {
          if (*v101 != v67)
          {
            objc_enumerationMutation(rooms);
          }

          v69 = *(*(&v100 + 1) + 8 * j);
          appData5 = [v69 appData];

          if (appData5)
          {
            appData6 = [v69 appData];
            [(HMDHome *)selfCopy updateAppData:appData6 identifierKey:@"HFSortedIdentifierStrings_roomServices" lookup:dictionary];
          }
        }

        v66 = [rooms countByEnumeratingWithState:&v100 objects:v113 count:16];
      }

      while (v66);
    }

    appData7 = [(HMDHome *)selfCopy appData];

    if (appData7)
    {
      appData8 = [(HMDHome *)selfCopy appData];
      [(HMDHome *)selfCopy updateAppData:appData8 identifierKey:@"HFSortedIdentifierStrings_homeServices" lookup:dictionary];
    }

    [(HMDHome *)selfCopy computeBridgedAccessoriesForAllBridges];
  }

  v98 = 0u;
  v99 = 0u;
  v96 = 0u;
  v97 = 0u;
  serviceGroups = [(HMDHome *)selfCopy serviceGroups];
  v75 = [serviceGroups countByEnumeratingWithState:&v96 objects:v112 count:16];
  if (v75)
  {
    v76 = v75;
    v77 = *v97;
    do
    {
      for (k = 0; k != v76; ++k)
      {
        if (*v97 != v77)
        {
          objc_enumerationMutation(serviceGroups);
        }

        [*(*(&v96 + 1) + 8 * k) fixupServiceGroup];
      }

      v76 = [serviceGroups countByEnumeratingWithState:&v96 objects:v112 count:16];
    }

    while (v76);
  }

  v79 = *MEMORY[0x277D85DE8];
}

- (void)updateAppData:(id)data identifierKey:(id)key lookup:(id)lookup
{
  v53 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  keyCopy = key;
  lookupCopy = lookup;
  dictionary = [dataCopy dictionary];
  v12 = [dictionary hmf_dictionaryForKey:@"com.apple.homekit-entitledclient.identifer"];

  v37 = keyCopy;
  v13 = [v12 objectForKey:keyCopy];
  v14 = v13;
  if (v13 && [v13 count])
  {
    v34 = v12;
    v35 = dataCopy;
    v32 = [v12 mutableCopy];
    v15 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v14, "count")}];
    v40 = 0u;
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v33 = v14;
    obj = v14;
    v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
    if (v39)
    {
      v16 = *v41;
      v36 = *v41;
      do
      {
        for (i = 0; i != v39; ++i)
        {
          if (*v41 != v16)
          {
            objc_enumerationMutation(obj);
          }

          v18 = *(*(&v40 + 1) + 8 * i);
          v19 = [lookupCopy objectForKey:v18];
          if (v19)
          {
            v20 = objc_autoreleasePoolPush();
            selfCopy = self;
            v22 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
            {
              HMFGetLogIdentifier();
              v23 = v15;
              selfCopy2 = self;
              v26 = v25 = lookupCopy;
              *buf = 138544130;
              v45 = v26;
              v46 = 2112;
              v47 = v37;
              v48 = 2112;
              v49 = v18;
              v50 = 2112;
              v51 = v19;
              _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Fixup of service uuid list %@ from legacy archive %@ -> %@", buf, 0x2Au);

              lookupCopy = v25;
              self = selfCopy2;
              v15 = v23;
              v16 = v36;
            }

            objc_autoreleasePoolPop(v20);
            v27 = v15;
            v28 = v19;
          }

          else
          {
            v27 = v15;
            v28 = v18;
          }

          [v27 addObject:v28];
        }

        v39 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
      }

      while (v39);
    }

    v29 = [v15 copy];
    [v32 setObject:v29 forKey:v37];

    v30 = [v32 copy];
    dataCopy = v35;
    [v35 setApplicationData:v30 forIdentifier:@"com.apple.homekit-entitledclient.identifer"];

    v14 = v33;
    v12 = v34;
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateMediaPassword:(id)password
{
  v39 = *MEMORY[0x277D85DE8];
  passwordCopy = password;
  messagePayload = [passwordCopy messagePayload];
  v6 = [messagePayload objectForKeyedSubscript:*MEMORY[0x277CD0408]];

  if (!v6)
  {
    goto LABEL_5;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v34 = v16;
      v35 = 2112;
      v36 = v6;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid password: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    responseHandler = [passwordCopy responseHandler];

    if (!responseHandler)
    {
      goto LABEL_18;
    }

    responseHandler5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
LABEL_16:
    responseHandler2 = [passwordCopy responseHandler];
    (responseHandler2)[2](responseHandler2, responseHandler5, 0);

    goto LABEL_17;
  }

  v32 = 0;
  v7 = [MEMORY[0x277CD1A60] isValidMediaPassword:v6 error:&v32];
  v8 = v32;
  responseHandler5 = v8;
  if ((v7 & 1) == 0)
  {
    v25 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543874;
      v34 = v28;
      v35 = 2112;
      v36 = v6;
      v37 = 2112;
      v38 = responseHandler5;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to validate password, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v25);
    responseHandler3 = [passwordCopy responseHandler];

    if (!responseHandler3)
    {
      goto LABEL_17;
    }

    goto LABEL_16;
  }

LABEL_5:
  mediaPassword = [(HMDHome *)self mediaPassword];
  v11 = HMFEqualObjects();

  if (!v11)
  {
    v18 = [HMDHomeMediaSettingsModel alloc];
    uuid = [(HMDHome *)self uuid];
    v20 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid];
    uuid2 = [(HMDHome *)self uuid];
    responseHandler5 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:v20 parentUUID:uuid2];

    [(HMDHomeMediaSettingsModel *)responseHandler5 setMediaPassword:v6];
    backingStore = [(HMDHome *)self backingStore];
    v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v24 = [backingStore transaction:@"Update Media Password" options:v23];

    [v24 add:responseHandler5 withMessage:passwordCopy];
    [v24 run];

    goto LABEL_17;
  }

  responseHandler4 = [passwordCopy responseHandler];

  if (responseHandler4)
  {
    responseHandler5 = [passwordCopy responseHandler];
    (*&responseHandler5->super.super._bsoDataVersionOverride)(responseHandler5, 0, 0);
LABEL_17:
  }

LABEL_18:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPassword:(id)password
{
  v19 = *MEMORY[0x277D85DE8];
  passwordCopy = password;
  v5 = [passwordCopy copy];
  os_unfair_recursive_lock_lock_with_options();
  mediaPassword = self->_mediaPassword;
  if (HMFEqualObjects())
  {
    os_unfair_recursive_lock_unlock();
  }

  else
  {
    objc_storeStrong(&self->_mediaPassword, v5);
    os_unfair_recursive_lock_unlock();
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = v5;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Updated media password to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    workQueue = selfCopy->_workQueue;
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __28__HMDHome_setMediaPassword___block_invoke;
    v13[3] = &unk_2797359B0;
    v13[4] = selfCopy;
    v14 = v5;
    dispatch_async(workQueue, v13);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __28__HMDHome_setMediaPassword___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_286698188])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedPassword:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (id)mediaPassword
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_mediaPassword;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleUpdateMediaPeerToPeerEnabled:(id)enabled
{
  v27 = *MEMORY[0x277D85DE8];
  enabledCopy = enabled;
  v24 = 0;
  v5 = [enabledCopy BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isMediaPeerToPeerEnabled])
    {
      v7 = [HMDHomeMediaSettingsModel alloc];
      uuid = [(HMDHome *)self uuid];
      v9 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)self uuid];
      responseHandler2 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:uuid2];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeMediaSettingsModel *)responseHandler2 setMediaPeerToPeerEnabled:v12];

      backingStore = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [backingStore transaction:@"Update Media Peer-to-peer Enabled" options:v14];

      [v15 add:responseHandler2 withMessage:enabledCopy];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    responseHandler = [enabledCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [enabledCopy responseHandler];
      (*&responseHandler2->super.super._bsoDataVersionOverride)(responseHandler2, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    responseHandler3 = [enabledCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [enabledCopy responseHandler];
      (responseHandler4)[2](responseHandler4, responseHandler2, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (void)setMediaPeerToPeerEnabled:(BOOL)enabled
{
  os_unfair_recursive_lock_lock_with_options();
  self->_mediaPeerToPeerEnabled = enabled;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isMediaPeerToPeerEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  mediaPeerToPeerEnabled = self->_mediaPeerToPeerEnabled;
  os_unfair_recursive_lock_unlock();
  return mediaPeerToPeerEnabled;
}

- (void)_handleUpdateMinimumMediaUserPrivilege:(id)privilege
{
  v28 = *MEMORY[0x277D85DE8];
  privilegeCopy = privilege;
  v5 = [privilegeCopy numberForKey:@"kUserPrivilegeLevelKey"];
  v6 = v5;
  if (v5)
  {
    integerValue = [v5 integerValue];
    if ([(HMDHome *)self minimumMediaUserPrivilege]!= integerValue)
    {
      v16 = [HMDHomeMediaSettingsModel alloc];
      uuid = [(HMDHome *)self uuid];
      v18 = [HMDHomeMediaSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v16 initWithObjectChangeType:2 uuid:v18 parentUUID:uuid2];

      v21 = [MEMORY[0x277CCABB0] numberWithInteger:integerValue];
      [(HMDHomeMediaSettingsModel *)v20 setMinimumMediaUserPrivilege:v21];

      backingStore = [(HMDHome *)self backingStore];
      v23 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v24 = [backingStore transaction:@"Update Minimum User Privilege" options:v23];

      [v24 add:v20 withMessage:privilegeCopy];
      [v24 run];

      goto LABEL_11;
    }

    responseHandler = [privilegeCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [privilegeCopy responseHandler];
      responseHandler2[2](responseHandler2, 0, 0);
LABEL_9:
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v26 = 138543362;
      v27 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", &v26, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    responseHandler3 = [privilegeCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [privilegeCopy responseHandler];
      responseHandler4[2](responseHandler4, responseHandler2, 0);

      goto LABEL_9;
    }
  }

LABEL_11:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)setMinimumMediaUserPrivilege:(int64_t)privilege
{
  v22 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_minimumMediaUserPrivilege == privilege)
  {
    os_unfair_recursive_lock_unlock();
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v8;
      v20 = 2112;
      v21 = v9;
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    self->_minimumMediaUserPrivilege = privilege;
    os_unfair_recursive_lock_unlock();
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMUserPrivilegeToString();
      *buf = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated minimum user privilege to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    workQueue = selfCopy2->_workQueue;
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke;
    v17[3] = &unk_279734BB8;
    v17[4] = selfCopy2;
    v17[5] = privilege;
    dispatch_async(workQueue, v17);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome_setMinimumMediaUserPrivilege___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [*(a1 + 32) accessories];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v12;
    do
    {
      v6 = 0;
      do
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v11 + 1) + 8 * v6);
        if ([v7 conformsToProtocol:&unk_286698188])
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        if (v9 && [v9 supportsMinimumUserPrivilege])
        {
          [v9 handleUpdatedMinimumUserPrivilege:*(a1 + 40)];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (int64_t)minimumMediaUserPrivilege
{
  os_unfair_recursive_lock_lock_with_options();
  minimumMediaUserPrivilege = self->_minimumMediaUserPrivilege;
  os_unfair_recursive_lock_unlock();
  return minimumMediaUserPrivilege;
}

- (void)queryPrimaryResidentReachabilityForAccessories:(id)accessories completion:(id)completion
{
  v49 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  completionCopy = completion;
  isCurrentDeviceConfirmedPrimaryResident = [(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident];
  v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessoriesCopy, "count")}];
  if (isCurrentDeviceConfirmedPrimaryResident)
  {
    v32 = completionCopy;
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v10 = accessoriesCopy;
    v11 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v40;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v40 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v39 + 1) + 8 * i);
          v46 = @"kAccessoryIsReachableKey";
          v16 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "isReachable", v32)}];
          v47 = v16;
          v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v47 forKeys:&v46 count:1];

          [v9 addObject:v17];
        }

        v12 = [v10 countByEnumeratingWithState:&v39 objects:v48 count:16];
      }

      while (v12);
    }

    completionCopy = v32;
    v32[2](v32, v9);
  }

  else
  {
    v37 = 0u;
    v38 = 0u;
    v35 = 0u;
    v36 = 0u;
    v18 = accessoriesCopy;
    v19 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v36;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v36 != v21)
          {
            objc_enumerationMutation(v18);
          }

          uuid = [*(*(&v35 + 1) + 8 * j) uuid];
          uUIDString = [uuid UUIDString];
          [v9 addObject:uUIDString];
        }

        v20 = [v18 countByEnumeratingWithState:&v35 objects:v45 count:16];
      }

      while (v20);
    }

    v43 = @"kAccessoriesUUIDKey";
    v44 = v9;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v44 forKeys:&v43 count:1];
    v26 = MEMORY[0x277D0F818];
    uUID = [MEMORY[0x277CCAD78] UUID];
    v28 = [v26 messageWithName:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" identifier:uUID messagePayload:v25];

    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke;
    v33[3] = &unk_279732CF0;
    v33[4] = self;
    v34 = completionCopy;
    [v28 setResponseHandler:v33];
    uuid2 = [(HMDHome *)self uuid];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDHome *)self redispatchToResidentMessage:v28 target:uuid2 responseQueue:workQueue];
  }

  v31 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_queryPrimaryResidentReachabilityForAccessories_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Query reachability response error: %@", &v16, 0x16u);
    }

    v12 = 0;
LABEL_5:

    objc_autoreleasePoolPop(v8);
    goto LABEL_6;
  }

  v14 = [v6 hmf_arrayForKey:@"kAccessoriesInfoDictionaryKey"];
  v12 = v14;
  if (!v14 || ![v14 count])
  {
    v8 = objc_autoreleasePoolPush();
    v9 = *(a1 + 32);
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v15;
      v18 = 2112;
      v19 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@No reachability setting in query reachability response: %@", &v16, 0x16u);
    }

    goto LABEL_5;
  }

LABEL_6:
  (*(*(a1 + 40) + 16))();

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleQueryResidentReachabilityForAccessories:(id)accessories
{
  v39 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  messagePayload = [accessoriesCopy messagePayload];
  v6 = [messagePayload hmf_arrayForKey:@"kAccessoriesUUIDKey"];
  v7 = v6;
  if (v6)
  {
    v26 = accessoriesCopy;
    v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v6, "count")}];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v25 = v7;
    obj = v7;
    v9 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      v12 = *MEMORY[0x277CCF0B0];
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v28 + 1) + 8 * i);
          v15 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v14];
          v16 = [(HMDHome *)self accessoryWithUUID:v15];

          if (v16)
          {
            v34[0] = v12;
            v34[1] = @"kAccessoryIsReachableKey";
            v35[0] = v14;
            v17 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v16, "isReachable")}];
            v35[1] = v17;
            v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

            [v8 addObject:v18];
          }
        }

        v10 = [obj countByEnumeratingWithState:&v28 objects:v36 count:16];
      }

      while (v10);
    }

    v32 = @"kAccessoriesInfoDictionaryKey";
    v33 = v8;
    v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v33 forKeys:&v32 count:1];
    accessoriesCopy = v26;
    [v26 respondWithPayload:v19];

    v7 = v25;
  }

  else
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Query reachability request is missing accessory UUID in payload", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v8 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
    [accessoriesCopy respondWithError:v8];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate:(id)update
{
  v27 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v24 = 0;
  v5 = [updateCopy BOOLForKey:@"kEnabledKey" keyPresent:&v24];
  if (v24)
  {
    v6 = v5;
    if (v5 != [(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
    {
      v7 = [HMDHomeSettingsModel alloc];
      uuid = [(HMDHome *)self uuid];
      v9 = [HMDHomeSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)self uuid];
      responseHandler2 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:2 uuid:v9 parentUUID:uuid2];

      v12 = [MEMORY[0x277CCABB0] numberWithBool:v6];
      [(HMDHomeSettingsModel *)responseHandler2 setAutomaticThirdPartyAccessorySoftwareUpdateEnabled:v12];

      backingStore = [(HMDHome *)self backingStore];
      v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v15 = [backingStore transaction:@"Update Automatic Accessory Firmware Update" options:v14];

      [v15 add:responseHandler2 withMessage:updateCopy];
      [v15 run];

LABEL_10:
      goto LABEL_11;
    }

    responseHandler = [updateCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [updateCopy responseHandler];
      (*&responseHandler2->super.super._bsoDataVersionOverride)(responseHandler2, 0, 0);
      goto LABEL_10;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
    responseHandler3 = [updateCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [updateCopy responseHandler];
      (responseHandler4)[2](responseHandler4, responseHandler2, 0);

      goto LABEL_10;
    }
  }

LABEL_11:

  v23 = *MEMORY[0x277D85DE8];
}

- (BOOL)isAutomaticThirdPartyAccessorySoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticThirdPartyAccessorySoftwareUpdateEnabled = self->_automaticThirdPartyAccessorySoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticThirdPartyAccessorySoftwareUpdateEnabled;
}

- (void)_handleUpdateAutomaticSoftwareUpdate:(id)update
{
  v44 = *MEMORY[0x277D85DE8];
  updateCopy = update;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling update automatic software update message", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v39 = 0;
  v9 = [updateCopy BOOLForKey:@"kEnabledKey" keyPresent:&v39];
  if (v39)
  {
    v10 = v9;
    isAutomaticSoftwareUpdateEnabled = [(HMDHome *)selfCopy isAutomaticSoftwareUpdateEnabled];
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    v15 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
    if (v10 != isAutomaticSoftwareUpdateEnabled)
    {
      if (v15)
      {
        v16 = HMFGetLogIdentifier();
        v17 = HMFBooleanToString();
        *buf = 138543618;
        v41 = v16;
        v42 = 2112;
        v43 = v17;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Updating automatic software update to: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
      responseHandler2 = [HMDSoftwareUpdateAutomaticUpdateToggledEvent eventWithAutomaticUpdateEnabled:v10];
      logEventSubmitter = [(HMDHome *)v13 logEventSubmitter];
      [logEventSubmitter submitLogEvent:responseHandler2];

      v20 = [HMDHomeSettingsModel alloc];
      uuid = [(HMDHome *)v13 uuid];
      v22 = [HMDHomeSettingsModel modelIDForHomeUUID:uuid];
      uuid2 = [(HMDHome *)v13 uuid];
      v24 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:2 uuid:v22 parentUUID:uuid2];

      v25 = [MEMORY[0x277CCABB0] numberWithBool:v10];
      [(HMDHomeSettingsModel *)v24 setAutomaticSoftwareUpdateEnabled:v25];

      backingStore = [(HMDHome *)v13 backingStore];
      v27 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v28 = [backingStore transaction:@"Update Automatic Software Update" options:v27];

      [v28 add:v24 withMessage:updateCopy];
      [v28 run];

      goto LABEL_16;
    }

    if (v15)
    {
      v35 = HMFGetLogIdentifier();
      v36 = HMFBooleanToString();
      *buf = 138543618;
      v41 = v35;
      v42 = 2112;
      v43 = v36;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Not changing the setting because it is already set to: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    responseHandler = [updateCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [updateCopy responseHandler];
      responseHandler2[2](responseHandler2, 0, 0);
      goto LABEL_16;
    }
  }

  else
  {
    v29 = objc_autoreleasePoolPush();
    v30 = selfCopy;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v32;
      _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v29);
    responseHandler3 = [updateCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      responseHandler4 = [updateCopy responseHandler];
      responseHandler4[2](responseHandler4, responseHandler2, 0);

LABEL_16:
    }
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)setAutomaticSoftwareUpdateEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (self->_automaticSoftwareUpdateEnabled == enabledCopy)
  {
    v5 = *MEMORY[0x277D85DE8];

    os_unfair_recursive_lock_unlock();
  }

  else
  {
    self->_automaticSoftwareUpdateEnabled = enabledCopy;
    os_unfair_recursive_lock_unlock();
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = v9;
      v11 = @"disabled";
      if (enabledCopy)
      {
        v11 = @"enabled";
      }

      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Automatic software updates %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    [(HMDHome *)selfCopy _reevaluateAccessoryInfoWithBadgeRefresh:1];
    v12 = *MEMORY[0x277D85DE8];
  }
}

- (BOOL)isAutomaticSoftwareUpdateEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  automaticSoftwareUpdateEnabled = self->_automaticSoftwareUpdateEnabled;
  os_unfair_recursive_lock_unlock();
  return automaticSoftwareUpdateEnabled;
}

- (void)_handleHomeLocationUpdateFromSharedAdmin:(id)admin
{
  v32 = *MEMORY[0x277D85DE8];
  adminCopy = admin;
  v5 = [adminCopy dataForKey:@"kHomeLocationDataKey"];
  if (v5)
  {
    v25 = 0;
    v6 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v5 error:&v25];
    v7 = v25;
    if (!v6)
    {
      v18 = objc_autoreleasePoolPush();
      selfCopy = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v21;
        v28 = 2112;
        v29 = v7;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive location from data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
      goto LABEL_13;
    }

    v8 = [adminCopy numberForKey:@"HMD.LOC.SRC"];
    intValue = [v8 intValue];

    v10 = isInternalBuild();
    v11 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v13 = HMFGetOSLogHandle();
    v14 = os_log_type_enabled(v13, OS_LOG_TYPE_INFO);
    if (v10)
    {
      if (v14)
      {
        v15 = HMFGetLogIdentifier();
        v16 = HMDHomeLocationSourceToString(intValue);
        *buf = 138543874;
        v27 = v15;
        v28 = 2112;
        v29 = v6;
        v30 = 2112;
        v31 = v16;
        v17 = "%{public}@Received new home location from shared admin: %@, source : %@";
LABEL_11:
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, v17, buf, 0x20u);
      }
    }

    else if (v14)
    {
      v15 = HMFGetLogIdentifier();
      v16 = HMDHomeLocationSourceToString(intValue);
      *buf = 138543875;
      v27 = v15;
      v28 = 2117;
      v29 = v6;
      v30 = 2112;
      v31 = v16;
      v17 = "%{public}@Received new home location from shared admin: %{sensitive}@, source : %@";
      goto LABEL_11;
    }

    objc_autoreleasePoolPop(v11);
    homeLocationHandler = [(HMDHome *)selfCopy2 homeLocationHandler];
    date = [MEMORY[0x277CBEAA8] date];
    [homeLocationHandler runTransactionWithLocation:v6 updatedTime:date source:intValue];

LABEL_13:
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_updateHomeLocation
{
  v40 = *MEMORY[0x277D85DE8];
  homeLocationHandler = [(HMDHome *)self homeLocationHandler];
  if (![homeLocationHandler regionStateAtHome])
  {

    goto LABEL_8;
  }

  homeLocationHandler2 = [(HMDHome *)self homeLocationHandler];
  regionStateNearbyHome = [homeLocationHandler2 regionStateNearbyHome];

  if (!regionStateNearbyHome)
  {
LABEL_8:
    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v31 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@No reachable accessories found and not all regions are determined. Setting Home location to unknown & home level to Not at Home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v19 = 0;
    v18 = 0;
    goto LABEL_11;
  }

  v6 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    HMFGetLogIdentifier();
    v9 = v29 = v6;
    homeLocationHandler3 = [(HMDHome *)selfCopy2 homeLocationHandler];
    [homeLocationHandler3 regionStateAtHome];
    v11 = HMRegionStateString();
    homeLocationHandler4 = [(HMDHome *)selfCopy2 homeLocationHandler];
    [homeLocationHandler4 regionStateNearbyHome];
    v13 = HMRegionStateString();
    reachableAccessoriesCount = [(HMDHome *)selfCopy2 reachableAccessoriesCount];
    v15 = HMFBooleanToString();
    *buf = 138544386;
    v31 = v9;
    v32 = 2112;
    v33 = v11;
    v34 = 2112;
    v35 = v13;
    v36 = 2048;
    v37 = reachableAccessoriesCount;
    v38 = 2112;
    v39 = v15;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@RegionStateAtHome : %@, RegionStateNearbyHome : %@, reachableAccessoriesCount : %lu/%@", buf, 0x34u);

    v6 = v29;
  }

  objc_autoreleasePoolPop(v6);
  homeLocationHandler5 = [(HMDHome *)selfCopy2 homeLocationHandler];
  regionStateAtHome = [homeLocationHandler5 regionStateAtHome];

  if (regionStateAtHome == 1)
  {
    v18 = 2;
    v19 = 1;
  }

  else
  {
    homeLocationHandler6 = [(HMDHome *)selfCopy2 homeLocationHandler];
    regionStateNearbyHome2 = [homeLocationHandler6 regionStateNearbyHome];

    if (regionStateNearbyHome2 == 1)
    {
      v18 = 1;
      v19 = 3;
    }

    else
    {
      homeLocationHandler7 = [(HMDHome *)selfCopy2 homeLocationHandler];
      regionStateNearbyHome3 = [homeLocationHandler7 regionStateNearbyHome];

      if (regionStateNearbyHome3 != 2)
      {
        v18 = 0;
        goto LABEL_12;
      }

      v18 = 1;
      v19 = 2;
    }
  }

LABEL_11:
  [(HMDHome *)self setHomeLocation:v19];
LABEL_12:
  [(HMDHome *)self setAtHomeLevel:v18];
  v24 = *MEMORY[0x277D85DE8];
}

- (void)updateHomeLocation
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_updateHomeLocation__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)setHomeLocation:(int64_t)location
{
  v23 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  v5 = 0;
  homeLocation = self->_homeLocation;
  if (homeLocation != location)
  {
    self->_homeLocation = location;
    v5 = !self->_overrideHomeLocation;
  }

  os_unfair_recursive_lock_unlock();
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    if (v5)
    {
      v11 = @"Updated";
    }

    else
    {
      v11 = @"Did not update";
    }

    v12 = HMStringFromHomeLocation();
    v13 = HMStringFromHomeLocation();
    v15 = 138544130;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    v21 = 2112;
    v22 = v13;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ home location from %@ to %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v7);
  if (v5)
  {
    [(HMDHome *)selfCopy _handleHomeLocationChange:location previousLocation:homeLocation];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeLocationChange:(int64_t)change previousLocation:(int64_t)location
{
  v41[1] = *MEMORY[0x277D85DE8];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    name = [(HMDHome *)selfCopy name];
    shortDescription = [(HMDHome *)selfCopy shortDescription];
    v13 = HMStringFromHomeLocation();
    v14 = HMStringFromHomeLocation();
    *buf = 138544386;
    *&buf[4] = v10;
    v33 = 2112;
    v34 = name;
    v35 = 2112;
    v36 = shortDescription;
    v37 = 2112;
    v38 = v13;
    v39 = 2112;
    v40 = v14;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Location status for home %@/%@ changing from %@ to %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v7);
  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  [notificationCenter postNotificationName:@"HMDHomeLocationChangedNotification" object:selfCopy];

  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid = [(HMDHome *)selfCopy uuid];
  [homeManager updateGenerationCounterWithReason:@"HomeLocationChanged" sourceUUID:uuid shouldNotifyClients:0];

  v18 = MEMORY[0x277D0F818];
  v19 = *MEMORY[0x277CD0058];
  v20 = selfCopy;
  uuid2 = [(HMDHome *)v20 uuid];
  v41[0] = *MEMORY[0x277CD0068];
  v22 = [MEMORY[0x277CCABB0] numberWithInteger:change];
  *buf = v22;
  v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v41 count:1];
  v24 = [v18 homeLocationAuthorizedAndEntitledMessageWithName:v19 target:uuid2 messagePayload:v23];

  msgDispatcher = [(HMDHome *)v20 msgDispatcher];

  [msgDispatcher sendMessage:v24 completionHandler:0];
  if (change == 1)
  {
    workQueue = [(HMDHome *)v20 workQueue];
    v27 = workQueue;
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke;
    v31[3] = &unk_279735D00;
    v31[4] = v20;
    v28 = v31;
LABEL_10:
    dispatch_async(workQueue, v28);

    goto LABEL_11;
  }

  if (change == 3 && location != 2 || change == 2 && location != 3)
  {
    workQueue = [(HMDHome *)v20 workQueue];
    v27 = workQueue;
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1708;
    v30[3] = &unk_279735D00;
    v30[4] = v20;
    v28 = v30;
    goto LABEL_10;
  }

LABEL_11:
  v29 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Did arrive home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidArriveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__handleHomeLocationChange_previousLocation___block_invoke_1708(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Did leave home", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeDidLeaveHomeNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (int64_t)homeLocation
{
  os_unfair_recursive_lock_lock_with_options();
  if (self->_overrideHomeLocation)
  {
    v3 = &OBJC_IVAR___HMDHome__overriddenHomeLocation;
  }

  else
  {
    v3 = &OBJC_IVAR___HMDHome__homeLocation;
  }

  v4 = *(&self->super.super.isa + *v3);
  os_unfair_recursive_lock_unlock();
  return v4;
}

- (void)setAtHomeLevel:(int64_t)level
{
  v26 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  if (atHomeLevel != level)
  {
    self->_atHomeLevel = level;
  }

  os_unfair_recursive_lock_unlock();
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v9;
    v11 = @"Updated";
    if (atHomeLevel == level)
    {
      v11 = @"Did not update";
    }

    if (atHomeLevel > 3)
    {
      v12 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v12 = off_279722F30[atHomeLevel];
    }

    if (level > 3)
    {
      v13 = @"HMDAtHomeLevelNotAtHome";
    }

    else
    {
      v13 = off_279722F30[level];
    }

    v18 = 138544130;
    v19 = v9;
    v20 = 2112;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v13;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@%@ atHomeLevel from %@ to %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v6);
  if (atHomeLevel != level)
  {
    residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
    [residentDeviceManager atHomeLevelChanged:level];

    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid = [(HMDHome *)selfCopy uuid];
    [homeManager atHomeLevelChanged:level formerLevel:atHomeLevel home:uuid];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (int64_t)atHomeLevel
{
  os_unfair_recursive_lock_lock_with_options();
  atHomeLevel = self->_atHomeLevel;
  os_unfair_recursive_lock_unlock();
  return atHomeLevel;
}

- (BOOL)enabledResidentsSupportsHomeHub
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  availableResidentDevices = [residentDeviceManager availableResidentDevices];
  v4 = [availableResidentDevices na_any:&__block_literal_global_1698];

  return v4;
}

uint64_t __42__HMDHome_enabledResidentsSupportsHomeHub__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsHomeHub];

  return v3;
}

- (BOOL)currentDeviceSupportsSidekickSettings
{
  homeManager = [(HMDHome *)self homeManager];
  capabilitiesController = [homeManager capabilitiesController];
  currentResidentCapabilities = [capabilitiesController currentResidentCapabilities];
  supportsSiriEndpointSetup = [currentResidentCapabilities supportsSiriEndpointSetup];

  return supportsSiriEndpointSetup;
}

- (BOOL)supportsSiriEndpointOnBoarding
{
  v34 = *MEMORY[0x277D85DE8];
  primaryResident = [(HMDHome *)self primaryResident];
  capabilities = [primaryResident capabilities];
  supportsSiriEndpointSetup = [capabilities supportsSiriEndpointSetup];

  if (supportsSiriEndpointSetup)
  {
    array = [MEMORY[0x277CBEB18] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
    v8 = [appleMediaAccessories countByEnumeratingWithState:&v28 objects:v33 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v29;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v29 != v10)
          {
            objc_enumerationMutation(appleMediaAccessories);
          }

          device = [*(*(&v28 + 1) + 8 * i) device];
          if (device)
          {
            [array addObject:device];
          }
        }

        v9 = [appleMediaAccessories countByEnumeratingWithState:&v28 objects:v33 count:16];
      }

      while (v9);
    }

    v26 = 0u;
    v27 = 0u;
    v24 = 0u;
    v25 = 0u;
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    v15 = [residentDevices countByEnumeratingWithState:&v24 objects:v32 count:16];
    if (v15)
    {
      v16 = *v25;
      do
      {
        for (j = 0; j != v15; ++j)
        {
          if (*v25 != v16)
          {
            objc_enumerationMutation(residentDevices);
          }

          v18 = *(*(&v24 + 1) + 8 * j);
          device2 = [v18 device];
          capabilities2 = [v18 capabilities];
          if ([capabilities2 supportsHomeHub])
          {
            v21 = [array containsObject:device2];

            if (v21)
            {

              LOBYTE(v15) = 1;
              goto LABEL_24;
            }
          }

          else
          {
          }
        }

        v15 = [residentDevices countByEnumeratingWithState:&v24 objects:v32 count:16];
      }

      while (v15);
    }

LABEL_24:
  }

  else
  {
    LOBYTE(v15) = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v15;
}

- (void)handleSiriEndPointAddedNotification:(id)notification
{
  v27 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  object = [notificationCopy object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = object;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (!v7)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v12;
      v23 = 2112;
      v24 = notificationCopy;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Unable to synchronize settings after receiving endpoint added notification with no HAP accessory. %@", &v21, 0x16u);
      goto LABEL_10;
    }

LABEL_11:

    objc_autoreleasePoolPop(v9);
    goto LABEL_12;
  }

  home = [v7 home];

  if (home != self)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      home2 = [v7 home];
      v21 = 138543874;
      v22 = v12;
      v23 = 2112;
      v24 = v7;
      v25 = 2112;
      v26 = home2;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@New accessory is added for another home for HAP accessory: %@ home:%@", &v21, 0x20u);

LABEL_10:
      goto LABEL_11;
    }

    goto LABEL_11;
  }

  siriEndpointProfile = [v7 siriEndpointProfile];

  if (siriEndpointProfile)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v19;
      v23 = 2112;
      v24 = v7;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@A siri endpoint accessory is added. Confirm resident device: %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    residentDeviceManager = [(HMDHome *)selfCopy3 residentDeviceManager];
    [residentDeviceManager confirmWithCompletionHandler:0];
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableNotifications:(id)notifications
{
  v50 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v43 = 0;
  v6 = [notificationsCopy BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v43];
  v42 = 0;
  v7 = [notificationsCopy BOOLForKey:*MEMORY[0x277CCFED8] keyPresent:&v42];
  if (v43 == 1 && (v42 & 1) != 0)
  {
    v8 = v7;
    clientIdentifier = [notificationsCopy clientIdentifier];
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    v13 = v12;
    if (clientIdentifier)
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = HMFBooleanToString();
        *buf = 138543874;
        v45 = v14;
        v46 = 2112;
        v47 = clientIdentifier;
        v48 = 2112;
        v49 = v15;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Handling Enable Notifications from ClientIdentifier: %@, setting: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v10);
      if (v6)
      {
        [(HMDHome *)selfCopy removeNotificationDeregistrationForClientIdentifier:clientIdentifier];
        notificationRegistrations = [(HMDHome *)selfCopy notificationRegistrations];
        v17 = [notificationRegistrations count];

        notificationRegistrationsForAppleMediaAccessories = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
        v19 = ([notificationRegistrationsForAppleMediaAccessories count] == 0) & v8;

        [(HMDHome *)selfCopy addNotificationRegistrationForClientIdentifier:clientIdentifier includesAppleMediaAccessories:v8];
        if (v19 == 1)
        {
          v20 = objc_autoreleasePoolPush();
          v21 = selfCopy;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            v23 = HMFGetLogIdentifier();
            *buf = 138543362;
            v45 = v23;
            _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Modifying direct Apple Media notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v20);
          [(HMDHome *)v21 _subscribeForHomeAppleMediaNotificationsOnDirectTransports:?];
        }

        if (!v17)
        {
          v24 = objc_autoreleasePoolPush();
          v25 = selfCopy;
          v26 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
          {
            v27 = HMFGetLogIdentifier();
            *buf = 138543362;
            v45 = v27;
            _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to HomeKit client request", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          [(HMDHome *)v25 _subscribeForHomeNotificationsFromRemoteGateway:1];
          [(HMDHome *)v25 _subscribeForHomeNotificationsOnDirectTransports:?];
          date = [MEMORY[0x277CBEAA8] date];
          [(HMDHome *)v25 setNotificationsUpdatedTime:date];
        }

        homeManager = [(HMDHome *)selfCopy homeManager];
        chipDataSource = [homeManager chipDataSource];
        [chipDataSource updateNotificationsEnabled:1 forHome:selfCopy keepAliveOnly:0];

        logAndPostNotification(@"HMDHomeDidEnableCharacteristicNotifyEventNotification", selfCopy, 0);
        [(HMDHome *)selfCopy _refreshCharacteristicValuesOnHomeNotificationEnable];
        if (v8)
        {
          [(HMDHome *)selfCopy _refreshMediaProfilesOnHomeNotificationEnable];
        }
      }

      else
      {
        [(HMDHome *)selfCopy addNotificationDeregistrationForClientIdentifier:clientIdentifier];
        [(HMDHome *)selfCopy _startHomeNotificationDeregistrationTimer];
      }

      mEMORY[0x277D0F8C0] = [MEMORY[0x277D0F8C0] sharedPowerLogger];
      [mEMORY[0x277D0F8C0] reportCharacteristicNotificationRegistrationEvent:v6 clientIdentifier:clientIdentifier];

      [notificationsCopy respondWithSuccess];
    }

    else
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v38;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Unable to look up the client identifier from request to enable home notifications", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      clientIdentifier = [notificationsCopy responseHandler];

      if (clientIdentifier)
      {
        responseHandler = [notificationsCopy responseHandler];
        v40 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        (responseHandler)[2](responseHandler, v40, 0);

        clientIdentifier = 0;
      }
    }
  }

  else
  {
    v31 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      v35 = HMFBooleanToString();
      v36 = HMFBooleanToString();
      *buf = 138543874;
      v45 = v34;
      v46 = 2112;
      v47 = v35;
      v48 = 2112;
      v49 = v36;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Client request missing required key (hasHAPKey: %@, hasAppleMediaKey: %@) to enable home notifications", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v31);
    clientIdentifier = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [notificationsCopy respondWithError:clientIdentifier];
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)_refreshMediaProfilesOnHomeNotificationEnable
{
  v37 = *MEMORY[0x277D85DE8];
  strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  array = [MEMORY[0x277CBEB18] array];
  supportsUnifiedMediaNotificationsOnResidents = [(HMDHome *)self supportsUnifiedMediaNotificationsOnResidents];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  selfCopy = self;
  obj = [(HMDHome *)self accessories];
  v5 = [obj countByEnumeratingWithState:&v31 objects:v36 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v32;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v32 != v7)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v31 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          device = [v11 device];
          if ((device == 0) | supportsUnifiedMediaNotificationsOnResidents & 1)
          {
            mediaProfile = [v11 mediaProfile];
            [array addObject:mediaProfile];
          }

          else
          {
            v14 = array;
            mediaProfile = [strongToStrongObjectsMapTable objectForKey:device];
            if (!mediaProfile)
            {
              mediaProfile = [MEMORY[0x277CBEB18] array];
              [strongToStrongObjectsMapTable setObject:mediaProfile forKey:device];
            }

            mediaProfile2 = [v11 mediaProfile];
            [mediaProfile addObject:mediaProfile2];

            array = v14;
          }
        }
      }

      v6 = [obj countByEnumeratingWithState:&v31 objects:v36 count:16];
    }

    while (v6);
  }

  if ([array count])
  {
    [(HMDHome *)selfCopy _readProfileState:array viaDevice:0];
  }

  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  v16 = strongToStrongObjectsMapTable;
  v17 = [v16 countByEnumeratingWithState:&v27 objects:v35 count:16];
  if (v17)
  {
    v18 = v17;
    v19 = *v28;
    do
    {
      for (j = 0; j != v18; ++j)
      {
        if (*v28 != v19)
        {
          objc_enumerationMutation(v16);
        }

        v21 = *(*(&v27 + 1) + 8 * j);
        v22 = [v16 objectForKey:v21];
        if ([v22 count])
        {
          [(HMDHome *)selfCopy _readProfileState:v22 viaDevice:v21];
        }
      }

      v18 = [v16 countByEnumeratingWithState:&v27 objects:v35 count:16];
    }

    while (v18);
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_readProfileState:(void *)state viaDevice:
{
  v30 = *MEMORY[0x277D85DE8];
  v19 = a2;
  stateCopy = state;
  val = self;
  if (self)
  {
    v5 = MEMORY[0x277CBEB18];
    v6 = [v19 count];
    v7 = +[HMDMediaSession mediaPropertyMessageKeys];
    v8 = [v5 arrayWithCapacity:{objc_msgSend(v7, "count") * v6}];

    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    obj = v19;
    v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v9)
    {
      v10 = *v26;
      v11 = MEMORY[0x277D85DD0];
      do
      {
        v12 = 0;
        do
        {
          if (*v26 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v13 = *(*(&v25 + 1) + 8 * v12);
          v14 = +[HMDMediaSession mediaPropertyMessageKeys];
          v24[0] = v11;
          v24[1] = 3221225472;
          v24[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke;
          v24[3] = &unk_2797330F0;
          v24[4] = v13;
          v15 = [v14 na_map:v24];

          [v8 addObjectsFromArray:v15];
          ++v12;
        }

        while (v9 != v12);
        v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      }

      while (v9);
    }

    objc_initWeak(&location, val);
    v21[0] = MEMORY[0x277D85DD0];
    v21[1] = 3221225472;
    v21[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_2;
    v21[3] = &unk_279735360;
    objc_copyWeak(&v22, &location);
    [val redispatchMediaReadRequests:v8 viaDevice:stateCopy completion:v21];
    objc_destroyWeak(&v22);
    objc_destroyWeak(&location);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = [WeakRetained workQueue];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __39__HMDHome__readProfileState_viaDevice___block_invoke_3;
    v7[3] = &unk_2797359B0;
    v8 = v3;
    v9 = v5;
    dispatch_async(v6, v7);
  }
}

void __39__HMDHome__readProfileState_viaDevice___block_invoke_3(uint64_t a1)
{
  v1 = a1;
  v148 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(*(a1 + 32), "count")}];
  v120 = 0u;
  v121 = 0u;
  v122 = 0u;
  v123 = 0u;
  obj = *(v1 + 32);
  v95 = v1;
  v100 = v2;
  v98 = [obj countByEnumeratingWithState:&v120 objects:v147 count:16];
  if (v98)
  {
    v97 = *v121;
    v115 = *MEMORY[0x277CD0910];
    v112 = *MEMORY[0x277CD0938];
    v110 = *MEMORY[0x277CD0990];
    v108 = *MEMORY[0x277CD0960];
    v106 = *MEMORY[0x277CD09B0];
    v104 = *MEMORY[0x277CD0920];
    *&v3 = 138544130;
    v93 = v3;
    do
    {
      v4 = 0;
      do
      {
        if (*v121 != v97)
        {
          objc_enumerationMutation(obj);
        }

        v103 = v4;
        v5 = *(*(&v120 + 1) + 8 * v4);
        v116 = 0u;
        v117 = 0u;
        v118 = 0u;
        v119 = 0u;
        v6 = v5;
        v7 = [v6 countByEnumeratingWithState:&v116 objects:v146 count:16];
        if (!v7)
        {

          v9 = 0;
          v111 = 0;
          v109 = 0;
          v107 = 0;
          v105 = 0;
LABEL_56:
          v32 = [v9 mediaSession];
          v38 = [v32 state];
          v8 = 0;
          goto LABEL_57;
        }

        v105 = 0;
        v107 = 0;
        v109 = 0;
        v111 = 0;
        v113 = 0;
        v8 = 0;
        v9 = 0;
        v10 = *v117;
        do
        {
          for (i = 0; i != v7; i = i + 1)
          {
            if (*v117 != v10)
            {
              objc_enumerationMutation(v6);
            }

            v12 = *(*(&v116 + 1) + 8 * i);
            v13 = [v12 error];

            if (!v13)
            {
              v14 = [v12 request];
              v15 = [v14 mediaProfile];

              v16 = [v14 property];
              v17 = [v16 isEqual:v115];

              if (v17)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v8;
                v8 = v19;
                goto LABEL_42;
              }

              v21 = [v14 property];
              v22 = [v21 isEqual:v112];

              if (v22)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v113;
                v113 = v19;
                goto LABEL_42;
              }

              v23 = [v14 property];
              v24 = [v23 isEqual:v110];

              if (v24)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v111;
                v111 = v19;
                goto LABEL_42;
              }

              v25 = [v14 property];
              v26 = [v25 isEqual:v108];

              if (v26)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v109;
                v109 = v19;
                goto LABEL_42;
              }

              v27 = [v14 property];
              v28 = [v27 isEqual:v106];

              if (v28)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v107;
                v107 = v19;
                goto LABEL_42;
              }

              v29 = [v14 property];
              v30 = [v29 isEqual:v104];

              if (v30)
              {
                v18 = [v12 value];
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v19 = v18;
                }

                else
                {
                  v19 = 0;
                }

                v20 = v105;
                v105 = v19;
LABEL_42:
                v31 = v19;
              }

              v9 = v15;
              continue;
            }
          }

          v7 = [v6 countByEnumeratingWithState:&v116 objects:v146 count:16];
        }

        while (v7);

        v2 = v100;
        if (!v8)
        {
          v1 = v95;
          v7 = v113;
          goto LABEL_56;
        }

        v32 = [v9 accessory];
        v33 = [v9 uniqueIdentifier];
        v34 = [v33 UUIDString];
        v35 = [v8 isEqualToString:v34];

        v1 = v95;
        v7 = v113;
        if (v35)
        {
          v36 = [v32 identifier];

          v8 = v36;
        }

        v37 = [v32 home];
        v38 = [v37 mediaSessionStateWithIdentifier:v8];
        if (!v38)
        {
          v39 = objc_autoreleasePoolPush();
          v40 = *(v95 + 40);
          v41 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v42 = v101 = v39;
            v43 = [v32 identifier];
            v44 = *(v95 + 32);
            *buf = v93;
            v139 = v42;
            v140 = 2112;
            v141 = v8;
            v142 = 2112;
            v143 = v43;
            v144 = 2112;
            v145 = v44;
            _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Creating a media session state for a remote session (sessionIdentifier %@; accessoryIdentifier %@) update - responses %@", buf, 0x2Au);

            v39 = v101;
          }

          objc_autoreleasePoolPop(v39);
          v38 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:v8];
          [v37 addMediaSessionState:v38];
          v7 = v113;
          v1 = v95;
        }

LABEL_57:
        v45 = [v9 accessory];
        v46 = [v45 uuid];
        v47 = [v46 UUIDString];

        if (v47 && v38)
        {
          v96 = v45;
          v48 = MEMORY[0x277CBEB38];
          v99 = v47;
          v49 = [v2 hmf_dictionaryForKey:v47];
          v50 = [v48 dictionaryWithDictionary:v49];

          v51 = v7 != 0;
          v114 = v7;
          v102 = v38;
          v52 = v50;
          if (v7)
          {
            v53 = [v7 unsignedIntegerValue];
            [(HMDMediaSessionState *)v38 setPlaybackState:v53];
            v54 = objc_autoreleasePoolPush();
            v55 = *(v1 + 40);
            v56 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
            {
              v57 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v57;
              v140 = 2048;
              v141 = v53;
              _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@Read the profile playback state as %tu", buf, 0x16u);

              v38 = v102;
            }

            objc_autoreleasePoolPop(v54);
            v136 = v112;
            v137 = v114;
            v58 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v137 forKeys:&v136 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v58];
          }

          if (v111)
          {
            v59 = [v111 unsignedIntegerValue];
            [(HMDMediaSessionState *)v38 setShuffleState:v59];
            v60 = objc_autoreleasePoolPush();
            v61 = *(v1 + 40);
            v62 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
            {
              v63 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v63;
              v140 = 2048;
              v141 = v59;
              _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@Read the profile shuffle state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v60);
            v134 = v110;
            v135 = v111;
            v51 = 1;
            v64 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v135 forKeys:&v134 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v64];
          }

          if (v109)
          {
            v65 = [v109 unsignedIntegerValue];
            [(HMDMediaSessionState *)v102 setRepeatState:v65];
            v66 = objc_autoreleasePoolPush();
            v67 = *(v1 + 40);
            v68 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
            {
              v69 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v69;
              v140 = 2048;
              v141 = v65;
              _os_log_impl(&dword_2531F8000, v68, OS_LOG_TYPE_INFO, "%{public}@Read the profile repeat state as %tu", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v66);
            v132 = v108;
            v133 = v109;
            v51 = 1;
            v70 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v133 forKeys:&v132 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v70];
          }

          v7 = v114;
          if (v107)
          {
            [(HMDMediaSessionState *)v102 setVolume:v107];
            v71 = objc_autoreleasePoolPush();
            v72 = *(v1 + 40);
            v73 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v73, OS_LOG_TYPE_INFO))
            {
              v74 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v74;
              v140 = 2112;
              v141 = v107;
              _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_INFO, "%{public}@Read the profile volume as %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v71);
            v130 = v106;
            v131 = v107;
            v75 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v131 forKeys:&v130 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v75];

            v38 = v102;
            v47 = v99;
            if (!v105)
            {
LABEL_80:
              [v100 setObject:v50 forKey:v47];
              goto LABEL_81;
            }

LABEL_77:
            [(HMDMediaSessionState *)v38 setMediaUniqueIdentifier:v105];
            v76 = objc_autoreleasePoolPush();
            v77 = *(v1 + 40);
            v78 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
            {
              v79 = HMFGetLogIdentifier();
              *buf = 138543618;
              v139 = v79;
              v140 = 2112;
              v141 = v105;
              _os_log_impl(&dword_2531F8000, v78, OS_LOG_TYPE_INFO, "%{public}@Read the profile mediaUniqueIdentifier state as %@", buf, 0x16u);

              v38 = v102;
            }

            objc_autoreleasePoolPop(v76);
            v128 = v104;
            v129 = v105;
            v80 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v129 forKeys:&v128 count:1];
            v50 = v52;
            [v52 addEntriesFromDictionary:v80];

            v47 = v99;
            goto LABEL_80;
          }

          v38 = v102;
          v47 = v99;
          if (v105)
          {
            goto LABEL_77;
          }

          if (v51)
          {
            goto LABEL_80;
          }

LABEL_81:

          v2 = v100;
          v45 = v96;
        }

        v4 = v103 + 1;
      }

      while (v103 + 1 != v98);
      v81 = [obj countByEnumeratingWithState:&v120 objects:v147 count:16];
      v98 = v81;
    }

    while (v81);
  }

  if ([v2 count])
  {
    v82 = [*(v1 + 40) uuid];
    v83 = [v82 UUIDString];
    v126 = v83;
    v124 = *MEMORY[0x277CCE7A8];
    v84 = [v100 copy];
    v125 = v84;
    v85 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v125 forKeys:&v124 count:1];
    v127 = v85;
    v86 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v127 forKeys:&v126 count:1];

    v87 = [MEMORY[0x277D0F848] entitledMessageWithName:*MEMORY[0x277CD0340] messagePayload:v86];
    v88 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:0 options:-1 active:1];
    [v87 setSendPolicy:v88];

    v89 = [*(v95 + 40) msgDispatcher];
    v90 = [*(v95 + 40) homeManager];
    v91 = [v90 uuid];
    [v89 sendMessage:v87 target:v91];

    v1 = v95;
    v2 = v100;
  }

  [(HMDHome *)*(v1 + 40) updateMediaStateWithResponses:0 requestMessageInformation:?];

  v92 = *MEMORY[0x277D85DE8];
}

- (void)updateMediaStateWithResponses:(void *)responses requestMessageInformation:
{
  v43 = *MEMORY[0x277D85DE8];
  v5 = a2;
  responsesCopy = responses;
  v7 = responsesCopy;
  if (self)
  {
    v30 = responsesCopy;
    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v37 = 0u;
    v38 = 0u;
    v39 = 0u;
    v40 = 0u;
    v29 = v5;
    obj = v5;
    v8 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v38;
      do
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v38 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v37 + 1) + 8 * i);
          firstObject = [v12 firstObject];
          request = [firstObject request];
          mediaProfile = [request mediaProfile];
          v16 = mediaProfile;
          if (mediaProfile)
          {
            mediaSession = [mediaProfile mediaSession];
            if (mediaSession)
            {
              v18 = [strongToStrongObjectsMapTable objectForKey:mediaSession];
              v19 = [v18 mutableCopy];

              if (v19)
              {
                [v19 addObjectsFromArray:v12];
              }

              else
              {
                v19 = [v12 mutableCopy];
              }

              v20 = [v19 copy];
              [strongToStrongObjectsMapTable setObject:v20 forKey:mediaSession];
            }

            else
            {
              [v16 updateWithResponses:v12 requestMessageInformation:v30];
            }
          }
        }

        v9 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
      }

      while (v9);
    }

    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    hm_allKeys = [strongToStrongObjectsMapTable hm_allKeys];
    v22 = [hm_allKeys countByEnumeratingWithState:&v33 objects:v41 count:16];
    v7 = v30;
    if (v22)
    {
      v23 = v22;
      v24 = *v34;
      do
      {
        for (j = 0; j != v23; ++j)
        {
          if (*v34 != v24)
          {
            objc_enumerationMutation(hm_allKeys);
          }

          v26 = *(*(&v33 + 1) + 8 * j);
          v27 = [strongToStrongObjectsMapTable objectForKey:{v26, v29}];
          [v26 updateWithResponses:v27 requestMessageInformation:v30];
        }

        v23 = [hm_allKeys countByEnumeratingWithState:&v33 objects:v41 count:16];
      }

      while (v23);
    }

    v5 = v29;
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_refreshCharacteristicValuesOnHomeNotificationEnable
{
  v76 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v49 = [MEMORY[0x277CBEB58] set];
  v63 = 0u;
  v64 = 0u;
  v65 = 0u;
  v66 = 0u;
  selfCopy = self;
  obj = [(HMDHome *)self accessories];
  v46 = [obj countByEnumeratingWithState:&v63 objects:v75 count:16];
  if (v46)
  {
    v44 = *v64;
    do
    {
      v4 = 0;
      do
      {
        if (*v64 != v44)
        {
          objc_enumerationMutation(obj);
        }

        v48 = v4;
        v5 = *(*(&v63 + 1) + 8 * v4);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v6 = v5;
        }

        else
        {
          v6 = 0;
        }

        v7 = v6;

        v62[0] = MEMORY[0x277D85DD0];
        v62[1] = 3221225472;
        v62[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke;
        v62[3] = &unk_279733D48;
        v62[4] = selfCopy;
        v8 = [v7 characteristicsPassingTest:v62];
        v58 = 0u;
        v59 = 0u;
        v60 = 0u;
        v61 = 0u;
        v9 = [v8 countByEnumeratingWithState:&v58 objects:v74 count:16];
        if (v9)
        {
          v10 = v9;
          v11 = *v59;
          do
          {
            for (i = 0; i != v10; ++i)
            {
              if (*v59 != v11)
              {
                objc_enumerationMutation(v8);
              }

              v13 = [HMDCharacteristicRequest requestWithCharacteristic:*(*(&v58 + 1) + 8 * i)];
              [array addObject:v13];
            }

            v10 = [v8 countByEnumeratingWithState:&v58 objects:v74 count:16];
          }

          while (v10);
        }

        v56 = 0u;
        v57 = 0u;
        v54 = 0u;
        v55 = 0u;
        v47 = v7;
        lightProfiles = [v7 lightProfiles];
        allObjects = [lightProfiles allObjects];

        v16 = [allObjects countByEnumeratingWithState:&v54 objects:v73 count:16];
        if (v16)
        {
          v17 = v16;
          v18 = *v55;
          do
          {
            for (j = 0; j != v17; ++j)
            {
              if (*v55 != v18)
              {
                objc_enumerationMutation(allObjects);
              }

              v20 = *(*(&v54 + 1) + 8 * j);
              readCharacteristicRequests = [v20 readCharacteristicRequests];
              if ([readCharacteristicRequests count])
              {
                allObjects2 = [readCharacteristicRequests allObjects];
                [array addObjectsFromArray:allObjects2];

                [v49 addObject:v20];
              }
            }

            v17 = [allObjects countByEnumeratingWithState:&v54 objects:v73 count:16];
          }

          while (v17);
        }

        v4 = v48 + 1;
      }

      while (v48 + 1 != v46);
      v46 = [obj countByEnumeratingWithState:&v63 objects:v75 count:16];
    }

    while (v46);
  }

  hmf_isEmpty = [array hmf_isEmpty];
  v24 = objc_autoreleasePoolPush();
  v25 = selfCopy;
  v26 = HMFGetOSLogHandle();
  v27 = os_log_type_enabled(v26, OS_LOG_TYPE_INFO);
  if (hmf_isEmpty)
  {
    v28 = v49;
    if (v27)
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543362;
      v70 = v29;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Not refreshing characteristics as read requests are empty", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v24);
  }

  else
  {
    v28 = v49;
    if (v27)
    {
      v30 = HMFGetLogIdentifier();
      v31 = [array count];
      *buf = 138543618;
      v70 = v30;
      v71 = 2048;
      v72 = v31;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Issuing %ld characteristic read requests when Home app enabled notifications", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v32 = MEMORY[0x277D0F818];
    allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
    v67 = @"kMultiPartResponseKey";
    v68 = MEMORY[0x277CBEC38];
    v34 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v68 forKeys:&v67 count:1];
    v35 = [v32 messageWithName:@"kMultipleCharacteristicReadRequestKey" destination:allMessageDestinations payload:v34];

    v36 = objc_autoreleasePoolPush();
    v37 = v25;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      identifier = [v35 identifier];
      *buf = 138543618;
      v70 = v39;
      v71 = 2114;
      v72 = identifier;
      _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: App enabled notifications", buf, 0x16u);

      v28 = v49;
    }

    objc_autoreleasePoolPop(v36);
    v41 = [array copy];
    v50[0] = MEMORY[0x277D85DD0];
    v50[1] = 3221225472;
    v50[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1695;
    v50[3] = &unk_279730A88;
    v51 = array;
    v52 = v37;
    v53 = v28;
    [(HMDHome *)v37 _readCharacteristicValues:v41 requestMessage:v35 source:1120 withCompletionHandler:v50];
  }

  v42 = *MEMORY[0x277D85DE8];
}

uint64_t __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 type];
  v5 = [v3 service];

  v6 = [v5 type];

  v7 = [*(a1 + 32) dataSource];
  v8 = [v7 hapMetadata];
  v9 = [v8 shouldRefreshValueForCharacteristicWithType:v4 serviceType:v6];

  return v9;
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1695(uint64_t a1, void *a2, void *a3)
{
  v59 = *MEMORY[0x277D85DE8];
  v36 = a2;
  v37 = a3;
  v47 = 0u;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v5 = a1;
  obj = *(a1 + 32);
  v6 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v48;
    *&v7 = 138543874;
    v33 = v7;
    v34 = *v48;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v48 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v47 + 1) + 8 * i);
        v12 = [v11 characteristic];
        v46 = 0;
        v13 = [v37 hmd_valueOfCharacteristic:v12 error:&v46];
        v14 = v46;

        v15 = objc_autoreleasePoolPush();
        v16 = *(v5 + 40);
        v17 = HMFGetOSLogHandle();
        v18 = v17;
        if (v13)
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v13;
          v20 = v18;
          v21 = OS_LOG_TYPE_INFO;
          v22 = "%{public}@Characteristic read request succeeded when Home app enabled notifications %@:%@";
        }

        else
        {
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_12;
          }

          v19 = HMFGetLogIdentifier();
          *buf = v33;
          v53 = v19;
          v54 = 2112;
          v55 = v11;
          v56 = 2112;
          v57 = v14;
          v20 = v18;
          v21 = OS_LOG_TYPE_ERROR;
          v22 = "%{public}@Characteristic read request when Home app enabled notification failed %@:%@";
        }

        _os_log_impl(&dword_2531F8000, v20, v21, v22, buf, 0x20u);

        v9 = v34;
LABEL_12:

        objc_autoreleasePoolPop(v15);
      }

      v8 = [obj countByEnumeratingWithState:&v47 objects:v58 count:16];
    }

    while (v8);
  }

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  v23 = *(v5 + 48);
  v24 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
  if (v24)
  {
    v25 = v24;
    v26 = *v43;
    do
    {
      for (j = 0; j != v25; ++j)
      {
        if (*v43 != v26)
        {
          objc_enumerationMutation(v23);
        }

        v28 = *(*(&v42 + 1) + 8 * j);
        v29 = [v28 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1696;
        block[3] = &unk_279734870;
        block[4] = v28;
        v30 = v37;
        v31 = *(v5 + 40);
        v39 = v30;
        v40 = v31;
        v41 = v36;
        dispatch_async(v29, block);
      }

      v25 = [v23 countByEnumeratingWithState:&v42 objects:v51 count:16];
    }

    while (v25);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __63__HMDHome__refreshCharacteristicValuesOnHomeNotificationEnable__block_invoke_1696(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 48);
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForWalletKeyChange:(id)change message:(id)message
{
  v17 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for wallet key value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  hasOnboardedForWalletKey = [changeCopy hasOnboardedForWalletKey];
  -[HMDHome setHasOnboardedForWalletKey:](selfCopy, "setHasOnboardedForWalletKey:", [hasOnboardedForWalletKey BOOLValue]);

  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  [notificationCenter postNotificationName:@"HMDHomeHasOnboardedForWalletKeyChangeNotification" object:selfCopy];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeChange:(id)change message:(id)message
{
  v17 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543362;
    v16 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has onboarded for access code value changed, sending notification", &v15, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  hasOnboardedForAccessCode = [changeCopy hasOnboardedForAccessCode];
  -[HMDHome setHasOnboardedForAccessCode:](selfCopy, "setHasOnboardedForAccessCode:", [hasOnboardedForAccessCode BOOLValue]);

  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  [notificationCenter postNotificationName:@"HMDHomeHasOnboardedForAccessCodeChangeNotification" object:selfCopy];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleHasAnyUserAcknowledgedCameraRecordingOnboardingChange:(id)change message:(id)message
{
  v16 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v14 = 138543362;
    v15 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Home's has any user acknowledged camera recording onboarding value changed, sending notification", &v14, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  hasAnyUserAcknowledgedCameraRecordingOnboarding = [changeCopy hasAnyUserAcknowledgedCameraRecordingOnboarding];
  -[HMDHome setHasAnyUserAcknowledgedCameraRecordingOnboarding:](selfCopy, "setHasAnyUserAcknowledgedCameraRecordingOnboarding:", [hasAnyUserAcknowledgedCameraRecordingOnboarding BOOLValue]);

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleResolveThreadNetworkRequest:(id)request
{
  v22 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v21 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve thread network credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    threadOperationalDataset = [(HMDHome *)selfCopy threadOperationalDataset];
    objc_initWeak(buf, selfCopy);
    doesHomeContainResident = [(HMDHome *)selfCopy doesHomeContainResident];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke;
    v17[3] = &unk_279723910;
    objc_copyWeak(&v19, buf);
    v18 = requestCopy;
    [v9 retrieveMetadata:threadOperationalDataset homeHasResident:doesHomeContainResident completion:v17];

    objc_destroyWeak(&v19);
    objc_destroyWeak(buf);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v21 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    threadOperationalDataset = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [requestCopy respondWithError:threadOperationalDataset];
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleResolveThreadNetworkRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 && WeakRetained)
  {
    v25 = 0;
    v9 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v5 requiringSecureCoding:1 error:&v25];
    v10 = v25;
    if (v9)
    {
      v11 = *(a1 + 32);
      v26 = *MEMORY[0x277CD0620];
      v27 = v9;
      v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
      [v11 respondWithPayload:v12];
    }

    else
    {
      v19 = objc_autoreleasePoolPush();
      v20 = v8;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138543618;
        v29 = v22;
        v30 = 2112;
        v31 = v10;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v19);
      v23 = *(a1 + 32);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v23 respondWithError:v12];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = v8;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v17 = [v14 threadNetworkID];
      *buf = 138543874;
      v29 = v16;
      v30 = 2112;
      v31 = v17;
      v32 = 2112;
      v33 = v6;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = *(a1 + 32);
    v10 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v18 respondWithError:v10];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateDidOnboardLocationServicesRequest:(id)request
{
  v35 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update did onboard locations services request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  messagePayload = [requestCopy messagePayload];
  v11 = *MEMORY[0x277CCFEB0];
  v30 = 0;
  v12 = [messagePayload hmf_BOOLForKey:v11 error:&v30];
  v13 = v30;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = selfCopy;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      messagePayload2 = [requestCopy messagePayload];
      *buf = 138543618;
      v32 = v17;
      v33 = 2112;
      v34 = messagePayload2;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode did onboard location services from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [requestCopy respondWithError:v13];
  }

  else
  {
    v19 = [HMDHomeModel alloc];
    uuid = [(HMDHome *)selfCopy uuid];
    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid2 = [homeManager uuid];
    v23 = [(HMDBackingStoreModelObject *)v19 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

    v24 = [MEMORY[0x277CCABB0] numberWithBool:v12];
    [(HMDHomeModel *)v23 setDidOnboardLocationServices:v24];

    backingStore = [(HMDHome *)selfCopy backingStore];
    name = [requestCopy name];
    v27 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v28 = [backingStore transaction:name options:v27];

    [v28 add:v23 withMessage:requestCopy];
    [v28 run];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleDidOnboardLocationServicesChange:(id)change message:(id)message
{
  v20 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  didOnboardLocationServices = [changeCopy didOnboardLocationServices];
  bOOLValue = [didOnboardLocationServices BOOLValue];

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating did onboard location services: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)selfCopy setDidOnboardLocationServices:bOOLValue];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleHomeUpdateLocationServicesEnabledRequest:(id)request
{
  v25 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v22 = v9;
    v23 = 2112;
    v24 = requestCopy;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update location services enabled request message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  messagePayload = [requestCopy messagePayload];
  v11 = *MEMORY[0x277CD0050];
  v20 = 0;
  v12 = [messagePayload hmf_BOOLForKey:v11 error:&v20];
  v13 = v20;

  if (v13)
  {
    v14 = objc_autoreleasePoolPush();
    v15 = selfCopy;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      messagePayload2 = [requestCopy messagePayload];
      *buf = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = messagePayload2;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode location services enabled from update request payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    [requestCopy respondWithError:v13];
  }

  else
  {
    [(HMDHome *)selfCopy runLocationServicesEnabledUpdateWithValue:v12 message:requestCopy];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_handleLocationServicesEnabledChange:(id)change message:(id)message
{
  v20 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  locationServicesEnabled = [changeCopy locationServicesEnabled];
  bOOLValue = [locationServicesEnabled BOOLValue];

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = HMFBooleanToString();
    v16 = 138543618;
    v17 = v13;
    v18 = 2112;
    v19 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updating location services enabled: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  [(HMDHome *)selfCopy setLocationServicesEnabled:bOOLValue];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckUpdateRequest:(id)request
{
  v28 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update soundCheck request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  messagePayload = [requestCopy messagePayload];
  v16 = *MEMORY[0x277CD05F0];
  v25 = 0;
  v17 = [messagePayload hmf_BOOLForKey:v16 error:&v25];
  v18 = v25;

  if (v18)
  {
    [requestCopy respondWithError:v18];
  }

  else
  {
    v19 = [MEMORY[0x277CCABB0] numberWithBool:v17];
    [(HMDHomeModel *)v14 setSoundCheckEnabled:v19];

    backingStore = [(HMDHome *)selfCopy backingStore];
    name = [requestCopy name];
    v22 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
    v23 = [backingStore transaction:name options:v22];

    [v23 add:v14 withMessage:requestCopy];
    [v23 run];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleSoundCheckChange:(id)change message:(id)message
{
  soundCheckEnabled = [change soundCheckEnabled];
  -[HMDHome setSoundCheckEnabled:](self, "setSoundCheckEnabled:", [soundCheckEnabled BOOLValue]);
}

- (void)enableUserListeningHistoryForAccessoryUUID:(id)d userUUID:(id)iD
{
  v22 = *MEMORY[0x277D85DE8];
  dCopy = d;
  iDCopy = iD;
  v8 = [(HMDHome *)self userWithUUID:iDCopy];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v13;
      v18 = 2112;
      v19 = dCopy;
      v20 = 2112;
      v21 = v8;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Enable ULH: accessoryUUID %@ user %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [(HMDHome *)v8 enableUserListeningHistoryForAccessory:dCopy];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v14;
      v18 = 2112;
      v19 = iDCopy;
      v20 = 2112;
      v21 = selfCopy;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@No user exist for userUUID %@ in home %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:(id)ds
{
  dsCopy = ds;
  v5 = __decodeAndVerifyCurrentUser(self, dsCopy);
  [v5 handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs:dsCopy];
}

- (void)_handleMediaContentProfileAccessControlUpdate:(id)update
{
  updateCopy = update;
  v5 = __decodeAndVerifyCurrentUser(self, updateCopy);
  [v5 handleMediaContentProfileAccessControlUpdate:updateCopy];
}

- (void)_handleAssistantAccessControlUpdate:(id)update
{
  updateCopy = update;
  v5 = __decodeAndVerifyCurrentUser(self, updateCopy);
  [v5 handleAssistantAccessControlUpdate:updateCopy];
}

- (void)_handleSiriPhraseOptionsUpdateRequest:(id)request
{
  v26 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v24 = 138543362;
    v25 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received update Siri phrase options request", &v24, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  v10 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v14 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  messagePayload = [requestCopy messagePayload];
  v16 = [messagePayload hmf_numberForKey:*MEMORY[0x277CD05E0]];
  unsignedIntegerValue = [v16 unsignedIntegerValue];

  v18 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:unsignedIntegerValue];
  [(HMDHomeModel *)v14 setSiriPhraseOptions:v18];

  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [requestCopy name];
  v21 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v22 = [backingStore transaction:name options:v21];

  [v22 add:v14 withMessage:requestCopy];
  [v22 run];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)_handleSiriPhraseOptionsStatusChange:(id)change message:(id)message
{
  siriPhraseOptions = [change siriPhraseOptions];
  -[HMDHome setSiriPhraseOptions:](self, "setSiriPhraseOptions:", [siriPhraseOptions unsignedIntegerValue]);
}

- (void)_handleMultiUserEnabledChange:(id)change message:(id)message
{
  v23 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  messageCopy = message;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v21 = 138543362;
    v22 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Multi-user enabled changed, sending notification", &v21, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  multiUserEnabled = [changeCopy multiUserEnabled];
  -[HMDHome setMultiUserEnabled:](selfCopy, "setMultiUserEnabled:", [multiUserEnabled BOOLValue]);

  notificationCenter = [(HMDHome *)selfCopy notificationCenter];
  v14 = *MEMORY[0x277CD0448];
  [notificationCenter postNotificationName:*MEMORY[0x277CD0448] object:0];

  v15 = MEMORY[0x277D0F848];
  messageDestination = [(HMDHome *)selfCopy messageDestination];
  v17 = [v15 messageWithName:v14 destination:messageDestination payload:0];

  identifier = [messageCopy identifier];
  [v17 setIdentifier:identifier];

  [v17 setRemote:{objc_msgSend(messageCopy, "isRemote")}];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  [msgDispatcher sendMessage:v17 completionHandler:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasOnboardedForAccessCodeMessage:(id)message
{
  v23 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543618;
    v20 = v8;
    v21 = 2112;
    v22 = messageCopy;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling message to set has onboarded for access code: %@", &v19, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  [(HMDHomeModel *)v13 setHasOnboardedForAccessCode:MEMORY[0x277CBEC38]];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [messageCopy name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [backingStore transaction:name options:v16];

  [v17 add:v13 withMessage:messageCopy];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest:(id)request
{
  v24 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received set has any user acknowledged camera recording onboarding request", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)selfCopy uuid];
  homeManager = [(HMDHome *)selfCopy homeManager];
  uuid2 = [homeManager uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  [(HMDHomeModel *)v13 setHasAnyUserAcknowledgedCameraRecordingOnboarding:MEMORY[0x277CBEC38]];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [requestCopy name];
  v16 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
  v17 = [backingStore transaction:name options:v16];

  [v17 add:v13 withMessage:requestCopy];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke;
  v20[3] = &unk_2797359D8;
  v21 = requestCopy;
  v18 = requestCopy;
  [v17 run:v20];

  v19 = *MEMORY[0x277D85DE8];
}

uint64_t __76__HMDHome__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithSuccess];
  }
}

- (void)enableMultiUser
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v12 = 138543362;
    v13 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Received local request to enable Multi-User", &v12, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v7 = MEMORY[0x277D0F818];
  v8 = *MEMORY[0x277CCFEE8];
  messageDestination = [(HMDHome *)selfCopy messageDestination];
  v10 = [v7 messageWithName:v8 destination:messageDestination payload:MEMORY[0x277CBEC10]];

  [(HMDHome *)selfCopy _enableMultiUserWithMessage:v10];
  v11 = *MEMORY[0x277D85DE8];
}

- (void)_enableMultiUserWithMessage:(void *)message
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (message)
  {
    if ([message isMultiUserEnabled])
    {
      [v3 respondWithSuccess];
    }

    else
    {
      v4 = objc_autoreleasePoolPush();
      messageCopy = message;
      v6 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v7;
        _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Received enable multi-user request", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v4);
      v8 = [HMDHomeModel alloc];
      uuid = [messageCopy uuid];
      homeManager = [messageCopy homeManager];
      uuid2 = [homeManager uuid];
      v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

      [(HMDHomeModel *)v12 setMultiUserEnabled:MEMORY[0x277CBEC38]];
      backingStore = [messageCopy backingStore];
      name = [v3 name];
      v15 = +[HMDBackingStoreTransactionOptions defaultPreferencesOptions];
      v16 = [backingStore transaction:name options:v15];

      [v16 add:v12 withMessage:v3];
      [v16 run];
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_handleEnableMultiUserRequest:(id)request
{
  v41 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  if ([requestCopy isRemote] && (objc_msgSend(requestCopy, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = requestCopy;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [requestCopy respondWithError:v14];
  }

  else
  {
    if ([(HMDHome *)self isOwnerUser])
    {
      [(HMDHome *)self _enableMultiUserWithMessage:requestCopy];
      goto LABEL_16;
    }

    primaryResident = [(HMDHome *)self primaryResident];
    if (!primaryResident)
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v16;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to forward message to home owner no resident found", buf, 0xCu);
      }

      goto LABEL_15;
    }

    if (([requestCopy isRemote] & 1) != 0 || objc_msgSend(requestCopy, "BOOLForKey:", @"kDoNotForwardMessageKey"))
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v9;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Did not expect remote message.", buf, 0xCu);
      }

LABEL_15:

      objc_autoreleasePoolPop(v6);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [requestCopy respondWithError:v17];

      goto LABEL_16;
    }

    v19 = [requestCopy mutableCopy];
    [v19 setRemote:1];
    [v19 setSecureRemote:1];
    v35 = @"kDoNotForwardMessageKey";
    v36 = MEMORY[0x277CBEC38];
    v20 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v36 forKeys:&v35 count:1];
    [v19 setMessagePayload:v20];

    v21 = [HMDRemoteDeviceMessageDestination alloc];
    destination = [requestCopy destination];
    target = [destination target];
    device = [primaryResident device];
    v25 = [(HMDRemoteDeviceMessageDestination *)v21 initWithTarget:target device:device];
    [v19 setDestination:v25];

    objc_initWeak(&location, self);
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __41__HMDHome__handleEnableMultiUserRequest___block_invoke;
    v31[3] = &unk_279733AE8;
    objc_copyWeak(&v33, &location);
    v32 = requestCopy;
    [v19 setResponseHandler:v31];
    v26 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v29;
      _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Forwarding enable multi-user request to owner.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v26);
    msgDispatcher = [(HMDHome *)selfCopy4 msgDispatcher];
    [msgDispatcher sendMessage:v19];

    objc_destroyWeak(&v33);
    objc_destroyWeak(&location);
  }

LABEL_16:

  v18 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleEnableMultiUserRequest___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Enabled multi-user on the home error: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = [*(a1 + 32) responseHandler];

  if (v12)
  {
    v13 = [*(a1 + 32) responseHandler];
    (v13)[2](v13, v5, v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_configureConfiguredResident:(id)resident desiredConfigState:(unint64_t)state message:(id)message
{
  v32 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  messageCopy = message;
  if (state == 1)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Unconfiguring residents is not supported", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v10);
    responseHandler = [messageCopy responseHandler];

    if (responseHandler)
    {
      homeManager = [MEMORY[0x277CCA9B8] hmErrorWithCode:48 description:0 reason:0 suggestion:0];
      responseHandler2 = [messageCopy responseHandler];
      (responseHandler2)[2](responseHandler2, homeManager, 0);
LABEL_17:
    }
  }

  else
  {
    configurationState = [residentCopy configurationState];
    [(HMDHome *)self _updateConfigurationStateForResidentDevice:residentCopy desiredConfigState:state message:messageCopy];
    if (configurationState != state)
    {
      homeManager = [(HMDHome *)self homeManager];
      v18 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v20 = HMFGetOSLogHandle();
      v21 = os_log_type_enabled(v20, OS_LOG_TYPE_INFO);
      if (state == 2)
      {
        if (v21)
        {
          v22 = HMFGetLogIdentifier();
          displayName = [residentCopy displayName];
          v28 = 138543618;
          v29 = v22;
          v30 = 2112;
          v31 = displayName;
          _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Enabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
      }

      else
      {
        if (v21)
        {
          v24 = HMFGetLogIdentifier();
          displayName2 = [residentCopy displayName];
          v28 = 138543618;
          v29 = v24;
          v30 = 2112;
          v31 = displayName2;
          _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Disabling resident device %@, checking if we need to go remote", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        uuid = [(HMDHome *)selfCopy2 uuid];
        [homeManager teardownRemoteAccessForHome:uuid];
      }

      if (![(HMDHome *)selfCopy2 isResidentSupported])
      {
        [homeManager checkForRemotePeers];
      }

      responseHandler2 = [messageCopy name];
      [(HMDHome *)selfCopy2 saveWithReason:responseHandler2 postSyncNotification:0];
      goto LABEL_17;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_addResidentWithUsername:(id)username publicKey:(id)key destination:(id)destination
{
  v38 = *MEMORY[0x277D85DE8];
  usernameCopy = username;
  keyCopy = key;
  destinationCopy = destination;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if (usernameCopy && keyCopy)
  {
    unconfiguredResidentDevices = [(HMDHome *)self unconfiguredResidentDevices];
    v13 = [unconfiguredResidentDevices hmf_firstObjectWithValue:destinationCopy forKeyPath:@"userID"];

    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (isKindOfClass)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543362;
        v33 = v19;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Found user as unconfigured resident, creating an accepted invitation to track adding the resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v15);
      v20 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v13 invitationState:5 forHome:selfCopy expiryDate:0 messageIdentifier:0];
      [(HMDHome *)selfCopy addOutgoingInvitation:v20];
      objc_initWeak(buf, selfCopy);
      v28[0] = MEMORY[0x277D85DD0];
      v28[1] = 3221225472;
      v28[2] = __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke;
      v28[3] = &unk_279731988;
      objc_copyWeak(&v31, buf);
      v29 = v13;
      v21 = v20;
      v30 = v21;
      [(HMDHome *)selfCopy __handleAcceptedOutgoingInvitationResponse:v21 destinationAddress:destinationCopy publicKey:keyCopy username:usernameCopy issuerPublicKeyER:0 presenceAuthStatus:0 completionHandler:v28];

      objc_destroyWeak(&v31);
      objc_destroyWeak(buf);
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v33 = v26;
        v34 = 2112;
        v35 = destinationCopy;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Attempt to pair an unknown resident user '%@', aborting", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543874;
      v33 = v25;
      v34 = 2112;
      v35 = usernameCopy;
      v36 = 2112;
      v37 = keyCopy;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Aborting adding resident due to missing userName '%@' and publicKey '%@'", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __58__HMDHome__addResidentWithUsername_publicKey_destination___block_invoke(id *a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (shouldLogPrivateInformation())
  {
    v5 = [a1[4] userID];
  }

  else
  {
    v5 = @"...";
    v6 = @"...";
  }

  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);
  if (v3)
  {
    if (v10)
    {
      v11 = HMFGetLogIdentifier();
      v16 = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v5;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to add resident user '%@' invitation with error: %@", &v16, 0x20u);
    }
  }

  else if (v10)
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[5] identifier];
    v14 = [v13 UUIDString];
    v16 = 138543874;
    v17 = v12;
    v18 = 2112;
    v19 = v5;
    v20 = 2112;
    v21 = v14;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Tracking adding resident user '%@' with accepted and pending invitation '%@'", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_sendResidentInviteWithDestination:(id)destination
{
  v47 = *MEMORY[0x277D85DE8];
  destinationCopy = destination;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = destinationCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      device = [v6 device];
      remoteDestinationString = [device remoteDestinationString];
      *buf = 138543618;
      v42 = v11;
      v43 = 2112;
      v44 = remoteDestinationString;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Adding user %@ as remote access point", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    homeManager = [(HMDHome *)selfCopy homeManager];
    v37 = 0;
    v38 = 0;
    v36 = 0;
    v15 = [homeManager getOrCreateControllerPublicKey:&v38 controllerUsername:&v37 error:&v36];
    v16 = v38;
    v32 = v37;
    v31 = v36;
    if (v15)
    {
      v39[0] = *MEMORY[0x277CD23D0];
      name = [(HMDHome *)selfCopy name];
      v40[0] = name;
      v39[1] = *MEMORY[0x277CD0640];
      uuid = [(HMDHome *)selfCopy uuid];
      uUIDString = [uuid UUIDString];
      v40[1] = uUIDString;
      v39[2] = @"kControllerPublicKey";
      null = v16;
      if (!v16)
      {
        null = [MEMORY[0x277CBEB68] null];
      }

      v39[3] = @"kControllerPairingNameKey";
      v40[2] = null;
      v40[3] = v32;
      v30 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v40 forKeys:v39 count:4];
      if (!v16)
      {
      }

      v21 = [MEMORY[0x277D0F818] internalMessageWithName:@"kAddRemoteAccessRequestKey" destination:destinationCopy messagePayload:v30];
      objc_initWeak(buf, selfCopy);
      v33[0] = MEMORY[0x277D85DD0];
      v33[1] = 3221225472;
      v33[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke;
      v33[3] = &unk_279733AE8;
      objc_copyWeak(&v35, buf);
      v34 = v6;
      [v21 setResponseHandler:v33];
      messageDispatcher = [homeManager messageDispatcher];
      [messageDispatcher sendMessage:v21 completionHandler:0];

      objc_destroyWeak(&v35);
      objc_destroyWeak(buf);
    }

    else
    {
      v25 = objc_autoreleasePoolPush();
      v26 = selfCopy;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v28;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed getting controller public key to add remote gateway", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v25);
    }
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v23 = HMFGetLogIdentifier();
      shortDescription = [(HMDHome *)selfCopy shortDescription];
      *buf = 138543874;
      v42 = v23;
      v43 = 2112;
      v44 = shortDescription;
      v45 = 2112;
      v46 = destinationCopy;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@[%@] Invalid resident invite destination: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = WeakRetained;
  if (v5 || !v6)
  {
    v10 = objc_autoreleasePoolPush();
    v11 = v8;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v14 = [*(a1 + 32) device];
      v15 = [v14 remoteDestinationString];
      *buf = 138543874;
      v22 = v13;
      v23 = 2112;
      v24 = v15;
      v25 = 2112;
      v26 = v5;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to receive controller info to auto add user %@ due to error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
  }

  else if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1689;
    block[3] = &unk_279734960;
    v18 = v6;
    v19 = v8;
    v20 = *(a1 + 32);
    dispatch_async(v9, block);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__sendResidentInviteWithDestination___block_invoke_1689(uint64_t a1)
{
  v6 = [*(a1 + 32) hmf_stringForKey:@"kControllerPairingNameKey"];
  v2 = [*(a1 + 32) hmf_dataForKey:@"kControllerPublicKey"];
  v3 = *(a1 + 40);
  v4 = [*(a1 + 48) device];
  v5 = [v4 remoteDestinationString];
  [v3 _addResidentWithUsername:v6 publicKey:v2 destination:v5];
}

- (void)_configureUnconfiguredResident:(id)resident desiredConfigState:(unint64_t)state
{
  v77 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v7 = residentCopy;
  configurationState = [residentCopy configurationState];
  if (configurationState != state)
  {
    v58 = configurationState;
    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    outgoingInvitations = [(HMDHome *)self outgoingInvitations];
    v10 = [outgoingInvitations countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v10)
    {
      v11 = *v65;
      while (2)
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v65 != v11)
          {
            objc_enumerationMutation(outgoingInvitations);
          }

          user = [*(*(&v64 + 1) + 8 * i) user];
          userID = [user userID];
          userID2 = [residentCopy userID];
          v16 = [userID isEqualToString:userID2];

          if (v16)
          {
            v32 = objc_autoreleasePoolPush();
            selfCopy = self;
            v34 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
            {
              v35 = HMFGetLogIdentifier();
              userID3 = [residentCopy userID];
              *buf = 138543618;
              v71 = v35;
              v72 = 2112;
              v73 = userID3;
              _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Already have a pending invitation for the resident user '%@', not setting up remote access", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v32);
            goto LABEL_34;
          }
        }

        v10 = [outgoingInvitations countByEnumeratingWithState:&v64 objects:v76 count:16];
        if (v10)
        {
          continue;
        }

        break;
      }
    }

    if (state != 2 || v58 != 1)
    {
      v37 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v40 = HMFGetLogIdentifier();
        displayName = [residentCopy displayName];
        *buf = 138543618;
        v71 = v40;
        v72 = 2112;
        v73 = displayName;
        _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Cannot configure unconfigured resident %@ to desired state", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v37);
      goto LABEL_34;
    }

    userID4 = [residentCopy userID];
    homeManager = [(HMDHome *)self homeManager];
    v19 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      displayName2 = [residentCopy displayName];
      *buf = 138543874;
      v71 = v22;
      v72 = 2112;
      v73 = userID4;
      v74 = 2112;
      v75 = displayName2;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Configuring unconfigured resident %@/%@ for remote access", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v19);
    hapAccessoryUniqueIdentifiers = [(HMDHome *)selfCopy3 hapAccessoryUniqueIdentifiers];
    allObjects = [hapAccessoryUniqueIdentifiers allObjects];

    if ([allObjects count])
    {
      pendingResponsesForRemoteAccessSetup = [(HMDHome *)selfCopy3 pendingResponsesForRemoteAccessSetup];
      v27 = [pendingResponsesForRemoteAccessSetup containsObject:userID4];

      if (!v27)
      {
        uuid = [homeManager uuid];
        v45 = [HMDMessageDispatcher destinationWithTarget:uuid userID:0 destination:userID4 multicast:0];

        if (v45)
        {
          pendingResponsesForRemoteAccessSetup2 = [(HMDHome *)selfCopy3 pendingResponsesForRemoteAccessSetup];
          [pendingResponsesForRemoteAccessSetup2 addObject:userID4];

          v69[0] = allObjects;
          v47 = *MEMORY[0x277CD0640];
          v68[0] = @"kAccessoryIdentitiesKey";
          v68[1] = v47;
          uuid2 = [(HMDHome *)selfCopy3 uuid];
          uUIDString = [uuid2 UUIDString];
          v69[1] = uUIDString;
          v50 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v69 forKeys:v68 count:2];

          v51 = [MEMORY[0x277D0F818] internalMessageWithName:@"kDoYouSeeUnpairedAccessoriesKey" destination:v45 messagePayload:v50];
          objc_initWeak(buf, selfCopy3);
          v60[0] = MEMORY[0x277D85DD0];
          v60[1] = 3221225472;
          v60[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke;
          v60[3] = &unk_279735248;
          objc_copyWeak(&v63, buf);
          v61 = userID4;
          v62 = v45;
          [v51 setResponseHandler:v60];
          messageDispatcher = [homeManager messageDispatcher];
          [messageDispatcher sendMessage:v51 completionHandler:0];

          objc_destroyWeak(&v63);
          objc_destroyWeak(buf);
        }

        else
        {
          v53 = objc_autoreleasePoolPush();
          v54 = selfCopy3;
          v55 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v55, OS_LOG_TYPE_DEFAULT))
          {
            v56 = HMFGetLogIdentifier();
            *buf = 138543618;
            v71 = v56;
            v72 = 2112;
            v73 = userID4;
            _os_log_impl(&dword_2531F8000, v55, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: could not create message destination for address: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v53);
        }

        goto LABEL_34;
      }

      v28 = objc_autoreleasePoolPush();
      v29 = selfCopy3;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v31 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v31;
        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: there is already a pending request", buf, 0xCu);
      }
    }

    else
    {
      v28 = objc_autoreleasePoolPush();
      v42 = selfCopy3;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v43 = HMFGetLogIdentifier();
        *buf = 138543362;
        v71 = v43;
        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEFAULT, "%{public}@Cannot configure unconfigured resident: no accessory identifiers found", buf, 0xCu);
      }
    }

    objc_autoreleasePoolPop(v28);
LABEL_34:
    v7 = residentCopy;
    goto LABEL_35;
  }

  [(HMDHome *)self _updateConfigurationStateForResidentDevice:residentCopy desiredConfigState:state message:0];
LABEL_35:

  v57 = *MEMORY[0x277D85DE8];
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2;
    block[3] = &unk_2797352C0;
    block[4] = v8;
    v11 = a1[4];
    v12 = v5;
    v13 = v6;
    v14 = a1[5];
    dispatch_async(v9, block);
  }
}

void __61__HMDHome__configureUnconfiguredResident_desiredConfigState___block_invoke_2(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) pendingResponsesForRemoteAccessSetup];
  [v2 removeObject:*(a1 + 40)];

  if (*(a1 + 48) || (v9 = *(a1 + 56)) == 0)
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 40);
      v8 = *(a1 + 48);
      v19 = 138543874;
      v20 = v6;
      v21 = 2112;
      v22 = v7;
      v23 = 2112;
      v24 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ failed to look for accessories with error:%@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    v10 = [v9 hmf_BOOLForKey:@"kAtHomeStateKey"];
    v11 = [*(a1 + 56) hmf_stringForKey:@"kDeviceNameKey"];
    v12 = v11;
    if (v10 && v11)
    {
      [*(a1 + 32) _sendResidentInviteWithDestination:*(a1 + 64)];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      v14 = *(a1 + 32);
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        v17 = *(a1 + 40);
        v19 = 138543618;
        v20 = v16;
        v21 = 2112;
        v22 = v17;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Remote peer %@ is not at home", &v19, 0x16u);
      }

      objc_autoreleasePoolPop(v13);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationStateForResidentDevice:(id)device desiredConfigState:(unint64_t)state message:(id)message
{
  v22 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    displayName = [deviceCopy displayName];
    v16 = 138543874;
    v17 = v13;
    v18 = 2112;
    v19 = displayName;
    v20 = 2048;
    stateCopy = state;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Updated configuration state of resident %@ to %ld", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v10);
  if ([deviceCopy configurationState] != state)
  {
    [deviceCopy setConfigurationState:state];
    [(HMDHome *)selfCopy _notifyClientsOfUpdatedResidentUser:deviceCopy];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyNewRemotePeersFound:(BOOL)found remoteUsersRemoved:(id)removed forceRemoteNotificationRegistration:(BOOL)registration
{
  removedCopy = removed;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke;
  block[3] = &unk_27972EBD8;
  block[4] = self;
  v12 = removedCopy;
  foundCopy = found;
  registrationCopy = registration;
  v10 = removedCopy;
  dispatch_async(workQueue, block);
}

void __92__HMDHome_notifyNewRemotePeersFound_remoteUsersRemoved_forceRemoteNotificationRegistration___block_invoke(uint64_t a1)
{
  v54 = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277CBEB58];
  v3 = [*(a1 + 32) users];
  v40 = [v2 setWithArray:v3];

  v39 = [MEMORY[0x277CBEB58] setWithArray:*(a1 + 40)];
  [v40 intersectSet:v39];
  if ([v40 count])
  {
    v42 = [MEMORY[0x277CBEB18] array];
    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    obj = [v40 allObjects];
    v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
    if (v4)
    {
      v5 = *v44;
      do
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v44 != v5)
          {
            objc_enumerationMutation(obj);
          }

          v7 = *(*(&v43 + 1) + 8 * i);
          if (shouldLogPrivateInformation())
          {
            v8 = [v7 userID];
          }

          else
          {
            v8 = @"...";
            v9 = @"...";
          }

          v10 = objc_autoreleasePoolPush();
          v11 = *(a1 + 32);
          v12 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
          {
            v13 = HMFGetLogIdentifier();
            *buf = 138543618;
            v50 = v13;
            v51 = 2112;
            v52 = v8;
            _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Removing remote user %@ since it has de-registered", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v10);
          v14 = [v7 userID];

          if (v14)
          {
            v15 = [v7 userID];
            [v42 addObject:v15];
          }

          [*(a1 + 32) _removeOutgoingInvitationForUser:v7];
          [*(a1 + 32) _removeUserFromContainer:v7];
        }

        v4 = [obj countByEnumeratingWithState:&v43 objects:v53 count:16];
      }

      while (v4);
    }

    v16 = *(a1 + 32);
    os_unfair_recursive_lock_lock_with_options();
    v17 = *(*(a1 + 32) + 32);
    v18 = [v40 allObjects];
    [v17 removeObjectsInArray:v18];

    os_unfair_recursive_lock_unlock();
    v47[0] = @"kUserIDsKey";
    v19 = [v42 copy];
    v47[1] = *MEMORY[0x277CD0640];
    v48[0] = v19;
    v20 = [*(a1 + 32) uuid];
    v21 = [v20 UUIDString];
    v48[1] = v21;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v48 forKeys:v47 count:2];

    [*(a1 + 32) saveWithReason:@"kRemoteUsersDeregistered" information:v22 postSyncNotification:0];
  }

  v23 = [*(a1 + 32) localCapabilitiesDataSource];
  v24 = [v23 supportsRemoteAccess];

  if (v24)
  {
    v25 = [*(a1 + 32) homeManager];
    if (*(a1 + 48) == 1)
    {
      if ([*(a1 + 32) reachableAccessoriesCount])
      {
        if ([*(a1 + 32) allowsRemoteAccess])
        {
          v26 = [*(a1 + 32) currentUser];
          v27 = [v26 isRemoteAccessAllowed];

          if (v27)
          {
            v28 = objc_autoreleasePoolPush();
            v29 = *(a1 + 32);
            v30 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
            {
              v31 = HMFGetLogIdentifier();
              *buf = 138543362;
              v50 = v31;
              _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@We have potential remote gateways that can be auto setup, triggering detection", buf, 0xCu);
            }

            objc_autoreleasePoolPop(v28);
            v32 = [*(a1 + 32) uuid];
            [v25 accessoriesAreLocallyReachableOnTransientDevice:1 forHome:v32];
          }
        }
      }
    }

    if (([*(a1 + 32) remoteAccessIsEnabled] & 1) == 0 && (objc_msgSend(*(a1 + 32), "isResidentSupported") & 1) == 0)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = *(a1 + 32);
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v50 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Home does not have remote access enabled, requesting electing a remote peer", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      v37 = [*(a1 + 32) uuid];
      [v25 electRemoteAccessPeerForHome:v37];
    }

    [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];
  }

  v38 = *MEMORY[0x277D85DE8];
}

- (void)_subscribeForNotificationFromRemoteGateway:(void *)gateway
{
  v24 = *MEMORY[0x277D85DE8];
  if (gateway)
  {
    workQueue = [gateway workQueue];
    dispatch_assert_queue_V2(workQueue);

    if ((a2 & 1) != 0 || ![gateway registeredNotificationWithRemoteGateway])
    {
      notificationRegistrations = [gateway notificationRegistrations];
      v10 = [notificationRegistrations count];

      v11 = objc_autoreleasePoolPush();
      gatewayCopy = gateway;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        notificationRegistrations2 = [gatewayCopy notificationRegistrations];
        shortDescription = [notificationRegistrations2 shortDescription];
        v18 = 138543874;
        v19 = v14;
        v20 = 2112;
        v21 = shortDescription;
        v22 = 2048;
        v23 = v10;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with new remote gateway: %@/%lu", &v18, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      [gatewayCopy _subscribeForHomeNotificationsFromRemoteGateway:v10 != 0];
      [gatewayCopy setRegisteredNotificationWithRemoteGateway:1];
    }

    else
    {
      v5 = objc_autoreleasePoolPush();
      gatewayCopy2 = gateway;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v18 = 138543362;
        v19 = v8;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Already registered for notification with remote gateway, skipping", &v18, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
    }
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_remoteAccessEnabled:(BOOL)enabled
{
  hapAccessories = [(HMDHome *)self hapAccessories];
  v5[0] = MEMORY[0x277D85DD0];
  v5[1] = 3221225472;
  v5[2] = __32__HMDHome__remoteAccessEnabled___block_invoke;
  v5[3] = &__block_descriptor_33_e25_v16__0__HMDHAPAccessory_8l;
  enabledCopy = enabled;
  [hapAccessories na_each:v5];
}

- (void)remoteAccessEnabled:(BOOL)enabled
{
  workQueue = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __31__HMDHome_remoteAccessEnabled___block_invoke;
  v6[3] = &unk_279735D28;
  v6[4] = self;
  enabledCopy = enabled;
  dispatch_async(workQueue, v6);
}

uint64_t __31__HMDHome_remoteAccessEnabled___block_invoke(uint64_t a1)
{
  v48 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) == [*(a1 + 32) remoteAccessIsEnabled])
  {
    goto LABEL_25;
  }

  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v7 = HMFBooleanToString();
    *buf = 138543618;
    v45 = v5;
    v46 = 2112;
    v47 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Setting remote access enabled to %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  [*(a1 + 32) setRemoteAccessIsEnabled:*(a1 + 40)];
  if (*(a1 + 40) != 1)
  {
    v19 = [*(a1 + 32) WiFiAssertion];

    if (v19)
    {
      v20 = objc_autoreleasePoolPush();
      v21 = *(a1 + 32);
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v23;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v20);
      v24 = [*(a1 + 32) wifiManager];
      v25 = [*(a1 + 32) WiFiAssertion];
      [v24 endActiveAssertion:v25];

      v26 = [*(a1 + 32) wifiManager];
      [v26 releaseWoWAssertion];

      [*(a1 + 32) setWiFiAssertion:0];
    }

    goto LABEL_16;
  }

  if (isWatch())
  {
    v8 = [*(a1 + 32) homeManager];
    if ([v8 isActive])
    {
      v9 = [*(a1 + 32) WiFiAssertion];

      if (v9)
      {
        goto LABEL_16;
      }

      v10 = objc_autoreleasePoolPush();
      v11 = *(a1 + 32);
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543362;
        v45 = v13;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v14 = [*(a1 + 32) wifiManager];
      v15 = MEMORY[0x277CCACA8];
      v16 = [*(a1 + 32) shortDescription];
      v17 = [v15 stringWithFormat:@"Remote Access for %@", v16];
      v18 = [v14 beginActiveAssertionWithOptions:0 reason:v17];
      [*(a1 + 32) setWiFiAssertion:v18];

      v8 = [*(a1 + 32) wifiManager];
      [v8 takeWoWAssertion];
    }
  }

LABEL_16:
  if (([*(a1 + 32) isResidentSupported] & 1) == 0)
  {
    v41 = 0u;
    v42 = 0u;
    v39 = 0u;
    v40 = 0u;
    v27 = [*(a1 + 32) _residentUsers];
    v28 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
    if (v28)
    {
      v29 = v28;
      v30 = *v40;
      do
      {
        v31 = 0;
        do
        {
          if (*v40 != v30)
          {
            objc_enumerationMutation(v27);
          }

          [*(a1 + 32) _notifyClientsOfUpdatedResidentUser:*(*(&v39 + 1) + 8 * v31++)];
        }

        while (v29 != v31);
        v29 = [v27 countByEnumeratingWithState:&v39 objects:v43 count:16];
      }

      while (v29);
    }
  }

LABEL_25:
  v32 = objc_autoreleasePoolPush();
  v33 = *(a1 + 32);
  v34 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
  {
    v35 = HMFGetLogIdentifier();
    *buf = 138543362;
    v45 = v35;
    _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Clearing history of all heartbeat queued messages to server", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v32);
  v36 = [*(a1 + 32) heartbeatPingMessagesQueuedWithServer];
  [v36 removeAllObjects];

  result = [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  v38 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)remoteAccessIsEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  remoteAccessIsEnabled = self->_remoteAccessIsEnabled;
  os_unfair_recursive_lock_unlock();
  return remoteAccessIsEnabled;
}

- (void)setRemoteAccessEnabled:(BOOL)enabled
{
  os_unfair_recursive_lock_lock_with_options();
  self->_remoteAccessIsEnabled = enabled;

  os_unfair_recursive_lock_unlock();
}

- (void)updateNetworkConnectivity:(BOOL)connectivity companionReachable:(BOOL)reachable
{
  workQueue = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke;
  v8[3] = &unk_27972C680;
  v8[4] = self;
  connectivityCopy = connectivity;
  reachableCopy = reachable;
  dispatch_async(workQueue, v8);
}

void __56__HMDHome_updateNetworkConnectivity_companionReachable___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  if (*(a1 + 40) != [*(a1 + 32) isNetworkAvailable])
  {
    [*(a1 + 32) setIsNetworkAvailable:?];
  }

  v2 = [*(a1 + 32) remoteEventRouterClientController];
  [v2 networkAvailabilityDidChange:*(a1 + 40)];

  if (isWatch() && *(a1 + 41) == 1)
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Companion is reachable, ignoring network connectivity update", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  else if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@We have no network connectivity, setting reachability state for all accessories to reflect their state", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 32) _remoteAccessEnabled:*(a1 + 40)];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)_residentDeviceAvailable
{
  v14 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isResidentSupported])
  {
    LOBYTE(v3) = 1;
  }

  else
  {
    v11 = 0u;
    v12 = 0u;
    v9 = 0u;
    v10 = 0u;
    _residentUsers = [(HMDHome *)self _residentUsers];
    v3 = [_residentUsers countByEnumeratingWithState:&v9 objects:v13 count:16];
    if (v3)
    {
      v5 = *v10;
      while (2)
      {
        for (i = 0; i != v3; ++i)
        {
          if (*v10 != v5)
          {
            objc_enumerationMutation(_residentUsers);
          }

          if ([*(*(&v9 + 1) + 8 * i) configurationState] == 2)
          {
            LOBYTE(v3) = 1;
            goto LABEL_13;
          }
        }

        v3 = [_residentUsers countByEnumeratingWithState:&v9 objects:v13 count:16];
        if (v3)
        {
          continue;
        }

        break;
      }
    }

LABEL_13:
  }

  v7 = *MEMORY[0x277D85DE8];
  return v3;
}

- (id)_residentUsers
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CBEB18];
  users = [(HMDHome *)self users];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(users, "count")}];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  users2 = [(HMDHome *)self users];
  v7 = [users2 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(users2);
        }

        v11 = *(*(&v14 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [v5 addObject:v11];
        }
      }

      v8 = [users2 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v8);
  }

  v12 = *MEMORY[0x277D85DE8];

  return v5;
}

- (BOOL)isRemoteAccessDeviceReachable
{
  if (![(HMDHome *)self remoteAccessIsEnabled])
  {
    return 0;
  }

  primaryResident = [(HMDHome *)self primaryResident];
  v4 = ([primaryResident isReachable] & 1) != 0 || -[HMDHome isCompanionReachable](self, "isCompanionReachable");

  return v4;
}

- (void)handlePrimaryResidentChangeNotification:(id)notification
{
  v20 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    name = [notificationCopy name];
    *buf = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = name;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received resident update notification: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  workQueue = [(HMDHome *)selfCopy workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke;
  v13[3] = &unk_2797359B0;
  v14 = notificationCopy;
  v15 = selfCopy;
  v11 = notificationCopy;
  dispatch_async(workQueue, v13);

  v12 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome_handlePrimaryResidentChangeNotification___block_invoke(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_UUIDForKey:@"HMDResidentDeviceHomeUUIDNotificationKey"];

  v4 = [*(a1 + 40) uuid];
  v5 = [v4 hmf_isEqualToUUID:v3];

  if (v5)
  {
    if ([*(a1 + 40) isCurrentDeviceConfirmedPrimaryResident])
    {
      v6 = objc_autoreleasePoolPush();
      v7 = *(a1 + 40);
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        v14 = 138543362;
        v15 = v9;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Resetting accessory browsers", &v14, 0xCu);
      }

      objc_autoreleasePoolPop(v6);
      v10 = [*(a1 + 40) accessoryBrowser];
      [v10 restartBrowsers];

      [*(a1 + 40) _evaluateShouldRelaunchAndSetRelaunch];
      HMFUptime();
      v12 = *(a1 + 40);
    }

    else
    {
      v12 = *(a1 + 40);
      v11 = 0.0;
    }

    [v12 setCurrentDeviceBecamePrimaryTime:v11];
    [*(a1 + 40) _registerCameraReachabilityEventNotificationsWithCompletionHandler:0];
    HMFUptime();
    [*(a1 + 40) setPrimaryResidentChangedTime:?];
    [*(a1 + 40) _notifyThreadLayerOfResidentChange];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoteDeviceBecameReachableNotification:(id)notification
{
  v26 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  object = [notificationCopy object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = object;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    primaryResident = [(HMDHome *)self primaryResident];
    device = [primaryResident device];
    v10 = device;
    if (device != v7)
    {

LABEL_14:
      goto LABEL_15;
    }

    supportsUnifiedMediaNotificationsOnResidents = [(HMDHome *)self supportsUnifiedMediaNotificationsOnResidents];

    if (supportsUnifiedMediaNotificationsOnResidents)
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = 138543618;
        v23 = v19;
        v24 = 2112;
        v25 = notificationCopy;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Resubscribing for apple media accessory state on primary resident did become reachable notification %@ ", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      primaryResident = [(HMDHome *)selfCopy workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __57__HMDHome_handleRemoteDeviceBecameReachableNotification___block_invoke;
      block[3] = &unk_279735D00;
      block[4] = selfCopy;
      dispatch_async(primaryResident, block);
      goto LABEL_14;
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v14;
      v24 = 2112;
      v25 = notificationCopy;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Expected notification (%@) to contain device for reachability ", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
  }

LABEL_15:

  v20 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome_handleRemoteDeviceBecameReachableNotification___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v3 = [v1 primaryResident];
  v2 = [v3 device];
  [(HMDHome *)v1 _updateDirectAppleMediaNotificationsOnResidentChange:v2 previousResidentDevice:0];
}

- (void)_updateDirectAppleMediaNotificationsOnResidentChange:(void *)change previousResidentDevice:
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  changeCopy = change;
  if (self)
  {
    workQueue = [self workQueue];
    dispatch_assert_queue_V2(workQueue);

    notificationRegistrationsForAppleMediaAccessories = [self notificationRegistrationsForAppleMediaAccessories];
    v9 = [notificationRegistrationsForAppleMediaAccessories count];

    if (v9)
    {
      appleMediaAccessories = [self appleMediaAccessories];
      capabilities = [changeCopy capabilities];
      if ([capabilities supportsUnifiedMediaNotifications])
      {
      }

      else
      {
        capabilities2 = [v5 capabilities];
        supportsUnifiedMediaNotifications = [capabilities2 supportsUnifiedMediaNotifications];

        if (supportsUnifiedMediaNotifications)
        {
          v41 = 0u;
          v42 = 0u;
          v39 = 0u;
          v40 = 0u;
          v34 = appleMediaAccessories;
          v18 = appleMediaAccessories;
          v19 = [v18 countByEnumeratingWithState:&v39 objects:v44 count:16];
          if (v19)
          {
            v20 = v19;
            v21 = *v40;
            do
            {
              for (i = 0; i != v20; ++i)
              {
                if (*v40 != v21)
                {
                  objc_enumerationMutation(v18);
                }

                v23 = *(*(&v39 + 1) + 8 * i);
                device = [v23 device];
                v25 = [device isEqual:v5];

                if ((v25 & 1) == 0)
                {
                  [(HMDHome *)self _enableMediaNotifications:v23 directlyOnMediaAccessory:0 completion:?];
                }
              }

              v20 = [v18 countByEnumeratingWithState:&v39 objects:v44 count:16];
            }

            while (v20);
          }

          appleMediaAccessories = v34;
          goto LABEL_29;
        }
      }

      capabilities3 = [changeCopy capabilities];
      if ([capabilities3 supportsUnifiedMediaNotifications])
      {
        capabilities4 = [v5 capabilities];
        supportsUnifiedMediaNotifications2 = [capabilities4 supportsUnifiedMediaNotifications];

        if (supportsUnifiedMediaNotifications2)
        {
LABEL_29:
          [self _refreshMediaProfilesOnHomeNotificationEnable];

          goto LABEL_30;
        }

        v37 = 0u;
        v38 = 0u;
        v35 = 0u;
        v36 = 0u;
        capabilities3 = appleMediaAccessories;
        v29 = [capabilities3 countByEnumeratingWithState:&v35 objects:v43 count:16];
        if (v29)
        {
          v30 = v29;
          v31 = *v36;
          do
          {
            for (j = 0; j != v30; ++j)
            {
              if (*v36 != v31)
              {
                objc_enumerationMutation(capabilities3);
              }

              [(HMDHome *)self _enableMediaNotifications:*(*(&v35 + 1) + 8 * j) directlyOnMediaAccessory:0 completion:?];
            }

            v30 = [capabilities3 countByEnumeratingWithState:&v35 objects:v43 count:16];
          }

          while (v30);
        }
      }

      goto LABEL_29;
    }

    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v46 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Skipping updated apple media notification registrations for remote devices because there are no clients registered.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

LABEL_30:

  v33 = *MEMORY[0x277D85DE8];
}

- (void)handleDeviceCapabilitiesUpdated:(id)updated
{
  v22 = *MEMORY[0x277D85DE8];
  updatedCopy = updated;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v21 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received notification to handle device capabilities update", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  object = [updatedCopy object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = object;
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  workQueue = [(HMDHome *)selfCopy workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __43__HMDHome_handleDeviceCapabilitiesUpdated___block_invoke;
  block[3] = &unk_279734960;
  v17 = updatedCopy;
  v18 = selfCopy;
  v19 = v11;
  v13 = v11;
  v14 = updatedCopy;
  dispatch_async(workQueue, block);

  v15 = *MEMORY[0x277D85DE8];
}

void __43__HMDHome_handleDeviceCapabilitiesUpdated___block_invoke(id *a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDDeviceCapabilitiesUpdatedDifferingFieldsNotificationKey"];

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = v3;
  v5 = [v4 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v16;
    do
    {
      v8 = 0;
      do
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v4);
        }

        if ([*(*(&v15 + 1) + 8 * v8) isEqualToString:{@"supportsCameraRecordingReachabilityNotifications", v15}])
        {
          [a1[5] _registerCameraReachabilityEventNotificationsWithCompletionHandler:0];
        }

        ++v8;
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v6);
  }

  v9 = [a1[5] primaryResident];
  v10 = [v9 device];

  v11 = [v10 capabilities];
  v12 = v11;
  if (v11 == a1[6])
  {
    v13 = [v4 containsObject:@"supportsUnifiedMediaNotifications"];

    if (v13 && [a1[6] supportsUnifiedMediaNotifications])
    {
      [(HMDHome *)a1[5] _updateDirectAppleMediaNotificationsOnResidentChange:v10 previousResidentDevice:0];
    }
  }

  else
  {
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleResidentChange
{
  v35 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setMigratingAfterResidentChange:0];
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  triggers = [(HMDHome *)self triggers];
  v4 = [triggers countByEnumeratingWithState:&v28 objects:v34 count:16];
  if (v4)
  {
    v5 = *v29;
    v6 = MEMORY[0x277D85DD0];
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v29 != v5)
        {
          objc_enumerationMutation(triggers);
        }

        v8 = *(*(&v28 + 1) + 8 * i);
        objc_initWeak(location, v8);
        v26[0] = v6;
        v26[1] = 3221225472;
        v26[2] = __32__HMDHome__handleResidentChange__block_invoke;
        v26[3] = &unk_279734708;
        objc_copyWeak(&v27, location);
        [v8 activateAfterResidentChangeWithCompletion:v26];
        objc_destroyWeak(&v27);
        objc_destroyWeak(location);
      }

      v4 = [triggers countByEnumeratingWithState:&v28 objects:v34 count:16];
    }

    while (v4);
  }

  if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self isResidentSupported]&& !isWatch())
  {
    v24 = 0u;
    v25 = 0u;
    v22 = 0u;
    v23 = 0u;
    users = [(HMDHome *)self users];
    v10 = [users countByEnumeratingWithState:&v22 objects:v33 count:16];
    if (v10)
    {
      v11 = *v23;
      do
      {
        for (j = 0; j != v10; ++j)
        {
          if (*v23 != v11)
          {
            objc_enumerationMutation(users);
          }

          v13 = *(*(&v22 + 1) + 8 * j);
          if ([v13 isAdministrator] && objc_msgSend(v13, "updateAdministrator:", 0))
          {
            [(HMDHome *)self saveWithReason:@"migration" postSyncNotification:0];
          }
        }

        v10 = [users countByEnumeratingWithState:&v22 objects:v33 count:16];
      }

      while (v10);
    }
  }

  v14 = objc_autoreleasePoolPush();
  selfCopy = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    LODWORD(location[0]) = 138543362;
    *(location + 4) = v17;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Calling presence feeder to notify the presence status to the new resident", location, 0xCu);
  }

  objc_autoreleasePoolPop(v14);
  presenceMonitor = [(HMDHome *)selfCopy presenceMonitor];
  [presenceMonitor residentChanged];

  presenceFeeder = [(HMDHome *)selfCopy presenceFeeder];
  [presenceFeeder residentChanged];

  periodicReader = [(HMDHome *)selfCopy periodicReader];
  [periodicReader residentUpdated];

  [(HMDHome *)selfCopy _evaluateNetworkProtectionAndRouterManagement];
  v21 = *MEMORY[0x277D85DE8];
}

void __32__HMDHome__handleResidentChange__block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v8;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Activating trigger after resident change finished with error (%@)", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)migrateAfterResidentChange
{
  v17 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v16 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@migrateAfterResidentChange", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  if ([(HMDHome *)selfCopy isMigratingAfterResidentChange])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = selfCopy;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v16 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Migration after resident change is already running", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    [(HMDHome *)selfCopy setMigratingAfterResidentChange:1];
    objc_initWeak(buf, selfCopy);
    backingStore = [(HMDHome *)selfCopy backingStore];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __37__HMDHome_migrateAfterResidentChange__block_invoke;
    v13[3] = &unk_279734708;
    objc_copyWeak(&v14, buf);
    [backingStore submitBlock:v13];

    objc_destroyWeak(&v14);
    objc_destroyWeak(buf);
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __37__HMDHome_migrateAfterResidentChange__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _handleResidentChange];
}

- (void)removeResidentCapableDevice:(id)device
{
  v30 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  if ([(HMDHome *)self isOwnerUser])
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    v7 = [residentDevices countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v22;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v22 != v9)
          {
            objc_enumerationMutation(residentDevices);
          }

          v11 = *(*(&v21 + 1) + 8 * i);
          device = [v11 device];
          v13 = [device isEqual:deviceCopy];

          if (v13)
          {
            residentDeviceManager2 = [(HMDHome *)self residentDeviceManager];
            [residentDeviceManager2 removeResidentDevice:v11];

            goto LABEL_16;
          }
        }

        v8 = [residentDevices countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

    if ([deviceCopy isCurrentDevice])
    {
      notificationRegistry = [(HMDHome *)self notificationRegistry];
      [notificationRegistry clearAllRegistrations];
    }
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v27 = v18;
      v28 = 2112;
      v29 = deviceCopy;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove resident on non-owner home -- device: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
  }

LABEL_16:

  v20 = *MEMORY[0x277D85DE8];
}

- (void)addResidentCapableDevice:(id)device
{
  v40 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  if ([(HMDHome *)self isOwnerUser])
  {
    capabilities = [deviceCopy capabilities];
    isResidentCapable = [capabilities isResidentCapable];

    if (isResidentCapable)
    {
      v33 = 0u;
      v34 = 0u;
      v31 = 0u;
      v32 = 0u;
      residentDeviceManager = [(HMDHome *)self residentDeviceManager];
      residentDevices = [residentDeviceManager residentDevices];

      v9 = [residentDevices countByEnumeratingWithState:&v31 objects:v39 count:16];
      if (v9)
      {
        v10 = v9;
        v11 = *v32;
        while (2)
        {
          for (i = 0; i != v10; ++i)
          {
            if (*v32 != v11)
            {
              objc_enumerationMutation(residentDevices);
            }

            v13 = *(*(&v31 + 1) + 8 * i);
            device = [v13 device];
            v15 = [device isEqual:deviceCopy];

            if (v15)
            {
              v26 = objc_autoreleasePoolPush();
              selfCopy = self;
              v28 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_DEBUG))
              {
                v29 = HMFGetLogIdentifier();
                *buf = 138543618;
                v36 = v29;
                v37 = 2112;
                v38 = v13;
                _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_DEBUG, "%{public}@Resident device already exists, refraining from creating a new transaction: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v26);
              goto LABEL_17;
            }
          }

          v10 = [residentDevices countByEnumeratingWithState:&v31 objects:v39 count:16];
          if (v10)
          {
            continue;
          }

          break;
        }
      }

      uuid = [(HMDHome *)self uuid];
      identifier = [deviceCopy identifier];
      residentDevices = [HMDResidentDevice deriveUUIDFromHomeUUID:uuid deviceUUID:identifier];

      v18 = [HMDResidentDeviceModel alloc];
      uuid2 = [(HMDHome *)self uuid];
      v20 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:1 uuid:residentDevices parentUUID:uuid2];

      [(HMDResidentDeviceModel *)v20 setEnabled:MEMORY[0x277CBEC38]];
      identifier2 = [deviceCopy identifier];
      uUIDString = [identifier2 UUIDString];
      [(HMDResidentDeviceModel *)v20 setDeviceUUID:uUIDString];

      if ([deviceCopy isCurrentDevice])
      {
        [(HMDResidentDeviceModel *)v20 setDevice:deviceCopy];
      }

      backingStore = [(HMDHome *)self backingStore];
      v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v25 = [backingStore transaction:@"addResidentCapableDevice" options:v24];

      [v25 add:v20 withMessage:0];
      [v25 run];

LABEL_17:
    }
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (NSArray)enabledResidents
{
  v18 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v6 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(residentDevices);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          [array addObject:v10];
        }
      }

      v7 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return array;
}

- (NSArray)residentEnabledDevices
{
  v19 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v6 = [residentDevices countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v15;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(residentDevices);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        if ([v10 isEnabled])
        {
          device = [v10 device];
          [array addObject:device];
        }
      }

      v7 = [residentDevices countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v7);
  }

  v12 = *MEMORY[0x277D85DE8];

  return array;
}

- (NSArray)residentCapableDevices
{
  v18 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v6 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(residentDevices);
        }

        device = [*(*(&v13 + 1) + 8 * i) device];
        [array addObject:device];
      }

      v7 = [residentDevices countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return array;
}

- (BOOL)shouldEnableResidentFirstAccessoryCommunication
{
  residentEnabledDevices = [(HMDHome *)self residentEnabledDevices];
  v3 = [residentEnabledDevices na_any:&__block_literal_global_1675];

  return v3;
}

uint64_t __58__HMDHome_shouldEnableResidentFirstAccessoryCommunication__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 capabilities];
  v3 = [v2 supportsResidentFirstAccessoryCommunication];

  return v3;
}

- (void)_updateResidentFirstAccessoryCommunicationEnabled
{
  v17 = *MEMORY[0x277D85DE8];
  shouldEnableResidentFirstAccessoryCommunication = [(HMDHome *)self shouldEnableResidentFirstAccessoryCommunication];
  if (shouldEnableResidentFirstAccessoryCommunication != [(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      [(HMDHome *)selfCopy isResidentFirstAccessoryCommunicationEnabled];
      v8 = HMFBooleanToString();
      v9 = HMFBooleanToString();
      v11 = 138543874;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Updating isResidentFirstAccessoryCommunicationEnabled from %@ to %@", &v11, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    [(HMDHome *)selfCopy setResidentFirstAccessoryCommunicationEnabled:shouldEnableResidentFirstAccessoryCommunication];
    logAndPostNotification(@"HMDHomeIsResidentFirstAccessoryCommunicationEnabledDidChangeNotification", selfCopy, 0);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)doesHomeContainResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];
  v4 = [residentDevices count] != 0;

  return v4;
}

- (NSNumber)matterFabricID
{
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    [(HMDHome *)self fabric];
  }

  else
  {
    [(HMDHome *)self chipStorage];
  }
  v3 = ;
  fabricID = [v3 fabricID];

  return fabricID;
}

- (BOOL)areAllResidentsUnreachable
{
  enabledResidents = [(HMDHome *)self enabledResidents];
  v3 = [enabledResidents na_allObjectsPassTest:&__block_literal_global_1672];

  return v3;
}

- (BOOL)isCurrentDeviceConfirmedPrimaryResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDeviceConfirmedPrimaryResident = [residentDeviceManager isCurrentDeviceConfirmedPrimaryResident];

  return isCurrentDeviceConfirmedPrimaryResident;
}

- (id)_hasConfirmedPrimaryResidentDevice
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  confirmedPrimaryResidentDevice = [residentDeviceManager confirmedPrimaryResidentDevice];

  return confirmedPrimaryResidentDevice;
}

- (BOOL)hasResidentDevicesForPrimaryResidentChangeMonitor:(id)monitor
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];
  v5 = [residentDevices count] != 0;

  return v5;
}

- (BOOL)isCurrentDevicePrimaryResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isCurrentDevicePrimaryResident = [residentDeviceManager isCurrentDevicePrimaryResident];

  return isCurrentDevicePrimaryResident;
}

- (id)primaryResident
{
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];

  return primaryResidentDevice;
}

- (BOOL)isResidentSupported
{
  if (isWatch())
  {
    homeManager = [(HMDHome *)self homeManager];
    companionReachable = [homeManager companionReachable];

    if (companionReachable)
    {
      return 0;
    }
  }

  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  isResidentAvailable = [residentDeviceManager isResidentAvailable];

  return isResidentAvailable;
}

- (void)_handleCharacteristicEnableNotification:(id)notification
{
  v95 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v68 = notificationCopy;
  if ([notificationCopy isRemote] && (objc_msgSend(notificationCopy, "isSecureRemote") & 1) == 0)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v13;
      *&buf[12] = 2112;
      *&buf[14] = v68;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    responseHandler = [v68 responseHandler];

    if (responseHandler)
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      responseHandler2 = [v68 responseHandler];
      (responseHandler2)[2](responseHandler2, v15, 0);
    }
  }

  else
  {
    messagePayload = [notificationCopy messagePayload];
    v66 = [messagePayload objectForKey:@"kNotificationEnablePayloadKey"];

    if (v66)
    {
      v5 = @"kNotificationEnablePayloadKey";
    }

    else
    {
      messagePayload2 = [v68 messagePayload];
      v7 = [messagePayload2 objectForKey:@"kNotificationDisablePayloadKey"];

      if (!v7)
      {
        responseHandler3 = [v68 responseHandler];
        v58 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        (responseHandler3)[2](responseHandler3, v58, 0);

        goto LABEL_49;
      }

      v5 = @"kNotificationDisablePayloadKey";
    }

    v67 = [v68 dictionaryForKey:v5];
    clientIdentifier = [v68 clientIdentifier];

    if (clientIdentifier)
    {
      clientIdentifier2 = [v68 clientIdentifier];
      v65 = [@"com.apple.HomeKit.client." stringByAppendingString:clientIdentifier2];
    }

    else
    {
      v65 = @"com.apple.HomeKitDaemon";
      v17 = @"com.apple.HomeKitDaemon";
    }

    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    v86 = 0u;
    v87 = 0u;
    v84 = 0u;
    v85 = 0u;
    obj = [v67 allKeys];
    v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
    if (v71)
    {
      v69 = *v85;
      v19 = @"disable";
      if (v66)
      {
        v19 = @"enable";
      }

      v60 = v19;
      *&v18 = 138544642;
      v59 = v18;
      do
      {
        for (i = 0; i != v71; ++i)
        {
          if (*v85 != v69)
          {
            objc_enumerationMutation(obj);
          }

          v21 = *(*(&v84 + 1) + 8 * i);
          v22 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v21];
          v23 = [(HMDHome *)self accessoryWithUUID:v22];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            v26 = [v67 hmf_arrayForKey:v21];
            if ([v26 count])
            {
              [strongToStrongObjectsMapTable setObject:v26 forKey:v25];
            }

            else
            {
              context = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v35 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
              {
                v61 = HMFGetLogIdentifier();
                name = [(HMDHome *)selfCopy2 name];
                uuid = [(HMDHome *)selfCopy2 uuid];
                uUIDString = [uuid UUIDString];
                name2 = [v25 name];
                *buf = v59;
                *&buf[4] = v61;
                *&buf[12] = 2112;
                *&buf[14] = name;
                *&buf[22] = 2112;
                v90 = uUIDString;
                *v91 = 2112;
                *&v91[2] = v60;
                *&v91[10] = 2112;
                *&v91[12] = name2;
                v92 = 2112;
                v93 = v21;
                _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for zero characteristics on accessory %@/%@", buf, 0x3Eu);
              }

              objc_autoreleasePoolPop(context);
            }
          }

          else
          {
            v27 = objc_autoreleasePoolPush();
            selfCopy3 = self;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
            {
              v30 = HMFGetLogIdentifier();
              name3 = [(HMDHome *)selfCopy3 name];
              uuid2 = [(HMDHome *)selfCopy3 uuid];
              uUIDString2 = [uuid2 UUIDString];
              *buf = 138544386;
              *&buf[4] = v30;
              *&buf[12] = 2112;
              *&buf[14] = name3;
              *&buf[22] = 2112;
              v90 = uUIDString2;
              *v91 = 2112;
              *&v91[2] = v60;
              *&v91[10] = 2112;
              *&v91[12] = v21;
              _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@%@/%@: Received notification %@ for different accessory: %@", buf, 0x34u);
            }

            objc_autoreleasePoolPop(v27);
          }
        }

        v71 = [obj countByEnumeratingWithState:&v84 objects:v94 count:16];
      }

      while (v71);
    }

    v40 = [strongToStrongObjectsMapTable count];
    if (v40)
    {
      responseHandler4 = dispatch_group_create();
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x3032000000;
      v90 = __Block_byref_object_copy__10664;
      *v91 = __Block_byref_object_dispose__10665;
      *&v91[8] = 0;
      v80 = 0u;
      v81 = 0u;
      v82 = 0u;
      v83 = 0u;
      v42 = strongToStrongObjectsMapTable;
      v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
      if (v43)
      {
        v44 = 0;
        v45 = *v81;
        v70 = v40 - 1;
        do
        {
          v46 = 0;
          v47 = v70 - v44;
          v72 = v44 + v43;
          do
          {
            if (*v81 != v45)
            {
              objc_enumerationMutation(v42);
            }

            v48 = *(*(&v80 + 1) + 8 * v46);
            dispatch_group_enter(responseHandler4);
            v49 = MEMORY[0x277D0F818];
            v77[0] = MEMORY[0x277D85DD0];
            v77[1] = 3221225472;
            v77[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke;
            v77[3] = &unk_279725FA0;
            v77[4] = self;
            v79 = buf;
            v78 = responseHandler4;
            v50 = [v49 messageWithMessage:v68 messagePayload:0 responseHandler:v77];
            v51 = [v50 mutableCopy];

            if (v47 != v46)
            {
              uUID = [MEMORY[0x277CCAD78] UUID];
              [v51 setIdentifier:uUID];
            }

            v53 = [v42 objectForKey:{v48, v59}];
            [v48 enableNotification:v66 != 0 forCharacteristicIDs:v53 message:v51 clientIdentifier:v65];

            ++v46;
          }

          while (v43 != v46);
          v43 = [v42 countByEnumeratingWithState:&v80 objects:v88 count:16];
          v44 = v72;
        }

        while (v43);
      }

      workQueue = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3;
      block[3] = &unk_279734898;
      v75 = v68;
      v76 = buf;
      dispatch_group_notify(responseHandler4, workQueue, block);

      _Block_object_dispose(buf, 8);
    }

    else
    {
      responseHandler4 = [v68 responseHandler];
      v55 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(responseHandler4 + 16))(responseHandler4, v55, 0);
    }
  }

LABEL_49:

  v56 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2;
  block[3] = &unk_279735BC0;
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 40) + 8) + 40), 0);
  }
}

void __51__HMDHome__handleCharacteristicEnableNotification___block_invoke_2(uint64_t a1)
{
  v2 = *(*(a1 + 48) + 8);
  v4 = *(v2 + 40);
  v3 = (v2 + 40);
  if (!v4)
  {
    objc_storeStrong(v3, *(a1 + 32));
  }

  v5 = *(a1 + 40);

  dispatch_group_leave(v5);
}

HMDCharacteristicUpdateTuple *__45__HMDHome__handlePendingResponsesTimerFired___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 error];

  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v5 = [HMDCharacteristicUpdateTuple alloc];
    v6 = [v2 request];
    v7 = [v6 characteristic];
    v8 = [v2 value];
    v4 = [(HMDCharacteristicUpdateTuple *)v5 initWithCharacteristic:v7 updatedValue:v8 isBroadcast:0];
  }

  return v4;
}

- (void)_handleSendingNotificationsForRequest:(id)request requestIdentifier:(id)identifier supportsMultiPartResponse:(BOOL)response characteristicUpdates:(id)updates completion:(id)completion
{
  responseCopy = response;
  v53 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  identifierCopy = identifier;
  updatesCopy = updates;
  completionCopy = completion;
  destination = [requestCopy destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = destination;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  if ([requestCopy isRemote] && (objc_msgSend(v18, "device"), v19 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v19, "remoteDestinationString"), v20 = objc_claimAutoreleasedReturnValue(), v20, v19, v20))
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      v38 = v24;
      shortDescription = [requestCopy shortDescription];
      v26 = "single";
      if (responseCopy)
      {
        v26 = "multi";
      }

      v35 = v26;
      v36 = shortDescription;
      v27 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(updatesCopy, "count")}];
      device = [v18 device];
      [device remoteDestinationString];
      *buf = 138544898;
      v40 = v24;
      v41 = 2112;
      v42 = v36;
      v43 = 2080;
      v44 = v35;
      v45 = 2112;
      v46 = v27;
      v47 = 2112;
      v48 = updatesCopy;
      v49 = 2112;
      v50 = identifierCopy;
      v52 = v51 = 2112;
      v28 = v52;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Response notification for %@ (%s part) [%@] with chars: %@ with id: %@ to device: %@", buf, 0x48u);
    }

    objc_autoreleasePoolPop(v21);
    uUID = [MEMORY[0x277CCAD78] UUID];
    uUIDString = [uUID UUIDString];
    device2 = [v18 device];
    remoteDestinationString = [device2 remoteDestinationString];
    [(HMDHome *)selfCopy _notifyUpdatedCharacteristic:updatesCopy withRequestIdentifier:identifierCopy notificationUpdateIdentifier:uUIDString toUserDeviceAddress:remoteDestinationString completion:completionCopy];
  }

  else if (completionCopy)
  {
    v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    completionCopy[2](completionCopy, v33);
  }

  v34 = *MEMORY[0x277D85DE8];
}

- (void)_handleMultipleCharacteristicRead:(id)read
{
  v38 = *MEMORY[0x277D85DE8];
  readCopy = read;
  currentActivity = [MEMORY[0x277D0F770] currentActivity];
  if ([readCopy isRemote] && (objc_msgSend(readCopy, "isSecureRemote") & 1) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v18 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_21;
    }

    v19 = HMFGetLogIdentifier();
    *buf = 138543618;
    v33 = v19;
    v34 = 2112;
    v35 = readCopy;
    v20 = "%{public}@Message not supported: %@";
    v21 = v18;
    v22 = 22;
    goto LABEL_20;
  }

  if ([readCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(readCopy, "isRemote"))
  {
    v31 = 0;
    responseHandler4 = [(HMDHome *)self _readRequestTuplesFromMessage:readCopy outUnhandledRequests:&v31];
    v7 = v31;
    if ([responseHandler4 count])
    {
      if ([v7 count])
      {
        v8 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          shortDescription = [readCopy shortDescription];
          *buf = 138543874;
          v33 = v11;
          v34 = 2112;
          v35 = shortDescription;
          v36 = 2112;
          v37 = v7;
          _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v8);
      }

      source = [readCopy source];
      [responseHandler4 count];
      [readCopy isRemote];
      v14 = HMDRequestSourceAsString(source);
      [(HMDHome *)self startReportingSessionForMessage:readCopy];
      v15 = [(HMDHome *)self __readWriteResponseHandler:readCopy unhandledRequests:v7];
      [(HMDHome *)self _readCharacteristicValues:responseHandler4 requestMessage:readCopy source:source withCompletionHandler:v15];
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543362;
        v33 = v26;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_DEFAULT, "%{public}@None of the characteristics/properties in multi-read are valid", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v15 domain];

      [v15 code];
      responseHandler = [readCopy responseHandler];

      if (responseHandler)
      {
        responseHandler2 = [readCopy responseHandler];
        (responseHandler2)[2](responseHandler2, v15, 0);
      }
    }

    goto LABEL_23;
  }

  v16 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543362;
    v33 = v19;
    v20 = "%{public}@Client does not have entitlement to use SPI";
    v21 = v18;
    v22 = 12;
LABEL_20:
    _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEFAULT, v20, buf, v22);
  }

LABEL_21:

  objc_autoreleasePoolPop(v16);
  v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
  [v7 domain];

  [v7 code];
  responseHandler3 = [readCopy responseHandler];

  if (responseHandler3)
  {
    responseHandler4 = [readCopy responseHandler];
    (responseHandler4)[2](responseHandler4, v7, 0);
LABEL_23:
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicRead:(id)read
{
  v51[1] = *MEMORY[0x277D85DE8];
  readCopy = read;
  messagePayload = [readCopy messagePayload];
  v6 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (!v9)
  {
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [readCopy respondWithError:v11];
LABEL_17:

    goto LABEL_18;
  }

  if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    messagePayload2 = [readCopy messagePayload];
    v11 = [messagePayload2 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];

    messagePayload3 = [readCopy messagePayload];
    v13 = [messagePayload3 objectForKeyedSubscript:*MEMORY[0x277CD2140]];

    v14 = [v9 findService:v11];
    v15 = [v14 findCharacteristic:v13];
    v16 = v15;
    if (v15)
    {
      v36 = v11;
      v51[0] = v15;
      v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v51 count:1];
      v37 = 0;
      v18 = [(HMDHome *)self _isReadRequestAllowForCharacteristics:v17 message:readCopy error:&v37];
      v19 = v37;

      if (v18)
      {
        v35 = v19;
        v33 = [HMDCharacteristicRequest requestWithCharacteristic:v16];
        source = [readCopy source];
        v20 = objc_autoreleasePoolPush();
        selfCopy = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v32 = HMFGetLogIdentifier();
          shortDescription = [readCopy shortDescription];
          [v6 UUIDString];
          v24 = v31 = v22;
          [v9 uniqueIdentifier];
          v25 = v30 = v20;
          *buf = 138544642;
          v40 = v32;
          v41 = 2112;
          v42 = shortDescription;
          v43 = 2112;
          v44 = v24;
          v45 = 2112;
          v46 = v25;
          v47 = 2112;
          v48 = v36;
          v49 = 2112;
          v50 = v13;
          _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic read request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic read requests", buf, 0x3Eu);

          v20 = v30;
          v22 = v31;
        }

        objc_autoreleasePoolPop(v20);
        v38 = v33;
        v26 = [MEMORY[0x277CBEA60] arrayWithObjects:&v38 count:1];
        v27 = [(HMDHome *)selfCopy __readWriteResponseHandler:readCopy unhandledRequests:0];
        [(HMDHome *)selfCopy _readCharacteristicValues:v26 requestMessage:readCopy source:source withCompletionHandler:v27];

        v19 = v35;
      }

      else
      {
        [readCopy respondWithError:v19];
      }

      v11 = v36;
    }

    else
    {
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [readCopy respondWithError:v28];
    }

    goto LABEL_17;
  }

  [v9 _handleCharacteristicRead:readCopy];
LABEL_18:

  v29 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isReadRequestAllowForCharacteristics:(id)characteristics message:(id)message error:(id *)error
{
  messageCopy = message;
  if ([(HMDHome *)self requiresUnlockToAccessCharacteristics:characteristics withMessage:messageCopy]&& ![(HMDHome *)self isAccessAllowedForCharacteristicsWithMessage:messageCopy])
  {
    if (error)
    {
      HMDSecureAccessErrorCodeForMessage(messageCopy, [messageCopy source]);
      *error = v9 = 0;
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_readRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests
{
  requestsCopy = requests;
  v66 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v4 = [messageCopy dictionaryForKey:*MEMORY[0x277CCE7A8]];
  array = [MEMORY[0x277CBEB18] array];
  v48 = objc_alloc_init(MEMORY[0x277CBEB38]);
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = v4;
  v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
  if (v37)
  {
    v35 = *v60;
    v47 = array;
    do
    {
      v6 = 0;
      do
      {
        if (*v60 != v35)
        {
          objc_enumerationMutation(obj);
        }

        v39 = v6;
        v7 = *(*(&v59 + 1) + 8 * v6);
        v8 = [obj hmf_dictionaryForKey:{v7, requestsCopy}];
        v49 = v7;
        v9 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
        v10 = [(HMDHome *)self accessoryWithUUID:v9];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v41 = v11;

        v57 = 0u;
        v58 = 0u;
        v55 = 0u;
        v56 = 0u;
        v12 = v8;
        array = v47;
        v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
        if (v43)
        {
          v42 = *v56;
          v40 = v12;
          do
          {
            for (i = 0; i != v43; ++i)
            {
              if (*v56 != v42)
              {
                objc_enumerationMutation(v12);
              }

              v14 = *(*(&v55 + 1) + 8 * i);
              v15 = [v12 hmf_arrayForKey:v14];
              v16 = [v15 na_map:&__block_literal_global_1642];

              v17 = HAPInstanceIDFromValue();
              if (v17)
              {
                v46 = i;
                v44 = v17;
                v18 = [v41 findService:v17];
                v51 = 0u;
                v52 = 0u;
                v53 = 0u;
                v54 = 0u;
                v45 = v16;
                v19 = v16;
                v20 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                if (v20)
                {
                  v21 = v20;
                  v22 = *v52;
                  do
                  {
                    for (j = 0; j != v21; ++j)
                    {
                      if (*v52 != v22)
                      {
                        objc_enumerationMutation(v19);
                      }

                      v24 = *(*(&v51 + 1) + 8 * j);
                      v25 = [v18 findCharacteristic:v24];
                      if (v25)
                      {
                        [array addObject:v25];
                      }

                      else
                      {
                        v26 = [v48 hmf_mutableDictionaryForKey:v49];
                        if (!v26)
                        {
                          v26 = objc_alloc_init(MEMORY[0x277CBEB38]);
                          [v48 setObject:v26 forKeyedSubscript:v49];
                        }

                        v27 = [v26 hmf_mutableArrayForKey:v14];
                        if (!v27)
                        {
                          v27 = objc_alloc_init(MEMORY[0x277CBEB18]);
                          [v26 setObject:v27 forKeyedSubscript:v14];
                        }

                        [v27 addObject:v24];

                        array = v47;
                      }
                    }

                    v21 = [v19 countByEnumeratingWithState:&v51 objects:v63 count:16];
                  }

                  while (v21);
                }

                v12 = v40;
                v16 = v45;
                i = v46;
                v17 = v44;
              }
            }

            v43 = [v12 countByEnumeratingWithState:&v55 objects:v64 count:16];
          }

          while (v43);
        }

        v6 = v39 + 1;
      }

      while (v39 + 1 != v37);
      v37 = [obj countByEnumeratingWithState:&v59 objects:v65 count:16];
    }

    while (v37);
  }

  if (requestsCopy)
  {
    *requestsCopy = [v48 copy];
  }

  v50 = 0;
  requestsCopy = [(HMDHome *)self _isReadRequestAllowForCharacteristics:array message:messageCopy error:&v50, requestsCopy];
  v29 = v50;
  if (requestsCopy)
  {
    v30 = [array na_map:&__block_literal_global_1645];
  }

  else
  {
    [messageCopy respondWithError:v29];
    v30 = 0;
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_readCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source withCompletionHandler:(id)handler
{
  v72 = *MEMORY[0x277D85DE8];
  valuesCopy = values;
  messageCopy = message;
  handlerCopy = handler;
  v12 = objc_alloc(MEMORY[0x277D0F770]);
  v13 = MEMORY[0x277CCACA8];
  v14 = MEMORY[0x259C01AE0](self, a2);
  27461 = [v13 stringWithFormat:@"%@, %s:%ld", v14, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 27461];
  v67 = [v12 initWithName:27461];

  if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    isCurrentDeviceAvailableResident = [(HMDHome *)self isCurrentDeviceAvailableResident];
    v17 = objc_autoreleasePoolPush();
    selfCopy = self;
    if (isCurrentDeviceAvailableResident)
    {
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        shortDescription = [messageCopy shortDescription];
        *buf = 138543618;
        v69 = v20;
        v70 = 2112;
        v71 = shortDescription;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
      }
    }

    else
    {
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v43 = HMFGetLogIdentifier();
        shortDescription2 = [messageCopy shortDescription];
        *buf = 138543618;
        v69 = v43;
        v70 = 2112;
        v71 = shortDescription2;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Routing accessory read requests using Resident First logic. %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v17);
    v45 = [(HMDHome *)selfCopy _createMessageForReadWriteRequest:messageCopy source:source withCompletionHandler:handlerCopy];
    accessoryReaderWriter = [(HMDHome *)selfCopy accessoryReaderWriter];
    [accessoryReaderWriter submitReadRequests:valuesCopy sourceType:source requestMessage:v45];
  }

  else
  {
    v54 = dispatch_group_create();
    identifier = [messageCopy identifier];
    v23 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
    v24 = [messageCopy stringForKey:@"kRequestIdentifierKey"];
    uUIDString = [identifier UUIDString];
    v26 = [(HMDHome *)self _setupPendingResponseTimerIdentifier:uUIDString originalRequestIdentifier:v24];

    v27 = +[HMDPendingResponse tupleForMessage:originalRequestIdentifier:requestCount:withCompletionHandler:](HMDPendingResponse, "tupleForMessage:originalRequestIdentifier:requestCount:withCompletionHandler:", messageCopy, v26, [valuesCopy count], handlerCopy);
    pendingResponses = [(HMDHome *)self pendingResponses];
    [pendingResponses setObject:v27 forKeyedSubscript:v26];

    weakToStrongObjectsMapTable = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
    v30 = [(HMDHome *)self _buildRequestMapTableFromRequests:valuesCopy pendingResponses:v27];

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    if (isWatch() && [(HMDHome *)self _passReadRequestToCompanion:v30 requestMessage:messageCopy source:source pendingResponses:v27 remoteAccessories:dictionary withCompletionHandler:handlerCopy])
    {
    }

    else
    {
      v50 = v23;
      v55 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v30, "count")}];
      [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v30, "count")}];
      v48 = v24;
      v51 = v49 = identifier;
      v52 = dispatch_group_create();
      [(HMDHome *)self _sendReadRequestToAccessoryServer:v30 requestMessage:messageCopy source:source pendingResponses:v27 slowFailedAccessories:v55 fastFailedAccessories:v51 unreachableWaitGroup:v52 waitGroup:v54 activity:v67];
      v31 = dispatch_group_create();
      array = [MEMORY[0x277CBEB18] array];
      dispatch_group_enter(v31);
      [(HMDHome *)self _waitForEarlyDispatchTimeoutOnReadRequest:v30 requestMessage:messageCopy source:source pendingResponses:v27 activity:v67 slowFailedAccessories:v55 tmpErrorResponseTuples:array unreachableWaitGroup:v52 failureWaitGroup:v31];
      [(HMDHome *)self _handleFailedAccessories:v30 requestMessage:messageCopy source:source pendingResponses:v27 fastFailedAccessories:v51 slowFailedAccessories:v55 tmpErrorResponseTuples:array waitGroup:v54 failureWaitGroup:v31 activity:v67];
      v33 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v69 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Wait before final notification", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      workQueue = [(HMDHome *)selfCopy2 workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __81__HMDHome__readCharacteristicValues_requestMessage_source_withCompletionHandler___block_invoke;
      block[3] = &unk_279722A38;
      v66 = v50;
      block[4] = selfCopy2;
      v59 = v27;
      v60 = array;
      v61 = v49;
      v62 = messageCopy;
      v63 = v48;
      v64 = v26;
      v65 = handlerCopy;
      v38 = v26;
      v39 = v48;
      v40 = v49;
      v41 = array;
      v42 = v27;
      dispatch_group_notify(v31, workQueue, block);
    }
  }

  __HMFActivityScopeLeave();

  v47 = *MEMORY[0x277D85DE8];
}

void __81__HMDHome__readCharacteristicValues_requestMessage_source_withCompletionHandler___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = v5;
    v7 = "single";
    if (*(a1 + 96))
    {
      v7 = "multi";
    }

    v20 = 138543618;
    v21 = v5;
    v22 = 2080;
    v23 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Final notification for multi-read (%s part)", &v20, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v8 = [*(a1 + 40) retrieveAndClearAllResponses];
  v9 = v8;
  v10 = *(a1 + 48);
  if (v10)
  {
    if (v8)
    {
      v11 = [v8 mutableCopy];
      v12 = [v11 arrayByAddingObjectsFromArray:*(a1 + 48)];

      v9 = v12;
    }

    else
    {
      v9 = v10;
    }
  }

  [*(a1 + 32) _notifyChangedCharacteristics:v9 identifier:*(a1 + 56) multiPartResponse:*(a1 + 96) moreMessagesInMultipart:0 requestMessage:*(a1 + 64) withCompletionHandler:*(a1 + 88)];
  if (!*(a1 + 72))
  {
    v13 = objc_autoreleasePoolPush();
    v14 = *(a1 + 32);
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 80);
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v17;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Remove tracking pending response for identifier %@ after final notification", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v18 = [*(a1 + 32) pendingResponses];
    [v18 removeObjectForKey:*(a1 + 80)];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_sendReadRequestToAccessoryServer:(id)server requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses slowFailedAccessories:(id)accessories fastFailedAccessories:(id)failedAccessories unreachableWaitGroup:(id)group waitGroup:(id)self0 activity:(id)self1
{
  v71 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  messageCopy = message;
  responsesCopy = responses;
  accessoriesCopy = accessories;
  failedAccessoriesCopy = failedAccessories;
  group = group;
  waitGroupCopy = waitGroup;
  activityCopy = activity;
  v19 = [messageCopy BOOLForKey:@"kDoNotForwardMessageKey"];
  v37 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  v40 = messageCopy;
  identifier = [messageCopy identifier];
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  v63 = 0u;
  obj = serverCopy;
  v45 = [obj countByEnumeratingWithState:&v60 objects:v70 count:16];
  if (v45)
  {
    v36 = v19 ^ 1;
    v35 = *v61;
    v34 = activityCopy;
    do
    {
      for (i = 0; i != v45; ++i)
      {
        if (*v61 != v35)
        {
          objc_enumerationMutation(obj);
        }

        v21 = *(*(&v60 + 1) + 8 * i);
        dispatch_group_enter(waitGroupCopy);
        dispatch_group_enter(group);
        v22 = [obj objectForKey:v21];
        shortDescription = [v21 shortDescription];
        [activityCopy markWithFormat:@"Starting read for accessory: %@", shortDescription];

        uuid = [v21 uuid];
        v25 = objc_autoreleasePoolPush();
        selfCopy = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
        {
          v28 = HMFGetLogIdentifier();
          v29 = [v22 count];
          *buf = 138543874;
          v65 = v28;
          v66 = 2112;
          v67 = uuid;
          v68 = 2048;
          v69 = v29;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Starting read for accessory %@ with %ld requests", buf, 0x20u);

          activityCopy = v34;
        }

        objc_autoreleasePoolPop(v25);
        [v22 count];
        workQueue = [(HMDHome *)selfCopy workQueue];
        v48[0] = MEMORY[0x277D85DD0];
        v48[1] = 3221225472;
        v48[2] = __168__HMDHome__sendReadRequestToAccessoryServer_requestMessage_source_pendingResponses_slowFailedAccessories_fastFailedAccessories_unreachableWaitGroup_waitGroup_activity___block_invoke;
        v48[3] = &unk_279722A10;
        v48[4] = selfCopy;
        v48[5] = v21;
        v49 = activityCopy;
        v50 = uuid;
        v58 = v36;
        v59 = v37;
        v51 = accessoriesCopy;
        v52 = failedAccessoriesCopy;
        v53 = responsesCopy;
        v31 = v40;
        v54 = v31;
        v55 = identifier;
        v56 = waitGroupCopy;
        groupCopy = group;
        v32 = uuid;
        [v21 readCharacteristicValues:v22 source:source message:v31 queue:workQueue logEvent:0 completionHandler:v48];
      }

      v45 = [obj countByEnumeratingWithState:&v60 objects:v70 count:16];
    }

    while (v45);
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __168__HMDHome__sendReadRequestToAccessoryServer_requestMessage_source_pendingResponses_slowFailedAccessories_fastFailedAccessories_unreachableWaitGroup_waitGroup_activity___block_invoke(uint64_t a1, void *a2)
{
  v63 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    v11 = [*(a1 + 40) uniqueIdentifier];
    *buf = 138544386;
    v54 = v7;
    v55 = 2112;
    v56 = v8;
    v57 = 2112;
    v58 = v10;
    v59 = 2112;
    v60 = v11;
    v61 = 2048;
    v62 = [v3 count];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Completed read for accessory %@/%@/%@ with %ld responses", buf, 0x34u);
  }

  v47 = a1;

  objc_autoreleasePoolPop(v4);
  v50 = 0u;
  v51 = 0u;
  v48 = 0u;
  v49 = 0u;
  v12 = v3;
  v13 = [v12 countByEnumeratingWithState:&v48 objects:v52 count:16];
  if (!v13)
  {
    goto LABEL_22;
  }

  v14 = v13;
  v15 = *v49;
  v16 = *MEMORY[0x277CCA7E8];
  v17 = *MEMORY[0x277CCFD28];
  while (2)
  {
    for (i = 0; i != v14; ++i)
    {
      if (*v49 != v15)
      {
        objc_enumerationMutation(v12);
      }

      v19 = [*(*(&v48 + 1) + 8 * i) error];
      [v19 domain];

      [v19 code];
      v20 = [v19 userInfo];

      if (v20)
      {
        v21 = [v19 userInfo];
        v22 = [v21 objectForKey:v16];

        if (v22)
        {
          v23 = !+[HMDHAPAccessory suspendedPerErrorCode:](HMDHAPAccessory, "suspendedPerErrorCode:", [v22 code]);
        }

        else
        {
          LOBYTE(v23) = 1;
        }

        if (!v19)
        {
          goto LABEL_19;
        }
      }

      else
      {
        LOBYTE(v23) = 1;
        if (!v19)
        {
          goto LABEL_19;
        }
      }

      v24 = [v19 domain];
      if (([v24 isEqualToString:v17] & 1) == 0)
      {

LABEL_19:
        continue;
      }

      v25 = ([v19 code] == 4) & v23;

      if (v25 == 1)
      {

        v26 = v47;
        if ((*(v47 + 120) & 1) == 0)
        {
          goto LABEL_30;
        }

        if (*(v47 + 121))
        {
          v27 = [*(v47 + 32) primaryResident];
          v28 = [v27 device];
          v29 = [v28 version];
          v30 = +[HMDHomeKitVersion version4];
          if ([v29 isAtLeastVersion:v30])
          {
            v31 = *(v47 + 121);

            v32 = v31 == 1;
            v26 = v47;
            if (v32)
            {
              v33 = objc_autoreleasePoolPush();
              v34 = *(v47 + 32);
              v35 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
              {
                v36 = HMFGetLogIdentifier();
                *buf = 138543362;
                v54 = v36;
                _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Dispatching to resident with binning", buf, 0xCu);
LABEL_43:

                goto LABEL_44;
              }

              goto LABEL_44;
            }
          }

          else
          {
          }

          v41 = [*(v26 + 40) linkSpeed];
          v33 = objc_autoreleasePoolPush();
          v34 = *(v26 + 32);
          v35 = HMFGetOSLogHandle();
          v42 = os_log_type_enabled(v35, OS_LOG_TYPE_INFO);
          if ((v41 & 0x8000000000000000) == 0)
          {
            if (v42)
            {
              v43 = HMFGetLogIdentifier();
              v44 = [*(v26 + 40) name];
              *buf = 138543618;
              v54 = v43;
              v55 = 2112;
              v56 = v44;
              _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@adding accessory %@ to fast dispatch group (multi-part).", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v33);
            v45 = *(v26 + 72);
            goto LABEL_45;
          }

          if (v42)
          {
            v36 = HMFGetLogIdentifier();
            v39 = [*(v26 + 40) name];
            *buf = 138543618;
            v54 = v36;
            v55 = 2112;
            v56 = v39;
            v40 = "%{public}@adding accessory %@ to slow dispatch group (multi-part).";
            goto LABEL_42;
          }
        }

        else
        {
          v33 = objc_autoreleasePoolPush();
          v34 = *(v47 + 32);
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            v39 = [*(v47 + 40) name];
            *buf = 138543618;
            v54 = v36;
            v55 = 2112;
            v56 = v39;
            v40 = "%{public}@adding accessory %@ to dispatch group (single-part).";
LABEL_42:
            _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, v40, buf, 0x16u);

            goto LABEL_43;
          }
        }

LABEL_44:

        objc_autoreleasePoolPop(v33);
        v45 = *(v26 + 64);
LABEL_45:
        [v45 addObject:*(v26 + 40)];
        goto LABEL_46;
      }
    }

    v14 = [v12 countByEnumeratingWithState:&v48 objects:v52 count:16];
    if (v14)
    {
      continue;
    }

    break;
  }

LABEL_22:

  v26 = v47;
LABEL_30:
  [*(v26 + 80) addResponsesToPendingResponse:v12];
  if (*(v26 + 121) == 1 && ([*(v26 + 88) isRemote] & 1) == 0)
  {
    v37 = *(v26 + 32);
    v38 = [*(v26 + 80) retrieveAndClearAllResponses];
    [v37 _notifyChangedCharacteristics:v38 identifier:*(v26 + 96) multiPartResponse:1 moreMessagesInMultipart:1 requestMessage:*(v26 + 88) withCompletionHandler:0];
  }

LABEL_46:
  dispatch_group_leave(*(v26 + 104));
  dispatch_group_leave(*(v26 + 112));

  v46 = *MEMORY[0x277D85DE8];
}

- (void)_waitForEarlyDispatchTimeoutOnReadRequest:(id)request requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses activity:(id)activity slowFailedAccessories:(id)accessories tmpErrorResponseTuples:(id)tuples unreachableWaitGroup:(id)self0 failureWaitGroup:(id)self1
{
  requestCopy = request;
  messageCopy = message;
  responsesCopy = responses;
  activityCopy = activity;
  accessoriesCopy = accessories;
  tuplesCopy = tuples;
  groupCopy = group;
  waitGroupCopy = waitGroup;
  v23 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  v24 = dispatch_get_global_queue(0, 0);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke;
  block[3] = &unk_27972DC40;
  v36 = groupCopy;
  selfCopy = self;
  v38 = accessoriesCopy;
  v39 = activityCopy;
  v46 = v23;
  v40 = responsesCopy;
  v41 = waitGroupCopy;
  v42 = requestCopy;
  v43 = messageCopy;
  v44 = tuplesCopy;
  sourceCopy = source;
  v25 = tuplesCopy;
  v26 = messageCopy;
  v27 = requestCopy;
  v28 = waitGroupCopy;
  v29 = responsesCopy;
  v30 = activityCopy;
  v31 = accessoriesCopy;
  v32 = groupCopy;
  dispatch_async(v24, block);
}

void __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = dispatch_time(0, 250000000);
  dispatch_group_wait(v2, v3);
  v4 = [*(a1 + 40) workQueue];
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke_2;
  v16[3] = &unk_2797245B0;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v22 = *(a1 + 112);
  *&v7 = *(a1 + 64);
  *(&v7 + 1) = *(a1 + 40);
  *&v8 = v5;
  *(&v8 + 1) = v6;
  v17 = v8;
  v18 = v7;
  v9 = *(a1 + 72);
  v10 = *(a1 + 80);
  v11 = *(a1 + 88);
  v12 = *(a1 + 96);
  v21 = *(a1 + 104);
  v13 = v12;
  *&v14 = v11;
  *(&v14 + 1) = v13;
  *&v15 = v9;
  *(&v15 + 1) = v10;
  v19 = v15;
  v20 = v14;
  dispatch_async(v4, v16);
}

void __184__HMDHome__waitForEarlyDispatchTimeoutOnReadRequest_requestMessage_source_pendingResponses_activity_slowFailedAccessories_tmpErrorResponseTuples_unreachableWaitGroup_failureWaitGroup___block_invoke_2(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CBEA60] arrayWithArray:*(a1 + 32)];
  if ([v2 count])
  {
    [v2 count];
    if (*(a1 + 104))
    {
      [MEMORY[0x277CBEB18] array];
    }

    else
    {
      [*(a1 + 48) allResponses];
    }
    v3 = ;
    [*(a1 + 40) begin];
    v9 = *(a1 + 40);
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 56);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for unreachable read accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 56) _redispatchReadForAccessories:v2 dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 96) responseTuples:v3 errorResponseTuples:*(a1 + 88)];
    __HMFActivityScopeLeave();

    [*(a1 + 32) removeObjectsInArray:v2];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleFailedAccessories:(id)accessories requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses fastFailedAccessories:(id)failedAccessories slowFailedAccessories:(id)slowFailedAccessories tmpErrorResponseTuples:(id)tuples waitGroup:(id)self0 failureWaitGroup:(id)self1 activity:(id)self2
{
  accessoriesCopy = accessories;
  messageCopy = message;
  responsesCopy = responses;
  failedAccessoriesCopy = failedAccessories;
  slowFailedAccessoriesCopy = slowFailedAccessories;
  tuplesCopy = tuples;
  waitGroupCopy = waitGroup;
  activityCopy = activity;
  group = group;
  v37 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  selfCopy = self;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke;
  block[3] = &unk_2797245B0;
  v22 = activityCopy;
  v57 = v22;
  v58 = failedAccessoriesCopy;
  v66 = v37;
  v23 = responsesCopy;
  v59 = v23;
  selfCopy2 = self;
  v24 = waitGroupCopy;
  v61 = v24;
  v25 = accessoriesCopy;
  v62 = v25;
  v26 = messageCopy;
  v63 = v26;
  sourceCopy = source;
  v27 = tuplesCopy;
  v64 = v27;
  v44 = failedAccessoriesCopy;
  dispatch_group_notify(group, workQueue, block);

  dispatch_group_enter(v24);
  workQueue2 = [(HMDHome *)selfCopy workQueue];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke_1624;
  v45[3] = &unk_2797245B0;
  v46 = v22;
  v47 = slowFailedAccessoriesCopy;
  v55 = v37;
  v48 = v23;
  v49 = selfCopy;
  v50 = v24;
  v51 = v25;
  v53 = v27;
  sourceCopy2 = source;
  v52 = v26;
  v41 = v27;
  v29 = v26;
  v30 = v25;
  v31 = v24;
  v32 = v23;
  v33 = slowFailedAccessoriesCopy;
  v34 = v22;
  dispatch_group_notify(group, workQueue2, v45);
}

uint64_t __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  if ([*(a1 + 40) count])
  {
    [*(a1 + 40) count];
    if (*(a1 + 104))
    {
      [MEMORY[0x277CBEB18] array];
    }

    else
    {
      [*(a1 + 48) allResponses];
    }
    v2 = ;
    [*(a1 + 32) begin];
    v9 = *(a1 + 32);
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 56);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      *buf = 138543362;
      v11 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for fast read failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 56) _redispatchReadForAccessories:*(a1 + 40) dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 96) responseTuples:v2 errorResponseTuples:*(a1 + 88)];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeAllObjects];
  }

  dispatch_group_leave(*(a1 + 64));
  result = [*(a1 + 32) end];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

uint64_t __178__HMDHome__handleFailedAccessories_requestMessage_source_pendingResponses_fastFailedAccessories_slowFailedAccessories_tmpErrorResponseTuples_waitGroup_failureWaitGroup_activity___block_invoke_1624(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  if ([*(a1 + 40) count])
  {
    if (*(a1 + 104))
    {
      [MEMORY[0x277CBEB18] array];
    }

    else
    {
      [*(a1 + 48) allResponses];
    }
    v2 = ;
    [*(a1 + 32) begin];
    v9 = *(a1 + 32);
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 56);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      *buf = 138543362;
      v11 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for slow read failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 56) _redispatchReadForAccessories:*(a1 + 40) dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 96) responseTuples:v2 errorResponseTuples:*(a1 + 88)];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeAllObjects];
  }

  dispatch_group_leave(*(a1 + 64));
  result = [*(a1 + 32) end];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (BOOL)_passReadRequestToCompanion:(id)companion requestMessage:(id)message source:(unint64_t)source pendingResponses:(id)responses remoteAccessories:(id)accessories withCompletionHandler:(id)handler
{
  v45 = *MEMORY[0x277D85DE8];
  companionCopy = companion;
  messageCopy = message;
  responsesCopy = responses;
  accessoriesCopy = accessories;
  handlerCopy = handler;
  v33 = messageCopy;
  v19 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  v32 = companionCopy;
  if (isWatch() && [(HMDHome *)self remoteAccessIsEnabled])
  {
    v30 = v19;
    sourceCopy = source;
    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    v20 = companionCopy;
    v21 = [v20 countByEnumeratingWithState:&v40 objects:v44 count:16];
    if (v21)
    {
      v22 = *v41;
      do
      {
        for (i = 0; i != v21; ++i)
        {
          if (*v41 != v22)
          {
            objc_enumerationMutation(v20);
          }

          v24 = [v20 objectForKey:*(*(&v40 + 1) + 8 * i)];
          allResponses = [responsesCopy allResponses];
          [HMDHome appendCharacteristicsToAccessoryList:accessoriesCopy responseTuples:allResponses forMultipleCharacteristicsRemoteRead:v24];
        }

        v21 = [v20 countByEnumeratingWithState:&v40 objects:v44 count:16];
      }

      while (v21);
    }

    array = [MEMORY[0x277CBEB18] array];
    objc_initWeak(&location, self);
    v34[0] = MEMORY[0x277D85DD0];
    v34[1] = 3221225472;
    v34[2] = __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke;
    v34[3] = &unk_2797229E8;
    objc_copyWeak(&v37, &location);
    v35 = v33;
    v38 = v30;
    v36 = handlerCopy;
    [(HMDHome *)self _readCharacteristicValuesForAccessories:accessoriesCopy readRequestMap:v20 responseTuples:array requestMessage:v35 source:sourceCopy viaDevice:0 completionHandler:v34];

    objc_destroyWeak(&v37);
    objc_destroyWeak(&location);

    v27 = 1;
  }

  else
  {
    v27 = 0;
  }

  v28 = *MEMORY[0x277D85DE8];
  return v27;
}

void __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke_2;
  v4[3] = &unk_279732430;
  v4[4] = WeakRetained;
  v5 = *(a1 + 32);
  v7 = *(a1 + 56);
  v6 = *(a1 + 40);
  dispatch_async(v3, v4);
}

void __118__HMDHome__passReadRequestToCompanion_requestMessage_source_pendingResponses_remoteAccessories_withCompletionHandler___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) identifier];
  [v2 _notifyChangedCharacteristics:MEMORY[0x277CBEBF8] identifier:v3 multiPartResponse:*(a1 + 56) moreMessagesInMultipart:0 requestMessage:*(a1 + 40) withCompletionHandler:*(a1 + 48)];
}

- (id)_buildRequestMapTableFromRequests:(id)requests pendingResponses:(id)responses
{
  v43 = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  responsesCopy = responses;
  weakToStrongObjectsMapTable = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = requestsCopy;
  v6 = [obj countByEnumeratingWithState:&v34 objects:v42 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v35;
    *&v7 = 138543618;
    v29 = v7;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v35 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v34 + 1) + 8 * i);
        characteristic = [v11 characteristic];
        service = [characteristic service];
        accessory = [service accessory];

        if (accessory)
        {
          if (([accessory isPrimary] & 1) == 0)
          {
            bridge = [accessory bridge];

            accessory = bridge;
          }

          v16 = [weakToStrongObjectsMapTable objectForKey:accessory];
          v17 = v16;
          v18 = MEMORY[0x277CBEBF8];
          if (v16)
          {
            v18 = v16;
          }

          v19 = v18;

          v20 = [HMDCharacteristicRequest requestWithCharacteristic:characteristic];
          v21 = [v19 arrayByAddingObject:v20];

          [weakToStrongObjectsMapTable setObject:v21 forKey:accessory];
        }

        else
        {
          v22 = v9;
          accessory = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v23 = objc_autoreleasePoolPush();
          selfCopy = self;
          v25 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
          {
            v26 = HMFGetLogIdentifier();
            *buf = v29;
            v39 = v26;
            v40 = 2112;
            v41 = v11;
            _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Aborting characteristic request, accessory is nil %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v23);
          v21 = [HMDCharacteristicResponse responseWithRequest:v11 error:accessory];
          [responsesCopy addToPendingResponses:v21];
          v9 = v22;
        }
      }

      v8 = [obj countByEnumeratingWithState:&v34 objects:v42 count:16];
    }

    while (v8);
  }

  v27 = *MEMORY[0x277D85DE8];

  return weakToStrongObjectsMapTable;
}

- (id)_setupPendingResponseTimerIdentifier:(id)identifier originalRequestIdentifier:(id)requestIdentifier
{
  v29 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  requestIdentifierCopy = requestIdentifier;
  v8 = requestIdentifierCopy;
  if (requestIdentifierCopy)
  {
    v9 = requestIdentifierCopy;

    v10 = objc_alloc(MEMORY[0x277D0F920]);
    v11 = [v10 initWithTimeInterval:1 options:*&pendingResponseTickPeriod];
    [(HMDHome *)self setPendingResponsesTimer:v11];

    workQueue = [(HMDHome *)self workQueue];
    pendingResponsesTimer = [(HMDHome *)self pendingResponsesTimer];
    [pendingResponsesTimer setDelegateQueue:workQueue];

    pendingResponsesTimer2 = [(HMDHome *)self pendingResponsesTimer];
    [pendingResponsesTimer2 setDelegate:self];

    pendingResponsesTimer3 = [(HMDHome *)self pendingResponsesTimer];
    [pendingResponsesTimer3 resume];

    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      pendingResponsesTimer4 = [(HMDHome *)selfCopy pendingResponsesTimer];
      v23 = 138543874;
      v24 = v19;
      v25 = 2048;
      v26 = pendingResponsesTimer4;
      v27 = 2112;
      v28 = v9;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Started pending responses timer %p for request %@", &v23, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    v9 = identifierCopy;
  }

  v21 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)readCharacteristicValues:(id)values source:(unint64_t)source sourceForLogging:(id)logging qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  loggingCopy = logging;
  handlerCopy = handler;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x259C01AE0](self, a2);
  27070 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 27070];
  v32 = [v16 initWithName:27070];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_2797229C0;
  v25 = v32;
  selfCopy = self;
  v27 = loggingCopy;
  v28 = valuesCopy;
  serviceCopy = service;
  sourceCopy = source;
  v29 = handlerCopy;
  v21 = handlerCopy;
  v22 = valuesCopy;
  v23 = loggingCopy;
  dispatch_async(workQueue, block);

  __HMFActivityScopeLeave();
}

void __99__HMDHome_readCharacteristicValues_source_sourceForLogging_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v21[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = *(a1 + 72);
  v4 = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = @"kMultiPartResponseKey";
  v21[0] = MEMORY[0x277CBEC28];
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v21 forKeys:&v20 count:1];
  v6 = [v2 messageWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v3 destination:v4 payload:v5];

  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 40);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = [v6 identifier];
    v12 = *(a1 + 48);
    v14 = 138543874;
    v15 = v10;
    v16 = 2114;
    v17 = v11;
    v18 = 2114;
    v19 = v12;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v14, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  [*(a1 + 40) _readCharacteristicValues:*(a1 + 56) requestMessage:v6 source:*(a1 + 80) withCompletionHandler:*(a1 + 64)];

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_redispatchReadForAccessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source responseTuples:(id)tuples errorResponseTuples:(id)responseTuples
{
  v113 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  groupCopy = group;
  mapCopy = map;
  messageCopy = message;
  tuplesCopy = tuples;
  responseTuplesCopy = responseTuples;
  v20 = objc_alloc(MEMORY[0x277D0F770]);
  v21 = MEMORY[0x277CCACA8];
  v22 = MEMORY[0x259C01AE0](self, a2);
  26961 = [v21 stringWithFormat:@"%@, %s:%ld", v22, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26961];
  v24 = [v20 initWithName:26961];

  primaryResident = [(HMDHome *)self primaryResident];
  if (primaryResident)
  {
    v81 = tuplesCopy;
    v82 = groupCopy;
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __123__HMDHome__redispatchReadForAccessories_dispatchGroup_requestMap_requestMessage_source_responseTuples_errorResponseTuples___block_invoke;
    aBlock[3] = &unk_279722830;
    v74 = mapCopy;
    v78 = mapCopy;
    v99 = v78;
    v72 = responseTuplesCopy;
    v100 = responseTuplesCopy;
    sourceCopy = source;
    v73 = messageCopy;
    v89 = messageCopy;
    v101 = v89;
    selfCopy = self;
    v87 = _Block_copy(aBlock);
    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    selfCopy2 = self;
    v79 = primaryResident;
    v80 = v24;
    v88 = strongToStrongObjectsMapTable;
    if ([primaryResident isCurrentDevice])
    {
      v96 = 0u;
      v97 = 0u;
      v94 = 0u;
      v95 = 0u;
      v27 = accessoriesCopy;
      v28 = [v27 countByEnumeratingWithState:&v94 objects:v112 count:16];
      if (v28)
      {
        v29 = v28;
        v30 = *v95;
        v76 = v27;
        do
        {
          v31 = 0;
          obj = v29;
          do
          {
            if (*v95 != v30)
            {
              objc_enumerationMutation(v27);
            }

            v32 = *(*(&v94 + 1) + 8 * v31);
            homeManager = [(HMDHome *)self homeManager];
            residentMesh = [homeManager residentMesh];
            v35 = [residentMesh bestResidentDeviceForAccessory:v32];

            if (v35)
            {
              v36 = [strongToStrongObjectsMapTable objectForKey:v35];
              v37 = v36;
              if (v36)
              {
                array = v36;
              }

              else
              {
                array = [MEMORY[0x277CBEB18] array];
              }

              uuid2 = array;

              [uuid2 addObject:v32];
              [strongToStrongObjectsMapTable setObject:uuid2 forKey:v35];
            }

            else
            {
              v39 = objc_autoreleasePoolPush();
              selfCopy3 = self;
              v41 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
              {
                v42 = HMFGetLogIdentifier();
                uuid = [v32 uuid];
                [uuid UUIDString];
                v44 = v77 = v39;
                [v32 uniqueIdentifier];
                v46 = v45 = v30;
                *buf = 138543874;
                v107 = v42;
                v108 = 2112;
                v109 = v44;
                v110 = 2112;
                v111 = v46;
                _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Read bulk redispatching failing for %@/%@ (No Mesh Redirect)", buf, 0x20u);

                v30 = v45;
                v39 = v77;

                strongToStrongObjectsMapTable = v88;
                v27 = v76;
              }

              objc_autoreleasePoolPop(v39);
              v105 = v32;
              v47 = [MEMORY[0x277CBEA60] arrayWithObjects:&v105 count:1];
              v48 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v87[2](v87, v47, v48);

              uuid2 = [v32 uuid];
              v29 = obj;
              self = selfCopy2;
            }

            ++v31;
          }

          while (v29 != v31);
          v29 = [v27 countByEnumeratingWithState:&v94 objects:v112 count:16];
        }

        while (v29);
      }
    }

    else
    {
      [strongToStrongObjectsMapTable setObject:accessoriesCopy forKey:primaryResident];
    }

    v53 = [v89 BOOLForKey:@"kMultiPartResponseKey"];
    v90 = 0u;
    v91 = 0u;
    v92 = 0u;
    v93 = 0u;
    obja = [strongToStrongObjectsMapTable keyEnumerator];
    v54 = [obja countByEnumeratingWithState:&v90 objects:v104 count:16];
    if (v54)
    {
      v55 = v54;
      v56 = *v91;
      if (v53)
      {
        v57 = v89;
      }

      else
      {
        v57 = 0;
      }

      do
      {
        for (i = 0; i != v55; ++i)
        {
          if (*v91 != v56)
          {
            objc_enumerationMutation(obja);
          }

          v59 = *(*(&v90 + 1) + 8 * i);
          v60 = [strongToStrongObjectsMapTable objectForKey:v59];
          remoteSourceDevice = [v89 remoteSourceDevice];
          device = [v59 device];
          v63 = [remoteSourceDevice isEqual:device];

          if (v63)
          {
            v64 = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v66 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
            {
              v67 = HMFGetLogIdentifier();
              *buf = 138543874;
              v107 = v67;
              v108 = 2112;
              v109 = v60;
              v110 = 2112;
              v111 = v89;
              _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_ERROR, "%{public}@Skipping read bulk redispatching for accessories %@ (Same source device). Message: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v64);
            v68 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v87[2](v87, v60, v68);

            self = selfCopy2;
          }

          else if (v59 == v79)
          {
            [(HMDHome *)self _reallyRedispatchReadsToDevice:0 accessories:v60 dispatchGroup:v82 requestMap:v78 requestMessage:v57 source:source responseTuples:v81 activity:v80];
          }

          else
          {
            device2 = [v59 device];
            [(HMDHome *)self _reallyRedispatchReadsToDevice:device2 accessories:v60 dispatchGroup:v82 requestMap:v78 requestMessage:v57 source:source responseTuples:v81 activity:v80];
          }

          strongToStrongObjectsMapTable = v88;
        }

        v55 = [obja countByEnumeratingWithState:&v90 objects:v104 count:16];
      }

      while (v55);
    }

    mapCopy = v74;
    v51 = accessoriesCopy;
    v52 = v81;
    groupCopy = v82;
    responseTuplesCopy = v72;
    messageCopy = v73;
    primaryResident = v79;
    v24 = v80;
  }

  else
  {
    v71 = tuplesCopy;
    v50 = tuplesCopy;
    v51 = accessoriesCopy;
    [(HMDHome *)self _reallyRedispatchReadsToDevice:0 accessories:accessoriesCopy dispatchGroup:groupCopy requestMap:mapCopy requestMessage:messageCopy source:source responseTuples:v71 activity:v24];
    v52 = v50;
  }

  v70 = *MEMORY[0x277D85DE8];
}

void __123__HMDHome__redispatchReadForAccessories_dispatchGroup_requestMap_requestMessage_source_responseTuples_errorResponseTuples___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v47 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v41 = 0u;
  v42 = 0u;
  v43 = 0u;
  v44 = 0u;
  obj = v5;
  v31 = [v5 countByEnumeratingWithState:&v41 objects:v46 count:16];
  if (v31)
  {
    v30 = *v42;
    do
    {
      v7 = 0;
      do
      {
        if (*v42 != v30)
        {
          objc_enumerationMutation(obj);
        }

        v35 = *(*(&v41 + 1) + 8 * v7);
        v36 = v7;
        v8 = [*(a1 + 32) objectForKey:?];
        v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v8, "count")}];
        v37 = 0u;
        v38 = 0u;
        v39 = 0u;
        v40 = 0u;
        v10 = v8;
        v11 = [v10 countByEnumeratingWithState:&v37 objects:v45 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v38;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v38 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v37 + 1) + 8 * i);
              v16 = *(a1 + 40);
              v17 = [HMDCharacteristicResponse responseWithRequest:v15 error:v6];
              [v16 addObject:v17];

              v18 = [v15 characteristic];
              [v9 addObject:v18];
            }

            v12 = [v10 countByEnumeratingWithState:&v37 objects:v45 count:16];
          }

          while (v12);
        }

        v33 = [HMDCharacteristicReadWriteLogEvent alloc];
        v34 = *(a1 + 64);
        v32 = [*(a1 + 48) identifier];
        v19 = [*(a1 + 48) clientIdentifier];
        v20 = *(a1 + 48);
        v21 = [v35 home];
        v22 = [v20 userForHome:v21];
        v23 = [v22 uuid];
        LOBYTE(v28) = 0;
        LOBYTE(v27) = 1;
        v24 = [(HMDCharacteristicReadWriteLogEvent *)v33 initWithCharacteristics:v9 hmdAccessory:v35 hapAccessory:0 source:v34 isWriteOperation:0 isTimedWrite:0 isLocal:v27 transactionId:v32 isCached:v28 bundleId:v19 userUUID:v23 writtenValues:MEMORY[0x277CBEBF8]];

        v25 = [*(a1 + 56) logEventSubmitter];
        [v25 submitLogEvent:v24 error:v6];

        v7 = v36 + 1;
      }

      while (v36 + 1 != v31);
      v31 = [obj countByEnumeratingWithState:&v41 objects:v46 count:16];
    }

    while (v31);
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_reallyRedispatchReadsToDevice:(id)device accessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source responseTuples:(id)tuples activity:(id)self0
{
  v60 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  accessoriesCopy = accessories;
  groupCopy = group;
  mapCopy = map;
  messageCopy = message;
  tuplesCopy = tuples;
  v34 = groupCopy;
  activityCopy = activity;
  dispatch_group_enter(groupCopy);
  selfCopy = self;
  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v49 = 0u;
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  obj = accessoriesCopy;
  v45 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
  if (v45)
  {
    v22 = *v50;
    v40 = device;
    v41 = tuplesCopy;
    v39 = *v50;
    v38 = selfCopy;
    do
    {
      for (i = 0; i != v45; ++i)
      {
        if (*v50 != v22)
        {
          objc_enumerationMutation(obj);
        }

        v24 = *(*(&v49 + 1) + 8 * i);
        context = objc_autoreleasePoolPush();
        v25 = selfCopy;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v27 = HMFGetLogIdentifier();
          uuid = [v24 uuid];
          uUIDString = [uuid UUIDString];
          uniqueIdentifier = [v24 uniqueIdentifier];
          *buf = 138543874;
          v54 = v27;
          v55 = 2112;
          v56 = uUIDString;
          v57 = 2112;
          v58 = uniqueIdentifier;
          _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Read bulk redispatching accessory %@/%@ to resident", buf, 0x20u);

          selfCopy = v38;
          v22 = v39;

          tuplesCopy = v41;
          device = v40;
        }

        objc_autoreleasePoolPop(context);
        [device isCurrentDevice];
        [v24 uuid];

        [deviceCopy identifier];
        v31 = [mapCopy objectForKey:v24];
        [HMDHome appendCharacteristicsToAccessoryList:dictionary responseTuples:tuplesCopy forMultipleCharacteristicsRemoteRead:v31];
      }

      v45 = [obj countByEnumeratingWithState:&v49 objects:v59 count:16];
    }

    while (v45);
  }

  v47[0] = MEMORY[0x277D85DD0];
  v47[1] = 3221225472;
  v47[2] = __125__HMDHome__reallyRedispatchReadsToDevice_accessories_dispatchGroup_requestMap_requestMessage_source_responseTuples_activity___block_invoke;
  v47[3] = &unk_279734E00;
  v48 = v34;
  v32 = v34;
  [(HMDHome *)selfCopy _readCharacteristicValuesForAccessories:dictionary readRequestMap:mapCopy responseTuples:tuplesCopy requestMessage:messageCopy source:source viaDevice:deviceCopy completionHandler:v47];

  v33 = *MEMORY[0x277D85DE8];
}

- (void)_readCharacteristicValuesForAccessories:(id)accessories readRequestMap:(id)map responseTuples:(id)tuples requestMessage:(id)message source:(unint64_t)source viaDevice:(id)device completionHandler:(id)handler
{
  v106[3] = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  mapCopy = map;
  tuplesCopy = tuples;
  messageCopy = message;
  deviceCopy = device;
  handlerCopy = handler;
  v18 = objc_alloc(MEMORY[0x277D0F770]);
  v19 = MEMORY[0x277CCACA8];
  v20 = MEMORY[0x259C01AE0](self, a2);
  26763 = [v19 stringWithFormat:@"%@, %s:%ld", v20, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26763];
  v76 = [v18 initWithName:26763];

  v22 = dispatch_group_create();
  dispatch_group_enter(v22);
  array = [MEMORY[0x277CBEB18] array];
  v75 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  if (![accessoriesCopy count])
  {
    dispatch_group_leave(v22);
    goto LABEL_27;
  }

  [MEMORY[0x277D17DC0] currentTime];
  v24 = v23;
  identifier = [messageCopy identifier];
  v26 = [messageCopy userForHome:self];
  uuid = [v26 uuid];
  clientIdentifier = [messageCopy clientIdentifier];
  v29 = [(HMDHome *)self _getLogEventsForOperation:0 startTime:accessoriesCopy accessories:mapCopy requestMap:identifier identifier:uuid userUUID:source source:v24 biomeSource:0 bundleID:clientIdentifier];

  uuid2 = [(HMDHome *)self uuid];
  uUIDString = [uuid2 UUIDString];

  v31 = MEMORY[0x277CBEB38];
  v32 = *MEMORY[0x277CD0640];
  v105[0] = *MEMORY[0x277CCE7A8];
  v105[1] = v32;
  v106[0] = accessoriesCopy;
  v106[1] = uUIDString;
  v105[2] = @"kDoNotForwardMessageKey";
  v33 = [MEMORY[0x277CCABB0] numberWithInt:deviceCopy != 0];
  v106[2] = v33;
  v34 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v106 forKeys:v105 count:3];
  v74 = [v31 dictionaryWithDictionary:v34];

  v70 = +[HMDHomeKitVersion version4];
  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];

  if (device)
  {
    primaryResident2 = [(HMDHome *)self primaryResident];
    device2 = [primaryResident2 device];
    version = [device2 version];
    v40 = [version isAtLeastVersion:v70];

LABEL_7:
    goto LABEL_8;
  }

  if (isWatch())
  {
    homeManager = [(HMDHome *)self homeManager];
    primaryResident2 = [homeManager companionDevice];

    device2 = [primaryResident2 version];
    v40 = [device2 isAtLeastVersion:v70];
    goto LABEL_7;
  }

  v40 = 0;
LABEL_8:
  identifier2 = [messageCopy identifier];
  identifier3 = identifier2;
  if (((identifier2 != 0) & v40) != 1)
  {
LABEL_11:

    goto LABEL_12;
  }

  if (v75)
  {
    v103[0] = @"kMultiPartResponseKey";
    v103[1] = @"kRequestIdentifierKey";
    v104[0] = MEMORY[0x277CBEC38];
    identifier3 = [messageCopy identifier];
    uUIDString2 = [identifier3 UUIDString];
    v104[1] = uUIDString2;
    v45 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v104 forKeys:v103 count:2];
    [v74 addEntriesFromDictionary:v45];

    goto LABEL_11;
  }

LABEL_12:
  v46 = MEMORY[0x277D0F848];
  qualityOfService = [messageCopy qualityOfService];
  messageDestination = [(HMDHome *)self messageDestination];
  v49 = [v74 copy];
  v50 = [v46 messageWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:qualityOfService destination:messageDestination payload:v49];

  objc_initWeak(&location, self);
  v91[0] = MEMORY[0x277D85DD0];
  v91[1] = 3221225472;
  v91[2] = __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke;
  v91[3] = &unk_2797227B8;
  objc_copyWeak(&v98, &location);
  v92 = v76;
  v93 = accessoriesCopy;
  v51 = mapCopy;
  v94 = v51;
  v95 = array;
  v52 = v29;
  v96 = v52;
  v97 = v22;
  [v50 setResponseHandler:v91];
  uuid3 = [(HMDHome *)self uuid];
  workQueue = [(HMDHome *)self workQueue];
  [(HMDHome *)self redispatchToResidentMessage:v50 target:uuid3 responseQueue:workQueue viaDevice:deviceCopy];

  if ([(HMDHome *)self remoteAccessIsEnabled])
  {
    v89 = 0u;
    v90 = 0u;
    v87 = 0u;
    v88 = 0u;
    v55 = v51;
    v56 = [v55 countByEnumeratingWithState:&v87 objects:v102 count:16];
    if (v56)
    {
      v57 = *v88;
      while (2)
      {
        for (i = 0; i != v56; ++i)
        {
          if (*v88 != v57)
          {
            objc_enumerationMutation(v55);
          }

          if ([*(*(&v87 + 1) + 8 * i) hasBTLELink])
          {
            context = objc_autoreleasePoolPush();
            selfCopy = self;
            v60 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
            {
              v61 = HMFGetLogIdentifier();
              *buf = 138543362;
              v101 = v61;
              _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_INFO, "%{public}@There are BTLE accessories that are currently unreachable during the read, kicking scan to update reachability", buf, 0xCu);
            }

            objc_autoreleasePoolPop(context);
            accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
            [accessoryBrowser btleAccessoryReachabilityProbeTimer:1];

            goto LABEL_25;
          }
        }

        v56 = [v55 countByEnumeratingWithState:&v87 objects:v102 count:16];
        if (v56)
        {
          continue;
        }

        break;
      }
    }

LABEL_25:
  }

  objc_destroyWeak(&v98);
  objc_destroyWeak(&location);

LABEL_27:
  workQueue2 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke_1610;
  block[3] = &unk_279725DE8;
  v81 = tuplesCopy;
  v82 = array;
  v83 = messageCopy;
  selfCopy2 = self;
  v86 = v75;
  v85 = handlerCopy;
  v64 = handlerCopy;
  v65 = messageCopy;
  v66 = array;
  v67 = tuplesCopy;
  dispatch_group_notify(v22, workQueue2, block);

  v68 = *MEMORY[0x277D85DE8];
}

void __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v64 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v45 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    if (v5)
    {
      v6 = [MEMORY[0x277CBEB58] set];
      v54 = 0u;
      v55 = 0u;
      v56 = 0u;
      v57 = 0u;
      obj = *(a1 + 40);
      v7 = [obj countByEnumeratingWithState:&v54 objects:v63 count:16];
      if (!v7)
      {
        goto LABEL_31;
      }

      v9 = v7;
      v48 = *v55;
      *&v8 = 138543618;
      v43 = v8;
      v44 = v6;
      while (1)
      {
        v10 = 0;
        v47 = v9;
        do
        {
          if (*v55 != v48)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v54 + 1) + 8 * v10);
          v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
          v13 = [WeakRetained accessoryWithUUID:v12];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if ([v15 isPrimary])
          {
            v16 = v15;
LABEL_16:
            v17 = [*(a1 + 48) objectForKey:{v16, v43}];
            v18 = v17;
            if (v17)
            {
              v52 = 0u;
              v53 = 0u;
              v50 = 0u;
              v51 = 0u;
              v19 = [v17 countByEnumeratingWithState:&v50 objects:v58 count:16];
              if (v19)
              {
                v20 = v19;
                v21 = *v51;
                do
                {
                  v22 = 0;
                  do
                  {
                    if (*v51 != v21)
                    {
                      objc_enumerationMutation(v18);
                    }

                    v23 = [HMDCharacteristicResponse responseWithRequest:*(*(&v50 + 1) + 8 * v22) error:v5];
                    [*(a1 + 56) addObject:v23];

                    ++v22;
                  }

                  while (v20 != v22);
                  v20 = [v18 countByEnumeratingWithState:&v50 objects:v58 count:16];
                }

                while (v20);
              }

              v24 = *(a1 + 64);
              v25 = [v16 uuid];
              v26 = [v25 UUIDString];
              v27 = [v24 objectForKeyedSubscript:v26];
              [v27 setLocal:{objc_msgSend(v45, "hmf_BOOLForKey:", @"NoResident"}];

              v28 = *(a1 + 64);
              v29 = [v16 uuid];
              v30 = [v29 UUIDString];
              v31 = [v28 objectForKeyedSubscript:v30];
              v32 = [v45 objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
              [v31 setTransportType:{objc_msgSend(v32, "intValue")}];

              v33 = [WeakRetained logEventSubmitter];
              v34 = *(a1 + 64);
              v35 = [v16 uuid];
              v36 = [v35 UUIDString];
              v37 = [v34 objectForKeyedSubscript:v36];
              [v33 submitLogEvent:v37 error:v5];

              v6 = v44;
              v9 = v47;
            }

            goto LABEL_29;
          }

          v16 = [v15 bridge];

          if (v16)
          {
            if ([v6 containsObject:v16])
            {
              goto LABEL_29;
            }

            [v6 addObject:v16];
            goto LABEL_16;
          }

          v38 = objc_autoreleasePoolPush();
          v39 = WeakRetained;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_DEFAULT))
          {
            v41 = HMFGetLogIdentifier();
            *buf = v43;
            v60 = v41;
            v61 = 2112;
            v62 = v11;
            _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_DEFAULT, "%{public}@Dropping read responses for nil-ed out accessory with UUID %@", buf, 0x16u);

            v9 = v47;
          }

          objc_autoreleasePoolPop(v38);
          v16 = 0;
LABEL_29:

          ++v10;
        }

        while (v10 != v9);
        v9 = [obj countByEnumeratingWithState:&v54 objects:v63 count:16];
        if (!v9)
        {
LABEL_31:

          dispatch_group_leave(*(a1 + 72));
          goto LABEL_33;
        }
      }
    }

    [WeakRetained _addResponseTuplesFromDictionary:v45 accessoryRequestMapTable:*(a1 + 48) responseTuples:*(a1 + 56) completedGroup:*(a1 + 72) logEvents:*(a1 + 64)];
LABEL_33:
    [*(a1 + 32) end];
  }

  v42 = *MEMORY[0x277D85DE8];
}

void __131__HMDHome__readCharacteristicValuesForAccessories_readRequestMap_responseTuples_requestMessage_source_viaDevice_completionHandler___block_invoke_1610(uint64_t a1)
{
  v32 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) addObjectsFromArray:*(a1 + 40)];
  v2 = *(a1 + 48);
  if (v2)
  {
    v3 = [v2 stringForKey:@"kRequestIdentifierKey"];
    if (v3)
    {
      v4 = v3;
      v5 = [*(a1 + 56) pendingResponses];
      v6 = [v5 objectForKeyedSubscript:v4];

      [v6 addResponsesToPendingResponse:*(a1 + 40)];
    }

    else
    {
      v12 = [*(a1 + 48) identifier];
      v4 = [v12 UUIDString];

      v13 = [*(a1 + 56) pendingResponses];
      v14 = [v13 objectForKeyedSubscript:v4];

      if (v14)
      {
        [v14 setPendingResponseCount:0];
        v15 = objc_autoreleasePoolPush();
        v16 = *(a1 + 56);
        v17 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v18 = HMFGetLogIdentifier();
          v28 = 138543618;
          v29 = v18;
          v30 = 2112;
          v31 = v4;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Remove tracking pending response %@ because last response received", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v15);
        v19 = [*(a1 + 56) pendingResponses];
        [v19 removeObjectForKey:v4];
      }
    }

    v20 = objc_autoreleasePoolPush();
    v21 = *(a1 + 56);
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      v23 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the reads and sending notification.", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v24 = *(a1 + 56);
    v25 = *(a1 + 40);
    v26 = [*(a1 + 48) identifier];
    [v24 _notifyChangedCharacteristics:v25 identifier:v26 multiPartResponse:*(a1 + 72) moreMessagesInMultipart:*(a1 + 72) requestMessage:*(a1 + 48) withCompletionHandler:*(a1 + 64)];
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 56);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v28 = 138543362;
      v29 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the reads and delaying notification.", &v28, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = *(a1 + 64);
    if (v11)
    {
      (*(v11 + 16))(v11, 0, 0);
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)readCharacteristicValues:(id)values identifier:(id)identifier source:(unint64_t)source qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  identifierCopy = identifier;
  handlerCopy = handler;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x259C01AE0](self, a2);
  26602 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26602];
  v20 = [v16 initWithName:26602];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_2797229C0;
  v27 = v20;
  v28 = valuesCopy;
  v31 = handlerCopy;
  sourceCopy = source;
  serviceCopy = service;
  selfCopy = self;
  v30 = identifierCopy;
  v22 = identifierCopy;
  v23 = handlerCopy;
  v24 = valuesCopy;
  v25 = v20;
  dispatch_async(workQueue, block);
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  location[3] = *MEMORY[0x277D85DE8];
  if ([*(a1 + 40) count])
  {
    objc_initWeak(location, *(a1 + 48));
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1609;
    aBlock[3] = &unk_279722998;
    objc_copyWeak(&v18, location);
    v17 = *(a1 + 64);
    v14 = *(a1 + 32);
    v19 = *(a1 + 72);
    v15 = *(a1 + 56);
    v16 = *(a1 + 40);
    v2 = _Block_copy(aBlock);
    if ([*(a1 + 48) _shouldWaitForAccessoriesToBeReachable])
    {
      v3 = *(a1 + 40);
      v4 = [*(a1 + 48) workQueue];
      v5 = [HMDHomeAssistantOperation homeAssistantOperationWithReadRequests:v3 queue:v4];

      [*(a1 + 48) _performOperation:v5 completion:v2];
    }

    else
    {
      v2[2](v2);
    }

    objc_destroyWeak(&v18);
    objc_destroyWeak(location);
    v10 = 0;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = *(a1 + 48);
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v9;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Empty characteristics array was given", location, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    v11 = *(a1 + 64);
    if (v11)
    {
      (*(v11 + 16))(v11, v10, 0);
    }
  }

  v12 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome_readCharacteristicValues_identifier_source_qualityOfService_withCompletionHandler___block_invoke_1609(uint64_t a1)
{
  v28[2] = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    v27[0] = @"sourceType";
    v3 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 72)];
    v27[1] = @"kMultiPartResponseKey";
    v28[0] = v3;
    v28[1] = MEMORY[0x277CBEC38];
    v4 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v28 forKeys:v27 count:2];

    v5 = objc_alloc(MEMORY[0x277D0F848]);
    v6 = *(a1 + 80);
    v7 = [MEMORY[0x277D0F820] allMessageDestinations];
    v8 = [v5 initWithName:@"kMultipleCharacteristicReadRequestKey" qualityOfService:v6 destination:v7 payload:v4];

    [v8 setIdentifier:*(a1 + 40)];
    v9 = objc_autoreleasePoolPush();
    v10 = WeakRetained;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v8 identifier];
      v14 = HMDRequestSourceAsString(*(a1 + 72));
      v21 = 138543874;
      v22 = v12;
      v23 = 2114;
      v24 = v13;
      v25 = 2114;
      v26 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Issuing read requests with identifier %{public}@, Source: %{public}@", &v21, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    [v10 _readCharacteristicValues:*(a1 + 48) requestMessage:v8 source:*(a1 + 72) withCompletionHandler:*(a1 + 56)];
    [*(a1 + 32) end];
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform read request", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_performOperation:(id)operation completion:(id)completion
{
  operationCopy = operation;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  assistantOperations = [(HMDHome *)self assistantOperations];

  if (!assistantOperations)
  {
    array = [MEMORY[0x277CBEB18] array];
    [(HMDHome *)self setAssistantOperations:array];
  }

  assistantOperations2 = [(HMDHome *)self assistantOperations];
  [assistantOperations2 addObject:operationCopy];

  objc_initWeak(&location, self);
  objc_initWeak(&from, operationCopy);
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__performOperation_completion___block_invoke;
  v13[3] = &unk_279722970;
  v12 = completionCopy;
  v14 = v12;
  objc_copyWeak(&v15, &from);
  objc_copyWeak(&v16, &location);
  [operationCopy startWithCompletion:v13];
  objc_destroyWeak(&v16);
  objc_destroyWeak(&v15);

  objc_destroyWeak(&from);
  objc_destroyWeak(&location);
}

void __40__HMDHome__performOperation_completion___block_invoke(uint64_t a1)
{
  (*(*(a1 + 32) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = WeakRetained;
    v3 = objc_loadWeakRetained((a1 + 48));
    v4 = [v3 assistantOperations];
    [v4 removeObject:v5];

    WeakRetained = v5;
  }
}

- (BOOL)_shouldWaitForAccessoriesToBeReachable
{
  if (isWatch() && !isWatch())
  {
    v5 = 0;
  }

  else
  {
    if (!isWatch())
    {
      LOBYTE(v4) = 0;
      return v4;
    }

    v2 = +[HMDWatchSystemState sharedState];
    if ([v2 isCompanionReachable])
    {
      LOBYTE(v4) = 0;
LABEL_10:

      return v4;
    }

    v5 = 1;
  }

  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  v4 = [primaryResidentDevice isReachable] ^ 1;

  if (v5)
  {
    goto LABEL_10;
  }

  return v4;
}

- (id)writeRequestTuplesFromMessage:(id)message outUnhandledRequests:(id *)requests
{
  v77 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v6 = [messageCopy dictionaryForKey:*MEMORY[0x277CCE7A8]];
  array = [MEMORY[0x277CBEB18] array];
  requestsCopy = requests;
  if (requests)
  {
    v7 = objc_alloc_init(MEMORY[0x277CBEB38]);
  }

  else
  {
    v7 = 0;
  }

  v8 = [messageCopy uuidForKey:*MEMORY[0x277CD2050]];
  if (v8)
  {
    v9 = 1;
  }

  else
  {
    v9 = [messageCopy BOOLForKey:*MEMORY[0x277CD2678]];
  }

  v56 = v9;

  v72 = 0u;
  v73 = 0u;
  v70 = 0u;
  v71 = 0u;
  obj = v6;
  v40 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
  if (v40)
  {
    v39 = *v71;
    v50 = *MEMORY[0x277CD2120];
    v52 = v7;
    v55 = messageCopy;
    do
    {
      v10 = 0;
      do
      {
        if (*v71 != v39)
        {
          objc_enumerationMutation(obj);
        }

        v42 = v10;
        v11 = *(*(&v70 + 1) + 8 * v10);
        v12 = [obj hmf_dictionaryForKey:v11];
        v53 = v11;
        v13 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v14 = [(HMDHome *)self accessoryWithUUID:v13];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v44 = v15;

        v68 = 0u;
        v69 = 0u;
        v66 = 0u;
        v67 = 0u;
        v16 = v12;
        v46 = [v16 countByEnumeratingWithState:&v66 objects:v75 count:16];
        if (v46)
        {
          v45 = *v67;
          v43 = v16;
          do
          {
            for (i = 0; i != v46; ++i)
            {
              if (*v67 != v45)
              {
                objc_enumerationMutation(v16);
              }

              v18 = *(*(&v66 + 1) + 8 * i);
              v19 = [v16 hmf_dictionaryForKey:v18];
              v54 = v18;
              v20 = HAPInstanceIDFromValue();
              if (v20)
              {
                v49 = i;
                v47 = v20;
                v59 = [v44 findService:v20];
                v62 = 0u;
                v63 = 0u;
                v64 = 0u;
                v65 = 0u;
                v48 = v19;
                v21 = v19;
                v61 = [v21 countByEnumeratingWithState:&v62 objects:v74 count:16];
                if (v61)
                {
                  v22 = *v63;
                  v58 = *v63;
                  do
                  {
                    for (j = 0; j != v61; ++j)
                    {
                      if (*v63 != v22)
                      {
                        objc_enumerationMutation(v21);
                      }

                      v24 = *(*(&v62 + 1) + 8 * j);
                      v25 = HAPInstanceIDFromValue();
                      if (v25)
                      {
                        v26 = [v59 findCharacteristic:v25];
                        if (v26)
                        {
                          if ([messageCopy isRemote])
                          {
                            v27 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, @"kAuthorizationDataKey"];
                            authorizationData = [v21 hmf_dataForKey:v27];
                          }

                          else
                          {
                            authorizationData = [v26 authorizationData];
                          }

                          v60 = [v21 hmf_BOOLForKey:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];
                          if ([messageCopy isRemote])
                          {
                            currentUser = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", v24, v50];
                            v29 = [v21 hmf_dataForKey:currentUser];
                          }

                          else
                          {
                            currentUser = [(HMDHome *)self currentUser];
                            notificationContextHAPIdentifier = [currentUser notificationContextHAPIdentifier];
                            v29 = [v26 contextDataForWriteRequestWithIdentifier:notificationContextHAPIdentifier];
                          }

                          [v21 objectForKeyedSubscript:v24];
                          v33 = v32 = v21;
                          messageCopy = v55;
                          identifier = [v55 identifier];
                          v35 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v26 value:v33 authorizationData:authorizationData identifier:identifier type:v56 includeResponseValue:v60 contextData:v29];

                          v21 = v32;
                          [array addObject:v35];

                          v22 = v58;
                        }

                        else
                        {
                          authorizationData = [v52 hmf_mutableDictionaryForKey:v53];
                          if (!authorizationData)
                          {
                            authorizationData = objc_alloc_init(MEMORY[0x277CBEB38]);
                            [v52 setObject:authorizationData forKeyedSubscript:v53];
                          }

                          v29 = [authorizationData hmf_mutableArrayForKey:v54];
                          if (!v29)
                          {
                            v29 = objc_alloc_init(MEMORY[0x277CBEB18]);
                            [authorizationData setObject:v29 forKeyedSubscript:v54];
                          }

                          [v29 addObject:v25];
                        }
                      }
                    }

                    v61 = [v21 countByEnumeratingWithState:&v62 objects:v74 count:16];
                  }

                  while (v61);
                }

                v7 = v52;
                v16 = v43;
                v19 = v48;
                i = v49;
                v20 = v47;
              }
            }

            v46 = [v16 countByEnumeratingWithState:&v66 objects:v75 count:16];
          }

          while (v46);
        }

        v10 = v42 + 1;
      }

      while (v42 + 1 != v40);
      v40 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
    }

    while (v40);
  }

  if (requestsCopy)
  {
    *requestsCopy = [v7 copy];
  }

  v36 = *MEMORY[0x277D85DE8];

  return array;
}

- (void)_areWriteRequestsAllowed:(id)allowed message:(id)message completion:(id)completion
{
  allowedCopy = allowed;
  messageCopy = message;
  completionCopy = completion;
  source = [messageCopy source];
  if ([(HMDHome *)self applyDeviceLockStatus:messageCopy])
  {
    [(HMDHome *)self _applyDeviceLockCheck:allowedCopy forSource:source message:messageCopy completion:completionCopy];
  }

  else
  {
    v11 = _Block_copy(completionCopy);

    if (v11)
    {
      v11[2](v11, 1, 0);
      completionCopy = v11;
    }

    else
    {
      completionCopy = 0;
    }
  }
}

- (void)_applyDeviceLockCheck:(uint64_t)check forSource:(void *)source message:(void *)message completion:
{
  v77 = *MEMORY[0x277D85DE8];
  v51 = a2;
  sourceCopy = source;
  messageCopy = message;
  if (self)
  {
    synchronouslyFetchIsCarPlayConnectedStatus = [self synchronouslyFetchIsCarPlayConnectedStatus];
    selfCopy = self;
    dataSource = [self dataSource];
    deviceLockStateDataSource = [dataSource deviceLockStateDataSource];
    isPasscodeEnabled = [deviceLockStateDataSource isPasscodeEnabled];

    v66 = 0u;
    v67 = 0u;
    v64 = 0u;
    v65 = 0u;
    obj = v51;
    v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
    if (v57)
    {
      v56 = *v65;
      v52 = isPasscodeEnabled & synchronouslyFetchIsCarPlayConnectedStatus;
LABEL_4:
      v12 = 0;
      while (1)
      {
        if (*v65 != v56)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v64 + 1) + 8 * v12);
        characteristic = [(__CFString *)v13 characteristic];
        service = [(__CFString *)characteristic service];
        dataSource2 = [selfCopy dataSource];
        hapMetadata = [dataSource2 hapMetadata];
        type = [(__CFString *)characteristic type];
        type2 = [service type];
        v20 = [hapMetadata requiresDeviceUnlock:type forService:type2];

        if (v20)
        {
          dataSource3 = [selfCopy dataSource];
          hapMetadata2 = [dataSource3 hapMetadata];
          type3 = [(__CFString *)characteristic type];
          value = [(__CFString *)v13 value];
          v25 = [hapMetadata2 allowsSecuringWriteFor:type3 withValue:value];

          if (((check == 1) & v25) == 0)
          {
            v26 = v52 ? [selfCopy isCarPlayAccessAllowedForCharacteristic:characteristic withMessage:sourceCopy fromSource:check] : 0;
            if ((([selfCopy isAccessAllowedForCharacteristicsWithMessage:sourceCopy] | v26) & 1) == 0)
            {
              break;
            }
          }
        }

        if (v57 == ++v12)
        {
          v57 = [(__CFString *)obj countByEnumeratingWithState:&v64 objects:v76 count:16];
          if (v57)
          {
            goto LABEL_4;
          }

          goto LABEL_23;
        }
      }

      v27 = HMDSecureAccessErrorCodeForMessage(sourceCopy, check);
      v28 = objc_autoreleasePoolPush();
      v29 = selfCopy;
      v30 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
      {
        v31 = HMFGetLogIdentifier();
        v32 = HMDRequestSourceAsString(check);
        *buf = 138544130;
        v69 = v31;
        v70 = 2112;
        v71 = v13;
        v72 = 2112;
        v73 = characteristic;
        v74 = 2112;
        v75 = v32;
        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Write request (%@) for characteristic: %@ from source: %@ is attempting to perform a securing write", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v28);
      if (check != 1)
      {
        goto LABEL_28;
      }

      if (!v27)
      {
        goto LABEL_24;
      }

      v33 = objc_autoreleasePoolPush();
      v34 = v29;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543362;
        v69 = v36;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Checking siri unlock access for siri triggered write request", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v33);
      objc_initWeak(buf, v34);
      siriSecureAccessoryAccessController = [v34 siriSecureAccessoryAccessController];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke;
      v59[3] = &unk_279732A70;
      objc_copyWeak(&v63, buf);
      v62 = messageCopy;
      v60 = obj;
      v38 = v27;
      v61 = v38;
      [siriSecureAccessoryAccessController isUnsecuringSiriActionAllowedWithCompletion:v59];

      objc_destroyWeak(&v63);
      objc_destroyWeak(buf);
    }

    else
    {
LABEL_23:

      if (check == 1)
      {
LABEL_24:
        v39 = objc_autoreleasePoolPush();
        v40 = selfCopy;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543874;
          v69 = v42;
          v70 = 2112;
          v71 = obj;
          v72 = 2112;
          v73 = @"Siri";
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Access is allowed for write requests (%@) from source: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v39);
        (*(messageCopy + 2))(messageCopy, 1, 0);
      }

      else
      {
        v27 = 0;
LABEL_28:
        v43 = objc_autoreleasePoolPush();
        v44 = selfCopy;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
        {
          v46 = HMFGetLogIdentifier();
          if (v27)
          {
            v47 = @"denied";
          }

          else
          {
            v47 = @"allowed";
          }

          v48 = HMDRequestSourceAsString(check);
          *buf = 138544130;
          v69 = v46;
          v70 = 2112;
          v71 = v47;
          v72 = 2112;
          v73 = obj;
          v74 = 2112;
          v75 = v48;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) from source: %@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v43);
        (*(messageCopy + 2))(messageCopy, v27 == 0, v27);
      }
    }
  }

  v49 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke(uint64_t a1, int a2)
{
  v25 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = @"denied";
      v10 = *(a1 + 32);
      *buf = 138543874;
      v20 = v8;
      if (a2)
      {
        v9 = @"allowed";
      }

      v21 = 2112;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Access is %@ for write requests (%@) by siri watch authentication", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = [v6 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1550;
    block[3] = &unk_279733DB0;
    v17 = *(a1 + 48);
    v18 = a2;
    v16 = *(a1 + 40);
    dispatch_async(v11, block);
  }

  else
  {
    v12 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    (*(v12 + 16))(v12, 0, v13);
  }

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __62__HMDHome__applyDeviceLockCheck_forSource_message_completion___block_invoke_1550(uint64_t a1)
{
  v2 = *(a1 + 40);
  if ((*(a1 + 48) & 1) == 0)
  {
    v3 = *(a1 + 32);
  }

  return (*(v2 + 16))();
}

- (void)_handleMultipleCharacteristicWrite:(id)write
{
  v30 = *MEMORY[0x277D85DE8];
  writeCopy = write;
  v23 = 0;
  v5 = [(HMDHome *)self writeRequestTuplesFromMessage:writeCopy outUnhandledRequests:&v23];
  v6 = v23;
  if ([v6 count])
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      shortDescription = [writeCopy shortDescription];
      *buf = 138543874;
      v25 = v10;
      v26 = 2112;
      v27 = shortDescription;
      v28 = 2112;
      v29 = v6;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ has characteristic requests that cannot be handled: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
  }

  source = [writeCopy source];
  [v5 count];
  [writeCopy isRemote];
  v13 = HMDRequestSourceAsString(source);
  objc_initWeak(buf, self);
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke;
  v18[3] = &unk_279722948;
  objc_copyWeak(v22, buf);
  v14 = writeCopy;
  v19 = v14;
  v22[1] = source;
  v15 = v5;
  v20 = v15;
  v16 = v6;
  v21 = v16;
  [(HMDHome *)self _areWriteRequestsAllowed:v15 message:v14 completion:v18];

  objc_destroyWeak(v22);
  objc_destroyWeak(buf);

  v17 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__handleMultipleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v27 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v7 = WeakRetained;
  if (a2)
  {
    v8 = *(a1 + 32);
    if (WeakRetained)
    {
      [WeakRetained startReportingSessionForMessage:*(a1 + 32)];
      v9 = objc_autoreleasePoolPush();
      v10 = v7;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v13 = [*(a1 + 32) identifier];

        if (v13)
        {
          v14 = [*(a1 + 32) identifier];
          [v14 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v21 = *buf;
        v16 = HMDRequestSourceAsString(*(a1 + 64));
        *buf = 138544130;
        *&buf[4] = v12;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        v23 = 2098;
        v24 = &v21;
        v25 = 2114;
        v26 = v16;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Handling multiple characteristics write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v9);
      v18 = *(a1 + 32);
      v17 = *(a1 + 40);
      v19 = *(a1 + 64);
      v15 = [v10 __readWriteResponseHandler:v18 unhandledRequests:*(a1 + 48)];
      [v10 _writeCharacteristicValues:v17 requestMessage:v18 source:v19 biomeSource:0 withCompletionHandler:v15];
    }

    else
    {
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v8 respondWithError:v15];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleCharacteristicWrite:(id)write
{
  v37[1] = *MEMORY[0x277D85DE8];
  writeCopy = write;
  messagePayload = [writeCopy messagePayload];
  v6 = [messagePayload hmf_UUIDForKey:*MEMORY[0x277CCF0B0]];

  v7 = [(HMDHome *)self accessoryWithUUID:v6];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  if (v9)
  {
    if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
    {
      messagePayload2 = [writeCopy messagePayload];
      v11 = [messagePayload2 objectForKeyedSubscript:*MEMORY[0x277CD25F8]];
      v27 = HAPInstanceIDFromValue();

      messagePayload3 = [writeCopy messagePayload];
      v13 = [messagePayload3 objectForKeyedSubscript:*MEMORY[0x277CD2140]];
      v14 = HAPInstanceIDFromValue();

      v26 = [v9 findService:v27];
      v15 = [v26 findCharacteristic:v14];
      if (v15)
      {
        if ([writeCopy isRemote])
        {
          [writeCopy dataForKey:@"kAuthorizationDataKey"];
        }

        else
        {
          [v15 authorizationData];
        }
        v25 = ;
        messagePayload4 = [writeCopy messagePayload];
        v19 = [messagePayload4 objectForKeyedSubscript:*MEMORY[0x277CD21B8]];
        identifier = [writeCopy identifier];
        v21 = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:v15 value:v19 authorizationData:v25 identifier:identifier type:0 includeResponseValue:0];

        objc_initWeak(&location, self);
        v37[0] = v21;
        v22 = [MEMORY[0x277CBEA60] arrayWithObjects:v37 count:1];
        v28[0] = MEMORY[0x277D85DD0];
        v28[1] = 3221225472;
        v28[2] = __38__HMDHome__handleCharacteristicWrite___block_invoke;
        v28[3] = &unk_279722920;
        objc_copyWeak(&v35, &location);
        v29 = writeCopy;
        v30 = v6;
        v31 = v9;
        v32 = v27;
        v33 = v14;
        v23 = v21;
        v34 = v23;
        [(HMDHome *)self _areWriteRequestsAllowed:v22 message:v29 completion:v28];

        objc_destroyWeak(&v35);
        objc_destroyWeak(&location);
      }

      else
      {
        v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        [writeCopy respondWithError:v17];
      }
    }

    else
    {
      [v9 _handleCharacteristicWrite:writeCopy];
    }
  }

  else
  {
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [writeCopy respondWithError:v16];
  }

  v24 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__handleCharacteristicWrite___block_invoke(uint64_t a1, char a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v7 = WeakRetained;
  if (a2)
  {
    if (WeakRetained)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = v7;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = [*(a1 + 32) shortDescription];
        v13 = [*(a1 + 40) UUIDString];
        v14 = [*(a1 + 48) uniqueIdentifier];
        v15 = *(a1 + 56);
        v16 = *(a1 + 64);
        *buf = 138544642;
        *&buf[4] = v11;
        *&buf[12] = 2112;
        *&buf[14] = v12;
        *&buf[22] = 2112;
        *&buf[24] = v13;
        *&buf[32] = 2112;
        *&buf[34] = v14;
        v34 = 2112;
        v35 = v15;
        v36 = 2112;
        v37 = v16;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Processing single characteristic write request: %@ (%@/%@/%@/%@) as a special case of multiple characteristic write requests", buf, 0x3Eu);
      }

      objc_autoreleasePoolPop(v8);
      v17 = [*(a1 + 32) source];
      v18 = objc_autoreleasePoolPush();
      v19 = v9;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 0;
        *&buf[8] = 0;
        v22 = [*(a1 + 32) identifier];

        if (v22)
        {
          v23 = [*(a1 + 32) identifier];
          [v23 getUUIDBytes:buf];
        }

        else
        {
          *buf = *MEMORY[0x277D0F960];
        }

        v32 = *buf;
        v26 = HMDRequestSourceAsString(v17);
        *buf = 138544130;
        *&buf[4] = v21;
        *&buf[12] = 1042;
        *&buf[14] = 16;
        *&buf[18] = 2098;
        *&buf[20] = &v32;
        *&buf[28] = 2114;
        *&buf[30] = v26;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Handling single characteristic write request with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
      }

      objc_autoreleasePoolPop(v18);
      v31 = *(a1 + 72);
      v27 = [MEMORY[0x277CBEA60] arrayWithObjects:&v31 count:1];
      v28 = *(a1 + 32);
      v29 = [v19 __readWriteResponseHandler:v28 unhandledRequests:0];
      [v19 _writeCharacteristicValues:v27 requestMessage:v28 source:v17 biomeSource:0 withCompletionHandler:v29];
    }

    else
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      [v24 respondWithError:v25];
    }
  }

  else
  {
    [*(a1 + 32) respondWithError:v5];
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (id)__readWriteResponseHandler:(id)handler unhandledRequests:(id)requests
{
  handlerCopy = handler;
  requestsCopy = requests;
  objc_initWeak(&location, self);
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke;
  v12[3] = &unk_279735248;
  objc_copyWeak(&v15, &location);
  v13 = requestsCopy;
  v14 = handlerCopy;
  v8 = handlerCopy;
  v9 = requestsCopy;
  v10 = _Block_copy(v12);

  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);

  return v10;
}

void __56__HMDHome___readWriteResponseHandler_unhandledRequests___block_invoke(id *a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if ([a1[4] count])
  {
    v8 = [HMDCharacteristicResponseNotificationContext updateMultipleCharacteristicReadWriteResponsePayload:v6 withUnhandledRequests:a1[4]];

    v6 = v8;
  }

  v9 = objc_autoreleasePoolPush();
  v10 = WeakRetained;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v13 = [a1[5] shortDescription];
    v15 = 138544130;
    v16 = v12;
    v17 = 2112;
    v18 = v13;
    v19 = 2112;
    v20 = v6;
    v21 = 2112;
    v22 = v5;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Responding to the client: %@ with payload : %@, error: %@", &v15, 0x2Au);
  }

  objc_autoreleasePoolPop(v9);
  [a1[5] respondWithPayload:v6 error:v5];
  [a1[5] setResponseHandler:0];
  [v10 endReportingSessionForMessage:a1[5]];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_addResponseTuplesFromDictionary:(id)dictionary accessoryRequestMapTable:(id)table responseTuples:(id)tuples completedGroup:(id)group logEvents:(id)events
{
  v61 = *MEMORY[0x277D85DE8];
  dictionaryCopy = dictionary;
  tableCopy = table;
  selfCopy = self;
  v40 = tableCopy;
  tuplesCopy = tuples;
  group = group;
  eventsCopy = events;
  v41 = dictionaryCopy;
  [dictionaryCopy hmf_dictionaryForKey:@"kModifiedCharacteristicsForAccessoryKey"];
  v56 = 0u;
  v57 = 0u;
  v58 = 0u;
  obj = v59 = 0u;
  v43 = [obj countByEnumeratingWithState:&v56 objects:v60 count:16];
  if (v43)
  {
    v42 = *v57;
    v36 = v47;
    do
    {
      for (i = 0; i != v43; ++i)
      {
        if (*v57 != v42)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v56 + 1) + 8 * i);
        v17 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:{v16, v36}];
        v18 = [(HMDHome *)selfCopy accessoryWithUUID:v17];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (v20)
        {
          bridge = [v20 bridge];
          v45 = v17;
          v22 = bridge;
          if (bridge)
          {
            v23 = bridge;
          }

          else
          {
            v23 = v20;
          }

          v24 = v23;

          uuid = [v24 uuid];
          uUIDString = [uuid UUIDString];

          v27 = [v40 objectForKey:v24];
          v28 = [obj hmf_dictionaryForKey:v16];
          dispatch_group_enter(group);
          workQueue = [(HMDHome *)selfCopy workQueue];
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v47[0] = __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke;
          v47[1] = &unk_2797228F8;
          v48 = v27;
          v30 = selfCopy;
          v31 = v20;
          v49 = v31;
          v50 = eventsCopy;
          v51 = uUIDString;
          v52 = v41;
          v53 = v30;
          v54 = tuplesCopy;
          groupCopy = group;
          v32 = uUIDString;
          v33 = v27;
          v34 = v31;
          selfCopy = v30;
          [v34 handleMultipleCharacteristicsUpdated:v28 message:0 completionQueue:workQueue completionHandler:v46];

          v17 = v45;
        }
      }

      v43 = [obj countByEnumeratingWithState:&v56 objects:v60 count:16];
    }

    while (v43);
  }

  dispatch_group_leave(group);

  v35 = *MEMORY[0x277D85DE8];
}

void __109__HMDHome__addResponseTuplesFromDictionary_accessoryRequestMapTable_responseTuples_completedGroup_logEvents___block_invoke(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v4 = *(a1 + 32);
  v5 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    v30 = v3;
    v31 = *v35;
    v29 = a1;
    do
    {
      v8 = 0;
      v33 = v6;
      do
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v34 + 1) + 8 * v8);
        v10 = [v9 characteristic];
        v11 = [v10 accessory];
        v12 = *(a1 + 40);

        if (v11 == v12)
        {
          v13 = [v9 characteristic];
          v14 = [v3 objectForKey:v13];

          v15 = [*(a1 + 48) objectForKeyedSubscript:*(a1 + 56)];
          v16 = v15;
          if (v15 && ([v15 isSubmitted] & 1) == 0)
          {
            v17 = [*(a1 + 64) objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
            [v16 setTransportType:{objc_msgSend(v17, "intValue")}];

            v18 = [*(a1 + 72) logEventSubmitter];
            v19 = [v14 error];
            [v18 submitLogEvent:v16 error:v19];

            v6 = v33;
            v7 = v31;
          }

          if (v14 && *(a1 + 80))
          {
            v20 = [v14 error];
            v21 = [HMDCharacteristicResponse responseWithRequest:v9 error:v20];

            v32 = [v9 characteristic];
            v22 = [v32 value];
            v23 = [v14 valueUpdatedTime];
            v24 = [v14 valueUpdatedStateNumber];
            v25 = [v9 characteristic];
            [v25 notificationContext];
            v27 = v26 = v4;
            [v21 setValue:v22 updatedTime:v23 stateNumber:v24 notificationContext:v27];

            v4 = v26;
            v7 = v31;

            v3 = v30;
            a1 = v29;

            v6 = v33;
            [*(v29 + 80) addObject:v21];
          }
        }

        ++v8;
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v6);
  }

  dispatch_group_leave(*(a1 + 88));
  v28 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(id)values requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource withCompletionHandler:(id)handler
{
  v61 = *MEMORY[0x277D85DE8];
  valuesCopy = values;
  messageCopy = message;
  handlerCopy = handler;
  v14 = objc_alloc(MEMORY[0x277D0F770]);
  v15 = MEMORY[0x277CCACA8];
  v16 = MEMORY[0x259C01AE0](self, a2);
  26007 = [v15 stringWithFormat:@"%@, %s:%ld", v16, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 26007];
  v56 = [v14 initWithName:26007];

  if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    isCurrentDeviceAvailableResident = [(HMDHome *)self isCurrentDeviceAvailableResident];
    v19 = objc_autoreleasePoolPush();
    selfCopy = self;
    if (isCurrentDeviceAvailableResident)
    {
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        shortDescription = [messageCopy shortDescription];
        *buf = 138543618;
        v58 = v22;
        v59 = 2112;
        v60 = shortDescription;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Running new accessory communication logic for resident. %@", buf, 0x16u);
      }
    }

    else
    {
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        shortDescription2 = [messageCopy shortDescription];
        *buf = 138543618;
        v58 = v30;
        v59 = 2112;
        v60 = shortDescription2;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Routing accessory write requests using Resident First logic. %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v19);
    v32 = [(HMDHome *)selfCopy _createMessageForReadWriteRequest:messageCopy source:source withCompletionHandler:handlerCopy];
    accessoryReaderWriter = [(HMDHome *)selfCopy accessoryReaderWriter];
    [accessoryReaderWriter submitWriteRequests:valuesCopy sourceType:source biomeSource:biomeSource requestMessage:v32];
  }

  else
  {
    array = [MEMORY[0x277CBEB18] array];
    identifier = [messageCopy identifier];
    v26 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
    v47 = [messageCopy userForHome:self];
    v46 = dispatch_group_create();
    weakToStrongObjectsMapTable = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
    v44 = v26;
    v45 = identifier;
    v28 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(valuesCopy, "count")}];
    [(HMDHome *)self _buildCharacteristicWriteRequest:valuesCopy accessoryWriteRequestMapTable:weakToStrongObjectsMapTable accessoryList:v28 responseTuples:array user:v47];
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    if (isWatch() && [(HMDHome *)self _passWriteRequestToCompanion:weakToStrongObjectsMapTable requestMessage:messageCopy source:source biomeSource:biomeSource remoteAccessories:dictionary responseTuples:array withCompletionHandler:handlerCopy]|| [(HMDHome *)self _loadBalanceWriteRequestOnResidentForAccessory:v28 accessoryWriteRequestMapTable:weakToStrongObjectsMapTable requestMessage:messageCopy source:source biomeSource:biomeSource responseTuples:array withCompletionHandler:handlerCopy])
    {
    }

    else
    {
      v43 = dictionary;
      biomeSourceCopy = biomeSource;
      array2 = [MEMORY[0x277CBEB18] array];
      v36 = dispatch_group_create();
      [(HMDHome *)self _sendWriteRequestToAccessoryServer:weakToStrongObjectsMapTable requestMessage:messageCopy source:source failedAccessories:array2 responseTuples:array activity:v56 waitGroup:v46 unreachableWaitGroup:v36];
      v37 = dispatch_group_create();
      dispatch_group_enter(v37);
      v42 = v36;
      [(HMDHome *)self _waitForEarlyDispatchTimeout:weakToStrongObjectsMapTable requestMessage:messageCopy source:source biomeSource:biomeSourceCopy failedAccessories:array2 responseTuples:array activity:v56 unreachableWaitGroup:v36 failureWaitGroup:v37];
      [(HMDHome *)self _waitForWriteRequestFanOut:weakToStrongObjectsMapTable requestMessage:messageCopy source:source biomeSource:biomeSourceCopy responseTuples:array failedAccessories:array2 activity:v56 waitGroup:v46 failureWaitGroup:v37];
      workQueue = [(HMDHome *)self workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __94__HMDHome__writeCharacteristicValues_requestMessage_source_biomeSource_withCompletionHandler___block_invoke;
      block[3] = &unk_279725DE8;
      v55 = v44;
      block[4] = self;
      v51 = array;
      v52 = v45;
      v53 = messageCopy;
      v54 = handlerCopy;
      v39 = v45;
      v40 = array;
      dispatch_group_notify(v37, workQueue, block);
    }
  }

  __HMFActivityScopeLeave();

  v41 = *MEMORY[0x277D85DE8];
}

uint64_t __94__HMDHome__writeCharacteristicValues_requestMessage_source_biomeSource_withCompletionHandler___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = v5;
    v7 = "single";
    if (*(a1 + 72))
    {
      v7 = "multi";
    }

    v10 = 138543618;
    v11 = v5;
    v12 = 2080;
    v13 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Final notification for multi-write (%s part)", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  result = [*(a1 + 32) _notifyChangedCharacteristics:*(a1 + 40) identifier:*(a1 + 48) multiPartResponse:*(a1 + 72) moreMessagesInMultipart:0 requestMessage:*(a1 + 56) withCompletionHandler:*(a1 + 64)];
  v9 = *MEMORY[0x277D85DE8];
  return result;
}

- (id)_createMessageForReadWriteRequest:(id)request source:(unint64_t)source withCompletionHandler:(id)handler
{
  requestCopy = request;
  handlerCopy = handler;
  internal = [requestCopy internal];
  v10 = [internal copy];

  v11 = [objc_alloc(objc_opt_class()) initWithInternalMessage:v10];
  objc_initWeak(&location, v11);
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke;
  v15[3] = &unk_2797328E8;
  objc_copyWeak(&v19, &location);
  v12 = handlerCopy;
  v18 = v12;
  v13 = requestCopy;
  v16 = v13;
  selfCopy = self;
  [v11 setResponseHandler:v15];

  objc_destroyWeak(&v19);
  objc_destroyWeak(&location);

  return v11;
}

void __74__HMDHome__createMessageForReadWriteRequest_source_withCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v21 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = _Block_copy(*(a1 + 48));
  v9 = v8;
  if (v8)
  {
    (*(v8 + 2))(v8, v5, v6);
  }

  v10 = [*(a1 + 32) responseHandler];

  if (!v10)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = *(a1 + 40);
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [*(a1 + 32) shortDescription];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = v15;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@The response handler became nil for read/write request message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    [WeakRetained setResponseHandler:0];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_waitForWriteRequestFanOut:(id)out requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)tuples failedAccessories:(id)accessories activity:(id)activity waitGroup:(id)self0 failureWaitGroup:(id)self1
{
  outCopy = out;
  messageCopy = message;
  tuplesCopy = tuples;
  accessoriesCopy = accessories;
  activityCopy = activity;
  waitGroupCopy = waitGroup;
  groupCopy = group;
  v22 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __141__HMDHome__waitForWriteRequestFanOut_requestMessage_source_biomeSource_responseTuples_failedAccessories_activity_waitGroup_failureWaitGroup___block_invoke;
  block[3] = &unk_2797228A8;
  v33 = activityCopy;
  v34 = accessoriesCopy;
  v42 = v22;
  v35 = tuplesCopy;
  selfCopy = self;
  v37 = waitGroupCopy;
  v38 = outCopy;
  v39 = messageCopy;
  sourceCopy = source;
  biomeSourceCopy = biomeSource;
  v24 = messageCopy;
  v25 = outCopy;
  v26 = waitGroupCopy;
  v27 = tuplesCopy;
  v28 = accessoriesCopy;
  v29 = activityCopy;
  dispatch_group_notify(groupCopy, workQueue, block);
}

uint64_t __141__HMDHome__waitForWriteRequestFanOut_requestMessage_source_biomeSource_responseTuples_failedAccessories_activity_waitGroup_failureWaitGroup___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  if ([*(a1 + 40) count])
  {
    [*(a1 + 40) count];
    if (*(a1 + 104))
    {
      v2 = [MEMORY[0x277CBEB18] array];
    }

    else
    {
      v2 = *(a1 + 48);
    }

    v3 = v2;
    [*(a1 + 32) begin];
    v10 = *(a1 + 32);
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 56);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543362;
      v12 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for write failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 56) _redispatchWriteForAccessories:*(a1 + 40) dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 88) biomeSource:*(a1 + 96) responseTuples:v3];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeAllObjects];
  }

  dispatch_group_leave(*(a1 + 64));
  result = [*(a1 + 32) end];
  v9 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_waitForEarlyDispatchTimeout:(id)timeout requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource failedAccessories:(id)accessories responseTuples:(id)tuples activity:(id)activity unreachableWaitGroup:(id)self0 failureWaitGroup:(id)self1
{
  timeoutCopy = timeout;
  messageCopy = message;
  accessoriesCopy = accessories;
  tuplesCopy = tuples;
  activityCopy = activity;
  groupCopy = group;
  waitGroupCopy = waitGroup;
  v22 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  v23 = dispatch_get_global_queue(0, 0);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke;
  block[3] = &unk_2797228D0;
  v34 = groupCopy;
  selfCopy = self;
  v36 = activityCopy;
  v37 = accessoriesCopy;
  v44 = v22;
  v38 = tuplesCopy;
  v39 = waitGroupCopy;
  v40 = timeoutCopy;
  v41 = messageCopy;
  sourceCopy = source;
  biomeSourceCopy = biomeSource;
  v24 = messageCopy;
  v25 = timeoutCopy;
  v26 = waitGroupCopy;
  v27 = tuplesCopy;
  v28 = accessoriesCopy;
  v29 = activityCopy;
  v30 = groupCopy;
  dispatch_async(v23, block);
}

void __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = dispatch_time(0, 250000000);
  dispatch_group_wait(v2, v3);
  v4 = [*(a1 + 40) workQueue];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke_2;
  v9[3] = &unk_2797228A8;
  v5 = *(a1 + 48);
  v6 = *(a1 + 56);
  v16 = *(a1 + 112);
  *&v7 = *(a1 + 64);
  *(&v7 + 1) = *(a1 + 40);
  *&v8 = v5;
  *(&v8 + 1) = v6;
  v10 = v8;
  v11 = v7;
  v12 = *(a1 + 72);
  v13 = *(a1 + 80);
  v14 = *(a1 + 88);
  v15 = *(a1 + 96);
  dispatch_async(v4, v9);
}

void __154__HMDHome__waitForEarlyDispatchTimeout_requestMessage_source_biomeSource_failedAccessories_responseTuples_activity_unreachableWaitGroup_failureWaitGroup___block_invoke_2(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 40) copy];
  if ([v2 count])
  {
    [v2 count];
    if (*(a1 + 104))
    {
      v3 = [MEMORY[0x277CBEB18] array];
    }

    else
    {
      v3 = *(a1 + 48);
    }

    v4 = v3;
    [*(a1 + 32) begin];
    v10 = *(a1 + 32);
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 56);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v12 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Beginning bulk redispatch for unreachable write failed accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 56) _redispatchWriteForAccessories:v2 dispatchGroup:*(a1 + 64) requestMap:*(a1 + 72) requestMessage:*(a1 + 80) source:*(a1 + 88) biomeSource:*(a1 + 96) responseTuples:v4];
    __HMFActivityScopeLeave();

    [*(a1 + 40) removeObjectsInArray:v2];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_sendWriteRequestToAccessoryServer:(id)server requestMessage:(id)message source:(unint64_t)source failedAccessories:(id)accessories responseTuples:(id)tuples activity:(id)activity waitGroup:(id)group unreachableWaitGroup:(id)self0
{
  v69 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  messageCopy = message;
  accessoriesCopy = accessories;
  tuplesCopy = tuples;
  activityCopy = activity;
  groupCopy = group;
  waitGroupCopy = waitGroup;
  v18 = [messageCopy BOOLForKey:@"kDoNotForwardMessageKey"];
  v36 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  v39 = messageCopy;
  identifier = [messageCopy identifier];
  v58 = 0u;
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  obj = serverCopy;
  v43 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
  if (v43)
  {
    v35 = v18 ^ 1;
    v34 = *v59;
    v33 = waitGroupCopy;
    do
    {
      for (i = 0; i != v43; ++i)
      {
        if (*v59 != v34)
        {
          objc_enumerationMutation(obj);
        }

        v20 = *(*(&v58 + 1) + 8 * i);
        dispatch_group_enter(groupCopy);
        dispatch_group_enter(waitGroupCopy);
        v21 = [obj objectForKey:v20];
        shortDescription = [v20 shortDescription];
        [activityCopy markWithFormat:@"Starting write for accessory: %@", shortDescription];

        uuid = [v20 uuid];
        v24 = objc_autoreleasePoolPush();
        selfCopy = self;
        v26 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
        {
          v27 = HMFGetLogIdentifier();
          v28 = [v21 count];
          *buf = 138543874;
          v63 = v27;
          v64 = 2112;
          v65 = uuid;
          v66 = 2048;
          v67 = v28;
          _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_DEFAULT, "%{public}@Starting write for accessory %@ with %ld requests", buf, 0x20u);

          waitGroupCopy = v33;
        }

        objc_autoreleasePoolPop(v24);
        [v21 count];
        workQueue = [(HMDHome *)selfCopy workQueue];
        v46[0] = MEMORY[0x277D85DD0];
        v46[1] = 3221225472;
        v46[2] = __141__HMDHome__sendWriteRequestToAccessoryServer_requestMessage_source_failedAccessories_responseTuples_activity_waitGroup_unreachableWaitGroup___block_invoke;
        v46[3] = &unk_279722880;
        v46[4] = selfCopy;
        v47 = uuid;
        v48 = v20;
        v49 = activityCopy;
        v56 = v35;
        v50 = accessoriesCopy;
        v57 = v36;
        v51 = identifier;
        v30 = v39;
        v52 = v30;
        v53 = tuplesCopy;
        v54 = groupCopy;
        v55 = waitGroupCopy;
        v31 = uuid;
        [v20 writeCharacteristicValues:v21 source:source message:v30 queue:workQueue completionHandler:v46];
      }

      v43 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
    }

    while (v43);
  }

  v32 = *MEMORY[0x277D85DE8];
}

void __141__HMDHome__sendWriteRequestToAccessoryServer_requestMessage_source_failedAccessories_responseTuples_activity_waitGroup_unreachableWaitGroup___block_invoke(uint64_t a1, void *a2)
{
  v41 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v9 = [*(a1 + 48) uniqueIdentifier];
    *buf = 138544130;
    v34 = v7;
    v35 = 2112;
    v36 = v8;
    v37 = 2112;
    v38 = v9;
    v39 = 2048;
    v40 = [v3 count];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Completed write for accessory %@/%@ with %ld responses", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v10 = v3;
  v11 = [v10 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (!v11)
  {
LABEL_15:

    goto LABEL_20;
  }

  v12 = v11;
  v13 = *v29;
  v14 = *MEMORY[0x277CCFD28];
LABEL_5:
  v15 = 0;
  while (1)
  {
    if (*v29 != v13)
    {
      objc_enumerationMutation(v10);
    }

    v16 = [*(*(&v28 + 1) + 8 * v15) error];
    [v16 domain];

    [v16 code];
    if (!v16)
    {
      goto LABEL_13;
    }

    v17 = [v16 domain];
    if (([v17 isEqualToString:v14] & 1) == 0)
    {

      goto LABEL_13;
    }

    v18 = [v16 code];

    if (v18 == 4)
    {
      break;
    }

LABEL_13:

    if (v12 == ++v15)
    {
      v12 = [v10 countByEnumeratingWithState:&v28 objects:v32 count:16];
      if (v12)
      {
        goto LABEL_5;
      }

      goto LABEL_15;
    }
  }

  v19 = objc_autoreleasePoolPush();
  v20 = *(a1 + 32);
  v21 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    v24 = *(a1 + 40);
    v25 = *(a1 + 112);
    v26 = HMFBooleanToString();
    *buf = 138543874;
    v34 = v23;
    v35 = 2112;
    v36 = v24;
    v37 = 2112;
    v38 = v26;
    _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Write for accessory with UUID: %@ failed with unreachable error, can forward to resident: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v19);
  if (*(a1 + 112))
  {
    [*(a1 + 64) addObject:*(a1 + 48)];
    goto LABEL_23;
  }

LABEL_20:
  if (*(a1 + 113) == 1)
  {
    [*(a1 + 32) _notifyChangedCharacteristics:v10 identifier:*(a1 + 72) multiPartResponse:1 moreMessagesInMultipart:1 requestMessage:*(a1 + 80) withCompletionHandler:0];
  }

  else
  {
    [*(a1 + 88) addObjectsFromArray:v10];
  }

LABEL_23:
  dispatch_group_leave(*(a1 + 96));
  dispatch_group_leave(*(a1 + 104));

  v27 = *MEMORY[0x277D85DE8];
}

- (BOOL)_passWriteRequestToCompanion:(id)companion requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource remoteAccessories:(id)accessories responseTuples:(id)tuples withCompletionHandler:(id)handler
{
  v43 = *MEMORY[0x277D85DE8];
  companionCopy = companion;
  messageCopy = message;
  accessoriesCopy = accessories;
  tuplesCopy = tuples;
  handlerCopy = handler;
  v24 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  identifier = [messageCopy identifier];
  if (isWatch() && [(HMDHome *)self remoteAccessIsEnabled])
  {
    v40 = 0u;
    v41 = 0u;
    v38 = 0u;
    v39 = 0u;
    v16 = companionCopy;
    v17 = [v16 countByEnumeratingWithState:&v38 objects:v42 count:16];
    if (v17)
    {
      v18 = *v39;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v39 != v18)
          {
            objc_enumerationMutation(v16);
          }

          v20 = [v16 objectForKey:*(*(&v38 + 1) + 8 * i)];
          [HMDHome appendCharacteristicsToAccessoryList:accessoriesCopy responseTuples:tuplesCopy forMultipleCharacteristicsRemoteWrite:v20 message:messageCopy];
        }

        v17 = [v16 countByEnumeratingWithState:&v38 objects:v42 count:16];
      }

      while (v17);
    }

    objc_initWeak(&location, self);
    v30[0] = MEMORY[0x277D85DD0];
    v30[1] = 3221225472;
    v30[2] = __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke;
    v30[3] = &unk_279723378;
    objc_copyWeak(&v35, &location);
    v36 = v24;
    v31 = tuplesCopy;
    v32 = identifier;
    v33 = messageCopy;
    v34 = handlerCopy;
    [(HMDHome *)self _writeCharacteristicValuesForAccessories:accessoriesCopy writeRequestMap:v16 responseTuples:v31 requestMessage:v33 viaDevice:0 source:source biomeSource:biomeSource completionHandler:v30];

    objc_destroyWeak(&v35);
    objc_destroyWeak(&location);
    v21 = 1;
  }

  else
  {
    v21 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];
  return v21;
}

void __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v3 = WeakRetained;
  if (WeakRetained)
  {
    v4 = [WeakRetained workQueue];
    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke_2;
    v11[3] = &unk_279725DE8;
    v11[4] = v3;
    v14 = *(a1 + 72);
    v5 = *(a1 + 32);
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    v8 = *(a1 + 56);
    *&v9 = v7;
    *(&v9 + 1) = v8;
    *&v10 = v5;
    *(&v10 + 1) = v6;
    v12 = v10;
    v13 = v9;
    dispatch_async(v4, v11);
  }
}

uint64_t __129__HMDHome__passWriteRequestToCompanion_requestMessage_source_biomeSource_remoteAccessories_responseTuples_withCompletionHandler___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  if (*(a1 + 72))
  {
    v3 = 0;
  }

  else
  {
    v3 = *(a1 + 40);
  }

  v4 = *(a1 + 56);
  v5 = *(a1 + 64);
  return [v2 _notifyChangedCharacteristics:v3 identifier:*(a1 + 48) multiPartResponse:? moreMessagesInMultipart:? requestMessage:? withCompletionHandler:?];
}

- (BOOL)_loadBalanceWriteRequestOnResidentForAccessory:(id)accessory accessoryWriteRequestMapTable:(id)table requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)tuples withCompletionHandler:(id)handler
{
  accessoryCopy = accessory;
  tableCopy = table;
  messageCopy = message;
  tuplesCopy = tuples;
  handlerCopy = handler;
  v18 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  identifier = [messageCopy identifier];
  [MEMORY[0x277D17DC0] currentTime];
  v21 = v20;
  primaryResident = [(HMDHome *)self primaryResident];
  isCurrentDevice = [primaryResident isCurrentDevice];

  if (isCurrentDevice)
  {
    group = dispatch_group_create();
    [(HMDHome *)self _loadBalancedRedispatchForAccessories:accessoryCopy source:source biomeSource:biomeSource dispatchGroup:group writeRequestMap:tableCopy requestMessage:messageCopy responseTuples:tuplesCopy];
    [(HMDHome *)self workQueue];
    v24 = identifier;
    v25 = tableCopy;
    v27 = v26 = handlerCopy;
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __159__HMDHome__loadBalanceWriteRequestOnResidentForAccessory_accessoryWriteRequestMapTable_requestMessage_source_biomeSource_responseTuples_withCompletionHandler___block_invoke;
    block[3] = &unk_279722858;
    block[4] = self;
    v40 = v18;
    v33 = tuplesCopy;
    v34 = messageCopy;
    v38 = v21;
    v35 = v25;
    v36 = v24;
    sourceCopy = source;
    v37 = v26;
    dispatch_group_notify(group, v27, block);

    handlerCopy = v26;
    tableCopy = v25;
    identifier = v24;
  }

  return isCurrentDevice;
}

uint64_t __159__HMDHome__loadBalanceWriteRequestOnResidentForAccessory_accessoryWriteRequestMapTable_requestMessage_source_biomeSource_responseTuples_withCompletionHandler___block_invoke(uint64_t a1)
{
  v65 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = v5;
    v7 = "single";
    if (*(a1 + 96))
    {
      v7 = "multi";
    }

    *buf = 138543618;
    v62 = v5;
    v63 = 2080;
    v64 = v7;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Final notification for multi-write - loadBalanceGroup primary resident (%s part)", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  if ([*(a1 + 40) count])
  {
    v8 = [*(a1 + 48) dictionaryForKey:*MEMORY[0x277CCE7A8]];
    v9 = *(a1 + 32);
    v10 = *(a1 + 80);
    v12 = *(a1 + 56);
    v11 = *(a1 + 64);
    [*(a1 + 48) userForHome:v9];
    v14 = v13 = a1;
    v15 = [v14 uuid];
    v16 = *(v13 + 88);
    v17 = [*(v13 + 48) clientIdentifier];
    v49 = v8;
    v48 = [v9 _getLogEventsForOperation:1 startTime:v8 accessories:v12 requestMap:v11 identifier:v15 userUUID:v16 source:v10 bundleID:v17];

    v18 = [MEMORY[0x277CBEB38] dictionary];
    v55 = 0u;
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    v50 = v13;
    v19 = *(v13 + 40);
    v20 = [v19 countByEnumeratingWithState:&v55 objects:v60 count:16];
    if (v20)
    {
      v21 = v20;
      v22 = *v56;
      do
      {
        for (i = 0; i != v21; ++i)
        {
          if (*v56 != v22)
          {
            objc_enumerationMutation(v19);
          }

          v24 = *(*(&v55 + 1) + 8 * i);
          v25 = [v24 request];
          v26 = [v25 characteristic];
          v27 = [v26 accessory];

          if (v27)
          {
            v28 = [v24 error];

            if (v28)
            {
              v29 = [v27 bridge];
              v30 = v29;
              if (v29)
              {
                v31 = v29;
              }

              else
              {
                v31 = v27;
              }

              v32 = v31;

              v33 = [v24 error];
              v34 = [v32 uuid];
              v35 = [v34 UUIDString];
              [v18 setObject:v33 forKeyedSubscript:v35];

              v27 = v32;
            }
          }
        }

        v21 = [v19 countByEnumeratingWithState:&v55 objects:v60 count:16];
      }

      while (v21);
    }

    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    v36 = v48;
    v37 = [v36 countByEnumeratingWithState:&v51 objects:v59 count:16];
    a1 = v50;
    if (v37)
    {
      v38 = v37;
      v39 = *v52;
      do
      {
        for (j = 0; j != v38; ++j)
        {
          if (*v52 != v39)
          {
            objc_enumerationMutation(v36);
          }

          v41 = *(*(&v51 + 1) + 8 * j);
          v42 = [*(a1 + 32) logEventSubmitter];
          v43 = [v36 objectForKeyedSubscript:v41];
          v44 = [v18 objectForKeyedSubscript:v41];
          if (v44)
          {
            v45 = [v18 objectForKeyedSubscript:v41];
            [v42 submitLogEvent:v43 error:v45];
          }

          else
          {
            [v42 submitLogEvent:v43 error:0];
          }

          a1 = v50;
        }

        v38 = [v36 countByEnumeratingWithState:&v51 objects:v59 count:16];
      }

      while (v38);
    }
  }

  result = [*(a1 + 32) _notifyChangedCharacteristics:*(a1 + 40) identifier:*(a1 + 64) multiPartResponse:*(a1 + 96) moreMessagesInMultipart:0 requestMessage:*(a1 + 48) withCompletionHandler:*(a1 + 72)];
  v47 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_buildCharacteristicWriteRequest:(id)request accessoryWriteRequestMapTable:(id)table accessoryList:(id)list responseTuples:(id)tuples user:(id)user
{
  v63 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  tableCopy = table;
  listCopy = list;
  tuplesCopy = tuples;
  userCopy = user;
  v54 = 0u;
  v55 = 0u;
  v56 = 0u;
  v57 = 0u;
  obj = requestCopy;
  v12 = [obj countByEnumeratingWithState:&v54 objects:v62 count:16];
  if (v12)
  {
    v14 = v12;
    v53 = *v55;
    *&v13 = 138543618;
    v46 = v13;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v55 != v53)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v54 + 1) + 8 * i);
        characteristic = [v16 characteristic];
        service = [characteristic service];
        accessory = [service accessory];

        if (!accessory)
        {
          accessory = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v34 = objc_autoreleasePoolPush();
          selfCopy = self;
          v36 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            v37 = HMFGetLogIdentifier();
            *buf = v46;
            v59 = v37;
            v60 = 2112;
            v61 = v16;
            _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Aborting characteristic write request: %@, accessory is nil", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v34);
          array = [HMDCharacteristicResponse responseWithRequest:v16 error:accessory];
          v32 = tuplesCopy;
          v33 = array;
          goto LABEL_21;
        }

        characteristic2 = [v16 characteristic];
        type = [characteristic2 type];
        service2 = [v16 service];
        type2 = [service2 type];
        v24 = [HMDHAPMetadata isOwnerPrivilegeRequiredForWritingCharacteristicType:type serviceType:type2];

        if (v24 && ([userCopy isOwner] & 1) == 0)
        {
          v38 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
          {
            v41 = HMFGetLogIdentifier();
            *buf = v46;
            v59 = v41;
            v60 = 2112;
            v61 = v16;
            v42 = v40;
            v43 = "%{public}@Aborting characteristic write request that requires owner privilege: %@";
LABEL_26:
            _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, v43, buf, 0x16u);
          }
        }

        else
        {
          characteristic3 = [v16 characteristic];
          type3 = [characteristic3 type];
          service3 = [v16 service];
          type4 = [service3 type];
          v29 = [HMDHAPMetadata isAdminPrivilegeRequiredForWritingCharacteristicType:type3 serviceType:type4];

          if (!v29 || ([userCopy isAdministrator] & 1) != 0)
          {
            if (([accessory isPrimary] & 1) == 0)
            {
              bridge = [accessory bridge];

              accessory = bridge;
            }

            if (([listCopy containsObject:accessory] & 1) == 0)
            {
              [listCopy addObject:accessory];
            }

            array = [tableCopy objectForKey:accessory];
            if (!array)
            {
              array = [MEMORY[0x277CBEB18] array];
              [tableCopy setObject:array forKey:accessory];
            }

            v32 = array;
            v33 = v16;
LABEL_21:
            [v32 addObject:v33];
            goto LABEL_28;
          }

          v38 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v40 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
          {
            v41 = HMFGetLogIdentifier();
            *buf = v46;
            v59 = v41;
            v60 = 2112;
            v61 = v16;
            v42 = v40;
            v43 = "%{public}@Aborting characteristic write request that requires admin privilege: %@";
            goto LABEL_26;
          }
        }

        objc_autoreleasePoolPop(v38);
        array = [MEMORY[0x277CCA9B8] hmErrorWithCode:10];
        v44 = [HMDCharacteristicResponse responseWithRequest:v16 error:array];
        [tuplesCopy addObject:v44];

LABEL_28:
      }

      v14 = [obj countByEnumeratingWithState:&v54 objects:v62 count:16];
    }

    while (v14);
  }

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_redispatchWriteForAccessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)tuples
{
  v110 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  groupCopy = group;
  mapCopy = map;
  messageCopy = message;
  tuplesCopy = tuples;
  primaryResident = [(HMDHome *)self primaryResident];
  currentActivity = [MEMORY[0x277D0F770] currentActivity];
  if (primaryResident)
  {
    v78 = currentActivity;
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __116__HMDHome__redispatchWriteForAccessories_dispatchGroup_requestMap_requestMessage_source_biomeSource_responseTuples___block_invoke;
    aBlock[3] = &unk_279722830;
    v75 = mapCopy;
    v96 = v75;
    v74 = tuplesCopy;
    v97 = v74;
    sourceCopy = source;
    v86 = messageCopy;
    v98 = v86;
    selfCopy = self;
    selfCopy2 = self;
    v84 = _Block_copy(aBlock);
    strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
    biomeSourceCopy = biomeSource;
    sourceCopy2 = source;
    v85 = strongToStrongObjectsMapTable;
    v69 = mapCopy;
    v70 = accessoriesCopy;
    v79 = primaryResident;
    v80 = groupCopy;
    v67 = tuplesCopy;
    v68 = messageCopy;
    if ([primaryResident isCurrentDevice])
    {
      v93 = 0u;
      v94 = 0u;
      v91 = 0u;
      v92 = 0u;
      v23 = accessoriesCopy;
      obj = [v23 countByEnumeratingWithState:&v91 objects:v109 count:16];
      if (obj)
      {
        v24 = *v92;
        v25 = selfCopy2;
        v26 = (v84 + 2);
        v27 = v85;
        v71 = *v92;
        v72 = v23;
        do
        {
          for (i = 0; i != obj; i = i + 1)
          {
            if (*v92 != v24)
            {
              objc_enumerationMutation(v23);
            }

            v29 = *(*(&v91 + 1) + 8 * i);
            homeManager = [(HMDHome *)v25 homeManager];
            residentMesh = [homeManager residentMesh];
            v32 = [residentMesh bestResidentDeviceForAccessory:v29];

            if (v32)
            {
              v33 = [v27 objectForKey:v32];
              v34 = v33;
              if (v33)
              {
                array = v33;
              }

              else
              {
                array = [MEMORY[0x277CBEB18] array];
              }

              uuid2 = array;

              [uuid2 addObject:v29];
              [v27 setObject:uuid2 forKey:v32];
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              v37 = v25;
              v38 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                uuid = [v29 uuid];
                uUIDString = [uuid UUIDString];
                [v29 uniqueIdentifier];
                v73 = v36;
                v43 = v42 = v26;
                *buf = 138543874;
                v104 = v39;
                v105 = 2112;
                v106 = uUIDString;
                v107 = 2112;
                v108 = v43;
                _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Write bulk redispatching failing for %@/%@ (No Mesh Redirect)", buf, 0x20u);

                v26 = v42;
                v36 = v73;

                v27 = v85;
                v24 = v71;

                v23 = v72;
              }

              objc_autoreleasePoolPop(v36);
              v102 = v29;
              v44 = [MEMORY[0x277CBEA60] arrayWithObjects:&v102 count:1];
              v45 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
              v84[2](v84, v44, v45);

              uuid2 = [v29 uuid];
              v25 = selfCopy2;
            }
          }

          obj = [v23 countByEnumeratingWithState:&v91 objects:v109 count:16];
        }

        while (obj);
      }

      else
      {
        v25 = selfCopy2;
        v27 = strongToStrongObjectsMapTable;
      }
    }

    else
    {
      v23 = [accessoriesCopy mutableCopy];
      [strongToStrongObjectsMapTable setObject:v23 forKey:primaryResident];
      v25 = selfCopy2;
      v27 = strongToStrongObjectsMapTable;
    }

    v48 = [v86 BOOLForKey:@"kMultiPartResponseKey"];
    v87 = 0u;
    v88 = 0u;
    v89 = 0u;
    v90 = 0u;
    obja = [v27 keyEnumerator];
    v49 = [obja countByEnumeratingWithState:&v87 objects:v101 count:16];
    if (v49)
    {
      v50 = v49;
      v51 = *v88;
      if (v48)
      {
        v52 = v86;
      }

      else
      {
        v52 = 0;
      }

      do
      {
        for (j = 0; j != v50; ++j)
        {
          if (*v88 != v51)
          {
            objc_enumerationMutation(obja);
          }

          v54 = *(*(&v87 + 1) + 8 * j);
          v55 = [v27 objectForKey:v54];
          remoteSourceDevice = [v86 remoteSourceDevice];
          device = [v54 device];
          v58 = [remoteSourceDevice isEqual:device];

          if (v58)
          {
            v59 = objc_autoreleasePoolPush();
            v60 = v25;
            v61 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
            {
              v62 = HMFGetLogIdentifier();
              *buf = 138543874;
              v104 = v62;
              v105 = 2112;
              v106 = v55;
              v107 = 2112;
              v108 = v86;
              _os_log_impl(&dword_2531F8000, v61, OS_LOG_TYPE_ERROR, "%{public}@Skipping write bulk redispatching for %@ (Same source device). Message: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v59);
            v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
            v84[2](v84, v55, v63);

            v25 = selfCopy2;
          }

          else if (v54 == v79)
          {
            [(HMDHome *)v25 _reallyRedispatchWritesToDevice:0 accessories:v55 dispatchGroup:v80 requestMap:v75 requestMessage:v52 source:sourceCopy2 biomeSource:biomeSourceCopy responseTuples:v74 activity:v78];
          }

          else
          {
            device2 = [v54 device];
            [(HMDHome *)v25 _reallyRedispatchWritesToDevice:device2 accessories:v55 dispatchGroup:v80 requestMap:v75 requestMessage:v52 source:sourceCopy2 biomeSource:biomeSourceCopy responseTuples:v74 activity:v78];
          }

          v27 = v85;
        }

        v50 = [obja countByEnumeratingWithState:&v87 objects:v101 count:16];
      }

      while (v50);
    }

    mapCopy = v69;
    accessoriesCopy = v70;
    primaryResident = v79;
    groupCopy = v80;
    tuplesCopy = v67;
    messageCopy = v68;
    v47 = v78;
  }

  else
  {
    biomeSourceCopy2 = biomeSource;
    v47 = currentActivity;
    [(HMDHome *)self _reallyRedispatchWritesToDevice:0 accessories:accessoriesCopy dispatchGroup:groupCopy requestMap:mapCopy requestMessage:messageCopy source:source biomeSource:biomeSourceCopy2 responseTuples:tuplesCopy activity:currentActivity];
  }

  v65 = *MEMORY[0x277D85DE8];
}

void __116__HMDHome__redispatchWriteForAccessories_dispatchGroup_requestMap_requestMessage_source_biomeSource_responseTuples___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v48 = *MEMORY[0x277D85DE8];
  v4 = a2;
  v5 = a3;
  v42 = 0u;
  v43 = 0u;
  v44 = 0u;
  v45 = 0u;
  obj = v4;
  v33 = [v4 countByEnumeratingWithState:&v42 objects:v47 count:16];
  if (v33)
  {
    v32 = *v43;
    do
    {
      v6 = 0;
      do
      {
        if (*v43 != v32)
        {
          objc_enumerationMutation(obj);
        }

        v35 = *(*(&v42 + 1) + 8 * v6);
        v36 = v6;
        v7 = [*(a1 + 32) objectForKey:?];
        v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
        v9 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v7, "count")}];
        v38 = 0u;
        v39 = 0u;
        v40 = 0u;
        v41 = 0u;
        v10 = v7;
        v11 = [v10 countByEnumeratingWithState:&v38 objects:v46 count:16];
        if (v11)
        {
          v12 = v11;
          v13 = *v39;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v39 != v13)
              {
                objc_enumerationMutation(v10);
              }

              v15 = *(*(&v38 + 1) + 8 * i);
              v16 = *(a1 + 40);
              v17 = [HMDCharacteristicResponse responseWithRequest:v15 error:v5];
              [v16 addObject:v17];

              v18 = [v15 characteristic];
              [v8 addObject:v18];

              v19 = [v15 value];
              if (v19)
              {
                [v9 addObject:v19];
              }

              else
              {
                v20 = [MEMORY[0x277CBEB68] null];
                [v9 addObject:v20];
              }
            }

            v12 = [v10 countByEnumeratingWithState:&v38 objects:v46 count:16];
          }

          while (v12);
        }

        v21 = [HMDCharacteristicReadWriteLogEvent alloc];
        v34 = *(a1 + 64);
        v22 = [*(a1 + 48) identifier];
        v23 = [*(a1 + 48) clientIdentifier];
        v24 = [*(a1 + 48) userForHome:*(a1 + 56)];
        v25 = [v24 uuid];
        LOBYTE(v30) = 0;
        LOBYTE(v29) = 1;
        v26 = [(HMDCharacteristicReadWriteLogEvent *)v21 initWithCharacteristics:v8 hmdAccessory:v35 hapAccessory:0 source:v34 isWriteOperation:1 isTimedWrite:0 isLocal:v29 transactionId:v22 isCached:v30 bundleId:v23 userUUID:v25 writtenValues:v9];

        v27 = [*(a1 + 56) logEventSubmitter];
        [v27 submitLogEvent:v26 error:v5];

        v6 = v36 + 1;
      }

      while (v36 + 1 != v33);
      v33 = [obj countByEnumeratingWithState:&v42 objects:v47 count:16];
    }

    while (v33);
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_reallyRedispatchWritesToDevice:(id)device accessories:(id)accessories dispatchGroup:(id)group requestMap:(id)map requestMessage:(id)message source:(unint64_t)source biomeSource:(unint64_t)biomeSource responseTuples:(id)self0 activity:(id)self1
{
  v65 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  accessoriesCopy = accessories;
  groupCopy = group;
  mapCopy = map;
  messageCopy = message;
  tuplesCopy = tuples;
  v37 = groupCopy;
  activityCopy = activity;
  dispatch_group_enter(groupCopy);
  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v55 = 0u;
  obj = accessoriesCopy;
  v48 = [obj countByEnumeratingWithState:&v52 objects:v64 count:16];
  if (v48)
  {
    v23 = *v53;
    v44 = tuplesCopy;
    v45 = mapCopy;
    v42 = *v53;
    v43 = device;
    selfCopy = self;
    do
    {
      for (i = 0; i != v48; ++i)
      {
        if (*v53 != v23)
        {
          objc_enumerationMutation(obj);
        }

        v25 = *(*(&v52 + 1) + 8 * i);
        context = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          name = [v25 name];
          uuid = [v25 uuid];
          uUIDString = [uuid UUIDString];
          [v25 uniqueIdentifier];
          v33 = v32 = messageCopy;
          *buf = 138544130;
          v57 = v28;
          v58 = 2112;
          v59 = name;
          v60 = 2112;
          v61 = uUIDString;
          v62 = 2112;
          v63 = v33;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Write bulk redispatching accessory %@/%@/%@ to resident", buf, 0x2Au);

          messageCopy = v32;
          self = selfCopy;

          v23 = v42;
          tuplesCopy = v44;

          device = v43;
          mapCopy = v45;
        }

        objc_autoreleasePoolPop(context);
        [device isCurrentDevice];
        [v25 uuid];

        [device identifier];
        v34 = [mapCopy objectForKey:v25];
        [HMDHome appendCharacteristicsToAccessoryList:dictionary responseTuples:tuplesCopy forMultipleCharacteristicsRemoteWrite:v34 message:messageCopy];
      }

      v48 = [obj countByEnumeratingWithState:&v52 objects:v64 count:16];
    }

    while (v48);
  }

  v50[0] = MEMORY[0x277D85DD0];
  v50[1] = 3221225472;
  v50[2] = __138__HMDHome__reallyRedispatchWritesToDevice_accessories_dispatchGroup_requestMap_requestMessage_source_biomeSource_responseTuples_activity___block_invoke;
  v50[3] = &unk_279734E00;
  v51 = v37;
  v35 = v37;
  [(HMDHome *)self _writeCharacteristicValuesForAccessories:dictionary writeRequestMap:mapCopy responseTuples:tuplesCopy requestMessage:messageCopy viaDevice:deviceCopy source:source biomeSource:biomeSource completionHandler:v50];

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_loadBalancedRedispatchForAccessories:(id)accessories source:(unint64_t)source biomeSource:(unint64_t)biomeSource dispatchGroup:(id)group writeRequestMap:(id)map requestMessage:(id)message responseTuples:(id)tuples
{
  v95 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  group = group;
  mapCopy = map;
  messageCopy = message;
  tuplesCopy = tuples;
  currentActivity = [MEMORY[0x277D0F770] currentActivity];
  v55 = [messageCopy BOOLForKey:@"kMultiPartResponseKey"];
  v63 = [accessoriesCopy sortedArrayUsingComparator:&__block_literal_global_1556];
  homeManager = [(HMDHome *)self homeManager];
  residentMesh = [homeManager residentMesh];
  v68 = [residentMesh balancedResidentMapForAccessories:v63];

  v15 = objc_autoreleasePoolPush();
  selfCopy = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543874;
    v90 = v17;
    v91 = 2112;
    v92 = v63;
    v93 = 2112;
    v94 = v68;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Balanced Resident Map for accessories: %@ -> %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  dispatch_group_enter(group);
  primaryResident = [(HMDHome *)selfCopy primaryResident];
  v65 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v63, "count")}];
  primaryResident2 = [(HMDHome *)selfCopy primaryResident];
  isCurrentDevice = [primaryResident2 isCurrentDevice];

  if (isCurrentDevice)
  {
    v20 = objc_autoreleasePoolPush();
    v21 = selfCopy;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEBUG))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v90 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEBUG, "%{public}@Checking for local reachability on primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    v85 = 0u;
    v86 = 0u;
    v83 = 0u;
    v84 = 0u;
    obj = v63;
    v24 = [obj countByEnumeratingWithState:&v83 objects:v88 count:16];
    if (v24)
    {
      v25 = *v84;
      do
      {
        v26 = 0;
        do
        {
          if (*v84 != v25)
          {
            objc_enumerationMutation(obj);
          }

          v27 = *(*(&v83 + 1) + 8 * v26);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v28 = v27;
          }

          else
          {
            v28 = 0;
          }

          v29 = v28;

          if (v29)
          {
            if ([v29 custom1WoBLE])
            {
              v30 = objc_autoreleasePoolPush();
              v31 = v21;
              v32 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
              {
                v33 = HMFGetLogIdentifier();
                *buf = 138543618;
                v90 = v33;
                v91 = 2112;
                v92 = v29;
                _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Adding accessory %@ supporting custom1WoBLE to balanced resident map", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v30);
              [(HMDHome *)v31 _addAccessoryToBalancedResidentMap:v29 residentDevice:primaryResident balancedResidentMap:v68];
            }

            v34 = [(HMDHome *)v21 __residentDeviceForAccessory:v27 fromMap:v68];
            v35 = v34 == 0;

            if (v35)
            {
              if ([v29 hasBTLELink])
              {
                v82 = 0;
                identifier = [v29 identifier];
                [(HMDHome *)v21 retrieveStateForTrackedAccessory:identifier stateNumber:0 isReachable:&v82 linkQuality:0 lastSeen:0];

                if (v82 != 1)
                {
                  goto LABEL_31;
                }

                v37 = objc_autoreleasePoolPush();
                v38 = v21;
                v39 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
                {
                  v40 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v90 = v40;
                  v91 = 2112;
                  v92 = v29;
                  v93 = 2112;
                  v94 = primaryResident;
                  _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Adding map for locally reachable accessory: %@ to resident: %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v37);
                [(HMDHome *)v38 _addAccessoryToBalancedResidentMap:v29 residentDevice:primaryResident balancedResidentMap:v68];
              }

              else
              {
                if (![v29 canWakeUpViaWoL])
                {
LABEL_31:
                  [v65 addObject:v29];
                  goto LABEL_20;
                }

                v41 = objc_autoreleasePoolPush();
                v42 = v21;
                v43 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
                {
                  v44 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v90 = v44;
                  v91 = 2112;
                  v92 = v29;
                  _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Adding accessory %@ supporting WakeUpViaWoL to balanced resident map", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v41);
                [(HMDHome *)v42 _addAccessoryToBalancedResidentMap:v29 residentDevice:primaryResident balancedResidentMap:v68];
              }
            }
          }

LABEL_20:

          ++v26;
        }

        while (v24 != v26);
        v45 = [obj countByEnumeratingWithState:&v83 objects:v88 count:16];
        v24 = v45;
      }

      while (v45);
    }
  }

  workQueue = [(HMDHome *)selfCopy workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1557;
  block[3] = &unk_279722808;
  v70 = currentActivity;
  v71 = v65;
  v72 = mapCopy;
  v73 = tuplesCopy;
  v74 = v68;
  v75 = primaryResident;
  v76 = messageCopy;
  v77 = selfCopy;
  groupCopy = group;
  sourceCopy = source;
  v81 = v55;
  biomeSourceCopy = biomeSource;
  groupCopy2 = group;
  v48 = messageCopy;
  v49 = primaryResident;
  v50 = v68;
  v51 = tuplesCopy;
  v52 = mapCopy;
  v53 = v65;
  dispatch_async(workQueue, block);

  __HMFActivityScopeLeave();
  v54 = *MEMORY[0x277D85DE8];
}

uint64_t __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1557(uint64_t a1)
{
  v98 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) begin];
  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  v2 = *(a1 + 40);
  v3 = [v2 countByEnumeratingWithState:&v84 objects:v97 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v85;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v85 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v84 + 1) + 8 * i);
        v8 = [*(a1 + 48) objectForKey:v7];
        [*(a1 + 48) removeObjectForKey:v7];
        v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        v10 = [HMDCharacteristicResponse responsesWithRequests:v8 error:v9];

        [*(a1 + 56) addObjectsFromArray:v10];
      }

      v4 = [v2 countByEnumeratingWithState:&v84 objects:v97 count:16];
    }

    while (v4);
  }

  v82 = 0u;
  v83 = 0u;
  v80 = 0u;
  v81 = 0u;
  obj = [*(a1 + 64) keyEnumerator];
  v58 = [obj countByEnumeratingWithState:&v80 objects:v96 count:16];
  if (v58)
  {
    v57 = *v81;
    v11 = HMDIDSActivityMonitorHomeManagerDataSource;
    do
    {
      v12 = 0;
      do
      {
        if (*v81 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v59 = v12;
        v13 = *(*(&v80 + 1) + 8 * v12);
        v14 = [MEMORY[0x277CBEB38] dictionary];
        v15 = [*(a1 + 64) objectForKey:*(a1 + 72)];
        v76 = 0u;
        v77 = 0u;
        v78 = 0u;
        v79 = 0u;
        v63 = v15;
        v16 = [v63 countByEnumeratingWithState:&v76 objects:v95 count:16];
        if (v16)
        {
          v17 = v16;
          v18 = *v77;
          do
          {
            for (j = 0; j != v17; ++j)
            {
              if (*v77 != v18)
              {
                objc_enumerationMutation(v63);
              }

              v20 = *(*(&v76 + 1) + 8 * j);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v21 = v20;
              }

              else
              {
                v21 = 0;
              }

              v22 = v21;

              v23 = [*(a1 + 48) objectForKey:v22];
              [&v11[48] appendCharacteristicsToAccessoryList:v14 responseTuples:*(a1 + 56) forMultipleCharacteristicsRemoteWrite:v23 message:*(a1 + 80)];
            }

            v17 = [v63 countByEnumeratingWithState:&v76 objects:v95 count:16];
          }

          while (v17);
        }

        v60 = v14;

        v24 = [v13 isCurrentDevice];
        v25 = objc_autoreleasePoolPush();
        v26 = *(a1 + 88);
        v27 = HMFGetOSLogHandle();
        v28 = os_log_type_enabled(v27, OS_LOG_TYPE_INFO);
        if (v24)
        {
          if (v28)
          {
            v29 = HMFGetLogIdentifier();
            *buf = 138543874;
            v90 = v29;
            v91 = 2112;
            v92 = v60;
            v93 = 2112;
            v94 = v13;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Writing to accessories: %@ on current Device: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v25);
          [v60 count];
          v72 = 0u;
          v73 = 0u;
          v74 = 0u;
          v75 = 0u;
          v30 = v63;
          v31 = [v30 countByEnumeratingWithState:&v72 objects:v88 count:16];
          if (v31)
          {
            v32 = v31;
            v61 = v30;
            v33 = *v73;
            do
            {
              for (k = 0; k != v32; ++k)
              {
                if (*v73 != v33)
                {
                  objc_enumerationMutation(v61);
                }

                v35 = *(*(&v72 + 1) + 8 * k);
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v36 = v35;
                }

                else
                {
                  v36 = 0;
                }

                v37 = v36;

                v38 = [*(a1 + 48) objectForKey:v37];
                if (v38)
                {
                  dispatch_group_enter(*(a1 + 96));
                  v39 = *(a1 + 104);
                  v40 = *(a1 + 80);
                  v41 = [*(a1 + 88) workQueue];
                  v66[0] = MEMORY[0x277D85DD0];
                  v66[1] = 3221225472;
                  v66[2] = __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1562;
                  v66[3] = &unk_2797227E0;
                  v66[4] = *(a1 + 88);
                  v66[5] = v35;
                  v42 = v37;
                  v67 = v42;
                  v71 = *(a1 + 120);
                  v68 = *(a1 + 80);
                  v69 = *(a1 + 56);
                  v70 = *(a1 + 96);
                  [v42 writeCharacteristicValues:v38 source:v39 message:v40 queue:v41 completionHandler:v66];
                }
              }

              v32 = [v61 countByEnumeratingWithState:&v72 objects:v88 count:16];
            }

            while (v32);
            v11 = HMDIDSActivityMonitorHomeManagerDataSource;
            v30 = v61;
          }

LABEL_48:

          v45 = v60;
          goto LABEL_49;
        }

        if (v28)
        {
          v43 = HMFGetLogIdentifier();
          *buf = 138543874;
          v90 = v43;
          v91 = 2112;
          v92 = v60;
          v93 = 2112;
          v94 = v13;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Dispatching accessories: %@ to resident: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v25);
        v44 = *(a1 + 32);
        v45 = v60;
        [v60 count];
        v46 = [v13 identifier];

        if (*(a1 + 48))
        {
          dispatch_group_enter(*(a1 + 96));
          if (*(a1 + 120) == 1)
          {
            v62 = *(a1 + 80);
          }

          else
          {
            v62 = 0;
          }

          v47 = *(a1 + 88);
          v48 = *(a1 + 48);
          v49 = *(a1 + 56);
          v50 = [v47 primaryResident];
          v51 = [v50 device];
          if ([v13 isEqual:v51])
          {
            v13 = 0;
          }

          v53 = *(a1 + 104);
          v52 = *(a1 + 112);
          v64[0] = MEMORY[0x277D85DD0];
          v64[1] = 3221225472;
          v64[2] = __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1567;
          v64[3] = &unk_279734E00;
          v65 = *(a1 + 96);
          [v47 _writeCharacteristicValuesForAccessories:v60 writeRequestMap:v48 responseTuples:v49 requestMessage:v62 viaDevice:v13 source:v53 biomeSource:v52 completionHandler:v64];

          v30 = v65;
          v11 = HMDIDSActivityMonitorHomeManagerDataSource;
          goto LABEL_48;
        }

LABEL_49:

        v12 = v59 + 1;
      }

      while (v59 + 1 != v58);
      v58 = [obj countByEnumeratingWithState:&v80 objects:v96 count:16];
    }

    while (v58);
  }

  dispatch_group_leave(*(a1 + 96));
  result = [*(a1 + 32) end];
  v55 = *MEMORY[0x277D85DE8];
  return result;
}

void __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke_1562(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    v11 = [*(a1 + 48) uniqueIdentifier];
    v15 = 138544386;
    v16 = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v21 = 2112;
    v22 = v11;
    v23 = 2048;
    v24 = [v3 count];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Load Balance completed write for accessory %@/%@/%@ with %ld responses", &v15, 0x34u);
  }

  objc_autoreleasePoolPop(v4);
  if (*(a1 + 80) == 1)
  {
    v12 = *(a1 + 32);
    v13 = [*(a1 + 56) identifier];
    [v12 _notifyChangedCharacteristics:v3 identifier:v13 multiPartResponse:1 moreMessagesInMultipart:1 requestMessage:*(a1 + 56) withCompletionHandler:0];
  }

  else
  {
    [*(a1 + 64) addObjectsFromArray:v3];
  }

  dispatch_group_leave(*(a1 + 72));

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __128__HMDHome__loadBalancedRedispatchForAccessories_source_biomeSource_dispatchGroup_writeRequestMap_requestMessage_responseTuples___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v4 = a3;
  v5 = [a2 uuid];
  v6 = [v5 UUIDString];
  v7 = [v4 uuid];

  v8 = [v7 UUIDString];
  v9 = [v6 compare:v8];

  return v9;
}

- (void)_addAccessoryToBalancedResidentMap:(id)map residentDevice:(id)device balancedResidentMap:(id)residentMap
{
  v15[1] = *MEMORY[0x277D85DE8];
  mapCopy = map;
  deviceCopy = device;
  residentMapCopy = residentMap;
  v10 = [residentMapCopy objectForKey:deviceCopy];
  v11 = v10;
  if (v10)
  {
    if (([v10 containsObject:mapCopy] & 1) == 0)
    {
      [v11 addObject:mapCopy];
    }
  }

  else
  {
    v15[0] = mapCopy;
    v12 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
    v13 = [v12 mutableCopy];
    [residentMapCopy setObject:v13 forKey:deviceCopy];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)__residentDeviceForAccessory:(id)accessory fromMap:(id)map
{
  v20 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  mapCopy = map;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  keyEnumerator = [mapCopy keyEnumerator];
  v8 = [keyEnumerator countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v8)
  {
    v9 = *v16;
    while (2)
    {
      for (i = 0; i != v8; i = i + 1)
      {
        if (*v16 != v9)
        {
          objc_enumerationMutation(keyEnumerator);
        }

        v11 = *(*(&v15 + 1) + 8 * i);
        v12 = [mapCopy objectForKey:v11];
        if ([v12 containsObject:accessoryCopy])
        {
          v8 = v11;

          goto LABEL_11;
        }
      }

      v8 = [keyEnumerator countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)_writeCharacteristicValuesForAccessories:(id)accessories writeRequestMap:(id)map responseTuples:(id)tuples requestMessage:(id)message viaDevice:(id)device source:(unint64_t)source biomeSource:(unint64_t)biomeSource completionHandler:(id)self0
{
  v127 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  mapCopy = map;
  tuplesCopy = tuples;
  messageCopy = message;
  deviceCopy = device;
  handlerCopy = handler;
  v18 = objc_alloc(MEMORY[0x277D0F770]);
  v19 = MEMORY[0x277CCACA8];
  v20 = MEMORY[0x259C01AE0](self, a2);
  25082 = [v19 stringWithFormat:@"%@, %s:%ld", v20, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 25082];
  v83 = [v18 initWithName:25082];

  group = dispatch_group_create();
  dispatch_group_enter(group);
  array = [MEMORY[0x277CBEB18] array];
  if ([accessoriesCopy count])
  {
    v22 = objc_autoreleasePoolPush();
    selfCopy = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEBUG))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v124 = v25;
      v125 = 2048;
      sourceCopy = source;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEBUG, "%{public}@Write operation source: %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    [MEMORY[0x277D17DC0] currentTime];
    v27 = v26;
    identifier = [messageCopy identifier];
    v29 = [messageCopy userForHome:selfCopy];
    uuid = [v29 uuid];
    clientIdentifier = [messageCopy clientIdentifier];
    v78 = [(HMDHome *)selfCopy _getLogEventsForOperation:1 startTime:accessoriesCopy accessories:mapCopy requestMap:identifier identifier:uuid userUUID:source source:v27 biomeSource:biomeSource bundleID:clientIdentifier];

    v77 = *MEMORY[0x277CD2678];
    LODWORD(identifier) = [messageCopy BOOLForKey:?];
    v32 = [messageCopy uuidForKey:*MEMORY[0x277CD2050]];

    v33 = v32 != 0;
    uuid2 = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid2 UUIDString];

    v121[0] = *MEMORY[0x277CCE7A8];
    v35 = [accessoriesCopy copy];
    v36 = *MEMORY[0x277CD0640];
    v122[0] = v35;
    v122[1] = uUIDString;
    v121[1] = v36;
    v121[2] = @"kDoNotForwardMessageKey";
    v37 = [MEMORY[0x277CCABB0] numberWithInt:deviceCopy != 0];
    v122[2] = v37;
    v38 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v122 forKeys:v121 count:3];
    v82 = [v38 mutableCopy];

    if ((v33 | identifier))
    {
LABEL_26:
      v117 = v77;
      v118 = MEMORY[0x277CBEC38];
      v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v118 forKeys:&v117 count:1];
      [v82 addEntriesFromDictionary:v39];
    }

    else
    {
      v114 = 0u;
      v115 = 0u;
      v112 = 0u;
      v113 = 0u;
      v39 = accessoriesCopy;
      v76 = [v39 countByEnumeratingWithState:&v112 objects:v120 count:16];
      if (v76)
      {
        v40 = *v113;
        v75 = *v113;
        do
        {
          for (i = 0; i != v76; ++i)
          {
            if (*v113 != v40)
            {
              objc_enumerationMutation(v39);
            }

            v42 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:*(*(&v112 + 1) + 8 * i)];
            v43 = [(HMDHome *)selfCopy accessoryWithUUID:v42];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v44 = v43;
            }

            else
            {
              v44 = 0;
            }

            v45 = v44;

            v46 = [mapCopy objectForKey:v45];
            v110 = 0u;
            v111 = 0u;
            v108 = 0u;
            v109 = 0u;
            v47 = v46;
            v48 = [v47 countByEnumeratingWithState:&v108 objects:v119 count:16];
            if (v48)
            {
              v49 = *v109;
              while (2)
              {
                for (j = 0; j != v48; ++j)
                {
                  if (*v109 != v49)
                  {
                    objc_enumerationMutation(v47);
                  }

                  if ([*(*(&v108 + 1) + 8 * j) requestType] == 1)
                  {

                    goto LABEL_26;
                  }
                }

                v48 = [v47 countByEnumeratingWithState:&v108 objects:v119 count:16];
                if (v48)
                {
                  continue;
                }

                break;
              }
            }

            v40 = v75;
          }

          v76 = [v39 countByEnumeratingWithState:&v112 objects:v120 count:16];
          v40 = v75;
        }

        while (v76);
      }
    }

    v51 = MEMORY[0x277D0F848];
    qualityOfService = [messageCopy qualityOfService];
    messageDestination = [(HMDHome *)selfCopy messageDestination];
    v54 = [v82 copy];
    v55 = [v51 messageWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:qualityOfService destination:messageDestination payload:v54];

    objc_initWeak(&location, selfCopy);
    v99[0] = MEMORY[0x277D85DD0];
    v99[1] = 3221225472;
    v99[2] = __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke;
    v99[3] = &unk_2797227B8;
    objc_copyWeak(&v106, &location);
    v100 = v83;
    v101 = accessoriesCopy;
    v56 = mapCopy;
    v102 = v56;
    v103 = array;
    v57 = v78;
    v104 = v57;
    v105 = group;
    [v55 setResponseHandler:v99];
    uuid3 = [(HMDHome *)selfCopy uuid];
    workQueue = [(HMDHome *)selfCopy workQueue];
    [(HMDHome *)selfCopy redispatchToResidentMessage:v55 target:uuid3 responseQueue:workQueue viaDevice:deviceCopy];

    if ([(HMDHome *)selfCopy remoteAccessIsEnabled])
    {
      v97 = 0u;
      v98 = 0u;
      v95 = 0u;
      v96 = 0u;
      v60 = v56;
      v61 = [v60 countByEnumeratingWithState:&v95 objects:v116 count:16];
      if (v61)
      {
        v62 = *v96;
        while (2)
        {
          for (k = 0; k != v61; ++k)
          {
            if (*v96 != v62)
            {
              objc_enumerationMutation(v60);
            }

            if ([*(*(&v95 + 1) + 8 * k) hasBTLELink])
            {
              v64 = objc_autoreleasePoolPush();
              v65 = selfCopy;
              v66 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
              {
                v67 = HMFGetLogIdentifier();
                *buf = 138543362;
                v124 = v67;
                _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@There are BTLE accessories that are currently unreachable during the write, kicking scan to update reachability", buf, 0xCu);
              }

              objc_autoreleasePoolPop(v64);
              accessoryBrowser = [(HMDHome *)v65 accessoryBrowser];
              [accessoryBrowser btleAccessoryReachabilityProbeTimer:1];

              goto LABEL_40;
            }
          }

          v61 = [v60 countByEnumeratingWithState:&v95 objects:v116 count:16];
          if (v61)
          {
            continue;
          }

          break;
        }
      }

LABEL_40:
    }

    objc_destroyWeak(&v106);
    objc_destroyWeak(&location);
  }

  else
  {
    dispatch_group_leave(group);
  }

  workQueue2 = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke_1553;
  block[3] = &unk_279734668;
  v90 = tuplesCopy;
  v91 = array;
  v92 = messageCopy;
  selfCopy2 = self;
  v94 = handlerCopy;
  v70 = handlerCopy;
  v71 = messageCopy;
  v72 = array;
  v73 = tuplesCopy;
  dispatch_group_notify(group, workQueue2, block);

  v74 = *MEMORY[0x277D85DE8];
}

void __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v55 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v36 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  if (WeakRetained)
  {
    [*(a1 + 32) begin];
    if (v5)
    {
      v7 = [MEMORY[0x277CBEB58] set];
      v45 = 0u;
      v46 = 0u;
      v47 = 0u;
      v48 = 0u;
      obj = *(a1 + 40);
      v40 = [obj countByEnumeratingWithState:&v45 objects:v54 count:16];
      if (!v40)
      {
        goto LABEL_31;
      }

      v39 = *v46;
      *&v8 = 138543618;
      v34 = v8;
      v37 = v7;
      v35 = WeakRetained;
      while (1)
      {
        v9 = 0;
        do
        {
          if (*v46 != v39)
          {
            objc_enumerationMutation(obj);
          }

          v10 = *(*(&v45 + 1) + 8 * v9);
          v11 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v10];
          v12 = [WeakRetained accessoryWithUUID:v11];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if ([v14 isPrimary])
          {
            v15 = v14;
LABEL_16:
            v16 = [*(a1 + 48) objectForKey:{v15, v34}];
            v17 = v16;
            if (v16)
            {
              v43 = 0u;
              v44 = 0u;
              v41 = 0u;
              v42 = 0u;
              v18 = [v16 countByEnumeratingWithState:&v41 objects:v49 count:16];
              if (v18)
              {
                v19 = v18;
                v20 = *v42;
                do
                {
                  v21 = 0;
                  do
                  {
                    if (*v42 != v20)
                    {
                      objc_enumerationMutation(v17);
                    }

                    v22 = [HMDCharacteristicResponse responseWithRequest:*(*(&v41 + 1) + 8 * v21) error:v5];
                    [*(a1 + 56) addObject:v22];

                    ++v21;
                  }

                  while (v19 != v21);
                  v19 = [v17 countByEnumeratingWithState:&v41 objects:v49 count:16];
                }

                while (v19);
              }

              v23 = *(a1 + 64);
              v24 = [v15 uuid];
              v25 = [v24 UUIDString];
              v26 = [v23 objectForKeyedSubscript:v25];

              v27 = [v36 objectForKeyedSubscript:@"kRemoteMessageTransportAttributionKey"];
              [v26 setTransportType:{objc_msgSend(v27, "intValue")}];

              WeakRetained = v35;
              v28 = [v35 logEventSubmitter];
              [v28 submitLogEvent:v26 error:v5];

              v7 = v37;
            }

            goto LABEL_29;
          }

          v15 = [v14 bridge];

          if (v15)
          {
            if ([v7 containsObject:v15])
            {
              goto LABEL_29;
            }

            [v7 addObject:v15];
            goto LABEL_16;
          }

          v29 = objc_autoreleasePoolPush();
          v30 = WeakRetained;
          v31 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
          {
            v32 = HMFGetLogIdentifier();
            *buf = v34;
            v51 = v32;
            v52 = 2112;
            v53 = v10;
            _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEFAULT, "%{public}@Dropping write responses for nil-ed out accessory with UUID %@", buf, 0x16u);

            v7 = v37;
          }

          objc_autoreleasePoolPop(v29);
          v15 = 0;
LABEL_29:

          ++v9;
        }

        while (v9 != v40);
        v40 = [obj countByEnumeratingWithState:&v45 objects:v54 count:16];
        if (!v40)
        {
LABEL_31:

          dispatch_group_leave(*(a1 + 72));
          goto LABEL_33;
        }
      }
    }

    [WeakRetained _addResponseTuplesFromDictionary:v36 accessoryRequestMapTable:*(a1 + 48) responseTuples:*(a1 + 56) completedGroup:*(a1 + 72) logEvents:*(a1 + 64)];
LABEL_33:
    [*(a1 + 32) end];
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __145__HMDHome__writeCharacteristicValuesForAccessories_writeRequestMap_responseTuples_requestMessage_viaDevice_source_biomeSource_completionHandler___block_invoke_1553(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) addObjectsFromArray:*(a1 + 40)];
  v2 = *(a1 + 48);
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 56);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the writes and sending notification.", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [*(a1 + 48) BOOLForKey:@"kMultiPartResponseKey"];
    v9 = *(a1 + 56);
    v10 = *(a1 + 40);
    v11 = [*(a1 + 48) identifier];
    [v9 _notifyChangedCharacteristics:v10 identifier:v11 multiPartResponse:v8 moreMessagesInMultipart:v8 requestMessage:*(a1 + 48) withCompletionHandler:*(a1 + 64)];
  }

  else
  {
    if (v6)
    {
      v12 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v12;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Completed all the writes and delaying notification.", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v13 = *(a1 + 64);
    if (v13)
    {
      (*(v13 + 16))(v13, 0, 0);
    }
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)requiresUnlockToAccessCharacteristics:(id)characteristics withMessage:(id)message
{
  characteristicsCopy = characteristics;
  if ([(HMDHome *)self applyDeviceLockStatus:message])
  {
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke;
    v9[3] = &unk_279733D48;
    v9[4] = self;
    v7 = [characteristicsCopy na_any:v9];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

uint64_t __61__HMDHome_requiresUnlockToAccessCharacteristics_withMessage___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = [v2 dataSource];
  v5 = [v4 hapMetadata];
  v6 = [v3 type];
  v7 = [v3 service];

  v8 = [v7 type];
  v9 = [v5 requiresDeviceUnlock:v6 forService:v8];

  return v9;
}

- (BOOL)isAccessAllowedForCharacteristicsWithMessage:(id)message
{
  v17 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([messageCopy isEntitledForSecureAccess] && (objc_msgSend(messageCopy, "isEntitledForSPIAccess") & 1) != 0)
  {
    v5 = 1;
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      shortDescription = [messageCopy shortDescription];
      v13 = 138543618;
      v14 = v9;
      v15 = 2112;
      v16 = shortDescription;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Insufficient entitlements, access is not allowed for characteristic with message: %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (void)writeCharacteristicValues:(id)values source:(unint64_t)source message:(id)message identifier:(id)identifier qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  messageCopy = message;
  identifierCopy = identifier;
  handlerCopy = handler;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x259C01AE0](self, a2);
  24831 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 24831];
  v23 = [v19 initWithName:24831];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_279726A38;
  block[4] = self;
  v31 = valuesCopy;
  v32 = v23;
  v33 = messageCopy;
  v34 = identifierCopy;
  v35 = handlerCopy;
  sourceCopy = source;
  serviceCopy = service;
  v25 = identifierCopy;
  v26 = messageCopy;
  v27 = v23;
  v28 = handlerCopy;
  v29 = valuesCopy;
  dispatch_async(workQueue, block);
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke(id *a1)
{
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v2 = a1[5];
    v3 = [a1[4] workQueue];
    v4 = [HMDHomeAssistantOperation homeAssistantOperationWithWriteRequests:v2 queue:v3];

    objc_initWeak(&location, a1[4]);
    v5 = a1[4];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2;
    v20[3] = &unk_279722768;
    objc_copyWeak(v24, &location);
    v23 = a1[9];
    v6 = a1[6];
    v7 = a1[5];
    v24[1] = a1[10];
    v8 = a1[7];
    v9 = a1[8];
    *&v10 = v8;
    *(&v10 + 1) = v9;
    *&v11 = v6;
    *(&v11 + 1) = v7;
    v21 = v11;
    v22 = v10;
    v24[2] = a1[11];
    [v5 _performOperation:v4 completion:v20];

    objc_destroyWeak(v24);
    objc_destroyWeak(&location);
  }

  else
  {
    [a1[6] begin];
    v12 = a1[4];
    v13 = a1[5];
    v14 = a1[10];
    v15 = a1[11];
    v16 = a1[8];
    v17 = a1[9];
    v19 = a1[6];
    v18 = a1[7];

    [(HMDHome *)v12 _writeCharacteristicValues:v13 source:v14 message:v18 identifier:v16 qualityOfService:v15 withCompletionHandler:v17 activity:v19];
  }
}

void __102__HMDHome_writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler___block_invoke_2(id *a1)
{
  v11 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  if (WeakRetained)
  {
    [a1[4] begin];
    [(HMDHome *)WeakRetained _writeCharacteristicValues:a1[10] source:a1[6] message:a1[7] identifier:a1[11] qualityOfService:a1[8] withCompletionHandler:a1[4] activity:?];
  }

  else
  {
    v3 = objc_autoreleasePoolPush();
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    v6 = _Block_copy(a1[8]);
    if (v6)
    {
      v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      v6[2](v6, v7, 0);
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_writeCharacteristicValues:(void *)values source:(void *)source message:(void *)message identifier:(void *)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:
{
  v60 = *MEMORY[0x277D85DE8];
  v42 = a2;
  sourceCopy = source;
  messageCopy = message;
  serviceCopy = service;
  handlerCopy = handler;
  val = self;
  if (self)
  {
    v44 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v42, "count")}];
    v55 = 0u;
    v56 = 0u;
    v53 = 0u;
    v54 = 0u;
    obj = v42;
    v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
    if (v13)
    {
      v14 = *v54;
      do
      {
        for (i = 0; i != v13; ++i)
        {
          if (*v54 != v14)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v53 + 1) + 8 * i);
          characteristic = [v16 characteristic];
          authorizationData = [characteristic authorizationData];
          home = [val home];
          currentUser = [home currentUser];
          notificationContextHAPIdentifier = [currentUser notificationContextHAPIdentifier];
          v22 = [characteristic contextDataForWriteRequestWithIdentifier:notificationContextHAPIdentifier];

          value = [v16 value];
          v24 = +[HMDCharacteristicWriteRequest writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:](HMDCharacteristicWriteRequest, "writeRequestWithCharacteristic:value:authorizationData:identifier:type:includeResponseValue:contextData:", characteristic, value, authorizationData, 0, [v16 requestType], objc_msgSend(v16, "includeResponseValue"), v22);

          [v44 addObject:v24];
        }

        v13 = [obj countByEnumeratingWithState:&v53 objects:v59 count:16];
      }

      while (v13);
    }

    dataSource = [val dataSource];
    deviceLockStateDataSource = [dataSource deviceLockStateDataSource];
    if ([deviceLockStateDataSource isPasscodeEnabled])
    {
      dataSource2 = [val dataSource];
      deviceLockStateDataSource2 = [dataSource2 deviceLockStateDataSource];
      isLocked = [deviceLockStateDataSource2 isLocked];

      if (!isLocked)
      {
        v30 = objc_autoreleasePoolPush();
        v31 = val;
        v32 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
        {
          v33 = HMFGetLogIdentifier();
          *buf = 138543362;
          v58 = v33;
          _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Allowing characteristic write because device lock check is not required", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v30);
        [(HMDHome *)v31 _performAllowedWriteCharacteristicValues:v44 source:values identifier:messageCopy qualityOfService:identifier withCompletionHandler:serviceCopy activity:handlerCopy];
        goto LABEL_16;
      }
    }

    else
    {
    }

    objc_initWeak(buf, val);
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke;
    v46[3] = &unk_279722790;
    objc_copyWeak(v51, buf);
    v34 = serviceCopy;
    v52 = 1;
    v50 = v34;
    v51[1] = values;
    v47 = handlerCopy;
    v48 = v44;
    v49 = messageCopy;
    v51[2] = identifier;
    [(HMDHome *)val _applyDeviceLockCheck:v48 forSource:values message:sourceCopy completion:v46];

    objc_destroyWeak(v51);
    objc_destroyWeak(buf);
LABEL_16:
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __112__HMDHome__writeCharacteristicValues_source_message_identifier_qualityOfService_withCompletionHandler_activity___block_invoke(uint64_t a1, int a2, void *a3)
{
  v32 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  if (WeakRetained)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = WeakRetained;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      if (a2)
      {
        v11 = @"Allowing";
      }

      else
      {
        v11 = @"Denying";
      }

      v12 = *(a1 + 88);
      v13 = NSStringFromBOOL();
      v14 = *(a1 + 72);
      v22 = 138544386;
      v23 = v10;
      v24 = 2112;
      v25 = v11;
      v26 = 2112;
      v27 = v13;
      v28 = 2048;
      v29 = v14;
      v30 = 2112;
      v31 = v5;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@%@ characteristic write passcode=%@, source=%lu : %@", &v22, 0x34u);
    }

    objc_autoreleasePoolPop(v7);
    if (a2)
    {
      [(HMDHome *)v8 _performAllowedWriteCharacteristicValues:*(a1 + 72) source:*(a1 + 48) identifier:*(a1 + 80) qualityOfService:*(a1 + 56) withCompletionHandler:*(a1 + 32) activity:?];
    }

    else
    {
      v20 = *(a1 + 56);
      if (v20)
      {
        (*(v20 + 16))(v20, v5, 0);
      }

      [*(a1 + 32) end];
    }
  }

  else
  {
    v15 = *(a1 + 56);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
      (*(v15 + 16))(v15, v16, 0);
    }

    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v22 = 138543362;
      v23 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot perform write request", &v22, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_performAllowedWriteCharacteristicValues:(uint64_t)values source:(void *)source identifier:(uint64_t)identifier qualityOfService:(void *)service withCompletionHandler:(void *)handler activity:
{
  v38[2] = *MEMORY[0x277D85DE8];
  v30 = a2;
  sourceCopy = source;
  serviceCopy = service;
  handlerCopy = handler;
  v37[0] = @"sourceType";
  v16 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:values];
  v37[1] = @"kMultiPartResponseKey";
  v38[0] = v16;
  v38[1] = MEMORY[0x277CBEC38];
  v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:v37 count:2];

  v18 = objc_alloc(MEMORY[0x277D0F848]);
  allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
  v20 = [v18 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:identifier destination:allMessageDestinations payload:v17];

  [v20 setIdentifier:sourceCopy];
  v21 = objc_autoreleasePoolPush();
  selfCopy = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
  {
    v29 = sourceCopy;
    v24 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    identifier = [v20 identifier];

    if (identifier)
    {
      identifier2 = [v20 identifier];
      [identifier2 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v31 = *buf;
    v27 = HMDRequestSourceAsString(values);
    *buf = 138544130;
    *&buf[4] = v24;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v33 = 2098;
    v34 = &v31;
    v35 = 2114;
    v36 = v27;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Performing allowed write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);

    sourceCopy = v29;
  }

  objc_autoreleasePoolPop(v21);
  [selfCopy _writeCharacteristicValues:v30 requestMessage:v20 source:values biomeSource:0 withCompletionHandler:serviceCopy];
  [handlerCopy end];

  v28 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)values message:(id)message withCompletionHandler:(id)handler
{
  handlerCopy = handler;
  messageCopy = message;
  valuesCopy = values;
  source = [messageCopy source];
  identifier = [messageCopy identifier];
  -[HMDHome writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:](self, "writeCharacteristicValues:source:message:identifier:qualityOfService:withCompletionHandler:", valuesCopy, source, messageCopy, identifier, [messageCopy qualityOfService], handlerCopy);
}

void __131__HMDHome__notifyChangedCharacteristics_identifier_multiPartResponse_moreMessagesInMultipart_requestMessage_withCompletionHandler___block_invoke(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, 0, *(a1 + 32));
    v2 = v3;
  }
}

void __131__HMDHome__notifyChangedCharacteristics_identifier_multiPartResponse_moreMessagesInMultipart_requestMessage_withCompletionHandler___block_invoke_1535(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  if (v2)
  {
    v3 = v2;
    (*(v2 + 2))(v2, 0, *(a1 + 32));
    v2 = v3;
  }
}

- (void)_sendClientCharacteristicsChangedNotificationWithIdentifier:(id)identifier requestMessage:(id)message multiPartResponse:(BOOL)response moreInMultiPartResponse:(BOOL)partResponse characteristicChanges:(id)changes completionHandler:(id)handler
{
  partResponseCopy = partResponse;
  responseCopy = response;
  v83 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  messageCopy = message;
  changesCopy = changes;
  handlerCopy = handler;
  v56 = changesCopy;
  characteristicUpdatesForAllClients = [changesCopy characteristicUpdatesForAllClients];
  if (responseCopy)
  {
    v14 = [MEMORY[0x277CCABB0] numberWithBool:partResponseCopy];
    v51 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForAllClients moreMessagesInMultipart:v14];
  }

  else
  {
    v51 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForAllClients moreMessagesInMultipart:0];
  }

  if ([v56 hasEntitledClientOnlyChanges])
  {
    characteristicUpdatesForEntitledClients = [v56 characteristicUpdatesForEntitledClients];
    if (responseCopy)
    {
      v16 = [MEMORY[0x277CCABB0] numberWithBool:partResponseCopy];
      v50 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForEntitledClients moreMessagesInMultipart:v16];
    }

    else
    {
      v50 = [HMDCharacteristicResponseNotificationContext responsePayloadForHome:self changedAccessories:characteristicUpdatesForEntitledClients moreMessagesInMultipart:0];
    }
  }

  else
  {
    v50 = 0;
  }

  proxyConnection = [messageCopy proxyConnection];
  orderedSet = [MEMORY[0x277CBEB40] orderedSet];
  if (proxyConnection)
  {
    [orderedSet addObject:proxyConnection];
  }

  if ([characteristicUpdatesForAllClients count] || objc_msgSend(v56, "hasEntitledClientOnlyChanges"))
  {
    dataSource = [(HMDHome *)self dataSource];
    xpcMessageTransport = [dataSource xpcMessageTransport];
    connections = [xpcMessageTransport connections];
    [orderedSet addObjectsFromArray:connections];
  }

  if ([messageCopy qualityOfService] < 17)
  {
    qualityOfService = 17;
  }

  else
  {
    qualityOfService = [messageCopy qualityOfService];
  }

  v22 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v24 = [v22 initWithTarget:uuid];

  v49 = v24;
  v25 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"kMultipleCharacteristicValuesUpdatedNotificationKey" qualityOfService:qualityOfService destination:v24 payload:0];
  v26 = v25;
  if (identifierCopy)
  {
    [v25 setIdentifier:?];
  }

  v27 = objc_autoreleasePoolPush();
  selfCopy = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
  {
    v30 = HMFGetLogIdentifier();
    v31 = [orderedSet count];
    *buf = 0;
    *&buf[8] = 0;
    identifier = [v26 identifier];

    if (identifier)
    {
      identifier2 = [v26 identifier];
      [identifier2 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v70 = *buf;
    v34 = [characteristicUpdatesForAllClients count] != 0;
    hasEntitledClientOnlyChanges = [v56 hasEntitledClientOnlyChanges];
    *buf = 138545154;
    *&buf[4] = v30;
    *&buf[12] = 2048;
    *&buf[14] = v31;
    *&buf[22] = 1040;
    v72 = 16;
    v73 = 2096;
    v74 = &v70;
    v75 = 1024;
    v76 = v34;
    v77 = 1024;
    v78 = hasEntitledClientOnlyChanges;
    v79 = 1024;
    v80 = responseCopy;
    v81 = 1024;
    v82 = partResponseCopy;
    _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Notifying %ld clients of characteristic changes with message identifier: %{uuid_t}.16P, allClients: %{BOOL}d, entitledClients: %{BOOL}d, multiPartResponse: %{BOOL}d, moreMessagesInMultipartResponse: %{BOOL}d", buf, 0x3Eu);
  }

  objc_autoreleasePoolPop(v27);
  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x2020000000;
  LOBYTE(v72) = handlerCopy != 0;
  v36 = dispatch_group_create();
  array = [orderedSet array];
  v61[0] = MEMORY[0x277D85DD0];
  v61[1] = 3221225472;
  v61[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke;
  v61[3] = &unk_279722740;
  v38 = v50;
  v62 = v38;
  v39 = v26;
  v63 = v39;
  v40 = v51;
  v64 = v40;
  v41 = proxyConnection;
  v65 = v41;
  v68 = buf;
  v69 = 34305;
  v42 = v36;
  v66 = v42;
  v43 = handlerCopy;
  v67 = v43;
  [array na_each:v61];

  reportingSessionManager = [(HMDHome *)selfCopy reportingSessionManager];
  messagePayload = [v39 messagePayload];
  identifier3 = [v39 identifier];
  [reportingSessionManager addResponseMessagePayload:messagePayload toSessionWithUUID:identifier3];

  if (*(*&buf[8] + 24) == 1)
  {
    workQueue = [(HMDHome *)selfCopy workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_3;
    block[3] = &unk_2797348C0;
    v60 = v43;
    dispatch_group_notify(v42, workQueue, block);
  }

  _Block_object_dispose(buf, 8);
  v48 = *MEMORY[0x277D85DE8];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = v3;
  v5 = (a1 + 32);
  if (*(a1 + 32) && ([v3 isEntitledForSPIAccess] & 1) != 0)
  {
    v6 = 1;
    v7 = 5;
  }

  else
  {
    v6 = 0;
    v5 = (a1 + 48);
    v7 = 1;
  }

  [*(a1 + 40) setMessagePayload:*v5];
  [*(a1 + 40) setRequiresSPIEntitlement:v6];
  if (*(a1 + 56) == v4)
  {
    *(*(*(a1 + 80) + 8) + 24) = 0;
  }

  else
  {
    [*(a1 + 40) setQualityOfService:17];
    v8 = [[HMDHomeManagerXPCMessageSendPolicy alloc] initWithEntitlements:v7 options:*(a1 + 88) active:1];
    [*(a1 + 40) setSendPolicy:v8];
  }

  dispatch_group_enter(*(a1 + 64));
  v9 = [*(a1 + 40) copy];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2;
  v11[3] = &unk_279735BE8;
  v12 = v4;
  v13 = *(a1 + 56);
  v15 = *(a1 + 72);
  v14 = *(a1 + 64);
  v10 = v4;
  [v10 sendMessage:v9 completionHandler:v11];
}

void __168__HMDHome__sendClientCharacteristicsChangedNotificationWithIdentifier_requestMessage_multiPartResponse_moreInMultiPartResponse_characteristicChanges_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v4 = a2;
  if (*(a1 + 32) == *(a1 + 40))
  {
    v3 = *(a1 + 56);
    if (v3)
    {
      (*(v3 + 16))();
    }
  }

  dispatch_group_leave(*(a1 + 48));
}

- (void)notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast
{
  characteristicsCopy = characteristics;
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __71__HMDHome_notifyRemoteUsersOfChangedCharacteristics_message_broadcast___block_invoke;
  v13[3] = &unk_279731C38;
  v13[4] = self;
  v14 = characteristicsCopy;
  v15 = messageCopy;
  broadcastCopy = broadcast;
  v11 = messageCopy;
  v12 = characteristicsCopy;
  dispatch_async(workQueue, v13);
}

- (void)notifyOfChangedCharacteristic:(id)characteristic changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message
{
  characteristicCopy = characteristic;
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke;
  v15[3] = &unk_27972EC78;
  v15[4] = self;
  v16 = characteristicCopy;
  deviceCopy = device;
  peersCopy = peers;
  v17 = messageCopy;
  v13 = messageCopy;
  v14 = characteristicCopy;
  dispatch_async(workQueue, v15);
}

void __95__HMDHome_notifyOfChangedCharacteristic_changedByThisDevice_residentShouldNotifyPeers_message___block_invoke(uint64_t a1)
{
  v6[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v6[0] = *(a1 + 40);
  v3 = [MEMORY[0x277CBEA60] arrayWithObjects:v6 count:1];
  LOBYTE(v5) = 0;
  [v2 _postInternalNotificationForChangedCharacteristics:v3 previouslyNilChangedCharacteristics:MEMORY[0x277CBEBF8] modifiedCharacteristics:0 changedByThisDevice:*(a1 + 56) residentShouldNotifyPeers:*(a1 + 57) message:*(a1 + 48) broadcast:v5];

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_postInternalNotificationForChangedCharacteristics:(id)characteristics previouslyNilChangedCharacteristics:(id)changedCharacteristics modifiedCharacteristics:(id)modifiedCharacteristics changedByThisDevice:(BOOL)device residentShouldNotifyPeers:(BOOL)peers message:(id)message broadcast:(BOOL)broadcast
{
  peersCopy = peers;
  deviceCopy = device;
  v115 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  changedCharacteristicsCopy = changedCharacteristics;
  modifiedCharacteristicsCopy = modifiedCharacteristics;
  messageCopy = message;
  v16 = objc_autoreleasePoolPush();
  selfCopy = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    [messageCopy shortDescription];
    v21 = v20 = selfCopy;
    *buf = 138544642;
    v104 = v19;
    v105 = 1024;
    v106 = deviceCopy;
    v107 = 1024;
    v108 = peersCopy;
    v109 = 1024;
    broadcastCopy = broadcast;
    v111 = 2112;
    v112 = characteristicsCopy;
    v113 = 2112;
    v114 = v21;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Posting internal notification and notifying remote users with changedByThisDevice: %{BOOL}d residentShouldNotifyPeers: %{BOOL}d broadcast: %{BOOL}d about changed characteristics: %@ message: %@ ", buf, 0x32u);

    selfCopy = v20;
  }

  objc_autoreleasePoolPop(v16);
  if ([characteristicsCopy count] || objc_msgSend(changedCharacteristicsCopy, "count"))
  {
    v22 = [messageCopy dictionaryForKey:@"kPresenceDictionaryForNotificationKey"];
    v23 = [messageCopy dictionaryForKey:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
    v99[0] = MEMORY[0x277D85DD0];
    v99[1] = 3221225472;
    v99[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke;
    v99[3] = &unk_279733D48;
    v99[4] = selfCopy;
    v24 = [characteristicsCopy na_filter:v99];
    v78 = v23;
    v79 = v22;
    if (v23)
    {
      v25 = [[HMDHomePresenceRemote alloc] initWithPresenceByPairingIdentity:v23];
    }

    else
    {
      if (!v22)
      {
LABEL_10:
        v71 = peersCopy;
        v72 = messageCopy;
        localCapabilitiesDataSource = [(HMDHome *)selfCopy localCapabilitiesDataSource];
        supportsBulletinBoard = [localCapabilitiesDataSource supportsBulletinBoard];

        if (supportsBulletinBoard)
        {
          v95[0] = MEMORY[0x277D85DD0];
          v95[1] = 3221225472;
          v95[2] = __186__HMDHome__postInternalNotificationForChangedCharacteristics_previouslyNilChangedCharacteristics_modifiedCharacteristics_changedByThisDevice_residentShouldNotifyPeers_message_broadcast___block_invoke_2;
          v95[3] = &unk_279722718;
          v95[4] = selfCopy;
          v96 = modifiedCharacteristicsCopy;
          v97 = deviceCopy;
          v98 = 0;
          [(HMDHome *)selfCopy evaluateNotificationConditionForCharacteristics:v24 homePresence:v22 completion:v95];
        }

        v70 = v24;
        v77 = selfCopy;

        weakToStrongObjectsMapTable = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
        v91 = 0u;
        v92 = 0u;
        v93 = 0u;
        v94 = 0u;
        v73 = characteristicsCopy;
        obj = characteristicsCopy;
        v28 = [obj countByEnumeratingWithState:&v91 objects:v102 count:16];
        if (v28)
        {
          v29 = v28;
          v30 = *v92;
          do
          {
            for (i = 0; i != v29; ++i)
            {
              if (*v92 != v30)
              {
                objc_enumerationMutation(obj);
              }

              v32 = *(*(&v91 + 1) + 8 * i);
              accessory = [v32 accessory];
              if (accessory)
              {
                v34 = [weakToStrongObjectsMapTable objectForKey:accessory];
                if (!v34)
                {
                  v34 = [MEMORY[0x277CBEB58] set];
                  [weakToStrongObjectsMapTable setObject:v34 forKey:accessory];
                }

                [v34 addObject:v32];
                v35 = [[HMDHAPAccessoryNotificationEvent alloc] initWithAccessory:accessory characteristic:v32];
                logEventSubmitter = [(HMDHome *)v77 logEventSubmitter];
                [logEventSubmitter submitLogEvent:v35 error:0];
              }
            }

            v29 = [obj countByEnumeratingWithState:&v91 objects:v102 count:16];
          }

          while (v29);
        }

        weakToStrongObjectsMapTable2 = [MEMORY[0x277CCAB00] weakToStrongObjectsMapTable];
        v87 = 0u;
        v88 = 0u;
        v89 = 0u;
        v90 = 0u;
        v38 = changedCharacteristicsCopy;
        v39 = [v38 countByEnumeratingWithState:&v87 objects:v101 count:16];
        if (v39)
        {
          v40 = v39;
          v41 = *v88;
          do
          {
            for (j = 0; j != v40; ++j)
            {
              if (*v88 != v41)
              {
                objc_enumerationMutation(v38);
              }

              v43 = *(*(&v87 + 1) + 8 * j);
              accessory2 = [v43 accessory];
              if (accessory2)
              {
                v45 = [weakToStrongObjectsMapTable2 objectForKey:accessory2];
                if (!v45)
                {
                  v45 = [MEMORY[0x277CBEB58] set];
                  [weakToStrongObjectsMapTable2 setObject:v45 forKey:accessory2];
                }

                [v45 addObject:v43];
              }
            }

            v40 = [v38 countByEnumeratingWithState:&v87 objects:v101 count:16];
          }

          while (v40);
        }

        v46 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(weakToStrongObjectsMapTable2, "count") + objc_msgSend(weakToStrongObjectsMapTable, "count")}];
        hm_allKeys = [weakToStrongObjectsMapTable hm_allKeys];
        [v46 addObjectsFromArray:hm_allKeys];

        hm_allKeys2 = [weakToStrongObjectsMapTable2 hm_allKeys];
        [v46 addObjectsFromArray:hm_allKeys2];

        v85 = 0u;
        v86 = 0u;
        v83 = 0u;
        v84 = 0u;
        v76 = v46;
        v49 = [v76 countByEnumeratingWithState:&v83 objects:v100 count:16];
        if (v49)
        {
          v50 = v49;
          v51 = MEMORY[0x277CBEBF8];
          v52 = *v84;
          do
          {
            for (k = 0; k != v50; ++k)
            {
              if (*v84 != v52)
              {
                objc_enumerationMutation(v76);
              }

              v54 = *(*(&v83 + 1) + 8 * k);
              dictionary = [MEMORY[0x277CBEB38] dictionary];
              v56 = [weakToStrongObjectsMapTable objectForKey:v54];
              allObjects = [v56 allObjects];
              v58 = allObjects;
              if (allObjects)
              {
                v59 = allObjects;
              }

              else
              {
                v59 = v51;
              }

              [dictionary setObject:v59 forKeyedSubscript:@"kModifiedCharacteristicsKey"];

              v60 = [weakToStrongObjectsMapTable2 objectForKey:v54];
              allObjects2 = [v60 allObjects];
              v62 = allObjects2;
              if (allObjects2)
              {
                v63 = allObjects2;
              }

              else
              {
                v63 = v51;
              }

              [dictionary setObject:v63 forKeyedSubscript:@"HMDModifiedPreviouslyNilValuedCharacteristicsKey"];

              [dictionary setObject:modifiedCharacteristicsCopy forKeyedSubscript:@"kModifiedCharacteristicsMapKey"];
              [dictionary setObject:v79 forKeyedSubscript:@"kPresenceDictionaryForNotificationKey"];
              [dictionary setObject:v78 forKeyedSubscript:@"kPresencePairingIdentifierDictionaryForNotificationKey"];
              v64 = [dictionary copy];
              logAndPostNotification(@"HMDAccessoryCharacteristicsChangedNotification", v54, v64);
            }

            v50 = [v76 countByEnumeratingWithState:&v83 objects:v100 count:16];
          }

          while (v50);
        }

        messageCopy = v72;
        characteristicsCopy = v73;
        if (v71 && [(HMDHome *)v77 shouldRelayNotificationToRegisteredDevicesForSource:v72])
        {
          v65 = objc_autoreleasePoolPush();
          v66 = v77;
          v67 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v67, OS_LOG_TYPE_INFO))
          {
            v68 = HMFGetLogIdentifier();
            *buf = 138543362;
            v104 = v68;
            _os_log_impl(&dword_2531F8000, v67, OS_LOG_TYPE_INFO, "%{public}@Posting notification to remote users since this is a resident device or is paired with a watch", buf, 0xCu);
          }

          objc_autoreleasePoolPop(v65);
          [(HMDHome *)v66 notifyRemoteUsersOfChangedCharacteristics:obj message:v72 broadcast:broadcast];
        }

        goto LABEL_53;
      }

      v25 = [[HMDHomePresenceRemote alloc] initWithPresenceByUserId:v22];
    }

    v22 = v25;
    goto LABEL_10;
  }

LABEL_53:

  v69 = *MEMORY[0x277D85DE8];
}

- (id)_disablePayloadFromRemotelyUpdatedCharacteristicNotifications:(id)notifications
{
  v59 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    v52 = 0u;
    v53 = 0u;
    v54 = 0u;
    v55 = 0u;
    obj = [notificationsCopy allKeys];
    v5 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v53;
      v8 = 0x277CBE000uLL;
      v9 = 0x277CCA000uLL;
      selfCopy = self;
      v36 = notificationsCopy;
      v34 = *v53;
      do
      {
        v10 = 0;
        v37 = v6;
        do
        {
          if (*v53 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v40 = v10;
          v11 = *(*(&v52 + 1) + 8 * v10);
          array = [*(v8 + 2840) array];
          v43 = [notificationsCopy hmf_dictionaryForKey:v11];
          v41 = [objc_alloc(*(v9 + 3448)) initWithUUIDString:v11];
          v13 = [(HMDHome *)self accessoryWithUUID:?];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          if (v15 && ([v15 hasBTLELink] & 1) == 0 && objc_msgSend(v15, "hasIPLink"))
          {
            v38 = v15;
            v50 = 0u;
            v51 = 0u;
            v48 = 0u;
            v49 = 0u;
            allKeys = [v43 allKeys];
            v16 = [allKeys countByEnumeratingWithState:&v48 objects:v57 count:16];
            if (v16)
            {
              v17 = v16;
              v18 = *v49;
              do
              {
                for (i = 0; i != v17; ++i)
                {
                  if (*v49 != v18)
                  {
                    objc_enumerationMutation(allKeys);
                  }

                  v20 = [v43 hmf_dictionaryForKey:*(*(&v48 + 1) + 8 * i)];
                  v44 = 0u;
                  v45 = 0u;
                  v46 = 0u;
                  v47 = 0u;
                  allKeys2 = [v20 allKeys];
                  v22 = [allKeys2 countByEnumeratingWithState:&v44 objects:v56 count:16];
                  if (v22)
                  {
                    v23 = v22;
                    v24 = *v45;
                    do
                    {
                      for (j = 0; j != v23; ++j)
                      {
                        if (*v45 != v24)
                        {
                          objc_enumerationMutation(allKeys2);
                        }

                        v26 = *(*(&v44 + 1) + 8 * j);
                        v27 = HAPInstanceIDFromValue();
                        if (v27)
                        {
                          [array addObject:v27];
                        }
                      }

                      v23 = [allKeys2 countByEnumeratingWithState:&v44 objects:v56 count:16];
                    }

                    while (v23);
                  }
                }

                v17 = [allKeys countByEnumeratingWithState:&v48 objects:v57 count:16];
              }

              while (v17);
            }

            self = selfCopy;
            notificationsCopy = v36;
            v7 = v34;
            v8 = 0x277CBE000;
            v9 = 0x277CCA000;
            v6 = v37;
            v15 = v38;
            if ([array count])
            {
              v28 = [array copy];
              uUIDString = [v41 UUIDString];
              [dictionary setObject:v28 forKeyedSubscript:uUIDString];

              v6 = v37;
              v15 = v38;
            }
          }

          v10 = v40 + 1;
        }

        while (v40 + 1 != v6);
        v6 = [obj countByEnumeratingWithState:&v52 objects:v58 count:16];
      }

      while (v6);
    }

    v30 = [dictionary copy];
  }

  else
  {
    v30 = MEMORY[0x277CBEC10];
  }

  v31 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_handleCharacteristicsChangedNotification:(id)notification
{
  v124 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  v80 = [notificationCopy dictionaryForKey:@"kCharacteristicNotificationsKey"];
  v81 = [notificationCopy stringForKey:@"kRequestIdentifierKey"];
  array = [MEMORY[0x277CBEB18] array];
  if (v81)
  {
    selfCopy2 = self;
    if ([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
    {
      accessoryReaderWriter = [(HMDHome *)self accessoryReaderWriter];
      [accessoryReaderWriter handleRemotelyUpdatedCharacteristicsMessage:notificationCopy];

      selfCopy2 = self;
    }

    v77 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v81];
    pendingResponses = [(HMDHome *)selfCopy2 pendingResponses];
    v87 = [pendingResponses objectForKeyedSubscript:v81];

    array2 = [MEMORY[0x277CBEB18] array];
    if (v87)
    {
      v111 = 0u;
      v112 = 0u;
      v109 = 0u;
      v110 = 0u;
      obj = [v80 allKeys];
      v76 = [obj countByEnumeratingWithState:&v109 objects:v123 count:16];
      if (v76)
      {
        v74 = *v110;
        do
        {
          v7 = 0;
          do
          {
            if (*v110 != v74)
            {
              v8 = v7;
              objc_enumerationMutation(obj);
              v7 = v8;
            }

            v75 = v7;
            v9 = *(*(&v109 + 1) + 8 * v7);
            v10 = [v80 objectForKeyedSubscript:{v9, v74}];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v11 = v10;
            }

            else
            {
              v11 = 0;
            }

            v84 = v11;

            v79 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v9];
            v12 = [(HMDHome *)self accessoryWithUUID:v79];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v13 = v12;
            }

            else
            {
              v13 = 0;
            }

            v14 = v13;

            v107 = 0u;
            v108 = 0u;
            v105 = 0u;
            v106 = 0u;
            allKeys = [v84 allKeys];
            v85 = [allKeys countByEnumeratingWithState:&v105 objects:v122 count:16];
            if (v85)
            {
              v83 = *v106;
              do
              {
                v15 = 0;
                do
                {
                  if (*v106 != v83)
                  {
                    v16 = v15;
                    objc_enumerationMutation(allKeys);
                    v15 = v16;
                  }

                  v86 = v15;
                  v17 = [v84 objectForKeyedSubscript:*(*(&v105 + 1) + 8 * v15)];
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v18 = v17;
                  }

                  else
                  {
                    v18 = 0;
                  }

                  v90 = v18;

                  v19 = HAPInstanceIDFromValue();
                  pendingResponseCount = [v87 pendingResponseCount];
                  if (pendingResponseCount >= [v90 count])
                  {
                    v22 = [v90 count];
                    v21 = [v87 pendingResponseCount] - v22;
                  }

                  else
                  {
                    v21 = 0;
                  }

                  [v87 setPendingResponseCount:v21];
                  v103 = 0u;
                  v104 = 0u;
                  v101 = 0u;
                  v102 = 0u;
                  allKeys2 = [v90 allKeys];
                  v24 = [allKeys2 countByEnumeratingWithState:&v101 objects:v121 count:16];
                  if (v24)
                  {
                    v25 = 0;
                    v26 = *v102;
                    do
                    {
                      v27 = 0;
                      v28 = v25;
                      do
                      {
                        if (*v102 != v26)
                        {
                          objc_enumerationMutation(allKeys2);
                        }

                        v29 = *(*(&v101 + 1) + 8 * v27);
                        v30 = HAPInstanceIDFromValue();
                        v25 = [v14 findCharacteristic:v30 forService:v19];

                        if (v25)
                        {
                          [array2 addObject:v25];
                          if ([v25 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                          {
                            [array addObject:v25];
                          }
                        }

                        ++v27;
                        v28 = v25;
                      }

                      while (v24 != v27);
                      v24 = [allKeys2 countByEnumeratingWithState:&v101 objects:v121 count:16];
                    }

                    while (v24);
                  }

                  v15 = v86 + 1;
                }

                while (v86 + 1 != v85);
                v85 = [allKeys countByEnumeratingWithState:&v105 objects:v122 count:16];
              }

              while (v85);
            }

            v7 = v75 + 1;
          }

          while (v75 + 1 != v76);
          v76 = [obj countByEnumeratingWithState:&v109 objects:v123 count:16];
        }

        while (v76);
      }

      v31 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543874;
        v116 = v34;
        v117 = 2112;
        v118 = v81;
        v119 = 2112;
        v120 = v80;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_DEBUG, "%{public}@Notifying changes for requestIdentifier %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v31);
      v35 = objc_autoreleasePoolPush();
      v36 = [(HMDHome *)selfCopy3 _splitCharacteristicChanges:array2 changedAccessories:v80];
      requestMessage = [v87 requestMessage];
      [(HMDHome *)selfCopy3 _sendClientCharacteristicsChangedNotificationWithIdentifier:v77 requestMessage:requestMessage multiPartResponse:1 moreInMultiPartResponse:1 characteristicChanges:v36 completionHandler:0];

      objc_autoreleasePoolPop(v35);
    }
  }

  else
  {
    v99 = 0u;
    v100 = 0u;
    v97 = 0u;
    v98 = 0u;
    v38 = v80;
    v39 = [v38 countByEnumeratingWithState:&v97 objects:v114 count:16];
    if (v39)
    {
      v40 = *v98;
      do
      {
        for (i = 0; i != v39; ++i)
        {
          if (*v98 != v40)
          {
            objc_enumerationMutation(v38);
          }

          v42 = *(*(&v97 + 1) + 8 * i);
          objc_initWeak(buf, self);
          v43 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v42];
          v44 = [(HMDHome *)self accessoryWithUUID:v43];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v45 = v44;
          }

          else
          {
            v45 = 0;
          }

          v46 = v45;

          v47 = [v38 hmf_dictionaryForKey:v42];
          workQueue = [(HMDHome *)self workQueue];
          v94[0] = MEMORY[0x277D85DD0];
          v94[1] = 3221225472;
          v94[2] = __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke;
          v94[3] = &unk_2797226F0;
          objc_copyWeak(&v96, buf);
          v95 = notificationCopy;
          [v46 handleMultipleCharacteristicsUpdated:v47 message:v95 completionQueue:workQueue completionHandler:v94];

          objc_destroyWeak(&v96);
          objc_destroyWeak(buf);
        }

        v39 = [v38 countByEnumeratingWithState:&v97 objects:v114 count:16];
      }

      while (v39);
    }

    v49 = [(HMDHome *)self _unexpectedCharacteristicsFromCharacteristicNotifications:v38];
  }

  array3 = [MEMORY[0x277CBEB18] array];
  v91 = [notificationCopy dictionaryForKey:@"kMediaNotificationsKey"];
  v88 = [HMDMediaPropertyResponse responsesFromSerializedResponse:v91 requests:0 home:self];
  v51 = [[HMDMediaSessionRequestMessageInformation alloc] initWithMessage:notificationCopy];
  [(HMDHome *)self updateMediaStateWithResponses:v88 requestMessageInformation:v51];
  remoteSourceDevice = [notificationCopy remoteSourceDevice];
  if ([(HMDHome *)self _shouldRegisterForNotificationsWithDevice:remoteSourceDevice])
  {
    primaryResident = [(HMDHome *)self primaryResident];
    if ([array count])
    {
      if ([(HMDHome *)self isCurrentDeviceAvailableResident])
      {
        if (![(HMDHome *)self isCurrentDevicePrimaryResident])
        {
          device = [primaryResident device];
          v55 = [remoteSourceDevice isEqual:device];

          if (v55)
          {
            v56 = objc_autoreleasePoolPush();
            selfCopy4 = self;
            v58 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
            {
              v59 = HMFGetLogIdentifier();
              v60 = [array count];
              *buf = 138543874;
              v116 = v59;
              v117 = 2048;
              v118 = v60;
              v119 = 2112;
              v120 = array;
              _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, "%{public}@Disabling %tu notifications on primary resident: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v56);
            [(HMDHome *)selfCopy4 _remotelySetNotificationsEnabled:0 forCharacteristics:array characteristicChangeThresholds:0];
          }
        }
      }
    }

    v61 = [(HMDHome *)self _disablePayloadFromRemotelyUpdatedCharacteristicNotifications:v80];
    if ([v61 count] || objc_msgSend(array3, "count"))
    {
      v62 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      v64 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
      {
        v65 = HMFGetLogIdentifier();
        shortDescription = [remoteSourceDevice shortDescription];
        *buf = 138543618;
        v116 = v65;
        v117 = 2112;
        v118 = shortDescription;
        _os_log_impl(&dword_2531F8000, v64, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations due to unexpected characteristic notification received on primary resident from remote device: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v62);
      [(HMDHome *)selfCopy5 _modifyCharacteristicNotifications:v61 mediaNotifications:MEMORY[0x277CBEC10] actionSetNotificationPayload:array3 enableNotification:0 withDevice:remoteSourceDevice];
    }
  }

  else
  {
    v67 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v69 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
    {
      v70 = HMFGetLogIdentifier();
      *buf = 138543618;
      v116 = v70;
      v117 = 2112;
      v118 = remoteSourceDevice;
      _os_log_impl(&dword_2531F8000, v69, OS_LOG_TYPE_INFO, "%{public}@Disabling notification registrations with resident: %@ due to unexpected characteristic notification received", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v67);
    logEventSubmitter = [(HMDHome *)selfCopy6 logEventSubmitter];
    v72 = [[HMDUnexpectedNotificationLogEvent alloc] initWithCount:1];
    [logEventSubmitter submitLogEvent:v72];

    v113 = remoteSourceDevice;
    primaryResident = [MEMORY[0x277CBEA60] arrayWithObjects:&v113 count:1];
    [(HMDHome *)selfCopy6 _disableNotificationsForDevices:primaryResident];
  }

  [notificationCopy respondWithPayload:0];
  v73 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__handleCharacteristicsChangedNotification___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if ([v5 count])
  {
    v4 = [v5 hm_allKeys];
    [WeakRetained _notifyChangedCharacteristics:v4 message:*(a1 + 32) modifiedCharacteristics:v5 broadcast:0];
  }
}

- (void)_notifyChangedProperties:(id)properties withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address
{
  v35 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  identifierCopy = identifier;
  updateIdentifierCopy = updateIdentifier;
  addressCopy = address;
  if (addressCopy)
  {
    notificationHandlerMap = [(HMDHome *)self notificationHandlerMap];
    v15 = [notificationHandlerMap objectForKey:addressCopy];

    if (!v15)
    {
      homeManager = [(HMDHome *)self homeManager];
      v30 = 0u;
      v31 = 0u;
      v32 = 0u;
      v33 = 0u;
      watchManager = [homeManager watchManager];
      connectedWatches = [watchManager connectedWatches];

      v19 = [connectedWatches countByEnumeratingWithState:&v30 objects:v34 count:16];
      if (v19)
      {
        v28 = homeManager;
        v29 = propertiesCopy;
        v20 = *v31;
        while (2)
        {
          for (i = 0; i != v19; ++i)
          {
            if (*v31 != v20)
            {
              objc_enumerationMutation(connectedWatches);
            }

            remoteDestinationString = [*(*(&v30 + 1) + 8 * i) remoteDestinationString];
            v23 = [remoteDestinationString isEqual:addressCopy];

            if (v23)
            {
              v19 = 1;
              goto LABEL_13;
            }
          }

          v19 = [connectedWatches countByEnumeratingWithState:&v30 objects:v34 count:16];
          if (v19)
          {
            continue;
          }

          break;
        }

LABEL_13:
        homeManager = v28;
        propertiesCopy = v29;
      }

      v24 = [HMDDeviceNotificationHandler alloc];
      msgDispatcher = [(HMDHome *)self msgDispatcher];
      v15 = [(HMDDeviceNotificationHandler *)v24 initWithDestination:addressCopy watchDevice:v19 withRequestIdentifier:identifierCopy messageDispatcher:msgDispatcher home:self];

      notificationHandlerMap2 = [(HMDHome *)self notificationHandlerMap];
      [notificationHandlerMap2 setObject:v15 forKey:addressCopy];
    }

    [(HMDDeviceNotificationHandler *)v15 sendNotificationForMediaProperties:propertiesCopy withRequestIdentifier:identifierCopy notificationUpdateIdentifier:updateIdentifierCopy];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information
{
  v69 = *MEMORY[0x277D85DE8];
  propertiesCopy = properties;
  informationCopy = information;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Notifying users registered with resident of changes in properties", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  v51 = informationCopy;
  remoteSourceDevice = [informationCopy remoteSourceDevice];
  primaryResident = [(HMDHome *)selfCopy primaryResident];
  device = [primaryResident device];

  notificationRegistry = [(HMDHome *)selfCopy notificationRegistry];
  v15 = [notificationRegistry usersRegisteredForNotificationsForProperties:propertiesCopy];

  residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
  isCurrentDeviceAvailableResident = [residentDeviceManager isCurrentDeviceAvailableResident];

  v17 = [MEMORY[0x277CBEB58] set];
  skippedInterDeviceChangeNotifications = selfCopy->_skippedInterDeviceChangeNotifications;
  uUID = [MEMORY[0x277CCAD78] UUID];
  uUIDString = [uUID UUIDString];

  v60 = 0u;
  v61 = 0u;
  v58 = 0u;
  v59 = 0u;
  obj = v15;
  v19 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
  v54 = remoteSourceDevice;
  if (v19)
  {
    v20 = v19;
    v21 = *v59;
    v22 = HMDIDSActivityMonitorHomeManagerDataSource;
    v52 = propertiesCopy;
    v53 = selfCopy;
    v56 = *v59;
    do
    {
      for (i = 0; i != v20; ++i)
      {
        if (*v59 != v21)
        {
          objc_enumerationMutation(obj);
        }

        v24 = *(*(&v58 + 1) + 8 * i);
        v25 = [&v22[93] deviceWithDestination:v24];
        if (v25)
        {
          [v17 addObject:v25];
          if ([(HMDHome *)selfCopy _shouldSendToDestination:v24 device:v25 remoteSourceDevice:remoteSourceDevice])
          {
            v26 = v17;
            notificationRegistry2 = [(HMDHome *)selfCopy notificationRegistry];
            v28 = [notificationRegistry2 filterProperties:propertiesCopy forUser:v24];

            if ([v28 count])
            {
              v29 = objc_autoreleasePoolPush();
              v30 = selfCopy;
              v31 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
              {
                v32 = HMFGetLogIdentifier();
                *buf = 138543874;
                v63 = v32;
                v64 = 2112;
                v65 = v24;
                v66 = 2112;
                v67 = uUIDString;
                _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the properties that changed with notificationUpdateIdentifier: %@", buf, 0x20u);

                propertiesCopy = v52;
              }

              objc_autoreleasePoolPop(v29);
              [(HMDHome *)v30 _notifyChangedProperties:v28 withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:v24];
              selfCopy = v53;
              remoteSourceDevice = v54;
            }

            v17 = v26;
            v21 = v56;
            v22 = HMDIDSActivityMonitorHomeManagerDataSource;
          }
        }
      }

      v20 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
    }

    while (v20);
  }

  if (!v51 && [propertiesCopy count] && device && (objc_msgSend(device, "isCurrentDevice") & 1) == 0 && (objc_msgSend(v17, "containsObject:", device) & 1) == 0)
  {
    if (isCurrentDeviceAvailableResident)
    {
      v40 = v17;
      v41 = objc_autoreleasePoolPush();
      v42 = selfCopy;
      v43 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
      {
        v44 = HMFGetLogIdentifier();
        [device remoteDestinationString];
        v46 = v45 = selfCopy;
        *buf = 138543874;
        v63 = v44;
        v64 = 2112;
        v65 = v46;
        v66 = 2112;
        v67 = uUIDString;
        _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Fanning to primary resident destination %@ notificationUpdateIdentifier: %@", buf, 0x20u);

        selfCopy = v45;
        remoteSourceDevice = v54;
      }

      objc_autoreleasePoolPop(v41);
      remoteDestinationString = [device remoteDestinationString];
      [(HMDHome *)v42 _notifyChangedProperties:propertiesCopy withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:remoteDestinationString];

      v17 = v40;
    }

    else
    {
      ++selfCopy->_skippedInterDeviceChangeNotifications;
    }
  }

  if (isInternalBuild() && skippedInterDeviceChangeNotifications != selfCopy->_skippedInterDeviceChangeNotifications)
  {
    v33 = v17;
    v34 = objc_autoreleasePoolPush();
    v35 = selfCopy;
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      v38 = selfCopy->_skippedInterDeviceChangeNotifications;
      *buf = 138543618;
      v63 = v37;
      v64 = 2048;
      v65 = v38;
      _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device media property change notifications", buf, 0x16u);

      remoteSourceDevice = v54;
    }

    objc_autoreleasePoolPop(v34);
    v17 = v33;
  }

  v39 = *MEMORY[0x277D85DE8];
}

- (void)notifyRemoteUsersOfChangedProperties:(id)properties requestMessageInformation:(id)information
{
  propertiesCopy = properties;
  informationCopy = information;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyRemoteUsersOfChangedProperties_requestMessageInformation___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v12 = propertiesCopy;
  v13 = informationCopy;
  v9 = informationCopy;
  v10 = propertiesCopy;
  dispatch_async(workQueue, block);
}

- (void)_notifyUpdatedCharacteristic:(id)characteristic withRequestIdentifier:(id)identifier notificationUpdateIdentifier:(id)updateIdentifier toUserDeviceAddress:(id)address completion:(id)completion
{
  v38 = *MEMORY[0x277D85DE8];
  characteristicCopy = characteristic;
  identifierCopy = identifier;
  updateIdentifierCopy = updateIdentifier;
  addressCopy = address;
  completionCopy = completion;
  if (addressCopy)
  {
    notificationHandlerMap = [(HMDHome *)self notificationHandlerMap];
    v18 = [notificationHandlerMap objectForKey:addressCopy];

    if (!v18)
    {
      [(HMDHome *)self homeManager];
      v33 = 0u;
      v34 = 0u;
      v35 = 0u;
      v32 = v36 = 0u;
      watchManager = [v32 watchManager];
      connectedWatches = [watchManager connectedWatches];

      v21 = [connectedWatches countByEnumeratingWithState:&v33 objects:v37 count:16];
      if (v21)
      {
        v30 = updateIdentifierCopy;
        v31 = characteristicCopy;
        v22 = *v34;
        while (2)
        {
          for (i = 0; i != v21; ++i)
          {
            if (*v34 != v22)
            {
              objc_enumerationMutation(connectedWatches);
            }

            remoteDestinationString = [*(*(&v33 + 1) + 8 * i) remoteDestinationString];
            v25 = [remoteDestinationString isEqual:addressCopy];

            if (v25)
            {
              v21 = 1;
              goto LABEL_13;
            }
          }

          v21 = [connectedWatches countByEnumeratingWithState:&v33 objects:v37 count:16];
          if (v21)
          {
            continue;
          }

          break;
        }

LABEL_13:
        updateIdentifierCopy = v30;
        characteristicCopy = v31;
      }

      v26 = [HMDDeviceNotificationHandler alloc];
      msgDispatcher = [(HMDHome *)self msgDispatcher];
      v18 = [(HMDDeviceNotificationHandler *)v26 initWithDestination:addressCopy watchDevice:v21 withRequestIdentifier:identifierCopy messageDispatcher:msgDispatcher home:self];

      notificationHandlerMap2 = [(HMDHome *)self notificationHandlerMap];
      [notificationHandlerMap2 setObject:v18 forKey:addressCopy];
    }

    [(HMDDeviceNotificationHandler *)v18 sendNotificationForCharacteristicUpdates:characteristicCopy withRequestIdentifier:identifierCopy notificationUpdateIdentifier:updateIdentifierCopy completion:completionCopy];
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_sendCoalescedRemoteNotificationsForRequestMessage:(id)message accessories:(id)accessories
{
  accessoriesCopy = accessories;
  messageCopy = message;
  destination = [messageCopy destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = destination;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  isRemote = [messageCopy isRemote];
  if (isRemote)
  {
    device = [v9 device];
    remoteDestinationString = [device remoteDestinationString];

    if (remoteDestinationString)
    {
      notificationHandlerMap = [(HMDHome *)self notificationHandlerMap];
      v14 = [notificationHandlerMap objectForKey:remoteDestinationString];

      [v14 sendCoalescedRemoteNotificationForAccessories:accessoriesCopy];
    }
  }
}

- (BOOL)_shouldSendToDestination:(id)destination device:(id)device remoteSourceDevice:(id)sourceDevice
{
  v55 = *MEMORY[0x277D85DE8];
  destinationCopy = destination;
  deviceCopy = device;
  sourceDeviceCopy = sourceDevice;
  v11 = [HMDDeviceHandle deviceHandleForDestination:destinationCopy];
  v12 = +[HMDAccountRegistry sharedRegistry];
  v13 = [v12 deviceForHandle:v11];

  account = [v13 account];

  if (!account)
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy8 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v26 = HMFGetLogIdentifier();
      [v13 shortDescription];
      v28 = v27 = sourceDeviceCopy;
      *buf = 138543618;
      v52 = v26;
      v53 = 2112;
      v54 = v28;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Device %@ has no user attached to it", buf, 0x16u);

      sourceDeviceCopy = v27;
    }

    goto LABEL_38;
  }

  if (![(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled])
  {
    v15 = [(HMDHome *)self _userForDevice:v13];
    if (!v15)
    {
      v50 = sourceDeviceCopy;
      v16 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        [v13 shortDescription];
        v20 = v49 = v16;
        *buf = 138543618;
        v52 = v19;
        v53 = 2112;
        v54 = v20;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@No user found for the matching device: %@", buf, 0x16u);

        v16 = v49;
      }

      objc_autoreleasePoolPop(v16);
      sourceDeviceCopy = v50;
    }

    if (([v15 isRemoteAccessAllowed] & 1) == 0)
    {
      v32 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v34 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
      {
        v35 = HMFGetLogIdentifier();
        *buf = 138543618;
        v52 = v35;
        v53 = 2112;
        v54 = deviceCopy;
        _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Skipping device %@ since the user lacks remote access", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v32);
      goto LABEL_39;
    }
  }

  if (deviceCopy && [sourceDeviceCopy isEqual:deviceCopy])
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy8 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = destinationCopy;
      v25 = "%{public}@Skipping device %@ since it is the original sender";
LABEL_18:
      v29 = v23;
      v30 = OS_LOG_TYPE_DEBUG;
LABEL_37:
      _os_log_impl(&dword_2531F8000, v29, v30, v25, buf, 0x16u);

      goto LABEL_38;
    }

    goto LABEL_38;
  }

  if ([v13 isCurrentDevice])
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy8 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = destinationCopy;
      v25 = "%{public}@Skipping device %@ - ourselves";
      goto LABEL_18;
    }

LABEL_38:

    objc_autoreleasePoolPop(v21);
LABEL_39:
    v46 = 0;
    goto LABEL_40;
  }

  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  if ([localCapabilitiesDataSource isCompanionCapable])
  {
  }

  else
  {
    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    isCurrentDeviceAvailableResident = [residentDeviceManager isCurrentDeviceAvailableResident];

    if ((isCurrentDeviceAvailableResident & 1) == 0)
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v21 = objc_autoreleasePoolPush();
      selfCopy8 = self;
      v23 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        goto LABEL_38;
      }

      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = destinationCopy;
      v25 = "%{public}@Skipping device %@ since this device is not a companion or enabled resident";
      goto LABEL_36;
    }
  }

  localCapabilitiesDataSource2 = [(HMDHome *)self localCapabilitiesDataSource];
  isCompanionCapable = [localCapabilitiesDataSource2 isCompanionCapable];

  if (isCompanionCapable)
  {
    productInfo = [v13 productInfo];
    if (productInfo && (v41 = productInfo, [v13 productInfo], v42 = objc_claimAutoreleasedReturnValue(), v43 = objc_msgSend(v42, "productClass"), v42, v41, v43 != 5))
    {
      ++self->_skippedInterDeviceChangeNotifications;
      v21 = objc_autoreleasePoolPush();
      selfCopy8 = self;
      v23 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        goto LABEL_38;
      }

      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = destinationCopy;
      v25 = "%{public}@Skipping device %@ since this device is a companion but sending to non-watch";
    }

    else
    {
      homeManager = [(HMDHome *)self homeManager];
      isPairedWithWatch = [homeManager isPairedWithWatch];

      if (isPairedWithWatch)
      {
        goto LABEL_29;
      }

      ++self->_skippedInterDeviceChangeNotifications;
      v21 = objc_autoreleasePoolPush();
      selfCopy8 = self;
      v23 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        goto LABEL_38;
      }

      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v52 = v24;
      v53 = 2112;
      v54 = destinationCopy;
      v25 = "%{public}@Skipping device %@ since this device is a companion but not paired with a watch";
    }

LABEL_36:
    v29 = v23;
    v30 = OS_LOG_TYPE_INFO;
    goto LABEL_37;
  }

LABEL_29:
  v46 = 1;
LABEL_40:

  v47 = *MEMORY[0x277D85DE8];
  return v46;
}

- (id)_userForDevice:(id)device
{
  deviceCopy = device;
  users = [(HMDHome *)self users];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __26__HMDHome__userForDevice___block_invoke;
  v9[3] = &unk_2797226C8;
  v10 = deviceCopy;
  v6 = deviceCopy;
  v7 = [users hmf_objectPassingTest:v9];

  return v7;
}

uint64_t __26__HMDHome__userForDevice___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 account];
  v4 = [*(a1 + 32) account];
  v5 = [v3 isEqual:v4];

  return v5;
}

- (BOOL)_shouldRateLimitChangeNotificationsForCharacteristic:(id)characteristic
{
  characteristicCopy = characteristic;
  service = [characteristicCopy service];
  type = [characteristicCopy type];
  if (([type isEqualToString:*MEMORY[0x277CFE628]] & 1) == 0)
  {

    goto LABEL_5;
  }

  type2 = [service type];
  if (![type2 isEqualToString:*MEMORY[0x277CFE900]])
  {
    type3 = [service type];
    v9 = [type3 isEqualToString:*MEMORY[0x277CFE860]];

    if (v9)
    {
      goto LABEL_7;
    }

LABEL_5:
    v7 = 0;
    goto LABEL_14;
  }

LABEL_7:
  previousValue = [characteristicCopy previousValue];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = previousValue;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  [v12 doubleValue];
  v27 = v13;

  value = [characteristicCopy value];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = value;
  }

  else
  {
    v15 = 0;
  }

  v16 = v15;

  [v16 doubleValue];
  v26 = v17;

  v18.f64[0] = v27;
  v18.f64[1] = v26;
  __asm { FMOV            V1.2D, #0.5 }

  v24 = vmulq_f64(vrndaq_f64(vaddq_f64(v18, v18)), _Q1);
  v7 = fabs(vsubq_f64(v24, vdupq_laneq_s64(v24, 1)).f64[0]) < 2.22044605e-16;
LABEL_14:

  return v7;
}

- (void)_notifyRemoteUsersOfChangedCharacteristics:(id)characteristics message:(id)message broadcast:(BOOL)broadcast
{
  broadcastCopy = broadcast;
  v128 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  messageCopy = message;
  v101 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
  v96 = [MEMORY[0x277CBEB58] set];
  v115 = 0u;
  v116 = 0u;
  v117 = 0u;
  v118 = 0u;
  v8 = characteristicsCopy;
  v9 = [v8 countByEnumeratingWithState:&v115 objects:v127 count:16];
  obj = v8;
  selfCopy = self;
  if (v9)
  {
    v10 = v9;
    v11 = *v116;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v116 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v115 + 1) + 8 * i);
        accessory = [v13 accessory];
        stateNumber = [v13 stateNumber];
        [accessory updateTrackedAccessoryStateNumber:stateNumber];

        dataSource = [(HMDHome *)self dataSource];
        hapMetadata = [dataSource hapMetadata];
        type = [v13 type];
        service = [v13 service];
        type2 = [service type];
        v21 = [hapMetadata shouldFilterChangeNotificationsForCharacteristicType:type serviceType:type2];

        self = selfCopy;
        if ((v21 & 1) == 0)
        {
          if ([(HMDHome *)selfCopy _shouldRateLimitChangeNotificationsForCharacteristic:v13])
          {
            v22 = objc_autoreleasePoolPush();
            v23 = selfCopy;
            v24 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
            {
              v25 = HMFGetLogIdentifier();
              *buf = 138543618;
              v120 = v25;
              v121 = 2112;
              v122 = v13;
              _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Filtering out characteristic for remote notification due to rate limiting: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v22);
          }

          else
          {
            accessory2 = [v13 accessory];
            if ([accessory2 hasBTLELink])
            {
              identifier = [accessory2 identifier];
              v28 = [accessory2 matchingTransportInformationWithServerIdentifier:identifier instanceID:0 linkType:1];

              if (([v28 isReachable] & 1) == 0)
              {
                [v96 addObject:v13];
              }
            }

            [v101 addObject:v13];
          }
        }
      }

      v8 = obj;
      v10 = [obj countByEnumeratingWithState:&v115 objects:v127 count:16];
    }

    while (v10);
  }

  v29 = v101;
  if ([v101 count])
  {
    v30 = messageCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v31 = v30;
    }

    else
    {
      v31 = 0;
    }

    v32 = v31;

    v93 = v32;
    destination = [v32 destination];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v34 = destination;
    }

    else
    {
      v34 = 0;
    }

    v35 = v34;

    v92 = v35;
    device = [v35 device];
    primaryResident = [(HMDHome *)self primaryResident];
    device2 = [primaryResident device];

    v104 = [MEMORY[0x277CBEB58] set];
    notificationRegistry = [(HMDHome *)self notificationRegistry];
    v39 = [notificationRegistry usersRegisteredForNotificationsForCharacteristics:v101];
    v102 = [v39 mutableCopy];

    residentDeviceManager = [(HMDHome *)self residentDeviceManager];
    LODWORD(v39) = [residentDeviceManager isCurrentDeviceAvailableResident];

    v97 = device;
    v90 = v39;
    if (v39)
    {
      v113 = 0u;
      v114 = 0u;
      v111 = 0u;
      v112 = 0u;
      residentEnabledDevices = [(HMDHome *)self residentEnabledDevices];
      v42 = [residentEnabledDevices countByEnumeratingWithState:&v111 objects:v126 count:16];
      if (!v42)
      {
        goto LABEL_37;
      }

      v43 = v42;
      v44 = *v112;
      while (1)
      {
        for (j = 0; j != v43; ++j)
        {
          if (*v112 != v44)
          {
            objc_enumerationMutation(residentEnabledDevices);
          }

          v46 = *(*(&v111 + 1) + 8 * j);
          primaryResident2 = [(HMDHome *)self primaryResident];
          if (([primaryResident2 isCurrentDevice] & 1) == 0)
          {
            primaryResident3 = [(HMDHome *)self primaryResident];
            device3 = [primaryResident3 device];
            remoteDestinationString = [device3 remoteDestinationString];
            v51 = [v102 containsObject:remoteDestinationString];

            if (v51)
            {
              goto LABEL_35;
            }

            primaryResident2 = [v46 remoteDestinationString];
            [v102 addObject:primaryResident2];
          }

LABEL_35:
          self = selfCopy;
        }

        v43 = [residentEnabledDevices countByEnumeratingWithState:&v111 objects:v126 count:16];
        if (!v43)
        {
LABEL_37:

          device = v97;
          break;
        }
      }
    }

    uUID = [MEMORY[0x277CCAD78] UUID];
    uUIDString = [uUID UUIDString];

    skippedInterDeviceChangeNotifications = self->_skippedInterDeviceChangeNotifications;
    v107 = 0u;
    v108 = 0u;
    v109 = 0u;
    v110 = 0u;
    v103 = v102;
    v53 = [v103 countByEnumeratingWithState:&v107 objects:v125 count:16];
    v29 = v101;
    if (v53)
    {
      v54 = v53;
      v55 = *v108;
      v56 = HMDIDSActivityMonitorHomeManagerDataSource;
      v99 = *v108;
      do
      {
        for (k = 0; k != v54; ++k)
        {
          if (*v108 != v55)
          {
            objc_enumerationMutation(v103);
          }

          v58 = *(*(&v107 + 1) + 8 * k);
          v59 = [&v56[93] deviceWithDestination:v58];
          if (v59)
          {
            [v104 addObject:v59];
            if ([(HMDHome *)self _shouldSendToDestination:v58 device:v59 remoteSourceDevice:device])
            {
              notificationRegistry2 = [(HMDHome *)self notificationRegistry];
              v61 = [notificationRegistry2 filterCharacteristics:v29 forUser:v58];

              v62 = [HMDCharacteristicUpdateTuple characteristicUpdateTuplesWithCharacteristics:v61 isBroadcast:broadcastCopy];
              if ([v62 count])
              {
                v63 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v65 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v65, OS_LOG_TYPE_INFO))
                {
                  v66 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v120 = v66;
                  v121 = 2112;
                  v122 = v58;
                  v123 = 2112;
                  v124 = uUIDString;
                  _os_log_impl(&dword_2531F8000, v65, OS_LOG_TYPE_INFO, "%{public}@Fanning out to device %@ with the characteristics that changed for notificationUpdateIdentifier: %@", buf, 0x20u);

                  v29 = v101;
                }

                objc_autoreleasePoolPop(v63);
                [(HMDHome *)selfCopy2 _notifyUpdatedCharacteristic:v62 withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:v58 completion:&__block_literal_global_1515];
                self = selfCopy;
                device = v97;
              }

              v55 = v99;
              v56 = HMDIDSActivityMonitorHomeManagerDataSource;
            }
          }
        }

        v54 = [v103 countByEnumeratingWithState:&v107 objects:v125 count:16];
      }

      while (v54);
    }

    v8 = obj;
    v67 = device2;
    if (![v29 count] || !device2 || (objc_msgSend(device2, "isCurrentDevice") & 1) != 0 || (objc_msgSend(v104, "containsObject:", device2) & 1) != 0 || (objc_msgSend(device, "isEqual:", device2) & 1) != 0)
    {
      goto LABEL_70;
    }

    if (v90)
    {
      v68 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v70 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v70, OS_LOG_TYPE_INFO))
      {
        v71 = HMFGetLogIdentifier();
        remoteDestinationString2 = [device2 remoteDestinationString];
        *buf = 138543874;
        v120 = v71;
        v121 = 2112;
        v122 = remoteDestinationString2;
        v123 = 2112;
        v124 = uUIDString;
        _os_log_impl(&dword_2531F8000, v70, OS_LOG_TYPE_INFO, "%{public}@Fanning to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v67 = device2;
      }

      objc_autoreleasePoolPop(v68);
      remoteDestinationString3 = [v67 remoteDestinationString];
      [(HMDHome *)selfCopy3 _notifyChangedCharacteristics:v29 withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:remoteDestinationString3 broadcast:broadcastCopy];
    }

    else
    {
      if (![v96 count])
      {
        ++self->_skippedInterDeviceChangeNotifications;
LABEL_70:
        if (isInternalBuild() && skippedInterDeviceChangeNotifications != self->_skippedInterDeviceChangeNotifications)
        {
          v84 = objc_autoreleasePoolPush();
          selfCopy4 = self;
          v86 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
          {
            v87 = HMFGetLogIdentifier();
            v88 = self->_skippedInterDeviceChangeNotifications;
            *buf = 138543618;
            v120 = v87;
            v121 = 2048;
            v122 = v88;
            _os_log_impl(&dword_2531F8000, v86, OS_LOG_TYPE_INFO, "%{public}@Skipped %lu spurious inter-device characteristic change notifications", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v84);
          device = v97;
        }

        goto LABEL_76;
      }

      v78 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      v80 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v80, OS_LOG_TYPE_INFO))
      {
        v81 = HMFGetLogIdentifier();
        remoteDestinationString4 = [device2 remoteDestinationString];
        *buf = 138543874;
        v120 = v81;
        v121 = 2112;
        v122 = remoteDestinationString4;
        v123 = 2112;
        v124 = uUIDString;
        _os_log_impl(&dword_2531F8000, v80, OS_LOG_TYPE_INFO, "%{public}@Fanning the characteristics changed over BTLE to primary resident destination %@ with notificationUpdateIdentifier: %@", buf, 0x20u);

        v67 = device2;
      }

      objc_autoreleasePoolPop(v78);
      remoteDestinationString3 = [v96 allObjects];
      remoteDestinationString5 = [v67 remoteDestinationString];
      [(HMDHome *)selfCopy5 _notifyChangedCharacteristics:remoteDestinationString3 withRequestIdentifier:0 notificationUpdateIdentifier:uUIDString toUserDeviceAddress:remoteDestinationString5 broadcast:broadcastCopy];
    }

    device = v97;
    goto LABEL_70;
  }

  if ([v8 count])
  {
    v74 = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v76 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v76, OS_LOG_TYPE_DEBUG))
    {
      v77 = HMFGetLogIdentifier();
      *buf = 138543362;
      v120 = v77;
      _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_DEBUG, "%{public}@No changes to notify remote devices of changed characteristics after filtering", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v74);
  }

LABEL_76:

  v89 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldRegisterForNotificationsWithDevice:(id)device
{
  deviceCopy = device;
  primaryResident = [(HMDHome *)self primaryResident];
  if (!isWatch())
  {
    if (primaryResident)
    {
      device = [primaryResident device];
      isCurrentDevice = [device isCurrentDevice];

      if (isCurrentDevice)
      {
        goto LABEL_8;
      }

      device2 = [primaryResident device];
      isRemoteGatewayCapable = [deviceCopy isEqual:device2];
    }

    else
    {
      device2 = [deviceCopy capabilities];
      isRemoteGatewayCapable = [device2 isRemoteGatewayCapable];
    }

    v10 = isRemoteGatewayCapable;
LABEL_14:

    goto LABEL_15;
  }

  if (!primaryResident || ([primaryResident device], v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(deviceCopy, "isEqual:", v6), v6, (v7 & 1) == 0))
  {
    homeManager = [(HMDHome *)self homeManager];
    device2 = [homeManager companionDevice];

    if ([deviceCopy isEqual:device2])
    {
      v10 = 1;
    }

    else if (device2)
    {
      v10 = 0;
    }

    else
    {
      device3 = [primaryResident device];
      v10 = [deviceCopy isEqual:device3];

      device2 = 0;
    }

    goto LABEL_14;
  }

LABEL_8:
  v10 = 1;
LABEL_15:

  return v10;
}

- (BOOL)shouldRelayNotificationToRegisteredDevicesForSource:(id)source
{
  sourceCopy = source;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = sourceCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  destination = [sourceCopy destination];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (![v6 isRemote] || (isKindOfClass & 1) == 0 || !destination)
  {
    goto LABEL_16;
  }

  name = [v6 name];
  if (([name isEqualToString:@"kCharacteristicValueUpdatedNotificationKey"] & 1) == 0)
  {
    name2 = [v6 name];
    if ([name2 isEqualToString:@"kMultipleCharacteristicValuesUpdatedNotificationKey"])
    {

      goto LABEL_10;
    }

    name3 = [v6 name];
    v16 = [name3 isEqualToString:@"kCharacterisiticsChangedInternalNotificationKey"];

    if (v16)
    {
      goto LABEL_11;
    }

LABEL_16:
    if (!isWatch())
    {
      goto LABEL_17;
    }

    goto LABEL_14;
  }

LABEL_10:

LABEL_11:
  primaryResident = [(HMDHome *)self primaryResident];
  if ([primaryResident isCurrentDevice])
  {

LABEL_17:
    v14 = 1;
    goto LABEL_18;
  }

  homeManager = [(HMDHome *)self homeManager];
  isPairedWithWatch = [homeManager isPairedWithWatch];

  if (isPairedWithWatch)
  {
    goto LABEL_17;
  }

LABEL_14:
  v14 = 0;
LABEL_18:

  return v14;
}

- (id)_splitCharacteristicChanges:(id)changes changedAccessories:(id)accessories
{
  v79 = *MEMORY[0x277D85DE8];
  changesCopy = changes;
  accessoriesCopy = accessories;
  v57 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(accessoriesCopy, "count")}];
  v59 = accessoriesCopy;
  v58 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(accessoriesCopy, "count")}];
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v77 = 0u;
  obj = changesCopy;
  v8 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v75;
    selfCopy = self;
    v62 = *v75;
    do
    {
      v11 = 0;
      v63 = v9;
      do
      {
        if (*v75 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v74 + 1) + 8 * v11);
        service = [v12 service];
        accessory = [service accessory];
        v15 = accessory;
        if (service)
        {
          v16 = accessory == 0;
        }

        else
        {
          v16 = 1;
        }

        if (!v16)
        {
          dataSource = [(HMDHome *)self dataSource];
          hapMetadata = [dataSource hapMetadata];
          type = [v12 type];
          v73 = hapMetadata;
          if (([hapMetadata shouldFilterCharacteristicOfTypeFromApp:type] & 1) == 0)
          {
            v70 = dataSource;
            v72 = type;
            dataSource2 = [(HMDHome *)self dataSource];
            hapMetadata2 = [dataSource2 hapMetadata];
            type2 = [service type];
            if ([hapMetadata2 shouldFilterServiceOfTypeFromApp:type2])
            {
              v67 = hapMetadata2;
              goto LABEL_13;
            }

            dataSource3 = [(HMDHome *)self dataSource];
            [dataSource3 hapMetadata];
            v24 = v64 = dataSource2;
            type3 = [v12 type];
            type4 = [service type];
            v68 = [v24 shouldFilterChangeNotificationsForCharacteristicType:type3 serviceType:type4];

            self = selfCopy;
            v9 = v63;

            v10 = v62;
            if (v68)
            {
              goto LABEL_31;
            }

            uuid = [v15 uuid];
            uUIDString = [uuid UUIDString];

            v70 = uUIDString;
            v29 = [v59 objectForKey:uUIDString];
            instanceID = [service instanceID];
            stringValue = [instanceID stringValue];

            v72 = stringValue;
            v73 = v29;
            dataSource2 = [v29 objectForKey:stringValue];
            instanceID2 = [v12 instanceID];
            stringValue2 = [instanceID2 stringValue];

            v34 = [dataSource2 objectForKey:stringValue2];
            v67 = stringValue2;
            if (v34)
            {
              v60 = v34;
              v35 = v58;
              if (isAppleTV())
              {
                v65 = dataSource2;
                dataSource4 = [(HMDHome *)selfCopy dataSource];
                hapMetadata3 = [dataSource4 hapMetadata];
                type5 = [v12 type];
                type6 = [service type];
                v40 = [hapMetadata3 requiresDeviceUnlock:type5 forService:type6];

                dataSource = v70;
                if (v40)
                {
                  v41 = v57;

                  v35 = v41;
                }

                self = selfCopy;
                dataSource2 = v65;
              }

              else
              {
                dataSource = v70;
              }

              v42 = accessoryToEncodeForXPCTransportForAccessory(v15);
              v66 = v42;
              if (v42 != v15)
              {
                uuid2 = [v42 uuid];
                uUIDString2 = [uuid2 UUIDString];

                v45 = v57;
                dataSource = uUIDString2;
                v35 = v45;
              }

              v9 = v63;
              v46 = [v35 objectForKey:dataSource];
              if (!v46)
              {
                v47 = MEMORY[0x277CBEB38];
                v48 = [v73 count];
                v49 = v47;
                v9 = v63;
                v46 = [v49 dictionaryWithCapacity:v48];
                [v35 setObject:v46 forKey:dataSource];
              }

              v71 = v35;
              v50 = [v46 objectForKey:v72];
              if (!v50)
              {
                v51 = MEMORY[0x277CBEB38];
                v52 = [dataSource2 count];
                v53 = v51;
                v9 = v63;
                v50 = [v53 dictionaryWithCapacity:v52];
                [v46 setObject:v50 forKey:v72];
              }

              type2 = v60;
              [v50 setObject:v60 forKey:v67];

              v10 = v62;
            }

            else
            {
              type2 = 0;
              v9 = v63;
LABEL_13:
              dataSource = v70;
            }

            type = v72;
          }
        }

LABEL_31:

        ++v11;
      }

      while (v9 != v11);
      v9 = [obj countByEnumeratingWithState:&v74 objects:v78 count:16];
    }

    while (v9);
  }

  v54 = [[HMDCharacteristicUpdatesNotificationPayload alloc] initWithSPIEntitledClientUpdates:v57 allClientUpdates:v58];
  v55 = *MEMORY[0x277D85DE8];

  return v54;
}

- (void)_handleRequestHomeDataSync:(id)sync
{
  v60 = *MEMORY[0x277D85DE8];
  syncCopy = sync;
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v6 = MEMORY[0x277CCFD28];
  if (!isOwnerUser)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      identifier = [syncCopy identifier];
      uUIDString = [identifier UUIDString];
      *buf = 138543618;
      v57 = v10;
      v58 = 2112;
      v59 = uUIDString;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Not owner, cannot send for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    v13 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:10 userInfo:0];
    responseHandler = [syncCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [syncCopy responseHandler];
      (responseHandler2)[2](responseHandler2, v13, 0);
    }
  }

  v16 = [syncCopy stringForKey:@"pairingUsername"];
  if (!v16)
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      identifier2 = [syncCopy identifier];
      uUIDString2 = [identifier2 UUIDString];
      *buf = 138543618;
      v57 = v20;
      v58 = 2112;
      v59 = uUIDString2;
      _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@User is not specified for message: %@", buf, 0x16u);

      v6 = MEMORY[0x277CCFD28];
    }

    objc_autoreleasePoolPop(v17);
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*v6 code:2 userInfo:0];
    responseHandler3 = [syncCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler4 = [syncCopy responseHandler];
      (responseHandler4)[2](responseHandler4, v23, 0);
    }
  }

  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  users = [(HMDHome *)self users];
  v27 = [users countByEnumeratingWithState:&v51 objects:v55 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v52;
LABEL_15:
    v30 = 0;
    while (1)
    {
      if (*v52 != v29)
      {
        objc_enumerationMutation(users);
      }

      v31 = *(*(&v51 + 1) + 8 * v30);
      if (([v31 isRemoteGateway] & 1) == 0)
      {
        pairingUsername = [v31 pairingUsername];
        v33 = [v16 isEqualToString:pairingUsername];

        if (v33)
        {
          break;
        }
      }

      if (v28 == ++v30)
      {
        v28 = [users countByEnumeratingWithState:&v51 objects:v55 count:16];
        if (v28)
        {
          goto LABEL_15;
        }

        goto LABEL_22;
      }
    }

    v34 = v31;

    if (v34)
    {
      goto LABEL_29;
    }
  }

  else
  {
LABEL_22:
  }

  v35 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v37 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
  {
    v38 = HMFGetLogIdentifier();
    identifier3 = [syncCopy identifier];
    uUIDString3 = [identifier3 UUIDString];
    *buf = 138543618;
    v57 = v38;
    v58 = 2112;
    v59 = uUIDString3;
    _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Unable to find user for message: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v35);
  v41 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  responseHandler5 = [syncCopy responseHandler];

  if (responseHandler5)
  {
    responseHandler6 = [syncCopy responseHandler];
    (responseHandler6)[2](responseHandler6, v41, 0);
  }

  v34 = 0;
LABEL_29:
  destination = [syncCopy destination];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v45 = destination;
  }

  else
  {
    v45 = 0;
  }

  v46 = v45;

  if (v46)
  {
    homeManager = [(HMDHome *)self homeManager];
    device = [v46 device];
    remoteDestinationString = [device remoteDestinationString];
    [homeManager sendUserAdded:v34 destination:remoteDestinationString toHome:self];
  }

  [syncCopy respondWithPayload:0];

  v50 = *MEMORY[0x277D85DE8];
}

- (void)_sendInvitationCancelationRequestToInvitee:(id)invitee
{
  v19[2] = *MEMORY[0x277D85DE8];
  inviteeCopy = invitee;
  homeManager = [(HMDHome *)self homeManager];
  v18[0] = @"kInvitationIdentifierKey";
  identifier = [inviteeCopy identifier];
  uUIDString = [identifier UUIDString];
  v18[1] = @"kInvitationStateKey";
  v19[0] = uUIDString;
  v19[1] = &unk_286627820;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v19 forKeys:v18 count:2];

  invitationData = [inviteeCopy invitationData];
  v10 = [MEMORY[0x277D0F818] internalMessageWithName:@"kUpdateHomeInvitationStateInternalRequestKey" messagePayload:v8];
  uuid = [homeManager uuid];
  inviteeUserID = [invitationData inviteeUserID];
  workQueue = [(HMDHome *)self workQueue];
  v16[0] = MEMORY[0x277D85DD0];
  v16[1] = 3221225472;
  v16[2] = __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke;
  v16[3] = &unk_279733FB0;
  v16[4] = self;
  v17 = inviteeCopy;
  v14 = inviteeCopy;
  [homeManager sendUnsecureMessage:v10 target:uuid userID:inviteeUserID responseQueue:workQueue responseHandler:v16];

  v15 = *MEMORY[0x277D85DE8];
}

void __54__HMDHome__sendInvitationCancelationRequestToInvitee___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = os_log_type_enabled(v9, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v10)
    {
      v11 = HMFGetLogIdentifier();
      v12 = [*(a1 + 40) identifier];
      v13 = [v12 UUIDString];
      v18 = 138543874;
      v19 = v11;
      v20 = 2112;
      v21 = v13;
      v22 = 2112;
      v23 = v5;
      v14 = "%{public}@Failed to cancel invitation state for invitee with identifier %@ due to error %@";
      v15 = v9;
      v16 = 32;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, v14, &v18, v16);
    }
  }

  else if (v10)
  {
    v11 = HMFGetLogIdentifier();
    v12 = [*(a1 + 40) identifier];
    v13 = [v12 UUIDString];
    v18 = 138543618;
    v19 = v11;
    v20 = 2112;
    v21 = v13;
    v14 = "%{public}@Canceled invitation state for invitee with identifier %@";
    v15 = v9;
    v16 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v7);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)__handleCompletedOutgoingInvitation:(id)invitation
{
  v17 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    identifier = [invitationCopy identifier];
    uUIDString = [identifier UUIDString];
    v13 = 138543618;
    v14 = v8;
    v15 = 2112;
    v16 = uUIDString;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing outgoing invitation '%@' since it completed", &v13, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [invitationCopy updateInvitationState:3];
  user = [invitationCopy user];
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)selfCopy->_usersPendingUserManagementOperations removeObject:user];
  os_unfair_recursive_lock_unlock();

  v12 = *MEMORY[0x277D85DE8];
}

- (void)__handleCancelledOutgoingInvitation:(id)invitation
{
  v30 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  [invitationCopy cancel];
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  v22 = 0u;
  v20 = invitationCopy;
  operations = [invitationCopy operations];
  v6 = [operations countByEnumeratingWithState:&v21 objects:v29 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v22;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v22 != v8)
        {
          objc_enumerationMutation(operations);
        }

        v10 = *(*(&v21 + 1) + 8 * i);
        if ([v10 isFinished] && (objc_msgSend(v10, "isCancelled") & 1) == 0)
        {
          user = [v10 user];
          accessory = [v10 accessory];
          v13 = [HMDUserManagementOperation removeUserManagementOperationForUser:user accessory:accessory model:0];

          v14 = objc_autoreleasePoolPush();
          selfCopy = self;
          v16 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
          {
            v17 = HMFGetLogIdentifier();
            *buf = 138543618;
            v26 = v17;
            v27 = 2112;
            v28 = v13;
            _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Adding remove operation for canceled invite: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v14);
          v18 = +[HMDUserManagementOperationManager sharedManager];
          [v18 addOperation:v13];
        }
      }

      v7 = [operations countByEnumeratingWithState:&v21 objects:v29 count:16];
    }

    while (v7);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)__handleAcceptedOutgoingInvitationResponse:(id)response destinationAddress:(id)address publicKey:(id)key username:(id)username issuerPublicKeyER:(id)r presenceAuthStatus:(id)status completionHandler:(id)handler
{
  v143 = *MEMORY[0x277D85DE8];
  responseCopy = response;
  addressCopy = address;
  keyCopy = key;
  usernameCopy = username;
  rCopy = r;
  statusCopy = status;
  aBlock = handler;
  v105 = responseCopy;
  user = [responseCopy user];
  v16 = objc_autoreleasePoolPush();
  val = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
  {
    v18 = HMFGetLogIdentifier();
    privilege = [(__CFString *)user privilege];
    if (privilege > 4)
    {
      v20 = @"None";
    }

    else
    {
      v20 = off_279730DF8[privilege];
    }

    v21 = v20;
    *buf = 138543874;
    v136 = v18;
    v137 = 2112;
    v138 = user;
    v139 = 2112;
    v140 = v21;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@User: %@, has accepted an invitation, processing acceptance. %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  [(__CFString *)user setHome:val];
  v107 = [(__CFString *)user modelObjectWithChangeType:1];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v22 = v107;
  }

  else
  {
    v22 = 0;
  }

  v23 = v22;

  if (user && v23)
  {
    v106 = usernameCopy;
    if ([(__CFString *)user isRemoteGateway])
    {
      keychainStore = [(HMDHome *)val keychainStore];
      v131 = 0;
      v132 = 0;
      v25 = [keychainStore getControllerPublicKey:0 secretKey:0 keyPair:0 username:&v132 allowCreation:0 error:&v131];
      v100 = v132;
      v104 = v131;

      if ((v25 & 1) == 0)
      {
        v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Failed to set resident pairing name" reason:0 suggestion:0];
        v53 = _Block_copy(aBlock);
        v54 = v53;
        if (v53)
        {
          (*(v53 + 2))(v53, v50);
        }

        goto LABEL_48;
      }

      if ([v100 isEqualToString:v106])
      {
        v26 = [HMDDevice deviceWithDestination:addressCopy];
        identifier = [v26 identifier];
        uUIDString = [identifier UUIDString];

        v106 = uUIDString;
      }
    }

    v104 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:keyCopy];
    v100 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:v106 publicKey:v104 privateKey:0 permissions:0];
    userID = [(__CFString *)user userID];
    uuid = [(HMDHome *)val uuid];
    v94 = [HMDUser UUIDWithUserID:userID forHomeIdentifier:uuid uuid:0 pairingIdentity:v100];

    uuid2 = [(__CFString *)user uuid];
    v32 = HMFEqualObjects();

    if ((v32 & 1) == 0)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = val;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        v36 = HMFGetLogIdentifier();
        uuid3 = [(__CFString *)user uuid];
        userID2 = [(__CFString *)user userID];
        *buf = 138544130;
        v136 = v36;
        v137 = 2112;
        v138 = uuid3;
        v139 = 2112;
        v140 = v94;
        v141 = 2112;
        v142 = userID2;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Old invitee uuid %@, new invitee uuid %@ for userID %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v33);
      [(__CFString *)user setUUID:v94];
      v39 = [(__CFString *)user modelObjectWithChangeType:1];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v40 = v39;
      }

      else
      {
        v40 = 0;
      }

      v107 = v40;
    }

    hmd_dictionaryEncoding = [v100 hmd_dictionaryEncoding];
    [v107 setPairingIdentity:hmd_dictionaryEncoding];

    number = [statusCopy number];
    [v107 setPresenceAuthorizationStatus:number];

    [(__CFString *)user setPairingIdentity:v100];
    accessories = [(HMDHome *)val accessories];
    v130 = 0;
    v97 = [(HMDHome *)val prepareUserManagementOperationForUser:user accessories:accessories type:1 error:&v130];
    v92 = v130;

    if (!v97)
    {
      if (shouldLogPrivateInformation())
      {
        userID3 = [(__CFString *)user userID];
      }

      else
      {
        userID3 = @"...";
        v55 = @"...";
      }

      v56 = objc_autoreleasePoolPush();
      v57 = val;
      v58 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = HMFGetLogIdentifier();
        *buf = 138543874;
        v136 = v59;
        v137 = 2112;
        v138 = userID3;
        v139 = 2112;
        v140 = v92;
        _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_ERROR, "%{public}@Failed to prepare add user operations for recently accepted user '%@' with error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v56);
    }

    v60 = [HMDOutgoingHomeInvitationModel alloc];
    identifier2 = [responseCopy identifier];
    uuid4 = [(HMDHome *)val uuid];
    v96 = [(HMDBackingStoreModelObject *)v60 initWithObjectChangeType:3 uuid:identifier2 parentUUID:uuid4];

    [(HMDOutgoingHomeInvitationModel *)v96 setInvitationState:&unk_286627880];
    [(HMDOutgoingHomeInvitationModel *)v96 setInviteeDestinationAddress:addressCopy];
    homeManager = [(HMDHome *)val homeManager];
    backingStore = [homeManager backingStore];
    v64 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v112 = [backingStore transaction:@"kUserManagementOperationAddedKey" options:v64];

    v65 = dispatch_group_create();
    v111 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v97, "count")}];
    if ([v97 count])
    {
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)val->_usersPendingUserManagementOperations addObject:user];
      os_unfair_recursive_lock_unlock();
      [(HMDBackingStoreModelObject *)v96 setObjectChangeType:2];
      v128 = 0u;
      v129 = 0u;
      v126 = 0u;
      v127 = 0u;
      obj = v97;
      v66 = [obj countByEnumeratingWithState:&v126 objects:v134 count:16];
      if (v66)
      {
        v67 = *v127;
        do
        {
          for (i = 0; i != v66; ++i)
          {
            if (*v127 != v67)
            {
              objc_enumerationMutation(obj);
            }

            v69 = *(*(&v126 + 1) + 8 * i);
            dispatch_group_enter(v65);
            accessory = [v69 accessory];
            identifier3 = [accessory identifier];
            user2 = [v69 user];
            pairingIdentity = [user2 pairingIdentity];
            v124[0] = MEMORY[0x277D85DD0];
            v124[1] = 3221225472;
            v124[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1508;
            v124[3] = &unk_2797359D8;
            v125 = v65;
            [homeManager cleanupOperationsForAccessory:identifier3 user:pairingIdentity completion:v124];

            v74 = [v69 modelObjectWithChangeType:1];
            [v112 add:v74];

            identifier4 = [v69 identifier];
            uUIDString2 = [identifier4 UUIDString];
            [v111 addObject:uUIDString2];
          }

          v66 = [obj countByEnumeratingWithState:&v126 objects:v134 count:16];
        }

        while (v66);
      }
    }

    else
    {
      v77 = objc_autoreleasePoolPush();
      v78 = val;
      v79 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v79, OS_LOG_TYPE_INFO))
      {
        v80 = HMFGetLogIdentifier();
        *buf = 138543362;
        v136 = v80;
        _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_INFO, "%{public}@Immediately processing outgoing invitation as there are no accessory operations to perform", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v77);
    }

    backingStore2 = [(HMDHome *)val backingStore];
    v82 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v83 = [backingStore2 transaction:@"kAddUserRequestKey" options:v82];

    v84 = MEMORY[0x277D0F818];
    identifier5 = [v105 identifier];
    v86 = [v84 messageWithName:@"kAddUserRequestKey" identifier:identifier5 messagePayload:0];
    [v83 add:v107 withMessage:v86];

    [v83 add:v96];
    objc_initWeak(buf, val);
    v114[0] = MEMORY[0x277D85DD0];
    v114[1] = 3221225472;
    v114[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1509;
    v114[3] = &unk_2797226A0;
    v114[4] = val;
    v115 = user;
    v87 = v65;
    v116 = v87;
    v88 = v112;
    v117 = v88;
    objc_copyWeak(&v123, buf);
    v89 = v111;
    v118 = v89;
    v119 = v105;
    v120 = addressCopy;
    v122 = aBlock;
    v50 = v93;
    v121 = v50;
    v90 = _Block_copy(v114);
    [v83 run:v90];

    objc_destroyWeak(&v123);
    objc_destroyWeak(buf);

    v54 = v94;
LABEL_48:

    v23 = v107;
    goto LABEL_49;
  }

  backingStore3 = [(HMDHome *)val backingStore];
  v46 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v106 = [backingStore3 transaction:@"kUpdateInvitationStateRequestKey" options:v46];

  v47 = [HMDOutgoingHomeInvitationModel alloc];
  identifier6 = [responseCopy identifier];
  uuid5 = [(HMDHome *)val uuid];
  v104 = [(HMDBackingStoreModelObject *)v47 initWithObjectChangeType:3 uuid:identifier6 parentUUID:uuid5];

  [v106 add:v104];
  v133[0] = MEMORY[0x277D85DD0];
  v133[1] = 3221225472;
  v133[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke;
  v133[3] = &unk_2797359D8;
  v133[4] = val;
  [v106 run:v133];
  v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Outgoing Invitation does not have a valid invitee. Cancelling the invite." reason:0 suggestion:0];
  v51 = _Block_copy(aBlock);
  v52 = v51;
  if (v51)
  {
    (*(v51 + 2))(v51, v50);
  }

LABEL_49:
  v91 = *MEMORY[0x277D85DE8];
}

void __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Finished deleting the outgoing invitation with error: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

void __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1509(uint64_t a1, void *a2)
{
  v37 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = shouldLogPrivateInformation();
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 32);
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v4)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      v10 = [*(a1 + 40) userID];
      v11 = [*(a1 + 40) displayName];
      *buf = 138544130;
      v30 = v9;
      v31 = 2112;
      v32 = v10;
      v33 = 2112;
      v34 = v11;
      v35 = 2112;
      v36 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
    }
  }

  else if (v8)
  {
    v12 = HMFGetLogIdentifier();
    *buf = 138544130;
    v30 = v12;
    v31 = 2112;
    v32 = @"...";
    v33 = 2112;
    v34 = @"...";
    v35 = 2112;
    v36 = v3;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Added user with userID: %@ and displayName: %@ with error: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v5);
  v13 = *(a1 + 48);
  v14 = [*(a1 + 32) workQueue];
  v21 = MEMORY[0x277D85DD0];
  v22 = 3221225472;
  v23 = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1510;
  v24 = &unk_279733910;
  v25 = *(a1 + 56);
  objc_copyWeak(&v28, (a1 + 104));
  v26 = *(a1 + 64);
  v27 = *(a1 + 72);
  dispatch_group_notify(v13, v14, &v21);

  WeakRetained = objc_loadWeakRetained((a1 + 104));
  v16 = WeakRetained;
  if (WeakRetained)
  {
    v17 = [WeakRetained homeManager];
    [v17 sendUserAdded:*(a1 + 40) destination:*(a1 + 80) toHome:v16];
  }

  v18 = _Block_copy(*(a1 + 96));
  v19 = v18;
  if (v18)
  {
    (*(v18 + 2))(v18, *(a1 + 88));
  }

  objc_destroyWeak(&v28);
  v20 = *MEMORY[0x277D85DE8];
}

void __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_1510(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_2;
  v3[3] = &unk_279731988;
  objc_copyWeak(&v6, (a1 + 56));
  v4 = *(a1 + 40);
  v5 = *(a1 + 48);
  [v2 run:v3];

  objc_destroyWeak(&v6);
}

uint64_t __147__HMDHome___handleAcceptedOutgoingInvitationResponse_destinationAddress_publicKey_username_issuerPublicKeyER_presenceAuthStatus_completionHandler___block_invoke_2(id *a1)
{
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v11 = WeakRetained;
    if ([a1[4] count])
    {
      v3 = [v11 backingStore];
      v4 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v5 = [v3 transaction:@"kAddUserRequestKey" options:v4];

      v6 = [HMDOutgoingHomeInvitationModel alloc];
      v7 = [a1[5] identifier];
      v8 = [v11 uuid];
      v9 = [(HMDBackingStoreModelObject *)v6 initWithObjectChangeType:2 uuid:v7 parentUUID:v8];

      [(HMDOutgoingHomeInvitationModel *)v9 setOperationIdentifiers:a1[4]];
      [v5 add:v9];
      [v5 run];
    }
  }

  return MEMORY[0x2821F96F8]();
}

- (void)_handleRemoveUserModel:(id)model message:(id)message
{
  v41 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self userWithUUID:uuid];

  if (v9)
  {
    currentUser = [(HMDHome *)self currentUser];

    if (v9 == currentUser)
    {
      v11 = objc_autoreleasePoolPush();
      selfCopy = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v14;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Attempting to remove current user", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v11);
      [(HMDHome *)selfCopy setCurrentUser:0];
    }

    [(HMDHome *)self _removeUserFromContainer:v9];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_usersPendingUserManagementOperations removeObject:v9];
    os_unfair_recursive_lock_unlock();
    [v9 setHome:0];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    if ([transactionResult source] == 1)
    {
      v16 = [HMDRemovedUser removedUserWithUser:v9];
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)self->_removedUsers addObject:v16];
      os_unfair_recursive_lock_unlock();
      v17 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        *buf = 138543618;
        v38 = v20;
        v39 = 2112;
        v40 = v16;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Sending message to removed user: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
      [v16 setRemovalInProgress:1];
      objc_initWeak(buf, selfCopy2);
      homeManager = [(HMDHome *)selfCopy2 homeManager];
      pairingUsername = [v9 pairingUsername];
      v34[0] = MEMORY[0x277D85DD0];
      v34[1] = 3221225472;
      v34[2] = __42__HMDHome__handleRemoveUserModel_message___block_invoke;
      v34[3] = &unk_279733AE8;
      objc_copyWeak(&v36, buf);
      v23 = v16;
      v35 = v23;
      [homeManager sendUserRemoved:v9 fromHome:selfCopy2 pairingUsername:pairingUsername pushToCloud:1 completionHandler:v34];

      objc_destroyWeak(&v36);
      objc_destroyWeak(buf);
    }

    else
    {
      v29 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v32;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Skipping remove user due to non-xpc backingstore transaction", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v29);
      [messageCopy respondWithPayload:0];
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      uuid2 = [modelCopy uuid];
      *buf = 138543618;
      v38 = v27;
      v39 = 2112;
      v40 = uuid2;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the user with UUID %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    transactionResult = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [messageCopy respondWithError:transactionResult];
  }

  v33 = *MEMORY[0x277D85DE8];
}

void __42__HMDHome__handleRemoveUserModel_message___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v29 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5 && [v5 code] != 2)
    {
      v20 = objc_autoreleasePoolPush();
      v21 = WeakRetained;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        v23 = HMFGetLogIdentifier();
        v25 = 138543618;
        v26 = v23;
        v27 = 2112;
        v28 = v5;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Unable to remove user: %@", &v25, 0x16u);
      }

      objc_autoreleasePoolPop(v20);
    }

    else
    {
      if ([v5 code] == 2)
      {
        v8 = objc_autoreleasePoolPush();
        v9 = WeakRetained;
        v10 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = HMFGetLogIdentifier();
          v25 = 138543618;
          v26 = v11;
          v27 = 2112;
          v28 = v5;
          _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Treating user removed message error as success: %@", &v25, 0x16u);
        }

        objc_autoreleasePoolPop(v8);
      }

      v12 = objc_autoreleasePoolPush();
      v13 = WeakRetained;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = HMFGetLogIdentifier();
        v16 = *(a1 + 32);
        v25 = 138543618;
        v26 = v15;
        v27 = 2112;
        v28 = v16;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Successfully sent removed user message for user: %@", &v25, 0x16u);
      }

      objc_autoreleasePoolPop(v12);
      os_unfair_recursive_lock_lock_with_options();
      [v13[5] removeObject:*(a1 + 32)];
      os_unfair_recursive_lock_unlock();
    }

    [*(a1 + 32) setRemovalInProgress:0];
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v25 = 138543362;
      v26 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Lost reference to home during user removal", &v25, 0xCu);
    }

    objc_autoreleasePoolPop(v17);
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddUserModel:(id)model message:(id)message
{
  v99 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self userWithUUID:uuid];

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [modelCopy debugString:1];
    *buf = 138543618;
    v94 = v13;
    v95 = 2112;
    v96 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Adding HMDUserModel: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (!v9)
  {
    v85 = selfCopy;
    homeManager = [(HMDHome *)selfCopy homeManager];
    v21 = modelCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = v21;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    if (v23)
    {
      v9 = [[HMDResidentUser alloc] initWithModelObject:v23];
    }

    else
    {
      v9 = [[HMDUser alloc] initWithModelObject:v21];
      [(HMDResidentUser *)v9 refreshDisplayName];
      userID = [(HMDResidentUser *)v9 userID];

      if (!userID)
      {
        v68 = homeManager;
        v69 = messageCopy;
        if (shouldLogPrivateInformation())
        {
          userID2 = [v21 userID];
        }

        else
        {
          userID2 = @"...";
          v75 = @"...";
        }

        v76 = objc_autoreleasePoolPush();
        v77 = v85;
        v78 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v78, OS_LOG_TYPE_ERROR))
        {
          v79 = HMFGetLogIdentifier();
          *buf = 138543618;
          v94 = v79;
          v95 = 2112;
          v96 = userID2;
          _os_log_impl(&dword_2531F8000, v78, OS_LOG_TYPE_ERROR, "%{public}@User created from model no longer has userID, model userID invalid %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v76);
        messageCopy = v69;
        homeManager = v68;
        v47 = 0;
LABEL_54:

        goto LABEL_55;
      }
    }

    if (v9)
    {
      v81 = v23;
      v82 = modelCopy;
      v83 = messageCopy;
      [(HMDResidentUser *)v9 configureWithHome:v85];
      [(HMDHome *)v85 _addUserToContainer:v9];
      [(HMDHome *)v85 _cleanRemovedUsers:v9];
      v84 = homeManager;
      [homeManager reprocessUserManagementModels];
      v88 = 0u;
      v89 = 0u;
      v86 = 0u;
      v87 = 0u;
      outgoingInvitations = [(HMDHome *)v85 outgoingInvitations];
      v26 = [outgoingInvitations countByEnumeratingWithState:&v86 objects:v92 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v87;
        while (2)
        {
          for (i = 0; i != v27; ++i)
          {
            if (*v87 != v28)
            {
              objc_enumerationMutation(outgoingInvitations);
            }

            v30 = *(*(&v86 + 1) + 8 * i);
            user = [v30 user];
            pairingIdentity = [user pairingIdentity];
            pairingIdentity2 = [(HMDUser *)v9 pairingIdentity];
            v34 = [pairingIdentity isEqual:pairingIdentity2];

            if (v34)
            {
              [v30 setUser:v9];
              goto LABEL_24;
            }
          }

          v27 = [outgoingInvitations countByEnumeratingWithState:&v86 objects:v92 count:16];
          if (v27)
          {
            continue;
          }

          break;
        }
      }

LABEL_24:

      [(HMDHome *)v85 _addUserToIdentityRegistry:v9];
      v9 = v9;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v35 = v9;
      }

      else
      {
        v35 = 0;
      }

      userID2 = v35;

      if (userID2)
      {
        [(HMDHome *)v85 _updateConfigurationStateForResidentDevice:userID2 desiredConfigState:2 message:0];
        v37 = objc_autoreleasePoolPush();
        v38 = v85;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
        {
          v40 = HMFGetLogIdentifier();
          userID3 = [(HMDResidentUser *)v9 userID];
          *buf = 138543618;
          v94 = v40;
          v95 = 2112;
          v96 = userID3;
          _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Removing resident user %@ from unassociated list", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v37);
        v36UserID = [(__CFString *)userID2 userID];
        [v84 removeFromUnassociatedPeers:v36UserID home:v38];

        v43 = objc_autoreleasePoolPush();
        v44 = v38;
        v45 = HMFGetOSLogHandle();
        modelCopy = v82;
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
        {
          v46 = HMFGetLogIdentifier();
          *buf = 138543362;
          v94 = v46;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_DEBUG, "%{public}@Add resident device", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v43);
        v47 = v81;
      }

      else
      {
        if ([(HMDUser *)v9 isCurrentUser])
        {
          v49 = objc_autoreleasePoolPush();
          v50 = v85;
          v51 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
          {
            v52 = HMFGetLogIdentifier();
            currentUser = [(HMDHome *)v50 currentUser];
            *buf = 138543874;
            v94 = v52;
            v95 = 2112;
            v96 = currentUser;
            v97 = 2112;
            v98 = v9;
            _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@Newly added user is current user, updating _currentUser from %@ to %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v49);
          presenceAuthStatus = [(HMDHome *)v50 presenceAuthStatus];
          [(HMDUser *)v9 setPresenceAuthStatus:presenceAuthStatus];

          [(HMDHome *)v50 setCurrentUser:v9];
        }

        v90[0] = @"kUserUUIDKey";
        uuid2 = [(HMDUser *)v9 uuid];
        uUIDString = [uuid2 UUIDString];
        v91[0] = uUIDString;
        v90[1] = @"kUserIDKey";
        userID4 = [(HMDResidentUser *)v9 userID];
        v91[1] = userID4;
        v90[2] = @"kUserDisplayNameKey";
        displayName = [(HMDResidentUser *)v9 displayName];
        v91[2] = displayName;
        v59 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v91 forKeys:v90 count:3];

        v60 = [v59 mutableCopy];
        userID5 = [(HMDResidentUser *)v9 userID];
        [v60 setObject:userID5 forKeyedSubscript:@"kUserIDKey"];

        identifier = [v83 identifier];
        v47 = v81;
        modelCopy = v82;
        if (identifier)
        {
          [v83 identifier];
        }

        else
        {
          [MEMORY[0x277CCAD78] UUID];
        }
        v70 = ;

        v71 = [MEMORY[0x277D0F818] entitledMessageWithName:@"kUserAddedNotificationKey" identifier:v70 messagePayload:v60];
        msgDispatcher = [(HMDHome *)v85 msgDispatcher];
        uuid3 = [(HMDHome *)v85 uuid];
        [msgDispatcher sendMessage:v71 target:uuid3];
      }

      messageCopy = v83;
      transactionResult = [v83 transactionResult];
      [transactionResult markChanged];

      homeManager = v84;
    }

    else
    {
      v48 = v23;
      if (shouldLogPrivateInformation())
      {
        userID2 = [v21 userID];
      }

      else
      {
        userID2 = @"...";
        v63 = @"...";
      }

      v64 = objc_autoreleasePoolPush();
      v65 = v85;
      v66 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
      {
        v67 = HMFGetLogIdentifier();
        *buf = 138543618;
        v94 = v67;
        v95 = 2112;
        v96 = userID2;
        _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_ERROR, "%{public}@Failed to create new user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v64);
      v9 = 0;
      v47 = v48;
    }

    goto LABEL_54;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = selfCopy;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
  {
    v18 = HMFGetLogIdentifier();
    uuid4 = [modelCopy uuid];
    *buf = 138543874;
    v94 = v18;
    v95 = 2112;
    v96 = uuid4;
    v97 = 2112;
    v98 = v9;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@HMDUserModel %@ passed as add for existing user %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  [(HMDResidentUser *)v9 transactionObjectUpdated:0 newValues:modelCopy message:messageCopy];
LABEL_55:

  v80 = *MEMORY[0x277D85DE8];
}

- (void)_updateOutgoingInvitationsWithCompleteUserManagementOperation:(id)operation
{
  v30 = *MEMORY[0x277D85DE8];
  operationCopy = operation;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v6 = [outgoingInvitations countByEnumeratingWithState:&v25 objects:v29 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v26;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v26 != v8)
        {
          objc_enumerationMutation(outgoingInvitations);
        }

        v10 = *(*(&v25 + 1) + 8 * i);
        operations = [v10 operations];
        if ([operations containsObject:operationCopy])
        {
          isComplete = [v10 isComplete];

          if (isComplete)
          {
            backingStore = [(HMDHome *)self backingStore];
            v18 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
            v19 = [backingStore transaction:@"kUpdateInvitationStateRequestKey" options:v18];

            v20 = [HMDOutgoingHomeInvitationModel alloc];
            identifier = [v10 identifier];
            uuid = [(HMDHome *)self uuid];
            v23 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:3 uuid:identifier parentUUID:uuid];

            [v19 add:v23];
            [v19 run];

            goto LABEL_13;
          }
        }

        else
        {
        }
      }

      v7 = [outgoingInvitations countByEnumeratingWithState:&v25 objects:v29 count:16];
    }

    while (v7);
  }

  homeManager = [(HMDHome *)self homeManager];
  backingStore2 = [homeManager backingStore];
  v15 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  outgoingInvitations = [backingStore2 transaction:@"kUserManagementOperationRemovedKey" options:v15];

  v16 = [operationCopy modelObjectWithChangeType:3];
  [outgoingInvitations add:v16];

  [outgoingInvitations run];
LABEL_13:

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateRequestForHomeInvitation:(id)invitation controllerPublicKey:(id)key controllerUsername:(id)username invitationState:(int64_t)state presenceAuthStatus:(id)status preferredUserID:(id)d fromHandle:(id)handle fromAddress:(id)self0 issuerPublicKeyER:(id)self1 message:(id)self2 messageResponseHandler:(id)self3
{
  v144 = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  keyCopy = key;
  usernameCopy = username;
  statusCopy = status;
  dCopy = d;
  handleCopy = handle;
  addressCopy = address;
  rCopy = r;
  messageCopy = message;
  handlerCopy = handler;
  v104 = invitationCopy;
  v97 = dCopy;
  v98 = keyCopy;
  if ([invitationCopy isExpired])
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      identifier = [v104 identifier];
      *buf = 138543618;
      v139 = v23;
      v140 = 2112;
      stateCopy = identifier;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already expired, invitee cannot accept or decline", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v25 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1006 userInfo:0];
    if (handlerCopy)
    {
      handlerCopy[2](handlerCopy, v25, 0);
    }

LABEL_43:

LABEL_74:
    v62 = handlerCopy;
    goto LABEL_75;
  }

  if ([invitationCopy responseReceived])
  {
    v26 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v28 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      v29 = HMFGetLogIdentifier();
      identifier2 = [v104 identifier];
      isDeclined = [v104 isDeclined];
      v32 = @"accepted";
      *buf = 138543874;
      v139 = v29;
      v140 = 2112;
      if (isDeclined)
      {
        v32 = @"declined";
      }

      stateCopy = identifier2;
      v142 = 2112;
      v143 = v32;
      _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Invitation (%@) has already been %@, invitee cannot accept or decline", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v26);
    v33 = MEMORY[0x277CCA9B8];
    if ([v104 isDeclined])
    {
      v34 = 1008;
    }

    else
    {
      v34 = 1007;
    }

    v25 = [v33 errorWithDomain:*MEMORY[0x277CCFD28] code:v34 userInfo:0];
    if (handlerCopy)
    {
      handlerCopy[2](handlerCopy, v25, 0);
    }

    goto LABEL_43;
  }

  if ((state - 3) > 1)
  {
    v55 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v57 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
    {
      v58 = HMFGetLogIdentifier();
      *buf = 138543618;
      v139 = v58;
      v140 = 2048;
      stateCopy = state;
      _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_INFO, "%{public}@Failed to update invite state since the value %ld was incorrect", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v55);
    v25 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    if (handlerCopy)
    {
      handlerCopy[2](handlerCopy, v25, 0);
    }

    goto LABEL_43;
  }

  if (state != 3)
  {
    if (shouldLogPrivateInformation())
    {
      user = [invitationCopy user];
      userID = [user userID];
    }

    else
    {
      userID = @"...";
      v63 = @"...";
    }

    v64 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v66 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
    {
      v67 = HMFGetLogIdentifier();
      *buf = 138543618;
      v139 = v67;
      v140 = 2112;
      stateCopy = userID;
      _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@User %@ declined invite", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v64);
    name = [messageCopy name];
    v69 = name;
    v70 = @"UpdateOutgoingInvitationToAccept";
    if (name)
    {
      v70 = name;
    }

    v71 = v70;

    backingStore = [(HMDHome *)selfCopy4 backingStore];
    v73 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v74 = [backingStore transaction:v71 options:v73];

    v75 = [invitationCopy emptyModelObjectWithChangeType:2];
    v76 = [MEMORY[0x277CCABB0] numberWithInteger:state];
    [v75 setInvitationState:v76];

    if (messageCopy)
    {
      [v74 add:v75 withMessage:?];
    }

    else
    {
      [v74 add:v75];
    }

    [v74 run];

    goto LABEL_74;
  }

  if (keyCopy && usernameCopy)
  {
    if (dCopy)
    {
      v35 = +[HMDAccountHandleFormatter defaultFormatter];
      dCopy = [v35 accountHandleFromString:dCopy];
    }

    v110[0] = MEMORY[0x277D85DD0];
    v110[1] = 3221225472;
    v111 = __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke;
    v112 = &unk_279722678;
    v121 = handlerCopy;
    v113 = handleCopy;
    selfCopy5 = self;
    v115 = invitationCopy;
    v116 = dCopy;
    v117 = keyCopy;
    v118 = usernameCopy;
    v119 = addressCopy;
    v120 = statusCopy;
    vala = self;
    v36 = v115;
    v91 = v113;
    v94 = v116;
    v92 = v110;
    user2 = [v36 user];
    accountHandle = [user2 accountHandle];

    if (!accountHandle)
    {
      v77 = objc_autoreleasePoolPush();
      v78 = vala;
      v79 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v79, OS_LOG_TYPE_ERROR))
      {
        v80 = HMFGetLogIdentifier();
        *buf = 138543362;
        v139 = v80;
        _os_log_impl(&dword_2531F8000, v79, OS_LOG_TYPE_ERROR, "%{public}@Invalid invitee destination", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v77);
      v108 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      v111(v92, v108);
      goto LABEL_73;
    }

    v38 = +[HMDAccountRegistry sharedRegistry];
    v108 = [v38 accountForHandle:v91];

    v90 = [MEMORY[0x277CBEB58] setWithCapacity:2];
    if ([v108 isAuthenticated])
    {
      handles = [v108 handles];
      v40 = [handles containsObject:accountHandle];

      if ((v40 & 1) == 0)
      {
        v41 = objc_autoreleasePoolPush();
        v42 = vala;
        v43 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
        {
          v44 = HMFGetLogIdentifier();
          *buf = 138543618;
          v139 = v44;
          v140 = 2112;
          stateCopy = accountHandle;
          _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Authenticating the invitation handle: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v41);
        [v90 addObject:accountHandle];
      }

      if (v94)
      {
        handles2 = [v108 handles];
        v46 = [handles2 containsObject:v94];

        if ((v46 & 1) == 0)
        {
          v47 = objc_autoreleasePoolPush();
          v48 = vala;
          v49 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
          {
            v50 = HMFGetLogIdentifier();
            *buf = 138543618;
            v139 = v50;
            v140 = 2112;
            stateCopy = v94;
            _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Authenticating the preferred account handle: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v47);
          [v90 addObject:v94];
        }
      }

      if (![v90 hmf_isEmpty])
      {
        v136[0] = 0;
        v136[1] = v136;
        v136[2] = 0x3032000000;
        v136[3] = __Block_byref_object_copy__10664;
        v136[4] = __Block_byref_object_dispose__10665;
        v137 = 0;
        v82 = dispatch_group_create();
        v132 = 0u;
        v133 = 0u;
        v134 = 0u;
        v135 = 0u;
        obj = v90;
        v83 = [obj countByEnumeratingWithState:&v132 objects:buf count:16];
        if (v83)
        {
          v84 = *v133;
          do
          {
            for (i = 0; i != v83; ++i)
            {
              if (*v133 != v84)
              {
                objc_enumerationMutation(obj);
              }

              v86 = *(*(&v132 + 1) + 8 * i);
              dispatch_group_enter(v82);
              objc_initWeak(location, vala);
              v87 = +[HMDAccountRegistry sharedRegistry];
              v126[0] = MEMORY[0x277D85DD0];
              v126[1] = 3221225472;
              v126[2] = ____authenticateAcceptedOutgoingInvitation_block_invoke;
              v126[3] = &unk_279722F10;
              objc_copyWeak(&v131, location);
              v127 = v82;
              v128 = v86;
              v130 = v136;
              v129 = v108;
              [v87 _resolveAccountForHandle:v86 completionHandler:v126];

              objc_destroyWeak(&v131);
              objc_destroyWeak(location);
            }

            v83 = [obj countByEnumeratingWithState:&v132 objects:buf count:16];
          }

          while (v83);
        }

        workQueue = [(HMDHome *)vala workQueue];
        location[0] = MEMORY[0x277D85DD0];
        location[1] = 3221225472;
        location[2] = ____authenticateAcceptedOutgoingInvitation_block_invoke_4364;
        location[3] = &unk_279731DC8;
        v125 = v136;
        v123 = vala;
        v124 = v92;
        dispatch_group_notify(v82, workQueue, location);

        _Block_object_dispose(v136, 8);
        goto LABEL_72;
      }

      v51 = objc_autoreleasePoolPush();
      v52 = vala;
      v53 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_DEFAULT))
      {
        v54 = HMFGetLogIdentifier();
        *buf = 138543362;
        v139 = v54;
        _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_DEFAULT, "%{public}@Authenticated invitation without resolving", buf, 0xCu);
      }
    }

    else
    {
      v51 = objc_autoreleasePoolPush();
      v52 = vala;
      v53 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
      {
        v81 = HMFGetLogIdentifier();
        *buf = 138543362;
        v139 = v81;
        _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_INFO, "%{public}@Accepting invitation from unauthenticated user", buf, 0xCu);
      }
    }

    objc_autoreleasePoolPop(v51);
    v111(v92, 0);
LABEL_72:

LABEL_73:
    goto LABEL_74;
  }

  v61 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
  v62 = handlerCopy;
  if (handlerCopy)
  {
    handlerCopy[2](handlerCopy, v61, 0);
  }

LABEL_75:
  v89 = *MEMORY[0x277D85DE8];
}

void __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke(uint64_t a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (!v3)
  {
    v5 = +[HMDAccountRegistry sharedRegistry];
    v6 = [v5 accountForHandle:*(a1 + 32)];

    if ([v6 isAuthenticated])
    {
      v7 = objc_autoreleasePoolPush();
      v8 = *(a1 + 40);
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543362;
        v38 = v10;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Received authenticated invitation response", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v11 = [*(a1 + 48) user];
      v12 = [v6 identifier];
      [v11 setAccountIdentifier:v12];
    }

    if (*(a1 + 56))
    {
      v13 = [*(a1 + 48) user];
      v14 = [HMDUser userIDForAccountHandle:*(a1 + 56)];
      [v13 setUserID:v14];
    }

    v33 = [objc_alloc(MEMORY[0x277D0F8B0]) initWithPairingKeyData:*(a1 + 64)];
    v15 = [objc_alloc(MEMORY[0x277CFEC20]) initWithIdentifier:*(a1 + 72) publicKey:v33 privateKey:0 permissions:0];
    v16 = [*(a1 + 40) homeManager];
    v17 = [*(a1 + 48) user];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = v17;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    v34 = v6;
    v31 = v16;
    v32 = v15;
    if (v19)
    {
      v20 = [v19 device];
      if (v20)
      {
        v21 = [v16 identityRegistry];
        v22 = [*(a1 + 48) user];
        [v21 registerIdentity:v15 device:v20 object:v22];

LABEL_18:
      }
    }

    else
    {
      v23 = [*(a1 + 48) user];
      v20 = [v23 account];

      if (v20)
      {
        v21 = [v16 identityRegistry];
        [v21 registerIdentity:v15 account:v20 object:*(a1 + 48)];
        goto LABEL_18;
      }
    }

    v24 = *(a1 + 40);
    v25 = *(a1 + 48);
    v27 = *(a1 + 64);
    v26 = *(a1 + 72);
    v29 = *(a1 + 80);
    v28 = *(a1 + 88);
    v35[0] = MEMORY[0x277D85DD0];
    v35[1] = 3221225472;
    v35[2] = __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1491;
    v35[3] = &unk_279735558;
    v36 = *(a1 + 96);
    [v24 __handleAcceptedOutgoingInvitationResponse:v25 destinationAddress:v29 publicKey:v27 username:v26 issuerPublicKeyER:0 presenceAuthStatus:v28 completionHandler:v35];

    goto LABEL_20;
  }

  v4 = *(a1 + 96);
  if (v4)
  {
    (*(v4 + 16))(v4, v3, 0);
  }

LABEL_20:

  v30 = *MEMORY[0x277D85DE8];
}

uint64_t __211__HMDHome__handleUpdateRequestForHomeInvitation_controllerPublicKey_controllerUsername_invitationState_presenceAuthStatus_preferredUserID_fromHandle_fromAddress_issuerPublicKeyER_message_messageResponseHandler___block_invoke_1491(uint64_t a1, uint64_t a2)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, a2, 0);
  }

  return result;
}

- (void)_handleUpdateRequestForHomeInvitationFromInvitee:(id)invitee
{
  v40 = *MEMORY[0x277D85DE8];
  inviteeCopy = invitee;
  v5 = [inviteeCopy uuidForKey:@"kInvitationIdentifierKey"];
  v35 = [inviteeCopy dataForKey:@"kControllerPublicKey"];
  v6 = [inviteeCopy stringForKey:@"kControllerPairingNameKey"];
  v7 = [inviteeCopy numberForKey:@"kInvitationStateKey"];
  v8 = [MEMORY[0x277CD1F00] authWithMessage:inviteeCopy];
  v9 = [inviteeCopy stringForKey:@"kUserIDKey"];
  remoteSourceID = [inviteeCopy remoteSourceID];
  v11 = [HMDAccountHandle accountHandleForDestination:remoteSourceID];
  if (v7)
  {
    v34 = v6;
    integerValue = [v7 integerValue];
    outgoingInvitations = [(HMDHome *)self outgoingInvitations];
    v33 = v5;
    v14 = [outgoingInvitations hmf_firstObjectWithValue:v5 forKeyPath:@"identifier"];

    if (v14)
    {
      responseHandler = [inviteeCopy responseHandler];
      selfCopy = self;
      v17 = v35;
      [(HMDHome *)selfCopy _handleUpdateRequestForHomeInvitation:v14 controllerPublicKey:v35 controllerUsername:v34 invitationState:integerValue presenceAuthStatus:v8 preferredUserID:v9 fromHandle:v11 fromAddress:remoteSourceID issuerPublicKeyER:0 message:inviteeCopy messageResponseHandler:responseHandler];
    }

    else
    {
      v21 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v23 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v24 = v31 = v8;
        identifier = [0 identifier];
        [identifier UUIDString];
        v25 = v32 = v21;
        *buf = 138543618;
        v37 = v24;
        v38 = 2112;
        v39 = v25;
        _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Invalid invite identifier %@ specified from remote user", buf, 0x16u);

        v21 = v32;
        v8 = v31;
      }

      objc_autoreleasePoolPop(v21);
      v26 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      responseHandler2 = [inviteeCopy responseHandler];

      if (responseHandler2)
      {
        responseHandler3 = [inviteeCopy responseHandler];
        (responseHandler3)[2](responseHandler3, v26, 0);
      }

      v17 = v35;
    }

    v5 = v33;
    v6 = v34;
  }

  else
  {
    v18 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    responseHandler4 = [inviteeCopy responseHandler];

    if (responseHandler4)
    {
      responseHandler5 = [inviteeCopy responseHandler];
      (responseHandler5)[2](responseHandler5, v18, 0);
    }

    v17 = v35;
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateOutgoingInvitationState:(id)state
{
  v43 = *MEMORY[0x277D85DE8];
  stateCopy = state;
  v5 = [stateCopy uuidForKey:@"kInvitationIdentifierKey"];
  v6 = [stateCopy numberForKey:@"kInvitationStateKey"];
  v7 = v6;
  if (!v5 || !v6)
  {
    v22 = objc_autoreleasePoolPush();
    selfCopy = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543362;
      v38 = v25;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Unable to accept the invitation as could not find the invite", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v22);
    v9 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    responseHandler = [stateCopy responseHandler];
    (responseHandler)[2](responseHandler, v9, 0);
    goto LABEL_17;
  }

  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v9 = [outgoingInvitations hmf_firstObjectWithValue:v5 forKeyPath:@"identifier"];

  if (v9)
  {
    if ([v7 integerValue] == 1)
    {
      v10 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v13 = HMFGetLogIdentifier();
        identifier = [v9 identifier];
        uUIDString = [identifier UUIDString];
        [MEMORY[0x277CD1A88] homeInvitationStateDescription:1];
        v16 = v36 = v10;
        *buf = 138543874;
        v38 = v13;
        v39 = 2112;
        v40 = uUIDString;
        v41 = 2112;
        v42 = v16;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@[Home] Processing request to update invitation %@ to state %@", buf, 0x20u);

        v10 = v36;
      }

      objc_autoreleasePoolPop(v10);
      if (([v9 invitationState] & 0xFFFFFFFFFFFFFFFDLL) != 4)
      {
        [(HMDHome *)selfCopy2 _sendInvitationCancelationRequestToInvitee:v9];
      }

      backingStore = [(HMDHome *)selfCopy2 backingStore];
      name = [stateCopy name];
      v19 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v20 = [backingStore transaction:name options:v19];

      v21 = [v9 emptyModelObjectWithChangeType:3];
      [v20 add:v21 withMessage:stateCopy];

      [v20 run];
      goto LABEL_18;
    }

    responseHandler = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:43 userInfo:0];
    responseHandler2 = [stateCopy responseHandler];
    responseHandler2[2](responseHandler2, responseHandler, 0);

LABEL_17:
    goto LABEL_18;
  }

  v27 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
  {
    v30 = HMFGetLogIdentifier();
    uUIDString2 = [v5 UUIDString];
    *buf = 138543618;
    v38 = v30;
    v39 = 2112;
    v40 = uUIDString2;
    _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Invalid invite identifier specified %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v27);
  v32 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  responseHandler3 = [stateCopy responseHandler];
  (responseHandler3)[2](responseHandler3, v32, 0);

  v9 = 0;
LABEL_18:

  v35 = *MEMORY[0x277D85DE8];
}

- (BOOL)doesThisHomeHaveCameras
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_1481];

  return v3;
}

uint64_t __34__HMDHome_doesThisHomeHaveCameras__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 hasCameraStreamService];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_sendInvitation:(id)invitation message:(id)message shareURL:(id)l shareToken:(id)token suppressHomeInviteNotification:(BOOL)notification logEventBuilder:(id)builder
{
  notificationCopy = notification;
  v100[2] = *MEMORY[0x277D85DE8];
  invitationCopy = invitation;
  messageCopy = message;
  lCopy = l;
  tokenCopy = token;
  builderCopy = builder;
  val = invitationCopy;
  user = [invitationCopy user];
  accountHandle = [user accountHandle];

  identifier = [invitationCopy identifier];
  endDate = [invitationCopy endDate];
  objc_initWeak(&location, self);
  expirationHandler = [invitationCopy expirationHandler];
  v23 = expirationHandler == 0;

  if (v23)
  {
    workQueue = [(HMDHome *)self workQueue];
    [invitationCopy setClientQueue:workQueue];

    objc_initWeak(from, invitationCopy);
    v82[0] = MEMORY[0x277D85DD0];
    v82[1] = 3221225472;
    v82[2] = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke;
    v82[3] = &unk_279733938;
    objc_copyWeak(&v84, &location);
    objc_copyWeak(&v85, from);
    v83 = messageCopy;
    [invitationCopy setExpirationHandler:v82];

    objc_destroyWeak(&v85);
    objc_destroyWeak(&v84);
    objc_destroyWeak(from);
  }

  [builderCopy markSendInviteBegin];
  user2 = [invitationCopy user];
  v75[0] = MEMORY[0x277D85DD0];
  v75[1] = 3221225472;
  v76 = __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1478;
  v77 = &unk_27972F820;
  objc_copyWeak(&v81, &location);
  v78 = accountHandle;
  v64 = builderCopy;
  v79 = v64;
  v63 = messageCopy;
  v80 = v63;
  v26 = v78;
  v71 = identifier;
  v72 = endDate;
  v67 = lCopy;
  v68 = tokenCopy;
  v73 = user2;
  v69 = v75;
  if (self)
  {
    v27 = objc_autoreleasePoolPush();
    selfCopy = self;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
    {
      v30 = HMFGetLogIdentifier();
      *from = 138543874;
      *&from[4] = v30;
      *&from[12] = 2112;
      *&from[14] = v26;
      *&from[22] = 2112;
      v94 = v73;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_INFO, "%{public}@Sending invite to: %@ for user: %@", from, 0x20u);
    }

    objc_autoreleasePoolPop(v27);
    homeManager = [(HMDHome *)selfCopy homeManager];
    appleAccountManager = [homeManager appleAccountManager];
    account = [appleAccountManager account];
    handles = [account handles];
    v34 = [handles containsObject:v26];

    if (v34)
    {
      v35 = objc_autoreleasePoolPush();
      v36 = selfCopy;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT))
      {
        v38 = HMFGetLogIdentifier();
        *from = 138543618;
        *&from[4] = v38;
        *&from[12] = 2112;
        *&from[14] = v26;
        _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_DEFAULT, "%{public}@Attempt to add local user: %@", from, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      v66 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v76(v69, v66);
    }

    else
    {
      keychainStore = [(HMDHome *)selfCopy keychainStore];
      v91 = 0;
      v65 = [keychainStore getLocalPairingIdentity:&v91];
      v66 = v91;

      if (v65)
      {
        v99[0] = @"kHomedVersionKey";
        v40 = homedVersion;
        v99[1] = @"kHomedSupportedFeaturesKey";
        v100[0] = v40;
        v100[1] = &unk_286626C50;
        v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v100 forKeys:v99 count:2];

        v92[0] = *MEMORY[0x277CD23D0];
        name = [(HMDHome *)selfCopy name];
        *from = name;
        v92[1] = *MEMORY[0x277CD0640];
        uuid = [(HMDHome *)selfCopy uuid];
        uUIDString = [uuid UUIDString];
        *&from[8] = uUIDString;
        *&from[16] = v72;
        v92[2] = @"kInvitationExpiryDateKey";
        v92[3] = @"kControllerPublicKey";
        publicKey = [v65 publicKey];
        data = [publicKey data];
        v94 = data;
        v92[4] = @"kControllerPairingNameKey";
        identifier2 = [v65 identifier];
        v95 = identifier2;
        v92[5] = @"kInvitationIdentifierKey";
        uUIDString2 = [v71 UUIDString];
        v96 = uUIDString2;
        v97 = v60;
        v92[6] = @"kRequestedCapabilitiesKey";
        v92[7] = @"HMDHomeSuppressInviteNotificationKey";
        v47 = [MEMORY[0x277CCABB0] numberWithBool:notificationCopy];
        v98 = v47;
        v48 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:from forKeys:v92 count:8];

        v49 = [HMDRemoteAccountMessageDestination alloc];
        v50 = objc_alloc(MEMORY[0x277CCAD78]);
        v51 = [v50 initWithUUIDString:*MEMORY[0x277CD23C8]];
        v52 = [(HMDRemoteAccountMessageDestination *)v49 initWithTarget:v51 handle:v26 multicast:1];

        v53 = [MEMORY[0x277D0F848] messageWithName:@"kAccessHomeInviteRequestKey" destination:v52 payload:v48];
        objc_initWeak(&v90, selfCopy);
        v87[0] = MEMORY[0x277D85DD0];
        v87[1] = 3221225472;
        v87[2] = __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke;
        v87[3] = &unk_279735248;
        v87[4] = selfCopy;
        v88 = v26;
        objc_copyWeak(&v89, &v90);
        [v53 setResponseHandler:v87];
        v54 = +[HMDSecureRemoteMessageTransport defaultTransport];
        [v54 sendMessage:v53 completionHandler:v69];

        objc_destroyWeak(&v89);
        objc_destroyWeak(&v90);
      }

      else
      {
        v55 = objc_autoreleasePoolPush();
        v56 = selfCopy;
        v57 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
        {
          v58 = HMFGetLogIdentifier();
          *from = 138543362;
          *&from[4] = v58;
          _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_ERROR, "%{public}@Failed to get local identity", from, 0xCu);
        }

        objc_autoreleasePoolPop(v55);
        v76(v69, v66);
      }
    }
  }

  objc_destroyWeak(&v81);
  objc_destroyWeak(&location);

  v59 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

void __102__HMDHome__sendInvitation_message_shareURL_shareToken_suppressHomeInviteNotification_logEventBuilder___block_invoke_1478(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = objc_autoreleasePoolPush();
  v6 = WeakRetained;
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v3)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 32);
      v18 = 138543874;
      v19 = v9;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invite to user, %@, with error: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v11 = *(a1 + 40);
    v12 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:3503 underlyingError:v3];
    [v11 markError:v12];
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Successfully sent invite to user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 40) markSendInviteEnd];
  }

  v15 = [*(a1 + 48) responseHandler];

  if (v15)
  {
    v16 = [*(a1 + 48) responseHandler];
    (v16)[2](v16, v3, 0);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __148__HMDHome__sendInviteToUserWithHandle_inviteIdentifier_expiryDate_shareURL_shareToken_suppressHomeInviteNotification_invitedUser_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = *(a1 + 40);
    v25 = 138543618;
    v26 = v10;
    v27 = 2112;
    v28 = v11;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Attempting to send home invitation: %@", &v25, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v5 && [v5 code] != 8)
  {
    v13 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = HMFGetLogIdentifier();
      v23 = *(a1 + 40);
      v25 = 138543874;
      v26 = v16;
      v27 = 2112;
      v28 = v23;
      v29 = 2112;
      v30 = v5;
      v18 = "%{public}@Failed to send invitation request to user, %@, due to error: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_DEFAULT;
      v21 = 32;
      goto LABEL_9;
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = WeakRetained;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      v17 = *(a1 + 40);
      v25 = 138543618;
      v26 = v16;
      v27 = 2112;
      v28 = v17;
      v18 = "%{public}@Successfully sent invitation to: %@";
      v19 = v15;
      v20 = OS_LOG_TYPE_INFO;
      v21 = 22;
LABEL_9:
      _os_log_impl(&dword_2531F8000, v19, v20, v18, &v25, v21);
    }
  }

  objc_autoreleasePoolPop(v13);
  v24 = *MEMORY[0x277D85DE8];
}

- (void)_addOutgoingInvitations:(id)invitations message:(id)message transactionCompleted:(id)completed
{
  v33 = *MEMORY[0x277D85DE8];
  invitationsCopy = invitations;
  messageCopy = message;
  completedCopy = completed;
  backingStore = [(HMDHome *)self backingStore];
  name = [messageCopy name];
  v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v14 = [backingStore transaction:name options:v13];

  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v15 = invitationsCopy;
  v16 = [v15 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v29;
    do
    {
      for (i = 0; i != v17; ++i)
      {
        if (*v29 != v18)
        {
          objc_enumerationMutation(v15);
        }

        v20 = *(*(&v28 + 1) + 8 * i);
        [v20 setHome:self];
        v21 = [v20 modelObjectWithChangeType:1 version:4];
        [v14 add:v21 withMessage:messageCopy];
      }

      v17 = [v15 countByEnumeratingWithState:&v28 objects:v32 count:16];
    }

    while (v17);
  }

  v25[0] = MEMORY[0x277D85DD0];
  v25[1] = 3221225472;
  v25[2] = __64__HMDHome__addOutgoingInvitations_message_transactionCompleted___block_invoke;
  v25[3] = &unk_279733F30;
  v26 = messageCopy;
  v27 = completedCopy;
  v22 = messageCopy;
  v23 = completedCopy;
  [v14 run:v25];

  v24 = *MEMORY[0x277D85DE8];
}

uint64_t __64__HMDHome__addOutgoingInvitations_message_transactionCompleted___block_invoke(uint64_t a1)
{
  v2 = _Block_copy(*(a1 + 40));
  v3 = v2;
  if (v2)
  {
    (*(v2 + 2))(v2);
  }

  v4 = *(a1 + 32);

  return [v4 respondWithPayload:0];
}

- (id)_outgoingInvitationForUserWithHandle:(id)handle
{
  v20 = *MEMORY[0x277D85DE8];
  handleCopy = handle;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v6 = [outgoingInvitations countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(outgoingInvitations);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        user = [v9 user];
        accountHandle = [user accountHandle];
        v12 = [accountHandle isEqual:handleCopy];

        if (v12)
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [outgoingInvitations countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_processOutgoingInvitationsRequest:(id)request
{
  v41[2] = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = [requestCopy dataForKey:@"HM.invitations"];
  if (v5)
  {
    v6 = MEMORY[0x277CCAAC8];
    v7 = MEMORY[0x277CBEB98];
    v41[0] = objc_opt_class();
    v41[1] = objc_opt_class();
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v41 count:2];
    v9 = [v7 setWithArray:v8];
    v34 = 0;
    v10 = [v6 unarchivedObjectOfClasses:v9 fromData:v5 error:&v34];
    v11 = v34;

    if (v10)
    {
      v30[0] = MEMORY[0x277D85DD0];
      v30[1] = 3221225472;
      v30[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke;
      v30[3] = &unk_279734960;
      v31 = requestCopy;
      selfCopy = self;
      v33 = v10;
      v12 = _Block_copy(v30);
      v12[2](v12, v13, v14, v15);

      v16 = v31;
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        identifier = [requestCopy identifier];
        uUIDString = [identifier UUIDString];
        *buf = 138543874;
        v36 = v26;
        v37 = 2112;
        v38 = uUIDString;
        v39 = 2112;
        v40 = v11;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive outgoing home invitations from serialized outgoing home invitation data: %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v23);
      v16 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      [requestCopy respondWithError:v16];
    }
  }

  else
  {
    v17 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v19 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = HMFGetLogIdentifier();
      identifier2 = [requestCopy identifier];
      uUIDString2 = [identifier2 UUIDString];
      *buf = 138543618;
      v36 = v20;
      v37 = 2112;
      v38 = uUIDString2;
      _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Unable to find outgoing invitations to add for message: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v17);
    v11 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [requestCopy respondWithError:v11];
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke(id *a1)
{
  v2 = [a1[4] BOOLForKey:@"HMDHomeSuppressInviteNotificationKey"];
  objc_initWeak(&location, a1[5]);
  v4 = a1[5];
  v3 = a1[6];
  v5 = a1[4];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2;
  v6[3] = &unk_27972F5B0;
  objc_copyWeak(&v8, &location);
  v7 = a1[6];
  v9 = v2;
  [v4 _addOutgoingInvitations:v3 message:v5 transactionCompleted:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __46__HMDHome__processOutgoingInvitationsRequest___block_invoke_3;
  block[3] = &unk_279734938;
  block[4] = WeakRetained;
  v5 = *(a1 + 32);
  v6 = *(a1 + 48);
  dispatch_async(v3, block);
}

- (void)setOverriddenHomeAccessControl:(id)control
{
  controlCopy = control;
  os_unfair_recursive_lock_lock_with_options();
  overriddenHomeAccessControl = self->_overriddenHomeAccessControl;
  self->_overriddenHomeAccessControl = controlCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSNumber)overriddenHomeAccessControl
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_overriddenHomeAccessControl;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)handleCurrentUserPrivilegeChanged:(id)changed
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __45__HMDHome_handleCurrentUserPrivilegeChanged___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  if (isFeatureMatterLocalFabricConfigEnabled())
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 32) currentUser];
      v7 = [v6 privilege];
      if (v7 > 4)
      {
        v8 = @"None";
      }

      else
      {
        v8 = off_279730DF8[v7];
      }

      v9 = v8;
      v10 = [*(a1 + 32) fabric];
      v11 = [v10 accessControl];
      [v11 currentUserPrivilege];
      v12 = HMMTRUserPrivilegeAsString();
      v19 = 138543874;
      v20 = v5;
      v21 = 2112;
      v22 = v9;
      v23 = 2112;
      v24 = v12;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Updating Fabric user privilege to %@ from priv %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    v13 = [*(a1 + 32) currentUser];
    v14 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v13 privilege]);
    v15 = [*(a1 + 32) fabric];
    v16 = [v15 accessControl];
    [v16 setCurrentUserPrivilege:v14];
  }

  result = [*(a1 + 32) _evaluateNetworkProtectionAndRouterManagement];
  v18 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)removeRemovedUser:(id)user
{
  userCopy = user;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_removedUsers removeObject:userCopy];
  os_unfair_recursive_lock_unlock();
}

- (BOOL)containsRemovedUser:(id)user
{
  v16 = *MEMORY[0x277D85DE8];
  userCopy = user;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  removedUsers = [(HMDHome *)self removedUsers];
  v6 = [removedUsers countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v6)
  {
    v7 = *v12;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(removedUsers);
        }

        if ([*(*(&v11 + 1) + 8 * i) isEqualToUser:userCopy])
        {
          LOBYTE(v6) = 1;
          goto LABEL_11;
        }
      }

      v6 = [removedUsers countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v6;
}

- (void)_refreshUserDisplayNames
{
  v49 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB58] set];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  selfCopy = self;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v5 = [outgoingInvitations countByEnumeratingWithState:&v39 objects:v48 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v40;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v40 != v7)
        {
          objc_enumerationMutation(outgoingInvitations);
        }

        v9 = *(*(&v39 + 1) + 8 * i);
        if ([v9 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v10 = MEMORY[0x277CCACA8];
            uuid = [v9 uuid];
            v12 = [v10 stringWithFormat:@"OutgoingInviteDisplayNameUpdate_%@", uuid];
            [v3 addObject:v12];
          }

          else
          {
            [v3 addObject:@"OutgoingInviteDisplayNameUpdate"];
          }
        }
      }

      v6 = [outgoingInvitations countByEnumeratingWithState:&v39 objects:v48 count:16];
    }

    while (v6);
  }

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  users = [(HMDHome *)selfCopy users];
  v14 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v36;
    do
    {
      for (j = 0; j != v15; ++j)
      {
        if (*v36 != v16)
        {
          objc_enumerationMutation(users);
        }

        v18 = *(*(&v35 + 1) + 8 * j);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20 && [v18 refreshDisplayName])
        {
          if (isInternalBuild())
          {
            v21 = MEMORY[0x277CCACA8];
            uuid2 = [v18 uuid];
            v23 = [v21 stringWithFormat:@"UserDisplayNameUpdate_%@", uuid2];
            [v3 addObject:v23];
          }

          else
          {
            [v3 addObject:@"UserDisplayNameUpdate"];
          }
        }
      }

      v15 = [users countByEnumeratingWithState:&v35 objects:v47 count:16];
    }

    while (v15);
  }

  if ([v3 count])
  {
    v24 = objc_autoreleasePoolPush();
    v25 = selfCopy;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      v27 = HMFGetLogIdentifier();
      allObjects = [v3 allObjects];
      v29 = [allObjects componentsJoinedByString:{@", "}];
      *buf = 138543618;
      v44 = v27;
      v45 = 2112;
      v46 = v29;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@User display names updated: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    [(HMDHome *)v25 saveToCurrentAccountWithReason:@"userDisplayNameUpdated"];
    home = [(HMDHome *)v25 home];
    homeManager = [home homeManager];
    uuid3 = [(HMDHome *)v25 uuid];
    [homeManager updateGenerationCounterWithReason:@"userDisplayNameUpdated" sourceUUID:uuid3 shouldNotifyClients:1];
  }

  v33 = *MEMORY[0x277D85DE8];
}

- (void)refreshUserDisplayNames
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_refreshUserDisplayNames__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)_addUserToContainer:(id)container
{
  v11[1] = *MEMORY[0x277D85DE8];
  containerCopy = container;
  [(HMDHome *)self addUser:containerCopy];
  presenceMonitor = [(HMDHome *)self presenceMonitor];
  [presenceMonitor addNewUser:containerCopy];

  notificationCenter = [(HMDHome *)self notificationCenter];
  v10 = @"HMDUserNotificationKey";
  v11[0] = containerCopy;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:&v10 count:1];

  [notificationCenter postNotificationName:@"HMDHomeUserAddedNotification" object:self userInfo:v7];
  if ([(HMDHome *)self isOwnerUser])
  {
    homeManager = [(HMDHome *)self homeManager];
    [homeManager setLastUserAddRemoveTimestamp];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_removeUserFromContainer:(id)container
{
  v11[1] = *MEMORY[0x277D85DE8];
  containerCopy = container;
  presenceMonitor = [(HMDHome *)self presenceMonitor];
  [presenceMonitor removeUser:containerCopy];

  [containerCopy removeCloudData];
  [(HMDHome *)self _removeUser:containerCopy];
  [containerCopy unconfigure];
  notificationCenter = [(HMDHome *)self notificationCenter];
  v10 = @"HMDUserNotificationKey";
  v11[0] = containerCopy;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:&v10 count:1];

  [notificationCenter postNotificationName:@"HMDHomeUserRemovedNotification" object:self userInfo:v7];
  if ([(HMDHome *)self isOwnerUser])
  {
    homeManager = [(HMDHome *)self homeManager];
    [homeManager setLastUserAddRemoveTimestamp];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_removeUser:(id)user message:(id)message
{
  v87 = *MEMORY[0x277D85DE8];
  userCopy = user;
  messageCopy = message;
  if (shouldLogPrivateInformation())
  {
    userID = [userCopy userID];
  }

  else
  {
    userID = @"...";
    v7 = @"...";
  }

  pairingIdentity = [userCopy pairingIdentity];

  if (pairingIdentity)
  {
    homeManager = [(HMDHome *)self homeManager];
    if (isFeatureMatterLocalFabricConfigEnabled() && (![userCopy privilege] || objc_msgSend(userCopy, "privilege") == 4))
    {
      v75[0] = MEMORY[0x277D85DD0];
      v75[1] = 3221225472;
      v75[2] = __31__HMDHome__removeUser_message___block_invoke;
      v75[3] = &unk_279731240;
      v75[4] = self;
      [(HMDHome *)self incrementOperatePrivilegeCATVersion:v75];
    }

    backingStore = [homeManager backingStore];
    v11 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v55 = [backingStore transaction:@"kUserManagementOperationAddedKey" options:v11];

    accessories = [(HMDHome *)self accessories];
    v74 = 0;
    v13 = [(HMDHome *)self prepareUserManagementOperationForUser:userCopy accessories:accessories type:2 error:&v74];
    v14 = v74;

    v52 = v13;
    v53 = v14;
    if (v14)
    {
      v15 = objc_autoreleasePoolPush();
      selfCopy = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v18 = HMFGetLogIdentifier();
        v19 = objc_opt_class();
        v62 = v19;
        [(HMDHome *)selfCopy name];
        v21 = v20 = homeManager;
        *buf = 138544386;
        v78 = v18;
        v79 = 2112;
        v80 = v19;
        v81 = 2112;
        v82 = v21;
        v83 = 2112;
        v84 = userID;
        v85 = 2112;
        v86 = v53;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@[%@ %@] Failed to prepare remove operations for user '%@' with error: %@", buf, 0x34u);

        homeManager = v20;
      }

      objc_autoreleasePoolPop(v15);
      responseHandler = [messageCopy responseHandler];
      v23 = v53;
      (responseHandler)[2](responseHandler, v53, 0);
      responseHandler2 = v55;
    }

    else
    {
      v50 = messageCopy;
      v51 = userCopy;
      owner = [(HMDHome *)self owner];
      responseHandler = [owner pairingIdentity];

      group = dispatch_group_create();
      v70 = 0u;
      v71 = 0u;
      v72 = 0u;
      v73 = 0u;
      obj = v13;
      responseHandler2 = v55;
      selfCopy3 = self;
      v61 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
      if (v61)
      {
        v58 = *v71;
        v59 = responseHandler;
        do
        {
          for (i = 0; i != v61; ++i)
          {
            if (*v71 != v58)
            {
              objc_enumerationMutation(obj);
            }

            v32 = *(*(&v70 + 1) + 8 * i);
            if (shouldLogPrivateInformation())
            {
              user = [v32 user];
              userID2 = [user userID];
            }

            else
            {
              v34 = @"...";
              userID2 = @"...";
            }

            v35 = objc_autoreleasePoolPush();
            v36 = selfCopy3;
            v37 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
            {
              v38 = HMFGetLogIdentifier();
              [v32 identifier];
              v40 = v39 = homeManager;
              accessory = [v32 accessory];
              shortDescription = [accessory shortDescription];
              *buf = 138544130;
              v78 = v38;
              v79 = 2112;
              v80 = v40;
              v81 = 2112;
              v82 = userID2;
              v83 = 2112;
              v84 = shortDescription;
              _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Adding operation '%@' to manager tracking remove user '%@' from accessory '%@'", buf, 0x2Au);

              selfCopy3 = self;
              homeManager = v39;
              responseHandler2 = v55;
            }

            objc_autoreleasePoolPop(v35);
            dispatch_group_enter(group);
            accessory2 = [v32 accessory];
            identifier = [accessory2 identifier];
            user2 = [v32 user];
            pairingIdentity2 = [user2 pairingIdentity];
            v68[0] = MEMORY[0x277D85DD0];
            v68[1] = 3221225472;
            v68[2] = __31__HMDHome__removeUser_message___block_invoke_1460;
            v68[3] = &unk_2797359D8;
            v69 = group;
            [homeManager cleanupOperationsForAccessory:identifier user:pairingIdentity2 completion:v68];

            responseHandler = v59;
            [v32 setOwnerPairingIdentity:v59];
            v47 = [v32 modelObjectWithChangeType:1];
            [responseHandler2 add:v47];
          }

          v61 = [obj countByEnumeratingWithState:&v70 objects:v76 count:16];
        }

        while (v61);
      }

      workQueue = [(HMDHome *)selfCopy3 workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __31__HMDHome__removeUser_message___block_invoke_2;
      block[3] = &unk_279734870;
      block[4] = selfCopy3;
      v65 = responseHandler2;
      userCopy = v51;
      v66 = v51;
      messageCopy = v50;
      v67 = v50;
      dispatch_group_notify(group, workQueue, block);

      v23 = 0;
    }

    goto LABEL_31;
  }

  v25 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
  {
    v28 = HMFGetLogIdentifier();
    *buf = 138543618;
    v78 = v28;
    v79 = 2112;
    v80 = userID;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve user with name: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v25);
  if (messageCopy)
  {
    homeManager = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    responseHandler2 = [messageCopy responseHandler];
    (responseHandler2)[2](responseHandler2, homeManager, 0);
LABEL_31:
  }

  v49 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_2(uint64_t a1)
{
  objc_initWeak(&location, *(a1 + 32));
  v2 = *(a1 + 40);
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __31__HMDHome__removeUser_message___block_invoke_3;
  v3[3] = &unk_279731988;
  objc_copyWeak(&v6, &location);
  v4 = *(a1 + 48);
  v5 = *(a1 + 56);
  [v2 run:v3];

  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __31__HMDHome__removeUser_message___block_invoke_3(id *a1, void *a2)
{
  v39 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v27 = v3;
    v6 = [WeakRetained backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [v6 transaction:@"kRemoveUserRequestKey" options:v7];

    v9 = [v5 __modelObjectsForRemovingOutgoingInvitationForUser:a1[4]];
    [v8 addObjects:v9];

    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    v10 = [v5 triggers];
    v11 = [v10 countByEnumeratingWithState:&v30 objects:v34 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v31;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v31 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v30 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v16 = v15;
          }

          else
          {
            v16 = 0;
          }

          v17 = v16;

          [v17 handleRemovalOfUser:a1[4] transaction:v8];
        }

        v12 = [v10 countByEnumeratingWithState:&v30 objects:v34 count:16];
      }

      while (v12);
    }

    v18 = [HMDUserModel alloc];
    v19 = [a1[4] uuid];
    v20 = [v5 uuid];
    v21 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:3 uuid:v19 parentUUID:v20];

    [v8 add:v21];
    v28[0] = MEMORY[0x277D85DD0];
    v28[1] = 3221225472;
    v28[2] = __31__HMDHome__removeUser_message___block_invoke_1462;
    v28[3] = &unk_2797358C8;
    v28[4] = v5;
    v29 = a1[5];
    [v8 run:v28];

    v3 = v27;
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v25 = a1[4];
      *buf = 138543618;
      v36 = v24;
      v37 = 2112;
      v38 = v25;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Home disappeared, cannot remove user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
  }

  v26 = *MEMORY[0x277D85DE8];
}

void __31__HMDHome__removeUser_message___block_invoke_1462(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeUser transaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  [*(a1 + 40) respondWithPayload:0 error:v3];

  v8 = *MEMORY[0x277D85DE8];
}

- (id)__modelObjectsForRemovingOutgoingInvitationForUser:(id)user
{
  v30 = *MEMORY[0x277D85DE8];
  userCopy = user;
  if (userCopy)
  {
    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    outgoingInvitations = [(HMDHome *)self outgoingInvitations];
    v6 = [outgoingInvitations countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v6)
    {
      v7 = v6;
      selfCopy = self;
      v8 = *v26;
LABEL_4:
      v9 = 0;
      while (1)
      {
        if (*v26 != v8)
        {
          objc_enumerationMutation(outgoingInvitations);
        }

        v10 = *(*(&v25 + 1) + 8 * v9);
        user = [v10 user];
        if (user)
        {
          userID = [userCopy userID];
          userID2 = [user userID];
          v14 = [userID isEqualToString:userID2];

          if (v14)
          {
            break;
          }
        }

        if (v7 == ++v9)
        {
          v7 = [outgoingInvitations countByEnumeratingWithState:&v25 objects:v29 count:16];
          if (v7)
          {
            goto LABEL_4;
          }

          goto LABEL_11;
        }
      }

      v16 = v10;

      if (!v16)
      {
        goto LABEL_15;
      }

      v17 = [MEMORY[0x277CBEB18] arrayWithCapacity:2];
      v18 = [HMDOutgoingHomeInvitationModel alloc];
      identifier = [v16 identifier];
      uuid = [(HMDHome *)selfCopy uuid];
      v21 = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:3 uuid:identifier parentUUID:uuid];

      [v17 addObject:v21];
      v15 = [v17 copy];

      outgoingInvitations = v16;
    }

    else
    {
LABEL_11:
      v15 = MEMORY[0x277CBEBF8];
    }
  }

  else
  {
LABEL_15:
    v15 = MEMORY[0x277CBEBF8];
  }

  v22 = *MEMORY[0x277D85DE8];

  return v15;
}

- (void)_removeOutgoingInvitationForUser:(id)user
{
  userCopy = user;
  v5 = [(HMDHome *)self __modelObjectsForRemovingOutgoingInvitationForUser:userCopy];
  if (([v5 hmf_isEmpty] & 1) == 0)
  {
    backingStore = [(HMDHome *)self backingStore];
    v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v8 = [backingStore transaction:@"removeOutgoingInvitation" options:v7];

    [v8 addObjects:v5];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __44__HMDHome__removeOutgoingInvitationForUser___block_invoke;
    v9[3] = &unk_279734D88;
    v9[4] = self;
    v10 = userCopy;
    v11 = v5;
    [v8 run:v9];
  }
}

void __44__HMDHome__removeOutgoingInvitationForUser___block_invoke(uint64_t a1, void *a2)
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 40);
      v9 = *(a1 + 48);
      v11 = 138544130;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      v15 = 2112;
      v16 = v9;
      v17 = 2112;
      v18 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to run transaction to remove the invitation for the user: %@ / %@ / %@", &v11, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)removeUser:(id)user
{
  v16 = *MEMORY[0x277D85DE8];
  userCopy = user;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v13 = v8;
    v14 = 2112;
    v15 = userCopy;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to remove user: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __22__HMDHome_removeUser___block_invoke;
  v11[3] = &unk_279734E00;
  v11[4] = selfCopy;
  v9 = [MEMORY[0x277D0F818] messageWithName:@"kDataSyncResponseNAckKey" messagePayload:0 responseHandler:v11];
  [(HMDHome *)selfCopy _removeUser:userCopy message:v9];

  v10 = *MEMORY[0x277D85DE8];
}

void __22__HMDHome_removeUser___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v10;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Failed to remove user due to %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)removeUserWithUserID:(id)d
{
  dCopy = d;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __32__HMDHome_removeUserWithUserID___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = dCopy;
  v6 = dCopy;
  dispatch_async(workQueue, v7);
}

void __32__HMDHome_removeUserWithUserID___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) users];
  v4 = [v2 hmf_firstObjectWithValue:*(a1 + 40) forKeyPath:@"userID"];

  v3 = v4;
  if (v4)
  {
    [*(a1 + 32) removeUser:v4];
    v3 = v4;
  }
}

- (void)_handleRemoveUser:(id)user
{
  v33 = *MEMORY[0x277D85DE8];
  userCopy = user;
  if ([userCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(userCopy, "isRemote"))
  {
    v5 = [userCopy uuidForKey:@"kUserUUIDKey"];
    if (!v5)
    {
      v18 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
      responseHandler = [userCopy responseHandler];
      (responseHandler)[2](responseHandler, v18, 0);

      v6 = 0;
LABEL_20:

      goto LABEL_21;
    }

    v6 = v5;
    users = [(HMDHome *)self users];
    responseHandler4 = [users hmf_firstObjectWithUUID:v6];

    if (responseHandler4)
    {
      isOwner = [responseHandler4 isOwner];
      v10 = objc_autoreleasePoolPush();
      selfCopy = self;
      v12 = HMFGetOSLogHandle();
      v13 = v12;
      if (!isOwner)
      {
        if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
        {
          v27 = HMFGetLogIdentifier();
          v29 = 138543618;
          v30 = v27;
          v31 = 2112;
          v32 = responseHandler4;
          _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Removing user: %@", &v29, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        [(HMDHome *)selfCopy _removeUser:responseHandler4 message:userCopy];
        goto LABEL_19;
      }

      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v14 = HMFGetLogIdentifier();
        v29 = 138543362;
        v30 = v14;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Owner cannot be removed from home", &v29, 0xCu);
      }

      objc_autoreleasePoolPop(v10);
      v15 = MEMORY[0x277CCA9B8];
      v16 = *MEMORY[0x277CCFD28];
      v17 = 17;
    }

    else
    {
      v15 = MEMORY[0x277CCA9B8];
      v16 = *MEMORY[0x277CCFD28];
      v17 = 2;
    }

    v25 = [v15 errorWithDomain:v16 code:v17 userInfo:0];
    responseHandler2 = [userCopy responseHandler];
    (responseHandler2)[2](responseHandler2, v25, 0);

LABEL_19:
    goto LABEL_20;
  }

  v20 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    v29 = 138543362;
    v30 = v23;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@User management (remove) not supported for non-SPI clients", &v29, 0xCu);
  }

  objc_autoreleasePoolPop(v20);
  responseHandler3 = [userCopy responseHandler];

  if (responseHandler3)
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    responseHandler4 = [userCopy responseHandler];
    (responseHandler4)[2](responseHandler4, v6, 0);
    goto LABEL_19;
  }

LABEL_21:

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdatePresenceConsent:(id)consent
{
  v40 = *MEMORY[0x277D85DE8];
  consentCopy = consent;
  v5 = [MEMORY[0x277CD1F00] authWithMessage:consentCopy];
  if (!v5)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Received nil presence auth", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    responseHandler = [consentCopy responseHandler];
    v17 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
    goto LABEL_15;
  }

  presenceAuthStatus = [(HMDHome *)self presenceAuthStatus];
  v7 = HMFEqualObjects();

  if (v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v11;
      v38 = 2112;
      v39 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Presence auth status is already set to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
LABEL_14:
    responseHandler = [consentCopy responseHandler];
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_15:
    v26 = v17;
    (*&responseHandler->super._bsoDataVersionOverride)(responseHandler, v17, 0);
    goto LABEL_16;
  }

  if (([v5 value] - 1) < 2)
  {
    v18 = [HMDHomeModel alloc];
    uuid = [(HMDHome *)self uuid];
    homeManager = [(HMDHome *)self homeManager];
    uuid2 = [homeManager uuid];
    responseHandler = [(HMDBackingStoreModelObject *)v18 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

    number = [v5 number];
    [(HMDHomeModel *)responseHandler setPresenceAuthorizationStatus:number];

    backingStore = [(HMDHome *)self backingStore];
    name = [consentCopy name];
    v25 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v26 = [backingStore transaction:name options:v25];

    [v26 add:responseHandler];
    v33[0] = MEMORY[0x277D85DD0];
    v33[1] = 3221225472;
    v33[2] = __40__HMDHome__handleUpdatePresenceConsent___block_invoke;
    v33[3] = &unk_2797358C8;
    v34 = consentCopy;
    selfCopy3 = self;
    [v26 run:v33];

LABEL_16:
    goto LABEL_17;
  }

  v27 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v29 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
  {
    v30 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v30;
    v38 = 2112;
    v39 = v5;
    _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Received invalid parameter for presence authorization: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v27);
  responseHandler2 = [consentCopy responseHandler];

  if (responseHandler2)
  {
    goto LABEL_14;
  }

LABEL_17:

  v32 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__handleUpdatePresenceConsent___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v8 = [MEMORY[0x277CBEB38] dictionary];
    v4 = [*(a1 + 40) currentUser];
    v5 = [v4 presenceAuthStatus];
    [v5 addToPayload:v8];

    v6 = *(a1 + 32);
    v7 = [v8 copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_handleUpdateUserAnnounceAccess:(id)access
{
  v35 = *MEMORY[0x277D85DE8];
  accessCopy = access;
  if ([accessCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(accessCopy, "isRemote"))
  {
    responseHandler2 = [accessCopy stringForKey:@"kUserIDKey"];
    users = [(HMDHome *)self users];
    v7 = [users hmf_firstObjectWithValue:responseHandler2 forKeyPath:@"userID"];

    if (v7)
    {
      currentUser = [(HMDHome *)self currentUser];
      if ([currentUser isAdministrator])
      {
        v9 = [v7 newModelWithChangeType:2];
        v10 = [accessCopy numberForKey:*MEMORY[0x277CD06A0]];
        if (v10)
        {
          [v9 setAnnounceAccessAllowed:v10];
          if ([v10 BOOLValue])
          {
            v11 = &unk_286627850;
          }

          else
          {
            v11 = &unk_286627868;
          }

          [v9 setAnnounceAccessLevel:v11];
        }

        backingStore = [(HMDHome *)self backingStore];
        name = [accessCopy name];
        v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v15 = [backingStore transaction:name options:v14];

        [v15 add:v9 withMessage:accessCopy];
        [v15 run];

        goto LABEL_21;
      }

      v25 = objc_autoreleasePoolPush();
      selfCopy = self;
      v27 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
      {
        v28 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v28;
        v33 = 2112;
        v34 = currentUser;
        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v25);
      responseHandler = [accessCopy responseHandler];
      v29 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (responseHandler)[2](responseHandler, v29, 0);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        v31 = 138543618;
        v32 = v19;
        v33 = 2112;
        v34 = responseHandler2;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", &v31, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      currentUser = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      responseHandler = [accessCopy responseHandler];
      (responseHandler)[2](responseHandler, currentUser, 0);
    }

LABEL_21:
    goto LABEL_22;
  }

  v21 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    v31 = 138543362;
    v32 = v24;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", &v31, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  responseHandler2 = [accessCopy responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (responseHandler2)[2](responseHandler2, v7, 0);
LABEL_22:

  v30 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateUserAccess:(id)access
{
  v62 = *MEMORY[0x277D85DE8];
  accessCopy = access;
  if ([accessCopy isEntitledForSPIAccess] & 1) != 0 || (objc_msgSend(accessCopy, "isRemote"))
  {
    responseHandler3 = [accessCopy stringForKey:@"kUserIDKey"];
    users = [(HMDHome *)self users];
    v7 = [users hmf_firstObjectWithValue:responseHandler3 forKeyPath:@"userID"];

    if (!v7)
    {
      v15 = objc_autoreleasePoolPush();
      selfCopy = self;
      v17 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v18;
        v58 = 2112;
        v59 = responseHandler3;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 2;
      goto LABEL_11;
    }

    if ([v7 isOwner])
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v11;
        v58 = 2112;
        v59 = responseHandler3;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify the owner of the home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = MEMORY[0x277CCA9B8];
      v13 = *MEMORY[0x277CCFD28];
      v14 = 17;
LABEL_11:
      currentUser = [v12 errorWithDomain:v13 code:v14 userInfo:0];
      responseHandler = [accessCopy responseHandler];
      (responseHandler)[2](responseHandler, currentUser, 0);
LABEL_42:

      goto LABEL_43;
    }

    currentUser = [(HMDHome *)self currentUser];
    if (([currentUser isAdministrator] & 1) == 0)
    {
      v34 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v37;
        v58 = 2112;
        v59 = currentUser;
        _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Current user is not an administrator, cannot modify access: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v34);
      responseHandler = [accessCopy responseHandler];
      v26 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
      (responseHandler)[2](responseHandler, v26, 0);
      goto LABEL_41;
    }

    responseHandler = [v7 newModelWithChangeType:2];
    v25 = [accessCopy numberForKey:@"kUserAdministratorInformationKey"];
    v26 = v25;
    if (!v25)
    {
      goto LABEL_25;
    }

    bOOLValue = [v25 BOOLValue];
    if (bOOLValue && ![(HMDHome *)self isResidentSupported])
    {
      v38 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
      {
        v41 = HMFGetLogIdentifier();
        *buf = 138543618;
        v57 = v41;
        v58 = 2112;
        v59 = responseHandler3;
        _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_INFO, "%{public}@Cannot update user %@ to administrator because it requires a resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 48;
    }

    else
    {
      if (![v7 privilege] || objc_msgSend(v7, "privilege") == 4)
      {
        if (bOOLValue)
        {
          v28 = &unk_286627838;
        }

        else
        {
          v28 = &unk_286627808;
        }

        [responseHandler setPrivilege:v28];
        [v7 privilege];
LABEL_25:
        v51 = v26;
        v29 = [accessCopy numberForKey:@"kUserRemoteAccessInformationKey"];
        if (v29)
        {
          [responseHandler setRemoteAccessAllowed:v29];
        }

        backingStore = [(HMDHome *)self backingStore];
        name = [accessCopy name];
        v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        responseHandler2 = [backingStore transaction:name options:v32];

        [responseHandler2 add:responseHandler];
        v53[0] = MEMORY[0x277D85DD0];
        v53[1] = 3221225472;
        v53[2] = __35__HMDHome__handleUpdateUserAccess___block_invoke;
        v53[3] = &unk_2797358C8;
        v54 = accessCopy;
        v55 = v7;
        [responseHandler2 run:v53];

        v26 = v51;
        goto LABEL_40;
      }

      v45 = objc_autoreleasePoolPush();
      selfCopy5 = self;
      v47 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v48 = v52 = v45;
        v49 = @"non-";
        *buf = 138543874;
        v57 = v48;
        v58 = 2112;
        if (bOOLValue)
        {
          v49 = &stru_286509E58;
        }

        v59 = responseHandler3;
        v60 = 2112;
        v61 = v49;
        _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_INFO, "%{public}@Failed to update user %@ to %@administrator", buf, 0x20u);

        v45 = v52;
      }

      objc_autoreleasePoolPop(v45);
      v42 = MEMORY[0x277CCA9B8];
      v43 = *MEMORY[0x277CCFD28];
      v44 = 10;
    }

    v29 = [v42 errorWithDomain:v43 code:v44 userInfo:0];
    responseHandler2 = [accessCopy responseHandler];
    (responseHandler2)[2](responseHandler2, v29, 0);
LABEL_40:

LABEL_41:
    goto LABEL_42;
  }

  v21 = objc_autoreleasePoolPush();
  selfCopy6 = self;
  v23 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
  {
    v24 = HMFGetLogIdentifier();
    *buf = 138543362;
    v57 = v24;
    _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to update users to home", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v21);
  responseHandler3 = [accessCopy responseHandler];
  v7 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:17 userInfo:0];
  (responseHandler3)[2](responseHandler3, v7, 0);
LABEL_43:

  v50 = *MEMORY[0x277D85DE8];
}

void __35__HMDHome__handleUpdateUserAccess___block_invoke(uint64_t a1, uint64_t a2)
{
  v12[4] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v11[0] = @"kUserAdministratorInformationKey";
    v5 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAdministrator")}];
    v12[0] = v5;
    v11[1] = @"kUserRemoteAccessInformationKey";
    v6 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isRemoteAccessAllowed")}];
    v12[1] = v6;
    v11[2] = @"kUserCamerasAccessLevelInformationKey";
    v7 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 40), "camerasAccessLevel")}];
    v12[2] = v7;
    v11[3] = *MEMORY[0x277CD06A0];
    v8 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(*(a1 + 40), "isAnnounceAccessAllowed")}];
    v12[3] = v8;
    v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:4];

    [*(a1 + 32) respondWithPayload:v9];
    v10 = *MEMORY[0x277D85DE8];
  }
}

- (void)_handleUpdateUserCamerasAccessLevel:(id)level
{
  v53 = *MEMORY[0x277D85DE8];
  levelCopy = level;
  v5 = [levelCopy stringForKey:@"kUserIDKey"];
  users = [(HMDHome *)self users];
  v7 = [users hmf_firstObjectWithValue:v5 forKeyPath:@"userID"];

  if (!v7)
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543618;
      v48 = v17;
      v49 = 2112;
      v50 = v5;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Failed to find user %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v12 = MEMORY[0x277CCA9B8];
    v13 = 2;
    goto LABEL_9;
  }

  if (![v7 isOwner])
  {
    v18 = [v7 newModelWithChangeType:2];
    v19 = [levelCopy numberForKey:@"kUserCamerasAccessLevelInformationKey"];
    v20 = v19;
    if (v19)
    {
      integerValue = [v19 integerValue];
      if (HMUserIsValidCameraAccessLevel())
      {
        camerasAccessLevel = [v7 camerasAccessLevel];
        v23 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v25 = HMFGetOSLogHandle();
        v26 = v25;
        if (camerasAccessLevel != integerValue)
        {
          if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
          {
            v39 = HMFGetLogIdentifier();
            v40 = HMUserCameraAccessLevelAsString();
            *buf = 138543874;
            v48 = v39;
            v49 = 2112;
            v50 = v40;
            v51 = 2112;
            v52 = v7;
            _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Updating cameras access level to %@ for user: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v23);
          [v18 setCamerasAccessLevel:v20];
          backingStore = [(HMDHome *)selfCopy2 backingStore];
          name = [levelCopy name];
          v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v37 = [backingStore transaction:name options:v43];

          [v37 add:v18];
          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke;
          v44[3] = &unk_2797358C8;
          v45 = levelCopy;
          v46 = v20;
          [v37 run:v44];

          goto LABEL_24;
        }

        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v27 = HMFGetLogIdentifier();
          v28 = HMUserCameraAccessLevelAsString();
          *buf = 138543618;
          v48 = v27;
          v49 = 2112;
          v50 = v28;
          _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Cameras access level: %@ already set", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
        v29 = MEMORY[0x277CCA9B8];
        v30 = 1;
LABEL_23:
        v37 = [v29 hmErrorWithCode:v30];
        [levelCopy respondWithError:v37];
LABEL_24:

        goto LABEL_25;
      }

      v31 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v36;
        v49 = 2048;
        v50 = integerValue;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Invalid cameras access level value: %ld", buf, 0x16u);
      }
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = HMFGetLogIdentifier();
        *buf = 138543618;
        v48 = v34;
        v49 = 2112;
        v50 = @"kUserCamerasAccessLevelInformationKey";
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Missing value for key: %@", buf, 0x16u);
      }
    }

    objc_autoreleasePoolPop(v31);
    v29 = MEMORY[0x277CCA9B8];
    v30 = 3;
    goto LABEL_23;
  }

  v8 = objc_autoreleasePoolPush();
  selfCopy5 = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543618;
    v48 = v11;
    v49 = 2112;
    v50 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot modify cameras access level for owner of the home: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v8);
  v12 = MEMORY[0x277CCA9B8];
  v13 = 48;
LABEL_9:
  v18 = [v12 hmErrorWithCode:v13];
  [levelCopy respondWithError:v18];
LABEL_25:

  v38 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleUpdateUserCamerasAccessLevel___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  if (a2)
  {
    v3 = *(a1 + 32);
    v4 = *MEMORY[0x277D85DE8];

    [v3 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = @"kUserCamerasAccessLevelInformationKey";
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [*(a1 + 32) respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (void)_addUsersWithInviteInformations:(id)informations message:(id)message
{
  v54 = *MEMORY[0x277D85DE8];
  informationsCopy = informations;
  messageCopy = message;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  v49 = 0u;
  v50 = 0u;
  v48 = 0u;
  v47 = 0u;
  obj = informationsCopy;
  v8 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
  if (v8)
  {
    v9 = *v48;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v48 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v47 + 1) + 8 * i);
        v12 = [objc_opt_class() privilegeFromUserInviteInformation:v11];
        v13 = +[HMDAccountHandleFormatter defaultFormatter];
        userID = [v11 userID];
        v15 = [v13 accountHandleFromString:userID];

        v16 = [[HMDUser alloc] initWithAccountHandle:v15 home:self pairingIdentity:0 privilege:v12];
        [(HMDUser *)v16 refreshDisplayName];
        -[HMDUser setRemoteAccessAllowed:](v16, "setRemoteAccessAllowed:", [v11 isRemoteAccessAllowed]);
        -[HMDUser setCamerasAccessLevel:](v16, "setCamerasAccessLevel:", [v11 camerasAccessLevel]);
        if ([v11 isAnnounceAccessAllowed])
        {
          v17 = 2;
        }

        else
        {
          v17 = 1;
        }

        [(HMDUser *)v16 setAnnounceAccessLevel:v17];
        v18 = [[HMDOutgoingHomeInvitation alloc] initWithInvitee:v16 invitationState:2 forHome:self expiryDate:0 messageIdentifier:0];
        [array addObject:v18];
        invitationData = [(HMDHomeInvitation *)v18 invitationData];
        [array2 addObject:invitationData];
      }

      v8 = [obj countByEnumeratingWithState:&v47 objects:v53 count:16];
    }

    while (v8);
  }

  v20 = _os_feature_enabled_impl();
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke;
  aBlock[3] = &unk_27972F5B0;
  objc_copyWeak(&v44, &location);
  v21 = array;
  v43 = v21;
  v45 = v20;
  v22 = _Block_copy(aBlock);
  [(HMDHome *)self _addOutgoingInvitations:v21 message:messageCopy transactionCompleted:0];
  administratorHandler = [(HMDHome *)self administratorHandler];
  if ([administratorHandler shouldRelayMessages])
  {
    v34 = encodeRootObject();
    v51[0] = @"HM.invitations";
    v51[1] = @"HMDHomeSuppressInviteNotificationKey";
    v52[0] = v34;
    v24 = [MEMORY[0x277CCABB0] numberWithBool:v20];
    v52[1] = v24;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v52 forKeys:v51 count:2];

    v26 = MEMORY[0x277D0F848];
    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2;
    v39[3] = &unk_279733AE8;
    objc_copyWeak(&v41, &location);
    v40 = v21;
    v27 = [v26 messageWithName:@"kAddHomeInvitesInternalRequestKey" messagePayload:v25 responseHandler:v39];
    v28 = objc_alloc(MEMORY[0x277D0F820]);
    uuid = [(HMDHome *)self uuid];
    v30 = [v28 initWithTarget:uuid];

    [v27 setDestination:v30];
    [v27 setQualityOfService:33];
    v38 = 0;
    v31 = [administratorHandler operationForMessage:v27 error:&v38];
    v32 = v38;
    if (v31)
    {
      [administratorHandler addOperation:v31];
    }

    objc_destroyWeak(&v41);
  }

  else
  {
    v22[2](v22);
  }

  objc_destroyWeak(&v44);
  objc_destroyWeak(&location);

  v33 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained __sendOutgoingInvitations:*(a1 + 32) suppressHomeInviteNotification:*(a1 + 48)];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = @"kAddHomeInvitesInternalRequestKey";
      v20 = 2112;
      v21 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    if (v5)
    {
      v12 = [v9 workQueue];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_1446;
      v14[3] = &unk_2797359B0;
      v14[4] = v9;
      v15 = *(a1 + 32);
      dispatch_async(v12, v14);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __51__HMDHome__addUsersWithInviteInformations_message___block_invoke_1446(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v20 = v5;
    v21 = 2112;
    v22 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing invites that were not added to resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = *(a1 + 40);
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        [*(a1 + 32) removeOutgoingInvitation:{v12, v14}];
        [*(a1 + 32) __handleCancelledOutgoingInvitation:v12];
        [v12 updateInvitationState:1];
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveOutgoingHomeInvitationModel:(id)model message:(id)message
{
  messageCopy = message;
  uuid = [model uuid];
  v7 = [(HMDHome *)self outgoingInvitationWithUUID:uuid];

  if (v7)
  {
    [(HMDHome *)self removeOutgoingInvitation:v7];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    user = [v7 user];
    uuid2 = [user uuid];
    v11 = [(HMDHome *)self userWithUUID:uuid2];

    if (v11)
    {
      [(HMDHome *)self __handleCompletedOutgoingInvitation:v7];
    }

    else
    {
      if ([transactionResult source] == 2 || objc_msgSend(transactionResult, "source") == 3)
      {
        [v7 cancel];
      }

      else
      {
        [(HMDHome *)self __handleCancelledOutgoingInvitation:v7];
      }

      [v7 updateInvitationState:1];
    }

    if ([(HMDHome *)self isOwnerUser])
    {
      homeManager = [(HMDHome *)self homeManager];
      [homeManager setLastUserAddRemoveTimestamp];
    }
  }

  [messageCopy respondWithPayload:0];
}

- (void)_handleAddOutgoingHomeInvitationModel:(id)model message:(id)message
{
  v48 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self outgoingInvitationWithUUID:uuid];

  if (!v9)
  {
    user = [modelCopy user];
    v11 = [HMDUser userWithDictionary:user home:self];

    [v11 refreshDisplayName];
    v12 = [HMDOutgoingHomeInvitation alloc];
    uuid2 = [modelCopy uuid];
    invitationState = [modelCopy invitationState];
    integerValue = [invitationState integerValue];
    expiryDate = [modelCopy expiryDate];
    v17 = [(HMDOutgoingHomeInvitation *)v12 initWithUUID:uuid2 invitee:v11 invitationState:integerValue forHome:self expiryDate:expiryDate messageIdentifier:0];

    v18 = objc_autoreleasePoolPush();
    selfCopy = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138544130;
      v41 = v21;
      v42 = 2112;
      v43 = v11;
      v44 = 2112;
      v45 = 0;
      v46 = 2112;
      v47 = v17;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Created user [%@] from outgoing invitation: %@ / %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v18);
    v22 = objc_alloc(MEMORY[0x277D0F818]);
    allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
    v24 = [v22 initWithName:@"kTransactionUpdate" destination:allMessageDestinations payload:0];
    [(HMDOutgoingHomeInvitation *)v17 transactionObjectUpdated:0 newValues:modelCopy message:v24];

    workQueue = [(HMDHome *)selfCopy workQueue];
    [(HMDHomeInvitation *)v17 setClientQueue:workQueue];

    objc_initWeak(buf, selfCopy);
    objc_initWeak(&location, v17);
    v32 = MEMORY[0x277D85DD0];
    v33 = 3221225472;
    v34 = __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke;
    v35 = &unk_279733938;
    objc_copyWeak(&v37, buf);
    objc_copyWeak(&v38, &location);
    v26 = messageCopy;
    v36 = v26;
    [(HMDHomeInvitation *)v17 setExpirationHandler:&v32];
    [(HMDHome *)selfCopy addOutgoingInvitation:v17, v32, v33, v34, v35];
    [(HMDHome *)selfCopy _cleanRemovedUsers:v11];
    [(HMDOutgoingHomeInvitation *)v17 notifyStateChangedForMessage:v26];
    if ([(HMDHome *)selfCopy isOwnerUser])
    {
      home = [(HMDHome *)selfCopy home];
      homeManager = [home homeManager];
      [homeManager updateCurrentUserEligibleForOwnerToAutoMigration];

      homeManager2 = [(HMDHome *)selfCopy homeManager];
      [homeManager2 setLastUserAddRemoveTimestamp];
    }

    transactionResult = [v26 transactionResult];
    [transactionResult markChanged];

    objc_destroyWeak(&v38);
    objc_destroyWeak(&v37);
    objc_destroyWeak(&location);
    objc_destroyWeak(buf);
  }

  v31 = *MEMORY[0x277D85DE8];
}

void __57__HMDHome__handleAddOutgoingHomeInvitationModel_message___block_invoke(id *a1)
{
  v15 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  v3 = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = WeakRetained;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [v3 identifier];
      v11 = 138543618;
      v12 = v7;
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Expiring invitation %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    [v5 removeOutgoingInvitation:v3];
    [v5 __handleCancelledOutgoingInvitation:v3];
    [v3 updateInvitationState:{objc_msgSend(v3, "invitationState")}];
    v9 = [a1[4] name];
    [v5 saveWithReason:v9 postSyncNotification:0];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserInvitations:(id)invitations
{
  v84[2] = *MEMORY[0x277D85DE8];
  invitationsCopy = invitations;
  featuresDataSource = [(HMDHome *)self featuresDataSource];
  isBlockHomeInvitationInHH1Enabled = [featuresDataSource isBlockHomeInvitationInHH1Enabled];

  if (isBlockHomeInvitationInHH1Enabled)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v79 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Home invitation is no longer supported in HH1.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [invitationsCopy respondWithError:v11];
    goto LABEL_43;
  }

  v11 = [invitationsCopy dataForKey:*MEMORY[0x277CD06B8]];
  if (!v11)
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      messagePayload = [invitationsCopy messagePayload];
      *buf = 138543618;
      v79 = v46;
      v80 = 2112;
      v81 = messagePayload;
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to send invitations, missing user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v43);
    v17 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [invitationsCopy respondWithError:v17];
    goto LABEL_42;
  }

  v12 = MEMORY[0x277CCAAC8];
  v13 = MEMORY[0x277CBEB98];
  v84[0] = objc_opt_class();
  v84[1] = objc_opt_class();
  v14 = [MEMORY[0x277CBEA60] arrayWithObjects:v84 count:2];
  v15 = [v13 setWithArray:v14];
  v76 = 0;
  v16 = [v12 unarchivedObjectOfClasses:v15 fromData:v11 error:&v76];
  v17 = v76;

  v18 = v16;
  v19 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v21 = HMFGetOSLogHandle();
  v22 = v21;
  if (!v16)
  {
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v48 = HMFGetLogIdentifier();
      *buf = 138543618;
      v79 = v48;
      v80 = 2112;
      v81 = v17;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Failed to decode user invite information: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    v49 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [invitationsCopy respondWithError:v49];
    goto LABEL_33;
  }

  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    v23 = HMFGetLogIdentifier();
    users = [(HMDHome *)selfCopy3 users];
    v25 = [users count];
    *buf = 138543874;
    v79 = v23;
    v80 = 2048;
    v81 = v25;
    v82 = 2048;
    v83 = maximumUsersPerHome;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Adding users; current user count is %ld and max is %ld", buf, 0x20u);

    v18 = v16;
  }

  objc_autoreleasePoolPop(v19);
  users2 = [(HMDHome *)selfCopy3 users];
  v27 = [users2 count];
  v28 = [v18 count] + v27;
  v29 = maximumUsersPerHome;

  if (v28 >= v29)
  {
    v50 = objc_autoreleasePoolPush();
    v51 = selfCopy3;
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      HMFGetLogIdentifier();
      v54 = v53 = v18;
      *buf = 138543362;
      v79 = v54;
      _os_log_impl(&dword_2531F8000, v52, OS_LOG_TYPE_INFO, "%{public}@Can't add users; already at maximum users for home", buf, 0xCu);

      v18 = v53;
    }

    objc_autoreleasePoolPop(v50);
    v49 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:49 userInfo:0];
    responseHandler = [invitationsCopy responseHandler];
    (responseHandler)[2](responseHandler, v49, 0);

LABEL_33:
    goto LABEL_41;
  }

  v69 = v17;
  v70 = invitationsCopy;
  v74 = 0u;
  v75 = 0u;
  v72 = 0u;
  v73 = 0u;
  obj = v18;
  v30 = [obj countByEnumeratingWithState:&v72 objects:v77 count:16];
  if (!v30)
  {
    goto LABEL_23;
  }

  v31 = v30;
  v32 = *v73;
  v68 = v18;
  while (2)
  {
    for (i = 0; i != v31; ++i)
    {
      if (*v73 != v32)
      {
        objc_enumerationMutation(obj);
      }

      v34 = *(*(&v72 + 1) + 8 * i);
      v35 = objc_autoreleasePoolPush();
      v36 = selfCopy3;
      v37 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
      {
        v38 = HMFGetLogIdentifier();
        *buf = 138543618;
        v79 = v38;
        v80 = 2112;
        v81 = v34;
        _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@Processing invite information : %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v35);
      userID = [v34 userID];
      users3 = [(HMDHome *)v36 users];
      v41 = [users3 hmf_firstObjectWithValue:userID forKeyPath:@"userID"];

      if (v41)
      {
        v56 = objc_autoreleasePoolPush();
        v57 = v36;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          *buf = 138543618;
          v79 = v59;
          v80 = 2112;
          v81 = userID;
          v60 = "%{public}@Failed to invite user %@ since the user is already part of the home";
LABEL_38:
          _os_log_impl(&dword_2531F8000, v58, OS_LOG_TYPE_INFO, v60, buf, 0x16u);
        }

LABEL_39:

        objc_autoreleasePoolPop(v56);
        responseHandler3 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:1 userInfo:0];
        invitationsCopy = v70;
        responseHandler2 = [v70 responseHandler];
        responseHandler2[2](responseHandler2, responseHandler3, 0);

LABEL_40:
        v17 = v69;

        v18 = v68;
        goto LABEL_41;
      }

      outgoingInvitations = [(HMDHome *)v36 outgoingInvitations];
      v41 = [outgoingInvitations hmf_firstObjectWithValue:userID forKeyPath:@"user.userID"];

      if (v41)
      {
        v56 = objc_autoreleasePoolPush();
        v57 = v36;
        v58 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v58, OS_LOG_TYPE_INFO))
        {
          v59 = HMFGetLogIdentifier();
          *buf = 138543618;
          v79 = v59;
          v80 = 2112;
          v81 = userID;
          v60 = "%{public}@Failed to invite user %@ since the user is already invited to the home";
          goto LABEL_38;
        }

        goto LABEL_39;
      }

      if ([v34 isAdministrator] && !-[HMDHome isResidentSupported](v36, "isResidentSupported"))
      {
        v64 = objc_autoreleasePoolPush();
        v65 = v36;
        v66 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
        {
          v67 = HMFGetLogIdentifier();
          *buf = 138543618;
          v79 = v67;
          v80 = 2112;
          v81 = userID;
          _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_INFO, "%{public}@Cannot invite admin user %@ because it requires a resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v64);
        v41 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:0];
        invitationsCopy = v70;
        responseHandler3 = [v70 responseHandler];
        (responseHandler3)[2](responseHandler3, v41, 0);
        goto LABEL_40;
      }
    }

    v31 = [obj countByEnumeratingWithState:&v72 objects:v77 count:16];
    v18 = v68;
    if (v31)
    {
      continue;
    }

    break;
  }

LABEL_23:

  invitationsCopy = v70;
  [(HMDHome *)selfCopy3 _addUsersWithInviteInformations:obj message:v70];
  v17 = v69;
LABEL_41:

LABEL_42:
LABEL_43:

  v63 = *MEMORY[0x277D85DE8];
}

- (void)_cleanRemovedUsers:(id)users
{
  v17 = *MEMORY[0x277D85DE8];
  usersCopy = users;
  array = [MEMORY[0x277CBEB18] array];
  os_unfair_recursive_lock_lock_with_options();
  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v6 = self->_removedUsers;
  v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v7)
  {
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        if ([v10 isEqualToUser:{usersCopy, v12}])
        {
          [array addObject:v10];
        }
      }

      v7 = [(NSMutableArray *)v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }

  [(NSMutableArray *)self->_removedUsers removeObjectsInArray:array];
  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (id)prepareUserManagementOperationForUser:(id)user accessory:(id)accessory type:(unint64_t)type model:(id)model error:(id *)error
{
  v52 = *MEMORY[0x277D85DE8];
  userCopy = user;
  accessoryCopy = accessory;
  modelCopy = model;
  errorCopy = error;
  if (shouldLogPrivateInformation())
  {
    userID = [userCopy userID];
  }

  else
  {
    userID = @"...";
    v15 = @"...";
  }

  v16 = modelCopy;
  v17 = objc_autoreleasePoolPush();
  selfCopy = self;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    if (type - 1 > 2)
    {
      v21 = @"unknown";
    }

    else
    {
      v21 = off_27972B528[type - 1];
    }

    v22 = v21;
    name = [accessoryCopy name];
    *buf = 138544130;
    v45 = v20;
    v46 = 2112;
    v47 = v22;
    v48 = 2112;
    v49 = userID;
    v50 = 2112;
    v51 = name;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Preparing %@ user operation for user '%@' and accessory '%@'", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v17);
  v43 = 0;
  v24 = [(HMDHome *)selfCopy _verifyUserManagementPermissionForAccessory:accessoryCopy error:&v43];
  v25 = v43;
  v26 = v25;
  if (!v24 || (v42 = v25, v27 = [(HMDHome *)selfCopy _isUserValid:userCopy error:&v42], v28 = v42, v26, v26 = v28, !v27))
  {
    v29 = objc_autoreleasePoolPush();
    v30 = selfCopy;
    v31 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
    {
      v32 = HMFGetLogIdentifier();
      name2 = [accessoryCopy name];
      *buf = 138544130;
      v45 = v32;
      v46 = 2112;
      v47 = userID;
      v48 = 2112;
      v49 = name2;
      v50 = 2112;
      v51 = v26;
      _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Unable to prepare user operation for user '%@' and accessory '%@' due to error: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v29);
  }

  if (v26)
  {
    v34 = 0;
    v35 = v16;
    v36 = errorCopy;
    goto LABEL_22;
  }

  v35 = v16;
  if (type == 2)
  {
    v34 = [HMDUserManagementOperation removeUserManagementOperationForUser:userCopy accessory:accessoryCopy model:v16];
    v36 = errorCopy;
    if (v34)
    {
LABEL_19:
      v26 = 0;
      goto LABEL_22;
    }
  }

  else
  {
    v36 = errorCopy;
    if (type == 1)
    {
      v34 = [HMDUserManagementOperation addUserManagementOperationForUser:userCopy accessory:accessoryCopy model:v35];
      if (v34)
      {
        goto LABEL_19;
      }
    }
  }

  v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3 description:@"Failed to create user operation" reason:0 suggestion:{0, type}];
  v34 = 0;
LABEL_22:
  if (v36)
  {
    v37 = v26;
    *v36 = v26;
  }

  v38 = *MEMORY[0x277D85DE8];

  return v34;
}

- (id)prepareUserManagementOperationForUser:(id)user accessories:(id)accessories type:(unint64_t)type error:(id *)error
{
  v53 = *MEMORY[0x277D85DE8];
  userCopy = user;
  accessoriesCopy = accessories;
  v35 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessoriesCopy, "count")}];
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v43 = 0u;
  obj = accessoriesCopy;
  v10 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
  if (v10)
  {
    v11 = v10;
    v34 = 0;
    v12 = *v41;
    selfCopy = self;
    typeCopy = type;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v41 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v40 + 1) + 8 * i);
        if ([v14 supportsUserManagement])
        {
          v39 = 0;
          v15 = [(HMDHome *)self prepareUserManagementOperationForUser:userCopy accessory:v14 type:type model:0 error:&v39];
          v16 = v39;
          if (v15)
          {
            [v35 addObject:v15];
          }

          else
          {
            v21 = objc_autoreleasePoolPush();
            selfCopy2 = self;
            v23 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
            {
              v24 = HMFGetLogIdentifier();
              [userCopy userID];
              v25 = v32 = v21;
              name = [v14 name];
              *buf = 138544130;
              v45 = v24;
              v46 = 2112;
              v47 = v25;
              v48 = 2112;
              v49 = name;
              v50 = 2112;
              v51 = v16;
              _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Failed to prepare user management operation for user '%@', accessory '%@ with error: %@", buf, 0x2Au);

              v21 = v32;
              self = selfCopy;
            }

            objc_autoreleasePoolPop(v21);
            if (v16)
            {
              v27 = v16;

              v34 = v27;
            }

            type = typeCopy;
          }
        }

        else
        {
          v17 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v19 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
          {
            v20 = HMFGetLogIdentifier();
            *buf = 138543618;
            v45 = v20;
            v46 = 2112;
            v47 = v14;
            _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Skipping creation of user management operation for unmanageable accessory: %@", buf, 0x16u);

            self = selfCopy;
          }

          objc_autoreleasePoolPop(v17);
        }
      }

      v11 = [obj countByEnumeratingWithState:&v40 objects:v52 count:16];
    }

    while (v11);
  }

  else
  {
    v34 = 0;
  }

  v28 = v34;
  if (error)
  {
    v28 = v34;
    *error = v28;
  }

  v29 = *MEMORY[0x277D85DE8];

  return v35;
}

- (void)_addAllUsersToAccessory:(id)accessory
{
  accessoryCopy = accessory;
  users = [(HMDHome *)self users];
  [(HMDHome *)self _addUsers:users accessory:accessoryCopy];
}

- (void)_addUsers:(id)users accessory:(id)accessory
{
  v64 = *MEMORY[0x277D85DE8];
  usersCopy = users;
  accessoryCopy = accessory;
  homeManager = [(HMDHome *)self homeManager];
  backingStore = [homeManager backingStore];
  v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v44 = [backingStore transaction:@"kUserManagementOperationAddedKey" options:v9];

  owner = [(HMDHome *)self owner];
  pairingIdentity = [owner pairingIdentity];

  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  obj = usersCopy;
  v11 = [obj countByEnumeratingWithState:&v51 objects:v63 count:16];
  if (v11)
  {
    v13 = v11;
    v14 = *v52;
    *&v12 = 138543874;
    v38 = v12;
    v45 = *v52;
    selfCopy = self;
    do
    {
      v15 = 0;
      v46 = v13;
      do
      {
        if (*v52 != v14)
        {
          objc_enumerationMutation(obj);
        }

        v16 = *(*(&v51 + 1) + 8 * v15);
        currentUser = [(HMDHome *)self currentUser];
        v18 = [v16 isEqual:currentUser];

        if ((v18 & 1) == 0)
        {
          v19 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v21 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            v22 = HMFGetLogIdentifier();
            userID = [v16 userID];
            *buf = 138543618;
            v56 = v22;
            v57 = 2112;
            v58 = userID;
            _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Adding user '%@' to all accessories in the home", buf, 0x16u);

            v13 = v46;
            v14 = v45;
          }

          objc_autoreleasePoolPop(v19);
          v50 = 0;
          v24 = [(HMDHome *)selfCopy2 prepareUserManagementOperationForUser:v16 accessory:accessoryCopy type:1 model:0 error:&v50];
          v49 = v50;
          v25 = objc_autoreleasePoolPush();
          v26 = selfCopy2;
          v27 = HMFGetOSLogHandle();
          v28 = v27;
          if (v24)
          {
            if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
            {
              v40 = HMFGetLogIdentifier();
              identifier = [v24 identifier];
              [identifier UUIDString];
              v29 = v42 = v25;
              user = [v24 user];
              userID2 = [user userID];
              accessory = [v24 accessory];
              shortDescription = [accessory shortDescription];
              *buf = 138544130;
              v56 = v40;
              v57 = 2112;
              v58 = v29;
              v59 = 2112;
              v60 = userID2;
              v61 = 2112;
              v62 = shortDescription;
              _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Adding operation '%@' to manager tracking adding user '%@' to accessory '%@'", buf, 0x2Au);

              self = selfCopy;
              v14 = v45;

              v13 = v46;
              v25 = v42;
            }

            objc_autoreleasePoolPop(v25);
            [v24 setOwnerPairingIdentity:pairingIdentity];
            v34 = [v24 modelObjectWithChangeType:1];
            [v44 add:v34];
          }

          else
          {
            if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
            {
              v35 = HMFGetLogIdentifier();
              userID3 = [v16 userID];
              *buf = v38;
              v56 = v35;
              v57 = 2112;
              v58 = userID3;
              v59 = 2112;
              v60 = v49;
              _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Failed to prepare add operations for user '%@' with error: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v25);
          }
        }

        ++v15;
      }

      while (v13 != v15);
      v13 = [obj countByEnumeratingWithState:&v51 objects:v63 count:16];
    }

    while (v13);
  }

  [v44 run];
  v37 = *MEMORY[0x277D85DE8];
}

- (void)removeAllUsersAndCloudDataFromAccessory:(id)accessory completionHandler:(id)handler
{
  v116 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  handlerCopy = handler;
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (isOwnerUser)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543618;
      v107 = v13;
      v108 = 2112;
      v109 = accessoryCopy;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Removing cloud data from primary accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = accessoryCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v15 = v14;
    }

    else
    {
      v15 = 0;
    }

    v16 = v15;
    v82 = v14;

    v104 = 0u;
    v105 = 0u;
    v102 = 0u;
    v103 = 0u;
    v71 = v16;
    identifiersForBridgedAccessories = [v16 identifiersForBridgedAccessories];
    v18 = [identifiersForBridgedAccessories countByEnumeratingWithState:&v102 objects:v115 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v103;
      do
      {
        for (i = 0; i != v19; ++i)
        {
          if (*v103 != v20)
          {
            objc_enumerationMutation(identifiersForBridgedAccessories);
          }

          v22 = [(HMDHome *)selfCopy accessoryWithUUID:*(*(&v102 + 1) + 8 * i)];
          [v22 removeCloudData];
        }

        v19 = [identifiersForBridgedAccessories countByEnumeratingWithState:&v102 objects:v115 count:16];
      }

      while (v19);
    }

    v72 = handlerCopy;
    v73 = accessoryCopy;

    [v82 removeCloudData];
    homeManager = [(HMDHome *)selfCopy homeManager];
    backingStore = [homeManager backingStore];
    v24 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v78 = [backingStore transaction:@"kUserManagementOperationAddedKey" options:v24];

    v25 = objc_autoreleasePoolPush();
    v26 = selfCopy;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543362;
      v107 = v28;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating remove operation", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v25);
    currentUser = [(HMDHome *)v26 currentUser];
    v101 = 0;
    v30 = [(HMDHome *)v26 prepareUserManagementOperationForUser:currentUser accessory:v82 type:2 model:0 error:&v101];
    v70 = v101;

    v77 = v30;
    if (v30)
    {
      group = dispatch_group_create();
      owner = [(HMDHome *)v26 owner];
      pairingIdentity = [owner pairingIdentity];

      v99 = 0u;
      v100 = 0u;
      v97 = 0u;
      v98 = 0u;
      obj = [(HMDHome *)v26 users];
      v32 = v82;
      v81 = [obj countByEnumeratingWithState:&v97 objects:v114 count:16];
      if (v81)
      {
        v80 = *v98;
        do
        {
          for (j = 0; j != v81; ++j)
          {
            if (*v98 != v80)
            {
              objc_enumerationMutation(obj);
            }

            v34 = *(*(&v97 + 1) + 8 * j);
            currentUser2 = [(HMDHome *)v26 currentUser];
            v36 = [v34 isEqual:currentUser2];

            v37 = objc_autoreleasePoolPush();
            v38 = v26;
            v39 = HMFGetOSLogHandle();
            v40 = os_log_type_enabled(v39, OS_LOG_TYPE_INFO);
            if (v36)
            {
              if (v40)
              {
                v41 = HMFGetLogIdentifier();
                userID = [v34 userID];
                name = [v32 name];
                *buf = 138543874;
                v107 = v41;
                v108 = 2112;
                v109 = userID;
                v110 = 2112;
                v111 = name;
                _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Skipping removing current user %@ from accessory %@", buf, 0x20u);
              }

              objc_autoreleasePoolPop(v37);
            }

            else
            {
              if (v40)
              {
                v44 = HMFGetLogIdentifier();
                userID2 = [v34 userID];
                shortDescription = [v32 shortDescription];
                *buf = 138543874;
                v107 = v44;
                v108 = 2112;
                v109 = userID2;
                v110 = 2112;
                v111 = shortDescription;
                _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Removing user %@ from accessory %@", buf, 0x20u);

                v32 = v82;
              }

              objc_autoreleasePoolPop(v37);
              v96 = 0;
              v47 = [(HMDHome *)v38 prepareUserManagementOperationForUser:v34 accessory:v32 type:2 model:0 error:&v96];
              v48 = v96;
              if (v47)
              {
                [v47 setOwnerPairingIdentity:pairingIdentity];
                [v77 addDependency:v47];
                dispatch_group_enter(group);
                identifier = [v32 identifier];
                pairingIdentity2 = [v34 pairingIdentity];
                v89[0] = MEMORY[0x277D85DD0];
                v89[1] = 3221225472;
                v89[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke;
                v89[3] = &unk_2797248F0;
                v90 = v47;
                v91 = v38;
                v92 = v34;
                v93 = v82;
                v94 = v78;
                v95 = group;
                [homeManager cleanupOperationsForAccessory:identifier user:pairingIdentity2 completion:v89];

                v32 = v82;
              }

              else
              {
                v51 = objc_autoreleasePoolPush();
                v52 = v38;
                v53 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
                {
                  v54 = HMFGetLogIdentifier();
                  userID3 = [v34 userID];
                  shortDescription2 = [v82 shortDescription];
                  *buf = 138544130;
                  v107 = v54;
                  v108 = 2112;
                  v109 = userID3;
                  v110 = 2112;
                  v111 = shortDescription2;
                  v112 = 2112;
                  v113 = v48;
                  _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_INFO, "%{public}@Failed to create remove user operation for user '%@' and accessory '%@': %@", buf, 0x2Au);

                  v32 = v82;
                }

                objc_autoreleasePoolPop(v51);
              }
            }
          }

          v81 = [obj countByEnumeratingWithState:&v97 objects:v114 count:16];
        }

        while (v81);
      }

      [v77 setOwnerPairingIdentity:pairingIdentity];
      [(HMDHome *)v26 workQueue];
      v58 = v57 = v32;
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1432;
      block[3] = &unk_279734668;
      v84 = v77;
      v85 = v26;
      v86 = v57;
      v87 = v78;
      handlerCopy = v72;
      v88 = v72;
      dispatch_group_notify(group, v58, block);

      accessoryCopy = v73;
      v59 = v70;
    }

    else
    {
      v64 = objc_autoreleasePoolPush();
      v65 = v26;
      v66 = HMFGetOSLogHandle();
      v59 = v70;
      if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
      {
        v67 = HMFGetLogIdentifier();
        shortDescription3 = [v82 shortDescription];
        *buf = 138543874;
        v107 = v67;
        v108 = 2112;
        v109 = shortDescription3;
        v110 = 2112;
        v111 = v70;
        _os_log_impl(&dword_2531F8000, v66, OS_LOG_TYPE_ERROR, "%{public}@Failed to create remove operation for accessory %@: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v64);
      if (handlerCopy)
      {
        handlerCopy[2](handlerCopy);
      }
    }

    v63 = v71;
  }

  else
  {
    if (v12)
    {
      v60 = HMFGetLogIdentifier();
      shortDescription4 = [accessoryCopy shortDescription];
      *buf = 138543618;
      v107 = v60;
      v108 = 2112;
      v109 = shortDescription4;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Not owner of home - bypassing removing users from accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v62 = _Block_copy(handlerCopy);
    v63 = v62;
    if (v62)
    {
      (*(v62 + 2))(v62);
    }
  }

  v69 = *MEMORY[0x277D85DE8];
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke(id *a1)
{
  v2 = a1[4];
  v3 = [a1[5] workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2;
  v4[3] = &unk_2797248F0;
  v5 = *(a1 + 5);
  v6 = a1[7];
  v7 = a1[8];
  v8 = a1[4];
  v9 = a1[9];
  [v2 executeWithCompletionQueue:v3 completionHandler:v4];
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1432(id *a1)
{
  v2 = a1[4];
  if (v2)
  {
    v3 = [a1[5] workQueue];
    v13[0] = MEMORY[0x277D85DD0];
    v13[1] = 3221225472;
    v13[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1433;
    v13[3] = &unk_279732B10;
    v10 = *(a1 + 5);
    v4 = *(&v10 + 1);
    v5 = a1[7];
    v6 = a1[4];
    *&v7 = v5;
    *(&v7 + 1) = v6;
    v14 = v10;
    v15 = v7;
    v16 = a1[8];
    [v2 executeWithCompletionQueue:v3 completionHandler:v13];

    v8 = *(&v14 + 1);
  }

  else
  {
    v11[0] = MEMORY[0x277D85DD0];
    v11[1] = 3221225472;
    v11[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1435;
    v11[3] = &unk_279735558;
    v9 = a1[7];
    v12 = a1[8];
    [v9 run:v11];
    v8 = v12;
  }
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1433(uint64_t a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 32) currentUser];
      v9 = [v8 userID];
      v10 = [*(a1 + 40) shortDescription];
      *buf = 138544130;
      v18 = v7;
      v19 = 2112;
      v20 = v9;
      v21 = 2112;
      v22 = v10;
      v23 = 2112;
      v24 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove user '%@' from accessory '%@': %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
    v11 = *(a1 + 48);
    v12 = [*(a1 + 56) modelObjectWithChangeType:1];
    [v11 add:v12];
  }

  v13 = *(a1 + 48);
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1434;
  v15[3] = &unk_279735558;
  v16 = *(a1 + 64);
  [v13 run:v15];

  v14 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2_1435(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

uint64_t __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_1434(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

void __69__HMDHome_removeAllUsersAndCloudDataFromAccessory_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 40) userID];
      v9 = [*(a1 + 48) shortDescription];
      v13 = 138544130;
      v14 = v7;
      v15 = 2112;
      v16 = v8;
      v17 = 2112;
      v18 = v9;
      v19 = 2112;
      v20 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove user '%@' from accessory '%@': %@", &v13, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 56);
    v11 = [*(a1 + 64) modelObjectWithChangeType:1];
    [v10 add:v11];
  }

  dispatch_group_leave(*(a1 + 72));

  v12 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isUserValid:(id)valid error:(id *)error
{
  v24 = *MEMORY[0x277D85DE8];
  validCopy = valid;
  v7 = validCopy;
  if (!validCopy)
  {
    if (error)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Missing required parameter to validate user";
      v12 = 3;
LABEL_10:
      [v10 hmErrorWithCode:v12 description:v11 reason:0 suggestion:0];
      *error = v9 = 0;
      goto LABEL_12;
    }

LABEL_11:
    v9 = 0;
    goto LABEL_12;
  }

  pairingIdentity = [validCopy pairingIdentity];

  if (!pairingIdentity)
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      userID = [v7 userID];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = userID;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Invalid user '%@', missing either pairing username or public key", &v20, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    if (error)
    {
      v10 = MEMORY[0x277CCA9B8];
      v11 = @"Invalid user information";
      v12 = 21;
      goto LABEL_10;
    }

    goto LABEL_11;
  }

  v9 = 1;
LABEL_12:

  v18 = *MEMORY[0x277D85DE8];
  return v9;
}

- (BOOL)_verifyUserManagementPermissionForAccessory:(id)accessory error:(id *)error
{
  v31 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  if (![(HMDHome *)self isAdminUser])
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v11;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_DEFAULT, "%{public}@Non administrator cannot perform user management", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    if (error)
    {
      [MEMORY[0x277CCA9B8] hmErrorWithCode:17 description:@"Must be administrator to perform user management" reason:0 suggestion:0];
      *error = v7 = 0;
      goto LABEL_13;
    }

LABEL_12:
    v7 = 0;
    goto LABEL_13;
  }

  if (([accessoryCopy supportsUserManagement] & 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      name = [accessoryCopy name];
      *buf = 138543618;
      v28 = v15;
      v29 = 2112;
      v30 = name;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Cannot perform user management on '%@' since it is does not support user management operations", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    if (error)
    {
      v25[0] = *MEMORY[0x277CCA450];
      v17 = MEMORY[0x277CCACA8];
      name2 = [accessoryCopy name];
      v19 = [v17 stringWithFormat:@"Cannot perform user management on '%@'", name2];
      v26[0] = v19;
      v25[1] = *MEMORY[0x277CCA470];
      mainBundle = [MEMORY[0x277CCA8D8] mainBundle];
      v21 = [mainBundle localizedStringForKey:@"Accessory is not a primary accessory." value:&stru_286509E58 table:0];
      v26[1] = v21;
      v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v26 forKeys:v25 count:2];

      *error = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:48 userInfo:v22];
    }

    goto LABEL_12;
  }

  v7 = 1;
LABEL_13:

  v23 = *MEMORY[0x277D85DE8];
  return v7;
}

- (void)_purgeResidentUsers
{
  selfCopy = self;
  v33 = *MEMORY[0x277D85DE8];
  residentCapableDevices = [(HMDHome *)self residentCapableDevices];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  _residentUsers = [(HMDHome *)selfCopy _residentUsers];
  v5 = [_residentUsers copy];

  v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
  if (v23)
  {
    v7 = *v25;
    v8 = HMDIDSActivityMonitorHomeManagerDataSource;
    *&v6 = 138543618;
    v21 = v6;
    v22 = *v25;
    do
    {
      for (i = 0; i != v23; ++i)
      {
        if (*v25 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v24 + 1) + 8 * i);
        userID = [v10 userID];
        v12 = [&v8[93] deviceWithDestination:userID];

        if (v12 && [residentCapableDevices containsObject:v12])
        {
          v13 = objc_autoreleasePoolPush();
          v14 = selfCopy;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            HMFGetLogIdentifier();
            v16 = v5;
            v17 = residentCapableDevices;
            v19 = v18 = selfCopy;
            *buf = v21;
            v29 = v19;
            v30 = 2112;
            v31 = v10;
            _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Removing non-legacy resident user from home: %@", buf, 0x16u);

            selfCopy = v18;
            residentCapableDevices = v17;
            v5 = v16;
            v7 = v22;
          }

          objc_autoreleasePoolPop(v13);
          [(HMDHome *)v14 _removeUser:v10];
          v8 = HMDIDSActivityMonitorHomeManagerDataSource;
        }
      }

      v23 = [v5 countByEnumeratingWithState:&v24 objects:v32 count:16];
    }

    while (v23);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfUpdatedResidentUser:(id)user
{
  v19 = *MEMORY[0x277D85DE8];
  userCopy = user;
  v5 = [(HMDHome *)self _residentDeviceForResidentUser:userCopy];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v10;
      v17 = 2112;
      v18 = userCopy;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Notifying clients of updated remote access gateway: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    homeManager = [(HMDHome *)selfCopy homeManager];
    identifier = [v5 identifier];
    [homeManager updateGenerationCounterWithReason:@"ResidentUserUpdated" sourceUUID:identifier shouldNotifyClients:1];
  }

  else
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = userCopy;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@Failed to find resident for resident user: %@", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (id)_residentDeviceForResidentUser:(id)user
{
  v22 = *MEMORY[0x277D85DE8];
  userCopy = user;
  device = [userCopy device];
  if (device)
  {
    v6 = [HMDResidentDevice alloc];
    uuid = [userCopy uuid];
    v8 = [(HMDResidentDevice *)v6 initWithDevice:device identifier:uuid];

    if (-[HMDHome isResidentSupported](self, "isResidentSupported") || [userCopy configurationState] != 2)
    {
      [(HMDResidentDevice *)v8 setEnabled:0];
    }

    homeManager = [(HMDHome *)self homeManager];
    messageDispatcher = [homeManager messageDispatcher];
    v11 = [messageDispatcher remoteAccessDeviceForHome:self];

    if (([v11 isEqual:device] & 1) == 0)
    {
      [(HMDResidentDevice *)v8 setReachable:0];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = userCopy;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Unable to find matching device for resident user: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v8 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v8;
}

- (id)_residentUserForResidentDevice:(id)device
{
  v28 = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  owner = [(HMDHome *)self owner];
  pairingIdentity = [owner pairingIdentity];

  if (pairingIdentity)
  {
    device = [deviceCopy device];
    if (device)
    {
      v8 = objc_alloc(MEMORY[0x277CFEC20]);
      identifier = [device identifier];
      uUIDString = [identifier UUIDString];
      publicKey = [pairingIdentity publicKey];
      privateKey = [pairingIdentity privateKey];
      v13 = [v8 initWithIdentifier:uUIDString publicKey:publicKey privateKey:privateKey permissions:{objc_msgSend(pairingIdentity, "permissions")}];

      if ([deviceCopy isEnabled])
      {
        v14 = 2;
      }

      else
      {
        v14 = 3;
      }

      v15 = [HMDResidentUser alloc];
      home = [deviceCopy home];
      v17 = [(HMDResidentUser *)v15 initWithDevice:device home:home pairingIdentity:v13 configurationState:v14];

      [(HMDUser *)v17 setHome:self];
      if ([(HMDResidentUser *)v17 isBlocked])
      {
        [(HMDResidentUser *)v17 setConfigurationState:3];
      }
    }

    else
    {
      v17 = 0;
    }
  }

  else
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
    {
      v21 = HMFGetLogIdentifier();
      v24 = 138543618;
      v25 = v21;
      v26 = 2112;
      v27 = deviceCopy;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to retrieve owner's pairing identity to create legacy resident user for device: %@", &v24, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
    v17 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v17;
}

- (id)userWithMergeID:(id)d
{
  v36 = *MEMORY[0x277D85DE8];
  dCopy = d;
  if (dCopy)
  {
    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    users = [(HMDHome *)self users];
    v6 = [users countByEnumeratingWithState:&v25 objects:v35 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v26;
      while (2)
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v26 != v8)
          {
            objc_enumerationMutation(users);
          }

          v10 = *(*(&v25 + 1) + 8 * i);
          account = [v10 account];
          senderCorrelationIdentifier = [account senderCorrelationIdentifier];
          v13 = [senderCorrelationIdentifier isEqualToString:dCopy];

          if (v13)
          {
            v19 = objc_autoreleasePoolPush();
            selfCopy = self;
            v21 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
            {
              v22 = HMFGetLogIdentifier();
              *buf = 138543874;
              v30 = v22;
              v31 = 2112;
              v32 = dCopy;
              v33 = 2112;
              v34 = v10;
              _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_DEBUG, "%{public}@Found user with mergeID %@: %@", buf, 0x20u);
            }

            objc_autoreleasePoolPop(v19);
            v18 = v10;

            goto LABEL_17;
          }
        }

        v7 = [users countByEnumeratingWithState:&v25 objects:v35 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }
  }

  v14 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543618;
    v30 = v17;
    v31 = 2112;
    v32 = dCopy;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEBUG, "%{public}@No user found with mergeID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v14);
  v18 = 0;
LABEL_17:

  v23 = *MEMORY[0x277D85DE8];

  return v18;
}

- (id)userWithPairingIdentityIdentifier:(id)identifier
{
  v17 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  if (identifierCopy)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    users = [(HMDHome *)self users];
    v6 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v6)
    {
      v7 = *v13;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(users);
          }

          v9 = *(*(&v12 + 1) + 8 * i);
          if ([v9 matchingPairingIdentityIdentifier:identifierCopy])
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)userWithPairingIdentity:(id)identity
{
  v19 = *MEMORY[0x277D85DE8];
  identityCopy = identity;
  if (identityCopy)
  {
    v16 = 0u;
    v17 = 0u;
    v14 = 0u;
    v15 = 0u;
    users = [(HMDHome *)self users];
    v6 = [users countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = *v15;
      while (2)
      {
        for (i = 0; i != v6; i = i + 1)
        {
          if (*v15 != v7)
          {
            objc_enumerationMutation(users);
          }

          v9 = *(*(&v14 + 1) + 8 * i);
          pairingIdentity = [v9 pairingIdentity];
          v11 = [identityCopy isEqual:pairingIdentity];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        v6 = [users countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  else
  {
    v6 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_updateCurrentUserForSharedHome
{
  v14 = *MEMORY[0x277D85DE8];
  currentUser = [(HMDHome *)self currentUser];

  if (!currentUser)
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Did not find the current user so adding user for shared home", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    dataSource = [(HMDHome *)selfCopy dataSource];
    v9 = [dataSource makeCurrentUserWithUserPrivilege:0 home:selfCopy];

    presenceAuthStatus = [(HMDHome *)selfCopy presenceAuthStatus];
    [v9 setPresenceAuthStatus:presenceAuthStatus];

    [v9 setHome:selfCopy];
    [(HMDHome *)selfCopy setCurrentUser:v9];
    [(HMDHome *)selfCopy addUser:v9];
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (BOOL)isSiriPhraseOptionsJustSiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = (self->_siriPhraseOptions >> 1) & 1;
  os_unfair_recursive_lock_unlock();
  return v3;
}

- (BOOL)isSiriPhraseOptionsHeySiriEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  siriPhraseOptions = self->_siriPhraseOptions;
  os_unfair_recursive_lock_unlock();
  return siriPhraseOptions & 1;
}

- (BOOL)isSmokeAlarmEnabled
{
  os_unfair_recursive_lock_lock_with_options();
  audioAnalysisClassifierOptions = self->_audioAnalysisClassifierOptions;
  os_unfair_recursive_lock_unlock();
  return audioAnalysisClassifierOptions & 1;
}

- (NSArray)removedUsers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_removedUsers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSArray)usersPendingUserManagementOperations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_usersPendingUserManagementOperations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (BOOL)isOwnerUser
{
  os_unfair_recursive_lock_lock_with_options();
  ownerUser = self->_ownerUser;
  os_unfair_recursive_lock_unlock();
  return ownerUser;
}

- (void)setOwnerUser:(BOOL)user
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerUser = user;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isSharedAdmin
{
  isAdminUser = [(HMDHome *)self isAdminUser];
  if (isAdminUser)
  {
    LOBYTE(isAdminUser) = ![(HMDHome *)self isOwnerUser];
  }

  return isAdminUser;
}

- (BOOL)isAdminUser
{
  currentUser = [(HMDHome *)self currentUser];
  isAdministrator = [currentUser isAdministrator];

  return isAdministrator;
}

- (HMDUser)currentUser
{
  v17 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_currentUser)
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    users = [(HMDHome *)self users];
    v4 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = *v13;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v13 != v5)
          {
            objc_enumerationMutation(users);
          }

          v7 = *(*(&v12 + 1) + 8 * i);
          if ([v7 isCurrentUser])
          {
            objc_storeStrong(&self->_currentUser, v7);
            presenceAuthStatus = [(HMDHome *)self presenceAuthStatus];
            [(HMDUser *)self->_currentUser setPresenceAuthStatus:presenceAuthStatus];

            goto LABEL_12;
          }
        }

        v4 = [users countByEnumeratingWithState:&v12 objects:v16 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  currentUser = self->_currentUser;
  v10 = *MEMORY[0x277D85DE8];

  return currentUser;
}

- (void)setCurrentUser:(id)user
{
  userCopy = user;
  os_unfair_recursive_lock_lock_with_options();
  currentUser = self->_currentUser;
  self->_currentUser = userCopy;

  os_unfair_recursive_lock_unlock();
}

- (id)owner
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  if (!self->_owner)
  {
    v13 = 0u;
    v14 = 0u;
    v11 = 0u;
    v12 = 0u;
    users = [(HMDHome *)self users];
    v4 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
    if (v4)
    {
      v5 = *v12;
      while (2)
      {
        for (i = 0; i != v4; ++i)
        {
          if (*v12 != v5)
          {
            objc_enumerationMutation(users);
          }

          v7 = *(*(&v11 + 1) + 8 * i);
          if ([v7 privilege] == 3)
          {
            objc_storeStrong(&self->_owner, v7);
            goto LABEL_12;
          }
        }

        v4 = [users countByEnumeratingWithState:&v11 objects:v15 count:16];
        if (v4)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  os_unfair_recursive_lock_unlock();
  owner = self->_owner;
  v9 = *MEMORY[0x277D85DE8];

  return owner;
}

- (void)setOwner:(id)owner
{
  ownerCopy = owner;
  os_unfair_recursive_lock_lock_with_options();
  owner = self->_owner;
  self->_owner = ownerCopy;

  os_unfair_recursive_lock_unlock();
}

- (void)_removeUser:(id)user
{
  userCopy = user;
  if (userCopy)
  {
    v5 = userCopy;
    os_unfair_recursive_lock_lock_with_options();
    if ([(NSMutableArray *)self->_users containsObject:v5])
    {
      [(NSMutableArray *)self->_users removeObject:v5];
    }

    os_unfair_recursive_lock_unlock();
    userCopy = v5;
  }
}

- (void)addUser:(id)user
{
  v15 = *MEMORY[0x277D85DE8];
  userCopy = user;
  homeManager = [(HMDHome *)self homeManager];
  if (userCopy)
  {
    os_unfair_recursive_lock_lock_with_options();
    if (([(NSMutableArray *)self->_users containsObject:userCopy]& 1) == 0)
    {
      v6 = objc_autoreleasePoolPush();
      selfCopy = self;
      v8 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = HMFGetLogIdentifier();
        v11 = 138543618;
        v12 = v9;
        v13 = 2112;
        v14 = userCopy;
        _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Adding a new user : %@", &v11, 0x16u);
      }

      objc_autoreleasePoolPop(v6);
      [(NSMutableArray *)self->_users addObject:userCopy];
    }

    os_unfair_recursive_lock_unlock();
    if ([(HMDHome *)self isOwnerUser])
    {
      [homeManager updateCurrentUserEligibleForOwnerToAutoMigration];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (NSArray)usersSupportingPresence
{
  users = [(HMDHome *)self users];
  v3 = [HMDHome filterUsersSupportingPresence:users];

  return v3;
}

- (id)sharedUsers
{
  users = [(HMDHome *)self users];
  v3 = [users na_map:&__block_literal_global_1410];

  return v3;
}

id __22__HMDHome_sharedUsers__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 privilege] == 3)
  {
    v3 = 0;
  }

  else
  {
    v3 = v2;
  }

  return v3;
}

- (NSArray)users
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_users copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveAppDataModel:(id)model message:(id)message
{
  messageCopy = message;
  [(HMDHome *)self setAppData:0];
  transactionResult = [messageCopy transactionResult];
  [transactionResult markChanged];
  [messageCopy respondWithPayload:0];
}

- (void)_handleUpdateAppDataModel:(id)model message:(id)message
{
  v25 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  appData = [(HMDHome *)self appData];

  if (appData)
  {
    appData2 = [(HMDHome *)self appData];
    [appData2 updateWithModel:modelCopy];
  }

  else
  {
    v10 = [HMDApplicationData alloc];
    appDataDictionary = [modelCopy appDataDictionary];
    uuid = [(HMDHome *)self uuid];
    v13 = [(HMDApplicationData *)v10 initWithDictionary:appDataDictionary parentUUID:uuid];
    [(HMDHome *)self setAppData:v13];

    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_DEBUG))
    {
      v17 = HMFGetLogIdentifier();
      appDataDictionary2 = [modelCopy appDataDictionary];
      v21 = 138543618;
      v22 = v17;
      v23 = 2112;
      v24 = appDataDictionary2;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEBUG, "%{public}@Updating the application data : %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  transactionResult = [messageCopy transactionResult];
  [transactionResult markChanged];
  [messageCopy respondWithPayload:0];

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetAppData:(id)data
{
  v28 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  v21 = 0;
  v5 = [dataCopy appDataDictionaryWithError:&v21];
  v6 = v21;
  if (v5)
  {
    v7 = [(HMDHome *)self _appDataContainerForMessage:dataCopy];
    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543874;
        v23 = v11;
        v24 = 2112;
        v25 = v7;
        v26 = 2112;
        v27 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Going to update appData for %@ to: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
      appData = [v7 appData];
      uuid = [v7 uuid];
      v14 = [HMDApplicationDataModel modelWithAppDataPayload:v5 existingAppData:appData parentUUID:uuid];
      if (v14)
      {
        backingStore = [(HMDHome *)selfCopy backingStore];
        name = [dataCopy name];
        v17 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        [backingStore transaction:name options:v17];
        v18 = v20 = v6;

        [v18 add:v14 withMessage:dataCopy];
        [v18 run];

        v6 = v20;
      }

      else
      {
        [dataCopy respondWithSuccess];
      }
    }

    else
    {
      appData = [dataCopy responseHandler];
      uuid = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (appData)[2](appData, uuid, 0);
    }
  }

  else
  {
    [dataCopy respondWithError:v6];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (id)_appDataContainerForMessage:(id)message
{
  messageCopy = message;
  v5 = [messageCopy uuidForKey:*MEMORY[0x277CD0D40]];
  if (v5)
  {
    v6 = [(HMDHome *)self roomWithUUID:v5];
  }

  else
  {
    v7 = [messageCopy uuidForKey:*MEMORY[0x277CD25E0]];
    if (v7)
    {
      v6 = [(HMDHome *)self serviceGroupWithUUID:v7];
    }

    else
    {
      v8 = [messageCopy uuidForKey:*MEMORY[0x277CD2050]];
      if (v8)
      {
        selfCopy = [(HMDHome *)self actionSetWithUUID:v8];
      }

      else
      {
        selfCopy = self;
      }

      v6 = selfCopy;
    }
  }

  return v6;
}

- (void)_handleAllowUserManagementMessage:(id)message
{
  v14 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if ([(HMDHome *)self isAdminUser])
  {
    responseHandler = [messageCopy responseHandler];
    responseHandler[2](responseHandler, 0, MEMORY[0x277CBEC10]);
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v12 = 138543362;
      v13 = v9;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to allow user management, insufficient privileges", &v12, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
    responseHandler = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    responseHandler2 = [messageCopy responseHandler];
    responseHandler2[2](responseHandler2, responseHandler, MEMORY[0x277CBEC10]);
  }

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_handleExecuteConfirmationOfTrigger:(id)trigger
{
  v61 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  if (([(__CFString *)triggerCopy isEntitledForSPIAccess]& 1) != 0 || ([(__CFString *)triggerCopy isRemote]& 1) != 0)
  {
    responseHandler4 = [(__CFString *)triggerCopy uuidForKey:*MEMORY[0x277CD2768]];
    triggers = [(HMDHome *)self triggers];
    v7 = [triggers hmf_firstObjectWithSPIUniqueIdentifier:responseHandler4];

    v8 = v7;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (isWatch() || isWatch() && ([v10 hasUserConfirmationSession] & 1) == 0)
    {
      v11 = objc_autoreleasePoolPush();
      selfCopy = self;
      v13 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        v15 = isWatch();
        v16 = @"non-Tinker HH2";
        *buf = 138543874;
        v56 = v14;
        v57 = 2112;
        if (v15)
        {
          v16 = @"Legacy";
        }

        v58 = v16;
        v59 = 2112;
        v60 = triggerCopy;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation for relay in %@ Watch, %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v11);
      homeManager = [(HMDHome *)selfCopy homeManager];
      companionDevice = [homeManager companionDevice];
      if (companionDevice && [homeManager companionReachable])
      {
        v48 = v10;
        v49 = responseHandler4;
        v19 = [HMDRemoteDeviceMessageDestination alloc];
        uuid = [(HMDHome *)selfCopy uuid];
        v21 = [(HMDRemoteDeviceMessageDestination *)v19 initWithTarget:uuid device:companionDevice];

        v22 = MEMORY[0x277D0F818];
        messagePayload = [(__CFString *)triggerCopy messagePayload];
        v24 = [messagePayload copy];
        v25 = [v22 messageWithName:@"kConfirmExecuteTriggerRequestKey" qualityOfService:25 destination:v21 payload:v24];

        v53[0] = MEMORY[0x277D85DD0];
        v53[1] = 3221225472;
        v53[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke;
        v53[3] = &unk_279734E00;
        v54 = triggerCopy;
        [v25 setResponseHandler:v53];
        v26 = objc_autoreleasePoolPush();
        v27 = selfCopy;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
        {
          v29 = HMFGetLogIdentifier();
          *buf = 138543362;
          v56 = v29;
          _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Sending confirmation to companion", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v26);
        messageDispatcher = [homeManager messageDispatcher];
        [messageDispatcher sendMessage:v25 completionHandler:0];

        v10 = v48;
        responseHandler4 = v49;
      }

      else
      {
        v21 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:63 userInfo:0];
        responseHandler = [(__CFString *)triggerCopy responseHandler];
        v25 = responseHandler;
        if (responseHandler)
        {
          (*(responseHandler + 16))(responseHandler, v21, 0);
        }
      }
    }

    else
    {
      v31 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v35 = v34 = v10;
        *buf = 138543618;
        v56 = v35;
        v57 = 2112;
        v58 = triggerCopy;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Received trigger execution confirmation on iOS or HH2 Watch: %@", buf, 0x16u);

        v10 = v34;
      }

      objc_autoreleasePoolPop(v31);
      if (v8)
      {
        v36 = v10;
        v37 = [(__CFString *)triggerCopy BOOLForKey:*MEMORY[0x277CD2740]];
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1405;
        v50[3] = &unk_2797358C8;
        v51 = v8;
        v52 = triggerCopy;
        v38 = v37;
        v10 = v36;
        [v51 userDidConfirmExecute:v38 completionHandler:v50];

        homeManager = v51;
      }

      else
      {
        homeManager = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
        responseHandler2 = [(__CFString *)triggerCopy responseHandler];
        v47 = responseHandler2;
        if (responseHandler2)
        {
          (*(responseHandler2 + 16))(responseHandler2, homeManager, 0);
        }
      }
    }

    goto LABEL_26;
  }

  v41 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v43 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v43, OS_LOG_TYPE_ERROR))
  {
    v44 = HMFGetLogIdentifier();
    *buf = 138543362;
    v56 = v44;
    _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI and it's not relayed from watch.", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v41);
  responseHandler3 = [(__CFString *)triggerCopy responseHandler];

  if (responseHandler3)
  {
    responseHandler4 = [(__CFString *)triggerCopy responseHandler];
    v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    (responseHandler4)[2](responseHandler4, v8, 0);
LABEL_26:
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = [*(a1 + 32) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

void __47__HMDHome__handleExecuteConfirmationOfTrigger___block_invoke_1405(uint64_t a1, void *a2)
{
  v5 = a2;
  if (v5 && isiOSDevice())
  {
    +[HMDBulletinUIManager presentExecutionErrorDialogForTrigger:partialSuccess:](HMDBulletinUIManager, "presentExecutionErrorDialogForTrigger:partialSuccess:", *(a1 + 32), [v5 code] == 64);
  }

  v3 = [*(a1 + 40) responseHandler];
  v4 = v3;
  if (v3)
  {
    (*(v3 + 16))(v3, v5, 0);
  }
}

- (void)_removeTrigger:(id)trigger message:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  messageCopy = message;
  if (triggerCopy)
  {
    [(HMDHome *)self removeTriggerNoNotification:triggerCopy];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v12;
      v32 = 2112;
      v33 = triggerCopy;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove trigger: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    uuid = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid UUIDString];
    v29[0] = uUIDString;
    v28[1] = *MEMORY[0x277CD2758];
    name = [triggerCopy name];
    v29[1] = name;
    v28[2] = *MEMORY[0x277CD2768];
    uuid2 = [triggerCopy uuid];
    uUIDString2 = [uuid2 UUIDString];
    v29[2] = uUIDString2;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    v19 = objc_autoreleasePoolPush();
    v20 = selfCopy;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v22;
      v32 = 2112;
      v33 = v18;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Successfully Removed trigger : sending back the result: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    [messageCopy respondWithPayload:v18];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v31 = v26;
      v32 = 2112;
      v33 = 0;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Could not find the Trigger : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    transactionResult = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    [messageCopy respondWithError:transactionResult];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)removeTriggerNoNotification:(id)notification
{
  notificationCopy = notification;
  if (notificationCopy)
  {
    v9 = notificationCopy;
    [notificationCopy invalidate];
    name = [v9 name];
    v6 = [(HMDHome *)self removeName:name];

    [(HMDHome *)self removeFromCurrentTriggers:v9];
    os_unfair_recursive_lock_lock_with_options();
    ownedTriggers = self->_ownedTriggers;
    uuid = [v9 uuid];
    [(NSMutableArray *)ownedTriggers removeObject:uuid];

    os_unfair_recursive_lock_unlock();
    notificationCopy = v9;
  }
}

- (void)removeTrigger:(id)trigger
{
  triggerCopy = trigger;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __25__HMDHome_removeTrigger___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = triggerCopy;
  v6 = triggerCopy;
  dispatch_async(workQueue, v7);
}

void __25__HMDHome_removeTrigger___block_invoke(uint64_t a1)
{
  v12[1] = *MEMORY[0x277D85DE8];
  v2 = MEMORY[0x277D0F818];
  v3 = objc_alloc(MEMORY[0x277D0F820]);
  v4 = [*(a1 + 32) uuid];
  v5 = [v3 initWithTarget:v4];
  v11 = *MEMORY[0x277CD2768];
  v6 = [*(a1 + 40) uuid];
  v7 = [v6 UUIDString];
  v12[0] = v7;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:&v11 count:1];
  v9 = [v2 messageWithName:@"kRemoveTriggerRequestKey" destination:v5 payload:v8];

  [*(a1 + 32) _handleRemoveTrigger:v9];
  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTriggerModel:(id)model message:(id)message
{
  v21 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self triggerWithUUID:uuid];

  if (v9)
  {
    [(HMDHome *)self _removeTrigger:v9 message:messageCopy];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      uuid2 = [modelCopy uuid];
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = uuid2;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Couldn't find trigger with UUID %@ to remove.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    transactionResult = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:transactionResult];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveTrigger:(id)trigger
{
  v25 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  v5 = [triggerCopy uuidForKey:*MEMORY[0x277CD2768]];
  v6 = [(HMDHome *)self triggerWithUUID:v5];
  if (v6)
  {
    v7 = [HMDTriggerModel alloc];
    uuid = [v6 uuid];
    uuid2 = [(HMDHome *)self uuid];
    v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:uuid parentUUID:uuid2];

    backingStore = [(HMDHome *)self backingStore];
    name = [triggerCopy name];
    v13 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v14 = [backingStore transaction:name options:v13];

    [v14 add:v10 withMessage:triggerCopy];
    [v14 run];
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v18;
      v23 = 2112;
      v24 = v5;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Cannot find the trigger with UUID %@", &v21, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [triggerCopy respondWithError:v19];
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_addNewTrigger:(id)trigger message:(id)message payloadAnnex:(id)annex triggerModel:(id)model
{
  v43 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  messageCopy = message;
  annexCopy = annex;
  modelCopy = model;
  [(HMDHome *)self addToCurrentTriggers:triggerCopy];
  os_unfair_recursive_lock_lock_with_options();
  ownedTriggers = self->_ownedTriggers;
  uuid = [triggerCopy uuid];
  if (([(NSMutableArray *)ownedTriggers containsObject:uuid]& 1) == 0)
  {
    owner = [triggerCopy owner];
    isOwner = [owner isOwner];

    if (!isOwner)
    {
      goto LABEL_5;
    }

    v18 = self->_ownedTriggers;
    uuid = [triggerCopy uuid];
    [(NSMutableArray *)v18 addObject:uuid];
  }

LABEL_5:
  os_unfair_recursive_lock_unlock();
  msgDispatcher = [(HMDHome *)self msgDispatcher];
  workQueue = [(HMDHome *)self workQueue];
  [triggerCopy configure:self messageDispatcher:msgDispatcher queue:workQueue];

  transactionResult = [messageCopy transactionResult];
  [transactionResult markChanged];
  name = [messageCopy name];
  if ([name isEqualToString:@"kAddEventTriggerRequestKey"])
  {
  }

  else
  {
    name2 = [messageCopy name];
    v24 = [name2 isEqualToString:@"kAddTimerTriggerRequestKey"];

    if ((v24 & 1) == 0)
    {
      [messageCopy respondWithSuccess];
      goto LABEL_14;
    }
  }

  v25 = objc_autoreleasePoolPush();
  selfCopy = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    name3 = [triggerCopy name];
    v37 = 138543874;
    v38 = v28;
    v39 = 2112;
    v40 = name3;
    v41 = 2112;
    v42 = messageCopy;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Add trigger Transaction marked for change. The client will be updated next: %@, %@", &v37, 0x20u);
  }

  objc_autoreleasePoolPop(v25);
  v30 = MEMORY[0x277CBEB38];
  messagePayload = [messageCopy messagePayload];
  v32 = [v30 dictionaryWithDictionary:messagePayload];

  v33 = HMDRemoteMessagePayloadKeysForTransportMetadata();
  [v32 removeObjectsForKeys:v33];

  uuid2 = [triggerCopy uuid];
  uUIDString = [uuid2 UUIDString];
  [v32 setObject:uUIDString forKey:*MEMORY[0x277CD2768]];

  if (annexCopy)
  {
    [v32 addEntriesFromDictionary:annexCopy];
  }

  [messageCopy respondWithPayload:v32];

LABEL_14:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTriggers:(id)triggers
{
  v105[2] = *MEMORY[0x277D85DE8];
  triggersCopy = triggers;
  v5 = [triggersCopy dataForKey:@"HM.triggers"];
  v71 = triggersCopy;
  if (v5)
  {
    v6 = MEMORY[0x277CCAAC8];
    v7 = MEMORY[0x277CBEB98];
    v105[0] = objc_opt_class();
    v105[1] = objc_opt_class();
    v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v105 count:2];
    v9 = [v7 setWithArray:v8];
    v95 = 0;
    v69 = v5;
    v10 = [v6 unarchivedObjectOfClasses:v9 fromData:v5 error:&v95];
    v70 = v95;

    v11 = v10;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = v11;
    }

    else
    {
      v12 = 0;
    }

    v13 = v12;

    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
    v68 = v13;
    if (v13)
    {
      v67 = v11;
      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543618;
        v100 = v17;
        v101 = 2112;
        v102 = v13;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Received triggers %@ from shared admin to add", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      backingStore = [(HMDHome *)selfCopy backingStore];
      name = [v71 name];
      v20 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      responseHandler = [backingStore transaction:name options:v20];

      v93 = 0u;
      v94 = 0u;
      v91 = 0u;
      v92 = 0u;
      obj = v13;
      v74 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
      if (v74)
      {
        v73 = *v92;
        v79 = responseHandler;
        do
        {
          v22 = 0;
          do
          {
            if (*v92 != v73)
            {
              objc_enumerationMutation(obj);
            }

            v76 = v22;
            v23 = *(*(&v91 + 1) + 8 * v22);
            [v23 setHome:{selfCopy, v67}];
            v89 = 0u;
            v90 = 0u;
            v87 = 0u;
            v88 = 0u;
            accessories = [(HMDHome *)selfCopy accessories];
            v25 = [accessories countByEnumeratingWithState:&v87 objects:v97 count:16];
            if (v25)
            {
              v26 = v25;
              v27 = *v88;
              do
              {
                for (i = 0; i != v26; ++i)
                {
                  if (*v88 != v27)
                  {
                    objc_enumerationMutation(accessories);
                  }

                  [v23 fixupForReplacementAccessory:*(*(&v87 + 1) + 8 * i) transaction:responseHandler];
                }

                v26 = [accessories countByEnumeratingWithState:&v87 objects:v97 count:16];
              }

              while (v26);
            }

            v29 = [v23 modelObjectWithChangeType:1];
            [responseHandler add:v29 withMessage:0];
            v30 = v23;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v31 = v30;
            }

            else
            {
              v31 = 0;
            }

            v32 = v31;
            v77 = v30;

            v85 = 0u;
            v86 = 0u;
            v83 = 0u;
            v84 = 0u;
            v75 = v32;
            events = [v32 events];
            v33 = [events countByEnumeratingWithState:&v83 objects:v96 count:16];
            if (v33)
            {
              v34 = v33;
              v35 = *v84;
              do
              {
                v36 = 0;
                v37 = v29;
                do
                {
                  if (*v84 != v35)
                  {
                    objc_enumerationMutation(events);
                  }

                  v38 = *(*(&v83 + 1) + 8 * v36);
                  v39 = objc_autoreleasePoolPush();
                  v40 = selfCopy;
                  v41 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
                  {
                    HMFGetLogIdentifier();
                    v43 = v42 = v35;
                    name2 = [v77 name];
                    *buf = 138543874;
                    v100 = v43;
                    v101 = 2112;
                    v102 = v38;
                    v103 = 2112;
                    v104 = name2;
                    _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Adding %@ to trigger %@", buf, 0x20u);

                    v35 = v42;
                  }

                  objc_autoreleasePoolPop(v39);
                  v29 = [v38 modelObjectWithChangeType:1];

                  responseHandler = v79;
                  [v79 add:v29 withMessage:0];
                  ++v36;
                  v37 = v29;
                }

                while (v34 != v36);
                v34 = [events countByEnumeratingWithState:&v83 objects:v96 count:16];
              }

              while (v34);
            }

            v45 = [HomeKitEventTriggerAddLogEvent alloc];
            uuid = [(HMDHome *)selfCopy uuid];
            v47 = [(HomeKitEventTriggerAddLogEvent *)v45 initWithHomeUUID:uuid];

            v48 = [[HMDAnalyticsEventTriggerData alloc] initWithEventTrigger:v75 isAdding:1];
            analyticsData = [(HomeKitEventTriggerAddLogEvent *)v47 analyticsData];
            [analyticsData setEventTrigger:v48];

            analyticsData2 = [(HomeKitEventTriggerAddLogEvent *)v47 analyticsData];
            [analyticsData2 setResultErrorCode:0];

            analyticsData3 = [(HomeKitEventTriggerAddLogEvent *)v47 analyticsData];
            [analyticsData3 setRequestOrigin:3];

            logEventSubmitter = [(HMDHome *)selfCopy logEventSubmitter];
            [logEventSubmitter submitLogEvent:v47];

            v22 = v76 + 1;
          }

          while (v76 + 1 != v74);
          v74 = [obj countByEnumeratingWithState:&v91 objects:v98 count:16];
        }

        while (v74);
      }

      v81[0] = MEMORY[0x277D85DD0];
      v81[1] = 3221225472;
      v81[2] = __30__HMDHome__handleAddTriggers___block_invoke;
      v81[3] = &unk_2797359D8;
      triggersCopy = v71;
      v82 = v71;
      [responseHandler run:v81];
      v53 = v82;
      v11 = v67;
    }

    else
    {
      triggersCopy = v71;
      if (v16)
      {
        v62 = HMFGetLogIdentifier();
        [v71 identifier];
        v64 = v63 = v11;
        uUIDString = [v64 UUIDString];
        *buf = 138543874;
        v100 = v62;
        v101 = 2112;
        v102 = uUIDString;
        v103 = 2112;
        v104 = v70;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive triggers from encoded triggers data: %@: %@", buf, 0x20u);

        v11 = v63;
        triggersCopy = v71;
      }

      objc_autoreleasePoolPop(v14);
      responseHandler = [triggersCopy responseHandler];
      v53 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (responseHandler)[2](responseHandler, v53, 0);
    }

    v5 = v69;
    v61 = v70;
    responseHandler2 = v68;
  }

  else
  {
    v54 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v56 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
    {
      v57 = HMFGetLogIdentifier();
      identifier = [triggersCopy identifier];
      uUIDString2 = [identifier UUIDString];
      *buf = 138543618;
      v100 = v57;
      v101 = 2112;
      v102 = uUIDString2;
      _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@Unable to find triggers to add for message: %@", buf, 0x16u);

      triggersCopy = v71;
      v5 = 0;
    }

    objc_autoreleasePoolPop(v54);
    responseHandler2 = [triggersCopy responseHandler];
    v61 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (responseHandler2)[2](responseHandler2, v61, 0);
  }

  v66 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTriggerModel:(id)model message:(id)message
{
  v19 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v8 = [[HMDTimerTrigger alloc] initWithModel:modelCopy home:self];
  if (v8)
  {
    createPayload = [modelCopy createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:messageCopy payloadAnnex:createPayload triggerModel:modelCopy];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create timer trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    createPayload = [messageCopy responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (createPayload)[2](createPayload, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTimerTrigger:(id)trigger
{
  v42 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  name = [triggerCopy name];
  v6 = [name isEqualToString:*MEMORY[0x277CCF200]];

  v7 = [triggerCopy stringForKey:*MEMORY[0x277CD2758]];
  if ([(HMDHome *)self _validateAddingNewTriggerWithName:v7 message:triggerCopy])
  {
    v8 = [triggerCopy stringForKey:*MEMORY[0x277CD1250]];
    uUID = [MEMORY[0x277CCAD78] UUID];
    v10 = [HMDTimerTriggerModel alloc];
    uuid = [(HMDHome *)self uuid];
    v12 = [(HMDBackingStoreModelObject *)v10 initWithObjectChangeType:1 uuid:uUID parentUUID:uuid];

    [(HMDTimerTriggerModel *)v12 setName:v7];
    [(HMDTimerTriggerModel *)v12 setConfiguredName:v8];
    [(HMDTimerTriggerModel *)v12 setActive:MEMORY[0x277CBEC28]];
    v13 = [HMDTimerTrigger validateTriggerModel:v12 message:triggerCopy currentFireDate:0];

    if (!v13)
    {
LABEL_21:

      goto LABEL_22;
    }

    v35 = uUID;
    v14 = v8;
    backingStore = [(HMDHome *)self backingStore];
    name2 = [triggerCopy name];
    v17 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v18 = [backingStore transaction:name2 options:v17];

    v19 = v6;
    if (v6)
    {
      v20 = objc_alloc_init(MEMORY[0x277CBEB38]);
      v21 = [(HMDHome *)self _populateTriggerModel:v13 fromBuilderMessage:triggerCopy transaction:v18 responsePayload:v20];
      v22 = v18;
      v8 = v14;
      uUID = v35;
      if (!v21)
      {
LABEL_20:

        goto LABEL_21;
      }
    }

    else
    {
      v20 = 0;
      v22 = v18;
      v8 = v14;
      uUID = v35;
    }

    currentUser = [(HMDHome *)self currentUser];
    [v13 setOwner:currentUser];

    currentDevice = [(HMDHome *)self currentDevice];
    [v13 setOwningDevice:currentDevice];

    if ([(HMDHome *)self isOwnerUser])
    {
      if (v19)
      {
        [v22 add:v13];
        v36[0] = MEMORY[0x277D85DD0];
        v36[1] = 3221225472;
        v36[2] = __34__HMDHome__handleAddTimerTrigger___block_invoke;
        v36[3] = &unk_279734D88;
        v37 = triggerCopy;
        v20 = v20;
        v38 = v20;
        v39 = v13;
        [v22 run:v36];
      }

      else
      {
        [v22 add:v13 withMessage:triggerCopy];
        [v22 run];
      }
    }

    else if ([(HMDHome *)self isAdminUser])
    {
      v29 = v22;
      [(HMDHome *)self transactionObjectUpdated:0 newValues:v13 message:triggerCopy];
      uuid2 = [v13 uuid];
      v31 = [(HMDHome *)self triggerWithUUID:uuid2];

      if (v31)
      {
        [(HMDHome *)self _relayAddTriggerToResident:v31];
      }

      v22 = v29;
    }

    else
    {
      responseHandler = [triggerCopy responseHandler];

      if (responseHandler)
      {
        v33 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
        [triggerCopy respondWithError:v33];
      }
    }

    goto LABEL_20;
  }

  v23 = objc_autoreleasePoolPush();
  selfCopy = self;
  v25 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    v26 = HMFGetLogIdentifier();
    *buf = 138543362;
    v41 = v26;
    _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Trigger name is not valid", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v23);
LABEL_22:

  v34 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddTimerTrigger___block_invoke(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayload];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 32);
    v7 = [*(a1 + 40) copy];
    [v6 respondWithPayload:v7];
  }
}

- (void)_relayAddTriggerToResident:(id)resident
{
  v24[1] = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  v24[0] = residentCopy;
  v5 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:1];
  v6 = encodeRootObject();

  v22 = @"HM.triggers";
  v23 = v6;
  v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
  objc_initWeak(&location, self);
  v8 = MEMORY[0x277D0F848];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke;
  v18[3] = &unk_279733AE8;
  objc_copyWeak(&v20, &location);
  v9 = residentCopy;
  v19 = v9;
  v10 = [v8 messageWithName:@"kAddTriggersInternalRequestKey" messagePayload:v7 responseHandler:v18];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:uuid];

  [v10 setDestination:v13];
  [v10 setQualityOfService:33];
  administratorHandler = [(HMDHome *)self administratorHandler];
  v15 = [v10 copy];
  v16 = [administratorHandler operationForMessage:v15 error:0];

  if (v16)
  {
    [administratorHandler addOperation:v16];
  }

  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);

  v17 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = @"kAddTriggersInternalRequestKey";
      v20 = 2112;
      v21 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    if (v5)
    {
      v12 = [v9 workQueue];
      v14[0] = MEMORY[0x277D85DD0];
      v14[1] = 3221225472;
      v14[2] = __38__HMDHome__relayAddTriggerToResident___block_invoke_1393;
      v14[3] = &unk_2797359B0;
      v14[4] = v9;
      v15 = *(a1 + 32);
      dispatch_async(v12, v14);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__relayAddTriggerToResident___block_invoke_1393(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v15 = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing trigger that was not added to resident: %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = [HMDTriggerModel alloc];
  v8 = [*(a1 + 40) uuid];
  v9 = [*(a1 + 32) uuid];
  v10 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v8 parentUUID:v9];

  v11 = [*(a1 + 32) backingStore];
  v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v13 = [v11 transaction:@"relayAddTrigger" options:v12];

  [v13 add:v10 withMessage:0];
  [v13 run];

  v14 = *MEMORY[0x277D85DE8];
}

- (BOOL)_validateAddingNewTriggerWithName:(id)name message:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  nameCopy = name;
  messageCopy = message;
  if (nameCopy)
  {
    if ([nameCopy length])
    {
      v8 = HMMaxLengthForNaming();
      if ([nameCopy length] > v8)
      {
        v9 = objc_autoreleasePoolPush();
        selfCopy = self;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
        {
          v12 = HMFGetLogIdentifier();
          v30 = 138543362;
          v31 = v12;
          _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v30, 0xCu);
        }

        objc_autoreleasePoolPop(v9);
        v13 = MEMORY[0x277CCA9B8];
        v14 = 46;
        goto LABEL_9;
      }

      v19 = [(HMDHome *)self triggerWithName:nameCopy];
      if (v19)
      {
        v20 = MEMORY[0x277CCA9B8];
        v21 = 1;
      }

      else
      {
        triggers = [(HMDHome *)self triggers];
        v23 = [triggers count];
        v24 = maximumTriggersPerHome;

        if (v23 < v24)
        {
          v16 = 1;
LABEL_19:

          goto LABEL_10;
        }

        v25 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          v30 = 138543618;
          v31 = v28;
          v32 = 2112;
          v33 = nameCopy;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Can't add trigger %@; already at maximum triggers for home", &v30, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        v20 = MEMORY[0x277CCA9B8];
        v21 = 49;
      }

      v29 = [v20 hmErrorWithCode:v21];
      [messageCopy respondWithError:v29];

      v16 = 0;
      goto LABEL_19;
    }

    v13 = MEMORY[0x277CCA9B8];
    v14 = 3;
  }

  else
  {
    v13 = MEMORY[0x277CCA9B8];
    v14 = 20;
  }

LABEL_9:
  v15 = [v13 hmErrorWithCode:v14];
  [messageCopy respondWithError:v15];

  v16 = 0;
LABEL_10:

  v17 = *MEMORY[0x277D85DE8];
  return v16;
}

- (void)_handleAddEventTriggerModel:(id)model message:(id)message
{
  v19 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v8 = [[HMDEventTrigger alloc] initWithModel:modelCopy home:self message:messageCopy];
  if (v8)
  {
    createPayload = [modelCopy createPayload];
    [(HMDHome *)self _addNewTrigger:v8 message:messageCopy payloadAnnex:createPayload triggerModel:modelCopy];
LABEL_7:

    goto LABEL_8;
  }

  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v17 = 138543362;
    v18 = v13;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Could not create event trigger object from model", &v17, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    createPayload = [messageCopy responseHandler];
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    (createPayload)[2](createPayload, v15, 0);

    goto LABEL_7;
  }

LABEL_8:

  v16 = *MEMORY[0x277D85DE8];
}

- (BOOL)_populateTriggerModel:(id)model fromBuilderMessage:(id)message transaction:(id)transaction responsePayload:(id)payload
{
  v76 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  transactionCopy = transaction;
  payloadCopy = payload;
  v12 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(messageCopy, "BOOLForKey:", *MEMORY[0x277CD2730])}];
  [modelCopy setActive:v12];

  v13 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(messageCopy, "BOOLForKey:", *MEMORY[0x277CD1260])}];
  [modelCopy setAutoDelete:v13];

  v64 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  v70 = 0u;
  v61 = messageCopy;
  obj = [messageCopy arrayForKey:*MEMORY[0x277CD2728]];
  v14 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v68;
    v59 = modelCopy;
    while (2)
    {
      for (i = 0; i != v15; ++i)
      {
        if (*v68 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v67 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v19 = v18;
        }

        else
        {
          v19 = 0;
        }

        v20 = v19;

        if (!v20)
        {
          goto LABEL_18;
        }

        v21 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v20];
        if (!v21)
        {
          v20 = v18;
LABEL_18:
          v40 = objc_autoreleasePoolPush();
          selfCopy = self;
          v42 = HMFGetOSLogHandle();
          v29 = transactionCopy;
          v28 = v61;
          if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
          {
            v43 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v43;
            v73 = 2112;
            v74 = v20;
            _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, "%{public}@Invalid ActionSet reference: '%@'", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v40);
          v44 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [v61 respondWithError:v44];

          v45 = 0;
          modelCopy = v59;
          goto LABEL_29;
        }

        v22 = v21;
        v23 = [(HMDHome *)self actionSetWithUUID:v21];
        if (!v23)
        {
          v46 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v48 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
          {
            v49 = HMFGetLogIdentifier();
            *buf = 138543618;
            v72 = v49;
            v73 = 2112;
            v74 = v22;
            _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_ERROR, "%{public}@Failed to resolve ActionSet reference: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v46);
          v50 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
          v28 = v61;
          [v61 respondWithError:v50];

          v45 = 0;
          modelCopy = v59;
          v29 = transactionCopy;
          goto LABEL_29;
        }

        v24 = v23;
        uuid = [v23 uuid];
        uUIDString = [uuid UUIDString];
        [v64 addObject:uUIDString];
      }

      v15 = [obj countByEnumeratingWithState:&v67 objects:v75 count:16];
      modelCopy = v59;
      if (v15)
      {
        continue;
      }

      break;
    }
  }

  v27 = *MEMORY[0x277CD2760];
  v28 = v61;
  [v61 dictionaryForKey:*MEMORY[0x277CD2760]];
  obj = v29 = transactionCopy;
  if (!obj)
  {
    goto LABEL_28;
  }

  uUID = [MEMORY[0x277CCAD78] UUID];
  v31 = [MEMORY[0x277CCAD78] hm_deriveUUIDFromBaseUUID:uUID];
  uUIDString2 = [v31 UUIDString];

  v33 = *MEMORY[0x277CCF1A0];
  v65 = 0;
  v66 = 0;
  selfCopy3 = self;
  v35 = uUIDString2;
  v36 = [(HMDHome *)selfCopy3 _createActionSetWithUUID:uUID name:uUIDString2 type:v33 fromDictionary:obj transaction:transactionCopy response:&v66 error:&v65];
  v37 = v66;
  v38 = v65;

  if (v36)
  {
    [payloadCopy setObject:v37 forKeyedSubscript:v27];
    uUIDString3 = [uUID UUIDString];
    [v64 addObject:uUIDString3];
  }

  else
  {
    v58 = v35;
    v51 = modelCopy;
    context = objc_autoreleasePoolPush();
    v52 = selfCopy3;
    v53 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v53, OS_LOG_TYPE_ERROR))
    {
      v54 = HMFGetLogIdentifier();
      *buf = 138543362;
      v72 = v54;
      _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_ERROR, "%{public}@Failed to create trigger-owned action set", buf, 0xCu);
    }

    objc_autoreleasePoolPop(context);
    [v61 respondWithError:v38];
    modelCopy = v51;
    v35 = v58;
  }

  if (!v36)
  {
    v45 = 0;
  }

  else
  {
LABEL_28:
    v20 = [v64 copy];
    [modelCopy setCurrentActionSets:v20];
    v45 = 1;
LABEL_29:
  }

  v55 = *MEMORY[0x277D85DE8];
  return v45;
}

- (HMDActionSet)_createActionSetWithUUID:(void *)d name:(void *)name type:(void *)type fromDictionary:(void *)dictionary transaction:(void *)transaction response:(void *)response error:
{
  v69 = *MEMORY[0x277D85DE8];
  v13 = a2;
  dCopy = d;
  nameCopy = name;
  typeCopy = type;
  dictionaryCopy = dictionary;
  v57 = typeCopy;
  v59 = dictionaryCopy;
  if (self)
  {
    v18 = dictionaryCopy;
    v55 = nameCopy;
    v19 = [[HMDActionSet alloc] initWithName:dCopy uuid:v13 type:nameCopy home:self queue:0];
    v20 = [(HMDActionSet *)v19 modelObjectWithChangeType:1];
    [v18 add:v20];

    v21 = [typeCopy hmf_arrayForKey:*MEMORY[0x277CD2030]];
    v22 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(v21, "count")}];
    v60 = 0u;
    v61 = 0u;
    v62 = 0u;
    v63 = 0u;
    obj = v21;
    v23 = [obj countByEnumeratingWithState:&v60 objects:v68 count:16];
    if (v23)
    {
      v24 = v23;
      v25 = *v61;
      v54 = v13;
LABEL_4:
      v26 = 0;
      while (1)
      {
        if (*v61 != v25)
        {
          objc_enumerationMutation(obj);
        }

        v27 = *(*(&v60 + 1) + 8 * v26);
        objc_opt_class();
        v28 = (objc_opt_isKindOfClass() & 1) != 0 ? v27 : 0;
        v29 = v28;

        if (!v29)
        {
          break;
        }

        v30 = [self actionWithDictionaryRepresentation:v29];
        if (!v30)
        {
          v43 = objc_autoreleasePoolPush();
          selfCopy = self;
          v45 = HMFGetOSLogHandle();
          v13 = v54;
          nameCopy = v55;
          if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
          {
            v46 = HMFGetLogIdentifier();
            *buf = 138543618;
            v65 = v46;
            v66 = 2112;
            v67 = v29;
            _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v43);
          if (response)
          {
            *response = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          }

          v42 = obj;
LABEL_30:

          v37 = 0;
          goto LABEL_40;
        }

        v31 = v30;
        [v22 addObject:v30];
        [v31 updateActionSetIfNil:v19];
        v32 = [v31 modelObjectWithChangeType:1];
        [v59 add:v32];

        if (v24 == ++v26)
        {
          v24 = [obj countByEnumeratingWithState:&v60 objects:v68 count:16];
          v13 = v54;
          if (v24)
          {
            goto LABEL_4;
          }

          goto LABEL_14;
        }
      }

      v38 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v40 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
      {
        v41 = HMFGetLogIdentifier();
        *buf = 138543618;
        v65 = v41;
        v66 = 2112;
        v67 = dCopy;
        _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; invalid serialized action", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v38);
      v13 = v54;
      nameCopy = v55;
      v42 = obj;
      if (response)
      {
        *response = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      }

      goto LABEL_30;
    }

LABEL_14:

    [(HMDActionSet *)v19 setActions:v22];
    if ([self validateActionsDoNotConflict:v22])
    {
      v33 = [v57 hmd_appDataDictionaryWithError:response];
      if (v33)
      {
        v34 = [HMDApplicationDataModel modelWithAppDataPayload:v33 existingAppData:0 parentUUID:v13];
        if (v34)
        {
          [v59 add:v34];
        }

        nameCopy = v55;
        if (transaction)
        {
          createPayload = [(HMDActionSet *)v19 createPayload];
          v36 = [createPayload mutableCopy];

          [v36 setObject:v33 forKeyedSubscript:@"kAppDataInformationKey"];
          *transaction = [v36 copy];
        }

        v37 = v19;
      }

      else
      {
        v37 = 0;
        nameCopy = v55;
      }
    }

    else
    {
      v47 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v49 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
      {
        v50 = HMFGetLogIdentifier();
        *buf = 138543618;
        v65 = v50;
        v66 = 2112;
        v67 = dCopy;
        _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; conflicting actions", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v47);
      if (response)
      {
        [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
        *response = v37 = 0;
      }

      else
      {
        v37 = 0;
      }

      nameCopy = v55;
    }

    v42 = obj;
LABEL_40:
  }

  else
  {
    v37 = 0;
  }

  v51 = *MEMORY[0x277D85DE8];

  return v37;
}

- (void)_handleAddEventTrigger:(id)trigger
{
  v84 = *MEMORY[0x277D85DE8];
  triggerCopy = trigger;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v79 = v8;
    v80 = 2112;
    v81 = triggerCopy;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received message %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = objc_autoreleasePoolPush();
  v10 = selfCopy;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    messagePayload = [triggerCopy messagePayload];
    *buf = 138543618;
    v79 = v12;
    v80 = 2112;
    v81 = messagePayload;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Add event trigger payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  name = [triggerCopy name];
  v15 = [name isEqualToString:*MEMORY[0x277CCF1F0]];

  v16 = [triggerCopy stringForKey:*MEMORY[0x277CD2758]];
  v58 = [triggerCopy stringForKey:*MEMORY[0x277CD1250]];
  v59 = [triggerCopy uuidForKey:*MEMORY[0x277CD0B10]];
  v62 = [triggerCopy predicateForKey:*MEMORY[0x277CD2298]];
  v17 = *MEMORY[0x277CD22C8];
  v18 = [triggerCopy numberForKey:*MEMORY[0x277CD22C8]];
  v19 = v18;
  if (v18)
  {
    [v18 unsignedIntegerValue];
    HMDaysOfTheWeekToDateComponents();
  }

  else
  {
    [triggerCopy arrayOfDateComponentsForKey:v17];
  }
  v61 = ;
  currentUser = [(HMDHome *)v10 currentUser];
  v20 = [HMDEventTriggerModel alloc];
  uuid = [(HMDHome *)v10 uuid];
  v22 = [(HMDBackingStoreModelObject *)v20 initWithObjectChangeType:1 uuid:v59 parentUUID:uuid];

  [(HMDEventTriggerModel *)v22 setName:v16];
  [(HMDEventTriggerModel *)v22 setConfiguredName:v58];
  [(HMDEventTriggerModel *)v22 setActive:MEMORY[0x277CBEC28]];
  [(HMDEventTriggerModel *)v22 setOwner:currentUser];
  currentDevice = [(HMDHome *)v10 currentDevice];
  [(HMDEventTriggerModel *)v22 setOwningDevice:currentDevice];

  if (v62)
  {
    predicateUtility = [(HMDHome *)v10 predicateUtility];
    v25 = [predicateUtility rewritePredicateForDaemon:v62 message:triggerCopy];

    v26 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v25 requiringSecureCoding:1 error:0];
    [(HMDEventTriggerModel *)v22 setEvaluationCondition:v26];
  }

  v27 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v61 requiringSecureCoding:1 error:0];
  [(HMDEventTriggerModel *)v22 setRecurrences:v27];

  v28 = [triggerCopy mutableCopy];
  objc_initWeak(&location, v10);
  v72[0] = MEMORY[0x277D85DD0];
  v72[1] = 3221225472;
  v72[2] = __34__HMDHome__handleAddEventTrigger___block_invoke;
  v72[3] = &unk_279722608;
  objc_copyWeak(&v75, &location);
  v29 = triggerCopy;
  v73 = v29;
  v30 = v22;
  v74 = v30;
  v76 = v15;
  [v28 setResponseHandler:v72];
  if ([(HMDHome *)v10 _validateAddingNewTriggerWithName:v16 message:v28])
  {
    if (!v19 && ![HMDEventTrigger __validateRecurrences:v61])
    {
      v42 = objc_autoreleasePoolPush();
      v43 = v10;
      v44 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        v45 = HMFGetLogIdentifier();
        *buf = 138543618;
        v79 = v45;
        v80 = 2112;
        v81 = v61;
        _os_log_impl(&dword_2531F8000, v44, OS_LOG_TYPE_ERROR, "%{public}@Received invalid values for recurrences: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v42);
      v34 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [v28 respondWithError:v34];
      goto LABEL_40;
    }

    backingStore = [(HMDHome *)v10 backingStore];
    name2 = [v29 name];
    v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v57 = [backingStore transaction:name2 options:v33];

    if (v15)
    {
      v34 = objc_alloc_init(MEMORY[0x277CBEB38]);
      if (![(HMDHome *)v10 _populateTriggerModel:v30 fromBuilderMessage:v28 transaction:v57 responsePayload:v34])
      {
LABEL_39:

LABEL_40:
        goto LABEL_41;
      }

      v35 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v29, "BOOLForKey:", *MEMORY[0x277CD22B8])}];
      [(HMDEventTriggerModel *)v30 setExecuteOnce:v35];
    }

    else
    {
      v34 = 0;
    }

    v36 = [[HMDEventTrigger alloc] initWithModel:v30 home:v10 message:v29];
    v37 = v36;
    if (v15)
    {
      v38 = v57;
    }

    else
    {
      v38 = 0;
    }

    v71 = 0;
    v39 = [(HMDEventTrigger *)v36 addEventsFromMessage:v29 preserveUUIDs:v15 ^ 1u transaction:v38 error:&v71];
    v40 = v71;
    v56 = v40;
    if (v39)
    {
      if ([(HMDEventTrigger *)v37 requiresDataVersion4]&& ![(HMDEventTrigger *)v37 checkSharedEventTriggerActivationResidentRequirement:v29])
      {
        v55 = v37;
        context = objc_autoreleasePoolPush();
        v47 = v10;
        v48 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
        {
          v53 = v34;
          v49 = HMFGetLogIdentifier();
          primaryResident = [(HMDHome *)v47 primaryResident];
          device = [primaryResident device];
          *buf = 138543874;
          v79 = v49;
          v80 = 2112;
          v81 = device;
          v82 = 2112;
          v83 = v55;
          _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Current resident device %@ does not support shared activation, cannot add the trigger %@", buf, 0x20u);

          v34 = v53;
        }

        objc_autoreleasePoolPop(context);
        v37 = v55;
        goto LABEL_38;
      }

      if ([(HMDHome *)v10 isOwnerUser])
      {
        if (!v15)
        {
          [v57 add:v30 withMessage:v28];
          [v57 run];
          goto LABEL_38;
        }

        [v57 add:v30];
        v63[0] = MEMORY[0x277D85DD0];
        v63[1] = 3221225472;
        v63[2] = __34__HMDHome__handleAddEventTrigger___block_invoke_1392;
        v63[3] = &unk_279722630;
        v64 = v28;
        v65 = v34;
        v66 = v30;
        v67 = v62;
        v68 = v10;
        v69 = v37;
        v70 = currentUser;
        [v57 run:v63];

        v41 = v64;
        goto LABEL_33;
      }

      if ([(HMDHome *)v10 isAdminUser])
      {
        [(HMDHome *)v10 transactionObjectUpdated:0 newValues:v30 message:v28];
        uuid2 = [(HMDBackingStoreModelObject *)v30 uuid];
        v41 = [(HMDHome *)v10 triggerWithUUID:uuid2];

        if (v41)
        {
          [(HMDHome *)v10 _relayAddTriggerToResident:v41];
        }

LABEL_33:
      }
    }

    else
    {
      [v28 respondWithError:v40];
    }

LABEL_38:

    goto LABEL_39;
  }

LABEL_41:

  objc_destroyWeak(&v75);
  objc_destroyWeak(&location);

  v52 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v34 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v28 = 138543874;
    v29 = v11;
    v30 = 2112;
    v31 = v6;
    v32 = 2112;
    v33 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Responding to the client about add event trigger status : Payload : [%@], error : [%@]", &v28, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) respondWithPayload:v6 error:v5];
  if (v9)
  {
    v12 = [[HMDEventTrigger alloc] initWithModel:*(a1 + 40) home:v9 message:*(a1 + 32)];
    v13 = 1;
    [(HMDEventTrigger *)v12 addEventsFromMessage:*(a1 + 32) preserveUUIDs:(*(a1 + 56) & 1) == 0 transaction:0 error:0];
    v14 = [HomeKitEventTriggerAddLogEvent alloc];
    v15 = [v9 uuid];
    v16 = [(HomeKitEventTriggerAddLogEvent *)v14 initWithHomeUUID:v15];

    v17 = [[HMDAnalyticsEventTriggerData alloc] initWithEventTrigger:v12 isAdding:1];
    v18 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v18 setEventTrigger:v17];

    v19 = [v5 code];
    v20 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v20 setResultErrorCode:v19];

    if (([v9 isOwnerUser] & 1) == 0)
    {
      if (![v9 isAdminUser])
      {
LABEL_8:
        v22 = objc_autoreleasePoolPush();
        v23 = v9;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          v25 = HMFGetLogIdentifier();
          v28 = 138543618;
          v29 = v25;
          v30 = 2112;
          v31 = v16;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Prepared the metric %@, submitting", &v28, 0x16u);
        }

        objc_autoreleasePoolPop(v22);
        v26 = [v23 logEventSubmitter];
        [v26 submitLogEvent:v16];

        goto LABEL_11;
      }

      v13 = 2;
    }

    v21 = [(HomeKitEventTriggerAddLogEvent *)v16 analyticsData];
    [v21 setRequestOrigin:v13];

    goto LABEL_8;
  }

LABEL_11:

  v27 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddEventTrigger___block_invoke_1392(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    v3 = *(a1 + 32);

    [v3 respondWithError:a2];
  }

  else
  {
    v4 = *(a1 + 40);
    v5 = [*(a1 + 48) createPayloadWithCondition:*(a1 + 56)];
    [v4 addEntriesFromDictionary:v5];

    v6 = *(a1 + 64);
    v7 = [*(a1 + 72) triggerEvents];
    v8 = [(HMDHome *)v6 _createEventsPayload:v7];
    [*(a1 + 40) setObject:v8 forKeyedSubscript:*MEMORY[0x277CD22B0]];

    v9 = *(a1 + 64);
    v10 = [*(a1 + 72) endEvents];
    v11 = [(HMDHome *)v9 _createEventsPayload:v10];
    [*(a1 + 40) setObject:v11 forKeyedSubscript:*MEMORY[0x277CD22A8]];

    v12 = [*(a1 + 80) uuid];
    v13 = [v12 UUIDString];
    [*(a1 + 40) setObject:v13 forKeyedSubscript:*MEMORY[0x277CD1268]];

    v14 = *(a1 + 32);
    v15 = [*(a1 + 40) copy];
    [v14 respondWithPayload:v15];
  }
}

- (id)_createEventsPayload:(uint64_t)payload
{
  v19 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (payload)
  {
    v4 = objc_alloc_init(MEMORY[0x277CBEB18]);
    v14 = 0u;
    v15 = 0u;
    v16 = 0u;
    v17 = 0u;
    v5 = v3;
    v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v15;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v15 != v8)
          {
            objc_enumerationMutation(v5);
          }

          createPayload = [*(*(&v14 + 1) + 8 * i) createPayload];
          [v4 addObject:createPayload];
        }

        v7 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
      }

      while (v7);
    }

    v11 = [v4 copy];
  }

  else
  {
    v11 = 0;
  }

  v12 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)_updateAndGetOwnedTriggers
{
  v18 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  triggers = [(HMDHome *)self triggers];
  v5 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v5)
  {
    v6 = *v14;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(triggers);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        if ([v8 isOwnedByThisDevice])
        {
          uuid = [v8 uuid];
          [array addObject:uuid];
        }
      }

      v5 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v5);
  }

  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_ownedTriggers setArray:array];
  os_unfair_recursive_lock_unlock();
  v10 = [array copy];

  v11 = *MEMORY[0x277D85DE8];

  return v10;
}

- (void)_handleExecuteActionSet:(id)set
{
  setCopy = set;
  v4 = [setCopy uuidForKey:*MEMORY[0x277CD2050]];
  v5 = [(HMDHome *)self actionSetWithUUID:v4];
  if (v5 || isInternalBuild() && ([(HMDHome *)self triggerOwnedActionSetWithUUID:v4], (v5 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v6 = v5;
    type = [v5 type];
    if ([type isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      v8 = isInternalBuild();

      if ((v8 & 1) == 0)
      {
        responseHandler = [setCopy responseHandler];
        v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        (responseHandler)[2](responseHandler, v10, 0);

        goto LABEL_10;
      }
    }

    else
    {
    }

    responseHandler = +[HMDDonationHandler sharedDonationHandler];
    [responseHandler donateActionSet:v6 withMessage:setCopy];
    [v6 execute:setCopy];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
    responseHandler = [setCopy responseHandler];
    (responseHandler)[2](responseHandler, v6, 0);
  }

LABEL_10:
}

- (void)executeActionSet:(id)set
{
  setCopy = set;
  v6 = objc_alloc(MEMORY[0x277D0F770]);
  v7 = MEMORY[0x277CCACA8];
  v8 = MEMORY[0x259C01AE0](self, a2);
  17891 = [v7 stringWithFormat:@"%@, %s:%ld", v8, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 17891];
  v10 = [v6 initWithName:17891];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __28__HMDHome_executeActionSet___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v15 = setCopy;
  v16 = v10;
  v12 = v10;
  v13 = setCopy;
  dispatch_async(workQueue, block);
}

void __28__HMDHome_executeActionSet___block_invoke(id *a1)
{
  objc_initWeak(&location, a1[4]);
  v7 = MEMORY[0x277D85DD0];
  v8 = 3221225472;
  v9 = __28__HMDHome_executeActionSet___block_invoke_2;
  v10 = &unk_279732670;
  objc_copyWeak(&v13, &location);
  v11 = a1[5];
  v12 = a1[6];
  v2 = _Block_copy(&v7);
  if ([a1[4] _shouldWaitForAccessoriesToBeReachable])
  {
    v3 = [a1[5] uuidForKey:*MEMORY[0x277CD2050]];
    v4 = [a1[4] actionSetWithUUID:v3];
    v5 = [a1[4] workQueue];
    v6 = [HMDHomeAssistantOperation homeAssistantOperationWithActionSet:v4 queue:v5];

    [a1[4] _performOperation:v6 completion:v2];
  }

  else
  {
    v2[2](v2);
  }

  objc_destroyWeak(&v13);
  objc_destroyWeak(&location);
}

void __28__HMDHome_executeActionSet___block_invoke_2(id *a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (WeakRetained)
  {
    [a1[5] begin];
    [WeakRetained _handleExecuteActionSet:a1[4]];
    [a1[5] end];
  }

  else
  {
    v3 = [a1[4] responseHandler];

    if (v3)
    {
      v4 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
      v5 = [a1[4] responseHandler];
      (v5)[2](v5, v4, 0);
    }

    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Home does not exist anymore, cannot execute action set", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveActionSetModel:(id)model message:(id)message
{
  v57 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v42 = modelCopy;
  uuid = [modelCopy uuid];
  v7 = [(HMDHome *)self actionSetWithUUID:uuid];
  if (v7 || ([(HMDHome *)self triggerOwnedActionSetWithUUID:uuid], (v7 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    name = [v7 name];
    v9 = [(HMDHome *)self removeName:name];

    v48 = 0u;
    v49 = 0u;
    v46 = 0u;
    v47 = 0u;
    triggers = [(HMDHome *)self triggers];
    v11 = [triggers countByEnumeratingWithState:&v46 objects:v52 count:16];
    if (v11)
    {
      v12 = *v47;
      do
      {
        v13 = 0;
        do
        {
          if (*v47 != v12)
          {
            objc_enumerationMutation(triggers);
          }

          [*(*(&v46 + 1) + 8 * v13++) removeActionSet:v7 postUpdate:1];
        }

        while (v11 != v13);
        v11 = [triggers countByEnumeratingWithState:&v46 objects:v52 count:16];
      }

      while (v11);
    }

    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    type = [v7 type];
    v15 = [type isEqualToString:*MEMORY[0x277CCF1A0]];

    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    v19 = os_log_type_enabled(v18, OS_LOG_TYPE_INFO);
    if (v15)
    {
      if (v19)
      {
        v20 = HMFGetLogIdentifier();
        name2 = [v7 name];
        *buf = 138543618;
        v54 = v20;
        v55 = 2112;
        v56 = name2;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Remove trigger owned action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)selfCopy->_triggerOwnedActionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      if (v19)
      {
        v22 = HMFGetLogIdentifier();
        name3 = [v7 name];
        *buf = 138543618;
        v54 = v22;
        v55 = 2112;
        v56 = name3;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Remove action set: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      os_unfair_recursive_lock_lock_with_options();
      [(NSMutableArray *)selfCopy->_actionSets removeObject:v7];
      os_unfair_recursive_lock_unlock();
      [transactionResult markSaveToAssistant];
    }

    [v7 invalidate];
    v50[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid2 UUIDString];
    v51[0] = uUIDString;
    v50[1] = *MEMORY[0x277CD2040];
    name4 = [v7 name];
    v51[1] = name4;
    v50[2] = *MEMORY[0x277CD2050];
    uUIDString2 = [uuid UUIDString];
    v51[2] = uUIDString2;
    v50[3] = *MEMORY[0x277CCF150];
    spiClientIdentifier = [v7 spiClientIdentifier];
    uUIDString3 = [spiClientIdentifier UUIDString];
    v51[3] = uUIDString3;
    v50[4] = *MEMORY[0x277CCF128];
    urlString = [v7 urlString];
    v51[4] = urlString;
    v31 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v51 forKeys:v50 count:5];

    logAndPostNotification(@"HMDActionSetRemovedNotification", selfCopy, v31);
    [messageCopy respondWithPayload:v31];
    v32 = objc_autoreleasePoolPush();
    v33 = selfCopy;
    v34 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
    {
      v35 = HMFGetLogIdentifier();
      *buf = 138543618;
      v54 = v35;
      v55 = 2112;
      v56 = v31;
      _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_INFO, "%{public}@Responding back to clients after removing actionSet: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v32);
  }

  else
  {
    v37 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v39 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v39, OS_LOG_TYPE_ERROR))
    {
      v40 = HMFGetLogIdentifier();
      uUIDString4 = [uuid UUIDString];
      *buf = 138543618;
      v54 = v40;
      v55 = 2112;
      v56 = uUIDString4;
      _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_ERROR, "%{public}@Count not find action set with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v37);
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v7];
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveActionSet:(id)set
{
  v41 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = [setCopy uuidForKey:*MEMORY[0x277CD2050]];
  v6 = [(HMDHome *)self actionSetWithUUID:v5];
  v7 = v6;
  if (!v6)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v19;
      v39 = 2112;
      v40 = v5;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Did not find the action set with UUID : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  type = [v6 type];
  v9 = [type isEqualToString:*MEMORY[0x277CCF1A0]];

  if (v9)
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      v37 = 138543618;
      v38 = v13;
      v39 = 2112;
      v40 = v7;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Removing this action Set is not supported. : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
LABEL_9:
    v20 = [v14 hmErrorWithCode:v15];
    [setCopy respondWithError:v20];
    goto LABEL_16;
  }

  v20 = +[HMDHome getBuiltinActionSets];
  type2 = [v7 type];
  v22 = [v20 objectForKey:type2];

  if (v22)
  {
    v23 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:83 userInfo:0];
    responseHandler = [setCopy responseHandler];
    (responseHandler)[2](responseHandler, v23, 0);

    v25 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v27 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      type3 = [v7 type];
      v37 = 138543618;
      v38 = v28;
      v39 = 2112;
      v40 = type3;
      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Cannot remove built in action set : %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v25);
    [setCopy respondWithError:v23];
  }

  else
  {
    v30 = [HMDActionSetModel alloc];
    uuid = [(HMDHome *)self uuid];
    v23 = [(HMDBackingStoreModelObject *)v30 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid];

    backingStore = [(HMDHome *)self backingStore];
    name = [setCopy name];
    v34 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v35 = [backingStore transaction:name options:v34];

    [v35 add:v23 withMessage:setCopy];
    [v35 run];
  }

LABEL_16:
  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetModel:(id)model message:(id)message
{
  v56 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  selfCopy = self;
  v8 = modelCopy;
  name = [v8 name];
  if (name)
  {
    uuid = [v8 uuid];
    type = [v8 type];
    if (type)
    {
      type2 = [v8 type];
    }

    else
    {
      type2 = *MEMORY[0x277CCF1A8];
    }

    v17 = type2;

    v48 = [(HMDHome *)selfCopy createActionSetWithName:name uuid:uuid type:v17];
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = selfCopy;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v16;
      *&buf[12] = 2112;
      *&buf[14] = v8;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@ActionSet model does not have a name %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v48 = 0;
  }

  if (v48)
  {
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    type3 = [v8 type];
    v19 = [type3 isEqualToString:*MEMORY[0x277CCF1A0]];

    os_unfair_recursive_lock_lock_with_options();
    if (v19)
    {
      v20 = v48;
      [(NSMutableArray *)selfCopy->_triggerOwnedActionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
    }

    else
    {
      [(NSMutableArray *)selfCopy->_actionSets addObject:v48];
      os_unfair_recursive_lock_unlock();
      actions = [v48 actions];
      v26 = [actions count];

      v20 = v48;
      if (v26)
      {
        [transactionResult markSaveToAssistant];
        v20 = v48;
      }
    }

    v27 = selfCopy;
    v28 = v20;
    v45 = messageCopy;
    context = objc_autoreleasePoolPush();
    v53[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)v27 uuid];
    uUIDString = [uuid2 UUIDString];
    *buf = uUIDString;
    v53[1] = *MEMORY[0x277CD2040];
    name2 = [v28 name];
    *&buf[8] = name2;
    v53[2] = *MEMORY[0x277CD2050];
    uuid3 = [v28 uuid];
    uUIDString2 = [uuid3 UUIDString];
    *&buf[16] = uUIDString2;
    v53[3] = *MEMORY[0x277CD2048];
    type4 = [v28 type];
    v55 = type4;
    v35 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:buf forKeys:v53 count:4];

    v36 = objc_autoreleasePoolPush();
    v37 = v27;
    v38 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
    {
      v39 = HMFGetLogIdentifier();
      *v49 = 138543618;
      v50 = v39;
      v51 = 2112;
      v52 = v35;
      _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Add action set finished. Responding to clients with : %@", v49, 0x16u);
    }

    objc_autoreleasePoolPop(v36);
    v40 = [MEMORY[0x277CBEB38] dictionaryWithDictionary:v35];
    [v40 setObject:v28 forKeyedSubscript:@"HMDActionSetNotificationKey"];
    notificationCenter = [(HMDHome *)v37 notificationCenter];
    v42 = [v40 copy];
    [notificationCenter postNotificationName:@"HMDActionSetAddedNotification" object:v37 userInfo:v42];

    [v45 respondWithPayload:v35];
    objc_autoreleasePoolPop(context);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = selfCopy;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = messageCopy;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Unable to create action set model. %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
  }

  v43 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddHomeOwnedActionSet:(id)set
{
  v51 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v45 = 138543362;
    v46 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set", &v45, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = *MEMORY[0x277CD2040];
  v10 = [setCopy stringForKey:*MEMORY[0x277CD2040]];
  v11 = [(HMDHome *)selfCopy actionSetWithName:v10];
  if (v11)
  {
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v15;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 1;
LABEL_15:
    v22 = [v16 hmErrorWithCode:v17];
LABEL_16:
    [setCopy respondWithError:v22];
    goto LABEL_17;
  }

  actionSets = [(HMDHome *)selfCopy actionSets];
  v19 = [actionSets count];
  v20 = maximumActionSetsPerHome;

  if (v19 >= v20)
  {
    v27 = objc_autoreleasePoolPush();
    v28 = selfCopy;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = HMFGetLogIdentifier();
      v45 = 138543618;
      v46 = v30;
      v47 = 2112;
      v48 = v10;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", &v45, 0x16u);
    }

    objc_autoreleasePoolPop(v27);
    v16 = MEMORY[0x277CCA9B8];
    v17 = 49;
    goto LABEL_15;
  }

  v21 = [(HMDHome *)selfCopy addActionSetName:v10];
  if (v21)
  {
    v22 = v21;
    v23 = objc_autoreleasePoolPush();
    v24 = selfCopy;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      v45 = 138543874;
      v46 = v26;
      v47 = 2112;
      v48 = v10;
      v49 = 2112;
      v50 = v22;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", &v45, 0x20u);
    }

    objc_autoreleasePoolPop(v23);
    goto LABEL_16;
  }

  v32 = [HMDActionSetModel alloc];
  v33 = [setCopy uuidForKey:*MEMORY[0x277CD0B10]];
  uuid = [(HMDHome *)selfCopy uuid];
  v35 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v33 parentUUID:uuid];

  v36 = [setCopy stringForKey:v9];
  [(HMDActionSetModel *)v35 setName:v36];

  v37 = [setCopy stringForKey:*MEMORY[0x277CD2048]];
  v38 = v37;
  v39 = *MEMORY[0x277CCF1A8];
  if (v37)
  {
    v40 = v37;
  }

  else
  {
    v40 = *MEMORY[0x277CCF1A8];
  }

  [(HMDActionSetModel *)v35 setType:v40];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [setCopy name];
  v43 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v44 = [backingStore transaction:name options:v43];

  [v44 add:v35 withMessage:setCopy];
  [v44 run];

  v22 = 0;
LABEL_17:

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddTriggerOwnedActionSet:(id)set
{
  v21 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding trigger owned action set", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [HMDActionSetModel alloc];
  v10 = [setCopy uuidForKey:*MEMORY[0x277CD0B10]];
  uuid = [(HMDHome *)selfCopy uuid];
  v12 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:1 uuid:v10 parentUUID:uuid];

  v13 = [setCopy stringForKey:*MEMORY[0x277CD2040]];
  [(HMDActionSetModel *)v12 setName:v13];

  [(HMDActionSetModel *)v12 setType:*MEMORY[0x277CCF1A0]];
  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [setCopy name];
  v16 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v17 = [backingStore transaction:name options:v16];

  [v17 add:v12 withMessage:setCopy];
  [v17 run];

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddActionSetFromBuilder:(id)builder
{
  v58 = *MEMORY[0x277D85DE8];
  builderCopy = builder;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v53 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Adding Home owned action set (from builder)", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [builderCopy uuidForKey:*MEMORY[0x277CD0B10]];
  v10 = v9;
  if (v9)
  {
    uUID = v9;
  }

  else
  {
    uUID = [MEMORY[0x277CCAD78] UUID];
  }

  v12 = uUID;

  v13 = [builderCopy stringForKey:*MEMORY[0x277CD2048]];
  v14 = v13;
  v15 = *MEMORY[0x277CCF1A8];
  if (v13)
  {
    v15 = v13;
  }

  v16 = v15;

  v17 = [builderCopy stringForKey:*MEMORY[0x277CD2040]];
  v18 = [(HMDHome *)selfCopy actionSetWithName:v17];
  if (!v18)
  {
    actionSets = [(HMDHome *)selfCopy actionSets];
    v26 = [actionSets count];
    v27 = maximumActionSetsPerHome;

    if (v26 >= v27)
    {
      v33 = objc_autoreleasePoolPush();
      v34 = selfCopy;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        v36 = HMFGetLogIdentifier();
        *buf = 138543618;
        v53 = v36;
        v54 = 2112;
        v55 = v17;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; already at maximum action sets for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v33);
      v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v28 = [(HMDHome *)selfCopy addActionSetName:v17];
      if (!v28)
      {
        backingStore = [(HMDHome *)selfCopy backingStore];
        name = [builderCopy name];
        v40 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v41 = [backingStore transaction:name options:v40];

        messagePayload = [builderCopy messagePayload];
        v50 = 0;
        v51 = 0;
        v43 = [(HMDHome *)selfCopy _createActionSetWithUUID:v12 name:v17 type:v16 fromDictionary:messagePayload transaction:v41 response:&v51 error:&v50];
        v44 = v51;
        v19 = v50;

        if (v43)
        {
          v46[0] = MEMORY[0x277D85DD0];
          v46[1] = 3221225472;
          v46[2] = __42__HMDHome__handleAddActionSetFromBuilder___block_invoke;
          v46[3] = &unk_279730430;
          v46[4] = selfCopy;
          v47 = v17;
          v48 = builderCopy;
          v49 = v44;
          [v41 run:v46];
        }

        else
        {
          v45 = [(HMDHome *)selfCopy removeName:v17];
          [builderCopy respondWithError:v19];
        }

        goto LABEL_21;
      }

      v19 = v28;
      v29 = objc_autoreleasePoolPush();
      v30 = selfCopy;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        *buf = 138543874;
        v53 = v32;
        v54 = 2112;
        v55 = v17;
        v56 = 2112;
        v57 = v19;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@; namespace error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v29);
    }

    [builderCopy respondWithError:v19];
    goto LABEL_21;
  }

  v19 = v18;
  v20 = objc_autoreleasePoolPush();
  v21 = selfCopy;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    v23 = HMFGetLogIdentifier();
    *buf = 138543618;
    v53 = v23;
    v54 = 2112;
    v55 = v17;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add action set %@ as it already exists.", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v20);
  v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
  [builderCopy respondWithError:v24];

LABEL_21:
  v37 = *MEMORY[0x277D85DE8];
}

void __42__HMDHome__handleAddActionSetFromBuilder___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    v3 = [*(a1 + 32) removeName:*(a1 + 40)];
    [*(a1 + 48) respondWithError:v4];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:*(a1 + 56)];
  }
}

- (void)_handleAddActionSet:(id)set
{
  v27 = *MEMORY[0x277D85DE8];
  setCopy = set;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v23 = 138543618;
    v24 = v8;
    v25 = 2112;
    v26 = setCopy;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Received a request to add a new action set : %@", &v23, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [setCopy stringForKey:*MEMORY[0x277CD2048]];
  if (!v9)
  {
    v9 = *MEMORY[0x277CCF1A8];
  }

  v10 = [setCopy stringForKey:*MEMORY[0x277CD2040]];
  v11 = HMMaxLengthForNaming();
  if ([v10 length] <= v11)
  {
    logEventSubmitter = [(HMDHome *)selfCopy logEventSubmitter];
    v18 = [HMDAddActionSetLogEvent alloc];
    uuid = [(HMDHome *)selfCopy uuid];
    v20 = [(HMDAddActionSetLogEvent *)v18 initWithActionSetType:v9 homeUUID:uuid];
    [logEventSubmitter submitLogEvent:v20];

    name = [setCopy name];
    LODWORD(v20) = [name isEqualToString:*MEMORY[0x277CCF1E8]];

    if (v20)
    {
      [(HMDHome *)selfCopy _handleAddActionSetFromBuilder:setCopy];
    }

    else if ([v9 isEqualToString:*MEMORY[0x277CCF1A0]])
    {
      [(HMDHome *)selfCopy _handleAddTriggerOwnedActionSet:setCopy];
    }

    else
    {
      [(HMDHome *)selfCopy _handleAddHomeOwnedActionSet:setCopy];
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = selfCopy;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v23 = 138543362;
      v24 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v23, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [setCopy respondWithError:v16];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)builtInActionSetInfo
{
  array = [MEMORY[0x277CBEB18] array];
  workQueue = [(HMDHome *)self workQueue];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __31__HMDHome_builtInActionSetInfo__block_invoke;
  v9[3] = &unk_2797359B0;
  v9[4] = self;
  v5 = array;
  v10 = v5;
  dispatch_sync(workQueue, v9);

  v6 = v10;
  v7 = v5;

  return v5;
}

void __31__HMDHome_builtInActionSetInfo__block_invoke(uint64_t a1)
{
  v29 = *MEMORY[0x277D85DE8];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v1 = [*(a1 + 32) actionSets];
  v2 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v23;
    v5 = *MEMORY[0x277CCF1A8];
    v19 = *MEMORY[0x277CD2048];
    v20 = *MEMORY[0x277CD2040];
    v18 = *MEMORY[0x277CD2050];
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v23 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v7 = *(*(&v22 + 1) + 8 * i);
        v8 = [v7 type];
        if (v8)
        {
          v9 = v8;
          v10 = [v7 type];
          v11 = [v10 isEqualToString:v5];

          if ((v11 & 1) == 0)
          {
            v26[0] = v20;
            v12 = [v7 name];
            v27[0] = v12;
            v26[1] = v19;
            v13 = [v7 type];
            v27[1] = v13;
            v26[2] = v18;
            v14 = [v7 uuid];
            v15 = [v14 UUIDString];
            v27[2] = v15;
            v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:v26 count:3];

            [*(a1 + 40) addObject:v16];
          }
        }
      }

      v3 = [v1 countByEnumeratingWithState:&v22 objects:v28 count:16];
    }

    while (v3);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)test_addTriggerOwnedActionSets:(id)sets
{
  setsCopy = sets;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_triggerOwnedActionSets addObjectsFromArray:setsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggerOwnedActionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_triggerOwnedActionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)test_addActionSets:(id)sets
{
  setsCopy = sets;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_actionSets addObjectsFromArray:setsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)actionSets
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_actionSets copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveServiceGroupModel:(id)model message:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v27 = modelCopy;
  uuid = [modelCopy uuid];
  v9 = [(HMDHome *)self serviceGroupWithUUID:uuid];
  v10 = v9;
  if (v9)
  {
    name = [v9 name];
    v12 = [(HMDHome *)self removeName:name];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups removeObject:v10];
    os_unfair_recursive_lock_unlock();
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      name2 = [v10 name];
      *buf = 138543618;
      v31 = v17;
      v32 = 2112;
      v33 = name2;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Removed service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    v28[0] = *MEMORY[0x277CD25C0];
    name3 = [v10 name];
    v29[0] = name3;
    v28[1] = *MEMORY[0x277CD25E0];
    uuid2 = [v10 uuid];
    uUIDString = [uuid2 UUIDString];
    v29[1] = uUIDString;
    v28[2] = *MEMORY[0x277CD0D58];
    spiClientIdentifier = [v10 spiClientIdentifier];
    uUIDString2 = [spiClientIdentifier UUIDString];
    v29[2] = uUIDString2;
    v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v29 forKeys:v28 count:3];

    logAndPostNotification(@"HMDServiceGroupRemovedNotification", v10, v24);
    [messageCopy respondWithSuccess];
  }

  else
  {
    v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v25];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveServiceGroup:(id)group
{
  groupCopy = group;
  v5 = [groupCopy uuidForKey:*MEMORY[0x277CD25E0]];
  v6 = [(HMDHome *)self serviceGroupWithUUID:v5];
  if (v6)
  {
    v7 = [HMDServiceGroupModel alloc];
    uuid = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid];

    backingStore = [(HMDHome *)self backingStore];
    name = [groupCopy name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [backingStore transaction:name options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __37__HMDHome__handleRemoveServiceGroup___block_invoke;
    v14[3] = &unk_2797359D8;
    v15 = groupCopy;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [groupCopy respondWithError:v9];
  }
}

- (void)_handleAddServiceGroupModel:(id)model message:(id)message
{
  v40 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  name = [modelCopy name];
  uuid = [modelCopy uuid];
  v10 = uuid;
  if (name && uuid)
  {
    hm_truncatedNameString = [name hm_truncatedNameString];

    v11 = [HMDServiceGroup alloc];
    workQueue = [(HMDHome *)self workQueue];
    v13 = [(HMDServiceGroup *)v11 initWithName:hm_truncatedNameString uuid:v10 home:self queue:workQueue];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_serviceGroups addObject:v13];
    os_unfair_recursive_lock_unlock();
    msgDispatcher = [(HMDHome *)self msgDispatcher];
    workQueue2 = [(HMDHome *)self workQueue];
    [(HMDServiceGroup *)v13 configure:msgDispatcher queue:workQueue2];

    v16 = [(HMDServiceGroup *)v13 updateServiceGroupWithModel:modelCopy message:messageCopy];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    serviceUUIDs = [(HMDServiceGroup *)v13 serviceUUIDs];
    v19 = [serviceUUIDs count];

    if (v19)
    {
      [transactionResult markSaveToAssistant];
    }

    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v23;
      v38 = 2112;
      v39 = hm_truncatedNameString;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Added service group: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v20);
    v34[0] = *MEMORY[0x277CD25C0];
    name2 = [(HMDServiceGroup *)v13 name];
    v35[0] = name2;
    v34[1] = *MEMORY[0x277CD25E0];
    uuid2 = [(HMDServiceGroup *)v13 uuid];
    uUIDString = [uuid2 UUIDString];
    v35[1] = uUIDString;
    v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:2];

    logAndPostNotification(@"HMDServiceGroupAddedNotification", v13, v27);
    [messageCopy respondWithPayload:0 error:v16];

    name = hm_truncatedNameString;
  }

  else
  {
    v28 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v30 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
    {
      v31 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v31;
      v38 = 2112;
      v39 = name;
      _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v28);
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:v13];
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddServiceGroup:(id)group
{
  v47 = *MEMORY[0x277D85DE8];
  groupCopy = group;
  v5 = [groupCopy stringForKey:*MEMORY[0x277CD25C0]];
  if (v5)
  {
    v6 = HMMaxLengthForNaming();
    if ([v5 length] > v6)
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543362;
        v42 = v10;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v7);
      v11 = MEMORY[0x277CCA9B8];
      v12 = 46;
      goto LABEL_7;
    }

    v13 = [(HMDHome *)self serviceGroupWithName:v5];
    if (v13)
    {
      v14 = MEMORY[0x277CCA9B8];
      v15 = 1;
    }

    else
    {
      serviceGroups = [(HMDHome *)self serviceGroups];
      v17 = [serviceGroups count];
      v18 = maximumServiceGroupsPerHome;

      if (v17 < v18)
      {
        v19 = [(HMDHome *)self addName:v5];
        if (!v19)
        {
          v29 = [HMDServiceGroupModel alloc];
          v30 = [groupCopy uuidForKey:*MEMORY[0x277CD0B10]];
          uuid = [(HMDHome *)self uuid];
          v32 = [(HMDBackingStoreModelObject *)v29 initWithObjectChangeType:1 uuid:v30 parentUUID:uuid];

          [(HMDServiceGroupModel *)v32 setName:v5];
          backingStore = [(HMDHome *)self backingStore];
          name = [groupCopy name];
          v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v36 = [backingStore transaction:name options:v35];

          [v36 add:v32];
          v38[0] = MEMORY[0x277D85DD0];
          v38[1] = 3221225472;
          v38[2] = __34__HMDHome__handleAddServiceGroup___block_invoke;
          v38[3] = &unk_2797358C8;
          v39 = groupCopy;
          v40 = v32;
          v37 = v32;
          [v36 run:v38];

          goto LABEL_20;
        }

        v20 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v22 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          v23 = HMFGetLogIdentifier();
          *buf = 138543874;
          v42 = v23;
          v43 = 2112;
          v44 = v5;
          v45 = 2112;
          v46 = v19;
          _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; namespace error %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v20);
LABEL_19:
        [groupCopy respondWithError:v19];
LABEL_20:

        goto LABEL_21;
      }

      v24 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v26 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        v27 = HMFGetLogIdentifier();
        *buf = 138543618;
        v42 = v27;
        v43 = 2112;
        v44 = v5;
        _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Can't add service group %@; already at maximum service groups for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v24);
      v14 = MEMORY[0x277CCA9B8];
      v15 = 49;
    }

    v19 = [v14 hmErrorWithCode:v15];
    goto LABEL_19;
  }

  v11 = MEMORY[0x277CCA9B8];
  v12 = 20;
LABEL_7:
  v13 = [v11 hmErrorWithCode:v12];
  [groupCopy respondWithError:v13];
LABEL_21:

  v28 = *MEMORY[0x277D85DE8];
}

void __34__HMDHome__handleAddServiceGroup___block_invoke(uint64_t a1, uint64_t a2)
{
  v12[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v11[0] = *MEMORY[0x277CD25C0];
    v6 = [*(a1 + 40) name];
    v12[0] = v6;
    v11[1] = *MEMORY[0x277CD25E0];
    v7 = [*(a1 + 40) uuid];
    v8 = [v7 UUIDString];
    v12[1] = v8;
    v9 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v12 forKeys:v11 count:2];
    [v2 respondWithPayload:v9];

    v10 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addServiceGroups:(id)groups
{
  groupsCopy = groups;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_serviceGroups addObjectsFromArray:groupsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)serviceGroups
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_serviceGroups copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)updateHomeFirstHAPAccessoryAddedDateToNow
{
  v3 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  homeManager = [(HMDHome *)self homeManager];
  uuid2 = [homeManager uuid];
  v11 = [(HMDBackingStoreModelObject *)v3 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  v7 = objc_alloc_init(MEMORY[0x277CBEAA8]);
  [(HMDHomeModel *)v11 setFirstHAPAccessoryAddedDate:v7];

  backingStore = [(HMDHome *)self backingStore];
  v9 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v10 = [backingStore transaction:@"updateHomeFirstHAPAccessoryAddedDate" options:v9];

  [v10 add:v11];
  [v10 run];
}

- (void)_processAccessoriesToAddForUnpairedAccessory:(id)accessory certificationStatus:(int64_t)status accessoryServer:(id)server networkCredential:(id)credential pairingEvent:(id)event message:(id)message completionHandler:(id)handler
{
  v225 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  serverCopy = server;
  credentialCopy = credential;
  eventCopy = event;
  messageCopy = message;
  handlerCopy = handler;
  v16 = objc_alloc(MEMORY[0x277D0F770]);
  v17 = MEMORY[0x277CCACA8];
  v18 = MEMORY[0x259C01AE0](self, a2);
  16894 = [v17 stringWithFormat:@"%@, %s:%ld", v18, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 16894];
  v211 = [v16 initWithName:16894];

  primaryAccessory = [serverCopy primaryAccessory];
  [eventCopy updateEventPropertiesWithHAPAccessory:primaryAccessory];

  v172 = accessoryCopy;
  if (self)
  {
    currentAccessory = [(HMDHome *)self currentAccessory];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = currentAccessory;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;

    uuid = 0;
    if (v172 && v23)
    {
      sensorAccessoryUUID = [v23 sensorAccessoryUUID];
      v25 = [sensorAccessoryUUID hmf_isEqualToUUID:v172];

      if (v25)
      {
        uuid = [v23 uuid];
      }

      else
      {
        uuid = 0;
      }
    }
  }

  else
  {
    uuid = 0;
  }

  v26 = objc_autoreleasePoolPush();
  selfCopy = self;
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    accessories = [serverCopy accessories];
    v30 = [accessories count];
    identifier = [serverCopy identifier];
    *buf = 138543874;
    v217 = v28;
    v218 = 2048;
    v219 = v30;
    v220 = 2112;
    v221 = identifier;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating %tu new accessory objects for a newly paired accessory server: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v26);
  array = [MEMORY[0x277CBEB18] array];
  v32 = MEMORY[0x277CBEB18];
  accessories2 = [serverCopy accessories];
  v166 = [v32 arrayWithCapacity:{objc_msgSend(accessories2, "count")}];

  v34 = MEMORY[0x277CBEB18];
  accessories3 = [serverCopy accessories];
  v178 = [v34 arrayWithCapacity:{objc_msgSend(accessories3, "count")}];

  v209 = 0u;
  v210 = 0u;
  v207 = 0u;
  v208 = 0u;
  accessories4 = [serverCopy accessories];
  v37 = [accessories4 countByEnumeratingWithState:&v207 objects:v224 count:16];
  if (v37)
  {
    v180 = 0;
    v168 = *v208;
    obj = accessories4;
    do
    {
      v38 = 0;
      v163 = v37;
      do
      {
        if (*v208 != v168)
        {
          objc_enumerationMutation(obj);
        }

        v39 = *(*(&v207 + 1) + 8 * v38);
        uniqueIdentifier = [v39 uniqueIdentifier];
        primaryAccessory2 = [serverCopy primaryAccessory];
        uniqueIdentifier2 = [primaryAccessory2 uniqueIdentifier];
        v43 = [uniqueIdentifier isEqual:uniqueIdentifier2];

        if (v43)
        {
          if (v180)
          {
            v44 = objc_autoreleasePoolPush();
            v45 = selfCopy;
            v46 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v46, OS_LOG_TYPE_DEFAULT))
            {
              v47 = HMFGetLogIdentifier();
              uuid2 = [v180 uuid];
              primaryAccessory3 = [serverCopy primaryAccessory];
              *buf = 138543874;
              v217 = v47;
              v218 = 2112;
              v219 = uuid2;
              v220 = 2112;
              v221 = primaryAccessory3;
              _os_log_impl(&dword_2531F8000, v46, OS_LOG_TYPE_DEFAULT, "%{public}@#### Multiple primary accessories: %@  new %@", buf, 0x20u);

              v37 = v163;
            }

            objc_autoreleasePoolPop(v44);
          }

          v50 = v172;
          if (!v172)
          {
            uUID = [MEMORY[0x277CCAD78] UUID];
            v50 = uUID;
          }

          v51 = [(HMDHome *)selfCopy getTransactionFromHAPAccessory:v39 hmdAccessory:0 uuid:v50 hostAccessoryUUID:uuid objectChangeType:1];
          if (!v172)
          {
          }

          v52 = v51;
          v53 = v39;
          manufacturer = [v53 manufacturer];
          [v52 setInitialManufacturer:manufacturer];

          model = [v53 model];
          [v52 setInitialModel:model];

          category = [v53 category];
          [v52 setInitialCategoryIdentifier:category];

          v57 = serviceTypeUUIDsForAccessory(v53);
          [v52 setInitialServiceTypeUUIDs:v57];

          server = [v53 server];

          [HMDHome updateCHIPPropertiesOnAccessoryModel:v52 forAddedHAPAccessoryServer:server];
          v59 = serverCopy;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v60 = v59;
          }

          else
          {
            v60 = 0;
          }

          v175 = v60;

          clientIdentifier = [credentialCopy clientIdentifier];
          [v52 setNetworkClientIdentifier:clientIdentifier];

          [v52 setNetworkClientLAN:&unk_286627820];
          networkRouterUUID = [credentialCopy networkRouterUUID];
          uUIDString = [networkRouterUUID UUIDString];
          [v52 setNetworkRouterUUID:uUIDString];

          wiFiPSK = [credentialCopy wiFiPSK];
          [v52 setWiFiUniquePreSharedKey:wiFiPSK];

          wiFiPSK2 = [credentialCopy wiFiPSK];

          if (wiFiPSK2)
          {
            v66 = 3;
          }

          else if ([v175 isWacComplete])
          {
            v66 = 2;
          }

          else
          {
            v66 = 0;
          }

          v72 = [MEMORY[0x277CCABB0] numberWithInteger:v66];
          [v52 setWiFiCredentialType:v72];

          v73 = [MEMORY[0x277CCABB0] numberWithInteger:status];
          [v52 setCertificationStatus:v73];

          if (uuid)
          {
            uUIDString2 = [uuid UUIDString];
            [v52 setHostAccessoryUUID:uUIDString2];
          }

          uuidToHAPAccessoryConfigTable = [(HMDHome *)selfCopy uuidToHAPAccessoryConfigTable];
          uuid3 = [v52 uuid];
          [uuidToHAPAccessoryConfigTable setObject:v53 forKey:uuid3];

          v77 = v52;
          homeManager = [(HMDHome *)selfCopy homeManager];
          v79 = homeManager;
          if (v172)
          {
            v80 = objc_autoreleasePoolPush();
            v81 = selfCopy;
            v82 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
            {
              v83 = HMFGetLogIdentifier();
              uniqueIdentifier3 = [v53 uniqueIdentifier];
              [v175 isWacComplete];
              v85 = HMFBooleanToString();
              wiFiCredentialType = [v77 wiFiCredentialType];
              *buf = 138544130;
              v217 = v83;
              v218 = 2112;
              v219 = uniqueIdentifier3;
              v220 = 2112;
              v221 = v85;
              v222 = 2112;
              v223 = wiFiCredentialType;
              _os_log_impl(&dword_2531F8000, v82, OS_LOG_TYPE_INFO, "%{public}@Creating primary accessory for unpaired accessory with identifier %@ isWacComplete: %@ wiFiCredentialType: %@", buf, 0x2Au);

              v37 = v163;
            }
          }

          else
          {
            [homeManager processAnyPendingRequestsForRemoteAccess];
            v80 = objc_autoreleasePoolPush();
            v87 = selfCopy;
            v82 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
            {
              v88 = HMFGetLogIdentifier();
              uniqueIdentifier4 = [v53 uniqueIdentifier];
              [v175 isWacComplete];
              v90 = HMFBooleanToString();
              wiFiCredentialType2 = [v77 wiFiCredentialType];
              *buf = 138544130;
              v217 = v88;
              v218 = 2112;
              v219 = uniqueIdentifier4;
              v220 = 2112;
              v221 = v90;
              v222 = 2112;
              v223 = wiFiCredentialType2;
              _os_log_impl(&dword_2531F8000, v82, OS_LOG_TYPE_INFO, "%{public}@Creating primary accessory with identifier %@ isWacComplete: %@ wiFiCredentialType: %@", buf, 0x2Au);

              v37 = v163;
            }
          }

          objc_autoreleasePoolPop(v80);
          v206 = v178;
          [(HMDHome *)selfCopy getUpdateTransactionForAccessory:0 hapAccessory:v53 accessoryTransaction:v77 addSvcTransactions:&v206 updateSvcTransactions:0 removeSvcTransactions:0];
          v92 = v206;

          [(HMDHome *)selfCopy _processProductDataForNewlyAddedAccessory:v53 transaction:v77];
          if ([(HMDHome *)selfCopy hasNeverAddedAnyHAPAccessory])
          {
            [eventCopy setFirstHAPAccessoryInHome:1];
            [(HMDHome *)selfCopy updateHomeFirstHAPAccessoryAddedDateToNow];
            [eventCopy setFirstHAPAccessoryInAnyHome:1];
            if ([v79 hasHAPAccessoryInAnyHome])
            {
              [eventCopy setFirstHAPAccessoryInAnyHome:0];
            }
          }

          v178 = v92;
          v180 = v77;
        }

        else
        {
          v67 = objc_autoreleasePoolPush();
          v68 = selfCopy;
          v69 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
          {
            v70 = HMFGetLogIdentifier();
            uniqueIdentifier5 = [v39 uniqueIdentifier];
            *buf = 138543618;
            v217 = v70;
            v218 = 2112;
            v219 = uniqueIdentifier5;
            _os_log_impl(&dword_2531F8000, v69, OS_LOG_TYPE_INFO, "%{public}@Non-primary accessory with identifier %@", buf, 0x16u);

            v37 = v163;
          }

          objc_autoreleasePoolPop(v67);
          [array addObject:v39];
        }

        ++v38;
      }

      while (v37 != v38);
      accessories4 = obj;
      v37 = [obj countByEnumeratingWithState:&v207 objects:v224 count:16];
    }

    while (v37);
  }

  else
  {
    v180 = 0;
  }

  v204 = 0u;
  v205 = 0u;
  v202 = 0u;
  v203 = 0u;
  v161 = array;
  v93 = [v161 countByEnumeratingWithState:&v202 objects:v215 count:16];
  if (v93)
  {
    v164 = *v203;
    do
    {
      v169 = v93;
      v94 = 0;
      v176 = v178;
      do
      {
        if (*v203 != v164)
        {
          objc_enumerationMutation(v161);
        }

        v95 = *(*(&v202 + 1) + 8 * v94);
        v96 = objc_autoreleasePoolPush();
        v97 = selfCopy;
        v98 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v98, OS_LOG_TYPE_INFO))
        {
          v99 = HMFGetLogIdentifier();
          uniqueIdentifier6 = [v95 uniqueIdentifier];
          *buf = 138543618;
          v217 = v99;
          v218 = 2112;
          v219 = uniqueIdentifier6;
          _os_log_impl(&dword_2531F8000, v98, OS_LOG_TYPE_INFO, "%{public}@Non-primary accessory with identifier %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v96);
        instanceID = [v95 instanceID];
        stringValue = [instanceID stringValue];
        v214 = stringValue;
        v103 = [MEMORY[0x277CBEA60] arrayWithObjects:&v214 count:1];

        v104 = MEMORY[0x277CCAD78];
        uuid4 = [v180 uuid];
        v106 = [v104 hm_deriveUUIDFromBaseUUID:uuid4 withSalts:v103];

        v107 = objc_autoreleasePoolPush();
        v108 = v97;
        v109 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v109, OS_LOG_TYPE_INFO))
        {
          v110 = HMFGetLogIdentifier();
          uniqueIdentifier7 = [v95 uniqueIdentifier];
          uUIDString3 = [v106 UUIDString];
          *buf = 138543874;
          v217 = v110;
          v218 = 2112;
          v219 = uniqueIdentifier7;
          v220 = 2112;
          v221 = uUIDString3;
          _os_log_impl(&dword_2531F8000, v109, OS_LOG_TYPE_INFO, "%{public}@Creating secondary accessory with identifier %@ and uuid %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v107);
        uuid5 = [v180 uuid];
        v114 = [(HMDHome *)v108 getTransactionFromHAPAccessory:v95 hmdAccessory:0 uuid:v106 hostAccessoryUUID:uuid5 objectChangeType:1];

        [v114 setWiFiCredentialType:&unk_286627820];
        [v166 addObject:v114];
        uuidToHAPAccessoryConfigTable2 = [(HMDHome *)v108 uuidToHAPAccessoryConfigTable];
        [uuidToHAPAccessoryConfigTable2 setObject:v95 forKey:v106];

        v201 = v176;
        [(HMDHome *)v108 getUpdateTransactionForAccessory:0 hapAccessory:v95 accessoryTransaction:v114 addSvcTransactions:&v201 updateSvcTransactions:0 removeSvcTransactions:0];
        v178 = v201;

        ++v94;
        v176 = v178;
      }

      while (v169 != v94);
      v93 = [v161 countByEnumeratingWithState:&v202 objects:v215 count:16];
    }

    while (v93);
  }

  backingStore = [(HMDHome *)selfCopy backingStore];
  name = [messageCopy name];
  v118 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v177 = [backingStore transaction:name options:v118];

  [v177 add:v180 withMessage:messageCopy];
  v119 = dispatch_group_create();
  [v180 setConfigurationTracker:v119];
  v199 = 0u;
  v200 = 0u;
  v197 = 0u;
  v198 = 0u;
  v167 = v166;
  v120 = [v167 countByEnumeratingWithState:&v197 objects:v213 count:16];
  if (v120)
  {
    v170 = *v198;
    do
    {
      for (i = 0; i != v120; ++i)
      {
        if (*v198 != v170)
        {
          objc_enumerationMutation(v167);
        }

        v122 = *(*(&v197 + 1) + 8 * i);
        [v122 setConfigurationTracker:v119];
        certificationStatus = [v180 certificationStatus];
        [v122 setCertificationStatus:certificationStatus];

        uuid6 = [v180 uuid];
        v125 = [(HMDHome *)selfCopy accessoryWithUUID:uuid6];

        v126 = v125;
        objc_opt_class();
        LOBYTE(v125) = objc_opt_isKindOfClass();

        if ((v125 & (v126 != 0)) == 1)
        {
          uuid7 = [v180 uuid];
          uUIDString4 = [uuid7 UUIDString];
          [v122 setBridgeUUID:uUIDString4];
LABEL_73:

          goto LABEL_77;
        }

        v129 = v126;
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & (v126 != 0)) != 0)
        {
          uuid7 = [v180 uuid];
          uUIDString4 = [uuid7 UUIDString];
          [v122 setHostAccessoryUUID:uUIDString4];
          goto LABEL_73;
        }

        v131 = objc_autoreleasePoolPush();
        v132 = selfCopy;
        v133 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v133, OS_LOG_TYPE_ERROR))
        {
          v134 = HMFGetLogIdentifier();
          *buf = 138543618;
          v217 = v134;
          v218 = 2112;
          v219 = v129;
          _os_log_impl(&dword_2531F8000, v133, OS_LOG_TYPE_ERROR, "%{public}@Unexpected type of host accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v131);
LABEL_77:
        [v177 add:v122 withMessage:messageCopy];
      }

      v120 = [v167 countByEnumeratingWithState:&v197 objects:v213 count:16];
    }

    while (v120);
  }

  v195 = 0u;
  v196 = 0u;
  v193 = 0u;
  v194 = 0u;
  v135 = v178;
  v136 = [v135 countByEnumeratingWithState:&v193 objects:v212 count:16];
  if (v136)
  {
    v137 = *v194;
    do
    {
      for (j = 0; j != v136; ++j)
      {
        if (*v194 != v137)
        {
          objc_enumerationMutation(v135);
        }

        v139 = *(*(&v193 + 1) + 8 * j);
        [v139 setConfigurationTracker:v119];
        [v177 add:v139 withMessage:0];
      }

      v136 = [v135 countByEnumeratingWithState:&v193 objects:v212 count:16];
    }

    while (v136);
  }

  v140 = [(HMDHome *)selfCopy emptyModelObjectWithChangeType:2];
  if ([objc_opt_class() updateCHIPPropertiesOnHomeModel:v140 forAddedHAPAccessoryServer:serverCopy])
  {
    v141 = v140;
    v142 = objc_autoreleasePoolPush();
    v143 = selfCopy;
    v144 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v144, OS_LOG_TYPE_INFO))
    {
      v145 = HMFGetLogIdentifier();
      *buf = 138543618;
      v217 = v145;
      v218 = 2112;
      v219 = v141;
      _os_log_impl(&dword_2531F8000, v144, OS_LOG_TYPE_INFO, "%{public}@Adding updated home model for CHIP-related properties: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v142);
    v140 = v141;
    [v177 add:v141];
  }

  v179 = v140;
  wiFiRouterAccessories = [(HMDHome *)selfCopy wiFiRouterAccessories];
  objc_initWeak(buf, selfCopy);
  v182[0] = MEMORY[0x277D85DD0];
  v182[1] = 3221225472;
  v182[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke;
  v182[3] = &unk_2797226A0;
  objc_copyWeak(&v192, buf);
  v147 = handlerCopy;
  v191 = v147;
  v148 = v119;
  v183 = v148;
  v149 = v180;
  v184 = v149;
  v150 = serverCopy;
  v185 = v150;
  v151 = v167;
  v186 = v151;
  v152 = messageCopy;
  v187 = v152;
  v188 = v211;
  v153 = wiFiRouterAccessories;
  v189 = v153;
  v154 = eventCopy;
  v190 = v154;
  [v177 run:v182];

  objc_destroyWeak(&v192);
  objc_destroyWeak(buf);

  __HMFActivityScopeLeave();
  v155 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v33 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 104));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    v6 = *(a1 + 32);
    v7 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2;
    block[3] = &unk_2797225E0;
    block[4] = v5;
    v8 = *(a1 + 40);
    v9 = *(a1 + 48);
    v10 = *(a1 + 56);
    v11 = *(a1 + 64);
    *&v12 = v10;
    *(&v12 + 1) = v11;
    *&v13 = v8;
    *(&v13 + 1) = v9;
    v22 = v13;
    v23 = v12;
    v28 = *(a1 + 96);
    v24 = *(a1 + 72);
    v25 = *(a1 + 80);
    v26 = v3;
    v27 = *(a1 + 88);
    dispatch_group_notify(v6, v7, block);

    v14 = v22;
LABEL_7:

    goto LABEL_8;
  }

  v15 = objc_autoreleasePoolPush();
  v16 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
  {
    v17 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v17;
    _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Home missing; failed to add accessory", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v15);
  v18 = *(a1 + 96);
  if (v18)
  {
    v19 = dispatch_get_global_queue(0, 0);
    v29[0] = MEMORY[0x277D85DD0];
    v29[1] = 3221225472;
    v29[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1369;
    v29[3] = &unk_2797348C0;
    v30 = v18;
    dispatch_async(v19, v29);

    v14 = v30;
    goto LABEL_7;
  }

LABEL_8:

  v20 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1369(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
  (*(v1 + 16))(v1, v2);
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2(uint64_t a1)
{
  v110 = *MEMORY[0x277D85DE8];
  v3 = (a1 + 32);
  v2 = *(a1 + 32);
  v4 = (a1 + 40);
  v5 = [*(a1 + 40) uuid];
  v6 = [v2 accessoryWithUUID:v5];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v62 = v7;

  v8 = [*v3 notificationRegistrations];
  v65 = [v8 count];

  v9 = [*v4 hapAccessoryLocal];
  [v62 enableNotificationsWithHAPAccessory:v9 homeNotificationsEnabled:v65 != 0];

  logAndPostNotification(@"HMDAccessoryConnectedNotification", v62, 0);
  [v62 updateBridgedAccessoryLightProfilesSettings];
  [*v3 finishPairingForServer:*(a1 + 48)];
  v102 = 0u;
  v103 = 0u;
  v100 = 0u;
  v101 = 0u;
  v10 = *(a1 + 56);
  v11 = [v10 countByEnumeratingWithState:&v100 objects:v109 count:16];
  if (v11)
  {
    v12 = *v101;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v101 != v12)
        {
          objc_enumerationMutation(v10);
        }

        v14 = *(*(&v100 + 1) + 8 * i);
        v15 = *(a1 + 32);
        v16 = [v14 uuid];
        v17 = [v15 accessoryWithUUID:v16];

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v18 = v17;
        }

        else
        {
          v18 = 0;
        }

        v19 = v18;

        v20 = [v14 hapAccessoryLocal];
        [v19 enableNotificationsWithHAPAccessory:v20 homeNotificationsEnabled:v65 != 0];

        logAndPostNotification(@"HMDAccessoryConnectedNotification", v19, 0);
      }

      v11 = [v10 countByEnumeratingWithState:&v100 objects:v109 count:16];
    }

    while (v11);
  }

  v21 = *(a1 + 32);
  v22 = [*(a1 + 64) identifier];
  v61 = [v21 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v22];

  if ([*(a1 + 32) isOwnerUser])
  {
    goto LABEL_25;
  }

  v94 = 0;
  v95 = &v94;
  v96 = 0x3032000000;
  v97 = __Block_byref_object_copy__10664;
  v98 = __Block_byref_object_dispose__10665;
  v99 = 0;
  v23 = dispatch_group_create();
  dispatch_group_enter(v23);
  v24 = [*(a1 + 32) homeManager];
  v25 = [v62 identifier];
  v88[0] = MEMORY[0x277D85DD0];
  v88[1] = 3221225472;
  v88[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_3;
  v88[3] = &unk_2797225B8;
  v26 = v62;
  v27 = *(a1 + 32);
  v89 = v26;
  v90 = v27;
  v93 = &v94;
  v28 = v61;
  v91 = v28;
  v29 = v23;
  v92 = v29;
  [v24 cleanupOperationsForAccessory:v25 user:0 completion:v88];

  v30 = dispatch_time(0, 180000000000);
  if (dispatch_group_wait(v29, v30))
  {
    v31 = objc_autoreleasePoolPush();
    v32 = *(a1 + 32);
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543618;
      v106 = v34;
      v107 = 2112;
      v108 = v26;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Timed out waiting for resident to respond to add accessory request: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v35 = [MEMORY[0x277CCA9B8] hmErrorWithCode:8];
    v36 = v95[5];
    v95[5] = v35;
  }

  v37 = v95[5];
  if (v37)
  {
    [*(a1 + 32) _sharedAdminDidFailToAddAccessories:v28];
    v38 = [*(a1 + 64) responseHandler];

    if (v38)
    {
      v39 = [*(a1 + 64) responseHandler];
      (v39)[2](v39, v95[5], 0);
    }

    v40 = *(a1 + 104);
    if (v40)
    {
      (*(v40 + 16))(v40, v95[5]);
    }
  }

  _Block_object_dispose(&v94, 8);
  if (!v37)
  {
LABEL_25:
    group = dispatch_group_create();
    if (v62)
    {
      dispatch_group_enter(group);
      v84[0] = MEMORY[0x277D85DD0];
      v84[1] = 3221225472;
      v84[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1370;
      v84[3] = &unk_279730430;
      v84[4] = *(a1 + 32);
      v41 = v62;
      v85 = v41;
      v86 = *(a1 + 72);
      v87 = group;
      [v41 readInitialRequiredCharacteristicsForAccessory:v84];
      v42 = [*(a1 + 40) hapAccessoryLocal];
      [v41 enableNotificationsWithHAPAccessory:v42 homeNotificationsEnabled:v65 != 0];
    }

    v82 = 0u;
    v83 = 0u;
    v80 = 0u;
    v81 = 0u;
    obj = *(a1 + 56);
    v43 = [obj countByEnumeratingWithState:&v80 objects:v104 count:16];
    if (v43)
    {
      v44 = *v81;
      do
      {
        for (j = 0; j != v43; ++j)
        {
          if (*v81 != v44)
          {
            objc_enumerationMutation(obj);
          }

          v46 = *(*(&v80 + 1) + 8 * j);
          v47 = *(a1 + 32);
          v48 = [v46 uuid];
          v49 = [v47 accessoryWithUUID:v48];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v50 = v49;
          }

          else
          {
            v50 = 0;
          }

          v51 = v50;

          if (v51)
          {
            dispatch_group_enter(group);
            v77[0] = MEMORY[0x277D85DD0];
            v77[1] = 3221225472;
            v77[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1372;
            v77[3] = &unk_279734D88;
            v77[4] = *(a1 + 32);
            v52 = v51;
            v78 = v52;
            v79 = group;
            [v52 readInitialRequiredCharacteristicsForAccessory:v77];
            v53 = [v46 hapAccessoryLocal];
            [v52 enableNotificationsWithHAPAccessory:v53 homeNotificationsEnabled:v65 != 0];
          }
        }

        v43 = [obj countByEnumeratingWithState:&v80 objects:v104 count:16];
      }

      while (v43);
    }

    v54 = dispatch_time(0, 3000000000);
    dispatch_group_wait(group, v54);
    if ([*(a1 + 32) isOwnerUser])
    {
      [*(a1 + 32) _setupActiveNetworkRouterAccessory:v61 existingRouterAccessories:*(a1 + 80)];
    }

    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1373;
    aBlock[3] = &unk_279734668;
    aBlock[4] = *(a1 + 32);
    v73 = v61;
    v74 = *(a1 + 64);
    v76 = *(a1 + 104);
    v75 = *(a1 + 88);
    v55 = _Block_copy(aBlock);
    v56 = v55;
    if (v62)
    {
      [*(a1 + 72) begin];
      v94 = *(a1 + 72);
      v57 = [MEMORY[0x277CBEAA8] date];
      v58 = *(a1 + 96);
      v66[0] = MEMORY[0x277D85DD0];
      v66[1] = 3221225472;
      v66[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1374;
      v66[3] = &unk_279732B10;
      v59 = v57;
      v67 = v59;
      v68 = *(a1 + 72);
      v69 = v62;
      v70 = *(a1 + 96);
      v71 = v56;
      [v69 commissionToThreadNetworkWithPairingEvent:v58 completion:v66];

      __HMFActivityScopeLeave();
    }

    else
    {
      (*(v55 + 2))(v55);
    }
  }

  v60 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_3(uint64_t a1)
{
  if (([*(a1 + 32) supportsCHIP] & 1) != 0 || (v3 = *(a1 + 32), v2 = *(a1 + 40), v4 = *(*(a1 + 64) + 8), v12 = *(v4 + 40), v5 = objc_msgSend(v2, "_addOwnerToPrimaryAccessory:error:", v3, &v12), objc_storeStrong((v4 + 40), v12), v5))
  {
    v6 = *(a1 + 40);
    v7 = *(a1 + 48);
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_4;
    v10[3] = &unk_27972C6F8;
    v9 = *(a1 + 56);
    v8 = v9;
    v11 = v9;
    [v6 _notifyOwnerOfAddedAccessories:v7 completion:v10];
  }

  else
  {
    dispatch_group_leave(*(a1 + 56));
  }
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1370(uint64_t a1, void *a2)
{
  v23 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    [*(a1 + 40) supportsTargetController];
    v11 = HMFBooleanToString();
    *buf = 138544130;
    *&buf[4] = v7;
    v17 = 2112;
    v18 = v8;
    v19 = 2112;
    v20 = v10;
    v21 = 2112;
    v22 = v11;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Primary accessory %@/%@ (supportsTargetController %@) being added to home", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) autoConfigureTargetController];
  [*(a1 + 48) begin];
  *buf = *(a1 + 48);
  dispatch_group_enter(*(a1 + 56));
  v12 = *(a1 + 40);
  v14[0] = MEMORY[0x277D85DD0];
  v14[1] = 3221225472;
  v14[2] = __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1371;
  v14[3] = &unk_279735D00;
  v15 = *(a1 + 56);
  [v12 handleUpdatedServicesForThreadManagementWithCompletion:v14];

  __HMFActivityScopeLeave();
  dispatch_group_leave(*(a1 + 56));

  v13 = *MEMORY[0x277D85DE8];
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1372(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) name];
    v9 = [*(a1 + 40) uuid];
    v10 = [v9 UUIDString];
    [*(a1 + 40) supportsTargetController];
    v11 = HMFBooleanToString();
    v13 = 138544130;
    v14 = v7;
    v15 = 2112;
    v16 = v8;
    v17 = 2112;
    v18 = v10;
    v19 = 2112;
    v20 = v11;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Bridged accessory %@/%@ (supportsTargetController %@) being added to home", &v13, 0x2Au);
  }

  objc_autoreleasePoolPop(v4);
  [*(a1 + 40) autoConfigureTargetController];
  dispatch_group_leave(*(a1 + 48));

  v12 = *MEMORY[0x277D85DE8];
}

uint64_t __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_1373(uint64_t a1)
{
  [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:*(a1 + 40) requestMessage:*(a1 + 48)];
  result = *(a1 + 64);
  if (result)
  {
    v3 = *(a1 + 56);
    v4 = *(result + 16);

    return v4();
  }

  return result;
}

uint64_t __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_2_1374(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CBEAA8];
  v4 = a2;
  v5 = [v3 date];
  [v5 timeIntervalSinceDate:*(a1 + 32)];
  v7 = v6;

  [*(a1 + 48) uuid];
  v8 = [MEMORY[0x277CCABB0] numberWithDouble:v7];
  [v4 domain];

  [v4 code];
  [*(a1 + 56) setThreadCommissioningDuration:v7];
  [*(a1 + 56) setThreadCommissioningError:v4];

  v9 = *(*(a1 + 64) + 16);

  return v9();
}

void __149__HMDHome__processAccessoriesToAddForUnpairedAccessory_certificationStatus_accessoryServer_networkCredential_pairingEvent_message_completionHandler___block_invoke_4(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  }

  dispatch_group_leave(*(a1 + 32));
}

- (BOOL)hasNeverAddedAnyHAPAccessory
{
  firstHAPAccessoryAddedDate = [(HMDHome *)self firstHAPAccessoryAddedDate];
  if (firstHAPAccessoryAddedDate)
  {
    v4 = 0;
  }

  else
  {
    hapAccessories = [(HMDHome *)self hapAccessories];
    v4 = [hapAccessories count] == 0;
  }

  return v4;
}

- (void)_processLegacyPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context
{
  pairingCopy = pairing;
  v61 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  contextCopy = context;
  v9 = [messageCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    if (pairingCopy)
    {
      responseHandler = [messageCopy responseHandler];
      [(HMDHome *)self _cancelPairingWithAccessoryUUID:v9 context:contextCopy completionHandler:responseHandler];
    }

    else
    {
      v50 = [messageCopy stringForKey:*MEMORY[0x277CD1FD8]];
      v49 = [messageCopy stringForKey:@"kAccessoryOnboardingSetupPayloadStringKey"];
      v54 = 0u;
      v55 = 0u;
      v52 = 0u;
      v53 = 0u;
      addPendingAccessories = [(HMDHome *)self addPendingAccessories];
      hm_allKeys = [addPendingAccessories hm_allKeys];

      v19 = [hm_allKeys countByEnumeratingWithState:&v52 objects:v56 count:16];
      if (v19)
      {
        v20 = *v53;
LABEL_9:
        v21 = 0;
        while (1)
        {
          if (*v53 != v20)
          {
            objc_enumerationMutation(hm_allKeys);
          }

          v22 = *(*(&v52 + 1) + 8 * v21);
          accessoryUUID = [v22 accessoryUUID];
          v24 = [accessoryUUID isEqual:v9];

          if (v24)
          {
            break;
          }

          if (v19 == ++v21)
          {
            v19 = [hm_allKeys countByEnumeratingWithState:&v52 objects:v56 count:16];
            if (v19)
            {
              goto LABEL_9;
            }

            goto LABEL_15;
          }
        }

        v25 = v22;

        if (!v25)
        {
          goto LABEL_24;
        }

        v26 = objc_autoreleasePoolPush();
        selfCopy = self;
        v28 = HMFGetOSLogHandle();
        v29 = os_log_type_enabled(v28, OS_LOG_TYPE_INFO);
        if (v50)
        {
          if (v29)
          {
            v30 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v30;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@Storing the setupCode for accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          addPendingAccessorySetupCodes = [(HMDHome *)selfCopy addPendingAccessorySetupCodes];
          [addPendingAccessorySetupCodes setObject:v50 forKey:v9];

          addPendingAccessoryOnboardingSetupPayloadStrings = [(HMDHome *)selfCopy addPendingAccessoryOnboardingSetupPayloadStrings];
          [addPendingAccessoryOnboardingSetupPayloadStrings setObject:v49 forKeyedSubscript:v9];

          accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
          v34 = [accessoryBrowser unpairedAccessoryWithUUID:v9];

          if (v34)
          {
            accessoryBrowser2 = [(HMDHome *)selfCopy accessoryBrowser];
            [accessoryBrowser2 handleSetupCodeAvailable:v34];
          }

          addPendingAccessorySetupCodeHandlers = [(HMDHome *)selfCopy addPendingAccessorySetupCodeHandlers];
          v37 = [addPendingAccessorySetupCodeHandlers objectForKeyedSubscript:v9];

          if (v37)
          {
            os_unfair_recursive_lock_lock_with_options();
            [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v9];
            os_unfair_recursive_lock_unlock();
            (v37)[2](v37, v50, v49, 0);
          }

          else
          {
            v44 = objc_autoreleasePoolPush();
            v45 = selfCopy;
            v46 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
            {
              v47 = HMFGetLogIdentifier();
              *buf = 138543618;
              v58 = v47;
              v59 = 2112;
              v60 = v9;
              _os_log_impl(&dword_2531F8000, v46, OS_LOG_TYPE_INFO, "%{public}@No handler to provide the setup code to for accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v44);
          }

          [messageCopy respondWithSuccess];
        }

        else
        {
          if (v29)
          {
            v42 = HMFGetLogIdentifier();
            *buf = 138543618;
            v58 = v42;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@No setupCode specified to continue pairing with accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v26);
          v43 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          [messageCopy respondWithError:v43];
        }
      }

      else
      {
LABEL_15:

LABEL_24:
        v38 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v40 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
        {
          v41 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v41;
          v59 = 2112;
          v60 = v9;
          _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_INFO, "%{public}@Accessory with UUID %@ not being added to the home", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v38);
        v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:79];
        [messageCopy respondWithError:v25];
      }
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      messagePayload = [messageCopy messagePayload];
      *buf = 138543618;
      v58 = v14;
      v59 = 2112;
      v60 = messagePayload;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@No accessory UUID found in payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:v16];
  }

  v48 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryUUID:(id)d context:(id)context completionHandler:(id)handler
{
  v48 = *MEMORY[0x277D85DE8];
  dCopy = d;
  contextCopy = context;
  handlerCopy = handler;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  unassociatedAccessories = [accessoryBrowser unassociatedAccessories];
  v12 = [unassociatedAccessories hmf_firstObjectWithUUID:dCopy];

  v13 = v12;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = v14;

  if (v15)
  {
    v42[0] = MEMORY[0x277D85DD0];
    v42[1] = 3221225472;
    v42[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke;
    v42[3] = &unk_2797348C0;
    v43 = handlerCopy;
    [v15 cancelConfigurationWithCompletionHandler:v42];
    v16 = v43;
  }

  else
  {
    accessoryBrowser2 = [(HMDHome *)self accessoryBrowser];
    v38 = [accessoryBrowser2 unpairedAccessoryWithUUID:dCopy];

    addPendingAccessorySetupCodeHandlers = [(HMDHome *)self addPendingAccessorySetupCodeHandlers];
    v37 = [addPendingAccessorySetupCodeHandlers objectForKeyedSubscript:dCopy];

    v19 = objc_autoreleasePoolPush();
    selfCopy = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = HMFGetLogIdentifier();
      uUIDString = [dCopy UUIDString];
      *buf = 138543618;
      v45 = v22;
      v46 = 2112;
      v47 = uUIDString;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v19);
    os_unfair_recursive_lock_lock_with_options();
    hm_allKeys = [(NSMapTable *)selfCopy->_addPendingAccessories hm_allKeys];
    v40[0] = MEMORY[0x277D85DD0];
    v40[1] = 3221225472;
    v40[2] = __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1365;
    v40[3] = &unk_279722568;
    v25 = dCopy;
    v41 = v25;
    v26 = [hm_allKeys na_firstObjectPassingTest:v40];

    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:v25];
    if (v26)
    {
      [(NSMapTable *)selfCopy->_addPendingAccessories removeObjectForKey:v26];
    }

    os_unfair_recursive_lock_unlock();
    if (v38)
    {
      accessoryBrowser3 = [(HMDHome *)selfCopy accessoryBrowser];
      v28 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      [accessoryBrowser3 cancelPairingWithAccessory:v38 error:v28 context:contextCopy];
    }

    if (v37)
    {
      v29 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (v37)[2](v37, 0, 0, v29);

      if (handlerCopy)
      {
        (*(handlerCopy + 2))(handlerCopy, 0, 0);
      }
    }

    else
    {
      context = objc_autoreleasePoolPush();
      v30 = selfCopy;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        v32 = HMFGetLogIdentifier();
        uUIDString2 = [v25 UUIDString];
        *buf = 138543618;
        v45 = v32;
        v46 = 2112;
        v47 = uUIDString2;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_INFO, "%{public}@Unable to find setup available completion handler for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(context);
      if (handlerCopy)
      {
        v34 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        (*(handlerCopy + 2))(handlerCopy, v34, 0);
      }
    }

    v16 = v38;
  }

  v35 = *MEMORY[0x277D85DE8];
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0, 0);
  }

  return result;
}

uint64_t __69__HMDHome__cancelPairingWithAccessoryUUID_context_completionHandler___block_invoke_1365(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (void)_processPairingRequestForMessage:(id)message cancelPairing:(BOOL)pairing context:(id)context
{
  pairingCopy = pairing;
  v24 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  contextCopy = context;
  v10 = [messageCopy dataForKey:*MEMORY[0x277CD1F90]];
  v19 = 0;
  v11 = [(HMDHome *)self _setupDescriptionFromData:v10 error:&v19];
  v12 = v19;
  if (v11)
  {
    if (pairingCopy)
    {
      [(HMDHome *)self _cancelPairingWithAccessoryDescription:v11 context:contextCopy];
      [messageCopy respondWithPayload:0];
    }
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = v12;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_cancelPairingWithAccessoryDescription:(id)description context:(id)context
{
  v20 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  contextCopy = context;
  accessoryUUID = [descriptionCopy accessoryUUID];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = descriptionCopy;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Canceling pairing and removing all state for accessory with description %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)selfCopy->_addPendingAccessories removeObjectForKey:descriptionCopy];
  if (accessoryUUID)
  {
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodes removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:accessoryUUID];
  }

  os_unfair_recursive_lock_unlock();
  accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
  v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
  [accessoryBrowser cancelPairingWithAccessoryDescription:descriptionCopy error:v14 context:contextCopy];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleCancelPairingAccessory:(id)accessory
{
  v4 = MEMORY[0x277CCA9B8];
  accessoryCopy = accessory;
  v6 = [v4 hmInternalErrorWithCode:1090];
  v8 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v6];

  v7 = [accessoryCopy dataForKey:*MEMORY[0x277CD1F90]];

  if (v7)
  {
    [(HMDHome *)self _processPairingRequestForMessage:accessoryCopy cancelPairing:1 context:v8];
  }

  else
  {
    [(HMDHome *)self _processLegacyPairingRequestForMessage:accessoryCopy cancelPairing:1 context:v8];
  }
}

- (id)_setupCodeProviderForMessage:(id)message
{
  messageCopy = message;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke;
  aBlock[3] = &unk_279722590;
  objc_copyWeak(&v11, &location);
  v5 = messageCopy;
  v10 = v5;
  v6 = _Block_copy(aBlock);
  v7 = [v6 copy];

  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);

  return v7;
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v11 = WeakRetained;
  if (WeakRetained)
  {
    v12 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2;
    block[3] = &unk_279734668;
    block[4] = v11;
    v15 = v7;
    v16 = v8;
    v18 = v9;
    v17 = *(a1 + 32);
    dispatch_async(v12, block);
  }

  else
  {
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v9 + 2))(v9, 0, 0, v13);
  }
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_2(id *a1)
{
  v81 = *MEMORY[0x277D85DE8];
  v2 = [a1[4] homeManager];
  v3 = [a1[5] uuid];
  v4 = [a1[5] name];
  v5 = v4;
  if (v3)
  {
    v6 = v4 == 0;
  }

  else
  {
    v6 = 1;
  }

  if (v6 || (v7 = a1[6]) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = a1[4];
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v3 UUIDString];
      *buf = 138543874;
      v74 = v19;
      v75 = 2112;
      v76 = v5;
      v77 = 2112;
      v78 = v20;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ went away while being added to home", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v21 = a1[8];
    v22 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
    (*(v21 + 2))(v21, 0, 0, v22);
  }

  else
  {
    if ([v7 isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = a1[4];
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v74 = v11;
        v75 = 2112;
        v76 = v3;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Clearing previous password on bad-password error for accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [a1[4] addPendingAccessorySetupCodes];
      [v12 removeObjectForKey:v3];

      v13 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      [v13 removeObjectForKey:v3];
    }

    v14 = *MEMORY[0x277CD1FD8];
    v15 = [a1[7] stringForKey:*MEMORY[0x277CD1FD8]];
    if (v15 && [a1[7] isEntitledForSPIAccess])
    {
      if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonBadPassword"])
      {

LABEL_27:
        v46 = objc_autoreleasePoolPush();
        v47 = a1[4];
        v48 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
        {
          v49 = HMFGetLogIdentifier();
          v50 = [a1[7] stringForKey:v14];
          v51 = [v3 UUIDString];
          *buf = 138544130;
          v74 = v49;
          v75 = 2112;
          v76 = v50;
          v77 = 2112;
          v78 = v5;
          v79 = 2112;
          v80 = v51;
          _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Provided password %@ incorrect for accessory %@/%@", buf, 0x2Au);
        }

        objc_autoreleasePoolPop(v46);
        v52 = a1[8];
        v22 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v52 + 2))(v52, 0, 0, v22);
        goto LABEL_17;
      }

      v45 = [a1[6] isEqualToString:@"HMSetupCodeProviderReasontTimeoutRetry"];

      if (v45)
      {
        goto LABEL_27;
      }
    }

    else
    {
    }

    v24 = a1[4];
    os_unfair_recursive_lock_lock_with_options();
    v25 = [a1[8] copy];
    v26 = _Block_copy(v25);
    [*(a1[4] + 100) setObject:v26 forKeyedSubscript:v3];

    os_unfair_recursive_lock_unlock();
    if ([a1[6] isEqualToString:@"HMSetupCodeProviderReasonInitial"])
    {
      v27 = [a1[4] addPendingAccessorySetupCodes];
      v22 = [v27 objectForKey:v3];

      v28 = [a1[4] addPendingAccessoryOnboardingSetupPayloadStrings];
      v29 = [v28 objectForKeyedSubscript:v3];

      v30 = objc_autoreleasePoolPush();
      v31 = a1[4];
      v32 = HMFGetOSLogHandle();
      v33 = os_log_type_enabled(v32, OS_LOG_TYPE_INFO);
      if (v22)
      {
        if (v33)
        {
          v34 = HMFGetLogIdentifier();
          v35 = a1[5];
          *buf = 138543618;
          v74 = v34;
          v75 = 2112;
          v76 = v35;
          _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Providing setupCode for accessory %@ and removing from tracking", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v30);
        (*(a1[8] + 2))();
      }

      else
      {
        if (v33)
        {
          v53 = HMFGetLogIdentifier();
          *buf = 138543874;
          v74 = v53;
          v75 = 2112;
          v76 = v5;
          v77 = 2112;
          v78 = v3;
          _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ prompted for pairing setupCode but did not receive it from HomeUIService", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v30);
        if ([a1[7] BOOLForKey:*MEMORY[0x277CD2010]])
        {
          v54 = objc_autoreleasePoolPush();
          v55 = a1[4];
          v56 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
          {
            v57 = HMFGetLogIdentifier();
            v58 = [v3 UUIDString];
            *buf = 138543874;
            v74 = v57;
            v75 = 2112;
            v76 = v5;
            v77 = 2112;
            v78 = v58;
            _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@addAccessory request from HomeUIService - waiting for setupCode for accessory %@/%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v54);
        }

        else
        {
          v64 = [v2 accessorySetupManager];
          v65 = [a1[4] uuid];
          v66 = [a1[7] proxyConnection];
          v68[0] = MEMORY[0x277D85DD0];
          v68[1] = 3221225472;
          v68[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1360;
          v68[3] = &unk_279735168;
          v68[4] = a1[4];
          v70 = a1[8];
          v69 = v3;
          [v64 launchAccessorySetupHostToRequestSetupCodeForAccessoryWithUUID:v69 accessoryName:v5 homeUUID:v65 clientConnection:v66 completionHandler:v68];
        }

        v22 = v29;
      }
    }

    else
    {
      v36 = objc_alloc(MEMORY[0x277D0F820]);
      v37 = [a1[4] uuid];
      v22 = [v36 initWithTarget:v37];

      v38 = objc_alloc(MEMORY[0x277D0F848]);
      v39 = a1[6];
      v71 = *MEMORY[0x277CD2018];
      v72 = v39;
      v40 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v72 forKeys:&v71 count:1];
      v41 = [v38 initWithName:*MEMORY[0x277CCFDB8] qualityOfService:33 destination:v22 payload:v40];

      v42 = [v2 accessorySetupManager];
      v43 = [v42 accessorySetupHostClientConnection];

      if (v43)
      {
        [v41 setTransport:v43];
        v44 = [a1[4] msgDispatcher];
        [v44 sendMessage:v41];
      }

      else
      {
        context = objc_autoreleasePoolPush();
        v59 = a1[4];
        v60 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v60, OS_LOG_TYPE_INFO))
        {
          v61 = HMFGetLogIdentifier();
          v62 = a1[5];
          *buf = 138543618;
          v74 = v61;
          v75 = 2112;
          v76 = v62;
          _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_INFO, "%{public}@No HomeUIService connection for accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(context);
        v63 = a1[8];
        v44 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2002];
        (*(v63 + 2))(v63, 0, 0, v44);
      }
    }
  }

LABEL_17:

  v23 = *MEMORY[0x277D85DE8];
}

void __40__HMDHome__setupCodeProviderForMessage___block_invoke_1360(id *a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [a1[4] workQueue];
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1361;
    v5[3] = &unk_279734578;
    v5[4] = a1[4];
    v6 = v3;
    v8 = a1[6];
    v7 = a1[5];
    dispatch_async(v4, v5);
  }
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_2_1361(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_ERROR))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    *buf = 138543618;
    v16 = v5;
    v17 = 2112;
    v18 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_ERROR, "%{public}@Failed to request setup code for accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 40);
  (*(*(a1 + 56) + 16))();
  v8 = *(a1 + 32);
  os_unfair_recursive_lock_lock_with_options();
  v9 = [*(*(a1 + 32) + 1032) hm_allKeys];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __40__HMDHome__setupCodeProviderForMessage___block_invoke_1362;
  v13[3] = &unk_279722568;
  v14 = *(a1 + 48);
  v10 = [v9 na_firstObjectPassingTest:v13];

  if (v10)
  {
    [*(*(a1 + 32) + 1032) removeObjectForKey:v10];
  }

  [*(*(a1 + 32) + 800) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 808) removeObjectForKey:*(a1 + 48)];
  [*(*(a1 + 32) + 816) removeObjectForKey:*(a1 + 48)];

  result = os_unfair_recursive_lock_unlock();
  v12 = *MEMORY[0x277D85DE8];
  return result;
}

uint64_t __40__HMDHome__setupCodeProviderForMessage___block_invoke_1362(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 accessoryUUID];
  v4 = [v2 isEqual:v3];

  return v4;
}

- (BOOL)hasAnyReachableAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_any:&__block_literal_global_1359];

  return v3;
}

- (void)retrieveStateForTrackedAccessory:(id)accessory stateNumber:(id *)number isReachable:(BOOL *)reachable linkQuality:(unint64_t *)quality lastSeen:(id *)seen
{
  accessoryCopy = accessory;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  accessoryBrowserHapProtocol = [accessoryBrowser accessoryBrowserHapProtocol];
  [accessoryBrowserHapProtocol retrieveCurrentStateForIdentifier:accessoryCopy stateNumber:number isReachable:reachable linkQuality:quality lastSeen:seen];
}

- (void)getReachableIPAccessories:(unint64_t *)accessories btleAccessories:(unint64_t *)btleAccessories mediaAccessories:(unint64_t *)mediaAccessories
{
  v31 = *MEMORY[0x277D85DE8];
  if (accessories | btleAccessories)
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    obj = [(HMDHome *)self accessories];
    v5 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = 0;
      v8 = 0;
      v9 = 0;
      v10 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v10)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if (v14)
          {
            v15 = [v14 matchingHAPAccessoryWithLinkType:1];
            v9 += [v15 isReachable];
            v16 = [v14 matchingHAPAccessoryWithLinkType:2];

            v8 += [v16 isReachable];
          }

          v17 = v12;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v18 = v17;
          }

          else
          {
            v18 = 0;
          }

          v19 = v18;

          isReachable = [v19 isReachable];
          v7 += isReachable;
        }

        v6 = [obj countByEnumeratingWithState:&v26 objects:v30 count:16];
      }

      while (v6);
    }

    else
    {
      v7 = 0;
      v8 = 0;
      v9 = 0;
    }

    if (accessories)
    {
      *accessories = v9;
    }

    if (btleAccessories)
    {
      *btleAccessories = v8;
    }

    if (mediaAccessories)
    {
      *mediaAccessories = v7;
    }
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (int64_t)reachableAppleMediaAccessoriesCount
{
  v18 = *MEMORY[0x277D85DE8];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v14;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(accessories);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if (v10)
        {
          v5 += [v8 isReachable];
        }
      }

      v4 = [accessories countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v11 = *MEMORY[0x277D85DE8];
  return v5;
}

- (int64_t)reachableAccessoriesCountExcludingMatter
{
  selfCopy = self;
  v41 = *MEMORY[0x277D85DE8];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  accessories = [(HMDHome *)self accessories];
  v4 = [accessories countByEnumeratingWithState:&v30 objects:v40 count:16];
  if (v4)
  {
    v6 = v4;
    v29 = 0;
    v7 = *v31;
    *&v5 = 138543618;
    v26 = v5;
    v27 = accessories;
    v28 = selfCopy;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v31 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v30 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          if ([v11 isReachable] && (objc_msgSend(v11, "supportsCHIP") & 1) == 0)
          {
            v12 = objc_autoreleasePoolPush();
            v13 = selfCopy;
            v14 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
            {
              v15 = HMFGetLogIdentifier();
              name = [v11 name];
              *buf = v26;
              v35 = v15;
              v36 = 2112;
              v37 = name;
              _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Accessory: %@ is reachable", buf, 0x16u);

              selfCopy = v28;
              accessories = v27;
            }

            objc_autoreleasePoolPop(v12);
            ++v29;
          }

          if ([v11 supportsCHIP])
          {
            v17 = objc_autoreleasePoolPush();
            v18 = selfCopy;
            v19 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
            {
              v20 = HMFGetLogIdentifier();
              name2 = [v11 name];
              isReachable = [v11 isReachable];
              *buf = 138543874;
              v23 = @"NO";
              if (isReachable)
              {
                v23 = @"YES";
              }

              v35 = v20;
              v36 = 2112;
              v37 = name2;
              v38 = 2112;
              v39 = v23;
              _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Ignoring Matter Accessory: %@ isReachable: %@", buf, 0x20u);

              accessories = v27;
              selfCopy = v28;
            }

            objc_autoreleasePoolPop(v17);
          }
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v30 objects:v40 count:16];
    }

    while (v6);
  }

  else
  {
    v29 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];
  return v29;
}

- (int64_t)reachableAccessoriesCount
{
  v21 = *MEMORY[0x277D85DE8];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  obj = [(HMDHome *)self accessories];
  v2 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = 0;
    v5 = *v17;
    do
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
        }

        else
        {
          v8 = 0;
        }

        v9 = v8;

        v10 = v7;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v9 && [v9 isReachable])
        {
          ++v4;
        }

        else if (v12 && [v12 isCurrentAccessory])
        {
          v4 += [v12 isReachable];
        }
      }

      v3 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v3);
  }

  else
  {
    v4 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];
  return v4;
}

- (void)_reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable
{
  reachableCopy = reachable;
  v71 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  reachableAccessoriesCount = [(HMDHome *)self reachableAccessoriesCount];
  previousReachableAccessoriesCount = [(HMDHome *)self previousReachableAccessoriesCount];
  reachableAppleMediaAccessoriesCount = [(HMDHome *)self reachableAppleMediaAccessoriesCount];
  previousReachableAppleMediaAccessoriesCount = [(HMDHome *)self previousReachableAppleMediaAccessoriesCount];
  [(HMDHome *)self setPreviousReachableAccessoriesCount:reachableAccessoriesCount];
  [(HMDHome *)self setPreviousReachableAppleMediaAccessoriesCount:reachableAppleMediaAccessoriesCount];
  v11 = reachableAppleMediaAccessoriesCount + reachableAccessoriesCount < 1;
  v57 = previousReachableAccessoriesCount;
  v55 = previousReachableAppleMediaAccessoriesCount + previousReachableAccessoriesCount;
  if ((previousReachableAppleMediaAccessoriesCount + previousReachableAccessoriesCount < 0) ^ __OFADD__(previousReachableAppleMediaAccessoriesCount, previousReachableAccessoriesCount) | (previousReachableAppleMediaAccessoriesCount + previousReachableAccessoriesCount == 0))
  {
    v12 = 0;
  }

  else
  {
    v12 = 1;
  }

  if ((previousReachableAppleMediaAccessoriesCount + previousReachableAccessoriesCount < 0) ^ __OFADD__(previousReachableAppleMediaAccessoriesCount, previousReachableAccessoriesCount) | (previousReachableAppleMediaAccessoriesCount + previousReachableAccessoriesCount == 0))
  {
    v13 = reachableAppleMediaAccessoriesCount + reachableAccessoriesCount < 1;
  }

  else
  {
    v13 = 1;
  }

  v14 = v11 ^ v12;
  if (((v11 ^ v12) & 1) == 0)
  {
    v53 = v11 ^ v12;
    v54 = accessoryCopy;
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138544642;
      v60 = v18;
      v61 = 2048;
      v62 = reachableAccessoriesCount;
      v63 = 2048;
      v64 = reachableAppleMediaAccessoriesCount;
      v65 = 1024;
      v66 = reachableCopy;
      v67 = 2048;
      v68 = v57;
      v69 = 2048;
      v70 = previousReachableAppleMediaAccessoriesCount;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Total reachable accessories %ld, apple media accessories: %ld, reachable = %d,                      last known reachable = %ld, last known apple media reachable = %ld", buf, 0x3Au);
    }

    objc_autoreleasePoolPop(v15);
    accessoryCopy = v54;
    v14 = v53;
  }

  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsRemoteAccess = [localCapabilitiesDataSource supportsRemoteAccess];

  if (supportsRemoteAccess)
  {
    v58 = 0;
    [(HMDHome *)self getReachableIPAccessories:&v58 btleAccessories:0 mediaAccessories:0];
    if (v13)
    {
      if (reachableAppleMediaAccessoriesCount + reachableAccessoriesCount > 0 || v55 < 1)
      {
        goto LABEL_18;
      }

      homeLocationHandler = [(HMDHome *)self homeLocationHandler];
      [homeLocationHandler accessoriesBecomeUnreachable];
    }

    else
    {
      homeLocationHandler = [(HMDHome *)self homeLocationHandler];
      [homeLocationHandler accessoriesBecomeReachable];
    }

LABEL_18:
    v22 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v24 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      v26 = v25;
      v27 = @"don't ";
      if (reachableAccessoriesCount > 0)
      {
        v27 = &stru_286509E58;
      }

      *buf = 138543618;
      v60 = v25;
      v61 = 2112;
      v62 = v27;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Notifying home manager that we %@have locally reachable accessories", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    homeManager = [(HMDHome *)selfCopy2 homeManager];
    uuid = [(HMDHome *)selfCopy2 uuid];
    [homeManager accessoriesAreLocallyReachableOnTransientDevice:reachableAccessoriesCount > 0 forHome:uuid];

    if ([accessoryCopy accessoryReprovisionState] && reachableCopy)
    {
      v30 = v14;
      v31 = objc_autoreleasePoolPush();
      v32 = selfCopy2;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        [accessoryCopy name];
        v36 = v35 = accessoryCopy;
        *buf = 138543618;
        v60 = v34;
        v61 = 2112;
        v62 = v36;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ reprovision state is updated to Not Required", buf, 0x16u);

        accessoryCopy = v35;
      }

      objc_autoreleasePoolPop(v31);
      [accessoryCopy setAccessoryReprovisionState:0];
      uuid2 = [accessoryCopy uuid];
      [homeManager updateGenerationCounterWithReason:@"ReprovisionStateChange" sourceUUID:uuid2 shouldNotifyClients:0];

      dictionary = [MEMORY[0x277CBEB38] dictionary];
      uuid3 = [accessoryCopy uuid];
      uUIDString = [uuid3 UUIDString];
      [dictionary setObject:uUIDString forKeyedSubscript:*MEMORY[0x277CCF0B0]];

      [dictionary setObject:&unk_286627808 forKeyedSubscript:*MEMORY[0x277CD2008]];
      v41 = MEMORY[0x277D0F848];
      v42 = *MEMORY[0x277CD1FF8];
      [(HMDHome *)v32 messageDestination];
      v44 = v43 = accessoryCopy;
      v45 = [v41 messageWithName:v42 destination:v44 payload:dictionary];

      accessoryCopy = v43;
      msgDispatcher = [(HMDHome *)v32 msgDispatcher];
      [msgDispatcher sendMessage:v45 completionHandler:0];

      v14 = v30;
    }
  }

  if (reachableAccessoriesCount >= 1 && v57 <= 0)
  {
    v47 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v49 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
    {
      v50 = HMFGetLogIdentifier();
      *buf = 138543362;
      v60 = v50;
      _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Notifying that we see at least one reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v47);
    notificationCenter = [(HMDHome *)selfCopy3 notificationCenter];
    [notificationCenter postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:selfCopy3];
  }

  if ((v14 & 1) == 0)
  {
    [(HMFTimer *)self->_homeLocationTimer resume];
  }

  v52 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityChange:(id)change
{
  v100 = *MEMORY[0x277D85DE8];
  changeCopy = change;
  v64 = *MEMORY[0x277CD0640];
  v5 = [changeCopy stringForKey:?];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  v8 = [v5 isEqualToString:uUIDString];

  selfCopy = self;
  v66 = v5;
  if (v8)
  {
    v65 = 0;
  }

  else
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      uuid2 = [(HMDHome *)selfCopy2 uuid];
      uUIDString2 = [uuid2 UUIDString];
      *buf = 138543874;
      v91 = v12;
      v92 = 2112;
      v93 = v5;
      v94 = 2112;
      v95 = uUIDString2;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Home does not match, received: %@, current: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    v65 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
  }

  v67 = changeCopy;
  messagePayload = [changeCopy messagePayload];
  v16 = [messagePayload hmf_arrayForKey:*MEMORY[0x277CCE7A8]];

  v86 = 0u;
  v87 = 0u;
  v84 = 0u;
  v85 = 0u;
  obj = v16;
  v17 = selfCopy;
  v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
  if (v70)
  {
    v69 = *v85;
    do
    {
      v18 = 0;
      do
      {
        if (*v85 != v69)
        {
          objc_enumerationMutation(obj);
        }

        v71 = v18;
        v19 = *(*(&v84 + 1) + 8 * v18);
        v80 = 0u;
        v81 = 0u;
        v82 = 0u;
        v83 = 0u;
        accessories = [(HMDHome *)v17 accessories];
        v79 = [accessories countByEnumeratingWithState:&v80 objects:v98 count:16];
        if (v79)
        {
          v78 = *v81;
          v76 = v19;
          do
          {
            for (i = 0; i != v79; ++i)
            {
              if (*v81 != v78)
              {
                objc_enumerationMutation(accessories);
              }

              v21 = *(*(&v80 + 1) + 8 * i);
              uuid3 = [v21 uuid];
              uUIDString3 = [uuid3 UUIDString];

              v24 = [v19 objectForKeyedSubscript:uUIDString3];
              if (v24)
              {
                v25 = objc_autoreleasePoolPush();
                v26 = v17;
                v27 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
                {
                  v28 = HMFGetLogIdentifier();
                  *buf = 138543874;
                  v91 = v28;
                  v92 = 2112;
                  v93 = uUIDString3;
                  v94 = 2112;
                  v95 = v24;
                  _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Setting remote reachability for accessory: %@ to: %@", buf, 0x20u);
                }

                objc_autoreleasePoolPop(v25);
                [v21 setRemotelyReachable:{objc_msgSend(v24, "BOOLValue")}];
              }

              v29 = v21;
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v30 = v29;
              }

              else
              {
                v30 = 0;
              }

              v31 = v30;

              identifier = [v31 identifier];

              if (identifier)
              {
                identifier2 = [v31 identifier];
                v34 = [v19 objectForKeyedSubscript:identifier2];

                if (v34)
                {
                  unsignedIntegerValue = [v34 unsignedIntegerValue];
                  context = objc_autoreleasePoolPush();
                  v36 = v17;
                  v37 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v37, OS_LOG_TYPE_DEBUG))
                  {
                    v38 = HMFGetLogIdentifier();
                    identifier3 = [v29 identifier];
                    [v31 suspendedState];
                    HAPAccessorySuspendedStateDescription();
                    v40 = v73 = uUIDString3;
                    HAPAccessorySuspendedStateDescription();
                    v41 = v74 = unsignedIntegerValue;
                    *buf = 138544130;
                    v91 = v38;
                    v92 = 2112;
                    v93 = identifier3;
                    v94 = 2112;
                    v95 = v40;
                    v96 = 2112;
                    v97 = v41;
                    _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_DEBUG, "%{public}@Handle Reachability change. Setting suspended state of accessory: %@ from '%@' to '%@'", buf, 0x2Au);

                    unsignedIntegerValue = v74;
                    uUIDString3 = v73;

                    v17 = selfCopy;
                  }

                  objc_autoreleasePoolPop(context);
                  [v31 setSuspendedState:unsignedIntegerValue shouldNotify:0 saveToBackingStore:1];
                }

                v19 = v76;
              }
            }

            v79 = [accessories countByEnumeratingWithState:&v80 objects:v98 count:16];
          }

          while (v79);
        }

        v18 = v71 + 1;
      }

      while (v71 + 1 != v70);
      v70 = [obj countByEnumeratingWithState:&v84 objects:v99 count:16];
    }

    while (v70);
  }

  responseHandler = [v67 responseHandler];

  if (responseHandler)
  {
    responseHandler2 = [v67 responseHandler];
    (responseHandler2)[2](responseHandler2, v65, 0);
  }

  remoteSourceDevice = [v67 remoteSourceDevice];
  primaryResident = [(HMDHome *)selfCopy primaryResident];
  device = [primaryResident device];
  if ([remoteSourceDevice isEqual:device])
  {
    currentRemoteReachabilityRegistration = [(HMDHome *)selfCopy currentRemoteReachabilityRegistration];

    if (currentRemoteReachabilityRegistration)
    {
      goto LABEL_42;
    }
  }

  else
  {
  }

  v48 = objc_autoreleasePoolPush();
  v49 = selfCopy;
  v50 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
  {
    v51 = HMFGetLogIdentifier();
    *buf = 138543618;
    v91 = v51;
    v92 = 2112;
    v93 = remoteSourceDevice;
    _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@De-registering stale remote reachability for accessories with device = %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v48);
  v52 = objc_alloc(MEMORY[0x277D0F818]);
  allMessageDestinations = [MEMORY[0x277D0F820] allMessageDestinations];
  v88 = v64;
  uuid4 = [(HMDHome *)v49 uuid];
  uUIDString4 = [uuid4 UUIDString];
  v89 = uUIDString4;
  v56 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
  v57 = [v52 initWithName:@"kDisableAccessoryReachabilityNotificationRequestKey" destination:allMessageDestinations payload:v56];

  homeManager = [(HMDHome *)v49 homeManager];
  messageDispatcher = [homeManager messageDispatcher];
  uuid5 = [(HMDHome *)v49 uuid];
  remoteDestinationString = [remoteSourceDevice remoteDestinationString];
  workQueue = [(HMDHome *)v49 workQueue];
  [messageDispatcher sendSecureMessage:v57 target:uuid5 userID:0 destination:remoteDestinationString responseQueue:workQueue responseHandler:0];

LABEL_42:
  v63 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoteReachabilityNotificationTimerFired
{
  v82 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v4 = objc_autoreleasePoolPush();
  selfCopy = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    remoteReachabilityNotificationPendingAccessories = [(HMDHome *)selfCopy remoteReachabilityNotificationPendingAccessories];
    *buf = 138543618;
    v75 = v7;
    v76 = 2112;
    v77 = remoteReachabilityNotificationPendingAccessories;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Reachability notification timer fired, pending list: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v70 = 0u;
  v71 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
  v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
  if (v58)
  {
    v57 = *v69;
    v55 = *MEMORY[0x277CD0640];
    v56 = *MEMORY[0x277CCE7A8];
    *&v9 = 138543874;
    v53 = v9;
    v10 = 0x277CCA000uLL;
    v62 = selfCopy;
    do
    {
      v11 = 0;
      do
      {
        if (*v69 != v57)
        {
          objc_enumerationMutation(obj);
        }

        v59 = *(*(&v68 + 1) + 8 * v11);
        v60 = v11;
        v12 = MEMORY[0x277CBEB18];
        remoteReachabilityNotificationPendingAccessories2 = [(HMDHome *)selfCopy remoteReachabilityNotificationPendingAccessories];
        v63 = [v12 arrayWithCapacity:{objc_msgSend(remoteReachabilityNotificationPendingAccessories2, "count")}];

        v66 = 0u;
        v67 = 0u;
        v64 = 0u;
        v65 = 0u;
        accessories = [(HMDHome *)selfCopy accessories];
        v14 = [accessories countByEnumeratingWithState:&v64 objects:v80 count:16];
        if (v14)
        {
          v15 = v14;
          v16 = *v65;
          do
          {
            for (i = 0; i != v15; ++i)
            {
              if (*v65 != v16)
              {
                objc_enumerationMutation(accessories);
              }

              v18 = *(*(&v64 + 1) + 8 * i);
              uuid = [v18 uuid];
              uUIDString = [uuid UUIDString];
              v21 = [(HMDHome *)selfCopy _getReachabilityTupleForAccessoryUUID:uUIDString];

              if (v21)
              {
                v22 = MEMORY[0x277CBEB38];
                v23 = [*(v10 + 2992) numberWithBool:{objc_msgSend(v21, "currentReachability")}];
                accessoryUUID = [v21 accessoryUUID];
                v25 = [v22 dictionaryWithObject:v23 forKey:accessoryUUID];

                v26 = v18;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v27 = v26;
                }

                else
                {
                  v27 = 0;
                }

                v28 = v27;

                identifier = [v28 identifier];

                if (identifier)
                {
                  v30 = [*(v10 + 2992) numberWithUnsignedInteger:{objc_msgSend(v28, "suspendedState")}];
                  identifier2 = [v28 identifier];
                  [v25 setObject:v30 forKey:identifier2];
                }

                [v63 addObject:v25];

                selfCopy = v62;
              }
            }

            v15 = [accessories countByEnumeratingWithState:&v64 objects:v80 count:16];
          }

          while (v15);
        }

        if ([v63 count])
        {
          v32 = v10;
          v33 = objc_autoreleasePoolPush();
          v34 = selfCopy;
          v35 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
          {
            v36 = HMFGetLogIdentifier();
            v37 = [v63 count];
            device = [v59 device];
            remoteDestinationString = [device remoteDestinationString];
            *buf = v53;
            v75 = v36;
            v76 = 2048;
            v77 = v37;
            v78 = 2112;
            v79 = remoteDestinationString;
            _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending current reachability for %tu accessories to destination:%@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v33);
          v72[0] = v56;
          v40 = [v63 copy];
          v72[1] = v55;
          v73[0] = v40;
          uuid2 = [(HMDHome *)v34 uuid];
          uUIDString2 = [uuid2 UUIDString];
          v73[1] = uUIDString2;
          v43 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v44 = [MEMORY[0x277D0F818] messageWithName:@"kRemoteReachabilityChangedNotificationKey" identifier:0 messagePayload:v43];
          homeManager = [(HMDHome *)v34 homeManager];
          messageDispatcher = [homeManager messageDispatcher];
          uuid3 = [(HMDHome *)v34 uuid];
          device2 = [v59 device];
          remoteDestinationString2 = [device2 remoteDestinationString];
          workQueue2 = [(HMDHome *)v34 workQueue];
          [messageDispatcher sendSecureMessage:v44 target:uuid3 userID:0 destination:remoteDestinationString2 responseQueue:workQueue2 responseHandler:0];

          selfCopy = v62;
          v10 = v32;
        }

        v11 = v60 + 1;
      }

      while (v60 + 1 != v58);
      v58 = [obj countByEnumeratingWithState:&v68 objects:v81 count:16];
    }

    while (v58);
  }

  remoteReachabilityNotificationPendingAccessories3 = [(HMDHome *)selfCopy remoteReachabilityNotificationPendingAccessories];
  [remoteReachabilityNotificationPendingAccessories3 removeAllObjects];

  [(HMDHome *)selfCopy setReachabilityNotificationTimer:0];
  v52 = *MEMORY[0x277D85DE8];
}

- (void)_updateReachabilityChangeToRegisteredDevices:(id)devices
{
  v43 = *MEMORY[0x277D85DE8];
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  uuid = [devicesCopy uuid];
  uUIDString = [uuid UUIDString];

  v8 = [(HMDHome *)self _getReachabilityTupleForAccessoryUUID:uUIDString];
  if ([devicesCopy isReachable])
  {
    v9 = 1;
  }

  else
  {
    homeManager = [(HMDHome *)self homeManager];
    residentMesh = [homeManager residentMesh];
    v12 = [residentMesh deviceForAccessory:devicesCopy residentOrder:1 reachableResidents:0];
    v9 = v12 != 0;
  }

  v13 = devicesCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = v14;

  if (v15)
  {
    [v8 setPreviouslySentSuspendedState:{objc_msgSend(v8, "currentSuspendedState")}];
    [v8 setCurrentSuspendedState:{objc_msgSend(v15, "suspendedState")}];
  }

  if (!v8)
  {
    remoteReachabilityNotificationPendingAccessories2 = [HMDAccessoryReachabilityTuple tupleWithAccessoryUUID:uUIDString reachable:v9];
    [remoteReachabilityNotificationPendingAccessories2 setCurrentSuspendedState:{objc_msgSend(v15, "suspendedState")}];
    remoteReachabilityNotificationPendingAccessories = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
    [remoteReachabilityNotificationPendingAccessories addObject:remoteReachabilityNotificationPendingAccessories2];

    reachabilityNotificationTimer = [(HMDHome *)self reachabilityNotificationTimer];

    if (!reachabilityNotificationTimer)
    {
      v26 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:1 options:*&remoteReachabilityNotificationsDeferPeriod];
      [(HMDHome *)self setReachabilityNotificationTimer:v26];

      workQueue2 = [(HMDHome *)self workQueue];
      reachabilityNotificationTimer2 = [(HMDHome *)self reachabilityNotificationTimer];
      [reachabilityNotificationTimer2 setDelegateQueue:workQueue2];

      reachabilityNotificationTimer3 = [(HMDHome *)self reachabilityNotificationTimer];
      [reachabilityNotificationTimer3 setDelegate:self];

      reachabilityNotificationTimer4 = [(HMDHome *)self reachabilityNotificationTimer];
      [reachabilityNotificationTimer4 resume];

      v31 = objc_autoreleasePoolPush();
      selfCopy = self;
      v33 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        v34 = HMFGetLogIdentifier();
        reachabilityNotificationTimer5 = [(HMDHome *)selfCopy reachabilityNotificationTimer];
        v37 = 138543874;
        v38 = v34;
        v39 = 2048;
        v40 = reachabilityNotificationTimer5;
        v41 = 2048;
        v42 = remoteReachabilityNotificationsDeferPeriod;
        _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Started reachability notification defer timer %p for %f sec", &v37, 0x20u);
      }

      objc_autoreleasePoolPop(v31);
    }

    goto LABEL_19;
  }

  [v8 setCurrentReachability:v9];
  previouslySentReachability = [v8 previouslySentReachability];
  if (previouslySentReachability == [v8 currentReachability])
  {
    previouslySentSuspendedState = [v8 previouslySentSuspendedState];
    if (previouslySentSuspendedState == [v8 currentSuspendedState])
    {
      v18 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = HMFGetLogIdentifier();
        v22 = HMFBooleanToString();
        v37 = 138543874;
        v38 = v21;
        v39 = 2112;
        v40 = v13;
        v41 = 2112;
        v42 = v22;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ toggled reachability back to %@ ignoring", &v37, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
      remoteReachabilityNotificationPendingAccessories2 = [(HMDHome *)selfCopy2 remoteReachabilityNotificationPendingAccessories];
      [remoteReachabilityNotificationPendingAccessories2 removeObject:v8];
LABEL_19:
    }
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (id)_getReachabilityTupleForAccessoryUUID:(id)d
{
  v20 = *MEMORY[0x277D85DE8];
  dCopy = d;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  remoteReachabilityNotificationPendingAccessories = [(HMDHome *)self remoteReachabilityNotificationPendingAccessories];
  v7 = [remoteReachabilityNotificationPendingAccessories countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = *v16;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(remoteReachabilityNotificationPendingAccessories);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        accessoryUUID = [v10 accessoryUUID];
        v12 = [accessoryUUID isEqual:dCopy];

        if (v12)
        {
          v7 = v10;
          goto LABEL_11;
        }
      }

      v7 = [remoteReachabilityNotificationPendingAccessories countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (void)_deregisterDeviceForReachabilityNotification:(id)notification
{
  v30 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543618;
    v27 = v9;
    v28 = 2112;
    v29 = notificationCopy;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@De-registering device %@ for reachability notification", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  v22 = 0u;
  reachabilityRegisteredDevices = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
  v11 = [reachabilityRegisteredDevices copy];

  v12 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v22;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v22 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = *(*(&v21 + 1) + 8 * i);
        device = [v16 device];
        v18 = [device isEqual:notificationCopy];

        if (v18)
        {
          reachabilityRegisteredDevices2 = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
          [reachabilityRegisteredDevices2 removeObject:v16];
        }
      }

      v13 = [v11 countByEnumeratingWithState:&v21 objects:v25 count:16];
    }

    while (v13);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (void)_registerDeviceForReachabilityNotification:(id)notification accessoryList:(id)list
{
  v20 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  listCopy = list;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self _deregisterDeviceForReachabilityNotification:notificationCopy];
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v12 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v12;
    v18 = 2112;
    v19 = notificationCopy;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Registering device %@ for reachability notification", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = [[HMDDeviceRegistrationEntry alloc] initWithDevice:notificationCopy accessoryList:listCopy];
  if (v13)
  {
    reachabilityRegisteredDevices = [(HMDHome *)selfCopy reachabilityRegisteredDevices];
    [reachabilityRegisteredDevices addObject:v13];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)resetAccessoryHashedRouteIdentifiers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(accessories);
        }

        [*(*(&v8 + 1) + 8 * v6++) resetHashedRoute];
      }

      while (v4 != v6);
      v4 = [accessories countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (void)btleAccessoryReachabilityProbeTimer:(BOOL)timer
{
  workQueue = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke;
  v6[3] = &unk_279735D28;
  v6[4] = self;
  timerCopy = timer;
  dispatch_async(workQueue, v6);
}

void __47__HMDHome_btleAccessoryReachabilityProbeTimer___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) accessoryBrowser];
  [v2 btleAccessoryReachabilityProbeTimer:*(a1 + 40)];
}

- (BOOL)evaluatePredicate:(id)predicate
{
  v27[1] = *MEMORY[0x277D85DE8];
  predicateCopy = predicate;
  predicateUtility = [(HMDHome *)self predicateUtility];
  v6 = [predicateUtility rewritePredicate:predicateCopy currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:0];

  v26 = @"THIS_OBJECT";
  predicateUtility2 = [(HMDHome *)self predicateUtility];
  v27[0] = predicateUtility2;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v27 forKeys:&v26 count:1];

  [v6 allowEvaluation];
  predicateUtility3 = [(HMDHome *)self predicateUtility];
  v10 = [v6 evaluateWithObject:predicateUtility3 substitutionVariables:v8];

  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v15 = HMFBooleanToString();
    v18 = 138544130;
    v19 = v14;
    v20 = 2112;
    v21 = predicateCopy;
    v22 = 2112;
    v23 = v6;
    v24 = 2112;
    v25 = v15;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Evaluating predicate %@ (rewritten %@) with result %@", &v18, 0x2Au);
  }

  objc_autoreleasePoolPop(v11);
  v16 = *MEMORY[0x277D85DE8];
  return v10;
}

- (void)handleEvaluatePredicateMessage:(id)message
{
  v38[1] = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = [messageCopy predicateForKey:*MEMORY[0x277CD24A8]];
  v6 = [messageCopy stringForKey:*MEMORY[0x277CD2660]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (v8)
  {
    responseHandler = [messageCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [messageCopy responseHandler];
      v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      (responseHandler2)[2](responseHandler2, v11, 0);
    }
  }

  else
  {
    v31 = v5;
    v12 = [(HMDHome *)self evaluatePredicate:v5];
    responseHandler3 = [messageCopy responseHandler];

    if (responseHandler3)
    {
      responseHandler4 = [messageCopy responseHandler];
      v37 = *MEMORY[0x277CD24B8];
      v15 = [MEMORY[0x277CCABB0] numberWithBool:v12];
      v38[0] = v15;
      v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v38 forKeys:&v37 count:1];
      (responseHandler4)[2](responseHandler4, 0, v16);
    }

    v17 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v7];
    v32 = 0u;
    v33 = 0u;
    v34 = 0u;
    v35 = 0u;
    accessories = [(HMDHome *)self accessories];
    v19 = [accessories countByEnumeratingWithState:&v32 objects:v36 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v33;
      while (2)
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v33 != v21)
          {
            objc_enumerationMutation(accessories);
          }

          v23 = *(*(&v32 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          v26 = [v25 serviceWithUUID:v17];
          if (v26)
          {
            v27 = v26;
            remoteSourceDevice = [messageCopy remoteSourceDevice];
            remoteDestinationString = [remoteSourceDevice remoteDestinationString];
            [v27 updatePresenceRequestTimeForDeviceWithDestination:remoteDestinationString];

            goto LABEL_23;
          }
        }

        v20 = [accessories countByEnumeratingWithState:&v32 objects:v36 count:16];
        if (v20)
        {
          continue;
        }

        break;
      }
    }

LABEL_23:

    v5 = v31;
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)dispatchRequestToEvaluateCondition:(id)condition forCharacteristics:(id)characteristics completion:(id)completion
{
  v63 = *MEMORY[0x277D85DE8];
  conditionCopy = condition;
  characteristicsCopy = characteristics;
  completionCopy = completion;
  if (completionCopy && [characteristicsCopy count])
  {
    primaryResident = [(HMDHome *)self primaryResident];
    isCurrentDevice = [primaryResident isCurrentDevice];

    if (isCurrentDevice)
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543362;
        v60 = v16;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Current device is the resident device itself, evaluating locally.", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
      if ([(HMDHome *)selfCopy evaluatePredicate:conditionCopy])
      {
        completionCopy[2](completionCopy, 0, characteristicsCopy);
      }
    }

    else
    {
      primaryResident2 = [(HMDHome *)self primaryResident];
      device = [primaryResident2 device];

      primaryResident3 = [(HMDHome *)self primaryResident];
      supportsSharedEventTriggerActivation = [primaryResident3 supportsSharedEventTriggerActivation];

      if (supportsSharedEventTriggerActivation)
      {
        v20 = MEMORY[0x277CCACA8];
        logIdentifier = [(HMDHome *)self logIdentifier];
        v48 = [v20 stringWithFormat:@"Bulletin-%@", logIdentifier];

        v45 = [[HMDPredicateUtilities alloc] initWithHome:self logIdentifier:v48];
        v47 = [(HMDPredicateUtilities *)v45 rewritePredicateForDaemon:conditionCopy message:0];
        v57[0] = *MEMORY[0x277CD24A8];
        v22 = encodeRootObject();
        v58[0] = v22;
        v57[1] = *MEMORY[0x277CD2660];
        firstObject = [characteristicsCopy firstObject];
        service = [firstObject service];
        uuid = [service uuid];
        uUIDString = [uuid UUIDString];
        v58[1] = uUIDString;
        v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v58 forKeys:v57 count:2];

        v27 = [HMDRemoteDeviceMessageDestination alloc];
        uuid2 = [(HMDHome *)self uuid];
        v29 = [(HMDRemoteDeviceMessageDestination *)v27 initWithTarget:uuid2 device:device];

        v30 = [HMDRemoteMessage secureMessageWithName:*MEMORY[0x277CD24B0] destination:v29 messagePayload:v46];
        identifier = [v30 identifier];
        objc_initWeak(&location, self);
        v50[0] = MEMORY[0x277D85DD0];
        v50[1] = 3221225472;
        v50[2] = __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke;
        v50[3] = &unk_279723088;
        objc_copyWeak(&v55, &location);
        v32 = identifier;
        v51 = v32;
        v52 = conditionCopy;
        v53 = characteristicsCopy;
        v54 = completionCopy;
        [v30 setResponseHandler:v50];
        v33 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v35 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
        {
          v36 = HMFGetLogIdentifier();
          *buf = 138543618;
          v60 = v36;
          v61 = 2114;
          v62 = v32;
          _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Sending message with identifier %{public}@ to evaluate bulletin condition to resident", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v33);
        homeManager = [(HMDHome *)selfCopy2 homeManager];
        messageDispatcher = [homeManager messageDispatcher];

        [messageDispatcher sendMessage:v30 completionHandler:0];
        objc_destroyWeak(&v55);
        objc_destroyWeak(&location);
      }

      else
      {
        v39 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          primaryResident4 = [(HMDHome *)selfCopy3 primaryResident];
          *buf = 138543618;
          v60 = v42;
          v61 = 2112;
          v62 = primaryResident4;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Remote access device %@ is not capable of presence status. Directly send the notification.", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v39);
        completionCopy[2](completionCopy, 0, characteristicsCopy);
      }
    }
  }

  v44 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_dispatchRequestToEvaluateCondition_forCharacteristics_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    v13 = *(a1 + 40);
    v14 = *(a1 + 48);
    *buf = 138544386;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    v33 = 2112;
    v34 = v5;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Message with identifier %@ to evaluate condition %@ for characteristics %@ has been sent with error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v8);
  if (v5)
  {
    goto LABEL_7;
  }

  v15 = [v6 hmf_BOOLForKey:*MEMORY[0x277CD24B8]];
  v16 = objc_autoreleasePoolPush();
  v17 = v9;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    v20 = *(a1 + 40);
    HMFBooleanToString();
    v21 = v24 = v15;
    *buf = 138543874;
    v26 = v19;
    v27 = 2112;
    v28 = v20;
    v29 = 2112;
    v30 = v21;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Resident evaluate predicate %@ to %@.", buf, 0x20u);

    v15 = v24;
  }

  objc_autoreleasePoolPop(v16);
  if (v15)
  {
LABEL_7:
    v22 = *(a1 + 48);
    (*(*(a1 + 56) + 16))();
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)evaluateNotificationConditionForCharacteristics:(id)characteristics homePresence:(id)presence completion:(id)completion
{
  v91 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  presenceCopy = presence;
  completionCopy = completion;
  if (completionCopy)
  {
    if ([(HMDHome *)self bulletinNotificationsSupported])
    {
      v63 = completionCopy;
      v65 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
      v67 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
      v77 = 0u;
      v78 = 0u;
      v79 = 0u;
      v80 = 0u;
      v64 = characteristicsCopy;
      obj = characteristicsCopy;
      v11 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
      v66 = presenceCopy;
      selfCopy = self;
      if (v11)
      {
        v12 = v11;
        v13 = *v78;
        v69 = *v78;
        do
        {
          v14 = 0;
          v70 = v12;
          do
          {
            if (*v78 != v13)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v77 + 1) + 8 * v14);
            service = [v15 service];
            bulletinBoardNotification = [service bulletinBoardNotification];
            isEnabled = [bulletinBoardNotification isEnabled];

            if (isEnabled)
            {
              v19 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v21 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
              {
                v22 = HMFGetLogIdentifier();
                shortDescription = [v15 shortDescription];
                *buf = 138543618;
                v83 = v22;
                v84 = 2112;
                v85 = shortDescription;
                _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Notification is enabled for characteristic: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v19);
              bulletinBoardNotification2 = [service bulletinBoardNotification];
              condition = [bulletinBoardNotification2 condition];

              if (condition)
              {
                predicateUtility = [(HMDHome *)selfCopy2 predicateUtility];
                v27 = [predicateUtility containsPresenceEvents:condition];
                if (presenceCopy || (v27 & 1) == 0)
                {
                  array = [predicateUtility rewritePredicate:condition currentCharacteristicInPredicate:0 characteristicsToRead:0 homePresence:presenceCopy];
                  v88 = @"THIS_OBJECT";
                  v89 = predicateUtility;
                  v39 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v89 forKeys:&v88 count:1];
                  [array allowEvaluation];
                  v40 = [array evaluateWithObject:predicateUtility substitutionVariables:v39];
                  context = objc_autoreleasePoolPush();
                  v41 = selfCopy2;
                  v42 = HMFGetOSLogHandle();
                  v43 = os_log_type_enabled(v42, OS_LOG_TYPE_INFO);
                  if (v40)
                  {
                    if (v43)
                    {
                      v44 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v44;
                      v84 = 2112;
                      v85 = condition;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to true, posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                    [v67 addObject:v15];
                  }

                  else
                  {
                    if (v43)
                    {
                      v45 = HMFGetLogIdentifier();
                      *buf = 138543874;
                      v83 = v45;
                      v84 = 2112;
                      v85 = condition;
                      v86 = 2112;
                      v87 = v15;
                      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Condition %@ for characteristic (%@) evaluates to false, not posting bulletin for it.", buf, 0x20u);
                    }

                    objc_autoreleasePoolPop(context);
                  }

                  presenceCopy = v66;
                }

                else
                {
                  v28 = objc_autoreleasePoolPush();
                  v29 = selfCopy2;
                  v30 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
                  {
                    v31 = HMFGetLogIdentifier();
                    *buf = 138543874;
                    v83 = v31;
                    v84 = 2112;
                    v85 = condition;
                    v86 = 2112;
                    v87 = v15;
                    _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Condition %@ contains presence and no homePresence presents, delaying bulletin for characteristic %@", buf, 0x20u);

                    presenceCopy = v66;
                  }

                  objc_autoreleasePoolPop(v28);
                  uuid = [service uuid];
                  array = [v65 objectForKeyedSubscript:uuid];

                  if (!array)
                  {
                    array = [MEMORY[0x277CBEB18] array];
                    uuid2 = [service uuid];
                    [v65 setObject:array forKeyedSubscript:uuid2];
                  }

                  [array addObject:v15];
                }

                v13 = v69;

                self = selfCopy;
              }

              else
              {
                v35 = objc_autoreleasePoolPush();
                v36 = selfCopy2;
                v37 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
                {
                  v38 = HMFGetLogIdentifier();
                  *buf = 138543618;
                  v83 = v38;
                  v84 = 2112;
                  v85 = v15;
                  _os_log_impl(&dword_2531F8000, v37, OS_LOG_TYPE_INFO, "%{public}@No condition is present in chr (%@)", buf, 0x16u);
                }

                objc_autoreleasePoolPop(v35);
                [v67 addObject:v15];
                v13 = v69;
              }

              v12 = v70;
            }

            ++v14;
          }

          while (v12 != v14);
          v12 = [obj countByEnumeratingWithState:&v77 objects:v90 count:16];
        }

        while (v12);
      }

      v46 = v67;
      completionCopy = v63;
      if ([v67 count])
      {
        (*(v63 + 2))(v63, 0, v67);
      }

      v47 = v65;
      if ([v65 count])
      {
        v75 = 0u;
        v76 = 0u;
        v73 = 0u;
        v74 = 0u;
        allValues = [v65 allValues];
        v49 = [allValues countByEnumeratingWithState:&v73 objects:v81 count:16];
        if (v49)
        {
          v50 = v49;
          v51 = *v74;
          do
          {
            for (i = 0; i != v50; ++i)
            {
              if (*v74 != v51)
              {
                objc_enumerationMutation(allValues);
              }

              v53 = *(*(&v73 + 1) + 8 * i);
              firstObject = [v53 firstObject];
              service2 = [firstObject service];
              bulletinBoardNotification3 = [service2 bulletinBoardNotification];
              condition2 = [bulletinBoardNotification3 condition];
              [(HMDHome *)selfCopy dispatchRequestToEvaluateCondition:condition2 forCharacteristics:v53 completion:v63];
            }

            v50 = [allValues countByEnumeratingWithState:&v73 objects:v81 count:16];
          }

          while (v50);
        }

        v47 = v65;
        presenceCopy = v66;
        v46 = v67;
      }

      characteristicsCopy = v64;
    }

    else
    {
      v58 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v60 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v60, OS_LOG_TYPE_DEBUG))
      {
        v61 = HMFGetLogIdentifier();
        *buf = 138543618;
        v83 = v61;
        v84 = 2112;
        v85 = characteristicsCopy;
        _os_log_impl(&dword_2531F8000, v60, OS_LOG_TYPE_DEBUG, "%{public}@Bulletin notifications are not supported, skipping evaluating bulletin for characteristics: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v58);
      (*(completionCopy + 2))(completionCopy, 0, MEMORY[0x277CBEBF8]);
    }
  }

  v62 = *MEMORY[0x277D85DE8];
}

- (void)reevaluateAccessoryInfo
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v11 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  workQueue = [(HMDHome *)selfCopy workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __34__HMDHome_reevaluateAccessoryInfo__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = selfCopy;
  dispatch_async(workQueue, block);

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_reevaluateAccessoryInfoWithBadgeRefresh:(BOOL)refresh
{
  refreshCopy = refresh;
  v22 = *MEMORY[0x277D85DE8];
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = HMFBooleanToString();
    v11 = HMFBooleanToString();
    v16 = 138543874;
    v17 = v9;
    v18 = 2112;
    v19 = v10;
    v20 = 2112;
    v21 = v11;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Re-evaluating accessory info with shouldRefreshBadge: %@, isOwnerUser: %@, ", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v6);
  if (isOwnerUser)
  {
    v12 = +[HMDBulletinBoard sharedBulletinBoard];
    v13 = [v12 updateBulletinForFirmwareUpdateInHome:selfCopy];
  }

  if (refreshCopy)
  {
    v14 = +[HMDBulletinBoard sharedBulletinBoard];
    [v14 refreshHomeBadgeNumber];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)sendFirmwareUpdateUINotification:(id)notification
{
  v21 = *MEMORY[0x277D85DE8];
  notificationCopy = notification;
  isOwnerUser = [(HMDHome *)self isOwnerUser];
  isSharedAdmin = [(HMDHome *)self isSharedAdmin];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMFBooleanToString();
    v12 = HMFBooleanToString();
    v15 = 138543874;
    v16 = v10;
    v17 = 2112;
    v18 = v11;
    v19 = 2112;
    v20 = v12;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Firmware update UI notification is issued, isOwnerUser: %@, isSharedAdminUser:%@ ", &v15, 0x20u);
  }

  objc_autoreleasePoolPop(v7);
  if (isOwnerUser || isSharedAdmin)
  {
    v13 = +[HMDBulletinBoard sharedBulletinBoard];
    [v13 insertBulletinsForMatterFirmwareUpdateInstalledInHome:selfCopy hmdHAPAccessory:notificationCopy];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories shouldRefreshBadge:(BOOL)badge withCompletion:(id)completion
{
  badgeCopy = badge;
  v84 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  completionCopy = completion;
  if ([accessoriesCopy count])
  {
    selfCopy = self;
    v65 = badgeCopy;
    v66 = completionCopy;
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
    v73 = 0u;
    v74 = 0u;
    v75 = 0u;
    v76 = 0u;
    v67 = accessoriesCopy;
    obj = accessoriesCopy;
    v10 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
    v62 = v10;
    v11 = 0;
    if (!v10)
    {
      goto LABEL_36;
    }

    v71 = *v74;
    v72 = v10;
    while (1)
    {
      for (i = 0; i != v72; ++i)
      {
        if (*v74 != v71)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v73 + 1) + 8 * i);
        vendorInfo = [v13 vendorInfo];
        firmwareVersion = [v13 firmwareVersion];
        if (firmwareVersion)
        {
          firmwareVersion2 = [vendorInfo firmwareVersion];
          firmwareVersion3 = [v13 firmwareVersion];
          v18 = [firmwareVersion2 isGreaterThanVersion:firmwareVersion3];
        }

        else
        {
          v18 = 0;
        }

        dictionary3 = [MEMORY[0x277CBEB38] dictionary];
        dictionary4 = [MEMORY[0x277CBEB38] dictionary];
        appBundleID = [vendorInfo appBundleID];

        if (appBundleID)
        {
          appBundleID2 = [vendorInfo appBundleID];
          [dictionary4 setObject:appBundleID2 forKeyedSubscript:@"kAccessoryVendorInfoBundleIDKey"];

          v11 = 1;
        }

        appStoreID = [vendorInfo appStoreID];

        if (appStoreID)
        {
          appStoreID2 = [vendorInfo appStoreID];
          [dictionary4 setObject:appStoreID2 forKeyedSubscript:@"kAccessoryVendorInfoStoreIDKey"];

          v11 = 1;
        }

        v25 = [MEMORY[0x277CCABB0] numberWithBool:v18];
        [dictionary4 setObject:v25 forKeyedSubscript:@"kAccessoryVendorInfoFirmwareUpdateAvailableKey"];

        serialNumber = [v13 serialNumber];

        if (serialNumber)
        {
          serialNumber2 = [v13 serialNumber];
          [dictionary4 setObject:serialNumber2 forKeyedSubscript:@"kAccessoryInfoSerialNumberKey"];

          v11 = 1;
        }

        manufacturer = [v13 manufacturer];

        if (manufacturer)
        {
          manufacturer2 = [v13 manufacturer];
          [dictionary3 setObject:manufacturer2 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];

          manufacturer3 = [v13 manufacturer];
          [dictionary4 setObject:manufacturer3 forKeyedSubscript:@"kAccessoryInfoManufacturerKey"];
        }

        model = [v13 model];

        if (model)
        {
          model2 = [v13 model];
          [dictionary3 setObject:model2 forKeyedSubscript:@"kAccessoryInfoModelKey"];

          model3 = [v13 model];
          [dictionary4 setObject:model3 forKeyedSubscript:@"kAccessoryInfoModelKey"];
        }

        v34 = v13;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v35 = v34;
        }

        else
        {
          v35 = 0;
        }

        v36 = v35;

        if (v36 && [v36 supportsCHIP])
        {
          displayableFirmwareVersion = [v34 displayableFirmwareVersion];

          if (!displayableFirmwareVersion)
          {
            goto LABEL_30;
          }

          displayableFirmwareVersion2 = [v34 displayableFirmwareVersion];
          [dictionary3 setObject:displayableFirmwareVersion2 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          displayableFirmwareVersion3 = [v34 displayableFirmwareVersion];
          [dictionary4 setObject:displayableFirmwareVersion3 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

        else
        {
          firmwareVersion4 = [v34 firmwareVersion];

          if (!firmwareVersion4)
          {
            goto LABEL_30;
          }

          firmwareVersion5 = [v34 firmwareVersion];
          shortVersionString = [firmwareVersion5 shortVersionString];
          [dictionary3 setObject:shortVersionString forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];

          displayableFirmwareVersion3 = [v34 firmwareVersion];
          shortVersionString2 = [displayableFirmwareVersion3 shortVersionString];
          [dictionary4 setObject:shortVersionString2 forKeyedSubscript:@"kAccessoryInfoFirmwareVersionKey"];
        }

LABEL_30:
        if ([dictionary4 count])
        {
          uuid = [v34 uuid];
          uUIDString = [uuid UUIDString];
          [dictionary2 setObject:dictionary4 forKeyedSubscript:uUIDString];
        }

        if ([dictionary3 count])
        {
          uuid2 = [v34 uuid];
          uUIDString2 = [uuid2 UUIDString];
          [dictionary setObject:dictionary3 forKeyedSubscript:uUIDString2];
        }
      }

      v72 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
      if (!v72)
      {
LABEL_36:

        v48 = objc_autoreleasePoolPush();
        v49 = selfCopy;
        v50 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
        {
          v51 = HMFGetLogIdentifier();
          *buf = 138543874;
          v78 = v51;
          v79 = 2112;
          v80 = dictionary;
          v81 = 2112;
          v82 = dictionary2;
          _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Notify clients that vendor info has updated: %@  entitledInfo %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v48);
        v52 = dictionary;
        v53 = [dictionary count];
        v54 = MEMORY[0x277CD1F98];
        if (v53)
        {
          v55 = [MEMORY[0x277D0F818] messageWithName:*MEMORY[0x277CD1F98] messagePayload:dictionary];
          msgDispatcher = [(HMDHome *)v49 msgDispatcher];
          messageTargetUUID = [(HMDHome *)v49 messageTargetUUID];
          [msgDispatcher sendMessage:v55 target:messageTargetUUID];

          v52 = dictionary;
        }

        if (v11)
        {
          v58 = [MEMORY[0x277D0F818] entitledMessageWithName:*v54 messagePayload:dictionary2];
          msgDispatcher2 = [(HMDHome *)v49 msgDispatcher];
          messageTargetUUID2 = [(HMDHome *)v49 messageTargetUUID];
          [msgDispatcher2 sendMessage:v58 target:messageTargetUUID2];
        }

        [(HMDHome *)v49 _reevaluateAccessoryInfoWithBadgeRefresh:v65, v62];
        completionCopy = v66;
        if (v66)
        {
          (v66)[2](v66, v63 != 0);
        }

        accessoriesCopy = v67;
        goto LABEL_47;
      }
    }
  }

  if (completionCopy)
  {
    completionCopy[2](completionCopy, 0);
  }

LABEL_47:

  v61 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientsOfAccessoryInfoUpdatedForAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __61__HMDHome_notifyClientsOfAccessoryInfoUpdatedForAccessories___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = accessoriesCopy;
  v6 = accessoriesCopy;
  dispatch_async(workQueue, v7);
}

- (void)_removeCloudData
{
  v26 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v4 = [HMDCameraProfileSettingsManager zoneNameForHome:self];
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543618;
    v23 = v8;
    v24 = 2112;
    v25 = v4;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Removing camera profile settings manager zone named %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDDatabase defaultDatabase];
  v10 = [v9 removePrivateZonesWithName:v4];
  v16 = MEMORY[0x277D85DD0];
  v17 = 3221225472;
  v18 = __27__HMDHome__removeCloudData__block_invoke;
  v19 = &unk_2797358C8;
  v20 = selfCopy;
  v21 = v4;
  v11 = v4;
  v12 = [v10 addFailureBlock:&v16];

  v13 = [(HMDHome *)selfCopy userActionPredictionManager:v16];
  [v13 removeZones];

  personDataManager = [(HMDHome *)selfCopy personDataManager];
  [personDataManager removeCloudDataDueToHomeRemoval];

  v15 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome__removeCloudData__block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove camera profile settings manager zone named %@: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (void)handleHomeWasRemoved
{
  walletKeyManager = [(HMDHome *)self walletKeyManager];
  [walletKeyManager handleHomeWasRemoved];
}

- (void)_removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler
{
  pairingsCopy = pairings;
  v76 = *MEMORY[0x277D85DE8];
  queueCopy = queue;
  handlerCopy = handler;
  v7 = objc_autoreleasePoolPush();
  val = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v69 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing all home contents and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  walletKeyManager = [(HMDHome *)val walletKeyManager];
  [walletKeyManager handleHomeWillBeRemoved];

  v66 = 0u;
  v67 = 0u;
  v64 = 0u;
  v65 = 0u;
  triggers = [(HMDHome *)val triggers];
  v12 = [triggers countByEnumeratingWithState:&v64 objects:v75 count:16];
  if (v12)
  {
    v13 = *v65;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v65 != v13)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v64 + 1) + 8 * i) invalidate];
      }

      v12 = [triggers countByEnumeratingWithState:&v64 objects:v75 count:16];
    }

    while (v12);
  }

  v62 = 0u;
  v63 = 0u;
  v60 = 0u;
  v61 = 0u;
  actionSets = [(HMDHome *)val actionSets];
  v16 = [actionSets countByEnumeratingWithState:&v60 objects:v74 count:16];
  if (v16)
  {
    v17 = *v61;
    do
    {
      for (j = 0; j != v16; ++j)
      {
        if (*v61 != v17)
        {
          objc_enumerationMutation(actionSets);
        }

        [*(*(&v60 + 1) + 8 * j) invalidate];
      }

      v16 = [actionSets countByEnumeratingWithState:&v60 objects:v74 count:16];
    }

    while (v16);
  }

  v58 = 0u;
  v59 = 0u;
  v56 = 0u;
  v57 = 0u;
  users = [(HMDHome *)val users];
  v20 = [users copy];

  v21 = [v20 countByEnumeratingWithState:&v56 objects:v73 count:16];
  if (v21)
  {
    v22 = *v57;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v57 != v22)
        {
          objc_enumerationMutation(v20);
        }

        v24 = *(*(&v56 + 1) + 8 * k);
        [v24 removeCloudData];
        [v24 unconfigure];
      }

      v21 = [v20 countByEnumeratingWithState:&v56 objects:v73 count:16];
    }

    while (v21);
  }

  accessories = [(HMDHome *)val accessories];
  v44 = [accessories na_map:&__block_literal_global_1334];

  [(HMDHome *)val _registerResidentReachabilityNotificationWithEnableAccessories:MEMORY[0x277CBEBF8] disableAccessories:v44 completionHandler:0];
  objc_initWeak(&location, val);
  group = dispatch_group_create();
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  accessories2 = [(HMDHome *)val accessories];
  v27 = [accessories2 countByEnumeratingWithState:&v51 objects:v72 count:16];
  if (v27)
  {
    v28 = *v52;
    do
    {
      for (m = 0; m != v27; ++m)
      {
        if (*v52 != v28)
        {
          objc_enumerationMutation(accessories2);
        }

        v30 = *(*(&v51 + 1) + 8 * m);
        if ([v30 isPrimary])
        {
          v31 = objc_autoreleasePoolPush();
          v32 = val;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v69 = v34;
            v70 = 2112;
            v71 = v30;
            _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing primary accessory %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          dispatch_group_enter(group);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1335;
          aBlock[3] = &unk_279732670;
          objc_copyWeak(&v50, &location);
          aBlock[4] = v30;
          v49 = group;
          v35 = _Block_copy(aBlock);
          v36 = v35;
          if (pairingsCopy)
          {
            [(HMDHome *)v32 removeAllUsersAndCloudDataFromAccessory:v30 completionHandler:v35];
          }

          else
          {
            (*(v35 + 2))(v35);
          }

          objc_destroyWeak(&v50);
        }
      }

      v27 = [accessories2 countByEnumeratingWithState:&v51 objects:v72 count:16];
    }

    while (v27);
  }

  [(HMDHome *)val _removeCloudData];
  dispatch_group_notify(group, queueCopy, handlerCopy);
  v37 = objc_autoreleasePoolPush();
  v38 = val;
  v39 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
  {
    v40 = HMFGetLogIdentifier();
    *buf = 138543362;
    v69 = v40;
    _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Removed all accessories", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v37);
  objc_destroyWeak(&location);

  v41 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1335(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v3 = *(a1 + 32);
    v5[0] = MEMORY[0x277D85DD0];
    v5[1] = 3221225472;
    v5[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2;
    v5[3] = &unk_2797352E8;
    objc_copyWeak(&v7, (a1 + 48));
    v4 = *(a1 + 40);
    v5[4] = *(a1 + 32);
    v6 = v4;
    [WeakRetained _removeAccessory:v3 completionHandler:v5];

    objc_destroyWeak(&v7);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v30 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v25 = v11;
    v26 = 2112;
    v27 = v12;
    v28 = 2112;
    v29 = v6;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed primary accessory, %@, with error: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  if (v9)
  {
    v13 = [v9 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1336;
    block[3] = &unk_2797352C0;
    v19 = v6;
    v20 = v9;
    v14 = v5;
    v15 = *(a1 + 32);
    v16 = *(a1 + 40);
    v21 = v14;
    v22 = v15;
    v23 = v16;
    dispatch_async(v13, block);
  }

  else
  {
    dispatch_group_leave(*(a1 + 40));
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke_1336(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = *(a1 + 56);
      v7 = *(a1 + 32);
      v9 = 138543874;
      v10 = v5;
      v11 = 2112;
      v12 = v6;
      v13 = 2112;
      v14 = v7;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", &v9, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
  }

  else
  {
    [*(a1 + 40) _removeAccessories:*(a1 + 48) message:0];
  }

  dispatch_group_leave(*(a1 + 64));
  v8 = *MEMORY[0x277D85DE8];
}

id __78__HMDHome__removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = [v4 cameraProfiles];
  v6 = [v5 count];

  if (v6)
  {
    v7 = v4;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)_removeAccessories:(id)accessories message:(id)message
{
  v56 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  messageCopy = message;
  v8 = [(HMDHome *)self _removeAccessoriesCommon:accessoriesCopy];
  name = [messageCopy name];
  v10 = [name isEqualToString:*MEMORY[0x277CD24F0]];

  if (v10)
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    [dictionary setObject:v8 forKeyedSubscript:*MEMORY[0x277CCE7A8]];
    v12 = [dictionary copy];
    [messageCopy respondWithPayload:v12];
  }

  else
  {
    [messageCopy respondWithSuccess];
  }

  v47 = 0u;
  v48 = 0u;
  v45 = 0u;
  v46 = 0u;
  obj = accessoriesCopy;
  v13 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v46;
    do
    {
      v16 = 0;
      v43 = v14;
      do
      {
        if (*v46 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v45 + 1) + 8 * v16);
        v18 = objc_autoreleasePoolPush();
        selfCopy = self;
        v20 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
        {
          v21 = HMFGetLogIdentifier();
          *buf = 138543618;
          v52 = v21;
          v53 = 2112;
          v54 = v17;
          _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Removing accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v18);
        v22 = v17;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v23 = v22;
        }

        else
        {
          v23 = 0;
        }

        v24 = v23;

        if (v24)
        {
          if ([v24 isCurrentAccessory])
          {
            v25 = v15;
            selfCopy2 = self;
            v27 = objc_autoreleasePoolPush();
            v28 = selfCopy;
            v29 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
            {
              v30 = HMFGetLogIdentifier();
              *buf = 138543618;
              v52 = v30;
              v53 = 2112;
              v54 = v22;
              _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@Posting notification about current accessory removal %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v27);
            notificationCenter = [(HMDHome *)v28 notificationCenter];
            v49 = @"HMDLastRemovedCurrentAccessoryUUIDKey";
            uuid = [v24 uuid];
            v50 = uuid;
            v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v50 forKeys:&v49 count:1];
            [notificationCenter postNotificationName:@"HMDHomeManagerDidRemoveCurrentAccessoryNotification" object:v28 userInfo:v33];

            self = selfCopy2;
            v15 = v25;
            v14 = v43;
          }

          homeManager = [(HMDHome *)selfCopy homeManager];
          capabilitiesAggregator = [(HMDHome *)selfCopy capabilitiesAggregator];
          uuid2 = [v24 uuid];
          [capabilitiesAggregator didRemoveAccessory:uuid2];

          uuid3 = [v24 uuid];
          v38 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid3];

          [v38 markAccessoryRemoved];
        }

        if ([v22 isPrimary])
        {
          identifier = [v22 identifier];
          [(HMDHome *)selfCopy _deregisterPairedAccessory:identifier];
        }

        [v22 setHome:0];
        [v22 unconfigure];

        ++v16;
      }

      while (v14 != v16);
      v14 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    }

    while (v14);
  }

  v40 = *MEMORY[0x277D85DE8];
}

- (id)_removeAccessoriesCommon:(id)common
{
  v44 = *MEMORY[0x277D85DE8];
  commonCopy = common;
  v30 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(commonCopy, "count")}];
  [(HMDHome *)self _removeAccessoriesFromContainers:commonCopy];
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = commonCopy;
  v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
  if (v31)
  {
    v29 = *v37;
    v28 = *MEMORY[0x277CCF0B0];
    do
    {
      for (i = 0; i != v31; ++i)
      {
        if (*v37 != v29)
        {
          objc_enumerationMutation(obj);
        }

        v6 = *(*(&v36 + 1) + 8 * i);
        [(HMDHome *)self removeAccessory:v6];
        getConfiguredName = [v6 getConfiguredName];

        if (getConfiguredName)
        {
          getConfiguredName2 = [v6 getConfiguredName];
          v9 = [(HMDHome *)self removeName:getConfiguredName2];
        }

        v10 = v6;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v34 = 0u;
          v35 = 0u;
          v32 = 0u;
          v33 = 0u;
          services = [v12 services];
          v14 = [services countByEnumeratingWithState:&v32 objects:v42 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v33;
            do
            {
              for (j = 0; j != v15; ++j)
              {
                if (*v33 != v16)
                {
                  objc_enumerationMutation(services);
                }

                v18 = *(*(&v32 + 1) + 8 * j);
                getConfiguredName3 = [v18 getConfiguredName];

                if (getConfiguredName3)
                {
                  getConfiguredName4 = [v18 getConfiguredName];
                  v21 = [(HMDHome *)self removeName:getConfiguredName4];
                }
              }

              v15 = [services countByEnumeratingWithState:&v32 objects:v42 count:16];
            }

            while (v15);
          }
        }

        v40 = v28;
        uuid = [v10 uuid];
        uUIDString = [uuid UUIDString];
        v41 = uUIDString;
        v24 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v41 forKeys:&v40 count:1];
        [v30 addObject:v24];
      }

      v31 = [obj countByEnumeratingWithState:&v36 objects:v43 count:16];
    }

    while (v31);
  }

  v25 = *MEMORY[0x277D85DE8];

  return v30;
}

- (void)_removeAccessoriesFromContainers:(id)containers
{
  v75 = *MEMORY[0x277D85DE8];
  containersCopy = containers;
  if ([containersCopy count])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v72 = v8;
      v73 = 2112;
      v74 = containersCopy;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Removing accessories from containers : [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    backingStore = [(HMDHome *)selfCopy backingStore];
    v10 = *MEMORY[0x277CD24E8];
    v11 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v12 = [backingStore transaction:v10 options:v11];

    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v41 = containersCopy;
    obj = containersCopy;
    v13 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
    if (v13)
    {
      v14 = v13;
      v43 = *v63;
      do
      {
        v15 = 0;
        do
        {
          if (*v63 != v43)
          {
            objc_enumerationMutation(obj);
          }

          v16 = *(*(&v62 + 1) + 8 * v15);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            v60 = 0u;
            v61 = 0u;
            v58 = 0u;
            v59 = 0u;
            serviceGroups = [(HMDHome *)selfCopy serviceGroups];
            v20 = [serviceGroups countByEnumeratingWithState:&v58 objects:v69 count:16];
            if (v20)
            {
              v21 = v20;
              v22 = *v59;
              do
              {
                v23 = 0;
                do
                {
                  if (*v59 != v22)
                  {
                    objc_enumerationMutation(serviceGroups);
                  }

                  [*(*(&v58 + 1) + 8 * v23++) removeServicesForAccessory:{v18, v41}];
                }

                while (v21 != v23);
                v21 = [serviceGroups countByEnumeratingWithState:&v58 objects:v69 count:16];
              }

              while (v21);
            }
          }

          v56 = 0u;
          v57 = 0u;
          v54 = 0u;
          v55 = 0u;
          actionSets = [(HMDHome *)selfCopy actionSets];
          v25 = [actionSets countByEnumeratingWithState:&v54 objects:v68 count:16];
          if (v25)
          {
            v26 = v25;
            v27 = *v55;
            do
            {
              v28 = 0;
              do
              {
                if (*v55 != v27)
                {
                  objc_enumerationMutation(actionSets);
                }

                [*(*(&v54 + 1) + 8 * v28++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v26 != v28);
              v26 = [actionSets countByEnumeratingWithState:&v54 objects:v68 count:16];
            }

            while (v26);
          }

          v52 = 0u;
          v53 = 0u;
          v50 = 0u;
          v51 = 0u;
          triggerOwnedActionSets = [(HMDHome *)selfCopy triggerOwnedActionSets];
          v30 = [triggerOwnedActionSets countByEnumeratingWithState:&v50 objects:v67 count:16];
          if (v30)
          {
            v31 = v30;
            v32 = *v51;
            do
            {
              v33 = 0;
              do
              {
                if (*v51 != v32)
                {
                  objc_enumerationMutation(triggerOwnedActionSets);
                }

                [*(*(&v50 + 1) + 8 * v33++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v31 != v33);
              v31 = [triggerOwnedActionSets countByEnumeratingWithState:&v50 objects:v67 count:16];
            }

            while (v31);
          }

          v48 = 0u;
          v49 = 0u;
          v46 = 0u;
          v47 = 0u;
          triggers = [(HMDHome *)selfCopy triggers];
          v35 = [triggers countByEnumeratingWithState:&v46 objects:v66 count:16];
          if (v35)
          {
            v36 = v35;
            v37 = *v47;
            do
            {
              v38 = 0;
              do
              {
                if (*v47 != v37)
                {
                  objc_enumerationMutation(triggers);
                }

                [*(*(&v46 + 1) + 8 * v38++) handleRemovalOfAccessory:v16 transaction:v12];
              }

              while (v36 != v38);
              v36 = [triggers countByEnumeratingWithState:&v46 objects:v66 count:16];
            }

            while (v36);
          }

          v44[0] = MEMORY[0x277D85DD0];
          v44[1] = 3221225472;
          v44[2] = __44__HMDHome__removeAccessoriesFromContainers___block_invoke;
          v44[3] = &unk_2797358C8;
          v44[4] = selfCopy;
          v45 = v18;
          v39 = v18;
          [v12 run:v44];

          ++v15;
        }

        while (v15 != v14);
        v14 = [obj countByEnumeratingWithState:&v62 objects:v70 count:16];
      }

      while (v14);
    }

    [(HMDHome *)selfCopy _evaluateShouldRelaunchAndSetRelaunch];
    containersCopy = v41;
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoriesFromContainers___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      v10 = "%{public}@Failed to commit removeAccessoriesFromContainersTransaction [%@]: %@";
      v11 = v7;
      v12 = OS_LOG_TYPE_ERROR;
      v13 = 32;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v11, v12, v10, &v16, v13);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v14 = *(a1 + 40);
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v14;
    v10 = "%{public}@Successfully finished running removeAccessoriesFromContainersTransaction : %@";
    v11 = v7;
    v12 = OS_LOG_TYPE_INFO;
    v13 = 22;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeService:(id)service
{
  v60 = *MEMORY[0x277D85DE8];
  serviceCopy = service;
  backingStore = [(HMDHome *)self backingStore];
  v6 = *MEMORY[0x277CD2528];
  v7 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v8 = [backingStore transaction:v6 options:v7];

  v52 = 0u;
  v53 = 0u;
  v50 = 0u;
  v51 = 0u;
  serviceGroups = [(HMDHome *)self serviceGroups];
  v10 = [serviceGroups countByEnumeratingWithState:&v50 objects:v59 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v51;
    do
    {
      v13 = 0;
      do
      {
        if (*v51 != v12)
        {
          objc_enumerationMutation(serviceGroups);
        }

        [*(*(&v50 + 1) + 8 * v13++) removeService:serviceCopy];
      }

      while (v11 != v13);
      v11 = [serviceGroups countByEnumeratingWithState:&v50 objects:v59 count:16];
    }

    while (v11);
  }

  v48 = 0u;
  v49 = 0u;
  v46 = 0u;
  v47 = 0u;
  actionSets = [(HMDHome *)self actionSets];
  v15 = [actionSets countByEnumeratingWithState:&v46 objects:v58 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v47;
    do
    {
      v18 = 0;
      do
      {
        if (*v47 != v17)
        {
          objc_enumerationMutation(actionSets);
        }

        [*(*(&v46 + 1) + 8 * v18++) handleRemovalOfService:serviceCopy transaction:v8];
      }

      while (v16 != v18);
      v16 = [actionSets countByEnumeratingWithState:&v46 objects:v58 count:16];
    }

    while (v16);
  }

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v20 = [triggerOwnedActionSets countByEnumeratingWithState:&v42 objects:v57 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v43;
    do
    {
      v23 = 0;
      do
      {
        if (*v43 != v22)
        {
          objc_enumerationMutation(triggerOwnedActionSets);
        }

        [*(*(&v42 + 1) + 8 * v23++) handleRemovalOfService:serviceCopy transaction:v8];
      }

      while (v21 != v23);
      v21 = [triggerOwnedActionSets countByEnumeratingWithState:&v42 objects:v57 count:16];
    }

    while (v21);
  }

  getConfiguredName = [serviceCopy getConfiguredName];

  if (getConfiguredName)
  {
    getConfiguredName2 = [serviceCopy getConfiguredName];
    v26 = [(HMDHome *)self removeName:getConfiguredName2];
  }

  v40 = 0u;
  v41 = 0u;
  v38 = 0u;
  v39 = 0u;
  triggers = [(HMDHome *)self triggers];
  v28 = [triggers countByEnumeratingWithState:&v38 objects:v56 count:16];
  if (v28)
  {
    v29 = v28;
    v30 = *v39;
    do
    {
      v31 = 0;
      do
      {
        if (*v39 != v30)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v38 + 1) + 8 * v31++) handleRemovalOfService:serviceCopy transaction:v8];
      }

      while (v29 != v31);
      v29 = [triggers countByEnumeratingWithState:&v38 objects:v56 count:16];
    }

    while (v29);
  }

  v37[0] = MEMORY[0x277D85DD0];
  v37[1] = 3221225472;
  v37[2] = __26__HMDHome__removeService___block_invoke;
  v37[3] = &unk_2797359D8;
  v37[4] = self;
  [v8 run:v37];
  notificationCenter = [(HMDHome *)self notificationCenter];
  v54 = @"HMDServiceNotificationKey";
  v55 = serviceCopy;
  v33 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v55 forKeys:&v54 count:1];
  [notificationCenter postNotificationName:@"HMDHomeServiceRemovedNotification" object:self userInfo:v33];

  notificationRegistry = [(HMDHome *)self notificationRegistry];
  characteristics = [serviceCopy characteristics];
  [notificationRegistry removeRegistrationsForCharacteristics:characteristics];

  v36 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__removeService___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeServiceTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_removeCharacteristic:(id)characteristic
{
  v40 = *MEMORY[0x277D85DE8];
  characteristicCopy = characteristic;
  backingStore = [(HMDHome *)self backingStore];
  v6 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v7 = [backingStore transaction:@"kRemoveCharacteristicRequestKey" options:v6];

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  actionSets = [(HMDHome *)self actionSets];
  v9 = [actionSets countByEnumeratingWithState:&v33 objects:v39 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v34;
    do
    {
      v12 = 0;
      do
      {
        if (*v34 != v11)
        {
          objc_enumerationMutation(actionSets);
        }

        [*(*(&v33 + 1) + 8 * v12++) handleRemovalOfActionForCharacteristic:characteristicCopy transaction:v7];
      }

      while (v10 != v12);
      v10 = [actionSets countByEnumeratingWithState:&v33 objects:v39 count:16];
    }

    while (v10);
  }

  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v14 = [triggerOwnedActionSets countByEnumeratingWithState:&v29 objects:v38 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v30;
    do
    {
      v17 = 0;
      do
      {
        if (*v30 != v16)
        {
          objc_enumerationMutation(triggerOwnedActionSets);
        }

        [*(*(&v29 + 1) + 8 * v17++) handleRemovalOfActionForCharacteristic:characteristicCopy transaction:v7];
      }

      while (v15 != v17);
      v15 = [triggerOwnedActionSets countByEnumeratingWithState:&v29 objects:v38 count:16];
    }

    while (v15);
  }

  v27 = 0u;
  v28 = 0u;
  v25 = 0u;
  v26 = 0u;
  triggers = [(HMDHome *)self triggers];
  v19 = [triggers countByEnumeratingWithState:&v25 objects:v37 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v26;
    do
    {
      v22 = 0;
      do
      {
        if (*v26 != v21)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v25 + 1) + 8 * v22++) handleRemovalOfCharacteristic:characteristicCopy transaction:v7];
      }

      while (v20 != v22);
      v20 = [triggers countByEnumeratingWithState:&v25 objects:v37 count:16];
    }

    while (v20);
  }

  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __33__HMDHome__removeCharacteristic___block_invoke;
  v24[3] = &unk_2797359D8;
  v24[4] = self;
  [v7 run:v24];

  v23 = *MEMORY[0x277D85DE8];
}

void __33__HMDHome__removeCharacteristic___block_invoke(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543618;
      v10 = v7;
      v11 = 2112;
      v12 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Failed to commit removeCharacteristicTransaction with error: %@", &v9, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)_removeAccessoryWithUUID:(id)d message:(id)message
{
  v29 = *MEMORY[0x277D85DE8];
  dCopy = d;
  messageCopy = message;
  objc_initWeak(&location, self);
  v8 = [(HMDHome *)self accessoryWithUUID:dCopy];
  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v12;
      v27 = 2112;
      v28 = v8;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Remove accessory name: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = v8;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    *buf = 0;
    v16 = [v15 preferredHAPAccessoryForOperation:8 linkType:buf];
    v17 = [HMDAccessoryPairingEvent removingAccessory:v13 hapAccessory:v16];
    v20[0] = MEMORY[0x277D85DD0];
    v20[1] = 3221225472;
    v20[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke;
    v20[3] = &unk_279722540;
    objc_copyWeak(&v24, &location);
    v21 = messageCopy;
    v18 = v17;
    v22 = v18;
    v23 = v13;
    [(HMDHome *)selfCopy _removeAccessory:v23 completionHandler:v20];

    objc_destroyWeak(&v24);
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v15];
  }

  objc_destroyWeak(&location);
  v19 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 7);
  v8 = WeakRetained;
  if (WeakRetained)
  {
    v9 = [WeakRetained workQueue];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2;
    v12[3] = &unk_27972F208;
    v12[4] = v8;
    v13 = a1[5];
    v14 = v6;
    v15 = v5;
    v16 = a1[4];
    v17 = a1[6];
    dispatch_async(v9, v12);
  }

  else
  {
    v10 = a1[4];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
    [v10 respondWithError:v11];
  }
}

void __44__HMDHome__removeAccessoryWithUUID_message___block_invoke_2(uint64_t a1)
{
  v19 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) logEventSubmitter];
  [v2 submitLogEvent:*(a1 + 40) error:*(a1 + 48)];

  if (*(a1 + 48))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = HMFGetLogIdentifier();
      v7 = [*(a1 + 72) name];
      v8 = *(a1 + 48);
      *buf = 138543874;
      v14 = v6;
      v15 = 2112;
      v16 = v7;
      v17 = 2112;
      v18 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 64) respondWithError:*(a1 + 48)];
    v9 = *MEMORY[0x277D85DE8];
  }

  else
  {
    [*(a1 + 32) _removeAccessories:*(a1 + 56) message:*(a1 + 64)];
    [*(a1 + 32) updateHomeLocation];
    v10 = *(a1 + 32);
    v12 = [*(a1 + 64) name];
    [v10 saveWithReason:? postSyncNotification:?];
    v11 = *MEMORY[0x277D85DE8];
  }
}

- (void)_removeAccessory:(id)accessory completionHandler:(id)handler
{
  v42 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  handlerCopy = handler;
  if ([accessoryCopy isPrimary])
  {
    removeAccessoryInProgressForHMDAccessories = [(HMDHome *)self removeAccessoryInProgressForHMDAccessories];
    v9 = [removeAccessoryInProgressForHMDAccessories containsObject:accessoryCopy];

    if (v9)
    {
      v10 = objc_autoreleasePoolPush();
      selfCopy = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        *buf = 138543618;
        v39 = v13;
        v40 = 2112;
        v41 = accessoryCopy;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Already have a remove operation queued for accessory %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      v36[0] = *MEMORY[0x277CCA450];
      v14 = MEMORY[0x277CCACA8];
      name = [accessoryCopy name];
      uuid = [accessoryCopy uuid];
      v17 = [v14 stringWithFormat:@"Failed to remove accessory %@(%@)", name, uuid];
      v36[1] = *MEMORY[0x277CCA470];
      v37[0] = v17;
      v18 = MEMORY[0x277CCACA8];
      v19 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:15];
      v20 = [v18 stringWithFormat:@"%ld (%@) This accessory is already being removed from the home.", 15, v19];
      v37[1] = v20;
      v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v37 forKeys:v36 count:2];

      v22 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:15 userInfo:v21];
      if (handlerCopy)
      {
        handlerCopy[2](handlerCopy, 0, v22);
      }
    }

    else
    {
      v27 = accessoryCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v28 = v27;
      }

      else
      {
        v28 = 0;
      }

      v21 = v28;

      home = [v27 home];
      if ([home isAdminUser])
      {
        isPaired = [v21 isPaired];

        if (isPaired)
        {
          os_unfair_recursive_lock_lock_with_options();
          [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories addObject:v21];
          os_unfair_recursive_lock_unlock();
          v31 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v33 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
          {
            v34 = HMFGetLogIdentifier();
            *buf = 138543618;
            v39 = v34;
            v40 = 2112;
            v41 = v21;
            _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Removing accessory %@. Also added accessory in removal-in-progress array", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v31);
          [(HMDHome *)selfCopy2 _removeAccessoriesForPrimaryAccessory:v21 error:0 completionHandler:handlerCopy];
          goto LABEL_22;
        }
      }

      else
      {
      }

      [(HMDHome *)self _removeAccessoriesForPrimaryAccessory:v27 error:0 completionHandler:handlerCopy];
    }

LABEL_22:

    goto LABEL_23;
  }

  v23 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v25 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    v26 = HMFGetLogIdentifier();
    *buf = 138543618;
    v39 = v26;
    v40 = 2112;
    v41 = accessoryCopy;
    _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@cannot remove non-primary accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v23);
  if (handlerCopy)
  {
    v21 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    handlerCopy[2](handlerCopy, 0, v21);
    goto LABEL_22;
  }

LABEL_23:

  v35 = *MEMORY[0x277D85DE8];
}

- (void)removeAccessory:(id)accessory completionHandler:(id)handler
{
  accessoryCopy = accessory;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __45__HMDHome_removeAccessory_completionHandler___block_invoke;
  block[3] = &unk_2797355D0;
  block[4] = self;
  v12 = accessoryCopy;
  v13 = handlerCopy;
  v9 = handlerCopy;
  v10 = accessoryCopy;
  dispatch_async(workQueue, block);
}

- (void)_removeAccessoriesForPrimaryAccessory:(id)accessory error:(id)error completionHandler:(id)handler
{
  v83 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  errorCopy = error;
  handlerCopy = handler;
  if (!accessoryCopy)
  {
    v53 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v55 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v55, OS_LOG_TYPE_ERROR))
    {
      v56 = HMFGetLogIdentifier();
      *buf = 138543362;
      v77 = v56;
      _os_log_impl(&dword_2531F8000, v55, OS_LOG_TYPE_ERROR, "%{public}@Nil accessory was passed to remove it from the home.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v53);
    v57 = MEMORY[0x277CCA9B8];
    v58 = *MEMORY[0x277CCFD28];
    v59 = 20;
    goto LABEL_50;
  }

  if (([accessoryCopy isPrimary] & 1) == 0)
  {
    v60 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v61 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
    {
      v62 = HMFGetLogIdentifier();
      *buf = 138543618;
      v77 = v62;
      v78 = 2112;
      v79 = accessoryCopy;
      _os_log_impl(&dword_2531F8000, v61, OS_LOG_TYPE_ERROR, "%{public}@Accessory is not primary (Bridged). Not moving further. [%@]", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v60);
    v57 = MEMORY[0x277CCA9B8];
    v58 = *MEMORY[0x277CCFD28];
    v59 = 34;
LABEL_50:
    array = [v57 errorWithDomain:v58 code:v59 userInfo:0];
    [(HMDHome *)selfCopy2 _sendRemoveCompletionStatusForHMDAccessories:0 withCompletion:handlerCopy error:array];
    goto LABEL_51;
  }

  array = [MEMORY[0x277CBEB18] array];
  [(HMDHome *)self removeAccessory:accessoryCopy];
  [array addObject:accessoryCopy];
  v12 = +[HMDBulletinBoard sharedBulletinBoard];
  [v12 removeBulletinsForAccessory:accessoryCopy];

  v13 = accessoryCopy;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (isKindOfClass)
  {
    v15 = v13;
  }

  else
  {
    v15 = 0;
  }

  v70 = v15;

  if (isKindOfClass)
  {
    v66 = v13;
    v67 = errorCopy;
    selfCopy3 = self;
    v69 = array;
    v64 = handlerCopy;
    v65 = accessoryCopy;
    v74 = 0u;
    v75 = 0u;
    v72 = 0u;
    v73 = 0u;
    accessories = [(HMDHome *)self accessories];
    v17 = [accessories countByEnumeratingWithState:&v72 objects:v82 count:16];
    if (v17)
    {
      v18 = v17;
      v19 = *v73;
      do
      {
        for (i = 0; i != v18; ++i)
        {
          if (*v73 != v19)
          {
            objc_enumerationMutation(accessories);
          }

          v21 = *(*(&v72 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v22 = v21;
          }

          else
          {
            v22 = 0;
          }

          v23 = v22;

          identifier = [v23 identifier];
          identifier2 = [v70 identifier];
          if (([identifier isEqualToString:identifier2] & 1) == 0)
          {

            goto LABEL_20;
          }

          hostAccessory = [v23 hostAccessory];
          objc_opt_class();
          v27 = objc_opt_isKindOfClass();

          if ((v27 & 1) == 0 || !hostAccessory)
          {
            [(HMDHome *)selfCopy3 removeAccessory:v21];
            [v69 addObject:v21];
            identifier = +[HMDBulletinBoard sharedBulletinBoard];
            [identifier removeBulletinsForAccessory:v21];
LABEL_20:
          }
        }

        v18 = [accessories countByEnumeratingWithState:&v72 objects:v82 count:16];
      }

      while (v18);
    }

    v13 = v66;
    isReachable = [v66 isReachable];
    accessoryCopy = v65;
    errorCopy = v67;
    self = selfCopy3;
    array = v69;
    if (v67 || !isReachable || ([v66 home], v29 = objc_claimAutoreleasedReturnValue(), v30 = objc_msgSend(v29, "isAdminUser"), v29, (v30 & 1) == 0))
    {
      keychainStore = [(HMDHome *)selfCopy3 keychainStore];
      identifier3 = [v70 identifier];
      v71 = 0;
      [keychainStore removeAccessoryKeyForName:identifier3 error:&v71];
      v33 = v71;

      if (v33)
      {
        v34 = objc_autoreleasePoolPush();
        v35 = selfCopy3;
        v36 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          v37 = HMFGetLogIdentifier();
          name = [v66 name];
          identifier4 = [v70 identifier];
          *buf = 138543874;
          v77 = v37;
          v78 = 2112;
          v79 = name;
          v80 = 2112;
          v81 = identifier4;
          _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove keychain entry for accessory %@ with identifier: %@", buf, 0x20u);

          array = v69;
          v13 = v66;
        }

        objc_autoreleasePoolPop(v34);
        errorCopy = v67;
      }
    }

    identifier5 = [v70 identifier];
    [(HMDHome *)selfCopy3 _deregisterPairedAccessory:identifier5];

    handlerCopy = v64;
  }

  v41 = v13;
  objc_opt_class();
  v42 = objc_opt_isKindOfClass();
  if (v42)
  {
    v43 = v41;
  }

  else
  {
    v43 = 0;
  }

  v44 = v43;

  if (v42)
  {
    mediaProfile = [v41 mediaProfile];
    if (mediaProfile)
    {
      notificationRegistry = [(HMDHome *)self notificationRegistry];
      [notificationRegistry removeRegistrationsForMediaProfile:mediaProfile];

      identifier6 = [v41 identifier];
      v48 = [(HMDHome *)self mediaSessionStateWithIdentifier:identifier6];

      if (v48)
      {
        [(HMDHome *)self removeMediaSessionState:v48];
      }
    }
  }

  v49 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v51 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
  {
    v52 = HMFGetLogIdentifier();
    *buf = 138543618;
    v77 = v52;
    v78 = 2112;
    v79 = array;
    _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@removedAccessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v49);
  [(HMDHome *)selfCopy4 _sendRemoveCompletionStatusForHMDAccessories:array withCompletion:handlerCopy error:0];

LABEL_51:
  v63 = *MEMORY[0x277D85DE8];
}

- (void)_sendRemoveCompletionStatusForHMDAccessories:(id)accessories withCompletion:(id)completion error:(id)error
{
  v42 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  completionCopy = completion;
  errorCopy = error;
  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (completionCopy)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543874;
      v37 = v13;
      v38 = 2112;
      v39 = errorCopy;
      v40 = 2112;
      v41 = accessoriesCopy;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending removal completion with error %@, accessories %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    completionCopy[2](completionCopy, accessoriesCopy, errorCopy);
  }

  else
  {
    if (v12)
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v37 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@sending removal completion for accessory removal: no completion found", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v9);
  }

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  obj = accessoriesCopy;
  v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v15)
  {
    v16 = *v32;
    do
    {
      v17 = 0;
      do
      {
        if (*v32 != v16)
        {
          objc_enumerationMutation(obj);
        }

        v18 = *(*(&v31 + 1) + 8 * v17);
        os_unfair_recursive_lock_lock_with_options();
        [(NSHashTable *)selfCopy->_removeAccessoryInProgressForHMDAccessories removeObject:v18];
        os_unfair_recursive_lock_unlock();
        v19 = v18;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v20 = v19;
        }

        else
        {
          v20 = 0;
        }

        v21 = v20;

        if (v21 && [v19 isPrimary])
        {
          getPrimaryHAPAccessories = [v21 getPrimaryHAPAccessories];
          firstObject = [getPrimaryHAPAccessories firstObject];
          server = [firstObject server];

          accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
          identifier = [v21 identifier];
          [accessoryBrowser addUnpairedAccessoryServer:server identifier:identifier];
        }

        ++v17;
      }

      while (v15 != v17);
      v15 = [obj countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v15);
  }

  if ([obj count])
  {
    [(HMDHome *)selfCopy _reevaluateAccessoryInfoWithBadgeRefresh:1];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_notifyClientOfNewlyAddedAccessories:(id)accessories requestMessage:(id)message
{
  v79 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  messageCopy = message;
  array = [MEMORY[0x277CBEB18] array];
  array2 = [MEMORY[0x277CBEB18] array];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  obj = accessoriesCopy;
  v7 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v67;
    v61 = *MEMORY[0x277CCF0B0];
    v60 = *MEMORY[0x277CCEA00];
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v67 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v66 + 1) + 8 * i);
        v12 = accessoryToEncodeForXPCTransportForAccessory(v11);
        if (v12 == v11)
        {
          v72[0] = v61;
          uuid = [v11 uuid];
          v72[1] = v60;
          v73[0] = uuid;
          v18 = encodeRootObjectForSPIClients(v11);
          v73[1] = v18;
          v19 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v73 forKeys:v72 count:2];

          v20 = [v19 copy];
          [array2 addObject:v20];

          v21 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v22 = v21;
          }

          else
          {
            v22 = 0;
          }

          v23 = v22;

          v24 = v21;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();

          if (v23 || (isKindOfClass & (v24 != 0)) != 0)
          {
            [array addObject:v19];
          }
        }

        else
        {
          v13 = objc_autoreleasePoolPush();
          selfCopy = self;
          v15 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543618;
            v75 = v16;
            v76 = 2112;
            v77 = v11;
            _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Skipping notifying clients of added accessory: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v13);
        }
      }

      v8 = [obj countByEnumeratingWithState:&v66 objects:v78 count:16];
    }

    while (v8);
  }

  v70 = *MEMORY[0x277CD0640];
  uuid2 = [(HMDHome *)self uuid];
  v71 = uuid2;
  v27 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];

  if ([array count])
  {
    v28 = [v27 mutableCopy];
    v29 = [array copy];
    v30 = *MEMORY[0x277CCE7A8];
    [v28 setObject:v29 forKeyedSubscript:*MEMORY[0x277CCE7A8]];

    v31 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543618;
      v75 = v34;
      v76 = 2112;
      v77 = v28;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Notifying non-SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v35 = [MEMORY[0x277D0F848] nonSPIEntitledMessageWithName:*MEMORY[0x277CCFD98] messagePayload:v28];
    v36 = messageCopy;
    identifier = [messageCopy identifier];
    [v35 setIdentifier:identifier];

    msgDispatcher = [(HMDHome *)selfCopy2 msgDispatcher];
    uuid3 = [(HMDHome *)selfCopy2 uuid];
    [msgDispatcher sendMessage:v35 target:uuid3];
  }

  else
  {
    v40 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v42 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
    {
      v43 = HMFGetLogIdentifier();
      *buf = 138543362;
      v75 = v43;
      _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_INFO, "%{public}@Not notifying non-SPI-entitled clients of empty list of added accessories", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v40);
    v30 = *MEMORY[0x277CCE7A8];
    v36 = messageCopy;
  }

  v44 = [v27 mutableCopy];
  v45 = [array2 copy];
  [v44 setObject:v45 forKeyedSubscript:v30];

  v46 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v48 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
  {
    v49 = HMFGetLogIdentifier();
    *buf = 138543618;
    v75 = v49;
    v76 = 2112;
    v77 = v44;
    _os_log_impl(&dword_2531F8000, v48, OS_LOG_TYPE_INFO, "%{public}@Notifying SPI-entitled clients of added accessories using payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v46);
  v50 = MEMORY[0x277D0F848];
  v51 = *MEMORY[0x277CCFD98];
  identifier2 = [v36 identifier];
  v53 = [v50 entitledMessageWithName:v51 identifier:identifier2 messagePayload:v44];

  msgDispatcher2 = [(HMDHome *)selfCopy4 msgDispatcher];
  uuid4 = [(HMDHome *)selfCopy4 uuid];
  v64[0] = MEMORY[0x277D85DD0];
  v64[1] = 3221225472;
  v64[2] = __63__HMDHome__notifyClientOfNewlyAddedAccessories_requestMessage___block_invoke;
  v64[3] = &unk_279735D00;
  v65 = v36;
  v56 = v36;
  [msgDispatcher2 sendMessage:v53 target:uuid4 andInvokeCompletionHandler:v64];

  v57 = *MEMORY[0x277D85DE8];
}

- (void)_sharedAdminDidFailToAddAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = accessoriesCopy;
  v6 = accessoriesCopy;
  dispatch_async(workQueue, v7);
}

void __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke(uint64_t a1)
{
  v106 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v73 = a1;
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(v73 + 40);
    *buf = 138543618;
    v96 = v5;
    v97 = 2112;
    v98 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Removing accessories that were not added to resident: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v91 = 0u;
  v92 = 0u;
  v89 = 0u;
  v90 = 0u;
  obj = *(v73 + 40);
  v66 = [obj countByEnumeratingWithState:&v89 objects:v105 count:16];
  if (v66)
  {
    v65 = *v90;
    *&v7 = 138544386;
    v62 = v7;
    do
    {
      v8 = 0;
      do
      {
        if (*v90 != v65)
        {
          v9 = v8;
          objc_enumerationMutation(obj);
          v8 = v9;
        }

        v69 = v8;
        v10 = *(*(&v89 + 1) + 8 * v8);
        if ([v10 isPrimary])
        {
          v68 = [MEMORY[0x277CBEB18] arrayWithCapacity:2];
          v11 = *(v73 + 32);
          v12 = [v11 owner];
          v88 = 0;
          v67 = [v11 prepareUserManagementOperationForUser:v12 accessory:v10 type:2 model:0 error:&v88];
          v70 = v88;

          if (v70)
          {
            v13 = objc_autoreleasePoolPush();
            v14 = *(v73 + 32);
            v15 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
            {
              v16 = HMFGetLogIdentifier();
              v17 = *(v73 + 32);
              v18 = objc_opt_class();
              v19 = *(v73 + 32);
              v20 = v18;
              v21 = [v19 name];
              v22 = [*(v73 + 32) owner];
              v23 = [v22 userID];
              *buf = v62;
              v96 = v16;
              v97 = 2112;
              v98 = v18;
              v99 = 2112;
              v100 = v21;
              v101 = 2112;
              v102 = v23;
              v103 = 2112;
              v104 = v70;
              _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@[%@ %@] Failed to prepare remove operations for user '%@' with error: %@", buf, 0x34u);
            }

            objc_autoreleasePoolPop(v13);
          }

          else
          {
            [v68 addObject:v67];
            v24 = *(v73 + 32);
            v25 = [v24 currentUser];
            v87 = 0;
            v63 = [v24 prepareUserManagementOperationForUser:v25 accessory:v10 type:2 model:0 error:&v87];
            v70 = v87;

            if (v70)
            {
              v26 = objc_autoreleasePoolPush();
              v27 = *(v73 + 32);
              v28 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
              {
                v29 = HMFGetLogIdentifier();
                v30 = *(v73 + 32);
                v31 = objc_opt_class();
                v32 = *(v73 + 32);
                v33 = v31;
                v34 = [v32 name];
                v35 = [*(v73 + 32) currentUser];
                v36 = [v35 userID];
                *buf = v62;
                v96 = v29;
                v97 = 2112;
                v98 = v31;
                v99 = 2112;
                v100 = v34;
                v101 = 2112;
                v102 = v36;
                v103 = 2112;
                v104 = v70;
                _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@[%@ %@] Failed to prepare remove operations for user '%@' with error: %@", buf, 0x34u);
              }

              objc_autoreleasePoolPop(v26);
            }

            else
            {
              [v63 addDependency:v67];
              [v68 addObject:v63];
            }

            v85 = 0u;
            v86 = 0u;
            v84 = 0u;
            v83 = 0u;
            v71 = v68;
            v74 = [v71 countByEnumeratingWithState:&v83 objects:v94 count:16];
            if (v74)
            {
              v72 = *v84;
              do
              {
                for (i = 0; i != v74; ++i)
                {
                  if (*v84 != v72)
                  {
                    objc_enumerationMutation(v71);
                  }

                  v38 = *(*(&v83 + 1) + 8 * i);
                  if (shouldLogPrivateInformation())
                  {
                    v39 = [v38 user];
                    v40 = [v39 userID];
                  }

                  else
                  {
                    v40 = @"...";
                    v41 = @"...";
                  }

                  v42 = objc_autoreleasePoolPush();
                  v43 = *(v73 + 32);
                  v44 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v44, OS_LOG_TYPE_INFO))
                  {
                    v45 = HMFGetLogIdentifier();
                    v46 = [v38 identifier];
                    v47 = [v38 accessory];
                    v48 = [v47 shortDescription];
                    *buf = 138544130;
                    v96 = v45;
                    v97 = 2112;
                    v98 = v46;
                    v99 = 2112;
                    v100 = v40;
                    v101 = 2112;
                    v102 = v48;
                    _os_log_impl(&dword_2531F8000, v44, OS_LOG_TYPE_INFO, "%{public}@Adding operation '%@' to manager tracking remove user '%@' from accessory '%@'", buf, 0x2Au);
                  }

                  objc_autoreleasePoolPop(v42);
                  v49 = +[HMDUserManagementOperationManager sharedManager];
                  [v49 addOperation:v38];
                }

                v74 = [v71 countByEnumeratingWithState:&v83 objects:v94 count:16];
              }

              while (v74);
            }
          }
        }

        v8 = v69 + 1;
      }

      while (v69 + 1 != v66);
      v66 = [obj countByEnumeratingWithState:&v89 objects:v105 count:16];
    }

    while (v66);
  }

  v81 = 0u;
  v82 = 0u;
  v79 = 0u;
  v80 = 0u;
  v50 = *(v73 + 40);
  v51 = [v50 countByEnumeratingWithState:&v79 objects:v93 count:16];
  if (!v51)
  {
    goto LABEL_47;
  }

  v52 = 0;
  v53 = *v80;
  do
  {
    for (j = 0; j != v51; ++j)
    {
      if (*v80 != v53)
      {
        objc_enumerationMutation(v50);
      }

      v55 = *(*(&v79 + 1) + 8 * j);
      if ([v55 isPrimary])
      {
        v56 = v55;

        v57 = [v56 networkClientIdentifier];

        if (v57)
        {
          v58 = *(v73 + 32);
          v59 = [v56 networkClientIdentifier];
          [v58 _removeClientConfigurationWithIdentifier:v59];
        }

        v52 = v56;
      }
    }

    v51 = [v50 countByEnumeratingWithState:&v79 objects:v93 count:16];
  }

  while (v51);

  if (v52)
  {
    objc_initWeak(buf, *(v73 + 32));
    v60 = *(v73 + 32);
    v75[0] = MEMORY[0x277D85DD0];
    v75[1] = 3221225472;
    v75[2] = __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_1324;
    v75[3] = &unk_2797352E8;
    objc_copyWeak(&v78, buf);
    v76 = *(v73 + 40);
    v50 = v52;
    v77 = v50;
    [v60 _removeAccessory:v50 completionHandler:v75];

    objc_destroyWeak(&v78);
    objc_destroyWeak(buf);
LABEL_47:
  }

  v61 = *MEMORY[0x277D85DE8];
}

void __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_1324(id *a1, uint64_t a2, void *a3)
{
  v4 = a3;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v6 = WeakRetained;
  if (WeakRetained)
  {
    v7 = [WeakRetained workQueue];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_2;
    v8[3] = &unk_279734870;
    v9 = v4;
    v10 = v6;
    v11 = a1[4];
    v12 = a1[5];
    dispatch_async(v7, v8);
  }
}

void __47__HMDHome__sharedAdminDidFailToAddAccessories___block_invoke_2(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 56) name];
      v7 = *(a1 + 32);
      v12 = 138543874;
      v13 = v5;
      v14 = 2112;
      v15 = v6;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to remove accessory %@ with error: %@", &v12, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    v8 = *MEMORY[0x277D85DE8];
  }

  else
  {
    v9 = *(a1 + 40);
    v10 = *(a1 + 48);
    v11 = *MEMORY[0x277D85DE8];

    [v9 _removeAccessories:v10 message:0];
  }
}

- (void)_notifyOwnerOfAddedAccessories:(id)accessories completion:(id)completion
{
  v43 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  completionCopy = completion;
  v33 = objc_alloc_init(MEMORY[0x277CBEB38]);
  v7 = objc_alloc_init(MEMORY[0x277CBEB18]);
  v8 = [accessoriesCopy mutableCopy];
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v9 = accessoriesCopy;
  v10 = [v9 countByEnumeratingWithState:&v38 objects:v42 count:16];
  if (v10)
  {
    v11 = *v39;
    do
    {
      v12 = 0;
      do
      {
        if (*v39 != v11)
        {
          objc_enumerationMutation(v9);
        }

        v13 = *(*(&v38 + 1) + 8 * v12);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          [v7 addObject:v15];
          [v8 removeObject:v15];
        }

        ++v12;
      }

      while (v10 != v12);
      v10 = [v9 countByEnumeratingWithState:&v38 objects:v42 count:16];
    }

    while (v10);
  }

  v16 = [v8 copy];
  [v33 setObject:v7 forKey:@"accessories.airplay"];
  v17 = encodeRootObject();
  [v33 setObject:v17 forKey:@"accessories"];
  chipStorage = [(HMDHome *)self chipStorage];
  fabricID = [chipStorage fabricID];
  [v33 setObject:fabricID forKeyedSubscript:@"HMDHomeCHIPFabricIndexMessageKey"];

  chipStorage2 = [(HMDHome *)self chipStorage];
  fabricID2 = [chipStorage2 fabricID];
  [v33 setObject:fabricID2 forKeyedSubscript:@"HMDHomeCHIPFabricIDMessageKey"];

  objc_initWeak(&location, self);
  v22 = MEMORY[0x277D0F848];
  v23 = [v33 copy];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __53__HMDHome__notifyOwnerOfAddedAccessories_completion___block_invoke;
  v34[3] = &unk_2797355F8;
  objc_copyWeak(&v36, &location);
  v24 = completionCopy;
  v35 = v24;
  v25 = [v22 messageWithName:@"kAddAccessoriesInternalRequestKey" messagePayload:v23 responseHandler:v34];

  v26 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v28 = [v26 initWithTarget:uuid];

  [v25 setDestination:v28];
  [v25 setQualityOfService:33];
  administratorHandler = [(HMDHome *)self administratorHandler];
  v30 = [administratorHandler operationForMessage:v25 error:0];
  if (v30)
  {
    [administratorHandler addOperation:v30];
  }

  objc_destroyWeak(&v36);
  objc_destroyWeak(&location);

  v31 = *MEMORY[0x277D85DE8];
}

void __53__HMDHome__notifyOwnerOfAddedAccessories_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v14 = 138543874;
      v15 = v11;
      v16 = 2112;
      v17 = @"kAddAccessoriesInternalRequestKey";
      v18 = 2112;
      v19 = v5;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Relayed message %@ with error %@", &v14, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = *(a1 + 32);
    if (v12)
    {
      (*(v12 + 16))(v12, v5);
    }
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)_addOwnerToPrimaryAccessory:(id)accessory error:(id *)error
{
  accessoryCopy = accessory;
  if ([accessoryCopy isPrimary])
  {
    v20 = 0;
    v21 = &v20;
    v22 = 0x3032000000;
    v23 = __Block_byref_object_copy__10664;
    v24 = __Block_byref_object_dispose__10665;
    v25 = 0;
    owner = [(HMDHome *)self owner];
    v8 = (v21 + 5);
    obj = v21[5];
    v9 = [(HMDHome *)self prepareUserManagementOperationForUser:owner accessory:accessoryCopy type:1 model:0 error:&obj];
    objc_storeStrong(v8, obj);

    v10 = v21[5];
    if (!v10)
    {
      v11 = dispatch_group_create();
      dispatch_group_enter(v11);
      v12 = dispatch_get_global_queue(0, 0);
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __45__HMDHome__addOwnerToPrimaryAccessory_error___block_invoke;
      v16[3] = &unk_27972C6F8;
      v18 = &v20;
      v13 = v11;
      v17 = v13;
      [v9 executeWithCompletionQueue:v12 completionHandler:v16];

      dispatch_group_wait(v13, 0xFFFFFFFFFFFFFFFFLL);
      v10 = v21[5];
    }

    v14 = v10 == 0;
    if (error && v10)
    {
      *error = v10;
    }

    _Block_object_dispose(&v20, 8);
  }

  else
  {
    v14 = 1;
  }

  return v14;
}

void __45__HMDHome__addOwnerToPrimaryAccessory_error___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  }

  dispatch_group_leave(*(a1 + 32));
}

- (void)_deregisterPairedAccessory:(id)accessory
{
  accessoryCopy = accessory;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser deregisterPairedAccessory:accessoryCopy];
}

- (void)_registerPairedAccessory:(id)accessory transports:(unint64_t)transports setupHash:(id)hash
{
  hashCopy = hash;
  accessoryCopy = accessory;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser registerPairedAccessory:accessoryCopy transports:transports setupHash:hashCopy delegate:self];
}

- (id)hapAccessoryUniqueIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  accessories = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(accessories, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = accessories;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11)
        {
          uniqueIdentifier = [v11 uniqueIdentifier];
          [v3 addObject:uniqueIdentifier];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (id)hapAccessoryServerIdentifiers
{
  v21 = *MEMORY[0x277D85DE8];
  accessories = [(HMDHome *)self accessories];
  v3 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(accessories, "count")}];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v4 = accessories;
  v5 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        if (v11 && [v11 isPrimary])
        {
          identifier = [v11 identifier];
          [v3 addObject:identifier];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (unint64_t)accessoryCountForRoom:(id)room
{
  room = [MEMORY[0x277CCAC30] predicateWithFormat:@"room == %@", room];
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories filteredArrayUsingPredicate:room];

  v7 = [v6 count];
  return v7;
}

- (void)scheduleRemoval
{
  homeManager = [(HMDHome *)self homeManager];
  v3 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  [homeManager scheduleRemovalForHome:self message:0 options:v3];
}

- (id)hmdHAPAccessoryWithHAPAccessory:(id)accessory
{
  v20 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v16 != v8)
      {
        objc_enumerationMutation(accessories);
      }

      v10 = *(*(&v15 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if ([v12 matchesHAPAccessory:accessoryCopy])
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_12;
      }
    }
  }

  else
  {
LABEL_12:
    v12 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)hapAccessoryWithIdentifier:(id)identifier instanceID:(id)d
{
  v28 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  dCopy = d;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  accessories = [(HMDHome *)self accessories];
  v9 = [accessories countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v24;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v24 != v11)
        {
          objc_enumerationMutation(accessories);
        }

        v13 = *(*(&v23 + 1) + 8 * i);
        identifier = [v13 identifier];
        v15 = [identifier isEqualToString:identifierCopy];

        if (v15)
        {
          v16 = v13;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v18)
          {
            if (!dCopy)
            {
              goto LABEL_17;
            }

            hapInstanceId = [v18 hapInstanceId];
            v20 = [hapInstanceId isEqualToNumber:dCopy];

            if (v20)
            {
              goto LABEL_17;
            }
          }
        }
      }

      v10 = [accessories countByEnumeratingWithState:&v23 objects:v27 count:16];
    }

    while (v10);
  }

  v16 = 0;
LABEL_17:

  v21 = *MEMORY[0x277D85DE8];

  return v16;
}

- (id)hapAccessoryWithIdentifier:(id)identifier
{
  v3 = [(HMDHome *)self accessoryWithIdentifier:identifier];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithIdentifier:(id)identifier
{
  v19 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = *v15;
    do
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v14 + 1) + 8 * i);
        identifier = [v9 identifier];
        if ([identifier isEqualToString:identifierCopy])
        {
          isPrimary = [v9 isPrimary];

          if (isPrimary)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }

        else
        {
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v6);
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (void)_removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler
{
  v13[1] = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  handlerCopy = handler;
  [bridgeAccessory removeHostedAccessory:accessoryCopy];
  [(HMDHome *)self removeAccessory:accessoryCopy];
  v10 = +[HMDBulletinBoard sharedBulletinBoard];
  [v10 removeBulletinsForAccessory:accessoryCopy];

  [(HMDHome *)self _reevaluateAccessoryInfoWithBadgeRefresh:1];
  if (handlerCopy)
  {
    v13[0] = accessoryCopy;
    v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v13 count:1];
    handlerCopy[2](handlerCopy, v11, 0);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)removeWithMergeSecondaryAccessory:(id)accessory removedFromBridgeAccessory:(id)bridgeAccessory completionHandler:(id)handler
{
  accessoryCopy = accessory;
  bridgeAccessoryCopy = bridgeAccessory;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __90__HMDHome_removeWithMergeSecondaryAccessory_removedFromBridgeAccessory_completionHandler___block_invoke;
  v15[3] = &unk_279734578;
  v15[4] = self;
  v16 = accessoryCopy;
  v17 = bridgeAccessoryCopy;
  v18 = handlerCopy;
  v12 = handlerCopy;
  v13 = bridgeAccessoryCopy;
  v14 = accessoryCopy;
  dispatch_async(workQueue, v15);
}

- (void)notifyOfNewlyAddedAccessoryByThisOwnerDevice:(id)device
{
  v17[1] = *MEMORY[0x277D85DE8];
  deviceCopy = device;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = deviceCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;
  if (v6)
  {
    v7 = v6;
    isOwnerUser = [(HMDHome *)self isOwnerUser];

    if (!isOwnerUser)
    {
      goto LABEL_13;
    }

    goto LABEL_12;
  }

  v9 = deviceCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v9;
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  if (v11)
  {
    isOwnerUser2 = [(HMDHome *)self isOwnerUser];

    if (isOwnerUser2)
    {
LABEL_12:
      notificationCenter = [(HMDHome *)self notificationCenter];
      v16 = @"HMDAccessoryNotificationKey";
      v17[0] = deviceCopy;
      v14 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
      [notificationCenter postNotificationName:@"HMDHomeThisOwnerDeviceAddedAccessoryNotification" object:self userInfo:v14];
    }
  }

LABEL_13:

  v15 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfAddedAccessory:(id)accessory
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __34__HMDHome_notifyOfAddedAccessory___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = accessoryCopy;
  v6 = accessoryCopy;
  dispatch_async(workQueue, v7);
}

void __34__HMDHome_notifyOfAddedAccessory___block_invoke(uint64_t a1)
{
  v6[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v1 = *(a1 + 40);
  v5[0] = @"HMDNotificationAddedAccessoryKey";
  v5[1] = @"HMDAccessoryKey";
  v6[0] = v1;
  v6[1] = v1;
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v6 forKeys:v5 count:2];
  logAndPostNotification(@"HMDNotificationHomeAddedAccessory", v2, v3);

  v4 = *MEMORY[0x277D85DE8];
}

- (void)notifyOfRemovedAccessory:(id)accessory source:(unint64_t)source
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke;
  block[3] = &unk_279732F10;
  block[4] = self;
  v10 = accessoryCopy;
  sourceCopy = source;
  v8 = accessoryCopy;
  dispatch_async(workQueue, block);
}

void __43__HMDHome_notifyOfRemovedAccessory_source___block_invoke(uint64_t a1)
{
  v9[4] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) notificationCenter];
  v4 = *(a1 + 32);
  v3 = *(a1 + 40);
  v8[0] = @"HMDAccessoryNotificationKey";
  v8[1] = @"HMDAccessoryKey";
  v9[0] = v3;
  v9[1] = v3;
  v9[2] = v4;
  v8[2] = @"HMDHomeKey";
  v8[3] = @"HMDNotificationSourceKey";
  v5 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 48)];
  v9[3] = v5;
  v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  [v2 postNotificationName:@"HMDHomeAccessoryRemovedNotification" object:v4 userInfo:v6];

  v7 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveAccessoryModel:(id)model message:(id)message
{
  v47 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];

  if (uuid)
  {
    transactionResult = [messageCopy transactionResult];
    uuid2 = [modelCopy uuid];
    v11 = [(HMDHome *)self accessoryWithUUID:uuid2];

    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      v16 = [modelCopy debugString:1];
      *buf = 138543618;
      v44 = v15;
      v45 = 2112;
      v46 = v16;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Going to remove accessory : %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    responseHandler = v11;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v18 = responseHandler;
    }

    else
    {
      v18 = 0;
    }

    v19 = v18;

    if (responseHandler)
    {
      if (isInternalBuild() && ([responseHandler shouldProcessTransactionRemoval] & 1) == 0)
      {
        v37 = objc_autoreleasePoolPush();
        v38 = selfCopy;
        v39 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v39, OS_LOG_TYPE_ERROR))
        {
          v40 = HMFGetLogIdentifier();
          *buf = 138543362;
          v44 = v40;
          _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_ERROR, "%{public}@Failed to process transaction removal due to internal flag set to simulate this failure", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v37);
        [messageCopy respondWithSuccess];
        goto LABEL_20;
      }

      if ([responseHandler isPrimary])
      {
        uuid3 = [modelCopy uuid];
        [(HMDHome *)selfCopy _removeAccessoryWithUUID:uuid3 message:messageCopy];

        networkProtectionGroupRegistry = [(HMDHome *)selfCopy networkProtectionGroupRegistry];
        [networkProtectionGroupRegistry handleRemovedAccessory:responseHandler];

        uuid4 = [responseHandler uuid];
        activeNetworkRouterUUID = [(HMDHome *)selfCopy activeNetworkRouterUUID];
        v24 = [uuid4 isEqual:activeNetworkRouterUUID];

        if (v24)
        {
          [(HMDHome *)selfCopy _evaluateNetworkRouterManagementForTransaction:transactionResult];
        }
      }

      else
      {
        bridge = [v19 bridge];
        [bridge removeHostedAccessory:responseHandler];
        [(HMDHome *)selfCopy removeAccessory:responseHandler];
        v42 = responseHandler;
        v26 = [MEMORY[0x277CBEA60] arrayWithObjects:&v42 count:1];
        [(HMDHome *)selfCopy _removeAccessories:v26 message:0];
      }

      transactionResult2 = [messageCopy transactionResult];
      -[HMDHome notifyOfRemovedAccessory:source:](selfCopy, "notifyOfRemovedAccessory:source:", responseHandler, [transactionResult2 source]);
      homeManager = [(HMDHome *)selfCopy homeManager];
      if ([v19 isPrimary])
      {
        matterNodeID = [v19 matterNodeID];
        unsignedIntValue = [matterNodeID unsignedIntValue];

        if (unsignedIntValue)
        {
          accessoryBrowser = [homeManager accessoryBrowser];
          chipAccessoryServerBrowser = [accessoryBrowser chipAccessoryServerBrowser];
          matterNodeID2 = [v19 matterNodeID];
          targetFabricUUID = [(HMDHome *)selfCopy targetFabricUUID];
          [chipAccessoryServerBrowser handleHomeRemovedAccessoryWithNodeID:matterNodeID2 fabricUUID:targetFabricUUID];
        }
      }

      lastEventStoreController = [homeManager lastEventStoreController];
      uuid5 = [responseHandler uuid];
      [lastEventStoreController didRemoveAccessory:uuid5];
    }

    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
LABEL_20:

    goto LABEL_21;
  }

  transactionResult = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
  responseHandler = [messageCopy responseHandler];
  (*(responseHandler + 2))(responseHandler, transactionResult, 0);
LABEL_21:

  v36 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveAccessoryAfterUserConsent:(id)consent message:(id)message
{
  v38 = *MEMORY[0x277D85DE8];
  consentCopy = consent;
  messageCopy = message;
  if ([(HMDHome *)self isAdminUser])
  {
    administratorHandler = [(HMDHome *)self administratorHandler];
    if (([administratorHandler shouldRelayMessages] & 1) != 0 || objc_msgSend(consentCopy, "requiresRemovalOnPrimaryResident") && !-[HMDHome isCurrentDevicePrimaryResident](self, "isCurrentDevicePrimaryResident"))
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v12;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Sending remove accessory request to owner / primary resident", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v9);
      v33 = 0;
      v13 = [administratorHandler operationForMessage:messageCopy error:&v33];
      v14 = v33;
      if (v13)
      {
        [administratorHandler addOperation:v13];
        v15 = objc_autoreleasePoolPush();
        v16 = selfCopy;
        v17 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v18 = HMFGetLogIdentifier();
          *buf = 138543362;
          v35 = v18;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Also removing accessory locally", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v15);
        [HMDHome __removeAccessory:v16 isBeingReplaced:consentCopy isForceUpdate:0 message:messageCopy];
        [(HMDHome *)v16 _submitRemovalLogEventForAccessory:consentCopy isLocalRemoval:1 isLocalFallback:1 isDuplicate:0 duplicateCount:0 error:v14];
      }

      else
      {
        v27 = objc_autoreleasePoolPush();
        v28 = selfCopy;
        v29 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543618;
          v35 = v30;
          v36 = 2112;
          v37 = v14;
          _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Failed to create home administrator configuration operation for accessory removal: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v27);
        v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:52];
        [messageCopy respondWithError:v31];
      }
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543362;
        v35 = v26;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@Removing accessory locally", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v23);
      [HMDHome __removeAccessory:selfCopy2 isBeingReplaced:consentCopy isForceUpdate:0 message:messageCopy];
      [(HMDHome *)selfCopy2 _submitRemovalLogEventForAccessory:consentCopy isLocalRemoval:1 isLocalFallback:0 isDuplicate:0 duplicateCount:0 error:0];
    }
  }

  else
  {
    v19 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v21 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      v22 = HMFGetLogIdentifier();
      *buf = 138543362;
      v35 = v22;
      _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Not removing accessory due to insufficient privileges", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v19);
    administratorHandler = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [messageCopy respondWithError:administratorHandler];
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)__removeAccessory:(void *)accessory isBeingReplaced:(void *)replaced isForceUpdate:(char)update message:(void *)message
{
  v70 = *MEMORY[0x277D85DE8];
  replacedCopy = replaced;
  messageCopy = message;
  if (accessory)
  {
    v8 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    backingStore = [accessory backingStore];
    name = [messageCopy name];
    v41 = v8;
    v11 = [backingStore transaction:name options:v8];

    v12 = [MEMORY[0x277CBEB18] arrayWithObject:replacedCopy];
    v43 = replacedCopy;
    v13 = replacedCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      accessories = [accessory accessories];
      v66[0] = MEMORY[0x277D85DD0];
      v66[1] = 3221225472;
      v66[2] = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke;
      v66[3] = &unk_27972C828;
      v67 = v15;
      v17 = [accessories na_filter:v66];

      [v12 addObjectsFromArray:v17];
    }

    v40 = v15;
    accessoryCopy = accessory;
    v64 = 0u;
    v65 = 0u;
    v62 = 0u;
    v63 = 0u;
    v18 = v12;
    v19 = [v18 countByEnumeratingWithState:&v62 objects:v69 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v63;
      do
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v63 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v23 = [*(*(&v62 + 1) + 8 * i) transactionWithObjectChangeType:3];
          [v11 add:v23 withMessage:messageCopy];
        }

        v20 = [v18 countByEnumeratingWithState:&v62 objects:v69 count:16];
      }

      while (v20);
    }

    v42 = messageCopy;

    group = dispatch_group_create();
    v58 = 0u;
    v59 = 0u;
    v60 = 0u;
    v61 = 0u;
    obj = v18;
    accessoryCopy2 = accessory;
    v49 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
    if (v49)
    {
      v25 = *v59;
      v44 = *v59;
      do
      {
        for (j = 0; j != v49; ++j)
        {
          if (*v59 != v25)
          {
            objc_enumerationMutation(obj);
          }

          v27 = *(*(&v58 + 1) + 8 * j);
          dispatch_group_enter(group);
          v52[0] = MEMORY[0x277D85DD0];
          v52[1] = 3221225472;
          v28 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2;
          v53 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2;
          v54 = &unk_279734960;
          v55 = accessoryCopy2;
          v56 = v27;
          v57 = group;
          v29 = accessoryCopy2;
          v30 = v27;
          v31 = v11;
          v32 = v11;
          v33 = v52;
          if ((update & 1) == 0)
          {
            uuid = [v30 uuid];
            activeNetworkRouterUUID = [v29 activeNetworkRouterUUID];
            v36 = [uuid isEqual:activeNetworkRouterUUID];

            if (v36)
            {
              [v29 _updateActiveNetworkRouterAccessory:0 isReplacement:0 withTransaction:v32];
              [v29 _clearAccessoryNetworkProtectionStateWithTransaction:v32];
              [v29 _reconfigureAccessoriesOnRouterRemovalWithCompletion:v33];
              v25 = v44;
              accessoryCopy2 = accessoryCopy;
              goto LABEL_24;
            }

            v28 = v53;
            v25 = v44;
            accessoryCopy2 = accessoryCopy;
          }

          v28(v33);
LABEL_24:

          v11 = v31;
        }

        v49 = [obj countByEnumeratingWithState:&v58 objects:v68 count:16];
      }

      while (v49);
    }

    workQueue = [accessoryCopy2 workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_4;
    block[3] = &unk_279735D00;
    v51 = v11;
    v38 = v11;
    dispatch_group_notify(group, workQueue, block);

    messageCopy = v42;
    replacedCopy = v43;
  }

  v39 = *MEMORY[0x277D85DE8];
}

BOOL __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 hostAccessory];
  v4 = v3 == *(a1 + 32);

  return v4;
}

void __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_2(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v7 = __67__HMDHome___removeAccessory_isBeingReplaced_isForceUpdate_message___block_invoke_3;
  v8 = &unk_279735D00;
  v9 = *(a1 + 48);
  v3 = v1;
  v4 = v2;
  v5 = v6;
  if (([v4 isPrimary] & 1) != 0 || objc_msgSend(v4, "conformsToProtocol:", &unk_286699670) && objc_msgSend(v4, "supportsUserManagement"))
  {
    [v3 removeAllUsersAndCloudDataFromAccessory:v4 completionHandler:v5];
  }

  else
  {
    v7(v5);
  }
}

- (BOOL)shouldAccessoryRemovalFallbackToLocalRemovalOnError:(id)error accessory:(id)accessory
{
  errorCopy = error;
  accessoryCopy = accessory;
  if ([errorCopy isHMError] && objc_msgSend(errorCopy, "code") == 8 || objc_msgSend(errorCopy, "isHMFError") && objc_msgSend(errorCopy, "code") == 13 || objc_msgSend(errorCopy, "isHMError") && objc_msgSend(errorCopy, "code") == 91)
  {
    homeManager = [(HMDHome *)self homeManager];
    if ([homeManager isNetworkConnectionAvailable] && ((v9 = accessoryCopy, objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) ? (v10 = 0) : (v10 = v9), v11 = v10, v9, v11))
    {
      owner = [(HMDHome *)self owner];
      isCurrentUser = [owner isCurrentUser];
    }

    else
    {
      isCurrentUser = 0;
    }
  }

  else
  {
    isCurrentUser = 0;
  }

  return isCurrentUser;
}

- (void)_handleRemoveAccessoryMessage:(id)message
{
  v58 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = [messageCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v6)
  {
    v7 = [(HMDHome *)self accessoryWithUUID:v6];
    if (!v7)
    {
      v22 = objc_autoreleasePoolPush();
      selfCopy = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543618;
        v55 = v25;
        v56 = 2112;
        v57 = v6;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to find accessory with UUID: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      responseHandler = [messageCopy responseHandler];

      if (responseHandler)
      {
        v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        responseHandler2 = [messageCopy responseHandler];
        (responseHandler2)[2](responseHandler2, v26, 0);

        responseHandler = 0;
      }

      goto LABEL_22;
    }

    responseHandler = v7;
    isPrimary = [v7 isPrimary];
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    v13 = v12;
    if (isPrimary)
    {
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v14 = HMFGetLogIdentifier();
        *buf = 138543618;
        v55 = v14;
        v56 = 2112;
        v57 = responseHandler;
        _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Received request to remove accessory: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      if ([messageCopy isRemote] & 1) != 0 || (objc_msgSend(messageCopy, "isEntitledForSPIAccess"))
      {
        goto LABEL_8;
      }

      aBlock[0] = MEMORY[0x277D85DD0];
      aBlock[1] = 3221225472;
      aBlock[2] = __41__HMDHome__handleRemoveAccessoryMessage___block_invoke;
      aBlock[3] = &unk_279723AB0;
      aBlock[4] = selfCopy2;
      v52 = messageCopy;
      v32 = responseHandler;
      v53 = v32;
      v33 = _Block_copy(aBlock);
      uuid = [v32 uuid];
      activeNetworkRouterUUID = [(HMDHome *)selfCopy2 activeNetworkRouterUUID];
      v36 = [uuid isEqual:activeNetworkRouterUUID];

      if (v36)
      {
        accessoriesRequiringManualReconfigurationOnRouterRemoval = [(HMDHome *)selfCopy2 accessoriesRequiringManualReconfigurationOnRouterRemoval];
        v38 = [accessoriesRequiringManualReconfigurationOnRouterRemoval na_map:&__block_literal_global_1316];

        v39 = objc_autoreleasePoolPush();
        v40 = selfCopy2;
        v41 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          v42 = HMFGetLogIdentifier();
          *buf = 138543362;
          v55 = v42;
          _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove active network router accessory", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v39);
        name2 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        name = [v32 name];
        uuid2 = [v32 uuid];
        workQueue2 = [(HMDHome *)v40 workQueue];
        [name2 requestUserPermissionForRemovalOfRouter:name accessoriesRequiringManualReconfiguration:v38 withContext:uuid2 queue:workQueue2 completionHandler:v33];
      }

      else
      {
        if ([v32 wiFiCredentialType] != 3)
        {

LABEL_8:
          [(HMDHome *)selfCopy2 _handleRemoveAccessoryAfterUserConsent:responseHandler message:messageCopy];
LABEL_22:

          goto LABEL_23;
        }

        v47 = objc_autoreleasePoolPush();
        v48 = selfCopy2;
        v49 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
        {
          v50 = HMFGetLogIdentifier();
          *buf = 138543362;
          v55 = v50;
          _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Requesting permission to remove accessory with specific WiFi credential", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v47);
        v38 = +[HMDUIDialogPresenter sharedUIDialogPresenter];
        name2 = [v32 name];
        name = [v32 uuid];
        uuid2 = [(HMDHome *)v48 workQueue];
        [v38 requestUserPermissionForRemovalOfSpecificWiFiCredentialedAccessory:name2 withContext:name queue:uuid2 completionHandler:v33];
      }

      responseHandler = v32;
      goto LABEL_22;
    }

    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v28 = HMFGetLogIdentifier();
      *buf = 138543618;
      v55 = v28;
      v56 = 2112;
      v57 = responseHandler;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@cannot remove bridged accessory %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    responseHandler3 = [messageCopy responseHandler];

    if (!responseHandler3)
    {
      goto LABEL_22;
    }

    responseHandler4 = [messageCopy responseHandler];
    v30 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:34 userInfo:0];
    (responseHandler4)[2](responseHandler4, v30, 0);

LABEL_21:
    goto LABEL_22;
  }

  v15 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
  {
    v18 = HMFGetLogIdentifier();
    messagePayload = [messageCopy messagePayload];
    *buf = 138543618;
    v55 = v18;
    v56 = 2112;
    v57 = messagePayload;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEFAULT, "%{public}@Missing target accessory UUID from message payload: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v15);
  responseHandler5 = [messageCopy responseHandler];

  if (responseHandler5)
  {
    responseHandler = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    responseHandler4 = [messageCopy responseHandler];
    (responseHandler4)[2](responseHandler4, responseHandler, 0);
    goto LABEL_21;
  }

LABEL_23:

  v31 = *MEMORY[0x277D85DE8];
}

void __41__HMDHome__handleRemoveAccessoryMessage___block_invoke(uint64_t a1, int a2)
{
  v15 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = os_log_type_enabled(v6, OS_LOG_TYPE_INFO);
  if (a2)
  {
    if (v7)
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@User canceled consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [v9 respondWithError:v10];
  }

  else
  {
    if (v7)
    {
      v11 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v11;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@User accepted consent for removing accessory", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _handleRemoveAccessoryAfterUserConsent:*(a1 + 48) message:*(a1 + 40)];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleRemoveAccessoryMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __40__HMDHome_handleRemoveAccessoryMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

- (void)handleRemoveAccessory:(id)accessory completion:(id)completion
{
  v26[1] = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v7 = MEMORY[0x277D0F848];
  accessoryCopy = accessory;
  v9 = [v7 alloc];
  v10 = *MEMORY[0x277CD24F0];
  v11 = objc_alloc(MEMORY[0x277D0F820]);
  uuid = [(HMDHome *)self uuid];
  v13 = [v11 initWithTarget:uuid];
  v25 = *MEMORY[0x277CCF0B0];
  uuid2 = [accessoryCopy uuid];

  uUIDString = [uuid2 UUIDString];
  v26[0] = uUIDString;
  v16 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v26 forKeys:&v25 count:1];
  v17 = [v9 initWithName:v10 destination:v13 payload:v16];

  [v17 setRemoteRestriction:9];
  v20 = MEMORY[0x277D85DD0];
  v21 = 3221225472;
  v22 = __44__HMDHome_handleRemoveAccessory_completion___block_invoke;
  v23 = &unk_279729A58;
  v24 = completionCopy;
  v18 = completionCopy;
  [v17 setResponseHandler:&v20];
  [(HMDHome *)self handleRemoveAccessoryMessage:v17, v20, v21, v22, v23];

  v19 = *MEMORY[0x277D85DE8];
}

void __44__HMDHome_handleRemoveAccessory_completion___block_invoke(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = _Block_copy(*(a1 + 32));
  v4 = v3;
  if (v3)
  {
    (*(v3 + 2))(v3, v5);
  }
}

- (void)__handleAddMediaAccessoryModel:(id)model message:(id)message
{
  v82 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v8 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v8))
  {
    uuid = [modelCopy uuid];
    parentUUID = [modelCopy parentUUID];
    bsoRecord = [modelCopy bsoRecord];
    recordID = [bsoRecord recordID];
    recordName = [recordID recordName];
    v14 = recordName;
    v15 = &stru_286509E58;
    *buf = 138412802;
    v77 = uuid;
    if (recordName)
    {
      v15 = recordName;
    }

    v78 = 2112;
    v79 = parentUUID;
    v80 = 2112;
    v81 = v15;
    _os_signpost_emit_with_name_impl(&dword_2531F8000, v8, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "Identifier=%{signpost.description:attribute}@ parentUUID=%{signpost.description:attribute}@ recordName=%{signpost.description:attribute}@ ", buf, 0x20u);
  }

  v16 = objc_autoreleasePoolPush();
  selfCopy = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v19 = HMFGetLogIdentifier();
    uuid2 = [modelCopy uuid];
    *buf = 138543618;
    v77 = v19;
    v78 = 2112;
    v79 = uuid2;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Creating new media accessory from model with UUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v16);
  v21 = modelCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v22 = v21;
  }

  else
  {
    v22 = 0;
  }

  v23 = v22;

  v24 = v21;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v25 = v24;
  }

  else
  {
    v25 = 0;
  }

  v26 = v25;

  if (v23)
  {
    v27 = v23;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v29 = v27;
    }

    else
    {
      v29 = 0;
    }

    if (isKindOfClass)
    {
      v30 = off_279719FF8;
    }

    else
    {
      v30 = off_27971A018;
    }

    v31 = v29;

    v32 = v27;
    objc_opt_class();
    v33 = objc_opt_isKindOfClass();
    if (v33)
    {
      v34 = v32;
    }

    else
    {
      v34 = 0;
    }

    if (v33)
    {
      v30 = off_27971A008;
    }

    v35 = v34;

    v36 = [objc_alloc(*v30) initWithTransaction:v32 home:selfCopy];
    isCurrentDevicePrimaryResident = 0;
    if (!v36)
    {
      goto LABEL_39;
    }

LABEL_29:
    v64 = v26;
    v65 = v24;
    v66 = v23;
    v38 = v36;
    objc_opt_class();
    v39 = objc_opt_isKindOfClass();
    if (v39)
    {
      v40 = v38;
    }

    else
    {
      v40 = 0;
    }

    v41 = v40;

    [(HMDAirPlayAccessory *)v41 setDataSource:selfCopy];
    [(HMDHome *)selfCopy addAccessory:v38];
    homeManager = [(HMDHome *)selfCopy homeManager];
    uuid3 = [(HMDAccessory *)v38 uuid];
    v44 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid3];

    v63 = v44;
    [v44 markAccessoryAddCompleted];
    v45 = dispatch_group_create();
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    [(HMDAirPlayAccessory *)v38 configureWithHome:selfCopy msgDispatcher:msgDispatcher configurationTracker:v45 initialConfiguration:0];

    homeManager2 = [(HMDHome *)selfCopy homeManager];
    if ((v39 & 1) != 0 && [(HMDAccessory *)v38 isCurrentAccessory])
    {
      currentAccessorySetupMetricDispatcher = [homeManager2 currentAccessorySetupMetricDispatcher];
      [currentAccessorySetupMetricDispatcher markSetupBeginStage:7 error:0];
    }

    v75 = v38;
    v49 = [MEMORY[0x277CBEA60] arrayWithObjects:&v75 count:1];
    identifier = [messageCopy identifier];
    [(HMDHome *)selfCopy addNewlyConfiguredAccessories:v49 addSessionIdentifier:identifier];

    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    workQueue = [(HMDHome *)selfCopy workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke;
    block[3] = &unk_279722518;
    block[4] = selfCopy;
    v68 = v38;
    v69 = messageCopy;
    v70 = homeManager2;
    v23 = v66;
    v71 = v66;
    v72 = v41;
    v74 = isCurrentDevicePrimaryResident;
    v73 = transactionResult;
    v53 = transactionResult;
    v54 = v41;
    v55 = homeManager2;
    v56 = v38;
    dispatch_group_notify(v45, workQueue, block);

    v26 = v64;
    v24 = v65;
    goto LABEL_39;
  }

  if (v26)
  {
    v36 = [[HMDAirPlayAccessory alloc] initWithTransaction:v26 home:selfCopy];
    isCurrentDevicePrimaryResident = [(HMDHome *)selfCopy isCurrentDevicePrimaryResident];
    if (!v36)
    {
      goto LABEL_39;
    }

    goto LABEL_29;
  }

  v57 = objc_autoreleasePoolPush();
  v58 = selfCopy;
  v59 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v59, OS_LOG_TYPE_DEFAULT))
  {
    v60 = HMFGetLogIdentifier();
    *buf = 138543618;
    v77 = v60;
    v78 = 2112;
    v79 = v24;
    _os_log_impl(&dword_2531F8000, v59, OS_LOG_TYPE_DEFAULT, "%{public}@Invalid WHA accessory: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v57);
LABEL_39:
  v61 = HMFGetOSLogHandle();
  if (os_signpost_enabled(v61))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_2531F8000, v61, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddMediaAccessoryModel", "", buf, 2u);
  }

  v62 = *MEMORY[0x277D85DE8];
}

void __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke(uint64_t a1)
{
  v85 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessoryBrowser];
  v3 = [*(a1 + 40) identifier];
  [v2 registerPairedAccessory:v3 transports:objc_msgSend(*(a1 + 40) setupHash:"supportedTransports") delegate:{0, *(a1 + 32)}];

  v71 = 0u;
  v72 = 0u;
  v69 = 0u;
  v70 = 0u;
  v4 = [*(a1 + 32) accessoryBrowser];
  v5 = [v4 mediaBrowser];
  v6 = [v5 accessoryAdvertisements];

  v7 = [v6 countByEnumeratingWithState:&v69 objects:v84 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v70;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v70 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v69 + 1) + 8 * i);
        v12 = [v11 identifier];
        v13 = [*(a1 + 40) identifier];
        v14 = [v12 isEqualToString:v13];

        if (v14)
        {
          [*(a1 + 40) addAdvertisement:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v69 objects:v84 count:16];
    }

    while (v8);
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v15 = objc_autoreleasePoolPush();
    v16 = *(a1 + 32);
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [*(a1 + 40) name];
      *buf = 138543618;
      v77 = v18;
      v78 = 2112;
      v79 = v19;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  v20 = [*(a1 + 48) transactionResult];
  v21 = [v20 source];

  if ((v21 & 0xFFFFFFFFFFFFFFFDLL) == 1 && [*(a1 + 32) isOwnerUser])
  {
    v22 = *(a1 + 56);
    v23 = [*(a1 + 40) identifier];
    v63 = MEMORY[0x277D85DD0];
    v64 = 3221225472;
    v65 = __50__HMDHome___handleAddMediaAccessoryModel_message___block_invoke_1312;
    v66 = &unk_2797358C8;
    v24 = *(a1 + 40);
    v67 = *(a1 + 32);
    v68 = v24;
    [v22 cleanupOperationsForAccessory:v23 user:0 completion:&v63];
  }

  v25 = objc_autoreleasePoolPush();
  v26 = *(a1 + 32);
  v27 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
  {
    v28 = HMFGetLogIdentifier();
    v29 = [*(a1 + 40) shortDescription];
    [*(a1 + 32) isCurrentDeviceConfirmedPrimaryResident];
    v30 = HMFBooleanToString();
    *buf = 138544130;
    v77 = v28;
    v78 = 2112;
    v79 = v29;
    v80 = 2048;
    v81 = v21;
    v82 = 2112;
    v83 = v30;
    _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Apple media accessory %@ being added to home - source %tu. IsPrimary: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v25);
  if ([*(a1 + 40) supportsTargetControl])
  {
    if (v21 <= 1)
    {
      if ([*(a1 + 40) isCurrentAccessory])
      {
        v31 = [MEMORY[0x277D0F8D0] sharedPreferences];
        v32 = [v31 preferenceForKey:@"autoConfigureNewTargets"];
        v33 = [v32 BOOLValue];

        if (v33)
        {
          [*(a1 + 40) autoConfigureTargetControllers];
        }
      }
    }
  }

  if (*(a1 + 64) && [*(a1 + 40) isCurrentAccessory])
  {
    v34 = objc_autoreleasePoolPush();
    v35 = *(a1 + 32);
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      v38 = *(a1 + 40);
      *buf = 138543618;
      v77 = v37;
      v78 = 2112;
      v79 = v38;
      _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during add - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v34);
    v39 = [*(a1 + 32) _addMediaSessionForCurrentAccessory:*(a1 + 40)];
  }

  v40 = *(a1 + 72);
  if (v40)
  {
    [v40 configureAudioDestinationController];
    if ([*(a1 + 72) isCurrentAccessory])
    {
      [*(a1 + 32) createRemoteEventRouterServerIfNeeded];
      v41 = [*(a1 + 32) notificationCenter];
      v42 = *(a1 + 32);
      v43 = *(a1 + 72);
      v74 = @"HMDAccessoryNotificationKey";
      v75 = v43;
      v44 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v75 forKeys:&v74 count:1];
      [v41 postNotificationName:@"HMDHomeManagerDidAddCurrentAccessoryNotification" object:v42 userInfo:v44];

      v45 = [*(a1 + 56) currentAccessorySetupMetricDispatcher];
      [v45 markSetupEndStage:7 error:0];
    }

    v46 = *(a1 + 32);
    v73 = *(a1 + 72);
    v47 = [MEMORY[0x277CBEA60] arrayWithObjects:&v73 count:{1, v63, v64, v65, v66, v67}];
    [v46 configureRemoteEventRouterClientControllerForAccessories:v47];

    v48 = [*(a1 + 32) capabilitiesAggregator];
    v49 = [*(a1 + 72) uuid];
    [v48 didAddAccessory:v49];
  }

  if ([*(a1 + 40) isCurrentAccessory])
  {
    v50 = objc_autoreleasePoolPush();
    v51 = *(a1 + 32);
    v52 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      v53 = HMFGetLogIdentifier();
      *buf = 138543362;
      v77 = v53;
      _os_log_impl(&dword_2531F8000, v52, OS_LOG_TYPE_INFO, "%{public}@Notifying that we are a reachable accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v50);
    v54 = [*(a1 + 32) notificationCenter];
    [v54 postNotificationName:@"HMDHomeCurrentDeviceHasReachableAccessories" object:*(a1 + 32)];

    v55 = *(a1 + 72);
    if (v55)
    {
      [v55 configureSensors];
    }
  }

  if (*(a1 + 88) == 1)
  {
    v56 = [*(a1 + 32) residentDeviceManager];
    [v56 confirmWithCompletionHandler:0];
  }

  v57 = *(a1 + 32);
  v58 = [*(a1 + 48) identifier];
  v59 = [v57 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v58];

  if ([*(a1 + 80) source] == 1)
  {
    [*(a1 + 32) _notifyClientOfNewlyAddedAccessories:v59 requestMessage:*(a1 + 48)];
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  else
  {
    [*(a1 + 48) respondWithPayload:0];
  }

  v60 = [*(a1 + 32) accessoryBrowser];
  v61 = [*(a1 + 40) identifier];
  [v60 removeUnassociatedAccessoryWithIdentifier:v61];

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  v62 = *MEMORY[0x277D85DE8];
}

- (void)__handleAddHAPAccessoryModel:(id)model message:(id)message
{
  v85 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  bridgeUUID = [modelCopy bridgeUUID];
  if (!bridgeUUID)
  {
    goto LABEL_3;
  }

  v9 = objc_alloc(MEMORY[0x277CCAD78]);
  bridgeUUID2 = [modelCopy bridgeUUID];
  v11 = [v9 initWithUUIDString:bridgeUUID2];
  v12 = [(HMDHome *)self accessoryWithUUID:v11];

  if (!v12)
  {
    v48 = objc_autoreleasePoolPush();
    selfCopy = self;
    v50 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
    {
      v51 = HMFGetLogIdentifier();
      bridgeUUID3 = [modelCopy bridgeUUID];
      uuid = [modelCopy uuid];
      *buf = 138543874;
      v76 = v51;
      v77 = 2112;
      v78 = bridgeUUID3;
      v79 = 2112;
      v80 = uuid;
      _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_ERROR, "%{public}@No bridge accessory %@ for added bridged accessory %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v48);
  }

  else
  {
LABEL_3:
    v13 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = HMFGetLogIdentifier();
      uuid2 = [modelCopy uuid];
      name = [modelCopy name];
      uniqueIdentifier = [modelCopy uniqueIdentifier];
      shortDescription = [messageCopy shortDescription];
      *buf = 138544386;
      v76 = v16;
      v77 = 2112;
      v78 = uuid2;
      v79 = 2112;
      v80 = name;
      v81 = 2112;
      v82 = uniqueIdentifier;
      v83 = 2112;
      v84 = shortDescription;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Creating new HAP accessory from model with UUID %@/%@/%@ from message: %@", buf, 0x34u);
    }

    objc_autoreleasePoolPop(v13);
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && (v21 = [(HMDHAPAccessory *)[HMDAppleMediaAccessorySensor alloc] initWithTransaction:modelCopy home:selfCopy2]) != 0 || (v21 = [[HMDHAPAccessory alloc] initWithTransaction:modelCopy home:selfCopy2]) != 0)
    {
      configurationTracker = [modelCopy configurationTracker];
      if (!configurationTracker)
      {
        configurationTracker = dispatch_group_create();
      }

      notificationRegistrations = [(HMDHome *)selfCopy2 notificationRegistrations];
      v24 = [notificationRegistrations count];
      v25 = v24 != 0;

      uuidToHAPAccessoryConfigTable = [(HMDHome *)selfCopy2 uuidToHAPAccessoryConfigTable];
      uuid3 = [modelCopy uuid];
      v28 = [uuidToHAPAccessoryConfigTable objectForKey:uuid3];

      if (v28)
      {
        uuidToHAPAccessoryConfigTable2 = [(HMDHome *)selfCopy2 uuidToHAPAccessoryConfigTable];
        uuid4 = [modelCopy uuid];
        [uuidToHAPAccessoryConfigTable2 removeObjectForKey:uuid4];

        dispatch_group_enter(configurationTracker);
        workQueue = [(HMDHome *)selfCopy2 workQueue];
        v72[0] = MEMORY[0x277D85DD0];
        v72[1] = 3221225472;
        v72[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke;
        v72[3] = &unk_279735D00;
        v73 = configurationTracker;
        [(HMDHAPAccessory *)v21 configureWithAccessory:v28 homeNotificationsEnabled:v24 != 0 queue:workQueue completion:v72];
      }

      if ([(HMDHAPAccessory *)v21 isPrimary])
      {
        name2 = [messageCopy name];
        v33 = [name2 isEqualToString:*MEMORY[0x277CD2070]];

        if ((v33 & 1) == 0)
        {
          [(HMDHAPAccessory *)v21 savePublicKeyToKeychain];
        }

        identifier = [(HMDAccessory *)v21 identifier];
        supportedTransports = [(HMDHAPAccessory *)v21 supportedTransports];
        setupHash = [(HMDHAPAccessory *)v21 setupHash];
        [(HMDHome *)selfCopy2 _registerPairedAccessory:identifier transports:supportedTransports setupHash:setupHash];
      }

      [(HMDHome *)selfCopy2 addAccessory:v21];
      msgDispatcher = [(HMDHome *)selfCopy2 msgDispatcher];
      [(HMDHAPAccessory *)v21 configureWithHome:selfCopy2 msgDispatcher:msgDispatcher configurationTracker:configurationTracker initialConfiguration:0];

      v74 = v21;
      v38 = [MEMORY[0x277CBEA60] arrayWithObjects:&v74 count:1];
      identifier2 = [messageCopy identifier];
      [(HMDHome *)selfCopy2 addNewlyConfiguredAccessories:v38 addSessionIdentifier:identifier2];

      accessoryBrowser = [(HMDHome *)selfCopy2 accessoryBrowser];
      [accessoryBrowser evaluateAccessoryDiscoveryState];

      matterNodeID = [(HMDHAPAccessory *)v21 matterNodeID];
      if (matterNodeID)
      {
        matterNodeID2 = [(HMDHAPAccessory *)v21 matterNodeID];
        v43 = [matterNodeID2 isEqual:&unk_2866277F0];

        if ((v43 & 1) == 0)
        {
          if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
          {
            objc_initWeak(buf, selfCopy2);
            v69[0] = MEMORY[0x277D85DD0];
            v69[1] = 3221225472;
            v69[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1304;
            v69[3] = &unk_2797338E8;
            objc_copyWeak(&v71, buf);
            v70 = v21;
            [(HMDHome *)selfCopy2 setUpSharedUserFabricDataWithForceFetch:0 completion:v69];

            objc_destroyWeak(&v71);
            objc_destroyWeak(buf);
          }
        }
      }

      transactionResult = [messageCopy transactionResult];
      [transactionResult markChanged];
      [transactionResult markSaveToAssistant];
      workQueue2 = [(HMDHome *)selfCopy2 workQueue];
      v63[0] = MEMORY[0x277D85DD0];
      v63[1] = 3221225472;
      v63[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2;
      v63[3] = &unk_27972DBC8;
      v63[4] = selfCopy2;
      v64 = v21;
      v65 = messageCopy;
      v66 = v28;
      v67 = modelCopy;
      v68 = v25;
      v46 = v28;
      responseHandler2 = v21;
      dispatch_group_notify(configurationTracker, workQueue2, v63);

      goto LABEL_21;
    }

    v54 = objc_autoreleasePoolPush();
    v55 = selfCopy2;
    v56 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
    {
      v57 = HMFGetLogIdentifier();
      uuid5 = [modelCopy uuid];
      uUIDString = [uuid5 UUIDString];
      *buf = 138543618;
      v76 = v57;
      v77 = 2112;
      v78 = uUIDString;
      _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null accessory) %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v54);
    responseHandler = [messageCopy responseHandler];
    v61 = responseHandler == 0;

    if (!v61)
    {
      responseHandler2 = [messageCopy responseHandler];
      configurationTracker = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
      (*&responseHandler2->super.super._primary)(responseHandler2, configurationTracker, 0);
LABEL_21:
    }
  }

  v62 = *MEMORY[0x277D85DE8];
}

void __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1304(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained homeManager];
  v3 = [v2 accessoryBrowser];
  v4 = [v3 chipAccessoryServerBrowser];
  v5 = [*(a1 + 32) matterNodeID];
  v6 = [WeakRetained targetFabricUUID];
  [v4 handleHomeAddedAccessoryWithNodeID:v5 fabricUUID:v6 localControl:{objc_msgSend(WeakRetained, "isCurrentDevicePrimaryResident")}];
}

uint64_t __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_2(uint64_t a1)
{
  v43 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) remoteAccessIsEnabled])
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 32);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) shortDescription];
      *buf = 138543618;
      *&buf[4] = v5;
      v39 = 2112;
      v40 = v6;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@accessory %@ setting remote access enabled", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) remoteAccessEnabled:1];
  }

  [*(a1 + 32) _reachabilityChangedForAccessory:*(a1 + 40) reachable:{objc_msgSend(*(a1 + 40), "isReachable")}];
  v7 = [*(a1 + 48) transactionResult];
  v8 = [v7 source];

  if ([*(a1 + 40) isPrimary])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = *(a1 + 32);
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [*(a1 + 40) shortDescription];
      v14 = *(a1 + 56);
      *buf = 138543874;
      *&buf[4] = v12;
      v39 = 2112;
      v40 = v13;
      v41 = 2112;
      v42 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@accessory %@ handling added primary HAPAccessory: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
    if (!*(a1 + 56))
    {
      v15 = [*(a1 + 40) identifier];
      *buf = 0;
      [*(a1 + 40) matchesHAPAccessoryWithServerIdentifier:v15 linkType:buf];
      v16 = [*(a1 + 32) accessoryBrowser];
      [v16 handleNewlyPairedAccessory:v15 linkType:*buf];

      if (!isWatch())
      {
        [*(a1 + 32) __requestAccessoryBrowsing];
      }
    }

    if ((v8 & 0xFFFFFFFFFFFFFFFDLL) == 1)
    {
      if ([*(a1 + 32) isOwnerUser])
      {
        v17 = [*(a1 + 64) sharedAdminAddedTimestamp];

        if (!v17)
        {
          v18 = [*(a1 + 32) homeManager];
          v19 = [*(a1 + 40) identifier];
          v35[0] = MEMORY[0x277D85DD0];
          v35[1] = 3221225472;
          v35[2] = __48__HMDHome___handleAddHAPAccessoryModel_message___block_invoke_1305;
          v35[3] = &unk_2797358C8;
          v20 = *(a1 + 40);
          v35[4] = *(a1 + 32);
          v36 = v20;
          [v18 cleanupOperationsForAccessory:v19 user:0 completion:v35];
        }
      }
    }

    v21 = [*(a1 + 32) accessoryBrowser];
    v22 = [*(a1 + 40) identifier];
    [v21 removeUnassociatedAccessoryWithIdentifier:v22];

    v23 = [*(a1 + 32) networkProtectionGroupRegistry];
    [v23 handleAddedAccessory:*(a1 + 40)];
  }

  v24 = *(a1 + 56);
  if (v24)
  {
    [*(a1 + 40) enableNotificationsWithHAPAccessory:v24 homeNotificationsEnabled:*(a1 + 72)];
  }

  else if (*(a1 + 72) == 1)
  {
    v25 = *(a1 + 32);
    v37 = *(a1 + 40);
    v26 = [MEMORY[0x277CBEA60] arrayWithObjects:&v37 count:1];
    [v25 _subscribeForHomeNotificationsFromRemoteGateway:1 accessories:v26];
  }

  v27 = [*(a1 + 48) name];
  if ([v27 isEqualToString:*MEMORY[0x277CD2070]])
  {
  }

  else
  {
    v28 = [*(a1 + 48) name];
    v29 = [v28 isEqualToString:@"kAddAccessoriesInternalRequestKey"];

    if ((v29 & 1) == 0)
    {
      v30 = *(a1 + 32);
      v31 = [*(a1 + 48) identifier];
      v32 = [v30 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v31];

      [*(a1 + 48) respondWithPayload:0];
    }
  }

  if (v8 == 1)
  {
    [*(a1 + 32) notifyOfNewlyAddedAccessoryByThisOwnerDevice:*(a1 + 40)];
  }

  [*(a1 + 32) notifyOfAddedAccessory:*(a1 + 40)];
  result = [*(a1 + 32) reevaluateAccessoryInfo];
  v34 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)__requestAccessoryBrowsing
{
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser startDiscoveringPairedAccessories];
}

- (void)_handleAddAccessoryModel:(id)model message:(id)message
{
  v34 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = modelCopy;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;
  v10 = modelCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;

  identifier = [v10 identifier];

  if (!identifier)
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      uuid = [v10 uuid];
      uUIDString = [uuid UUIDString];
      v30 = 138543618;
      v31 = v17;
      v32 = 2112;
      v33 = uUIDString;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to create accessory from object (null identifier) %@", &v30, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
    home = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [messageCopy respondWithError:home];
    goto LABEL_21;
  }

  if (v9)
  {
    [(HMDHome *)self __handleAddHAPAccessoryModel:v9 message:messageCopy];
  }

  else if (v12)
  {
    [(HMDHome *)self __handleAddMediaAccessoryModel:v12 message:messageCopy];
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v30 = 138543362;
      v31 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Only HAP accessories can be added to the home currently", &v30, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    responseHandler = [messageCopy responseHandler];

    if (responseHandler)
    {
      v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      responseHandler2 = [messageCopy responseHandler];
      (responseHandler2)[2](responseHandler2, v26, 0);
    }
  }

  if ([(HMDHome *)self isOwnerUser])
  {
    home = [(HMDHome *)self home];
    homeManager = [home homeManager];
    [homeManager updateCurrentUserEligibleForOwnerToAutoMigration];

LABEL_21:
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentResponseForAccessory:(id)accessory
{
  v35 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  if ([accessoryCopy isEntitledForSPIAccess])
  {
    v5 = [accessoryCopy dataForKey:*MEMORY[0x277CD1F90]];
    v30 = 0;
    v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v30];
    v7 = v30;
    if (v6)
    {
      v8 = [accessoryCopy numberForKey:*MEMORY[0x277CD06B0]];
      if (v8)
      {
        addPendingAccessories = [(HMDHome *)self addPendingAccessories];
        v10 = [addPendingAccessories objectForKey:v6];

        integerValue = [v8 integerValue];
        if (integerValue > 1)
        {
          if ((integerValue & 0xFFFFFFFFFFFFFFFELL) == 2)
          {
            [(HMDHome *)self _handleUserConsentForAccessoryReplacement:v6 consent:integerValue == 3 message:v10];
          }

          else
          {
            v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];

            v7 = v26;
          }
        }

        else
        {
          v12 = integerValue == 1;
          accessoryBrowser = [(HMDHome *)self accessoryBrowser];
          [accessoryBrowser didReceiveUserConsentResponseForSetupAccessoryDetail:v6 consent:v12];
        }

        responseHandler = [accessoryCopy responseHandler];

        if (responseHandler)
        {
          responseHandler2 = [accessoryCopy responseHandler];
          (responseHandler2)[2](responseHandler2, v7, 0);
        }
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        selfCopy = self;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543362;
          v32 = v25;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@user consent response is absent", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v22);
      }
    }

    else
    {
      v18 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v32 = v21;
        v33 = 2112;
        v34 = v7;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v18);
    }
  }

  else
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v17;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI for user consent response", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)_handleUserConsentForAccessoryReplacement:(id)replacement consent:(BOOL)consent message:(id)message
{
  v36 = *MEMORY[0x277D85DE8];
  replacementCopy = replacement;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  v13 = os_log_type_enabled(v12, OS_LOG_TYPE_INFO);
  if (consent)
  {
    if (v13)
    {
      v14 = HMFGetLogIdentifier();
      name = [messageCopy name];
      identifier = [messageCopy identifier];
      messagePayload = [messageCopy messagePayload];
      v28 = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = name;
      v32 = 2112;
      v33 = identifier;
      v34 = 2112;
      v35 = messagePayload;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@User consented to Wi-Fi router replacement; continue to adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    [replacementCopy setUserConsentedForReplace:1];
    accessoryUUID = [replacementCopy accessoryUUID];

    if (accessoryUUID)
    {
      accessoryUUID2 = [replacementCopy accessoryUUID];
      [(HMDHome *)selfCopy _continuePairingAfterUserConsentWithAccessoryUUID:accessoryUUID2 orUnassociatedAccessory:0 message:messageCopy];
    }

    else
    {
      [(HMDHome *)selfCopy _continuePairingAfterUserConsentWithAccessoryDescription:replacementCopy progressHandlerDelegate:0 message:messageCopy];
    }
  }

  else
  {
    if (v13)
    {
      v20 = HMFGetLogIdentifier();
      name2 = [messageCopy name];
      identifier2 = [messageCopy identifier];
      messagePayload2 = [messageCopy messagePayload];
      v28 = 138544130;
      v29 = v20;
      v30 = 2112;
      v31 = name2;
      v32 = 2112;
      v33 = identifier2;
      v34 = 2112;
      v35 = messagePayload2;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@User did not consent to Wi-Fi router replacement; cancelling adding new Wi-Fi router - message %@/%@/%@", &v28, 0x2Au);
    }

    objc_autoreleasePoolPop(v10);
    v24 = [MEMORY[0x277CCA9B8] hmInternalErrorWithCode:1091];
    v25 = [HMDMatterAccessoryPairingEndContext hmContextWithCancelledError:v24];
    [(HMDHome *)selfCopy _cancelPairingWithAccessoryDescription:replacementCopy context:v25];

    v26 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    [messageCopy respondWithError:v26];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessories:(id)accessories
{
  v155[2] = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsAddingAccessory = [localCapabilitiesDataSource supportsAddingAccessory];

  if (supportsAddingAccessory)
  {
    v7 = [accessoriesCopy dataForKey:@"accessories"];
    if (!v7)
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        identifier = [accessoriesCopy identifier];
        uUIDString = [identifier UUIDString];
        *buf = 138543618;
        v145 = v11;
        v146 = 2112;
        v147 = uUIDString;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Unable to find accessories to add for message: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      v14 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      responseHandler = [accessoriesCopy responseHandler];
      (responseHandler)[2](responseHandler, v14, 0);
    }

    v143 = 0;
    v113 = v7;
    v16 = [objc_alloc(MEMORY[0x277CCAAC8]) initForReadingFromData:v7 error:&v143];
    v17 = v143;
    [v16 _allowDecodingCyclesInSecureMode];
    v18 = MEMORY[0x277CBEB98];
    v155[0] = objc_opt_class();
    v155[1] = objc_opt_class();
    v19 = [MEMORY[0x277CBEA60] arrayWithObjects:v155 count:2];
    v20 = [v18 setWithArray:v19];
    v21 = *MEMORY[0x277CCA308];
    v142 = v17;
    v112 = v16;
    v22 = [v16 decodeTopLevelObjectOfClasses:v20 forKey:v21 error:&v142];
    v114 = v142;

    v23 = v22;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v24 = v23;
    }

    else
    {
      v24 = 0;
    }

    v25 = v24;

    if (!v25)
    {
      v93 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v95 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v95, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v97 = v96 = v23;
        identifier2 = [accessoriesCopy identifier];
        uUIDString2 = [identifier2 UUIDString];
        *buf = 138543874;
        v145 = v97;
        v146 = 2112;
        v147 = uUIDString2;
        v148 = 2112;
        v149 = v114;
        _os_log_impl(&dword_2531F8000, v95, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive accessories from encoded accessories data: %@: %@", buf, 0x20u);

        v23 = v96;
      }

      objc_autoreleasePoolPop(v93);
      v100 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
      responseHandler2 = [accessoriesCopy responseHandler];
      (responseHandler2)[2](responseHandler2, v100, 0);
      v89 = 0;
      v80 = v113;
      goto LABEL_67;
    }

    [accessoriesCopy dataForKey:@"accessories.airplay"];
    v111 = v110 = v23;
    v26 = v23;
    if (v111)
    {
      v27 = MEMORY[0x277CCAAC8];
      v28 = MEMORY[0x277CBEB98];
      v154[0] = objc_opt_class();
      v154[1] = objc_opt_class();
      v29 = [MEMORY[0x277CBEA60] arrayWithObjects:v154 count:2];
      v30 = [v28 setWithArray:v29];
      v141 = 0;
      v31 = [v27 unarchivedObjectOfClasses:v30 fromData:v111 error:&v141];
      v32 = v141;

      if (!v31)
      {
        v120 = v32;
        v102 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v104 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v104, OS_LOG_TYPE_INFO))
        {
          v105 = HMFGetLogIdentifier();
          identifier3 = [accessoriesCopy identifier];
          uUIDString3 = [identifier3 UUIDString];
          *buf = 138543874;
          v145 = v105;
          v146 = 2112;
          v147 = uUIDString3;
          v148 = 2112;
          v149 = v120;
          _os_log_impl(&dword_2531F8000, v104, OS_LOG_TYPE_INFO, "%{public}@Failed to unarchive airplay accessories from encoded airplay accessories data: %@: %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v102);
        v77 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:2 userInfo:0];
        responseHandler3 = [accessoriesCopy responseHandler];
        (responseHandler3)[2](responseHandler3, v77, 0);
        v23 = v110;
        v89 = v110;
        v80 = v7;
        goto LABEL_66;
      }

      v26 = [v25 arrayByAddingObjectsFromArray:v31];
    }

    wiFiRouterAccessories = [(HMDHome *)self wiFiRouterAccessories];
    v124 = dispatch_group_create();
    backingStore = [(HMDHome *)self backingStore];
    name = [accessoriesCopy name];
    v35 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v36 = [backingStore transaction:name options:v35];

    v139 = 0u;
    v140 = 0u;
    v137 = 0u;
    v138 = 0u;
    obj = v26;
    v120 = v36;
    v117 = [obj countByEnumeratingWithState:&v137 objects:v153 count:16];
    if (v117)
    {
      v116 = *v138;
      selfCopy4 = self;
      do
      {
        v37 = 0;
        do
        {
          if (*v138 != v116)
          {
            objc_enumerationMutation(obj);
          }

          v118 = v37;
          v38 = *(*(&v137 + 1) + 8 * v37);
          [v38 setHome:self];
          v125 = v38;
          v39 = [v38 backingStoreObjects:4];
          v133 = 0u;
          v134 = 0u;
          v135 = 0u;
          v136 = 0u;
          v121 = v39;
          v127 = [v121 countByEnumeratingWithState:&v133 objects:v152 count:16];
          if (v127)
          {
            v126 = *v134;
            do
            {
              for (i = 0; i != v127; ++i)
              {
                if (*v134 != v126)
                {
                  objc_enumerationMutation(v121);
                }

                v41 = *(*(&v133 + 1) + 8 * i);
                [v41 setObjectChangeType:1];
                v42 = v41;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v43 = v42;
                }

                else
                {
                  v43 = 0;
                }

                v44 = v43;

                v45 = v42;
                objc_opt_class();
                if (objc_opt_isKindOfClass())
                {
                  v46 = v45;
                }

                else
                {
                  v46 = 0;
                }

                v47 = v46;

                if (v44)
                {
                  [v44 setConfigurationTracker:v124];
                  v48 = [HMDUserManagementOperationTimestamp alloc];
                  remoteSourceDevice = [accessoriesCopy remoteSourceDevice];
                  v50 = [(HMDUserManagementOperationTimestamp *)v48 initWithDevice:remoteSourceDevice state:0];
                  [v44 setSharedAdminAddedTimestamp:v50];

                  v51 = objc_autoreleasePoolPush();
                  selfCopy5 = self;
                  v53 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
                  {
                    HMFGetLogIdentifier();
                    v122 = v51;
                    v54 = v123 = v47;
                    name2 = [v125 name];
                    uuid = [v125 uuid];
                    uUIDString4 = [uuid UUIDString];
                    [v44 sharedAdminAddedTimestamp];
                    v59 = v58 = accessoriesCopy;
                    *buf = 138544130;
                    v145 = v54;
                    v146 = 2112;
                    v147 = name2;
                    v148 = 2112;
                    v149 = uUIDString4;
                    v150 = 2112;
                    v151 = v59;
                    _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ shared admin added %@", buf, 0x2Au);

                    accessoriesCopy = v58;
                    self = selfCopy4;

                    v36 = v120;
                    v51 = v122;

                    v47 = v123;
                  }

                  objc_autoreleasePoolPop(v51);
                  [v36 add:v44 withMessage:accessoriesCopy];
                  v60 = v125;
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v61 = v60;
                  }

                  else
                  {
                    v61 = 0;
                  }

                  v62 = v61;

                  if ([v62 isPrimary])
                  {
                    v63 = [HMDUserManagementOperation auditUserManagementOperationAccessory:v60 model:0];
                    uuid2 = [v44 uuid];
                    v65 = [v63 modelObjectWithChangeType:1 parentUUID:uuid2];

                    if (v65)
                    {
                      [v36 add:v65 withMessage:accessoriesCopy];
                    }
                  }
                }

                else if (v47)
                {
                  [v47 setConfigurationTracker:v124];
                  [v36 add:v45 withMessage:0];
                }
              }

              v127 = [v121 countByEnumeratingWithState:&v133 objects:v152 count:16];
            }

            while (v127);
          }

          v66 = objc_autoreleasePoolPush();
          selfCopy6 = self;
          v68 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v68, OS_LOG_TYPE_INFO))
          {
            v69 = HMFGetLogIdentifier();
            name3 = [v125 name];
            uuid3 = [v125 uuid];
            uUIDString5 = [uuid3 UUIDString];
            [v125 supportsTargetController];
            v73 = HMFBooleanToString();
            *buf = 138544130;
            v145 = v69;
            v146 = 2112;
            v147 = name3;
            v148 = 2112;
            v149 = uUIDString5;
            v150 = 2112;
            v151 = v73;
            _os_log_impl(&dword_2531F8000, v68, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ (supportsTargetController %@) being added to home through shared admin", buf, 0x2Au);

            v36 = v120;
          }

          objc_autoreleasePoolPop(v66);
          v74 = v125;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v75 = v74;
          }

          else
          {
            v75 = 0;
          }

          v76 = v75;

          [v76 autoConfigureTargetController];
          v37 = v118 + 1;
        }

        while (v118 + 1 != v117);
        v117 = [obj countByEnumeratingWithState:&v137 objects:v153 count:16];
      }

      while (v117);
    }

    v77 = [accessoriesCopy numberForKey:@"HMDHomeCHIPFabricIDMessageKey"];
    responseHandler3 = [accessoriesCopy numberForKey:@"HMDHomeCHIPFabricIndexMessageKey"];
    v79 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    v80 = v113;
    if (v77)
    {
      if (responseHandler3)
      {
        chipStorage = [(HMDHome *)self chipStorage];
        fabricID = [chipStorage fabricID];

        if (!fabricID)
        {
          [v79 setChipFabricID:v77];
          [v79 setChipFabricIndex:responseHandler3];
          v83 = objc_autoreleasePoolPush();
          selfCopy7 = self;
          v85 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v85, OS_LOG_TYPE_INFO))
          {
            v86 = HMFGetLogIdentifier();
            *buf = 138543874;
            v145 = v86;
            v146 = 2112;
            v147 = responseHandler3;
            v148 = 2112;
            v149 = v77;
            _os_log_impl(&dword_2531F8000, v85, OS_LOG_TYPE_INFO, "%{public}@Updating home model with fabric index %@ and fabric ID %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v83);
          [v120 add:v79];
        }
      }
    }

    v128[0] = MEMORY[0x277D85DD0];
    v128[1] = 3221225472;
    v128[2] = __33__HMDHome__handleAddAccessories___block_invoke;
    v128[3] = &unk_279730430;
    v129 = v124;
    selfCopy8 = self;
    v131 = accessoriesCopy;
    v132 = wiFiRouterAccessories;
    v87 = wiFiRouterAccessories;
    v88 = v124;
    [v120 run:v128];

    v23 = v110;
    v89 = obj;
LABEL_66:

    v100 = v111;
    responseHandler2 = v120;
LABEL_67:

    goto LABEL_68;
  }

  responseHandler4 = [accessoriesCopy responseHandler];

  if (responseHandler4)
  {
    responseHandler5 = [accessoriesCopy responseHandler];
    v92 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (responseHandler5)[2](responseHandler5, v92, 0);
  }

LABEL_68:

  v108 = *MEMORY[0x277D85DE8];
}

void __33__HMDHome__handleAddAccessories___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome__handleAddAccessories___block_invoke_2;
  block[3] = &unk_279734960;
  v4 = *(a1 + 48);
  v5 = *(a1 + 40);
  v7 = v4;
  v8 = v5;
  v9 = *(a1 + 56);
  dispatch_group_notify(v2, v3, block);
}

void __33__HMDHome__handleAddAccessories___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) respondWithPayload:0];
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) identifier];
  v4 = [v2 retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:v3];

  [*(a1 + 40) _setupActiveNetworkRouterAccessory:v4 existingRouterAccessories:*(a1 + 48)];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)description configuration:(id)configuration pairingEvent:(id)event progressHandler:(id)handler requestMessage:(id)message
{
  handlerCopy = handler;
  configurationCopy = configuration;
  descriptionCopy = description;
  v16 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, descriptionCopy, configurationCopy, event, message);
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  [accessoryBrowser pairAccessoryWithDescription:descriptionCopy configuration:configurationCopy progressHandler:handlerCopy completionHandler:v16];
}

- (void)_continuePairingAfterUserConsentWithAccessoryDescription:(id)description progressHandlerDelegate:(id)delegate message:(id)message
{
  v59 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  delegateCopy = delegate;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = descriptionCopy;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryDescription %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v14 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setRequiresUserConsent:1];
  homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
  isoCountryCode = [homeLocationHandler isoCountryCode];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setIsoCountryCode:isoCountryCode];

  matterFabricID = [(HMDHome *)selfCopy matterFabricID];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setChipFabricID:matterFabricID];

  uuid = [(HMDHome *)selfCopy uuid];
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 setHomeUUID:uuid];

  v19 = [HMDAccessoryPairingEvent pairingAccessoryWithDescription:descriptionCopy home:selfCopy];
  if ([v19 isMatterAccessory])
  {
    notifyMatterMetricPairingStep(selfCopy, 2uLL);
  }

  setupAccessoryPayload = [descriptionCopy setupAccessoryPayload];
  v20 = objc_alloc(MEMORY[0x277D0F770]);
  v21 = MEMORY[0x277CCACA8];
  v22 = MEMORY[0x259C01AE0](selfCopy, a2);
  12372 = [v21 stringWithFormat:@"%@, %s:%ld", v22, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 12372];
  v24 = [v20 initWithName:12372];

  v45 = v24;
  [descriptionCopy accessoryUUID];

  [setupAccessoryPayload categoryNumber];
  [v19 linkType];
  v25 = HAPLinkTypeDescription();
  [v19 communicationProtocol];
  v26 = HAPCommunicationProtocolDescription();
  [setupAccessoryPayload supportsWAC];
  v27 = HMFBooleanToString();
  [(HMDUnpairedHAPAccessoryConfiguration *)v14 requiresUserConsent];
  v28 = HMFBooleanToString();
  v29 = HMDNetworkRouterSupportAsString([(HMDHome *)selfCopy networkRouterSupport]);
  v30 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](selfCopy, "networkRouterSupportDisableReason")}];
  [descriptionCopy appIdentifier];

  [v19 isThreadAccessory];
  v31 = HMFBooleanToString();

  if (delegateCopy)
  {
    v32 = delegateCopy;
    if (selfCopy)
    {
      objc_initWeak(&location, selfCopy);
      *buf = MEMORY[0x277D85DD0];
      *&buf[8] = 3221225472;
      *&buf[16] = __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke;
      v55 = &unk_279722400;
      objc_copyWeak(&v56[8], &location);
      *v56 = v32;
      v41 = _Block_copy(buf);

      objc_destroyWeak(&v56[8]);
      objc_destroyWeak(&location);
    }

    else
    {
      v41 = 0;
    }
  }

  else
  {
    v41 = HMDHomeCreateAddAccessoryProgressHandler(selfCopy, descriptionCopy, messageCopy);
  }

  v33 = objc_autoreleasePoolPush();
  v34 = selfCopy;
  v35 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
  {
    v36 = HMFGetLogIdentifier();
    [descriptionCopy supportsWAC];
    v37 = HMFBooleanToString();
    v38 = HMDNetworkRouterSupportAsString([(HMDHome *)v34 networkRouterSupport]);
    [(HMDHome *)v34 networkRouterSupportDisableReason];
    v39 = HMNetworkRouterSupportDisableReasonAsString();
    *buf = 138544386;
    *&buf[4] = v36;
    *&buf[12] = 2112;
    *&buf[14] = descriptionCopy;
    *&buf[22] = 2112;
    v55 = v37;
    *v56 = 2112;
    *&v56[2] = v38;
    v57 = 2112;
    v58 = v39;
    _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with description: %@, supports WAC: %@, network router support: %@ (Reason: %@)", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v33);
  if ([descriptionCopy supportsWAC] && (-[HMDHome networkRouterSupport](v34, "networkRouterSupport") & 8) != 0)
  {
    v46[0] = MEMORY[0x277D85DD0];
    v46[1] = 3221225472;
    v46[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke;
    v46[3] = &unk_2797224F0;
    v46[4] = v34;
    v47 = v45;
    v48 = descriptionCopy;
    v49 = v19;
    v50 = messageCopy;
    v51 = v14;
    v52 = v41;
    [(HMDHome *)v34 _createUniquePSKClientConfigurationWithRequestMessage:v50 pairingEvent:v49 completion:v46];
  }

  else
  {
    [v45 begin];
    *buf = v45;
    [(HMDHome *)v34 _pairAccessoryWithAccessoryDescription:descriptionCopy configuration:v14 pairingEvent:v19 progressHandler:v41 requestMessage:messageCopy];
    __HMFActivityScopeLeave();
  }

  v40 = *MEMORY[0x277D85DE8];
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2;
  block[3] = &unk_27972EED8;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __100__HMDHome__continuePairingAfterUserConsentWithAccessoryDescription_progressHandlerDelegate_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) progressHandler:*(a1 + 96) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __74__HMDHome_createLocalAddAccessoryProgressHandler_progressHandlerDelegate___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v20 = *MEMORY[0x277D85DE8];
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v7 = objc_autoreleasePoolPush();
  v8 = WeakRetained;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v11 = HMSetupAccessoryProgressAsString();
    v16 = 138543618;
    v17 = v10;
    v18 = 2112;
    v19 = v11;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Local add accessory progress handler called with progress: %@", &v16, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  if (v8)
  {
    if (*(a1 + 32))
    {
      v12 = [v5 accessoryUUID];

      if (a2 == 6)
      {
        if (v12)
        {
          v13 = *(a1 + 32);
          v14 = [v5 accessoryUUID];
          [v13 localAccessoryAddRequiresConsent:v14];
        }
      }
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(id)description
{
  v19 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  v5 = [descriptionCopy dataForKey:*MEMORY[0x277CD1F90]];
  v14 = 0;
  v6 = [(HMDHome *)self _setupDescriptionFromData:v5 error:&v14];
  v7 = v14;
  if (v6)
  {
    [(HMDHome *)&self->super.super.isa _handleAddAccessoryWithDescription:v6 progressHandlerDelegate:0 message:descriptionCopy];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v16 = v11;
      v17 = 2112;
      v18 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to unarchive setup accessory description from accessory description data: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [descriptionCopy respondWithError:v12];
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessoryWithDescription:(void *)description progressHandlerDelegate:(void *)delegate message:
{
  v59 = *MEMORY[0x277D85DE8];
  v7 = a2;
  descriptionCopy = description;
  delegateCopy = delegate;
  v10 = delegateCopy;
  if (self)
  {
    if (([delegateCopy isEntitledForSPIAccess] & 1) == 0)
    {
      v30 = objc_autoreleasePoolPush();
      selfCopy = self;
      v32 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        v33 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v33;
        _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_ERROR, "%{public}@Client does not have entitlement to use SPI", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v30);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    accessories = [self accessories];
    v12 = [accessories count];
    v13 = maximumAccessoriesPerHome;

    if (v12 >= v13)
    {
      v34 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v36 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = HMFGetLogIdentifier();
        *buf = 138543362;
        v54 = v37;
        _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Can't add additional accessories; already at maximum accessories for home", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v34);
      v16 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
      [v10 respondWithError:v16];
      goto LABEL_32;
    }

    v52 = 0;
    v14 = [self _shouldAllowAddingAccessoryWithDescription:v7 requestMessage:v10 error:&v52];
    v15 = v52;
    v16 = v15;
    if (v14)
    {
      goto LABEL_5;
    }

    domain = [v15 domain];
    if ([domain isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v39 = [v16 code] == 97;

      if (v39)
      {
LABEL_5:
        appIdentifier = [v7 appIdentifier];
        v18 = appIdentifier == 0;

        if (v18)
        {
          clientIdentifier = [v10 clientIdentifier];
          v20 = clientIdentifier;
          if (clientIdentifier)
          {
            v21 = clientIdentifier;
          }

          else
          {
            v21 = &stru_286509E58;
          }

          [v7 updateAppIdentifier:v21];
        }

        os_unfair_recursive_lock_lock_with_options();
        [self[129] setObject:v10 forKey:v7];
        os_unfair_recursive_lock_unlock();
        accessoryBrowser = [self accessoryBrowser];
        v23 = [accessoryBrowser unpairedHAPAccessoryWithAccessoryDescription:v7];

        uuid = [v23 uuid];
        v25 = HMDHomeCreateAddAccessoryProgressHandler(self, v7, v10);

        accessoryBrowser2 = [self accessoryBrowser];
        uuid2 = [v23 uuid];
        [accessoryBrowser2 registerProgressHandler:v25 unpairedAccessoryUUID:uuid2];

        if (v14)
        {
          accessoryUUID = [v7 accessoryUUID];

          if (accessoryUUID)
          {
            accessoryUUID2 = [v7 accessoryUUID];
            [self _continuePairingAfterUserConsentWithAccessoryUUID:accessoryUUID2 orUnassociatedAccessory:0 message:v10];
          }

          else
          {
            [self _continuePairingAfterUserConsentWithAccessoryDescription:v7 progressHandlerDelegate:descriptionCopy message:v10];
          }
        }

        else
        {
          category = [v23 category];
          v41 = category == 0;

          if (v41)
          {
            setupAccessoryPayload = [v7 setupAccessoryPayload];
            categoryNumber = [setupAccessoryPayload categoryNumber];
          }

          else
          {
            categoryNumber = 0;
          }

          v50 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v23 server:0 categoryIdentifier:categoryNumber certificationStatus:0];
          (v25)[2](v25, 9, v50);
        }

LABEL_32:
        goto LABEL_33;
      }
    }

    else
    {
    }

    v43 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      category2 = [v7 category];
      localizedDescription = [category2 localizedDescription];
      *buf = 138543874;
      v54 = v46;
      v55 = 2112;
      v56 = localizedDescription;
      v57 = 2112;
      v58 = v16;
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Cannot add an accessory of category '%@', error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v43);
    [v10 respondWithError:v16];
    goto LABEL_32;
  }

LABEL_33:

  v51 = *MEMORY[0x277D85DE8];
}

- (void)_addMediaAccessory:(id)accessory message:(id)message
{
  v57 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  messageCopy = message;
  if (self && ([accessoryCopy identifier], v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isEqualToString:", @"00000000-0000-0000-0000-C2EE6102B308"), v7, v8))
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      *&buf[4] = v12;
      *&buf[12] = 2112;
      *&buf[14] = accessoryCopy;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@The accessory %@ has an unknown media route identifier", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:9001];
    [messageCopy respondWithError:v13];
  }

  else
  {
    v41 = 0;
    v42 = &v41;
    v43 = 0x2020000000;
    v44 = 0;
    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v46 = __Block_byref_object_copy__10664;
    v47 = __Block_byref_object_dispose__10665;
    v48 = 0;
    appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
    v37[0] = MEMORY[0x277D85DD0];
    v37[1] = 3221225472;
    v37[2] = __38__HMDHome__addMediaAccessory_message___block_invoke;
    v37[3] = &unk_2797224C8;
    v15 = accessoryCopy;
    v38 = v15;
    v39 = &v41;
    v40 = buf;
    [appleMediaAccessories na_each:v37];

    if (v42[3] >= 1)
    {
      v16 = *(*&buf[8] + 40);
      if (v16)
      {
        [HMDHome _submitRemovalLogEventForAccessory:"_submitRemovalLogEventForAccessory:isLocalRemoval:isLocalFallback:isDuplicate:duplicateCount:error:" isLocalRemoval:v16 isLocalFallback:0 isDuplicate:0 duplicateCount:1 error:?];
      }
    }

    v17 = v15;
    v18 = messageCopy;
    if (self)
    {
      v19 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        v22 = HMFGetLogIdentifier();
        shortDescription = [v18 shortDescription];
        [(HMDHome *)selfCopy2 isCurrentDevicePrimaryResident];
        v24 = HMFBooleanToString();
        *v49 = 138544130;
        v50 = v22;
        v51 = 2112;
        v52 = v17;
        v53 = 2112;
        v54 = shortDescription;
        v55 = 2112;
        v56 = v24;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Performing local add of media accessory: %@. Message: %@ - isPrimaryResident: %@", v49, 0x2Au);
      }

      objc_autoreleasePoolPop(v19);
      v25 = HMFGetOSLogHandle();
      if (os_signpost_enabled(v25))
      {
        uuid = [v17 uuid];
        *v49 = 138412290;
        v50 = uuid;
        _os_signpost_emit_with_name_impl(&dword_2531F8000, v25, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "accessoryUUID=%{signpost.description:attribute}@ ", v49, 0xCu);
      }

      v27 = [v17 addTransactionForHome:selfCopy2];
      roomForEntireHome = [(HMDHome *)selfCopy2 roomForEntireHome];
      uuid2 = [roomForEntireHome uuid];
      uUIDString = [uuid2 UUIDString];
      [v27 setRoomUUID:uUIDString];

      backingStore = [(HMDHome *)selfCopy2 backingStore];
      name = [v18 name];
      v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v34 = [backingStore transaction:name options:v33];

      [v34 add:v27 withMessage:v18];
      [v34 run];
      if (os_signpost_enabled(v25))
      {
        *v49 = 0;
        _os_signpost_emit_with_name_impl(&dword_2531F8000, v25, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "AddAccessory", "", v49, 2u);
      }
    }

    _Block_object_dispose(buf, 8);
    _Block_object_dispose(&v41, 8);
  }

  v35 = *MEMORY[0x277D85DE8];
}

void __38__HMDHome__addMediaAccessory_message___block_invoke(uint64_t a1, void *a2)
{
  v7 = a2;
  if ([v7 isHomePod])
  {
    v4 = [*(a1 + 32) serialNumber];
    v5 = [v7 serialNumber];
    v6 = [v4 isEqualToString:v5];

    if (v6)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), a2);
    }
  }
}

- (void)_removePendingAccessoryAdd:(id)add
{
  v16 = *MEMORY[0x277D85DE8];
  addCopy = add;
  accessoryUUID = [addCopy accessoryUUID];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    uUIDString = [accessoryUUID UUIDString];
    v12 = 138543618;
    v13 = v9;
    v14 = 2112;
    v15 = uUIDString;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Removing accessoryDescription, setupCode and handlers for accessory %@", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)selfCopy->_addPendingAccessories removeObjectForKey:addCopy];
  if (accessoryUUID)
  {
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodeHandlers removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessorySetupCodes removeObjectForKey:accessoryUUID];
    [(NSMutableDictionary *)selfCopy->_addPendingAccessoryOnboardingSetupPayloadStrings removeObjectForKey:accessoryUUID];
  }

  os_unfair_recursive_lock_unlock();

  v11 = *MEMORY[0x277D85DE8];
}

- (void)_accessoryPairingDidComplete:(id)complete configuration:(id)configuration pairingEvent:(id)event accessoryServer:(id)server certificationStatus:(int64_t)status requestMessage:(id)message
{
  v42 = *MEMORY[0x277D85DE8];
  completeCopy = complete;
  configurationCopy = configuration;
  eventCopy = event;
  serverCopy = server;
  messageCopy = message;
  [(HMDHome *)self _removePendingAccessoryAdd:completeCopy];
  v17 = serverCopy;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v18 = v17;
  }

  else
  {
    v18 = 0;
  }

  v19 = v18;

  networkCredential = 0;
  if ([v19 isWacComplete])
  {
    v21 = objc_autoreleasePoolPush();
    selfCopy = self;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v41 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@WAC was completed as part of accessory pairing.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v21);
    networkCredential = [configurationCopy networkCredential];
  }

  if ([eventCopy isMatterAccessory])
  {
    notifyMatterMetricPairingStep(self, 0x18uLL);
  }

  currentActivity = [MEMORY[0x277D0F770] currentActivity];
  objc_initWeak(buf, self);
  accessoryUUID = [completeCopy accessoryUUID];
  v34[0] = MEMORY[0x277D85DD0];
  v34[1] = 3221225472;
  v34[2] = __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke;
  v34[3] = &unk_279722478;
  objc_copyWeak(v39, buf);
  v27 = v17;
  v35 = v27;
  v28 = eventCopy;
  v36 = v28;
  v29 = completeCopy;
  v37 = v29;
  v30 = currentActivity;
  v38 = v30;
  v39[1] = status;
  [(HMDHome *)self _processAccessoriesToAddForUnpairedAccessory:accessoryUUID certificationStatus:status accessoryServer:v27 networkCredential:networkCredential pairingEvent:v28 message:messageCopy completionHandler:v34];

  objc_destroyWeak(v39);
  objc_destroyWeak(buf);

  v31 = *MEMORY[0x277D85DE8];
}

void __118__HMDHome__accessoryPairingDidComplete_configuration_pairingEvent_accessoryServer_certificationStatus_requestMessage___block_invoke(uint64_t a1, void *a2)
{
  v33 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = [WeakRetained _primaryAccessoryForServer:*(a1 + 32)];
  v28 = 0;
  v6 = [v5 preferredHAPAccessoryForOperation:1 linkType:&v28];
  v7 = [*(a1 + 32) pairingMetricDictionary];
  v8 = [v7 copy];
  [*(a1 + 40) setMatterMetrics:v8];

  [*(a1 + 32) clearPairingMetrics];
  [*(a1 + 40) updateEventPropertiesWithPairedAccessory:v5];
  if ([*(a1 + 40) isMatterAccessory] && objc_msgSend(*(a1 + 40), "isAddOperation"))
  {
    if (v3)
    {
      [HMDMatterAccessoryPairingEndContext hmdContextWithError:v3];
    }

    else
    {
      +[HMDMatterAccessoryPairingEndContext pairingCompletedContext];
    }
    v9 = ;
    notifyMatterMetricPairingEnded(WeakRetained, v9);
  }

  else
  {
    v9 = [WeakRetained logEventSubmitter];
    [v9 submitLogEvent:*(a1 + 40) error:v3];
  }

  v10 = objc_autoreleasePoolPush();
  v11 = WeakRetained;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v14 = [*(a1 + 48) accessoryName];
    *buf = 138543618;
    v30 = v13;
    v31 = 2112;
    v32 = v14;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@_handleAddAccessory: added accessories for accessory %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  v15 = [v5 metricLoggingVendorDetails];
  v16 = [v6 server];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = v16;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = *(a1 + 48);
  v20 = *(a1 + 56);
  [v19 accessoryUUID];

  [*(a1 + 32) category];
  [v15 model];

  [v15 manufacturer];
  [v15 firmwareVersion];

  v21 = HAPLinkTypeDescription();
  [v18 isWacAccessory];

  v22 = HMFBooleanToString();
  v23 = [MEMORY[0x277CCABB0] numberWithInteger:*(a1 + 72)];
  [*(a1 + 40) isThreadAccessory];
  v24 = HMFBooleanToString();
  [*(a1 + 40) accessorySupportsWoL];

  v25 = HMFBooleanToString();
  v26 = [v11 homeLocationHandler];
  [v26 updateHomeLocation];

  [v11 _evaluateShouldRelaunchAndSetRelaunch];
  v27 = *MEMORY[0x277D85DE8];
}

- (void)_pairAccessoryWithAccessoryDescription:(id)description unpairedAccessory:(id)accessory configuration:(id)configuration pairingEvent:(id)event requestMessage:(id)message
{
  messageCopy = message;
  eventCopy = event;
  configurationCopy = configuration;
  accessoryCopy = accessory;
  descriptionCopy = description;
  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  v17 = __createAccessoryBrowserAddAccessoryCompletionHandler(self, descriptionCopy, configurationCopy, eventCopy, messageCopy);

  [accessoryBrowser pairAccessory:accessoryCopy configuration:configurationCopy completionHandler:v17];
}

- (void)_continuePairingAfterUserConsentWithAccessoryUUID:(id)d orUnassociatedAccessory:(id)accessory message:(id)message
{
  v113 = *MEMORY[0x277D85DE8];
  dCopy = d;
  accessoryCopy = accessory;
  messageCopy = message;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    *&buf[4] = v13;
    *&buf[12] = 2112;
    *&buf[14] = dCopy;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Continue pairing after user consent with accessoryUUID %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (accessoryCopy)
  {
    goto LABEL_5;
  }

  accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
  unassociatedAccessories = [accessoryBrowser unassociatedAccessories];
  accessoryCopy = [unassociatedAccessories hmf_firstObjectWithUUID:dCopy];

  if (accessoryCopy)
  {
LABEL_5:
    responseHandler2 = accessoryCopy;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v17 = responseHandler2;
    }

    else
    {
      v17 = 0;
    }

    v94 = v17;

    if (isKindOfClass)
    {
      v107 = 0u;
      v105 = 0u;
      v106 = 0u;
      v104 = 0u;
      addPendingAccessories = [(HMDHome *)selfCopy addPendingAccessories];
      hm_allKeys = [addPendingAccessories hm_allKeys];

      v20 = [hm_allKeys countByEnumeratingWithState:&v104 objects:v109 count:16];
      if (v20)
      {
        v21 = *v105;
        while (2)
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v105 != v21)
            {
              objc_enumerationMutation(hm_allKeys);
            }

            v23 = *(*(&v104 + 1) + 8 * i);
            accessoryUUID = [v23 accessoryUUID];
            v25 = [accessoryUUID isEqual:dCopy];

            if (v25)
            {
              v93 = v23;
              addPendingAccessories2 = [(HMDHome *)selfCopy addPendingAccessories];
              v35 = [addPendingAccessories2 objectForKey:v93];

              messageCopy = v35;
              goto LABEL_27;
            }
          }

          v20 = [hm_allKeys countByEnumeratingWithState:&v104 objects:v109 count:16];
          if (v20)
          {
            continue;
          }

          break;
        }
      }

      v93 = 0;
LABEL_27:

      setupCode = [messageCopy stringForKey:*MEMORY[0x277CD1FD8]];
      if (setupCode)
      {
        v36 = objc_autoreleasePoolPush();
        v37 = selfCopy;
        v38 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
        {
          v39 = HMFGetLogIdentifier();
          *buf = 138543618;
          *&buf[4] = v39;
          *&buf[12] = 2112;
          *&buf[14] = v94;
          _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Storing setupCode accessory %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v36);
        addPendingAccessorySetupCodes = [(HMDHome *)v37 addPendingAccessorySetupCodes];
        [addPendingAccessorySetupCodes setObject:setupCode forKey:dCopy];
      }

      else
      {
        setupCode = [v93 setupCode];
      }

      appIdentifier = [v93 appIdentifier];
      v92 = +[HMDAccessoryPairingEvent pairingAccessory:home:appIdentifier:retry:](HMDAccessoryPairingEvent, "pairingAccessory:home:appIdentifier:retry:", v94, selfCopy, appIdentifier, [v93 retry]);

      if ([v92 isMatterAccessory])
      {
        notifyMatterMetricPairingStep(selfCopy, 2uLL);
      }

      v46 = objc_alloc_init(HMDUnpairedHAPAccessoryConfiguration);
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCode:setupCode];
      v47 = [(HMDHome *)selfCopy _setupCodeProviderForMessage:messageCopy];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setSetupCodeProvider:v47];

      homeLocationHandler = [(HMDHome *)selfCopy homeLocationHandler];
      isoCountryCode = [homeLocationHandler isoCountryCode];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setIsoCountryCode:isoCountryCode];

      matterFabricID = [(HMDHome *)selfCopy matterFabricID];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setChipFabricID:matterFabricID];

      uuid = [(HMDHome *)selfCopy uuid];
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 setHomeUUID:uuid];

      preferredAccessoryServer = [v94 preferredAccessoryServer];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v53 = preferredAccessoryServer;
      }

      else
      {
        v53 = 0;
      }

      v90 = v53;

      v54 = objc_autoreleasePoolPush();
      v55 = selfCopy;
      v56 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v56, OS_LOG_TYPE_INFO))
      {
        v57 = HMFGetLogIdentifier();
        uUIDString = [dCopy UUIDString];
        [v90 isWacNeeded];
        v59 = HMFBooleanToString();
        v60 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
        [(HMDHome *)v55 networkRouterSupportDisableReason];
        v61 = HMNetworkRouterSupportDisableReasonAsString();
        *buf = 138544386;
        *&buf[4] = v57;
        *&buf[12] = 2112;
        *&buf[14] = uUIDString;
        *&buf[22] = 2112;
        v111 = v59;
        *v112 = 2112;
        *&v112[2] = v60;
        *&v112[10] = 2112;
        *&v112[12] = v61;
        _os_log_impl(&dword_2531F8000, v56, OS_LOG_TYPE_INFO, "%{public}@Adding unpaired accessory with uuid: %@, WAC needed: %@, network router support: %@ (Reason %@)", buf, 0x34u);
      }

      objc_autoreleasePoolPop(v54);
      currentActivity = [MEMORY[0x277D0F770] currentActivity];
      [v93 accessoryUUID];

      preferredAccessoryServer2 = [v94 preferredAccessoryServer];
      [preferredAccessoryServer2 category];

      v64 = HMDNetworkRouterSupportAsString([(HMDHome *)v55 networkRouterSupport]);
      v65 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{-[HMDHome networkRouterSupportDisableReason](v55, "networkRouterSupportDisableReason")}];
      [v92 linkType];
      v66 = HAPLinkTypeDescription();
      [v92 communicationProtocol];
      v67 = HAPCommunicationProtocolDescription();
      [v90 isWacNeeded];
      v68 = HMFBooleanToString();
      [(HMDUnpairedHAPAccessoryConfiguration *)v46 requiresUserConsent];
      v69 = HMFBooleanToString();
      [v93 appIdentifier];

      [v92 isThreadAccessory];
      v70 = HMFBooleanToString();
      if ([v90 isWacNeeded] && (-[HMDHome networkRouterSupport](v55, "networkRouterSupport") & 8) != 0)
      {
        v97[0] = MEMORY[0x277D85DD0];
        v97[1] = 3221225472;
        v97[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke;
        v97[3] = &unk_279722450;
        v97[4] = v55;
        v98 = currentActivity;
        v99 = v93;
        v100 = v92;
        v101 = messageCopy;
        v102 = v46;
        v103 = v94;
        [(HMDHome *)v55 _createUniquePSKClientConfigurationWithRequestMessage:v101 pairingEvent:v100 completion:v97];
      }

      else
      {
        [currentActivity begin];
        *buf = currentActivity;
        [(HMDHome *)v55 _pairAccessoryWithAccessoryDescription:v93 unpairedAccessory:v94 configuration:v46 pairingEvent:v92 requestMessage:messageCopy];
        __HMFActivityScopeLeave();
      }
    }

    else
    {
      responseHandler2 = responseHandler2;
      messageCopy = messageCopy;
      if (selfCopy)
      {
        objc_initWeak(&location, selfCopy);
        v26 = responseHandler2;
        objc_opt_class();
        v27 = objc_opt_isKindOfClass();
        if (v27)
        {
          v28 = v26;
        }

        else
        {
          v28 = 0;
        }

        v29 = v28;

        if (v27)
        {
          v30 = objc_autoreleasePoolPush();
          v31 = selfCopy;
          v32 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT))
          {
            v33 = HMFGetLogIdentifier();
            *buf = 138543618;
            *&buf[4] = v33;
            *&buf[12] = 2112;
            *&buf[14] = v29;
            _os_log_impl(&dword_2531F8000, v32, OS_LOG_TYPE_DEFAULT, "%{public}@Starting WAC for %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v30);
          *buf = MEMORY[0x277D85DD0];
          *&buf[8] = 3221225472;
          *&buf[16] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke;
          v111 = &unk_2797224A0;
          objc_copyWeak(&v112[16], &location);
          *v112 = messageCopy;
          *&v112[8] = v29;
          [*&v112[8] startConfigurationWithCompletionHandler:buf];

          objc_destroyWeak(&v112[16]);
        }

        else
        {
          v41 = v26;
          objc_opt_class();
          v42 = objc_opt_isKindOfClass();
          if (v42)
          {
            v43 = v41;
          }

          else
          {
            v43 = 0;
          }

          v44 = v43;

          if (v42)
          {
            [(HMDHome *)selfCopy _addAndMaybeAssociateMediaAccessory:v44 message:messageCopy];
          }

          else
          {
            v84 = objc_autoreleasePoolPush();
            v85 = selfCopy;
            v86 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_DEFAULT))
            {
              v87 = HMFGetLogIdentifier();
              *buf = 138543618;
              *&buf[4] = v87;
              *&buf[12] = 2112;
              *&buf[14] = v41;
              _os_log_impl(&dword_2531F8000, v86, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to add unknown unassociated accessory: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v84);
            v88 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
            [messageCopy respondWithError:v88];
          }
        }

        objc_destroyWeak(&location);
      }
    }

    goto LABEL_61;
  }

  v71 = objc_autoreleasePoolPush();
  v72 = selfCopy;
  v73 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v73, OS_LOG_TYPE_DEFAULT))
  {
    v74 = HMFGetLogIdentifier();
    uUIDString2 = [dCopy UUIDString];
    *buf = 138543618;
    *&buf[4] = v74;
    *&buf[12] = 2112;
    *&buf[14] = uUIDString2;
    _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_DEFAULT, "%{public}@Unknown accessory with identifier: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v71);
  v76 = objc_autoreleasePoolPush();
  v77 = v72;
  v78 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v78, OS_LOG_TYPE_DEFAULT))
  {
    v79 = HMFGetLogIdentifier();
    accessoryBrowser2 = [(HMDHome *)v77 accessoryBrowser];
    accessoryBrowser3 = [(HMDHome *)v77 accessoryBrowser];
    unassociatedAccessories2 = [accessoryBrowser3 unassociatedAccessories];
    *buf = 138543874;
    *&buf[4] = v79;
    *&buf[12] = 2112;
    *&buf[14] = accessoryBrowser2;
    *&buf[22] = 2112;
    v111 = unassociatedAccessories2;
    _os_log_impl(&dword_2531F8000, v78, OS_LOG_TYPE_DEFAULT, "%{public}@AccessoryBrowser %@, Unassociated accessories: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v76);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    responseHandler2 = [messageCopy responseHandler];
    v94 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(responseHandler2 + 2))(responseHandler2, v94, 0);
LABEL_61:
  }

  v89 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2;
  block[3] = &unk_279722428;
  v11 = a1[5];
  v12 = a1[6];
  v13 = v6;
  v14 = a1[4];
  v15 = a1[7];
  v16 = a1[8];
  v17 = a1[9];
  v18 = v5;
  v19 = a1[10];
  v8 = v5;
  v9 = v6;
  dispatch_async(v7, block);
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v35 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (!WeakRetained)
  {
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
LABEL_7:
    v16 = [v14 hmErrorWithCode:v15];
    [v13 respondWithError:v16];
    goto LABEL_8;
  }

  if (v5)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v12 = *(a1 + 40);
      *buf = 138543618;
      v32 = v11;
      v33 = 2112;
      v34 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@WAC failed for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = *(a1 + 32);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 48;
    goto LABEL_7;
  }

  v18 = v6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v19 = v18;
  }

  else
  {
    v19 = 0;
  }

  v16 = v19;

  if (v16)
  {
    v20 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1245;
    block[3] = &unk_279734960;
    block[4] = WeakRetained;
    v29 = v16;
    v30 = *(a1 + 32);
    dispatch_async(v20, block);
  }

  else
  {
    v21 = objc_autoreleasePoolPush();
    v22 = WeakRetained;
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v24;
      v33 = 2112;
      v34 = objc_opt_class();
      v25 = v34;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Post-WAC not supported for type %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v21);
    v26 = *(a1 + 32);
    v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [v26 respondWithError:v27];
  }

LABEL_8:

  v17 = *MEMORY[0x277D85DE8];
}

- (void)_addAndMaybeAssociateMediaAccessory:(void *)accessory message:
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  accessoryCopy = accessory;
  if (self)
  {
    if ([self isOwnerUser])
    {
      homeManager = [self homeManager];
      uuid = [v5 uuid];
      v9 = [homeManager accessorySetupMetricDispatcherForAccessoryUUID:uuid];

      [v9 addHome:self];
      if ([v5 conformsToProtocol:&unk_286687F08] && objc_msgSend(v5, "supportsAssociation"))
      {
        objc_initWeak(&location, self);
        v10 = objc_autoreleasePoolPush();
        selfCopy = self;
        v12 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = HMFGetLogIdentifier();
          *buf = 138543618;
          v25 = v13;
          v26 = 2112;
          v27 = v5;
          _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Starting association for media accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v10);
        v19[0] = MEMORY[0x277D85DD0];
        v19[1] = 3221225472;
        v19[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke;
        v19[3] = &unk_279731988;
        objc_copyWeak(&v22, &location);
        v20 = v5;
        v21 = accessoryCopy;
        [v20 associateToHome:selfCopy completionHandler:v19];

        objc_destroyWeak(&v22);
        objc_destroyWeak(&location);
      }

      else
      {
        [self _addMediaAccessory:v5 message:accessoryCopy];
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v25 = v17;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_DEFAULT, "%{public}@Must be owner to add WHA accessory", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v14);
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [accessoryCopy respondWithError:v9];
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke(id *a1, void *a2)
{
  v25 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v5 = WeakRetained;
  if (v3)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = HMFGetLogIdentifier();
      v10 = a1[4];
      *buf = 138543874;
      v20 = v9;
      v21 = 2112;
      v22 = v10;
      v23 = 2112;
      v24 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to add accessory, %@, with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v6);
    [a1[5] respondWithError:v3];
  }

  else if (WeakRetained)
  {
    v11 = [WeakRetained workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1290;
    block[3] = &unk_279732670;
    objc_copyWeak(&v18, a1 + 6);
    v16 = a1[5];
    v17 = a1[4];
    dispatch_async(v11, block);

    objc_destroyWeak(&v18);
  }

  else
  {
    v12 = a1[5];
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v12 respondWithError:v13];
  }

  v14 = *MEMORY[0x277D85DE8];
}

void __55__HMDHome__addAndMaybeAssociateMediaAccessory_message___block_invoke_1290(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v5 = WeakRetained;
  if (WeakRetained)
  {
    [WeakRetained _addMediaAccessory:*(a1 + 40) message:*(a1 + 32)];
  }

  else
  {
    v3 = *(a1 + 32);
    v4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [v3 respondWithError:v4];
  }
}

void __49__HMDHome__addAndMaybeWACMediaAccessory_message___block_invoke_1245(id *a1)
{
  v9 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = a1[4];
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v7 = 138543362;
    v8 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Continuing to add accessory post-WAC", &v7, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  [(HMDHome *)a1[4] _addAndMaybeAssociateMediaAccessory:a1[6] message:?];
  v6 = *MEMORY[0x277D85DE8];
}

void __93__HMDHome__continuePairingAfterUserConsentWithAccessoryUUID_orUnassociatedAccessory_message___block_invoke_2(uint64_t a1)
{
  v20 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 40);
  v3 = *(a1 + 32);
  [v2 accessoryUUID];

  [*(a1 + 48) domain];
  [*(a1 + 48) code];

  v4 = *(a1 + 48) == 0;
  v5 = objc_autoreleasePoolPush();
  v6 = *(a1 + 56);
  v7 = HMFGetOSLogHandle();
  v8 = v7;
  if (v4)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      *v15 = 138543362;
      *&v15[4] = v13;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Client configuration with WiFi unique PSK created successfully", v15, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [*(a1 + 80) setNetworkCredential:*(a1 + 88)];
    [*(a1 + 64) setUsedWiFiPPSK:1];
    [*(a1 + 32) begin];
    *v15 = *(a1 + 32);
    [*(a1 + 56) _pairAccessoryWithAccessoryDescription:*(a1 + 40) unpairedAccessory:*(a1 + 96) configuration:*(a1 + 80) pairingEvent:*(a1 + 64) requestMessage:*(a1 + 72)];
    __HMFActivityScopeLeave();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      v10 = *(a1 + 40);
      v11 = *(a1 + 48);
      *v15 = 138543874;
      *&v15[4] = v9;
      v16 = 2112;
      v17 = v10;
      v18 = 2112;
      v19 = v11;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Failed to generate WiFi credential for accessory %@ with error: %@", v15, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    v12 = [*(a1 + 56) logEventSubmitter];
    [v12 submitLogEvent:*(a1 + 64) error:*(a1 + 48)];

    [*(a1 + 72) respondWithError:*(a1 + 48)];
    [*(a1 + 56) _removePendingAccessoryAdd:*(a1 + 40)];
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_continueLegacyAddAccessoryWithUUID:(id)d unassociatedAccessory:(id)accessory setupCode:(id)code appID:(id)iD message:(id)message
{
  v83 = *MEMORY[0x277D85DE8];
  dCopy = d;
  accessoryCopy = accessory;
  codeCopy = code;
  iDCopy = iD;
  messageCopy = message;
  v17 = [(HMDHome *)self accessoryWithUUID:dCopy];
  if (v17)
  {
    v18 = objc_autoreleasePoolPush();
    selfCopy = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = HMFGetLogIdentifier();
      *buf = 138543874;
      v78 = v21;
      v79 = 2112;
      v80 = dCopy;
      v81 = 2112;
      v82 = v17;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: this home already has an accessory with UUID %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v18);
    if (_os_feature_enabled_impl() && [messageCopy isEntitledForSPIAccess] && objc_msgSend(messageCopy, "isEntitledToProvideAccessorySetupPayload"))
    {
      v22 = objc_autoreleasePoolPush();
      v23 = selfCopy;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
      {
        v25 = HMFGetLogIdentifier();
        *buf = 138543362;
        v78 = v25;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_DEFAULT, "%{public}@Creating temporary progress handler to invoke with already-associated error", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v22);
      v26 = objc_alloc(MEMORY[0x277CD1DE8]);
      uuid = [(HMDHome *)v23 uuid];
      v28 = [v26 initWithAccessoryUUID:dCopy accessoryName:0 appID:iDCopy homeUUID:uuid];

      v29 = HMDHomeCreateAddAccessoryProgressHandler(v23, v28, messageCopy);
      v30 = [[HMDAddAccessoryProgressState alloc] initWithPairedAccessory:v17];
      (v29)[2](v29, 47, v30);
    }

    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:13];
    [messageCopy respondWithError:v31];
    goto LABEL_47;
  }

  accessories = [(HMDHome *)self accessories];
  v33 = [accessories count];
  v34 = maximumAccessoriesPerHome;

  if (v33 >= v34)
  {
    v39 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v41 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      v42 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v42;
      _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_ERROR, "%{public}@Can't add unassociated accessory: already at maximum accessories for home", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v39);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    [messageCopy respondWithError:v31];
  }

  else if (([accessoryCopy associationOptions] & 2) != 0)
  {
    v43 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v45 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543362;
      v78 = v46;
      _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Can't add unassociated accessory: software update needed on the accessory", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v43);
    v31 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    [messageCopy respondWithError:v31];
  }

  else
  {
    category = [accessoryCopy category];
    v76 = 0;
    context = [(HMDHome *)self _shouldAllowAddingAccessoryOfCategory:category requestMessage:messageCopy error:&v76];
    v31 = v76;

    if (context)
    {
LABEL_14:
      v70 = accessoryCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v36 = v70;
      }

      else
      {
        v36 = 0;
      }

      v67 = v36;

      if (v67)
      {
        v37 = objc_alloc(MEMORY[0x277CD1DE8]);
        uuid2 = [(HMDHome *)self uuid];
        v68 = [v37 initWithAccessoryUUID:dCopy accessoryName:0 appID:iDCopy homeUUID:uuid2];

        [v68 setSetupCode:codeCopy];
        os_unfair_recursive_lock_lock_with_options();
        [(NSMapTable *)self->_addPendingAccessories setObject:messageCopy forKey:v68];
        os_unfair_recursive_lock_unlock();
      }

      else
      {
        v68 = 0;
      }

      if ([messageCopy isEntitledForSPIAccess] && objc_msgSend(messageCopy, "isEntitledToProvideAccessorySetupPayload"))
      {
        v66 = objc_autoreleasePoolPush();
        selfCopy4 = self;
        v53 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
        {
          v54 = HMFGetLogIdentifier();
          *buf = 138543362;
          v65 = v54;
          v78 = v54;
          _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_DEBUG, "%{public}@Registering Progress Handler", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v66);
        v55 = HMDHomeCreateAddAccessoryProgressHandler(selfCopy4, v68, messageCopy);
        v56 = selfCopy4;
        v57 = v55;
        accessoryBrowser = [(HMDHome *)v56 accessoryBrowser];
        [accessoryBrowser registerProgressHandler:v57 unpairedAccessoryUUID:dCopy];
      }

      else
      {
        v57 = 0;
      }

      if (context)
      {
        [(HMDHome *)self _continuePairingAfterUserConsentWithAccessoryUUID:dCopy orUnassociatedAccessory:v70 message:messageCopy];
      }

      else if (v57)
      {
        v59 = [[HMDAddAccessoryProgressState alloc] initWithUnpairedAccessory:v67 server:0];
        (v57)[2](v57, 9, v59);
      }

      else
      {
        contextb = objc_autoreleasePoolPush();
        selfCopy5 = self;
        v61 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_INFO))
        {
          v62 = HMFGetLogIdentifier();
          *buf = 138543362;
          v72 = v62;
          v78 = v62;
          _os_log_impl(&dword_2531F8000, v61, OS_LOG_TYPE_INFO, "%{public}@No progress handler but need to request user consent to replace accessory in home", buf, 0xCu);
        }

        objc_autoreleasePoolPop(contextb);
        v63 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
        [messageCopy respondWithError:v63];
      }

      goto LABEL_47;
    }

    domain = [v31 domain];
    if ([domain isEqualToString:*MEMORY[0x277CCFD28]])
    {
      v48 = [v31 code] == 97;

      if (v48)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }

    contexta = objc_autoreleasePoolPush();
    selfCopy6 = self;
    v50 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      category2 = [accessoryCopy category];
      localizedDescription = [category2 localizedDescription];
      *buf = 138543874;
      v78 = v69;
      v79 = 2112;
      v80 = localizedDescription;
      v81 = 2112;
      v82 = v31;
      _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_ERROR, "%{public}@Can't add an accessory of category %@: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(contexta);
    [messageCopy respondWithError:v31];
  }

LABEL_47:

  v64 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldUseDeprecatedAddAccessoryMessage:(id)message minimumVersion:(id)version primaryResident:(id)resident shouldRelayMessages:(BOOL)messages
{
  versionCopy = version;
  device = [resident device];
  version = [device version];

  LOBYTE(v12) = 0;
  if (versionCopy && resident)
  {
    v12 = [version isAtLeastVersion:versionCopy] ^ 1;
  }

  v13 = v12 & messages;
  if (message)
  {
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)_handleLegacyAddAccessory:(id)accessory
{
  v43 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v37 = 138543362;
    v38 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Handling legacy add accessory", &v37, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [accessoryCopy uuidForKey:*MEMORY[0x277CCF0B0]];
  if (v9)
  {
    v10 = [accessoryCopy stringForKey:*MEMORY[0x277CD1FD8]];
    if (v10 && ([accessoryCopy isEntitledForSPIAccess] & 1) == 0)
    {
      v29 = objc_autoreleasePoolPush();
      v30 = selfCopy;
      v31 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = HMFGetLogIdentifier();
        v37 = 138543362;
        v38 = v32;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Client provided a setup code but does not have entitlement to use SPI", &v37, 0xCu);
      }

      objc_autoreleasePoolPop(v29);
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
      [accessoryCopy respondWithError:v13];
    }

    else
    {
      accessoryBrowser = [(HMDHome *)selfCopy accessoryBrowser];
      unassociatedAccessories = [accessoryBrowser unassociatedAccessories];
      v13 = [unassociatedAccessories hmf_firstObjectWithUUID:v9];

      v14 = objc_autoreleasePoolPush();
      v15 = selfCopy;
      v16 = HMFGetOSLogHandle();
      v17 = v16;
      if (v13)
      {
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          v18 = HMFGetLogIdentifier();
          v37 = 138543618;
          v38 = v18;
          v39 = 2112;
          v40 = v13;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Found matching unassociated accessory: %@", &v37, 0x16u);
        }

        objc_autoreleasePoolPop(v14);
        v19 = objc_autoreleasePoolPush();
        v20 = v15;
        v21 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v22 = HMFGetLogIdentifier();
          v37 = 138543618;
          v38 = v22;
          v39 = 2112;
          v40 = v13;
          _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@Continuing legacy add for unassociated accessory: %@", &v37, 0x16u);
        }

        objc_autoreleasePoolPop(v19);
        clientIdentifier = [accessoryCopy clientIdentifier];
        [(HMDHome *)v20 _continueLegacyAddAccessoryWithUUID:v9 unassociatedAccessory:v13 setupCode:v10 appID:clientIdentifier message:accessoryCopy];
      }

      else
      {
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v33 = HMFGetLogIdentifier();
          accessoryBrowser2 = [(HMDHome *)v15 accessoryBrowser];
          unassociatedAccessories2 = [accessoryBrowser2 unassociatedAccessories];
          v37 = 138543874;
          v38 = v33;
          v39 = 2112;
          v40 = v9;
          v41 = 2112;
          v42 = unassociatedAccessories2;
          _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Could not find unassociated accessory with UUID %@ for legacy add accessory flow. All unassociated accessories: %@", &v37, 0x20u);
        }

        objc_autoreleasePoolPop(v14);
        clientIdentifier = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
        [accessoryCopy respondWithError:clientIdentifier];
      }
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    v25 = selfCopy;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      v37 = 138543618;
      v38 = v27;
      v39 = 2112;
      v40 = shortDescription;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Legacy add accessory message is missing accessory uuid: %@", &v37, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:20];
    [accessoryCopy respondWithError:v10];
  }

  v36 = *MEMORY[0x277D85DE8];
}

- (BOOL)_shouldAllowAddingAccessoryWithDescription:(id)description requestMessage:(id)message error:(id *)error
{
  messageCopy = message;
  v9 = MEMORY[0x277CD1680];
  descriptionCopy = description;
  setupAccessoryPayload = [descriptionCopy setupAccessoryPayload];
  categoryNumber = [setupAccessoryPayload categoryNumber];
  v13 = [v9 categoryWithCategoryIdentifier:categoryNumber];

  category = [descriptionCopy category];

  if ([category isWiFiRouterAccessoryCategory])
  {
  }

  else
  {
    isWiFiRouterAccessoryCategory = [v13 isWiFiRouterAccessoryCategory];

    if ((isWiFiRouterAccessoryCategory & 1) == 0)
    {
      v16 = 1;
      goto LABEL_6;
    }
  }

  v16 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:messageCopy error:error];
LABEL_6:

  return v16;
}

- (BOOL)_shouldAllowAddingAccessoryOfCategory:(id)category requestMessage:(id)message error:(id *)error
{
  messageCopy = message;
  if ([category isWiFiRouterAccessoryCategory])
  {
    v9 = [(HMDHome *)self __shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:messageCopy error:error];
  }

  else
  {
    v9 = 1;
  }

  return v9;
}

- (id)_setupDescriptionFromData:(id)data error:(id *)error
{
  v35 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  v7 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:dataCopy error:error];
  v8 = v7;
  if (v7)
  {
    addRequestIdentifier = [v7 addRequestIdentifier];
    v30 = 0u;
    v31 = 0u;
    v32 = 0u;
    v33 = 0u;
    addPendingAccessories = [(HMDHome *)self addPendingAccessories];
    hm_allKeys = [addPendingAccessories hm_allKeys];

    obj = hm_allKeys;
    v26 = [hm_allKeys countByEnumeratingWithState:&v30 objects:v34 count:16];
    if (v26)
    {
      v27 = *v31;
      v24 = dataCopy;
      while (2)
      {
        for (i = 0; i != v26; ++i)
        {
          if (*v31 != v27)
          {
            objc_enumerationMutation(obj);
          }

          v12 = *(*(&v30 + 1) + 8 * i);
          setupAccessoryPayload = [v12 setupAccessoryPayload];
          setupID = [setupAccessoryPayload setupID];
          setupAccessoryPayload2 = [v8 setupAccessoryPayload];
          setupID2 = [setupAccessoryPayload2 setupID];
          if ([setupID isEqual:setupID2])
          {
            goto LABEL_15;
          }

          accessoryUUID = [v12 accessoryUUID];
          accessoryUUID2 = [v8 accessoryUUID];
          if ([accessoryUUID isEqual:accessoryUUID2])
          {

LABEL_15:
LABEL_16:
            cancellationReason = [v8 cancellationReason];
            [v12 setCancellationReason:cancellationReason];

            v20 = v12;
            dataCopy = v24;
            goto LABEL_17;
          }

          addRequestIdentifier2 = [v12 addRequestIdentifier];
          v29 = [addRequestIdentifier2 isEqual:addRequestIdentifier];

          if (v29)
          {
            goto LABEL_16;
          }
        }

        dataCopy = v24;
        v26 = [obj countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v26)
        {
          continue;
        }

        break;
      }
    }

    v20 = v8;
LABEL_17:
  }

  else
  {
    v20 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v20;
}

- (BOOL)__shouldAllowAddingWiFiRouterAccessoryWithRequestMessage:(id)message error:(id *)error
{
  v25 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  if (![(HMDHome *)self checkForNetworkRouterSupport:4 error:error])
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMDNetworkRouterSupportAsString([(HMDHome *)selfCopy networkRouterSupport]);
      v15 = v14;
      if (error)
      {
        v16 = *error;
      }

      else
      {
        v16 = 0;
      }

      v19 = 138543874;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      v23 = 2112;
      v24 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot add network router to the home - networkRouterSupport %@ error %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    goto LABEL_12;
  }

  wiFiRouterAccessories = [(HMDHome *)self wiFiRouterAccessories];
  v8 = [wiFiRouterAccessories count];

  if (!v8)
  {
    v9 = 1;
    goto LABEL_13;
  }

  if (!error)
  {
LABEL_12:
    v9 = 0;
    goto LABEL_13;
  }

  [MEMORY[0x277CCA9B8] hmErrorWithCode:97];
  *error = v9 = 0;
LABEL_13:

  v17 = *MEMORY[0x277D85DE8];
  return v9;
}

- (void)performLocalAddAccessoryWithDescription:(id)description progressHandlerDelegate:(id)delegate completion:(id)completion
{
  v30 = *MEMORY[0x277D85DE8];
  descriptionCopy = description;
  delegateCopy = delegate;
  completionCopy = completion;
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsAddingAccessory = [localCapabilitiesDataSource supportsAddingAccessory];

  if (supportsAddingAccessory)
  {
    currentAccessory = [(HMDHome *)self currentAccessory];
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    v17 = v16;
    if (currentAccessory)
    {
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v18 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v18;
        v28 = 2112;
        v29 = descriptionCopy;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Performing local add accessory with setup description %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      v19 = [MEMORY[0x277D0F848] internalMessageWithName:*MEMORY[0x277CD2070] messagePayload:0];
      [v19 setQualityOfService:25];
      objc_initWeak(buf, selfCopy);
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke;
      v23[3] = &unk_2797355F8;
      objc_copyWeak(&v25, buf);
      v24 = completionCopy;
      [v19 setResponseHandler:v23];
      [(HMDHome *)&selfCopy->super.super.isa _handleAddAccessoryWithDescription:descriptionCopy progressHandlerDelegate:delegateCopy message:v19];

      objc_destroyWeak(&v25);
      objc_destroyWeak(buf);
    }

    else
    {
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        *buf = 138543618;
        v27 = v21;
        v28 = 2112;
        v29 = descriptionCopy;
        _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Will not perform local add accessory with setup description %@ without current accessory present", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v14);
      if (!completionCopy)
      {
        goto LABEL_13;
      }

      v19 = [MEMORY[0x277CCA9B8] hmPrivateErrorWithCode:2020];
      (*(completionCopy + 2))(completionCopy, v19);
    }

LABEL_13:
    goto LABEL_14;
  }

  if (completionCopy)
  {
    v20 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(completionCopy + 2))(completionCopy, v20);
  }

LABEL_14:

  v22 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_performLocalAddAccessoryWithDescription_progressHandlerDelegate_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    if (v5)
    {
      v12 = [MEMORY[0x277CCACA8] stringWithFormat:@"failed with error: %@", v5];
    }

    else
    {
      v12 = @"completed";
    }

    *buf = 138543618;
    v16 = v11;
    v17 = 2112;
    v18 = v12;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Perform local add accessory %@", buf, 0x16u);
    if (v5)
    {
    }
  }

  objc_autoreleasePoolPop(v8);
  v13 = *(a1 + 32);
  if (v13)
  {
    (*(v13 + 16))(v13, v5);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddAccessory:(id)accessory
{
  accessoryCopy = accessory;
  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  supportsAddingAccessory = [localCapabilitiesDataSource supportsAddingAccessory];

  if (supportsAddingAccessory)
  {
    v6 = [accessoryCopy dataForKey:*MEMORY[0x277CD1F90]];

    if (v6)
    {
      [(HMDHome *)self _handleAddAccessoryWithDescription:accessoryCopy];
    }

    else
    {
      [(HMDHome *)self _handleLegacyAddAccessory:accessoryCopy];
    }
  }

  else
  {
    responseHandler = [accessoryCopy responseHandler];

    if (responseHandler)
    {
      responseHandler2 = [accessoryCopy responseHandler];
      v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
      (responseHandler2)[2](responseHandler2, v9, 0);
    }
  }
}

- (BOOL)_removeAccessory:(id)accessory
{
  v24 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  uuid = [accessoryCopy uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKeyedSubscript:uuid];

  if (v7)
  {
    v8 = self->_accessories;
    uuid2 = [accessoryCopy uuid];
    [(NSMutableDictionary *)v8 setObject:0 forKeyedSubscript:uuid2];

    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      uuid3 = [accessoryCopy uuid];
      v20 = 138543618;
      v21 = v13;
      v22 = 2112;
      v23 = uuid3;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Successfully removed accessory from list: %@", &v20, 0x16u);
    }
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      shortDescription = [accessoryCopy shortDescription];
      v20 = 138543618;
      v21 = v16;
      v22 = 2112;
      v23 = shortDescription;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Asked to remove accessory that doesn't exist in list of accessories: %@", &v20, 0x16u);
    }
  }

  objc_autoreleasePoolPop(v10);
  os_unfair_recursive_lock_unlock();

  v18 = *MEMORY[0x277D85DE8];
  return v7 != 0;
}

- (void)removeAccessory:(id)accessory
{
  v29 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  if (accessoryCopy && [(HMDHome *)self _removeAccessory:accessoryCopy])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v8;
      v27 = 2112;
      v28 = accessoryCopy;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Removed accessory: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    if ([accessoryCopy isPrimary])
    {
      v9 = accessoryCopy;
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
      if (isKindOfClass)
      {
        v11 = v9;
      }

      else
      {
        v11 = 0;
      }

      v12 = v11;

      v13 = v9;
      objc_opt_class();
      v14 = objc_opt_isKindOfClass();
      if (v14)
      {
        v15 = v13;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      if (isKindOfClass)
      {
        workQueue = selfCopy->_workQueue;
        v23[0] = MEMORY[0x277D85DD0];
        v23[1] = 3221225472;
        v23[2] = __27__HMDHome_removeAccessory___block_invoke;
        v23[3] = &unk_2797359B0;
        v23[4] = selfCopy;
        v18 = &v24;
        v24 = v13;
        v19 = v23;
      }

      else
      {
        if ((v14 & 1) == 0)
        {
LABEL_17:

          goto LABEL_18;
        }

        workQueue = selfCopy->_workQueue;
        v21[0] = MEMORY[0x277D85DD0];
        v21[1] = 3221225472;
        v21[2] = __27__HMDHome_removeAccessory___block_invoke_2;
        v21[3] = &unk_2797359B0;
        v21[4] = selfCopy;
        v18 = &v22;
        v22 = v13;
        v19 = v21;
      }

      dispatch_async(workQueue, v19);

      goto LABEL_17;
    }
  }

LABEL_18:

  v20 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23 description:@"Retrieval cancelled reason:accessory removed" suggestion:{0, 0}];
  v3 = *(a1 + 32);
  v4 = [*(a1 + 40) identifier];
  [v3 _notifyRetrievalError:v2 accessoryServer:v4 linkType:0 accessoryOperationBlock:0];

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v5 = [*(a1 + 40) services];
  v6 = [v5 copy];

  v7 = [v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v13;
    do
    {
      v10 = 0;
      do
      {
        if (*v13 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [*(a1 + 32) _removeService:*(*(&v12 + 1) + 8 * v10++)];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v8);
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __27__HMDHome_removeAccessory___block_invoke_2(uint64_t a1)
{
  v3 = [*(a1 + 32) remoteEventRouterClientController];
  v2 = [*(a1 + 40) uuid];
  [v3 removeResidentRouterForAccessoryUUID:v2];
}

- (void)_addAccessories:(id)accessories
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __27__HMDHome__addAccessories___block_invoke;
  v3[3] = &unk_279733780;
  v3[4] = self;
  [accessories na_each:v3];
}

- (BOOL)_addAccessory:(id)accessory
{
  v21 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  os_unfair_recursive_lock_lock_with_options();
  accessories = self->_accessories;
  uuid = [accessoryCopy uuid];
  v7 = [(NSMutableDictionary *)accessories objectForKey:uuid];

  if (!v7)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      uuid2 = [accessoryCopy uuid];
      v17 = 138543618;
      v18 = v11;
      v19 = 2112;
      v20 = uuid2;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Added accessory to the home's list: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v13 = self->_accessories;
    uuid3 = [accessoryCopy uuid];
    [(NSMutableDictionary *)v13 setObject:accessoryCopy forKey:uuid3];
  }

  os_unfair_recursive_lock_unlock();

  v15 = *MEMORY[0x277D85DE8];
  return v7 == 0;
}

- (void)addAccessory:(id)accessory
{
  v29 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v5 = accessoryCopy;
  if (!accessoryCopy)
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v26 = v10;
      v11 = "%{public}@Attempting to add a nil accessory";
      v12 = v9;
      v13 = 12;
      goto LABEL_8;
    }

LABEL_9:

    objc_autoreleasePoolPop(v7);
    goto LABEL_11;
  }

  uuid = [accessoryCopy uuid];

  if (uuid)
  {
    if (![(HMDHome *)self _addAccessory:v5])
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v10 = HMFGetLogIdentifier();
        *buf = 138543618;
        v26 = v10;
        v27 = 2112;
        v28 = v5;
        v11 = "%{public}@Attempted to add an accessory that is already present: %@";
        v12 = v9;
        v13 = 22;
LABEL_8:
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, v11, buf, v13);

        goto LABEL_9;
      }

      goto LABEL_9;
    }
  }

  else
  {
    uuid2 = [v5 uuid];

    if (!uuid2)
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_FAULT))
      {
        v19 = HMFGetLogIdentifier();
        shortDescription = [v5 shortDescription];
        *buf = 138543618;
        v26 = v19;
        v27 = 2112;
        v28 = shortDescription;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: Attempted to add an accessory that does not have an uuid: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
      v21 = [HMDAssertionLogEvent alloc];
      shortDescription2 = [v5 shortDescription];
      v23 = [(HMDAssertionLogEvent *)v21 initWithReason:@"Attempted to add an accessory that does not have an uuid: %@", shortDescription2];

      v24 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v24 submitLogEvent:v23];
    }
  }

LABEL_11:

  v15 = *MEMORY[0x277D85DE8];
}

- (unint64_t)assistantAccessCapableAccessoryCount
{
  v15 = *MEMORY[0x277D85DE8];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v11;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(accessories);
        }

        v5 += [HMDAssistantAccessControl isAccessorySupported:*(*(&v10 + 1) + 8 * i)];
      }

      v4 = [accessories countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  v8 = *MEMORY[0x277D85DE8];
  return v5;
}

- (BOOL)shouldEncodeLegacyLocationServiceSettingForSettingsParentUUID:(id)d
{
  v20 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v5 = [(HMDHome *)self mediaSystemWithUUID:dCopy];
  v6 = v5;
  if (v5)
  {
    LODWORD(v7) = [v5 componentsSupportsHomeLevelLocationServiceSetting] ^ 1;
  }

  else
  {
    v8 = [(HMDHome *)self accessoryWithUUID:dCopy];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v10 = v9;

    if (v10)
    {
      LODWORD(v7) = [v10 supportsHomeLevelLocationServiceSetting] ^ 1;
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        v16 = 138543618;
        v17 = v13;
        v18 = 2112;
        v19 = dCopy;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to filter legacy location service setting due to no parent found with uuid: %@", &v16, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      LOBYTE(v7) = 0;
    }
  }

  v14 = *MEMORY[0x277D85DE8];
  return v7;
}

- (id)destinationControllerWithCommittedDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  destinationControllers = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke;
  v9[3] = &unk_2797223B0;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [destinationControllers na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __67__HMDHome_destinationControllerWithCommittedDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 committedData];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  destinationControllers = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke;
  v9[3] = &unk_2797223B0;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [destinationControllers na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __58__HMDHome_destinationControllerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 data];
  v4 = [v3 destinationIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationControllerWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  destinationControllers = [(HMDHome *)self destinationControllers];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __47__HMDHome_destinationControllerWithIdentifier___block_invoke;
  v9[3] = &unk_2797223B0;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [destinationControllers na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __47__HMDHome_destinationControllerWithIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 identifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)destinationControllers
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v3 = [appleMediaAccessories na_map:&__block_literal_global_1203];

  return v3;
}

- (int64_t)destinationTypeForDestinationWithIdentifier:(id)identifier
{
  v40 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  [(HMDHome *)self appleMediaAccessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v5 = v37 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    v9 = 3;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v11 = *(*(&v34 + 1) + 8 * i);
        uuid = [v11 uuid];
        v13 = [uuid hmf_isEqualToUUID:identifierCopy];

        if (v13)
        {
          v17 = v5;
          goto LABEL_26;
        }

        audioDestination = [v11 audioDestination];
        uniqueIdentifier = [audioDestination uniqueIdentifier];
        v16 = [uniqueIdentifier hmf_isEqualToUUID:identifierCopy];

        if (v16)
        {
          v17 = v5;
          v9 = 1;
          goto LABEL_26;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v30 = 0u;
  v31 = 0u;
  v32 = 0u;
  v17 = v33 = 0u;
  v18 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v31;
    while (2)
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v31 != v20)
        {
          objc_enumerationMutation(v17);
        }

        v22 = *(*(&v30 + 1) + 8 * j);
        uuid2 = [v22 uuid];
        v24 = [uuid2 hmf_isEqualToUUID:identifierCopy];

        if (v24)
        {
          v9 = 4;
          goto LABEL_25;
        }

        audioDestination2 = [v22 audioDestination];
        uniqueIdentifier2 = [audioDestination2 uniqueIdentifier];
        v27 = [uniqueIdentifier2 hmf_isEqualToUUID:identifierCopy];

        if (v27)
        {
          v9 = 2;
          goto LABEL_25;
        }
      }

      v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      v9 = 0;
      if (v19)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v9 = 0;
  }

LABEL_25:

LABEL_26:
  v28 = *MEMORY[0x277D85DE8];
  return v9;
}

- (id)mediaDestinationsInRoom:(id)room
{
  v45 = *MEMORY[0x277D85DE8];
  roomCopy = room;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v32 = appleMediaAccessories;
  v34 = [objc_alloc(MEMORY[0x277CBEB18]) initWithCapacity:{objc_msgSend(mediaSystems, "count") + objc_msgSend(appleMediaAccessories, "count")}];
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v7 = mediaSystems;
  v8 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v40;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v40 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v39 + 1) + 8 * i);
        audioDestination = [v12 audioDestination];
        if (audioDestination)
        {
          if (!roomCopy)
          {
            goto LABEL_9;
          }

          room = [v12 room];
          uuid = [room uuid];
          uuid2 = [roomCopy uuid];
          v17 = [uuid hmf_isEqualToUUID:uuid2];

          if (v17)
          {
LABEL_9:
            [v34 addObject:audioDestination];
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v39 objects:v44 count:16];
    }

    while (v9);
  }

  v33 = v7;

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  v18 = v32;
  v19 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v36;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v36 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v35 + 1) + 8 * j);
        audioDestination2 = [v23 audioDestination];
        if (audioDestination2)
        {
          if (!roomCopy)
          {
            if (_mediaSystemsContainsAccessory(v33, v23))
            {
              goto LABEL_25;
            }

LABEL_23:
            [v34 addObject:audioDestination2];
            goto LABEL_25;
          }

          room2 = [v23 room];
          uuid3 = [room2 uuid];
          uuid4 = [roomCopy uuid];
          if ([uuid3 hmf_isEqualToUUID:uuid4])
          {
            v28 = _mediaSystemsContainsAccessory(v33, v23);

            if ((v28 & 1) == 0)
            {
              goto LABEL_23;
            }
          }

          else
          {
          }
        }

LABEL_25:
      }

      v20 = [v18 countByEnumeratingWithState:&v35 objects:v43 count:16];
    }

    while (v20);
  }

  v29 = [v34 copy];
  v30 = *MEMORY[0x277D85DE8];

  return v29;
}

- (id)mediaDestinationManagersWithSupportedOptions:(unint64_t)options
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke;
  v15[3] = &__block_descriptor_40_e54____HMDMediaDestinationManager__16__0__HMDMediaSystem_8l;
  v15[4] = options;
  v7 = [mediaSystems na_map:v15];
  v12[0] = MEMORY[0x277D85DD0];
  v12[1] = 3221225472;
  v12[2] = __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2;
  v12[3] = &unk_279722368;
  v13 = mediaSystems;
  optionsCopy = options;
  v8 = mediaSystems;
  v9 = [appleMediaAccessories na_map:v12];
  v10 = [v9 arrayByAddingObjectsFromArray:v7];

  return v10;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationManager];
  v4 = [v3 destination];
  LODWORD(a1) = [v4 containsSupportedOptions:*(a1 + 32)];

  if (a1)
  {
    v5 = v3;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

id __56__HMDHome_mediaDestinationManagersWithSupportedOptions___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsSupportedOptions:*(a1 + 40)])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

- (id)mediaDestinationManagersWithHomeTheaterSupportedOptions
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v5 = [mediaSystems na_map:&__block_literal_global_1198];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2;
  v10[3] = &unk_279722320;
  v11 = mediaSystems;
  v6 = mediaSystems;
  v7 = [appleMediaAccessories na_map:v10];
  v8 = [v7 arrayByAddingObjectsFromArray:v5];

  return v8;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = [v4 destination];
  if ([v5 containsHomeTheaterSupportedOptions])
  {
    v6 = _mediaSystemsContainsAccessory(*(a1 + 32), v3);

    if ((v6 & 1) == 0)
    {
      v7 = v4;
      goto LABEL_6;
    }
  }

  else
  {
  }

  v7 = 0;
LABEL_6:

  return v7;
}

id __66__HMDHome_mediaDestinationManagersWithHomeTheaterSupportedOptions__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 audioDestinationManager];
  v3 = [v2 destination];
  v4 = [v3 containsHomeTheaterSupportedOptions];

  if (v4)
  {
    v5 = v2;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)destinationManagerPassingTest:(id)test
{
  v28 = *MEMORY[0x277D85DE8];
  testCopy = test;
  [(HMDHome *)self appleMediaAccessories];
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = v25 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v23;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v23 != v8)
        {
          objc_enumerationMutation(v5);
        }

        audioDestinationManager = [*(*(&v22 + 1) + 8 * i) audioDestinationManager];
        if (audioDestinationManager && (testCopy[2](testCopy, audioDestinationManager) & 1) != 0)
        {
          v11 = v5;
          goto LABEL_22;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v22 objects:v27 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  [(HMDHome *)self mediaSystems];
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v11 = v21 = 0u;
  v12 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v19;
LABEL_12:
    v15 = 0;
    while (1)
    {
      if (*v19 != v14)
      {
        objc_enumerationMutation(v11);
      }

      audioDestinationManager = [*(*(&v18 + 1) + 8 * v15) audioDestinationManager];
      if (audioDestinationManager)
      {
        if (testCopy[2](testCopy, audioDestinationManager))
        {
          break;
        }
      }

      if (v13 == ++v15)
      {
        v13 = [v11 countByEnumeratingWithState:&v18 objects:v26 count:16];
        if (v13)
        {
          goto LABEL_12;
        }

        goto LABEL_19;
      }
    }
  }

  else
  {
LABEL_19:
    audioDestinationManager = 0;
  }

LABEL_22:
  v16 = *MEMORY[0x277D85DE8];

  return audioDestinationManager;
}

- (id)destinationManagerWithDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke;
  v8[3] = &unk_27972A130;
  v9 = identifierCopy;
  v5 = identifierCopy;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __55__HMDHome_destinationManagerWithDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 uniqueIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)destinationManagerWithParentIdentifier:(id)identifier
{
  identifierCopy = identifier;
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke;
  v8[3] = &unk_27972A130;
  v9 = identifierCopy;
  v5 = identifierCopy;
  v6 = [(HMDHome *)self destinationManagerPassingTest:v8];

  return v6;
}

uint64_t __50__HMDHome_destinationManagerWithParentIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 destination];
  v4 = [v3 parentIdentifier];
  v5 = [v4 hmf_isEqualToUUID:*(a1 + 32)];

  return v5;
}

- (id)rootDestinationManagerWithDescendantDestinationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v10 = MEMORY[0x277D85DD0];
  v11 = 3221225472;
  v12 = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke;
  v13 = &unk_279723F68;
  selfCopy = self;
  v15 = identifierCopy;
  v6 = identifierCopy;
  v7 = [mediaSystems na_firstObjectPassingTest:&v10];
  audioDestinationManager = [v7 audioDestinationManager];

  return audioDestinationManager;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 components];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2;
  v7[3] = &unk_2797222D8;
  v4 = *(a1 + 40);
  v7[4] = *(a1 + 32);
  v8 = v4;
  v5 = [v3 na_any:v7];

  return v5;
}

uint64_t __69__HMDHome_rootDestinationManagerWithDescendantDestinationIdentifier___block_invoke_2(uint64_t a1, void *a2)
{
  v24 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v3 accessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    v8 = *(a1 + 40);
    v9 = [v7 audioDestination];
    v10 = [v9 uniqueIdentifier];
    v11 = [v8 hmf_isEqualToUUID:v10];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    v13 = *(a1 + 32);
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543874;
      v19 = v15;
      v20 = 2112;
      v21 = v3;
      v22 = 2112;
      v23 = v4;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to apple media accessory from component: %@ accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];
  return v11;
}

- (id)destinationManagersWithDestinationIdentifiers:(id)identifiers supportedOptions:(unint64_t)options
{
  identifiersCopy = identifiers;
  v7 = [(HMDHome *)self mediaDestinationManagersWithSupportedOptions:options];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke;
  v11[3] = &unk_27972A130;
  v12 = identifiersCopy;
  v8 = identifiersCopy;
  v9 = [v7 na_filter:v11];

  return v9;
}

uint64_t __74__HMDHome_destinationManagersWithDestinationIdentifiers_supportedOptions___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 identifier];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (id)targetAccessoriesWithDestinationIdentifiers:(id)identifiers
{
  v32 = *MEMORY[0x277D85DE8];
  identifiersCopy = identifiers;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  mediaSystems = [(HMDHome *)self mediaSystems];
  v24[0] = MEMORY[0x277D85DD0];
  v24[1] = 3221225472;
  v24[2] = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke;
  v24[3] = &unk_279722288;
  v7 = identifiersCopy;
  v25 = v7;
  v8 = [mediaSystems na_map:v24];
  v19 = MEMORY[0x277D85DD0];
  v20 = 3221225472;
  v21 = __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2;
  v22 = &unk_2797222B0;
  v9 = v7;
  v23 = v9;
  v10 = [appleMediaAccessories na_map:&v19];
  v11 = [v8 arrayByAddingObjectsFromArray:{v10, v19, v20, v21, v22}];
  v12 = [v11 count];
  if (v12 != [v9 count])
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v27 = v16;
      v28 = 2112;
      v29 = v9;
      v30 = 2112;
      v31 = v11;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get target accessories for destination identifiers: %@ targets: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = [v3 targetAccessory];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

id __55__HMDHome_targetAccessoriesWithDestinationIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 audioDestinationManager];
  v5 = *(a1 + 32);
  v6 = [v4 identifier];
  LODWORD(v5) = [v5 containsObject:v6];

  if (v5)
  {
    v7 = v3;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)audioDestinationControllerDataForDestination:(id)destination
{
  destinationCopy = destination;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke;
  v10[3] = &unk_279734F10;
  v11 = destinationCopy;
  v6 = destinationCopy;
  v7 = [appleMediaAccessories na_firstObjectPassingTest:v10];

  audioDestinationControllerData = [v7 audioDestinationControllerData];

  return audioDestinationControllerData;
}

uint64_t __56__HMDHome_audioDestinationControllerDataForDestination___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 audioDestinationControllerData];
  v4 = [v3 destinationIdentifier];
  v5 = [*(a1 + 32) uniqueIdentifier];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)mediaSystemForAppleMediaAccessory:(id)accessory
{
  v17 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v6 = [mediaSystems countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(mediaSystems);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if (_mediaSystemContainsAccessory(v9, accessoryCopy))
        {
          v6 = v9;
          goto LABEL_11;
        }
      }

      v6 = [mediaSystems countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v10 = *MEMORY[0x277D85DE8];

  return v6;
}

- (NSArray)appleMediaAccessories
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_map:&__block_literal_global_1191];

  return v3;
}

void *__32__HMDHome_appleMediaAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)_setAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  os_unfair_recursive_lock_lock_with_options();
  if (accessoriesCopy)
  {
    v4 = [accessoriesCopy na_dictionaryWithKeyGenerator:&__block_literal_global_1189];
    v5 = [v4 mutableCopy];
    accessories = self->_accessories;
    self->_accessories = v5;
  }

  else
  {
    [(NSMutableDictionary *)self->_accessories removeAllObjects];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)setAccessories:(id)accessories
{
  v29 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  [(HMDHome *)self _setAccessories:accessoriesCopy];
  v25 = 0u;
  v26 = 0u;
  v23 = 0u;
  v24 = 0u;
  v5 = accessoriesCopy;
  v6 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v24;
    do
    {
      v9 = 0;
      do
      {
        if (*v24 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v23 + 1) + 8 * v9);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = v10;
        }

        else
        {
          v11 = 0;
        }

        v12 = v11;

        if (v12)
        {
          v21 = 0u;
          v22 = 0u;
          v19 = 0u;
          v20 = 0u;
          serviceGroups = [(HMDHome *)self serviceGroups];
          v14 = [serviceGroups countByEnumeratingWithState:&v19 objects:v27 count:16];
          if (v14)
          {
            v15 = v14;
            v16 = *v20;
            do
            {
              v17 = 0;
              do
              {
                if (*v20 != v16)
                {
                  objc_enumerationMutation(serviceGroups);
                }

                [*(*(&v19 + 1) + 8 * v17++) fixupServicesForReplacementAccessory:v12];
              }

              while (v15 != v17);
              v15 = [serviceGroups countByEnumeratingWithState:&v19 objects:v27 count:16];
            }

            while (v15);
          }
        }

        ++v9;
      }

      while (v9 != v7);
      v7 = [v5 countByEnumeratingWithState:&v23 objects:v28 count:16];
    }

    while (v7);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (NSArray)accessories
{
  os_unfair_recursive_lock_lock_with_options();
  allValues = [(NSMutableDictionary *)self->_accessories allValues];
  os_unfair_recursive_lock_unlock();

  return allValues;
}

- (HMDAccessory)currentAccessory
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories na_firstObjectPassingTest:&__block_literal_global_1187];

  return v3;
}

uint64_t __27__HMDHome_currentAccessory__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 isCurrentAccessory];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)_handleRemoveZoneModel:(id)model message:(id)message
{
  v35[5] = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  uuid = [modelCopy uuid];
  v6 = [(HMDHome *)self zoneWithUUID:uuid];
  v7 = v6;
  if (v6)
  {
    name = [v6 name];
    v9 = [(HMDHome *)self removeName:name];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones removeObject:v7];
    os_unfair_recursive_lock_unlock();
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    v34[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)self uuid];
    uUIDString = [uuid2 UUIDString];
    v35[0] = uUIDString;
    v34[1] = *MEMORY[0x277CD27B0];
    name2 = [v7 name];
    v35[1] = name2;
    v34[2] = *MEMORY[0x277CD27B8];
    uuid3 = [v7 uuid];
    uUIDString2 = [uuid3 UUIDString];
    v35[2] = uUIDString2;
    v34[3] = *MEMORY[0x277CD15F0];
    spiClientIdentifier = [v7 spiClientIdentifier];
    uUIDString3 = [spiClientIdentifier UUIDString];
    v35[3] = uUIDString3;
    v34[4] = *MEMORY[0x277CD15E8];
    urlString = [v7 urlString];
    v35[4] = urlString;
    v25 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:5];

    logAndPostNotification(@"HMDZoneRemovedNotification", v7, v25);
    v18 = objc_autoreleasePoolPush();
    selfCopy = self;
    v20 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = HMFGetLogIdentifier();
      name3 = [v7 name];
      *buf = 138543618;
      v31 = v21;
      v32 = 2112;
      v33 = name3;
      _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Removed zone: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v18);
  }

  else
  {
    v23 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v23];
  }

  v24 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveZone:(id)zone
{
  zoneCopy = zone;
  v5 = [zoneCopy uuidForKey:*MEMORY[0x277CD27B8]];
  v6 = [(HMDHome *)self zoneWithUUID:v5];
  if (v6)
  {
    v7 = [HMDZoneModel alloc];
    uuid = [(HMDHome *)self uuid];
    v9 = [(HMDBackingStoreModelObject *)v7 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid];

    backingStore = [(HMDHome *)self backingStore];
    name = [zoneCopy name];
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [backingStore transaction:name options:v12];

    [v13 add:v9];
    v14[0] = MEMORY[0x277D85DD0];
    v14[1] = 3221225472;
    v14[2] = __29__HMDHome__handleRemoveZone___block_invoke;
    v14[3] = &unk_2797359D8;
    v15 = zoneCopy;
    [v13 run:v14];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [zoneCopy respondWithError:v9];
  }
}

- (void)_handleAddZoneModel:(id)model message:(id)message
{
  v35 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  name = [modelCopy name];
  hm_truncatedNameString = [name hm_truncatedNameString];

  uuid = [modelCopy uuid];
  if (hm_truncatedNameString && uuid)
  {
    v10 = [[HMDZone alloc] initWithName:hm_truncatedNameString uuid:uuid home:self];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)self->_zones addObject:v10];
    os_unfair_recursive_lock_unlock();
    msgDispatcher = [(HMDHome *)self msgDispatcher];
    workQueue = [(HMDHome *)self workQueue];
    [(HMDZone *)v10 configure:msgDispatcher queue:workQueue];

    [(HMDZone *)v10 updateZoneWithModel:modelCopy message:messageCopy error:0];
    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    roomUUIDs = [(HMDZone *)v10 roomUUIDs];
    v15 = [roomUUIDs count];

    if (v15)
    {
      [transactionResult markSaveToAssistant];
    }

    v29[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)self uuid];
    uUIDString = [uuid2 UUIDString];
    v18 = *MEMORY[0x277CD27B0];
    v30[0] = uUIDString;
    v30[1] = hm_truncatedNameString;
    v19 = *MEMORY[0x277CD27B8];
    v29[1] = v18;
    v29[2] = v19;
    uuid3 = [(HMDZone *)v10 uuid];
    uUIDString2 = [uuid3 UUIDString];
    v30[2] = uUIDString2;
    v22 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v30 forKeys:v29 count:3];

    logAndPostNotification(@"HMDZoneAddedNotification", v10, v22);
    [messageCopy respondWithPayload:0];
  }

  else
  {
    v23 = objc_autoreleasePoolPush();
    selfCopy = self;
    v25 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
    {
      v26 = HMFGetLogIdentifier();
      *buf = 138543618;
      v32 = v26;
      v33 = 2112;
      v34 = hm_truncatedNameString;
      _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v23);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:v10];
  }

  v27 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddZone:(id)zone
{
  v47 = *MEMORY[0x277D85DE8];
  zoneCopy = zone;
  v5 = [zoneCopy stringForKey:*MEMORY[0x277CD27B0]];
  v6 = [zoneCopy uuidForKey:*MEMORY[0x277CD0B10]];
  v7 = v6;
  if (v5)
  {
    v8 = v6 == 0;
  }

  else
  {
    v8 = 1;
  }

  if (!v8)
  {
    v11 = HMMaxLengthForNaming();
    if ([v5 length] > v11)
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        *buf = 138543362;
        v44 = v15;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v12);
      v9 = MEMORY[0x277CCA9B8];
      v10 = 46;
      goto LABEL_11;
    }

    v16 = [(HMDHome *)self zoneWithName:v5];
    if (v16)
    {
      v17 = MEMORY[0x277CCA9B8];
      v18 = 1;
    }

    else
    {
      zones = [(HMDHome *)self zones];
      v20 = [zones count];
      v21 = maximumZonesPerHome;

      if (v20 < v21)
      {
        v22 = [(HMDHome *)self addName:v5];
        if (!v22)
        {
          v32 = [HMDZoneModel alloc];
          uuid = [(HMDHome *)self uuid];
          v34 = [(HMDBackingStoreModelObject *)v32 initWithObjectChangeType:1 uuid:v7 parentUUID:uuid];

          [(HMDZoneModel *)v34 setName:v5];
          backingStore = [(HMDHome *)self backingStore];
          name = [zoneCopy name];
          v37 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
          v38 = [backingStore transaction:name options:v37];

          [v38 add:v34];
          v39[0] = MEMORY[0x277D85DD0];
          v39[1] = 3221225472;
          v39[2] = __26__HMDHome__handleAddZone___block_invoke;
          v39[3] = &unk_279734D88;
          v40 = zoneCopy;
          v41 = v7;
          v42 = v5;
          [v38 run:v39];

          goto LABEL_24;
        }

        v23 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v25 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
        {
          v26 = HMFGetLogIdentifier();
          *buf = 138543618;
          v44 = v26;
          v45 = 2112;
          v46 = v5;
          _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; invalid parameter", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v23);
LABEL_23:
        [zoneCopy respondWithError:v22];
LABEL_24:

        goto LABEL_25;
      }

      v27 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v29 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = HMFGetLogIdentifier();
        *buf = 138543618;
        v44 = v30;
        v45 = 2112;
        v46 = v5;
        _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_ERROR, "%{public}@Can't add zone %@; already at maximum zones for home", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v27);
      v17 = MEMORY[0x277CCA9B8];
      v18 = 49;
    }

    v22 = [v17 hmErrorWithCode:v18];
    goto LABEL_23;
  }

  v9 = MEMORY[0x277CCA9B8];
  v10 = 20;
LABEL_11:
  v16 = [v9 hmErrorWithCode:v10];
  [zoneCopy respondWithError:v16];
LABEL_25:

  v31 = *MEMORY[0x277D85DE8];
}

void __26__HMDHome__handleAddZone___block_invoke(uint64_t a1, uint64_t a2)
{
  v10[2] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v9[0] = *MEMORY[0x277CD27B8];
    v6 = [*(a1 + 40) UUIDString];
    v9[1] = *MEMORY[0x277CD27B0];
    v10[0] = v6;
    v10[1] = *(a1 + 48);
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v10 forKeys:v9 count:2];
    [v2 respondWithPayload:v7];

    v8 = *MEMORY[0x277D85DE8];
  }
}

- (void)test_addZones:(id)zones
{
  zonesCopy = zones;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_zones addObjectsFromArray:zonesCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)zones
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_zones copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleRemoveRoomModel:(id)model message:(id)message
{
  v67 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  v47 = modelCopy;
  uuid = [modelCopy uuid];
  v7 = [(HMDHome *)self roomWithUUID:uuid];
  v8 = v7;
  if (!v7)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [messageCopy respondWithError:v14];
    goto LABEL_6;
  }

  uuid2 = [v7 uuid];
  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid3 = [roomForEntireHome uuid];
  v12 = [uuid2 isEqual:uuid3];

  if (v12)
  {
    responseHandler = [messageCopy responseHandler];

    if (responseHandler)
    {
      v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:29];
      responseHandler2 = [messageCopy responseHandler];
      (responseHandler2)[2](responseHandler2, v14, 0);

LABEL_6:
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      name = [v8 name];
      *buf = 138543618;
      v64 = v18;
      v65 = 2112;
      v66 = name;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Remove room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v61[0] = *MEMORY[0x277CD0640];
    uuid4 = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid4 UUIDString];
    v62[0] = uUIDString;
    v61[1] = *MEMORY[0x277CD0D30];
    name2 = [v8 name];
    v62[1] = name2;
    v61[2] = *MEMORY[0x277CD0D40];
    uUIDString2 = [uuid UUIDString];
    v62[2] = uUIDString2;
    v61[3] = *MEMORY[0x277CD0D38];
    spiClientIdentifier = [v8 spiClientIdentifier];
    uUIDString3 = [spiClientIdentifier UUIDString];
    v62[3] = uUIDString3;
    v61[4] = *MEMORY[0x277CD0D28];
    urlString = [v8 urlString];
    v62[4] = urlString;
    v46 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v62 forKeys:v61 count:5];

    logAndPostNotification(@"HMDRoomRemovedNotification", v8, v46);
    v57 = 0u;
    v58 = 0u;
    v55 = 0u;
    v56 = 0u;
    zones = [(HMDHome *)selfCopy zones];
    v28 = [zones countByEnumeratingWithState:&v55 objects:v60 count:16];
    if (v28)
    {
      v29 = *v56;
      do
      {
        for (i = 0; i != v28; ++i)
        {
          if (*v56 != v29)
          {
            objc_enumerationMutation(zones);
          }

          [*(*(&v55 + 1) + 8 * i) removeRoom:v8];
        }

        v28 = [zones countByEnumeratingWithState:&v55 objects:v60 count:16];
      }

      while (v28);
    }

    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    accessories = [(HMDHome *)selfCopy accessories];
    v32 = [accessories countByEnumeratingWithState:&v51 objects:v59 count:16];
    if (v32)
    {
      v33 = *v52;
      do
      {
        for (j = 0; j != v32; ++j)
        {
          if (*v52 != v33)
          {
            objc_enumerationMutation(accessories);
          }

          v35 = *(*(&v51 + 1) + 8 * j);
          uuid5 = [v8 uuid];
          room = [v35 room];
          uuid6 = [room uuid];
          v39 = [uuid5 isEqual:uuid6];

          if (v39)
          {
            transactionResult = [messageCopy transactionResult];
            roomForEntireHome2 = [(HMDHome *)selfCopy roomForEntireHome];
            [v35 updateRoom:roomForEntireHome2 source:{objc_msgSend(transactionResult, "source")}];
          }
        }

        v32 = [accessories countByEnumeratingWithState:&v51 objects:v59 count:16];
      }

      while (v32);
    }

    name3 = [v8 name];
    v43 = [(HMDHome *)selfCopy removeName:name3];

    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)selfCopy->_rooms removeObject:v8];
    os_unfair_recursive_lock_unlock();
    transactionResult2 = [messageCopy transactionResult];
    [transactionResult2 markChanged];
    [transactionResult2 markSaveToAssistant];
    [messageCopy respondWithPayload:v46];
  }

  v45 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveRoom:(id)room
{
  v61 = *MEMORY[0x277D85DE8];
  roomCopy = room;
  v5 = [roomCopy uuidForKey:*MEMORY[0x277CD0D40]];
  if (!v5)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      messagePayload = [roomCopy messagePayload];
      *buf = 138543618;
      v58 = v19;
      v59 = 2112;
      v60 = messagePayload;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot find room UUID in remove room message payload: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 2;
    goto LABEL_9;
  }

  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid = [roomForEntireHome uuid];
  v8 = [v5 isEqual:uuid];

  if (v8)
  {
    v9 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v12 = HMFGetLogIdentifier();
      roomForEntireHome2 = [(HMDHome *)selfCopy2 roomForEntireHome];
      *buf = 138543618;
      v58 = v12;
      v59 = 2112;
      v60 = roomForEntireHome2;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle request to remove roomForEntireHome: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v14 = MEMORY[0x277CCA9B8];
    v15 = 29;
LABEL_9:
    v21 = [v14 hmErrorWithCode:v15];
    [roomCopy respondWithError:v21];
    goto LABEL_29;
  }

  v21 = [(HMDHome *)self roomWithUUID:v5];
  v22 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v23 = HMFGetOSLogHandle();
  v24 = v23;
  if (v21)
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v25 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v25;
      v59 = 2112;
      v60 = v21;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_INFO, "%{public}@Removing room: %@", buf, 0x16u);
    }

    v49 = v21;

    objc_autoreleasePoolPop(v22);
    v26 = [HMDRoomModel alloc];
    uuid2 = [(HMDHome *)selfCopy3 uuid];
    v28 = [(HMDBackingStoreModelObject *)v26 initWithObjectChangeType:3 uuid:v5 parentUUID:uuid2];

    backingStore = [(HMDHome *)selfCopy3 backingStore];
    [roomCopy name];
    v31 = v30 = roomCopy;
    v32 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v33 = [backingStore transaction:v31 options:v32];

    v48 = v28;
    v50 = v30;
    [v33 add:v28 withMessage:v30];
    v54 = 0u;
    v55 = 0u;
    v52 = 0u;
    v53 = 0u;
    accessories = [(HMDHome *)selfCopy3 accessories];
    v35 = [accessories countByEnumeratingWithState:&v52 objects:v56 count:16];
    if (v35)
    {
      v36 = v35;
      v37 = *v53;
      do
      {
        for (i = 0; i != v36; ++i)
        {
          if (*v53 != v37)
          {
            objc_enumerationMutation(accessories);
          }

          v39 = *(*(&v52 + 1) + 8 * i);
          room = [v39 room];
          uuid3 = [room uuid];
          v42 = [v5 isEqual:uuid3];

          if (v42)
          {
            roomForEntireHome3 = [(HMDHome *)selfCopy3 roomForEntireHome];
            v44 = [v39 modelWithUpdatedRoom:roomForEntireHome3];

            if (v44)
            {
              [v33 add:v44];
            }
          }
        }

        v36 = [accessories countByEnumeratingWithState:&v52 objects:v56 count:16];
      }

      while (v36);
    }

    [v33 run];
    v21 = v49;
    roomCopy = v50;
    v45 = v48;
  }

  else
  {
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v46 = HMFGetLogIdentifier();
      *buf = 138543618;
      v58 = v46;
      v59 = 2112;
      v60 = v5;
      _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find room to remove with UUID: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v45 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    [roomCopy respondWithError:v45];
  }

LABEL_29:
  v47 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoomModel:(id)model message:(id)message
{
  v40 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  name = [modelCopy name];
  uuid = [modelCopy uuid];
  if (name && uuid)
  {
    hm_truncatedNameString = [name hm_truncatedNameString];

    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v12;
      v38 = 2112;
      v39 = hm_truncatedNameString;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Add room: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    v13 = [[HMDRoom alloc] initWithName:hm_truncatedNameString uuid:uuid home:selfCopy];
    os_unfair_recursive_lock_lock_with_options();
    [(NSMutableArray *)selfCopy->_rooms addObject:v13];
    os_unfair_recursive_lock_unlock();
    msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
    workQueue = [(HMDHome *)selfCopy workQueue];
    [(HMDRoom *)v13 configure:msgDispatcher queue:workQueue];

    transactionResult = [messageCopy transactionResult];
    [transactionResult markChanged];
    [transactionResult markSaveToAssistant];
    v34[0] = *MEMORY[0x277CD0640];
    uuid2 = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid2 UUIDString];
    v19 = *MEMORY[0x277CD0D30];
    v35[0] = uUIDString;
    v35[1] = hm_truncatedNameString;
    v20 = *MEMORY[0x277CD0D40];
    v34[1] = v19;
    v34[2] = v20;
    uuid3 = [(HMDRoom *)v13 uuid];
    uUIDString2 = [uuid3 UUIDString];
    v35[2] = uUIDString2;
    v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v35 forKeys:v34 count:3];

    logAndPostNotification(@"HMDRoomAddedNotification", v13, v23);
    [messageCopy respondWithPayload:v23];
    if ([(HMDHome *)selfCopy isOwnerUser])
    {
      home = [(HMDHome *)selfCopy home];
      homeManager = [home homeManager];
      [homeManager updateCurrentUserEligibleForOwnerToAutoMigration];
    }

    name = hm_truncatedNameString;
    goto LABEL_12;
  }

  v26 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v28 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
  {
    v29 = HMFGetLogIdentifier();
    *buf = 138543618;
    v37 = v29;
    v38 = 2112;
    v39 = name;
    _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@; invalid parameter", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v26);
  responseHandler = [messageCopy responseHandler];

  if (responseHandler)
  {
    v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    transactionResult = [messageCopy responseHandler];
    (transactionResult)[2](transactionResult, v13, 0);
LABEL_12:
  }

  v31 = *MEMORY[0x277D85DE8];
}

- (void)_handleAddRoom:(id)room
{
  v41 = *MEMORY[0x277D85DE8];
  roomCopy = room;
  v5 = [roomCopy stringForKey:*MEMORY[0x277CD0D30]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    v12 = [(HMDHome *)self roomWithName:v5];
    if (v12)
    {
      v11 = v12;
      v13 = [MEMORY[0x277CCA9B8] hmErrorWithCode:1];
      [roomCopy respondWithError:v13];

      goto LABEL_17;
    }

    rooms = [(HMDHome *)self rooms];
    v15 = [rooms count];
    v16 = maximumRoomsPerHome;

    if (v15 >= v16)
    {
      v22 = objc_autoreleasePoolPush();
      selfCopy = self;
      v24 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        v25 = HMFGetLogIdentifier();
        v35 = 138543618;
        v36 = v25;
        v37 = 2112;
        v38 = v5;
        _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; already at maximum rooms for home", &v35, 0x16u);
      }

      objc_autoreleasePoolPop(v22);
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:49];
    }

    else
    {
      v17 = [(HMDHome *)self addName:v5];
      if (!v17)
      {
        v27 = [HMDRoomModel alloc];
        v28 = [roomCopy uuidForKey:*MEMORY[0x277CD0B10]];
        uuid = [(HMDHome *)self uuid];
        v30 = [(HMDBackingStoreModelObject *)v27 initWithObjectChangeType:1 uuid:v28 parentUUID:uuid];

        [(HMDRoomModel *)v30 setName:v5];
        backingStore = [(HMDHome *)self backingStore];
        name = [roomCopy name];
        v33 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
        v34 = [backingStore transaction:name options:v33];

        [v34 add:v30 withMessage:roomCopy];
        [v34 run];

        goto LABEL_16;
      }

      v18 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v20 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        v21 = HMFGetLogIdentifier();
        v35 = 138543874;
        v36 = v21;
        v37 = 2112;
        v38 = v5;
        v39 = 2112;
        v40 = v17;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_ERROR, "%{public}@Can't add room %@ to home; namespace error %@", &v35, 0x20u);
      }

      objc_autoreleasePoolPop(v18);
    }

    [roomCopy respondWithError:v17];
LABEL_16:

    v11 = 0;
    goto LABEL_17;
  }

  v7 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v35 = 138543362;
    v36 = v10;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", &v35, 0xCu);
  }

  objc_autoreleasePoolPop(v7);
  v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
  [roomCopy respondWithError:v11];
LABEL_17:

  v26 = *MEMORY[0x277D85DE8];
}

- (void)test_addRooms:(id)rooms
{
  roomsCopy = rooms;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_rooms addObjectsFromArray:roomsCopy];
  os_unfair_recursive_lock_unlock();
}

- (NSArray)rooms
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_rooms copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)_handleHomeDataRequest:(id)request
{
  v3 = MEMORY[0x277CCA9B8];
  requestCopy = request;
  v5 = [v3 hmErrorWithCode:48];
  [requestCopy respondWithError:v5];
}

- (id)_handleRenameHomeModel:(id)model message:(id)message
{
  v24[2] = *MEMORY[0x277D85DE8];
  messageCopy = message;
  name = [model name];
  hm_truncatedNameString = [name hm_truncatedNameString];

  if (hm_truncatedNameString && [hm_truncatedNameString length])
  {
    transactionResult = [messageCopy transactionResult];
    label = [transactionResult label];
    v11 = [label isEqualToString:*MEMORY[0x277CD2540]];

    if ((v11 & 1) == 0)
    {
      homeManager = [(HMDHome *)self homeManager];
      name2 = [(HMDHome *)self name];
      uuid = [homeManager uuid];
      v24[0] = uuid;
      uuid2 = [(HMDHome *)self uuid];
      v24[1] = uuid2;
      v16 = [MEMORY[0x277CBEA60] arrayWithObjects:v24 count:2];
      v17 = [homeManager replaceName:name2 withNewName:hm_truncatedNameString inNamespaces:v16];
    }

    [(HMDHome *)self setName:hm_truncatedNameString];
    v22 = @"HMDHomeNameNotificationKey";
    v23 = hm_truncatedNameString;
    v18 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v23 forKeys:&v22 count:1];
    logAndPostNotification(@"HMDHomeNameChangedNotification", self, v18);

    v19 = 0;
  }

  else
  {
    v19 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:20 userInfo:0];
  }

  v20 = *MEMORY[0x277D85DE8];

  return v19;
}

- (void)_handleRename:(id)rename
{
  v35 = *MEMORY[0x277D85DE8];
  renameCopy = rename;
  v5 = [renameCopy stringForKey:*MEMORY[0x277CD23D0]];
  v6 = HMMaxLengthForNaming();
  if ([v5 length] <= v6)
  {
    homeManager = [(HMDHome *)self homeManager];
    name = [(HMDHome *)self name];
    uuid = [homeManager uuid];
    v32[0] = uuid;
    uuid2 = [(HMDHome *)self uuid];
    v32[1] = uuid2;
    v15 = [MEMORY[0x277CBEA60] arrayWithObjects:v32 count:2];
    v16 = [homeManager replaceName:name withNewName:v5 inNamespaces:v15];

    if (v16)
    {
      if ([(HMDHomeModel *)v16 code]== 31)
      {
        v17 = MEMORY[0x277CCA9B8];
        v18 = *MEMORY[0x277CCFD28];
        userInfo = [(HMDHomeModel *)v16 userInfo];
        v20 = [v17 errorWithDomain:v18 code:32 userInfo:userInfo];

        v16 = v20;
      }

      [renameCopy respondWithError:v16];
    }

    else
    {
      v21 = [HMDHomeModel alloc];
      uuid3 = [(HMDHome *)self uuid];
      uuid4 = [homeManager uuid];
      v16 = [(HMDBackingStoreModelObject *)v21 initWithObjectChangeType:2 uuid:uuid3 parentUUID:uuid4];

      [(HMDHomeModel *)v16 setName:v5];
      backingStore = [(HMDHome *)self backingStore];
      name2 = [renameCopy name];
      v26 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
      v27 = [backingStore transaction:name2 options:v26];

      [v27 add:v16];
      v29[0] = MEMORY[0x277D85DD0];
      v29[1] = 3221225472;
      v29[2] = __25__HMDHome__handleRename___block_invoke;
      v29[3] = &unk_2797358C8;
      v30 = renameCopy;
      v31 = v5;
      [v27 run:v29];
    }
  }

  else
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_ERROR, "%{public}@New name is longer than the pre-defined max length", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    homeManager = [MEMORY[0x277CCA9B8] hmErrorWithCode:46];
    [renameCopy respondWithError:homeManager];
  }

  v28 = *MEMORY[0x277D85DE8];
}

void __25__HMDHome__handleRename___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v5 = *(a1 + 40);
    v8 = *MEMORY[0x277CD23D0];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (id)_unexpectedCharacteristicsFromCharacteristicNotifications:(id)notifications
{
  v88 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  notificationRegistrations = [(HMDHome *)self notificationRegistrations];
  v6 = [notificationRegistrations count];

  if (v6)
  {
    v7 = MEMORY[0x277CBEBF8];
    goto LABEL_37;
  }

  array = [MEMORY[0x277CBEB18] array];
  context = objc_autoreleasePoolPush();
  allKeys = [notificationsCopy allKeys];
  v76[0] = MEMORY[0x277D85DD0];
  v76[1] = 3221225472;
  v76[2] = __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke;
  v76[3] = &unk_279722260;
  v42 = notificationsCopy;
  v45 = notificationsCopy;
  v77 = v45;
  selfCopy = self;
  v40 = allKeys;
  v10 = [allKeys na_map:v76];
  v74 = 0;
  v75 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:v10 accessories:&v75 enableCharacteristicNotificationPayload:0 characteristicNotificationThresholdsPayload:&v74 disableCharacteristicNotificationPayload:0 enableMediaNotificationPayload:0 disableMediaNotificationPayload:?];
  v47 = v75;
  v46 = v74;
  v70 = 0u;
  v71 = 0u;
  v72 = 0u;
  v73 = 0u;
  obj = v10;
  v48 = [obj countByEnumeratingWithState:&v70 objects:v87 count:16];
  if (!v48)
  {
    goto LABEL_36;
  }

  v44 = *v71;
  selfCopy2 = self;
  v55 = array;
  do
  {
    v11 = 0;
    do
    {
      if (*v71 != v44)
      {
        objc_enumerationMutation(obj);
      }

      v49 = v11;
      v12 = *(*(&v70 + 1) + 8 * v11);
      uuid = [v12 uuid];
      uUIDString = [uuid UUIDString];

      v52 = [v45 hmf_dictionaryForKey:uUIDString];
      v61 = [v47 hmf_arrayForKey:uUIDString];
      v57 = uUIDString;
      v58 = [v46 hmf_arrayForKey:uUIDString];
      v66 = 0u;
      v67 = 0u;
      v68 = 0u;
      v69 = 0u;
      services = [v12 services];
      v53 = [services countByEnumeratingWithState:&v66 objects:v86 count:16];
      if (v53)
      {
        v51 = *v67;
        do
        {
          for (i = 0; i != v53; ++i)
          {
            if (*v67 != v51)
            {
              objc_enumerationMutation(services);
            }

            v16 = *(*(&v66 + 1) + 8 * i);
            instanceID = [v16 instanceID];
            stringValue = [instanceID stringValue];
            v19 = [v52 hmf_dictionaryForKey:stringValue];

            if (v19)
            {
              v54 = i;
              v64 = 0u;
              v65 = 0u;
              v62 = 0u;
              v63 = 0u;
              characteristics = [v16 characteristics];
              v20 = [characteristics countByEnumeratingWithState:&v62 objects:v85 count:16];
              if (!v20)
              {
                goto LABEL_31;
              }

              v21 = v20;
              v22 = *v63;
              v59 = v19;
              while (1)
              {
                for (j = 0; j != v21; ++j)
                {
                  if (*v63 != v22)
                  {
                    objc_enumerationMutation(characteristics);
                  }

                  v24 = *(*(&v62 + 1) + 8 * j);
                  instanceID2 = [v24 instanceID];
                  stringValue2 = [instanceID2 stringValue];
                  v27 = [v19 objectForKey:stringValue2];

                  if (v27)
                  {
                    if ([v61 containsObject:instanceID2])
                    {
                      v28 = objc_autoreleasePoolPush();
                      selfCopy3 = self;
                      v30 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
                      {
                        v31 = HMFGetLogIdentifier();
                        shortDescription = [v24 shortDescription];
                        *buf = 138543874;
                        v80 = v31;
                        v81 = 2112;
                        v82 = shortDescription;
                        v83 = 2112;
                        v84 = v57;
                        _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEBUG, "%{public}@Received persistent characteristic changed notification for characteristic (%@), accessoryUUID %@", buf, 0x20u);

                        self = selfCopy2;
                      }

                      objc_autoreleasePoolPop(v28);
                    }

                    else
                    {
                      if (![v58 containsObject:instanceID2])
                      {
                        goto LABEL_29;
                      }

                      v33 = objc_autoreleasePoolPush();
                      selfCopy4 = self;
                      v35 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
                      {
                        v36 = HMFGetLogIdentifier();
                        shortDescription2 = [v24 shortDescription];
                        *buf = 138543874;
                        v80 = v36;
                        v81 = 2112;
                        v82 = shortDescription2;
                        v83 = 2112;
                        v84 = v57;
                        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_ERROR, "%{public}@Received unexpected characteristic changed notification for characteristic (%@), accessoryUUID %@", buf, 0x20u);

                        array = v55;
                        self = selfCopy2;
                      }

                      objc_autoreleasePoolPop(v33);
                      [array addObject:v24];
                    }

                    v19 = v59;
                  }

LABEL_29:
                }

                v21 = [characteristics countByEnumeratingWithState:&v62 objects:v85 count:16];
                if (!v21)
                {
LABEL_31:

                  i = v54;
                  break;
                }
              }
            }
          }

          v53 = [services countByEnumeratingWithState:&v66 objects:v86 count:16];
        }

        while (v53);
      }

      v11 = v49 + 1;
    }

    while (v49 + 1 != v48);
    v48 = [obj countByEnumeratingWithState:&v70 objects:v87 count:16];
  }

  while (v48);
LABEL_36:

  objc_autoreleasePoolPop(context);
  v7 = [array copy];

  notificationsCopy = v42;
LABEL_37:

  v38 = *MEMORY[0x277D85DE8];

  return v7;
}

id __69__HMDHome__unexpectedCharacteristicsFromCharacteristicNotifications___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) objectForKeyedSubscript:v3];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  v6 = 0;
  if ((isKindOfClass & 1) != 0 && v4)
  {
    v7 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v3];
    v8 = [*(a1 + 40) accessoryWithUUID:v7];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }

    v6 = v9;
  }

  return v6;
}

- (void)_notificationPayloadsForRemoteGateway:(void *)gateway accessories:(void *)accessories enableCharacteristicNotificationPayload:(void *)payload characteristicNotificationThresholdsPayload:(void *)thresholdsPayload disableCharacteristicNotificationPayload:(void *)notificationPayload enableMediaNotificationPayload:(void *)mediaNotificationPayload disableMediaNotificationPayload:
{
  v185 = *MEMORY[0x277D85DE8];
  gatewayCopy = gateway;
  if (self)
  {
    array = [MEMORY[0x277CBEB18] array];
    v168 = 0u;
    v169 = 0u;
    v170 = 0u;
    v171 = 0u;
    obj = [self triggers];
    v10 = [obj countByEnumeratingWithState:&v168 objects:v184 count:16];
    v137 = array;
    selfCopy = self;
    if (v10)
    {
      v11 = v10;
      v12 = *v169;
      v139 = *v169;
      do
      {
        v13 = 0;
        context = v11;
        do
        {
          if (*v169 != v12)
          {
            objc_enumerationMutation(obj);
          }

          v14 = *(*(&v168 + 1) + 8 * v13);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v15 = v14;
          }

          else
          {
            v15 = 0;
          }

          v16 = v15;

          if ([v16 shouldActivateOnLocalDevice])
          {
            v147 = v16;
            v149 = v13;
            v166 = 0u;
            v167 = 0u;
            v164 = 0u;
            v165 = 0u;
            characteristicEvents = [v16 characteristicEvents];
            v18 = [characteristicEvents countByEnumeratingWithState:&v164 objects:v183 count:16];
            if (v18)
            {
              v19 = v18;
              v20 = *v165;
              do
              {
                for (i = 0; i != v19; ++i)
                {
                  if (*v165 != v20)
                  {
                    objc_enumerationMutation(characteristicEvents);
                  }

                  v22 = *(*(&v164 + 1) + 8 * i);
                  characteristic = [v22 characteristic];

                  if (characteristic)
                  {
                    characteristic2 = [v22 characteristic];
                    array = v137;
                    [v137 addObject:characteristic2];
                  }

                  else
                  {
                    v25 = objc_autoreleasePoolPush();
                    selfCopy2 = self;
                    v27 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                    {
                      v28 = HMFGetLogIdentifier();
                      *buf = 138543618;
                      *&buf[4] = v28;
                      *&buf[12] = 2112;
                      *&buf[14] = v22;
                      _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                    }

                    objc_autoreleasePoolPop(v25);
                    array = v137;
                    self = selfCopy;
                  }
                }

                v19 = [characteristicEvents countByEnumeratingWithState:&v164 objects:v183 count:16];
              }

              while (v19);
            }

            v12 = v139;
            v11 = context;
            v16 = v147;
            v13 = v149;
          }

          ++v13;
        }

        while (v13 != v11);
        v11 = [obj countByEnumeratingWithState:&v168 objects:v184 count:16];
      }

      while (v11);
    }

    v29 = 0x277CBE000uLL;
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
    dictionary3 = [MEMORY[0x277CBEB38] dictionary];
    if (notificationPayload)
    {
      dictionary4 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      dictionary4 = 0;
    }

    if (mediaNotificationPayload)
    {
      dictionary5 = [MEMORY[0x277CBEB38] dictionary];
    }

    else
    {
      dictionary5 = 0;
    }

    v30 = 0x277CBE000uLL;
    v162 = 0u;
    v163 = 0u;
    v160 = 0u;
    v161 = 0u;
    v124 = gatewayCopy;
    v127 = [v124 countByEnumeratingWithState:&v160 objects:v182 count:16];
    if (v127)
    {
      v31 = dictionary4;
      if (!a2)
      {
        v31 = dictionary5;
      }

      v120 = v31;
      v126 = *v161;
      obja = *MEMORY[0x277CFE810];
      do
      {
        for (j = 0; j != v127; ++j)
        {
          if (*v161 != v126)
          {
            objc_enumerationMutation(v124);
          }

          v33 = *(*(&v160 + 1) + 8 * j);
          array2 = [*(v30 + 2840) array];
          array3 = [*(v30 + 2840) array];
          dictionary6 = [*(v29 + 2872) dictionary];
          v35 = v33;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v36 = v35;
          }

          else
          {
            v36 = 0;
          }

          v37 = v36;

          v38 = v35;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v39 = v38;
          }

          else
          {
            v39 = 0;
          }

          v40 = v39;
          v129 = v38;

          v130 = v37;
          if (v37)
          {
            v128 = j;
            if (!shouldSkipRemoteAccessoryNotificationRegistration(self, v37))
            {
              v125 = v40;
              v140 = array2;
              v158 = 0u;
              v159 = 0u;
              v156 = 0u;
              v157 = 0u;
              services = [v37 services];
              v133 = [services countByEnumeratingWithState:&v156 objects:v180 count:16];
              if (v133)
              {
                v132 = *v157;
                do
                {
                  v52 = 0;
                  do
                  {
                    if (*v157 != v132)
                    {
                      objc_enumerationMutation(services);
                    }

                    v134 = v52;
                    v53 = *(*(&v156 + 1) + 8 * v52);
                    type = [v53 type];
                    v152 = 0u;
                    v153 = 0u;
                    v154 = 0u;
                    v155 = 0u;
                    characteristics = [v53 characteristics];
                    v55 = [characteristics countByEnumeratingWithState:&v152 objects:v179 count:16];
                    if (v55)
                    {
                      v56 = v55;
                      v57 = *v153;
                      v148 = *v153;
                      v150 = characteristics;
                      do
                      {
                        v58 = 0;
                        do
                        {
                          if (*v153 != v57)
                          {
                            objc_enumerationMutation(characteristics);
                          }

                          v59 = *(*(&v152 + 1) + 8 * v58);
                          if ([v59 supportsNotification])
                          {
                            dataSource = [self dataSource];
                            hapMetadata = [dataSource hapMetadata];
                            v62 = [hapMetadata shouldFilterEnableNotificationsForCharacteristicType:0 serviceType:type];

                            if ((v62 & 1) == 0)
                            {
                              if ([type isEqualToString:obja])
                              {
                                type2 = [v59 type];
                                v64 = [type2 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                              }

                              else
                              {
                                v64 = 0;
                              }

                              dataSource2 = [self dataSource];
                              hapMetadata2 = [dataSource2 hapMetadata];
                              type3 = [v59 type];
                              v68 = [hapMetadata2 shouldAutoEnableNotificationForCharacteristic:type3 ofService:type];

                              isNonHomeNotificationsEnabled = [v59 isNonHomeNotificationsEnabled];
                              if (([array containsObject:v59] & 1) != 0 || (isNonHomeNotificationsEnabled & 1) != 0 || (v68 & 1) != 0 || v64)
                              {
                                contexta = objc_autoreleasePoolPush();
                                selfCopy3 = self;
                                v76 = HMFGetOSLogHandle();
                                if (os_log_type_enabled(v76, OS_LOG_TYPE_DEBUG))
                                {
                                  v77 = HMFGetLogIdentifier();
                                  v78 = HMFBooleanToString();
                                  v79 = HMFBooleanToString();
                                  v80 = HMFBooleanToString();
                                  v81 = HMFBooleanToString();
                                  *buf = 138544642;
                                  *&buf[4] = v77;
                                  *&buf[12] = 2112;
                                  *&buf[14] = v59;
                                  *&buf[22] = 2112;
                                  *&buf[24] = v78;
                                  v173 = 2112;
                                  v174 = v79;
                                  v175 = 2112;
                                  v176 = v80;
                                  v177 = 2112;
                                  v178 = v81;
                                  _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_DEBUG, "%{public}@Enabling characteristic %@ because characteristicInEvent: %@ nonHomeNotificationsEnabled: %@ autoEnableNotification: %@ accessoryFlags: %@", buf, 0x3Eu);

                                  array = v137;
                                }

                                objc_autoreleasePoolPop(contexta);
                                changeThresholdForNonHomeClientEnabledNotifications = [v59 changeThresholdForNonHomeClientEnabledNotifications];
                                dataSource3 = [selfCopy3 dataSource];
                                hapMetadata3 = [dataSource3 hapMetadata];
                                type4 = [v59 type];
                                v86 = [hapMetadata3 shouldEnableHomeNotificationForCharacteristicType:type4 serviceType:type];

                                if (changeThresholdForNonHomeClientEnabledNotifications && (v86 & a2 & 1) == 0)
                                {
                                  instanceID = [v59 instanceID];
                                  stringValue = [instanceID stringValue];
                                  [dictionary6 setObject:changeThresholdForNonHomeClientEnabledNotifications forKeyedSubscript:stringValue];
                                }

                                instanceID2 = [v59 instanceID];
                                [v140 addObject:instanceID2];

                                self = selfCopy;
                                v57 = v148;
                                characteristics = v150;
                              }

                              else if (a2)
                              {
                                type5 = [v59 type];
                                dataSource4 = [self dataSource];
                                hapMetadata4 = [dataSource4 hapMetadata];
                                v73 = [hapMetadata4 shouldEnableHomeNotificationForCharacteristicType:type5 serviceType:type];

                                v57 = v148;
                                if (v73)
                                {
                                  instanceID3 = [v59 instanceID];
                                  [v140 addObject:instanceID3];
                                }

                                characteristics = v150;
                              }

                              else
                              {
                                v57 = v148;
                                characteristics = v150;
                                if ([v59 isClientNotificationEnabled])
                                {
                                  v90 = objc_autoreleasePoolPush();
                                  selfCopy4 = self;
                                  v92 = HMFGetOSLogHandle();
                                  if (os_log_type_enabled(v92, OS_LOG_TYPE_DEFAULT))
                                  {
                                    v93 = HMFGetLogIdentifier();
                                    notificationRegistrations = [v59 notificationRegistrations];
                                    *buf = 138543874;
                                    *&buf[4] = v93;
                                    *&buf[12] = 2112;
                                    *&buf[14] = v59;
                                    *&buf[22] = 2112;
                                    *&buf[24] = notificationRegistrations;
                                    _os_log_impl(&dword_2531F8000, v92, OS_LOG_TYPE_DEFAULT, "%{public}@Not disabling characteristic %@ because client(s) are registered: %@", buf, 0x20u);

                                    v57 = v148;
                                    characteristics = v150;
                                  }

                                  objc_autoreleasePoolPop(v90);
                                }

                                else
                                {
                                  instanceID4 = [v59 instanceID];
                                  [array3 addObject:instanceID4];
                                }
                              }
                            }
                          }

                          ++v58;
                        }

                        while (v56 != v58);
                        v96 = [characteristics countByEnumeratingWithState:&v152 objects:v179 count:16];
                        v56 = v96;
                      }

                      while (v96);
                    }

                    v52 = v134 + 1;
                  }

                  while (v134 + 1 != v133);
                  v133 = [services countByEnumeratingWithState:&v156 objects:v180 count:16];
                }

                while (v133);
              }

              uuid = [v129 uuid];
              uUIDString = [uuid UUIDString];

              if ([v140 count])
              {
                v99 = [v140 copy];
                [dictionary setObject:v99 forKeyedSubscript:uUIDString];
              }

              v30 = 0x277CBE000;
              v29 = 0x277CBE000;
              j = v128;
              if ([dictionary6 count])
              {
                v100 = [dictionary6 copy];
                [dictionary2 setObject:v100 forKeyedSubscript:uUIDString];
              }

              v40 = v125;
              if ([array3 count])
              {
                v101 = [array3 copy];
                [dictionary3 setObject:v101 forKeyedSubscript:uUIDString];
              }

LABEL_101:
              array2 = v140;
              goto LABEL_111;
            }

            v41 = objc_autoreleasePoolPush();
            selfCopy5 = self;
            v43 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
            {
              v44 = HMFGetLogIdentifier();
              *&buf[8] = 0;
              *buf = 0;
              uuid2 = [v130 uuid];

              if (uuid2)
              {
                uuid3 = [v130 uuid];
                [uuid3 getUUIDBytes:buf];
              }

              else
              {
                *buf = *MEMORY[0x277D0F960];
              }

              v181 = *buf;
              *buf = 138543874;
              *&buf[4] = v44;
              *&buf[12] = 1040;
              *&buf[14] = 16;
              *&buf[18] = 2096;
              *&buf[20] = &v181;
              _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %{uuid_t}.16P from remote notification as partitioned network is no longer supported by residents", buf, 0x1Cu);

              v30 = 0x277CBE000;
              v29 = 0x277CBE000;
            }

            objc_autoreleasePoolPop(v41);
            j = v128;
          }

          else
          {
            if (!v40)
            {
              goto LABEL_111;
            }

            if ([self isCurrentDeviceAvailableResident])
            {
              v140 = array2;
              v47 = j;
              v48 = objc_autoreleasePoolPush();
              selfCopy6 = self;
              v50 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
              {
                v51 = HMFGetLogIdentifier();
                *buf = 138543618;
                *&buf[4] = v51;
                *&buf[12] = 2112;
                *&buf[14] = v40;
                _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Skipping generating media notification payload for apple media accessory because current device is a resident: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v48);
              j = v47;
              goto LABEL_101;
            }

            mediaProfile = [v40 mediaProfile];
            if (mediaProfile)
            {
              v103 = [(HMDHome *)self mediaNotificationPayloadForProfile:mediaProfile];
              [v120 addEntriesFromDictionary:v103];
            }

            else
            {
              v141 = array2;
              v104 = j;
              v105 = objc_autoreleasePoolPush();
              selfCopy7 = self;
              v107 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v107, OS_LOG_TYPE_INFO))
              {
                v108 = HMFGetLogIdentifier();
                *buf = 138543618;
                *&buf[4] = v108;
                *&buf[12] = 2112;
                *&buf[14] = v40;
                _os_log_impl(&dword_2531F8000, v107, OS_LOG_TYPE_INFO, "%{public}@Skipping generating media notification payload for accessory with no media profile: %@", buf, 0x16u);

                v30 = 0x277CBE000;
              }

              objc_autoreleasePoolPop(v105);
              j = v104;
              array2 = v141;
            }
          }

LABEL_111:
        }

        v127 = [v124 countByEnumeratingWithState:&v160 objects:v182 count:16];
      }

      while (v127);
    }

    v109 = [dictionary copy];
    payloadCopy = payload;
    *accessories = v109;
    if (payload)
    {
      *payloadCopy = [dictionary2 copy];
    }

    *thresholdsPayload = [dictionary3 copy];
    if (notificationPayload)
    {
      *notificationPayload = [dictionary4 copy];
    }

    if (mediaNotificationPayload)
    {
      *mediaNotificationPayload = [dictionary5 copy];
    }
  }

  v111 = *MEMORY[0x277D85DE8];
}

- (void)_updateWoWState:(id)state
{
  v21 = *MEMORY[0x277D85DE8];
  stateCopy = state;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v5 = [stateCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(stateCopy);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        identifier = [v9 identifier];
        v11 = [v9 matchingHAPAccessoryWithServerIdentifier:identifier linkType:1];

        if ([v9 isReachable])
        {
          v12 = v11 == 0;
        }

        else
        {
          v12 = 1;
        }

        if (v12 || ![v9 isNonClientNotificationEnabled])
        {
          dataSource = [(HMDHome *)self dataSource];
          netManager = [dataSource netManager];
          [netManager deregisterWoWAssertionForObject:v9];
        }

        else
        {
          dataSource = [(HMDHome *)self dataSource];
          netManager = [dataSource netManager];
          [netManager registerWoWAssertionForObject:v9];
        }
      }

      v6 = [stateCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_registerForNotifications
{
  notificationCenter = [(HMDHome *)self notificationCenter];
  homeManager = [(HMDHome *)self homeManager];
  connectionsManager = [homeManager connectionsManager];
  [notificationCenter addObserver:self selector:sel_handleFirstProcessDidBecomeActiveNotification_ name:@"HMDHomeManagerFirstProcessDidBecomeActiveNotification" object:connectionsManager];

  connectionsManager2 = [homeManager connectionsManager];
  [notificationCenter addObserver:self selector:sel_handleLastProcessDidBecomeInactiveNotification_ name:@"HMDHomeManagerLastProcessDidBecomeInactiveNotification" object:connectionsManager2];

  [notificationCenter addObserver:self selector:sel_handleClientProcessDisconnectedNotification_ name:@"HMDHomeManagerClientProcessDisconnectedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleAccessoryDidAddNetworkRouterControllerNotification_ name:@"HMDAccessoryDidAddNetworkRouterControllerNotification" object:self];
  [notificationCenter addObserver:self selector:sel_handleAccessoryDidRemoveNetworkRouterControllerNotification_ name:@"HMDAccessoryDidRemoveNetworkRouterControllerNotification" object:self];
  currentUser = [(HMDHome *)self currentUser];
  [notificationCenter addObserver:self selector:sel_handleCurrentUserPrivilegeChanged_ name:@"HMDUserPrivilegeDidChangeNotification" object:currentUser];

  v7 = +[HMDAppleAccountManager sharedManager];
  [notificationCenter addObserver:self selector:sel_handleActiveAccountChanged_ name:@"HMDAppleAccountManagerAccountUpdatedNotification" object:v7];

  [notificationCenter addObserver:self selector:sel_handleAccountHandlesUpdated_ name:@"HMDAccountHandlesUpdatedNotification" object:0];
  [notificationCenter addObserver:self selector:sel___handleProcessStateChange_ name:HMDProcessMonitorProcessStateDidChangeNotification object:0];
  [notificationCenter addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsReachableNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleAccessoryReachabilityChangeNotification_ name:@"HMDAccessoryIsNotReachableNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleRemovedMediaSessions_ name:@"HMDMediaSessionsRemovedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleXPCConnectionInvalidated_ name:@"HMDXPCClientConnectionDidInvalidateNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleDeviceCapabilitiesUpdated_ name:@"HMDDeviceCapabilitiiesUpdatedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handlePrimaryResidentChangeNotification_ name:@"HMDResidentDeviceConfirmedStateChangedNotification" object:0];
  if (isiOSDevice())
  {
    [notificationCenter addObserver:self selector:sel_handleDidReceiveIDSMessageWithNoListener_ name:@"HMDDidReceiveRemoteMessageWithNoListenerNotification" object:0];
  }

  [notificationCenter addObserver:self selector:sel_handleSiriEndPointAddedNotification_ name:@"HMDSiriEndpointProfileAddedNotification" object:0];
  [notificationCenter addObserver:self selector:sel_handleRemoteDeviceBecameReachableNotification_ name:@"HMDRemoteDeviceIsReachableNotification" object:0];
}

- (void)_registerForMessages
{
  v504[2] = *MEMORY[0x277D85DE8];
  v3 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:3 remoteAccessRequired:0];
  v411 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:0];
  v410 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:0 remoteAccessRequired:1];
  administratorHandler = [(HMDHome *)self administratorHandler];
  v5 = *MEMORY[0x277CD2540];
  v6 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v504[0] = v6;
  v7 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v504[1] = v7;
  v8 = [MEMORY[0x277CBEA60] arrayWithObjects:v504 count:2];
  [administratorHandler registerForMessage:v5 receiver:self policies:v8 selector:sel__handleRename_];

  msgDispatcher = [(HMDHome *)self msgDispatcher];
  v10 = *MEMORY[0x277CD1208];
  v11 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v503 = v11;
  v12 = [MEMORY[0x277CBEA60] arrayWithObjects:&v503 count:1];
  [msgDispatcher registerForMessage:v10 receiver:self policies:v12 selector:sel__handleHomeDataRequest_];

  administratorHandler2 = [(HMDHome *)self administratorHandler];
  v14 = *MEMORY[0x277CCF1F8];
  v15 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v502[0] = v15;
  v16 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v502[1] = v16;
  v17 = [MEMORY[0x277CBEA60] arrayWithObjects:v502 count:2];
  [administratorHandler2 registerForMessage:v14 receiver:self policies:v17 selector:sel__handleAddRoom_];

  administratorHandler3 = [(HMDHome *)self administratorHandler];
  v19 = *MEMORY[0x277CD0CA0];
  v20 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v501[0] = v20;
  v21 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v501[1] = v21;
  v22 = [MEMORY[0x277CBEA60] arrayWithObjects:v501 count:2];
  [administratorHandler3 registerForMessage:v19 receiver:self policies:v22 selector:sel__handleRemoveRoom_];

  administratorHandler4 = [(HMDHome *)self administratorHandler];
  v24 = *MEMORY[0x277CD20B0];
  v25 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v500[0] = v25;
  v26 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v500[1] = v26;
  v27 = [MEMORY[0x277CBEA60] arrayWithObjects:v500 count:2];
  [administratorHandler4 registerForMessage:v24 receiver:self policies:v27 selector:sel__handleAddZone_];

  administratorHandler5 = [(HMDHome *)self administratorHandler];
  v29 = *MEMORY[0x277CD2530];
  v30 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v499[0] = v30;
  v31 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v499[1] = v31;
  v32 = [MEMORY[0x277CBEA60] arrayWithObjects:v499 count:2];
  [administratorHandler5 registerForMessage:v29 receiver:self policies:v32 selector:sel__handleRemoveZone_];

  administratorHandler6 = [(HMDHome *)self administratorHandler];
  v34 = *MEMORY[0x277CD20A0];
  v35 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v498[0] = v35;
  v36 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v498[1] = v36;
  v37 = [MEMORY[0x277CBEA60] arrayWithObjects:v498 count:2];
  [administratorHandler6 registerForMessage:v34 receiver:self policies:v37 selector:sel__handleAddServiceGroup_];

  administratorHandler7 = [(HMDHome *)self administratorHandler];
  v39 = *MEMORY[0x277CD2520];
  v40 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v497[0] = v40;
  v41 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v497[1] = v41;
  v42 = [MEMORY[0x277CBEA60] arrayWithObjects:v497 count:2];
  [administratorHandler7 registerForMessage:v39 receiver:self policies:v42 selector:sel__handleRemoveServiceGroup_];

  administratorHandler8 = [(HMDHome *)self administratorHandler];
  v44 = *MEMORY[0x277CD2078];
  v45 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v496[0] = v45;
  v46 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v496[1] = v46;
  v47 = [MEMORY[0x277CBEA60] arrayWithObjects:v496 count:2];
  [administratorHandler8 registerForMessage:v44 receiver:self policies:v47 selector:sel__handleAddActionSet_];

  administratorHandler9 = [(HMDHome *)self administratorHandler];
  v49 = *MEMORY[0x277CD24F8];
  v50 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v495[0] = v50;
  v51 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v495[1] = v51;
  v52 = [MEMORY[0x277CBEA60] arrayWithObjects:v495 count:2];
  [administratorHandler9 registerForMessage:v49 receiver:self policies:v52 selector:sel__handleRemoveActionSet_];

  administratorHandler10 = [(HMDHome *)self administratorHandler];
  v54 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v494[0] = v54;
  v55 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v494[1] = v55;
  v56 = [MEMORY[0x277CBEA60] arrayWithObjects:v494 count:2];
  [administratorHandler10 registerForMessage:@"kRemoveTriggerRequestKey" receiver:self policies:v56 selector:sel__handleRemoveTrigger_];

  administratorHandler11 = [(HMDHome *)self administratorHandler];
  v58 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v493[0] = v58;
  v59 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v493[1] = v59;
  v60 = [MEMORY[0x277CBEA60] arrayWithObjects:v493 count:2];
  [administratorHandler11 registerForMessage:@"kUpdateUserAccessRequestKey" receiver:self policies:v60 selector:sel__handleUpdateUserAccess_];

  administratorHandler12 = [(HMDHome *)self administratorHandler];
  v62 = *MEMORY[0x277CD2788];
  v63 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v492[0] = v63;
  v64 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v492[1] = v64;
  v409 = v3;
  v492[2] = v3;
  v65 = [MEMORY[0x277CBEA60] arrayWithObjects:v492 count:3];
  [administratorHandler12 registerForMessage:v62 receiver:self policies:v65 selector:sel__handleUpdateUserCamerasAccessLevel_];

  administratorHandler13 = [(HMDHome *)self administratorHandler];
  v67 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v491[0] = v67;
  v68 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v491[1] = v68;
  v69 = [MEMORY[0x277CBEA60] arrayWithObjects:v491 count:2];
  [administratorHandler13 registerForMessage:@"kRemoveUserRequestKey" receiver:self policies:v69 selector:sel__handleRemoveUser_];

  administratorHandler14 = [(HMDHome *)self administratorHandler];
  v71 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v490[0] = v71;
  v72 = [HMDConfigurationMessagePolicy policyWithOperationTypes:7];
  v490[1] = v72;
  v73 = [MEMORY[0x277CBEA60] arrayWithObjects:v490 count:2];
  [administratorHandler14 registerForMessage:@"kSetAppDataRequestKey" receiver:self policies:v73 selector:sel__handleSetAppData_];

  administratorHandler15 = [(HMDHome *)self administratorHandler];
  v75 = *MEMORY[0x277CD0678];
  v76 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v489[0] = v76;
  v77 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v489[1] = v77;
  v78 = [MEMORY[0x277CBEA60] arrayWithObjects:v489 count:2];
  [administratorHandler15 registerForMessage:v75 receiver:self policies:v78 selector:sel__handleUpdateMinimumMediaUserPrivilege_];

  administratorHandler16 = [(HMDHome *)self administratorHandler];
  v80 = *MEMORY[0x277CD0670];
  v81 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v488[0] = v81;
  v82 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v488[1] = v82;
  v83 = [MEMORY[0x277CBEA60] arrayWithObjects:v488 count:2];
  [administratorHandler16 registerForMessage:v80 receiver:self policies:v83 selector:sel__handleUpdateMediaPeerToPeerEnabled_];

  administratorHandler17 = [(HMDHome *)self administratorHandler];
  v85 = *MEMORY[0x277CD0668];
  v86 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v487[0] = v86;
  v87 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v487[1] = v87;
  v88 = [MEMORY[0x277CBEA60] arrayWithObjects:v487 count:2];
  [administratorHandler17 registerForMessage:v85 receiver:self policies:v88 selector:sel__handleUpdateMediaPassword_];

  administratorHandler18 = [(HMDHome *)self administratorHandler];
  v90 = *MEMORY[0x277CD0580];
  v91 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v486[0] = v91;
  v92 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v486[1] = v92;
  v93 = [MEMORY[0x277CBEA60] arrayWithObjects:v486 count:2];
  [administratorHandler18 registerForMessage:v90 receiver:self policies:v93 selector:sel__handleSetHasAnyUserAcknowledgedCameraRecordingOnboardingRequest_];

  administratorHandler19 = [(HMDHome *)self administratorHandler];
  v95 = *MEMORY[0x277CD0588];
  v96 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v485[0] = v96;
  v97 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v485[1] = v97;
  v98 = [MEMORY[0x277CBEA60] arrayWithObjects:v485 count:2];
  [administratorHandler19 registerForMessage:v95 receiver:self policies:v98 selector:sel__handleSetHasOnboardedForAccessCodeMessage_];

  administratorHandler20 = [(HMDHome *)self administratorHandler];
  v100 = *MEMORY[0x277CD0590];
  v101 = [HMDXPCMessagePolicy policyWithEntitlements:131077];
  v484[0] = v101;
  v102 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v484[1] = v102;
  v103 = [MEMORY[0x277CBEA60] arrayWithObjects:v484 count:2];
  [administratorHandler20 registerForMessage:v100 receiver:self policies:v103 selector:sel__handleSetHasOnboardedForWalletKeyMessage_];

  administratorHandler21 = [(HMDHome *)self administratorHandler];
  v105 = *MEMORY[0x277CD0680];
  v106 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v483[0] = v106;
  v107 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v483[1] = v107;
  v108 = [MEMORY[0x277CBEA60] arrayWithObjects:v483 count:2];
  [administratorHandler21 registerForMessage:v105 receiver:self policies:v108 selector:sel__handleUpdateNetworkProtection_];

  administratorHandler22 = [(HMDHome *)self administratorHandler];
  v110 = *MEMORY[0x277CD0690];
  v111 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v482[0] = v111;
  v112 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v482[1] = v112;
  v113 = [MEMORY[0x277CBEA60] arrayWithObjects:v482 count:2];
  [administratorHandler22 registerForMessage:v110 receiver:self policies:v113 selector:sel__handleUpdateUserAnnounceAccess_];

  administratorHandler23 = [(HMDHome *)self administratorHandler];
  v115 = *MEMORY[0x277CD0558];
  v116 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v481[0] = v116;
  v117 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v481[1] = v117;
  v118 = [MEMORY[0x277CBEA60] arrayWithObjects:v481 count:2];
  [administratorHandler23 registerForMessage:v115 receiver:self policies:v118 selector:sel__handleResolveThreadNetworkRequest_];

  administratorHandler24 = [(HMDHome *)self administratorHandler];
  v120 = *MEMORY[0x277CD05E8];
  v121 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v480[0] = v121;
  v122 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v480[1] = v122;
  v123 = [MEMORY[0x277CBEA60] arrayWithObjects:v480 count:2];
  [administratorHandler24 registerForMessage:v120 receiver:self policies:v123 selector:sel__handleSiriPhraseOptionsUpdateRequest_];

  administratorHandler25 = [(HMDHome *)self administratorHandler];
  v125 = *MEMORY[0x277CD05D0];
  v126 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v479[0] = v126;
  v127 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v479[1] = v127;
  v128 = [MEMORY[0x277CBEA60] arrayWithObjects:v479 count:2];
  [administratorHandler25 registerForMessage:v125 receiver:self policies:v128 selector:sel__handleSoundCheckUpdateRequest_];

  administratorHandler26 = [(HMDHome *)self administratorHandler];
  v130 = *MEMORY[0x277CD0660];
  v131 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v478[0] = v131;
  v132 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v478[1] = v132;
  v133 = [MEMORY[0x277CBEA60] arrayWithObjects:v478 count:2];
  [administratorHandler26 registerForMessage:v130 receiver:self policies:v133 selector:sel__handleHomeUpdateLocationServicesEnabledRequest_];

  if (isInternalBuild())
  {
    administratorHandler27 = [(HMDHome *)self administratorHandler];
    v135 = *MEMORY[0x277CD0658];
    v136 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v477[0] = v136;
    v137 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v477[1] = v137;
    v138 = [MEMORY[0x277CBEA60] arrayWithObjects:v477 count:2];
    [administratorHandler27 registerForMessage:v135 receiver:self policies:v138 selector:sel__handleHomeUpdateDidOnboardLocationServicesRequest_];
  }

  if (!isWatch())
  {
    administratorHandler28 = [(HMDHome *)self administratorHandler];
    v140 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v476[0] = v140;
    v141 = [HMDConfigurationMessagePolicy policyWithOperationTypes:6];
    v476[1] = v141;
    v142 = [MEMORY[0x277CBEA60] arrayWithObjects:v476 count:2];
    [administratorHandler28 registerForMessage:@"kUpdateInvitationStateRequestKey" receiver:self policies:v142 selector:sel__handleUpdateOutgoingInvitationState_];
  }

  v143 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v143 setRoles:{objc_msgSend(v143, "roles") | 4}];
  v406 = v143;
  v144 = [v143 copy];
  v145 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
  msgDispatcher2 = [(HMDHome *)self msgDispatcher];
  v147 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v475[0] = v147;
  v475[1] = v145;
  v148 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v475[2] = v148;
  v149 = [MEMORY[0x277CBEA60] arrayWithObjects:v475 count:3];
  [msgDispatcher2 registerForMessage:@"kAddEventTriggerRequestKey" receiver:self policies:v149 selector:sel__handleAddEventTrigger_];

  v150 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v474[0] = v150;
  v474[1] = v145;
  v151 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v474[2] = v151;
  v152 = [MEMORY[0x277CBEA60] arrayWithObjects:v474 count:3];
  v404 = msgDispatcher2;
  [msgDispatcher2 registerForMessage:@"kAddTimerTriggerRequestKey" receiver:self policies:v152 selector:sel__handleAddTimerTrigger_];

  msgDispatcher3 = [(HMDHome *)self msgDispatcher];
  v473[0] = v144;
  v473[1] = v145;
  v154 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v473[2] = v154;
  v155 = [MEMORY[0x277CBEA60] arrayWithObjects:v473 count:3];
  [msgDispatcher3 registerForMessage:@"kAddTriggersInternalRequestKey" receiver:self policies:v155 selector:sel__handleAddTriggers_];

  productInfo = [MEMORY[0x277D0F8E8] productInfo];
  productPlatform = [productInfo productPlatform];

  if (productPlatform == 1)
  {
    v158 = 5;
  }

  else
  {
    v158 = 1;
  }

  msgDispatcher4 = [(HMDHome *)self msgDispatcher];
  v160 = *MEMORY[0x277CD2070];
  v472[0] = v144;
  v472[1] = v145;
  v161 = [HMDXPCMessagePolicy policyWithEntitlements:v158];
  v472[2] = v161;
  v162 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v472[3] = v162;
  v163 = [MEMORY[0x277CBEA60] arrayWithObjects:v472 count:4];
  [msgDispatcher4 registerForMessage:v160 receiver:self policies:v163 selector:sel__handleAddAccessory_];

  msgDispatcher5 = [(HMDHome *)self msgDispatcher];
  v471[0] = v144;
  v471[1] = v145;
  v165 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v471[2] = v165;
  v166 = [MEMORY[0x277CBEA60] arrayWithObjects:v471 count:3];
  [msgDispatcher5 registerForMessage:@"kAddAccessoriesInternalRequestKey" receiver:self policies:v166 selector:sel__handleAddAccessories_];

  msgDispatcher6 = [(HMDHome *)self msgDispatcher];
  v168 = *MEMORY[0x277CD06A8];
  v169 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v470[0] = v169;
  v470[1] = v145;
  v170 = [MEMORY[0x277CBEA60] arrayWithObjects:v470 count:2];
  [msgDispatcher6 registerForMessage:v168 receiver:self policies:v170 selector:sel__handleUserConsentResponseForAccessory_];

  msgDispatcher7 = [(HMDHome *)self msgDispatcher];
  v172 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v469[0] = v172;
  v469[1] = v145;
  v173 = [MEMORY[0x277CBEA60] arrayWithObjects:v469 count:2];
  [msgDispatcher7 registerForMessage:@"kContinuePairingAccessoryRequestKey" receiver:self policies:v173 selector:sel__handleContinuePairingAccessory_];

  msgDispatcher8 = [(HMDHome *)self msgDispatcher];
  v175 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v468[0] = v175;
  v468[1] = v145;
  v176 = [MEMORY[0x277CBEA60] arrayWithObjects:v468 count:2];
  [msgDispatcher8 registerForMessage:@"kCancelPairingAccessoryRequestKey" receiver:self policies:v176 selector:sel__handleCancelPairingAccessory_];

  msgDispatcher9 = [(HMDHome *)self msgDispatcher];
  v178 = *MEMORY[0x277CD24F0];
  v179 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v467[0] = v179;
  v467[1] = v144;
  v467[2] = v145;
  v180 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v467[3] = v180;
  v181 = [MEMORY[0x277CBEA60] arrayWithObjects:v467 count:4];
  [msgDispatcher9 registerForMessage:v178 receiver:self policies:v181 selector:sel__handleRemoveAccessoryMessage_];

  administratorHandler29 = [(HMDHome *)self administratorHandler];
  v183 = *MEMORY[0x277CD0518];
  v184 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v466[0] = v184;
  v466[1] = v144;
  v466[2] = v145;
  v185 = [HMDConfigurationMessagePolicy policyWithOperationTypes:4];
  v466[3] = v185;
  v186 = [MEMORY[0x277CBEA60] arrayWithObjects:v466 count:4];
  [administratorHandler29 registerForMessage:v183 receiver:self policies:v186 selector:sel_handleResetAndRemoveAllCHIPPairingsFromAccessoryMessage_];

  msgDispatcher10 = [(HMDHome *)self msgDispatcher];
  v465[0] = v144;
  v465[1] = v410;
  v188 = [MEMORY[0x277CBEA60] arrayWithObjects:v465 count:2];
  [msgDispatcher10 registerForMessage:@"HMDHomeRequestCommissioningCertificatesMessage" receiver:self policies:v188 selector:sel_handleCommissioningCertificateRequest_];

  msgDispatcher11 = [(HMDHome *)self msgDispatcher];
  v464[0] = v144;
  v464[1] = v145;
  v190 = [MEMORY[0x277CBEA60] arrayWithObjects:v464 count:2];
  [msgDispatcher11 registerForMessage:@"HMDHomeNotificationPairingCompletionMessage" receiver:self policies:v190 selector:sel_handleMatterPairingCompletionNotification_];

  msgDispatcher12 = [(HMDHome *)self msgDispatcher];
  v192 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v463[0] = v192;
  v463[1] = v145;
  v193 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
  v463[2] = v193;
  v194 = [MEMORY[0x277CBEA60] arrayWithObjects:v463 count:3];
  [msgDispatcher12 registerForMessage:@"kInviteUsersRequestKey" receiver:self policies:v194 selector:sel__handleUserInvitations_];

  administratorHandler30 = [(HMDHome *)self administratorHandler];
  v196 = *MEMORY[0x277CCFEE8];
  v197 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v462[0] = v197;
  v198 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v462[1] = v198;
  v462[2] = v410;
  v462[3] = v144;
  v199 = [MEMORY[0x277CBEA60] arrayWithObjects:v462 count:4];
  [administratorHandler30 registerForMessage:v196 receiver:self policies:v199 selector:sel__handleEnableMultiUserRequest_];

  localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v196) = [localCapabilitiesDataSource isResidentCapable];

  if (v196)
  {
    msgDispatcher13 = [(HMDHome *)self msgDispatcher];
    v461[0] = v144;
    v461[1] = v145;
    v202 = [HMDConfigurationMessagePolicy policyWithOperationTypes:1];
    v461[2] = v202;
    v203 = [MEMORY[0x277CBEA60] arrayWithObjects:v461 count:3];
    [msgDispatcher13 registerForMessage:@"kAddHomeInvitesInternalRequestKey" receiver:self policies:v203 selector:sel__handleOutgoingInvitations_];

    msgDispatcher14 = [(HMDHome *)self msgDispatcher];
    v460[0] = v144;
    v460[1] = v145;
    v205 = [MEMORY[0x277CBEA60] arrayWithObjects:v460 count:2];
    [msgDispatcher14 registerForMessage:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" receiver:self policies:v205 selector:sel__handleCreateUniquePSKClientConfiguration_];

    msgDispatcher15 = [(HMDHome *)self msgDispatcher];
    v459[0] = v144;
    v459[1] = v145;
    v207 = [MEMORY[0x277CBEA60] arrayWithObjects:v459 count:2];
    [msgDispatcher15 registerForMessage:@"HMDHomeRemoveClientConfigurationRequestKey" receiver:self policies:v207 selector:sel__handleRemoveClientConfiguration_];
  }

  if (!isWatch())
  {
    msgDispatcher16 = [(HMDHome *)self msgDispatcher];
    v209 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
    v458[0] = v209;
    v458[1] = v145;
    v210 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v458[2] = v210;
    v211 = [MEMORY[0x277CBEA60] arrayWithObjects:v458 count:3];
    [msgDispatcher16 registerForMessage:@"kHomeLocationUpdatedNotificationKey" receiver:self policies:v211 selector:sel__handleHomeLocationUpdateFromSharedAdmin_];
  }

  if (isInternalBuild())
  {
    msgDispatcher17 = [(HMDHome *)self msgDispatcher];
    v213 = *MEMORY[0x277CD0008];
    v214 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v457[0] = v214;
    v215 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v457[1] = v215;
    v216 = [MEMORY[0x277CBEA60] arrayWithObjects:v457 count:2];
    [msgDispatcher17 registerForMessage:v213 receiver:self policies:v216 selector:sel__handleSetMinimumNetworkRouterHomeKitVersion_];

    msgDispatcher18 = [(HMDHome *)self msgDispatcher];
    v218 = *MEMORY[0x277CD0000];
    v219 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v456[0] = v219;
    v220 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v456[1] = v220;
    v221 = [MEMORY[0x277CBEA60] arrayWithObjects:v456 count:2];
    [msgDispatcher18 registerForMessage:v218 receiver:self policies:v221 selector:sel__handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange_];
  }

  v223 = v410;
  v222 = v411;
  if (isInternalBuild() && isiOSDevice())
  {
    msgDispatcher19 = [(HMDHome *)self msgDispatcher];
    v225 = *MEMORY[0x277CD0568];
    v226 = [HMDXPCMessagePolicy policyWithEntitlements:1049605];
    v455[0] = v226;
    v227 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v455[1] = v227;
    v228 = [MEMORY[0x277CBEA60] arrayWithObjects:v455 count:2];
    [msgDispatcher19 registerForMessage:v225 receiver:self policies:v228 selector:sel__handleRetrieveHomeLocationForFeedback_];

    v222 = v411;
    v223 = v410;
  }

  msgDispatcher20 = [(HMDHome *)self msgDispatcher];
  v230 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v454[0] = v230;
  v454[1] = v222;
  v231 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v454[2] = v231;
  v232 = [MEMORY[0x277CBEA60] arrayWithObjects:v454 count:3];
  [msgDispatcher20 registerForMessage:@"kUpdateUserPresenceStatusConsentRequestKey" receiver:self policies:v232 selector:sel__handleUpdatePresenceConsent_];

  msgDispatcher21 = [(HMDHome *)self msgDispatcher];
  v234 = *MEMORY[0x277CD0560];
  v235 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v453[0] = v235;
  v236 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v453[1] = v236;
  v237 = [MEMORY[0x277CBEA60] arrayWithObjects:v453 count:2];
  [msgDispatcher21 registerForMessage:v234 receiver:self policies:v237 selector:sel__handleRetrieveAsyncResults_];

  v238 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v238 setRoles:{objc_msgSend(v238, "roles") | 6}];
  v407 = v238;
  v239 = [v238 copy];
  msgDispatcher22 = [(HMDHome *)self msgDispatcher];
  v241 = *MEMORY[0x277CD2348];
  v242 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v452[0] = v242;
  v452[1] = v239;
  v452[2] = v223;
  v243 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v452[3] = v243;
  v244 = [MEMORY[0x277CBEA60] arrayWithObjects:v452 count:4];
  [msgDispatcher22 registerForMessage:v241 receiver:self policies:v244 selector:sel__handleExecuteActionSet_];

  msgDispatcher23 = [(HMDHome *)self msgDispatcher];
  v246 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v451[0] = v246;
  v451[1] = v239;
  v451[2] = v223;
  v247 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v451[3] = v247;
  v248 = [MEMORY[0x277CBEA60] arrayWithObjects:v451 count:4];
  [msgDispatcher23 registerForMessage:@"kMultipleCharacteristicWriteRequestKey" receiver:self policies:v248 selector:sel__handleMultipleCharacteristicWrite_];

  msgDispatcher24 = [(HMDHome *)self msgDispatcher];
  v250 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v450[0] = v250;
  v450[1] = v239;
  v450[2] = v223;
  v251 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v450[3] = v251;
  v252 = [MEMORY[0x277CBEA60] arrayWithObjects:v450 count:4];
  [msgDispatcher24 registerForMessage:@"kMultipleCharacteristicReadRequestKey" receiver:self policies:v252 selector:sel__handleMultipleCharacteristicRead_];

  msgDispatcher25 = [(HMDHome *)self msgDispatcher];
  v449[0] = v239;
  v449[1] = v223;
  v254 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v449[2] = v254;
  v255 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v449[3] = v255;
  v256 = [MEMORY[0x277CBEA60] arrayWithObjects:v449 count:4];
  [msgDispatcher25 registerForMessage:@"kCharacteristicWriteRequestKey" receiver:self policies:v256 selector:sel__handleCharacteristicWrite_];

  msgDispatcher26 = [(HMDHome *)self msgDispatcher];
  v448[0] = v239;
  v448[1] = v223;
  v258 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v448[2] = v258;
  v259 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v448[3] = v259;
  v260 = [MEMORY[0x277CBEA60] arrayWithObjects:v448 count:4];
  [msgDispatcher26 registerForMessage:@"kCharacteristicReadRequestKey" receiver:self policies:v260 selector:sel__handleCharacteristicRead_];

  msgDispatcher27 = [(HMDHome *)self msgDispatcher];
  v262 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v447[0] = v262;
  v447[1] = v239;
  v447[2] = v411;
  v263 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
  v447[3] = v263;
  v264 = [MEMORY[0x277CBEA60] arrayWithObjects:v447 count:4];
  [msgDispatcher27 registerForMessage:@"kCharacteristicEnableNotificationRequestKey" receiver:self policies:v264 selector:sel__handleCharacteristicEnableNotification_];

  if (!isWatch())
  {
    msgDispatcher28 = [(HMDHome *)self msgDispatcher];
    v446[0] = v239;
    v446[1] = v223;
    v266 = [MEMORY[0x277CBEA60] arrayWithObjects:v446 count:2];
    [msgDispatcher28 registerForMessage:@"kModifyCharacterisiticNotificationsRequestKey" receiver:self policies:v266 selector:sel__handleModifyCharacteristicNotifications_];
  }

  msgDispatcher29 = [(HMDHome *)self msgDispatcher];
  v445[0] = v239;
  v445[1] = v223;
  v268 = [MEMORY[0x277CBEA60] arrayWithObjects:v445 count:2];
  [msgDispatcher29 registerForMessage:@"kEnableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v268 selector:sel__handleAccessoryReachabilityRegistrationAndEnable_];

  msgDispatcher30 = [(HMDHome *)self msgDispatcher];
  v444[0] = v239;
  v444[1] = v223;
  v270 = [MEMORY[0x277CBEA60] arrayWithObjects:v444 count:2];
  [msgDispatcher30 registerForMessage:@"kDisableAccessoryReachabilityNotificationRequestKey" receiver:self policies:v270 selector:sel__handleAccessoryReachabilityRegistration_];

  msgDispatcher31 = [(HMDHome *)self msgDispatcher];
  v443[0] = v239;
  v443[1] = v411;
  v272 = [MEMORY[0x277CBEA60] arrayWithObjects:v443 count:2];
  [msgDispatcher31 registerForMessage:@"kRequestHomeDataSyncRequestKey" receiver:self policies:v272 selector:sel__handleRequestHomeDataSync_];

  msgDispatcher32 = [(HMDHome *)self msgDispatcher];
  v274 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v442[0] = v274;
  v442[1] = v411;
  v275 = [MEMORY[0x277CBEA60] arrayWithObjects:v442 count:2];
  [msgDispatcher32 registerForMessage:@"kCharacterisiticsChangedInternalNotificationKey" receiver:self policies:v275 selector:sel__handleCharacteristicsChangedNotification_];

  msgDispatcher33 = [(HMDHome *)self msgDispatcher];
  v277 = [HMDXPCMessagePolicy policyWithEntitlements:1];
  v441[0] = v277;
  v441[1] = v411;
  v278 = [MEMORY[0x277CBEA60] arrayWithObjects:v441 count:2];
  [msgDispatcher33 registerForMessage:@"HMHomeAllowUserManagementMessage" receiver:self policies:v278 selector:sel__handleAllowUserManagementMessage_];

  msgDispatcher34 = [(HMDHome *)self msgDispatcher];
  v280 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v440[0] = v280;
  v440[1] = v411;
  v281 = [MEMORY[0x277CBEA60] arrayWithObjects:v440 count:2];
  [msgDispatcher34 registerForMessage:@"kRemoteReachabilityChangedNotificationKey" receiver:self policies:v281 selector:sel__handleAccessoryReachabilityChange_];

  msgDispatcher35 = [(HMDHome *)self msgDispatcher];
  v283 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v439[0] = v283;
  v439[1] = v411;
  v284 = [MEMORY[0x277CBEA60] arrayWithObjects:v439 count:2];
  [msgDispatcher35 registerForMessage:@"HMDAccessoryResidentReachabilityNotificationRegistrationMessage" receiver:self policies:v284 selector:sel__handleAccessoryReachabilityEventNotificationsRegistration_];

  v285 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v285 setRequiresSecureMessage:1];
  [v285 setRoles:3];
  v408 = v285;
  v286 = [v285 copy];
  msgDispatcher36 = [(HMDHome *)self msgDispatcher];
  v288 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v438[0] = v288;
  v438[1] = v286;
  v405 = v286;
  v438[2] = v223;
  v289 = [MEMORY[0x277CBEA60] arrayWithObjects:v438 count:3];
  [msgDispatcher36 registerForMessage:@"kConfirmExecuteTriggerRequestKey" receiver:self policies:v289 selector:sel__handleExecuteConfirmationOfTrigger_];

  v290 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
  [v290 setRoles:4];
  v291 = [v290 copy];
  msgDispatcher37 = [(HMDHome *)self msgDispatcher];
  v293 = *MEMORY[0x277CD24B0];
  v437[0] = v291;
  v437[1] = v411;
  v294 = [MEMORY[0x277CBEA60] arrayWithObjects:v437 count:2];
  [msgDispatcher37 registerForMessage:v293 receiver:self policies:v294 selector:sel_handleEvaluatePredicateMessage_];

  msgDispatcher38 = [(HMDHome *)self msgDispatcher];
  v296 = *MEMORY[0x277CD0648];
  v297 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v436[0] = v297;
  v436[1] = v409;
  v298 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v436[2] = v298;
  v299 = [MEMORY[0x277CBEA60] arrayWithObjects:v436 count:3];
  [msgDispatcher38 registerForMessage:v296 receiver:self policies:v299 selector:sel__handleUpdateAutomaticSoftwareUpdate_];

  v300 = *MEMORY[0x277CD0650];
  v301 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v435[0] = v301;
  v435[1] = v409;
  v302 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v435[2] = v302;
  v303 = [MEMORY[0x277CBEA60] arrayWithObjects:v435 count:3];
  v403 = msgDispatcher38;
  v304 = msgDispatcher38;
  v305 = v410;
  [v304 registerForMessage:v300 receiver:self policies:v303 selector:sel__handleUpdateAutomaticThirdPartyAccessorySoftwareUpdate_];

  msgDispatcher39 = [(HMDHome *)self msgDispatcher];
  v307 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v434[0] = v307;
  v434[1] = v410;
  v308 = [MEMORY[0x277CBEA60] arrayWithObjects:v434 count:2];
  [msgDispatcher39 registerForMessage:@"HMDHomeQueryResidentReachabilityForAccessoriesMessageKey" receiver:self policies:v308 selector:sel__handleQueryResidentReachabilityForAccessories_];

  msgDispatcher40 = [(HMDHome *)self msgDispatcher];
  v310 = *MEMORY[0x277CCFF40];
  v311 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v433[0] = v311;
  v433[1] = v411;
  v312 = [MEMORY[0x277CBEA60] arrayWithObjects:v433 count:2];
  [msgDispatcher40 registerForMessage:v310 receiver:self policies:v312 selector:sel_executeActionsFromMessage_];

  localCapabilitiesDataSource2 = [(HMDHome *)self localCapabilitiesDataSource];
  LODWORD(v310) = [localCapabilitiesDataSource2 supportsHomeInvitation];

  if (v310)
  {
    v314 = +[(HMDRemoteMessagePolicy *)HMDMutableRemoteMessagePolicy];
    [v314 setRequiresSecureMessage:0];
    [v314 setRequiresAccountMessage:0];
    [v314 setTransportRestriction:-1];
    v315 = [v314 copy];
    msgDispatcher41 = [(HMDHome *)self msgDispatcher];
    v432[0] = v315;
    v317 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v432[1] = v317;
    v318 = [MEMORY[0x277CBEA60] arrayWithObjects:v432 count:2];
    [msgDispatcher41 registerForMessage:@"kUpdateHomeInvitationStateInternalRequestKey" receiver:self policies:v318 selector:sel__handleUpdateRequestForHomeInvitationFromInvitee_];

    v305 = v410;
  }

  localCapabilitiesDataSource3 = [(HMDHome *)self localCapabilitiesDataSource];
  supportsHomeNotificationEnablement = [localCapabilitiesDataSource3 supportsHomeNotificationEnablement];

  if (supportsHomeNotificationEnablement)
  {
    msgDispatcher42 = [(HMDHome *)self msgDispatcher];
    v322 = *MEMORY[0x277CCFEE0];
    v323 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v431[0] = v323;
    v431[1] = v411;
    v324 = [MEMORY[0x277CBEA60] arrayWithObjects:v431 count:2];
    [msgDispatcher42 registerForMessage:v322 receiver:self policies:v324 selector:sel__handleEnableNotifications_];
  }

  msgDispatcher43 = [(HMDHome *)self msgDispatcher];
  v326 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v430[0] = v326;
  v430[1] = v305;
  v327 = [MEMORY[0x277CBEA60] arrayWithObjects:v430 count:2];
  [msgDispatcher43 registerForMessage:@"kMediaPropertiesWriteRequestKey" receiver:self policies:v327 selector:sel__handleMediaPropertiesWrite_];

  msgDispatcher44 = [(HMDHome *)self msgDispatcher];
  v329 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v429[0] = v329;
  v429[1] = v305;
  v330 = [MEMORY[0x277CBEA60] arrayWithObjects:v429 count:2];
  [msgDispatcher44 registerForMessage:@"kMediaPropertiesReadRequestKey" receiver:self policies:v330 selector:sel__handleMediaPropertiesRead_];

  msgDispatcher45 = [(HMDHome *)self msgDispatcher];
  v332 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v333 = v409;
  v428[0] = v332;
  v428[1] = v409;
  v334 = [MEMORY[0x277CBEA60] arrayWithObjects:v428 count:2];
  [msgDispatcher45 registerForMessage:@"kStartDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v334 selector:sel__handleStartDiscoveringSymptomsForNearbyDevicesMessage_];

  msgDispatcher46 = [(HMDHome *)self msgDispatcher];
  v336 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v427[0] = v336;
  v427[1] = v409;
  v337 = [MEMORY[0x277CBEA60] arrayWithObjects:v427 count:2];
  [msgDispatcher46 registerForMessage:@"kStopDiscoveringSymptomsForNearbyDevicesRequestKey" receiver:self policies:v337 selector:sel__handleStopDiscoveringSymptomsForNearbyDevicesMessage_];

  msgDispatcher47 = [(HMDHome *)self msgDispatcher];
  v339 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v426[0] = v339;
  v340 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
  v341 = v411;
  v426[1] = v340;
  v426[2] = v411;
  v342 = [MEMORY[0x277CBEA60] arrayWithObjects:v426 count:3];

  [msgDispatcher47 registerForMessage:*MEMORY[0x277CD1300] receiver:self policies:v342 selector:sel__handleAssistantAccessControlUpdate_];
  [msgDispatcher47 registerForMessage:*MEMORY[0x277CD13C0] receiver:self policies:v342 selector:sel__handleMediaContentProfileAccessControlUpdate_];
  v401 = v342;
  v402 = msgDispatcher47;
  [msgDispatcher47 registerForMessage:*MEMORY[0x277CD13A8] receiver:self policies:v342 selector:sel__handleUserListeningHistoryUpdateControlUpdatedAccessoryUUIDs_];
  msgDispatcher48 = [(HMDHome *)self msgDispatcher];
  v344 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v425[0] = v344;
  v425[1] = v411;
  v345 = [MEMORY[0x277CBEA60] arrayWithObjects:v425 count:2];
  [msgDispatcher48 registerForMessage:@"HMDUCM.rsr" receiver:self policies:v345 selector:sel__handleRemoteUserClientCloudShareRequest_];

  msgDispatcher49 = [(HMDHome *)self msgDispatcher];
  v347 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v424[0] = v347;
  v424[1] = v411;
  v348 = [MEMORY[0x277CBEA60] arrayWithObjects:v424 count:2];
  [msgDispatcher49 registerForMessage:@"HMDUCM.rRepr" receiver:self policies:v348 selector:sel__handleRemoteUserClientCloudShareRepairRequest_];

  if (isInternalBuild())
  {
    msgDispatcher50 = [(HMDHome *)self msgDispatcher];
    v350 = *MEMORY[0x277CCFEA0];
    v351 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v423[0] = v351;
    v423[1] = v409;
    v352 = [HMDConfigurationMessagePolicy policyWithOperationTypes:2];
    v423[2] = v352;
    v353 = [MEMORY[0x277CBEA60] arrayWithObjects:v423 count:3];
    [msgDispatcher50 registerForMessage:v350 receiver:self policies:v353 selector:sel__handleConfirmResidentRequest_];

    v341 = v411;
  }

  v354 = v341;
  [(HMDHome *)self _registerThreadResidentCommissioningMessageHandlers];
  if (isInternalBuild())
  {
    msgDispatcher51 = [(HMDHome *)self msgDispatcher];
    v356 = *MEMORY[0x277CD0610];
    v357 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v422 = v357;
    v358 = [MEMORY[0x277CBEA60] arrayWithObjects:&v422 count:1];
    [msgDispatcher51 registerForMessage:v356 receiver:self policies:v358 selector:sel__handleTestUpgradeToROAR_];
  }

  msgDispatcher52 = [(HMDHome *)self msgDispatcher];
  v360 = *MEMORY[0x277CCFF58];
  v361 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v421 = v361;
  v362 = [MEMORY[0x277CBEA60] arrayWithObjects:&v421 count:1];
  [msgDispatcher52 registerForMessage:v360 receiver:self policies:v362 selector:sel_handleFetchLightProfileSettingsMessage_];

  msgDispatcher53 = [(HMDHome *)self msgDispatcher];
  v364 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v420[0] = v364;
  v420[1] = v341;
  v365 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v420[2] = v365;
  v366 = [MEMORY[0x277CBEA60] arrayWithObjects:v420 count:3];
  [msgDispatcher53 registerForMessage:@"HMDHomeCHIPSendRemoteRequestMessage" receiver:self policies:v366 selector:sel_handleCHIPSendRemoteRequestMessage_];

  if (isInternalBuild())
  {
    v367 = [HMDUserMessagePolicy userMessagePolicyWithHome:self userPrivilege:4 remoteAccessRequired:0];
    msgDispatcher54 = [(HMDHome *)self msgDispatcher];
    v369 = *MEMORY[0x277CD0548];
    v370 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
    v419[0] = v370;
    v419[1] = v367;
    v371 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v419[2] = v371;
    v372 = [MEMORY[0x277CBEA60] arrayWithObjects:v419 count:3];
    [msgDispatcher54 registerForMessage:v369 receiver:self policies:v372 selector:sel_handleResetMatterStorageRequest_];

    msgDispatcher55 = [(HMDHome *)self msgDispatcher];
    v374 = *MEMORY[0x277CCFE98];
    v375 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
    v418[0] = v375;
    v418[1] = v367;
    v376 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v418[2] = v376;
    v377 = [MEMORY[0x277CBEA60] arrayWithObjects:v418 count:3];
    [msgDispatcher55 registerForMessage:v374 receiver:self policies:v377 selector:sel_handleClearMatterControllerPrivateStorageRequest_];

    v333 = v409;
    v354 = v411;
  }

  msgDispatcher56 = [(HMDHome *)self msgDispatcher];
  v379 = +[HMDRemoteMessagePolicy defaultSecurePolicy];
  v417[0] = v379;
  v417[1] = v354;
  v380 = [MEMORY[0x277CBEA60] arrayWithObjects:v417 count:2];
  [msgDispatcher56 registerForMessage:@"HMDHomeCHIPSendReportMessage" receiver:self policies:v380 selector:sel_handleCHIPSendReportMessage_];

  if (isInternalBuild())
  {
    msgDispatcher57 = [(HMDHome *)self msgDispatcher];
    v382 = *MEMORY[0x277CD05A0];
    v383 = [HMDXPCMessagePolicy policyWithEntitlements:1];
    v416[0] = v383;
    v384 = [HMDXPCBackgroundMessagePolicy policyWithEntitlementRequirement:1];
    v416[1] = v384;
    v385 = [MEMORY[0x277CBEA60] arrayWithObjects:v416 count:2];
    [msgDispatcher57 registerForMessage:v382 receiver:self policies:v385 selector:sel_handleSetPreferredPrimaryMessage_];

    v333 = v409;
  }

  msgDispatcher58 = [(HMDHome *)self msgDispatcher];
  v387 = *MEMORY[0x277CCFF90];
  v388 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v415 = v388;
  v389 = [MEMORY[0x277CBEA60] arrayWithObjects:&v415 count:1];
  [msgDispatcher58 registerForMessage:v387 receiver:self policies:v389 selector:sel__handleFetchUniqueIdentifierForBundleIdentifier_];

  msgDispatcher59 = [(HMDHome *)self msgDispatcher];
  v391 = *MEMORY[0x277CCFF88];
  v392 = [HMDXPCMessagePolicy policyWithEntitlements:5];
  v414 = v392;
  v393 = [MEMORY[0x277CBEA60] arrayWithObjects:&v414 count:1];
  [msgDispatcher59 registerForMessage:v391 receiver:self policies:v393 selector:sel__handleFetchTriggerNameRequest_];

  isInternalBuild();
  if (isInternalBuild())
  {
    msgDispatcher60 = [(HMDHome *)self msgDispatcher];
    v395 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v413 = v395;
    v396 = [MEMORY[0x277CBEA60] arrayWithObjects:&v413 count:1];
    [msgDispatcher60 registerForMessage:@"HomeUtil.Command.Wallet.RollReaderKey" receiver:self policies:v396 selector:sel__handleRollReaderKey_];

    msgDispatcher61 = [(HMDHome *)self msgDispatcher];
    v398 = [HMDXPCMessagePolicy policyWithEntitlements:5];
    v412 = v398;
    v399 = [MEMORY[0x277CBEA60] arrayWithObjects:&v412 count:1];
    [msgDispatcher61 registerForMessage:@"HomeUtil.Command.Wallet.FetchOrCreateReaderKey" receiver:self policies:v399 selector:sel__handleFetchOrCreateReaderKey_];
  }

  v400 = *MEMORY[0x277D85DE8];
}

- (void)notifyClientOfVendorInfoUpdatedForManufacturers:(id)manufacturers withCompletion:(id)completion
{
  manufacturersCopy = manufacturers;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke;
  block[3] = &unk_2797355D0;
  block[4] = self;
  v12 = manufacturersCopy;
  v13 = completionCopy;
  v9 = completionCopy;
  v10 = manufacturersCopy;
  dispatch_async(workQueue, block);
}

void __74__HMDHome_notifyClientOfVendorInfoUpdatedForManufacturers_withCompletion___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v18 = [v2 copy];

  v3 = [MEMORY[0x277CBEB18] array];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v15 = a1;
  obj = *(a1 + 40);
  v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
  if (v19)
  {
    v17 = *v25;
    do
    {
      for (i = 0; i != v19; ++i)
      {
        if (*v25 != v17)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v24 + 1) + 8 * i);
        v20 = 0u;
        v21 = 0u;
        v22 = 0u;
        v23 = 0u;
        v6 = v18;
        v7 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
        if (v7)
        {
          v8 = v7;
          v9 = *v21;
          do
          {
            for (j = 0; j != v8; ++j)
            {
              if (*v21 != v9)
              {
                objc_enumerationMutation(v6);
              }

              v11 = *(*(&v20 + 1) + 8 * j);
              v12 = [v11 manufacturer];
              v13 = [v12 caseInsensitiveCompare:v5];

              if (!v13)
              {
                [v11 updateVendorInfo];
                [v3 addObject:v11];
              }
            }

            v8 = [v6 countByEnumeratingWithState:&v20 objects:v28 count:16];
          }

          while (v8);
        }
      }

      v19 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
    }

    while (v19);
  }

  [*(v15 + 32) _notifyClientsOfAccessoryInfoUpdatedForAccessories:v3 shouldRefreshBadge:0 withCompletion:*(v15 + 48)];
  v14 = *MEMORY[0x277D85DE8];
}

- (void)resetConfiguration
{
  [(HMDHome *)self unconfigure];
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_resetConfiguration__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __29__HMDHome_resetConfiguration__block_invoke(uint64_t a1)
{
  v23 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) accessories];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543618;
    v20 = v6;
    v21 = 2112;
    v22 = v2;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@resetConfiguration - removing accessories %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v2;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        [*(a1 + 32) removeAccessory:{v12, v14}];
        [v12 unconfigure];
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_evaluateShouldRelaunchAndSetRelaunch
{
  v17 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    v14 = 0u;
    v15 = 0u;
    v12 = 0u;
    v13 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
    if (v4)
    {
      v5 = v4;
      v6 = 0;
      v7 = *v13;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v13 != v7)
          {
            objc_enumerationMutation(accessories);
          }

          v6 |= [*(*(&v12 + 1) + 8 * i) shouldEnableDaemonRelaunch];
        }

        v5 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
      }

      while (v5);

      if (v6)
      {
        goto LABEL_10;
      }
    }

    else
    {
    }

    launchHandler = [(HMDHome *)self launchHandler];
    uuid = [(HMDHome *)self uuid];
    [launchHandler deregisterRelaunchClientWithUUID:uuid];
    goto LABEL_13;
  }

LABEL_10:
  launchHandler = [(HMDHome *)self launchHandler];
  uuid = [(HMDHome *)self uuid];
  [launchHandler registerRelaunchClientWithUUID:uuid];
LABEL_13:

  v11 = *MEMORY[0x277D85DE8];
}

- (void)evaluateShouldRelaunchAndSetRelaunch
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __47__HMDHome_evaluateShouldRelaunchAndSetRelaunch__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (id)getTransactionFromHAPAccessory:(id)accessory hmdAccessory:(id)hmdAccessory uuid:(id)uuid hostAccessoryUUID:(id)d objectChangeType:(unint64_t)type
{
  v103 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  hmdAccessoryCopy = hmdAccessory;
  uuidCopy = uuid;
  dCopy = d;
  currentAccessory = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v17 = currentAccessory;
  }

  else
  {
    v17 = 0;
  }

  v18 = v17;

  v19 = uuidCopy;
  v20 = v19;
  if (hmdAccessoryCopy)
  {
    uuid = [hmdAccessoryCopy transactionWithObjectChangeType:type];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v22 = uuid;
    }

    else
    {
      v22 = 0;
    }

    v23 = v22;
    goto LABEL_14;
  }

  if (!v19)
  {
    goto LABEL_13;
  }

  if (!v18)
  {
    goto LABEL_13;
  }

  sensorAccessoryUUID = [v18 sensorAccessoryUUID];
  v25 = [sensorAccessoryUUID hmf_isEqualToUUID:v20];

  if (!v25 || (v26 = [HMDAppleMediaAccessorySensorModel alloc], [(HMDHome *)self uuid], v27 = objc_claimAutoreleasedReturnValue(), v28 = [(HMDBackingStoreModelObject *)v26 initWithObjectChangeType:type uuid:v20 parentUUID:v27], v27, !v28))
  {
LABEL_13:
    v29 = [HMDHAPAccessoryTransaction alloc];
    uuid = [(HMDHome *)self uuid];
    v23 = [(HMDBackingStoreModelObject *)v29 initWithObjectChangeType:type uuid:v20 parentUUID:uuid];
LABEL_14:
    v28 = v23;
  }

  [(HMDHAPAccessoryTransaction *)v28 setHapAccessoryLocal:accessoryCopy];
  providedName = [hmdAccessoryCopy providedName];
  if (providedName)
  {
LABEL_18:

    goto LABEL_19;
  }

  if ([accessoryCopy linkType] != 2)
  {
    providedName = [accessoryCopy name];
    v31 = [providedName copy];
    [(HMDAppleMediaAccessorySensorModel *)v28 setProvidedName:v31];

    goto LABEL_18;
  }

LABEL_19:
  v85 = v20;
  v81 = dCopy;
  uniqueIdentifier = [accessoryCopy uniqueIdentifier];
  [(HMDAppleMediaAccessorySensorModel *)v28 setUniqueIdentifier:uniqueIdentifier];

  identifier = [accessoryCopy identifier];
  [(HMDAppleMediaAccessorySensorModel *)v28 setIdentifier:identifier];

  identifier2 = [accessoryCopy identifier];
  v92 = 0;
  keychainStore = [(HMDHome *)self keychainStore];
  v91 = 0;
  v36 = [keychainStore readPublicKeyForAccessoryName:identifier2 registeredWithHomeKit:&v92 error:&v91];
  v82 = v91;

  v83 = v36;
  v84 = identifier2;
  if (identifier2 && v36 && v92 == 1)
  {
    v37 = objc_autoreleasePoolPush();
    selfCopy = self;
    v39 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
    {
      v40 = HMFGetLogIdentifier();
      [accessoryCopy name];
      v41 = v80 = v37;
      [accessoryCopy uniqueIdentifier];
      v42 = hmdAccessoryCopy;
      v44 = v43 = v18;
      *buf = 138544386;
      v94 = v40;
      v95 = 2112;
      v96 = v41;
      v97 = 2112;
      v98 = v44;
      v99 = 2112;
      v100 = v84;
      v101 = 2112;
      v102 = v83;
      _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Accessory %@/%@ setting pairing username and pubkey to ('%@', '%@')", buf, 0x34u);

      v18 = v43;
      hmdAccessoryCopy = v42;

      v37 = v80;
    }

    objc_autoreleasePoolPop(v37);
    [(HMDAppleMediaAccessorySensorModel *)v28 setPairingUsername:v84];
    [(HMDAppleMediaAccessorySensorModel *)v28 setPublicKey:v83];
  }

  else
  {
    v45 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v47 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v47, OS_LOG_TYPE_ERROR))
    {
      HMFGetLogIdentifier();
      v48 = hmdAccessoryCopy;
      v50 = v49 = v18;
      providedName2 = [(HMDAppleMediaAccessorySensorModel *)v28 providedName];
      *buf = 138544130;
      v94 = v50;
      v95 = 2112;
      v96 = providedName2;
      v97 = 2112;
      v98 = v84;
      v99 = 2112;
      v100 = v82;
      _os_log_impl(&dword_2531F8000, v47, OS_LOG_TYPE_ERROR, "%{public}@Failed to read public key for accessory %@ with pairing username %@: %@", buf, 0x2Au);

      v18 = v49;
      hmdAccessoryCopy = v48;
    }

    objc_autoreleasePoolPop(v45);
  }

  if (v81)
  {
    v52 = [(HMDHome *)self accessoryWithUUID:v81];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    uUIDString = [v81 UUIDString];
    if ((isKindOfClass & 1) != 0 && v52)
    {
      [(HMDAppleMediaAccessorySensorModel *)v28 setHostAccessoryUUID:uUIDString];
    }

    else
    {
      [(HMDAppleMediaAccessorySensorModel *)v28 setBridgeUUID:uUIDString];
    }
  }

  hostAccessoryUUID = [(HMDAppleMediaAccessorySensorModel *)v28 hostAccessoryUUID];
  uuid2 = hostAccessoryUUID;
  if (v85 && !hostAccessoryUUID && v18)
  {
    sensorAccessoryUUID2 = [v18 sensorAccessoryUUID];
    v58 = [sensorAccessoryUUID2 hmf_isEqualToUUID:v85];

    if (!v58)
    {
      goto LABEL_40;
    }

    uuid2 = [v18 uuid];
    uUIDString2 = [uuid2 UUIDString];
    [(HMDAppleMediaAccessorySensorModel *)v28 setHostAccessoryUUID:uUIDString2];
  }

LABEL_40:
  category = [hmdAccessoryCopy category];

  if (!category)
  {
    category2 = [accessoryCopy category];

    if (category2)
    {
      category3 = [accessoryCopy category];
      [(HMDAppleMediaAccessorySensorModel *)v28 setAccessoryCategory:category3];
    }

    else
    {
      category3 = [(HMDHome *)self dataSource];
      hapMetadata = [category3 hapMetadata];
      categoryForOther = [hapMetadata categoryForOther];
      identifier3 = [categoryForOther identifier];
      [(HMDAppleMediaAccessorySensorModel *)v28 setAccessoryCategory:identifier3];
    }
  }

  v66 = [MEMORY[0x277CBEB58] set];
  v67 = MEMORY[0x277CBEB58];
  v68 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(accessoryCopy, "linkType")}];
  v69 = [v67 setWithObject:v68];

  v70 = [accessoryCopy servicesOfType:@"00000701-0000-1000-8000-0026BB765291"];
  v71 = [v70 count];

  if (v71)
  {
    [v69 addObject:&unk_2866277D8];
  }

  v88[0] = MEMORY[0x277D85DD0];
  v88[1] = 3221225472;
  v88[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke;
  v88[3] = &unk_279722210;
  v72 = v66;
  v89 = v72;
  v90 = accessoryCopy;
  v73 = accessoryCopy;
  [v69 na_each:v88];
  transportInformationInstances = [hmdAccessoryCopy transportInformationInstances];
  v86[0] = MEMORY[0x277D85DD0];
  v86[1] = 3221225472;
  v86[2] = __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2;
  v86[3] = &unk_279722238;
  v87 = v72;
  v75 = v72;
  [transportInformationInstances na_each:v86];

  allObjects = [v75 allObjects];
  [(HMDAppleMediaAccessorySensorModel *)v28 setTransportInformation:allObjects];

  v77 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v73, "communicationProtocol")}];
  [(HMDAppleMediaAccessorySensorModel *)v28 setCommunicationProtocol:v77];

  v78 = *MEMORY[0x277D85DE8];

  return v28;
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke(uint64_t a1, void *a2)
{
  v11[3] = *MEMORY[0x277D85DE8];
  v10[0] = @"HM.serverIdentifier";
  v3 = *(a1 + 32);
  v4 = *(a1 + 40);
  v5 = a2;
  v6 = [v4 serverIdentifier];
  v11[0] = v6;
  v10[1] = @"HM.instanceID";
  v7 = [*(a1 + 40) instanceID];
  v10[2] = @"linkType";
  v11[1] = v7;
  v11[2] = v5;
  v8 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v11 forKeys:v10 count:3];
  [v3 addObject:v8];

  v9 = *MEMORY[0x277D85DE8];
}

void __95__HMDHome_getTransactionFromHAPAccessory_hmdAccessory_uuid_hostAccessoryUUID_objectChangeType___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 transportInfoDictionary];
  [v2 addObject:v3];
}

- (id)getServiceTransaction:(id)transaction parentUUID:(id)d changeType:(unint64_t)type
{
  transactionCopy = transaction;
  dCopy = d;
  instanceID = [transactionCopy instanceID];
  v10 = [HMDService generateUUIDWithAccessoryUUID:dCopy serviceID:instanceID];

  v11 = [(HMDBackingStoreModelObject *)[HMDServiceTransaction alloc] initWithObjectChangeType:type uuid:v10 parentUUID:dCopy];
  if (transactionCopy)
  {
    instanceID2 = [transactionCopy instanceID];
    [(HMDServiceTransaction *)v11 setInstanceID:instanceID2];

    type = [transactionCopy type];
    [(HMDServiceTransaction *)v11 setServiceType:type];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = transactionCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v15 = v14;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      endpoint = [v16 endpoint];

      [(HMDServiceTransaction *)v11 setMatterEndpointID:endpoint];
    }

    linkedServices = [transactionCopy linkedServices];

    if (linkedServices)
    {
      linkedServices2 = [transactionCopy linkedServices];
      v20 = [linkedServices2 copy];
      [(HMDServiceTransaction *)v11 setLinkedServices:v20];
    }

    v21 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(transactionCopy, "serviceProperties")}];
    [(HMDServiceTransaction *)v11 setServiceProperties:v21];
  }

  return v11;
}

- (void)evaluateResidentUpdate
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_evaluateResidentUpdate__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)reEvaluateHomeHubState
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __33__HMDHome_reEvaluateHomeHubState__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __33__HMDHome_reEvaluateHomeHubState__block_invoke(uint64_t a1)
{
  v17[1] = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) residentDeviceManager];
  v3 = [v2 residentDevices];

  v4 = 2 * ([v3 count] != 0);
  v5 = [*(a1 + 32) residentDeviceManager];
  v6 = [v5 primaryResidentDevice];

  if ([v6 isEnabled] && objc_msgSend(v6, "isReachable"))
  {
    v4 = 1;
  }

  v7 = *(a1 + 32);
  if (*(v7 + 784) != v4)
  {
    *(v7 + 784) = v4;
    v8 = MEMORY[0x277D0F818];
    v9 = *MEMORY[0x277CCFFF8];
    v16 = *MEMORY[0x277CCFFF0];
    v10 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(*(a1 + 32), "homeHubState")}];
    v17[0] = v10;
    v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v17 forKeys:&v16 count:1];
    v12 = [v8 messageWithName:v9 messagePayload:v11];

    v13 = [*(a1 + 32) msgDispatcher];
    v14 = [*(a1 + 32) uuid];
    [v13 sendMessage:v12 target:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (id)matterAccessoriesWithNewFirmwareInstalledInHome
{
  v37 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  if (([(HMDHome *)self isOwnerUser]|| [(HMDHome *)self isSharedAdmin]) && ![(HMDHome *)self isAutomaticThirdPartyAccessorySoftwareUpdateEnabled])
  {
    v28 = 0u;
    v29 = 0u;
    v26 = 0u;
    v27 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories copy];

    v5 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v27;
      selfCopy = self;
      v23 = v4;
      v20 = *v27;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v27 != v7)
          {
            objc_enumerationMutation(v4);
          }

          v9 = *(*(&v26 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v10 = v9;
          }

          else
          {
            v10 = 0;
          }

          v11 = v10;

          if ([v11 supportsCHIP])
          {
            softwareUpdate = [v9 softwareUpdate];
            v13 = softwareUpdate;
            if (softwareUpdate && [softwareUpdate state] == 4)
            {
              context = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v15 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
              {
                v16 = HMFGetLogIdentifier();
                uuid = [v9 uuid];
                uUIDString = [uuid UUIDString];
                *buf = 138543874;
                v31 = v16;
                v32 = 2114;
                v33 = uUIDString;
                v34 = 2112;
                v35 = v13;
                _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware recently installed, softwareUpdate %@", buf, 0x20u);

                self = selfCopy;
                v7 = v20;
              }

              objc_autoreleasePoolPop(context);
              [array addObject:v9];
              v4 = v23;
            }
          }
        }

        v6 = [v4 countByEnumeratingWithState:&v26 objects:v36 count:16];
      }

      while (v6);
    }
  }

  v18 = *MEMORY[0x277D85DE8];

  return array;
}

- (void)_handleConfirmResidentRequest:(id)request
{
  requestCopy = request;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome__handleConfirmResidentRequest___block_invoke;
  v7[3] = &unk_2797359D8;
  v8 = requestCopy;
  v6 = requestCopy;
  [residentDeviceManager confirmWithCompletionHandler:v7];
}

- (id)namesOfServicesWithNewFirmwareAvailableInHome
{
  v84 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  if ([(HMDHome *)self isOwnerUser])
  {
    v73 = 0u;
    v74 = 0u;
    v71 = 0u;
    v72 = 0u;
    accessories = [(HMDHome *)self accessories];
    v4 = [accessories copy];

    obj = v4;
    v5 = [v4 countByEnumeratingWithState:&v71 objects:v83 count:16];
    if (!v5)
    {
      goto LABEL_56;
    }

    v7 = v5;
    v8 = *v72;
    *&v6 = 138544130;
    v59 = v6;
    v68 = *v72;
    while (1)
    {
      v9 = 0;
      v69 = v7;
      do
      {
        if (*v72 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v71 + 1) + 8 * v9);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) != 0 && v10)
        {
          if (!-[HMDHome isAutomaticThirdPartyAccessorySoftwareUpdateEnabled](self, "isAutomaticThirdPartyAccessorySoftwareUpdateEnabled") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v12 = objc_claimAutoreleasedReturnValue(), [v12 availableResidentDevices], v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "count"), v13, v12, !v14))
          {
            selfCopy = self;
            v16 = v10;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            v18 = v17;

            if (![v18 supportsCHIP])
            {
              vendorInfo = [v16 vendorInfo];
              firmwareVersion = [v16 firmwareVersion];
              if (firmwareVersion && [v16 isPrimary])
              {
                firmwareVersion2 = [vendorInfo firmwareVersion];
                firmwareVersion3 = [v16 firmwareVersion];
                v37 = [firmwareVersion2 isGreaterThanVersion:firmwareVersion3];
              }

              else
              {
                v37 = 0;
              }

              if (vendorInfo && ([vendorInfo firmwareVersion], (v38 = objc_claimAutoreleasedReturnValue()) != 0) && (v39 = v38, v40 = objc_msgSend(v16, "isPrimary"), v39, (v40 & 1) != 0))
              {
                if (!v37)
                {
                  self = selfCopy;
                  v8 = v68;
                  goto LABEL_51;
                }

                v41 = objc_autoreleasePoolPush();
                v42 = selfCopy;
                v43 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
                {
                  v44 = HMFGetLogIdentifier();
                  uuid = [v16 uuid];
                  uUIDString = [uuid UUIDString];
                  [vendorInfo firmwareVersion];
                  v46 = v65 = v41;
                  [vendorInfo productData];
                  v47 = v60 = v42;
                  *buf = v59;
                  v76 = v44;
                  v77 = 2114;
                  v78 = uUIDString;
                  v79 = 2114;
                  v80 = v46;
                  v81 = 2112;
                  v82 = v47;
                  _os_log_impl(&dword_2531F8000, v43, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ has a firmware update, vendor database indicates available firmware version %{public}@ for product data %@", buf, 0x2Au);

                  v42 = v60;
                  v41 = v65;
                }

                objc_autoreleasePoolPop(v41);
                namesOfServicesShowingTilesInHomeApp = [v16 namesOfServicesShowingTilesInHomeApp];
                [array addObjectsFromArray:namesOfServicesShowingTilesInHomeApp];
              }

              else
              {
                softwareUpdate = [v16 softwareUpdate];
                namesOfServicesShowingTilesInHomeApp = softwareUpdate;
                if (softwareUpdate && [softwareUpdate state] == 2)
                {
                  v49 = objc_autoreleasePoolPush();
                  v50 = selfCopy;
                  v51 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
                  {
                    v61 = HMFGetLogIdentifier();
                    uuid2 = [v16 uuid];
                    [uuid2 UUIDString];
                    v52 = v66 = v49;
                    firmwareVersion4 = [v16 firmwareVersion];
                    *buf = 138543874;
                    v76 = v61;
                    v77 = 2114;
                    v78 = v52;
                    v79 = 2114;
                    v80 = firmwareVersion4;
                    v54 = firmwareVersion4;
                    _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_INFO, "%{public}@Accessory %{public}@ currentFirmwareVersion %{public}@ has a firmware update", buf, 0x20u);

                    v49 = v66;
                  }

                  objc_autoreleasePoolPop(v49);
                  name = [v16 name];
                  [array addObject:name];
                }
              }

              self = selfCopy;
              v8 = v68;
              goto LABEL_50;
            }

            softwareUpdate2 = [v16 softwareUpdate];
            vendorInfo = softwareUpdate2;
            if (softwareUpdate2 && [softwareUpdate2 state] == 2)
            {
              v21 = objc_autoreleasePoolPush();
              v22 = selfCopy;
              v23 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
              {
                v24 = HMFGetLogIdentifier();
                [v16 uuid];
                v25 = v64 = v21;
                uUIDString2 = [v25 UUIDString];
                *buf = 138543618;
                v76 = v24;
                v77 = 2114;
                v78 = uUIDString2;
                _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Matter accessory %{public}@ has a firmware update", buf, 0x16u);

                v21 = v64;
              }

              objc_autoreleasePoolPop(v21);
              namesOfServicesShowingTilesInHomeApp = [v16 name];
              [array addObject:namesOfServicesShowingTilesInHomeApp];
              self = selfCopy;
              v8 = v68;
              goto LABEL_50;
            }

            self = selfCopy;
            v8 = v68;
LABEL_51:

            v7 = v69;
          }
        }

        else
        {
          v28 = v10;
          objc_opt_class();
          v29 = objc_opt_isKindOfClass();

          if ((v29 & 1) != 0 && v10 && ![(HMDHome *)self isAutomaticSoftwareUpdateEnabled])
          {
            v30 = v28;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v31 = v30;
            }

            else
            {
              v31 = 0;
            }

            v18 = v31;

            softwareUpdate3 = [v18 softwareUpdate];
            vendorInfo = softwareUpdate3;
            if (!softwareUpdate3)
            {
              goto LABEL_51;
            }

            state = [softwareUpdate3 state];
            if (state >= 2)
            {
              if (state == 2)
              {
                goto LABEL_49;
              }
            }

            else
            {
              if (![v18 supportsTVOSUpdateManualUpdateAvailableNotification])
              {
                goto LABEL_51;
              }

LABEL_49:
              namesOfServicesShowingTilesInHomeApp = [v18 name];
              [array addObject:namesOfServicesShowingTilesInHomeApp];
LABEL_50:
            }

            goto LABEL_51;
          }
        }

        ++v9;
      }

      while (v7 != v9);
      v56 = [obj countByEnumeratingWithState:&v71 objects:v83 count:16];
      v7 = v56;
      if (!v56)
      {
LABEL_56:

        break;
      }
    }
  }

  v57 = *MEMORY[0x277D85DE8];

  return array;
}

- (BOOL)_hasPairedReachableBTLEAccessories
{
  hapAccessories = [(HMDHome *)self hapAccessories];
  v3 = [hapAccessories na_any:&__block_literal_global_938];

  return v3;
}

unint64_t __45__HMDHome__hasPairedReachableBTLEAccessories__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 hasBTLELink])
  {
    v3 = ([v2 reachableTransports] >> 1) & 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)_registerForReachabilityChangeNotificationsEnabled:(BOOL)enabled completionHandler:(id)handler
{
  enabledCopy = enabled;
  v33 = *MEMORY[0x277D85DE8];
  handlerCopy = handler;
  isCurrentDevicePrimaryResident = [(HMDHome *)self isCurrentDevicePrimaryResident];
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  v11 = v10;
  if (isCurrentDevicePrimaryResident)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      *buf = 138543362;
      v30 = v12;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability notifications because we are the primary resident", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    handlerCopy[2](handlerCopy, 1);
  }

  else
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = HMFBooleanToString();
      *buf = 138543618;
      v30 = v13;
      v31 = 2112;
      v32 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Setting remote accessory reachability notifications enabled to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    uuid = [(HMDHome *)selfCopy uuid];
    uUIDString = [uuid UUIDString];

    v27 = *MEMORY[0x277CD0640];
    v28 = uUIDString;
    v17 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v28 forKeys:&v27 count:1];
    objc_initWeak(buf, selfCopy);
    if (enabledCopy)
    {
      v18 = @"kEnableAccessoryReachabilityNotificationRequestKey";
    }

    else
    {
      v18 = @"kDisableAccessoryReachabilityNotificationRequestKey";
    }

    v23[0] = MEMORY[0x277D85DD0];
    v23[1] = 3221225472;
    v23[2] = __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke;
    v23[3] = &unk_2797221E8;
    objc_copyWeak(&v25, buf);
    v26 = enabledCopy;
    v24 = handlerCopy;
    v19 = [HMDRemoteMessage messageWithName:v18 messagePayload:v17 responseHandler:v23];
    uuid2 = [(HMDHome *)selfCopy uuid];
    workQueue = [(HMDHome *)selfCopy workQueue];
    [(HMDHome *)selfCopy redispatchToResidentMessage:v19 target:uuid2 responseQueue:workQueue];

    objc_destroyWeak(&v25);
    objc_destroyWeak(buf);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome__registerForReachabilityChangeNotificationsEnabled_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v28 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (!WeakRetained)
  {
    goto LABEL_15;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = WeakRetained;
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v12 = HMFGetLogIdentifier();
    v13 = *(a1 + 48);
    v22 = 138543874;
    v23 = v12;
    if (v13)
    {
      v14 = "register";
    }

    else
    {
      v14 = "de-register";
    }

    v24 = 2080;
    v25 = v14;
    v26 = 2112;
    v27 = v5;
    v15 = "%{public}@Failed to %s remote accessory reachability notification with error: %@";
    v16 = v10;
    v17 = 32;
  }

  else
  {
    if (!v11)
    {
      goto LABEL_13;
    }

    v18 = HMFGetLogIdentifier();
    v12 = v18;
    v19 = "de-registered";
    if (*(a1 + 48))
    {
      v19 = "registered";
    }

    v22 = 138543618;
    v23 = v18;
    v24 = 2080;
    v25 = v19;
    v15 = "%{public}@Successfully %s remote accessory reachability notification";
    v16 = v10;
    v17 = 22;
  }

  _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, v15, &v22, v17);

LABEL_13:
  objc_autoreleasePoolPop(v8);
  v20 = *(a1 + 32);
  if (v20)
  {
    (*(v20 + 16))(v20, v5 == 0);
  }

LABEL_15:

  v21 = *MEMORY[0x277D85DE8];
}

- (BOOL)currentRemoteReachabilityRegistration
{
  stagedRemoteReachabilityRegistration = [(HMDHome *)self stagedRemoteReachabilityRegistration];
  value = [stagedRemoteReachabilityRegistration value];

  LOBYTE(stagedRemoteReachabilityRegistration) = [value BOOLValue];
  return stagedRemoteReachabilityRegistration;
}

- (id)_primaryAccessoryForServer:(id)server
{
  v20 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  [(HMDHome *)self hapAccessoriesForServer:serverCopy];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v5 = v18 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = *v16;
    while (2)
    {
      for (i = 0; i != v6; i = i + 1)
      {
        if (*v16 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = *(*(&v15 + 1) + 8 * i);
        if ([v9 isPrimary])
        {
          v14 = 0;
          identifier = [serverCopy identifier];
          v11 = [v9 matchesHAPAccessoryWithServerIdentifier:identifier linkType:&v14];

          if (v11)
          {
            v6 = v9;
            goto LABEL_12;
          }
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  v12 = *MEMORY[0x277D85DE8];

  return v6;
}

- (id)hapAccessoriesForServer:(id)server
{
  serverCopy = server;
  identifier = [serverCopy identifier];
  linkType = [serverCopy linkType];

  v7 = [(HMDHome *)self hapAccessoriesForServer:identifier linkType:linkType];

  return v7;
}

- (id)hapAccessoriesForServer:(id)server linkType:(int64_t)type
{
  v25 = *MEMORY[0x277D85DE8];
  serverCopy = server;
  accessories = [(HMDHome *)self accessories];
  v8 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v9 = accessories;
  v10 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v21;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v21 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v20 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v16 = v15;

        if (v16)
        {
          typeCopy = type;
          if ([v16 matchesHAPAccessoryWithServerIdentifier:serverCopy linkType:&typeCopy])
          {
            [v8 addObject:v16];
          }
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v11);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)readProfileState:(id)state viaDevice:(id)device
{
  stateCopy = state;
  deviceCopy = device;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __38__HMDHome_readProfileState_viaDevice___block_invoke;
  block[3] = &unk_279734960;
  block[4] = self;
  v12 = stateCopy;
  v13 = deviceCopy;
  v9 = deviceCopy;
  v10 = stateCopy;
  dispatch_async(workQueue, block);
}

- (void)_getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion
{
  deviceStateCopy = deviceState;
  stateCopy = state;
  optionsCopy = options;
  v112 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v10 = completionCopy;
  if (!completionCopy)
  {
    goto LABEL_80;
  }

  v75 = deviceStateCopy;
  v76 = completionCopy;
  accessories = [(HMDHome *)self accessories];
  v12 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(accessories, "count")}];
  strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  v77 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  supportsUnifiedMediaNotificationsOnResidents = [(HMDHome *)self supportsUnifiedMediaNotificationsOnResidents];
  v103 = 0u;
  v104 = 0u;
  v105 = 0u;
  v106 = 0u;
  obj = accessories;
  selfCopy = self;
  v86 = v12;
  v92 = [obj countByEnumeratingWithState:&v103 objects:v111 count:16];
  if (!v92)
  {
    goto LABEL_59;
  }

  v91 = optionsCopy & 0x201;
  v90 = optionsCopy & 0x50;
  v89 = *v104;
  v85 = *MEMORY[0x277CD0938];
  v84 = *MEMORY[0x277CD0990];
  v83 = *MEMORY[0x277CD0960];
  v82 = *MEMORY[0x277CD09B0];
  v81 = *MEMORY[0x277CD0920];
  v88 = optionsCopy;
  do
  {
    for (i = 0; i != v92; ++i)
    {
      if (*v104 != v89)
      {
        objc_enumerationMutation(obj);
      }

      v14 = *(*(&v103 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v15 = v14;
      }

      else
      {
        v15 = 0;
      }

      v16 = v15;

      v17 = v16;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v18 = v17;
      }

      else
      {
        v18 = 0;
      }

      v19 = v18;

      v20 = v17;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v21 = v20;
      }

      else
      {
        v21 = 0;
      }

      v22 = v21;

      v23 = v14;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v24 = v23;
      }

      else
      {
        v24 = 0;
      }

      v25 = v24;

      if (v20)
      {
        v26 = stateCopy;
      }

      else
      {
        v26 = 0;
      }

      if (v90)
      {
        v27 = v22 == 0;
      }

      else
      {
        v27 = 1;
      }

      v28 = !v27;
      v94 = v19;
      if (v91)
      {
        v29 = v25 == 0;
      }

      else
      {
        v29 = 1;
      }

      v30 = !v29;
      if (v26 || (v28 & 1) != 0 || ((v19 != 0) & (optionsCopy >> 8)) != 0 || (v30 & 1) != 0 || (optionsCopy & 0x400) != 0 && [v25 hasTelevisionService])
      {
        runtimeState = [v23 runtimeState];
        v32 = [runtimeState mutableCopy];

        if (v20 && stateCopy)
        {
          mediaProfile = [v20 mediaProfile];
          v34 = mediaProfile;
          if (mediaProfile)
          {
            mediaSession = [mediaProfile mediaSession];
            state = [mediaSession state];
            if (state)
            {
              v37 = state;
              goto LABEL_46;
            }

            identifier = [v20 identifier];
            v37 = [(HMDHome *)selfCopy mediaSessionStateWithIdentifier:identifier];

            if (v37)
            {
LABEL_46:
              v39 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v37, "playbackState")}];
              [v32 setObject:v39 forKeyedSubscript:v85];

              v40 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v37, "shuffleState")}];
              [v32 setObject:v40 forKeyedSubscript:v84];

              v41 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(v37, "repeatState")}];
              [v32 setObject:v41 forKeyedSubscript:v83];

              volume = [v37 volume];
              [v32 setObject:volume forKeyedSubscript:v82];

              mediaUniqueIdentifier = [v37 mediaUniqueIdentifier];
              [v32 setObject:mediaUniqueIdentifier forKeyedSubscript:v81];
            }

            if (!mediaSession)
            {
              device = [v22 device];
              if ((device == 0) | supportsUnifiedMediaNotificationsOnResidents & 1)
              {
                [v77 addObject:v34];
              }

              else
              {
                array = [strongToStrongObjectsMapTable objectForKey:device];
                if (!array)
                {
                  array = [MEMORY[0x277CBEB18] array];
                  [strongToStrongObjectsMapTable setObject:array forKey:device];
                }

                [array addObject:v34];
              }
            }

            v12 = v86;
          }
        }

        v46 = [v32 copy];
        uuid = [v23 uuid];
        uUIDString = [uuid UUIDString];
        [v12 setObject:v46 forKeyedSubscript:uUIDString];

        optionsCopy = v88;
      }
    }

    v92 = [obj countByEnumeratingWithState:&v103 objects:v111 count:16];
  }

  while (v92);
LABEL_59:

  v109 = *MEMORY[0x277CCE7A8];
  v49 = [v12 copy];
  v110 = v49;
  v50 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v110 forKeys:&v109 count:1];
  v51 = [v50 mutableCopy];

  v10 = v76;
  v52 = selfCopy;
  if (v75)
  {
    residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];

    v55 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:{objc_msgSend(residentDevices, "count")}];
    v99 = 0u;
    v100 = 0u;
    v101 = 0u;
    v102 = 0u;
    v56 = residentDevices;
    v57 = [v56 countByEnumeratingWithState:&v99 objects:v108 count:16];
    if (v57)
    {
      v58 = v57;
      v59 = *v100;
      do
      {
        for (j = 0; j != v58; ++j)
        {
          if (*v100 != v59)
          {
            objc_enumerationMutation(v56);
          }

          v61 = *(*(&v99 + 1) + 8 * j);
          identifier2 = [v61 identifier];
          uUIDString2 = [identifier2 UUIDString];

          runtimeState2 = [v61 runtimeState];
          [v55 setObject:runtimeState2 forKey:uUIDString2];
        }

        v58 = [v56 countByEnumeratingWithState:&v99 objects:v108 count:16];
      }

      while (v58);
    }

    v65 = [v55 copy];
    [v51 setObject:v65 forKey:*MEMORY[0x277CD0550]];

    v52 = selfCopy;
    v12 = v86;
  }

  v66 = [v51 copy];
  v76[2](v76, v66);

  if ([v77 count])
  {
    [(HMDHome *)v52 _readProfileState:v77 viaDevice:0];
  }

  v97 = 0u;
  v98 = 0u;
  v95 = 0u;
  v96 = 0u;
  v67 = strongToStrongObjectsMapTable;
  v68 = [v67 countByEnumeratingWithState:&v95 objects:v107 count:16];
  if (v68)
  {
    v69 = v68;
    v70 = *v96;
    do
    {
      for (k = 0; k != v69; ++k)
      {
        if (*v96 != v70)
        {
          objc_enumerationMutation(v67);
        }

        v72 = *(*(&v95 + 1) + 8 * k);
        v73 = [v67 objectForKey:v72];
        if ([v73 count])
        {
          [(HMDHome *)v52 _readProfileState:v73 viaDevice:v72];
        }
      }

      v69 = [v67 countByEnumeratingWithState:&v95 objects:v107 count:16];
    }

    while (v69);
  }

LABEL_80:
  v74 = *MEMORY[0x277D85DE8];
}

- (void)getRunTimeStateUpdateWithOptions:(unint64_t)options includeMediaAccessorySessionState:(BOOL)state includeResidentDeviceState:(BOOL)deviceState completion:(id)completion
{
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __116__HMDHome_getRunTimeStateUpdateWithOptions_includeMediaAccessorySessionState_includeResidentDeviceState_completion___block_invoke;
  v13[3] = &unk_2797221C0;
  v14 = completionCopy;
  optionsCopy = options;
  stateCopy = state;
  deviceStateCopy = deviceState;
  v13[4] = self;
  v12 = completionCopy;
  dispatch_async(workQueue, v13);
}

- (void)checkTimerTriggers
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_checkTimerTriggers__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __29__HMDHome_checkTimerTriggers__block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v1 = [*(a1 + 32) triggers];
  v2 = [v1 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v9;
    do
    {
      v5 = 0;
      do
      {
        if (*v9 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v6 = *(*(&v8 + 1) + 8 * v5);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [v6 completeConfiguration];
        }

        ++v5;
      }

      while (v3 != v5);
      v3 = [v1 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v3);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (id)migrateOwnedTriggers
{
  v40 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_ownedTriggers copy];
  os_unfair_recursive_lock_unlock();
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  obj = [(HMDHome *)self triggers];
  v4 = [obj countByEnumeratingWithState:&v29 objects:v39 count:16];
  if (!v4)
  {
    goto LABEL_17;
  }

  v6 = *v30;
  *&v5 = 138543618;
  v26 = v5;
  do
  {
    for (i = 0; i != v4; ++i)
    {
      if (*v30 != v6)
      {
        objc_enumerationMutation(obj);
      }

      v8 = *(*(&v29 + 1) + 8 * i);
      uuid = [v8 uuid];
      if (([v3 containsObject:uuid] & 1) == 0)
      {

        continue;
      }

      owningDevice = [v8 owningDevice];
      if (owningDevice)
      {
        isOwnedByThisDevice = [v8 isOwnedByThisDevice];

        if (isOwnedByThisDevice)
        {
          continue;
        }
      }

      else
      {
      }

      currentUser = [(HMDHome *)self currentUser];
      [v8 setOwner:currentUser];

      currentDevice = [(HMDHome *)self currentDevice];
      [v8 setOwningDevice:currentDevice];

      uuid2 = [v8 uuid];
      uUIDString = [uuid2 UUIDString];
      [array addObject:uUIDString];

      v16 = objc_autoreleasePoolPush();
      selfCopy = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        *buf = v26;
        v36 = v19;
        v37 = 2112;
        v38 = v8;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Updating owning device for trigger %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v16);
    }

    v4 = [obj countByEnumeratingWithState:&v29 objects:v39 count:16];
  }

  while (v4);
LABEL_17:

  if ([array count])
  {
    v34[0] = array;
    v20 = *MEMORY[0x277CD0640];
    v33[0] = @"triggerUUID";
    v33[1] = v20;
    uuid3 = [(HMDHome *)self uuid];
    uUIDString2 = [uuid3 UUIDString];
    v34[1] = uUIDString2;
    v23 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v34 forKeys:v33 count:2];
  }

  else
  {
    v23 = 0;
  }

  v24 = *MEMORY[0x277D85DE8];

  return v23;
}

- (id)performReadRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow
{
  v55 = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = requestsCopy;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        characteristic = [v17 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        uuid = [accessory uuid];

        v22 = [dictionary objectForKeyedSubscript:uuid];

        if (v22)
        {
          v23 = [dictionary objectForKeyedSubscript:uuid];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [dictionary setObject:v23 forKeyedSubscript:uuid];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  allValues = [dictionary allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_279722178;
  intervalCopy = interval;
  retriesCopy = retries;
  v45[4] = self;
  v25 = objectCopy;
  v46 = v25;
  v26 = flowCopy;
  v47 = v26;
  v27 = [allValues na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  workQueue = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:workQueue];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_922;
  v42[3] = &unk_279730870;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_279722150;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_922(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_925];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All read request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_923(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __75__HMDHome_performReadRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic read requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performReadRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performWriteRequests:(id)requests withRetries:(int64_t)retries timeInterval:(double)interval loggingObject:(id)object flow:(id)flow
{
  v55 = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v50 = 0u;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v12 = requestsCopy;
  v13 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
  if (v13)
  {
    v14 = v13;
    v15 = *v51;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v51 != v15)
        {
          objc_enumerationMutation(v12);
        }

        v17 = *(*(&v50 + 1) + 8 * i);
        characteristic = [v17 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        uuid = [accessory uuid];

        v22 = [dictionary objectForKeyedSubscript:uuid];

        if (v22)
        {
          v23 = [dictionary objectForKeyedSubscript:uuid];
          [v23 addObject:v17];
        }

        else
        {
          v23 = [MEMORY[0x277CBEB18] arrayWithObject:v17];
          [dictionary setObject:v23 forKeyedSubscript:uuid];
        }
      }

      v14 = [v12 countByEnumeratingWithState:&v50 objects:v54 count:16];
    }

    while (v14);
  }

  allValues = [dictionary allValues];
  v45[0] = MEMORY[0x277D85DD0];
  v45[1] = 3221225472;
  v45[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke;
  v45[3] = &unk_279722178;
  intervalCopy = interval;
  retriesCopy = retries;
  v45[4] = self;
  v25 = objectCopy;
  v46 = v25;
  v26 = flowCopy;
  v47 = v26;
  v27 = [allValues na_map:v45];

  v28 = MEMORY[0x277D2C900];
  v29 = MEMORY[0x277D2C938];
  workQueue = [(HMDHome *)self workQueue];
  v31 = [v29 schedulerWithDispatchQueue:workQueue];
  v32 = [v28 combineAllFutures:v27 ignoringErrors:1 scheduler:v31];
  v42[0] = MEMORY[0x277D85DD0];
  v42[1] = 3221225472;
  v42[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_916;
  v42[3] = &unk_279730870;
  v43 = v25;
  v44 = v26;
  v33 = v26;
  v34 = v25;
  v35 = [v32 flatMap:v42];

  v36 = *MEMORY[0x277D85DE8];

  return v35;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = MEMORY[0x277D2C900];
  v5 = *(a1 + 56);
  v6 = *(a1 + 64);
  v7 = [*(a1 + 32) workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2;
  v13[3] = &unk_279722150;
  v14 = *(a1 + 40);
  v8 = *(a1 + 48);
  v9 = *(a1 + 32);
  v15 = v8;
  v16 = v9;
  v17 = v3;
  v10 = v3;
  v11 = [v4 futureWithRetries:v5 timeInterval:v7 workQueue:v13 block:v6];

  return v11;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_916(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = [v3 na_map:&__block_literal_global_920];
  if ([v4 hmf_isEmpty])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = [*(a1 + 40) UUID];
      v17 = 138543618;
      v18 = v8;
      v19 = 2112;
      v20 = v9;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] All write request retries failed.", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    v10 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    v12 = [v10 futureWithError:v11];
  }

  else
  {
    v13 = MEMORY[0x277D2C900];
    v11 = [MEMORY[0x277CBEAC0] dictionaryByCombiningNonOverlappingDictionaries:v4];
    v12 = [v13 futureWithResult:v11];
  }

  v14 = v12;

  v15 = *MEMORY[0x277D85DE8];

  return v14;
}

void *__76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2_917(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

id __76__HMDHome_performWriteRequests_withRetries_timeInterval_loggingObject_flow___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x277D85DE8];
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v8 = [*(a1 + 40) UUID];
    v12 = 138543874;
    v13 = v7;
    v14 = 2112;
    v15 = v8;
    v16 = 2048;
    v17 = a2;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Performing characteristic write requests with remaining retries: %ld", &v12, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = [*(a1 + 48) performWriteRequests:*(a1 + 56) loggingObject:*(a1 + 32) flow:*(a1 + 40)];
  v10 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)performReadRequests:(id)requests loggingObject:(id)object flow:(id)flow
{
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  v12 = [(HMDHome *)self description];
  v20[0] = MEMORY[0x277D85DD0];
  v20[1] = 3221225472;
  v20[2] = __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke;
  v20[3] = &unk_27972CD68;
  v21 = objectCopy;
  v22 = flowCopy;
  v13 = v11;
  v23 = v13;
  v24 = requestsCopy;
  v14 = requestsCopy;
  v15 = flowCopy;
  v16 = objectCopy;
  [(HMDHome *)self readCharacteristicValues:v14 source:1120 sourceForLogging:v12 qualityOfService:-1 withCompletionHandler:v20];

  v17 = v24;
  v18 = v13;

  return v13;
}

void __50__HMDHome_performReadRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform read requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (id)performWriteRequests:(id)requests loggingObject:(id)object flow:(id)flow
{
  v42 = *MEMORY[0x277D85DE8];
  requestsCopy = requests;
  objectCopy = object;
  flowCopy = flow;
  v11 = objc_alloc_init(MEMORY[0x277D2C900]);
  uUID = [MEMORY[0x277CCAD78] UUID];
  v13 = objc_autoreleasePoolPush();
  selfCopy = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
  {
    v16 = HMFGetLogIdentifier();
    uUID2 = [flowCopy UUID];
    *buf = 0;
    *&buf[8] = 0;
    if (uUID)
    {
      [uUID getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v32 = *buf;
    v18 = [requestsCopy count];
    *buf = 138544642;
    *&buf[4] = v16;
    *&buf[12] = 2112;
    *&buf[14] = uUID2;
    v34 = 1042;
    v35 = 16;
    v36 = 2098;
    v37 = &v32;
    v38 = 2114;
    v39 = selfCopy;
    v40 = 2048;
    v41 = v18;
    _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Executing write requests with identifier: %{public,uuid_t}.16P from home: %{public}@ count: %lu for perform write requests", buf, 0x3Au);
  }

  objc_autoreleasePoolPop(v13);
  v27[0] = MEMORY[0x277D85DD0];
  v27[1] = 3221225472;
  v27[2] = __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke;
  v27[3] = &unk_27972CD68;
  v28 = objectCopy;
  v29 = flowCopy;
  v19 = v11;
  v30 = v19;
  v31 = requestsCopy;
  v20 = requestsCopy;
  v21 = flowCopy;
  v22 = objectCopy;
  [(HMDHome *)selfCopy writeCharacteristicValues:v20 source:1120 identifier:uUID transport:0 qualityOfService:-1 withCompletionHandler:v27];
  v23 = v31;
  v24 = v19;

  v25 = *MEMORY[0x277D85DE8];
  return v19;
}

void __51__HMDHome_performWriteRequests_loggingObject_flow___block_invoke(id *a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = [a1[7] firstObject];
    v8 = [v7 characteristic];

    v24 = 0;
    v9 = [v6 hmd_valueOfCharacteristic:v8 error:&v24];
    v10 = v24;
    if (v9)
    {
      [a1[6] finishWithResult:v6];
    }

    else
    {
      v17 = objc_autoreleasePoolPush();
      v18 = a1[4];
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        v20 = HMFGetLogIdentifier();
        [a1[5] UUID];
        v21 = v23 = v17;
        *buf = 138543874;
        v26 = v20;
        v27 = 2112;
        v28 = v21;
        v29 = 2112;
        v30 = v10;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests with error: %@", buf, 0x20u);

        v17 = v23;
      }

      objc_autoreleasePoolPop(v17);
      [a1[6] finishWithError:v10];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = a1[4];
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [a1[5] UUID];
      *buf = 138543874;
      v26 = v14;
      v27 = 2112;
      v28 = v15;
      v29 = 2112;
      v30 = v5;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@[Flow: %@] Failed to perform write requests (no response payload) with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    v16 = a1[6];
    v8 = [MEMORY[0x277CBEB68] null];
    [v16 finishWithResult:v8];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)writeCharacteristicValues:(id)values source:(unint64_t)source biomeSource:(unint64_t)biomeSource identifier:(id)identifier transport:(id)transport qualityOfService:(int64_t)service withCompletionHandler:(id)handler
{
  valuesCopy = values;
  identifierCopy = identifier;
  transportCopy = transport;
  handlerCopy = handler;
  v19 = objc_alloc(MEMORY[0x277D0F770]);
  v20 = MEMORY[0x277CCACA8];
  v21 = MEMORY[0x259C01AE0](self, a2);
  7421 = [v20 stringWithFormat:@"%@, %s:%ld", v21, "/Library/Caches/com.apple.xbs/Sources/HomeKit_executables_legacy/Sources/homed/Home/HMDHome.m", 7421];
  v39 = [v19 initWithName:7421];

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke;
  block[3] = &unk_279722128;
  sourceCopy = source;
  serviceCopy = service;
  v30 = v39;
  v31 = identifierCopy;
  v32 = transportCopy;
  selfCopy = self;
  biomeSourceCopy = biomeSource;
  v34 = valuesCopy;
  v35 = handlerCopy;
  v24 = handlerCopy;
  v25 = valuesCopy;
  v26 = transportCopy;
  v27 = identifierCopy;
  dispatch_async(workQueue, block);

  __HMFActivityScopeLeave();
}

void __116__HMDHome_writeCharacteristicValues_source_biomeSource_identifier_transport_qualityOfService_withCompletionHandler___block_invoke(uint64_t a1)
{
  v23[2] = *MEMORY[0x277D85DE8];
  v22[0] = @"sourceType";
  v2 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:*(a1 + 80)];
  v22[1] = @"kMultiPartResponseKey";
  v23[0] = v2;
  v23[1] = MEMORY[0x277CBEC28];
  v3 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v23 forKeys:v22 count:2];

  v4 = objc_alloc(MEMORY[0x277D0F848]);
  v5 = *(a1 + 88);
  v6 = [MEMORY[0x277D0F820] allMessageDestinations];
  v7 = [v4 initWithName:@"kMultipleCharacteristicWriteRequestKey" qualityOfService:v5 destination:v6 payload:v3];

  [v7 setIdentifier:*(a1 + 40)];
  [v7 setTransport:*(a1 + 48)];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 56);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    v12 = [v7 identifier];

    if (v12)
    {
      v13 = [v7 identifier];
      [v13 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v16 = *buf;
    v14 = HMDRequestSourceAsString(*(a1 + 80));
    *buf = 138544130;
    *&buf[4] = v11;
    *&buf[12] = 1042;
    *&buf[14] = 16;
    v18 = 2098;
    v19 = &v16;
    v20 = 2114;
    v21 = v14;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Issuing write requests with identifier: %{public,uuid_t}.16P, source: %{public}@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 56) _writeCharacteristicValues:*(a1 + 64) requestMessage:v7 source:*(a1 + 80) biomeSource:*(a1 + 96) withCompletionHandler:*(a1 + 72)];

  v15 = *MEMORY[0x277D85DE8];
}

- (void)regionStateUpdated
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __29__HMDHome_regionStateUpdated__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __29__HMDHome_regionStateUpdated__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) homeLocationHandler];
  v3 = [v2 regionStateAtHome];

  if (v3 == 1)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v8 = MEMORY[0x277D85DD0];
    v9 = 3221225472;
    v10 = __29__HMDHome_regionStateUpdated__block_invoke_905;
    v11 = &unk_279735D00;
    v12 = *(a1 + 32);
    v6 = &v8;
    goto LABEL_5;
  }

  if (v3 == 2)
  {
    v4 = [*(a1 + 32) workQueue];
    v5 = v4;
    v13 = MEMORY[0x277D85DD0];
    v14 = 3221225472;
    v15 = __29__HMDHome_regionStateUpdated__block_invoke_2;
    v16 = &unk_279735D00;
    v17 = *(a1 + 32);
    v6 = &v13;
LABEL_5:
    dispatch_async(v4, v6);
  }

  return [*(a1 + 32) _updateHomeLocation];
}

void __29__HMDHome_regionStateUpdated__block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did leave home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionExitedNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

void __29__HMDHome_regionStateUpdated__block_invoke_905(uint64_t a1)
{
  v10 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v8 = 138543362;
    v9 = v5;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Did enter home region", &v8, 0xCu);
  }

  objc_autoreleasePoolPop(v2);
  v6 = [*(a1 + 32) notificationCenter];
  logAndPostNotificationWithNotificationCenter(v6, @"HMDHomeRegionEnteredNotificationKey", *(a1 + 32), 0);

  v7 = *MEMORY[0x277D85DE8];
}

- (void)suspendedStateChangedForAccessory:(id)accessory suspendedState:(unint64_t)state
{
  v26 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = accessoryCopy;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;

  if (v8)
  {
    if (state == 2)
    {
      v9 = objc_autoreleasePoolPush();
      selfCopy = self;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v12 = HMFGetLogIdentifier();
        v13 = HAPAccessorySuspendedStateDescription();
        *buf = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = accessoryCopy;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEBUG, "%{public}@Skipping suspended state update: '%@' for accessory %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
    }

    else
    {
      workQueue = [(HMDHome *)self workQueue];
      v16[0] = MEMORY[0x277D85DD0];
      v16[1] = 3221225472;
      v16[2] = __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke;
      v16[3] = &unk_279733188;
      v16[4] = self;
      stateCopy = state;
      v17 = v8;
      v18 = accessoryCopy;
      dispatch_async(workQueue, v16);
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

uint64_t __60__HMDHome_suspendedStateChangedForAccessory_suspendedState___block_invoke(uint64_t a1)
{
  v24 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) reachabilityRegisteredDevices];
  v3 = [v2 count];

  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 56);
      v10 = HAPAccessorySuspendedStateDescription();
      v11 = *(a1 + 40);
      v18 = 138543874;
      v19 = v8;
      v20 = 2112;
      v21 = v10;
      v22 = 2112;
      v23 = v11;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of suspended state change to '%@' for accessory: %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    [*(a1 + 32) _updateReachabilityChangeToRegisteredDevices:*(a1 + 48)];
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 56);
      v14 = HAPAccessorySuspendedStateDescription();
      v15 = *(a1 + 48);
      v18 = 138543874;
      v19 = v12;
      v20 = 2112;
      v21 = v14;
      v22 = 2112;
      v23 = v15;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices to send the suspended state change '%@' for accessory %@", &v18, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
  }

  result = [*(a1 + 32) notifyClientsOfReachabilityUpdateForAccessory:*(a1 + 48)];
  v17 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)reachabilityChangedForAccessory:(id)accessory reachable:(BOOL)reachable
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke;
  block[3] = &unk_279734938;
  v10 = accessoryCopy;
  selfCopy = self;
  reachableCopy = reachable;
  v8 = accessoryCopy;
  dispatch_async(workQueue, block);
}

void __53__HMDHome_reachabilityChangedForAccessory_reachable___block_invoke(uint64_t a1)
{
  v22[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  if (v4)
  {
    v5 = *(a1 + 40);
    v22[0] = v4;
    v6 = [MEMORY[0x277CBEA60] arrayWithObjects:v22 count:1];
    [v5 _updateWoWState:v6];
  }

  [*(a1 + 40) _reachabilityChangedForAccessory:*(a1 + 32) reachable:*(a1 + 48)];
  v7 = [*(a1 + 40) reachabilityRegisteredDevices];
  v8 = [v7 count];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = v11;
  if (v8)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v14 = *(a1 + 32);
      v18 = 138543618;
      v19 = v13;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Notify registered devices of reachability change for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _updateReachabilityChangeToRegisteredDevices:*(a1 + 32)];
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      v16 = *(a1 + 32);
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = v16;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@No registered devices available to notify reachability change update for accessory: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (id)replaceActionSetName:(id)name withNewName:(id)newName
{
  v15[1] = *MEMORY[0x277D85DE8];
  newNameCopy = newName;
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v15[0] = uuid;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [nameValidator replaceActionSetName:nameCopy withNewName:newNameCopy inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)replaceName:(id)name withNewName:(id)newName
{
  v15[1] = *MEMORY[0x277D85DE8];
  newNameCopy = newName;
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v15[0] = uuid;
  v11 = [MEMORY[0x277CBEA60] arrayWithObjects:v15 count:1];
  v12 = [nameValidator replaceName:nameCopy withNewName:newNameCopy inNamespaces:v11];

  v13 = *MEMORY[0x277D85DE8];

  return v12;
}

- (id)removeName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v8 = [nameValidator removeName:nameCopy namespace:uuid];

  return v8;
}

- (id)addActionSetName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v8 = [nameValidator addActionSetName:nameCopy namespace:uuid];

  return v8;
}

- (id)addName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  uuid = [(HMDHome *)self uuid];
  v8 = [nameValidator addName:nameCopy namespace:uuid];

  return v8;
}

- (id)validateName:(id)name
{
  nameCopy = name;
  homeManager = [(HMDHome *)self homeManager];
  nameValidator = [homeManager nameValidator];
  v7 = [nameValidator validateName:nameCopy];

  return v7;
}

- (void)removeAllHomeContentsAndAccessoryPairings:(BOOL)pairings queue:(id)queue completionHandler:(id)handler
{
  v24 = *MEMORY[0x277D85DE8];
  queueCopy = queue;
  handlerCopy = handler;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v13;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Removed all home content and accessory pairings", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v10);
  workQueue = [(HMDHome *)selfCopy workQueue];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __77__HMDHome_removeAllHomeContentsAndAccessoryPairings_queue_completionHandler___block_invoke;
  v18[3] = &unk_279732430;
  pairingsCopy = pairings;
  v18[4] = selfCopy;
  v19 = queueCopy;
  v20 = handlerCopy;
  v15 = handlerCopy;
  v16 = queueCopy;
  dispatch_async(workQueue, v18);

  v17 = *MEMORY[0x277D85DE8];
}

- (void)removeCharacteristic:(id)characteristic
{
  characteristicCopy = characteristic;
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __32__HMDHome_removeCharacteristic___block_invoke;
  block[3] = &unk_279732E78;
  objc_copyWeak(&v9, &location);
  v8 = characteristicCopy;
  v6 = characteristicCopy;
  dispatch_async(workQueue, block);

  objc_destroyWeak(&v9);
  objc_destroyWeak(&location);
}

void __32__HMDHome_removeCharacteristic___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(a1 + 32))
  {
    v3 = WeakRetained;
    [WeakRetained _removeCharacteristic:?];
    WeakRetained = v3;
  }
}

- (void)removeService:(id)service
{
  serviceCopy = service;
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __25__HMDHome_removeService___block_invoke;
  v8[3] = &unk_279731EE0;
  objc_copyWeak(v10, &location);
  v9 = serviceCopy;
  v10[1] = a2;
  v7 = serviceCopy;
  dispatch_async(workQueue, v8);

  objc_destroyWeak(v10);
  objc_destroyWeak(&location);
}

void __25__HMDHome_removeService___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained && *(a1 + 32))
  {
    v4 = WeakRetained;
    [WeakRetained _removeService:?];
    v3 = NSStringFromSelector(*(a1 + 48));
    [v4 saveWithReason:v3 postSyncNotification:1];

    WeakRetained = v4;
  }
}

- (void)handleSignificantTimeChange
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    *buf = 138543362;
    v19 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Going to re-evaluate all the triggers as time has changed significantly", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  triggers = [(HMDHome *)selfCopy triggers];
  v8 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v14;
    do
    {
      v11 = 0;
      do
      {
        if (*v14 != v10)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v13 + 1) + 8 * v11++) reEvaluate:1];
      }

      while (v9 != v11);
      v9 = [triggers countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v9);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)reEvaluateTriggers
{
  v13 = *MEMORY[0x277D85DE8];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  triggers = [(HMDHome *)self triggers];
  v3 = [triggers countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      v6 = 0;
      do
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(triggers);
        }

        [*(*(&v8 + 1) + 8 * v6++) reEvaluate:0];
      }

      while (v4 != v6);
      v4 = [triggers countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v4);
  }

  v7 = *MEMORY[0x277D85DE8];
}

- (id)mediaSystemWithUUID:(id)d
{
  dCopy = d;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v6 = [mediaSystems hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)mediaSystemsWithUUIDs:(id)ds
{
  dsCopy = ds;
  mediaSystems = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __33__HMDHome_mediaSystemsWithUUIDs___block_invoke;
  v9[3] = &unk_279726148;
  v10 = dsCopy;
  v6 = dsCopy;
  v7 = [mediaSystems na_filter:v9];

  return v7;
}

uint64_t __33__HMDHome_mediaSystemsWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)removeOutgoingInvitation:(id)invitation
{
  invitationCopy = invitation;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations removeObject:invitationCopy];
  os_unfair_recursive_lock_unlock();
}

- (void)addOutgoingInvitation:(id)invitation
{
  invitationCopy = invitation;
  os_unfair_recursive_lock_lock_with_options();
  [(NSMutableArray *)self->_outgoingInvitations addObject:invitationCopy];
  os_unfair_recursive_lock_unlock();
}

- (void)setOutgoingInvitations:(id)invitations
{
  invitationsCopy = invitations;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [invitationsCopy mutableCopy];
  outgoingInvitations = self->_outgoingInvitations;
  self->_outgoingInvitations = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSArray)outgoingInvitations
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_outgoingInvitations copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (id)outgoingInvitationWithUUID:(id)d
{
  dCopy = d;
  outgoingInvitations = [(HMDHome *)self outgoingInvitations];
  v6 = [outgoingInvitations hmf_firstObjectWithValue:dCopy forKeyPath:@"identifier"];

  return v6;
}

- (id)userWithUUID:(id)d
{
  dCopy = d;
  users = [(HMDHome *)self users];
  v6 = [users hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)serviceGroupWithUUID:(id)d
{
  dCopy = d;
  serviceGroups = [(HMDHome *)self serviceGroups];
  v6 = [serviceGroups hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)serviceGroupWithName:(id)name
{
  nameCopy = name;
  serviceGroups = [(HMDHome *)self serviceGroups];
  v6 = [serviceGroups hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (id)triggerWithUUID:(id)d
{
  dCopy = d;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)triggerWithName:(id)name
{
  nameCopy = name;
  triggers = [(HMDHome *)self triggers];
  v6 = [triggers hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (id)triggerOwnedActionSetWithUUID:(id)d
{
  dCopy = d;
  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v6 = [triggerOwnedActionSets hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)actionSetWithUUID:(id)d
{
  dCopy = d;
  actionSets = [(HMDHome *)self actionSets];
  v6 = [actionSets hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)actionSetWithName:(id)name
{
  nameCopy = name;
  actionSets = [(HMDHome *)self actionSets];
  v6 = [actionSets hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (void)_evaluateOwnerTrustZoneCapabilityAndNotify
{
  v13 = *MEMORY[0x277D85DE8];
  if (![(HMDHome *)self isOwnerTrustZoneCapable])
  {
    if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
    {
      v5 = objc_autoreleasePoolPush();
      selfCopy = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = HMFGetLogIdentifier();
        v11 = 138543362;
        v12 = v8;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after evaluating owner trust zone capability", &v11, 0xCu);
      }

      objc_autoreleasePoolPop(v5);
      [(HMDHome *)selfCopy setOwnerTrustZoneCapable:1];
      notificationCenter = [(HMDHome *)selfCopy notificationCenter];
      [notificationCenter postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:selfCopy];
    }
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleReceivedNonCloudSourcedSharedHomeModel
{
  v13 = *MEMORY[0x277D85DE8];
  if (-[HMDHome _isSharedHomeVersionTrustZoneCapable](self, "_isSharedHomeVersionTrustZoneCapable") || (-[HMDHome residentDeviceManager](self, "residentDeviceManager"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 hasTrustZoneCapableResident], v3, v4))
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Owner became trust zone capable after receiving shared home model", &v11, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setOwnerTrustZoneCapable:1];
    notificationCenter = [(HMDHome *)selfCopy notificationCenter];
    [notificationCenter postNotificationName:@"HMDHomeOwnerBecameTrustZoneCapableNotification" object:selfCopy];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)_isSharedHomeVersionTrustZoneCapable
{
  sharedHomeSourceVersion = [(HMDHome *)self sharedHomeSourceVersion];
  v3 = +[HMDHomeKitVersion version6];
  v4 = [sharedHomeSourceVersion isAtLeastVersion:v3];

  return v4;
}

- (void)setOwnerTrustZoneCapable:(BOOL)capable
{
  os_unfair_recursive_lock_lock_with_options();
  self->_ownerTrustZoneCapable = capable;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)ownerTrustZoneCapable
{
  os_unfair_recursive_lock_lock_with_options();
  ownerTrustZoneCapable = self->_ownerTrustZoneCapable;
  os_unfair_recursive_lock_unlock();
  return ownerTrustZoneCapable;
}

- (id)zoneWithUUID:(id)d
{
  dCopy = d;
  zones = [(HMDHome *)self zones];
  v6 = [zones hmf_firstObjectWithUUID:dCopy];

  return v6;
}

- (id)zoneWithName:(id)name
{
  nameCopy = name;
  zones = [(HMDHome *)self zones];
  v6 = [zones hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (id)mediaProfileWithUUID:(id)d
{
  v26 = *MEMORY[0x277D85DE8];
  dCopy = d;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v21 objects:v25 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v22;
LABEL_3:
    v9 = 0;
    while (1)
    {
      if (*v22 != v8)
      {
        objc_enumerationMutation(accessories);
      }

      v10 = *(*(&v21 + 1) + 8 * v9);
      objc_opt_class();
      v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
      v12 = v11;

      if (v12)
      {
        mediaProfile = [v12 mediaProfile];
      }

      else
      {
        v14 = v10;
        objc_opt_class();
        v15 = (objc_opt_isKindOfClass() & 1) != 0 ? v14 : 0;
        v16 = v15;

        mediaProfile = [v16 mediaProfile];
      }

      uniqueIdentifier = [mediaProfile uniqueIdentifier];
      v18 = [uniqueIdentifier isEqual:dCopy];

      if (v18)
      {
        break;
      }

      if (v7 == ++v9)
      {
        v7 = [accessories countByEnumeratingWithState:&v21 objects:v25 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        goto LABEL_18;
      }
    }
  }

  else
  {
LABEL_18:
    mediaProfile = 0;
  }

  v19 = *MEMORY[0x277D85DE8];

  return mediaProfile;
}

- (id)accessoryWithSPIClientIdentifier:(id)identifier
{
  identifierCopy = identifier;
  accessories = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke;
  v9[3] = &unk_27972C828;
  v10 = identifierCopy;
  v6 = identifierCopy;
  v7 = [accessories na_firstObjectPassingTest:v9];

  return v7;
}

uint64_t __44__HMDHome_accessoryWithSPIClientIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 spiClientIdentifier];
  v4 = [v3 hmf_isEqualToUUID:*(a1 + 32)];

  return v4;
}

- (id)accessoryWithDeviceIdentifier:(id)identifier
{
  identifierCopy = identifier;
  accessories = [(HMDHome *)self accessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke;
  v11[3] = &unk_27972C828;
  v12 = identifierCopy;
  v6 = identifierCopy;
  v7 = [accessories na_firstObjectPassingTest:v11];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
  }

  else
  {
    v8 = 0;
  }

  v9 = v8;

  return v8;
}

uint64_t __41__HMDHome_accessoryWithDeviceIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = [v5 deviceForDirectMessaging];

  v7 = [v6 identifier];
  v8 = [v7 hmf_isEqualToUUID:*(a1 + 32)];

  return v8;
}

- (id)accessoryWithEndpointIdentifier:(id)identifier
{
  v3 = [(HMDHome *)self accessoryWithSPIClientIdentifier:identifier];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  return v4;
}

- (id)accessoryWithUUID:(id)d
{
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_accessories objectForKeyedSubscript:dCopy];
  os_unfair_recursive_lock_unlock();

  return v5;
}

- (id)roomWithUniqueIdentifier:(id)identifier forClientIdentifierSalt:(id)salt
{
  identifierCopy = identifier;
  saltCopy = salt;
  rooms = [(HMDHome *)self rooms];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke;
  v13[3] = &unk_279722100;
  v14 = saltCopy;
  v15 = identifierCopy;
  v9 = identifierCopy;
  v10 = saltCopy;
  v11 = [rooms na_firstObjectPassingTest:v13];

  return v11;
}

uint64_t __60__HMDHome_roomWithUniqueIdentifier_forClientIdentifierSalt___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x277CCAD78];
  v4 = [a2 uuid];
  v5 = [v3 hm_deriveUUIDFromBaseUUID:v4 identifierSalt:*(a1 + 32)];

  v6 = [v5 isEqual:*(a1 + 40)];
  return v6;
}

- (id)roomWithUUID:(id)d
{
  dCopy = d;
  roomForEntireHome = [(HMDHome *)self roomForEntireHome];
  uuid = [roomForEntireHome uuid];
  v7 = [uuid isEqual:dCopy];

  if (v7)
  {
    roomForEntireHome2 = [(HMDHome *)self roomForEntireHome];
  }

  else
  {
    rooms = [(HMDHome *)self rooms];
    roomForEntireHome2 = [rooms hmf_firstObjectWithUUID:dCopy];
  }

  return roomForEntireHome2;
}

- (id)roomWithName:(id)name
{
  nameCopy = name;
  rooms = [(HMDHome *)self rooms];
  v6 = [rooms hmf_firstObjectWithName:nameCopy];

  return v6;
}

- (void)_configureBulletinNotification
{
  v15 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  hapAccessories = [(HMDHome *)self hapAccessories];
  v5 = [hapAccessories countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      v8 = 0;
      do
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(hapAccessories);
        }

        [*(*(&v10 + 1) + 8 * v8++) configureBulletinNotification];
      }

      while (v6 != v8);
      v6 = [hapAccessories countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)configureBulletinNotification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __40__HMDHome_configureBulletinNotification__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)_performPostSaveActionsWithReason:(id)reason
{
  v32 = *MEMORY[0x277D85DE8];
  reasonCopy = reason;
  if ([(HMDHome *)self isOwnerUser])
  {
    if ([HMDHomeManager doesSaveReasonAffectOnlyLocalData:reasonCopy])
    {
      v5 = objc_autoreleasePoolPush();
      selfCopy = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
      {
        v8 = HMFGetLogIdentifier();
        v26 = 138543618;
        v27 = v8;
        v28 = 2112;
        v29 = reasonCopy;
        v9 = "%{public}@Saving with reason %@ for a local change.";
LABEL_19:
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, v9, &v26, 0x16u);
      }
    }

    else
    {
      [(HMDHome *)self _updateConfigurationVersion];
      v5 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
      {
        v8 = HMFGetLogIdentifier();
        v26 = 138543618;
        v27 = v8;
        v28 = 2112;
        v29 = reasonCopy;
        v9 = "%{public}@Saving with reason %@ for a non-local change";
        goto LABEL_19;
      }
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)self configureBulletinNotification];
    goto LABEL_21;
  }

  v10 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    v26 = 138543618;
    v27 = v13;
    v28 = 2112;
    v29 = reasonCopy;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Dropping request to save due to %@ since the user is not owner of home", &v26, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if ([(HMDHome *)selfCopy3 isAdminUser]&& ![HMDHomeManager doesSaveReasonAffectOnlyLocalData:reasonCopy]&& ![HMDHomeManager shouldIgnoreExpectedConfigurationVersionUpdateForReason:reasonCopy])
  {
    [(HMDHome *)selfCopy3 _updateExpectConfigurationVersion];
  }

  v14 = [HMDHomeManager shouldIncrementGenerationCounterForReason:reasonCopy];
  v15 = objc_autoreleasePoolPush();
  v16 = selfCopy3;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
  {
    v18 = HMFGetLogIdentifier();
    v19 = HMFBooleanToString();
    v26 = 138543874;
    v27 = v18;
    v28 = 2112;
    v29 = reasonCopy;
    v30 = 2112;
    v31 = v19;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEFAULT, "%{public}@Saving to persistent store due to reason: %@ (incrementing generation counter: %@)", &v26, 0x20u);
  }

  objc_autoreleasePoolPop(v15);
  homeManager = [(HMDHome *)v16 homeManager];
  backingStore = [homeManager backingStore];
  v22 = backingStore;
  if (reasonCopy)
  {
    v23 = reasonCopy;
  }

  else
  {
    v23 = @"Unknown Reason";
  }

  [backingStore saveToPersistentStoreWithReason:v23 incrementGeneration:v14];

LABEL_21:
  v25 = *MEMORY[0x277D85DE8];
}

- (void)performPostSaveActionsWithReason:(id)reason
{
  reasonCopy = reason;
  [(HMDHome *)self _performPostSaveActionsWithReason:reasonCopy];
  v6 = [[HMDHomeSaveRequest alloc] initWithHome:self reason:reasonCopy information:0 postSyncNotification:0 objectChange:1];

  homeManager = [(HMDHome *)self homeManager];
  [homeManager performPostSaveRequestActionsWithRequest:v6];
}

- (void)saveToCurrentAccountWithReason:(id)reason
{
  reasonCopy = reason;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_saveToCurrentAccountWithReason___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = reasonCopy;
  v6 = reasonCopy;
  dispatch_async(workQueue, v7);
}

uint64_t __42__HMDHome_saveToCurrentAccountWithReason___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = HMFGetLogIdentifier();
    v6 = *(a1 + 40);
    v9 = 138543618;
    v10 = v5;
    v11 = 2112;
    v12 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_INFO, "%{public}@Saving to current account with reason: %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  [*(a1 + 32) saveWithReason:*(a1 + 40) information:0 postSyncNotification:0];
  result = [*(a1 + 32) _configureBulletinNotification];
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_saveSharedHomeToAccountWithReason:(id)reason postSyncNotification:(BOOL)notification options:(id)options
{
  v32 = *MEMORY[0x277D85DE8];
  reasonCopy = reason;
  optionsCopy = options;
  v10 = objc_autoreleasePoolPush();
  selfCopy = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
  {
    v13 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v13;
    v30 = 2112;
    v31 = reasonCopy;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Received request to save to account with reason: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v10);
  if (-[HMDHome isOwnerUser](selfCopy, "isOwnerUser") || +[HMDHomeManager doesSaveReasonAffectOnlyLocalData:](HMDHomeManager, "doesSaveReasonAffectOnlyLocalData:", reasonCopy) || ([MEMORY[0x277D0F8E8] productInfo], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "productPlatform") == 3, v14, v15))
  {
    v16 = objc_autoreleasePoolPush();
    v17 = selfCopy;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v19;
      v30 = 2112;
      v31 = reasonCopy;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Cannot save home as a shared home to cloud for reason %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
  }

  else
  {
    sharedHomeModel = [(HMDHome *)selfCopy sharedHomeModel];
    backingStore = [(HMDHome *)selfCopy backingStore];
    v23 = [backingStore transaction:reasonCopy options:optionsCopy];

    [v23 add:sharedHomeModel];
    objc_initWeak(buf, selfCopy);
    v24[0] = MEMORY[0x277D85DD0];
    v24[1] = 3221225472;
    v24[2] = __75__HMDHome__saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke;
    v24[3] = &unk_2797248C8;
    objc_copyWeak(&v26, buf);
    v25 = reasonCopy;
    notificationCopy = notification;
    [v23 save:v24];
    [(HMDHome *)selfCopy configureBulletinNotification];

    objc_destroyWeak(&v26);
    objc_destroyWeak(buf);
  }

  v20 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome__saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v5 = WeakRetained;
    v3 = [[HMDHomeSaveRequest alloc] initWithHome:WeakRetained reason:*(a1 + 32) information:0 postSyncNotification:*(a1 + 48) objectChange:1];
    v4 = [v5 homeManager];
    [v4 saveWithRequest:v3];

    WeakRetained = v5;
  }
}

- (void)saveSharedHomeToAccountWithReason:(id)reason postSyncNotification:(BOOL)notification options:(id)options
{
  reasonCopy = reason;
  optionsCopy = options;
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __74__HMDHome_saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke;
  block[3] = &unk_279730EA0;
  objc_copyWeak(&v16, &location);
  notificationCopy = notification;
  v14 = reasonCopy;
  v15 = optionsCopy;
  v11 = optionsCopy;
  v12 = reasonCopy;
  dispatch_async(workQueue, block);

  objc_destroyWeak(&v16);
  objc_destroyWeak(&location);
}

void __74__HMDHome_saveSharedHomeToAccountWithReason_postSyncNotification_options___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (WeakRetained)
  {
    v3 = WeakRetained;
    [WeakRetained _saveSharedHomeToAccountWithReason:*(a1 + 32) postSyncNotification:*(a1 + 56) options:*(a1 + 40)];
    WeakRetained = v3;
  }
}

- (void)_updateExpectConfigurationVersion
{
  v15 = *MEMORY[0x277D85DE8];
  expectedConfigurationVersion = [(HMDHome *)self expectedConfigurationVersion];
  if (expectedConfigurationVersion < [(HMDHome *)self configurationVersion])
  {
    [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self configurationVersion]];
  }

  [(HMDHome *)self setExpectedConfigurationVersion:[(HMDHome *)self expectedConfigurationVersion]+ 1];
  v4 = objc_autoreleasePoolPush();
  selfCopy = self;
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543874;
    v10 = v7;
    v11 = 2048;
    expectedConfigurationVersion2 = [(HMDHome *)selfCopy expectedConfigurationVersion];
    v13 = 2048;
    configurationVersion = [(HMDHome *)selfCopy configurationVersion];
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Increased expected configuration counter to %lu (current configurationVersion: %lu).", &v9, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_updateConfigurationVersion
{
  v12 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self setConfigurationVersion:[(HMDHome *)self configurationVersion]+ 1];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = HMFGetLogIdentifier();
    v8 = 138543618;
    v9 = v6;
    v10 = 2048;
    configurationVersion = [(HMDHome *)selfCopy configurationVersion];
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Incrementing configuration version to %lu", &v8, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [(HMDHome *)selfCopy __saveConfigurationVersionTransaction];
  v7 = *MEMORY[0x277D85DE8];
}

- (void)__saveConfigurationVersionTransaction
{
  backingStore = [(HMDHome *)self backingStore];
  v4 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v6 = [backingStore transaction:@"kHomeConfigurationVersionKey" options:v4];

  v5 = [(HMDHome *)self homeConfigurationModelObjectWithChangeType:1];
  [v6 add:v5 withMessage:0];
  [v6 save];
}

- (void)_handleModifyCharacteristicNotifications:(id)notifications
{
  v87 = *MEMORY[0x277D85DE8];
  notificationsCopy = notifications;
  if ([notificationsCopy isRemote] && (objc_msgSend(notificationsCopy, "isSecureRemote") & 1) == 0)
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v80 = v19;
      v81 = 2112;
      v82 = notificationsCopy;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEFAULT, "%{public}@Message not supported: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v4 = [MEMORY[0x277CCA9B8] hmErrorWithCode:17];
    [notificationsCopy respondWithError:v4];
  }

  else
  {
    v4 = [notificationsCopy dictionaryForKey:@"kCharacteristicNotificationsKey"];
    v5 = [notificationsCopy dictionaryForKey:@"kMediaNotificationsKey"];
    v77 = 0;
    v6 = [notificationsCopy BOOLForKey:*MEMORY[0x277CD2158] keyPresent:&v77];
    remoteSourceDevice = [notificationsCopy remoteSourceDevice];
    remoteDestinationString = [remoteSourceDevice remoteDestinationString];

    if (v4 | v5 && remoteDestinationString && (v77 & 1) != 0)
    {
      if (v6)
      {
        notificationRegistry = [(HMDHome *)self notificationRegistry];
        [notificationRegistry setNotificationsEnabled:1 forUserID:remoteDestinationString characteristicsPayload:v4 mediaPropertiesPayload:v5];
LABEL_50:

        [notificationsCopy respondWithSuccess];
      }

      else
      {
        v20 = objc_alloc_init(MEMORY[0x277CBEB18]);
        [notificationsCopy remoteSourceDevice];
        v73 = 0u;
        v74 = 0u;
        v75 = 0u;
        v61 = v76 = 0u;
        handles = [v61 handles];
        v22 = [handles countByEnumeratingWithState:&v73 objects:v86 count:16];
        if (v22)
        {
          v23 = v22;
          v24 = *v74;
          do
          {
            for (i = 0; i != v23; ++i)
            {
              if (*v74 != v24)
              {
                objc_enumerationMutation(handles);
              }

              destination = [*(*(&v73 + 1) + 8 * i) destination];
              [v20 addObject:destination];
            }

            v23 = [handles countByEnumeratingWithState:&v73 objects:v86 count:16];
          }

          while (v23);
        }

        v60 = remoteDestinationString;

        globalHandles = [v61 globalHandles];
        firstObject = [globalHandles firstObject];

        v62 = firstObject;
        if (firstObject)
        {
          v57 = v5;
          v58 = v4;
          v59 = notificationsCopy;
          v71 = 0u;
          v72 = 0u;
          v69 = 0u;
          v70 = 0u;
          account = [v61 account];
          handles2 = [account handles];

          obj = handles2;
          v31 = [handles2 countByEnumeratingWithState:&v69 objects:v85 count:16];
          if (v31)
          {
            v32 = v31;
            v33 = *v70;
            do
            {
              for (j = 0; j != v32; ++j)
              {
                if (*v70 != v33)
                {
                  objc_enumerationMutation(obj);
                }

                v35 = *(*(&v69 + 1) + 8 * j);
                pushToken = [firstObject pushToken];
                v37 = [v35 URI];
                prefixedURI = [v37 prefixedURI];
                v39 = MEMORY[0x259C01FD0](pushToken, prefixedURI);

                if (v39)
                {
                  if (([v20 containsObject:v39] & 1) == 0)
                  {
                    [v20 addObject:v39];
                  }
                }

                else
                {
                  v40 = objc_autoreleasePoolPush();
                  selfCopy2 = self;
                  v42 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
                  {
                    v43 = HMFGetLogIdentifier();
                    *buf = 138543874;
                    v80 = v43;
                    v81 = 2112;
                    v82 = v62;
                    v83 = 2112;
                    v84 = v35;
                    _os_log_impl(&dword_2531F8000, v42, OS_LOG_TYPE_ERROR, "%{public}@Failed to create destination with globalHandle: %@, accountHandle: %@", buf, 0x20u);

                    firstObject = v62;
                  }

                  objc_autoreleasePoolPop(v40);
                }
              }

              v32 = [obj countByEnumeratingWithState:&v69 objects:v85 count:16];
            }

            while (v32);
          }

          v4 = v58;
          notificationsCopy = v59;
          v5 = v57;
        }

        remoteSourceID = [notificationsCopy remoteSourceID];
        if (([v20 containsObject:remoteSourceID] & 1) == 0)
        {
          [v20 addObject:remoteSourceID];
        }

        v67 = 0u;
        v68 = 0u;
        v65 = 0u;
        v66 = 0u;
        notificationRegistry = v20;
        v45 = [notificationRegistry countByEnumeratingWithState:&v65 objects:v78 count:16];
        if (v45)
        {
          v46 = v45;
          v47 = *v66;
          while (2)
          {
            for (k = 0; k != v46; ++k)
            {
              if (*v66 != v47)
              {
                objc_enumerationMutation(notificationRegistry);
              }

              v49 = *(*(&v65 + 1) + 8 * k);
              notificationRegistry2 = [(HMDHome *)self notificationRegistry];
              LOBYTE(v49) = [notificationRegistry2 setNotificationsEnabled:0 forUserID:v49 characteristicsPayload:v4 mediaPropertiesPayload:v5];

              if (v49)
              {

                remoteDestinationString = v60;
                goto LABEL_50;
              }
            }

            v46 = [notificationRegistry countByEnumeratingWithState:&v65 objects:v78 count:16];
            if (v46)
            {
              continue;
            }

            break;
          }
        }

        v51 = objc_autoreleasePoolPush();
        selfCopy3 = self;
        v53 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_ERROR))
        {
          v54 = HMFGetLogIdentifier();
          *buf = 138543618;
          v80 = v54;
          v81 = 2112;
          v82 = notificationRegistry;
          _os_log_impl(&dword_2531F8000, v53, OS_LOG_TYPE_ERROR, "%{public}@Failed to disable notification with destinations: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v51);
        v55 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:@"Failed to disable notification because registration was not found" reason:@"Could not find matching registration" suggestion:0];
        [notificationsCopy respondWithError:v55];

        remoteDestinationString = v60;
      }
    }

    else
    {
      v10 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v12 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        v13 = HMFGetLogIdentifier();
        messagePayload = [notificationsCopy messagePayload];
        *buf = 138543618;
        v80 = v13;
        v81 = 2112;
        v82 = messagePayload;
        _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Cannot handle modify characteristic notifications message payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v10);
      v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
      [notificationsCopy respondWithError:v15];
    }
  }

  v56 = *MEMORY[0x277D85DE8];
}

- (void)_handleAccessoryReachabilityEventNotificationsRegistration:(id)registration
{
  v38 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    *buf = 138543362;
    v33 = v9;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Received message to handle accessory reachability event notification registration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v6);
  messagePayload = [registrationCopy messagePayload];
  v11 = [messagePayload hmf_arrayForKey:@"HMDAccessoryResidentReachabilityNotificationEnableAccessoryUUIDsMessageKey"];

  messagePayload2 = [registrationCopy messagePayload];
  v13 = [messagePayload2 hmf_arrayForKey:@"HMDAccessoryResidentReachabilityNotificationDisableAccessoryUUIDsMessageKey"];

  if ([v11 count] || objc_msgSend(v13, "count"))
  {
    v14 = [v11 na_map:&__block_literal_global_887];
    v31 = [v13 na_map:&__block_literal_global_889];
    messagePayload3 = [registrationCopy messagePayload];
    remoteSourceID = [messagePayload3 hmf_stringForKey:@"HMDAccessoryResidentReachabilityNotificationUserIDMessageKey"];

    if (!remoteSourceID)
    {
      remoteSourceID = [registrationCopy remoteSourceID];
    }

    notificationRegistry = [(HMDHome *)selfCopy notificationRegistry];
    if ([notificationRegistry enableReachabilityEventNotificationForAccessoryUUIDs:v14 forUserID:remoteSourceID])
    {
      v18 = 1;
    }

    else
    {
      notificationRegistry2 = [(HMDHome *)selfCopy notificationRegistry];
      v18 = [notificationRegistry2 disableReachabilityEventNotificationForAccessoryUUIDs:v31 forUserID:remoteSourceID];
    }

    v20 = objc_autoreleasePoolPush();
    v21 = selfCopy;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      HMFGetLogIdentifier();
      v23 = v11;
      v25 = v24 = v13;
      *buf = 138543874;
      v33 = v25;
      v34 = 2112;
      v35 = v14;
      v36 = 2112;
      v37 = v31;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Changed reachability event notification registration for enableAccessoryUUIDs : %@ and disableAccessoryUUIDs : %@", buf, 0x20u);

      v13 = v24;
      v11 = v23;
    }

    objc_autoreleasePoolPop(v20);
    if (v18)
    {
      [(HMDHome *)v21 saveToCurrentAccountWithReason:@"HMDAccessoryResidentReachabilityNotificationRegistrationMessage"];
    }

    [registrationCopy respondWithSuccess];
  }

  else
  {
    v27 = objc_autoreleasePoolPush();
    v28 = selfCopy;
    v29 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
    {
      v30 = HMFGetLogIdentifier();
      *buf = 138543362;
      v33 = v30;
      _os_log_impl(&dword_2531F8000, v29, OS_LOG_TYPE_DEFAULT, "%{public}@No accessories passed in for remote reachability event registration/deregistration", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v27);
    v14 = [MEMORY[0x277CCA9B8] errorWithDomain:*MEMORY[0x277CCFD28] code:3 userInfo:0];
    [registrationCopy respondWithError:v14];
  }

  v26 = *MEMORY[0x277D85DE8];
}

id __70__HMDHome__handleAccessoryReachabilityEventNotificationsRegistration___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = MEMORY[0x277CCAD78];
  v3 = a2;
  v4 = [[v2 alloc] initWithUUIDString:v3];

  return v4;
}

id __70__HMDHome__handleAccessoryReachabilityEventNotificationsRegistration___block_invoke(uint64_t a1, void *a2)
{
  v2 = MEMORY[0x277CCAD78];
  v3 = a2;
  v4 = [[v2 alloc] initWithUUIDString:v3];

  return v4;
}

- (void)auditUsersForNotifications:(id)notifications
{
  notificationsCopy = notifications;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_auditUsersForNotifications___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = notificationsCopy;
  v6 = notificationsCopy;
  dispatch_async(workQueue, v7);
}

void __38__HMDHome_auditUsersForNotifications___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistry];
  [v2 auditUsersForNotifications:*(a1 + 40) forHome:*(a1 + 32)];
}

void __135__HMDHome__modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v8 = WeakRetained;
  if (WeakRetained)
  {
    if (v5)
    {
      v9 = objc_autoreleasePoolPush();
      v10 = v8;
      v11 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        *buf = 138543874;
        v26 = v12;
        v27 = 2112;
        v28 = v13;
        v29 = 2112;
        v30 = v5;
        _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Failed to modify notifications with remote gateway %@ due to error %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v9);
      v14 = *(a1 + 48);
      if (v14)
      {
        (*(v14 + 16))(v14, v5);
      }
    }

    else
    {
      v17 = [WeakRetained workQueue];
      block[0] = MEMORY[0x277D85DD0];
      block[1] = 3221225472;
      block[2] = __135__HMDHome__modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice_completion___block_invoke_884;
      block[3] = &unk_2797220B0;
      objc_copyWeak(&v23, (a1 + 56));
      v20 = *(a1 + 32);
      v21 = *(a1 + 40);
      v24 = *(a1 + 64);
      v22 = *(a1 + 48);
      dispatch_async(v17, block);

      objc_destroyWeak(&v23);
    }
  }

  else
  {
    v15 = *(a1 + 48);
    if (v15)
    {
      v16 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:8];
      (*(v15 + 16))(v15, v16);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __135__HMDHome__modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice_completion___block_invoke_884(uint64_t a1)
{
  v14 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = objc_autoreleasePoolPush();
  v4 = WeakRetained;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v7 = *(a1 + 32);
    v10 = 138543618;
    v11 = v6;
    v12 = 2112;
    v13 = v7;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Modified notifications with remote gateway %@", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v3);
  [v4 _handleRemoteGatewayNotificationRegistration:*(a1 + 40) enable:*(a1 + 64)];
  v8 = *(a1 + 48);
  if (v8)
  {
    (*(v8 + 16))(v8, 0);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)modifyCharacteristicNotifications:(id)notifications mediaNotifications:(id)mediaNotifications actionSetNotificationPayload:(id)payload enableNotification:(BOOL)notification withDevice:(id)device
{
  notificationsCopy = notifications;
  mediaNotificationsCopy = mediaNotifications;
  payloadCopy = payload;
  deviceCopy = device;
  workQueue = [(HMDHome *)self workQueue];
  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __123__HMDHome_modifyCharacteristicNotifications_mediaNotifications_actionSetNotificationPayload_enableNotification_withDevice___block_invoke;
  v21[3] = &unk_27972DBC8;
  v21[4] = self;
  v22 = notificationsCopy;
  v23 = mediaNotificationsCopy;
  v24 = payloadCopy;
  notificationCopy = notification;
  v25 = deviceCopy;
  v17 = deviceCopy;
  v18 = payloadCopy;
  v19 = mediaNotificationsCopy;
  v20 = notificationsCopy;
  dispatch_async(workQueue, v21);
}

- (BOOL)shouldRestrictAllMessagingToLocalTransportsForUser:(id)user
{
  userCopy = user;
  if (isiOSDevice())
  {
    isResidentFirstAccessoryCommunicationEnabled = [(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled];
    LOBYTE(self) = 0;
    if (userCopy && isResidentFirstAccessoryCommunicationEnabled)
    {
      LODWORD(self) = [userCopy isRemoteAccessAllowed] ^ 1;
    }
  }

  else
  {
    LOBYTE(self) = 0;
  }

  return self;
}

- (void)_resubscribeForNotificationsOnResident:(id)resident
{
  v56 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  primaryResident = [(HMDHome *)self primaryResident];
  device = [primaryResident device];

  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543874;
    v51 = v11;
    v52 = 2112;
    v53 = residentCopy;
    v54 = 2112;
    v55 = device;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Resubscribing for notifications - previousResidentDevice: %@, current primaryResident: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v44 = residentCopy;
  if (isWatch() && (-[HMDHome homeManager](selfCopy, "homeManager"), v12 = objc_claimAutoreleasedReturnValue(), v13 = [v12 companionReachable], v12, v13))
  {
    v14 = objc_autoreleasePoolPush();
    v15 = selfCopy;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v17;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Subscribing to companion", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v14);
    v43 = 0;
  }

  else
  {
    v43 = device;
  }

  residentEnabledDevices = [(HMDHome *)selfCopy residentEnabledDevices];
  array = [MEMORY[0x277CBEB18] array];
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  _residentUsers = [(HMDHome *)selfCopy _residentUsers];
  v20 = [_residentUsers countByEnumeratingWithState:&v45 objects:v49 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v46;
    do
    {
      for (i = 0; i != v21; ++i)
      {
        if (*v46 != v22)
        {
          objc_enumerationMutation(_residentUsers);
        }

        v24 = *(*(&v45 + 1) + 8 * i);
        if ([v24 configurationState] == 2)
        {
          userID = [v24 userID];
          v26 = [HMDDevice deviceWithDestination:userID];

          if (v26 && ([v26 isCurrentDevice] & 1) == 0)
          {
            [array addObject:v26];
          }
        }
      }

      v21 = [_residentUsers countByEnumeratingWithState:&v45 objects:v49 count:16];
    }

    while (v21);
  }

  if ([residentEnabledDevices count] || objc_msgSend(array, "count"))
  {
    v27 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(array, "count") + objc_msgSend(residentEnabledDevices, "count")}];
    v28 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(array, "count") + objc_msgSend(residentEnabledDevices, "count")}];
    v29 = v43;
    if ([v43 isCurrentDevice])
    {
      [v27 addObjectsFromArray:residentEnabledDevices];
      [v27 addObjectsFromArray:array];
      v30 = v44;
    }

    else
    {
      v30 = v44;
      if (v44)
      {
        [v28 addObject:v44];
      }

      else
      {
        [v28 addObjectsFromArray:array];
      }

      if (v43)
      {
        [v27 addObject:v43];
      }

      else
      {
        [v27 addObjectsFromArray:array];
      }
    }

    [v28 minusSet:v27];
    v31 = objc_autoreleasePoolPush();
    v32 = selfCopy;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
    {
      v34 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v34;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_INFO, "%{public}@Modifying notification registrations with resident due to initial home launch or change in primary resident.", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v31);
    if ([v28 count])
    {
      allObjects = [v28 allObjects];
      [(HMDHome *)v32 _disableNotificationsForDevices:allObjects];
    }

    if ([v27 count])
    {
      allObjects2 = [v27 allObjects];
      [(HMDHome *)v32 _enableNotificationsForDevices:allObjects2];
    }

    [(HMDHome *)v32 _updateDirectAppleMediaNotificationsOnResidentChange:v43 previousResidentDevice:v30];
  }

  else
  {
    v38 = objc_autoreleasePoolPush();
    v39 = selfCopy;
    v40 = HMFGetOSLogHandle();
    v29 = v43;
    if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
    {
      v41 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v41;
      _os_log_impl(&dword_2531F8000, v40, OS_LOG_TYPE_INFO, "%{public}@There are no resident devices or remote gateways to register with", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v38);
    v30 = v44;
  }

  v37 = *MEMORY[0x277D85DE8];
}

- (void)resubscribeForNotificationsOnResident:(id)resident
{
  residentCopy = resident;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __49__HMDHome_resubscribeForNotificationsOnResident___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = residentCopy;
  v6 = residentCopy;
  dispatch_async(workQueue, v7);
}

- (void)_registerResidentReachabilityNotificationWithEnableAccessories:(id)accessories disableAccessories:(id)disableAccessories completionHandler:(id)handler
{
  v70 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  disableAccessoriesCopy = disableAccessories;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if (![(HMDHome *)self _canCurrentDeviceRegisterForReachabilityEventNotification])
  {
    v19 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v21 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      goto LABEL_13;
    }

    v22 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v22;
    v23 = "%{public}@Current device is either watch or resident, do not have to send remote message for remote reachability event notification registration";
    v24 = v21;
    v25 = OS_LOG_TYPE_DEBUG;
    goto LABEL_12;
  }

  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  availableResidentDevices = [residentDeviceManager availableResidentDevices];
  v14 = [availableResidentDevices count];

  if (!v14)
  {
    v19 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v21 = HMFGetOSLogHandle();
    if (!os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_13;
    }

    v22 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v22;
    v23 = "%{public}@There is no resident available to register for reachability event notification";
    v24 = v21;
    v25 = OS_LOG_TYPE_ERROR;
LABEL_12:
    _os_log_impl(&dword_2531F8000, v24, v25, v23, buf, 0xCu);

LABEL_13:
    objc_autoreleasePoolPop(v19);
    primaryResident = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    if (handlerCopy)
    {
      handlerCopy[2](handlerCopy, primaryResident);
    }

    goto LABEL_26;
  }

  if (![(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
  {
    primaryResident = [(HMDHome *)self primaryResident];
    isConfirmed = [primaryResident isConfirmed];
    primaryResident2 = [(HMDHome *)self primaryResident];
    capabilities = [primaryResident2 capabilities];
    supportsCameraRecordingReachabilityNotifications = [capabilities supportsCameraRecordingReachabilityNotifications];

    if (primaryResident && isConfirmed && (supportsCameraRecordingReachabilityNotifications & 1) != 0)
    {
      v31 = [accessoriesCopy na_map:&__block_literal_global_880];
      v32 = [v31 copy];

      v33 = [disableAccessoriesCopy na_map:&__block_literal_global_882];
      v34 = [v33 copy];

      v60[0] = @"HMDAccessoryResidentReachabilityNotificationEnableAccessoryUUIDsMessageKey";
      v60[1] = @"HMDAccessoryResidentReachabilityNotificationDisableAccessoryUUIDsMessageKey";
      v56 = v34;
      v57 = v32;
      v61[0] = v32;
      v61[1] = v34;
      [MEMORY[0x277CBEAC0] dictionaryWithObjects:v61 forKeys:v60 count:2];
      v36 = v35 = primaryResident;
      v37 = [HMDRemoteDeviceMessageDestination alloc];
      uuid = [(HMDHome *)self uuid];
      v55 = v35;
      device = [v35 device];
      v40 = [(HMDRemoteDeviceMessageDestination *)v37 initWithTarget:uuid device:device];
      v41 = [HMDRemoteMessage secureMessageWithName:@"HMDAccessoryResidentReachabilityNotificationRegistrationMessage" destination:v40 messagePayload:v36];

      v58[0] = MEMORY[0x277D85DD0];
      v58[1] = 3221225472;
      v58[2] = __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke_3;
      v58[3] = &unk_279732CF0;
      v58[4] = self;
      v59 = handlerCopy;
      [v41 setResponseHandler:v58];
      v42 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v44 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_INFO))
      {
        v45 = HMFGetLogIdentifier();
        *buf = 138543874;
        v63 = v45;
        v64 = 2112;
        v65 = v41;
        v66 = 2112;
        v67 = v36;
        _os_log_impl(&dword_2531F8000, v44, OS_LOG_TYPE_INFO, "%{public}@Sending reachability notification registration message %@ with payload: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v42);
      msgDispatcher = [(HMDHome *)selfCopy3 msgDispatcher];
      [msgDispatcher sendMessage:v41];

      v47 = v57;
      primaryResident = v55;
    }

    else
    {
      v48 = objc_autoreleasePoolPush();
      selfCopy4 = self;
      v50 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
      {
        v51 = HMFGetLogIdentifier();
        v52 = HMFBooleanToString();
        v53 = HMFBooleanToString();
        *buf = 138544130;
        v63 = v51;
        v64 = 2112;
        v65 = v52;
        v66 = 2112;
        v67 = v53;
        v68 = 2112;
        v69 = primaryResident;
        _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_ERROR, "%{public}@Primary resident is not confirmed (%@) or does not support camera recording reachability notifications (%@): %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v48);
      v47 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      if (handlerCopy)
      {
        handlerCopy[2](handlerCopy, v47);
      }
    }

LABEL_26:
    goto LABEL_27;
  }

  v15 = objc_autoreleasePoolPush();
  selfCopy5 = self;
  v17 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
  {
    v18 = HMFGetLogIdentifier();
    *buf = 138543362;
    v63 = v18;
    _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_DEFAULT, "%{public}@Current device is confirmed primary resident, do not need to register for notification on confirmed primary resident itself", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v15);
  if (handlerCopy)
  {
    handlerCopy[2](handlerCopy, 0);
  }

LABEL_27:

  v54 = *MEMORY[0x277D85DE8];
}

void __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v22 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v5)
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v18 = 138543618;
    v19 = v11;
    v20 = 2112;
    v21 = v5;
    v12 = "%{public}@Failed to update accessory reachability event notification registry due to error: %@";
    v13 = v10;
    v14 = OS_LOG_TYPE_ERROR;
    v15 = 22;
  }

  else
  {
    if (!os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      goto LABEL_7;
    }

    v11 = HMFGetLogIdentifier();
    v18 = 138543362;
    v19 = v11;
    v12 = "%{public}@Successfully updated accessory reachability event notification registry";
    v13 = v10;
    v14 = OS_LOG_TYPE_INFO;
    v15 = 12;
  }

  _os_log_impl(&dword_2531F8000, v13, v14, v12, &v18, v15);

LABEL_7:
  objc_autoreleasePoolPop(v7);
  v16 = *(a1 + 40);
  if (v16)
  {
    (*(v16 + 16))(v16, v5);
  }

  v17 = *MEMORY[0x277D85DE8];
}

id __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = [a2 uuid];
  v3 = [v2 UUIDString];

  return v3;
}

id __111__HMDHome__registerResidentReachabilityNotificationWithEnableAccessories_disableAccessories_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 uuid];
  v3 = [v2 UUIDString];

  return v3;
}

- (BOOL)_canCurrentDeviceRegisterForReachabilityEventNotification
{
  v12 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if (isWatch() || isAppleTV() || isHomePod())
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEBUG, "%{public}@Skipping registering for reachability notification on watch / ATV / HomePod", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    result = 0;
  }

  else
  {
    result = 1;
  }

  v9 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)setCameraReachabilityEventNotificationsEnabled:(BOOL)enabled forAccessory:(id)accessory completionHandler:(id)handler
{
  accessoryCopy = accessory;
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __89__HMDHome_setCameraReachabilityEventNotificationsEnabled_forAccessory_completionHandler___block_invoke;
  v13[3] = &unk_279732430;
  enabledCopy = enabled;
  v13[4] = self;
  v14 = accessoryCopy;
  v15 = handlerCopy;
  v11 = handlerCopy;
  v12 = accessoryCopy;
  dispatch_async(workQueue, v13);
}

void __89__HMDHome_setCameraReachabilityEventNotificationsEnabled_forAccessory_completionHandler___block_invoke(uint64_t a1)
{
  v8[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 56);
  if (v3 == 1)
  {
    v8[0] = *(a1 + 40);
    v4 = [MEMORY[0x277CBEA60] arrayWithObjects:v8 count:1];
    if (*(a1 + 56))
    {
      [v2 _registerResidentReachabilityNotificationWithEnableAccessories:v4 disableAccessories:MEMORY[0x277CBEBF8] completionHandler:*(a1 + 48)];
LABEL_6:

      goto LABEL_7;
    }
  }

  else
  {
    v4 = MEMORY[0x277CBEBF8];
  }

  v7 = *(a1 + 40);
  v5 = [MEMORY[0x277CBEA60] arrayWithObjects:&v7 count:1];
  [v2 _registerResidentReachabilityNotificationWithEnableAccessories:v4 disableAccessories:v5 completionHandler:*(a1 + 48)];

  if (v3)
  {
    goto LABEL_6;
  }

LABEL_7:
  v6 = *MEMORY[0x277D85DE8];
}

- (void)_registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)handler
{
  v40 = *MEMORY[0x277D85DE8];
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v5 = objc_alloc(MEMORY[0x277CBEB18]);
  accessories = [(HMDHome *)self accessories];
  v32 = [v5 initWithCapacity:{objc_msgSend(accessories, "count")}];

  v7 = objc_alloc(MEMORY[0x277CBEB18]);
  accessories2 = [(HMDHome *)self accessories];
  v33 = [v7 initWithCapacity:{objc_msgSend(accessories2, "count")}];

  v37 = 0u;
  v38 = 0u;
  v35 = 0u;
  v36 = 0u;
  obj = [(HMDHome *)self accessories];
  v9 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v36;
    v12 = HMDIDSActivityMonitorHomeManagerDataSource;
    v31 = *v36;
    do
    {
      v13 = 0;
      do
      {
        if (*v36 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v35 + 1) + 8 * v13);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v16 = v15;

        cameraProfiles = [v16 cameraProfiles];
        v18 = [cameraProfiles count];

        if (v18)
        {
          accountSettings = [(HMDHome *)self accountSettings];
          if ([accountSettings isHomeEnabled])
          {
            cameraProfileSettingsManager = [v16 cameraProfileSettingsManager];
            [cameraProfileSettingsManager currentSettings];
            v22 = v21 = self;
            [v22 notificationSettings];
            v24 = v23 = v12;
            isReachabilityEventNotificationEnabled = [v24 isReachabilityEventNotificationEnabled];

            v12 = v23;
            self = v21;
            v11 = v31;

            v26 = v32;
            if (isReachabilityEventNotificationEnabled)
            {
              goto LABEL_15;
            }
          }

          else
          {
          }

          v26 = v33;
LABEL_15:
          [v26 addObject:v16];
        }

        ++v13;
      }

      while (v10 != v13);
      v10 = [obj countByEnumeratingWithState:&v35 objects:v39 count:16];
    }

    while (v10);
  }

  v27 = [v32 copy];
  v28 = [v33 copy];
  [(HMDHome *)self _registerResidentReachabilityNotificationWithEnableAccessories:v27 disableAccessories:v28 completionHandler:handlerCopy];

  v29 = *MEMORY[0x277D85DE8];
}

- (void)registerCameraReachabilityEventNotificationsWithCompletionHandler:(id)handler
{
  handlerCopy = handler;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __77__HMDHome_registerCameraReachabilityEventNotificationsWithCompletionHandler___block_invoke;
  v7[3] = &unk_279735738;
  v7[4] = self;
  v8 = handlerCopy;
  v6 = handlerCopy;
  dispatch_async(workQueue, v7);
}

- (void)_disableNotificationsForDevices:(id)devices
{
  v110 = *MEMORY[0x277D85DE8];
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([devicesCopy count])
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v107 = v9;
      v108 = 2112;
      v109 = devicesCopy;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Disabling Notifications on %@", buf, 0x16u);
    }

    v64 = devicesCopy;

    objc_autoreleasePoolPop(v6);
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    array = [MEMORY[0x277CBEB18] array];
    supportsUnifiedMediaNotificationsOnResidents = [(HMDHome *)selfCopy supportsUnifiedMediaNotificationsOnResidents];
    v97 = 0u;
    v98 = 0u;
    v99 = 0u;
    v100 = 0u;
    v80 = selfCopy;
    obj = [(HMDHome *)selfCopy accessories];
    v68 = [obj countByEnumeratingWithState:&v97 objects:v105 count:16];
    if (v68)
    {
      v66 = *v98;
      do
      {
        v10 = 0;
        do
        {
          if (*v98 != v66)
          {
            objc_enumerationMutation(obj);
          }

          v11 = *(*(&v97 + 1) + 8 * v10);
          array2 = [MEMORY[0x277CBEB18] array];
          v13 = v11;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v14 = v13;
          }

          else
          {
            v14 = 0;
          }

          v15 = v14;

          v16 = v13;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v17 = v16;
          }

          else
          {
            v17 = 0;
          }

          v18 = v17;

          if (v15)
          {
            v70 = v16;
            v72 = v18;
            v77 = v10;
            v95 = 0u;
            v96 = 0u;
            v93 = 0u;
            v94 = 0u;
            v74 = v15;
            services = [v15 services];
            v20 = [services countByEnumeratingWithState:&v93 objects:v104 count:16];
            if (v20)
            {
              v21 = v20;
              v22 = *v94;
              do
              {
                for (i = 0; i != v21; ++i)
                {
                  if (*v94 != v22)
                  {
                    objc_enumerationMutation(services);
                  }

                  v24 = *(*(&v93 + 1) + 8 * i);
                  v89 = 0u;
                  v90 = 0u;
                  v91 = 0u;
                  v92 = 0u;
                  characteristics = [v24 characteristics];
                  v26 = [characteristics countByEnumeratingWithState:&v89 objects:v103 count:16];
                  if (v26)
                  {
                    v27 = v26;
                    v28 = *v90;
                    do
                    {
                      for (j = 0; j != v27; ++j)
                      {
                        if (*v90 != v28)
                        {
                          objc_enumerationMutation(characteristics);
                        }

                        v30 = *(*(&v89 + 1) + 8 * j);
                        if ([v30 supportsNotification])
                        {
                          instanceID = [v30 instanceID];
                          [array2 addObject:instanceID];
                        }
                      }

                      v27 = [characteristics countByEnumeratingWithState:&v89 objects:v103 count:16];
                    }

                    while (v27);
                  }
                }

                v21 = [services countByEnumeratingWithState:&v93 objects:v104 count:16];
              }

              while (v21);
            }

            uuid = [v70 uuid];
            uUIDString = [uuid UUIDString];

            if ([array2 count])
            {
              v34 = [array2 copy];
              [dictionary setObject:v34 forKeyedSubscript:uUIDString];
            }

            v10 = v77;
            v18 = v72;
            v15 = v74;
LABEL_35:

            goto LABEL_36;
          }

          if (v18)
          {
            mediaProfile = [v18 mediaProfile];
            if (mediaProfile)
            {
              uUIDString = mediaProfile;
              [array addObject:mediaProfile];
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              v37 = v80;
              v38 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                *buf = 138543618;
                v107 = v39;
                v108 = 2112;
                v109 = v18;
                _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@skipping disabling notifications for apple media accessory without media profile: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v36);
              uUIDString = 0;
            }

            goto LABEL_35;
          }

LABEL_36:

          v10 = v10 + 1;
        }

        while (v10 != v68);
        v40 = [obj countByEnumeratingWithState:&v97 objects:v105 count:16];
        v68 = v40;
      }

      while (v40);
    }

    array3 = [MEMORY[0x277CBEB18] array];
    if ([dictionary count] || objc_msgSend(array, "count"))
    {
      v87 = 0u;
      v88 = 0u;
      v85 = 0u;
      v86 = 0u;
      v69 = v64;
      v75 = [v69 countByEnumeratingWithState:&v85 objects:v102 count:16];
      if (v75)
      {
        v71 = *v86;
        do
        {
          v41 = 0;
          do
          {
            if (*v86 != v71)
            {
              objc_enumerationMutation(v69);
            }

            v78 = v41;
            v42 = *(*(&v85 + 1) + 8 * v41);
            dictionary2 = [MEMORY[0x277CBEB38] dictionary];
            v81 = 0u;
            v82 = 0u;
            v83 = 0u;
            v84 = 0u;
            v44 = array;
            v45 = [v44 countByEnumeratingWithState:&v81 objects:v101 count:16];
            if (v45)
            {
              v46 = v45;
              v47 = *v82;
              do
              {
                for (k = 0; k != v46; ++k)
                {
                  if (*v82 != v47)
                  {
                    objc_enumerationMutation(v44);
                  }

                  v49 = *(*(&v81 + 1) + 8 * k);
                  accessory = [v49 accessory];
                  objc_opt_class();
                  if (objc_opt_isKindOfClass())
                  {
                    v51 = accessory;
                  }

                  else
                  {
                    v51 = 0;
                  }

                  v52 = v51;

                  if (!v52 || ([v52 device], v53 = objc_claimAutoreleasedReturnValue(), v54 = (v53 != v42) | supportsUnifiedMediaNotificationsOnResidents, v53, (v54 & 1) != 0))
                  {
                    v55 = [(HMDHome *)v80 mediaNotificationPayloadForProfile:v49];
                    [dictionary2 addEntriesFromDictionary:v55];
                  }
                }

                v46 = [v44 countByEnumeratingWithState:&v81 objects:v101 count:16];
              }

              while (v46);
            }

            v56 = [dictionary copy];
            v57 = [dictionary2 copy];
            v58 = [array3 copy];
            [(HMDHome *)v80 _modifyCharacteristicNotifications:v56 mediaNotifications:v57 actionSetNotificationPayload:v58 enableNotification:0 withDevice:v42];

            v41 = v78 + 1;
          }

          while (v78 + 1 != v75);
          v75 = [v69 countByEnumeratingWithState:&v85 objects:v102 count:16];
        }

        while (v75);
      }

      devicesCopy = v64;
    }

    else
    {
      v60 = objc_autoreleasePoolPush();
      v61 = v80;
      v62 = HMFGetOSLogHandle();
      devicesCopy = v64;
      if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
      {
        v63 = HMFGetLogIdentifier();
        *buf = 138543362;
        v107 = v63;
        _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics requiring deregistration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v60);
    }
  }

  v59 = *MEMORY[0x277D85DE8];
}

- (void)disableNotificationsForDevices:(id)devices
{
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __42__HMDHome_disableNotificationsForDevices___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = devicesCopy;
  v6 = devicesCopy;
  dispatch_async(workQueue, v7);
}

- (void)_enableNotificationsForDevices:(id)devices
{
  v196 = *MEMORY[0x277D85DE8];
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v119 = devicesCopy;
  if ([devicesCopy count])
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v193 = v9;
      v194 = 2112;
      v195 = v119;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEBUG, "%{public}@Enabling Notifications on %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    notificationRegistrations = [(HMDHome *)selfCopy notificationRegistrations];
    v140 = [notificationRegistrations count];

    primaryResident = [(HMDHome *)selfCopy primaryResident];
    device = [primaryResident device];

    if ([(HMDHome *)selfCopy isCurrentDeviceAvailableResident]&& ![(HMDHome *)selfCopy isCurrentDevicePrimaryResident])
    {
      v182 = 0u;
      v183 = 0u;
      v180 = 0u;
      v181 = 0u;
      v12 = v119;
      v13 = [v12 countByEnumeratingWithState:&v180 objects:v191 count:16];
      if (v13)
      {
        v14 = v13;
        v15 = *v181;
        while (2)
        {
          for (i = 0; i != v14; ++i)
          {
            if (*v181 != v15)
            {
              objc_enumerationMutation(v12);
            }

            if ([*(*(&v180 + 1) + 8 * i) isEqual:device])
            {
              v143 = 1;
              goto LABEL_17;
            }
          }

          v14 = [v12 countByEnumeratingWithState:&v180 objects:v191 count:16];
          if (v14)
          {
            continue;
          }

          break;
        }
      }

      v143 = 0;
LABEL_17:
    }

    else
    {
      v143 = 0;
    }

    array = [MEMORY[0x277CBEB18] array];
    v176 = 0u;
    v177 = 0u;
    v178 = 0u;
    v179 = 0u;
    obj = [(HMDHome *)selfCopy triggers];
    v148 = selfCopy;
    v149 = [obj countByEnumeratingWithState:&v176 objects:v190 count:16];
    if (v149)
    {
      v146 = *v177;
      do
      {
        v17 = 0;
        do
        {
          if (*v177 != v146)
          {
            objc_enumerationMutation(obj);
          }

          v153 = v17;
          v18 = *(*(&v176 + 1) + 8 * v17);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v19 = v18;
          }

          else
          {
            v19 = 0;
          }

          v20 = v19;

          v174 = 0u;
          v175 = 0u;
          v172 = 0u;
          v173 = 0u;
          v151 = v20;
          characteristicEvents = [v20 characteristicEvents];
          v22 = [characteristicEvents countByEnumeratingWithState:&v172 objects:v189 count:16];
          if (v22)
          {
            v23 = v22;
            v24 = *v173;
            do
            {
              for (j = 0; j != v23; ++j)
              {
                if (*v173 != v24)
                {
                  objc_enumerationMutation(characteristicEvents);
                }

                v26 = *(*(&v172 + 1) + 8 * j);
                characteristic = [v26 characteristic];

                if (characteristic)
                {
                  characteristic2 = [v26 characteristic];
                  [array addObject:characteristic2];
                }

                else
                {
                  v29 = objc_autoreleasePoolPush();
                  v30 = selfCopy;
                  v31 = HMFGetOSLogHandle();
                  if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
                  {
                    v32 = HMFGetLogIdentifier();
                    *buf = 138543618;
                    v193 = v32;
                    v194 = 2112;
                    v195 = v26;
                    _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_ERROR, "%{public}@Characteristic of HMDCharacteristicEvent %@ is nil!", buf, 0x16u);
                  }

                  objc_autoreleasePoolPop(v29);
                  selfCopy = v148;
                }
              }

              v23 = [characteristicEvents countByEnumeratingWithState:&v172 objects:v189 count:16];
            }

            while (v23);
          }

          v17 = v153 + 1;
        }

        while ((v153 + 1) != v149);
        v149 = [obj countByEnumeratingWithState:&v176 objects:v190 count:16];
      }

      while (v149);
    }

    dictionary = [MEMORY[0x277CBEB38] dictionary];
    dictionary2 = [MEMORY[0x277CBEB38] dictionary];
    dictionary3 = [MEMORY[0x277CBEB38] dictionary];
    supportsUnifiedMediaNotificationsOnResidents = [(HMDHome *)selfCopy supportsUnifiedMediaNotificationsOnResidents];
    v168 = 0u;
    v169 = 0u;
    v170 = 0u;
    v171 = 0u;
    accessories = [(HMDHome *)selfCopy accessories];
    v33 = [accessories countByEnumeratingWithState:&v168 objects:v188 count:16];
    if (v33)
    {
      v34 = v33;
      v35 = *v169;
      v135 = *MEMORY[0x277CFE810];
      v121 = *v169;
      do
      {
        v36 = 0;
        v122 = v34;
        do
        {
          if (*v169 != v35)
          {
            objc_enumerationMutation(accessories);
          }

          v37 = *(*(&v168 + 1) + 8 * v36);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v38 = v37;
          }

          else
          {
            v38 = 0;
          }

          v39 = v38;

          v40 = v37;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v41 = v40;
          }

          else
          {
            v41 = 0;
          }

          v42 = v41;
          v128 = v40;

          v130 = v39;
          if (!v39)
          {
            if (((v42 != 0) & supportsUnifiedMediaNotificationsOnResidents) != 1)
            {
              goto LABEL_121;
            }

            v129 = v42;
            mediaProfile = [v42 mediaProfile];
            if (mediaProfile)
            {
              if (v140)
              {
                v48 = [(HMDHome *)selfCopy mediaNotificationPayloadForProfile:mediaProfile];
                [dictionary3 addEntriesFromDictionary:v48];

LABEL_119:
                goto LABEL_120;
              }

              v93 = objc_autoreleasePoolPush();
              v100 = selfCopy;
              v95 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v95, OS_LOG_TYPE_DEBUG))
              {
                v96 = HMFGetLogIdentifier();
                *buf = 138543618;
                v193 = v96;
                v194 = 2112;
                v195 = v129;
                v97 = v95;
                v98 = OS_LOG_TYPE_DEBUG;
                v99 = "%{public}@Skipping enabling notifications for apple media accessory %@ because home notifications are disabled";
LABEL_117:
                _os_log_impl(&dword_2531F8000, v97, v98, v99, buf, 0x16u);
              }
            }

            else
            {
              v93 = objc_autoreleasePoolPush();
              v94 = selfCopy;
              v95 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v95, OS_LOG_TYPE_INFO))
              {
                v96 = HMFGetLogIdentifier();
                *buf = 138543618;
                v193 = v96;
                v194 = 2112;
                v195 = v129;
                v97 = v95;
                v98 = OS_LOG_TYPE_INFO;
                v99 = "%{public}@Skipping enabling notifications for apple media accessory without media profile: %@";
                goto LABEL_117;
              }
            }

            objc_autoreleasePoolPop(v93);
            goto LABEL_119;
          }

          v129 = v42;
          if (shouldSkipRemoteAccessoryNotificationRegistration(selfCopy, v39))
          {
            v43 = objc_autoreleasePoolPush();
            v44 = selfCopy;
            v45 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
            {
              v46 = HMFGetLogIdentifier();
              *buf = 138543618;
              v193 = v46;
              v194 = 2112;
              v195 = v130;
              _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Dropping all characteristics for %@ from remote notification as partitioned network is no longer supported by residents", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v43);
            goto LABEL_120;
          }

          v126 = v36;
          obja = [MEMORY[0x277CBEB18] array];
          dictionary4 = [MEMORY[0x277CBEB38] dictionary];
          v164 = 0u;
          v165 = 0u;
          v166 = 0u;
          v167 = 0u;
          services = [v39 services];
          v133 = [services countByEnumeratingWithState:&v164 objects:v187 count:16];
          if (!v133)
          {
            goto LABEL_108;
          }

          v132 = *v165;
          v147 = dictionary4;
          do
          {
            v50 = 0;
            do
            {
              if (*v165 != v132)
              {
                objc_enumerationMutation(services);
              }

              v134 = v50;
              v51 = *(*(&v164 + 1) + 8 * v50);
              v160 = 0u;
              v161 = 0u;
              v162 = 0u;
              v163 = 0u;
              v152 = v51;
              characteristics = [v51 characteristics];
              v52 = [characteristics countByEnumeratingWithState:&v160 objects:v186 count:16];
              if (v52)
              {
                v53 = v52;
                v155 = *v161;
                do
                {
                  v54 = 0;
                  do
                  {
                    if (*v161 != v155)
                    {
                      objc_enumerationMutation(characteristics);
                    }

                    v55 = *(*(&v160 + 1) + 8 * v54);
                    if ([v55 supportsNotification])
                    {
                      dataSource = [(HMDHome *)selfCopy dataSource];
                      hapMetadata = [dataSource hapMetadata];
                      type = [v55 type];
                      type2 = [v152 type];
                      v60 = [hapMetadata shouldFilterEnableNotificationsForCharacteristicType:type serviceType:type2];

                      if ((v60 & 1) == 0)
                      {
                        type3 = [v55 type];
                        type4 = [v152 type];
                        notificationRegistry = [(HMDHome *)selfCopy notificationRegistry];
                        v185 = v55;
                        v63 = [MEMORY[0x277CBEA60] arrayWithObjects:&v185 count:1];
                        v64 = [notificationRegistry usersRegisteredForNotificationsForCharacteristics:v63];
                        v65 = [v64 mutableCopy];

                        remoteDestinationString = [device remoteDestinationString];
                        if (remoteDestinationString)
                        {
                          [v65 removeObject:remoteDestinationString];
                        }

                        v67 = [v65 count];
                        v68 = v67 != 0;
                        v69 = type3;
                        if ([array containsObject:v55] & 1) != 0 || (objc_msgSend(v55, "isNonHomeNotificationsEnabled"))
                        {
                          goto LABEL_80;
                        }

                        dataSource2 = [(HMDHome *)v148 dataSource];
                        hapMetadata2 = [dataSource2 hapMetadata];
                        if ([hapMetadata2 requiresDeviceUnlock:type3 forService:type4])
                        {
                          goto LABEL_79;
                        }

                        v138 = hapMetadata2;
                        v139 = dataSource2;
                        dataSource3 = [(HMDHome *)v148 dataSource];
                        hapMetadata3 = [dataSource3 hapMetadata];
                        if ([hapMetadata3 shouldAutoEnableNotificationForCharacteristic:type3 ofService:?])
                        {

                          dataSource2 = v139;
                          hapMetadata2 = v138;
LABEL_79:

                          v69 = type3;
LABEL_80:
                          if (v143 && [v55 isNotificationEnabledForClientIdentifierPrefix:@"com.apple.HomeKitDaemon.Local"])
                          {
                            v74 = objc_autoreleasePoolPush();
                            v75 = v148;
                            v76 = HMFGetOSLogHandle();
                            if (os_log_type_enabled(v76, OS_LOG_TYPE_INFO))
                            {
                              v77 = HMFGetLogIdentifier();
                              *buf = 138543618;
                              v193 = v77;
                              v194 = 2112;
                              v195 = v55;
                              _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_INFO, "%{public}@Dropping characteristic for remote notifications from primary resident because it should be local only: %@", buf, 0x16u);
                            }

                            objc_autoreleasePoolPop(v74);
                            v69 = type3;
                          }

                          else
                          {
                            instanceID = [v55 instanceID];
                            [obja addObject:instanceID];

                            changeThresholdForEnabledNotifications = [v55 changeThresholdForEnabledNotifications];
                            if (changeThresholdForEnabledNotifications && !v140)
                            {
                              instanceID2 = [v55 instanceID];
                              stringValue = [instanceID2 stringValue];
                              [v147 setObject:changeThresholdForEnabledNotifications forKeyedSubscript:stringValue];

                              v69 = type3;
                            }
                          }

LABEL_89:

                          dictionary4 = v147;
                          selfCopy = v148;
                          goto LABEL_90;
                        }

                        v136 = hapMetadata3;
                        v137 = dataSource3;
                        if ([type3 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"])
                        {
                          v82 = [type4 isEqualToString:v135];
                          if (v67)
                          {
                            v68 = 1;
                          }

                          else
                          {
                            v68 = v82;
                          }

                          if (v82 & 1 | (v140 == 0))
                          {
LABEL_103:

                            v69 = type3;
                            if (v68)
                            {
                              goto LABEL_80;
                            }

                            goto LABEL_89;
                          }
                        }

                        else if (!v140)
                        {
                          goto LABEL_103;
                        }

                        dataSource4 = [(HMDHome *)v148 dataSource];
                        hapMetadata4 = [dataSource4 hapMetadata];
                        v85 = [hapMetadata4 shouldEnableHomeNotificationForCharacteristicType:type3 serviceType:type4];
                        if (v67)
                        {
                          v68 = 1;
                        }

                        else
                        {
                          v68 = v85;
                        }

                        goto LABEL_103;
                      }
                    }

LABEL_90:
                    ++v54;
                  }

                  while (v53 != v54);
                  v86 = [characteristics countByEnumeratingWithState:&v160 objects:v186 count:16];
                  v53 = v86;
                }

                while (v86);
              }

              v50 = v134 + 1;
            }

            while (v134 + 1 != v133);
            v133 = [services countByEnumeratingWithState:&v164 objects:v187 count:16];
          }

          while (v133);
LABEL_108:

          uuid = [v128 uuid];
          uUIDString = [uuid UUIDString];

          if ([obja count])
          {
            v89 = [obja copy];
            [dictionary setObject:v89 forKeyedSubscript:uUIDString];
          }

          v90 = [dictionary4 count];
          v91 = dictionary4;
          v35 = v121;
          v34 = v122;
          v36 = v126;
          if (v90)
          {
            v92 = [v91 copy];
            [dictionary2 setObject:v92 forKeyedSubscript:uUIDString];
          }

LABEL_120:
          v42 = v129;
LABEL_121:

          ++v36;
        }

        while (v36 != v34);
        v34 = [accessories countByEnumeratingWithState:&v168 objects:v188 count:16];
      }

      while (v34);
    }

    array2 = [MEMORY[0x277CBEB18] array];
    [dictionary count];
    if ([dictionary count] || objc_msgSend(dictionary3, "count"))
    {
      v158 = 0u;
      v159 = 0u;
      v156 = 0u;
      v157 = 0u;
      v102 = v119;
      v103 = [v102 countByEnumeratingWithState:&v156 objects:v184 count:16];
      if (v103)
      {
        v104 = v103;
        v105 = *v157;
        do
        {
          for (k = 0; k != v104; ++k)
          {
            if (*v157 != v105)
            {
              objc_enumerationMutation(v102);
            }

            v107 = *(*(&v156 + 1) + 8 * k);
            capabilities = [v107 capabilities];
            supportsUnifiedMediaNotifications = [capabilities supportsUnifiedMediaNotifications];

            if (supportsUnifiedMediaNotifications)
            {
              v110 = [dictionary3 copy];
            }

            else
            {
              v110 = 0;
            }

            v111 = [dictionary copy];
            v112 = [v110 copy];
            v113 = [array2 copy];
            [(HMDHome *)v148 _modifyCharacteristicNotifications:v111 mediaNotifications:v112 actionSetNotificationPayload:v113 enableNotification:1 withDevice:v107];
          }

          v104 = [v102 countByEnumeratingWithState:&v156 objects:v184 count:16];
        }

        while (v104);
      }
    }

    else
    {
      v115 = objc_autoreleasePoolPush();
      v116 = selfCopy;
      v117 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v117, OS_LOG_TYPE_INFO))
      {
        v118 = HMFGetLogIdentifier();
        *buf = 138543362;
        v193 = v118;
        _os_log_impl(&dword_2531F8000, v117, OS_LOG_TYPE_INFO, "%{public}@There are no characteristics/media properties requiring registration", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v115);
    }
  }

  v114 = *MEMORY[0x277D85DE8];
}

- (void)enableNotificationsForDevices:(id)devices
{
  devicesCopy = devices;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __41__HMDHome_enableNotificationsForDevices___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = devicesCopy;
  v6 = devicesCopy;
  dispatch_async(workQueue, v7);
}

- (void)_modifyCharacteristicNotificationsOnResident:(id)resident mediaNotifications:(id)notifications actionSetNotificationPayload:(id)payload enableNotification:(BOOL)notification
{
  notificationCopy = notification;
  v55 = *MEMORY[0x277D85DE8];
  residentCopy = resident;
  notificationsCopy = notifications;
  payloadCopy = payload;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  selfCopy = self;
  primaryResident = [(HMDHome *)self primaryResident];
  if (isWatch())
  {
    homeManager = [(HMDHome *)selfCopy homeManager];
    companionReachable = [homeManager companionReachable];

    if (companionReachable)
    {

      primaryResident = 0;
LABEL_11:
      v17 = residentCopy;
      goto LABEL_12;
    }
  }

  if (!primaryResident)
  {
    goto LABEL_11;
  }

  device = [primaryResident device];
  isCurrentDevice = [device isCurrentDevice];

  v17 = residentCopy;
  if (isCurrentDevice)
  {
LABEL_12:
    device2 = [primaryResident device];
    isCurrentDevice2 = [device2 isCurrentDevice];

    if (isCurrentDevice2)
    {
      v38 = primaryResident;
      v46 = 0u;
      v47 = 0u;
      v44 = 0u;
      v45 = 0u;
      obj = [(HMDHome *)selfCopy residentEnabledDevices];
      v26 = [obj countByEnumeratingWithState:&v44 objects:v48 count:16];
      if (v26)
      {
        v27 = v26;
        v28 = *v45;
        v29 = "Disabling";
        if (notificationCopy)
        {
          v29 = "Enabling";
        }

        v39 = v29;
        do
        {
          for (i = 0; i != v27; ++i)
          {
            v31 = notificationsCopy;
            if (*v45 != v28)
            {
              objc_enumerationMutation(obj);
            }

            v32 = *(*(&v44 + 1) + 8 * i);
            v33 = objc_autoreleasePoolPush();
            v34 = selfCopy;
            v35 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
            {
              v36 = HMFGetLogIdentifier();
              *buf = 138543874;
              v50 = v36;
              v51 = 2080;
              v52 = v39;
              v53 = 2112;
              v54 = v32;
              _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@%s notifications with secondary resident %@", buf, 0x20u);

              v17 = residentCopy;
            }

            objc_autoreleasePoolPop(v33);
            notificationsCopy = v31;
            [(HMDHome *)v34 _modifyCharacteristicNotifications:v17 mediaNotifications:v31 actionSetNotificationPayload:payloadCopy enableNotification:notificationCopy withDevice:v32 completion:0];
          }

          v27 = [obj countByEnumeratingWithState:&v44 objects:v48 count:16];
        }

        while (v27);
      }

      primaryResident = v38;
    }

    [(HMDHome *)selfCopy _modifyCharacteristicNotificationsOnResidentUsers:v17 mediaNotifications:notificationsCopy actionSetNotificationPayload:payloadCopy enableNotification:notificationCopy];
    goto LABEL_26;
  }

  device3 = [primaryResident device];
  v19 = objc_autoreleasePoolPush();
  v20 = selfCopy;
  v21 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    v22 = HMFGetLogIdentifier();
    v23 = "Disabling";
    *buf = 138543874;
    v50 = v22;
    if (notificationCopy)
    {
      v23 = "Enabling";
    }

    v51 = 2080;
    v52 = v23;
    v53 = 2112;
    v54 = device3;
    _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@%s notifications with resident %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v19);
  [(HMDHome *)v20 _modifyCharacteristicNotifications:residentCopy mediaNotifications:notificationsCopy actionSetNotificationPayload:payloadCopy enableNotification:notificationCopy withDevice:device3 completion:0];

LABEL_26:
  v37 = *MEMORY[0x277D85DE8];
}

- (void)enableMediaNotifications:(BOOL)notifications directlyOnMediaAccessory:(id)accessory completion:(id)completion
{
  accessoryCopy = accessory;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __72__HMDHome_enableMediaNotifications_directlyOnMediaAccessory_completion___block_invoke;
  v13[3] = &unk_279732430;
  notificationsCopy = notifications;
  v13[4] = self;
  v14 = accessoryCopy;
  v15 = completionCopy;
  v11 = completionCopy;
  v12 = accessoryCopy;
  dispatch_async(workQueue, v13);
}

- (void)enableHomeNotificationsForMediaAccessory:(id)accessory
{
  accessoryCopy = accessory;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __52__HMDHome_enableHomeNotificationsForMediaAccessory___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = accessoryCopy;
  v6 = accessoryCopy;
  dispatch_async(workQueue, v7);
}

void __52__HMDHome_enableHomeNotificationsForMediaAccessory___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) notificationRegistrationsForAppleMediaAccessories];
  v3 = [v2 count];

  if (v3)
  {
    v4 = *(a1 + 32);
    v5 = *(a1 + 40);

    [(HMDHome *)v4 _enableMediaNotifications:v5 forMediaAccessory:?];
  }
}

- (void)_subscribeForHomeNotificationsFromRemoteGateway:(BOOL)gateway accessories:(id)accessories
{
  gatewayCopy = gateway;
  v58 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v48 = 0;
  v49 = 0;
  v46 = 0;
  v47 = 0;
  v45 = 0;
  [(HMDHome *)self _notificationPayloadsForRemoteGateway:gatewayCopy accessories:accessoriesCopy enableCharacteristicNotificationPayload:&v49 characteristicNotificationThresholdsPayload:&v48 disableCharacteristicNotificationPayload:&v47 enableMediaNotificationPayload:&v46 disableMediaNotificationPayload:&v45];
  v8 = v49;
  v9 = v48;
  v10 = v47;
  v11 = v46;
  v12 = v45;
  if ([v10 count] || objc_msgSend(v8, "count") || objc_msgSend(v12, "count") || objc_msgSend(v11, "count"))
  {
    if ([v8 count] || objc_msgSend(v11, "count"))
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v38 = v13;
        v17 = v16 = v11;
        HMFBooleanToString();
        v18 = v39 = v12;
        [v8 shortDescription];
        v40 = v8;
        v42 = v10;
        v20 = v19 = accessoriesCopy;
        [v16 shortDescription];
        v22 = v21 = v9;
        *buf = 138544130;
        v51 = v17;
        v52 = 2112;
        v53 = v18;
        v54 = 2112;
        v55 = v20;
        v56 = 2112;
        v57 = v22;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v9 = v21;
        accessoriesCopy = v19;
        v8 = v40;
        v10 = v42;

        v12 = v39;
        v11 = v16;
        v13 = v38;
      }

      objc_autoreleasePoolPop(v13);
      [(HMDHome *)selfCopy _modifyCharacteristicNotificationsOnResident:v8 mediaNotifications:v11 actionSetNotificationPayload:MEMORY[0x277CBEBF8] enableNotification:1];
    }

    if ([v10 count] || objc_msgSend(v12, "count"))
    {
      v23 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v26 = v43 = v11;
        HMFBooleanToString();
        v27 = v44 = accessoriesCopy;
        [v10 shortDescription];
        v28 = v41 = v9;
        [v12 shortDescription];
        v30 = v29 = v12;
        *buf = 138544130;
        v51 = v26;
        v52 = 2112;
        v53 = v27;
        v54 = 2112;
        v55 = v28;
        v56 = 2112;
        v57 = v30;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_INFO, "%{public}@De-registering notifications with remote gateway when notificationEnabled: %@, characteristics: %@, properties: %@", buf, 0x2Au);

        v12 = v29;
        v9 = v41;

        accessoriesCopy = v44;
        v11 = v43;
      }

      objc_autoreleasePoolPop(v23);
      [(HMDHome *)selfCopy2 _modifyCharacteristicNotificationsOnResident:v10 mediaNotifications:v12 actionSetNotificationPayload:MEMORY[0x277CBEBF8] enableNotification:0];
    }
  }

  else
  {
    v32 = v12;
    v33 = v11;
    v34 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v36 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
    {
      v37 = HMFGetLogIdentifier();
      *buf = 138543362;
      v51 = v37;
      _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_INFO, "%{public}@Not registering notifications with remote gateway since we have no modifications", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v34);
    v11 = v33;
    v12 = v32;
  }

  v31 = *MEMORY[0x277D85DE8];
}

uint64_t __59__HMDHome__subscribeForHomeNotificationsFromRemoteGateway___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  v3 = (v2 == 0) | ~objc_opt_isKindOfClass();

  return v3 & 1;
}

- (void)subscribeForNotificationsFromRemoteGateway
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __53__HMDHome_subscribeForNotificationsFromRemoteGateway__block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

- (void)_createModifyNotificationsCoalesceTimerIfNeeded
{
  v19 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  modifyNotificationsCoalesceTimer = [(HMDHome *)self modifyNotificationsCoalesceTimer];

  if (!modifyNotificationsCoalesceTimer)
  {
    v5 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:0.5];
    [(HMDHome *)self setModifyNotificationsCoalesceTimer:v5];

    workQueue2 = [(HMDHome *)self workQueue];
    modifyNotificationsCoalesceTimer2 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [modifyNotificationsCoalesceTimer2 setDelegateQueue:workQueue2];

    modifyNotificationsCoalesceTimer3 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [modifyNotificationsCoalesceTimer3 setDelegate:self];

    modifyNotificationsCoalesceTimer4 = [(HMDHome *)self modifyNotificationsCoalesceTimer];
    [modifyNotificationsCoalesceTimer4 resume];

    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543618;
      v16 = v13;
      v17 = 2112;
      v18 = selfCopy;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@%@ Kicked off the modify notifications on resident request timer", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds
{
  v49 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  thresholdsCopy = thresholds;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v31 = thresholdsCopy;
  if (enabled)
  {
    enableNotificationPayload = [(HMDHome *)self enableNotificationPayload];
    [(HMDHome *)self disableNotificationPayload];
  }

  else
  {
    enableNotificationPayload = [(HMDHome *)self disableNotificationPayload];
    [(HMDHome *)self enableNotificationPayload];
  }
  v35 = ;
  v40 = 0u;
  v41 = 0u;
  v38 = 0u;
  v39 = 0u;
  obj = characteristicsCopy;
  v37 = [obj countByEnumeratingWithState:&v38 objects:v48 count:16];
  if (v37)
  {
    v36 = *v39;
    v32 = enableNotificationPayload;
    selfCopy = self;
    do
    {
      for (i = 0; i != v37; ++i)
      {
        if (*v39 != v36)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v38 + 1) + 8 * i);
        accessory = [v13 accessory];
        uuid = [accessory uuid];
        uUIDString = [uuid UUIDString];

        if (uUIDString)
        {
          array = [enableNotificationPayload objectForKeyedSubscript:uUIDString];
          if (!array)
          {
            array = [MEMORY[0x277CBEB18] array];
            [enableNotificationPayload setObject:array forKeyedSubscript:uUIDString];
          }

          instanceID = [v13 instanceID];
          v19 = [array containsObject:instanceID];

          if ((v19 & 1) == 0)
          {
            instanceID2 = [v13 instanceID];
            [array addObject:instanceID2];
          }

          v21 = [v35 objectForKeyedSubscript:uUIDString];

          instanceID3 = [v13 instanceID];
          v23 = [v21 containsObject:instanceID3];

          if (v23)
          {
            instanceID4 = [v13 instanceID];
            [v21 removeObject:instanceID4];

            v25 = objc_autoreleasePoolPush();
            selfCopy2 = self;
            v27 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
            {
              v28 = HMFGetLogIdentifier();
              v29 = HMFBooleanToString();
              *buf = 138543874;
              v43 = v28;
              v44 = 2112;
              v45 = v29;
              v46 = 2112;
              v47 = v13;
              _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Function call to set notification to %@, removing the entry %@ from the other payload", buf, 0x20u);

              self = selfCopy;
              enableNotificationPayload = v32;
            }

            objc_autoreleasePoolPop(v25);
            if (![v21 count])
            {
              [v35 removeObjectForKey:uUIDString];
            }
          }
        }
      }

      v37 = [obj countByEnumeratingWithState:&v38 objects:v48 count:16];
    }

    while (v37);
  }

  if ([enableNotificationPayload count] || objc_msgSend(v35, "count"))
  {
    [(HMDHome *)self _createModifyNotificationsCoalesceTimerIfNeeded];
  }

  v30 = *MEMORY[0x277D85DE8];
}

- (void)remotelySetNotificationsEnabled:(BOOL)enabled forCharacteristics:(id)characteristics characteristicChangeThresholds:(id)thresholds
{
  characteristicsCopy = characteristics;
  thresholdsCopy = thresholds;
  workQueue = [(HMDHome *)self workQueue];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __93__HMDHome_remotelySetNotificationsEnabled_forCharacteristics_characteristicChangeThresholds___block_invoke;
  v13[3] = &unk_279731C38;
  enabledCopy = enabled;
  v13[4] = self;
  v14 = characteristicsCopy;
  v15 = thresholdsCopy;
  v11 = thresholdsCopy;
  v12 = characteristicsCopy;
  dispatch_async(workQueue, v13);
}

- (void)redispatchToResidentMessage:(id)message target:(id)target responseQueue:(id)queue viaDevice:(id)device
{
  v103 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  targetCopy = target;
  queueCopy = queue;
  deviceCopy = device;
  v92 = targetCopy;
  if (targetCopy)
  {
    v13 = messageCopy;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
    }

    else
    {
      v14 = 0;
    }

    v15 = v14;

    if (v15)
    {
      v16 = v13;
    }

    else
    {
      v16 = [v13 mutableCopy];
    }

    v17 = v16;

    responseHandler = [(HMDAssertionLogEvent *)v17 responseHandler];
    if (responseHandler)
    {
      v94[0] = MEMORY[0x277D85DD0];
      v94[1] = 3221225472;
      v94[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke;
      v94[3] = &unk_279732CF0;
      v95 = queueCopy;
      v96 = responseHandler;
      [(HMDAssertionLogEvent *)v17 setResponseHandler:v94];
    }

    name = [(HMDAssertionLogEvent *)v17 name];
    v20 = [name isEqualToString:@"kMultipleCharacteristicWriteRequestKey"];

    if (!isiOSDevice())
    {
      goto LABEL_15;
    }

    if (redispatchToResidentMessage_target_responseQueue_viaDevice__pred != -1)
    {
      dispatch_once(&redispatchToResidentMessage_target_responseQueue_viaDevice__pred, &__block_literal_global_858);
    }

    v21 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
    name2 = [(HMDAssertionLogEvent *)v17 name];
    LODWORD(v21) = [v21 containsObject:name2];

    if (!v21)
    {
      goto LABEL_15;
    }

    currentUser = [(HMDHome *)self currentUser];
    isRemoteAccessAllowed = [currentUser isRemoteAccessAllowed];

    if ((isRemoteAccessAllowed & 1) == 0)
    {
      v91 = queueCopy;
      isResidentFirstAccessoryCommunicationEnabled = [(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled];
      v71 = objc_autoreleasePoolPush();
      selfCopy = self;
      v73 = HMFGetOSLogHandle();
      v74 = os_log_type_enabled(v73, OS_LOG_TYPE_INFO);
      if (!isResidentFirstAccessoryCommunicationEnabled)
      {
        if (v74)
        {
          v78 = HMFGetLogIdentifier();
          currentUser2 = [(HMDHome *)selfCopy currentUser];
          shortDescription = [currentUser2 shortDescription];
          *buf = 138543618;
          v98 = v78;
          v99 = 2112;
          v100 = shortDescription;
          _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_INFO, "%{public}@Remote access is disabled for the current user: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v71);
        v27 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        [(HMDAssertionLogEvent *)v17 respondWithError:v27];
        queueCopy = v91;
        goto LABEL_40;
      }

      if (v74)
      {
        HMFGetLogIdentifier();
        v75 = v88 = v71;
        currentUser3 = [(HMDHome *)selfCopy currentUser];
        displayName = [currentUser3 displayName];
        *buf = 138543618;
        v98 = v75;
        v99 = 2112;
        v100 = displayName;
        _os_log_impl(&dword_2531F8000, v73, OS_LOG_TYPE_INFO, "%{public}@Remote access is disabled for the user %@, restricting to local transports...", buf, 0x16u);

        v71 = v88;
      }

      objc_autoreleasePoolPop(v71);
      v25 = 1;
      queueCopy = v91;
    }

    else
    {
LABEL_15:
      v25 = 0;
    }

    messagePayload = [(HMDAssertionLogEvent *)v17 messagePayload];
    v27 = [messagePayload mutableCopy];

    if (v25)
    {
      [(HMDAssertionLogEvent *)v17 setRemoteDisallowsIDSRacing:1];
    }

    currentActivity = [MEMORY[0x277D0F770] currentActivity];
    v29 = currentActivity;
    if (deviceCopy)
    {
      [(HMDAssertionLogEvent *)v17 setSecureRemote:1];
      v30 = [[HMDRemoteDeviceMessageDestination alloc] initWithTarget:v92 device:deviceCopy];
      [(HMDAssertionLogEvent *)v17 setDestination:v30];

      [v27 setObject:0 forKeyedSubscript:@"kIDSMessageSourceIDKey"];
      if (([(HMDHome *)self isResidentFirstAccessoryCommunicationEnabled]& v20) == 1)
      {
        capabilities = [deviceCopy capabilities];
        supportsResidentFirstAccessoryCommunication = [capabilities supportsResidentFirstAccessoryCommunication];

        if ((supportsResidentFirstAccessoryCommunication & 1) == 0)
        {
          [v27 setObject:0 forKeyedSubscript:@"kMultiPartResponseKey"];
        }
      }

      [(HMDAssertionLogEvent *)v17 setMessagePayload:v27];
      v33 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v35 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v86 = v27;
        v89 = responseHandler;
        v37 = v36 = queueCopy;
        shortDescription2 = [(HMDAssertionLogEvent *)v17 shortDescription];
        [deviceCopy shortDescription];
        v40 = v39 = v29;
        *buf = 138543874;
        v98 = v37;
        v99 = 2112;
        v100 = shortDescription2;
        v101 = 2112;
        v102 = v40;
        _os_log_impl(&dword_2531F8000, v35, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to device: %@", buf, 0x20u);

        v29 = v39;
        queueCopy = v36;
        v27 = v86;
        responseHandler = v89;
      }

      objc_autoreleasePoolPop(v33);
      [(HMDAssertionLogEvent *)v17 name];

      [(HMDAssertionLogEvent *)v17 identifier];
      [deviceCopy identifier];

      v41 = +[HMDSecureRemoteMessageTransport defaultTransport];
      v42 = [(HMDAssertionLogEvent *)v17 copy];
      [v41 sendMessage:v42 completionHandler:0];
    }

    else
    {
      v85 = currentActivity;
      v90 = queueCopy;
      v43 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v45 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v45, OS_LOG_TYPE_INFO))
      {
        v46 = HMFGetLogIdentifier();
        shortDescription3 = [(HMDAssertionLogEvent *)v17 shortDescription];
        *buf = 138543618;
        v98 = v46;
        v99 = 2112;
        v100 = shortDescription3;
        _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to resident", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v43);
      homeManager = [(HMDHome *)selfCopy3 homeManager];
      messageDispatcher = [homeManager messageDispatcher];
      v41 = [messageDispatcher residentCommunicationHandlerForHome:selfCopy3];

      preferredDevice = [v41 preferredDevice];
      if (preferredDevice)
      {
        v42 = preferredDevice;
        if (v20)
        {
          if ([(HMDHome *)selfCopy3 isResidentFirstAccessoryCommunicationEnabled])
          {
            capabilities2 = [v42 capabilities];
            supportsResidentFirstAccessoryCommunication2 = [capabilities2 supportsResidentFirstAccessoryCommunication];

            if ((supportsResidentFirstAccessoryCommunication2 & 1) == 0)
            {
              [v27 setObject:0 forKeyedSubscript:@"kMultiPartResponseKey"];
            }
          }
        }

        [(HMDAssertionLogEvent *)v17 setMessagePayload:v27];
        v53 = objc_autoreleasePoolPush();
        v54 = selfCopy3;
        v55 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v55, OS_LOG_TYPE_INFO))
        {
          v56 = HMFGetLogIdentifier();
          [(HMDAssertionLogEvent *)v17 shortDescription];
          v87 = v27;
          v58 = v57 = responseHandler;
          shortDescription4 = [v42 shortDescription];
          *buf = 138543874;
          v98 = v56;
          v99 = 2112;
          v100 = v58;
          v101 = 2112;
          v102 = shortDescription4;
          _os_log_impl(&dword_2531F8000, v55, OS_LOG_TYPE_INFO, "%{public}@Redispatching message %@ to remote device: %@", buf, 0x20u);

          deviceCopy = 0;
          responseHandler = v57;
          v27 = v87;
        }

        objc_autoreleasePoolPop(v53);
        queueCopy = v90;
        [v41 redispatchMessage:v17 target:v92 responseQueue:v90];
      }

      else
      {
        v60 = objc_autoreleasePoolPush();
        v61 = selfCopy3;
        v62 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
        {
          v63 = HMFGetLogIdentifier();
          shortDescription5 = [(HMDAssertionLogEvent *)v17 shortDescription];
          [(HMDHome *)v61 shortDescription];
          v65 = v27;
          v67 = v66 = responseHandler;
          *buf = 138543874;
          v98 = v63;
          v99 = 2112;
          v100 = shortDescription5;
          v101 = 2112;
          v102 = v67;
          _os_log_impl(&dword_2531F8000, v62, OS_LOG_TYPE_INFO, "%{public}@Cannot redispatch message %@ because there is no resident configured for home: %@", buf, 0x20u);

          responseHandler = v66;
          v27 = v65;

          deviceCopy = 0;
        }

        objc_autoreleasePoolPop(v60);
        [(HMDHome *)v61 uuid];

        v68 = [MEMORY[0x277CCA9B8] hmErrorWithCode:4];
        [(HMDAssertionLogEvent *)v17 respondWithError:v68];

        v42 = 0;
        queueCopy = v90;
      }

      v29 = v85;
    }

LABEL_40:
    goto LABEL_41;
  }

  v81 = objc_autoreleasePoolPush();
  selfCopy4 = self;
  v83 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v83, OS_LOG_TYPE_FAULT))
  {
    v84 = HMFGetLogIdentifier();
    *buf = 138543362;
    v98 = v84;
    _os_log_impl(&dword_2531F8000, v83, OS_LOG_TYPE_FAULT, "%{public}@Submitting ABC event for failure: TargetUUID cannot be nil", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v81);
  v17 = [[HMDAssertionLogEvent alloc] initWithReason:@"TargetUUID cannot be nil"];
  responseHandler = +[HMDMetricsManager sharedLogEventSubmitter];
  [responseHandler submitLogEvent:v17];
LABEL_41:

  v69 = *MEMORY[0x277D85DE8];
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_2;
  block[3] = &unk_2797355D0;
  v7 = *(a1 + 32);
  v8 = *(a1 + 40);
  v13 = v6;
  v14 = v8;
  v12 = v5;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);
}

void __70__HMDHome_redispatchToResidentMessage_target_responseQueue_viaDevice___block_invoke_3()
{
  v3[8] = *MEMORY[0x277D85DE8];
  v3[0] = @"kCharacteristicWriteRequestKey";
  v3[1] = @"kCharacteristicReadRequestKey";
  v3[2] = @"kMultipleCharacteristicWriteRequestKey";
  v3[3] = @"kMultipleCharacteristicReadRequestKey";
  v3[4] = @"kIdentifyAccessoryRequestKey";
  v3[5] = @"kMediaPropertiesWriteRequestKey";
  v3[6] = @"kMediaPropertiesReadRequestKey";
  v3[7] = @"HMDHomeSetNaturalLightingEnabledForLightProfilesMessage";
  v0 = [MEMORY[0x277CBEA60] arrayWithObjects:v3 count:8];
  v1 = redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages;
  redispatchToResidentMessage_target_responseQueue_viaDevice___restrictedToLocalMessages = v0;

  v2 = *MEMORY[0x277D85DE8];
}

- (void)addCompanionAsResidentUser:(id)user
{
  userCopy = user;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __38__HMDHome_addCompanionAsResidentUser___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = userCopy;
  v6 = userCopy;
  dispatch_async(workQueue, v7);
}

void __38__HMDHome_addCompanionAsResidentUser___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) users];
  v3 = [*(a1 + 40) userID];
  v4 = [v2 hmf_firstObjectWithValue:v3 forKeyPath:@"userID"];

  if (!v4)
  {
    [*(a1 + 32) _addUserToContainer:*(a1 + 40)];
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 32);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Added a new resident user", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  [(HMDHome *)*(a1 + 32) _subscribeForNotificationFromRemoteGateway:?];

  v9 = *MEMORY[0x277D85DE8];
}

- (id)_characteristicNotificationPayloadsOnDirectTransports:(BOOL)transports
{
  transportsCopy = transports;
  v103 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  v93 = 0u;
  v94 = 0u;
  v95 = 0u;
  v96 = 0u;
  selfCopy = self;
  obj = [(HMDHome *)self triggers];
  v4 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v94;
    do
    {
      v7 = 0;
      v72 = v5;
      do
      {
        if (*v94 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v93 + 1) + 8 * v7);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v9 = v8;
        }

        else
        {
          v9 = 0;
        }

        v10 = v9;

        if ([v10 shouldActivateOnLocalDevice])
        {
          v91 = 0u;
          v92 = 0u;
          v89 = 0u;
          v90 = 0u;
          characteristicEvents = [v10 characteristicEvents];
          v12 = [characteristicEvents countByEnumeratingWithState:&v89 objects:v101 count:16];
          if (v12)
          {
            v13 = v12;
            v14 = *v90;
            do
            {
              for (i = 0; i != v13; ++i)
              {
                if (*v90 != v14)
                {
                  objc_enumerationMutation(characteristicEvents);
                }

                v16 = *(*(&v89 + 1) + 8 * i);
                characteristic = [v16 characteristic];

                if (characteristic)
                {
                  characteristic2 = [v16 characteristic];
                  [array addObject:characteristic2];
                }
              }

              v13 = [characteristicEvents countByEnumeratingWithState:&v89 objects:v101 count:16];
            }

            while (v13);
          }

          v5 = v72;
        }

        ++v7;
      }

      while (v7 != v5);
      v5 = [obj countByEnumeratingWithState:&v93 objects:v102 count:16];
    }

    while (v5);
  }

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  dictionary2 = [MEMORY[0x277CBEB38] dictionary];
  selfCopy2 = self;
  [(HMDHome *)self accessories];
  v85 = 0u;
  v86 = 0u;
  v87 = 0u;
  v56 = v88 = 0u;
  v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
  if (v60)
  {
    v59 = *v86;
    v73 = *MEMORY[0x277CFE810];
    do
    {
      for (j = 0; j != v60; ++j)
      {
        if (*v86 != v59)
        {
          objc_enumerationMutation(v56);
        }

        v21 = *(*(&v85 + 1) + 8 * j);
        array2 = [MEMORY[0x277CBEB18] array];
        array3 = [MEMORY[0x277CBEB18] array];
        v24 = v21;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v25 = v24;
        }

        else
        {
          v25 = 0;
        }

        v26 = v25;

        if (v26)
        {
          v61 = v24;
          v62 = v26;
          v68 = array3;
          v71 = array2;
          v63 = j;
          v83 = 0u;
          v84 = 0u;
          v81 = 0u;
          v82 = 0u;
          services = [v26 services];
          v66 = [services countByEnumeratingWithState:&v81 objects:v99 count:16];
          if (!v66)
          {
            goto LABEL_61;
          }

          v65 = *v82;
          while (1)
          {
            v27 = 0;
            do
            {
              if (*v82 != v65)
              {
                objc_enumerationMutation(services);
              }

              v67 = v27;
              v28 = *(*(&v81 + 1) + 8 * v27);
              type = [v28 type];
              v77 = 0u;
              v78 = 0u;
              v79 = 0u;
              v80 = 0u;
              obja = [v28 characteristics];
              v30 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
              if (v30)
              {
                v31 = v30;
                v32 = *v78;
                do
                {
                  v33 = 0;
                  do
                  {
                    if (*v78 != v32)
                    {
                      objc_enumerationMutation(obja);
                    }

                    v34 = *(*(&v77 + 1) + 8 * v33);
                    if ([v34 supportsNotification])
                    {
                      dataSource = [(HMDHome *)selfCopy2 dataSource];
                      hapMetadata = [dataSource hapMetadata];
                      type2 = [v34 type];
                      v38 = [hapMetadata shouldFilterEnableNotificationsForCharacteristicType:type2 serviceType:type];

                      if ((v38 & 1) == 0)
                      {
                        if ([type isEqualToString:v73])
                        {
                          type3 = [v34 type];
                          v40 = [type3 isEqualToString:@"000000A6-0000-1000-8000-0026BB765291"];
                        }

                        else
                        {
                          v40 = 0;
                        }

                        dataSource2 = [(HMDHome *)selfCopy2 dataSource];
                        hapMetadata2 = [dataSource2 hapMetadata];
                        type4 = [v34 type];
                        v44 = [hapMetadata2 shouldAutoEnableNotificationForCharacteristic:type4 ofService:type];

                        if ([v34 isClientNotificationEnabled] & 1) != 0 || (objc_msgSend(array, "containsObject:", v34) & 1) != 0 || ((objc_msgSend(v34, "isNonHomeNotificationsEnabled") | v40 | v44))
                        {
                          v45 = v71;
LABEL_50:
                          [v45 addObject:v34];
                          selfCopy2 = selfCopy;
                          goto LABEL_51;
                        }

                        if (!transportsCopy)
                        {
                          v45 = v68;
                          goto LABEL_50;
                        }

                        type5 = [v34 type];
                        selfCopy2 = selfCopy;
                        dataSource3 = [(HMDHome *)selfCopy dataSource];
                        hapMetadata3 = [dataSource3 hapMetadata];
                        v49 = [hapMetadata3 shouldEnableHomeNotificationForCharacteristicType:type5 serviceType:type];

                        if (v49)
                        {
                          [v71 addObject:v34];
                        }
                      }
                    }

LABEL_51:
                    ++v33;
                  }

                  while (v31 != v33);
                  v50 = [obja countByEnumeratingWithState:&v77 objects:v98 count:16];
                  v31 = v50;
                }

                while (v50);
              }

              v27 = v67 + 1;
            }

            while (v67 + 1 != v66);
            v66 = [services countByEnumeratingWithState:&v81 objects:v99 count:16];
            if (!v66)
            {
LABEL_61:

              v26 = v62;
              j = v63;
              array2 = v71;
              array3 = v68;
              v24 = v61;
              break;
            }
          }
        }

        uuid = [v24 uuid];
        uUIDString = [uuid UUIDString];

        if ([array2 count])
        {
          [dictionary setObject:array2 forKeyedSubscript:uUIDString];
        }

        if ([array3 count])
        {
          [dictionary2 setObject:array3 forKeyedSubscript:uUIDString];
        }
      }

      v60 = [v56 countByEnumeratingWithState:&v85 objects:v100 count:16];
    }

    while (v60);
  }

  v97[0] = dictionary2;
  v97[1] = dictionary;
  v53 = [MEMORY[0x277CBEA60] arrayWithObjects:v97 count:2];

  v54 = *MEMORY[0x277D85DE8];

  return v53;
}

- (void)_handleRemoteGatewayNotificationRegistration:(id)registration enable:(BOOL)enable
{
  enableCopy = enable;
  v25 = *MEMORY[0x277D85DE8];
  registrationCopy = registration;
  date = [MEMORY[0x277CBEAA8] date];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v6 = registrationCopy;
  v7 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v21;
    do
    {
      v10 = 0;
      do
      {
        if (*v21 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v20 + 1) + 8 * v10);
        v12 = [objc_alloc(MEMORY[0x277CCAD78]) initWithUUIDString:v11];
        v13 = [(HMDHome *)self accessoryWithUUID:v12];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if (v15)
        {
          v16 = [v6 hmf_arrayForKey:v11];
          if ([v16 count])
          {
            [v15 handleRemoteGatewayNotificationRegistration:v16 enable:enableCopy enableTime:date];
          }
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v8);
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (BOOL)applyDeviceLockStatus:(id)status
{
  v23 = *MEMORY[0x277D85DE8];
  statusCopy = status;
  if ([statusCopy isRemote])
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      shortDescription = [statusCopy shortDescription];
      v19 = 138543618;
      v20 = v8;
      v21 = 2112;
      v22 = shortDescription;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@%@ is from remote source; ignoring this device's lock status", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    isLocked = 0;
  }

  else if ([statusCopy BOOLForKey:@"kApplyDeviceUnlockKey"])
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v19 = 138543362;
      v20 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Treating device as always locked.", &v19, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    isLocked = 1;
  }

  else
  {
    dataSource = [(HMDHome *)self dataSource];
    deviceLockStateDataSource = [dataSource deviceLockStateDataSource];
    isLocked = [deviceLockStateDataSource isLocked];
  }

  v17 = *MEMORY[0x277D85DE8];
  return isLocked;
}

- (void)configureMediaGroupsAggregateConsumer
{
  v33 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    homeManager = [(HMDHome *)self homeManager];
    uuid = [(HMDHome *)self uuid];
    notificationCenter = [(HMDHome *)self notificationCenter];
    localAndRemoteSubscriptionProvider = [homeManager localAndRemoteSubscriptionProvider];
    userDefaults = [homeManager userDefaults];
    v8 = userDefaults;
    if (localAndRemoteSubscriptionProvider && uuid && notificationCenter && userDefaults)
    {
      v9 = [[HMDMediaGroupsStageManager alloc] initWithIdentifier:uuid userDefaults:userDefaults];
      v10 = [[HMDMediaGroupsAggregateConsumer alloc] initWithIdentifier:uuid subscriptionProvider:localAndRemoteSubscriptionProvider notificationCenter:notificationCenter stageManager:v9];
      mediaGroupsAggregateConsumer = self->_mediaGroupsAggregateConsumer;
      self->_mediaGroupsAggregateConsumer = v10;

      [(HMDMediaGroupsStageManager *)v9 setDelegate:self->_mediaGroupsAggregateConsumer];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer setDelegate:self];
      [(HMDMediaGroupsAggregateConsumer *)self->_mediaGroupsAggregateConsumer configureWithHome:self];
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v19 = HMFGetLogIdentifier();
        v21 = 138544642;
        v22 = v19;
        v23 = 2112;
        v24 = uuid;
        v25 = 2112;
        v26 = localAndRemoteSubscriptionProvider;
        v27 = 2112;
        v28 = notificationCenter;
        v29 = 2112;
        v30 = v8;
        v31 = 2112;
        v32 = homeManager;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregate consumer with dependencies homeUUID: %@ subscriptionProvider: %@ notificationCenter: %@ userDefaults: %@ homeManager: %@", &v21, 0x3Eu);
      }

      objc_autoreleasePoolPop(v16);
    }
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is disabled", &v21, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v20 = *MEMORY[0x277D85DE8];
}

- (id)roomForAllDestinationParentIdentifiers:(id)identifiers
{
  v36 = *MEMORY[0x277D85DE8];
  identifiersCopy = identifiers;
  if ([identifiersCopy count])
  {
    v5 = [(HMDHome *)self accessoriesWithUUIDs:identifiersCopy];
    v6 = [(HMDHome *)self mediaSystemsWithUUIDs:identifiersCopy];
    v7 = [identifiersCopy count];
    v8 = [v5 count];
    if (v7 == [v6 count] + v8)
    {
      firstObject = [v5 firstObject];
      room = [firstObject room];
      v11 = room;
      if (room)
      {
        room2 = room;
      }

      else
      {
        firstObject2 = [v6 firstObject];
        room2 = [firstObject2 room];
      }

      v26[0] = MEMORY[0x277D85DD0];
      v26[1] = 3221225472;
      v26[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke;
      v26[3] = &unk_27972C828;
      v19 = room2;
      v27 = v19;
      if ([v5 na_allObjectsPassTest:v26])
      {
        v24[0] = MEMORY[0x277D85DD0];
        v24[1] = 3221225472;
        v24[2] = __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2;
        v24[3] = &unk_279726148;
        v20 = v19;
        v25 = v20;
        if ([v6 na_allObjectsPassTest:v24])
        {
          v21 = v20;
        }

        else
        {
          v21 = 0;
        }

        v13 = v21;
      }

      else
      {
        v13 = 0;
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      selfCopy = self;
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138544130;
        v29 = v17;
        v30 = 2112;
        v31 = identifiersCopy;
        v32 = 2112;
        v33 = v5;
        v34 = 2112;
        v35 = v6;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Failed to find room due to missing destination parent identifiers: %@ found accessories: %@ found media systems: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v14);
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  v22 = *MEMORY[0x277D85DE8];

  return v13;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

uint64_t __50__HMDHome_roomForAllDestinationParentIdentifiers___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 room];
  v4 = [v3 uuid];
  v5 = [*(a1 + 32) uuid];
  v6 = [v4 hmf_isEqualToUUID:v5];

  return v6;
}

- (id)roomForAccessoryUUID:(id)d
{
  v3 = [(HMDHome *)self accessoryWithUUID:d];
  room = [v3 room];

  return room;
}

- (id)sameRoomAccessoryUUIDsForDestinationControllerData:(id)data mediaGroupsAggregator:(id)aggregator
{
  v25 = *MEMORY[0x277D85DE8];
  dataCopy = data;
  aggregatorCopy = aggregator;
  parentIdentifier = [dataCopy parentIdentifier];
  v9 = [(HMDHome *)self roomForAccessoryUUID:parentIdentifier];

  if (v9)
  {
    accessories = [(HMDHome *)self accessories];
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke;
    v19[3] = &unk_279722060;
    v20 = v9;
    v11 = [accessories na_map:v19];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      parentIdentifier2 = [dataCopy parentIdentifier];
      *buf = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = parentIdentifier2;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get available destinations due to no room for accessory uuid: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v11 = MEMORY[0x277CBEBF8];
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

id __84__HMDHome_sameRoomAccessoryUUIDsForDestinationControllerData_mediaGroupsAggregator___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 room];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 hmf_isEqualToUUID:v6])
  {
    v7 = [v3 uuid];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)eventSourceForMediaGroupsAggregator:(id)aggregator
{
  homeManager = [(HMDHome *)self homeManager];
  currentEventSource = [homeManager currentEventSource];

  return currentEventSource;
}

- (id)participantDataTopicForAccessory:(id)accessory mediaGroupsAggregator:(id)aggregator
{
  v5 = MEMORY[0x277CD16F0];
  v6 = *MEMORY[0x277CCEA70];
  accessoryCopy = accessory;
  uuid = [(HMDHome *)self uuid];
  uuid2 = [accessoryCopy uuid];

  v10 = [v5 topicFromSuffixID:v6 homeUUID:uuid accessoryUUID:uuid2];

  return v10;
}

- (void)configureMediaGroupsAggregator
{
  v51 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    uuid = [(HMDHome *)self uuid];
    homeManager = [(HMDHome *)self homeManager];
    uuid2 = [homeManager uuid];
    notificationCenter = [(HMDHome *)self notificationCenter];
    primaryResidentChangeMonitor = [(HMDHome *)self primaryResidentChangeMonitor];
    eventForwarder = [homeManager eventForwarder];
    localAndRemoteSubscriptionProvider = [homeManager localAndRemoteSubscriptionProvider];
    eventStoreReadHandle = [homeManager eventStoreReadHandle];
    msgDispatcher = [(HMDHome *)self msgDispatcher];
    v28 = msgDispatcher;
    if (uuid && notificationCenter && primaryResidentChangeMonitor && eventForwarder && localAndRemoteSubscriptionProvider && eventStoreReadHandle && msgDispatcher)
    {
      v10 = [[HMDMediaGroupsAggregatorBackupSender alloc] initWithIdentifier:uuid];
      v24 = [[HMDMediaGroupsLocalDataStorage alloc] initWithIdentifier:uuid backupSender:v10];
      v11 = objc_alloc_init(HMDMediaGroupsAggregatorMessenger);
      v26 = uuid2;
      v12 = [[HMDMediaGroupsAggregator alloc] initWithIdentifier:uuid messenger:v11 eventForwarder:eventForwarder subscriptionProvider:localAndRemoteSubscriptionProvider eventStoreReadHandle:eventStoreReadHandle groupsLocalDataStorage:v24];
      [(HMDMediaGroupsAggregatorBackupSender *)v10 setDataSource:v24];
      [(HMDMediaGroupsLocalDataStorage *)v24 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDataSource:self];
      [(HMDMediaGroupsAggregatorMessenger *)v11 setDelegate:v12];
      [(HMDMediaGroupsAggregator *)v12 setDataSource:self];
      [(HMDHome *)self setMediaGroupsAggregator:v12];
      mediaGroupsAggregator = [(HMDHome *)self mediaGroupsAggregator];
      selfCopy = self;
      v15 = v28;
      [mediaGroupsAggregator configureWithHome:selfCopy messageDispatcher:v28 notificationCenter:notificationCenter primaryResidentChangeMonitor:primaryResidentChangeMonitor];

      uuid2 = v26;
    }

    else
    {
      v27 = eventStoreReadHandle;
      context = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = HMFGetLogIdentifier();
        *buf = 138545666;
        v32 = v22;
        v33 = 2112;
        v34 = uuid;
        v35 = 2112;
        v36 = uuid2;
        v37 = 2112;
        v38 = notificationCenter;
        v39 = 2112;
        v40 = primaryResidentChangeMonitor;
        v41 = 2112;
        v42 = eventForwarder;
        v43 = 2112;
        v44 = localAndRemoteSubscriptionProvider;
        v45 = 2112;
        v46 = v27;
        v47 = 2112;
        v48 = homeManager;
        v49 = 2112;
        v50 = v28;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups aggregator with dependencies homeUUID: %@ homeManagerUUID: %@ notificationCenter: %@ primaryChangeMonitor: %@ eventForwarder: %@ subscriptionProvider: %@ eventStoreReadHandle: %@ homeManager: %@ message dispatcher: %@", buf, 0x66u);
      }

      objc_autoreleasePoolPop(context);
      eventStoreReadHandle = v27;
      v15 = v28;
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543362;
      v32 = v19;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v16);
  }

  v23 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupsUnconfiguredParticipantOnboardingManager
{
  v23 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    uuid = [(HMDHome *)self uuid];
    notificationCenter = [(HMDHome *)self notificationCenter];
    v5 = notificationCenter;
    if (uuid && notificationCenter)
    {
      v6 = [[HMDMediaGroupsUnconfiguredParticipantOnboardingManager alloc] initWithIdentifier:uuid];
      [(HMDMediaGroupsUnconfiguredParticipantOnboardingManager *)v6 setDataSource:self];
      [(HMDHome *)self setMediaGroupsUnconfiguredParticipantOnboardingManager:v6];
      mediaGroupsUnconfiguredParticipantOnboardingManager = [(HMDHome *)self mediaGroupsUnconfiguredParticipantOnboardingManager];
      [mediaGroupsUnconfiguredParticipantOnboardingManager configureWithNotificationCenter:v5];
    }

    else
    {
      v12 = objc_autoreleasePoolPush();
      selfCopy = self;
      v14 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        v15 = HMFGetLogIdentifier();
        v17 = 138543874;
        v18 = v15;
        v19 = 2112;
        v20 = uuid;
        v21 = 2112;
        v22 = v5;
        _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to configure media groups unconfigured participant onboarding manager with dependencies homeUUID: %@ notificationCenter: %@", &v17, 0x20u);
      }

      objc_autoreleasePoolPop(v12);
    }
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      v17 = 138543362;
      v18 = v11;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v17, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (id)receiverForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage
{
  v25 = *MEMORY[0x277D85DE8];
  dCopy = d;
  storageCopy = storage;
  homeManager = [(HMDHome *)self homeManager];
  mediaGroupParticipantDataLocalStorage = [homeManager mediaGroupParticipantDataLocalStorage];
  groupsBackupReceiver = [mediaGroupParticipantDataLocalStorage groupsBackupReceiver];
  v11 = groupsBackupReceiver;
  if (groupsBackupReceiver)
  {
    v12 = groupsBackupReceiver;
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      v19 = 138543874;
      v20 = v16;
      v21 = 2112;
      v22 = homeManager;
      v23 = 2112;
      v24 = mediaGroupParticipantDataLocalStorage;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@Failed to get groups backup receiver with homeManager: %@ participantStorage: %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v13);
  }

  v17 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)routerForParticipantAccessoryUUID:(id)d mediaGroupsLocalDataStorage:(id)storage
{
  v22 = *MEMORY[0x277D85DE8];
  dCopy = d;
  storageCopy = storage;
  v8 = [(HMDHome *)self accessoryWithUUID:dCopy];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = v8;
  }

  else
  {
    v9 = 0;
  }

  v10 = v9;

  if (v10)
  {
    messageRouter = [v10 messageRouter];
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v18 = 138543618;
      v19 = v15;
      v20 = 2112;
      v21 = dCopy;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_ERROR, "%{public}@Failed to get router for unknown accessory uuid: %@", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    messageRouter = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return messageRouter;
}

- (void)mergeMediaDestinationsWithConsumer:(id)consumer
{
  consumerCopy = consumer;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke;
  v11[3] = &unk_279731490;
  v6 = consumerCopy;
  v12 = v6;
  [appleMediaAccessories na_each:v11];

  mediaSystems = [(HMDHome *)self mediaSystems];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2;
  v9[3] = &unk_279722038;
  v10 = v6;
  v8 = v6;
  [mediaSystems na_each:v9];
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

void __46__HMDHome_mergeMediaDestinationsWithConsumer___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestination:v6];
  }
}

- (void)mergeMediaDestinationControllerDataWithConsumer:(id)consumer
{
  consumerCopy = consumer;
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke;
  v7[3] = &unk_279731490;
  v8 = consumerCopy;
  v6 = consumerCopy;
  [appleMediaAccessories na_each:v7];
}

void __59__HMDHome_mergeMediaDestinationControllerDataWithConsumer___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v7 = v3;
  v5 = [v3 uuid];
  v6 = [v4 destinationControllerDataWithParentIdentifier:v5];

  if (v6)
  {
    [v7 mergeAudioDestinationControllerData:v6];
  }
}

- (void)mergeMediaGroupsAggregateDataWithConsumer:(id)consumer
{
  consumerCopy = consumer;
  [(HMDHome *)self mergeMediaDestinationsWithConsumer:consumerCopy];
  [(HMDHome *)self mergeMediaDestinationControllerDataWithConsumer:consumerCopy];
  mediaSystemController = [(HMDHome *)self mediaSystemController];
  allMediaSystemData = [consumerCopy allMediaSystemData];

  [mediaSystemController mergeMediaSystemData:allMediaSystemData];
}

- (void)didUpdateAggregateDataForMediaGroupsAggregateConsumer:(id)consumer
{
  v18 = *MEMORY[0x277D85DE8];
  consumerCopy = consumer;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Updating home graph due to updated media groups aggregate data", &v16, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)selfCopy mergeMediaGroupsAggregateDataWithConsumer:consumerCopy];
  homeManager = [(HMDHome *)selfCopy homeManager];
  if (homeManager)
  {
    uuid = [(HMDHome *)selfCopy uuid];
    [homeManager updateGenerationCounterWithReason:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData" sourceUUID:uuid shouldNotifyClients:1];

    [homeManager assistantSyncDataChanged:@"HMDMediaGroupsAggregateConsumerDelegateUpdatedAggregateData"];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = selfCopy;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v16 = 138543362;
      v17 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Failed to update home graph for media groups due to no home manager", &v16, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (HMDDevice)currentDevice
{
  v2 = +[HMDAppleAccountManager sharedManager];
  device = [v2 device];

  return device;
}

- (HMFWiFiManager)wifiManager
{
  dataSource = [(HMDHome *)self dataSource];
  wifiManager = [dataSource wifiManager];

  return wifiManager;
}

- (void)_handleFetchUniqueIdentifierForBundleIdentifier:(id)identifier
{
  v27 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  v5 = [identifierCopy stringForKey:*MEMORY[0x277CCFE48]];
  if (v5)
  {
    v18 = 0;
    v6 = [HMDApplicationInfo clientIdentifierSaltForBundleIdentifier:v5 error:&v18];
    v7 = v18;
    if (v6)
    {
      v8 = MEMORY[0x277CCAD78];
      uuid = [(HMDHome *)self uuid];
      v10 = [v8 hm_deriveUUIDFromBaseUUID:uuid identifierSalt:v6];

      v19 = *MEMORY[0x277CD0570];
      v20 = v10;
      v11 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
      [identifierCopy respondWithPayload:v11];
    }

    else
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v22 = v16;
        v23 = 2112;
        v24 = v5;
        v25 = 2112;
        v26 = v7;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Failed to get client identifier salt for bundle identifier: %@, error: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      if (v7)
      {
        [identifierCopy respondWithError:v7];
        goto LABEL_10;
      }

      v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      [identifierCopy respondWithError:v10];
    }

LABEL_10:
    goto LABEL_11;
  }

  v12 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2 description:0 reason:@"Payload is missing the bundle identifier." suggestion:0];
  [identifierCopy respondWithError:v12];

LABEL_11:
  v17 = *MEMORY[0x277D85DE8];
}

- (void)configureMediaGroupObjects
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureHomeTheaterQFAEnabledForTests && ([isFeatureHomeTheaterQFAEnabledForTests BOOLValue] & 1) != 0)
  {
    [(HMDHome *)self configureMediaGroupsUnconfiguredParticipantOnboardingManager];
    [(HMDHome *)self configureMediaGroupsAggregator];
    v3 = *MEMORY[0x277D85DE8];

    [(HMDHome *)self configureMediaGroupsAggregateConsumer];
  }

  else
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Home Theater QFA is not enabled", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    v8 = *MEMORY[0x277D85DE8];
  }
}

- (id)accessoriesWithUUIDs:(id)ds
{
  dsCopy = ds;
  accessories = [(HMDHome *)self accessories];
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __32__HMDHome_accessoriesWithUUIDs___block_invoke;
  v9[3] = &unk_27972C828;
  v10 = dsCopy;
  v6 = dsCopy;
  v7 = [accessories na_filter:v9];

  return v7;
}

uint64_t __32__HMDHome_accessoriesWithUUIDs___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 uuid];
  v4 = [v2 containsObject:v3];

  return v4;
}

- (void)configureNaturalLightingWithDemoModeEnabled:(BOOL)enabled
{
  workQueue = [(HMDHome *)self workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke;
  v6[3] = &unk_279735D28;
  v6[4] = self;
  enabledCopy = enabled;
  dispatch_async(workQueue, v6);
}

void __55__HMDHome_configureNaturalLightingWithDemoModeEnabled___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) localCapabilitiesDataSource];
  if ([v2 isResidentCapable])
  {
  }

  else
  {
    v3 = *(a1 + 40);

    if ((v3 & 1) == 0)
    {
      return;
    }
  }

  v4 = [[HMDHomeNaturalLightingContextUpdater alloc] initWithHome:*(a1 + 32) demoModeEnabled:*(a1 + 40)];
  [*(a1 + 32) setNaturalLightingContextUpdater:v4];

  v5 = [*(a1 + 32) naturalLightingContextUpdater];
  [v5 configure];
}

- (void)configureMediaDestinationControllersForAccessories:(id)accessories
{
  accessoriesCopy = accessories;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = [accessoriesCopy na_map:&__block_literal_global_821];

  [v6 na_each:&__block_literal_global_824];
}

void *__62__HMDHome_configureMediaDestinationControllersForAccessories___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = v2;
  }

  else
  {
    v3 = 0;
  }

  v4 = v3;

  return v3;
}

- (void)configureMediaSystems
{
  mediaSystemController = [(HMDHome *)self mediaSystemController];
  workQueue = [(HMDHome *)self workQueue];
  msgDispatcher = [(HMDHome *)self msgDispatcher];
  notificationCenter = [(HMDHome *)self notificationCenter];
  [mediaSystemController configure:self delegate:self dataSource:self queue:workQueue messageDispatcher:msgDispatcher notificationCenter:notificationCenter];
}

- (BOOL)hasSiriEndpointAccessory
{
  v17 = *MEMORY[0x277D85DE8];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = *v13;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v13 != v4)
        {
          objc_enumerationMutation(accessories);
        }

        v6 = *(*(&v12 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v7 = v6;
        }

        else
        {
          v7 = 0;
        }

        v8 = v7;

        if (v8)
        {
          siriEndpointProfile = [v8 siriEndpointProfile];

          if (siriEndpointProfile)
          {
            LOBYTE(v3) = 1;
            goto LABEL_15;
          }
        }
      }

      v3 = [accessories countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_15:

  v10 = *MEMORY[0x277D85DE8];
  return v3;
}

- (BOOL)supportsDeviceWithCapabilities:(id)capabilities
{
  capabilitiesCopy = capabilities;
  if (-[HMDHome hasSiriEndpointAccessory](self, "hasSiriEndpointAccessory") && ![capabilitiesCopy supportsSiriEndpointSetup])
  {
    supportsResidentFirstAccessoryCommunication = 0;
  }

  else
  {
    supportsResidentFirstAccessoryCommunication = [capabilitiesCopy supportsResidentFirstAccessoryCommunication];
  }

  return supportsResidentFirstAccessoryCommunication;
}

- (void)registerForDeviceWithCapabilities
{
  v12 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  selfCopy = self;
  v5 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = HMFGetLogIdentifier();
    v10 = 138543362;
    v11 = v6;
    _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for device with capabilities and confirming resident device", &v10, 0xCu);
  }

  objc_autoreleasePoolPop(v3);
  residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
  [residentDeviceManager addDataSource:selfCopy];

  residentDeviceManager2 = [(HMDHome *)selfCopy residentDeviceManager];
  [residentDeviceManager2 confirmWithCompletionHandler:0];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)migrateLegacyLocationServiceSettings
{
  v11 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isOwnerUser]&& ![(HMDHome *)self didOnboardLocationServices])
  {
    appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
    if ([appleMediaAccessories count])
    {
      v4 = objc_autoreleasePoolPush();
      selfCopy = self;
      v6 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = HMFGetLogIdentifier();
        v9 = 138543362;
        v10 = v7;
        _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Migrating legacy location service setting", &v9, 0xCu);
      }

      objc_autoreleasePoolPop(v4);
      if ([appleMediaAccessories na_allObjectsPassTest:&__block_literal_global_818])
      {
        [(HMDHome *)selfCopy runLocationServicesEnabledUpdateWithValue:1];
      }
    }
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (id)eventRouterServerDiagnosticInfo
{
  remoteEventRouterServer = [(HMDHome *)self remoteEventRouterServer];
  diagnosticInfo = [remoteEventRouterServer diagnosticInfo];

  return diagnosticInfo;
}

- (void)createRemoteEventRouterServerIfNeeded
{
  v65 = *MEMORY[0x277D85DE8];
  homeManager = [(HMDHome *)self homeManager];
  currentAccessory = [(HMDHome *)self currentAccessory];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = currentAccessory;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  remoteEventRouterServer = [(HMDHome *)self remoteEventRouterServer];
  residentModeUUID = [remoteEventRouterServer residentModeUUID];

  if (v6)
  {
    localCapabilitiesDataSource = [(HMDHome *)self localCapabilitiesDataSource];
    if ([localCapabilitiesDataSource isResidentCapable])
    {
      if (!residentModeUUID)
      {

LABEL_14:
        uuid = [v6 uuid];
        v19 = [residentModeUUID isEqual:uuid];

        if ((v19 & 1) == 0)
        {
          v20 = objc_autoreleasePoolPush();
          selfCopy = self;
          v22 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
          {
            v23 = HMFGetLogIdentifier();
            uuid2 = [v6 uuid];
            *buf = 138543874;
            v58 = v23;
            v59 = 2112;
            v60 = residentModeUUID;
            v61 = 2112;
            v62 = uuid2;
            _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_ERROR, "%{public}@Overwriting stale remote event router server with uuid: %@ to current accessory uuid: %@", buf, 0x20u);
          }

          objc_autoreleasePoolPop(v20);
        }

        v25 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v27 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          v28 = HMFGetLogIdentifier();
          *buf = 138543618;
          v58 = v28;
          v59 = 2112;
          v60 = v6;
          _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_INFO, "%{public}@Creating remote event router server with current accessory: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v25);
        localOnlySubscriptionProvider = [homeManager localOnlySubscriptionProvider];
        if (objc_opt_respondsToSelector())
        {
          serverDelegatingEventRouter = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];
          synchronousSubscriptionProvider = [localOnlySubscriptionProvider synchronousSubscriptionProvider];
          [serverDelegatingEventRouter registerSubRouter:synchronousSubscriptionProvider];

          serverDelegatingEventRouter2 = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];

          localOnlySubscriptionProvider = serverDelegatingEventRouter2;
        }

        v54 = localOnlySubscriptionProvider;
        v55 = residentModeUUID;
        remoteEventRouterClientController = [(HMDHome *)selfCopy2 remoteEventRouterClientController];
        residentDelegatingEventRouter = [remoteEventRouterClientController residentDelegatingEventRouter];

        if (residentDelegatingEventRouter)
        {
          serverDelegatingEventRouter3 = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];
          [serverDelegatingEventRouter3 registerSubRouter:residentDelegatingEventRouter];
        }

        v53 = residentDelegatingEventRouter;
        v51 = [HMDRemoteEventRouterServer alloc];
        uuid3 = [(HMDHome *)selfCopy2 uuid];
        uuid4 = [v6 uuid];
        [homeManager workQueue];
        v37 = v52 = v6;
        msgDispatcher = [(HMDHome *)selfCopy2 msgDispatcher];
        notificationCenter = [(HMDHome *)selfCopy2 notificationCenter];
        serverDelegatingEventRouter4 = [(HMDHome *)selfCopy2 serverDelegatingEventRouter];
        eventForwarder = [homeManager eventForwarder];
        eventStoreReadHandle = [homeManager eventStoreReadHandle];
        v43 = [(HMDRemoteEventRouterServer *)v51 initWithPrimaryModeUUID:uuid3 residentModeUUID:uuid4 queue:v37 messageDispatcher:msgDispatcher dataSource:selfCopy2 notificationCenter:notificationCenter requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" subscriptionProvider:serverDelegatingEventRouter4 registrationEventRouter:eventForwarder storeReadHandle:eventStoreReadHandle];
        [(HMDHome *)selfCopy2 setRemoteEventRouterServer:v43];

        v6 = v52;
        v44 = [HMDUserMessagePolicy userMessagePolicyWithHome:selfCopy2 userPrivilege:0 remoteAccessRequired:0];
        v45 = isTVOSDevice();
        remoteEventRouterServer2 = [(HMDHome *)selfCopy2 remoteEventRouterServer];
        isCurrentDevicePrimaryResident = [(HMDHome *)selfCopy2 isCurrentDevicePrimaryResident];
        v56 = v44;
        v48 = [MEMORY[0x277CBEA60] arrayWithObjects:&v56 count:1];
        [remoteEventRouterServer2 configureWithHome:selfCopy2 isPrimaryResident:isCurrentDevicePrimaryResident isResidentEventProviding:v45 additionalPolicies:v48];

        residentModeUUID = v55;
        goto LABEL_25;
      }

      uuid5 = [v6 uuid];
      v11 = [residentModeUUID isEqual:uuid5];

      if ((v11 & 1) == 0)
      {
        goto LABEL_14;
      }
    }

    else
    {
    }
  }

  v12 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v14 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
  {
    v15 = HMFGetLogIdentifier();
    localCapabilitiesDataSource2 = [(HMDHome *)selfCopy3 localCapabilitiesDataSource];
    [localCapabilitiesDataSource2 isResidentCapable];
    v17 = HMFBooleanToString();
    *buf = 138544130;
    v58 = v15;
    v59 = 2112;
    v60 = v6;
    v61 = 2112;
    v62 = v17;
    v63 = 2112;
    v64 = residentModeUUID;
    _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@Cannot create remote event router server with currentAccessory: %@ isResidentCapable: %@ serverAccessoryUUID: %@", buf, 0x2Au);
  }

  objc_autoreleasePoolPop(v12);
LABEL_25:

  v49 = *MEMORY[0x277D85DE8];
}

- (void)configureRemoteEventRouterClientControllerForAccessories:(id)accessories
{
  v23 = *MEMORY[0x277D85DE8];
  accessoriesCopy = accessories;
  if (_os_feature_enabled_impl())
  {
    v20 = 0u;
    v21 = 0u;
    v18 = 0u;
    v19 = 0u;
    v17 = accessoriesCopy;
    v5 = accessoriesCopy;
    v6 = [v5 countByEnumeratingWithState:&v18 objects:v22 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v19;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v19 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v18 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v11 = v10;
          }

          else
          {
            v11 = 0;
          }

          v12 = v11;

          if (v12)
          {
            isCurrentAccessory = [v10 isCurrentAccessory];
            remoteEventRouterClientController = [(HMDHome *)self remoteEventRouterClientController];
            uuid = [v10 uuid];
            if (isCurrentAccessory)
            {
              [remoteEventRouterClientController updateCurrentAccessoryUUID:uuid];
            }

            else
            {
              [remoteEventRouterClientController createResidentRouterForAccessoryUUID:uuid];
            }
          }
        }

        v7 = [v5 countByEnumeratingWithState:&v18 objects:v22 count:16];
      }

      while (v7);
    }

    accessoriesCopy = v17;
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:(id)accessory accessories:(id)accessories uncommittedTransactions:(id)transactions
{
  v91 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  accessoriesCopy = accessories;
  transactionsCopy = transactions;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    *buf = 138543362;
    v85 = v14;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Configuring after accessories configuration tracker notifications", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v11);
  workQueue = [(HMDHome *)selfCopy workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)selfCopy configureBulletinNotification];
  [(HMDHome *)selfCopy _evaluateNetworkProtectionAndRouterManagement];
  if (accessoryCopy)
  {
    v16 = objc_autoreleasePoolPush();
    v17 = selfCopy;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      *buf = 138543618;
      v85 = v19;
      v86 = 2112;
      v87 = accessoryCopy;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Setting up media session for current accessory during configure - %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
    v20 = [(HMDHome *)v17 _addMediaSessionForCurrentAccessory:accessoryCopy];
    v21 = accessoryCopy;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v23 = v21;
    }

    else
    {
      v23 = 0;
    }

    v24 = v23;

    if (isKindOfClass)
    {
      [v21 configureSensors];
    }
  }

  localCapabilitiesDataSource = [(HMDHome *)selfCopy localCapabilitiesDataSource];
  isResidentCapable = [localCapabilitiesDataSource isResidentCapable];

  if (isResidentCapable)
  {
    mediaStateManager = [(HMDHome *)selfCopy mediaStateManager];
    notificationRegistry = [(HMDHome *)selfCopy notificationRegistry];
    notificationCenter = [(HMDHome *)selfCopy notificationCenter];
    [mediaStateManager configureWithNotificationRegistry:notificationRegistry notificationCenter:notificationCenter];
  }

  [(HMDHome *)selfCopy configureMediaSystems];
  [(HMDHome *)selfCopy configureMediaDestinationControllersForAccessories:accessoriesCopy];
  [(HMDHome *)selfCopy registerForDeviceWithCapabilities];
  [(HMDHome *)selfCopy configureAppleMediaAccessoriesStateManagerWithStateManagerWithFactory:selfCopy messengerFactory:selfCopy metricsDispatcherFactory:selfCopy];
  v30 = objc_autoreleasePoolPush();
  if ([transactionsCopy count])
  {
    backingStore = [(HMDHome *)selfCopy backingStore];
    root = [backingStore root];
    encodeForKey = [root encodeForKey];

    v82[0] = MEMORY[0x277D85DD0];
    v82[1] = 3221225472;
    v82[2] = __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke;
    v82[3] = &unk_279721FF0;
    v34 = encodeForKey;
    v83 = v34;
    v35 = [transactionsCopy na_filter:v82];
    if ([v35 count])
    {
      v66 = v34;
      v67 = v30;
      v69 = transactionsCopy;
      v70 = accessoriesCopy;
      v71 = accessoryCopy;
      v36 = objc_autoreleasePoolPush();
      v68 = selfCopy;
      v37 = selfCopy;
      v38 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
      {
        v39 = HMFGetLogIdentifier();
        *buf = 138543618;
        v85 = v39;
        v86 = 2112;
        v87 = v35;
        _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_DEFAULT, "%{public}@Obtained uncommitted transactions that need to be applied: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v36);
      array = [MEMORY[0x277CBEB18] array];
      v78 = 0u;
      v79 = 0u;
      v80 = 0u;
      v81 = 0u;
      v65 = v35;
      obj = v35;
      v74 = [obj countByEnumeratingWithState:&v78 objects:v90 count:16];
      if (v74)
      {
        v40 = *v79;
        p_cache = HMDDataSyncStateLogEvent.cache;
        do
        {
          for (i = 0; i != v74; ++i)
          {
            if (*v79 != v40)
            {
              objc_enumerationMutation(obj);
            }

            v43 = *(*(&v78 + 1) + 8 * i);
            data = [v43 data];
            encoding = [v43 encoding];
            rowID = [v43 rowID];
            v77 = 0;
            v47 = [p_cache + 433 objectFromData:data encoding:encoding rowID:rowID error:&v77];
            v48 = v77;

            [v47 setObjectChangeType:{objc_msgSend(v43, "type")}];
            if (v48)
            {
              v49 = objc_autoreleasePoolPush();
              v50 = v37;
              v51 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
              {
                HMFGetLogIdentifier();
                v52 = v40;
                v54 = v53 = v37;
                *buf = 138543874;
                v85 = v54;
                v86 = 2112;
                v87 = v43;
                v88 = 2112;
                v89 = v48;
                _os_log_impl(&dword_2531F8000, v51, OS_LOG_TYPE_ERROR, "%{public}@Error decoding log record %@: %@", buf, 0x20u);

                v37 = v53;
                v40 = v52;
                p_cache = (HMDDataSyncStateLogEvent + 16);
              }

              objc_autoreleasePoolPop(v49);
            }

            else
            {
              [array addObject:v47];
            }
          }

          v74 = [obj countByEnumeratingWithState:&v78 objects:v90 count:16];
        }

        while (v74);
      }

      v55 = objc_autoreleasePoolPush();
      v56 = v37;
      v57 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v57, OS_LOG_TYPE_DEFAULT))
      {
        v58 = HMFGetLogIdentifier();
        *buf = 138543618;
        v85 = v58;
        v86 = 2112;
        v87 = array;
        _os_log_impl(&dword_2531F8000, v57, OS_LOG_TYPE_DEFAULT, "%{public}@Rerunning uncommitted transaction models %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v55);
      backingStore2 = [(HMDHome *)v56 backingStore];
      v60 = +[HMDBackingStoreTransactionOptions defaultLocalOptions];
      v61 = [backingStore2 transaction:@"RerunUncommitted" options:v60];

      [v61 addObjects:array];
      v75[0] = MEMORY[0x277D85DD0];
      v75[1] = 3221225472;
      v75[2] = __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke_809;
      v75[3] = &unk_2797358C8;
      v75[4] = v56;
      v76 = array;
      v62 = array;
      [v61 runWithoutSave:v75];

      accessoriesCopy = v70;
      accessoryCopy = v71;
      selfCopy = v68;
      transactionsCopy = v69;
      v34 = v66;
      v30 = v67;
      v35 = v65;
    }
  }

  objc_autoreleasePoolPop(v30);
  [(HMDHome *)selfCopy migrateLegacyLocationServiceSettings];
  [(HMDHome *)selfCopy configureMediaGroupObjects];
  accessories = [(HMDHome *)selfCopy accessories];
  [(HMDHome *)selfCopy configureRemoteEventRouterClientControllerForAccessories:accessories];

  v64 = *MEMORY[0x277D85DE8];
}

uint64_t __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = [a2 root];
  v4 = [v3 encodeForKey];
  v5 = [v2 isEqualToString:v4];

  return v5;
}

void __126__HMDHome_configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory_accessories_uncommittedTransactions___block_invoke_809(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v7 = HMFGetLogIdentifier();
    v8 = *(a1 + 40);
    v10 = 138543874;
    v11 = v7;
    v12 = 2112;
    v13 = v8;
    v14 = 2112;
    v15 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Saved uncommitted transaction models %@ with error: %@", &v10, 0x20u);
  }

  objc_autoreleasePoolPop(v4);
  v9 = *MEMORY[0x277D85DE8];
}

- (BOOL)configureWithHomeManager:(id)manager accessoriesPresent:(id)present uncommittedTransactions:(id)transactions source:(unint64_t)source
{
  v553 = *MEMORY[0x277D85DE8];
  managerCopy = manager;
  presentCopy = present;
  transactionsCopy = transactions;
  HMFUptime();
  v10 = v9;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    uuid = [(HMDHome *)selfCopy uuid];
    [(HMDHome *)selfCopy locationServicesEnabled];
    v16 = HMFBooleanToString();
    *buf = 138545410;
    v511 = v14;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring home with location service enabled";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"start";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = uuid;
    v524 = 2114;
    v525 = @"status";
    v526 = 2112;
    v527 = v16;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v11);
  mEMORY[0x277D17DE8] = [MEMORY[0x277D17DE8] sharedInstance];
  v18 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid2 = [(HMDHome *)selfCopy uuid];
  [(HMDHome *)selfCopy locationServicesEnabled];
  v20 = HMFBooleanToString();
  v21 = HMDTaggedLoggingCreateDictionary();
  v22 = [v18 initWithTag:@"homeConfigureStart" data:{v21, @"state", @"start", @"homeUUID", uuid2, @"status", v20}];
  currentTagProcessorList = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8] submitTaggedEvent:v22 processorList:currentTagProcessorList];

  [(HMDHome *)selfCopy setHomeManager:managerCopy];
  messageDispatcher = [managerCopy messageDispatcher];
  [(HMDHome *)selfCopy setMsgDispatcher:messageDispatcher];

  accessoryBrowser = [managerCopy accessoryBrowser];
  [(HMDHome *)selfCopy setAccessoryBrowser:accessoryBrowser];

  metricsManager = [managerCopy metricsManager];
  logEventSubmitter = [metricsManager logEventSubmitter];
  logEventSubmitter = selfCopy->_logEventSubmitter;
  selfCopy->_logEventSubmitter = logEventSubmitter;

  if (!selfCopy->_metricsDispatcher)
  {
    dataSource = [(HMDHome *)selfCopy dataSource];
    uuid = selfCopy->_uuid;
    logEventSubmitter2 = [(HMDHome *)selfCopy logEventSubmitter];
    v32 = [dataSource makeHomeMetricsDispatcherWithIdentifier:uuid logEventSubmitter:logEventSubmitter2];
    metricsDispatcher = selfCopy->_metricsDispatcher;
    selfCopy->_metricsDispatcher = v32;
  }

  v34 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:8 options:7.0];
  homeLocationTimer = selfCopy->_homeLocationTimer;
  selfCopy->_homeLocationTimer = v34;

  [(HMFTimer *)selfCopy->_homeLocationTimer setDelegateQueue:selfCopy->_workQueue];
  [(HMFTimer *)selfCopy->_homeLocationTimer setDelegate:selfCopy];
  mEMORY[0x277D0F8D0] = [MEMORY[0x277D0F8D0] sharedPreferences];
  v37 = [mEMORY[0x277D0F8D0] preferenceForKey:@"accessoryReachabilityCoalescePeriod"];
  numberValue = [v37 numberValue];

  LODWORD(mEMORY[0x277D0F8D0]) = [numberValue unsignedIntValue];
  v38 = [objc_alloc(MEMORY[0x277D0F920]) initWithTimeInterval:0 options:mEMORY[0x277D0F8D0]];
  accessoryReachabilityUpdatesTimer = selfCopy->_accessoryReachabilityUpdatesTimer;
  selfCopy->_accessoryReachabilityUpdatesTimer = v38;

  [(HMFTimer *)selfCopy->_accessoryReachabilityUpdatesTimer setDelegate:selfCopy];
  [(HMFTimer *)selfCopy->_accessoryReachabilityUpdatesTimer setDelegateQueue:selfCopy->_workQueue];
  roomForEntireHome = [(HMDHome *)selfCopy roomForEntireHome];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  workQueue = [(HMDHome *)selfCopy workQueue];
  [roomForEntireHome configure:msgDispatcher queue:workQueue];

  [(HMDHome *)selfCopy setOwnerUser:[HMDHomeManager isThisDeviceAdminOfHome:selfCopy]];
  [(HMDHome *)selfCopy setupBackingStore];
  periodicReader = [(HMDHome *)selfCopy periodicReader];
  [periodicReader configure:selfCopy];

  presenceMonitor = [(HMDHome *)selfCopy presenceMonitor];
  msgDispatcher2 = [(HMDHome *)selfCopy msgDispatcher];
  [presenceMonitor configure:selfCopy messageDispatcher:msgDispatcher2];

  presenceFeeder = [(HMDHome *)selfCopy presenceFeeder];
  msgDispatcher3 = [(HMDHome *)selfCopy msgDispatcher];
  [presenceFeeder configure:selfCopy messageDispatcher:msgDispatcher3];

  v48 = objc_autoreleasePoolPush();
  v49 = selfCopy;
  v50 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v50, OS_LOG_TYPE_INFO))
  {
    v51 = HMFGetLogIdentifier();
    presenceFeeder2 = [(HMDHome *)v49 presenceFeeder];
    *buf = 138543618;
    v511 = v51;
    v512 = 2112;
    v513 = presenceFeeder2;
    _os_log_impl(&dword_2531F8000, v50, OS_LOG_TYPE_INFO, "%{public}@Configured presenceFeeder: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v48);
  homeLocationHandler = [(HMDHome *)v49 homeLocationHandler];
  workQueue2 = [(HMDHome *)v49 workQueue];
  msgDispatcher4 = [(HMDHome *)v49 msgDispatcher];
  [homeLocationHandler configure:v49 queue:workQueue2 messageDispatcher:msgDispatcher4];

  homeReprovisionHandler = [(HMDHome *)v49 homeReprovisionHandler];
  workQueue3 = [(HMDHome *)v49 workQueue];
  msgDispatcher5 = [(HMDHome *)v49 msgDispatcher];
  [homeReprovisionHandler configure:v49 queue:workQueue3 messageDispatcher:msgDispatcher5];

  sharedHomeUpdateHandler = [(HMDHome *)v49 sharedHomeUpdateHandler];
  [sharedHomeUpdateHandler registerForMessages];

  reachabilityChangedLogEventManager = [(HMDHome *)v49 reachabilityChangedLogEventManager];
  [reachabilityChangedLogEventManager configure];

  [(HMDHome *)v49 updateHomeLocation];
  residentDeviceManager = [(HMDHome *)v49 residentDeviceManager];
  v62 = +[HMDMessageDispatcher defaultDispatcher];
  [residentDeviceManager configureWithHome:v49 messageDispatcher:v62];

  residentDeviceManager2 = [(HMDHome *)v49 residentDeviceManager];
  [residentDeviceManager2 setDelegate:v49];

  primaryResidentChangeMonitor = [(HMDHome *)v49 primaryResidentChangeMonitor];
  [primaryResidentChangeMonitor configureWithHome:v49];

  [(HMDHome *)v49 setResidentFirstAccessoryCommunicationEnabled:[(HMDHome *)v49 shouldEnableResidentFirstAccessoryCommunication]];
  [(HMDHome *)v49 _purgeResidentUsers];
  if ([(HMDHome *)v49 isOwnerUser])
  {
    primaryResident = [(HMDHome *)v49 primaryResident];
    device = [primaryResident device];
    isCurrentDevice = [device isCurrentDevice];

    accessoryBrowser2 = [(HMDHome *)v49 accessoryBrowser];
    [accessoryBrowser2 setQOS:isCurrentDevice];
  }

  name = [(HMDHome *)v49 name];
  v70 = [(HMDHome *)v49 addName:name];

  roomForEntireHome2 = [(HMDHome *)v49 roomForEntireHome];
  name2 = [roomForEntireHome2 name];
  v73 = [(HMDHome *)v49 addName:name2];

  notificationRegistrations = [(HMDHome *)v49 notificationRegistrations];
  LOBYTE(name2) = [notificationRegistrations count] == 0;

  if ((name2 & 1) == 0)
  {
    v508 = 0u;
    v509 = 0u;
    v506 = 0u;
    v507 = 0u;
    mediaSessions = [(HMDHome *)v49 mediaSessions];
    v76 = [mediaSessions countByEnumeratingWithState:&v506 objects:v552 count:16];
    if (v76)
    {
      v77 = *v507;
      do
      {
        for (i = 0; i != v76; ++i)
        {
          if (*v507 != v77)
          {
            objc_enumerationMutation(mediaSessions);
          }

          [*(*(&v506 + 1) + 8 * i) registerForSessionUpdates:1];
        }

        v76 = [mediaSessions countByEnumeratingWithState:&v506 objects:v552 count:16];
      }

      while (v76);
    }
  }

  group = dispatch_group_create();
  [(HMDHome *)v49 setBulletinNotificationsSupported:1];
  accessories = [(HMDHome *)v49 accessories];
  v442 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(accessories, "count")}];
  HMFUptime();
  v81 = v80;
  v82 = objc_autoreleasePoolPush();
  v83 = v49;
  v84 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v84, OS_LOG_TYPE_DEBUG))
  {
    v85 = HMFGetLogIdentifier();
    uuid3 = [(HMDHome *)v83 uuid];
    *buf = 138544898;
    v511 = v85;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring accessories";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureAccessories";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = uuid3;
    _os_log_impl(&dword_2531F8000, v84, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v82);
  mEMORY[0x277D17DE8]2 = [MEMORY[0x277D17DE8] sharedInstance];
  v88 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid4 = [(HMDHome *)v83 uuid];
  v90 = HMDTaggedLoggingCreateDictionary();
  v91 = [v88 initWithTag:@"homeConfigureStart" data:{v90, @"state", @"homeConfigureAccessories", @"homeUUID", uuid4}];
  currentTagProcessorList2 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]2 submitTaggedEvent:v91 processorList:currentTagProcessorList2];

  v504 = 0u;
  v505 = 0u;
  v502 = 0u;
  v503 = 0u;
  obj = accessories;
  v93 = [obj countByEnumeratingWithState:&v502 objects:v551 count:16];
  if (v93)
  {
    v443 = 0;
    v452 = *v503;
    do
    {
      for (j = 0; j != v93; ++j)
      {
        if (*v503 != v452)
        {
          objc_enumerationMutation(obj);
        }

        v95 = *(*(&v502 + 1) + 8 * j);
        v96 = objc_autoreleasePoolPush();
        v97 = v95;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v98 = v97;
        }

        else
        {
          v98 = 0;
        }

        v99 = v98;

        [v99 setDataSource:v83];
        v100 = v97;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v101 = v100;
        }

        else
        {
          v101 = 0;
        }

        v102 = v101;

        if (v102)
        {
          if ([v102 isPrimary])
          {
            identifier = [v102 identifier];
            supportedTransports = [v102 supportedTransports];
            setupHash = [v102 setupHash];
            [(HMDHome *)v83 _registerPairedAccessory:identifier transports:supportedTransports setupHash:setupHash];
          }

          [v442 addObject:v102];
        }

        v106 = v100;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v107 = v106;
        }

        else
        {
          v107 = 0;
        }

        v108 = v107;

        if (v108)
        {
          if (v99)
          {
            capabilitiesAggregator = [(HMDHome *)v83 capabilitiesAggregator];
            uuid5 = [v99 uuid];
            [capabilitiesAggregator didAddAccessory:uuid5];
          }

          if ([v99 isCurrentAccessory])
          {
            v111 = v99;

            v443 = v111;
          }

          identifier2 = [v108 identifier];
          -[HMDHome _registerPairedAccessory:transports:setupHash:](v83, "_registerPairedAccessory:transports:setupHash:", identifier2, [v108 supportedTransports], 0);
        }

        msgDispatcher6 = [(HMDHome *)v83 msgDispatcher];
        [v106 configureWithHome:v83 msgDispatcher:msgDispatcher6 configurationTracker:group initialConfiguration:1];

        uuid6 = [v106 uuid];
        uUIDString = [uuid6 UUIDString];
        [presentCopy addObject:uUIDString];

        objc_autoreleasePoolPop(v96);
      }

      v93 = [obj countByEnumeratingWithState:&v502 objects:v551 count:16];
    }

    while (v93);
  }

  else
  {
    v443 = 0;
  }

  v116 = objc_autoreleasePoolPush();
  v117 = v83;
  v118 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v118, OS_LOG_TYPE_INFO))
  {
    v119 = HMFGetLogIdentifier();
    v120 = MEMORY[0x277CCACA8];
    HMFUptime();
    v122 = [v120 stringWithFormat:@"%.3f", v121 - v81];
    uuid7 = [(HMDHome *)v117 uuid];
    v124 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
    *buf = 138545922;
    v511 = v119;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured accessories";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredAccessories";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v122;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = uuid7;
    v528 = 2114;
    v529 = @"accessoriesCount";
    v530 = 2112;
    v531 = v124;
    _os_log_impl(&dword_2531F8000, v118, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x70u);
  }

  objc_autoreleasePoolPop(v116);
  mEMORY[0x277D17DE8]3 = [MEMORY[0x277D17DE8] sharedInstance];
  v126 = objc_alloc(MEMORY[0x277D17DF8]);
  v127 = MEMORY[0x277CCACA8];
  HMFUptime();
  v129 = [v127 stringWithFormat:@"%.3f", v128 - v81];
  uuid8 = [(HMDHome *)v117 uuid];
  v131 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:{objc_msgSend(obj, "count")}];
  v132 = HMDTaggedLoggingCreateDictionary();
  v133 = [v126 initWithTag:@"homeConfigureStart" data:{v132, @"state", @"homeConfiguredAccessories", @"duration", v129, @"homeUUID", uuid8, @"accessoriesCount", v131}];
  currentTagProcessorList3 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]3 submitTaggedEvent:v133 processorList:currentTagProcessorList3];

  HMFUptime();
  v136 = v135;
  v137 = objc_autoreleasePoolPush();
  v138 = v117;
  v139 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v139, OS_LOG_TYPE_DEBUG))
  {
    v140 = HMFGetLogIdentifier();
    uuid9 = [(HMDHome *)v138 uuid];
    *buf = 138544898;
    v511 = v140;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring rooms, zones, groups, etc";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureProperties";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = uuid9;
    _os_log_impl(&dword_2531F8000, v139, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v137);
  mEMORY[0x277D17DE8]4 = [MEMORY[0x277D17DE8] sharedInstance];
  v143 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid10 = [(HMDHome *)v138 uuid];
  v145 = HMDTaggedLoggingCreateDictionary();
  v146 = [v143 initWithTag:@"homeConfigureStart" data:{v145, @"state", @"homeConfigureProperties", @"homeUUID", uuid10}];
  currentTagProcessorList4 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]4 submitTaggedEvent:v146 processorList:currentTagProcessorList4];

  v500 = 0u;
  v501 = 0u;
  v498 = 0u;
  v499 = 0u;
  rooms = [(HMDHome *)v138 rooms];
  v149 = [rooms countByEnumeratingWithState:&v498 objects:v550 count:16];
  if (v149)
  {
    v150 = *v499;
    do
    {
      for (k = 0; k != v149; ++k)
      {
        if (*v499 != v150)
        {
          objc_enumerationMutation(rooms);
        }

        v152 = *(*(&v498 + 1) + 8 * k);
        msgDispatcher7 = [(HMDHome *)v138 msgDispatcher];
        workQueue4 = [(HMDHome *)v138 workQueue];
        [v152 configure:msgDispatcher7 queue:workQueue4];

        name3 = [v152 name];
        v156 = [(HMDHome *)v138 addName:name3];
      }

      v149 = [rooms countByEnumeratingWithState:&v498 objects:v550 count:16];
    }

    while (v149);
  }

  v496 = 0u;
  v497 = 0u;
  v494 = 0u;
  v495 = 0u;
  zones = [(HMDHome *)v138 zones];
  v158 = [zones countByEnumeratingWithState:&v494 objects:v549 count:16];
  if (v158)
  {
    v159 = *v495;
    do
    {
      for (m = 0; m != v158; ++m)
      {
        if (*v495 != v159)
        {
          objc_enumerationMutation(zones);
        }

        v161 = *(*(&v494 + 1) + 8 * m);
        msgDispatcher8 = [(HMDHome *)v138 msgDispatcher];
        workQueue5 = [(HMDHome *)v138 workQueue];
        [v161 configure:msgDispatcher8 queue:workQueue5];

        name4 = [v161 name];
        v165 = [(HMDHome *)v138 addName:name4];
      }

      v158 = [zones countByEnumeratingWithState:&v494 objects:v549 count:16];
    }

    while (v158);
  }

  v492 = 0u;
  v493 = 0u;
  v490 = 0u;
  v491 = 0u;
  serviceGroups = [(HMDHome *)v138 serviceGroups];
  v167 = [serviceGroups countByEnumeratingWithState:&v490 objects:v548 count:16];
  if (v167)
  {
    v168 = *v491;
    do
    {
      for (n = 0; n != v167; ++n)
      {
        if (*v491 != v168)
        {
          objc_enumerationMutation(serviceGroups);
        }

        v170 = *(*(&v490 + 1) + 8 * n);
        msgDispatcher9 = [(HMDHome *)v138 msgDispatcher];
        workQueue6 = [(HMDHome *)v138 workQueue];
        [v170 configure:msgDispatcher9 queue:workQueue6];

        name5 = [v170 name];
        v174 = [(HMDHome *)v138 addName:name5];
      }

      v167 = [serviceGroups countByEnumeratingWithState:&v490 objects:v548 count:16];
    }

    while (v167);
  }

  v488 = 0u;
  v489 = 0u;
  v486 = 0u;
  v487 = 0u;
  actionSets = [(HMDHome *)v138 actionSets];
  v176 = [actionSets countByEnumeratingWithState:&v486 objects:v547 count:16];
  if (v176)
  {
    v453 = 0;
    v177 = *v487;
    do
    {
      for (ii = 0; ii != v176; ++ii)
      {
        if (*v487 != v177)
        {
          objc_enumerationMutation(actionSets);
        }

        v179 = *(*(&v486 + 1) + 8 * ii);
        v180 = objc_autoreleasePoolPush();
        msgDispatcher10 = [(HMDHome *)v138 msgDispatcher];
        workQueue7 = [(HMDHome *)v138 workQueue];
        v183 = [v179 configure:v138 messageDispatcher:msgDispatcher10 queue:workQueue7];

        name6 = [v179 name];
        v185 = [(HMDHome *)v138 addName:name6];

        objc_autoreleasePoolPop(v180);
        v453 |= v183;
      }

      v176 = [actionSets countByEnumeratingWithState:&v486 objects:v547 count:16];
    }

    while (v176);
  }

  else
  {
    v453 = 0;
  }

  v484 = 0u;
  v485 = 0u;
  v482 = 0u;
  v483 = 0u;
  triggerOwnedActionSets = [(HMDHome *)v138 triggerOwnedActionSets];
  v187 = [triggerOwnedActionSets countByEnumeratingWithState:&v482 objects:v546 count:16];
  if (v187)
  {
    v188 = *v483;
    do
    {
      for (jj = 0; jj != v187; ++jj)
      {
        if (*v483 != v188)
        {
          objc_enumerationMutation(triggerOwnedActionSets);
        }

        v190 = *(*(&v482 + 1) + 8 * jj);
        v191 = objc_autoreleasePoolPush();
        msgDispatcher11 = [(HMDHome *)v138 msgDispatcher];
        workQueue8 = [(HMDHome *)v138 workQueue];
        LOBYTE(v190) = [v190 configure:v138 messageDispatcher:msgDispatcher11 queue:workQueue8];

        objc_autoreleasePoolPop(v191);
        v453 |= v190;
      }

      v187 = [triggerOwnedActionSets countByEnumeratingWithState:&v482 objects:v546 count:16];
    }

    while (v187);
  }

  if (source <= 1)
  {
    actionSets2 = [(HMDHome *)v138 actionSets];
    v195 = [(HMDHome *)v138 filterBuiltinActionSets:actionSets2];
    v196 = [v195 count] == 0;

    if (v196)
    {
      isOwnerUser = [(HMDHome *)v138 isOwnerUser];
      v198 = objc_autoreleasePoolPush();
      v199 = v138;
      v200 = HMFGetOSLogHandle();
      v201 = os_log_type_enabled(v200, OS_LOG_TYPE_INFO);
      if (isOwnerUser)
      {
        if (v201)
        {
          v202 = HMFGetLogIdentifier();
          actionSets3 = [v199 actionSets];
          v204 = [actionSets3 count];
          *buf = 138543618;
          v511 = v202;
          v512 = 2048;
          v513 = v204;
          _os_log_impl(&dword_2531F8000, v200, OS_LOG_TYPE_INFO, "%{public}@%ld user-defined actionSets; no builtin actionSets - creating....", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v198);
        _createBuiltinActionSets = [v199 _createBuiltinActionSets];
        os_unfair_recursive_lock_lock_with_options();
        [v199[11] addObjectsFromArray:_createBuiltinActionSets];
        os_unfair_recursive_lock_unlock();

        v453 = 1;
      }

      else
      {
        if (v201)
        {
          v206 = HMFGetLogIdentifier();
          v207 = v199[151];
          *buf = 138543618;
          v511 = v206;
          v512 = 2112;
          v513 = v207;
          _os_log_impl(&dword_2531F8000, v200, OS_LOG_TYPE_INFO, "%{public}@Shared home - not creating builtin actionSets %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v198);
      }
    }
  }

  v480 = 0u;
  v481 = 0u;
  v478 = 0u;
  v479 = 0u;
  triggers = [(HMDHome *)v138 triggers];
  v209 = [triggers countByEnumeratingWithState:&v478 objects:v545 count:16];
  if (v209)
  {
    v210 = *v479;
    do
    {
      for (kk = 0; kk != v209; ++kk)
      {
        if (*v479 != v210)
        {
          objc_enumerationMutation(triggers);
        }

        v212 = *(*(&v478 + 1) + 8 * kk);
        msgDispatcher12 = [(HMDHome *)v138 msgDispatcher];
        workQueue9 = [(HMDHome *)v138 workQueue];
        [v212 configure:v138 messageDispatcher:msgDispatcher12 queue:workQueue9];

        owner = [v212 owner];
        LODWORD(msgDispatcher12) = owner == 0;

        if (msgDispatcher12)
        {
          currentUser = [(HMDHome *)v138 currentUser];
          [v212 setOwner:currentUser];
        }

        owner2 = [v212 owner];
        if ([owner2 isCurrentUser])
        {
          owningDevice = [v212 owningDevice];
          v219 = owningDevice == 0;

          if (v219)
          {
            currentDevice = [(HMDHome *)v138 currentDevice];
            [v212 setOwningDevice:currentDevice];

            owningDevice2 = [v212 owningDevice];

            if (owningDevice2)
            {
              v222 = objc_autoreleasePoolPush();
              v223 = v138;
              v224 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v224, OS_LOG_TYPE_INFO))
              {
                v225 = HMFGetLogIdentifier();
                name7 = [v212 name];
                *buf = 138543618;
                v511 = v225;
                v512 = 2112;
                v513 = name7;
                _os_log_impl(&dword_2531F8000, v224, OS_LOG_TYPE_INFO, "%{public}@Configuration changed: Trigger %@ owner updated to current device", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v222);
              v453 = 1;
            }
          }
        }

        else
        {
        }
      }

      v209 = [triggers countByEnumeratingWithState:&v478 objects:v545 count:16];
    }

    while (v209);
  }

  v227 = objc_autoreleasePoolPush();
  v228 = v138;
  v229 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v229, OS_LOG_TYPE_INFO))
  {
    v230 = HMFGetLogIdentifier();
    v231 = MEMORY[0x277CCACA8];
    HMFUptime();
    v136 = [v231 stringWithFormat:@"%.3f", v232 - v136];
    uuid11 = [(HMDHome *)v228 uuid];
    *buf = 138545410;
    v511 = v230;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured rooms, zones, triggers, etc.";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredProperties";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v136;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = uuid11;
    _os_log_impl(&dword_2531F8000, v229, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v227);
  mEMORY[0x277D17DE8]5 = [MEMORY[0x277D17DE8] sharedInstance];
  v236 = objc_alloc(MEMORY[0x277D17DF8]);
  v237 = MEMORY[0x277CCACA8];
  HMFUptime();
  v1362 = [v237 stringWithFormat:@"%.3f", v238 - v136];
  uuid12 = [(HMDHome *)v228 uuid];
  v241 = HMDTaggedLoggingCreateDictionary();
  v242 = [v236 initWithTag:@"homeConfigureStart" data:{v241, @"state", @"homeConfiguredProperties", @"duration", v1362, @"homeUUID", uuid12}];
  currentTagProcessorList5 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]5 submitTaggedEvent:v242 processorList:currentTagProcessorList5];

  HMFUptime();
  v245 = v244;
  v246 = objc_autoreleasePoolPush();
  v247 = v228;
  v248 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v248, OS_LOG_TYPE_DEBUG))
  {
    v249 = HMFGetLogIdentifier();
    uuid13 = [(HMDHome *)v247 uuid];
    *buf = 138544898;
    v511 = v249;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring users";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureUsers";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = uuid13;
    _os_log_impl(&dword_2531F8000, v248, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v246);
  mEMORY[0x277D17DE8]6 = [MEMORY[0x277D17DE8] sharedInstance];
  v252 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid14 = [(HMDHome *)v247 uuid];
  v254 = HMDTaggedLoggingCreateDictionary();
  v255 = [v252 initWithTag:@"homeConfigureStart" data:{v254, @"state", @"homeConfigureUsers", @"homeUUID", uuid14}];
  currentTagProcessorList6 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]6 submitTaggedEvent:v255 processorList:currentTagProcessorList6];

  v476 = 0u;
  v477 = 0u;
  v474 = 0u;
  v475 = 0u;
  removedUsers = [(HMDHome *)v247 removedUsers];
  v258 = [removedUsers countByEnumeratingWithState:&v474 objects:v544 count:16];
  if (v258)
  {
    v259 = *v475;
    do
    {
      for (mm = 0; mm != v258; ++mm)
      {
        if (*v475 != v259)
        {
          objc_enumerationMutation(removedUsers);
        }

        user = [*(*(&v474 + 1) + 8 * mm) user];
        [(HMDHome *)v247 _addUserToIdentityRegistry:user];
      }

      v258 = [removedUsers countByEnumeratingWithState:&v474 objects:v544 count:16];
    }

    while (v258);
  }

  v472 = 0u;
  v473 = 0u;
  v470 = 0u;
  v471 = 0u;
  users = [(HMDHome *)v247 users];
  v262 = [users countByEnumeratingWithState:&v470 objects:v543 count:16];
  if (v262)
  {
    v446 = *v471;
    do
    {
      for (nn = 0; nn != v262; ++nn)
      {
        if (*v471 != v446)
        {
          objc_enumerationMutation(users);
        }

        v264 = *(*(&v470 + 1) + 8 * nn);
        userID = [(__CFString *)v264 userID];
        isRemoteGateway = [(__CFString *)v264 isRemoteGateway];
        if (userID)
        {
          v267 = isRemoteGateway;
        }

        else
        {
          v267 = 1;
        }

        if ((v267 & 1) == 0)
        {
          v268 = [HMDDeviceHandle deviceHandleForDestination:userID];
          if (v268)
          {
            v269 = objc_autoreleasePoolPush();
            v270 = v247;
            v271 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v271, OS_LOG_TYPE_DEFAULT))
            {
              v272 = HMFGetLogIdentifier();
              *buf = 138543618;
              v511 = v272;
              v512 = 2112;
              v513 = v264;
              _os_log_impl(&dword_2531F8000, v271, OS_LOG_TYPE_DEFAULT, "%{public}@Migrating invalid resident user: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v269);
            [(HMDHome *)v270 _removeUser:v264];
            v273 = +[HMDAccountRegistry sharedRegistry];
            v274 = [v273 deviceForHandle:v268];

            v275 = [HMDResidentUser alloc];
            pairingIdentity = [(__CFString *)v264 pairingIdentity];
            v277 = [(HMDResidentUser *)v275 initWithDevice:v274 home:v270 pairingIdentity:pairingIdentity configurationState:0];

            uuid15 = [(__CFString *)v264 uuid];
            [(HMDUser *)v277 setUUID:uuid15];

            [(HMDHome *)v270 addUser:v277];
          }
        }

        [(HMDHome *)v247 _addUserToIdentityRegistry:v264];
        [(__CFString *)v264 configureWithHome:v247];
        if ([(__CFString *)v264 isOwner]&& ![(HMDHome *)v247 isOwnerUser])
        {
          v279 = dispatch_time(0, 300000000000);
          workQueue10 = [(HMDHome *)v247 workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke;
          block[3] = &unk_2797359B0;
          block[4] = v264;
          block[5] = v247;
          dispatch_after(v279, workQueue10, block);
        }
      }

      v262 = [users countByEnumeratingWithState:&v470 objects:v543 count:16];
    }

    while (v262);
  }

  v281 = objc_autoreleasePoolPush();
  v282 = v247;
  v283 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v283, OS_LOG_TYPE_INFO))
  {
    v284 = HMFGetLogIdentifier();
    v285 = MEMORY[0x277CCACA8];
    HMFUptime();
    v245 = [v285 stringWithFormat:@"%.3f", v286 - v245];
    v288 = MEMORY[0x277CCABB0];
    users2 = [(HMDHome *)v282 users];
    v290 = [v288 numberWithUnsignedInteger:{objc_msgSend(users2, "count")}];
    *buf = 138545410;
    v511 = v284;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured users";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredUsers";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v245;
    v524 = 2114;
    v525 = @"usersCount";
    v526 = 2112;
    v527 = v290;
    _os_log_impl(&dword_2531F8000, v283, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v281);
  mEMORY[0x277D17DE8]7 = [MEMORY[0x277D17DE8] sharedInstance];
  v292 = objc_alloc(MEMORY[0x277D17DF8]);
  v293 = MEMORY[0x277CCACA8];
  HMFUptime();
  v2452 = [v293 stringWithFormat:@"%.3f", v294 - v245];
  v296 = MEMORY[0x277CCABB0];
  users3 = [(HMDHome *)v282 users];
  v298 = [v296 numberWithUnsignedInteger:{objc_msgSend(users3, "count")}];
  v299 = HMDTaggedLoggingCreateDictionary();
  v300 = [v292 initWithTag:@"homeConfigureStart" data:{v299, @"state", @"homeConfiguredUsers", @"duration", v2452, @"usersCount", v298}];
  currentTagProcessorList7 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]7 submitTaggedEvent:v300 processorList:currentTagProcessorList7];

  networkProtectionGroupRegistry = [(HMDHome *)v282 networkProtectionGroupRegistry];
  [networkProtectionGroupRegistry configure];

  localCapabilitiesDataSource = [(HMDHome *)v282 localCapabilitiesDataSource];
  LODWORD(v2452) = [localCapabilitiesDataSource isResidentCapable];

  if (v2452)
  {
    uuid16 = [(HMDHome *)v282 uuid];
    uUIDString2 = [uuid16 UUIDString];
    v306 = [@"Home.EventRouter.Server.Delegating." stringByAppendingString:uUIDString2];

    v307 = objc_alloc(MEMORY[0x277D17498]);
    workQueue11 = [managerCopy workQueue];
    v309 = v306;
    uTF8String = [v306 UTF8String];
    uuid17 = [(HMDHome *)v282 uuid];
    v312 = [v307 initWithQueue:workQueue11 dataSource:v282 storeReadHandle:0 logCategory:uTF8String identifier:uuid17];
    serverDelegatingEventRouter = v282->_serverDelegatingEventRouter;
    v282->_serverDelegatingEventRouter = v312;

    [(HMDHome *)v282 createRemoteEventRouterServerIfNeeded];
  }

  v437 = [HMDUserMessagePolicy userMessagePolicyWithHome:v282 userPrivilege:3 remoteAccessRequired:0];
  eventRouterAssertionController = [managerCopy eventRouterAssertionController];
  v314 = [HMDHomeRemoteEventRouterClientController alloc];
  messageTargetUUID = [(HMDHome *)v282 messageTargetUUID];
  workQueue12 = [managerCopy workQueue];
  uuid18 = [v443 uuid];
  v318 = [(HMDHomeRemoteEventRouterClientController *)v314 initWithMessageTargetUUID:messageTargetUUID workQueue:workQueue12 dataSource:v282 requestMessageName:@"RemoteEventRouterRequestMessage" updateMessageName:@"RemoteEventRouterUpdateMessageName" multiHopFetchResponseMessageName:@"RER.MHF.ResponseMessageName" clientUserMessagePolicy:v437 currentAccessoryUUID:uuid18 assertionController:eventRouterAssertionController];
  [(HMDHome *)v282 setRemoteEventRouterClientController:v318];

  remoteEventRouterClientController = [(HMDHome *)v282 remoteEventRouterClientController];
  [remoteEventRouterClientController setHomeManager:managerCopy];

  localAndRemoteSubscriptionProvider = [managerCopy localAndRemoteSubscriptionProvider];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v321 = localAndRemoteSubscriptionProvider;
  }

  else
  {
    v321 = 0;
  }

  v433 = v321;

  remoteEventRouterClientController2 = [(HMDHome *)v282 remoteEventRouterClientController];
  residentDelegatingEventRouter = [remoteEventRouterClientController2 residentDelegatingEventRouter];

  if (residentDelegatingEventRouter)
  {
    [v433 registerSubRouter:residentDelegatingEventRouter];
  }

  swiftExtensions = [(HMDHome *)v282 swiftExtensions];
  [swiftExtensions configureWithHome:v282];

  objc_initWeak(&location, v282);
  workQueue13 = [(HMDHome *)v282 workQueue];
  v463[0] = MEMORY[0x277D85DD0];
  v463[1] = 3221225472;
  v463[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_788;
  v463[3] = &unk_279733910;
  objc_copyWeak(&v467, &location);
  v430 = v443;
  v464 = v430;
  obja = obj;
  v465 = obja;
  v432 = transactionsCopy;
  v466 = v432;
  dispatch_group_notify(group, workQueue13, v463);

  v461 = 0u;
  v462 = 0u;
  v459 = 0u;
  v460 = 0u;
  outgoingInvitations = [(HMDHome *)v282 outgoingInvitations];
  v326 = [outgoingInvitations countByEnumeratingWithState:&v459 objects:v542 count:16];
  if (v326)
  {
    v444 = outgoingInvitations;
    v447 = *v460;
    do
    {
      for (i1 = 0; i1 != v326; ++i1)
      {
        if (*v460 != v447)
        {
          objc_enumerationMutation(v444);
        }

        v328 = *(*(&v459 + 1) + 8 * i1);
        v455 = 0u;
        v456 = 0u;
        v457 = 0u;
        v458 = 0u;
        operations = [v328 operations];
        v330 = [operations countByEnumeratingWithState:&v455 objects:v541 count:16];
        if (v330)
        {
          v331 = *v456;
          do
          {
            for (i2 = 0; i2 != v330; ++i2)
            {
              if (*v456 != v331)
              {
                objc_enumerationMutation(operations);
              }

              v333 = *(*(&v455 + 1) + 8 * i2);
              if (([v333 isFinished] & 1) == 0)
              {
                [v333 setDelegate:v282];
                v334 = +[HMDUserManagementOperationManager sharedManager];
                [v334 addOperation:v333];
              }
            }

            v330 = [operations countByEnumeratingWithState:&v455 objects:v541 count:16];
          }

          while (v330);
        }
      }

      outgoingInvitations = v444;
      v326 = [v444 countByEnumeratingWithState:&v459 objects:v542 count:16];
    }

    while (v326);
  }

  HMFUptime();
  v336 = v335;
  v337 = objc_autoreleasePoolPush();
  v338 = v282;
  v339 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v339, OS_LOG_TYPE_DEBUG))
  {
    v340 = HMFGetLogIdentifier();
    uuid19 = [(HMDHome *)v338 uuid];
    *buf = 138544898;
    v511 = v340;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configuring profiles and settings";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfigureProfiles";
    v520 = 2114;
    v521 = @"homeUUID";
    v522 = 2112;
    v523 = uuid19;
    _os_log_impl(&dword_2531F8000, v339, OS_LOG_TYPE_DEBUG, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@", buf, 0x48u);
  }

  objc_autoreleasePoolPop(v337);
  mEMORY[0x277D17DE8]8 = [MEMORY[0x277D17DE8] sharedInstance];
  v343 = objc_alloc(MEMORY[0x277D17DF8]);
  uuid20 = [(HMDHome *)v338 uuid];
  v345 = HMDTaggedLoggingCreateDictionary();
  v346 = [v343 initWithTag:@"homeConfigureStart" data:{v345, @"state", @"homeConfigureProfiles", @"homeUUID", uuid20}];
  currentTagProcessorList8 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]8 submitTaggedEvent:v346 processorList:currentTagProcessorList8];

  v348 = objc_autoreleasePoolPush();
  [(HMDHome *)v338 _registerForMessages];
  objc_autoreleasePoolPop(v348);
  [(HMDHome *)v338 _registerForNotifications];
  [(HMDHome *)v338 resubscribeForNotificationsOnResident:0];
  [(HMDHome *)v338 configureMultiuserSettingsMessengerWithMessengerFactory:v338];
  [(HMDHome *)v338 _evaluateShouldRelaunchAndSetRelaunch];
  [(HMDHome *)v338 reEvaluateHomeHubState];
  v349 = objc_autoreleasePoolPush();
  v350 = v338;
  v351 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v351, OS_LOG_TYPE_INFO))
  {
    v352 = HMFGetLogIdentifier();
    triggers2 = [v350 triggers];
    *buf = 138543618;
    v511 = v352;
    v512 = 2112;
    v513 = triggers2;
    _os_log_impl(&dword_2531F8000, v351, OS_LOG_TYPE_INFO, "%{public}@Triggers: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v349);
  [v350 migrateAfterResidentChange];
  [v350 _updateWoWState:v442];
  if ((v453 & 1) != 0 && [v350 isOwnerUser])
  {
    [v350 _updateConfigurationVersion];
  }

  v354 = [[HMDMediaActionRouter alloc] initWithDataSource:v350];
  [v350 setMediaActionRouter:v354];

  personDataManager = [v350 personDataManager];
  [personDataManager configure];

  v356 = [[HMDUserActionPredictionManager alloc] initWithHome:v350];
  [v350 setUserActionPredictionManager:v356];

  userActionPredictionManager = [v350 userActionPredictionManager];
  [userActionPredictionManager configure];

  reachabilityNotificationManager = [v350 reachabilityNotificationManager];
  messageDispatcher2 = [managerCopy messageDispatcher];
  secureRemoteTransport = [messageDispatcher2 secureRemoteTransport];
  deviceMonitor = [secureRemoteTransport deviceMonitor];
  [reachabilityNotificationManager configureWithHome:v350 deviceMonitor:deviceMonitor];

  [v350 configureNaturalLightingWithDemoModeEnabled:0];
  walletKeyManager = [v350 walletKeyManager];
  [walletKeyManager configureWithHome:v350];

  nfcReaderKeyManager = [v350 nfcReaderKeyManager];
  [nfcReaderKeyManager configureWithHome:v350];

  lockNotificationManager = [v350 lockNotificationManager];
  [lockNotificationManager configureWithHome:v350];

  analysisStatePublisher = [v350 analysisStatePublisher];
  [analysisStatePublisher configureWithHome:v350];

  [v350 configurePrimaryResidentMessageRouterWithFactory:v350 metricsDispatcherFactory:v350];
  v366 = [HMDAppleMediaAccessoryMessageRouter alloc];
  uuid21 = [v350 uuid];
  msgDispatcher13 = [v350 msgDispatcher];
  v369 = [(HMDAppleMediaAccessoryMessageRouter *)v366 initWithIdentifier:uuid21 messageDispatcher:msgDispatcher13];
  [v350 setAppleDeviceRouter:v369];

  appleDeviceRouter = [v350 appleDeviceRouter];
  [appleDeviceRouter setDataSource:v350];

  v371 = [HMDDelegatingMessageRouter alloc];
  msgDispatcher14 = [v350 msgDispatcher];
  appleDeviceRouter2 = [v350 appleDeviceRouter];
  v540[0] = appleDeviceRouter2;
  primaryResidentMessageRouter = [v350 primaryResidentMessageRouter];
  v540[1] = primaryResidentMessageRouter;
  v375 = [MEMORY[0x277CBEA60] arrayWithObjects:v540 count:2];
  v376 = [(HMDDelegatingMessageRouter *)v371 initWithMessageDispatcher:msgDispatcher14 routers:v375];
  [v350 setAccessoryMessageRouterViaPrimary:v376];

  accessoryMessageRouterViaPrimary = [v350 accessoryMessageRouterViaPrimary];
  [accessoryMessageRouterViaPrimary setDataSource:v350];

  [v350 configureUnifiedLanguageValueListSettingDataProviderWithFactory:v350];
  [v350 configureAccessorySettingsMessengerWithMessengerFactory:v350 messageHandlerFactory:v350];
  [v350 configureSiriEndpointProfilesMessengerWithMessengerFactory:v350 messageHandlerFactory:v350];
  accessoryConnectionCoordinator = [v350 accessoryConnectionCoordinator];
  localCapabilitiesDataSource2 = [v350 localCapabilitiesDataSource];
  [accessoryConnectionCoordinator configureWithIsResidentCapable:{objc_msgSend(localCapabilitiesDataSource2, "isResidentCapable")}];

  workQueue14 = [v350 workQueue];
  v454[0] = MEMORY[0x277D85DD0];
  v454[1] = 3221225472;
  v454[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_796;
  v454[3] = &unk_279735D00;
  v454[4] = v350;
  dispatch_async(workQueue14, v454);

  v381 = objc_autoreleasePoolPush();
  v382 = v350;
  v383 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v383, OS_LOG_TYPE_INFO))
  {
    v384 = HMFGetLogIdentifier();
    v385 = MEMORY[0x277CCACA8];
    HMFUptime();
    v336 = [v385 stringWithFormat:@"%.3f", v386 - v336];
    uuid22 = [v382 uuid];
    *buf = 138545410;
    v511 = v384;
    v512 = 2114;
    v513 = @"homeConfigureStart";
    v514 = 2112;
    v515 = @"Configured profiles and settings";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"homeConfiguredProfiles";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v336;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = uuid22;
    _os_log_impl(&dword_2531F8000, v383, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x5Cu);
  }

  objc_autoreleasePoolPop(v381);
  mEMORY[0x277D17DE8]9 = [MEMORY[0x277D17DE8] sharedInstance];
  v390 = objc_alloc(MEMORY[0x277D17DF8]);
  v391 = MEMORY[0x277CCACA8];
  HMFUptime();
  v3362 = [v391 stringWithFormat:@"%.3f", v392 - v336];
  uuid23 = [v382 uuid];
  v395 = HMDTaggedLoggingCreateDictionary();
  v396 = [v390 initWithTag:@"homeConfigureStart" data:{v395, @"state", @"homeConfiguredProfiles", @"duration", v3362, @"homeUUID", uuid23}];
  currentTagProcessorList9 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]9 submitTaggedEvent:v396 processorList:currentTagProcessorList9];

  v398 = objc_autoreleasePoolPush();
  v399 = v382;
  v400 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v400, OS_LOG_TYPE_INFO))
  {
    v448 = v398;
    v401 = HMFGetLogIdentifier();
    v402 = MEMORY[0x277CCACA8];
    HMFUptime();
    v404 = [v402 stringWithFormat:@"%.3f", v403 - v10];
    uuid24 = [v399 uuid];
    v406 = HMFBooleanToString();
    v407 = MEMORY[0x277CCABB0];
    accessories2 = [v399 accessories];
    v409 = [v407 numberWithUnsignedInteger:{objc_msgSend(accessories2, "count")}];
    v410 = MEMORY[0x277CCABB0];
    users4 = [v399 users];
    v412 = [v410 numberWithUnsignedInteger:{objc_msgSend(users4, "count")}];
    *buf = 138546946;
    v511 = v401;
    v512 = 2114;
    v513 = @"homeConfigureDone";
    v514 = 2112;
    v515 = @"Configured home";
    v516 = 2114;
    v517 = @"state";
    v518 = 2112;
    v519 = @"end";
    v520 = 2114;
    v521 = @"duration";
    v522 = 2112;
    v523 = v404;
    v524 = 2114;
    v525 = @"homeUUID";
    v526 = 2112;
    v527 = uuid24;
    v528 = 2114;
    v529 = @"configChanged";
    v530 = 2112;
    v531 = v406;
    v532 = 2114;
    v533 = @"accessoriesCount";
    v534 = 2112;
    v535 = v409;
    v536 = 2114;
    v537 = @"usersCount";
    v538 = 2112;
    v539 = v412;
    _os_log_impl(&dword_2531F8000, v400, OS_LOG_TYPE_INFO, "%{public}@tag=%{public}@ desc=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@ %{public}@=%@", buf, 0x98u);

    v398 = v448;
  }

  objc_autoreleasePoolPop(v398);
  mEMORY[0x277D17DE8]10 = [MEMORY[0x277D17DE8] sharedInstance];
  v413 = objc_alloc(MEMORY[0x277D17DF8]);
  v414 = MEMORY[0x277CCACA8];
  HMFUptime();
  v416 = [v414 stringWithFormat:@"%.3f", v415 - v10];
  uuid25 = [v399 uuid];
  v418 = HMFBooleanToString();
  v419 = MEMORY[0x277CCABB0];
  accessories3 = [v399 accessories];
  v421 = [v419 numberWithUnsignedInteger:{objc_msgSend(accessories3, "count")}];
  v422 = MEMORY[0x277CCABB0];
  users5 = [v399 users];
  v424 = [v422 numberWithUnsignedInteger:{objc_msgSend(users5, "count")}];
  v425 = HMDTaggedLoggingCreateDictionary();
  v426 = [v413 initWithTag:@"homeConfigureDone" data:{v425, @"state", @"end", @"duration", v416, @"homeUUID", uuid25, @"configChanged", v418, @"accessoriesCount", v421, @"usersCount", v424}];
  currentTagProcessorList10 = [MEMORY[0x277D0F770] currentTagProcessorList];
  [mEMORY[0x277D17DE8]10 submitTaggedEvent:v426 processorList:currentTagProcessorList10];

  objc_destroyWeak(&v467);
  objc_destroyWeak(&location);

  v428 = *MEMORY[0x277D85DE8];
  return v453 & 1;
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) account];
  v3 = [v2 senderCorrelationIdentifier];

  if (!v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 40);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 32);
      *buf = 138543618;
      v15 = v7;
      v16 = 2112;
      v17 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_DEFAULT, "%{public}@Owner for home %@ does not have a merge ID, resolving handle", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = +[HMDRemoteAccountManager sharedManager];
    v10 = [*(a1 + 32) accountHandle];
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_777;
    v12[3] = &unk_279721FC8;
    v13 = vextq_s8(*(a1 + 32), *(a1 + 32), 8uLL);
    [v9 _resolveAccountForHandle:v10 completionHandler:v12];
  }

  v11 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_788(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained configureAfterAccessoriesConfigurationTrackerNotificationsWithCurrentAccessory:*(a1 + 32) accessories:*(a1 + 40) uncommittedTransactions:*(a1 + 48)];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_796(uint64_t a1)
{
  v3 = [*(a1 + 32) accessCodeManager];
  v2 = [*(a1 + 32) msgDispatcher];
  [v3 configureWithMessageDispatcher:v2];
}

void __86__HMDHome_configureWithHomeManager_accessoriesPresent_uncommittedTransactions_source___block_invoke_777(uint64_t a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = *(a1 + 32);
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      v11 = [*(a1 + 40) accountHandle];
      v13 = 138543618;
      v14 = v10;
      v15 = 2112;
      v16 = v11;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Failed to resolve account handle for account with no merge ID %@", &v13, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)_setupActiveNetworkRouterAccessory:(id)accessory existingRouterAccessories:(id)accessories
{
  v63 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  accessoriesCopy = accessories;
  v51 = 0u;
  v52 = 0u;
  v53 = 0u;
  v54 = 0u;
  v8 = accessoryCopy;
  v9 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v52;
    while (2)
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v52 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = *(*(&v51 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v14 = v13;
        }

        else
        {
          v14 = 0;
        }

        v15 = v14;

        if ([v15 isPrimary])
        {
          networkRouterController = [v15 networkRouterController];

          if (networkRouterController)
          {
            v42 = v8;
            v43 = accessoriesCopy;
            v49 = 0u;
            v50 = 0u;
            v47 = 0u;
            v48 = 0u;
            v17 = accessoriesCopy;
            v18 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
            v19 = v15;
            v46 = v15;
            if (v18)
            {
              v20 = v18;
              v21 = *v48;
              v44 = v17;
              v45 = *v48;
              do
              {
                for (j = 0; j != v20; ++j)
                {
                  if (*v48 != v21)
                  {
                    objc_enumerationMutation(v17);
                  }

                  v23 = *(*(&v47 + 1) + 8 * j);
                  if (([v23 isEqual:{v19, v42, v43}] & 1) == 0)
                  {
                    v24 = objc_autoreleasePoolPush();
                    selfCopy = self;
                    v26 = HMFGetOSLogHandle();
                    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
                    {
                      HMFGetLogIdentifier();
                      v28 = v27 = self;
                      [v23 shortDescription];
                      v30 = v29 = v20;
                      shortDescription = [v19 shortDescription];
                      *buf = 138543874;
                      v56 = v28;
                      v57 = 2112;
                      v58 = v30;
                      v59 = 2112;
                      v60 = shortDescription;
                      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_INFO, "%{public}@Removing existing Wi-Fi router accessory '%@' while adding a new Wi-Fi router accessory '%@'", buf, 0x20u);

                      v19 = v46;
                      v20 = v29;

                      self = v27;
                      v17 = v44;
                      v21 = v45;
                    }

                    objc_autoreleasePoolPop(v24);
                    [HMDHome __removeAccessory:selfCopy isBeingReplaced:v23 isForceUpdate:1 message:0];
                  }
                }

                v20 = [v17 countByEnumeratingWithState:&v47 objects:v61 count:16];
              }

              while (v20);
            }

            uuid = [v19 uuid];
            activeNetworkRouterUUID = [(HMDHome *)self activeNetworkRouterUUID];
            v34 = [uuid isEqual:activeNetworkRouterUUID];

            if (v34)
            {
              [(HMDHome *)self _evaluateNetworkProtectionAndRouterManagement];
              v8 = v42;
              accessoriesCopy = v43;
              v35 = v46;
            }

            else
            {
              v36 = objc_autoreleasePoolPush();
              selfCopy2 = self;
              v38 = HMFGetOSLogHandle();
              v8 = v42;
              accessoriesCopy = v43;
              if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
              {
                v39 = HMFGetLogIdentifier();
                shortDescription2 = [v46 shortDescription];
                *buf = 138543618;
                v56 = v39;
                v57 = 2112;
                v58 = shortDescription2;
                _os_log_impl(&dword_2531F8000, v38, OS_LOG_TYPE_INFO, "%{public}@Adding transaction to set %@ as active network router accessory", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v36);
              v35 = v46;
              -[HMDHome _addTransactionForActiveNetworkRouterAccessory:isReplacement:](selfCopy2, "_addTransactionForActiveNetworkRouterAccessory:isReplacement:", v46, [v17 count] != 0);
            }

            goto LABEL_31;
          }
        }
      }

      v10 = [v8 countByEnumeratingWithState:&v51 objects:v62 count:16];
      if (v10)
      {
        continue;
      }

      break;
    }
  }

LABEL_31:

  v41 = *MEMORY[0x277D85DE8];
}

- (void)setupBackingStore
{
  uuid = [(HMDHome *)self uuid];
  if (uuid)
  {
    v4 = uuid;
    backingStore = [(HMDHome *)self backingStore];

    if (!backingStore)
    {
      v6 = [HMDBackingStore alloc];
      uuid2 = [(HMDHome *)self uuid];
      v8 = [(HMDBackingStore *)v6 initWithUUID:uuid2 home:self];
      [(HMDHome *)self setBackingStore:v8];

      backingStore2 = [(HMDHome *)self backingStore];
      [backingStore2 setDelegate:self];
    }
  }
}

- (void)setBackingStore:(id)store
{
  storeCopy = store;
  os_unfair_recursive_lock_lock_with_options();
  backingStore = self->_backingStore;
  self->_backingStore = storeCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDBackingStore)backingStore
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_backingStore;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setWatchSkipVersionCheck:(BOOL)check
{
  os_unfair_recursive_lock_lock_with_options();
  self->_watchSkipVersionCheck = check;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)watchSkipVersionCheck
{
  os_unfair_recursive_lock_lock_with_options();
  watchSkipVersionCheck = self->_watchSkipVersionCheck;
  os_unfair_recursive_lock_unlock();
  return watchSkipVersionCheck;
}

- (void)_addUserToIdentityRegistry:(id)registry
{
  registryCopy = registry;
  userID = [registryCopy userID];
  v4 = registryCopy;
  if (userID)
  {
    pairingIdentity = [registryCopy pairingIdentity];

    v4 = registryCopy;
    if (pairingIdentity)
    {
      v6 = registryCopy;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v7 = v6;
      }

      else
      {
        v7 = 0;
      }

      v8 = v7;

      if (v8)
      {
        device = [v8 device];
        if (device)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          pairingIdentity2 = [v6 pairingIdentity];
          [v10 registerIdentity:pairingIdentity2 device:device object:v6];
LABEL_11:
        }
      }

      else
      {
        device = [v6 account];
        if (device)
        {
          v10 = +[HMDIdentityRegistry sharedRegistry];
          pairingIdentity2 = [v6 pairingIdentity];
          [v10 registerIdentity:pairingIdentity2 account:device object:v6];
          goto LABEL_11;
        }
      }

      v4 = registryCopy;
    }
  }
}

- (void)_removeMediaSessionWithIdentifier:(id)identifier
{
  v4 = [(HMDHome *)self mediaSessionWithIdentifier:identifier];
  if (v4)
  {
    v5 = v4;
    [v4 registerForSessionUpdates:0];
    [(HMDHome *)self removeMediaSession:v5];
    v4 = v5;
  }
}

- (id)_createMediaSessionWithEndpoint:(id)endpoint
{
  v20 = *MEMORY[0x277D85DE8];
  endpointCopy = endpoint;
  sessionIdentifier = [endpointCopy sessionIdentifier];
  if (sessionIdentifier)
  {
    v6 = [(HMDHome *)self mediaSessionStateWithIdentifier:sessionIdentifier];
    if (!v6)
    {
      v6 = [[HMDMediaSessionState alloc] initWithSessionIdentifier:sessionIdentifier];
      [(HMDHome *)self addMediaSessionState:v6];
    }

    v7 = [HMDMediaSession alloc];
    array = [MEMORY[0x277CBEA60] array];
    v9 = [(HMDMediaSession *)v7 initWithEndpoint:endpointCopy mediaProfiles:array state:v6];

    [(HMDHome *)self __addMediaSession:v9];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v13;
      v18 = 2112;
      v19 = endpointCopy;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_INFO, "%{public}@Cannot create a mediaSession with nil sessionIdentifier for endpoint %@", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v9 = 0;
  }

  v14 = *MEMORY[0x277D85DE8];

  return v9;
}

- (id)_addMediaSessionForCurrentAccessory:(id)accessory
{
  v22 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = accessoryCopy;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  mediaProfile = [v6 mediaProfile];
  if (mediaProfile)
  {
    identifier = [accessoryCopy identifier];
    v9 = [HMDMediaSession sessionForCurrentAccessoryWithSessionIdentifier:identifier mediaProfile:mediaProfile];

    if (v9)
    {
      state = [v9 state];
      [(HMDHome *)self addMediaSessionState:state];

      [(HMDHome *)self __addMediaSession:v9];
      [accessoryCopy updateMediaSession:v9];
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = HMFGetLogIdentifier();
      name = [accessoryCopy name];
      v18 = 138543618;
      v19 = v14;
      v20 = 2112;
      v21 = name;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Current accessory '%@' not an Apple media accessory or no media profile", &v18, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    v9 = 0;
  }

  v16 = *MEMORY[0x277D85DE8];

  return v9;
}

- (void)__addMediaSession:(id)session
{
  sessionCopy = session;
  if (sessionCopy)
  {
    v7 = sessionCopy;
    notificationRegistrations = [(HMDHome *)self notificationRegistrations];
    v6 = [notificationRegistrations count];

    if (v6)
    {
      [v7 registerForSessionUpdates:1];
    }

    [(HMDHome *)self addMediaSession:v7];
    sessionCopy = v7;
  }
}

- (id)_createBuiltinActionSets
{
  v36 = *MEMORY[0x277D85DE8];
  array = [MEMORY[0x277CBEB18] array];
  +[HMDHome getBuiltinActionSets];
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v4 = v28 = 0u;
  v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
  if (v24)
  {
    v23 = *v26;
    *&v5 = 138543874;
    v20 = v5;
    selfCopy = self;
    v22 = v4;
    do
    {
      for (i = 0; i != v24; ++i)
      {
        if (*v26 != v23)
        {
          objc_enumerationMutation(v4);
        }

        v7 = *(*(&v25 + 1) + 8 * i);
        v8 = [v4 objectForKeyedSubscript:{v7, v20}];
        v9 = HMDLocalizedStringForKey(v8);

        v10 = [(HMDHome *)self addName:v9];
        if (v10)
        {
          v11 = objc_autoreleasePoolPush();
          selfCopy2 = self;
          v13 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
          {
            v14 = HMFGetLogIdentifier();
            [(HMDHome *)selfCopy2 name];
            v16 = v15 = array;
            *buf = v20;
            v30 = v14;
            v31 = 2112;
            v32 = v9;
            v33 = 2112;
            v34 = v16;
            _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEFAULT, "%{public}@Could not add builtin actionSet '%@' to home '%@' namespace", buf, 0x20u);

            array = v15;
            self = selfCopy;
          }

          objc_autoreleasePoolPop(v11);
          v4 = v22;
        }

        v17 = [(HMDHome *)self createActionSetWithName:v9 uuid:0 type:v7];
        [array addObject:v17];
      }

      v24 = [v4 countByEnumeratingWithState:&v25 objects:v35 count:16];
    }

    while (v24);
  }

  v18 = *MEMORY[0x277D85DE8];

  return array;
}

- (id)createActionSetWithName:(id)name uuid:(id)uuid type:(id)type
{
  typeCopy = type;
  uuidCopy = uuid;
  nameCopy = name;
  v11 = [HMDActionSet alloc];
  workQueue = [(HMDHome *)self workQueue];
  v13 = [(HMDActionSet *)v11 initWithName:nameCopy uuid:uuidCopy type:typeCopy home:self queue:workQueue];

  msgDispatcher = [(HMDHome *)self msgDispatcher];
  workQueue2 = [(HMDHome *)self workQueue];
  [(HMDActionSet *)v13 configure:self messageDispatcher:msgDispatcher queue:workQueue2];

  return v13;
}

- (id)filterBuiltinActionSets:(id)sets
{
  v22 = *MEMORY[0x277D85DE8];
  setsCopy = sets;
  v4 = +[HMDHome getBuiltinActionSets];
  allKeys = [v4 allKeys];

  array = [MEMORY[0x277CBEB18] array];
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = setsCopy;
  v8 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v18;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v18 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v17 + 1) + 8 * i);
        type = [v12 type];
        v14 = [allKeys containsObject:type];

        if (v14)
        {
          [array addObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v17 objects:v21 count:16];
    }

    while (v9);
  }

  v15 = *MEMORY[0x277D85DE8];

  return array;
}

- (void)computeBridgedAccessoriesForAllBridges
{
  v40 = *MEMORY[0x277D85DE8];
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  accessories = [(HMDHome *)self accessories];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = [accessories countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v35;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v35 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v34 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        bridge = [v11 bridge];
        v13 = bridge;
        if (bridge)
        {
          uuid = [bridge uuid];
          v15 = [dictionary hmf_mutableSetForKey:uuid];

          if (!v15)
          {
            v15 = [MEMORY[0x277CBEB58] set];
            uuid2 = [v13 uuid];
            [dictionary setObject:v15 forKey:uuid2];
          }

          uuid3 = [v9 uuid];
          [v15 addObject:uuid3];
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v6);
  }

  v32 = 0u;
  v33 = 0u;
  v30 = 0u;
  v31 = 0u;
  v18 = dictionary;
  v19 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v31;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v31 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v30 + 1) + 8 * j);
        v24 = [v18 hmf_mutableSetForKey:{v23, v30}];
        v25 = [accessories hmf_firstObjectWithUUID:v23];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v26 = v25;
        }

        else
        {
          v26 = 0;
        }

        v27 = v26;

        if (v27)
        {
          v28 = v24 == 0;
        }

        else
        {
          v28 = 1;
        }

        if (!v28)
        {
          [v27 setIdentifiersForBridgedAccessories:v24];
        }
      }

      v20 = [v18 countByEnumeratingWithState:&v30 objects:v38 count:16];
    }

    while (v20);
  }

  v29 = *MEMORY[0x277D85DE8];
}

- (void)__handleProcessStateChange:(id)change
{
  userInfo = [change userInfo];
  v5 = [userInfo objectForKeyedSubscript:@"processInfo"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (v7)
  {
    bundleIdentifier = [v7 bundleIdentifier];
    state = [v7 state];
    if (bundleIdentifier)
    {
      v10 = state > 4;
    }

    else
    {
      v10 = 1;
    }

    if (!v10 && ((1 << state) & 0x1A) != 0)
    {
      workQueue = [(HMDHome *)self workQueue];
      v14 = MEMORY[0x277D85DD0];
      v15 = 3221225472;
      v16 = __38__HMDHome___handleProcessStateChange___block_invoke;
      v17 = &unk_2797359B0;
      v18 = bundleIdentifier;
      selfCopy = self;
      dispatch_async(workQueue, &v14);
    }

    v13 = [(HMDHome *)self hapAccessories:v14];
    [v13 hmf_enumerateWithAutoreleasePoolUsingBlock:&__block_literal_global_735];
  }
}

uint64_t __38__HMDHome___handleProcessStateChange___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = +[HMDAccessorySetupManager accessorySetupHostBundleIdentifier];
  LODWORD(v2) = [v2 isEqualToString:v3];

  if (v2)
  {
    [*(a1 + 40) _cleanAddAccessoryOperations];
  }

  v5 = *(a1 + 32);
  v4 = *(a1 + 40);

  return [v4 _disableNotificationsForClient:v5];
}

- (void)_startHomeNotificationDeregistrationTimer
{
  v26 = *MEMORY[0x277D85DE8];
  disableNotificationTimer = [(HMDHome *)self disableNotificationTimer];

  if (disableNotificationTimer)
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      disableNotificationTimer2 = [(HMDHome *)selfCopy disableNotificationTimer];
      v22 = 138543618;
      v23 = v7;
      v24 = 2112;
      v25 = disableNotificationTimer2;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Kicking notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    disableNotificationTimer3 = [(HMDHome *)selfCopy disableNotificationTimer];
    [disableNotificationTimer3 kick];
  }

  else
  {
    v10 = objc_alloc(MEMORY[0x277D0F920]);
    v11 = [v10 initWithTimeInterval:1 options:*&disableNotificationsDeferPeriod];
    [(HMDHome *)self setDisableNotificationTimer:v11];

    workQueue = [(HMDHome *)self workQueue];
    disableNotificationTimer4 = [(HMDHome *)self disableNotificationTimer];
    [disableNotificationTimer4 setDelegateQueue:workQueue];

    disableNotificationTimer5 = [(HMDHome *)self disableNotificationTimer];
    [disableNotificationTimer5 setDelegate:self];

    disableNotificationTimer6 = [(HMDHome *)self disableNotificationTimer];
    [disableNotificationTimer6 resume];

    v16 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = HMFGetLogIdentifier();
      disableNotificationTimer7 = [(HMDHome *)selfCopy2 disableNotificationTimer];
      v22 = 138543618;
      v23 = v19;
      v24 = 2112;
      v25 = disableNotificationTimer7;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Started notification disable timer: %@", &v22, 0x16u);
    }

    objc_autoreleasePoolPop(v16);
  }

  v21 = *MEMORY[0x277D85DE8];
}

- (void)_disableDirectCharacteristicNotificationsForClient:(id)client
{
  v28 = *MEMORY[0x277D85DE8];
  clientCopy = client;
  v25[0] = 0;
  v25[1] = v25;
  v25[2] = 0x2020000000;
  v26 = 0;
  v5 = dispatch_group_create();
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  accessories = [(HMDHome *)self accessories];
  v7 = [accessories copy];

  v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
  if (v8)
  {
    v9 = *v22;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v22 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v21 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          dispatch_group_enter(v5);
          aBlock[0] = MEMORY[0x277D85DD0];
          aBlock[1] = 3221225472;
          aBlock[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke;
          aBlock[3] = &unk_279732558;
          v20 = v25;
          v19 = v5;
          v14 = _Block_copy(aBlock);
          [v13 disableNotificationsForBundleID:clientCopy completionHandler:v14];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
    }

    while (v8);
  }

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2;
  block[3] = &unk_279734898;
  block[4] = self;
  block[5] = v25;
  dispatch_group_notify(v5, workQueue, block);

  _Block_object_dispose(v25, 8);
  v16 = *MEMORY[0x277D85DE8];
}

void __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke(uint64_t a1, int a2)
{
  if (a2)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
  }

  dispatch_group_leave(*(a1 + 32));
}

uint64_t __62__HMDHome__disableDirectCharacteristicNotificationsForClient___block_invoke_2(uint64_t result)
{
  if (*(*(*(result + 40) + 8) + 24) == 1)
  {
    return [*(result + 32) saveToCurrentAccountWithReason:@"HMDApplicationTerminatedSaveReason"];
  }

  return result;
}

- (void)_disableNotificationsForClient:(id)client
{
  v19 = *MEMORY[0x277D85DE8];
  clientCopy = client;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = clientCopy;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Disabling notification for client %@", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  notificationRegistrations = [(HMDHome *)selfCopy notificationRegistrations];
  if ([notificationRegistrations containsObject:clientCopy])
  {
    notificationDeregistrations = [(HMDHome *)selfCopy notificationDeregistrations];
    v12 = [notificationDeregistrations containsObject:clientCopy];

    if ((v12 & 1) == 0)
    {
      [(HMDHome *)selfCopy addNotificationDeregistrationForClientIdentifier:clientCopy];
      [(HMDHome *)selfCopy _startHomeNotificationDeregistrationTimer];
    }
  }

  else
  {
  }

  v13 = [@"com.apple.HomeKit.client." stringByAppendingString:clientCopy];
  [(HMDHome *)selfCopy _disableDirectCharacteristicNotificationsForClient:v13];

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_cleanAddAccessoryOperations
{
  os_unfair_recursive_lock_lock_with_options();
  [(NSMapTable *)self->_addPendingAccessories removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessorySetupCodes removeAllObjects];
  [(NSMutableDictionary *)self->_addPendingAccessoryOnboardingSetupPayloadStrings removeAllObjects];

  os_unfair_recursive_lock_unlock();
}

- (void)handleAccessoryReachabilityChangeNotification:(id)notification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

uint64_t __57__HMDHome_handleAccessoryReachabilityChangeNotification___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) _hasPairedReachableBTLEAccessories];
  v3 = *(a1 + 32);

  return [v3 setAnyBTLEAccessoryReachable:v2];
}

- (void)handleClientProcessDisconnectedNotification:(id)notification
{
  object = [notification object];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = object;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  if (v6)
  {
    bundleIdentifier = [v6 bundleIdentifier];
    if (bundleIdentifier)
    {
      workQueue = [(HMDHome *)self workQueue];
      v9[0] = MEMORY[0x277D85DD0];
      v9[1] = 3221225472;
      v9[2] = __55__HMDHome_handleClientProcessDisconnectedNotification___block_invoke;
      v9[3] = &unk_2797359B0;
      v9[4] = self;
      v10 = bundleIdentifier;
      dispatch_async(workQueue, v9);
    }
  }
}

- (void)_registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier
{
  notificationsCopy = notifications;
  v49 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  clientIdentifierCopy = clientIdentifier;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  if ([(HMDHome *)self isFeatureMatteriPhoneOnlyPairingControlEnabled])
  {
    if (clientIdentifierCopy)
    {
      v11 = clientIdentifierCopy;
    }

    else
    {
      v11 = identifierCopy;
    }

    v12 = v11;
    if (([v12 isEqualToString:*MEMORY[0x277CCFE40]] & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD09C8]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD11A0]) & 1) != 0 || (objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD06C8]) & 1) != 0 || objc_msgSend(v12, "isEqualToString:", *MEMORY[0x277CD0638]))
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG);
      if (notificationsCopy)
      {
        if (v16)
        {
          v17 = HMFGetLogIdentifier();
          v43 = 138543874;
          v44 = v17;
          v45 = 2112;
          v46 = clientIdentifierCopy;
          v47 = 2112;
          v48 = identifierCopy;
          _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:YES - skip registering client %@, registrationIdentifier = %@", &v43, 0x20u);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_35;
      }

      if (v16)
      {
        v18 = HMFGetLogIdentifier();
        v43 = 138543874;
        v44 = v18;
        v45 = 2112;
        v46 = clientIdentifierCopy;
        v47 = 2112;
        v48 = identifierCopy;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEBUG, "%{public}@registerForMatterFabricNotifications:NO - allow deregistration for client %@, registrationIdentifier = %@", &v43, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
    }

    else if (notificationsCopy)
    {
      matterFabricEnabledClients = [(HMDHome *)self matterFabricEnabledClients];
      v42 = [matterFabricEnabledClients containsObject:identifierCopy];

      if (v42)
      {
LABEL_19:
        homeManager = [(HMDHome *)self homeManager];
        matterFabricEnabledClients2 = [(HMDHome *)self matterFabricEnabledClients];
        v22 = [matterFabricEnabledClients2 count];

        if (v22)
        {
          currentMatterClientRegistration = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v26 = HMFGetOSLogHandle();
          v27 = v26;
          if (currentMatterClientRegistration)
          {
            if (!os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
            {
LABEL_24:

              objc_autoreleasePoolPop(v24);
LABEL_34:

LABEL_35:
              goto LABEL_36;
            }

            v28 = HMFGetLogIdentifier();
            matterFabricEnabledClients3 = [(HMDHome *)selfCopy3 matterFabricEnabledClients];
            v43 = 138543618;
            v44 = v28;
            v45 = 2112;
            v46 = matterFabricEnabledClients3;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are registered and have the clients %@", &v43, 0x16u);

LABEL_23:
            goto LABEL_24;
          }

          if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
          {
            v38 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v38;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are not registered but have clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          chipDataSource = [homeManager chipDataSource];
          [chipDataSource updateNotificationsEnabled:1 forHome:selfCopy3 keepAliveOnly:1];

          v36 = selfCopy3;
          v37 = 1;
        }

        else
        {
          matterFabricEnabledClients4 = [(HMDHome *)self matterFabricEnabledClients];
          v31 = [matterFabricEnabledClients4 count];

          if (v31)
          {
            goto LABEL_34;
          }

          currentMatterClientRegistration2 = [(HMDHome *)self currentMatterClientRegistration];
          v24 = objc_autoreleasePoolPush();
          selfCopy3 = self;
          v33 = HMFGetOSLogHandle();
          v27 = v33;
          if (!currentMatterClientRegistration2)
          {
            if (!os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
            {
              goto LABEL_24;
            }

            v28 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v28;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEBUG, "%{public}@Not updating matter fabric registration as we are not registered and have no clients", &v43, 0xCu);
            goto LABEL_23;
          }

          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            v34 = HMFGetLogIdentifier();
            v43 = 138543362;
            v44 = v34;
            _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_DEFAULT, "%{public}@Updating matter fabric registration as we are registered but have no clients", &v43, 0xCu);
          }

          objc_autoreleasePoolPop(v24);
          chipDataSource2 = [homeManager chipDataSource];
          [chipDataSource2 updateNotificationsEnabled:0 forHome:selfCopy3 keepAliveOnly:1];

          v36 = selfCopy3;
          v37 = 0;
        }

        [(HMDHome *)v36 setCurrentMatterClientRegistration:v37];
        goto LABEL_34;
      }

      matterFabricEnabledClients5 = [(HMDHome *)self matterFabricEnabledClients];
      [matterFabricEnabledClients5 addObject:identifierCopy];
LABEL_18:

      goto LABEL_19;
    }

    matterFabricEnabledClients5 = [(HMDHome *)self matterFabricEnabledClients];
    [matterFabricEnabledClients5 removeObject:identifierCopy];
    goto LABEL_18;
  }

LABEL_36:

  v40 = *MEMORY[0x277D85DE8];
}

- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier
{
  clientIdentifierCopy = clientIdentifier;
  identifierCopy = identifier;
  workQueue = [(HMDHome *)self workQueue];
  v11[0] = MEMORY[0x277D85DD0];
  v11[1] = 3221225472;
  v11[2] = __88__HMDHome_registerForMatterFabricNotifications_registrationIdentifier_clientIdentifier___block_invoke;
  v11[3] = &unk_279731C38;
  notificationsCopy = notifications;
  v11[4] = self;
  v11[5] = identifierCopy;
  v11[6] = clientIdentifierCopy;
  dispatch_async(workQueue, v11);
}

- (void)registerForMatterFabricNotifications:(BOOL)notifications registrationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __71__HMDHome_registerForMatterFabricNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_279734938;
  notificationsCopy = notifications;
  block[4] = self;
  block[5] = identifierCopy;
  dispatch_async(workQueue, block);
}

- (void)_registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier clientIdentifier:(id)clientIdentifier
{
  notificationsCopy = notifications;
  v40 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  clientIdentifierCopy = clientIdentifier;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  accessoryRemoteReachabilityEnabledClients = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  accessoryRemoteReachabilityEnabledClients2 = accessoryRemoteReachabilityEnabledClients;
  if (notificationsCopy)
  {
    v13 = [accessoryRemoteReachabilityEnabledClients containsObject:identifierCopy];

    if (v13)
    {
      goto LABEL_6;
    }

    accessoryRemoteReachabilityEnabledClients2 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
    [accessoryRemoteReachabilityEnabledClients2 addObject:identifierCopy];
  }

  else
  {
    [accessoryRemoteReachabilityEnabledClients removeObject:identifierCopy];
  }

LABEL_6:
  accessoryRemoteReachabilityEnabledClients3 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v15 = [accessoryRemoteReachabilityEnabledClients3 count];

  if (v15)
  {
    currentRemoteReachabilityRegistration = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v17 = objc_autoreleasePoolPush();
    selfCopy = self;
    v19 = HMFGetOSLogHandle();
    v20 = v19;
    if (currentRemoteReachabilityRegistration)
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        v21 = HMFGetLogIdentifier();
        accessoryRemoteReachabilityEnabledClients4 = [(HMDHome *)selfCopy accessoryRemoteReachabilityEnabledClients];
        v36 = 138543618;
        v37 = v21;
        v38 = 2112;
        v39 = accessoryRemoteReachabilityEnabledClients4;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are registered and have the clients %@", &v36, 0x16u);
      }

      objc_autoreleasePoolPop(v17);
    }

    else
    {
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v23;
        _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are not registered but have clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      if (clientIdentifierCopy)
      {
        v24 = clientIdentifierCopy;
      }

      else
      {
        v24 = identifierCopy;
      }

      [(HMDHome *)selfCopy __registerForRemoteAccessoryReachabilityNotifications:1 clientIdentifier:v24];
    }
  }

  accessoryRemoteReachabilityEnabledClients5 = [(HMDHome *)self accessoryRemoteReachabilityEnabledClients];
  v26 = [accessoryRemoteReachabilityEnabledClients5 count];

  if (!v26)
  {
    currentRemoteReachabilityRegistration2 = [(HMDHome *)self currentRemoteReachabilityRegistration];
    v28 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v30 = HMFGetOSLogHandle();
    v31 = v30;
    if (currentRemoteReachabilityRegistration2)
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v32 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v32;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEFAULT, "%{public}@Updating remote accessory reachability registration as we are registered but have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
      if (clientIdentifierCopy)
      {
        v33 = clientIdentifierCopy;
      }

      else
      {
        v33 = identifierCopy;
      }

      [(HMDHome *)selfCopy2 __registerForRemoteAccessoryReachabilityNotifications:0 clientIdentifier:v33];
    }

    else
    {
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        v34 = HMFGetLogIdentifier();
        v36 = 138543362;
        v37 = v34;
        _os_log_impl(&dword_2531F8000, v31, OS_LOG_TYPE_DEBUG, "%{public}@Not updating remote accessory reachability registration as we are not registered and have no clients", &v36, 0xCu);
      }

      objc_autoreleasePoolPop(v28);
    }
  }

  v35 = *MEMORY[0x277D85DE8];
}

- (void)registerForAccessoryReachabilityNotifications:(BOOL)notifications registrationIdentifier:(id)identifier
{
  identifierCopy = identifier;
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __80__HMDHome_registerForAccessoryReachabilityNotifications_registrationIdentifier___block_invoke;
  block[3] = &unk_279734938;
  notificationsCopy = notifications;
  block[4] = self;
  block[5] = identifierCopy;
  dispatch_async(workQueue, block);
}

- (void)handleLastProcessDidBecomeInactiveNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = notificationCopy;
  selfCopy = self;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __58__HMDHome_handleLastProcessDidBecomeInactiveNotification___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 40) _registerForAccessoryReachabilityNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  [*(a1 + 40) _registerForMatterFabricNotifications:0 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v3];
  v4 = [*(a1 + 40) WiFiAssertion];

  if (v4)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = *(a1 + 40);
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = HMFGetLogIdentifier();
      v13 = 138543362;
      v14 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEFAULT, "%{public}@Releasing WiFi assertion", &v13, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
    v9 = [*(a1 + 40) wifiManager];
    v10 = [*(a1 + 40) WiFiAssertion];
    [v9 endActiveAssertion:v10];

    v11 = [*(a1 + 40) wifiManager];
    [v11 releaseWoWAssertion];

    [*(a1 + 40) setWiFiAssertion:0];
  }

  v12 = *MEMORY[0x277D85DE8];
}

- (void)handleFirstProcessDidBecomeActiveNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = notificationCopy;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __57__HMDHome_handleFirstProcessDidBecomeActiveNotification___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (isWatch())
  {
    if ([*(a1 + 32) remoteAccessIsEnabled])
    {
      v2 = [*(a1 + 32) WiFiAssertion];

      if (!v2)
      {
        v3 = objc_autoreleasePoolPush();
        v4 = *(a1 + 32);
        v5 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
        {
          v6 = HMFGetLogIdentifier();
          *buf = 138543362;
          v17 = v6;
          _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_DEFAULT, "%{public}@Taking WiFi assertion", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v3);
        v7 = [*(a1 + 32) wifiManager];
        v8 = MEMORY[0x277CCACA8];
        v9 = [*(a1 + 32) shortDescription];
        v10 = [v8 stringWithFormat:@"Remote Access for %@", v9];
        v11 = [v7 beginActiveAssertionWithOptions:0 reason:v10];
        [*(a1 + 32) setWiFiAssertion:v11];

        v12 = [*(a1 + 32) wifiManager];
        [v12 takeWoWAssertion];
      }
    }
  }

  v13 = [*(a1 + 40) userInfo];
  v14 = [v13 hmf_stringForKey:@"HMDXPCConnectionClientIdentifierKey"];

  [*(a1 + 32) _registerForAccessoryReachabilityNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];
  [*(a1 + 32) _registerForMatterFabricNotifications:1 registrationIdentifier:@"HMDAccessoryActiveClientRemoteRegistrationIdentifierKey" clientIdentifier:v14];

  v15 = *MEMORY[0x277D85DE8];
}

- (HMMDailyScheduler)dailyScheduler
{
  homeManager = [(HMDHome *)self homeManager];
  metricsManager = [homeManager metricsManager];
  dailyScheduler = [metricsManager dailyScheduler];

  return dailyScheduler;
}

- (void)setThreadOperationalDataset:(id)dataset
{
  datasetCopy = dataset;
  os_unfair_recursive_lock_lock_with_options();
  v4 = [datasetCopy copy];
  threadOperationalDataset = self->_threadOperationalDataset;
  self->_threadOperationalDataset = v4;

  os_unfair_recursive_lock_unlock();
}

- (NSData)threadOperationalDataset
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSData *)self->_threadOperationalDataset copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setPrimaryNetworkRouterManagingDeviceUUID:(id)d
{
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  primaryNetworkRouterManagingDeviceUUID = self->_primaryNetworkRouterManagingDeviceUUID;
  self->_primaryNetworkRouterManagingDeviceUUID = dCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)primaryNetworkRouterManagingDeviceUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_primaryNetworkRouterManagingDeviceUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setActiveNetworkRouterInitialSetupNeeded:(BOOL)needed
{
  os_unfair_recursive_lock_lock_with_options();
  self->_activeNetworkRouterInitialSetupNeeded = needed;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isActiveNetworkRouterInitialSetupNeeded
{
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterInitialSetupNeeded = self->_activeNetworkRouterInitialSetupNeeded;
  os_unfair_recursive_lock_unlock();
  return activeNetworkRouterInitialSetupNeeded;
}

- (void)setActiveNetworkRouterUUID:(id)d
{
  dCopy = d;
  os_unfair_recursive_lock_lock_with_options();
  activeNetworkRouterUUID = self->_activeNetworkRouterUUID;
  self->_activeNetworkRouterUUID = dCopy;

  os_unfair_recursive_lock_unlock();
}

- (NSUUID)activeNetworkRouterUUID
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_activeNetworkRouterUUID;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setRouterClientManager:(id)manager
{
  managerCopy = manager;
  os_unfair_recursive_lock_lock_with_options();
  routerClientManager = self->_routerClientManager;
  self->_routerClientManager = managerCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDNetworkRouterClientManager)routerClientManager
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_routerClientManager;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change
{
  changeCopy = change;
  os_unfair_recursive_lock_lock_with_options();
  minHomeKitVersionForAccessoryNetworkProtectionChange = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  self->_minHomeKitVersionForAccessoryNetworkProtectionChange = changeCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minHomeKitVersionForAccessoryNetworkProtectionChange
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minHomeKitVersionForAccessoryNetworkProtectionChange;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setMinimumNetworkRouterSupportHomeKitVersion:(id)version
{
  versionCopy = version;
  os_unfair_recursive_lock_lock_with_options();
  minimumNetworkRouterSupportHomeKitVersion = self->_minimumNetworkRouterSupportHomeKitVersion;
  self->_minimumNetworkRouterSupportHomeKitVersion = versionCopy;

  os_unfair_recursive_lock_unlock();
}

- (HMDHomeKitVersion)minimumNetworkRouterSupportHomeKitVersion
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_minimumNetworkRouterSupportHomeKitVersion;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)setNetworkRouterSupport:(unint64_t)support
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupport = support;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupport
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupport = self->_networkRouterSupport;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupport;
}

- (void)setNetworkRouterSupportDisableReason:(unint64_t)reason
{
  os_unfair_recursive_lock_lock_with_options();
  self->_networkRouterSupportDisableReason = reason;

  os_unfair_recursive_lock_unlock();
}

- (unint64_t)networkRouterSupportDisableReason
{
  os_unfair_recursive_lock_lock_with_options();
  networkRouterSupportDisableReason = self->_networkRouterSupportDisableReason;
  os_unfair_recursive_lock_unlock();
  return networkRouterSupportDisableReason;
}

- (void)setProtectionMode:(int64_t)mode
{
  os_unfair_recursive_lock_lock_with_options();
  self->_protectionMode = mode;

  os_unfair_recursive_lock_unlock();
}

- (int64_t)protectionMode
{
  os_unfair_recursive_lock_lock_with_options();
  protectionMode = self->_protectionMode;
  os_unfair_recursive_lock_unlock();
  return protectionMode;
}

- (id)retrieveAndResetNewlyConfiguredAccessoriesForAddSessionIdentifier:(id)identifier
{
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  v5 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:identifierCopy];
  v6 = [v5 copy];

  if (v6)
  {
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories removeObjectForKey:identifierCopy];
    v7 = v6;
  }

  else
  {
    v7 = MEMORY[0x277CBEBF8];
  }

  v8 = v7;

  os_unfair_recursive_lock_unlock();

  return v8;
}

- (NSMapTable)addPendingAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMapTable *)self->_addPendingAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSMutableDictionary)addPendingAccessorySetupCodeHandlers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableDictionary *)self->_addPendingAccessorySetupCodeHandlers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (NSHashTable)removeAccessoryInProgressForHMDAccessories
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSHashTable *)self->_removeAccessoryInProgressForHMDAccessories copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)removeFromCurrentTriggers:(id)triggers
{
  triggersCopy = triggers;
  os_unfair_recursive_lock_lock_with_options();
  if ([(NSMutableArray *)self->_currentTriggers containsObject:triggersCopy])
  {
    [(NSMutableArray *)self->_currentTriggers removeObject:triggersCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (void)addToCurrentTriggers:(id)triggers
{
  triggersCopy = triggers;
  os_unfair_recursive_lock_lock_with_options();
  if (([(NSMutableArray *)self->_currentTriggers containsObject:triggersCopy]& 1) == 0)
  {
    [(NSMutableArray *)self->_currentTriggers addObject:triggersCopy];
  }

  os_unfair_recursive_lock_unlock();
}

- (NSArray)triggers
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = [(NSMutableArray *)self->_currentTriggers copy];
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (void)addNewlyConfiguredAccessories:(id)accessories addSessionIdentifier:(id)identifier
{
  accessoriesCopy = accessories;
  identifierCopy = identifier;
  os_unfair_recursive_lock_lock_with_options();
  v7 = [(NSMutableDictionary *)self->_newlyConfiguredAccessories objectForKeyedSubscript:identifierCopy];
  if (!v7)
  {
    v7 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
    [(NSMutableDictionary *)self->_newlyConfiguredAccessories setObject:v7 forKeyedSubscript:identifierCopy];
  }

  [v7 addObjectsFromArray:accessoriesCopy];

  os_unfair_recursive_lock_unlock();
}

- (id)allNewlyConfiguredAccessories
{
  v16 = *MEMORY[0x277D85DE8];
  os_unfair_recursive_lock_lock_with_options();
  array = [MEMORY[0x277CBEB18] array];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  allValues = [(NSMutableDictionary *)self->_newlyConfiguredAccessories allValues];
  v5 = [allValues countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(allValues);
        }

        [array addObjectsFromArray:*(*(&v11 + 1) + 8 * i)];
      }

      v5 = [allValues countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v5);
  }

  v8 = [array copy];
  os_unfair_recursive_lock_unlock();
  v9 = *MEMORY[0x277D85DE8];

  return v8;
}

- (void)setAnyBTLEAccessoryReachable:(BOOL)reachable
{
  os_unfair_recursive_lock_lock_with_options();
  self->_anyBTLEAccessoryReachable = reachable;

  os_unfair_recursive_lock_unlock();
}

- (BOOL)isAnyBTLEAccessoryReachable
{
  os_unfair_recursive_lock_lock_with_options();
  anyBTLEAccessoryReachable = self->_anyBTLEAccessoryReachable;
  os_unfair_recursive_lock_unlock();
  return anyBTLEAccessoryReachable;
}

- (void)setName:(id)name
{
  nameCopy = name;
  os_unfair_recursive_lock_lock_with_options();
  hm_truncatedNameString = [nameCopy hm_truncatedNameString];
  name = self->_name;
  self->_name = hm_truncatedNameString;

  os_unfair_recursive_lock_unlock();
}

- (NSString)name
{
  os_unfair_recursive_lock_lock_with_options();
  v3 = self->_name;
  os_unfair_recursive_lock_unlock();

  return v3;
}

- (HMDFeaturesDataSource)featuresDataSource
{
  dataSource = [(HMDHome *)self dataSource];
  featuresDataSource = [dataSource featuresDataSource];

  return featuresDataSource;
}

- (id)dumpStateWithPrivacyLevel:(unint64_t)level
{
  v188 = *MEMORY[0x277D85DE8];
  v148 = [MEMORY[0x277CBEB38] dictionaryWithCapacity:12];
  v142 = MEMORY[0x277CCACA8];
  name = [(HMDHome *)self name];
  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  spiClientIdentifier = [(HMDHome *)self spiClientIdentifier];
  uUIDString2 = [spiClientIdentifier UUIDString];
  zoneID = [(HMDHome *)self zoneID];
  uUIDString3 = [zoneID UUIDString];
  [(HMDHome *)self isMultiUserEnabled];
  v9 = HMFBooleanToString();
  [(HMDHome *)self hasAnyUserAcknowledgedCameraRecordingOnboarding];
  v10 = HMFBooleanToString();
  urlString = [(HMDHome *)self urlString];
  v12 = [v142 stringWithFormat:@"name: %@, uuid: %@, spiClientIdentifier: %@, zoneID: %@, multiUserEnabled: %@, acknowledgedCameraOnboarding: %@, assistantIdentifier: %@", name, uUIDString, uUIDString2, uUIDString3, v9, v10, urlString];

  v136 = v12;
  [v148 setObject:v12 forKeyedSubscript:*MEMORY[0x277D0F170]];
  appData = [(HMDHome *)self appData];
  v14 = [appData dumpStateWithPrivacyLevel:level];
  [v148 setObject:v14 forKeyedSubscript:*MEMORY[0x277D0F050]];

  v15 = [(HMDHome *)self homeLocationWithPrivacyLevel:level];
  v16 = v15;
  v17 = MEMORY[0x277CCACA8];
  if (v15)
  {
    v18 = v15;
  }

  else
  {
    v18 = @"Unknown";
  }

  homeLocationHandler = [(HMDHome *)self homeLocationHandler];
  [homeLocationHandler regionStateAtHome];
  v20 = HMRegionStateString();
  homeLocationHandler2 = [(HMDHome *)self homeLocationHandler];
  [homeLocationHandler2 regionStateNearbyHome];
  v22 = HMRegionStateString();
  selfCopy = self;
  atHomeLevel = [(HMDHome *)self atHomeLevel];
  v135 = v16;
  v143 = homeLocationHandler2;
  v146 = homeLocationHandler;
  v24 = v20;
  if (atHomeLevel > 3)
  {
    v25 = @"HMDAtHomeLevelNotAtHome";
  }

  else
  {
    v25 = off_279722F30[atHomeLevel];
  }

  [(HMDHome *)self homeLocation];
  v26 = HMStringFromHomeLocation();
  homeLocationHandler3 = [(HMDHome *)self homeLocationHandler];
  v28 = HMDHomeLocationSourceToString([homeLocationHandler3 locationSource]);
  v29 = [v17 stringWithFormat:@"Location: %@, At Home Region State: %@, Nearby Home Region State: %@, At Home Level: %@, State: %@, Source: %@", v18, v24, v22, v25, v26, v28];

  selfCopy2 = self;
  v31 = v148;
  v134 = v29;
  [v148 setObject:v29 forKeyedSubscript:*MEMORY[0x277D0F0F8]];
  v32 = MEMORY[0x277CCACA8];
  [(HMDHome *)self minimumMediaUserPrivilege];
  v33 = HMUserPrivilegeToString();
  [(HMDHome *)self isMediaPeerToPeerEnabled];
  v34 = HMFBooleanToString();
  mediaPassword = [(HMDHome *)self mediaPassword];
  v36 = @"<set>";
  if (!mediaPassword)
  {
    v36 = @"<null>";
  }

  v37 = [v32 stringWithFormat:@"Minimum Media User Privilege: %@, Media Peer to Peer Enabled: %@, has Media Password: %@", v33, v34, v36];

  v133 = v37;
  [v148 setObject:v37 forKeyedSubscript:@"User Privilege"];
  rooms = [(HMDHome *)selfCopy rooms];
  v39 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(rooms, "count") + 1}];
  roomForEntireHome = [(HMDHome *)selfCopy roomForEntireHome];

  if (roomForEntireHome)
  {
    roomForEntireHome2 = [(HMDHome *)selfCopy roomForEntireHome];
    v42 = [roomForEntireHome2 dumpStateWithPrivacyLevel:level];
    [v39 addObject:v42];
  }

  v177 = 0u;
  v178 = 0u;
  v175 = 0u;
  v176 = 0u;
  v43 = rooms;
  v44 = [v43 countByEnumeratingWithState:&v175 objects:v187 count:16];
  if (v44)
  {
    v45 = v44;
    v46 = *v176;
    do
    {
      for (i = 0; i != v45; ++i)
      {
        if (*v176 != v46)
        {
          objc_enumerationMutation(v43);
        }

        v48 = [*(*(&v175 + 1) + 8 * i) dumpStateWithPrivacyLevel:level];
        [v39 addObject:v48];
      }

      v45 = [v43 countByEnumeratingWithState:&v175 objects:v187 count:16];
    }

    while (v45);
  }

  if ([v39 count])
  {
    [v148 setObject:v39 forKeyedSubscript:*MEMORY[0x277D0F140]];
  }

  zones = [(HMDHome *)selfCopy zones];
  if ([zones count])
  {
    v49 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(zones, "count")}];
    v171 = 0u;
    v172 = 0u;
    v173 = 0u;
    v174 = 0u;
    v50 = zones;
    v51 = [v50 countByEnumeratingWithState:&v171 objects:v186 count:16];
    if (v51)
    {
      v52 = v51;
      v53 = *v172;
      do
      {
        for (j = 0; j != v52; ++j)
        {
          if (*v172 != v53)
          {
            objc_enumerationMutation(v50);
          }

          v55 = [*(*(&v171 + 1) + 8 * j) dumpStateWithPrivacyLevel:level];
          [v49 addObject:v55];
        }

        v52 = [v50 countByEnumeratingWithState:&v171 objects:v186 count:16];
      }

      while (v52);
    }

    [v148 setObject:v49 forKeyedSubscript:*MEMORY[0x277D0F198]];
    selfCopy2 = selfCopy;
  }

  accessories = [(HMDHome *)selfCopy2 accessories];
  v57 = [accessories copy];

  v144 = v57;
  if ([v57 count])
  {
    v58 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v57, "count")}];
    v167 = 0u;
    v168 = 0u;
    v169 = 0u;
    v170 = 0u;
    v59 = v57;
    v60 = [v59 countByEnumeratingWithState:&v167 objects:v185 count:16];
    if (v60)
    {
      v61 = v60;
      v62 = *v168;
      do
      {
        for (k = 0; k != v61; ++k)
        {
          if (*v168 != v62)
          {
            objc_enumerationMutation(v59);
          }

          v64 = *(*(&v167 + 1) + 8 * k);
          v65 = objc_autoreleasePoolPush();
          v66 = [v64 dumpStateWithPrivacyLevel:level];
          [v58 addObject:v66];

          objc_autoreleasePoolPop(v65);
        }

        v61 = [v59 countByEnumeratingWithState:&v167 objects:v185 count:16];
      }

      while (v61);
    }

    v31 = v148;
    [v148 setObject:v58 forKeyedSubscript:*MEMORY[0x277D0F028]];

    selfCopy2 = selfCopy;
  }

  serviceGroups = [(HMDHome *)selfCopy2 serviceGroups];
  if ([serviceGroups count])
  {
    v67 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(serviceGroups, "count")}];
    v163 = 0u;
    v164 = 0u;
    v165 = 0u;
    v166 = 0u;
    v68 = serviceGroups;
    v69 = [v68 countByEnumeratingWithState:&v163 objects:v184 count:16];
    if (v69)
    {
      v70 = v69;
      v71 = *v164;
      do
      {
        for (m = 0; m != v70; ++m)
        {
          if (*v164 != v71)
          {
            objc_enumerationMutation(v68);
          }

          v73 = [*(*(&v163 + 1) + 8 * m) dumpStateWithPrivacyLevel:level];
          [v67 addObject:v73];
        }

        v70 = [v68 countByEnumeratingWithState:&v163 objects:v184 count:16];
      }

      while (v70);
    }

    [v31 setObject:v67 forKeyedSubscript:*MEMORY[0x277D0F148]];
    selfCopy2 = selfCopy;
  }

  triggers = [(HMDHome *)selfCopy2 triggers];
  if ([triggers count])
  {
    v74 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(triggers, "count")}];
    v159 = 0u;
    v160 = 0u;
    v161 = 0u;
    v162 = 0u;
    v75 = triggers;
    v76 = [v75 countByEnumeratingWithState:&v159 objects:v183 count:16];
    if (v76)
    {
      v77 = v76;
      v78 = *v160;
      do
      {
        for (n = 0; n != v77; ++n)
        {
          if (*v160 != v78)
          {
            objc_enumerationMutation(v75);
          }

          v80 = [*(*(&v159 + 1) + 8 * n) dumpStateWithPrivacyLevel:level];
          [v74 addObject:v80];
        }

        v77 = [v75 countByEnumeratingWithState:&v159 objects:v183 count:16];
      }

      while (v77);
    }

    [v31 setObject:v74 forKeyedSubscript:*MEMORY[0x277D0F188]];
    selfCopy2 = selfCopy;
  }

  currentUser = [(HMDHome *)selfCopy2 currentUser];
  v82 = [currentUser dumpStateWithPrivacyLevel:level];
  [v31 setObject:v82 forKeyedSubscript:*MEMORY[0x277D0F090]];

  users = [(HMDHome *)selfCopy2 users];
  v84 = [users copy];

  v138 = v84;
  if ([v84 count])
  {
    v85 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v84, "count")}];
    v155 = 0u;
    v156 = 0u;
    v157 = 0u;
    v158 = 0u;
    v86 = v84;
    v87 = [v86 countByEnumeratingWithState:&v155 objects:v182 count:16];
    if (v87)
    {
      v88 = v87;
      v89 = *v156;
      do
      {
        for (ii = 0; ii != v88; ++ii)
        {
          if (*v156 != v89)
          {
            objc_enumerationMutation(v86);
          }

          v91 = [*(*(&v155 + 1) + 8 * ii) dumpStateWithPrivacyLevel:level];
          [v85 addObject:v91];
        }

        v88 = [v86 countByEnumeratingWithState:&v155 objects:v182 count:16];
      }

      while (v88);
    }

    [v31 setObject:v85 forKeyedSubscript:*MEMORY[0x277D0F190]];
    selfCopy2 = selfCopy;
  }

  removedUsers = [(HMDHome *)selfCopy2 removedUsers];
  if ([removedUsers count])
  {
    v92 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(removedUsers, "count")}];
    v151 = 0u;
    v152 = 0u;
    v153 = 0u;
    v154 = 0u;
    v93 = removedUsers;
    v94 = [v93 countByEnumeratingWithState:&v151 objects:v181 count:16];
    if (v94)
    {
      v95 = v94;
      v96 = *v152;
      do
      {
        for (jj = 0; jj != v95; ++jj)
        {
          if (*v152 != v96)
          {
            objc_enumerationMutation(v93);
          }

          user = [*(*(&v151 + 1) + 8 * jj) user];
          v99 = [user dumpStateWithPrivacyLevel:level];
          [v92 addObject:v99];
        }

        v95 = [v93 countByEnumeratingWithState:&v151 objects:v181 count:16];
      }

      while (v95);
    }

    v31 = v148;
    [v148 setObject:v92 forKeyedSubscript:*MEMORY[0x277D0F130]];

    selfCopy2 = selfCopy;
  }

  residentDeviceManager = [(HMDHome *)selfCopy2 residentDeviceManager];

  if (residentDeviceManager)
  {
    residentDeviceManager2 = [(HMDHome *)selfCopy2 residentDeviceManager];
    dumpState = [residentDeviceManager2 dumpState];
    [v31 setObject:dumpState forKeyedSubscript:*MEMORY[0x277D0F138]];
  }

  v131 = MEMORY[0x277CBEB38];
  v179[0] = @"Registered";
  notificationRegistrations = [(HMDHome *)selfCopy2 notificationRegistrations];
  allObjects = [notificationRegistrations allObjects];
  v180[0] = allObjects;
  v179[1] = @"Apple Media Registered";
  notificationRegistrationsForAppleMediaAccessories = [(HMDHome *)selfCopy notificationRegistrationsForAppleMediaAccessories];
  allObjects2 = [notificationRegistrationsForAppleMediaAccessories allObjects];
  v180[1] = allObjects2;
  v179[2] = @"Deregistered";
  notificationDeregistrations = [(HMDHome *)selfCopy notificationDeregistrations];
  allObjects3 = [notificationDeregistrations allObjects];
  v180[2] = allObjects3;
  v108 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v180 forKeys:v179 count:3];
  v109 = [v131 dictionaryWithDictionary:v108];

  notificationsUpdatedTime = [(HMDHome *)selfCopy notificationsUpdatedTime];

  if (notificationsUpdatedTime)
  {
    notificationsUpdatedTime2 = [(HMDHome *)selfCopy notificationsUpdatedTime];
    shortDescription = [notificationsUpdatedTime2 shortDescription];
    [v109 setObject:shortDescription forKey:@"UpdateTime"];
  }

  [v148 setObject:v109 forKeyedSubscript:*MEMORY[0x277D0F0C8]];
  pendingResponses = [(HMDHome *)selfCopy pendingResponses];
  v114 = [pendingResponses description];
  [v148 setObject:v114 forKeyedSubscript:*MEMORY[0x277D0F118]];

  sharedHomeUpdateHandler = [(HMDHome *)selfCopy sharedHomeUpdateHandler];
  v116 = [sharedHomeUpdateHandler dumpStateWithPrivacyLevel:level];
  [v148 setObject:v116 forKeyedSubscript:*MEMORY[0x277D0F160]];

  sharedHomeSourceVersion = [(HMDHome *)selfCopy sharedHomeSourceVersion];
  versionString = [sharedHomeSourceVersion versionString];
  [v148 setObject:versionString forKeyedSubscript:*MEMORY[0x277D0F158]];

  v119 = MEMORY[0x277CCACA8];
  unfilteredThreadNetworkID = [(HMDHome *)selfCopy unfilteredThreadNetworkID];
  v120 = [v119 stringWithFormat:@"threadNetworkID=%@", unfilteredThreadNetworkID];
  [v148 setObject:v120 forKeyedSubscript:@"ThreadNetwork"];

  personManagerSettings = [(HMDHome *)selfCopy personManagerSettings];
  v123 = [personManagerSettings description];
  [v148 setObject:v123 forKeyedSubscript:@"Person Manager Settings"];

  labelsByAccessCode = [(HMDHome *)selfCopy labelsByAccessCode];
  v125 = [labelsByAccessCode description];
  [v148 setObject:v125 forKeyedSubscript:@"Simple Label Access Codes"];

  chipStorage = [(HMDHome *)selfCopy chipStorage];
  debugDictionaryRepresentation = [chipStorage debugDictionaryRepresentation];
  [v148 setObject:debugDictionaryRepresentation forKeyedSubscript:@"CHIP Home Storage"];

  [(HMDHome *)selfCopy isResidentFirstAccessoryCommunicationEnabled];
  v128 = HMFBooleanToString();
  [v148 setObject:v128 forKeyedSubscript:@"Is Resident First Accessory Communication Enabled"];

  v129 = *MEMORY[0x277D85DE8];

  return v148;
}

- (id)homeLocationWithPrivacyLevel:(unint64_t)level
{
  if (level == 2)
  {
    homeLocationHandler = [(HMDHome *)self homeLocationHandler];
    location = [homeLocationHandler location];
  }

  else
  {
    location = 0;
  }

  return location;
}

- (id)descriptionWithPointer:(BOOL)pointer
{
  pointerCopy = pointer;
  v5 = MEMORY[0x277CCACA8];
  shortDescription = [objc_opt_class() shortDescription];
  if (pointerCopy)
  {
    v7 = [MEMORY[0x277CCACA8] stringWithFormat:@" %p", self];
  }

  else
  {
    v7 = &stru_286509E58;
  }

  uuid = [(HMDHome *)self uuid];
  uUIDString = [uuid UUIDString];
  spiClientIdentifier = [(HMDHome *)self spiClientIdentifier];
  uUIDString2 = [spiClientIdentifier UUIDString];
  name = [(HMDHome *)self name];
  v13 = [v5 stringWithFormat:@"<%@%@, ID = %@, spiID = %@, NM = %@>", shortDescription, v7, uUIDString, uUIDString2, name];

  if (pointerCopy)
  {
  }

  return v13;
}

- (id)shortDescription
{
  if (isInternalBuild())
  {
    v3 = MEMORY[0x277CCACA8];
    name = [(HMDHome *)self name];
    uuid = [(HMDHome *)self uuid];
    uUIDString = [v3 stringWithFormat:@"%@/%@", name, uuid];
  }

  else
  {
    name = [(HMDHome *)self uuid];
    uUIDString = [name UUIDString];
  }

  return uUIDString;
}

- (void)dealloc
{
  [(HMDHome *)self unconfigure];
  v3.receiver = self;
  v3.super_class = HMDHome;
  [(HMDHome *)&v3 dealloc];
}

- (void)unconfigure
{
  notificationCenter = [(HMDHome *)self notificationCenter];
  [notificationCenter removeObserver:self];

  msgDispatcher = [(HMDHome *)self msgDispatcher];
  [msgDispatcher deregisterReceiver:self];

  mediaGroupsAggregateConsumer = [(HMDHome *)self mediaGroupsAggregateConsumer];
  [mediaGroupsAggregateConsumer unconfigure];

  accessCodeManager = [(HMDHome *)self accessCodeManager];
  [accessCodeManager unconfigure];
}

- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source logEventSubmitter:(id)self0 carPlayDataSource:(id)self1 administratorHandlerFactory:(id)self2 localCapabilitiesDataSource:(id)self3 notificationCenter:(id)self4 keychainStore:(id)self5
{
  v290 = *MEMORY[0x277D85DE8];
  nameCopy = name;
  uuidCopy = uuid;
  dCopy = d;
  ownerCopy = owner;
  obj = manager;
  authCopy = auth;
  sourceCopy = source;
  submitterCopy = submitter;
  dataSourceCopy = dataSource;
  factoryCopy = factory;
  capabilitiesDataSourceCopy = capabilitiesDataSource;
  centerCopy = center;
  storeCopy = store;
  v285.receiver = self;
  v285.super_class = HMDHome;
  v20 = [(HMDHome *)&v285 init];
  v21 = v20;
  if (!v20)
  {
    goto LABEL_47;
  }

  objc_storeStrong(&v20->_dataSource, source);
  +[HMDHome _initialize];
  v264 = [obj sharedUserAcceptEventBuilderForHomeUuid:uuidCopy];
  [v264 markCreatedHome];
  objc_storeStrong(&v21->_localCapabilitiesDataSource, capabilitiesDataSource);
  v22 = HMFGetOSLogHandle();
  logger = v21->_logger;
  v21->_logger = v22;

  if (uuidCopy)
  {
    uUID = [uuidCopy copy];
  }

  else
  {
    uUID = [MEMORY[0x277CCAD78] UUID];
  }

  v24 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:uUID];
  uuid = v21->_uuid;
  v21->_uuid = v24;

  v262 = spiClientIdentifierForUUID(v21->_uuid);
  v26 = [MEMORY[0x277D0F890] hmf_cachedInstanceForNSUUID:v262];
  spiClientIdentifier = v21->_spiClientIdentifier;
  v21->_spiClientIdentifier = v26;

  uUIDString = [(NSUUID *)v21->_uuid UUIDString];
  v268 = [@"com.apple.hmd.home" stringByAppendingString:uUIDString];

  v29 = v268;
  uTF8String = [v268 UTF8String];
  v31 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v32 = dispatch_queue_create(uTF8String, v31);
  workQueue = v21->_workQueue;
  v21->_workQueue = v32;

  [MEMORY[0x277D0F7A8] blessWithImplicitContext:v21->_workQueue];
  objc_storeStrong(&v21->_notificationCenter, center);
  v34 = [[HMDPrimaryResidentChangeMonitor alloc] initWithIdentifier:v21->_uuid notificationCenter:centerCopy];
  primaryResidentChangeMonitor = v21->_primaryResidentChangeMonitor;
  v21->_primaryResidentChangeMonitor = v34;

  [(HMDPrimaryResidentChangeMonitor *)v21->_primaryResidentChangeMonitor setDataSource:v21];
  objc_storeStrong(&v21->_logEventSubmitter, submitter);
  objc_storeStrong(&v21->_keychainStore, store);
  makeReportingSessionManager = [sourceCopy makeReportingSessionManager];
  reportingSessionManager = v21->_reportingSessionManager;
  v21->_reportingSessionManager = makeReportingSessionManager;

  if (submitterCopy)
  {
    v38 = [sourceCopy makeHomeMetricsDispatcherWithIdentifier:v21->_uuid logEventSubmitter:submitterCopy];
    metricsDispatcher = v21->_metricsDispatcher;
    v21->_metricsDispatcher = v38;
  }

  hm_truncatedNameString = [nameCopy hm_truncatedNameString];
  v41 = [hm_truncatedNameString copy];
  name = v21->_name;
  v21->_name = v41;

  v43 = [HMDHome zoneIDFromHomeUUID:v21->_uuid];
  zoneID = v21->_zoneID;
  v21->_zoneID = v43;

  objc_storeWeak(&v21->_homeManager, obj);
  messageDispatcher = [obj messageDispatcher];
  msgDispatcher = v21->_msgDispatcher;
  v21->_msgDispatcher = messageDispatcher;

  objc_storeStrong(&v21->_owner, owner);
  v21->_ownerTrustZoneCapable = [ownerCopy isCurrentUser];
  pairingUsername = [ownerCopy pairingUsername];
  ownerName = v21->_ownerName;
  v21->_ownerName = pairingUsername;

  isCurrentUser = ownerCopy;
  if (ownerCopy)
  {
    isCurrentUser = [ownerCopy isCurrentUser];
  }

  v21->_ownerUser = isCurrentUser;
  v21->_allowsRemoteAccess = 1;
  v50 = +[HMDHomeKitVersion currentVersion];
  currentHomeKitVersion = v21->_currentHomeKitVersion;
  v21->_currentHomeKitVersion = v50;

  v52 = objc_autoreleasePoolPush();
  v53 = v21;
  v54 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v54, OS_LOG_TYPE_INFO))
  {
    v55 = HMFGetLogIdentifier();
    *buf = 138543618;
    v287 = v55;
    v288 = 2112;
    v289 = authCopy;
    _os_log_impl(&dword_2531F8000, v54, OS_LOG_TYPE_INFO, "%{public}@Home Presence auth : %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v52);
  if (authCopy)
  {
    v56 = authCopy;
    presenceAuthStatus = v53->_presenceAuthStatus;
    v53->_presenceAuthStatus = v56;
  }

  else
  {
    v58 = [HMDHomeManager isThisDeviceAdminOfHome:v53];
    if (v58)
    {
      presenceAuthStatus = [MEMORY[0x277CD1F00] authWithValue:1];
    }

    else
    {
      presenceAuthStatus = 0;
    }

    objc_storeStrong(&v53->_presenceAuthStatus, presenceAuthStatus);
    if (!v58)
    {
      goto LABEL_18;
    }
  }

LABEL_18:
  presenceComputeStatus = v53->_presenceComputeStatus;
  v53->_presenceComputeStatus = 0;

  v53->_homeLocation = 0;
  v60 = [MEMORY[0x277CBEB58] set];
  reachabilityUpdatedAccessories = v53->_reachabilityUpdatedAccessories;
  v53->_reachabilityUpdatedAccessories = v60;

  v62 = [[HMDHomeObjectChangeHandler alloc] initWithHome:v53];
  homeObjectChangeHandler = v53->_homeObjectChangeHandler;
  v53->_homeObjectChangeHandler = v62;

  accessoryBrowser = [obj accessoryBrowser];
  accessoryBrowser = v53->_accessoryBrowser;
  v53->_accessoryBrowser = accessoryBrowser;

  array = [MEMORY[0x277CBEB18] array];
  rooms = v53->_rooms;
  v53->_rooms = array;

  array2 = [MEMORY[0x277CBEB18] array];
  zones = v53->_zones;
  v53->_zones = array2;

  dictionary = [MEMORY[0x277CBEB38] dictionary];
  accessories = v53->_accessories;
  v53->_accessories = dictionary;

  array3 = [MEMORY[0x277CBEB18] array];
  serviceGroups = v53->_serviceGroups;
  v53->_serviceGroups = array3;

  array4 = [MEMORY[0x277CBEB18] array];
  actionSets = v53->_actionSets;
  v53->_actionSets = array4;

  array5 = [MEMORY[0x277CBEB18] array];
  currentTriggers = v53->_currentTriggers;
  v53->_currentTriggers = array5;

  array6 = [MEMORY[0x277CBEB18] array];
  triggerOwnedActionSets = v53->_triggerOwnedActionSets;
  v53->_triggerOwnedActionSets = array6;

  array7 = [MEMORY[0x277CBEB18] array];
  users = v53->_users;
  v53->_users = array7;

  array8 = [MEMORY[0x277CBEB18] array];
  usersPendingUserManagementOperations = v53->_usersPendingUserManagementOperations;
  v53->_usersPendingUserManagementOperations = array8;

  array9 = [MEMORY[0x277CBEB18] array];
  removedUsers = v53->_removedUsers;
  v53->_removedUsers = array9;

  array10 = [MEMORY[0x277CBEB18] array];
  outgoingInvitations = v53->_outgoingInvitations;
  v53->_outgoingInvitations = array10;

  array11 = [MEMORY[0x277CBEB18] array];
  ownedTriggers = v53->_ownedTriggers;
  v53->_ownedTriggers = array11;

  v90 = [MEMORY[0x277CBEB58] set];
  pendingResponsesForRemoteAccessSetup = v53->_pendingResponsesForRemoteAccessSetup;
  v53->_pendingResponsesForRemoteAccessSetup = v90;

  dictionary2 = [MEMORY[0x277CBEB38] dictionary];
  enableNotificationPayload = v53->_enableNotificationPayload;
  v53->_enableNotificationPayload = dictionary2;

  dictionary3 = [MEMORY[0x277CBEB38] dictionary];
  disableNotificationPayload = v53->_disableNotificationPayload;
  v53->_disableNotificationPayload = dictionary3;

  dictionary4 = [MEMORY[0x277CBEB38] dictionary];
  notificationHandlerMap = v53->_notificationHandlerMap;
  v53->_notificationHandlerMap = dictionary4;

  v98 = [MEMORY[0x277CBEB58] set];
  notificationRegistrations = v53->_notificationRegistrations;
  v53->_notificationRegistrations = v98;

  v100 = [MEMORY[0x277CBEB58] set];
  notificationRegistrationsForAppleMediaAccessories = v53->_notificationRegistrationsForAppleMediaAccessories;
  v53->_notificationRegistrationsForAppleMediaAccessories = v100;

  v102 = [MEMORY[0x277CBEB58] set];
  notificationDeregistrations = v53->_notificationDeregistrations;
  v53->_notificationDeregistrations = v102;

  distantFuture = [MEMORY[0x277CBEAA8] distantFuture];
  notificationsUpdatedTime = v53->_notificationsUpdatedTime;
  v53->_notificationsUpdatedTime = distantFuture;

  strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
  uuidToHAPAccessoryConfigTable = v53->_uuidToHAPAccessoryConfigTable;
  v53->_uuidToHAPAccessoryConfigTable = strongToStrongObjectsMapTable;

  v108 = +[HMDAppleAccountSettings sharedSettings];
  accountSettings = v53->_accountSettings;
  v53->_accountSettings = v108;

  objc_storeStrong(&v53->_carPlayDataSource, dataSource);
  if (isiOSDevice())
  {
    v110 = [MEMORY[0x277CBEB58] set];
    heartbeatPingMessagesQueuedWithServer = v53->_heartbeatPingMessagesQueuedWithServer;
    v53->_heartbeatPingMessagesQueuedWithServer = v110;
  }

  if (ownerCopy)
  {
    [(NSMutableArray *)v53->_users addObject:ownerCopy];
    [ownerCopy setHome:v53];
    if (!v21->_ownerUser)
    {
      [(HMDHome *)v53 _updateCurrentUserForSharedHome];
    }
  }

  v112 = [HMDRoom alloc];
  v113 = HMDDefaultRoomName();
  v114 = [(HMDRoom *)v112 initWithName:v113 uuid:dCopy home:v53];
  roomForEntireHome = v53->_roomForEntireHome;
  v53->_roomForEntireHome = v114;

  v53->_configurationVersion = 0;
  v53->_previousReachableAccessoriesCount = 0;
  v53->_previousReachableAppleMediaAccessoriesCount = 0;
  array12 = [MEMORY[0x277CBEB18] array];
  unconfiguredResidentDevices = v53->_unconfiguredResidentDevices;
  v53->_unconfiguredResidentDevices = array12;

  weakObjectsHashTable = [MEMORY[0x277CCAA50] weakObjectsHashTable];
  removeAccessoryInProgressForHMDAccessories = v53->_removeAccessoryInProgressForHMDAccessories;
  v53->_removeAccessoryInProgressForHMDAccessories = weakObjectsHashTable;

  array13 = [MEMORY[0x277CBEB18] array];
  retrievalAccessoryCompletionTuples = v53->_retrievalAccessoryCompletionTuples;
  v53->_retrievalAccessoryCompletionTuples = array13;

  array14 = [MEMORY[0x277CBEB18] array];
  accessoryRemoteReachabilityEnabledClients = v53->_accessoryRemoteReachabilityEnabledClients;
  v53->_accessoryRemoteReachabilityEnabledClients = array14;

  objc_initWeak(&location, v53);
  v124 = [HMDManagedStagedValue alloc];
  v125 = [MEMORY[0x277D0F788] BOOLeanWithBool:0];
  v282[0] = MEMORY[0x277D85DD0];
  v282[1] = 3221225472;
  v282[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke;
  v282[3] = &unk_279721F58;
  objc_copyWeak(&v283, &location);
  v126 = [(HMDManagedStagedValue *)v124 initWithValue:v125 commitBlock:v282];
  stagedRemoteReachabilityRegistration = v53->_stagedRemoteReachabilityRegistration;
  v53->_stagedRemoteReachabilityRegistration = v126;

  array15 = [MEMORY[0x277CBEB18] array];
  reachabilityRegisteredDevices = v53->_reachabilityRegisteredDevices;
  v53->_reachabilityRegisteredDevices = array15;

  array16 = [MEMORY[0x277CBEB18] array];
  remoteReachabilityNotificationPendingAccessories = v53->_remoteReachabilityNotificationPendingAccessories;
  v53->_remoteReachabilityNotificationPendingAccessories = array16;

  dictionary5 = [MEMORY[0x277CBEB38] dictionary];
  pendingResponses = v53->_pendingResponses;
  v53->_pendingResponses = dictionary5;

  makeHomeLocationHandler = [sourceCopy makeHomeLocationHandler];
  homeLocationHandler = v53->_homeLocationHandler;
  v53->_homeLocationHandler = makeHomeLocationHandler;

  makeHomeReprovisionHandler = [sourceCopy makeHomeReprovisionHandler];
  homeReprovisionHandler = v53->_homeReprovisionHandler;
  v53->_homeReprovisionHandler = makeHomeReprovisionHandler;

  dictionary6 = [MEMORY[0x277CBEB38] dictionary];
  newlyConfiguredAccessories = v53->_newlyConfiguredAccessories;
  v53->_newlyConfiguredAccessories = dictionary6;

  v140 = [MEMORY[0x277CCAB00] mapTableWithKeyOptions:512 valueOptions:0];
  addPendingAccessories = v53->_addPendingAccessories;
  v53->_addPendingAccessories = v140;

  dictionary7 = [MEMORY[0x277CBEB38] dictionary];
  addPendingAccessorySetupCodes = v53->_addPendingAccessorySetupCodes;
  v53->_addPendingAccessorySetupCodes = dictionary7;

  dictionary8 = [MEMORY[0x277CBEB38] dictionary];
  addPendingAccessoryOnboardingSetupPayloadStrings = v53->_addPendingAccessoryOnboardingSetupPayloadStrings;
  v53->_addPendingAccessoryOnboardingSetupPayloadStrings = dictionary8;

  dictionary9 = [MEMORY[0x277CBEB38] dictionary];
  addPendingAccessorySetupCodeHandlers = v53->_addPendingAccessorySetupCodeHandlers;
  v53->_addPendingAccessorySetupCodeHandlers = dictionary9;

  v53->_anyBTLEAccessoryReachable = 0;
  v148 = [sourceCopy makeResidentDeviceManagerWithHomeUUID:v21->_uuid];
  residentDeviceManager = v53->_residentDeviceManager;
  v53->_residentDeviceManager = v148;

  if (!v21->_ownerUser && !isWatch())
  {
    v150 = objc_alloc_init(HMDSharedHomeUpdateHandler);
    sharedHomeUpdateHandler = v53->_sharedHomeUpdateHandler;
    v53->_sharedHomeUpdateHandler = v150;

    [(HMDSharedHomeUpdateHandler *)v53->_sharedHomeUpdateHandler configureWithHome:v53];
  }

  v152 = factoryCopy[2](factoryCopy, v53);
  administratorHandler = v53->_administratorHandler;
  v53->_administratorHandler = v152;

  v154 = [HMDHomeMediaSystemHandler alloc];
  v155 = [(HMDHomeMediaSystemHandler *)v154 initWithMediaSystems:MEMORY[0x277CBEBF8]];
  mediaSystemController = v53->_mediaSystemController;
  v53->_mediaSystemController = v155;

  v53->_automaticSoftwareUpdateEnabled = 1;
  v53->_automaticThirdPartyAccessorySoftwareUpdateEnabled = 0;
  v53->_protectionMode = 0;
  v53->_networkRouterSupportDisableReason = 0;
  v53->_networkRouterSupport = [(HMDHome *)v53 deriveNetworkRouterSupport:0];
  v53->_mediaPeerToPeerEnabled = 0;
  v53->_soundCheckEnabled = 1;
  makeNotificationRegistry = [sourceCopy makeNotificationRegistry];
  notificationRegistry = v53->_notificationRegistry;
  v53->_notificationRegistry = makeNotificationRegistry;

  [(HMDNotificationRegistry *)v53->_notificationRegistry configureWithHome:v53];
  if ([(HMDHomeLocalDeviceCapabilitiesDataSource *)v21->_localCapabilitiesDataSource isResidentCapable])
  {
    v159 = [[HMDResidentAppleMediaStateManager alloc] initWithDataSource:v53 delegate:v53];
    mediaStateManager = v53->_mediaStateManager;
    v53->_mediaStateManager = v159;
  }

  array17 = [MEMORY[0x277CBEB18] array];
  mediaSessions = v53->_mediaSessions;
  v53->_mediaSessions = array17;

  array18 = [MEMORY[0x277CBEB18] array];
  mediaSessionStates = v53->_mediaSessionStates;
  v53->_mediaSessionStates = array18;

  weakObjectsHashTable2 = [MEMORY[0x277CCAA50] weakObjectsHashTable];
  connectionsDiscoveringSymptomsForNearbyDevices = v53->_connectionsDiscoveringSymptomsForNearbyDevices;
  v53->_connectionsDiscoveringSymptomsForNearbyDevices = weakObjectsHashTable2;

  if (!isWatch())
  {
    if (ownerCopy && [(HMDHomeLocalDeviceCapabilitiesDataSource *)v21->_localCapabilitiesDataSource isResidentCapable])
    {
      dataSource = [(HMDHome *)v53 dataSource];
      makeHomePresenceMonitor = [dataSource makeHomePresenceMonitor];
      presenceMonitor = v53->_presenceMonitor;
      v53->_presenceMonitor = makeHomePresenceMonitor;

      v170 = objc_alloc_init(HMDHomePeriodicReader);
      periodicReader = v53->_periodicReader;
      v53->_periodicReader = v170;
    }

    v172 = objc_alloc_init(HMDUserPresenceFeeder);
    presenceFeeder = v53->_presenceFeeder;
    v53->_presenceFeeder = v172;

    v174 = objc_autoreleasePoolPush();
    v175 = v53;
    v176 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v176, OS_LOG_TYPE_INFO))
    {
      v177 = HMFGetLogIdentifier();
      presenceFeeder = [(HMDHome *)v175 presenceFeeder];
      *buf = 138543618;
      v287 = v177;
      v288 = 2112;
      v289 = presenceFeeder;
      _os_log_impl(&dword_2531F8000, v176, OS_LOG_TYPE_INFO, "%{public}@Allocated presenceFeeder on HMDHome: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v174);
  }

  v179 = [HMDPredicateUtilities alloc];
  name = [(HMDHome *)v53 name];
  v181 = [(HMDPredicateUtilities *)v179 initWithHome:v53 logIdentifier:name];
  predicateUtility = v53->_predicateUtility;
  v53->_predicateUtility = v181;

  v183 = [[HMDMediaActionRouter alloc] initWithDataSource:v53];
  mediaActionRouter = v53->_mediaActionRouter;
  v53->_mediaActionRouter = v183;

  v53->_multiUserEnabled = 1;
  v53->_hasAnyUserAcknowledgedCameraRecordingOnboarding = 0;
  v185 = [HMDAccessoryNetworkProtectionGroupRegistry alloc];
  notificationCenter = [(HMDHome *)v53 notificationCenter];
  v187 = [(HMDAccessoryNetworkProtectionGroupRegistry *)v185 initWithHome:v53 notificationCenter:notificationCenter];
  networkProtectionGroupRegistry = v53->_networkProtectionGroupRegistry;
  v53->_networkProtectionGroupRegistry = v187;

  v189 = [HMDResidentReachabilityNotificationManager alloc];
  v190 = objc_alloc_init(HMDResidentReachabilityContext);
  v191 = [(HMDResidentReachabilityNotificationManager *)v189 initWithResidentReachabilityContext:v190 workQueue:v21->_workQueue];
  reachabilityNotificationManager = v53->_reachabilityNotificationManager;
  v53->_reachabilityNotificationManager = v191;

  v193 = [[HMDAccessoryReachabilityChangedLogEventManager alloc] initWithHome:v53];
  reachabilityChangedLogEventManager = v53->_reachabilityChangedLogEventManager;
  v53->_reachabilityChangedLogEventManager = v193;

  v195 = [sourceCopy makeNaturalLightingCurveWriterWithHome:v53];
  naturalLightingCurveWriter = v53->_naturalLightingCurveWriter;
  v53->_naturalLightingCurveWriter = v195;

  v197 = [HMDHAPAccessoryConnectionCoordinator alloc];
  notificationCenter2 = [(HMDHome *)v53 notificationCenter];
  v199 = [(HMDHAPAccessoryConnectionCoordinator *)v197 initWithHome:v53 notificationCenter:notificationCenter2];
  accessoryConnectionCoordinator = v53->_accessoryConnectionCoordinator;
  v53->_accessoryConnectionCoordinator = v199;

  v201 = [[HMDHAPAccessoryReaderWriter alloc] initWithHome:v53];
  accessoryReaderWriter = v53->_accessoryReaderWriter;
  v53->_accessoryReaderWriter = v201;

  v203 = [[HMDHomePersonDataManager alloc] initWithHome:v53 workQueue:v21->_workQueue];
  personDataManager = v53->_personDataManager;
  v53->_personDataManager = v203;

  v205 = [[HMDHomeWalletKeyManager alloc] initWithUUID:v21->_uuid workQueue:v21->_workQueue];
  walletKeyManager = v53->_walletKeyManager;
  v53->_walletKeyManager = v205;

  v207 = objc_autoreleasePoolPush();
  v208 = v53;
  v209 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v209, OS_LOG_TYPE_DEFAULT))
  {
    v210 = HMFGetLogIdentifier();
    *buf = 138543362;
    v287 = v210;
    _os_log_impl(&dword_2531F8000, v209, OS_LOG_TYPE_DEFAULT, "%{public}@Created wallet key manager", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v207);
  v211 = [sourceCopy makeNFCReaderKeyManagerWithHomeUUID:v21->_uuid workQueue:v21->_workQueue];
  nfcReaderKeyManager = v208->_nfcReaderKeyManager;
  v208->_nfcReaderKeyManager = v211;

  v213 = objc_autoreleasePoolPush();
  v214 = v208;
  v215 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v215, OS_LOG_TYPE_DEFAULT))
  {
    v216 = HMFGetLogIdentifier();
    *buf = 138543362;
    v287 = v216;
    _os_log_impl(&dword_2531F8000, v215, OS_LOG_TYPE_DEFAULT, "%{public}@Created nfc reader key manager", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v213);
  v214->_shouldEncodeHasOnboardedForWalletKey = 1;
  v214->_shouldEncodeNFCReaderKey = 1;
  dictionary10 = [MEMORY[0x277CBEB38] dictionary];
  labelsByAccessCode = v214->_labelsByAccessCode;
  v214->_labelsByAccessCode = dictionary10;

  dictionary11 = [MEMORY[0x277CBEB38] dictionary];
  removedUserInfoByAccessCode = v214->_removedUserInfoByAccessCode;
  v214->_removedUserInfoByAccessCode = dictionary11;

  v221 = [HMDAccessCodeManagerContext alloc];
  workQueue = [(HMDHome *)v214 workQueue];
  v223 = [(HMDAccessCodeManagerContext *)v221 initWithHome:v214 workQueue:workQueue];

  v224 = [[HMDAccessCodeManager alloc] initWithContext:v223];
  accessCodeManager = v214->_accessCodeManager;
  v214->_accessCodeManager = v224;

  uuid = [(HMDHome *)v214 uuid];
  workQueue2 = [(HMDHome *)v214 workQueue];
  v228 = [sourceCopy makeLockNotificationManagerWithHomeUUID:uuid workQueue:workQueue2];
  lockNotificationManager = v214->_lockNotificationManager;
  v214->_lockNotificationManager = v228;

  v230 = [[HMDCameraAnalysisStatePublisher alloc] initWithHome:v214];
  analysisStatePublisher = v214->_analysisStatePublisher;
  v214->_analysisStatePublisher = v230;

  if ([(HMDHomeLocalDeviceCapabilitiesDataSource *)v21->_localCapabilitiesDataSource isResidentCapable])
  {
    v232 = [[HMDHomeRemoteEventAccessController alloc] initWithDataSource:v214];
    homeRemoteEventAccessController = v214->_homeRemoteEventAccessController;
    v214->_homeRemoteEventAccessController = v232;
  }

  v234 = objc_autoreleasePoolPush();
  v235 = v214;
  v236 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v236, OS_LOG_TYPE_DEFAULT))
  {
    v237 = HMFGetLogIdentifier();
    *buf = 138543362;
    v287 = v237;
    _os_log_impl(&dword_2531F8000, v236, OS_LOG_TYPE_DEFAULT, "%{public}@Creating setup metric dispatchers for media system and home theater", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v234);
  v238 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v235 logEventSubmitter:submitterCopy];
  v239 = v235[182];
  v235[182] = v238;

  v240 = [[HMDMediaGroupSetupMetricDispatcher alloc] initWithDataSource:v235 logEventSubmitter:submitterCopy];
  v241 = v235[183];
  v235[183] = v240;

  v242 = objc_alloc_init(HMDCHIPHomeStorage);
  v243 = v235[173];
  v235[173] = v242;

  if ([v235 isFeatureMatterLocalFabricConfigEnabled])
  {
    array19 = [MEMORY[0x277CBEB18] array];
    v245 = v235[130];
    v235[130] = array19;

    v246 = objc_alloc(MEMORY[0x277D17AE8]);
    workQueue3 = [v235 workQueue];
    v248 = [v246 initWithDelegate:v235 queue:workQueue3];
    v249 = v235[175];
    v235[175] = v248;

    [v235[175] setControllerEntityIdentifier:v21->_uuid];
    LODWORD(v246) = [ownerCopy isCurrentUser];
    accessControl = [v235[175] accessControl];
    [accessControl setCurrentUserPrivilege:v246];

    accessControl2 = [v235[175] accessControl];
    v252 = [accessControl2 currentUserPrivilege] == 0;

    if (v252)
    {
      objc_initWeak(buf, v235);
      v280[0] = MEMORY[0x277D85DD0];
      v280[1] = 3221225472;
      v280[2] = __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_670;
      v280[3] = &unk_279721F80;
      objc_copyWeak(&v281, buf);
      accessControl3 = [v235[175] accessControl];
      [accessControl3 setPrivilegeGetter:v280];

      objc_destroyWeak(&v281);
      objc_destroyWeak(buf);
    }
  }

  v235[187] = 0;
  v235[188] = 0;
  uUID2 = [MEMORY[0x277CCAD78] UUID];
  v255 = v235[178];
  v235[178] = uUID2;

  array20 = [MEMORY[0x277CBEB18] array];
  v257 = v235[179];
  v235[179] = array20;

  v258 = [sourceCopy makeSwiftExtensionsWithHome:v235];
  v259 = v235[96];
  v235[96] = v258;

  objc_destroyWeak(&v283);
  objc_destroyWeak(&location);

LABEL_47:
  v260 = *MEMORY[0x277D85DE8];
  return v21;
}

void __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v7 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (v7)
  {
    [WeakRetained _registerForReachabilityChangeNotificationsEnabled:objc_msgSend(v7 completionHandler:{"BOOLValue"), v5}];
  }
}

unint64_t __212__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource_logEventSubmitter_carPlayDataSource_administratorHandlerFactory_localCapabilitiesDataSource_notificationCenter_keychainStore___block_invoke_670(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained currentUser];
    v4 = +[HMDUser hmmtrUserPrivilegeFromHMDUserPrivilege:](HMDUser, "hmmtrUserPrivilegeFromHMDUserPrivilege:", [v3 privilege]);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (HMDHome)initWithName:(id)name uuid:(id)uuid defaultRoomUUID:(id)d owner:(id)owner homeManager:(id)manager presenceAuth:(id)auth dataSource:(id)source
{
  sourceCopy = source;
  authCopy = auth;
  managerCopy = manager;
  ownerCopy = owner;
  dCopy = d;
  uuidCopy = uuid;
  nameCopy = name;
  metricsManager = [managerCopy metricsManager];
  logEventSubmitter = [metricsManager logEventSubmitter];
  v25 = objc_alloc_init(HMDCarPlayDataSource);
  v24 = objc_alloc_init(HMDHomeLocalDeviceCapabilitiesDataSource);
  defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
  systemStore = [MEMORY[0x277CFEC78] systemStore];
  v28 = [(HMDHome *)self initWithName:nameCopy uuid:uuidCopy defaultRoomUUID:dCopy owner:ownerCopy homeManager:managerCopy presenceAuth:authCopy dataSource:sourceCopy logEventSubmitter:logEventSubmitter carPlayDataSource:v25 administratorHandlerFactory:&__block_literal_global_622 localCapabilitiesDataSource:v24 notificationCenter:defaultCenter keychainStore:systemStore];

  return v28;
}

HMDHomeAdministratorHandler *__87__HMDHome_initWithName_uuid_defaultRoomUUID_owner_homeManager_presenceAuth_dataSource___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [[HMDHomeAdministratorHandler alloc] initWithHome:v2];

  return v3;
}

uint64_t __58__HMDHome_filterAllowedToPostBulletinFromCharacteristics___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 service];
  v3 = [v2 accessory];
  v4 = [v3 home];
  v5 = [v4 shouldPostBulletin];

  return v5;
}

+ (id)logCategory
{
  if (logCategory__hmf_once_t1382 != -1)
  {
    dispatch_once(&logCategory__hmf_once_t1382, &__block_literal_global_1845);
  }

  v3 = logCategory__hmf_once_v1383;

  return v3;
}

uint64_t __22__HMDHome_logCategory__block_invoke()
{
  v0 = *MEMORY[0x277D0F1A8];
  logCategory__hmf_once_v1383 = HMFCreateOSLogHandle();

  return MEMORY[0x2821F96F8]();
}

+ (id)supportedAccessoryClasses
{
  if (supportedAccessoryClasses_onceToken != -1)
  {
    dispatch_once(&supportedAccessoryClasses_onceToken, &__block_literal_global_1756);
  }

  v3 = supportedAccessoryClasses_supportedAccessoryClasses;

  return v3;
}

void __36__HMDHome_supportedAccessoryClasses__block_invoke()
{
  v5[2] = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5[0] = objc_opt_class();
  v5[1] = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:v5 count:2];
  v2 = [v0 setWithArray:v1];
  v3 = supportedAccessoryClasses_supportedAccessoryClasses;
  supportedAccessoryClasses_supportedAccessoryClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteRead:(id)read
{
  v39 = *MEMORY[0x277D85DE8];
  listCopy = list;
  tuplesCopy = tuples;
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = read;
  v7 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v35;
    v29 = *MEMORY[0x277CCFD28];
    do
    {
      v10 = 0;
      v31 = v8;
      do
      {
        if (*v35 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v34 + 1) + 8 * v10);
        characteristic = [v11 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        v15 = accessory;
        if (characteristic)
        {
          v16 = service == 0;
        }

        else
        {
          v16 = 1;
        }

        if (v16 || accessory == 0)
        {
          uUIDString = [MEMORY[0x277CCA9B8] errorWithDomain:v29 code:4 userInfo:0];
          dictionary = [HMDCharacteristicResponse responseWithRequest:v11 error:uUIDString];
          [tuplesCopy addObject:dictionary];
        }

        else
        {
          uuid = [accessory uuid];
          uUIDString = [uuid UUIDString];

          v21 = [listCopy hmf_mutableDictionaryForKey:uUIDString];
          dictionary = v21;
          if (!v21)
          {
            dictionary = [MEMORY[0x277CBEB38] dictionary];
            [listCopy setObject:dictionary forKey:uUIDString];
          }

          instanceID = [service instanceID];
          stringValue = [instanceID stringValue];
          array = [dictionary hmf_mutableArrayForKey:stringValue];

          if (!array)
          {
            array = [MEMORY[0x277CBEB18] array];
            instanceID2 = [service instanceID];
            stringValue2 = [instanceID2 stringValue];
            [dictionary setObject:array forKey:stringValue2];
          }

          instanceID3 = [characteristic instanceID];
          [array addObject:instanceID3];

          v8 = v31;
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [obj countByEnumeratingWithState:&v34 objects:v38 count:16];
    }

    while (v8);
  }

  v28 = *MEMORY[0x277D85DE8];
}

+ (void)appendCharacteristicsToAccessoryList:(id)list responseTuples:(id)tuples forMultipleCharacteristicsRemoteWrite:(id)write message:(id)message
{
  v64 = *MEMORY[0x277D85DE8];
  listCopy = list;
  tuplesCopy = tuples;
  writeCopy = write;
  messageCopy = message;
  v59 = 0u;
  v60 = 0u;
  v61 = 0u;
  v62 = 0u;
  obj = writeCopy;
  v10 = [writeCopy countByEnumeratingWithState:&v59 objects:v63 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v60;
    v46 = *MEMORY[0x277CCFD28];
    v13 = *MEMORY[0x277CD2120];
    v44 = *MEMORY[0x277CD2120];
    v45 = *MEMORY[0x277CD2050];
    v52 = *MEMORY[0x277CD2678];
    v47 = *v60;
    do
    {
      v14 = 0;
      v50 = v11;
      do
      {
        if (*v60 != v12)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v59 + 1) + 8 * v14);
        characteristic = [v15 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        v19 = accessory;
        if (characteristic)
        {
          v20 = service == 0;
        }

        else
        {
          v20 = 1;
        }

        if (v20 || accessory == 0)
        {
          v22 = [MEMORY[0x277CCA9B8] errorWithDomain:v46 code:4 userInfo:0];
          v23 = [HMDCharacteristicResponse responseWithRequest:v15 error:v22];
          [tuplesCopy addObject:v23];
        }

        else
        {
          uuid = [accessory uuid];
          uUIDString = [uuid UUIDString];

          instanceID = [service instanceID];
          stringValue = [instanceID stringValue];

          instanceID2 = [characteristic instanceID];
          stringValue2 = [instanceID2 stringValue];

          v29 = [listCopy hmf_mutableDictionaryForKey:uUIDString];
          dictionary = v29;
          if (!v29)
          {
            dictionary = [MEMORY[0x277CBEB38] dictionary];
            [listCopy setObject:dictionary forKeyedSubscript:uUIDString];
          }

          v57 = uUIDString;
          dictionary2 = [dictionary hmf_mutableDictionaryForKey:stringValue];
          if (!dictionary2)
          {
            dictionary2 = [MEMORY[0x277CBEB38] dictionary];
            [dictionary setObject:dictionary2 forKeyedSubscript:stringValue];
          }

          v55 = dictionary;
          v56 = stringValue;
          authorizationData = [characteristic authorizationData];
          if (authorizationData)
          {
            v33 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", stringValue2, @"kAuthorizationDataKey"];
            [dictionary2 setObject:authorizationData forKeyedSubscript:v33];
          }

          v54 = authorizationData;
          home = [v19 home];
          currentUser = [home currentUser];
          notificationContextHAPIdentifier = [currentUser notificationContextHAPIdentifier];
          v37 = [characteristic contextDataForWriteRequestWithIdentifier:notificationContextHAPIdentifier];

          if (v37)
          {
            v38 = [MEMORY[0x277CCACA8] stringWithFormat:@"%@-%@", stringValue2, v44];
            [dictionary2 setObject:v37 forKeyedSubscript:v38];
          }

          v39 = [messageCopy uuidForKey:v45];
          v40 = [messageCopy BOOLForKey:v52];
          if (v39 || v40)
          {
            [listCopy setObject:MEMORY[0x277CBEC38] forKeyedSubscript:v52];
          }

          value = [v15 value];
          [dictionary2 setObject:value forKeyedSubscript:stringValue2];

          v42 = [MEMORY[0x277CCABB0] numberWithBool:{objc_msgSend(v15, "includeResponseValue")}];
          [dictionary2 setObject:v42 forKeyedSubscript:@"HMDCharacteristicWriteRequestIncludeResponseValueKey"];

          v12 = v47;
          v23 = v56;
          v22 = v57;
          v11 = v50;
        }

        ++v14;
      }

      while (v11 != v14);
      v11 = [obj countByEnumeratingWithState:&v59 objects:v63 count:16];
    }

    while (v11);
  }

  v43 = *MEMORY[0x277D85DE8];
}

+ (id)notificationPayloadForChangedCharacteristics:(id)characteristics destinationIsXPCTransport:(BOOL)transport
{
  transportCopy = transport;
  v84 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v5 = +[HMDHAPMetadata getSharedInstance];
  v73 = 0u;
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  obj = characteristicsCopy;
  v6 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v74;
    v56 = *MEMORY[0x277CD21B8];
    v53 = *MEMORY[0x277CD21E0];
    v51 = *MEMORY[0x277CD2150];
    v52 = *MEMORY[0x277CD21D0];
    v55 = *MEMORY[0x277CD2110];
    *&v7 = 138543618;
    v49 = v7;
    v67 = v5;
    v63 = *v74;
    do
    {
      v10 = 0;
      v65 = v8;
      do
      {
        if (*v74 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v73 + 1) + 8 * v10);
        characteristic = [v11 characteristic];
        service = [characteristic service];
        accessory = [service accessory];
        home = [accessory home];
        v16 = home;
        if (characteristic)
        {
          v17 = service == 0;
        }

        else
        {
          v17 = 1;
        }

        if (!v17 && accessory != 0 && home != 0)
        {
          updatedValue = [v11 updatedValue];
          v21 = updatedValue;
          if (updatedValue)
          {
            v22 = !transportCopy;
          }

          else
          {
            v22 = 1;
          }

          if (!v22)
          {
            v23 = updatedValue;
            objc_opt_class();
            isKindOfClass = objc_opt_isKindOfClass();

            if (isKindOfClass)
            {
              goto LABEL_44;
            }

LABEL_24:
            if (transportCopy)
            {
              type = [characteristic type];
              if ([v67 shouldFilterCharacteristicOfTypeFromApp:type])
              {

                goto LABEL_44;
              }

              type2 = [service type];
              v27 = [v67 shouldFilterServiceOfTypeFromApp:type2];

              if (v27)
              {
                goto LABEL_44;
              }
            }

            uuid = [accessory uuid];
            uUIDString = [uuid UUIDString];

            dictionary2 = [dictionary hmf_mutableDictionaryForKey:uUIDString];
            if (!dictionary2)
            {
              dictionary2 = [MEMORY[0x277CBEB38] dictionary];
              [dictionary setObject:dictionary2 forKey:uUIDString];
            }

            v62 = uUIDString;
            instanceID = [service instanceID];
            stringValue = [instanceID stringValue];
            v61 = dictionary2;
            v33 = [dictionary2 hmf_mutableDictionaryForKey:stringValue];

            dictionary3 = v33;
            if (!v33)
            {
              dictionary3 = [MEMORY[0x277CBEB38] dictionary];
              instanceID2 = [service instanceID];
              stringValue2 = [instanceID2 stringValue];
              [v61 setObject:dictionary3 forKey:stringValue2];
            }

            v81 = v56;
            v82 = v21;
            v37 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v82 forKeys:&v81 count:1];
            v38 = [v37 mutableCopy];

            v71 = 0;
            v72 = 0;
            v70 = 0;
            [characteristic getLastKnownValueUpdateTime:&v72 stateNumber:&v71 notificationContext:&v70];
            v39 = v72;
            v64 = v71;
            v68 = v70;
            if (v39)
            {
              [v38 setObject:v39 forKey:v53];
            }

            v60 = v39;
            if (v64)
            {
              [v38 setObject:v64 forKey:v52];
            }

            if (v68)
            {
              v58 = dictionary3;
              context = objc_autoreleasePoolPush();
              selfCopy = self;
              v41 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
              {
                v50 = HMFGetLogIdentifier();
                *buf = v49;
                v78 = v50;
                v79 = 2112;
                v80 = v68;
                _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_INFO, "%{public}@Setting notification context in notification payload to %@ ", buf, 0x16u);
              }

              objc_autoreleasePoolPop(context);
              [v38 setObject:v68 forKey:v51];
              dictionary3 = v58;
            }

            isBroadcast = [v11 isBroadcast];
            v43 = MEMORY[0x277CBEC38];
            if ((isBroadcast & 1) != 0 || (v44 = [accessory isBLELinkConnected], v43 = MEMORY[0x277CBEC28], v44))
            {
              [v38 setObject:v43 forKey:v55];
            }

            instanceID3 = [characteristic instanceID];
            stringValue3 = [instanceID3 stringValue];
            [dictionary3 setObject:v38 forKey:stringValue3];

            goto LABEL_44;
          }

          if (updatedValue)
          {
            goto LABEL_24;
          }

LABEL_44:

          v5 = v67;
          v9 = v63;
          v8 = v65;
        }

        ++v10;
      }

      while (v8 != v10);
      v8 = [obj countByEnumeratingWithState:&v73 objects:v83 count:16];
    }

    while (v8);
  }

  v47 = *MEMORY[0x277D85DE8];

  return dictionary;
}

+ (unint64_t)privilegeFromUserInviteInformation:(id)information
{
  if ([information isAdministrator])
  {
    return 4;
  }

  else
  {
    return 0;
  }
}

+ (id)filterUsersSupportingPresence:(id)presence
{
  v18 = *MEMORY[0x277D85DE8];
  presenceCopy = presence;
  v4 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(presenceCopy, "count")}];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = presenceCopy;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          [v4 addObject:{v10, v13}];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = *MEMORY[0x277D85DE8];

  return v4;
}

+ (id)shortDescription
{
  v2 = objc_opt_class();

  return NSStringFromClass(v2);
}

+ (id)zoneIDFromHomeUUID:(id)d
{
  v11 = *MEMORY[0x277D85DE8];
  v3 = MEMORY[0x277CCAD78];
  v10 = *MEMORY[0x277CD23C8];
  v4 = MEMORY[0x277CBEA60];
  dCopy = d;
  v6 = [v4 arrayWithObjects:&v10 count:1];
  v7 = [v3 hm_deriveUUIDFromBaseUUID:dCopy identifierSalt:0 withSalts:{v6, v10, v11}];

  v8 = *MEMORY[0x277D85DE8];

  return v7;
}

+ (BOOL)isObjectContainedInHome:(id)home
{
  v16 = *MEMORY[0x277D85DE8];
  homeCopy = home;
  +[HMDHome _initialize];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  v4 = allowedClasses;
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = *v12;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v11 + 1) + 8 * i);
        if (objc_opt_isKindOfClass())
        {
          LOBYTE(v5) = 1;
          goto LABEL_11;
        }
      }

      v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v9 = *MEMORY[0x277D85DE8];
  return v5;
}

+ (id)getBuiltinActionSets
{
  if (getBuiltinActionSets_onceToken != -1)
  {
    dispatch_once(&getBuiltinActionSets_onceToken, &__block_literal_global_616);
  }

  v3 = getBuiltinActionSets_builtinActionSets;

  return v3;
}

void __31__HMDHome_getBuiltinActionSets__block_invoke()
{
  v9[4] = *MEMORY[0x277D85DE8];
  v0 = *MEMORY[0x277CCF148];
  v1 = *MEMORY[0x277CCF198];
  v8[0] = *MEMORY[0x277CCF1B0];
  v8[1] = v1;
  v2 = *MEMORY[0x277CCF140];
  v9[0] = v0;
  v9[1] = v2;
  v3 = *MEMORY[0x277CCF188];
  v8[2] = *MEMORY[0x277CCF180];
  v8[3] = v3;
  v4 = *MEMORY[0x277CCF138];
  v9[2] = *MEMORY[0x277CCF130];
  v9[3] = v4;
  v5 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:v8 count:4];
  v6 = getBuiltinActionSets_builtinActionSets;
  getBuiltinActionSets_builtinActionSets = v5;

  v7 = *MEMORY[0x277D85DE8];
}

+ (void)_initialize
{
  if (_initialize_onceToken != -1)
  {
    dispatch_once(&_initialize_onceToken, &__block_literal_global_10958);
  }
}

void __22__HMDHome__initialize__block_invoke()
{
  v16 = *MEMORY[0x277D85DE8];
  v0 = MEMORY[0x277CBEB98];
  v5 = objc_opt_class();
  v6 = objc_opt_class();
  v7 = objc_opt_class();
  v8 = objc_opt_class();
  v9 = objc_opt_class();
  v10 = objc_opt_class();
  v11 = objc_opt_class();
  v12 = objc_opt_class();
  v13 = objc_opt_class();
  v14 = objc_opt_class();
  v15 = objc_opt_class();
  v1 = [MEMORY[0x277CBEA60] arrayWithObjects:&v5 count:11];
  v2 = [v0 setWithArray:{v1, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14}];
  v3 = allowedClasses;
  allowedClasses = v2;

  v4 = *MEMORY[0x277D85DE8];
}

- (void)_notifyThreadLayerOfResidentChange
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  home = [(HMDHome *)self home];
  if (home)
  {
    v12 = home;
    if ([home isCurrentDeviceAvailableResident])
    {
      v5 = +[HMDThreadResidentCommissioner sharedCommissioner];
      primaryResident = [v12 primaryResident];
      isCurrentDevice = [primaryResident isCurrentDevice];
      primaryResident2 = [v12 primaryResident];
      capabilities = [primaryResident2 capabilities];
      [v5 informThreadLayerOfResidentChange:isCurrentDevice primaryResidentIsThreadCapable:{objc_msgSend(capabilities, "supportsThreadBorderRouter")}];

      if ([(HMDHome *)self isCurrentDeviceConfirmedPrimaryResident])
      {
        threadOperationalDataset = [(HMDHome *)self threadOperationalDataset];

        if (threadOperationalDataset)
        {
          threadOperationalDataset2 = [(HMDHome *)self threadOperationalDataset];
          [(HMDHome *)self saveAndSyncWithThreadOperationalDataset:threadOperationalDataset2 forceUpdate:1];
        }
      }
    }
  }

  MEMORY[0x2821F96F8]();
}

- (void)_updateThreadNetworkWithModel:(id)model message:(id)message
{
  v32 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  setProperties = [modelCopy setProperties];
  v9 = [setProperties containsObject:@"threadNetworkID"];

  if (!v9)
  {
LABEL_13:
    [messageCopy respondWithPayload:0];
    goto LABEL_14;
  }

  unfilteredThreadNetworkID = [(HMDHome *)self unfilteredThreadNetworkID];
  threadNetworkID = [modelCopy threadNetworkID];
  threadNetworkID2 = [(HMDHome *)self threadNetworkID];

  if (!threadNetworkID2)
  {
    transactionResult = [messageCopy transactionResult];
    source = [transactionResult source];

    if (source == 2 && threadNetworkID && [(HMDHome *)self attemptToUpdateThreadNetworkID:threadNetworkID])
    {
      v20 = objc_autoreleasePoolPush();
      selfCopy = self;
      v22 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
      {
        v23 = HMFGetLogIdentifier();
        v26 = 138543874;
        v27 = v23;
        v28 = 2112;
        v29 = unfilteredThreadNetworkID;
        v30 = 2112;
        v31 = threadNetworkID;
        _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@threadNetworkID updated from cloud: %@ -> %@", &v26, 0x20u);
      }

      objc_autoreleasePoolPop(v20);
      [(HMDHome *)selfCopy startThreadNetwork:0];
    }

    transactionResult2 = [messageCopy transactionResult];
    [transactionResult2 markChanged];

    goto LABEL_13;
  }

  v13 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v15 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
  {
    v16 = HMFGetLogIdentifier();
    v26 = 138543874;
    v27 = v16;
    v28 = 2112;
    v29 = unfilteredThreadNetworkID;
    v30 = 2112;
    v31 = threadNetworkID;
    _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_DEFAULT, "%{public}@Ignoring threadNetworkID update from cloud: %@ -> %@", &v26, 0x20u);
  }

  objc_autoreleasePoolPop(v13);
  transactionResult3 = [messageCopy transactionResult];
  [transactionResult3 markChanged];

  [messageCopy respondWithPayload:0];
LABEL_14:

  v25 = *MEMORY[0x277D85DE8];
}

- (void)saveAndSyncWithThreadOperationalDataset:(id)dataset forceUpdate:(BOOL)update
{
  v37 = *MEMORY[0x277D85DE8];
  datasetCopy = dataset;
  home = [(HMDHome *)self home];
  v8 = home;
  if (datasetCopy)
  {
    residentDeviceManager = [home residentDeviceManager];
    residentDevices = [residentDeviceManager residentDevices];
    if ([residentDevices count] && !-[HMDHome isCurrentDeviceConfirmedPrimaryResident](self, "isCurrentDeviceConfirmedPrimaryResident"))
    {
      v26 = objc_autoreleasePoolPush();
      selfCopy = self;
      v28 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        v29 = HMFGetLogIdentifier();
        *buf = 138543618;
        v34 = v29;
        v35 = 2112;
        v36 = v8;
        _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_INFO, "%{public}@There are residents for home: %@, but we are not the primary. Updated locally but not syncing ThreadOperationalDataset.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v26);
      [(HMDHome *)selfCopy setThreadOperationalDataset:datasetCopy];
      goto LABEL_19;
    }

    threadOperationalDataset = [(HMDHome *)self threadOperationalDataset];
    v12 = HMFEqualObjects();

    if (v12)
    {
      v13 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v15 = HMFGetOSLogHandle();
      v16 = os_log_type_enabled(v15, OS_LOG_TYPE_INFO);
      if (!update)
      {
        if (v16)
        {
          v30 = HMFGetLogIdentifier();
          *buf = 138543362;
          v34 = v30;
          _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, ignoring request to save and sync", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v13);
        goto LABEL_19;
      }

      if (v16)
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543362;
        v34 = v17;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Thread operational dataset has not changed, but pushing out update because forceUpdate is true", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v13);
    }

    v18 = [(HMDHome *)self emptyModelObjectWithChangeType:2];
    [v18 setThreadOperationalDataset:datasetCopy];
    [(HMDHome *)self setThreadOperationalDataset:datasetCopy];
    backingStore = [(HMDHome *)self backingStore];
    v20 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v21 = [backingStore transaction:@"Update thread operational dataset" options:v20];

    [v21 add:v18];
    v32[0] = MEMORY[0x277D85DD0];
    v32[1] = 3221225472;
    v32[2] = __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke;
    v32[3] = &unk_2797359D8;
    v32[4] = self;
    [v21 run:v32];
    [(HMDHome *)self setThreadOperationalDataset:datasetCopy];

LABEL_19:
    goto LABEL_20;
  }

  v22 = objc_autoreleasePoolPush();
  selfCopy3 = self;
  v24 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
  {
    v25 = HMFGetLogIdentifier();
    *buf = 138543618;
    v34 = v25;
    v35 = 2112;
    v36 = v8;
    _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@threadOperationalDataset is null for home %@, not saving...", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v22);
LABEL_20:

  v31 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning__saveAndSyncWithThreadOperationalDataset_forceUpdate___block_invoke(uint64_t a1, void *a2)
{
  v16 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v12 = 138543618;
      v13 = v8;
      v14 = 2112;
      v15 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to sync thread operational dataset, error: %@", &v12, 0x16u);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadOperationalDataset];
    v12 = 138543618;
    v13 = v9;
    v14 = 2048;
    v15 = [v10 length];
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Successfully sync'ed thread operational dataset, Length: %lu", &v12, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v11 = *MEMORY[0x277D85DE8];
}

- (void)updateThreadOperationalDatasetWithHomeModel:(id)model message:(id)message
{
  v19 = *MEMORY[0x277D85DE8];
  modelCopy = model;
  messageCopy = message;
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    threadOperationalDataset = [modelCopy threadOperationalDataset];
    [(HMDHome *)self setThreadOperationalDataset:threadOperationalDataset];

    v9 = objc_autoreleasePoolPush();
    selfCopy = self;
    v11 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      threadOperationalDataset2 = [(HMDHome *)selfCopy threadOperationalDataset];
      v15 = 138543618;
      v16 = v12;
      v17 = 2048;
      v18 = [threadOperationalDataset2 length];
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Updated thread operational dataset, Length: %lu", &v15, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)stopThreadAccessoryFirmwareUpdateWithCompletion:(id)completion
{
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __88__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryFirmwareUpdateWithCompletion___block_invoke;
    v7[3] = &unk_279735558;
    v8 = completionCopy;
    [v6 stopThreadAccessoryFirmwareUpdateWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(completionCopy + 2))(completionCopy, v6);
  }
}

- (void)stopThreadAccessoryPairingWithCompletion:(id)completion
{
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 supportsThreadService], v4, (v5 & 1) != 0))
  {
    v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v7[0] = MEMORY[0x277D85DD0];
    v7[1] = 3221225472;
    v7[2] = __81__HMDHome_ThreadResidentCommissioning__stopThreadAccessoryPairingWithCompletion___block_invoke;
    v7[3] = &unk_279735558;
    v8 = completionCopy;
    [v6 stopThreadAccessoryPairingWithCompletion:v7];
  }

  else
  {
    v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(completionCopy + 2))(completionCopy, v6);
  }
}

- (void)onThreadNetworkCallStateChange:(BOOL)change
{
  v11 = *MEMORY[0x277D85DE8];
  if (!change && [(HMDHome *)self threadNetworkShouldRestartOnNetworkChange])
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Restarting thread network after call end", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [(HMDHome *)selfCopy startThreadNetwork:1];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkPeripheralDeviceNodeTypeChange:(id)change
{
  v3 = MEMORY[0x277CCAB98];
  changeCopy = change;
  defaultCenter = [v3 defaultCenter];
  [defaultCenter postNotificationName:@"HMDHomeThreadNetworkPeripheralDeviceNodeTypeChangedNotification" object:changeCopy];
}

- (void)onThreadNetworkWakeOnDeviceConnectionStateChange:(id)change
{
  v3 = MEMORY[0x277CCAB98];
  changeCopy = change;
  defaultCenter = [v3 defaultCenter];
  [defaultCenter postNotificationName:@"HMDHomeThreadNetworkWakeOnConnectionStateChangeNotification" object:changeCopy];
}

- (void)onThreadNetworkNodeTypeStateChange:(int64_t)change
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkNodeType]!= change)
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      changeCopy = change;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network node type changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setThreadNetworkNodeType:change];
    defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter postNotificationName:@"HMDHomeThreadNetworkNodeTypeChangeNotification" object:selfCopy];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)onThreadNetworkConnectionStateChange:(int64_t)change
{
  v15 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self threadNetworkConnectionState]!= change)
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2048;
      changeCopy = change;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread network connection state changed to %ld", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setThreadNetworkConnectionState:change];
    defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter postNotificationName:@"HMDHomeThreadNetworkConnectionStateChangeNotification" object:selfCopy];
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)connectToThreadAccessoryWithExtendedMACAddress:(id)address completion:(id)completion
{
  addressCopy = address;
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v7 = objc_claimAutoreleasedReturnValue(), v8 = [v7 supportsThreadService], v7, (v8 & 1) != 0))
  {
    v9 = +[HMDThreadResidentCommissioner sharedCommissioner];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __98__HMDHome_ThreadResidentCommissioning__connectToThreadAccessoryWithExtendedMACAddress_completion___block_invoke;
    v10[3] = &unk_279735558;
    v11 = completionCopy;
    [v9 connectToThreadAccessoryWithExtendedMACAddress:addressCopy completion:v10];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    (*(completionCopy + 2))(completionCopy, v9);
  }
}

- (void)_unjoinThreadNetworkWithCompletion:(id)completion
{
  v19 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    threadNetworkID = [(HMDHome *)selfCopy threadNetworkID];
    *buf = 138543618;
    v16 = v9;
    v17 = 2112;
    v18 = threadNetworkID;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Request to unjoin previous thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  [(HMDHome *)selfCopy setThreadNetworkID:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"];
  v13[0] = MEMORY[0x277D85DD0];
  v13[1] = 3221225472;
  v13[2] = __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke;
  v13[3] = &unk_279733F30;
  v13[4] = selfCopy;
  v14 = completionCopy;
  v11 = completionCopy;
  [(HMDHome *)selfCopy _stopThreadNetworkWithCompletion:v13];

  v12 = *MEMORY[0x277D85DE8];
}

void __75__HMDHome_ThreadResidentCommissioning___unjoinThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v16 = 138543618;
      v17 = v8;
      v18 = 2112;
      v19 = v3;
      v9 = "%{public}@Failed to leave previous thread network: %@";
      v10 = v7;
      v11 = OS_LOG_TYPE_ERROR;
      v12 = 22;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v10, v11, v9, &v16, v12);
    }
  }

  else if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
  {
    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully left previous thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v4);
  (*(*(a1 + 40) + 16))(*(a1 + 40), v3, v13, v14);

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_stopThreadNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self setThreadNetworkShouldRestartOnNetworkChange:0];
  [(HMDHome *)self _incrementCurrentSequenceNumber];
  [(HMDHome *)self _unregisterForThreadNetworkEvents];
  v6 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __73__HMDHome_ThreadResidentCommissioning___stopThreadNetworkWithCompletion___block_invoke;
  v8[3] = &unk_279735558;
  v9 = completionCopy;
  v7 = completionCopy;
  [v6 stopThreadNetworkWithCompletion:v8];
}

- (void)stopThreadNetworkWithCompletion:(BOOL)completion completion:(id)a4
{
  v5 = a4;
  workQueue = [(HMDHome *)self workQueue];
  v8[0] = MEMORY[0x277D85DD0];
  v8[1] = 3221225472;
  v8[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke;
  v8[3] = &unk_279735738;
  v8[4] = self;
  v9 = v5;
  v7 = v5;
  dispatch_async(workQueue, v8);
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x277D85DE8];
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = objc_autoreleasePoolPush();
  v3 = *(a1 + 32);
  v4 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = HMFGetLogIdentifier();
    v6 = [*(a1 + 32) threadNetworkID];
    *buf = 138543618;
    v12 = v5;
    v13 = 2112;
    v14 = v6;
    _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Stop thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v2);
  v7 = *(a1 + 32);
  v9[0] = MEMORY[0x277D85DD0];
  v9[1] = 3221225472;
  v9[2] = __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61;
  v9[3] = &unk_279733F30;
  v9[4] = v7;
  v10 = *(a1 + 40);
  [v7 _stopThreadNetworkWithCompletion:v9];

  v8 = *MEMORY[0x277D85DE8];
}

void __83__HMDHome_ThreadResidentCommissioning__stopThreadNetworkWithCompletion_completion___block_invoke_61(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543618;
    v17 = v8;
    v18 = 2112;
    v19 = v3;
    v9 = "%{public}@Failed to stop thread network: %@";
    v10 = v7;
    v11 = OS_LOG_TYPE_ERROR;
    v12 = 22;
  }

  else
  {
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      goto LABEL_7;
    }

    v8 = HMFGetLogIdentifier();
    v16 = 138543362;
    v17 = v8;
    v9 = "%{public}@Successfully stopped thread network";
    v10 = v7;
    v11 = OS_LOG_TYPE_DEFAULT;
    v12 = 12;
  }

  _os_log_impl(&dword_2531F8000, v10, v11, v9, &v16, v12);

LABEL_7:
  objc_autoreleasePoolPop(v4);
  v13 = _Block_copy(*(a1 + 40));
  v14 = v13;
  if (v13)
  {
    (*(v13 + 2))(v13);
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  [(HMDHome *)self _startThreadNetworkOnControllerWithCompletion:completionCopy];
}

- (void)_startThreadNetworkOnResidentWithCompletion:(id)completion
{
  v14 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v10 = 138543618;
    v11 = v8;
    v12 = 2112;
    v13 = selfCopy;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@ using ThreadUUID", &v10, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  [(HMDHome *)selfCopy setStartThreadNetworkInProgress:1];
  [(HMDHome *)selfCopy _startThreadNetworkOnCommissionerWithCompletion:completionCopy];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnControllerWithCompletion:(id)completion
{
  v15 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v5 = objc_autoreleasePoolPush();
    selfCopy = self;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      v11 = 138543618;
      v12 = v8;
      v13 = 2112;
      v14 = selfCopy;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Thread start starting for home %@", &v11, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy setStartThreadNetworkInProgress:1];
    [(HMDHome *)selfCopy setThreadNetworkShouldRestartOnNetworkChange:1];
    [(HMDHome *)selfCopy _fetchThreadCredentialsAndStartThreadNetworkWithCompletion:completionCopy];
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
    completionCopy[2](completionCopy, v9);
  }

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_fetchThreadCredentialsAndStartThreadNetworkWithCompletion:(id)completion
{
  completionCopy = completion;
  v20[0] = 0;
  v20[1] = v20;
  v20[2] = 0x2020000000;
  v21 = 0;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke;
  aBlock[3] = &unk_279731E18;
  objc_copyWeak(&v18, &location);
  v17 = v20;
  v5 = completionCopy;
  v16 = v5;
  v6 = _Block_copy(aBlock);
  if (![(HMDHome *)self _overrideStartThreadTimeout])
  {
    v7 = dispatch_time(0, 20000000000);
    workQueue = [(HMDHome *)self workQueue];
    block[0] = MEMORY[0x277D85DD0];
    block[1] = 3221225472;
    block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2;
    block[3] = &unk_2797348C0;
    v14 = v6;
    dispatch_after(v7, workQueue, block);
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3;
  v10[3] = &unk_279734508;
  objc_copyWeak(&v12, &location);
  v9 = v6;
  v11 = v9;
  [(HMDHome *)self _retrievePreferredNetworkWithCompletion:v10];

  objc_destroyWeak(&v12);
  objc_destroyWeak(&v18);
  objc_destroyWeak(&location);
  _Block_object_dispose(v20, 8);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v42 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  if (v3)
  {
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
      v5 = objc_autoreleasePoolPush();
      v6 = WeakRetained;
      v7 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = HMFGetLogIdentifier();
        *buf = 138543874;
        v37 = v8;
        v38 = 2112;
        v39 = v6;
        v40 = 2112;
        v41 = v3;
        _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Error starting thread for home %@, resetting state: %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v5);
      if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
      {
        v9 = objc_autoreleasePoolPush();
        v10 = v6;
        v11 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          v12 = HMFGetLogIdentifier();
          *buf = 138543874;
          v37 = v12;
          v38 = 2112;
          v39 = v10;
          v40 = 2112;
          v41 = v3;
          _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v9);
        [v10 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v13 = [v10 workQueue];
        block[0] = MEMORY[0x277D85DD0];
        block[1] = 3221225472;
        block[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_59;
        block[3] = &unk_279735738;
        v31 = *(a1 + 32);
        v30 = v3;
        dispatch_async(v13, block);

        v14 = v31;
LABEL_18:
      }
    }
  }

  else
  {
    if (!*(*(*(a1 + 40) + 8) + 24))
    {
      goto LABEL_13;
    }

    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      *buf = 138543618;
      v37 = v18;
      v38 = 2112;
      v39 = v16;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@Starting thread took longer than expected for home %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    if ((*(*(*(a1 + 40) + 8) + 24) & 1) == 0)
    {
LABEL_13:
      v19 = [WeakRetained threadOperationalDataset];

      if (v19)
      {
        v20 = [WeakRetained threadOperationalDataset];
        v34[0] = MEMORY[0x277D85DD0];
        v34[1] = 3221225472;
        v34[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56;
        v34[3] = &unk_27972D6C8;
        v34[4] = WeakRetained;
        v28 = *(a1 + 32);
        v21 = v28;
        v35 = v28;
        [WeakRetained _startThreadNetworkOnCommissionerWithOperationalDataset:v20 completion:v34];

        v14 = v35;
      }

      else
      {
        v22 = objc_autoreleasePoolPush();
        v23 = WeakRetained;
        v24 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          v25 = HMFGetLogIdentifier();
          *buf = 138543618;
          v37 = v25;
          v38 = 2112;
          v39 = v23;
          _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Thread operational dataset not available. Cancelling thread start for home %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v22);
        [v23 setStartThreadNetworkInProgress:0];
        *(*(*(a1 + 40) + 8) + 24) = 1;
        v26 = [v23 workQueue];
        v32[0] = MEMORY[0x277D85DD0];
        v32[1] = 3221225472;
        v32[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58;
        v32[3] = &unk_2797348C0;
        v33 = *(a1 + 32);
        dispatch_async(v26, v32);

        v14 = v33;
      }

      goto LABEL_18;
    }
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_2(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:8];
  (*(v1 + 16))(v1, v2);
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_3(uint64_t a1, void *a2)
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v5 = WeakRetained;
  if (v3 || !WeakRetained)
  {
    v6 = objc_autoreleasePoolPush();
    v7 = v5;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = HMFGetLogIdentifier();
      *buf = 138543618;
      v29 = v9;
      v30 = 2112;
      v31 = v3;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve preferred thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
    v10 = [v7 threadOperationalDataset];

    if (!v10)
    {
      v24 = *(a1 + 32);
      v25 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
      (*(v24 + 16))(v24, v25);

      goto LABEL_12;
    }

    v11 = objc_autoreleasePoolPush();
    v12 = v7;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v15 = [v12 threadOperationalDataset];
      v16 = [v12 threadNetworkID];
      v17 = [v12 home];
      *buf = 138544130;
      v29 = v14;
      v30 = 2112;
      v31 = v15;
      v32 = 2112;
      v33 = v16;
      v34 = 2112;
      v35 = v17;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Using cached threadOperationalDataset %@ and uuid %@ from home %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v11);
  }

  v18 = objc_autoreleasePoolPush();
  v19 = v5;
  v20 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
  {
    v21 = HMFGetLogIdentifier();
    *buf = 138543618;
    v29 = v21;
    v30 = 2112;
    v31 = v19;
    _os_log_impl(&dword_2531F8000, v20, OS_LOG_TYPE_INFO, "%{public}@Successfully fetched preferred network, scheduling startThread for home %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v18);
  v22 = [v19 workQueue];
  v26[0] = MEMORY[0x277D85DD0];
  v26[1] = 3221225472;
  v26[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60;
  v26[3] = &unk_279735738;
  v26[4] = v19;
  v27 = *(a1 + 32);
  dispatch_async(v22, v26);

LABEL_12:
  v23 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_60(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  if ([*(a1 + 32) startThreadNetworkInProgress])
  {
    v2 = *(*(a1 + 40) + 16);
    v3 = *MEMORY[0x277D85DE8];

    v2();
  }

  else
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v8 = *(a1 + 32);
      v12 = 138543618;
      v13 = v7;
      v14 = 2112;
      v15 = v8;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Thread network stop was requested by the time preferred network was fetched to start Thread for home %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v9 = *(a1 + 40);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:23];
    (*(v9 + 16))(v9, v10);

    v11 = *MEMORY[0x277D85DE8];
  }
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_56(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      *buf = 138543618;
      v21 = v7;
      v22 = 2112;
      v23 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Unable to start thread with operational dataset: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 32);
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v12 = *(a1 + 32);
    *buf = 138543874;
    v21 = v11;
    v22 = 2112;
    v23 = v12;
    v24 = 2112;
    v25 = v3;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Thread start completed for home %@, error = %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  *(*(*(a1 + 48) + 8) + 24) = 1;
  v13 = [*(a1 + 32) workQueue];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_57;
  v17[3] = &unk_279735738;
  v14 = *(a1 + 40);
  v18 = v3;
  v19 = v14;
  v15 = v3;
  dispatch_async(v13, v17);

  v16 = *MEMORY[0x277D85DE8];
}

void __99__HMDHome_ThreadResidentCommissioning___fetchThreadCredentialsAndStartThreadNetworkWithCompletion___block_invoke_58(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = [MEMORY[0x277CCA9B8] hmErrorWithCode:48];
  (*(v1 + 16))(v1, v2);
}

- (void)_retrievePreferredNetworkOnControllerWithCompletion:(id)completion
{
  v32 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v27 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = +[HMDThreadNetworkMetadataStore defaultStore];
  if (v9)
  {
    if ([(HMDHome *)selfCopy isOwnerUser])
    {
      objc_initWeak(buf, selfCopy);
      threadOperationalDataset = [(HMDHome *)selfCopy threadOperationalDataset];
      v23[0] = MEMORY[0x277D85DD0];
      v23[1] = 3221225472;
      v23[2] = __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke;
      v23[3] = &unk_27972A918;
      objc_copyWeak(&v25, buf);
      v24 = completionCopy;
      [v9 retrievePreferredNetwork:threadOperationalDataset completion:v23];

      objc_destroyWeak(&v25);
      objc_destroyWeak(buf);
    }

    else
    {
      v16 = objc_autoreleasePoolPush();
      v17 = selfCopy;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        threadOperationalDataset2 = [(HMDHome *)v17 threadOperationalDataset];
        home = [(HMDHome *)v17 home];
        *buf = 138543874;
        v27 = v19;
        v28 = 2112;
        v29 = threadOperationalDataset2;
        v30 = 2112;
        v31 = home;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Shared user -  always use cached threadOperationalDataset %@ for home %@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v16);
      (*(completionCopy + 2))(completionCopy, 0);
    }
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    v12 = selfCopy;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543362;
      v27 = v14;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v11);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:58];
    (*(completionCopy + 2))(completionCopy, v15);
  }

  v22 = *MEMORY[0x277D85DE8];
}

void __92__HMDHome_ThreadResidentCommissioning___retrievePreferredNetworkOnControllerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4, void *a5)
{
  v40 = *MEMORY[0x277D85DE8];
  v9 = a2;
  v10 = a3;
  v11 = a4;
  v12 = a5;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v14 = objc_autoreleasePoolPush();
  v15 = WeakRetained;
  if (!v12 && v9 && WeakRetained)
  {
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = HMFGetLogIdentifier();
      *buf = 138544130;
      v33 = v17;
      v34 = 2112;
      v35 = v9;
      v36 = 2112;
      v37 = v10;
      v38 = 2112;
      v39 = v11;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved preferred thread credentials %@ with UUID %@ and operationalDataset %@ from network metadata store", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v14);
    if (v11)
    {
      v18 = [v11 copy];
      [v15 saveAndSyncWithThreadOperationalDataset:v18];

      v19 = objc_autoreleasePoolPush();
      v20 = v15;
      v21 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        HMFGetLogIdentifier();
        v22 = v30 = v9;
        [v20 threadOperationalDataset];
        v23 = v29 = v10;
        [v20 home];
        v24 = v31 = v19;
        *buf = 138543874;
        v33 = v22;
        v34 = 2112;
        v35 = v23;
        v36 = 2112;
        v37 = v24;
        _os_log_impl(&dword_2531F8000, v21, OS_LOG_TYPE_INFO, "%{public}@threadOperationalDataset set to %@ for home %@", buf, 0x20u);

        v19 = v31;
        v10 = v29;

        v9 = v30;
      }

      objc_autoreleasePoolPop(v19);
    }

    if (v10)
    {
      v25 = [v10 copy];
      [v15 setThreadNetworkID:v25];
    }
  }

  else
  {
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v27;
      v34 = 2112;
      v35 = v12;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v14);
  }

  (*(*(a1 + 32) + 16))();

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_startThreadNetworkOnCommissionerWithOperationalDataset:(id)dataset completion:(id)completion
{
  datasetCopy = dataset;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke;
  aBlock[3] = &unk_27972F8D8;
  aBlock[4] = self;
  v9 = datasetCopy;
  v19 = v9;
  v10 = completionCopy;
  v20 = v10;
  v11 = _Block_copy(aBlock);
  homeManager = [(HMDHome *)self homeManager];
  chipDataSource = [homeManager chipDataSource];

  if (chipDataSource)
  {
    home = [(HMDHome *)self home];
    v16[0] = MEMORY[0x277D85DD0];
    v16[1] = 3221225472;
    v16[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_53;
    v16[3] = &unk_279732788;
    v17 = v11;
    [chipDataSource hasValidGeoOrPreferredNetworkForHome:home completion:v16];

    v15 = v17;
  }

  else
  {
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
    (*(v11 + 2))(v11, 0, v15);
  }
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a3;
  v6 = objc_autoreleasePoolPush();
  v7 = *(a1 + 32);
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = HMFGetLogIdentifier();
    v10 = [*(a1 + 32) threadNetworkID];
    v11 = *(a1 + 40);
    v12 = HMFBooleanToString();
    *buf = 138544386;
    v22 = v9;
    v23 = 2112;
    v24 = v10;
    v25 = 2112;
    v26 = v11;
    v27 = 2112;
    v28 = v12;
    v29 = 2112;
    v30 = v5;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Start thread network with uuid: %@, credentials: %@, geoAvailable: %@, error %@", buf, 0x34u);
  }

  objc_autoreleasePoolPop(v6);
  v13 = +[HMDThreadResidentCommissioner sharedCommissioner];
  [v13 setGeoAvailable:a2];
  v14 = *(a1 + 40);
  v15 = [*(a1 + 32) isOwnerUser];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50;
  v18[3] = &unk_279735168;
  v16 = *(a1 + 40);
  v18[4] = *(a1 + 32);
  v19 = v16;
  v20 = *(a1 + 48);
  [v13 startThreadNetworkWithOperationalDataset:v14 threadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F" isOwnerUser:v15 completion:v18];

  v17 = *MEMORY[0x277D85DE8];
}

void __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_50(uint64_t a1, void *a2)
{
  v26 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v8 = [*(a1 + 32) threadNetworkID];
      v9 = *(a1 + 40);
      *buf = 138544130;
      v19 = v7;
      v20 = 2112;
      v21 = v8;
      v22 = 2112;
      v23 = v9;
      v24 = 2112;
      v25 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@ with operational data set%@: %@", buf, 0x2Au);
    }

    objc_autoreleasePoolPop(v4);
  }

  v10 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51;
  block[3] = &unk_2797355D0;
  v11 = *(a1 + 32);
  v15 = v3;
  v16 = v11;
  v17 = *(a1 + 48);
  v12 = v3;
  dispatch_async(v10, block);

  v13 = *MEMORY[0x277D85DE8];
}

uint64_t __107__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithOperationalDataset_completion___block_invoke_51(uint64_t a1)
{
  v11 = *MEMORY[0x277D85DE8];
  if (!*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v5;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Attached to thread network using operational dataset", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:@"770E5B2E-0A0D-0A0D-0A0D-EE86505EFF8F"];
  }

  [*(a1 + 40) _registerForThreadNetworkEvents];
  [*(a1 + 40) setStartThreadNetworkInProgress:0];
  [*(a1 + 40) _scheduleThreadNetworkUpdate];
  v6 = *(a1 + 32);
  result = (*(*(a1 + 48) + 16))();
  v8 = *MEMORY[0x277D85DE8];
  return result;
}

- (void)_startThreadNetworkOnCommissionerWithCompletion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v18 = 0;
  v19 = &v18;
  v20 = 0x3032000000;
  v21 = __Block_byref_object_copy__14888;
  v22 = __Block_byref_object_dispose__14889;
  threadNetworkID = [(HMDHome *)self threadNetworkID];
  v6 = objc_autoreleasePoolPush();
  selfCopy = self;
  v8 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = HMFGetLogIdentifier();
    v10 = v19[5];
    *buf = 138543618;
    v25 = v9;
    v26 = 2112;
    v27 = v10;
    _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_DEFAULT, "%{public}@Start thread network: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v6);
  v11 = +[HMDThreadResidentCommissioner sharedCommissioner];
  v12 = v19[5];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke;
  v15[3] = &unk_279723440;
  v15[4] = selfCopy;
  v13 = completionCopy;
  v16 = v13;
  v17 = &v18;
  [v11 startThreadNetworkWithID:v12 completion:v15];

  _Block_object_dispose(&v18, 8);
  v14 = *MEMORY[0x277D85DE8];
}

void __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v38 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = *(*(*(a1 + 48) + 8) + 40);
    if (v7 && ![v7 isEqualToString:v5])
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      v24 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138543874;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v36 = 2112;
      v37 = v24;
      v12 = "%{public}@Attached to thread network %@, but expected to attach to %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_ERROR;
      v15 = 32;
    }

    else
    {
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (!os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_12;
      }

      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v33 = v11;
      v34 = 2112;
      v35 = v5;
      v12 = "%{public}@Attached to thread network %@";
      v13 = v10;
      v14 = OS_LOG_TYPE_DEFAULT;
      v15 = 22;
    }

    _os_log_impl(&dword_2531F8000, v13, v14, v12, buf, v15);

LABEL_12:
    objc_autoreleasePoolPop(v8);
    if (!*(*(*(a1 + 48) + 8) + 40) || ([v5 isEqualToString:?] & 1) == 0)
    {
      [*(a1 + 32) setThreadNetworkID:v5];
    }

    v23 = [*(a1 + 32) workQueue];
    v27[0] = MEMORY[0x277D85DD0];
    v27[1] = 3221225472;
    v27[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48;
    v27[3] = &unk_279735738;
    v25 = *(a1 + 40);
    v27[4] = *(a1 + 32);
    v22 = &v28;
    v28 = v25;
    dispatch_async(v23, v27);
    goto LABEL_16;
  }

  v16 = objc_autoreleasePoolPush();
  v17 = *(a1 + 32);
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    v19 = HMFGetLogIdentifier();
    *buf = 138543874;
    v33 = v19;
    v34 = 2112;
    v35 = 0;
    v36 = 2112;
    v37 = v6;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Failed to attach to thread network %@: %@", buf, 0x20u);
  }

  objc_autoreleasePoolPop(v16);
  v20 = [*(a1 + 32) workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47;
  block[3] = &unk_2797355D0;
  v21 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v22 = &v31;
  v31 = v21;
  v30 = v6;
  dispatch_async(v20, block);

  v23 = v30;
LABEL_16:

  v26 = *MEMORY[0x277D85DE8];
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_47(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  v2 = *(a1 + 40);
  v3 = *(*(a1 + 48) + 16);

  return v3();
}

uint64_t __88__HMDHome_ThreadResidentCommissioning___startThreadNetworkOnCommissionerWithCompletion___block_invoke_48(uint64_t a1)
{
  [*(a1 + 32) setStartThreadNetworkInProgress:0];
  [*(a1 + 32) _scheduleThreadNetworkUpdate];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)_retryStartThreadNetwork:(double)network
{
  v26 = *MEMORY[0x277D85DE8];
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = 30.0;
  if (network > 0.0)
  {
    v7 = fmin(network + network, 1800.0);
    if (network < 2.22044605e-16)
    {
      v6 = 30.0;
    }

    else
    {
      v6 = v7;
    }
  }

  threadNetworkSequenceNumber = [(HMDHome *)self threadNetworkSequenceNumber];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke;
  aBlock[3] = &unk_279723418;
  objc_copyWeak(v20, &location);
  v20[1] = *&network;
  v20[2] = threadNetworkSequenceNumber;
  v20[3] = *&v6;
  v9 = _Block_copy(aBlock);
  v10 = v9;
  v11 = network <= 0.0;
  if (network < 2.22044605e-16)
  {
    v11 = 1;
  }

  if (v11)
  {
    (*(v9 + 2))(v9);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543618;
      v23 = v15;
      v24 = 2048;
      networkCopy = network;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Next resident commissioning attempt will happen in %lu seconds", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v12);
    v16 = dispatch_time(0, (network * 1000000000.0));
    workQueue2 = [(HMDHome *)selfCopy workQueue];
    dispatch_after(v16, workQueue2, v10);
  }

  objc_destroyWeak(v20);
  objc_destroyWeak(&location);
  v18 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke(uint64_t a1)
{
  v28 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  if (!WeakRetained)
  {
    v11 = objc_autoreleasePoolPush();
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v13;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@Home has died, resident commissioning canceled", buf, 0xCu);
    }

    v14 = v11;
    goto LABEL_17;
  }

  v3 = *(a1 + 40);
  if (v3 > 0.0 && v3 >= 2.22044605e-16)
  {
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning timer expired", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = [WeakRetained threadNetworkSequenceNumber];
  v10 = v9;
  if (v9 != *(a1 + 48))
  {
    v15 = objc_autoreleasePoolPush();
    v16 = WeakRetained;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = *(a1 + 48);
      *buf = 138543874;
      v23 = v18;
      v24 = 2048;
      v25 = v19;
      v26 = 2048;
      v27 = v10;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", buf, 0x20u);
    }

    v14 = v15;
LABEL_17:
    objc_autoreleasePoolPop(v14);
    goto LABEL_18;
  }

  v21[0] = MEMORY[0x277D85DD0];
  v21[1] = 3221225472;
  v21[2] = __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45;
  v21[3] = &unk_2797233F0;
  v21[4] = WeakRetained;
  v21[5] = v9;
  v21[6] = *(a1 + 56);
  [WeakRetained _startThreadNetworkWithCompletion:v21];
LABEL_18:

  v20 = *MEMORY[0x277D85DE8];
}

void __65__HMDHome_ThreadResidentCommissioning___retryStartThreadNetwork___block_invoke_45(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = v3;
  if (v3)
  {
    v5 = [v3 domain];
    if ([v5 isEqualToString:*MEMORY[0x277CCFD28]])
    {
      if ([v4 code] == 48)
      {

        goto LABEL_12;
      }

      v13 = [v4 code];

      if (v13 == 23)
      {
        goto LABEL_12;
      }
    }

    else
    {
    }

    v6 = [*(a1 + 32) threadNetworkSequenceNumber];
    if (v6 == *(a1 + 40))
    {
      [*(a1 + 32) _retryStartThreadNetwork:*(a1 + 48)];
    }

    else
    {
      v7 = v6;
      v8 = objc_autoreleasePoolPush();
      v9 = *(a1 + 32);
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v12 = *(a1 + 40);
        v15 = 138543874;
        v16 = v11;
        v17 = 2048;
        v18 = v12;
        v19 = 2048;
        v20 = v7;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Resident commissioning sequence number no longer matches: %lu != %lu", &v15, 0x20u);
      }

      objc_autoreleasePoolPop(v8);
    }
  }

LABEL_12:

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_incrementCurrentSequenceNumber
{
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  threadNetworkSequenceNumber = [(HMDHome *)self threadNetworkSequenceNumber];
  [(HMDHome *)self setThreadNetworkSequenceNumber:threadNetworkSequenceNumber + 1];
  if (threadNetworkSequenceNumber == -1)
  {
    v5 = [(HMDHome *)self threadNetworkSequenceNumber]+ 1;

    [(HMDHome *)self setThreadNetworkSequenceNumber:v5];
  }
}

- (void)startThreadNetwork:(BOOL)network
{
  v21 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled() && (+[HMDDeviceCapabilities deviceCapabilities](HMDDeviceCapabilities, "deviceCapabilities"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 supportsThreadService], v5, (v6 & 1) != 0))
  {
    v7 = objc_autoreleasePoolPush();
    selfCopy = self;
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
    {
      v10 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v10;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEBUG, "%{public}@Starting resident commissioning timer", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v7);
    workQueue = [(HMDHome *)selfCopy workQueue];
    v17[0] = MEMORY[0x277D85DD0];
    v17[1] = 3221225472;
    v17[2] = __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke;
    v17[3] = &unk_279735D28;
    v17[4] = selfCopy;
    networkCopy = network;
    dispatch_async(workQueue, v17);
  }

  else
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
    {
      v15 = HMFGetLogIdentifier();
      *buf = 138543362;
      v20 = v15;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_DEBUG, "%{public}@Thread commissioning is not supported on this platform", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v12);
  }

  v16 = *MEMORY[0x277D85DE8];
}

void __59__HMDHome_ThreadResidentCommissioning__startThreadNetwork___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) homeManager];
  if ([v2 isStartThreadNetworkInProgress])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, start already in progress for another network";
LABEL_4:
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, v7, &v11, 0xCu);
    }
  }

  else
  {
    if (*(a1 + 40) & 1) != 0 || ([*(a1 + 32) threadNetworkID], v8 = objc_claimAutoreleasedReturnValue(), v9 = objc_msgSend(v2, "isCurrentResidentDeviceRunningThreadNetwork:", v8), v8, (v9))
    {
      [*(a1 + 32) _incrementCurrentSequenceNumber];
      [*(a1 + 32) _retryStartThreadNetwork:0.0];
      goto LABEL_9;
    }

    v3 = objc_autoreleasePoolPush();
    v4 = *(a1 + 32);
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v11 = 138543362;
      v12 = v6;
      v7 = "%{public}@Not starting thread network, not associated with thread network homes";
      goto LABEL_4;
    }
  }

  objc_autoreleasePoolPop(v3);
LABEL_9:

  v10 = *MEMORY[0x277D85DE8];
}

- (void)_handleUnjoinThreadNetworkMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke;
  v7[3] = &unk_2797359B0;
  v7[4] = self;
  v8 = messageCopy;
  v6 = messageCopy;
  dispatch_async(workQueue, v7);
}

void __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v2[0] = MEMORY[0x277D85DD0];
  v2[1] = 3221225472;
  v2[2] = __74__HMDHome_ThreadResidentCommissioning___handleUnjoinThreadNetworkMessage___block_invoke_2;
  v2[3] = &unk_2797359D8;
  v1 = *(a1 + 32);
  v3 = *(a1 + 40);
  [v1 _unjoinThreadNetworkWithCompletion:v2];
}

- (void)_handleJoinOrFormThreadNetworkMessage:(id)message
{
  v25 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v5 = _os_feature_enabled_impl();
  if (isFeatureMatteriPhoneOnlyPairingControlForThreadEnabled())
  {
    v6 = +[HMDDeviceCapabilities deviceCapabilities];
    supportsThreadService = [v6 supportsThreadService];

    if (((supportsThreadService | v5) & 1) == 0)
    {
LABEL_3:
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543362;
        v24 = v11;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Resident commissioning is disabled", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v8);
      v12 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:5];
      [messageCopy respondWithPayload:0 error:v12];
      goto LABEL_13;
    }
  }

  else if ((v5 & 1) == 0)
  {
    goto LABEL_3;
  }

  messagePayload = [messageCopy messagePayload];

  if (messagePayload)
  {
    messagePayload2 = [messageCopy messagePayload];
    v15 = [messagePayload2 objectForKey:*MEMORY[0x277CD0628]];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v16 = v15;
    }

    else
    {
      v16 = 0;
    }

    messagePayload = v16;
  }

  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke;
  block[3] = &unk_279734960;
  v20 = messagePayload;
  selfCopy2 = self;
  v22 = messageCopy;
  v12 = messagePayload;
  dispatch_async(workQueue, block);

LABEL_13:
  v18 = *MEMORY[0x277D85DE8];
}

void __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke(uint64_t a1)
{
  v18 = *MEMORY[0x277D85DE8];
  if (*(a1 + 32))
  {
    v2 = objc_autoreleasePoolPush();
    v3 = *(a1 + 40);
    v4 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
    {
      v5 = HMFGetLogIdentifier();
      v6 = [*(a1 + 40) threadNetworkID];
      v7 = *(a1 + 32);
      *buf = 138543874;
      v13 = v5;
      v14 = 2112;
      v15 = v6;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_2531F8000, v4, OS_LOG_TYPE_DEFAULT, "%{public}@Updating thread network %@ -> %@ and starting", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v2);
    [*(a1 + 40) setThreadNetworkID:*(a1 + 32)];
  }

  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __78__HMDHome_ThreadResidentCommissioning___handleJoinOrFormThreadNetworkMessage___block_invoke_43;
  v10[3] = &unk_2797359D8;
  v8 = *(a1 + 40);
  v11 = *(a1 + 48);
  [v8 _startThreadNetworkWithCompletion:v10];

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_handleThreadNetworkCredentialsRequest:(id)request
{
  v24 = *MEMORY[0x277D85DE8];
  requestCopy = request;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v23 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Attempting to resolve request for Thread Network Credentials", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  threadNetworkMetadataStore = [(HMDHome *)selfCopy threadNetworkMetadataStore];
  if (threadNetworkMetadataStore)
  {
    objc_initWeak(buf, selfCopy);
    aBlock[0] = MEMORY[0x277D85DD0];
    aBlock[1] = 3221225472;
    aBlock[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke;
    aBlock[3] = &unk_2797233C8;
    aBlock[4] = selfCopy;
    objc_copyWeak(&v21, buf);
    v20 = requestCopy;
    v10 = _Block_copy(aBlock);
    threadOperationalDataset = [(HMDHome *)selfCopy threadOperationalDataset];
    home = [(HMDHome *)selfCopy home];
    [threadNetworkMetadataStore retrieveMetadata:threadOperationalDataset homeHasResident:objc_msgSend(home completion:{"doesHomeContainResident"), v10}];

    objc_destroyWeak(&v21);
    objc_destroyWeak(buf);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    v14 = selfCopy;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543362;
      v23 = v16;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@No thread network metadata store", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v17 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [requestCopy respondWithError:v17];
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] workQueue];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2;
  v10[3] = &unk_279733910;
  objc_copyWeak(&v14, a1 + 6);
  v11 = v5;
  v12 = v6;
  v13 = a1[5];
  v8 = v6;
  v9 = v5;
  dispatch_async(v7, v10);

  objc_destroyWeak(&v14);
}

void __79__HMDHome_ThreadResidentCommissioning___handleThreadNetworkCredentialsRequest___block_invoke_2(uint64_t a1)
{
  v36 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained && *(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      *buf = 138543618;
      v31 = v6;
      v32 = 2112;
      v33 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Successfully retrieved thread credentials %@ from network metadata store", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = [*(a1 + 32) operationalDataset];

    if (v8)
    {
      v9 = [*(a1 + 32) operationalDataset];
      v10 = [v9 copy];
      [v4 saveAndSyncWithThreadOperationalDataset:v10];
    }

    v11 = *(a1 + 32);
    v29 = 0;
    v12 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:v11 requiringSecureCoding:1 error:&v29];
    v13 = v29;
    if (v12)
    {
      v14 = [MEMORY[0x277CBEB38] dictionary];
      [v14 setObject:v12 forKeyedSubscript:*MEMORY[0x277CD0620]];
      v15 = [*(a1 + 32) masterKey];
      [v14 setObject:v15 forKeyedSubscript:@"HMHomeThreadNetworkCredentialsMasterKeyMessageKey"];

      [*(a1 + 48) respondWithPayload:v14];
    }

    else
    {
      v23 = objc_autoreleasePoolPush();
      v24 = v4;
      v25 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        v26 = HMFGetLogIdentifier();
        *buf = 138543618;
        v31 = v26;
        v32 = 2112;
        v33 = v13;
        _os_log_impl(&dword_2531F8000, v25, OS_LOG_TYPE_ERROR, "%{public}@Unable to encode credentials: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v23);
      v27 = *(a1 + 48);
      v14 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:15];
      [v27 respondWithError:v14];
    }
  }

  else
  {
    v16 = objc_autoreleasePoolPush();
    v17 = WeakRetained;
    v18 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      v19 = HMFGetLogIdentifier();
      v20 = [v17 threadNetworkID];
      v21 = *(a1 + 40);
      *buf = 138543874;
      v31 = v19;
      v32 = 2112;
      v33 = v20;
      v34 = 2112;
      v35 = v21;
      _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_ERROR, "%{public}@Unable to retrieve metadata for thread network '%@': %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v16);
    v22 = *(a1 + 48);
    v13 = [MEMORY[0x277CCA9B8] hmfErrorWithCode:2];
    [v22 respondWithError:v13];
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)handleCurrentWiFiNetworkChangedNotification:(id)notification
{
  workQueue = [(HMDHome *)self workQueue];
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke;
  block[3] = &unk_279735D00;
  block[4] = self;
  dispatch_async(workQueue, block);
}

void __84__HMDHome_ThreadResidentCommissioning__handleCurrentWiFiNetworkChangedNotification___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) threadNetworkShouldRestartOnNetworkChange];
  v3 = objc_autoreleasePoolPush();
  v4 = *(a1 + 32);
  v5 = HMFGetOSLogHandle();
  v6 = os_log_type_enabled(v5, OS_LOG_TYPE_INFO);
  if (v2)
  {
    if (v6)
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Restarting Thread network upon WiFi network changed notification", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    [*(a1 + 32) startThreadNetwork:1];
  }

  else
  {
    if (v6)
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Ignoring WiFi network changed notification when Thread is not up", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerThreadResidentCommissioningMessageHandlers
{
  v11 = *MEMORY[0x277D85DE8];
  if (isFeatureMatteriPhoneOnlyPairingControlEnabled())
  {
    v3 = objc_autoreleasePoolPush();
    selfCopy = self;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = HMFGetLogIdentifier();
      v9 = 138543362;
      v10 = v6;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_INFO, "%{public}@Registering for HMFWiFiManagerCurrentNetworkDidChangeNotification", &v9, 0xCu);
    }

    objc_autoreleasePoolPop(v3);
    defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
    [defaultCenter addObserver:selfCopy selector:sel_handleCurrentWiFiNetworkChangedNotification_ name:*MEMORY[0x277D0F768] object:0];
  }

  v8 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadPreferredPrimaryResident
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  supportsThreadBorderRouter = [v2 supportsThreadBorderRouter];

  return supportsThreadBorderRouter;
}

- (void)setThreadNetworkID:(id)d
{
  v26 = *MEMORY[0x277D85DE8];
  dCopy = d;
  threadNetworkID = [(HMDHome *)self threadNetworkID];
  if (threadNetworkID && (v7 = threadNetworkID, v8 = [dCopy isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"], v7, (v8 & 1) == 0))
  {
    v14 = objc_autoreleasePoolPush();
    selfCopy = self;
    v16 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = HMFGetLogIdentifier();
      unfilteredThreadNetworkID = [(HMDHome *)selfCopy unfilteredThreadNetworkID];
      v20 = 138543874;
      v21 = v17;
      v22 = 2112;
      v23 = dCopy;
      v24 = 2112;
      v25 = unfilteredThreadNetworkID;
      _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Unable to set threadNetworkID to %@. (current value=%@)", &v20, 0x20u);
    }

    objc_autoreleasePoolPop(v14);
  }

  else if ([(HMDHome *)self attemptToUpdateThreadNetworkID:dCopy])
  {
    v9 = [HMDHomeThreadNetworkModel defaultModelForHome:self];
    [v9 setThreadNetworkID:dCopy];
    backingStore = [(HMDHome *)self backingStore];
    v11 = NSStringFromSelector(a2);
    v12 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
    v13 = [backingStore transaction:v11 options:v12];

    [v13 add:v9 withMessage:0];
    [v13 run];
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (NSString)threadNetworkID
{
  unfilteredThreadNetworkID = [(HMDHome *)self unfilteredThreadNetworkID];
  if ([unfilteredThreadNetworkID isEqualToString:@"770E5B2E-0BAD-0BAD-0BAD-EE86505EFF8F"])
  {
    v3 = 0;
  }

  else
  {
    v3 = unfilteredThreadNetworkID;
  }

  return v3;
}

- (void)_unregisterForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_279732FD8;
  objc_copyWeak(&v5, &location);
  dispatch_async(workQueue, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __73__HMDHome_ThreadResidentCommissioning___unregisterForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained && ([WeakRetained threadNetworkPeriodicStatusReporter], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    v4 = [v2 threadNetworkPeriodicStatusReporter];
    [v4 unregisterForThreadNetworkEvents];

    [v2 setThreadNetworkPeriodicStatusReporter:0];
  }

  else
  {
    v5 = objc_autoreleasePoolPush();
    v6 = v2;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@_unregisterForThreadNetworkEvents already unregistered", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v5);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_registerForThreadNetworkEvents
{
  objc_initWeak(&location, self);
  workQueue = [(HMDHome *)self workQueue];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke;
  v4[3] = &unk_279732FD8;
  objc_copyWeak(&v5, &location);
  dispatch_async(workQueue, v4);

  objc_destroyWeak(&v5);
  objc_destroyWeak(&location);
}

void __71__HMDHome_ThreadResidentCommissioning___registerForThreadNetworkEvents__block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = WeakRetained;
  if (WeakRetained)
  {
    v3 = [WeakRetained threadNetworkPeriodicStatusReporter];

    if (!v3)
    {
      v4 = [[HMDThreadNetworkStatusReporter alloc] initWithHome:v2];
      [v2 setThreadNetworkPeriodicStatusReporter:v4];
    }

    v5 = [v2 threadNetworkPeriodicStatusReporter];
    [v5 registerForThreadNetworkEvents];
  }

  else
  {
    v6 = objc_autoreleasePoolPush();
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v8;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@_registerForThreadNetworkEvents could not get a strong reference to self", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v6);
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (BOOL)isCurrentDeviceThreadBorderRouterCapable
{
  v2 = +[HMDDeviceCapabilities deviceCapabilities];
  supportsThreadBorderRouter = [v2 supportsThreadBorderRouter];

  return supportsThreadBorderRouter;
}

- (BOOL)isThreadNetworkUp
{
  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadNetworkIsUp];
}

- (BOOL)isThreadCapable
{
  threadNetworkID = [(HMDHome *)self threadNetworkID];

  if (threadNetworkID)
  {
    return 1;
  }

  [(HMDHome *)self _scheduleThreadNetworkUpdate];

  return [(HMDHome *)self threadPreferredNetworkExists];
}

- (id)actionWithDictionaryRepresentation:(id)representation
{
  v25 = *MEMORY[0x277D85DE8];
  representationCopy = representation;
  v5 = representationCopy;
  if (!representationCopy)
  {
    v11 = 0;
    goto LABEL_14;
  }

  v6 = [representationCopy hmf_numberForKey:*MEMORY[0x277CD2058]];
  v7 = v6;
  if (!v6)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543362;
      v22 = v15;
      v16 = "%{public}@Unable to determine the action type";
      v17 = v14;
      v18 = 12;
      goto LABEL_11;
    }

LABEL_12:

    objc_autoreleasePoolPop(v12);
    v11 = 0;
    goto LABEL_13;
  }

  integerValue = [v6 integerValue];
  if (integerValue > 3 || (v9 = *off_279724020[integerValue], objc_opt_class(), (v10 = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = HMFGetLogIdentifier();
      v21 = 138543618;
      v22 = v15;
      v23 = 2112;
      v24 = v7;
      v16 = "%{public}@Unknown action type: %@";
      v17 = v14;
      v18 = 22;
LABEL_11:
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, v16, &v21, v18);

      goto LABEL_12;
    }

    goto LABEL_12;
  }

  v11 = [v10 actionWithDictionaryRepresentation:v5 home:self];
LABEL_13:

LABEL_14:
  v19 = *MEMORY[0x277D85DE8];

  return v11;
}

- (id)createAppleMediaAccessoriesStateManagerWithIdentifier:(id)identifier messenger:(id)messenger metricsDispatcher:(id)dispatcher
{
  dispatcherCopy = dispatcher;
  messengerCopy = messenger;
  identifierCopy = identifier;
  v10 = [[HMDAppleMediaAccessoriesStateManager alloc] initWithIdentifier:identifierCopy messenger:messengerCopy metricsDispatcher:dispatcherCopy];

  return v10;
}

- (void)configureAppleMediaAccessoriesStateManagerWithStateManagerWithFactory:(id)factory messengerFactory:(id)messengerFactory metricsDispatcherFactory:(id)dispatcherFactory
{
  v25 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  messengerFactoryCopy = messengerFactory;
  dispatcherFactoryCopy = dispatcherFactory;
  v11 = objc_autoreleasePoolPush();
  selfCopy = self;
  v13 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
  {
    v14 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v14;
    _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@Configuring apple media accessories state manager", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v11);
  uuid = [(HMDHome *)selfCopy uuid];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  v17 = +[HMDMetricsManager sharedLogEventSubmitter];
  if (!uuid)
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!msgDispatcher)
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  v18 = v17;
  if (!v17)
  {
    goto LABEL_9;
  }

  v19 = [messengerFactoryCopy createAppleMediaAccessoriesStateMessengerWithIdentifier:uuid messageDispatcher:msgDispatcher];
  v20 = [dispatcherFactoryCopy createAppleMediaAccessoriesStateManagerMetricsDispatcherWithIdentifier:uuid logEventSubmitter:v18];
  v21 = [factoryCopy createAppleMediaAccessoriesStateManagerWithIdentifier:uuid messenger:v19 metricsDispatcher:v20];
  [v19 setDelegate:v21];
  [v21 setDataSource:selfCopy];
  [v19 registerForMessagesWithHome:selfCopy];
  [v21 run];
  [(HMDHome *)selfCopy setAppleMediaAccessoriesStateManager:v21];

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_auditChangedCharacteristics:(id)characteristics
{
  v40 = *MEMORY[0x277D85DE8];
  characteristicsCopy = characteristics;
  v4 = [MEMORY[0x277CBEB58] setWithCapacity:{objc_msgSend(characteristicsCopy, "count")}];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v5 = characteristicsCopy;
  v6 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v35;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        notificationRegistrations = [v10 notificationRegistrations];
        v12 = [notificationRegistrations count];

        if (!v12)
        {
          accessory = [v10 accessory];
          uuid = [accessory uuid];
          [v4 addObject:uuid];

          if (([accessory isPrimary] & 1) == 0)
          {
            bridge = [accessory bridge];
            identifiersForBridgedAccessories = [bridge identifiersForBridgedAccessories];
            [v4 unionSet:identifiersForBridgedAccessories];
          }
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v7);
  }

  if ([v4 count] == 1)
  {
    firstObject = [v5 firstObject];
    accessory2 = [firstObject accessory];
    [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:accessory2];
  }

  else
  {
    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    firstObject = [(HMDHome *)self accessories];
    v19 = [firstObject countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v31;
      do
      {
        for (j = 0; j != v20; ++j)
        {
          if (*v31 != v21)
          {
            objc_enumerationMutation(firstObject);
          }

          v23 = *(*(&v30 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v24 = v23;
          }

          else
          {
            v24 = 0;
          }

          v25 = v24;

          if (v25)
          {
            uuid2 = [v25 uuid];
            v27 = [v4 containsObject:uuid2];

            if (v27)
            {
              [(HMDHome *)self _auditAndDeregisterCharacteristicsForHAPAccessory:v25];
            }
          }
        }

        v20 = [firstObject countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v20);
    }
  }

  v28 = *MEMORY[0x277D85DE8];
}

- (void)_auditAndDeregisterCharacteristicsForHAPAccessory:(id)accessory
{
  selfCopy = self;
  v46 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  array = [MEMORY[0x277CBEB18] array];
  string = [MEMORY[0x277CCAB68] string];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v25 = accessoryCopy;
  obj = [accessoryCopy services];
  v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
  if (v28)
  {
    v27 = *v35;
    do
    {
      v6 = 0;
      do
      {
        if (*v35 != v27)
        {
          objc_enumerationMutation(obj);
        }

        v29 = v6;
        v7 = *(*(&v34 + 1) + 8 * v6);
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        characteristics = [v7 characteristics];
        v9 = [characteristics countByEnumeratingWithState:&v30 objects:v44 count:16];
        if (v9)
        {
          v10 = v9;
          v11 = *v31;
          do
          {
            for (i = 0; i != v10; ++i)
            {
              if (*v31 != v11)
              {
                objc_enumerationMutation(characteristics);
              }

              v13 = *(*(&v30 + 1) + 8 * i);
              notificationRegistrations = [v13 notificationRegistrations];
              v15 = [notificationRegistrations count];

              if (!v15)
              {
                [array addObject:v13];
                shortDescription = [v13 shortDescription];
                [string appendString:shortDescription];

                [string appendString:@"\n"];
              }
            }

            v10 = [characteristics countByEnumeratingWithState:&v30 objects:v44 count:16];
          }

          while (v10);
        }

        v6 = v29 + 1;
      }

      while (v29 + 1 != v28);
      v28 = [obj countByEnumeratingWithState:&v34 objects:v45 count:16];
    }

    while (v28);
  }

  v17 = objc_autoreleasePoolPush();
  v18 = selfCopy;
  v19 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = HMFGetLogIdentifier();
    *buf = 0;
    *&buf[8] = 0;
    uuid = [v25 uuid];

    if (uuid)
    {
      uuid2 = [v25 uuid];
      [uuid2 getUUIDBytes:buf];
    }

    else
    {
      *buf = *MEMORY[0x277D0F960];
    }

    v38 = *buf;
    *buf = 138544130;
    *&buf[4] = v20;
    *&buf[12] = 1040;
    *&buf[14] = 16;
    v40 = 2096;
    v41 = &v38;
    v42 = 2112;
    v43 = string;
    _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_INFO, "%{public}@Audit de-registering notifications accessory %{uuid_t}.16P characteristics %@", buf, 0x26u);
  }

  objc_autoreleasePoolPop(v17);
  [v25 enableNotification:0 forCharacteristics:array message:0 clientIdentifier:0];

  v23 = *MEMORY[0x277D85DE8];
}

- (void)updateLightProfilesSettings:(id)settings
{
  v38 = *MEMORY[0x277D85DE8];
  settingsCopy = settings;
  v5 = [MEMORY[0x277CBEB58] set];
  v6 = [MEMORY[0x277CBEB58] set];
  v31 = 0u;
  v32 = 0u;
  v29 = 0u;
  v30 = 0u;
  v7 = settingsCopy;
  v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
  if (v8)
  {
    v9 = *v30;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v30 != v9)
        {
          objc_enumerationMutation(v7);
        }

        v11 = *(*(&v29 + 1) + 8 * i);
        readCharacteristicRequests = [v11 readCharacteristicRequests];
        if ([readCharacteristicRequests count])
        {
          allObjects = [readCharacteristicRequests allObjects];
          [v5 addObjectsFromArray:allObjects];

          [v6 addObject:v11];
        }
      }

      v8 = [v7 countByEnumeratingWithState:&v29 objects:v37 count:16];
    }

    while (v8);
  }

  v14 = [v5 count] == 0;
  v15 = objc_autoreleasePoolPush();
  if (v14)
  {
    lightLogCategory = [(HMDHome *)self lightLogCategory];
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
    {
      v24 = HMFGetLogIdentifier();
      *buf = 138543362;
      v34 = v24;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic read requests for light profiles", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  else
  {
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = HMFGetLogIdentifier();
      v19 = [v5 count];
      *buf = 138543618;
      v34 = v18;
      v35 = 2048;
      v36 = v19;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_INFO, "%{public}@update light profiles settings, read characteristic count %lu", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v15);
    objc_initWeak(buf, selfCopy);
    allObjects2 = [v5 allObjects];
    v21 = [(HMDHome *)selfCopy description];
    v26[0] = MEMORY[0x277D85DD0];
    v26[1] = 3221225472;
    v26[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke;
    v26[3] = &unk_279733AE8;
    objc_copyWeak(&v28, buf);
    v27 = v6;
    [(HMDHome *)selfCopy readCharacteristicValues:allObjects2 source:1140 sourceForLogging:v21 qualityOfService:-1 withCompletionHandler:v26];

    objc_destroyWeak(&v28);
    objc_destroyWeak(buf);
  }

  v25 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v36 = *MEMORY[0x277D85DE8];
  v20 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v7 = v5;
    if ([v5 count])
    {
      v27 = 0u;
      v28 = 0u;
      v25 = 0u;
      v26 = 0u;
      obj = *(a1 + 32);
      v8 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
      if (v8)
      {
        v9 = v8;
        v10 = *v26;
        do
        {
          for (i = 0; i != v9; ++i)
          {
            if (*v26 != v10)
            {
              objc_enumerationMutation(obj);
            }

            v12 = *(*(&v25 + 1) + 8 * i);
            v13 = [v12 workQueue];
            block[0] = MEMORY[0x277D85DD0];
            block[1] = 3221225472;
            block[2] = __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_15;
            block[3] = &unk_279734870;
            block[4] = v12;
            v5 = v7;
            v22 = v7;
            v23 = WeakRetained;
            v24 = v20;
            dispatch_async(v13, block);
          }

          v9 = [obj countByEnumeratingWithState:&v25 objects:v29 count:16];
        }

        while (v9);
      }
    }

    else
    {
      v14 = objc_autoreleasePoolPush();
      v15 = [WeakRetained lightLogCategory];
      v16 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v17 = HMFGetLogIdentifier();
        *buf = 138543874;
        v31 = v17;
        v32 = 2112;
        v33 = v7;
        v34 = 2112;
        v35 = v20;
        _os_log_impl(&dword_2531F8000, v16, OS_LOG_TYPE_ERROR, "%{public}@Received empty response payload for light profile charactersitic read requests %@:%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v14);
      v5 = v7;
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __46__HMDHome_Light__updateLightProfilesSettings___block_invoke_15(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v18 = 0;
  v4 = [v2 updateSettingsWithReadCharacteristicResponsePayload:v3 error:&v18];
  v5 = v18;
  v6 = objc_autoreleasePoolPush();
  v7 = [*(a1 + 48) lightLogCategory];
  v8 = HMFGetOSLogHandle();
  v9 = v8;
  if (v4)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v10 = HMFGetLogIdentifier();
      v11 = *(a1 + 32);
      *buf = 138543874;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      v23 = 2112;
      v24 = v4;
      v12 = "%{public}@Successfully updated light profile settings %@:%@";
      v13 = v9;
      v14 = OS_LOG_TYPE_INFO;
LABEL_6:
      _os_log_impl(&dword_2531F8000, v13, v14, v12, buf, 0x20u);
    }
  }

  else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v10 = HMFGetLogIdentifier();
    v15 = *(a1 + 32);
    v16 = *(a1 + 56);
    *buf = 138543874;
    v20 = v10;
    v21 = 2112;
    v22 = v15;
    v23 = 2112;
    v24 = v16;
    v12 = "%{public}@Failed to update light profile settings %@:%@";
    v13 = v9;
    v14 = OS_LOG_TYPE_ERROR;
    goto LABEL_6;
  }

  objc_autoreleasePoolPop(v6);
  v17 = *MEMORY[0x277D85DE8];
}

- (void)updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v24 = *MEMORY[0x277D85DE8];
  v5 = [MEMORY[0x277CBEB58] set];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  accessories = [(HMDHome *)self accessories];
  v7 = [accessories countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v20;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v20 != v9)
        {
          objc_enumerationMutation(accessories);
        }

        v11 = *(*(&v19 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v12 = v11;
        }

        else
        {
          v12 = 0;
        }

        v13 = v12;

        if (v13)
        {
          lightProfiles = [v13 lightProfiles];
          v15 = lightProfiles;
          if (enabledCopy)
          {
            v16 = [lightProfiles na_filter:&__block_literal_global_44789];

            v15 = v16;
          }

          allObjects = [v15 allObjects];
          [v5 addObjectsFromArray:allObjects];
        }
      }

      v8 = [accessories countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v8);
  }

  [(HMDHome *)self updateLightProfilesSettings:v5];
  v18 = *MEMORY[0x277D85DE8];
}

BOOL __82__HMDHome_Light__updateLightProfilesSettingsWithRequiresHomeNotificationsEnabled___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 notificationEnabledCharacteristics];
  v3 = [v2 count] != 0;

  return v3;
}

- (void)respondMessage:(id)message withSettingResults:(id)results
{
  v27 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  resultsCopy = results;
  v18 = 0;
  v8 = [MEMORY[0x277CCAAB0] archivedDataWithRootObject:resultsCopy requiringSecureCoding:1 error:&v18];
  v9 = v18;
  v10 = objc_autoreleasePoolPush();
  lightLogCategory = [(HMDHome *)self lightLogCategory];
  v12 = HMFGetOSLogHandle();
  v13 = v12;
  if (v8)
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v14 = HMFGetLogIdentifier();
      *buf = 138543618;
      v22 = v14;
      v23 = 2112;
      v24 = resultsCopy;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_DEBUG, "%{public}@Responding with light profile settings: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v10);
    v19 = *MEMORY[0x277CD0438];
    v20 = v8;
    v15 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v20 forKeys:&v19 count:1];
    [messageCopy respondWithPayload:v15];
  }

  else
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      *buf = 138543874;
      v22 = v16;
      v23 = 2112;
      v24 = resultsCopy;
      v25 = 2112;
      v26 = v9;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to encode profile setting results: %@ with error: %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    v15 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    [messageCopy respondWithError:v15];
  }

  v17 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)message withLightProfileUUIDs:(id)ds
{
  v55 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  dsCopy = ds;
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  lightLogCategory = [(HMDHome *)self lightLogCategory];
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    *buf = 138543618;
    v52 = v10;
    v53 = 2112;
    v54 = dsCopy;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Handling fetch light profiles settings for profiles: %@", buf, 0x16u);
  }

  objc_autoreleasePoolPop(v7);
  dictionary = [MEMORY[0x277CBEB38] dictionary];
  v40 = [MEMORY[0x277CBEB58] set];
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = dsCopy;
  v12 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
  selfCopy2 = self;
  if (v12)
  {
    v14 = v12;
    v15 = *v46;
    do
    {
      v16 = 0;
      v38 = v14;
      do
      {
        if (*v46 != v15)
        {
          objc_enumerationMutation(obj);
        }

        v17 = *(*(&v45 + 1) + 8 * v16);
        v18 = [(HMDHome *)selfCopy2 lightProfileWithUUID:v17];
        if (v18)
        {
          [v40 addObject:v18];
        }

        else
        {
          v19 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
          v20 = [objc_alloc(MEMORY[0x277CD1A80]) initWithError:v19];
          v21 = dictionary;
          [dictionary setObject:v20 forKeyedSubscript:v17];

          v22 = objc_autoreleasePoolPush();
          lightLogCategory2 = [(HMDHome *)selfCopy2 lightLogCategory];
          v24 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            v25 = HMFGetLogIdentifier();
            *buf = 138543618;
            v52 = v25;
            v53 = 2112;
            v54 = v17;
            _os_log_impl(&dword_2531F8000, v24, OS_LOG_TYPE_ERROR, "%{public}@Could not find light profile with uuid: %@", buf, 0x16u);

            selfCopy2 = selfCopy;
          }

          objc_autoreleasePoolPop(v22);
          dictionary = v21;
          v14 = v38;
        }

        ++v16;
      }

      while (v14 != v16);
      v14 = [obj countByEnumeratingWithState:&v45 objects:v50 count:16];
    }

    while (v14);
  }

  v43 = 0u;
  v44 = 0u;
  v41 = 0u;
  v42 = 0u;
  v26 = v40;
  v27 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
  if (v27)
  {
    v28 = v27;
    v29 = *v42;
    do
    {
      for (i = 0; i != v28; ++i)
      {
        if (*v42 != v29)
        {
          objc_enumerationMutation(v26);
        }

        v31 = *(*(&v41 + 1) + 8 * i);
        settings = [v31 settings];
        v33 = [objc_alloc(MEMORY[0x277CD1A80]) initWithSettings:settings];
        uniqueIdentifier = [v31 uniqueIdentifier];
        [dictionary setObject:v33 forKeyedSubscript:uniqueIdentifier];
      }

      v28 = [v26 countByEnumeratingWithState:&v41 objects:v49 count:16];
    }

    while (v28);
  }

  [(HMDHome *)selfCopy respondMessage:messageCopy withSettingResults:dictionary];
  v35 = *MEMORY[0x277D85DE8];
}

- (void)handleFetchLightProfileSettingsMessage:(id)message
{
  messageCopy = message;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  v6 = [messageCopy setForKey:*MEMORY[0x277CD0430]];
  [(HMDHome *)self handleFetchLightProfileSettingsMessage:messageCopy withLightProfileUUIDs:v6];
}

- (id)lightProfileWithUUID:(id)d
{
  dCopy = d;
  accessories = [(HMDHome *)self accessories];
  v10[0] = MEMORY[0x277D85DD0];
  v10[1] = 3221225472;
  v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke;
  v10[3] = &unk_279726250;
  v11 = dCopy;
  v6 = dCopy;
  v7 = [accessories na_map:v10];

  firstObject = [v7 firstObject];

  return firstObject;
}

id __39__HMDHome_Light__lightProfileWithUUID___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;
  v6 = v5;
  if (v5)
  {
    v7 = [v5 lightProfiles];
    v10[0] = MEMORY[0x277D85DD0];
    v10[1] = 3221225472;
    v10[2] = __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2;
    v10[3] = &unk_2797285D0;
    v11 = *(a1 + 32);
    v8 = [v7 na_firstObjectPassingTest:v10];
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

uint64_t __39__HMDHome_Light__lightProfileWithUUID___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 uniqueIdentifier];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (id)createPrimaryResidentMessageRouterWithHomeUUID:(id)d messageDispatcher:(id)dispatcher metricsDispatcher:(id)metricsDispatcher
{
  metricsDispatcherCopy = metricsDispatcher;
  dispatcherCopy = dispatcher;
  dCopy = d;
  v10 = [[HMDPrimaryResidentMessageRouter alloc] initWithHomeUUID:dCopy messageDispatcher:dispatcherCopy metricsDispatcher:metricsDispatcherCopy];

  return v10;
}

- (void)configurePrimaryResidentMessageRouterWithFactory:(id)factory metricsDispatcherFactory:(id)dispatcherFactory
{
  v21 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  dispatcherFactoryCopy = dispatcherFactory;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v19 = 138543362;
    v20 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring primary resident message router", &v19, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  msgDispatcher2 = [(HMDHome *)selfCopy msgDispatcher];

  if (!msgDispatcher2)
  {
    _HMFPreconditionFailure();
  }

  v14 = +[HMDMetricsManager sharedLogEventSubmitter];
  v15 = [dispatcherFactoryCopy createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:v14];
  uuid = [(HMDHome *)selfCopy uuid];
  v17 = [factoryCopy createPrimaryResidentMessageRouterWithHomeUUID:uuid messageDispatcher:msgDispatcher metricsDispatcher:v15];

  [v17 setDataSource:selfCopy];
  [(HMDHome *)selfCopy setPrimaryResidentMessageRouter:v17];

  v18 = *MEMORY[0x277D85DE8];
}

- (id)createAccessorySettingsLocalMessageHandlerWithHomeUUID:(id)d languageValuesDataProvider:(id)provider
{
  providerCopy = provider;
  dCopy = d;
  v7 = [[HMDAccessorySettingsLocalMessageHandler alloc] initWithHomeUUID:dCopy languageValuesDataProvider:providerCopy];

  return v7;
}

- (HMDAccessoryCount)accessoryCount
{
  v2 = [[HMDAccessoryCount alloc] initWithHome:self];

  return v2;
}

- (id)createSiriEndpointProfileMessageHandlerWithHomeUUID:(id)d
{
  dCopy = d;
  v4 = [[HMDSiriEndpointProfileMessageHandler alloc] initWithHomeUUID:dCopy];

  return v4;
}

- (id)createPrimaryResidentMessageRouterMetricsDispatcherWithLogEventSubmitter:(id)submitter
{
  submitterCopy = submitter;
  v4 = [[HMDPrimaryResidentMessageRouterMetricsDispatcher alloc] initWithLogEventSubmitter:submitterCopy];

  return v4;
}

- (void)_reconfigureAccessoriesOnRouterRemovalWithCompletion:(id)completion
{
  v46 = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  accessories = [(HMDHome *)self accessories];
  v7 = [accessories hmf_objectsPassingTest:&__block_literal_global_2];

  if ([v7 count])
  {
    activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
    networkRouterController = [activeNetworkRouterAccessory networkRouterController];
    wiFiSSID = [networkRouterController wiFiSSID];

    v11 = [HMDWiFiManagementController sharedPSKForNetworkWithSSID:wiFiSSID];
    v12 = v11;
    v32 = wiFiSSID;
    if (wiFiSSID && v11)
    {
      block = completionCopy;
      v31 = v11;
      v13 = objc_autoreleasePoolPush();
      selfCopy = self;
      v15 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = HMFGetLogIdentifier();
        *buf = 138543874;
        v41 = v16;
        v42 = 2048;
        v43 = [v7 count];
        v44 = 2112;
        v45 = v32;
        _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_INFO, "%{public}@Reconfiguring %ld accessories on '%@' due to router removal", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v13);
      v17 = dispatch_group_create();
      v35 = 0u;
      v36 = 0u;
      v37 = 0u;
      v38 = 0u;
      v18 = v7;
      v19 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v36;
        do
        {
          for (i = 0; i != v20; ++i)
          {
            if (*v36 != v21)
            {
              objc_enumerationMutation(v18);
            }

            v23 = *(*(&v35 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v24 = v23;
            }

            else
            {
              v24 = 0;
            }

            v25 = v24;

            wiFiManagementController = [v25 wiFiManagementController];

            if (wiFiManagementController)
            {
              dispatch_group_enter(v17);
              v27 = objc_alloc_init(HMDWiFiReconfigurationLogEvent);
              [(HMDWiFiReconfigurationLogEvent *)v27 setCredentialType:2];
              v33[0] = MEMORY[0x277D85DD0];
              v33[1] = 3221225472;
              v33[2] = __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5;
              v33[3] = &unk_2797358C8;
              v33[4] = v23;
              v34 = v17;
              [wiFiManagementController reconfigureWithSSID:v32 PSK:v31 logEvent:v27 completion:v33];
            }
          }

          v20 = [v18 countByEnumeratingWithState:&v35 objects:v39 count:16];
        }

        while (v20);
      }

      workQueue2 = [(HMDHome *)selfCopy workQueue];
      completionCopy = block;
      dispatch_group_notify(v17, workQueue2, block);

      v12 = v31;
    }

    else
    {
      completionCopy[2](completionCopy);
    }
  }

  else
  {
    completionCopy[2](completionCopy);
  }

  v29 = *MEMORY[0x277D85DE8];
}

void __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke_5(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) saveWiFiUniquePreSharedKey:0 credentialType:2 * (a2 == 0)];
  v3 = *(a1 + 40);

  dispatch_group_leave(v3);
}

uint64_t __80__HMDHome_WiFiManagement___reconfigureAccessoriesOnRouterRemovalWithCompletion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2);
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (NSArray)accessoriesRequiringManualReconfigurationOnRouterRemoval
{
  accessories = [(HMDHome *)self accessories];
  v3 = [accessories hmf_objectsPassingTest:&__block_literal_global_76098];

  return v3;
}

uint64_t __83__HMDHome_WiFiManagement__accessoriesRequiringManualReconfigurationOnRouterRemoval__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 wiFiCredentialType] == 3)
  {
    v3 = isReconfigurationPossible(v2) ^ 1;
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)playbackArchiveWithSessionIdentifier:(id)identifier
{
  v39 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  actionSets = [(HMDHome *)self actionSets];
  triggerOwnedActionSets = [(HMDHome *)self triggerOwnedActionSets];
  v7 = [actionSets arrayByAddingObjectsFromArray:triggerOwnedActionSets];

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  v8 = v7;
  v26 = [v8 countByEnumeratingWithState:&v33 objects:v38 count:16];
  if (v26)
  {
    v9 = *v34;
    v28 = v8;
    v25 = *v34;
    do
    {
      v10 = 0;
      do
      {
        if (*v34 != v9)
        {
          objc_enumerationMutation(v8);
        }

        v27 = v10;
        v11 = *(*(&v33 + 1) + 8 * v10);
        v29 = 0u;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        actions = [v11 actions];
        v13 = [actions countByEnumeratingWithState:&v29 objects:v37 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v30;
          while (2)
          {
            for (i = 0; i != v14; ++i)
            {
              if (*v30 != v15)
              {
                objc_enumerationMutation(actions);
              }

              v17 = *(*(&v29 + 1) + 8 * i);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v18 = v17;
              }

              else
              {
                v18 = 0;
              }

              v19 = v18;

              playbackArchive = [v19 playbackArchive];
              playbackSessionIdentifier = [playbackArchive playbackSessionIdentifier];
              v22 = [playbackSessionIdentifier isEqualToString:identifierCopy];

              if (v22)
              {

                v8 = v28;
                goto LABEL_22;
              }
            }

            v14 = [actions countByEnumeratingWithState:&v29 objects:v37 count:16];
            if (v14)
            {
              continue;
            }

            break;
          }
        }

        v10 = v27 + 1;
        v8 = v28;
        v9 = v25;
      }

      while (v27 + 1 != v26);
      playbackArchive = 0;
      v26 = [v28 countByEnumeratingWithState:&v33 objects:v38 count:16];
    }

    while (v26);
  }

  else
  {
    playbackArchive = 0;
  }

LABEL_22:

  v23 = *MEMORY[0x277D85DE8];

  return playbackArchive;
}

- (id)createAccessorySettingsMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler logEventSubmitter:(id)submitter legacyMessageReceiver:(id)receiver
{
  v37 = *MEMORY[0x277D85DE8];
  dCopy = d;
  dispatcherCopy = dispatcher;
  routerCopy = router;
  handlerCopy = handler;
  submitterCopy = submitter;
  receiverCopy = receiver;
  v20 = objc_autoreleasePoolPush();
  selfCopy = self;
  v22 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    v23 = HMFGetLogIdentifier();
    v27 = 138544386;
    v28 = v23;
    v29 = 2112;
    v30 = dCopy;
    v31 = 2112;
    v32 = dispatcherCopy;
    v33 = 2112;
    v34 = routerCopy;
    v35 = 2112;
    v36 = handlerCopy;
    _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_INFO, "%{public}@Creating accessory settings messenger with message target UUID: %@ message dispatcher: %@ message router: %@ message handler: %@", &v27, 0x34u);
  }

  objc_autoreleasePoolPop(v20);
  v24 = [[HMDAccessorySettingsMessenger alloc] initWithMessageTargetUUID:dCopy messageDispatcher:dispatcherCopy messageRouter:routerCopy messageHandler:handlerCopy logEventSubmitter:submitterCopy legacyMessageReceiver:receiverCopy];

  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

- (void)configureAccessorySettingsMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory
{
  v33 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  handlerFactoryCopy = handlerFactory;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    *buf = 138543362;
    v32 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring accessory settings messenger", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  accessoryMessageRouterViaPrimary = [(HMDHome *)selfCopy accessoryMessageRouterViaPrimary];
  unifiedLanguageValueListSettingDataProvider = [(HMDHome *)selfCopy unifiedLanguageValueListSettingDataProvider];
  if (!msgDispatcher)
  {
    _HMFPreconditionFailure();
    goto LABEL_8;
  }

  if (!accessoryMessageRouterViaPrimary)
  {
LABEL_8:
    _HMFPreconditionFailure();
LABEL_9:
    _HMFPreconditionFailure();
  }

  v15 = unifiedLanguageValueListSettingDataProvider;
  if (!unifiedLanguageValueListSettingDataProvider)
  {
    goto LABEL_9;
  }

  uuid = [(HMDHome *)selfCopy uuid];
  v17 = [handlerFactoryCopy createAccessorySettingsLocalMessageHandlerWithHomeUUID:uuid languageValuesDataProvider:v15];

  [v17 setDataSource:selfCopy];
  homeManager = [(HMDHome *)selfCopy homeManager];
  compositeSettingsControllerManager = [homeManager compositeSettingsControllerManager];
  [v17 setDelegate:compositeSettingsControllerManager];

  v20 = MEMORY[0x277CD17B0];
  uuid2 = [(HMDHome *)selfCopy uuid];
  v22 = [v20 legacyMessageTargetUUIDWithHomeUUID:uuid2];

  v23 = [[HMDAccessorySettingsLegacyMessageReceiver alloc] initWithMessageTargetUUID:v22 messageDispatcher:msgDispatcher];
  accessorySettingsMessengerMessageTargetUUID = [(HMDHome *)selfCopy accessorySettingsMessengerMessageTargetUUID];
  [(HMDHome *)selfCopy logEventSubmitter];
  v29 = v15;
  v26 = v25 = factoryCopy;
  [v25 createAccessorySettingsMessengerWithMessageTargetUUID:accessorySettingsMessengerMessageTargetUUID messageDispatcher:msgDispatcher messageRouter:accessoryMessageRouterViaPrimary messageHandler:v17 logEventSubmitter:v26 legacyMessageReceiver:v23];
  v27 = v30 = handlerFactoryCopy;

  [(HMDAccessorySettingsLegacyMessageReceiver *)v23 setMessenger:v27];
  [v27 registerForMessagesWithHome:selfCopy];
  [(HMDHome *)selfCopy setAccessorySettingsMessenger:v27];

  v28 = *MEMORY[0x277D85DE8];
}

- (id)accessorySettingsMessengerMessageTargetUUID
{
  v2 = MEMORY[0x277CD17B0];
  uuid = [(HMDHome *)self uuid];
  v4 = [v2 messageTargetUUIDWithHomeUUID:uuid];

  return v4;
}

- (id)hubAccessories
{
  appleMediaAccessories = [(HMDHome *)self appleMediaAccessories];
  v3 = [appleMediaAccessories na_filter:&__block_literal_global_104469];

  return v3;
}

- (id)createAppleMediaAccessoriesStateMessengerWithIdentifier:(id)identifier messageDispatcher:(id)dispatcher
{
  dispatcherCopy = dispatcher;
  identifierCopy = identifier;
  v7 = [[HMDAppleMediaAccessoriesStateMessenger alloc] initWithIdentifier:identifierCopy messageDispatcher:dispatcherCopy];

  return v7;
}

- (BOOL)isCarPlayAccessAllowedForActionSet:(id)set withMessage:(id)message fromSource:(unint64_t)source
{
  v21 = *MEMORY[0x277D85DE8];
  setCopy = set;
  messageCopy = message;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:messageCopy source:source]& 1) == 0)
  {
    v12 = objc_autoreleasePoolPush();
    selfCopy = self;
    v14 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = HMFGetLogIdentifier();
      *v18 = 138543874;
      *&v18[4] = v15;
      *&v18[12] = 2112;
      *&v18[14] = setCopy;
      *&v18[22] = 2048;
      sourceCopy = source;
      _os_log_impl(&dword_2531F8000, v14, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for action set: %@ because message from source: %lu does not have sufficient entitlements", v18, 0x20u);
    }

    objc_autoreleasePoolPop(v12);
    goto LABEL_9;
  }

  if (self)
  {
    if ([(HMDHome *)self homeLocation]== 1 || [(HMDHome *)self homeLocation]== 3)
    {
      actions = [setCopy actions];
      v11 = [actions na_filter:&__block_literal_global_107220];

      *v18 = MEMORY[0x277D85DD0];
      *&v18[8] = 3221225472;
      *&v18[16] = __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2;
      sourceCopy = &unk_27972AF48;
      selfCopy2 = self;
      LOBYTE(self) = [v11 na_all:v18];

      goto LABEL_10;
    }

LABEL_9:
    LOBYTE(self) = 0;
  }

LABEL_10:

  v16 = *MEMORY[0x277D85DE8];
  return self;
}

- (uint64_t)isMessageEntitledForCarPlayAccess:(uint64_t)access source:
{
  v5 = a2;
  v6 = v5;
  if (!self)
  {
    goto LABEL_5;
  }

  if (access != 1)
  {
    if ([v5 isEntitledForSecureAccess])
    {
      access = [v6 isEntitledForSPIAccess];
      goto LABEL_6;
    }

LABEL_5:
    access = 0;
  }

LABEL_6:

  return access;
}

uint64_t __55__HMDHome_CarPlay__isActionSetAllowedForCarPlayAccess___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = *(a1 + 32);
  v3 = a2;
  v4 = v3;
  if (v2 && ![v3 type])
  {
    v6 = v4;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = v6;
    }

    else
    {
      v7 = 0;
    }

    v8 = v7;

    if (v8)
    {
      v9 = [v8 characteristic];
      v5 = [HMDHome isCharacteristicAllowedForCarPlayAccess:v9];
    }

    else
    {
      v5 = 0;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (uint64_t)isCharacteristicAllowedForCarPlayAccess:(void *)access
{
  service = [access service];
  serviceType = [service serviceType];

  if ([serviceType isEqualToString:*MEMORY[0x277CD0E58]])
  {
    v3 = 1;
  }

  else
  {
    v3 = [serviceType isEqualToString:*MEMORY[0x277CD0EB0]];
  }

  return v3;
}

- (BOOL)isCarPlayAccessAllowedForCharacteristic:(id)characteristic withMessage:(id)message fromSource:(unint64_t)source
{
  v23 = *MEMORY[0x277D85DE8];
  characteristicCopy = characteristic;
  messageCopy = message;
  if (([(HMDHome *)self isMessageEntitledForCarPlayAccess:messageCopy source:source]& 1) == 0)
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543874;
      v18 = v14;
      v19 = 2112;
      v20 = characteristicCopy;
      v21 = 2048;
      sourceCopy = source;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_INFO, "%{public}@CarPlay access is not allowed for characteristic: %@ because message from source: %lu does not have sufficient entitlements", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v11);
    goto LABEL_9;
  }

  if (!self || [(HMDHome *)self homeLocation]!= 1 && [(HMDHome *)self homeLocation]!= 3)
  {
LABEL_9:
    v10 = 0;
    goto LABEL_10;
  }

  v10 = [HMDHome isCharacteristicAllowedForCarPlayAccess:characteristicCopy];
LABEL_10:

  v15 = *MEMORY[0x277D85DE8];
  return v10;
}

- (BOOL)synchronouslyFetchIsConnectedToCarPlayNetwork
{
  carPlayDataSource = [(HMDHome *)self carPlayDataSource];
  synchronouslyFetchIsConnectedToCarPlayNetwork = [carPlayDataSource synchronouslyFetchIsConnectedToCarPlayNetwork];

  return synchronouslyFetchIsConnectedToCarPlayNetwork;
}

- (BOOL)synchronouslyFetchIsCarPlayConnectedStatus
{
  carPlayDataSource = [(HMDHome *)self carPlayDataSource];
  synchronouslyFetchIsCarPlayConnectedStatus = [carPlayDataSource synchronouslyFetchIsCarPlayConnectedStatus];

  return synchronouslyFetchIsCarPlayConnectedStatus;
}

- (NSDictionary)assistantObject
{
  v21 = *MEMORY[0x277D85DE8];
  name = [(HMDHome *)self name];

  if (name)
  {
    v16[0] = *MEMORY[0x277D48158];
    v4 = [(HMDHome *)self name:@"objectType"];
    v16[1] = v4;
    v15[2] = @"objectIdentifier";
    urlString = [(HMDHome *)self urlString];
    v16[2] = urlString;
    v15[3] = @"objectHomeIdentifier";
    urlString2 = [(HMDHome *)self urlString];
    v15[4] = @"objectReference";
    v16[3] = urlString2;
    v16[4] = self;
    v7 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v16 forKeys:v15 count:5];
  }

  else
  {
    v8 = objc_autoreleasePoolPush();
    v9 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = HMFGetLogIdentifier();
      uuid = [(HMDHome *)self uuid];
      uUIDString = [uuid UUIDString];
      *buf = 138543618;
      v18 = v10;
      v19 = 2112;
      v20 = uUIDString;
      _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_DEFAULT, "%{public}@Skipping because home.name is nil for %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v8);
    v7 = 0;
  }

  v13 = *MEMORY[0x277D85DE8];

  return v7;
}

- (NSString)urlString
{
  v2 = *MEMORY[0x277CCF290];
  uuid = [(HMDHome *)self uuid];
  v4 = hm_assistantIdentifier();

  return v4;
}

- (id)multiUserSettings
{
  v47 = *MEMORY[0x277D85DE8];
  v42 = 0;
  v43 = &v42;
  v44 = 0x2020000000;
  v45 = 0;
  v38 = 0;
  v39 = &v38;
  v40 = 0x2020000000;
  v41 = 0;
  users = [(HMDHome *)self users];
  v3 = [users count];
  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = users;
  v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
  v27 = v3;
  v5 = 0;
  v6 = 0;
  if (v4)
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
    v8 = *v35;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v35 != v8)
        {
          objc_enumerationMutation(obj);
        }

        v10 = *(*(&v34 + 1) + 8 * i);
        if (([v10 isOwner] & 1) == 0)
        {
          sharedSettingValuesByKeyPath = [v10 sharedSettingValuesByKeyPath];
          v12 = [sharedSettingValuesByKeyPath mutableCopy];

          if ([v12 count])
          {
            v33[0] = MEMORY[0x277D85DD0];
            v33[1] = 3221225472;
            v33[2] = __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke;
            v33[3] = &unk_27972BBF8;
            v33[4] = &v42;
            v33[5] = &v38;
            [v12 enumerateKeysAndObjectsUsingBlock:v33];
            ++v32;
          }

          else
          {
            cloudShareTrustManager = [v10 cloudShareTrustManager];
            isTrustConfigured = [cloudShareTrustManager isTrustConfigured];

            sharedUserSettingsLogEventBackingStoreControllerRunState = [v10 sharedUserSettingsLogEventBackingStoreControllerRunState];
            v16 = v28;
            v29 += isTrustConfigured ^ 1u;
            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 5)
            {
              v17 = v6 + 1;
            }

            else
            {
              v17 = v6;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 4)
            {
              v18 = v5 + 1;
            }

            else
            {
              v18 = v5;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 4)
            {
              v17 = v6;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 3)
            {
              v18 = v5;
              v17 = v6;
              v19 = v28 + 1;
            }

            else
            {
              v19 = v28;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState == 2)
            {
              v20 = v7 + 1;
            }

            else
            {
              v20 = v7;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState < 2)
            {
              v20 = v7;
            }

            v21 = v30;
            if (sharedUserSettingsLogEventBackingStoreControllerRunState >= 2)
            {
              v22 = v30;
            }

            else
            {
              v22 = v30 + 1;
            }

            if (sharedUserSettingsLogEventBackingStoreControllerRunState > 2)
            {
              v5 = v18;
              v6 = v17;
              v16 = v19;
            }

            v28 = v16;
            if (sharedUserSettingsLogEventBackingStoreControllerRunState <= 2)
            {
              v7 = v20;
              v21 = v22;
            }

            v30 = v21;
          }
        }
      }

      v4 = [obj countByEnumeratingWithState:&v34 objects:v46 count:16];
    }

    while (v4);
  }

  else
  {
    v28 = 0;
    v29 = 0;
    v7 = 0;
    v30 = 0;
    v32 = 0;
  }

  v23 = objc_alloc(MEMORY[0x277CD1C20]);
  v24 = [v23 initWithNumSharedUsers:(v27 - 1) & ~((v27 - 1) >> 63) numUsersWithSettings:v32 numUsersWithIdentifyVoiceOff:v43[3] numUsersWithPlayBackInfluencesForYouOff:v39[3] numUsersCloudShareTrustNotConfigured:v29 numUsersSharedBackingStoreNotStarted:v30 numUsersSharedBackingStoreRunning:v7 numUsersSharedBackingStoreNotRunningDueToError:v28 numUsersSharedBackingStoreNotRunningDueToStopped:v5 numUsersSharedBackingStoreSharedZoneWaitingForShareInvitation:v6];

  _Block_object_dispose(&v38, 8);
  _Block_object_dispose(&v42, 8);
  v25 = *MEMORY[0x277D85DE8];

  return v24;
}

void __54__HMDHome_MultiUserSettingsMetrics__multiUserSettings__block_invoke(uint64_t a1, void *a2, void *a3)
{
  v14 = a2;
  v5 = a3;
  if ([v14 isEqualToString:@"shared.root.siri.identifyVoice"])
  {
    v6 = v5;
    objc_opt_class();
    v7 = (objc_opt_isKindOfClass() & 1) != 0 ? v6 : 0;
    v8 = v7;

    v9 = [v8 intValue];
    if (!v9)
    {
      ++*(*(*(a1 + 32) + 8) + 24);
    }
  }

  if ([v14 isEqualToString:@"shared.root.music.playbackInfluencesForYou"])
  {
    v10 = v5;
    objc_opt_class();
    v11 = (objc_opt_isKindOfClass() & 1) != 0 ? v10 : 0;
    v12 = v11;

    v13 = [v12 intValue];
    if (!v13)
    {
      ++*(*(*(a1 + 40) + 8) + 24);
    }
  }
}

- (void)_evaluateNetworkProtectionSupport
{
  selfCopy = self;
  v86 = *MEMORY[0x277D85DE8];
  v66 = 0u;
  v67 = 0u;
  v68 = 0u;
  v69 = 0u;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  residentDevices = [residentDeviceManager residentDevices];

  v5 = [residentDevices countByEnumeratingWithState:&v66 objects:v85 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v67;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v67 != v7)
        {
          objc_enumerationMutation(residentDevices);
        }

        v9 = *(*(&v66 + 1) + 8 * i);
        device = [v9 device];
        if ([v9 isEnabled])
        {
          capabilities = [v9 capabilities];
          supportsRouterManagement = [capabilities supportsRouterManagement];

          if (supportsRouterManagement)
          {
            minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)selfCopy minimumNetworkRouterSupportHomeKitVersion];
            if (!minimumNetworkRouterSupportHomeKitVersion)
            {
              goto LABEL_13;
            }

            v14 = minimumNetworkRouterSupportHomeKitVersion;
            version = [device version];
            [(HMDHome *)selfCopy minimumNetworkRouterSupportHomeKitVersion];
            v16 = v7;
            v17 = residentDevices;
            v19 = v18 = selfCopy;
            v64 = [version isAtLeastVersion:v19];

            selfCopy = v18;
            residentDevices = v17;
            v7 = v16;

            if (v64)
            {
LABEL_13:
              v21 = objc_autoreleasePoolPush();
              v22 = selfCopy;
              v23 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
              {
                HMFGetLogIdentifier();
                v25 = v24 = selfCopy;
                *buf = 138543618;
                v76 = v25;
                v77 = 2112;
                v78 = v9;
                _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_INFO, "%{public}@Found resident with router management support: %@", buf, 0x16u);

                selfCopy = v24;
              }

              objc_autoreleasePoolPop(v21);
              v20 = 1;
              goto LABEL_16;
            }
          }
        }
      }

      v6 = [residentDevices countByEnumeratingWithState:&v66 objects:v85 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v20 = 0;
LABEL_16:

  activeNetworkRouterAccessory = [(HMDHome *)selfCopy activeNetworkRouterAccessory];

  _isNetworkRouterSupportEnabledForCurrentDevice = [(HMDHome *)selfCopy _isNetworkRouterSupportEnabledForCurrentDevice];
  v28 = objc_autoreleasePoolPush();
  v29 = selfCopy;
  v30 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
  {
    v31 = _isNetworkRouterSupportEnabledForCurrentDevice;
    v32 = HMFGetLogIdentifier();
    name = [(HMDHome *)v29 name];
    v34 = HMFBooleanToString();
    v35 = HMFBooleanToString();
    HMFBooleanToString();
    v36 = v65 = v28;
    *buf = 138544386;
    v76 = v32;
    v77 = 2112;
    v78 = name;
    v79 = 2112;
    v80 = v34;
    v81 = 2112;
    v82 = v35;
    v83 = 2112;
    v84 = v36;
    _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_INFO, "%{public}@Evaluating network protection support for home %@, Router Managing Device: %@, Active Network Router Accessory: %@, Router support enabled: %@", buf, 0x34u);

    v28 = v65;
    _isNetworkRouterSupportEnabledForCurrentDevice = v31;
  }

  objc_autoreleasePoolPop(v28);
  minHomeKitVersionForAccessoryNetworkProtectionChange = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
  if (minHomeKitVersionForAccessoryNetworkProtectionChange)
  {
    v38 = minHomeKitVersionForAccessoryNetworkProtectionChange;
    minHomeKitVersionForAccessoryNetworkProtectionChange2 = [(HMDHome *)v29 minHomeKitVersionForAccessoryNetworkProtectionChange];
    v40 = +[HMDHomeKitVersion currentVersion];
    v41 = [minHomeKitVersionForAccessoryNetworkProtectionChange2 isGreaterThanVersion:v40];

    v42 = v41 ^ 1;
  }

  else
  {
    v42 = 1;
  }

  isAdminUser = [(HMDHome *)v29 isAdminUser];
  v44 = 4;
  if (isAdminUser)
  {
    v44 = 0;
  }

  if (!activeNetworkRouterAccessory)
  {
    v44 |= 8uLL;
  }

  v45 = v44 | v20 ^ 1u;
  if (!_isNetworkRouterSupportEnabledForCurrentDevice)
  {
    v45 |= 2uLL;
  }

  if (v42)
  {
    v46 = v45;
  }

  else
  {
    v46 = v45 | 0x10;
  }

  if ([(HMDHome *)v29 networkRouterSupportDisableReason]!= v46)
  {
    [(HMDHome *)v29 setNetworkRouterSupportDisableReason:v46];
    [(HMDHome *)v29 setNetworkRouterSupport:[(HMDHome *)v29 deriveNetworkRouterSupport:v46]];
    v47 = ([(HMDHome *)v29 networkRouterSupport]>> 2) & 1;
    v48 = MEMORY[0x277D0F848];
    v49 = *MEMORY[0x277CD0470];
    messageDestination = [(HMDHome *)v29 messageDestination];
    v72 = *MEMORY[0x277CD0468];
    v51 = [MEMORY[0x277CCABB0] numberWithUnsignedInteger:v46];
    v74[0] = v51;
    v73 = *MEMORY[0x277CCFE18];
    v52 = v73;
    v53 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v74[1] = v53;
    v54 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v74 forKeys:&v72 count:2];
    v55 = [v48 messageWithName:v49 destination:messageDestination payload:v54];

    [v55 setRequiresSPIEntitlement];
    msgDispatcher = [(HMDHome *)v29 msgDispatcher];
    [msgDispatcher sendMessage:v55 completionHandler:0];

    v57 = MEMORY[0x277D0F848];
    messageDestination2 = [(HMDHome *)v29 messageDestination];
    v70 = v52;
    v59 = [MEMORY[0x277CCABB0] numberWithBool:v47];
    v71 = v59;
    v60 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v71 forKeys:&v70 count:1];
    v61 = [v57 messageWithName:v49 destination:messageDestination2 payload:v60];

    [v61 setRequiresNoSPIEntitlement];
    msgDispatcher2 = [(HMDHome *)v29 msgDispatcher];
    [msgDispatcher2 sendMessage:v61 completionHandler:0];
  }

  v63 = *MEMORY[0x277D85DE8];
}

- (void)_requestRemoveClientConfigurationWithIdentifier:(id)identifier
{
  location[3] = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];

  if (device)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:uuid device:device];

    v11 = objc_alloc(MEMORY[0x277D0F848]);
    v26 = @"HMDH.NetworkClientIdentifierMessageKey";
    v27 = identifierCopy;
    v12 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:&v27 forKeys:&v26 count:1];
    v13 = [v11 initWithName:@"HMDHomeRemoveClientConfigurationRequestKey" destination:v10 payload:v12];

    [v13 setSecureRemote:1];
    objc_initWeak(location, self);
    v20 = MEMORY[0x277D85DD0];
    v21 = 3221225472;
    v22 = __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke;
    v23 = &unk_279733AE8;
    objc_copyWeak(&v25, location);
    v24 = identifierCopy;
    [v13 setResponseHandler:&v20];
    v14 = [(HMDHome *)self msgDispatcher:v20];
    [v14 sendMessage:v13 completionHandler:0];

    objc_destroyWeak(&v25);
    objc_destroyWeak(location);
  }

  else
  {
    v15 = objc_autoreleasePoolPush();
    selfCopy = self;
    v17 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v18;
      _os_log_impl(&dword_2531F8000, v17, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request to remove client configuration", location, 0xCu);
    }

    objc_autoreleasePoolPop(v15);
  }

  v19 = *MEMORY[0x277D85DE8];
}

void __82__HMDHome_NetworkRouterInternal___requestRemoveClientConfigurationWithIdentifier___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v26 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = WeakRetained;
    v10 = HMFGetOSLogHandle();
    v11 = v10;
    if (v5)
    {
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = HMFGetLogIdentifier();
        v13 = *(a1 + 32);
        v20 = 138543874;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        v24 = 2112;
        v25 = v5;
        v14 = "%{public}@Request to remove client configuration %@ failed with error: %@";
        v15 = v11;
        v16 = OS_LOG_TYPE_ERROR;
        v17 = 32;
LABEL_7:
        _os_log_impl(&dword_2531F8000, v15, v16, v14, &v20, v17);
      }
    }

    else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v18 = *(a1 + 32);
      v20 = 138543618;
      v21 = v12;
      v22 = 2112;
      v23 = v18;
      v14 = "%{public}@Request remove client configuration %@ successful";
      v15 = v11;
      v16 = OS_LOG_TYPE_INFO;
      v17 = 22;
      goto LABEL_7;
    }

    objc_autoreleasePoolPop(v8);
  }

  v19 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)identifier completion:(id)completion
{
  v28 = *MEMORY[0x277D85DE8];
  identifierCopy = identifier;
  completionCopy = completion;
  activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
  networkRouterController = [activeNetworkRouterAccessory networkRouterController];

  if (networkRouterController)
  {
    v19[0] = MEMORY[0x277D85DD0];
    v19[1] = 3221225472;
    v19[2] = __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke;
    v19[3] = &unk_279735168;
    v19[4] = self;
    v20 = identifierCopy;
    v21 = completionCopy;
    [networkRouterController removeClientConfigurationWithClientIdentifier:v20 completion:v19];
  }

  else
  {
    v10 = objc_autoreleasePoolPush();
    selfCopy = self;
    v12 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = HMFGetLogIdentifier();
      activeNetworkRouterAccessory2 = [(HMDHome *)selfCopy activeNetworkRouterAccessory];
      uuid = [activeNetworkRouterAccessory2 uuid];
      uUIDString = [uuid UUIDString];
      *buf = 138543874;
      v23 = v13;
      v24 = 2112;
      v25 = identifierCopy;
      v26 = 2112;
      v27 = uUIDString;
      _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to no router controller found on the active network router %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v10);
    if (completionCopy)
    {
      v17 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];
      (*(completionCopy + 2))(completionCopy, v17);
    }
  }

  v18 = *MEMORY[0x277D85DE8];
}

void __86__HMDHome_NetworkRouterInternal___removeClientConfigurationWithIdentifier_completion___block_invoke(uint64_t a1, void *a2)
{
  v22 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  v7 = v6;
  if (v3)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      v9 = *(a1 + 40);
      v16 = 138543874;
      v17 = v8;
      v18 = 2112;
      v19 = v9;
      v20 = 2112;
      v21 = v3;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to remove client configuration %@ due to error %@", &v16, 0x20u);
    }

    objc_autoreleasePoolPop(v4);
    v10 = *(a1 + 48);
    if (v10)
    {
      v11 = *(v10 + 16);
LABEL_10:
      v11();
    }
  }

  else
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = *(a1 + 40);
      v16 = 138543618;
      v17 = v12;
      v18 = 2112;
      v19 = v13;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Removed client configuration %@ successfully", &v16, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
    v14 = *(a1 + 48);
    if (v14)
    {
      v11 = *(v14 + 16);
      goto LABEL_10;
    }
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_removeClientConfigurationWithIdentifier:(id)identifier
{
  identifierCopy = identifier;
  if ([(HMDHome *)self isOwnerUser])
  {
    [(HMDHome *)self _removeClientConfigurationWithIdentifier:identifierCopy completion:0];
  }

  else
  {
    [(HMDHome *)self _requestRemoveClientConfigurationWithIdentifier:identifierCopy];
  }
}

- (void)_requestUniquePSKClientConfigurationWithCompletion:(id)completion
{
  location[3] = *MEMORY[0x277D85DE8];
  completionCopy = completion;
  residentDeviceManager = [(HMDHome *)self residentDeviceManager];
  primaryResidentDevice = [residentDeviceManager primaryResidentDevice];
  device = [primaryResidentDevice device];

  if (device)
  {
    v8 = [HMDRemoteDeviceMessageDestination alloc];
    uuid = [(HMDHome *)self uuid];
    v10 = [(HMDRemoteDeviceMessageDestination *)v8 initWithTarget:uuid device:device];

    v11 = [objc_alloc(MEMORY[0x277D0F848]) initWithName:@"HMDHomeCreateUniquePSKClientConfigurationRequestKey" destination:v10 payload:0];
    [v11 setSecureRemote:1];
    objc_initWeak(location, self);
    v18 = MEMORY[0x277D85DD0];
    v19 = 3221225472;
    v20 = __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke;
    v21 = &unk_2797355F8;
    objc_copyWeak(&v23, location);
    v22 = completionCopy;
    [v11 setResponseHandler:&v18];
    v12 = [(HMDHome *)self msgDispatcher:v18];
    [v12 sendMessage:v11 completionHandler:0];

    objc_destroyWeak(&v23);
    objc_destroyWeak(location);
  }

  else
  {
    v13 = objc_autoreleasePoolPush();
    selfCopy = self;
    v15 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = HMFGetLogIdentifier();
      LODWORD(location[0]) = 138543362;
      *(location + 4) = v16;
      _os_log_impl(&dword_2531F8000, v15, OS_LOG_TYPE_ERROR, "%{public}@No primary resident device to request unique PSK from", location, 0xCu);
    }

    objc_autoreleasePoolPop(v13);
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:91];
    (*(completionCopy + 2))(completionCopy, 0, v10);
  }

  v17 = *MEMORY[0x277D85DE8];
}

void __85__HMDHome_NetworkRouterInternal___requestUniquePSKClientConfigurationWithCompletion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v45 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    if (v5)
    {
      v8 = objc_autoreleasePoolPush();
      v9 = WeakRetained;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = HMFGetLogIdentifier();
        *buf = 138543618;
        v38 = v11;
        v39 = 2112;
        v40 = v5;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Request for unique PSK failed with error: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v8);
      (*(*(a1 + 32) + 16))();
    }

    else
    {
      v12 = [v6 hmf_dataForKey:@"HMDH.UniquePSKMessageKey"];
      v13 = [v6 hmf_numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
      v14 = objc_alloc(MEMORY[0x277CCAD78]);
      v15 = [v6 hmf_stringForKey:@"HMDH.NetworkRouterUUIDMessageKey"];
      v16 = [v14 initWithUUIDString:v15];

      v17 = objc_autoreleasePoolPush();
      v18 = WeakRetained;
      v19 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
      {
        HMFGetLogIdentifier();
        v33 = v17;
        v21 = v20 = v13;
        HMFBooleanToString();
        v22 = v34 = v12;
        [v16 UUIDString];
        v23 = v35 = v16;
        *buf = 138544130;
        v38 = v21;
        v39 = 2112;
        v40 = v22;
        v41 = 2112;
        v42 = v20;
        v43 = 2112;
        v44 = v23;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEBUG, "%{public}@Request for unique PSK results successful. PSK: %@, Client Identifier: %@, Network Router UUID: %@", buf, 0x2Au);

        v16 = v35;
        v12 = v34;

        v13 = v20;
        v17 = v33;
      }

      objc_autoreleasePoolPop(v17);
      if (v12 && v13 && v16)
      {
        v24 = [[HMDAccessoryNetworkCredential alloc] initWithNetworkRouterUUID:v16 clientIdentifier:v13 wiFiPSK:v12];
        v25 = *(*(a1 + 32) + 16);
      }

      else
      {
        v26 = objc_autoreleasePoolPush();
        v27 = v18;
        v28 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
        {
          HMFGetLogIdentifier();
          v36 = v16;
          v30 = v29 = v13;
          *buf = 138543362;
          v38 = v30;
          _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Missing info in response", buf, 0xCu);

          v13 = v29;
          v16 = v36;
        }

        objc_autoreleasePoolPop(v26);
        v31 = *(a1 + 32);
        v24 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
        v25 = *(v31 + 16);
      }

      v25();
    }
  }

  v32 = *MEMORY[0x277D85DE8];
}

- (void)_createUniquePSKClientConfigurationWithRequestMessage:(id)message pairingEvent:(id)event completion:(id)completion
{
  messageCopy = message;
  eventCopy = event;
  completionCopy = completion;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x277D85DD0];
  aBlock[1] = 3221225472;
  aBlock[2] = __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke;
  aBlock[3] = &unk_27972CA80;
  objc_copyWeak(&v19, &location);
  v11 = eventCopy;
  v16 = v11;
  v12 = messageCopy;
  v17 = v12;
  v13 = completionCopy;
  v18 = v13;
  v14 = _Block_copy(aBlock);
  [(HMDHome *)self _requestUniquePSKClientConfigurationWithCompletion:v14];

  objc_destroyWeak(&v19);
  objc_destroyWeak(&location);
}

void __112__HMDHome_NetworkRouterInternal___createUniquePSKClientConfigurationWithRequestMessage_pairingEvent_completion___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v11 = a2;
  v5 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (WeakRetained)
  {
    v7 = *(a1 + 48);
    if (v5)
    {
      v8 = [MEMORY[0x277CCA9B8] hmErrorWithCode:98 description:0 reason:0 suggestion:0 underlyingError:v5];
      (*(v7 + 16))(v7, v11, v8);
    }

    else
    {
      (*(v7 + 16))(v7, v11, 0);
    }
  }

  else
  {
    v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:2];

    if (*(a1 + 32))
    {
      v10 = +[HMDMetricsManager sharedLogEventSubmitter];
      [v10 submitLogEvent:*(a1 + 32) error:v9];
    }

    [*(a1 + 40) respondWithError:v9];
  }
}

- (void)_evaluateNetworkProtectionAndRouterManagement
{
  v23 = *MEMORY[0x277D85DE8];
  [(HMDHome *)self _evaluateNetworkProtectionSupport];
  activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
  networkRouterController = [activeNetworkRouterAccessory networkRouterController];

  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (networkRouterController)
  {
    if (v8)
    {
      v9 = HMFGetLogIdentifier();
      uuid = [activeNetworkRouterAccessory uuid];
      uUIDString = [uuid UUIDString];
      name = [activeNetworkRouterAccessory name];
      v17 = 138543874;
      v18 = v9;
      v19 = 2112;
      v20 = uUIDString;
      v21 = 2112;
      v22 = name;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Found active network router accessory %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy _configureNetworkRouterClientManager:activeNetworkRouterAccessory];
  }

  else
  {
    if (v8)
    {
      v13 = HMFGetLogIdentifier();
      activeNetworkRouterUUID = [(HMDHome *)selfCopy activeNetworkRouterUUID];
      name2 = [activeNetworkRouterAccessory name];
      v17 = 138543874;
      v18 = v13;
      v19 = 2112;
      v20 = activeNetworkRouterUUID;
      v21 = 2112;
      v22 = name2;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@No active network router accessory with router info %@/%@", &v17, 0x20u);
    }

    objc_autoreleasePoolPop(v5);
    [(HMDHome *)selfCopy _unconfigureNetworkRouterClientManager];
  }

  v16 = *MEMORY[0x277D85DE8];
}

- (void)_handleNetworkProtectionModeChangeForTransaction:(id)transaction
{
  transactionCopy = transaction;
  userInfo = [transactionCopy userInfo];
  [userInfo setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"NetworkProtectionModeChanged"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:transactionCopy];
}

- (void)_evaluateNetworkRouterManagementForTransaction:(id)transaction
{
  transactionCopy = transaction;
  userInfo = [transactionCopy userInfo];
  [userInfo setObject:MEMORY[0x277CBEC38] forKeyedSubscript:@"EvaluateRouterManagement"];

  [(HMDHome *)self _scheduleApplyNetworkRouterSettingsAction:transactionCopy];
}

- (void)_scheduleApplyNetworkRouterSettingsAction:(id)action
{
  v3[0] = MEMORY[0x277D85DD0];
  v3[1] = 3221225472;
  v3[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke;
  v3[3] = &unk_27972CA58;
  v3[4] = self;
  [action addPostApplyActionIfNotPresent:@"HMDNetworkRouterApplySettingsAction" usingBlock:v3];
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2;
  v7[3] = &unk_2797359B0;
  v5 = *(a1 + 32);
  v8 = v3;
  v9 = v5;
  v6 = v3;
  dispatch_async(v4, v7);
}

void __76__HMDHome_NetworkRouterInternal___scheduleApplyNetworkRouterSettingsAction___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"EvaluateRouterManagement"];

  if (v3)
  {
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  v4 = [*(a1 + 32) userInfo];
  v5 = [v4 objectForKeyedSubscript:@"NetworkProtectionModeChanged"];

  if (v5)
  {
    v6 = [MEMORY[0x277CCAB98] defaultCenter];
    [v6 postNotificationName:@"HMDHomeNetworkProtectionUpdatedNotificationKey" object:*(a1 + 40)];
  }
}

- (void)handleAccessoryDidRemoveNetworkRouterControllerNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = notificationCopy;
  selfCopy = self;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __94__HMDHome_NetworkRouterInternal__handleAccessoryDidRemoveNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v17 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [*(a1 + 40) activeNetworkRouterAccessory];
  v7 = [v6 isEqual:v5];
  v8 = objc_autoreleasePoolPush();
  v9 = *(a1 + 40);
  v10 = HMFGetOSLogHandle();
  v11 = os_log_type_enabled(v10, OS_LOG_TYPE_INFO);
  if (v7)
  {
    if (v11)
    {
      v12 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v12;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
    [*(a1 + 40) _addTransactionForActiveNetworkRouterAccessory:0 isReplacement:0];
  }

  else
  {
    if (v11)
    {
      v13 = HMFGetLogIdentifier();
      v15 = 138543362;
      v16 = v13;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Removed network router profile for non-active network router accessory", &v15, 0xCu);
    }

    objc_autoreleasePoolPop(v8);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)handleAccessoryDidAddNetworkRouterControllerNotification:(id)notification
{
  notificationCopy = notification;
  workQueue = [(HMDHome *)self workQueue];
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke;
  v7[3] = &unk_2797359B0;
  v8 = notificationCopy;
  selfCopy = self;
  v6 = notificationCopy;
  dispatch_async(workQueue, v7);
}

void __91__HMDHome_NetworkRouterInternal__handleAccessoryDidAddNetworkRouterControllerNotification___block_invoke(uint64_t a1)
{
  v25 = *MEMORY[0x277D85DE8];
  v2 = [*(a1 + 32) userInfo];
  v3 = [v2 objectForKeyedSubscript:@"HMDNetworkRouterAccessoryNotificationKey"];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = v3;
  }

  else
  {
    v4 = 0;
  }

  v5 = v4;

  if (!v5)
  {
    _HMFPreconditionFailure();
  }

  v6 = [v5 uuid];
  v7 = [*(a1 + 40) activeNetworkRouterUUID];
  v8 = [v6 isEqual:v7];

  v9 = objc_autoreleasePoolPush();
  v10 = *(a1 + 40);
  v11 = HMFGetOSLogHandle();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v8)
  {
    if (v12)
    {
      v13 = HMFGetLogIdentifier();
      v14 = [v5 uuid];
      v19 = 138543618;
      v20 = v13;
      v21 = 2112;
      v22 = v14;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Added network router controller is for active network router accessory %@", &v19, 0x16u);
    }

    objc_autoreleasePoolPop(v9);
    [*(a1 + 40) _evaluateNetworkProtectionAndRouterManagement];
  }

  else
  {
    if (v12)
    {
      v15 = HMFGetLogIdentifier();
      v16 = [v5 uuid];
      v17 = [*(a1 + 40) activeNetworkRouterUUID];
      v19 = 138543874;
      v20 = v15;
      v21 = 2112;
      v22 = v16;
      v23 = 2112;
      v24 = v17;
      _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_INFO, "%{public}@Ignoring added network router controller for accessory %@ since it is not for the active network router accessory %@", &v19, 0x20u);
    }

    objc_autoreleasePoolPop(v9);
  }

  v18 = *MEMORY[0x277D85DE8];
}

- (void)_unconfigureNetworkRouterClientManager
{
  v12 = *MEMORY[0x277D85DE8];
  routerClientManager = [(HMDHome *)self routerClientManager];
  if (routerClientManager)
  {
    v4 = objc_autoreleasePoolPush();
    selfCopy = self;
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543362;
      v11 = v7;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Shutting down firewall rule manager and network router client manager", &v10, 0xCu);
    }

    objc_autoreleasePoolPop(v4);
    [routerClientManager stop];
    [(HMDHome *)selfCopy setRouterClientManager:0];
    v8 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
    [v8 shutdownForClient:routerClientManager];
  }

  v9 = *MEMORY[0x277D85DE8];
}

- (void)_configureNetworkRouterClientManager:(id)manager
{
  v32 = *MEMORY[0x277D85DE8];
  managerCopy = manager;
  if ([(HMDHome *)self supportsRouterManagement])
  {
    routerClientManager = [(HMDHome *)self routerClientManager];

    if (routerClientManager)
    {
      routerClientManager2 = [(HMDHome *)self routerClientManager];
      [routerClientManager2 replaceActiveNetworkRouterAccessory:managerCopy];
    }

    else
    {
      v7 = objc_autoreleasePoolPush();
      selfCopy = self;
      v9 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = HMFGetLogIdentifier();
        name = [managerCopy name];
        uuid = [managerCopy uuid];
        uUIDString = [uuid UUIDString];
        *buf = 138543874;
        v27 = v10;
        v28 = 2112;
        v29 = name;
        v30 = 2112;
        v31 = uUIDString;
        _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Creating network router client manager with accessory %@/%@", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v7);
      v14 = +[HMDNetworkRouterFirewallRuleManager sharedInstance];
      v15 = [HMDNetworkRouterClientManager alloc];
      workQueue = [(HMDHome *)selfCopy workQueue];
      defaultCenter = [MEMORY[0x277CCAB98] defaultCenter];
      v18 = [(HMDNetworkRouterClientManager *)v15 initWithNetworkRouterAccessory:managerCopy workQueue:workQueue firewallRuleManager:v14 notificationCenter:defaultCenter];
      [(HMDHome *)selfCopy setRouterClientManager:v18];

      routerClientManager3 = [(HMDHome *)selfCopy routerClientManager];
      v25[0] = MEMORY[0x277D85DD0];
      v25[1] = 3221225472;
      v25[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke;
      v25[3] = &unk_2797359D8;
      v25[4] = selfCopy;
      [v14 startupForClient:routerClientManager3 completion:v25];

      residentDeviceManager = [(HMDHome *)selfCopy residentDeviceManager];
      routerClientManager4 = [(HMDHome *)selfCopy routerClientManager];
      [residentDeviceManager addDataSource:routerClientManager4];

      residentDeviceManager2 = [(HMDHome *)selfCopy residentDeviceManager];
      v24[0] = MEMORY[0x277D85DD0];
      v24[1] = 3221225472;
      v24[2] = __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84;
      v24[3] = &unk_2797359D8;
      v24[4] = selfCopy;
      [residentDeviceManager2 confirmWithCompletionHandler:v24];
    }
  }

  v23 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke(uint64_t a1, void *a2)
{
  v14 = *MEMORY[0x277D85DE8];
  v3 = a2;
  if (v3)
  {
    v4 = objc_autoreleasePoolPush();
    v5 = *(a1 + 32);
    v6 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v7 = HMFGetLogIdentifier();
      v10 = 138543618;
      v11 = v7;
      v12 = 2112;
      v13 = v3;
      _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_ERROR, "%{public}@Firewall rule manager failed to start with error %@", &v10, 0x16u);
    }

    objc_autoreleasePoolPop(v4);
  }

  else
  {
    v8 = [*(a1 + 32) routerClientManager];
    [v8 evaluateManagement];
  }

  v9 = *MEMORY[0x277D85DE8];
}

void __71__HMDHome_NetworkRouterInternal___configureNetworkRouterClientManager___block_invoke_84(uint64_t a1, void *a2)
{
  v13 = *MEMORY[0x277D85DE8];
  v3 = a2;
  v4 = objc_autoreleasePoolPush();
  v5 = *(a1 + 32);
  v6 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = HMFGetLogIdentifier();
    v9 = 138543618;
    v10 = v7;
    v11 = 2112;
    v12 = v3;
    _os_log_impl(&dword_2531F8000, v6, OS_LOG_TYPE_INFO, "%{public}@Confirming primary resident with active network router in the home completed with %@", &v9, 0x16u);
  }

  objc_autoreleasePoolPop(v4);
  v8 = *MEMORY[0x277D85DE8];
}

- (void)_handleRemoveClientConfiguration:(id)configuration
{
  v16 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    v15 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to remove a client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  v9 = [configurationCopy numberForKey:@"HMDH.NetworkClientIdentifierMessageKey"];
  if (v9)
  {
    v12[0] = MEMORY[0x277D85DD0];
    v12[1] = 3221225472;
    v12[2] = __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke;
    v12[3] = &unk_2797359D8;
    v13 = configurationCopy;
    [(HMDHome *)selfCopy _removeClientConfigurationWithIdentifier:v9 completion:v12];
    v10 = v13;
  }

  else
  {
    v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:27];
    [configurationCopy respondWithError:v10];
  }

  v11 = *MEMORY[0x277D85DE8];
}

uint64_t __67__HMDHome_NetworkRouterInternal___handleRemoveClientConfiguration___block_invoke(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  if (a2)
  {
    return [v2 respondWithError:a2];
  }

  else
  {
    return [v2 respondWithPayload:0];
  }
}

- (void)_handleCreateUniquePSKClientConfiguration:(id)configuration
{
  v41 = *MEMORY[0x277D85DE8];
  configurationCopy = configuration;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    v8 = HMFGetLogIdentifier();
    *buf = 138543362;
    *&buf[4] = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_DEBUG, "%{public}@Received request to create a unique PSK client configuration", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  activeNetworkRouterAccessory = [(HMDHome *)selfCopy activeNetworkRouterAccessory];
  v28 = MEMORY[0x277D85DD0];
  v29 = 3221225472;
  v30 = __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke;
  v31 = &unk_27972CA30;
  v32 = selfCopy;
  v33 = configurationCopy;
  v10 = configurationCopy;
  v11 = activeNetworkRouterAccessory;
  v12 = &v28;
  v13 = generateWiFiUniquePreSharedKey();
  v14 = [v13 dataUsingEncoding:{1, v28, v29}];

  networkRouterController = [v11 networkRouterController];
  v16 = networkRouterController;
  if (v14 && networkRouterController)
  {
    v17 = [HMDNetworkRouterClientConfiguration configurationForOpenProtectionWithClientIdentifier:0];
    v18 = objc_alloc_init(HMDNetworkRouterCredential);
    [v17 setCredential:v18];

    credential = [v17 credential];
    [credential setPsk:v14];

    *buf = MEMORY[0x277D85DD0];
    *&buf[8] = 3221225472;
    *&buf[16] = __HMDCreateUniquePSKClientConfiguration_block_invoke;
    v35 = &unk_279732B10;
    v40 = v12;
    v20 = v16;
    v36 = v20;
    v37 = v17;
    v38 = v11;
    v39 = v14;
    v21 = v17;
    [v20 writeManagedNetworkEnable:1 completion:buf];
  }

  else
  {
    v22 = objc_autoreleasePoolPush();
    v23 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
    {
      v24 = HMFGetLogIdentifier();
      v25 = v24;
      v26 = @"no router controller found";
      if (v16)
      {
        v26 = @"PSK generation";
      }

      *buf = 138543618;
      *&buf[4] = v24;
      *&buf[12] = 2112;
      *&buf[14] = v26;
      _os_log_impl(&dword_2531F8000, v23, OS_LOG_TYPE_ERROR, "%{public}@Failed to create unique PSK client configuration due to %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v22);
    v21 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
    v30(v12, 0, v21);
  }

  v27 = *MEMORY[0x277D85DE8];
}

void __76__HMDHome_NetworkRouterInternal___handleCreateUniquePSKClientConfiguration___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x277D85DE8];
  v5 = a2;
  v6 = a3;
  v7 = objc_autoreleasePoolPush();
  v8 = *(a1 + 32);
  v9 = HMFGetOSLogHandle();
  v10 = v9;
  if (v6)
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      v11 = HMFGetLogIdentifier();
      *buf = 138543618;
      v26 = v11;
      v27 = 2112;
      v28 = v6;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_ERROR, "%{public}@Failed to create a unique PSK client configuration with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v7);
    [*(a1 + 40) respondWithError:v6];
  }

  else
  {
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v12 = HMFGetLogIdentifier();
      v13 = [v5 clientIdentifier];
      v14 = [v5 networkRouterUUID];
      v15 = [v14 UUIDString];
      *buf = 138543874;
      v26 = v12;
      v27 = 2112;
      v28 = v13;
      v29 = 2112;
      v30 = v15;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Created unique PSK client configuration with client identifier %@ on network router %@ for remote request", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v7);
    v16 = *(a1 + 40);
    v17 = [v5 clientIdentifier];
    v24[0] = v17;
    v23[1] = @"HMDH.UniquePSKMessageKey";
    v18 = [v5 wiFiPSK];
    v24[1] = v18;
    v23[2] = @"HMDH.NetworkRouterUUIDMessageKey";
    v19 = [v5 networkRouterUUID];
    v20 = [v19 UUIDString];
    v24[2] = v20;
    v21 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v24 forKeys:v23 count:3];
    [v16 respondWithPayload:v21];
  }

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_handleSetMinHomeKitVersionForAccessoryNetworkProtectionChange:(id)change
{
  changeCopy = change;
  v4 = [changeCopy stringForKey:@"kHomedVersionKey"];
  if (v4)
  {
    v5 = [[HMDHomeKitVersion alloc] initWithString:v4];
    if (v5)
    {
      [(HMDHome *)self _addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:v5 message:changeCopy];
    }

    else
    {
      v6 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [changeCopy respondWithError:v6];
    }
  }

  else
  {
    v5 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [changeCopy respondWithError:v5];
  }
}

- (void)_handleSetMinimumNetworkRouterHomeKitVersion:(id)version
{
  v23 = *MEMORY[0x277D85DE8];
  versionCopy = version;
  v5 = [versionCopy stringForKey:@"kHomedVersionKey"];
  v6 = [[HMDHomeKitVersion alloc] initWithString:v5];
  if (v6)
  {
    v7 = +[HMDHomeKitVersion currentVersion];
    if ([v7 isGreaterThanVersion:v6])
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        versionString = [(HMDHomeKitVersion *)v6 versionString];
        [v7 versionString];
        v13 = v16 = v8;
        *buf = 138543874;
        v18 = v11;
        v19 = 2112;
        v20 = versionString;
        v21 = 2112;
        v22 = v13;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Attempting to set the network router support HomeKit version to %@ - lower than version of HomeKit on this device - %@", buf, 0x20u);

        v8 = v16;
      }

      objc_autoreleasePoolPop(v8);
    }

    [(HMDHome *)self _addTransactionForMinimumNetworkRouterHomeKitVersion:v6 message:versionCopy];
  }

  else
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [versionCopy respondWithError:v14];
  }

  v15 = *MEMORY[0x277D85DE8];
}

- (void)_handleUpdateNetworkProtection:(id)protection
{
  v22 = *MEMORY[0x277D85DE8];
  protectionCopy = protection;
  v5 = [protectionCopy numberForKey:*MEMORY[0x277CD23D8]];
  if (!v5)
  {
    v7 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
LABEL_9:
    [protectionCopy respondWithError:v7];
    goto LABEL_10;
  }

  v15 = 0;
  v6 = [(HMDHome *)self checkForNetworkRouterSupport:1 error:&v15];
  v7 = v15;
  if (!v6)
  {
    v8 = objc_autoreleasePoolPush();
    selfCopy = self;
    v10 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = HMFGetLogIdentifier();
      v12 = HMDNetworkRouterSupportAsString([(HMDHome *)selfCopy networkRouterSupport]);
      *buf = 138543874;
      v17 = v11;
      v18 = 2112;
      v19 = v12;
      v20 = 2112;
      v21 = v7;
      _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Cannot update home network protection mode - networkRouterSupport %@ error %@", buf, 0x20u);
    }

    objc_autoreleasePoolPop(v8);
    goto LABEL_9;
  }

  if ([v5 integerValue] > 1)
  {
    v14 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [protectionCopy respondWithError:v14];
  }

  else
  {
    [(HMDHome *)self _addTransactionWithProtectionMode:v5 message:protectionCopy];
  }

LABEL_10:

  v13 = *MEMORY[0x277D85DE8];
}

- (void)_addTransactionForMinimumHomeKitVersionForAccessoryNetworkProtectionChange:(id)change message:(id)message
{
  messageCopy = message;
  changeCopy = change;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  uuid = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:uuid];
  uuid2 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:uuid2];

  versionString = [changeCopy versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinHomeKitVersionForAccessoryNetworkProtectionChange:versionString];
  backingStore = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [backingStore transaction:@"Update Minimum HomeKit Version For Accessory Network Protection Change" options:v14];

  [v15 add:v16 withMessage:messageCopy];
  [v15 run];
}

- (void)_addTransactionForMinimumNetworkRouterHomeKitVersion:(id)version message:(id)message
{
  messageCopy = message;
  versionCopy = version;
  v8 = [HMDHomeNetworkRouterSettingsModel alloc];
  uuid = [(HMDHome *)self uuid];
  v10 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:uuid];
  uuid2 = [(HMDHome *)self uuid];
  v16 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:v10 parentUUID:uuid2];

  versionString = [versionCopy versionString];

  [(HMDHomeNetworkRouterSettingsModel *)v16 setMinimumNetworkRouterSupportHomeKitVersion:versionString];
  backingStore = [(HMDHome *)self backingStore];
  v14 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v15 = [backingStore transaction:@"Update Minimum Network Router Support HomeKit Version" options:v14];

  [v15 add:v16 withMessage:messageCopy];
  [v15 run];
}

- (void)_clearAccessoryNetworkProtectionStateWithTransaction:(id)transaction
{
  v20 = *MEMORY[0x277D85DE8];
  transactionCopy = transaction;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  accessories = [(HMDHome *)self accessories];
  v6 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v16;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v16 != v8)
        {
          objc_enumerationMutation(accessories);
        }

        v10 = *(*(&v15 + 1) + 8 * i);
        networkRouterUUID = [v10 networkRouterUUID];
        if (networkRouterUUID)
        {
        }

        else
        {
          networkClientIdentifier = [v10 networkClientIdentifier];

          if (!networkClientIdentifier)
          {
            continue;
          }
        }

        v13 = [v10 transactionWithObjectChangeType:2];
        [v13 setNetworkRouterUUID:0];
        [v13 setNetworkClientIdentifier:0];
        [v13 setNetworkClientProfileFingerprint:0];
        [v13 setAppliedFirewallWANRules:0];
        [v13 setNetworkClientLAN:&unk_286629008];
        [v13 setCurrentNetworkProtectionMode:&unk_286629020];
        [transactionCopy add:v13];
      }

      v7 = [accessories countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v7);
  }

  v14 = *MEMORY[0x277D85DE8];
}

- (void)_updateActiveNetworkRouterAccessory:(id)accessory isReplacement:(BOOL)replacement withTransaction:(id)transaction
{
  replacementCopy = replacement;
  transactionCopy = transaction;
  accessoryCopy = accessory;
  v9 = [HMDHomeNetworkRouterSettingsModel alloc];
  uuid = [(HMDHome *)self uuid];
  v11 = [HMDHomeNetworkRouterSettingsModel modelIDForHomeUUID:uuid];
  uuid2 = [(HMDHome *)self uuid];
  v13 = [(HMDBackingStoreModelObject *)v9 initWithObjectChangeType:2 uuid:v11 parentUUID:uuid2];

  uuid3 = [accessoryCopy uuid];

  uUIDString = [uuid3 UUIDString];

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterAccessoryUUID:uUIDString];
  if (replacementCopy)
  {
    v16 = 0;
  }

  else
  {
    v16 = uUIDString;
  }

  [(HMDHomeNetworkRouterSettingsModel *)v13 setActiveNetworkRouterInitialSetupNeededUUID:v16];
  [transactionCopy add:v13];
  if (!replacementCopy)
  {
    v17 = [HMDHomeModel alloc];
    uuid4 = [(HMDHome *)self uuid];
    homeManager = [(HMDHome *)self homeManager];
    uuid5 = [homeManager uuid];
    v21 = [(HMDBackingStoreModelObject *)v17 initWithObjectChangeType:2 uuid:uuid4 parentUUID:uuid5];

    [(HMDHomeModel *)v21 setNetworkProtectionMode:&unk_286628FF0];
    [transactionCopy add:v21];
  }
}

- (void)_addTransactionWithProtectionMode:(id)mode message:(id)message
{
  messageCopy = message;
  modeCopy = mode;
  v8 = [HMDHomeModel alloc];
  uuid = [(HMDHome *)self uuid];
  homeManager = [(HMDHome *)self homeManager];
  uuid2 = [homeManager uuid];
  v12 = [(HMDBackingStoreModelObject *)v8 initWithObjectChangeType:2 uuid:uuid parentUUID:uuid2];

  [(HMDHomeModel *)v12 setNetworkProtectionMode:modeCopy];
  backingStore = [(HMDHome *)self backingStore];
  name = [messageCopy name];
  v15 = +[HMDBackingStoreTransactionOptions defaultXPCOptions];
  v16 = [backingStore transaction:name options:v15];

  [v16 add:v12 withMessage:messageCopy];
  v18[0] = MEMORY[0x277D85DD0];
  v18[1] = 3221225472;
  v18[2] = __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke;
  v18[3] = &unk_2797358C8;
  v19 = messageCopy;
  selfCopy = self;
  v17 = messageCopy;
  [v16 run:v18];
}

void __76__HMDHome_NetworkRouterInternal___addTransactionWithProtectionMode_message___block_invoke(uint64_t a1, uint64_t a2)
{
  v9[1] = *MEMORY[0x277D85DE8];
  v2 = *(a1 + 32);
  if (a2)
  {
    v3 = *MEMORY[0x277D85DE8];
    v4 = *(a1 + 32);

    [v4 respondWithError:a2];
  }

  else
  {
    v8 = *MEMORY[0x277CD23D8];
    v5 = [MEMORY[0x277CCABB0] numberWithInteger:{objc_msgSend(*(a1 + 40), "protectionMode")}];
    v9[0] = v5;
    v6 = [MEMORY[0x277CBEAC0] dictionaryWithObjects:v9 forKeys:&v8 count:1];
    [v2 respondWithPayload:v6];

    v7 = *MEMORY[0x277D85DE8];
  }
}

- (unint64_t)deriveNetworkRouterSupport:(unint64_t)support
{
  supportCopy = support;
  v4 = 4;
  if ((support & 8) == 0)
  {
    v4 = 15;
  }

  if (support)
  {
    v5 = v4 & 8;
    if ([(HMDHome *)self isOwnerUser])
    {
      v4 = v5;
    }

    else
    {
      v4 = 0;
    }
  }

  if ((supportCopy & 2) != 0)
  {
    v4 = 0;
  }

  if ((supportCopy & 4) != 0)
  {
    v4 &= 9u;
  }

  if ((supportCopy & 0x10) != 0)
  {
    return v4 & 0xFFFFFFFFFFFFFFFDLL;
  }

  else
  {
    return v4;
  }
}

- (BOOL)checkForNetworkRouterSupport:(unint64_t)support error:(id *)error
{
  supportCopy = support;
  networkRouterSupportDisableReason = [(HMDHome *)self networkRouterSupportDisableReason];
  if ((supportCopy & 4) != 0)
  {
    if ((networkRouterSupportDisableReason & 4) != 0)
    {
      goto LABEL_16;
    }

    if ((networkRouterSupportDisableReason & 2) != 0)
    {
      goto LABEL_22;
    }

    if (networkRouterSupportDisableReason)
    {
      goto LABEL_14;
    }
  }

  if ((supportCopy & 3) == 0)
  {
    goto LABEL_7;
  }

  if ((networkRouterSupportDisableReason & 4) == 0)
  {
    if ((networkRouterSupportDisableReason & 8) != 0 || (networkRouterSupportDisableReason & 2) != 0)
    {
      goto LABEL_22;
    }

    if (networkRouterSupportDisableReason)
    {
      goto LABEL_14;
    }

LABEL_7:
    if ((supportCopy & 2) == 0 || (networkRouterSupportDisableReason & 0x10) == 0)
    {
      if ((supportCopy & 8) == 0)
      {
        return 1;
      }

      if ((networkRouterSupportDisableReason & 8) == 0 && (networkRouterSupportDisableReason & 2) == 0)
      {
        if ((networkRouterSupportDisableReason & 1) == 0)
        {
          return 1;
        }

LABEL_14:
        if (error)
        {
          v8 = 92;
LABEL_24:
          v9 = [MEMORY[0x277CCA9B8] hmErrorWithCode:v8];
          v10 = v9;
          result = 0;
          *error = v9;
          return result;
        }

        return 0;
      }
    }

LABEL_22:
    if (error)
    {
      v8 = 48;
      goto LABEL_24;
    }

    return 0;
  }

LABEL_16:
  if (error)
  {
    v8 = 17;
    goto LABEL_24;
  }

  return 0;
}

- (HMDHAPAccessory)activeNetworkRouterAccessory
{
  activeNetworkRouterUUID = [(HMDHome *)self activeNetworkRouterUUID];
  v4 = [(HMDHome *)self accessoryWithUUID:activeNetworkRouterUUID];

  v5 = v4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  return v6;
}

- (NSArray)wiFiRouterAccessories
{
  v21 = *MEMORY[0x277D85DE8];
  v3 = [MEMORY[0x277CBEB18] arrayWithCapacity:1];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  accessories = [(HMDHome *)self accessories];
  v5 = [accessories countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v17;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v17 != v7)
        {
          objc_enumerationMutation(accessories);
        }

        v9 = *(*(&v16 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v10 = v9;
        }

        else
        {
          v10 = 0;
        }

        v11 = v10;

        networkRouterController = [v11 networkRouterController];

        if (networkRouterController)
        {
          [v3 addObject:v11];
        }
      }

      v6 = [accessories countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v6);
  }

  v13 = [v3 copy];
  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (BOOL)supportsRouterManagement
{
  if (![(HMDHome *)self _isNetworkRouterSupportEnabledForCurrentDevice]|| ![(HMDHome *)self isOwnerUser])
  {
    return 0;
  }

  _currentDeviceCapabilities = [(HMDHome *)self _currentDeviceCapabilities];
  supportsRouterManagement = [_currentDeviceCapabilities supportsRouterManagement];

  return supportsRouterManagement;
}

- (BOOL)_isNetworkRouterSupportEnabledForCurrentDevice
{
  v36 = *MEMORY[0x277D85DE8];
  v3 = +[HMDHomeKitVersion currentVersion];
  minimumNetworkRouterSupportHomeKitVersion = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
  if (minimumNetworkRouterSupportHomeKitVersion)
  {
    v5 = minimumNetworkRouterSupportHomeKitVersion;
    minimumNetworkRouterSupportHomeKitVersion2 = [(HMDHome *)self minimumNetworkRouterSupportHomeKitVersion];
    v7 = [minimumNetworkRouterSupportHomeKitVersion2 isGreaterThanVersion:v3];

    if (v7)
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        minimumNetworkRouterSupportHomeKitVersion3 = [(HMDHome *)selfCopy2 minimumNetworkRouterSupportHomeKitVersion];
        versionString = [minimumNetworkRouterSupportHomeKitVersion3 versionString];
        versionString2 = [v3 versionString];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = versionString;
        v34 = 2112;
        v35 = versionString2;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router support requires minimum HomeKit version of %@ - current %@; disabling", &v30, 0x20u);

LABEL_9:
        goto LABEL_10;
      }

      goto LABEL_10;
    }
  }

  activeNetworkRouterAccessory = [(HMDHome *)self activeNetworkRouterAccessory];
  primaryProfileVersion = [activeNetworkRouterAccessory primaryProfileVersion];
  if (primaryProfileVersion)
  {
    v17 = primaryProfileVersion;
    activeNetworkRouterAccessory2 = [(HMDHome *)self activeNetworkRouterAccessory];
    primaryProfileVersion2 = [activeNetworkRouterAccessory2 primaryProfileVersion];
    majorVersion = [primaryProfileVersion2 majorVersion];

    if (majorVersion >= 2)
    {
      v8 = objc_autoreleasePoolPush();
      selfCopy2 = self;
      v10 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = HMFGetLogIdentifier();
        v21 = MEMORY[0x277CCABB0];
        activeNetworkRouterAccessory3 = [(HMDHome *)selfCopy2 activeNetworkRouterAccessory];
        primaryProfileVersion3 = [activeNetworkRouterAccessory3 primaryProfileVersion];
        v24 = [v21 numberWithUnsignedInteger:{objc_msgSend(primaryProfileVersion3, "majorVersion")}];
        v30 = 138543874;
        v31 = v11;
        v32 = 2112;
        v33 = v24;
        v34 = 2112;
        v35 = &unk_286628FD8;
        _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Network router major version %@ not supported on this device - only supports up to major version %@; disabling", &v30, 0x20u);

        goto LABEL_9;
      }

LABEL_10:

      objc_autoreleasePoolPop(v8);
      v25 = 0;
      goto LABEL_17;
    }
  }

  else
  {
  }

  mEMORY[0x277D0F8D0] = [MEMORY[0x277D0F8D0] sharedPreferences];
  v27 = [mEMORY[0x277D0F8D0] preferenceForKey:@"enableNetworkRouterSupport"];

  v25 = !v27 || [v27 BOOLValue];
LABEL_17:

  v28 = *MEMORY[0x277D85DE8];
  return v25;
}

- (id)createAppleMediaAccessoriesStateManagerMetricsDispatcherWithIdentifier:(id)identifier logEventSubmitter:(id)submitter
{
  submitterCopy = submitter;
  identifierCopy = identifier;
  v7 = [[HMDAppleMediaAccessoriesStateManagerMetricsDispatcher alloc] initWithIdentifier:identifierCopy logEventSubmitter:submitterCopy];

  return v7;
}

- (id)createMultiuserSettingsMessenger:(id)messenger messageDispatcher:(id)dispatcher
{
  v22 = *MEMORY[0x277D85DE8];
  messengerCopy = messenger;
  dispatcherCopy = dispatcher;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    uuid = [messengerCopy uuid];
    v16 = 138543874;
    v17 = v11;
    v18 = 2112;
    v19 = uuid;
    v20 = 2112;
    v21 = dispatcherCopy;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Creating Multiuser settings messenger with current home UUID: %@ message dispatcher: %@", &v16, 0x20u);
  }

  objc_autoreleasePoolPop(v8);
  v13 = [[HMDMultiuserSettingsMessenger alloc] initWithHome:messengerCopy messageDispatcher:dispatcherCopy];

  v14 = *MEMORY[0x277D85DE8];

  return v13;
}

- (void)configureMultiuserSettingsMessengerWithMessengerFactory:(id)factory
{
  v18 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    home = [(HMDHome *)selfCopy home];
    v14 = 138543618;
    v15 = v8;
    v16 = 2112;
    v17 = home;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring Multiuser settings messenger %@", &v14, 0x16u);
  }

  objc_autoreleasePoolPop(v5);
  home2 = [(HMDHome *)selfCopy home];
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  v12 = [factoryCopy createMultiuserSettingsMessenger:home2 messageDispatcher:msgDispatcher];

  [v12 registerForMessages];
  [(HMDHome *)selfCopy setMultiuserSettingsMessenger:v12];

  v13 = *MEMORY[0x277D85DE8];
}

- (BOOL)_processTestModeSkipHH2MigrationOverride:(id)override error:(id *)error
{
  v17 = *MEMORY[0x277D85DE8];
  overrideCopy = override;
  v6 = [overrideCopy hmf_BOOLForKey:@"kConfigTestingSkipMigrationCheckOverrideKey"];
  v7 = objc_autoreleasePoolPush();
  selfCopy = self;
  v9 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    v10 = HMFGetLogIdentifier();
    v13 = 138543618;
    v14 = v10;
    v15 = 1024;
    v16 = v6;
    _os_log_impl(&dword_2531F8000, v9, OS_LOG_TYPE_INFO, "%{public}@Setting for HH2 skip migration check override to %{BOOL}d", &v13, 0x12u);
  }

  objc_autoreleasePoolPop(v7);
  [(HMDHome *)selfCopy setOverrideSentinelZoneForConvergencePeriod:v6];

  v11 = *MEMORY[0x277D85DE8];
  return 1;
}

- (BOOL)isThisHomeMigratedToHH2
{
  v37 = *MEMORY[0x277D85DE8];
  homeManager = [(HMDHome *)self homeManager];
  v4 = homeManager;
  if (!homeManager || ([homeManager hh2FrameworkSwitch], v5 = objc_claimAutoreleasedReturnValue(), v5, !v5))
  {
    v20 = objc_autoreleasePoolPush();
    selfCopy = self;
    v22 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
    {
      v23 = HMFGetLogIdentifier();
      *buf = 138543362;
      v28 = v23;
      _os_log_impl(&dword_2531F8000, v22, OS_LOG_TYPE_DEFAULT, "%{public}@Unable to find a valid instance of homeManager or this OS is not capable of running ROAR. Marking this home as not migrated to ROAR", buf, 0xCu);
    }

    objc_autoreleasePoolPop(v20);
    goto LABEL_11;
  }

  owner = [(HMDHome *)self owner];
  isCurrentUser = [owner isCurrentUser];

  hh2FrameworkSwitch = [v4 hh2FrameworkSwitch];
  checkExistenceOfHH2SentinelZone = [hh2FrameworkSwitch checkExistenceOfHH2SentinelZone];

  v10 = objc_autoreleasePoolPush();
  selfCopy2 = self;
  v12 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
  {
    v13 = HMFGetLogIdentifier();
    HMFBooleanToString();
    v14 = v26 = checkExistenceOfHH2SentinelZone;
    v15 = HMFBooleanToString();
    [(HMDHome *)selfCopy2 isUpdatedToHH2];
    v16 = HMFBooleanToString();
    HMFBooleanToString();
    v18 = v17 = v10;
    *buf = 138544386;
    v28 = v13;
    v29 = 2112;
    v30 = v14;
    v31 = 2112;
    v32 = v15;
    v33 = 2112;
    v34 = v16;
    v35 = 2112;
    v36 = v18;
    _os_log_impl(&dword_2531F8000, v12, OS_LOG_TYPE_DEBUG, "%{public}@[HH2 Sentinel zone exist : %@], [isOwner: %@], [Is Shared Home Updated to HH2: %@], [Running in HH2 daemon: %@]", buf, 0x34u);

    v10 = v17;
    checkExistenceOfHH2SentinelZone = v26;
  }

  objc_autoreleasePoolPop(v10);
  if ((checkExistenceOfHH2SentinelZone & 1) == 0)
  {
    if ((isCurrentUser & 1) == 0)
    {
      goto LABEL_13;
    }

LABEL_11:
    isUpdatedToHH2 = 0;
    goto LABEL_14;
  }

  if ((isCurrentUser & 1) == 0)
  {
LABEL_13:
    isUpdatedToHH2 = [(HMDHome *)selfCopy2 isUpdatedToHH2];
    goto LABEL_14;
  }

  isUpdatedToHH2 = 1;
LABEL_14:

  v24 = *MEMORY[0x277D85DE8];
  return isUpdatedToHH2;
}

- (unint64_t)accessNotAllowedReasonCode
{
  v19 = *MEMORY[0x277D85DE8];
  if ([(HMDHome *)self isAccessToHomeAllowed])
  {
    v3 = 1;
  }

  else
  {
    homeManager = [(HMDHome *)self homeManager];
    isHH1EOLEnabled = [homeManager isHH1EOLEnabled];

    if (isHH1EOLEnabled)
    {
      v3 = 8;
    }

    else
    {
      currentHomeKitVersion = [(HMDHome *)self currentHomeKitVersion];
      v7 = HMDMinimumHomeKitVersionSupportingHH2();
      v8 = [currentHomeKitVersion isAtLeastVersion:v7];

      if (v8)
      {
        v3 = 4;
      }

      else
      {
        v3 = 2;
      }
    }
  }

  v9 = objc_autoreleasePoolPush();
  selfCopy = self;
  v11 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
  {
    v12 = HMFGetLogIdentifier();
    v15 = 138543618;
    v16 = v12;
    v17 = 2048;
    v18 = v3;
    _os_log_impl(&dword_2531F8000, v11, OS_LOG_TYPE_DEFAULT, "%{public}@Home access is not allowed with reason code : %lu", &v15, 0x16u);
  }

  objc_autoreleasePoolPop(v9);
  v13 = *MEMORY[0x277D85DE8];
  return v3;
}

- (BOOL)_isAccessToHomeAllowed
{
  if ([(HMDHome *)self isThisHomeMigratedToHH2])
  {
    LOBYTE(v3) = 0;
  }

  else
  {
    homeManager = [(HMDHome *)self homeManager];
    v3 = [homeManager isHH1EOLEnabled] ^ 1;
  }

  return v3;
}

- (void)storeMigrationCharacteristicsAuthorizationData
{
  v47 = *MEMORY[0x277D85DE8];
  v3 = objc_autoreleasePoolPush();
  currentUser = [(HMDHome *)self currentUser];
  isOwner = [currentUser isOwner];

  if (isOwner)
  {
    v6 = objc_autoreleasePoolPush();
    selfCopy = self;
    v8 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = HMFGetLogIdentifier();
      name = [(HMDHome *)selfCopy name];
      *buf = 138543618;
      v42 = v9;
      v43 = 2112;
      v44 = name;
      _os_log_impl(&dword_2531F8000, v8, OS_LOG_TYPE_INFO, "%{public}@Skipping characteristic authorization archiving for home: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v6);
  }

  else
  {
    dictionary = [MEMORY[0x277CBEB38] dictionary];
    hapAccessories = [(HMDHome *)self hapAccessories];
    v39[0] = MEMORY[0x277D85DD0];
    v39[1] = 3221225472;
    v39[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke;
    v39[3] = &unk_27972F628;
    v13 = dictionary;
    v40 = v13;
    [hapAccessories na_each:v39];

    v14 = [v13 count];
    v15 = objc_autoreleasePoolPush();
    selfCopy2 = self;
    v17 = HMFGetOSLogHandle();
    v18 = v17;
    if (v14)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v19 = HMFGetLogIdentifier();
        name2 = [(HMDHome *)selfCopy2 name];
        *buf = 138543874;
        v42 = v19;
        v43 = 2112;
        v44 = name2;
        v45 = 2112;
        v46 = v13;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Archiving characteristic authorization data for migration for home: %@, [%@]", buf, 0x20u);
      }

      objc_autoreleasePoolPop(v15);
      v21 = [objc_alloc(MEMORY[0x277CCAAB0]) initRequiringSecureCoding:1];
      [v21 encodeObject:v13 forKey:*MEMORY[0x277CCA308]];
      [v21 finishEncoding];
      encodedData = [v21 encodedData];
      if (encodedData)
      {
        uuid = [(HMDHome *)selfCopy2 uuid];
        v24 = MEMORY[0x277CCACA8];
        v25 = hh1ToHH2PerDeviceMigrationDirectoryPath;
        v26 = [v24 stringWithFormat:@"%@/HMDHome-Authorization-Data-%@.plist", v25, uuid];

        v27 = [HMDPersistentStore writeData:encodedData toStorePath:v26 dataLabel:@"CharacteristicAuthorizationData"];
        v28 = objc_autoreleasePoolPush();
        v29 = selfCopy2;
        v30 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
        {
          v31 = HMFGetLogIdentifier();
          *buf = 138543874;
          v42 = v31;
          v43 = 2112;
          v44 = v27;
          v45 = 2112;
          v46 = v26;
          _os_log_impl(&dword_2531F8000, v30, OS_LOG_TYPE_DEBUG, "%{public}@Stored characteristic authorization data ([%@] bytes) to [%@]", buf, 0x20u);
        }

        objc_autoreleasePoolPop(v28);
      }

      else
      {
        v34 = objc_autoreleasePoolPush();
        v35 = selfCopy2;
        v36 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          v37 = HMFGetLogIdentifier();
          *buf = 138543362;
          v42 = v37;
          _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Unable to store characteristic authorization data during migration, archived data is nil", buf, 0xCu);
        }

        objc_autoreleasePoolPop(v34);
      }
    }

    else
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        v32 = HMFGetLogIdentifier();
        name3 = [(HMDHome *)selfCopy2 name];
        *buf = 138543618;
        v42 = v32;
        v43 = 2112;
        v44 = name3;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEBUG, "%{public}@No characteristic authorization data to migrate for home: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v15);
    }
  }

  objc_autoreleasePoolPop(v3);
  v38 = *MEMORY[0x277D85DE8];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 services];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2;
  v6[3] = &unk_27972F600;
  v7 = *(a1 + 32);
  v8 = v3;
  v5 = v3;
  [v4 na_each:v6];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 characteristics];
  v4[0] = MEMORY[0x277D85DD0];
  v4[1] = 3221225472;
  v4[2] = __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3;
  v4[3] = &unk_27972F5D8;
  v5 = *(a1 + 32);
  v6 = *(a1 + 40);
  [v3 na_each:v4];
}

void __90__HMDHome_CharacteristicAuthorizationData__storeMigrationCharacteristicsAuthorizationData__block_invoke_3(uint64_t a1, void *a2)
{
  v15 = a2;
  v3 = [v15 getCharacteristicDictionary];
  v4 = [v3 objectForKeyedSubscript:*MEMORY[0x277CD2100]];

  if (v4)
  {
    v5 = *(a1 + 32);
    v6 = [*(a1 + 40) uuid];
    v7 = [v5 objectForKeyedSubscript:v6];

    if (!v7)
    {
      v8 = [MEMORY[0x277CBEB38] dictionary];
      v9 = *(a1 + 32);
      v10 = [*(a1 + 40) uuid];
      [v9 setObject:v8 forKeyedSubscript:v10];
    }

    v11 = *(a1 + 32);
    v12 = [*(a1 + 40) uuid];
    v13 = [v11 objectForKeyedSubscript:v12];
    v14 = [v15 instanceID];
    [v13 setObject:v4 forKeyedSubscript:v14];
  }
}

- (id)createSiriEndpointProfilesMessengerWithMessageTargetUUID:(id)d messageDispatcher:(id)dispatcher messageRouter:(id)router messageHandler:(id)handler
{
  handlerCopy = handler;
  routerCopy = router;
  dispatcherCopy = dispatcher;
  dCopy = d;
  v13 = [[HMDSiriEndpointProfilesMessenger alloc] initWithMessageTargetUUID:dCopy messageDispatcher:dispatcherCopy messageRouter:routerCopy messageHandler:handlerCopy];

  return v13;
}

- (void)configureSiriEndpointProfilesMessengerWithMessengerFactory:(id)factory messageHandlerFactory:(id)handlerFactory
{
  v25 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  handlerFactoryCopy = handlerFactory;
  v8 = objc_autoreleasePoolPush();
  selfCopy = self;
  v10 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
  {
    v11 = HMFGetLogIdentifier();
    v23 = 138543362;
    v24 = v11;
    _os_log_impl(&dword_2531F8000, v10, OS_LOG_TYPE_INFO, "%{public}@Configuring siri endpoint profiles messenger", &v23, 0xCu);
  }

  objc_autoreleasePoolPop(v8);
  msgDispatcher = [(HMDHome *)selfCopy msgDispatcher];
  primaryResidentMessageRouter = [(HMDHome *)selfCopy primaryResidentMessageRouter];
  if (!msgDispatcher)
  {
    _HMFPreconditionFailure();
LABEL_7:
    _HMFPreconditionFailure();
  }

  v14 = primaryResidentMessageRouter;
  if (!primaryResidentMessageRouter)
  {
    goto LABEL_7;
  }

  v15 = MEMORY[0x277CD1E30];
  uuid = [(HMDHome *)selfCopy uuid];
  v17 = [v15 messageTargetUUIDWithHomeUUID:uuid];

  uuid2 = [(HMDHome *)selfCopy uuid];
  v19 = [handlerFactoryCopy createSiriEndpointProfileMessageHandlerWithHomeUUID:uuid2];

  homeManager = [(HMDHome *)selfCopy homeManager];
  [v19 setDataSource:homeManager];

  v21 = [factoryCopy createSiriEndpointProfilesMessengerWithMessageTargetUUID:v17 messageDispatcher:msgDispatcher messageRouter:v14 messageHandler:v19];
  [v21 registerForMessagesWithHome:selfCopy];
  [(HMDHome *)selfCopy setSiriEndpointProfilesMessenger:v21];

  v22 = *MEMORY[0x277D85DE8];
}

- (void)_unitTest_setRetrievalCompletionsTimeout:(double)timeout
{
  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v6 = [retrievalAccessoryCompletionTuples copy];

  os_unfair_recursive_lock_unlock();
  v7[0] = MEMORY[0x277D85DD0];
  v7[1] = 3221225472;
  v7[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke;
  v7[3] = &unk_279733200;
  v7[4] = self;
  *&v7[5] = timeout;
  [v6 na_each:v7];
}

void __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [*(a1 + 32) workQueue];
  v6[0] = MEMORY[0x277D85DD0];
  v6[1] = 3221225472;
  v6[2] = __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2;
  v6[3] = &unk_279734BB8;
  v7 = v3;
  v8 = *(a1 + 40);
  v5 = v3;
  dispatch_async(v4, v6);
}

uint64_t __72__HMDHome_AccessoryRetrieval___unitTest_setRetrievalCompletionsTimeout___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) stop];
  [*(a1 + 32) setRetrievalTimeout:*(a1 + 40)];
  v2 = *(a1 + 32);

  return [v2 start];
}

- (void)_notifyRetrievalError:(id)error accessoryServer:(id)server linkType:(int64_t)type accessoryOperationBlock:(id)block
{
  errorCopy = error;
  serverCopy = server;
  blockCopy = block;
  hapAccessories = [(HMDHome *)self hapAccessories];
  v17[0] = MEMORY[0x277D85DD0];
  v17[1] = 3221225472;
  v17[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke;
  v17[3] = &unk_2797331D8;
  v18 = serverCopy;
  selfCopy = self;
  v21 = blockCopy;
  typeCopy = type;
  v20 = errorCopy;
  v14 = errorCopy;
  v15 = blockCopy;
  v16 = serverCopy;
  [hapAccessories na_each:v17];
}

void __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if ([v3 matchesHAPAccessoryWithServerIdentifier:*(a1 + 32) linkType:0])
  {
    v4 = _Block_copy(*(a1 + 56));
    v5 = v4;
    if (v4)
    {
      (*(v4 + 2))(v4, v3);
    }

    v6 = [*(a1 + 40) workQueue];
    v9[0] = MEMORY[0x277D85DD0];
    v9[1] = 3221225472;
    v9[2] = __102__HMDHome_AccessoryRetrieval___notifyRetrievalError_accessoryServer_linkType_accessoryOperationBlock___block_invoke_2;
    v9[3] = &unk_279733188;
    v9[4] = *(a1 + 40);
    v7 = v3;
    v8 = *(a1 + 64);
    v10 = v7;
    v12 = v8;
    v11 = *(a1 + 48);
    dispatch_async(v6, v9);
  }
}

- (void)_retrieveHAPAccessoryForHMDHAPAccessory:(id)accessory linkType:(int64_t)type forceRetrieve:(BOOL)retrieve completion:(id)completion
{
  retrieveCopy = retrieve;
  v73 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  completionCopy = completion;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  bridge = [accessoryCopy bridge];
  v14 = bridge;
  if (bridge)
  {
    v15 = bridge;
  }

  else
  {
    v15 = accessoryCopy;
  }

  v16 = v15;

  accessoryBrowser = [(HMDHome *)self accessoryBrowser];
  isBrowsingAllowed = [accessoryBrowser isBrowsingAllowed];

  if (isBrowsingAllowed)
  {
    accessories = [(HMDHome *)self accessories];
    v20 = [accessories containsObject:accessoryCopy];

    if (v20)
    {
      v21 = [v16 matchingHAPAccessoryServerIdentifierWithLinkType:type];
      v62 = 0;
      v22 = [(HMDHome *)self _enqueueRetrievalTupleForAccessory:v16 linkType:type inProgress:&v62 completion:completionCopy];
      v23 = v22;
      if (v62 == 1 && !retrieveCopy)
      {
        goto LABEL_24;
      }

      v58 = v22;
      v37 = objc_autoreleasePoolPush();
      selfCopy = self;
      v39 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v39, OS_LOG_TYPE_INFO))
      {
        v56 = HMFGetLogIdentifier();
        shortDescription = [v16 shortDescription];
        if (type > 2)
        {
          v40 = @"Undefined";
        }

        else
        {
          v40 = off_279727440[type];
        }

        v51 = v40;
        v41 = HMFBooleanToString();
        *buf = 138544130;
        v64 = v56;
        v65 = 2112;
        v66 = shortDescription;
        v67 = 2112;
        v68 = v51;
        v69 = 2112;
        v70 = v41;
        _os_log_impl(&dword_2531F8000, v39, OS_LOG_TYPE_INFO, "%{public}@Retrieving accessory %@/%@. Force: %@", buf, 0x2Au);
      }

      objc_autoreleasePoolPop(v37);
      v23 = v58;
      [v58 start];
      accessoryBrowser2 = [(HMDHome *)selfCopy accessoryBrowser];
      v59[0] = MEMORY[0x277D85DD0];
      v59[1] = 3221225472;
      v59[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke;
      v59[3] = &unk_2797331B0;
      v59[4] = selfCopy;
      v60 = v16;
      typeCopy = type;
      [accessoryBrowser2 discoverAccessoryServer:v21 linkType:type errorHandler:v59];

      if (v62)
      {
LABEL_24:
        v43 = objc_autoreleasePoolPush();
        selfCopy2 = self;
        v45 = HMFGetOSLogHandle();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
        {
          v55 = HMFGetLogIdentifier();
          shortDescription2 = [v16 shortDescription];
          v57 = v43;
          if (type > 2)
          {
            v46 = @"Undefined";
          }

          else
          {
            v46 = off_279727440[type];
          }

          v47 = v46;
          v48 = MEMORY[0x277CCABB0];
          log = [v23 completions];
          v49 = [v48 numberWithUnsignedInteger:{-[NSObject count](log, "count")}];
          *buf = 138544386;
          v64 = v55;
          v65 = 2112;
          v66 = shortDescription2;
          v67 = 2112;
          v68 = v21;
          v69 = 2112;
          v70 = v47;
          v71 = 2112;
          v72 = v49;
          _os_log_impl(&dword_2531F8000, v45, OS_LOG_TYPE_DEBUG, "%{public}@Retrieval already in progress for accessory (%@) with server %@/%@ and %@ completions.", buf, 0x34u);

          v43 = v57;
        }

        objc_autoreleasePoolPop(v43);
      }

      goto LABEL_31;
    }

    v31 = objc_autoreleasePoolPush();
    selfCopy3 = self;
    v33 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
    {
      v34 = HMFGetLogIdentifier();
      shortDescription3 = [accessoryCopy shortDescription];
      *buf = 138543618;
      v64 = v34;
      v65 = 2112;
      v66 = shortDescription3;
      _os_log_impl(&dword_2531F8000, v33, OS_LOG_TYPE_ERROR, "%{public}@Cannot retrieve HAP accessory: %@. Requested accessory not part of this home", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v31);
    v21 = _Block_copy(completionCopy);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 3;
      goto LABEL_17;
    }
  }

  else
  {
    v24 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v26 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      v27 = HMFGetLogIdentifier();
      shortDescription4 = [v16 shortDescription];
      *buf = 138543618;
      v64 = v27;
      v65 = 2112;
      v66 = shortDescription4;
      _os_log_impl(&dword_2531F8000, v26, OS_LOG_TYPE_ERROR, "%{public}@Ignoring request to retrieve HAP accessory: %@. Browsing not allowed (companion is connected or no app)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v24);
    v21 = _Block_copy(completionCopy);
    if (v21)
    {
      v29 = MEMORY[0x277CCA9B8];
      v30 = 48;
LABEL_17:
      v36 = [v29 hmErrorWithCode:v30];
      (v21->data)(v21, v36);
    }
  }

LABEL_31:

  v50 = *MEMORY[0x277D85DE8];
}

void __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (v3)
  {
    v4 = [*(a1 + 32) workQueue];
    v8[0] = MEMORY[0x277D85DD0];
    v8[1] = 3221225472;
    v8[2] = __105__HMDHome_AccessoryRetrieval___retrieveHAPAccessoryForHMDHAPAccessory_linkType_forceRetrieve_completion___block_invoke_2;
    v8[3] = &unk_279733188;
    v5 = *(a1 + 40);
    v8[4] = *(a1 + 32);
    v6 = v5;
    v7 = *(a1 + 48);
    v9 = v6;
    v11 = v7;
    v10 = v3;
    dispatch_async(v4, v8);
  }
}

- (void)_dequeueRetrievalForAccessory:(id)accessory linkType:(int64_t)type error:(id)error
{
  v43 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  errorCopy = error;
  workQueue = [(HMDHome *)self workQueue];
  dispatch_assert_queue_V2(workQueue);

  bridge = [accessoryCopy bridge];
  v12 = bridge;
  if (bridge)
  {
    v13 = bridge;
  }

  else
  {
    v13 = accessoryCopy;
  }

  v14 = v13;

  v15 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:v14 linkType:type];
  if (v15)
  {
    [(HMDHome *)self _removeRetrievalCompletionTuple:v15];
    [v15 stop];
    if (errorCopy)
    {
      v16 = objc_autoreleasePoolPush();
      selfCopy = self;
      v18 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v30 = HMFGetLogIdentifier();
        shortDescription = [v14 shortDescription];
        v29 = v16;
        if (type > 2)
        {
          v19 = @"Undefined";
        }

        else
        {
          v19 = off_279727440[type];
        }

        v20 = v19;
        v21 = [MEMORY[0x277CCA9B8] hmStringFromErrorCode:{objc_msgSend(errorCopy, "code")}];
        v22 = MEMORY[0x277CCABB0];
        completions = [v15 completions];
        v23 = [v22 numberWithUnsignedInteger:{objc_msgSend(completions, "count")}];
        *buf = 138544386;
        v34 = v30;
        v35 = 2112;
        v36 = shortDescription;
        v37 = 2112;
        v38 = v20;
        v39 = 2112;
        v40 = v21;
        v41 = 2112;
        v42 = v23;
        _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_INFO, "%{public}@Calling accessory retrieval for %@/%@ with error: %@ and %@ completions.", buf, 0x34u);

        v16 = v29;
      }

      objc_autoreleasePoolPop(v16);
    }

    completions2 = [v15 completions];
    v31[0] = MEMORY[0x277D85DD0];
    v31[1] = 3221225472;
    v31[2] = __76__HMDHome_AccessoryRetrieval___dequeueRetrievalForAccessory_linkType_error___block_invoke;
    v31[3] = &unk_279733160;
    v32 = errorCopy;
    [completions2 na_each:v31];

    completions3 = [v15 completions];
    [completions3 removeAllObjects];
  }

  v26 = *MEMORY[0x277D85DE8];
}

- (id)_enqueueRetrievalTupleForAccessory:(id)accessory linkType:(int64_t)type inProgress:(BOOL *)progress completion:(id)completion
{
  v39 = *MEMORY[0x277D85DE8];
  accessoryCopy = accessory;
  completionCopy = completion;
  bridge = [accessoryCopy bridge];
  v13 = bridge;
  if (bridge)
  {
    v14 = bridge;
  }

  else
  {
    v14 = accessoryCopy;
  }

  v15 = v14;

  v16 = objc_autoreleasePoolPush();
  selfCopy = self;
  v18 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
  {
    v28 = v16;
    v19 = HMFGetLogIdentifier();
    if (completionCopy)
    {
      v20 = @" with completion";
    }

    else
    {
      v20 = &stru_286509E58;
    }

    shortDescription = [v15 shortDescription];
    progressCopy = progress;
    if (type > 2)
    {
      v22 = @"Undefined";
    }

    else
    {
      v22 = off_279727440[type];
    }

    v23 = v22;
    *buf = 138544130;
    v32 = v19;
    v33 = 2112;
    v34 = v20;
    v35 = 2112;
    v36 = shortDescription;
    v37 = 2112;
    v38 = v23;
    _os_log_impl(&dword_2531F8000, v18, OS_LOG_TYPE_DEBUG, "%{public}@Enqueueing retrieval tuple%@ for %@/%@.", buf, 0x2Au);

    v16 = v29;
    progress = progressCopy;
  }

  objc_autoreleasePoolPop(v16);
  v24 = [(HMDHome *)selfCopy _retrieveTupleForPrimaryAccessory:v15 linkType:type];
  if (v24)
  {
    v25 = v24;
    if (progress)
    {
      *progress = 1;
    }

    if (completionCopy)
    {
      goto LABEL_16;
    }
  }

  else
  {
    v25 = [[HMDAccessoryRetrievalCompletionTuple alloc] initWithHome:selfCopy accessory:v15 linkType:type];
    [(HMDHome *)selfCopy _addRetrievalCompletionTuple:v25];
    if (completionCopy)
    {
LABEL_16:
      [(HMDAccessoryRetrievalCompletionTuple *)v25 addCompletion:completionCopy];
    }
  }

  v26 = *MEMORY[0x277D85DE8];

  return v25;
}

- (BOOL)_isRetrievalInProgressForPrimaryAccessory:(id)accessory linkType:(int64_t)type
{
  v4 = [(HMDHome *)self _retrieveTupleForPrimaryAccessory:accessory linkType:type];
  v5 = v4 != 0;

  return v5;
}

- (void)_removeRetrievalCompletionTuple:(id)tuple
{
  tupleCopy = tuple;
  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [retrievalAccessoryCompletionTuples removeObject:tupleCopy];

  os_unfair_recursive_lock_unlock();
}

- (void)_addRetrievalCompletionTuple:(id)tuple
{
  tupleCopy = tuple;
  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  [retrievalAccessoryCompletionTuples addObject:tupleCopy];

  os_unfair_recursive_lock_unlock();
}

- (id)_retrieveTupleForPrimaryAccessory:(id)accessory linkType:(int64_t)type
{
  accessoryCopy = accessory;
  bridge = [accessoryCopy bridge];
  v8 = bridge;
  if (bridge)
  {
    v9 = bridge;
  }

  else
  {
    v9 = accessoryCopy;
  }

  v10 = v9;

  os_unfair_recursive_lock_lock_with_options();
  retrievalAccessoryCompletionTuples = [(HMDHome *)self retrievalAccessoryCompletionTuples];
  v15[0] = MEMORY[0x277D85DD0];
  v15[1] = 3221225472;
  v15[2] = __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke;
  v15[3] = &unk_279733138;
  v12 = v10;
  v16 = v12;
  typeCopy = type;
  v13 = [retrievalAccessoryCompletionTuples na_firstObjectPassingTest:v15];

  os_unfair_recursive_lock_unlock();

  return v13;
}

BOOL __74__HMDHome_AccessoryRetrieval___retrieveTupleForPrimaryAccessory_linkType___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 accessory];
  v5 = [v4 uuid];
  v6 = [*(a1 + 32) uuid];
  if ([v5 isEqual:v6])
  {
    v7 = [v3 linkType] == *(a1 + 40);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (unint64_t)accessorySettingsLocalMessageHandler:(id)handler callerPrivilegeWithMessage:(id)message
{
  v21 = *MEMORY[0x277D85DE8];
  handlerCopy = handler;
  messageCopy = message;
  v8 = [messageCopy userForHome:self];
  v9 = v8;
  if (v8)
  {
    privilege = [v8 privilege];
  }

  else
  {
    v11 = objc_autoreleasePoolPush();
    selfCopy = self;
    v13 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = HMFGetLogIdentifier();
      v17 = 138543618;
      v18 = v14;
      v19 = 2112;
      v20 = messageCopy;
      _os_log_impl(&dword_2531F8000, v13, OS_LOG_TYPE_ERROR, "%{public}@Failed to get accessory settings local message handler caller privilege from message: %@", &v17, 0x16u);
    }

    objc_autoreleasePoolPop(v11);
    privilege = 2;
  }

  v15 = *MEMORY[0x277D85DE8];
  return privilege;
}

- (id)createUnifiedLanguageValueListSettingDataProvider
{
  v2 = objc_alloc_init(HMDUnifiedLanguageValueListSettingDataProvider);

  return v2;
}

- (void)configureUnifiedLanguageValueListSettingDataProviderWithFactory:(id)factory
{
  v13 = *MEMORY[0x277D85DE8];
  factoryCopy = factory;
  v5 = objc_autoreleasePoolPush();
  selfCopy = self;
  v7 = HMFGetOSLogHandle();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    v8 = HMFGetLogIdentifier();
    v11 = 138543362;
    v12 = v8;
    _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_INFO, "%{public}@Configuring unified language value list setting data provider", &v11, 0xCu);
  }

  objc_autoreleasePoolPop(v5);
  createUnifiedLanguageValueListSettingDataProvider = [factoryCopy createUnifiedLanguageValueListSettingDataProvider];
  [createUnifiedLanguageValueListSettingDataProvider setDataSource:selfCopy];
  [(HMDHome *)selfCopy setUnifiedLanguageValueListSettingDataProvider:createUnifiedLanguageValueListSettingDataProvider];

  v10 = *MEMORY[0x277D85DE8];
}

- (BOOL)validateActionsDoNotConflict:(id)conflict
{
  v55 = *MEMORY[0x277D85DE8];
  conflictCopy = conflict;
  if ([conflictCopy count])
  {
    v5 = [MEMORY[0x277CBEB58] set];
    v6 = [MEMORY[0x277CBEB58] set];
    v45 = 0u;
    v46 = 0u;
    v47 = 0u;
    v48 = 0u;
    v7 = conflictCopy;
    v8 = [v7 countByEnumeratingWithState:&v45 objects:v54 count:16];
    if (v8)
    {
      v9 = v8;
      selfCopy = self;
      v37 = conflictCopy;
      v39 = v7;
      v40 = *v46;
      v38 = v5;
      while (2)
      {
        v10 = 0;
        v11 = v40;
        do
        {
          if (*v46 != v11)
          {
            objc_enumerationMutation(v7);
          }

          v12 = *(*(&v45 + 1) + 8 * v10);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = v12;
          }

          else
          {
            v13 = 0;
          }

          v14 = v13;

          if (v14)
          {
            characteristic = [v14 characteristic];
            if ([v5 containsObject:characteristic])
            {
              v32 = objc_autoreleasePoolPush();
              v33 = selfCopy;
              v34 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
              {
                v35 = HMFGetLogIdentifier();
                *buf = 138543618;
                v51 = v35;
                v52 = 2112;
                v53 = v12;
                _os_log_impl(&dword_2531F8000, v34, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v32);
LABEL_34:

              v25 = 0;
              conflictCopy = v37;
              v7 = v39;
              goto LABEL_36;
            }

            [v5 addObject:characteristic];
          }

          else
          {
            v16 = v12;
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v17 = v16;
            }

            else
            {
              v17 = 0;
            }

            characteristic = v17;

            if (characteristic)
            {
              v43 = 0u;
              v44 = 0u;
              v41 = 0u;
              v42 = 0u;
              mediaProfiles = [characteristic mediaProfiles];
              v19 = [mediaProfiles countByEnumeratingWithState:&v41 objects:v49 count:16];
              if (v19)
              {
                v20 = v19;
                v21 = *v42;
                while (2)
                {
                  for (i = 0; i != v20; ++i)
                  {
                    if (*v42 != v21)
                    {
                      objc_enumerationMutation(mediaProfiles);
                    }

                    v23 = *(*(&v41 + 1) + 8 * i);
                    if ([v6 containsObject:v23])
                    {
                      v26 = objc_autoreleasePoolPush();
                      v27 = selfCopy;
                      v28 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
                      {
                        v29 = HMFGetLogIdentifier();
                        *buf = 138543618;
                        v51 = v29;
                        v52 = 2112;
                        v53 = v16;
                        _os_log_impl(&dword_2531F8000, v28, OS_LOG_TYPE_ERROR, "%{public}@Conflicting action detected: %@", buf, 0x16u);
                      }

                      objc_autoreleasePoolPop(v26);
                      v14 = 0;
                      v5 = v38;
                      goto LABEL_34;
                    }

                    [v6 addObject:v23];
                  }

                  v20 = [mediaProfiles countByEnumeratingWithState:&v41 objects:v49 count:16];
                  if (v20)
                  {
                    continue;
                  }

                  break;
                }
              }

              v14 = 0;
              v5 = v38;
              v7 = v39;
              v11 = v40;
            }
          }

          ++v10;
        }

        while (v10 != v9);
        v24 = [v7 countByEnumeratingWithState:&v45 objects:v54 count:16];
        v9 = v24;
        v25 = 1;
        conflictCopy = v37;
        if (v24)
        {
          continue;
        }

        break;
      }
    }

    else
    {
      v25 = 1;
    }

LABEL_36:
  }

  else
  {
    v25 = 1;
  }

  v30 = *MEMORY[0x277D85DE8];
  return v25;
}

- (void)executeActionsFromMessage:(id)message
{
  v166 = *MEMORY[0x277D85DE8];
  messageCopy = message;
  v93 = [messageCopy arrayForKey:*MEMORY[0x277CCFF38]];
  if ([v93 count])
  {
    if ([v93 hmf_objectsAreKindOfClass:objc_opt_class()])
    {
      date = [MEMORY[0x277CBEAA8] date];
      source = [messageCopy source];
      transport = [messageCopy transport];
      v94 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v93, "count")}];
      v145 = 0u;
      v146 = 0u;
      v143 = 0u;
      v144 = 0u;
      v4 = v93;
      v5 = [v4 countByEnumeratingWithState:&v143 objects:v165 count:16];
      if (!v5)
      {
        goto LABEL_17;
      }

      v6 = *v144;
      while (2)
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v144 != v6)
          {
            objc_enumerationMutation(v4);
          }

          v8 = *(*(&v143 + 1) + 8 * i);
          v9 = [(HMDHome *)self actionWithDictionaryRepresentation:v8];
          if (!v9)
          {
            v74 = objc_autoreleasePoolPush();
            selfCopy = self;
            v76 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v76, OS_LOG_TYPE_ERROR))
            {
              v77 = HMFGetLogIdentifier();
              *buf = 138543618;
              v153 = v77;
              v154 = 2112;
              *v155 = v8;
              _os_log_impl(&dword_2531F8000, v76, OS_LOG_TYPE_ERROR, "%{public}@Failed to deserialize action: %@", buf, 0x16u);
            }

            objc_autoreleasePoolPop(v74);
            v10 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
            [messageCopy respondWithError:v10];
LABEL_91:

            goto LABEL_99;
          }

          v10 = v9;
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if (isKindOfClass)
          {
            v12 = v10;
          }

          else
          {
            v12 = 0;
          }

          v13 = v12;

          if (isKindOfClass)
          {
            proxyConnection = [messageCopy proxyConnection];
            if (proxyConnection)
            {
              isEntitledForShortcutsAutomationAccess = [messageCopy isEntitledForShortcutsAutomationAccess];

              if ((isEntitledForShortcutsAutomationAccess & 1) == 0)
              {
                v80 = objc_autoreleasePoolPush();
                selfCopy2 = self;
                v82 = HMFGetOSLogHandle();
                if (os_log_type_enabled(v82, OS_LOG_TYPE_ERROR))
                {
                  v83 = HMFGetLogIdentifier();
                  *buf = 138543362;
                  v153 = v83;
                  _os_log_impl(&dword_2531F8000, v82, OS_LOG_TYPE_ERROR, "%{public}@Missing ShortcutsAutomationAccess Entitlement for Execute", buf, 0xCu);
                }

                objc_autoreleasePoolPop(v80);
                v84 = [MEMORY[0x277CCA9B8] hmErrorWithCode:80 description:@"Missing Entitlement" reason:0 suggestion:0];
                [messageCopy respondWithError:v84];

                goto LABEL_91;
              }
            }
          }

          [v94 addObject:v10];
        }

        v5 = [v4 countByEnumeratingWithState:&v143 objects:v165 count:16];
        if (v5)
        {
          continue;
        }

        break;
      }

LABEL_17:

      v16 = [(HMDHome *)self validateActionsDoNotConflict:v94];
      v17 = objc_autoreleasePoolPush();
      val = self;
      v18 = HMFGetOSLogHandle();
      v19 = v18;
      if (v16)
      {
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          v20 = HMFGetLogIdentifier();
          *buf = 138543618;
          v153 = v20;
          v154 = 2112;
          *v155 = v94;
          _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_DEFAULT, "%{public}@Executing actions: %@", buf, 0x16u);
        }

        objc_autoreleasePoolPop(v17);
        v137 = 0;
        v138 = &v137;
        v139 = 0x3032000000;
        v140 = __Block_byref_object_copy__194645;
        v141 = __Block_byref_object_dispose__194646;
        v142 = 0;
        workQueue = [(HMDHome *)val workQueue];
        group = dispatch_group_create();
        v105 = [MEMORY[0x277CBEB18] arrayWithCapacity:{objc_msgSend(v94, "count")}];
        strongToStrongObjectsMapTable = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        strongToStrongObjectsMapTable2 = [MEMORY[0x277CCAB00] strongToStrongObjectsMapTable];
        v135 = 0u;
        v136 = 0u;
        v133 = 0u;
        v134 = 0u;
        obj = v94;
        v21 = [obj countByEnumeratingWithState:&v133 objects:v164 count:16];
        if (!v21)
        {
LABEL_72:

          if ([v105 count])
          {
            objc_initWeak(&location, val);
            dispatch_group_enter(group);
            uUID = [MEMORY[0x277CCAD78] UUID];
            v62 = objc_autoreleasePoolPush();
            v63 = val;
            v64 = HMFGetOSLogHandle();
            if (os_log_type_enabled(v64, OS_LOG_TYPE_INFO))
            {
              v65 = HMFGetLogIdentifier();
              v150 = 0uLL;
              if (uUID)
              {
                [uUID getUUIDBytes:&v150];
              }

              else
              {
                v150 = *MEMORY[0x277D0F960];
              }

              v148 = v150;
              v150 = 0uLL;
              identifier = [messageCopy identifier];

              if (identifier)
              {
                identifier2 = [messageCopy identifier];
                [identifier2 getUUIDBytes:&v150];
              }

              else
              {
                v150 = *MEMORY[0x277D0F960];
              }

              v147 = v150;
              v87 = [v105 count];
              *buf = 138544898;
              v153 = v65;
              v154 = 1042;
              *v155 = 16;
              *&v155[4] = 2098;
              *&v155[6] = &v148;
              v156 = 1042;
              v157 = 16;
              v158 = 2098;
              v159 = &v147;
              v160 = 2114;
              v161 = v63;
              v162 = 2048;
              v163 = v87;
              _os_log_impl(&dword_2531F8000, v64, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for characteristic write actions", buf, 0x40u);
            }

            objc_autoreleasePoolPop(v62);
            qualityOfService = [messageCopy qualityOfService];
            v113[0] = MEMORY[0x277D85DD0];
            v113[1] = 3221225472;
            v113[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29;
            v113[3] = &unk_279735B98;
            v114 = workQueue;
            objc_copyWeak(&v120, &location);
            v115 = v105;
            v116 = strongToStrongObjectsMapTable2;
            v117 = strongToStrongObjectsMapTable;
            v119 = &v137;
            v118 = group;
            [(HMDHome *)v63 writeCharacteristicValues:v115 source:source biomeSource:0 identifier:uUID transport:transport qualityOfService:qualityOfService withCompletionHandler:v113];

            objc_destroyWeak(&v120);
            objc_destroyWeak(&location);
          }

          workQueue2 = [(HMDHome *)val workQueue];
          block[0] = MEMORY[0x277D85DD0];
          block[1] = 3221225472;
          block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31;
          block[3] = &unk_279735BC0;
          v110 = messageCopy;
          v112 = &v137;
          v111 = obj;
          dispatch_group_notify(group, workQueue2, block);

          _Block_object_dispose(&v137, 8);
          goto LABEL_99;
        }

        v106 = *v134;
        while (2)
        {
          v107 = v21;
          v22 = 0;
LABEL_23:
          if (*v134 != v106)
          {
            objc_enumerationMutation(obj);
          }

          v23 = *(*(&v133 + 1) + 8 * v22);
          [v23 configureWithHome:val];
          v24 = v23;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v25 = v24;
          }

          else
          {
            v25 = 0;
          }

          v26 = v25;

          if (v26)
          {
            characteristic = [v26 characteristic];
            targetValue = [v26 targetValue];
            authorizationData = [characteristic authorizationData];
            lightProfile = [HMDCharacteristicWriteRequest writeRequestWithCharacteristic:characteristic value:targetValue authorizationData:authorizationData type:1];

            if (lightProfile)
            {
              [v105 addObject:lightProfile];
              [strongToStrongObjectsMapTable setObject:v26 forKey:lightProfile];
              goto LABEL_70;
            }
          }

          v31 = v24;
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v32 = v31;
          }

          else
          {
            v32 = 0;
          }

          characteristic = v32;

          lightProfile = [characteristic lightProfile];
          if (lightProfile)
          {
            residualAction = [characteristic writeRequestForTransitionStartWithLightProfile:lightProfile startDate:date type:1];
            if (residualAction)
            {
              [strongToStrongObjectsMapTable2 setObject:characteristic forKey:residualAction];
              [v105 addObject:residualAction];
            }

            else
            {
              v39 = objc_autoreleasePoolPush();
              v40 = val;
              v41 = HMFGetOSLogHandle();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
              {
                v42 = HMFGetLogIdentifier();
                *buf = 138543618;
                v153 = v42;
                v154 = 2112;
                *v155 = characteristic;
                _os_log_impl(&dword_2531F8000, v41, OS_LOG_TYPE_ERROR, "%{public}@Failed to create characteristic write request for natural lighting action: %@", buf, 0x16u);
              }

              objc_autoreleasePoolPop(v39);
              residualAction = 0;
            }

LABEL_69:

LABEL_70:
            if (v107 == ++v22)
            {
              v21 = [obj countByEnumeratingWithState:&v133 objects:v164 count:16];
              if (!v21)
              {
                goto LABEL_72;
              }

              continue;
            }

            goto LABEL_23;
          }

          break;
        }

        if (characteristic)
        {
          v34 = objc_autoreleasePoolPush();
          v35 = val;
          v36 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            v37 = HMFGetLogIdentifier();
            *buf = 138543618;
            v153 = v37;
            v154 = 2112;
            *v155 = characteristic;
            _os_log_impl(&dword_2531F8000, v36, OS_LOG_TYPE_ERROR, "%{public}@Skipping executing natural lighting action, missing light profile: %@", buf, 0x16u);
          }

          objc_autoreleasePoolPop(v34);
          v38 = [MEMORY[0x277CCA9B8] hmErrorWithCode:-1];
          residualAction = v138[5];
          v138[5] = v38;
          goto LABEL_69;
        }

        residualAction = v31;
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v43 = residualAction;
        }

        else
        {
          v43 = 0;
        }

        v44 = v43;
        v97 = residualAction;

        if (v44)
        {
          convertedCharacteristicWriteRequests = [v44 convertedCharacteristicWriteRequests];
          v46 = convertedCharacteristicWriteRequests;
          if (convertedCharacteristicWriteRequests)
          {
            residualAction = [convertedCharacteristicWriteRequests residualAction];

            characteristicWriteRequests = [v46 characteristicWriteRequests];
            if (!residualAction)
            {
LABEL_55:

              goto LABEL_56;
            }
          }

          else
          {
            characteristicWriteRequests = 0;
          }

          [residualAction setEncodePlaybackArchiveForExecution:1];
          goto LABEL_55;
        }

        characteristicWriteRequests = 0;
        residualAction = 0;
LABEL_56:
        objc_initWeak(&location, val);
        if ([characteristicWriteRequests count])
        {
          dispatch_group_enter(group);
          uUID2 = [MEMORY[0x277CCAD78] UUID];
          v47 = objc_autoreleasePoolPush();
          v48 = val;
          v49 = HMFGetOSLogHandle();
          if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
          {
            v50 = HMFGetLogIdentifier();
            v150 = 0uLL;
            if (uUID2)
            {
              [uUID2 getUUIDBytes:&v150];
            }

            else
            {
              v150 = *MEMORY[0x277D0F960];
            }

            v151 = v150;
            v150 = 0uLL;
            identifier3 = [messageCopy identifier];

            if (identifier3)
            {
              identifier4 = [messageCopy identifier];
              [identifier4 getUUIDBytes:&v150];
            }

            else
            {
              v150 = *MEMORY[0x277D0F960];
            }

            v149 = v150;
            v53 = [characteristicWriteRequests count];
            *buf = 138544898;
            v153 = v50;
            v154 = 1042;
            *v155 = 16;
            *&v155[4] = 2098;
            *&v155[6] = &v151;
            v156 = 1042;
            v157 = 16;
            v158 = 2098;
            v159 = &v149;
            v160 = 2114;
            v161 = val;
            v162 = 2048;
            v163 = v53;
            _os_log_impl(&dword_2531F8000, v49, OS_LOG_TYPE_INFO, "%{public}@Executing write requests with identifier: %{public,uuid_t}.16P for request identifier %{public,uuid_t}.16P from home: %{public}@ count: %lu for media actions", buf, 0x40u);
          }

          objc_autoreleasePoolPop(v47);
          source2 = [messageCopy source];
          qualityOfService2 = [messageCopy qualityOfService];
          v126[0] = MEMORY[0x277D85DD0];
          v126[1] = 3221225472;
          v126[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke;
          v126[3] = &unk_279735AF8;
          v127 = workQueue;
          objc_copyWeak(&v131, &location);
          v56 = characteristicWriteRequests;
          v128 = v56;
          v130 = &v137;
          v129 = group;
          [(HMDHome *)v48 writeCharacteristicValues:v56 source:source2 biomeSource:0 identifier:uUID2 transport:transport qualityOfService:qualityOfService2 withCompletionHandler:v126];

          objc_destroyWeak(&v131);
        }

        clientName = [messageCopy clientName];
        v58 = clientName;
        v59 = @"Unknown";
        if (clientName)
        {
          v59 = clientName;
        }

        v60 = v59;

        dispatch_group_enter(group);
        v121[0] = MEMORY[0x277D85DD0];
        v121[1] = 3221225472;
        v121[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26;
        v121[3] = &unk_279735B48;
        v122 = workQueue;
        objc_copyWeak(&v125, &location);
        v124 = &v137;
        v123 = group;
        [v97 executeWithSource:source clientName:v60 completionHandler:v121];

        objc_destroyWeak(&v125);
        objc_destroyWeak(&location);

        goto LABEL_69;
      }

      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        v78 = HMFGetLogIdentifier();
        *buf = 138543362;
        v153 = v78;
        _os_log_impl(&dword_2531F8000, v19, OS_LOG_TYPE_ERROR, "%{public}@Failed to validate actions", buf, 0xCu);
      }

      objc_autoreleasePoolPop(v17);
      v79 = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
      [messageCopy respondWithError:v79];

LABEL_99:
    }

    else
    {
      v70 = objc_autoreleasePoolPush();
      selfCopy3 = self;
      v72 = HMFGetOSLogHandle();
      if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
      {
        v73 = HMFGetLogIdentifier();
        *buf = 138543618;
        v153 = v73;
        v154 = 2112;
        *v155 = messageCopy;
        _os_log_impl(&dword_2531F8000, v72, OS_LOG_TYPE_ERROR, "%{public}@Invalid actions payload: %@", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v70);
      date = [MEMORY[0x277CCA9B8] hmErrorWithCode:22];
      [messageCopy respondWithError:date];
    }
  }

  else
  {
    v66 = objc_autoreleasePoolPush();
    selfCopy4 = self;
    v68 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
    {
      v69 = HMFGetLogIdentifier();
      *buf = 138543618;
      v153 = v69;
      v154 = 2112;
      *v155 = messageCopy;
      _os_log_impl(&dword_2531F8000, v68, OS_LOG_TYPE_ERROR, "%{public}@No Actions in message:(%@)", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v66);
    date = [MEMORY[0x277CCA9B8] hmErrorWithCode:3];
    [messageCopy respondWithError:date];
  }

  v90 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2;
  block[3] = &unk_279735AD0;
  objc_copyWeak(&v17, (a1 + 64));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = v6;
  v11 = *(a1 + 48);
  v8 = v11;
  v16 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v17);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_26(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27;
  block[3] = &unk_279735B20;
  objc_copyWeak(&v11, (a1 + 56));
  v9 = v3;
  v7 = *(a1 + 40);
  v5 = v7;
  v10 = v7;
  v6 = v3;
  dispatch_async(v4, block);

  objc_destroyWeak(&v11);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_29(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = *(a1 + 32);
  block[0] = MEMORY[0x277D85DD0];
  block[1] = 3221225472;
  block[2] = __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30;
  block[3] = &unk_279735B70;
  objc_copyWeak(&v19, (a1 + 80));
  v13 = v5;
  v14 = *(a1 + 40);
  v15 = *(a1 + 48);
  v16 = v6;
  v17 = *(a1 + 56);
  v11 = *(a1 + 64);
  v8 = v11;
  v18 = v11;
  v9 = v6;
  v10 = v5;
  dispatch_async(v7, block);

  objc_destroyWeak(&v19);
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_31(uint64_t a1)
{
  v2 = [*(a1 + 32) responseHandler];

  if (v2)
  {
    v3 = [*(a1 + 32) responseHandler];
    (*(v3 + 2))(v3, *(*(*(a1 + 48) + 8) + 40), 0);
  }
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_30(uint64_t a1)
{
  v56 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 88));
  v3 = *(a1 + 32);
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v48 = 0u;
  obj = *(a1 + 40);
  v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
  if (v42)
  {
    v41 = *v46;
    v38 = WeakRetained;
    do
    {
      for (i = 0; i != v42; ++i)
      {
        if (*v46 != v41)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v45 + 1) + 8 * i);
        v6 = [*(a1 + 48) objectForKey:v5];
        v7 = v6;
        if (v6)
        {
          v8 = *(a1 + 56);
          v9 = [v6 isNaturalLightingEnabled];
          v44 = 0;
          v10 = [v8 hmd_isValidResponseForWriteRequest:v5 naturalLightingEnabled:v9 error:&v44];
          v11 = v44;
          v12 = objc_autoreleasePoolPush();
          v13 = WeakRetained;
          v14 = HMFGetOSLogHandle();
          v15 = v14;
          if (v10)
          {
            if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
            {
              v16 = HMFGetLogIdentifier();
              *buf = 138543618;
              v50 = v16;
              v51 = 2112;
              v52 = v7;
              v17 = v15;
              v18 = OS_LOG_TYPE_INFO;
              v19 = "%{public}@Successfully executed natural lighting action: %@";
              v20 = 22;
              goto LABEL_15;
            }
          }

          else if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
          {
            v16 = HMFGetLogIdentifier();
            *buf = 138543874;
            v50 = v16;
            v51 = 2112;
            v52 = v7;
            v53 = 2112;
            v54 = v11;
            v17 = v15;
            v18 = OS_LOG_TYPE_ERROR;
            v19 = "%{public}@Failed to execute natural lighting action %@:%@";
            v20 = 32;
LABEL_15:
            _os_log_impl(&dword_2531F8000, v17, v18, v19, buf, v20);
          }

          objc_autoreleasePoolPop(v12);
          if (v3)
          {
            goto LABEL_24;
          }

          goto LABEL_22;
        }

        v40 = v3;
        v21 = [*(a1 + 64) objectForKey:v5];
        v22 = *(a1 + 56);
        v23 = [v5 characteristic];
        v43 = 0;
        v24 = [v22 hmd_valueOfCharacteristic:v23 error:&v43];
        v11 = v43;

        v25 = objc_autoreleasePoolPush();
        v26 = WeakRetained;
        v27 = HMFGetOSLogHandle();
        v28 = v27;
        if (v24)
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543618;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v30 = v28;
          v31 = OS_LOG_TYPE_INFO;
          v32 = "%{public}@Successfully executed characteristic write action: %@";
          v33 = 22;
        }

        else
        {
          if (!os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_21;
          }

          v29 = HMFGetLogIdentifier();
          *buf = 138543874;
          v50 = v29;
          v51 = 2112;
          v52 = v21;
          v53 = 2112;
          v54 = v11;
          v30 = v28;
          v31 = OS_LOG_TYPE_ERROR;
          v32 = "%{public}@Failed to execute characteristic write action %@:%@";
          v33 = 32;
        }

        _os_log_impl(&dword_2531F8000, v30, v31, v32, buf, v33);

        WeakRetained = v38;
LABEL_21:

        objc_autoreleasePoolPop(v25);
        v3 = v40;
        if (v40)
        {
          goto LABEL_24;
        }

LABEL_22:
        if (v11)
        {
          v3 = v11;
        }

LABEL_24:
      }

      v42 = [obj countByEnumeratingWithState:&v45 objects:v55 count:16];
    }

    while (v42);
  }

  if (v3)
  {
    v34 = *(*(a1 + 80) + 8);
    v36 = *(v34 + 40);
    v35 = (v34 + 40);
    if (!v36)
    {
      objc_storeStrong(v35, v3);
    }
  }

  dispatch_group_leave(*(a1 + 72));

  v37 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2_27(uint64_t a1)
{
  v16 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  if (*(a1 + 32))
  {
    v3 = objc_autoreleasePoolPush();
    v4 = WeakRetained;
    v5 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v6 = HMFGetLogIdentifier();
      v7 = *(a1 + 32);
      v12 = 138543618;
      v13 = v6;
      v14 = 2112;
      v15 = v7;
      _os_log_impl(&dword_2531F8000, v5, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute action with error: %@", &v12, 0x16u);
    }

    objc_autoreleasePoolPop(v3);
    v8 = *(*(a1 + 48) + 8);
    v10 = *(v8 + 40);
    v9 = (v8 + 40);
    if (!v10)
    {
      objc_storeStrong(v9, *(a1 + 32));
    }
  }

  dispatch_group_leave(*(a1 + 40));

  v11 = *MEMORY[0x277D85DE8];
}

void __56__HMDHome_HMActionExecution__executeActionsFromMessage___block_invoke_2(id *a1)
{
  v73 = *MEMORY[0x277D85DE8];
  WeakRetained = objc_loadWeakRetained(a1 + 9);
  v3 = a1[4];
  v34 = a1;
  if (v3)
  {
    v4 = v3;
    v5 = objc_autoreleasePoolPush();
    v6 = WeakRetained;
    v7 = HMFGetOSLogHandle();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = HMFGetLogIdentifier();
      *buf = 138543618;
      v61 = v8;
      v62 = 2112;
      v63 = v4;
      _os_log_impl(&dword_2531F8000, v7, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for converted media action with error: %@", buf, 0x16u);
    }

    objc_autoreleasePoolPop(v5);
  }

  else
  {
    v31 = [a1[5] count];
    v56 = 0u;
    v57 = 0u;
    v58 = 0u;
    v59 = 0u;
    v12 = a1[6];
    v35 = [v12 countByEnumeratingWithState:&v56 objects:v72 count:16];
    if (!v35)
    {

      v4 = 0;
      v11 = 0;
      goto LABEL_37;
    }

    v13 = 0;
    v4 = 0;
    obj = v12;
    v33 = *v57;
    v45 = *MEMORY[0x277CD2128];
    do
    {
      v14 = 0;
      do
      {
        if (*v57 != v33)
        {
          v15 = v14;
          objc_enumerationMutation(obj);
          v14 = v15;
        }

        v36 = v14;
        v41 = *(*(&v56 + 1) + 8 * v14);
        v16 = [v34[6] hmf_dictionaryForKey:v31];
        v52 = 0u;
        v53 = 0u;
        v54 = 0u;
        v55 = 0u;
        v39 = v16;
        v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
        if (v38)
        {
          v37 = *v53;
          do
          {
            v17 = 0;
            do
            {
              if (*v53 != v37)
              {
                objc_enumerationMutation(v39);
              }

              v40 = v17;
              v42 = *(*(&v52 + 1) + 8 * v17);
              v18 = [v39 hmf_dictionaryForKey:?];
              v48 = 0u;
              v49 = 0u;
              v50 = 0u;
              v51 = 0u;
              v19 = v18;
              v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
              if (v47)
              {
                v46 = *v49;
                v44 = v19;
                do
                {
                  for (i = 0; i != v47; ++i)
                  {
                    if (*v49 != v46)
                    {
                      objc_enumerationMutation(v19);
                    }

                    v21 = *(*(&v48 + 1) + 8 * i);
                    v22 = [v19 hmf_dictionaryForKey:v21];
                    v23 = [v22 hmf_dataForKey:v45];
                    if (v23)
                    {
                      v24 = [MEMORY[0x277CCAAC8] unarchivedObjectOfClass:objc_opt_class() fromData:v23 error:0];

                      v25 = objc_autoreleasePoolPush();
                      v26 = WeakRetained;
                      v27 = HMFGetOSLogHandle();
                      if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
                      {
                        HMFGetLogIdentifier();
                        v43 = v13;
                        v29 = v28 = WeakRetained;
                        *buf = 138544386;
                        v61 = v29;
                        v62 = 2112;
                        v63 = v41;
                        v64 = 2112;
                        v65 = v42;
                        v66 = 2112;
                        v67 = v21;
                        v68 = 2112;
                        v69 = v24;
                        _os_log_impl(&dword_2531F8000, v27, OS_LOG_TYPE_ERROR, "%{public}@Failed to execute write requests for %@/%@/%@ with error: %@", buf, 0x34u);

                        WeakRetained = v28;
                        v13 = v43;
                      }

                      ++v13;

                      objc_autoreleasePoolPop(v25);
                      v4 = v24;
                      v19 = v44;
                    }
                  }

                  v47 = [v19 countByEnumeratingWithState:&v48 objects:v70 count:16];
                }

                while (v47);
              }

              v17 = v40 + 1;
            }

            while (v40 + 1 != v38);
            v38 = [v39 countByEnumeratingWithState:&v52 objects:v71 count:16];
          }

          while (v38);
        }

        v14 = v36 + 1;
      }

      while (v36 + 1 != v35);
      v35 = [obj countByEnumeratingWithState:&v56 objects:v72 count:16];
    }

    while (v35);

    v11 = 0;
    if (!v31 || v31 != v13)
    {
      goto LABEL_37;
    }

    if (!v4)
    {
      goto LABEL_38;
    }
  }

  v9 = v34;
  v10 = *(v34[8] + 1);
  if (!*(v10 + 40))
  {
    v11 = v4;
    v4 = *(v10 + 40);
    *(v10 + 40) = v11;
LABEL_37:

    v4 = v11;
LABEL_38:
    v9 = v34;
  }

  dispatch_group_leave(v9[7]);

  v30 = *MEMORY[0x277D85DE8];
}

@end