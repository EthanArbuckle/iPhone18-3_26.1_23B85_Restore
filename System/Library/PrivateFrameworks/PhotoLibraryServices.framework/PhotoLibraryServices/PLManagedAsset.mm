@interface PLManagedAsset
+ (BOOL)_checkComputeSyncUploadPolicyWithCPLConfiguration:(id)configuration library:(id)library debugMode:(BOOL)mode debugLog:(id)log;
+ (BOOL)_isLibraryScopeExiting:(id)exiting;
+ (BOOL)_isScreenshotWithType:(id)type hasScreenshotDimensions:(BOOL)dimensions hasScreenshotMetadata:(BOOL)metadata;
+ (BOOL)_shouldPushComputeSyncWithLocalMajorVersion:(signed __int16)version localAnalaysisStage:(signed __int16)stage cloudComputeStateVersionStr:(id)str localAdjustmentFingerprint:(id)fingerprint cloudAdjustmentFingerprint:(id)adjustmentFingerprint scopedIdentifier:(id)identifier;
+ (BOOL)attemptToRecreateMasterAndAssetResourcesForPlaceholderAssetRepush:(id)repush sourceAsset:(id)asset library:(id)library;
+ (BOOL)canPlayPhotoIrisWithPhotoIris:(BOOL)iris photoIrisPlaceholder:(BOOL)placeholder hasAdjustments:(BOOL)adjustments videoCpVisibilityState:(unsigned __int16)state;
+ (BOOL)cloneResourceFileFromURL:(id)l toURL:(id)rL forDestinationResource:(id)resource forDestinationAsset:(id)asset fileManager:(id)manager error:(id *)error;
+ (BOOL)createAssetResourcesForPlaceholderAsset:(id)asset withSourceAsset:(id)sourceAsset shouldBakeInAdjustments:(BOOL)adjustments shouldFlattenLivePhoto:(BOOL)photo placeholderResourceURLToSourceResourceURLMap:(id)map photoLibrary:(id)library;
+ (BOOL)createMasterForPlaceholderAsset:(id)asset withSourceAsset:(id)sourceAsset shouldBakeInAdjustments:(BOOL)adjustments shouldFlattenLivePhoto:(BOOL)photo placeholderResourceURLToSourceResourceURLMap:(id)map photoLibrary:(id)library;
+ (BOOL)createShareAssetsForShare:(id)share batchedSourceAssetsToCopy:(id)copy creationRequestSourceAssetsToShareAssetsMap:(id)map curatedSourceAssets:(id)assets adjustmentBakeInOptionsDictionary:(id)dictionary metadataCopyOptionsDictionary:(id)optionsDictionary keySourceAssetIdentifier:(id)identifier commentText:(id)self0 clientConnection:(id)self1 library:(id)self2 error:(id *)self3;
+ (BOOL)guaranteedFlashOffForAssetAtURL:(id)l;
+ (BOOL)hasMasterThumbWithThumbnailIndex:(int64_t)index;
+ (BOOL)hasRequiredExtendedAttributesForMainFileURL:(id)l;
+ (BOOL)hasRequiredExtendedAttributesForPersistanceAttributes:(id)attributes;
+ (BOOL)installResourcesForAssetAndRemoveDeferredProcessingPreviewFile:(id)file error:(id *)error;
+ (BOOL)invalidateReverseLocationDataOnAllAssetsInManagedObjectContext:(id)context error:(id *)error;
+ (BOOL)isComputeSyncEnabledForDirection:(int64_t)direction library:(id)library debugMode:(BOOL)mode debugLog:(id *)log;
+ (BOOL)isHFRVideoAVAsset:(id)asset;
+ (BOOL)isKnownFileExtension:(id)extension;
+ (BOOL)isPhotoIrisPlaceholderWithPhotoIris:(BOOL)iris videoCpDuration:(int64_t)duration isCloudShared:(BOOL)shared videoCpFilePath:(id)path;
+ (BOOL)isPrimaryImageFormatForUTI:(id)i;
+ (BOOL)isScreenRecordingFileName:(id)name;
+ (BOOL)isValidFileExtensionForImport:(id)import;
+ (BOOL)isValidFileURLForImport:(id)import;
+ (BOOL)isVideoComplementVisibilityStatePlayable:(unsigned __int16)playable hasAdjustments:(BOOL)adjustments;
+ (BOOL)markUnavailableComputeSyncResourcesWithManagedObjectContext:(id)context error:(id *)error;
+ (BOOL)shouldBakeInAdjustmentsAndFlattenLivePhoto:(BOOL *)photo forSourceAsset:(id)asset adjustmentBakeInOptions:(id)options;
+ (BOOL)shouldPerformServerCopyOnPlaceholderAsset:(id)asset photoLibrary:(id)library;
+ (BOOL)shouldPerformServerCopyWithSourceAsset:(id)asset copyingFromShare:(BOOL)share photoLibrary:(id)library;
+ (BOOL)shouldSyncAssetToSPLWithSavedAssetType:(signed __int16)type syndicationState:(unsigned __int16)state;
+ (BOOL)validShareForPlaceholderAsset:(id)asset;
+ (CGSize)dimensionsForAVAsset:(id)asset;
+ (CGSize)dimensionsForVideoAtURL:(id)l;
+ (CGSize)sizeOfImageAtURL:(id)l outOrientation:(signed __int16 *)orientation;
+ (NSPredicate)predicateToIncludeSharedLibrarySharingSuggestionsAssets;
+ (PLManagedAsset)assetWithObjectID:(id)d inLibrary:(id)library;
+ (PLManagedAsset)assetWithObjectID:(id)d inManagedObjectContext:(id)context;
+ (PLManagedAsset)assetWithScopedIdentifier:(id)identifier inLibrary:(id)library prefetchResources:(BOOL)resources;
+ (PLManagedAsset)assetWithSyndicationIdentifier:(id)identifier inLibrary:(id)library;
+ (PLManagedAsset)assetWithUUID:(id)d inLibrary:(id)library;
+ (PLManagedAsset)assetWithUUID:(id)d inManagedObjectContext:(id)context;
+ (id)_cloudAdjustmentFingerprintWithAdjustmentDataBlob:(id)blob largeAdjustmentBlobFingerpint:(id)fingerpint formatIdentifier:(id)identifier formatVersion:(id)version editorBundleID:(id)d baseVersion:(int64_t)baseVersion baseImageData:(id)data baseImageFingerprint:(id)self0;
+ (id)_countOfAssetsByKindWithResourcePredicate:(id)predicate inContext:(id)context;
+ (id)_createAssetModelToInsert:(id)insert uuid:(id)uuid replacementUUID:(id)d;
+ (id)_dataFromCPLPlaceAnnotation:(id)annotation;
+ (id)_importAlbumIsolationQueue;
+ (id)_insertAssetIntoPhotoLibrary:(id)library mainFileURL:(id)l mainFileMetadata:(id)metadata savedAssetType:(signed __int16)type bundleScope:(unsigned __int16)scope uuid:(id)uuid replacementUUID:(id)d imageSource:(CGImageSource *)self0 imageData:(id *)self1 isPlaceholder:(BOOL)self2 deleteFileOnFailure:(BOOL)self3;
+ (id)_insertSyndicationAssetIntoPhotoLibrary:(id)library uuid:(id)uuid syndicationIdentifier:(id)identifier bundleID:(id)d addedDate:(id)date;
+ (id)_newPathAndDateDictionariesByAssetUUIDFromFetchResults:(id)results photoLibrary:(id)library;
+ (id)_notPushedAssetsToUploadInitiallyInManagedObjectContext:(id)context withSavedAssetTypePredicate:(id)predicate shouldSort:(BOOL)sort limit:(unint64_t)limit;
+ (id)_placeAnnotationFromAnnotationData:(id)data;
+ (id)_predicateForAssetsWithNotCompleteResourcesOnResource;
+ (id)_predicateForAvalancheKindAssetsWithUUID:(id)d kind:(unsigned __int16)kind;
+ (id)_predicateForCloudLocalStates:(id)states;
+ (id)_predicateForDepthType:(signed __int16)type;
+ (id)_predicateForTrashedAssetsToExcludeInInitialUpload;
+ (id)_ptpCalendar;
+ (id)_ptpEventInfoIsolationQueue;
+ (id)_syncablePredicate;
+ (id)_syndicationAssetForSearchableItem:(id)item inLibrary:(id)library createIfNeeded:(BOOL)needed didCreate:(BOOL *)create error:(id *)error;
+ (id)_videoComplementURLForSharingFromAsset:(id)asset;
+ (id)allCloudSharedAssetsInLibrary:(id)library;
+ (id)allHDRValues;
+ (id)assetUUIDsByObjectIDs:(id)ds withFilterPredicate:(id)predicate context:(id)context error:(id *)error;
+ (id)assetsByCloudAssetUUID:(id)d inLibrary:(id)library;
+ (id)assetsByScopedIdentifiers:(id)identifiers relationshipKeyPathsForPrefetching:(id)prefetching inLibrary:(id)library;
+ (id)assetsLibraryURLWithUUID:(id)d extension:(id)extension;
+ (id)assetsToConsiderForTypePromotionInContext:(id)context withExtensions:(id)extensions error:(id *)error;
+ (id)assetsToRetryInLibrary:(id)library limit:(unint64_t)limit;
+ (id)assetsToUploadInitiallyInManagedObjectContext:(id)context limit:(unint64_t)limit;
+ (id)assetsWithGroupingUUID:(id)d inManagedObjectContext:(id)context;
+ (id)assetsWithObjectIDs:(id)ds inLibrary:(id)library;
+ (id)assetsWithScopedIdentifiers:(id)identifiers prefetchResources:(BOOL)resources relationshipKeyPathsForPrefetching:(id)prefetching inLibrary:(id)library;
+ (id)assetsWithUUIDs:(id)ds options:(unint64_t)options inLibrary:(id)library;
+ (id)assetsWithUUIDs:(id)ds options:(unint64_t)options inManagedObjectContext:(id)context;
+ (id)assetsWithValidatedSavedAssetTypeMask:(unsigned int)mask inManagedObjectContext:(id)context;
+ (id)attributeValidationRules;
+ (id)calculateImageRequestHintsFromSortedResources:(id)resources asset:(id)asset;
+ (id)cloudMasterMediaMetadataForAssetObjectID:(id)d managedObjectContext:(id)context error:(id *)error;
+ (id)cloudSharedAssetsWithGUIDs:(id)ds inLibrary:(id)library;
+ (id)createCloudPhotoLibraryAssetWithAssetRecord:(id)record withCloudMaster:(id)master inLibrary:(id)library;
+ (id)createOrUpdateObjectFromSearchableItem:(id)item library:(id)library fullIndexSyncStartDate:(id)date createIfNeeded:(BOOL)needed didCreate:(BOOL *)create isSyndicatable:(BOOL *)syndicatable error:(id *)error;
+ (id)createSparseComputeStateRecordsForAssets:(id)assets inPhotoLibrary:(id)library;
+ (id)debugDescriptionForHintData:(id)data assetWidth:(int64_t)width assetHeight:(int64_t)height assetID:(id)d;
+ (id)diagnosticFilePathForLibrary:(id)library mainFilename:(id)filename createIfNeeded:(BOOL)needed;
+ (id)eventInfoForPTP;
+ (id)failedToPushAssetInLibrary:(id)library;
+ (id)fetchAssetsWithUUIDs:(id)ds managedObjectContext:(id)context;
+ (id)fetchAssetsWithUUIDs:(id)ds managedObjectContext:(id)context error:(id *)error;
+ (id)fetchPredicateForLegacyRequiredResourcesLocallyAvailable:(BOOL)available photoLibrary:(id)library;
+ (id)fetchRequestForResourcesWithObjectID:(id)d versions:(id)versions allowDerivatives:(BOOL)derivatives excludeDynamicCPLResources:(BOOL)resources additionalPredicate:(id)predicate relationshipKeyPathsForPrefetching:(id)prefetching;
+ (id)fetchRequestForSortedCloudSharedAssetsWithPlaceholderKindsRequiringThumbnails:(BOOL)thumbnails additionalPredicate:(id)predicate ascending:(BOOL)ascending;
+ (id)fetchResourcesForAssetWithObjectID:(id)d inContext:(id)context versions:(id)versions includeVirtualResources:(BOOL)resources allowDerivatives:(BOOL)derivatives excludeDynamicCPLResources:(BOOL)lResources additionalPredicate:(id)predicate relationshipKeyPathsForPrefetching:(id)self0 error:(id *)self1;
+ (id)fileURLFromAssetURL:(id)l photoLibrary:(id)library;
+ (id)generateFullComputeStateRecordForRecord:(id)record payloadHelper:(id)helper destinationDirectoryURL:(id)l inPhotoLibrary:(id)library;
+ (id)imageAssetsForMediaGroupUUID:(id)d moc:(id)moc;
+ (id)isEligibleForSearchIndexingPredicateForLibraryIdentifier:(int64_t)identifier;
+ (id)lightweightReimportFileNameWithGUID:(id)d type:(id)type;
+ (id)listOfSharingAttributesRelevantForUpload;
+ (id)listOfSharingRelationshipsRelevantForUpload;
+ (id)listOfSyncedProperties;
+ (id)newImagePropertiesFromImageSource:(CGImageSource *)source;
+ (id)newLocationDataFromLocation:(id)location;
+ (id)newLocationFromLocationData:(id)data timestampIfMissing:(id)missing;
+ (id)objectsWithScopedIdentifiers:(id)identifiers forEntityName:(id)name prefetchResources:(BOOL)resources relationshipKeyPathsForPrefetching:(id)prefetching inLibrary:(id)library;
+ (id)pathAndDateDictionariesForAllIncompleteAssetsInManagedObjectContext:(id)context;
+ (id)pathForAdjustmentDataFileWithPathManager:(id)manager bundleScope:(unsigned __int16)scope uuid:(id)uuid directory:(id)directory filename:(id)filename;
+ (id)pathForAdjustmentFileWithPathManager:(id)manager bundleScope:(unsigned __int16)scope uuid:(id)uuid directory:(id)directory filename:(id)filename;
+ (id)pathForAlchemistImageWithUUID:(id)d bundleScope:(unsigned __int16)scope directory:(id)directory filename:(id)filename pathManager:(id)manager;
+ (id)pathForMutationsDirectoryWithDirectory:(id)directory filename:(id)filename;
+ (id)persistedRecentlyUsedGUIDSWithPathManager:(id)manager;
+ (id)photoFromAssetURL:(id)l photoLibrary:(id)library sidecar:(id *)sidecar;
+ (id)predicateExcludingLocallyUnavailableDynamicCPLResources;
+ (id)predicateFilteringForNonDerivativeRecipeIDs;
+ (id)predicateForAdjustedAssetsWithKeyPathToAsset:(id)asset;
+ (id)predicateForAssetSharingFilter:(signed __int16)filter noindex:(BOOL)noindex;
+ (id)predicateForAssetSubtype:(signed __int16)subtype;
+ (id)predicateForAssetsIncompletelyProcessedForSensitivity;
+ (id)predicateForAssetsToCheckForDeletionOnCPLDisable;
+ (id)predicateForAssetsWithCompleteResourcesOnAsset;
+ (id)predicateForAvalancheKindAssetsWithKind:(unsigned __int16)kind;
+ (id)predicateForBurstStackAssets;
+ (id)predicateForReframedAssets;
+ (id)predicateForShouldSyncToSPL;
+ (id)predicateForSpatialOverCaptureAssets;
+ (id)predicateForStyleableAssets;
+ (id)predicateForSupportedAssetTypesForUpload;
+ (id)predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders;
+ (id)predicateForSyndicatedAssetIdentifiers:(id)identifiers includeRejected:(BOOL)rejected;
+ (id)predicateForSyndicatedAssetIdentifiersSuffix:(id)suffix;
+ (id)predicateForUnadjustedAssetsWithKeyPathToAsset:(id)asset;
+ (id)predicateForUnpushedDeferredAssets;
+ (id)predicateForUploadableAssetsWithCloudLocalState:(signed __int16)state;
+ (id)predicateForUploadableAssetsWithCloudLocalStates:(id)states;
+ (id)predicateForUploadableAssetsWithMasterCloudLocalStateNotEqualTo:(signed __int16)to;
+ (id)predicateForUploadableAssetsWithoutCloudLocalState:(signed __int16)state;
+ (id)predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath:(id)path;
+ (id)predicateToExcludeCameraAutoAdjustments;
+ (id)predicateToExcludeHiddenAssetsWithHiddenKeyPath:(id)path;
+ (id)predicateToExcludeNonVisibleStackedAssets;
+ (id)predicateToExcludeNonvisibleBurstAssets;
+ (id)predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath:(id)path;
+ (id)predicateToExcludeRestrictedLockedAssets;
+ (id)predicateToExcludeTrashedAssets;
+ (id)predicateToExcludeTrashedAssetsWithTrashedStateKeyPath:(id)path;
+ (id)predicateToExcludeVideosWithVideoKeyFrameSetWithKeyPathToAsset:(id)asset;
+ (id)predicateToIncludeBothPrivateAssetsAndSharedContentContributedByCurrentUser;
+ (id)predicateToIncludeDuplicateAssetVisibilityStateMostRelevant;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToFaceVersion:(id)version;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestFaceVersion;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestSceneVersion;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToSceneVersion:(id)version;
+ (id)predicateToIncludePrivateLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)state;
+ (id)predicateToIncludeSharedLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)state;
+ (id)predicateToLimitToCaptureSessionIdentifier:(id)identifier;
+ (id)preferredFileExtensionForType:(id)type;
+ (id)propertiesToFetch;
+ (id)ptpAssetIDForEventAndFilenameKey:(id)key;
+ (id)quarantinedAssetsInLibrary:(id)library;
+ (id)relationshipKeyPathsToPrefetch;
+ (id)toUploadAssetsInLibrary:(id)library;
+ (id)uniformTypeFromPathExtension:(id)extension assetType:(signed __int16)type;
+ (id)uniformTypeIdentifierFromPathExtension:(id)extension assetType:(signed __int16)type;
+ (id)uuidFromAssetURL:(id)l fileExtension:(id *)extension sidecarIndex:(id *)index;
+ (id)videoAssetsForMediaGroupUUID:(id)d moc:(id)moc;
+ (id)videoComplementVisibilityStatePlayablePredicate;
+ (int64_t)_locationDataFormat:(id)format;
+ (int64_t)adjustmentBaseVersionFromPFAdjustmentsBaseVersion:(int64_t)version;
+ (int64_t)pfAdjustmentsBaseVersionFromAdjustmentBaseVersion:(int64_t)version;
+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)library urgency:(int64_t)urgency;
+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)library urgency:(int64_t)urgency sizeOption:(unint64_t)option;
+ (signed)assetTypeFromUniformTypeIdentifier:(id)identifier;
+ (signed)correctedOrientation:(signed __int16)orientation;
+ (signed)imageDepthTypeFromCustomRenderedValue:(signed __int16)value;
+ (signed)imageHDRTypeFromCustomRenderedValue:(signed __int16)value;
+ (unint64_t)CPLAssetHDRTypeFromPLAssetHDRType:(signed __int16)type;
+ (unint64_t)_sumOfCountsInCountedSet:(id)set;
+ (unint64_t)countForAssetsWithUUIDs:(id)ds uuidKeyPath:(id)path includePendingChanges:(BOOL)changes inManagedObjectContext:(id)context error:(id *)error;
+ (unint64_t)countOfDeferredAssetsToSyncInPhotoLibrary:(id)library outAssetList:(id)list;
+ (unint64_t)countOfNotUploadedAssetsInPhotoLibrary:(id)library forAssetType:(signed __int16)type error:(id *)error;
+ (unint64_t)countUsedAssetsWithKind:(signed __int16)kind excludeTrashed:(BOOL)trashed excludeInvisible:(BOOL)invisible excludeCloudShared:(BOOL)shared excludePhotoStream:(BOOL)stream inManagedObjectContext:(id)context;
+ (unint64_t)iCPLAssetCountInPhotoLibrary:(id)library;
+ (unint64_t)resourceTypeForUnadjustedFlattenedLivePhotoAssetResourceType:(unint64_t)type;
+ (unint64_t)totalSizeOfUnpushedOriginalsInPhotoLibrary:(id)library outMasterList:(id)list isInitialUpload:(BOOL)upload;
+ (unsigned)defaultPlaybackStyleFromAssetType:(signed __int16)type subtype:(signed __int16)subtype playbackVariation:(unsigned __int16)variation;
+ (void)_cloneResourcesForSharePlaceholderAsset:(id)asset withPlaceholderResourceURLToSourceResourceURLMap:(id)map fileManager:(id)manager photoLibrary:(id)library;
+ (void)_createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs:(id)ds withBatchCommentText:(id)text adjustmentBakeInOptionsDictionary:(id)dictionary collectionShare:(id)share library:(id)library completionHandler:(id)handler;
+ (void)_rm_copyResourceFileFrom:(id)from to:(id)to forCloudMaster:(id)master andAsset:(id)asset;
+ (void)batchFetchAssetsByFaceUUIDWithFaceUUIDs:(id)ds library:(id)library completion:(id)completion;
+ (void)clearImportSessionObjectIDCacheOnManagedObjectContext:(id)context;
+ (void)computePreCropThumbnailSize:(CGSize *)size andPostCropSize:(CGSize *)cropSize forOrientedOriginalSize:(CGSize)originalSize andCroppedSize:(CGSize)croppedSize isLargeThumbnail:(BOOL)thumbnail;
+ (void)countOfAssetsWithRequiredResourcesNotLocallyAvailableInLibrary:(id)library outCount:(unint64_t *)count photoCount:(unint64_t *)photoCount videoCount:(unint64_t *)videoCount;
+ (void)createMastersInLibrary:(id)library;
+ (void)createTHMFileWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fileURLForThumbnailFile:(id)file;
+ (void)createThumbnailImage:(id *)image previewImage:(id *)previewImage withToBeReleasedImageSource:(CGImageSource *)source;
+ (void)deleteOldPlaceholderAssetsInManagedObjectContext:(id)context;
+ (void)enumerateImageRequestHintData:(id)data assetWidth:(int64_t)width assetHeight:(int64_t)height libraryID:(id)d startingOffset:(int64_t)offset assetID:(id)iD block:(id)block;
+ (void)fixMissingOriginalDateCreatedIfNeededForAsset:(id)asset withCloudMaster:(id)master;
+ (void)fixMissingOriginalTimezoneIfNeededForAsset:(id)asset;
+ (void)fixupCloudPhotoLibraryAsset:(id)asset withCloudMaster:(id)master inLibrary:(id)library;
+ (void)markAssetAsRecentlyUsed:(id)used;
+ (void)markMomentShareAndCollectionShareAssetsAsCopied:(id)copied;
+ (void)performTransactionOnSyndicationLibraryWithSyndicationIdentifier:(id)identifier block:(id)block;
+ (void)processAdjustedMediaMetadataForAsset:(id)asset;
+ (void)processMediaMetadataForAsset:(id)asset withCloudMaster:(id)master;
+ (void)ptpResetEventAndFilenameMapping;
+ (void)ptpSetAssetIDForEventAndFilenameKey:(id)key value:(id)value;
+ (void)resetAssetsCloudStateInLibrary:(id)library;
+ (void)rm_cplResourceWasUploaded:(id)uploaded photoLibrary:(id)library;
+ (void)updateAllAlbumAssociationIfNeededWithLibrary:(id)library;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisStillDisplayTime;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisVideoDuration;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)videoKeyFrameTime;
- (BOOL)_analysisStateWasChangedForWorkerType:(signed __int16)type;
- (BOOL)_checkForAndAddFrameDropRecoveryForPhotoKitIngest;
- (BOOL)_hasBecomeNonVisibleToMemoriesAndPersonsAndSuggestions:(id)suggestions;
- (BOOL)_hasPanoramaDimensions;
- (BOOL)_hasScreenshotDimensions;
- (BOOL)_hasVideoComplementData;
- (BOOL)_ingestAndApplyMetadataChangesFromAdjustments:(id)adjustments updateAdjustmentDictionary:(id)dictionary options:(id)options fullSizeRenderURL:(id)l videoPosterRenderURL:(id)rL isRevertToOriginal:(BOOL)original error:(id *)error;
- (BOOL)_installExistingPurgeableResourceAtPath:(id)path dstPath:(id)dstPath error:(id *)error installResourceHandler:(id)handler;
- (BOOL)_isAdjustedResourceAvailableForResourceType:(unint64_t)type outResource:(id *)resource;
- (BOOL)_isCameraAutoAdjustmentChecksNeededAndUpdateAsset;
- (BOOL)_isMasterResourceAvailableForResourceType:(unint64_t)type outResource:(id *)resource;
- (BOOL)_isPartOfAvalancheWithKind:(unsigned __int16)kind;
- (BOOL)_isResourceAvailableForResourceType:(unint64_t)type outResource:(id *)resource;
- (BOOL)_isResourceType:(unint64_t)type inResources:(id)resources;
- (BOOL)_isValidUTI:(id)i forService:(id)service;
- (BOOL)_linkVideoFileFromSourcePath:(id)path toDestinationPath:(id)destinationPath;
- (BOOL)_location:(id)_location isEqualToLocationForUpdating:(id)updating;
- (BOOL)_migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat;
- (BOOL)_migrateLegacySLMAdjustments;
- (BOOL)_setDefaultCinematicAdjustementsWithMainFileMetadata:(id)metadata;
- (BOOL)_setDefaultSlowMotionAdjustmentsWithMainFileMetadata:(id)metadata;
- (BOOL)_setHDRTypeFromMetadata:(id)metadata;
- (BOOL)_setupPlaceholderAdjustmentPropertiesFromSourceAsset:(id)asset bakeInAdjustmentsFromSourceAsset:(BOOL)sourceAsset library:(id)library;
- (BOOL)_shouldIngestComputeSyncFromCloudWithCloudVersion:(id)version cloudAdjustmentFingerprint:(id)fingerprint currentMajorVersion:(unint64_t)majorVersion;
- (BOOL)_shouldInstallComputeSyncResourceFromCloudWithCPLAssetChange:(id)change;
- (BOOL)_shouldSetupVideoComplementForAsyncEditWithBaseVersion:(int64_t)version;
- (BOOL)_tuAnalysisComplete;
- (BOOL)_updateAndStoreFinalPhotoResourceForResourceType:(unsigned int)type version:(unsigned int)version error:(id *)error;
- (BOOL)_updateAndStoreFinalVideoComplementResourceWithOutError:(id *)error;
- (BOOL)_updateKindSubtypeIfScreenshotWithCheckTask:(id)task;
- (BOOL)addSidecarFileAtIndex:(unint64_t)index sidecarURL:(id)l withFilename:(id)filename compressedSize:(id)size captureDate:(id)date modificationDate:(id)modificationDate uniformTypeIdentifier:(id)identifier imageOrientation:(unsigned int)self0 pathManager:(id)self1;
- (BOOL)anyInternalResourceIsLocal;
- (BOOL)applyComputeSyncPayloadWithComputeStateRecord:(id)record originatedFromPrefetch:(BOOL)prefetch error:(id *)error;
- (BOOL)attemptPromoteFromUnknownKindUsingCloudMaster;
- (BOOL)avalanchePickTypeIsVisible;
- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)d mainFileMetadata:(id)metadata videoURL:(id)l spatialOverCaptureURL:(id)rL videoDuration:(id *)duration stillDisplayTime:(id *)time options:(unint64_t)options;
- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)d mainFileMetadata:(id)metadata videoURL:(id)l videoDuration:(id *)duration stillDisplayTime:(id *)time options:(unint64_t)options;
- (BOOL)becomeSyndicationLivePhotoWithVideoComplementContentType:(id)type;
- (BOOL)calculateAllowedForAnalysis;
- (BOOL)canPerformEditOperation:(unint64_t)operation;
- (BOOL)canPlayPhotoIris;
- (BOOL)checkAllResourcesRequiredForCPLDisableWithReachableBlock:(id)block;
- (BOOL)cleanUpMetadataPath;
- (BOOL)cloudHasSameOwnerAsAsset:(id)asset;
- (BOOL)copyComputeSyncResourceFromCPLFilePath:(id)path error:(id *)error;
- (BOOL)couldBeStoredInDCIM;
- (BOOL)deleteContextualVideoThumbnailFilesWithError:(id *)error;
- (BOOL)eligibleForGuestAssetPromotion;
- (BOOL)faceDetectionComplete;
- (BOOL)fullAnalysisComplete;
- (BOOL)hasAdjustedCPLThumbResource;
- (BOOL)hasAdjustedVideoComplement;
- (BOOL)hasAllThumbs;
- (BOOL)hasJustBeenHidden;
- (BOOL)hasJustBeenShown;
- (BOOL)hasLargerThanThumbResourceLocal;
- (BOOL)hasLegacyRequiredResourcesLocallyAvailable;
- (BOOL)hasLibraryScope;
- (BOOL)hasMasterThumb;
- (BOOL)hasNonSlomoAdjustments;
- (BOOL)hasOriginalFile;
- (BOOL)hasScreenshotMetadata;
- (BOOL)hasUnrenderedAsyncAdjustments;
- (BOOL)hasVideoComponent;
- (BOOL)imageRequestHintsContainsResource:(id)resource;
- (BOOL)installComputeSyncResourceAfterAttachtoCPLWithError:(id *)error;
- (BOOL)installExistingAlchemistImageAtPath:(id)path error:(id *)error;
- (BOOL)installExistingAlchemistV2ResourceFileAtPath:(id)path recipeID:(unsigned int)d error:(id *)error;
- (BOOL)installExistingGenerativePlaygroundFaceResourcesFileAtPath:(id)path error:(id *)error;
- (BOOL)installExistingWallpaperComputeResourcesFileAtPath:(id)path error:(id *)error;
- (BOOL)installFinalImageAndRemoveDeferredFilesWithFinalImageURL:(id)l previewImage:(id)image thumbnailImage:(id)thumbnailImage outError:(id *)error;
- (BOOL)installFinalVideoComplementAndRemoveDeferredFilesWithOutError:(id *)error;
- (BOOL)installSparseFullStageComputeSyncResourceIfNeeded;
- (BOOL)isAvalanchePhoto;
- (BOOL)isAvalancheStackPhoto;
- (BOOL)isCPLSharingScopeAsset;
- (BOOL)isCameraConnectionKitAsset;
- (BOOL)isCloudPhotoLibraryAsset;
- (BOOL)isCloudSharedAsset;
- (BOOL)isColorAware;
- (BOOL)isDefaultAdjustedSlomo;
- (BOOL)isDeletableFromAssetsLibrary;
- (BOOL)isEditableFromAssetsLibrary;
- (BOOL)isEligibleForSearchIndexing;
- (BOOL)isFinderSyncedAsset;
- (BOOL)isHDVideo;
- (BOOL)isHEIF;
- (BOOL)isIncludedInCloudFeeds;
- (BOOL)isIncludedInMoments;
- (BOOL)isJPEG;
- (BOOL)isLocalVideoKeyFrameValid;
- (BOOL)isLocatedAtCoordinates:(CLLocationCoordinate2D)coordinates;
- (BOOL)isMogul;
- (BOOL)isOriginalRAW;
- (BOOL)isOriginalSRGB;
- (BOOL)isPanorama;
- (BOOL)isPhotoIris;
- (BOOL)isPhotoIrisPlaceholder;
- (BOOL)isPhotoStreamPhoto;
- (BOOL)isPlaceholderAsset;
- (BOOL)isPlayableVideo:(id *)video;
- (BOOL)isPrimaryImageFormat;
- (BOOL)isRAW;
- (BOOL)isRAWOnly;
- (BOOL)isRAWPlusJPEG;
- (BOOL)isRAWPlusJPEGWithRAWOnTop;
- (BOOL)isReadyForPurgeSyndicationResources;
- (BOOL)isReferencedAsset;
- (BOOL)isSavedPhotosAsset;
- (BOOL)isScreenRecording;
- (BOOL)isSemanticEnhanceProcessingCandidate;
- (BOOL)isStreamedVideo;
- (BOOL)isSuggestedForSharingByPhotos;
- (BOOL)isSyncableChange;
- (BOOL)isTimelapsePlaceholder;
- (BOOL)isValidForJournalPersistence;
- (BOOL)isValidTypeForPersistence;
- (BOOL)isVisibleForSocialGroupKeyAssetFetch;
- (BOOL)isWalrusEnabled;
- (BOOL)migrateLegacyVideoAdjustments;
- (BOOL)migrateLocationDataIfNeededAfterOTARestore:(BOOL)restore;
- (BOOL)placeholder_shouldAllowServerCopy;
- (BOOL)placeholder_shouldBakeInAdjustments;
- (BOOL)placeholder_shouldFlattenLivePhoto;
- (BOOL)promoteDeferredPreviewToFinalImageWithOutError:(id *)error;
- (BOOL)promoteFromUnknownKind;
- (BOOL)promoteProxyToFinalVideoComplementWithOutError:(id *)error;
- (BOOL)promoteSemanticEnhancePreviewToFinalImage:(id *)image;
- (BOOL)promoteToGuestAsset:(id *)asset;
- (BOOL)pruneLocalVideoKeyFrameImage;
- (BOOL)renderableAdjustmentDictionary:(id *)dictionary error:(id *)error;
- (BOOL)repairAssetScopeValidationErrors:(id)errors;
- (BOOL)requiresImageDeferredFinalization;
- (BOOL)requiresVideoComplementDeferredFinalization;
- (BOOL)resetGuestAssetPromotion:(id *)promotion;
- (BOOL)resetVideoKeyFrameTime;
- (BOOL)resetVideoKeyFrameTimeAndDeleteKeyFrameResource;
- (BOOL)resourceModelIndicatesDeepFusionNeeded;
- (BOOL)resourceModelIndicatesImageDeferredFinalizationNeeded;
- (BOOL)reverseLocationDataIsValid;
- (BOOL)rm_createNewResourcesIn:(id)in inManagedObjectContext:(id)context;
- (BOOL)savedAssetTypeIsSupportedForUpload;
- (BOOL)sceneAnalysisWasPerformedOnLatestAdjustment;
- (BOOL)setAttributesFromMainFileURL:(id)l mainFileMetadata:(id)metadata savedAssetType:(signed __int16)type bundleScope:(unsigned __int16)scope isPlaceholder:(BOOL)placeholder placeholderFileURL:(id)rL imageSource:(CGImageSource *)source imageData:(id *)self0;
- (BOOL)setCameraCaptureDeviceFromMetadata:(id)metadata;
- (BOOL)setCurrentAdjustmentAsOriginalAdjustment;
- (BOOL)setDefaultAdjustmentsIfNecessaryWithMainFileMetadata:(id)metadata;
- (BOOL)setFingerprintAndStableHashOnInternalResource:(id)resource recordClass:(Class)class resourceType:(unint64_t)type resourceFileURL:(id)l fingerprintScheme:(id)scheme error:(id *)error;
- (BOOL)setImageInfoFromImageMetadata:(id)metadata overwriteOriginalProperties:(BOOL)properties;
- (BOOL)setTimeExifTimestampStringFromMetadata:(id)metadata;
- (BOOL)setTrashedState:(signed __int16)state forResourceType:(unint64_t)type;
- (BOOL)setTrashedStateOnSpatialOverCaptureResources:(signed __int16)resources;
- (BOOL)setVideoInfoFromFileAtURL:(id)l mainFileMetadata:(id)metadata fullSizeRenderURL:(id)rL overwriteOriginalProperties:(BOOL)properties;
- (BOOL)setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:(id)asset placeholderAssetUUID:(id)d bundleScope:(unsigned __int16)scope share:(id)share importSessionID:(id)iD bakeInAdjustmentsFromSourceAsset:(BOOL)sourceAsset flattenLivePhoto:(BOOL)photo copyTitleDescriptionAndKeywords:(BOOL)self0 copyCameraProcessingAdjustmentResources:(BOOL)self1 library:(id)self2;
- (BOOL)shiftedLocationIsValid;
- (BOOL)shouldDownloadComputeSyncPayload;
- (BOOL)shouldIncludeInCPLCounts;
- (BOOL)shouldPurgeSyndicationResourcesWithChangedValues:(id)values;
- (BOOL)shouldPushComputeSync;
- (BOOL)shouldSimulateQuarantineOriginalImageResourceOnPush;
- (BOOL)shouldSyncToSPL;
- (BOOL)shouldUseNonAdjustedVideo;
- (BOOL)shouldUseUBFPathManager;
- (BOOL)supportsCloudUpload;
- (BOOL)syndicationOriginalResourcesAreLocal;
- (BOOL)transitionToDeferredProcessingNeededAdjustmentWithOriginalWidth:(unint64_t)width originalHeight:(unint64_t)height shouldSignalBackgroundProcessingNeeded:(BOOL)needed reason:(id)reason;
- (BOOL)unQuarantineIfPossible;
- (BOOL)updateAttributesFromMainFileURL:(id)l mainFileMetadata:(id)metadata fullSizeRenderURL:(id)rL error:(id *)error;
- (BOOL)updateDeferredAdjustmentWithFullSizeRenderImageURL:(id)l videoURL:(id)rL videoPosterURL:(id)uRL error:(id *)error;
- (BOOL)updateExtendedAttributesWithError:(id *)error;
- (BOOL)updateExtendedAttributesWithMetadata:(id)metadata error:(id *)error;
- (BOOL)updateKindSubtypeIfScreenshot;
- (BOOL)updateKindSubtypeIfScreenshotWithMetadata:(id)metadata;
- (BOOL)updatePlaybackVariationAndLoopingStyleFromAVAsset:(id)asset;
- (BOOL)updatePlaybackVariationAndLoopingStyleFromVariation:(unsigned __int16)variation;
- (BOOL)updatePlaybackVariationAndStyleFromOriginalMetadata:(id)metadata;
- (BOOL)userCloudSharedLiked;
- (BOOL)validateForInsert:(id *)insert;
- (BOOL)validateForUpdate:(id *)update;
- (BOOL)visibilityStateIsEqualToState:(signed __int16)state;
- (CGSize)_targetSizeForInputSize:(CGSize)size maxPixelSize:(unint64_t)pixelSize;
- (CGSize)imageSize;
- (CGSize)originalImageSize;
- (CGSize)spatialOverCaptureSize;
- (CGSize)unorientedSize;
- (CGSize)videoComplementSpatialOverCaptureSize;
- (CLLocation)location;
- (CLLocation)shiftedLocation;
- (CLLocationCoordinate2D)gpsCoordinate;
- (CLLocationCoordinate2D)pl_coordinate;
- (NSArray)allUniformTypeIdentifiers;
- (NSArray)sortedSidecarFiles;
- (NSData)embeddedThumbnailData;
- (NSData)faceRegions;
- (NSData)originalHash;
- (NSData)placeAnnotationData;
- (NSData)reverseLocationData;
- (NSDate)confirmedSpotlightSyncDate;
- (NSDate)dateForComparingAdjustmentVersions;
- (NSDate)localDateCreated;
- (NSDate)pl_date;
- (NSNumber)rawTimeZoneOffsetValue;
- (NSOrderedSet)orderedCloudComments;
- (NSOrderedSet)orderedLikeComments;
- (NSSet)allDetectedFaces;
- (NSSet)allFileURLs;
- (NSSet)filePathsWithoutThumbs;
- (NSSet)libraryScopeContributors;
- (NSString)accessibilityDescription;
- (NSString)cloudOwnerDisplayName;
- (NSString)cloudOwnerEmail;
- (NSString)cloudOwnerFirstName;
- (NSString)cloudOwnerFullName;
- (NSString)cloudOwnerLastName;
- (NSString)editorBundleID;
- (NSString)fileExtension;
- (NSString)importedByBundleIdentifier;
- (NSString)importedByDisplayName;
- (NSString)longDescription;
- (NSString)originalAssetsUUID;
- (NSString)originalFilename;
- (NSString)pathForAdjustmentDirectory;
- (NSString)pathForComputeDirectory;
- (NSString)pathForComputeSyncMediaAnalysisPayloadFile;
- (NSString)pathForComputeSyncWrapperFile;
- (NSString)pathForLargeDisplayableImageFile;
- (NSString)pathForLargeThumbnailFile;
- (NSString)pathForLegacySlalomRegionsArchive;
- (NSString)pathForMediumThumbnailFile;
- (NSString)pathForMetadataDirectory;
- (NSString)pathForOriginalFile;
- (NSString)pathForPrebakedLandscapeScrubberThumbnails;
- (NSString)pathForPrebakedPortraitScrubberThumbnails;
- (NSString)pathForTrimmedVideoFile;
- (NSString)pathForVideoFile;
- (NSString)pathForVideoPreviewFile;
- (NSString)pathForXMPFile;
- (NSString)publicGlobalUUID;
- (NSString)rawTimeZoneName;
- (NSString)syncedAdjustmentFingerprint;
- (NSString)textBadgeString;
- (NSString)title;
- (NSString)uuidDescription;
- (NSURL)assetURL;
- (NSURL)cachedNonPersistedVideoPlaybackURL;
- (NSURL)fileURLForLargeThumbnailFile;
- (NSURL)mainFileURL;
- (NSURL)persistedFileSystemAttributesFileURL;
- (PLCloudSharedAlbumProtocol)cloudShareAlbum;
- (PLManagedAsset)originalAsset;
- (PLManagedAssetID)assetID;
- (PLRevGeoLocationInfo)locationInfo;
- (PLRevGeoPlaceAnnotation)placeAnnotation;
- (PLShareParticipant)collectionShareContributor;
- (double)gpsHorizontalAccuracy;
- (double)pl_gpsHorizontalAccuracy;
- (id)_avAssetProxyForFullSize:(BOOL)size allowReadFromFile:(BOOL)file;
- (id)_availableCloudResourcesForPhotosRequireUnadjusted:(BOOL)unadjusted allowPenultimate:(BOOL)penultimate;
- (id)_calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources;
- (id)_cloudSharedPathWithExtension:(id)extension;
- (id)_compactDebugDescription;
- (id)_computeNewMasterIdentifierAndStableHash:(id *)hash fingerprintScheme:(void *)scheme forMasterFileURL:(void *)l error:;
- (id)_cplRelationsForAssetInLibrary:(id)library orderKeyManager:(id)manager;
- (id)_createCPLResourceFromResourcePath:(uint64_t)path withResourceType:(void *)type uniformTypeIdentifier:(void *)identifier scopedIdentifier:(void *)scopedIdentifier recordClass:(void *)class fingerprintScheme:;
- (id)_createJPEGResourcesFromFullSizePath:(id)path withScopedIdentifier:(id)identifier forMaster:(BOOL)master forResourceTypes:(id)types fingerprintScheme:(id)scheme;
- (id)_createVideoResourceFromVideoURL:(uint64_t)l withResourceType:(void *)type scopedIdentifier:(int)identifier applyVideoAdjustments:(int)adjustments forMaster:(int)master forPhotoIris:(void *)iris fingerprintScheme:;
- (id)_currentComputeStateVersion;
- (id)_effectiveMetadataForMainFileURL:(id)l mainFileMetadata:(id)metadata fullSizeRenderURL:(id)rL shouldCache:(BOOL)cache error:(id *)error;
- (id)_findMissingOriginalStableHashFromMaster:(id)master error:(id *)error;
- (id)_generateDeferredAdjustmentWithImageConversionClient:(id)client videoConversionClient:(id)conversionClient reason:(id)reason retryNumber:(unint64_t)number allowCancellationByService:(BOOL)service clientBundleID:(id)d completion:(id)completion;
- (id)_generatePosterFrameForVideoAtURL:(uint64_t)l withResourceType:(void *)type scopedIdentifier:(int)identifier forMaster:(void *)master fingerprintScheme:;
- (id)_generatePosterFrameResourcesFromVideoURL:(id)l withScopedIdentifier:(id)identifier forMaster:(BOOL)master fingerprintScheme:(id)scheme;
- (id)_generateVideoResourcesFromURL:(id)l withScopedIdentifier:(id)identifier forMaster:(BOOL)master;
- (id)_hdrTypeDescription;
- (id)_imagePropertiesFromMetadata:(id)metadata;
- (id)_installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:(BOOL)file error:(id *)error;
- (id)_kindDescription;
- (id)_mediaGroupUUIDForPersistence;
- (id)_metadataFromMediaProperties:(id)properties uniformTypeIdentifier:(id)identifier block:(id)block;
- (id)_originalResources;
- (id)_pathForSidecarResource:(id)resource;
- (id)_persistedResourceForResourceIdentity:(id)identity error:(id *)error;
- (id)_rm_localResourceURLForResource:(id)resource;
- (id)_savedAssetTypeDescription;
- (id)_sizeOfVideoPreviewForAVAsset:(id)asset;
- (id)_sourceURLForAsyncEditWithBaseVersion:(int64_t)version;
- (id)activityViewController:(id)controller itemForActivityType:(id)type;
- (id)addLegacyFaceWithRelativeRect:(CGRect)rect identifier:(signed __int16)identifier albumUUID:(id)d;
- (id)addedDateData;
- (id)adjustedFileURLs;
- (id)adjustedPathForCPLResourceType:(unint64_t)type;
- (id)adjustmentDataResource;
- (id)allAssetCPLResources;
- (id)allCPLResourcesForPruning;
- (id)allFileBackedResources;
- (id)allFileExtensions;
- (id)allMasterCPLResources;
- (id)allRequiredResourcesForCPLDisable;
- (id)analysisStateForWorkerType:(signed __int16)type;
- (id)assetComparisonSortDescriptors;
- (id)assetResourceForCPLType:(unint64_t)type;
- (id)assetURLForSidecarFile:(id)file;
- (id)assetURLWithExtension:(id)extension;
- (id)avalanchePickDescription;
- (id)bestAvailableAdjustedResource;
- (id)cameraMake;
- (id)cameraModel;
- (id)cloudSharedAssetPathForPlaceholderKind:(signed __int16)kind;
- (id)contextualVideoThumbnailURLs;
- (id)cplAssetChangeWithMasterScopedIdentifier:(id)identifier withChangeType:(unint64_t)type shouldGenerateDerivatives:(BOOL)derivatives orderKeyManager:(id)manager computeSyncUploadEnabled:(BOOL)enabled inLibrary:(id)library;
- (id)cplFullRecord;
- (id)cplMasterChangeInLibrary:(id)library shouldGenerateDerivatives:(BOOL)derivatives;
- (id)createResourcesForAssetInPhotoLibrary:(id)library shouldGenerateDerivatives:(BOOL)derivatives;
- (id)createResourcesForMaster:(id)master shouldGenerateDerivatives:(BOOL)derivatives inPhotoLibrary:(id)library;
- (id)dateCreatedData;
- (id)decodedFaceRegions;
- (id)descriptionForAnalysisStates;
- (id)descriptionForModernResources;
- (id)descriptionForNonCloudResources;
- (id)descriptionForResources;
- (id)descriptionForSceneAnalysis;
- (id)descriptionForSidecarFiles;
- (id)documentObservation;
- (id)duplicateAlbum;
- (id)duplicateSortPropertyNames;
- (id)duplicateSortPropertyNamesSkip;
- (id)edgesIn;
- (id)edgesOut;
- (id)evaluateWhiteBalanceValueWithOriginalExifProperties:(id)properties;
- (id)existingCloudMasterNeedsRepush:(BOOL *)repush;
- (id)extendedAttributesCreateIfNeeded:(BOOL)needed;
- (id)faceDescription;
- (id)fetchOrCreateResourceWithIdentity:(id)identity;
- (id)fetchResourceWithIdentity:(id)identity error:(id *)error;
- (id)fetchResourcesForAssetVersions:(id)versions allowDerivatives:(BOOL)derivatives additionalPredicate:(id)predicate relationshipKeyPathsForPrefetching:(id)prefetching error:(id *)error;
- (id)fetchSourceAssetForDuplicationIfExists;
- (id)fileTypeForFullsizeRenderImage;
- (id)fileURLForAdjustedLargeThumbnailFile;
- (id)fileURLForAdjustedMediumThumbnailFile;
- (id)fileURLForAsyncAdjustedRenderPreviewImage;
- (id)fileURLForCurrentDeferredProcessingPreviewFile;
- (id)fileURLForDeferredVideoComplement;
- (id)fileURLForFullsizeRenderImage;
- (id)fileURLForFullsizeRenderVideo;
- (id)fileURLForHypotheticalSidecarFileWithFilename:(id)filename;
- (id)fileURLForMediumThumbnailFile;
- (id)fileURLForMetadataWithExtension:(id)extension;
- (id)fileURLForNonAdjustedLargeThumbnailFile;
- (id)fileURLForNonAdjustedMediumThumbnailFile;
- (id)fileURLForOriginalVideoComplement;
- (id)filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources:(id)resources;
- (id)fingerprintContext;
- (id)fingerprintScheme;
- (id)firstPersistedResourceMatching:(id)matching;
- (id)formattedCameraModel;
- (id)fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:(id)l;
- (id)generatePortraitAdjustment:(id *)adjustment;
- (id)imageDataForThumbGenerationAndIfNeededRAWUTI:(id *)i isPreviewSource:(BOOL *)source;
- (id)imageMediaMetadataForURL:(id)l;
- (id)imageProperties;
- (id)imageWithFormat:(unsigned __int16)format;
- (id)largestAvailableDataRepresentationAndType:(id *)type;
- (id)lastUploadAttemptDate;
- (id)legacyFaceWithIdentifier:(signed __int16)identifier;
- (id)lensModel;
- (id)libraryID;
- (id)localDateAndCreateIfNeededWithLocalDateCreator:(id)creator;
- (id)localResourcePathForMasterResource:(id)resource;
- (id)localResourcePathForMasterResourceWithCPLType:(unint64_t)type andUTI:(id)i;
- (id)localVideoKeyFrameResource;
- (id)loggingDescription;
- (id)managedAssetForPhotoLibrary:(id)library;
- (id)masterIdentifierCacheIfNecessaryAndOriginalStableHash:(id *)hash error:(id *)error;
- (id)masterResourceForCPLType:(unint64_t)type;
- (id)masterThumbnailFileURLIfLocal;
- (id)masterThumbnailResource;
- (id)mediaAnalysisAttributesInsertingIfNecessary;
- (id)mediaMetadataForResourceVersion:(unsigned int)version mediaMetadataType:(id *)type;
- (id)mediaMetadataVirtualResources;
- (id)metadataFromMediaPropertiesOrOriginalResource;
- (id)nonAdjustedPathForCPLResourceType:(unint64_t)type;
- (id)nonDynamicOriginalUTI;
- (id)nonPersistedResourcesWithOptions:(unsigned __int16)options;
- (id)originalStableHashCacheIfNecessaryAndAdjustedStableHash:(id *)hash fullsizeRenderImageIfNecessary:(BOOL)necessary enableSaveIfNecessary:(BOOL)ifNecessary error:(id *)error;
- (id)originalUniformTypeIdentifier;
- (id)originalVideoComplementUniformTypeIdentifier;
- (id)pasteBoardRepresentation;
- (id)pathForAdjustedLargeSizeImageFile;
- (id)pathForAdjustedLargeThumbnailFile;
- (id)pathForAdjustedLargeVideoFile;
- (id)pathForAdjustedMediaMetadataFile;
- (id)pathForAdjustedMediumHDRVideoFile;
- (id)pathForAdjustedMediumThumbnailFile;
- (id)pathForAdjustedMediumVideoFile;
- (id)pathForAdjustedSmallVideoFile;
- (id)pathForAdjustmentDataFile;
- (id)pathForAdjustmentFile;
- (id)pathForAdjustmentSecondaryDataFile;
- (id)pathForAlchemistImage;
- (id)pathForAlchemistV2ResourceFileWithRecipeID:(unsigned int)d;
- (id)pathForAsyncAdjustedRenderPreviewImageFile;
- (id)pathForBestAvailableFullsizeRenderImageFileOutIsSubstandard:(BOOL *)substandard;
- (id)pathForCPLResourceType:(unint64_t)type adjusted:(BOOL)adjusted;
- (id)pathForCameraMetadataDiagnosticFile;
- (id)pathForCameraMetadataFile;
- (id)pathForCameraSpatialOverCaptureMetadataDiagnosticFile;
- (id)pathForDeferredProcessingPreviewFile;
- (id)pathForDeferredVideoComplementFile;
- (id)pathForDiagnosticFile;
- (id)pathForFullsizeImageFile;
- (id)pathForFullsizeRenderImageFile;
- (id)pathForFullsizeRenderImageFileWithUTI:(id)i;
- (id)pathForFullsizeRenderVideoFile;
- (id)pathForGenerativePlaygroundFaceResourcesFile;
- (id)pathForLargeSizeImageFile;
- (id)pathForLocalVideoKeyFrame;
- (id)pathForMediaMetadataFile;
- (id)pathForMediumVideoFile;
- (id)pathForMetadataWithExtension:(id)extension;
- (id)pathForMutationsDirectory;
- (id)pathForNonAdjustedFullsizeImageFile;
- (id)pathForNonAdjustedLargeSizeImageFile;
- (id)pathForNonAdjustedLargeThumbnailFile;
- (id)pathForNonAdjustedLargeVideoFile;
- (id)pathForNonAdjustedMediumHDRVideoFile;
- (id)pathForNonAdjustedMediumThumbnailFile;
- (id)pathForNonAdjustedMediumVideoFile;
- (id)pathForNonAdjustedSmallVideoFile;
- (id)pathForOriginalAdjustmentFile;
- (id)pathForOriginalVideoComplementDiagnosticFile;
- (id)pathForPenultimateFullsizeRenderImageFile;
- (id)pathForPenultimateFullsizeRenderImageFileWithUTI:(id)i;
- (id)pathForPenultimateFullsizeRenderVideoFile;
- (id)pathForReframeDiagnosticDirectory;
- (id)pathForReframeDiagnosticFile;
- (id)pathForSpatialOverCaptureContentFile;
- (id)pathForSpatialOverCaptureDiagnosticFile;
- (id)pathForSubstandardFullsizeRenderImageFile;
- (id)pathForTransientVideoPosterFramePreview;
- (id)pathForVideoComplementFile;
- (id)pathForVideoComplementSpatialOverCaptureContentFile;
- (id)pathForVideoMetadataFile;
- (id)pathForWallpaperComputeResourcesFile;
- (id)pathToOriginalVideoFile;
- (id)payloadForChangedKeys:(id)keys;
- (id)payloadID;
- (id)payloadIDForTombstone:(id)tombstone;
- (id)penultimateImageResource;
- (id)persistedResourcesMatching:(id)matching;
- (id)persistedResourcesWithRecipeID:(unsigned int)d andVersion:(unsigned int)version;
- (id)photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:(id)identifier;
- (id)photoIrisSidecarIgnoringSubtype:(BOOL)subtype;
- (id)readonlyFileURLForContextualVideoThumbnailIdentifier:(id)identifier;
- (id)resourceForCPLType:(unint64_t)type version:(unsigned int)version;
- (id)resourcesSortedByQualityWithOptions:(unsigned __int16)options;
- (id)resourcesWithVersion:(unsigned int)version;
- (id)reverseGeoDescription;
- (id)rm_applyResourcesFromAssetChange:(id)change inLibrary:(id)library;
- (id)rm_cplExpungeableMasterResourceStates;
- (id)rm_cplMasterResourceForResourceType:(unint64_t)type;
- (id)rm_cplMasterResourcesFromCloudMaster:(id)master addOriginalResourceMode:(BOOL)mode;
- (id)rm_cplResourceForResourceType:(unint64_t)type;
- (id)scopeIdentifier;
- (id)scopedIdentifier;
- (id)shareRelationship;
- (id)shortenedFilePath;
- (id)sidecarFileMatchingContentType:(id)type requireExactMatch:(BOOL)match requireSort:(BOOL)sort;
- (id)sidecarWithResourceObjectID:(id)d;
- (id)sidecars;
- (id)sortPlaceholderCloudResourcesByOrderOfCloudReReference:(id)reference;
- (id)storedResourceForCPLResource:(id)resource asset:(id)asset adjusted:(BOOL)adjusted;
- (id)storedResourceForExternalResource:(id)resource asset:(id)asset;
- (id)syncDescription;
- (id)syndicationDescription;
- (id)syndicationFileIdentifierForResourceType:(unsigned int)type version:(unsigned int)version recipeID:(unsigned int)d utiString:(id)string;
- (id)syndicationOriginalResource;
- (id)syndicationResourceURLForResourceType:(unsigned int)type version:(unsigned int)version recipeID:(unsigned int)d utiString:(id)string error:(id *)error;
- (id)syndicationResourcesDescription;
- (id)thumbnailIdentifier;
- (id)unadjustedDerivativeImageURLs;
- (id)urlForSideCarImageFile;
- (id)userAddCloudSharedCommentWithText:(id)text;
- (id)validateForAssetID:(id)d resourceIdentity:(id)identity;
- (id)videoComplementData;
- (id)virtualResourcesThatReplaceMissingPersistedResources:(id)resources;
- (id)writableFileURLForContextualVideoThumbnailIdentifier:(id)identifier;
- (int)cloudCommentsStatusForOwnedAsset:(BOOL)asset;
- (int)embeddedThumbnailLength;
- (int)embeddedThumbnailOffset;
- (int)inferredTimeZoneOffset;
- (int)locationHash;
- (int64_t)_prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:(int64_t)version penultimateRenderedJPEGData:(id)data penultimateRenderedVideoContentURL:(id)l penultimateRenderedVideoComplementContentURL:(id)rL fileIngestionType:(int64_t)type;
- (int64_t)cameraProcessingAdjustmentTrashedState;
- (int64_t)compareToAsset:(id)asset;
- (int64_t)height;
- (int64_t)originalHeight;
- (int64_t)originalImageOrientation;
- (int64_t)originalWidth;
- (int64_t)width;
- (signed)embeddedThumbnailHeight;
- (signed)embeddedThumbnailWidth;
- (signed)importedBy;
- (signed)originalOrientation;
- (signed)uploadAttempts;
- (uint64_t)_canComputeMasterIdentifierOrStableHashWithError:(uint64_t)result;
- (unint64_t)_countForCommentRelationshipNamed:(id)named inverseRelationshipName:(id)name;
- (unint64_t)bestResourceTypeForAdjustedStableHash;
- (unint64_t)cplAssetSubtypeFromPLAssetSubtype:(signed __int16)subtype;
- (unint64_t)deferredProcessingHash;
- (unint64_t)effectiveThumbnailIndex;
- (unint64_t)masterResourceTypeForAdjustedAssetResourceType:(unint64_t)type flattenLivePhoto:(BOOL)photo;
- (unint64_t)originalFilesize;
- (unint64_t)originalResourceChoice;
- (unint64_t)ptpCloudMasterOriginalFileSize;
- (unint64_t)syndicationProcessingVersion;
- (unsigned)_calculateRenderTypeAdditionalFlagCheckAndUpdateIfNeededUnmanagedAdjustment:(id)adjustment options:(id)options hasAdjustments:(BOOL)adjustments;
- (unsigned)_playbackVariationWithAdjustmentRenderTypes:(unsigned int)types;
- (unsigned)expectedDeferredProcessingNeededOnAssetCreation;
- (unsigned)fullSizeRenderResourceRecipeID;
- (unsigned)playbackVariationFromAVAsset:(id)asset isLivePhotoVideoComplement:(BOOL)complement;
- (unsigned)shareState;
- (unsigned)syndicationHistory;
- (unsigned)syndicationProcessingValue;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types forSpatialTypeOfAVAsset:(id)asset;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types withDepthType:(signed __int16)type;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types withMetadata:(id)metadata;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types withPlaybackVariation:(unsigned __int16)variation;
- (void)_applyPropertiesChangeToCPLAssetChange:(id)change withMasterScopedIdentifier:(id)identifier computeSyncUploadEnabled:(BOOL)enabled inLibrary:(id)library;
- (void)_applyPropertiesFromCloudMaster:(id)master;
- (void)_applyResourceChangeToCPLAsset:(id)asset forChangeType:(unint64_t)type shouldGenerateDerivatives:(BOOL)derivatives inLibrary:(id)library;
- (void)_applySharingChangeToCPLAssetChange:(id)change inLibrary:(id)library;
- (void)_asyncGenerateRenderImageFileWithSize:(CGSize)size formatIdentifier:(id)identifier formatVersion:(id)version adjustmentDataBlob:(id)blob originalImageFilePath:(id)path originalImageEXIFOrientation:(int64_t)orientation renderedImageFilePath:(id)filePath completionHandler:(id)self0;
- (void)_cleanupPenultimateResources;
- (void)_clearAcceptableCropRect;
- (void)_clearOverallAestheticScore;
- (void)_clearPreferredCropRect;
- (void)_clearStickerConfidenceAttributes;
- (void)_coordinatesFromDoubles:(double)doubles faceMaxX:(double)x faceMinY:(double)y faceMaxY:(double)maxY minX:(double *)minX maxX:(double *)maxX minY:(double *)minY maxY:(double *)self0;
- (void)_dateCreatedDidChange:(id)change;
- (void)_debugPrintAdjustmentState;
- (void)_deleteComputedAttributes;
- (void)_deleteDeferredIntermediatesForDeferredPhotoIdentifier:(id)identifier withFinalizer:(id)finalizer;
- (void)_duplicateProcessingChanges:(id)changes;
- (void)_fixDistantPastContentCreationDateWithItem:(id)item;
- (void)_getLargestAvailableDataRepresentation:(id *)representation type:(id *)type;
- (void)_handleHighlightRelationshipChangeForKey:(id)key forAssetCountKey:(id)countKey newValue:(id)value;
- (void)_loadReverseGeoIfNeeded;
- (void)_populateSyndicationAssetWithAssetType:(signed __int16)type subtype:(signed __int16)subtype contentType:(id)contentType videoComplementContentType:(id)complementContentType originalFilename:(id)filename;
- (void)_preserveRelationshipsOfDeletedGuestAsset:(id)asset;
- (void)_processRenderTypeUpdateForCameraAutoWithUnmanagedAdjustment:(id)adjustment options:(id)options hasAdjustments:(BOOL)adjustments updateRenderFlagsResult:(BOOL)result;
- (void)_processRenderTypeUpdateForGenerativeEditsWithUnmanagedAdjustment:(id)adjustment fullSizeRenderURL:(id)l hasAdjustments:(BOOL)adjustments;
- (void)_processRenderTypeUpdateForSleetCastWithUnmanagedAdjustment:(id)adjustment fullSizeRenderURL:(id)l settingPayload:(id)payload hasAdjustments:(BOOL)adjustments;
- (void)_recordAssetPersonEdgeAndSocialGroupContainmentUpdateIfNeededWithChangedValues:(id)values inContext:(id)context;
- (void)_reloadWidgetTimelineIfNeeded;
- (void)_removeAdjustmentDataResources;
- (void)_removeComputeResourcesOnEdit;
- (void)_removeKeyAssetFromSuggestions:(id)suggestions;
- (void)_resetAllMediaProcessingVersionsIncludingVideo:(BOOL)video;
- (void)_resetMediaAnalysisStateOnEditIncludingVideo:(BOOL)video;
- (void)_rm_insertResource:(id)resource forOtherDuplicatedAssetInMaster:(id)master inPhotoLibrary:(id)library;
- (void)_setAllowedForAnalysisDependentValue:(id)value forKey:(id)key;
- (void)_setBurstUuidFromMetadata:(id)metadata;
- (void)_setColorSpaceNameFromMetadata:(id)metadata;
- (void)_setHDRGainFromMetadata:(id)metadata;
- (void)_setOriginalSizeAndOrientationFromMetadata:(id)metadata;
- (void)_setPhotoIrisPropertiesFromMetadata:(id)metadata;
- (void)_setSOCGroupIdentifierFromMetadata:(id)metadata;
- (void)_setSavedAssetTypeFromMetadata:(id)metadata;
- (void)_setSizeAndOrientationFromMetadata:(id)metadata;
- (void)_setSyndicationStateFromContentsOfSearchableItem:(id)item;
- (void)_setVideoComplementData:(id)data;
- (void)_setupMediaConversionSourceURLCollection:(id)collection destinationURLCollection:(id)lCollection baseVersion:(int64_t)version;
- (void)_updateAdjustmentFromAssetAdjustment:(id)adjustment unmanagedAdjustment:(id)unmanagedAdjustment fullSizeRenderURL:(id)l options:(id)options;
- (void)_updateAlbumAssociationIfNeeded;
- (void)_updateAlbumAssociationIfNeededWithChangedValues:(id)values;
- (void)_updateAssetSubtypeForCPLAssetChange:(id)change;
- (void)_updateAssetSubtypeFromCPLAssetSubtype:(unint64_t)subtype;
- (void)_updateAvalanchePropertiesFromAssetChange:(id)change;
- (void)_updateBurstFlagsForCPLAssetChange:(id)change photoLibrary:(id)library;
- (void)_updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:(id)date;
- (void)_updateCoreDateExtendedAttributes:(id)attributes fromMetadata:(id)metadata;
- (void)_updateCoreExtendedAttributes:(id)attributes fromMetadata:(id)metadata;
- (void)_updateDerivativesAndThumbnails:(BOOL)thumbnails withPreviewImage:(id)image thumbnailImage:(id)thumbnailImage metadata:(id)metadata didRevertToOriginal:(BOOL)original updateInternalResources:(BOOL)resources isSubstandardRender:(BOOL)render isDeferred:(BOOL)self0;
- (void)_updateDestinationAssetCopyStateOnCMMAsset;
- (void)_updateIMCoreSyndicationForIdentifier:(id)identifier hide:(BOOL)hide;
- (void)_updateModificationDateForSyndication;
- (void)_updateOriginalResourceChoice;
- (void)_updatePackedBadgeAttributesIfNeeded:(int)needed;
- (void)_updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:(id)asset;
- (void)_updateSyndicationState:(unsigned __int16)state enabled:(BOOL)enabled logPrefix:(id)prefix;
- (void)_updateViewPresentationForCPLAssetChange:(id)change;
- (void)_updateViewPresentationFromCPLAssetViewPresentation:(signed __int16)presentation;
- (void)_writeOutAdjustmentsToFile:(id)file;
- (void)addComment:(id)comment;
- (void)applyComputeSyncPropertiesFromAssetChange:(id)change inLibrary:(id)library didInstallComputeSyncResource:(BOOL *)resource computeSyncDownloadEnabled:(BOOL)enabled;
- (void)applyFacesFromAssetChange:(id)change inSyncContext:(id)context;
- (void)applyPropertiesFromAssetChange:(id)change inLibrary:(id)library;
- (void)applySharingPropertiesFromAssetChange:(id)change inLibrary:(id)library;
- (void)applyTrashedState:(signed __int16)state withTrashedReason:(unsigned __int16)reason expungeReasonFromClient:(id)client;
- (void)awakeFromFetch;
- (void)awakeFromInsert;
- (void)copyAuxiliaryImagesFromImageSource:(CGImageSource *)source toDestination:(CGImageDestination *)destination fromImageAtIndex:(unint64_t)index imageProperties:(id)properties applyingOrientation:(signed __int16)orientation scalingToLongSideLength:(int64_t)length;
- (void)createMasterIfNecessaryInLibrary:(id)library;
- (void)dealloc;
- (void)delete;
- (void)deleteAdjustedResources;
- (void)deleteComment:(id)comment;
- (void)deleteComputeSyncResourceIfExists;
- (void)deleteFromDatabaseOnly;
- (void)deleteFromDatabaseOnlyWithReason:(id)reason;
- (void)deleteResourceForSidecarRepresentation:(id)representation;
- (void)deleteResourcesWithRecipeID:(unsigned int)d andVersion:(unsigned int)version;
- (void)deleteWithReason:(id)reason;
- (void)didSave;
- (void)didTurnIntoFault;
- (void)ensurePlaybackStyleConsistencyWithKindSubtype:(id)subtype;
- (void)expungeTrashedSpatialOverCaptureResources;
- (void)fixupMemoriesWithMissingKeyAsset;
- (void)fixupPlaceholderAssetWithSavedAssetType:(signed __int16)type;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data forceSRGBConversion:(BOOL)conversion;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data forceSRGBConversion:(BOOL)conversion reduceProcessingForIngest:(BOOL)ingest;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data metadata:(id)metadata forceSRGBConversion:(BOOL)conversion forFinalCameraImage:(BOOL)cameraImage saveCameraPreviewWellImage:(BOOL)self0 reduceProcessingForIngest:(BOOL)self1;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data metadata:(id)metadata forceSRGBConversion:(BOOL)conversion saveCameraPreviewWellImage:(BOOL)wellImage;
- (void)generateLargeThumbnailFileIfNecessary;
- (void)generateThumbnailsWithImageSource:(CGImageSource *)source imageData:(id)data metadata:(id)metadata allowMediumPreview:(BOOL)preview forceSRGBConversion:(BOOL)conversion forFinalCameraImage:(BOOL)image outSmallThumbnailData:(id *)thumbnailData isPreviewSource:(BOOL)self0;
- (void)getFileURL:(id *)l originalFilename:(id *)filename uti:(id *)uti fileSize:(unint64_t *)size forSidecarMatchingUTI:(id)i requireExactMatch:(BOOL)match;
- (void)incrementUploadAttempts;
- (void)insertTableThumbImageRequestHints;
- (void)invalidateThumbnailIfNeededAfterMasterResourceChangeInLibrary:(id)library;
- (void)makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:(int64_t)urgency completion:(id)completion;
- (void)markAsUnavailableCloudResourceOfType:(unint64_t)type;
- (void)persistMetadataToFileURL:(id)l;
- (void)persistMetadataToFilesystem;
- (void)postProcessResourceDependentPropertyChangesFromAssetChange:(id)change inLibrary:(id)library;
- (void)prepareForDeletion;
- (void)purgeSyndicationResourcesOriginalsOnly:(BOOL)only;
- (void)recalculateImageRequestHints;
- (void)recalculateImageRequestHintsForResource:(id)resource afterLocalAvailabilityChangeFrom:(signed __int16)from previousDataStoreKey:(id)key;
- (void)recalculateIsDetectedScreenshot;
- (void)recalculateIsRecentlySaved;
- (void)recalculateRAWBadgeAttribute;
- (void)reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker;
- (void)reevaluateCameraProcessingAdjustmentState;
- (void)registerForChanges;
- (void)rejectSyndicatedAsset;
- (void)removeAllStillFrameSceneClassifications;
- (void)removeAllTemporalSceneClassifications;
- (void)removeAssetFromRelatedSuggestionsAndFixupSuggestions;
- (void)removeAssetFromUserAlbumSuggestionIfNeededWithChangedValues:(id)values;
- (void)removeComputeResourceWithRecipeID:(unsigned int)d atPath:(id)path;
- (void)removeFromDuplicateAlbum;
- (void)removeLibraryScopeAndContributors;
- (void)removeLocalFileForResource:(id)resource allowDCIMPath:(BOOL)path;
- (void)removeSceneClassificationsOfType:(int64_t)type;
- (void)removeSidecar:(id)sidecar;
- (void)removeTemporalSceneClassificationsOfType:(int64_t)type;
- (void)reportSharedAssetIncrementalChange:(id)change;
- (void)requestDeletionOfDeferredPhotoProcessingIntermediates;
- (void)resetKeyFaceOnVideoKeyFrameChange;
- (void)restoreSyndicatedAsset;
- (void)revalidateFaceAreaPoints;
- (void)revertToOriginal;
- (void)rm_createAssetResourcesForCPLResources:(id)resources inLibrary:(id)library;
- (void)rm_createMasterResourcesForCPLResources:(id)resources master:(id)master inLibrary:(id)library;
- (void)rm_createMasterResourcesIn:(id)in inManagedObjectContext:(id)context;
- (void)setAccessibilityDescription:(id)description;
- (void)setAdjustments:(id)adjustments options:(id)options;
- (void)setAssetAdjustmentsStateFromAdjustmentRenderType:(unsigned int)type;
- (void)setAvalanchePickType:(int)type;
- (void)setCameraProcessingAdjustmentStateFromAdjustmentRenderTypes:(unsigned int)types;
- (void)setCollectionShare:(id)share withContributor:(id)contributor;
- (void)setCollectionShareContributor:(id)contributor;
- (void)setCollectionShareWithCurrentUserAsContributor:(id)contributor;
- (void)setConfirmedSpotlightSyncDate:(id)date;
- (void)setConversationAlbumWithConversationID:(id)d;
- (void)setCurrentSleetCastFromMetadata:(id)metadata;
- (void)setDateCreated:(id)created;
- (void)setDepthTypeFromAdjustmentRenderTypes:(unsigned int)types;
- (void)setDepthTypeFromMetadata:(id)metadata;
- (void)setDestinationAssetCopyStateOnSourceAsset:(signed __int16)asset;
- (void)setDetectedScreenshotBadgeAttribute:(BOOL)attribute;
- (void)setEditableDepthBadgeAttribute:(unsigned __int8)attribute;
- (void)setEditableDepthBadgeAttributeFromMetadata:(id)metadata;
- (void)setEditorBundleID:(id)d;
- (void)setEffectiveThumbnailIndex:(unint64_t)index;
- (void)setEmbeddedThumbnailHeight:(signed __int16)height;
- (void)setEmbeddedThumbnailLength:(int)length;
- (void)setEmbeddedThumbnailOffset:(int)offset;
- (void)setEmbeddedThumbnailWidth:(signed __int16)width;
- (void)setFaceRegions:(id)regions;
- (void)setFaceRegionsFromCGImageProperties:(id)properties;
- (void)setFaceRegionsFromImageMetadata:(CGImageMetadata *)metadata;
- (void)setHeight:(int64_t)height;
- (void)setHidden:(BOOL)hidden;
- (void)setImageInfoFromOriginalImageMetadata:(id)metadata;
- (void)setImageSize:(CGSize)size;
- (void)setImportSessionAlbumWithImportSessionID:(id)d;
- (void)setImportedBy:(signed __int16)by;
- (void)setImportedByBundleIdentifier:(id)identifier;
- (void)setImportedByDisplayName:(id)name;
- (void)setIsSmartStyleableWithMetadata:(id)metadata;
- (void)setKeywordBadgeAttribute:(unsigned __int8)attribute;
- (void)setKeywordsFromImageProperties:(id)properties;
- (void)setLastUploadAttemptDate:(id)date;
- (void)setLibraryScope:(id)scope;
- (void)setLibraryScope:(id)scope withContributors:(id)contributors;
- (void)setLibraryScopeContributors:(id)contributors;
- (void)setLibraryScopeWithCurrentUserAsContributor:(id)contributor;
- (void)setLocation:(id)location;
- (void)setLocationFromPersistedAttributes:(id)attributes;
- (void)setLocationHash:(int)hash;
- (void)setLongDescription:(id)description;
- (void)setMetadataFromCustomRenderedValue:(int64_t)value;
- (void)setMoment:(id)moment;
- (void)setOriginalAsset:(id)asset;
- (void)setOriginalAssetsUUID:(id)d;
- (void)setOriginalFilename:(id)filename;
- (void)setOriginalFilesize:(unint64_t)filesize;
- (void)setOriginalHash:(id)hash;
- (void)setOriginalHeight:(int64_t)height;
- (void)setOriginalOrientation:(signed __int16)orientation;
- (void)setOriginalResourceChoice:(unint64_t)choice;
- (void)setOriginalSizeAndOrientationFromImageProperties:(id)properties;
- (void)setOriginalWidth:(int64_t)width;
- (void)setPhotoIrisStillDisplayTime:(id *)time;
- (void)setPhotoIrisVideoDuration:(id *)duration;
- (void)setPlaceAnnotationData:(id)data;
- (void)setPlaybackControlBadgeAttribute:(unsigned __int8)attribute;
- (void)setPlaybackControlBadgeAttributeFromMetadata:(id)metadata;
- (void)setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:(unsigned __int16)variation;
- (void)setPlaybackVariationAndLoopingStyleFromAdjustmentRenderTypes:(unsigned int)types;
- (void)setProResBadgeAttribute:(unsigned __int8)attribute;
- (void)setPublicGlobalUUID:(id)d;
- (void)setRAWBadgeAttribute:(unsigned __int8)attribute;
- (void)setReverseLocationData:(id)data;
- (void)setReverseLocationDataIsValid:(BOOL)valid;
- (void)setSavedAssetType:(signed __int16)type;
- (void)setSensitivityAnalysisState:(unsigned __int8)state;
- (void)setShiftedLocation:(id)location;
- (void)setShiftedLocationIsValid:(BOOL)valid;
- (void)setSizeAndOrientationFromImageProperties:(id)properties;
- (void)setSpatialAudioControlBadgeAttribute:(unsigned __int8)attribute;
- (void)setSpatialAudioControlBadgeAttributeFromMetadata:(id)metadata;
- (void)setSpatialTypeFromMetadata:(id)metadata;
- (void)setSyndicationAttributesFromMainFileURL:(id)l metadata:(id)metadata;
- (void)setSyndicationFilenameAndDirectoryWithOriginalFilename:(id)filename;
- (void)setSyndicationLivePhotoAttributesFromMainFileURL:(id)l mainFileMetadata:(id)metadata videoComplementFileURL:(id)rL videoComplementMetadata:(id)complementMetadata;
- (void)setThumbnailDataFromImageProperties:(id)properties;
- (void)setTitle:(id)title;
- (void)setTrashedState:(signed __int16)state;
- (void)setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:(id)identifier originalFilename:(id)filename;
- (void)setUniformTypeIdentifierFromOriginalFile;
- (void)setUniformTypeIdentifierFromPathExtension:(id)extension;
- (void)setUploadAttempts:(signed __int16)attempts;
- (void)setUserCloudSharedLiked:(BOOL)liked;
- (void)setUuid:(id)uuid;
- (void)setVideoInfoOnMasterFromAVAsset:(id)asset;
- (void)setVideoKeyFrameTime:(id *)time;
- (void)setWasGuestAsset:(BOOL)asset;
- (void)setWidth:(int64_t)width;
- (void)setupPropertiesOnExistingMaster:(id)master;
- (void)setupPropertiesOnNewCloudMaster:(id)master withPlaceholderSourceAsset:(id)asset uniformTypeIdentifier:(id)identifier;
- (void)simulateQuarantineOriginalImageResourceOnPush:(id)push;
- (void)synchronizeWithPersistedFileSystemAttributes;
- (void)synchronouslyFetchAdjustmentBlobWithCompletionHandler:(id)handler;
- (void)synchronouslyFetchAdjustmentDataWithCompletionHandler:(id)handler;
- (void)synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:(id)path withCompletionHandler:(id)handler;
- (void)syndicatedAssetDidSaveToUserLibrary;
- (void)unregisterForChanges;
- (void)unsaveSyndicatedAsset;
- (void)updateAdjustmentFileWithAdjustmentRenderTypes:(unsigned int)types;
- (void)updateAssetAdjustmentsStateIfNeededFromAdjustmentFile;
- (void)updateAssetKindAndPlaybackStyleIfNeededWithKind:(signed __int16)kind;
- (void)updateAssetKindFromUniformTypeIdentifier;
- (void)updateAssetPropertiesFromAdjustmentFile;
- (void)updateAudioExtendedAttributesFromMetadata:(id)metadata;
- (void)updateComputeSyncResourceAfterDownloadWithResource:(id)resource onDemandDownload:(BOOL)download;
- (void)updateImageExtendedAttributesFromMetadata:(id)metadata;
- (void)updateImageExtendedGenerativeAttributesFromMetadata:(id)metadata;
- (void)updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:(BOOL)library;
- (void)updatePanoramosityWithMetadata:(id)metadata;
- (void)updatePhotoIrisMetadataWithMediaGroupUUID:(id)d videoDuration:(id *)duration stillDisplayTime:(id *)time;
- (void)updatePhotoIrisVisibilityStateWithVitalityScore:(id)score;
- (void)updatePlaybackStyleWithLivePhotoPlayability:(BOOL)playability;
- (void)updateSmartStyleVideoCastFromMetadata:(id)metadata;
- (void)updateSpatialTypeFromAdjustmentRenderTypes:(unsigned int)types hasAdjustment:(BOOL)adjustment adjustedMediaMetadata:(id)metadata;
- (void)updateSyndicationStateWithSavedToLibrary:(BOOL)library;
- (void)updateSyndicationStateWithSyndicationProcessingValue:(unsigned __int16)value;
- (void)updateVideoAttributesFromMetadata:(id)metadata overwriteOriginalProperties:(BOOL)properties;
- (void)updateVideoExtendedAttributesFromMetadata:(id)metadata;
- (void)updateWithCustomAssetProperties:(id)properties;
- (void)userDeleteCloudSharedComment:(id)comment;
- (void)userReadAllCloudSharedComments;
- (void)willSave;
- (void)willTurnIntoFault;
@end

@implementation PLManagedAsset

+ (id)predicateToExcludeNonvisibleBurstAssets
{
  pl_dispatch_once();
  v2 = predicateToExcludeNonvisibleBurstAssets_pl_once_object_14;

  return v2;
}

void __57__PLManagedAsset_predicateToExcludeNonvisibleBurstAssets__block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath:@"avalanchePickType"];
  v1 = [v3 copy];
  v2 = predicateToExcludeNonvisibleBurstAssets_pl_once_object_14;
  predicateToExcludeNonvisibleBurstAssets_pl_once_object_14 = v1;
}

+ (id)predicateToExcludeTrashedAssets
{
  pl_dispatch_once();
  v2 = predicateToExcludeTrashedAssets_pl_once_object_10;

  return v2;
}

void __49__PLManagedAsset_predicateToExcludeTrashedAssets__block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) predicateToExcludeTrashedAssetsWithTrashedStateKeyPath:@"trashedState"];
  v1 = [v3 copy];
  v2 = predicateToExcludeTrashedAssets_pl_once_object_10;
  predicateToExcludeTrashedAssets_pl_once_object_10 = v1;
}

+ (id)predicateToExcludeCameraAutoAdjustments
{
  pl_dispatch_once();
  v2 = predicateToExcludeCameraAutoAdjustments_pl_once_object_17;

  return v2;
}

void __57__PLManagedAsset_predicateToExcludeCameraAutoAdjustments__block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d", @"adjustmentsState", 3];
  v0 = [v2 copy];
  v1 = predicateToExcludeCameraAutoAdjustments_pl_once_object_17;
  predicateToExcludeCameraAutoAdjustments_pl_once_object_17 = v0;
}

- (BOOL)migrateLocationDataIfNeededAfterOTARestore:(BOOL)restore
{
  restoreCopy = restore;
  locationData = [(PLManagedAsset *)self locationData];
  v6 = [PLManagedAsset _locationDataFormat:locationData];
  if (v6 == 2)
  {
    v7 = 0;
    goto LABEL_15;
  }

  dateCreated = [(PLManagedAsset *)self dateCreated];
  v9 = [PLManagedAsset newLocationFromLocationData:locationData timestampIfMissing:dateCreated];
  if (!v6)
  {
    mainFileURL = [(PLManagedAsset *)self mainFileURL];
    if (-[PLManagedAsset complete](self, "complete") && ([MEMORY[0x1E696AC08] defaultManager], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(mainFileURL, "path"), v12 = objc_claimAutoreleasedReturnValue(), v13 = objc_msgSend(v11, "fileExistsAtPath:isDirectory:", v12, 0), v12, v11, v13))
    {
      v14 = objc_alloc(MEMORY[0x1E69C0718]);
      photoLibrary = [(PLManagedObject *)self photoLibrary];
      libraryBundle = [photoLibrary libraryBundle];
      timeZoneLookup = [libraryBundle timeZoneLookup];
      v18 = [v14 initWithMediaURL:mainFileURL timeZoneLookup:timeZoneLookup];

      gpsLocation = [v18 gpsLocation];
      if (gpsLocation)
      {
        v20 = objc_alloc(MEMORY[0x1E6985C40]);
        [v9 coordinate];
        v22 = v21;
        v24 = v23;
        [gpsLocation altitude];
        v26 = v25;
        [gpsLocation horizontalAccuracy];
        v28 = v27;
        [gpsLocation verticalAccuracy];
        v30 = v29;
        [gpsLocation course];
        v32 = v31;
        [gpsLocation speed];
        v34 = v33;
        timestamp = [gpsLocation timestamp];
        v36 = [v20 initWithCoordinate:timestamp altitude:v22 horizontalAccuracy:v24 verticalAccuracy:v26 course:v28 speed:v30 timestamp:{v32, v34}];

        v9 = v36;
      }
    }

    else if (!restoreCopy)
    {
      v7 = 0;
      goto LABEL_13;
    }

    [(PLManagedAsset *)self setLocation:v9];
    v7 = 1;
LABEL_13:

    goto LABEL_14;
  }

  [(PLManagedAsset *)self setLocation:v9];
  v7 = 1;
LABEL_14:

LABEL_15:
  if (v6 == 2)
  {
    v37 = 1;
  }

  else
  {
    v37 = v7;
  }

  return v37;
}

+ (id)newLocationFromLocationData:(id)data timestampIfMissing:(id)missing
{
  dataCopy = data;
  missingCopy = missing;
  if (!dataCopy || ![dataCopy length])
  {
    goto LABEL_8;
  }

  v8 = [self _locationDataFormat:dataCopy];
  if (!v8)
  {
    v18 = 0uLL;
    [dataCopy getBytes:&v18 length:16];
    v17 = CLLocationCoordinate2DMake(*&v18, *(&v18 + 1));
    v14 = 0;
    if (![PLLocationUtils canUseCoordinate:?])
    {
      goto LABEL_9;
    }

    v16 = [objc_alloc(MEMORY[0x1E6985C40]) initWithCoordinate:missingCopy altitude:v17.latitude horizontalAccuracy:v17.longitude verticalAccuracy:0.0 timestamp:{0.0, 0.0}];
LABEL_13:
    v14 = v16;
    goto LABEL_9;
  }

  if (v8 == 1)
  {
    v16 = [MEMORY[0x1E696ACD0] pl_safeUnarchiveObjectFromData:dataCopy class:objc_opt_class()];
    goto LABEL_13;
  }

  if (v8 != 2)
  {
LABEL_8:
    v14 = 0;
    goto LABEL_9;
  }

  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  [dataCopy getBytes:&v18 length:64];
  v9 = v19;
  v10 = v20;
  v11 = v21;
  v12 = CLLocationCoordinate2DMake(*&v18, *(&v18 + 1));
  v13 = [MEMORY[0x1E695DF00] dateWithTimeIntervalSinceReferenceDate:*(&v11 + 1)];
  if ([PLLocationUtils canUseCoordinate:v12.latitude, v12.longitude])
  {
    v14 = [objc_alloc(MEMORY[0x1E6985C40]) initWithCoordinate:v13 altitude:v12.latitude horizontalAccuracy:v12.longitude verticalAccuracy:v9 course:v10 speed:*&v11 timestamp:?];
  }

  else
  {
    v14 = 0;
  }

LABEL_9:
  return v14;
}

+ (int64_t)_locationDataFormat:(id)format
{
  v3 = [format length];
  if ((v3 & 0xFFFFFFFFFFFFFFBFLL) != 0)
  {
    return v3 != 16;
  }

  else
  {
    return 2;
  }
}

+ (id)newLocationDataFromLocation:(id)location
{
  if (!location)
  {
    return 0;
  }

  locationCopy = location;
  [locationCopy coordinate];
  [locationCopy coordinate];
  v14[1] = v5;
  [locationCopy altitude];
  v14[2] = v6;
  [locationCopy horizontalAccuracy];
  v14[3] = v7;
  [locationCopy verticalAccuracy];
  v14[4] = v8;
  [locationCopy course];
  v14[5] = v9;
  [locationCopy speed];
  v14[6] = v10;
  timestamp = [locationCopy timestamp];

  [timestamp timeIntervalSinceReferenceDate];
  v14[7] = v12;

  return [objc_alloc(MEMORY[0x1E695DEF0]) initWithBytes:v14 length:64];
}

- (id)documentObservation
{
  v16 = *MEMORY[0x1E69E9840];
  if (documentObservation_onceToken != -1)
  {
    dispatch_once(&documentObservation_onceToken, &__block_literal_global_7496);
  }

  if (documentObservation_observationClass)
  {
    mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
    characterRecognitionAttributes = [mediaAnalysisAttributes characterRecognitionAttributes];
    characterRecognitionData = [characterRecognitionAttributes characterRecognitionData];

    if (characterRecognitionData)
    {
      v11 = 0;
      v6 = [MEMORY[0x1E696ACD0] unarchivedObjectOfClass:documentObservation_observationClass fromData:characterRecognitionData error:&v11];
      v7 = v11;
      if (!v6 && os_log_type_enabled(MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543618;
        v13 = uuid;
        v14 = 2112;
        v15 = v7;
        _os_log_error_impl(&dword_19BF1F000, MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR, "Failed to unarchive OCR VNDocumentObservation for asset: %{public}@, error: %@", buf, 0x16u);
      }
    }

    else
    {
      v6 = 0;
    }

    v8 = v6;
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

void __42__PLManagedAsset_OCR__documentObservation__block_invoke()
{
  documentObservation_observationClass = NSClassFromString(&cfstr_Vndocumentobse.isa);
  if (!documentObservation_observationClass && os_log_type_enabled(MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR))
  {
    *v0 = 0;
    _os_log_error_impl(&dword_19BF1F000, MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR, "VNDocumentObservation not available in current process.", v0, 2u);
  }
}

- (BOOL)promoteFromUnknownKind
{
  if ([(PLManagedAsset *)self kind]== 3)
  {
    originalUniformTypeIdentifier = [(PLManagedAsset *)self originalUniformTypeIdentifier];
    v4 = [MEMORY[0x1E69C08F0] typeWithIdentifier:originalUniformTypeIdentifier];
    if ([v4 conformsToType:*MEMORY[0x1E6982E30]])
    {
      v5 = 0;
    }

    else
    {
      if (([v4 conformsToType:*MEMORY[0x1E6982EE8]] & 1) == 0)
      {
        if (![(PLManagedAsset *)self attemptPromoteFromUnknownKindUsingCloudMaster])
        {
          v6 = 0;
LABEL_11:

          return v6;
        }

LABEL_8:
        photoLibrary = [(PLManagedObject *)self photoLibrary];
        thumbnailManager = [photoLibrary thumbnailManager];

        thumbnailIdentifier = [(PLManagedAsset *)self thumbnailIdentifier];
        thumbnailIndex = [(PLManagedAsset *)self thumbnailIndex];
        uuid = [(PLManagedAsset *)self uuid];
        [thumbnailManager deleteThumbnailsWithIdentifier:thumbnailIdentifier orIndex:thumbnailIndex uuid:uuid];

        [(PLManagedAsset *)self setEffectiveThumbnailIndex:0x7FFFFFFFFFFFFFFFLL];
        uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];

        if (!uniformTypeIdentifier)
        {
          [(PLManagedAsset *)self setUniformTypeIdentifier:originalUniformTypeIdentifier];
        }

        v6 = 1;
        goto LABEL_11;
      }

      v5 = 1;
    }

    [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:v5];
    goto LABEL_8;
  }

  return 0;
}

- (BOOL)attemptPromoteFromUnknownKindUsingCloudMaster
{
  v28 = *MEMORY[0x1E69E9840];
  master = [(PLManagedAsset *)self master];
  uniformTypeIdentifier = [master uniformTypeIdentifier];
  allAssetAttachedResources = [master allAssetAttachedResources];
  v6 = MEMORY[0x1E696AE18];
  imageDerivativeTypes = [MEMORY[0x1E6994B90] imageDerivativeTypes];
  v8 = [v6 predicateWithFormat:@"cplType IN %@", imageDerivativeTypes];
  v9 = [allAssetAttachedResources filteredSetUsingPredicate:v8];
  v10 = [v9 count];

  if (v10)
  {
    if (*MEMORY[0x1E6994D48])
    {
      v13 = 0;
      goto LABEL_12;
    }

    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138412802;
      v23 = uniformTypeIdentifier;
      v24 = 2112;
      v25 = uuid;
      v26 = 2112;
      v27 = master;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Guessing PLAssetTypeImage for UTI: %@ on asset: %@ from master %@", buf, 0x20u);
    }

    v13 = 0;
  }

  else
  {
    v14 = MEMORY[0x1E696AE18];
    videoDerivativeTypes = [MEMORY[0x1E6994B90] videoDerivativeTypes];
    v16 = [v14 predicateWithFormat:@"cplType IN %@", videoDerivativeTypes];
    v17 = [allAssetAttachedResources filteredSetUsingPredicate:v16];
    v18 = [v17 count];

    if (!v18)
    {
      v20 = 0;
      goto LABEL_13;
    }

    if (*MEMORY[0x1E6994D48])
    {
      v13 = 1;
      goto LABEL_12;
    }

    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      uuid2 = [(PLManagedAsset *)self uuid];
      *buf = 138412802;
      v23 = uniformTypeIdentifier;
      v24 = 2112;
      v25 = uuid2;
      v26 = 2112;
      v27 = master;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Guessing PLAssetTypeVideo for UTI: %@ on asset: %@ from master %@", buf, 0x20u);
    }

    v13 = 1;
  }

LABEL_12:
  [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:v13];
  v20 = 1;
LABEL_13:

  return v20;
}

+ (id)assetsToConsiderForTypePromotionInContext:(id)context withExtensions:(id)extensions error:(id *)error
{
  v43 = *MEMORY[0x1E69E9840];
  contextCopy = context;
  extensionsCopy = extensions;
  if (!contextCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+NewFormats.m" lineNumber:60 description:{@"Invalid parameter not satisfying: %@", @"context"}];
  }

  v34 = contextCopy;
  if (!extensionsCopy)
  {
    currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+NewFormats.m" lineNumber:61 description:{@"Invalid parameter not satisfying: %@", @"extensions"}];
  }

  v33 = [MEMORY[0x1E696AE18] predicateWithFormat:@"kind = %d", 3];
  array = [MEMORY[0x1E695DF70] array];
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  obj = extensionsCopy;
  v12 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v38;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v38 != v14)
        {
          objc_enumerationMutation(obj);
        }

        v16 = MEMORY[0x1E696AE18];
        v17 = [MEMORY[0x1E696AEC0] stringWithFormat:@".%@", *(*(&v37 + 1) + 8 * i)];
        v18 = [v16 predicateWithFormat:@"filename ENDSWITH[c] %@", v17];
        [array addObject:v18];
      }

      v13 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
    }

    while (v13);
  }

  v19 = MEMORY[0x1E696AB28];
  v41[0] = v33;
  v20 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:array];
  v41[1] = v20;
  v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v41 count:2];
  v22 = [v19 andPredicateWithSubpredicates:v21];

  v23 = MEMORY[0x1E695D5E0];
  v24 = +[PLManagedAsset entityName];
  v25 = [v23 fetchRequestWithEntityName:v24];

  [v25 setFetchBatchSize:100];
  [v25 setPredicate:v22];
  v36 = 0;
  v26 = [v34 executeFetchRequest:v25 error:&v36];
  v27 = v36;
  v28 = v27;
  if (error && v27)
  {
    v29 = v27;
    *error = v28;
  }

  return v26;
}

- (id)edgesIn
{
  v2 = [PLGraphNode nodeForActingObject:self createIfMissing:0];
  edgesIn = [v2 edgesIn];

  return edgesIn;
}

- (id)edgesOut
{
  v2 = [PLGraphNode nodeForActingObject:self createIfMissing:0];
  edgesOut = [v2 edgesOut];

  return edgesOut;
}

- (double)pl_gpsHorizontalAccuracy
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes gpsHorizontalAccuracy];
  v4 = v3;

  return v4;
}

- (NSDate)pl_date
{
  cachedDateCreated = self->_cachedDateCreated;
  if (!cachedDateCreated)
  {
    dateCreated = [(PLManagedAsset *)self dateCreated];
    v5 = self->_cachedDateCreated;
    self->_cachedDateCreated = dateCreated;

    cachedDateCreated = self->_cachedDateCreated;
  }

  return cachedDateCreated;
}

- (CLLocationCoordinate2D)pl_coordinate
{
  if (!self->_isCoordinateCached)
  {
    [(PLManagedAsset *)self latitude];
    v4 = v3;
    [(PLManagedAsset *)self longitude];
    v6 = CLLocationCoordinate2DMake(v4, v5);
    v7 = [PLLocationUtils canUseCoordinate:?];
    p_cachedCoordinate = &self->_cachedCoordinate;
    if (v7)
    {
      p_cachedCoordinate->latitude = v6.latitude;
      self->_cachedCoordinate.longitude = v6.longitude;
    }

    else
    {
      *p_cachedCoordinate = *MEMORY[0x1E6985CC0];
    }

    self->_isCoordinateCached = 1;
  }

  latitude = self->_cachedCoordinate.latitude;
  longitude = self->_cachedCoordinate.longitude;
  result.longitude = longitude;
  result.latitude = latitude;
  return result;
}

- (id)activityViewController:(id)controller itemForActivityType:(id)type
{
  if ([type isEqualToString:@"com.apple.UIKit.activity.CopyToPasteboard"])
  {
    [(PLManagedAsset *)self pasteBoardRepresentation];
  }

  else
  {
    [(PLManagedAsset *)self assetURL];
  }
  v5 = ;

  return v5;
}

- (int)inferredTimeZoneOffset
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  inferredTimeZoneOffset = [additionalAttributes inferredTimeZoneOffset];
  integerValue = [inferredTimeZoneOffset integerValue];

  return integerValue;
}

- (NSNumber)rawTimeZoneOffsetValue
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  timeZoneOffset = [additionalAttributes timeZoneOffset];

  return timeZoneOffset;
}

- (NSString)rawTimeZoneName
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  timeZoneName = [additionalAttributes timeZoneName];

  return timeZoneName;
}

- (id)localDateAndCreateIfNeededWithLocalDateCreator:(id)creator
{
  creatorCopy = creator;
  v5 = self->_cachedLocalDateCreated;
  v6 = v5;
  if (v5)
  {
    localDateCreated = v5;
  }

  else
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    inferredTimeZoneOffset = [additionalAttributes inferredTimeZoneOffset];
    if (!inferredTimeZoneOffset)
    {
      v10 = [creatorCopy generateInferredTimeZoneOffsetForAsset:self];
      [additionalAttributes setInferredTimeZoneOffset:v10];
    }

    localDateCreated = [(PLManagedAsset *)self localDateCreated];
  }

  return localDateCreated;
}

- (double)gpsHorizontalAccuracy
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes gpsHorizontalAccuracy];
  v4 = v3;

  return v4;
}

- (NSDate)localDateCreated
{
  cachedLocalDateCreated = self->_cachedLocalDateCreated;
  if (!cachedLocalDateCreated)
  {
    pl_date = [(PLManagedAsset *)self pl_date];
    v5 = [pl_date dateByAddingTimeInterval:{-[PLManagedAsset inferredTimeZoneOffset](self, "inferredTimeZoneOffset")}];
    v6 = self->_cachedLocalDateCreated;
    self->_cachedLocalDateCreated = v5;

    cachedLocalDateCreated = self->_cachedLocalDateCreated;
  }

  return cachedLocalDateCreated;
}

- (int64_t)compareToAsset:(id)asset
{
  assetCopy = asset;
  dateCreated = [(PLManagedAsset *)self dateCreated];
  dateCreated2 = [assetCopy dateCreated];
  v7 = [dateCreated compare:dateCreated2];

  if (!v7)
  {
    addedDate = [(PLManagedAsset *)self addedDate];
    addedDate2 = [assetCopy addedDate];
    v7 = [addedDate compare:addedDate2];

    if (!v7)
    {
      filename = [(PLManagedAsset *)self filename];
      filename2 = [assetCopy filename];
      v7 = [filename compare:filename2];
    }
  }

  return v7;
}

- (id)assetComparisonSortDescriptors
{
  v7[3] = *MEMORY[0x1E69E9840];
  v2 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:1];
  v3 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"addedDate" ascending:{1, v2}];
  v7[1] = v3;
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"filename" ascending:1];
  v7[2] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v7 count:3];

  return v5;
}

- (BOOL)visibilityStateIsEqualToState:(signed __int16)state
{
  if (!state)
  {
    if ([(PLManagedAsset *)self visibilityState])
    {
      return 0;
    }

    goto LABEL_10;
  }

  if (state == 1)
  {
    if ([(PLManagedAsset *)self visibilityState]!= 1)
    {
      return 0;
    }

LABEL_10:
    if (([(PLManagedAsset *)self hidden]& 1) == 0)
    {
      return ![(PLManagedAsset *)self isInTrash];
    }

    return 0;
  }

  if (state != 2)
  {
    return 0;
  }

  if ([(PLManagedAsset *)self visibilityState]== 2 || ([(PLManagedAsset *)self hidden]& 1) != 0)
  {
    return 1;
  }

  return [(PLManagedAsset *)self isInTrash];
}

- (id)descriptionForModernResources
{
  v21 = *MEMORY[0x1E69E9840];
  string = [MEMORY[0x1E696AD60] string];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"qualitySortValue" ascending:1];
  v5 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"version" ascending:0];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v6 = [(PLManagedAsset *)self resourcesSortedByQualityWithOptions:0];
  v19[0] = v4;
  v19[1] = v5;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v19 count:2];
  v8 = [v6 sortedArrayUsingDescriptors:v7];

  v9 = [v8 countByEnumeratingWithState:&v15 objects:v20 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v16;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v16 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v15 + 1) + 8 * i) debugDescription];
        [string appendFormat:@"resource: %@\n", v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v15 objects:v20 count:16];
    }

    while (v10);
  }

  return string;
}

- (id)faceDescription
{
  v19 = *MEMORY[0x1E69E9840];
  v3 = +[PLDescriptionBuilder plainMultiLineDescriptionBuilder];
  faceAdjustmentVersion = [(PLManagedAsset *)self faceAdjustmentVersion];
  [v3 appendName:@"adjustmentVersion" object:faceAdjustmentVersion];

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [v3 appendName:@"analysisVersion" integerValue:{objc_msgSend(additionalAttributes, "faceAnalysisVersion")}];

  detectedFaces = [(PLManagedAsset *)self detectedFaces];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v7 = [detectedFaces countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(detectedFaces);
        }

        debugLogDescription = [*(*(&v14 + 1) + 8 * i) debugLogDescription];
        [v3 appendName:@"face" object:debugLogDescription];
      }

      v8 = [detectedFaces countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v8);
  }

  build = [v3 build];

  return build;
}

- (id)descriptionForNonCloudResources
{
  string = [MEMORY[0x1E696AD60] string];
  [string appendString:{@"CPL not enabled, resource list may not be complete\n"}];
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  v5 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Original", pathForOriginalFile);
  [string appendString:v5];

  pathForFullsizeImageFile = [(PLManagedAsset *)self pathForFullsizeImageFile];
  v7 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"FullSize", pathForFullsizeImageFile);
  [string appendString:v7];

  pathForLargeThumbnailFile = [(PLManagedAsset *)self pathForLargeThumbnailFile];
  v9 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Medium (3MP)", pathForLargeThumbnailFile);
  [string appendString:v9];

  pathForMediumThumbnailFile = [(PLManagedAsset *)self pathForMediumThumbnailFile];
  v11 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Thumb", pathForMediumThumbnailFile);
  [string appendString:v11];

  pathForSubstandardFullsizeRenderImageFile = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
  v13 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Substandard", pathForSubstandardFullsizeRenderImageFile);
  [string appendString:v13];

  return string;
}

id __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(void *a1, void *a2)
{
  v3 = MEMORY[0x1E696AC08];
  v4 = a2;
  v5 = a1;
  v6 = [v3 defaultManager];
  v7 = [v6 fileExistsAtPath:v4];

  v8 = @"N";
  if (v7)
  {
    v8 = @"Y";
  }

  v9 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@ : %@ : %@\n", v5, v4, v8];

  return v9;
}

- (id)descriptionForSceneAnalysis
{
  v33 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  sceneClassifications = [additionalAttributes sceneClassifications];

  v5 = MEMORY[0x1E696AD60];
  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  sceneAnalysisVersion = [additionalAttributes2 sceneAnalysisVersion];
  additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
  sceneAnalysisTimestamp = [additionalAttributes3 sceneAnalysisTimestamp];
  v10 = [v5 stringWithFormat:@"version: %ld\ntimestamp: %@\n%lu total", sceneAnalysisVersion, sceneAnalysisTimestamp, objc_msgSend(sceneClassifications, "count")];

  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v11 = sceneClassifications;
  v12 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v29;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v29 != v14)
        {
          objc_enumerationMutation(v11);
        }

        debugLogDescription = [*(*(&v28 + 1) + 8 * i) debugLogDescription];
        [v10 appendFormat:@"\n%@", debugLogDescription];
      }

      v13 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
    }

    while (v13);
  }

  [(PLManagedAsset *)self packedPreferredCropRect];
  [(PLManagedAsset *)self packedAcceptableCropRect];
  PLSplitToCGRectFromInt64();
  PLSplitToCGRectFromInt64();
  v27 = vmulq_f64(0, vcvtq_f64_s64(*&self->_width));
  v35.origin = v27;
  v35.size = v27;
  v17 = NSStringFromRect(v35);
  v36.origin = v27;
  v36.size = v27;
  v18 = NSStringFromRect(v36);
  [v10 appendFormat:@"\nPreferred Crop Rect: %@\nAcceptable Crop Rect: %@", v17, v18];

  if ([(PLManagedAsset *)self faceAreaPoints]< 0)
  {
    v23 = *MEMORY[0x1E695F058];
    v24 = *(MEMORY[0x1E695F058] + 8);
    v20 = *(MEMORY[0x1E695F058] + 16);
    v22 = *(MEMORY[0x1E695F058] + 24);
  }

  else
  {
    PLSplitToDoubleFromInt64();
    width = self->_width;
    v20 = (0.0 - 0.0) * width;
    height = self->_height;
    v22 = (0.0 - 0.0) * height;
    v23 = 0.0 * width;
    v24 = 0.0 * height;
  }

  v25 = NSStringFromRect(*&v23);
  [v10 appendFormat:@"\nFace Area Rect: %@", v25];

  return v10;
}

- (id)descriptionForAnalysisStates
{
  v17 = *MEMORY[0x1E69E9840];
  analysisStates = [(PLManagedAsset *)self analysisStates];
  string = [MEMORY[0x1E696AD60] string];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = analysisStates;
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([string length])
        {
          [string appendFormat:@"\n"];
        }

        debugLogDescription = [v9 debugLogDescription];
        [string appendFormat:@"%@", debugLogDescription];
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v6);
  }

  return string;
}

- (id)descriptionForSidecarFiles
{
  v15 = *MEMORY[0x1E69E9840];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  sidecars = [(PLManagedAsset *)self sidecars];
  v3 = [sidecars countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    string = 0;
    v6 = *v11;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(sidecars);
        }

        v8 = *(*(&v10 + 1) + 8 * i);
        if (!string)
        {
          string = [MEMORY[0x1E696AD60] string];
        }

        [string appendFormat:@"SIDECAR: %@", v8];
      }

      v4 = [sidecars countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v4);
  }

  else
  {
    string = 0;
  }

  return string;
}

- (id)shortenedFilePath
{
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  v3 = [pathForOriginalFile rangeOfString:@"/Media/"];
  if (v4)
  {
    v5 = [pathForOriginalFile substringWithRange:{v3, objc_msgSend(pathForOriginalFile, "length") - v3}];
  }

  else
  {
    v5 = pathForOriginalFile;
  }

  v6 = v5;

  return v6;
}

- (BOOL)isPlayableVideo:(id *)video
{
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  if (![(PLManagedAsset *)self isVideo]&& !isPhotoIris)
  {
    videoCodecName = 0;
    if (!video)
    {
      v7 = 0;
      goto LABEL_40;
    }

LABEL_39:
    v7 = 0;
    *video = videoCodecName;
    goto LABEL_40;
  }

  v8 = objc_autoreleasePoolPush();
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  isCloudPhotoLibraryEnabled = [photoLibrary isCloudPhotoLibraryEnabled];

  if (!isCloudPhotoLibraryEnabled)
  {
    if (isPhotoIris)
    {
      [(PLManagedAsset *)self pathForVideoComplementFile];
    }

    else
    {
      [(PLManagedAsset *)self pathForOriginalFile];
    }
    v19 = ;
    videoCodecName = 0;
    v7 = 1;
    if (!v19)
    {
      goto LABEL_36;
    }

    goto LABEL_30;
  }

  if (isPhotoIris)
  {
    v11 = 18;
  }

  else
  {
    v11 = 1;
  }

  v35 = 0;
  v12 = [(PLManagedAsset *)self _isResourceAvailableForResourceType:v11 outResource:&v35];
  v13 = v35;
  v14 = v13;
  if (v12)
  {
    uniformTypeIdentifier = [v13 uniformTypeIdentifier];
    identifier = [uniformTypeIdentifier identifier];

    cplFileURL = [v14 cplFileURL];
    path = [cplFileURL path];

    if ([objc_opt_class() _isPlayableVideoUTI:identifier])
    {
      if (isPhotoIris)
      {
        path = path;
        videoCodecName = 0;
        v7 = 1;
        v19 = path;
      }

      else
      {
        master = [(PLManagedAsset *)self master];
        mediaMetadata = [master mediaMetadata];
        v22 = [mediaMetadata valueForKey:@"data"];

        if (v22)
        {
          v23 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVProxyData:v22 timeZoneLookup:0];
          v24 = v23;
          if (v23)
          {
            isPlayable = [v23 isPlayable];
            v7 = isPlayable;
            videoCodecName = 0;
            if (video && (isPlayable & 1) == 0)
            {
              videoCodecName = [v24 videoCodecName];
              v7 = 0;
            }
          }

          else
          {
            videoCodecName = 0;
            v7 = 1;
          }
        }

        else
        {
          videoCodecName = 0;
          v7 = 1;
        }

        v19 = 0;
      }
    }

    else
    {
      v19 = 0;
      videoCodecName = 0;
      v7 = 0;
    }
  }

  else
  {
    path = 0;
    identifier = 0;
    v19 = 0;
    videoCodecName = 0;
    v7 = 1;
  }

  if (v19)
  {
LABEL_30:
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    v27 = [defaultManager fileExistsAtPath:v19];

    if (v27)
    {
      v28 = [MEMORY[0x1E695DFF8] fileURLWithPath:v19 isDirectory:0];
      v29 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVURL:v28 timeZoneLookup:0];
      v30 = v29;
      if (v29)
      {
        isPlayable2 = [v29 isPlayable];
        v7 = isPlayable2;
        if (video)
        {
          if ((isPlayable2 & 1) == 0)
          {
            videoCodecName2 = [v30 videoCodecName];

            v7 = 0;
            videoCodecName = videoCodecName2;
          }
        }
      }
    }
  }

LABEL_36:

  objc_autoreleasePoolPop(v8);
  if (video && !v7)
  {
    v33 = videoCodecName;
    goto LABEL_39;
  }

LABEL_40:

  return v7;
}

- (NSURL)assetURL
{
  fileExtension = [(PLManagedAsset *)self fileExtension];
  v4 = [(PLManagedAsset *)self assetURLWithExtension:fileExtension];

  return v4;
}

- (id)assetURLForSidecarFile:(id)file
{
  fileCopy = file;
  v5 = fileCopy;
  if (fileCopy)
  {
    v6 = MEMORY[0x1E6982C40];
    uniformTypeIdentifier = [fileCopy uniformTypeIdentifier];
    v8 = [v6 typeWithIdentifier:uniformTypeIdentifier];
    preferredFilenameExtension = [v8 preferredFilenameExtension];

    v10 = MEMORY[0x1E695DFF8];
    v11 = MEMORY[0x1E696AEC0];
    uuid = [(PLManagedAsset *)self uuid];
    index = [v5 index];
    v14 = [v11 stringWithFormat:@"%@://%@/%@.%@?%@=%@&%@=%@", @"assets-library", @"asset", @"asset", preferredFilenameExtension, @"id", uuid, @"sci", index];
    v15 = [v10 URLWithString:v14];
  }

  else
  {
    v16 = MEMORY[0x1E695DFF8];
    v17 = MEMORY[0x1E696AEC0];
    preferredFilenameExtension = [(PLManagedAsset *)self fileExtension];
    uuid = [(PLManagedAsset *)self uuid];
    index = [v17 stringWithFormat:@"%@://%@/%@.%@?%@=%@", @"assets-library", @"asset", @"asset", preferredFilenameExtension, @"id", uuid];
    v15 = [v16 URLWithString:index];
  }

  return v15;
}

- (id)assetURLWithExtension:(id)extension
{
  v22 = *MEMORY[0x1E69E9840];
  extensionCopy = extension;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  sidecars = [(PLManagedAsset *)self sidecars];
  v6 = [sidecars countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v18;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v18 != v8)
        {
          objc_enumerationMutation(sidecars);
        }

        v10 = *(*(&v17 + 1) + 8 * i);
        originalFilename = [v10 originalFilename];
        pathExtension = [originalFilename pathExtension];
        v13 = [pathExtension compare:extensionCopy options:1];

        if (!v13)
        {
          v14 = [(PLManagedAsset *)self assetURLForSidecarFile:v10];
          goto LABEL_11;
        }
      }

      v7 = [sidecars countByEnumeratingWithState:&v17 objects:v21 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  sidecars = [(PLManagedAsset *)self uuid];
  v14 = [PLManagedAsset assetsLibraryURLWithUUID:sidecars extension:extensionCopy];
LABEL_11:
  v15 = v14;

  return v15;
}

- (NSString)textBadgeString
{
  v3 = objc_autoreleasePoolPush();
  allFileExtensions = [(PLManagedAsset *)self allFileExtensions];
  if ([allFileExtensions count] == 1 && (-[PLManagedAsset isPhoto](self, "isPhoto") || -[PLManagedAsset isVideo](self, "isVideo") || -[PLManagedAsset isAudio](self, "isAudio") || -[PLManagedAsset kind](self, "kind") == 3))
  {

    objc_autoreleasePoolPop(v3);
    uppercaseString = 0;
  }

  else
  {
    v6 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(allFileExtensions, "count")}];
    v28 = 0;
    v29 = &v28;
    v30 = 0x2020000000;
    v31 = 0;
    v24 = 0;
    v25 = &v24;
    v26 = 0x2020000000;
    v27 = 0;
    v20 = 0;
    v21 = &v20;
    v22 = 0x2020000000;
    v23 = 0;
    v16 = 0;
    v17 = &v16;
    v18 = 0x2020000000;
    v19 = 0;
    v10[0] = MEMORY[0x1E69E9820];
    v10[1] = 3221225472;
    v10[2] = __33__PLManagedAsset_textBadgeString__block_invoke;
    v10[3] = &unk_1E7567A60;
    v12 = &v28;
    v7 = v6;
    v11 = v7;
    v13 = &v24;
    v14 = &v20;
    v15 = &v16;
    [allFileExtensions enumerateObjectsUsingBlock:v10];
    if ([v7 count] == 2 && *(v29 + 24) == 1 && (v25[3] & 1) != 0)
    {
      uppercaseString = @"RAW+JPG";
    }

    else if ([v7 count] == 2 && *(v21 + 24) == 1 && (v17[3] & 1) != 0)
    {
      uppercaseString = 0;
    }

    else
    {
      v8 = [v7 componentsJoinedByString:@"+"];
      uppercaseString = [v8 uppercaseString];
    }

    _Block_object_dispose(&v16, 8);
    _Block_object_dispose(&v20, 8);
    _Block_object_dispose(&v24, 8);
    _Block_object_dispose(&v28, 8);

    objc_autoreleasePoolPop(v3);
  }

  return uppercaseString;
}

void __33__PLManagedAsset_textBadgeString__block_invoke(void *a1, void *a2)
{
  v3 = MEMORY[0x1E6982C40];
  v4 = a2;
  v8 = [v3 typeWithFilenameExtension:v4];
  if ([v8 conformsToType:*MEMORY[0x1E6982F88]])
  {
    *(*(a1[5] + 8) + 24) = 1;
    v5 = a1[4];
    v6 = @"RAW";
  }

  else if ([v8 conformsToType:*MEMORY[0x1E6982E58]])
  {
    *(*(a1[6] + 8) + 24) = 1;
    v5 = a1[4];
    v6 = @"JPG";
  }

  else if ([v8 conformsToType:*MEMORY[0x1E6982F28]])
  {
    *(*(a1[7] + 8) + 24) = 1;
    v5 = a1[4];
    v6 = @"PNG";
  }

  else
  {
    v5 = a1[4];
    v6 = v4;
  }

  [v5 addObject:v6];
  v7 = [(__CFString *)v4 caseInsensitiveCompare:*MEMORY[0x1E69C0E20]];

  if (!v7)
  {
    *(*(a1[8] + 8) + 24) = 1;
  }
}

- (id)pasteBoardRepresentation
{
  dictionary = [MEMORY[0x1E695DF90] dictionary];
  objectID = [(PLManagedAsset *)self objectID];
  if (objectID)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      uRIRepresentation = [objectID URIRepresentation];
      absoluteString = [uRIRepresentation absoluteString];
    }

    else
    {
      absoluteString = 0;
    }

    v7 = [absoluteString dataUsingEncoding:4];
    [dictionary setObject:v7 forKey:@"com.apple.mobileslideshow.asset-object-id-uri"];
  }

  v12 = 0;
  v8 = [(PLManagedAsset *)self largestAvailableDataRepresentationAndType:&v12];
  v9 = v12;
  if (v9)
  {
    v10 = v8 == 0;
  }

  else
  {
    v10 = 1;
  }

  if (!v10)
  {
    [dictionary setObject:v8 forKey:v9];
  }

  return dictionary;
}

- (id)largestAvailableDataRepresentationAndType:(id *)type
{
  v5 = 0;
  [(PLManagedAsset *)self _getLargestAvailableDataRepresentation:&v5 type:type];
  v3 = v5;

  return v3;
}

- (void)_getLargestAvailableDataRepresentation:(id *)representation type:(id *)type
{
  if (-[PLManagedAsset isPhoto](self, "isPhoto") && ([0 pathExtension], v7 = objc_claimAutoreleasedReturnValue(), v8 = +[PLPhotoLibrary isRawImageFileExtension:](PLPhotoLibrary, "isRawImageFileExtension:", v7), v7, v8))
  {
    v19 = 0;
    v9 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:self format:0 allowMetadataSnapshot:0 forceLarge:1 outFilePath:&v19 outImageType:0];
    v10 = v19;
  }

  else
  {
    v10 = 0;
  }

  if ([(PLManagedAsset *)self isVideo])
  {
    pathForVideoFile = [(PLManagedAsset *)self pathForVideoFile];

    v10 = pathForVideoFile;
  }

  if (!v10)
  {
    pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
    if (pathForOriginalFile)
    {
      v10 = pathForOriginalFile;
    }

    else
    {
      v18 = 0;
      v13 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:self format:0 allowMetadataSnapshot:0 forceLarge:1 outFilePath:&v18 outImageType:0];
      v10 = v18;
      if (!v10)
      {
        v14 = 0;
        goto LABEL_16;
      }
    }
  }

  if (representation)
  {
    v14 = [objc_alloc(MEMORY[0x1E695DEF0]) initWithContentsOfFile:v10 options:1 error:0];
    *representation = v14;
    if (!type)
    {
      goto LABEL_16;
    }

    goto LABEL_15;
  }

  v14 = 0;
  if (type)
  {
LABEL_15:
    v15 = MEMORY[0x1E6982C40];
    pathExtension = [v10 pathExtension];
    v17 = [v15 typeWithFilenameExtension:pathExtension];
    *type = [v17 identifier];
  }

LABEL_16:
}

- (id)imageWithFormat:(unsigned __int16)format
{
  v3 = [PLImageLoadingUtilities newSynchronousImageForAsset:self withFormat:format allowPlaceholder:1 outImageProperties:0 outDeliveredPlaceholder:0];

  return v3;
}

- (id)pathForOriginalVideoComplementDiagnosticFile
{
  pathForDiagnosticFile = [(PLManagedAsset *)self pathForDiagnosticFile];
  stringByDeletingPathExtension = [pathForDiagnosticFile stringByDeletingPathExtension];
  pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
  pathExtension = [pathForVideoComplementFile pathExtension];
  v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:pathExtension];

  return v7;
}

- (id)pathForCameraSpatialOverCaptureMetadataDiagnosticFile
{
  pathForDiagnosticFile = [(PLManagedAsset *)self pathForDiagnosticFile];
  stringByDeletingPathExtension = [pathForDiagnosticFile stringByDeletingPathExtension];
  v4 = [stringByDeletingPathExtension stringByAppendingPathExtension:*MEMORY[0x1E69C00F0]];
  v5 = [v4 stringByAppendingPathExtension:*MEMORY[0x1E69C00C0]];

  return v5;
}

- (id)pathForCameraMetadataDiagnosticFile
{
  pathForDiagnosticFile = [(PLManagedAsset *)self pathForDiagnosticFile];
  stringByDeletingPathExtension = [pathForDiagnosticFile stringByDeletingPathExtension];
  v4 = [stringByDeletingPathExtension stringByAppendingPathExtension:*MEMORY[0x1E69C00C0]];

  return v4;
}

- (id)pathForReframeDiagnosticFile
{
  pathForReframeDiagnosticDirectory = [(PLManagedAsset *)self pathForReframeDiagnosticDirectory];
  v3 = [pathForReframeDiagnosticDirectory stringByAppendingPathComponent:*MEMORY[0x1E69C00E8]];
  v4 = [v3 stringByAppendingPathExtension:*MEMORY[0x1E69C00C8]];

  return v4;
}

- (id)pathForReframeDiagnosticDirectory
{
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  lastPathComponent = [mainFileURL lastPathComponent];
  stringByDeletingPathExtension = [lastPathComponent stringByDeletingPathExtension];

  photoLibrary = [(PLManagedObject *)self photoLibrary];
  pathManager = [photoLibrary pathManager];
  v8 = [pathManager privateDirectoryWithSubType:8 createIfNeeded:0 error:0];

  v9 = [v8 stringByAppendingPathComponent:stringByDeletingPathExtension];

  return v9;
}

- (id)pathForSpatialOverCaptureDiagnosticFile
{
  pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForSpatialOverCaptureContentFile];
  lastPathComponent = [pathForSpatialOverCaptureContentFile lastPathComponent];

  v5 = objc_opt_class();
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v7 = [v5 diagnosticFilePathForLibrary:photoLibrary mainFilename:lastPathComponent createIfNeeded:0];

  return v7;
}

- (id)pathForDiagnosticFile
{
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  lastPathComponent = [mainFileURL lastPathComponent];

  v5 = objc_opt_class();
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v7 = [v5 diagnosticFilePathForLibrary:photoLibrary mainFilename:lastPathComponent createIfNeeded:0];

  return v7;
}

- (NSString)pathForLegacySlalomRegionsArchive
{
  if ([(PLManagedAsset *)self isDefaultAdjustedSlomo])
  {
    pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
    stringByDeletingPathExtension = [pathForOriginalFile stringByDeletingPathExtension];
    v5 = [stringByDeletingPathExtension stringByAppendingPathExtension:@"SLM"];
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (BOOL)isDefaultAdjustedSlomo
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];

  adjustmentFormatIdentifier = [unmanagedAdjustment adjustmentFormatIdentifier];
  v6 = [adjustmentFormatIdentifier isEqualToString:@"com.apple.video.slomo"];

  adjustmentFormatVersion = [unmanagedAdjustment adjustmentFormatVersion];
  v8 = adjustmentFormatVersion;
  if (v6)
  {
    if ([adjustmentFormatVersion isEqualToString:@"1.1"])
    {
      LOBYTE(v6) = 1;
    }

    else
    {
      LOBYTE(v6) = [v8 isEqualToString:@"1.0"];
    }
  }

  isVideo = [(PLManagedAsset *)self isVideo];

  return isVideo & v6;
}

- (BOOL)isMogul
{
  isVideo = [(PLManagedAsset *)self isVideo];
  if (isVideo)
  {
    LOBYTE(isVideo) = [(PLManagedAsset *)self kindSubtype]== 101;
  }

  return isVideo;
}

- (NSString)pathForXMPFile
{
  pathManager = [(PLManagedObject *)self pathManager];
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v4 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    supplementalResourceXMPType = [MEMORY[0x1E69C08F0] supplementalResourceXMPType];
    identifier = [supplementalResourceXMPType identifier];
    uppercaseString = [v4 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 resourceType:5];

    filename = [pathManager readOnlyUrlWithIdentifier:uppercaseString];
    path = [filename path];
  }

  else
  {
    uppercaseString = [*MEMORY[0x1E69C0E20] uppercaseString];
    [uppercaseString UTF8String];
    filename = [(PLManagedAsset *)self filename];
    directory = [(PLManagedAsset *)self directory];
    v13 = PLDCIMURLForResourcePropertiesAndPathManager();
    path = [v13 path];
  }

  return path;
}

- (NSString)pathForPrebakedPortraitScrubberThumbnails
{
  if ([(PLManagedAsset *)self isVideo])
  {
    v3 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"THP"];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (NSString)pathForPrebakedLandscapeScrubberThumbnails
{
  if ([(PLManagedAsset *)self isVideo])
  {
    v3 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"THL"];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (unsigned)expectedDeferredProcessingNeededOnAssetCreation
{
  deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
  if (!deferredProcessingNeeded)
  {
    if ([(PLManagedAsset *)self kind])
    {
      LOWORD(deferredProcessingNeeded) = 0;
    }

    else
    {
      v4 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FBF4A8];
      v5 = [PLResourceRecipe recipeFromID:65737];
      if ([v4 containsObject:v5])
      {
        LOWORD(deferredProcessingNeeded) = 4;
      }

      else
      {
        LOWORD(deferredProcessingNeeded) = 0;
      }
    }
  }

  return deferredProcessingNeeded;
}

- (BOOL)renderableAdjustmentDictionary:(id *)dictionary error:(id *)error
{
  v6 = MEMORY[0x1E695DEF0];
  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  v25 = 0;
  v8 = [v6 dataWithContentsOfFile:pathForAdjustmentFile options:0 error:&v25];
  v9 = v25;

  if (v8)
  {
    v24 = 0;
    v10 = [MEMORY[0x1E696AE40] propertyListWithData:v8 options:0 format:0 error:&v24];
    v11 = v24;

    v9 = v11;
  }

  else
  {
    v10 = 0;
  }

  v12 = [v10 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
  v13 = [v10 objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
  v14 = [v10 objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
  v15 = v14;
  if (v12)
  {
    v16 = v13 == 0;
  }

  else
  {
    v16 = 1;
  }

  v17 = v16 || v14 == 0;
  if (v17 || ([MEMORY[0x1E69C0910] isRecognizedSlowMotionFormatWithIdentifier:v14 version:v13] & 1) != 0)
  {
    v18 = 0;
    if (!error)
    {
      goto LABEL_14;
    }

    goto LABEL_13;
  }

  v23 = v9;
  v18 = [PLPhotoEditPersistenceManager validateAdjustmentData:v12 formatIdentifier:v15 formatVersion:v13 error:&v23];
  v22 = v23;

  v9 = v22;
  if (error)
  {
LABEL_13:
    v19 = v9;
    *error = v9;
  }

LABEL_14:
  if (dictionary)
  {
    v20 = v10;
    *dictionary = v10;
  }

  return v18;
}

- (id)_generateDeferredAdjustmentWithImageConversionClient:(id)client videoConversionClient:(id)conversionClient reason:(id)reason retryNumber:(unint64_t)number allowCancellationByService:(BOOL)service clientBundleID:(id)d completion:(id)completion
{
  serviceCopy = service;
  v135[3] = *MEMORY[0x1E69E9840];
  clientCopy = client;
  conversionClientCopy = conversionClient;
  reasonCopy = reason;
  dCopy = d;
  completionCopy = completion;
  deferredProcessingHash = [(PLManagedAsset *)self deferredProcessingHash];
  v14 = MEMORY[0x1E696AEC0];
  uuid = [(PLManagedAsset *)self uuid];
  v92 = [v14 stringWithFormat:@"uuid: %@, initial hash: %tu", uuid, deferredProcessingHash];

  v16 = PLPhotoEditGetLog();
  v17 = os_signpost_id_generate(v16);
  v18 = v16;
  v19 = v18;
  spid = v17;
  if (v17 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v18))
  {
    uuid2 = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    *&buf[4] = uuid2;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v19, OS_SIGNPOST_INTERVAL_BEGIN, v17, "generateDeferredAdjustment", "uuid: %{public}@", buf, 0xCu);
  }

  v82 = v19;

  v21 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    *buf = 138543362;
    *&buf[4] = v92;
    _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_INFO, "[%{public}@] Generating deferred adjustment", buf, 0xCu);
  }

  v127 = 0;
  v128 = 0;
  v22 = [(PLManagedAsset *)self renderableAdjustmentDictionary:&v128 error:&v127];
  v23 = v128;
  v89 = v127;
  v88 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
  v87 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
  v86 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
  if (!v22)
  {
    v26 = v89;
    if (v89)
    {
      v132 = *MEMORY[0x1E696AA08];
      v133 = v89;
      v27 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v133 forKeys:&v132 count:1];
      v26 = v89;
      v28 = v27;
    }

    else
    {
      v28 = 0;
    }

    v29 = v26 == 0;
    v84 = v28;
    v30 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:47016 userInfo:?];
    v31 = PLPhotoEditGetLog();
    v32 = os_log_type_enabled(v31, OS_LOG_TYPE_ERROR);
    if (v29)
    {
      if (v32)
      {
        v70 = @"no";
        *buf = 138544386;
        *&buf[4] = v92;
        if (!v88)
        {
          v70 = @"yes";
        }

        *&buf[12] = 2114;
        *&buf[14] = v70;
        *&buf[22] = 2114;
        v130 = v86;
        *v131 = 2114;
        *&v131[2] = v87;
        *&v131[10] = 2112;
        *&v131[12] = v30;
        v33 = "[%{public}@] Unknown error, missing adjustmentDataBlob: %{public}@, formatIdentifier: %{public}@, formatVersion: %{public}@, for async edit: %@";
        v34 = v31;
        v35 = 52;
        goto LABEL_31;
      }
    }

    else if (v32)
    {
      *buf = 138543618;
      *&buf[4] = v92;
      *&buf[12] = 2112;
      *&buf[14] = v30;
      v33 = "[%{public}@] Unable to use adjustment data for async edit: %@";
      v34 = v31;
      v35 = 22;
LABEL_31:
      _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_ERROR, v33, buf, v35);
    }

    photoLibrary = [(PLManagedObject *)self photoLibrary];
    v96[0] = MEMORY[0x1E69E9820];
    v96[1] = 3221225472;
    v96[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1273;
    v96[3] = &unk_1E75781E8;
    v96[4] = self;
    v93[0] = MEMORY[0x1E69E9820];
    v93[1] = 3221225472;
    v93[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2_1274;
    v93[3] = &unk_1E7577C08;
    v94 = v30;
    v95 = completionCopy;
    v57 = v30;
    [photoLibrary performTransaction:v96 completionHandler:v93];

    v68 = 0;
    goto LABEL_36;
  }

  v24 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF368]];
  v84 = v24;
  if (v24)
  {
    integerValue = [v24 integerValue];
  }

  else
  {
    integerValue = 0;
  }

  dictionary = [MEMORY[0x1E695DF90] dictionary];
  [dictionary setObject:reasonCopy forKeyedSubscript:*MEMORY[0x1E69AE980]];
  if (serviceCopy)
  {
    v37 = 3;
  }

  else
  {
    v37 = 4;
  }

  v38 = [MEMORY[0x1E696AD98] numberWithInteger:v37];
  [dictionary setObject:v38 forKeyedSubscript:*MEMORY[0x1E69AE950]];

  v39 = *MEMORY[0x1E69AE8D0];
  v134[0] = *MEMORY[0x1E69AE8C8];
  v134[1] = v39;
  v135[0] = v88;
  v135[1] = v86;
  v134[2] = *MEMORY[0x1E69AE8D8];
  v135[2] = v87;
  v40 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v135 forKeys:v134 count:3];
  [dictionary setObject:v40 forKeyedSubscript:*MEMORY[0x1E69AE918]];

  v79 = objc_opt_new();
  v41 = objc_opt_new();
  [(PLManagedAsset *)self _setupMediaConversionSourceURLCollection:v79 destinationURLCollection:v41 baseVersion:integerValue];
  v42 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v42, OS_LOG_TYPE_DEBUG))
  {
    urlCount = [v79 urlCount];
    urlCount2 = [v41 urlCount];
    *buf = 138543874;
    *&buf[4] = v92;
    *&buf[12] = 2048;
    *&buf[14] = urlCount;
    *&buf[22] = 2048;
    v130 = urlCount2;
    _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment with number of source URLs: %ld destination URLs: %ld", buf, 0x20u);
  }

  v45 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
  {
    v46 = [v79 resourceURLForRole:*MEMORY[0x1E69AE8B8]];
    *buf = 138543618;
    *&buf[4] = v92;
    *&buf[12] = 2112;
    *&buf[14] = v46;
    _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEBUG, "[%{public}@] Main source URL: %@", buf, 0x16u);
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke;
  aBlock[3] = &unk_1E7576FF8;
  v47 = completionCopy;
  v126 = v47;
  v78 = v41;
  v125 = v78;
  v48 = _Block_copy(aBlock);
  objectID = [(PLManagedAsset *)self objectID];
  photoLibrary2 = [(PLManagedObject *)self photoLibrary];
  pathManager = [photoLibrary2 pathManager];
  capabilities = [pathManager capabilities];

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v130 = __Block_byref_object_copy__14821;
  *v131 = __Block_byref_object_dispose__14822;
  *&v131[8] = [MEMORY[0x1E695DF00] now];
  photoLibrary3 = [(PLManagedObject *)self photoLibrary];
  v54 = [photoLibrary3 shortLivedLibraryCopyByAppendingName:"-[PLManagedAsset _generateDeferredAdjustmentWithImageConversionClient:videoConversionClient:reason:retryNumber:allowCancellationByService:clientBundleID:completion:]"];

  v123[0] = 0;
  v123[1] = v123;
  v123[2] = 0x2020000000;
  [MEMORY[0x1E695DF00] timeIntervalSinceReferenceDate];
  v123[3] = v55;
  v106[0] = MEMORY[0x1E69E9820];
  v106[1] = 3221225472;
  v106[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2;
  v106[3] = &unk_1E75679E8;
  v107 = v19;
  v121 = spid;
  v56 = v54;
  v108 = v56;
  v109 = v92;
  v74 = objectID;
  v110 = v74;
  spida = capabilities;
  v111 = spida;
  v119 = buf;
  v57 = dictionary;
  v112 = v57;
  v120 = v123;
  v113 = dCopy;
  numberCopy = number;
  v58 = clientCopy;
  v114 = v58;
  v59 = conversionClientCopy;
  v115 = v59;
  v116 = reasonCopy;
  v117 = v47;
  v60 = v48;
  v118 = v60;
  v61 = _Block_copy(v106);
  isPhoto = [(PLManagedAsset *)self isPhoto];
  v63 = *MEMORY[0x1E69AE8B8];
  if (isPhoto)
  {
    v64 = [v78 resourceURLForRole:v63];
    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v65 = [v78 resourceURLForRole:*MEMORY[0x1E69AE8C0]];
    }

    else
    {
      v65 = 0;
    }

    [v57 setObject:&unk_1F0FBB308 forKeyedSubscript:*MEMORY[0x1E69AE990]];
    standardPolicy = [MEMORY[0x1E69C06C0] standardPolicy];
    [v57 setObject:standardPolicy forKeyedSubscript:*MEMORY[0x1E69AE968]];

    [v57 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*MEMORY[0x1E69AE920]];
    v101[0] = MEMORY[0x1E69E9820];
    v101[1] = 3221225472;
    v101[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1264;
    v101[3] = &unk_1E7567A10;
    v104 = v61;
    v67 = v64;
    v102 = v67;
    v69 = v65;
    v103 = v69;
    v105 = deferredProcessingHash;
    [v58 convertImageAtSourceURLCollection:v79 toDestinationURLCollection:v78 options:v57 completionHandler:v101];

    v68 = 0;
  }

  else
  {
    v66 = [v78 resourceURLForRole:v63];
    v97[0] = MEMORY[0x1E69E9820];
    v97[1] = 3221225472;
    v97[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2_1266;
    v97[3] = &unk_1E7567A38;
    v99 = v61;
    v67 = v66;
    v98 = v67;
    v100 = deferredProcessingHash;
    v68 = [v59 convertVideoAtSourceURLCollection:v79 toDestinationURLCollection:v78 options:v57 completionHandler:v97];

    v69 = v99;
  }

  _Block_object_dispose(v123, 8);
  _Block_object_dispose(buf, 8);

LABEL_36:

  return v68;
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2(uint64_t a1, int a2, void *a3, void *a4, uint64_t a5, uint64_t a6, void *a7, void *a8)
{
  v168[1] = *MEMORY[0x1E69E9840];
  v13 = a3;
  v14 = a4;
  v88 = a7;
  v90 = a8;
  v15 = *(a1 + 32);
  v16 = v15;
  v17 = *(a1 + 144);
  if (v17 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v15))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v16, OS_SIGNPOST_INTERVAL_END, v17, "generateDeferredAdjustment", "", buf, 2u);
  }

  v144 = 0;
  v145 = &v144;
  v146 = 0x2020000000;
  v147 = 0;
  v140 = 0;
  v141 = &v140;
  v142 = 0x2020000000;
  v143 = 0;
  *buf = 0;
  v135 = buf;
  v136 = 0x3032000000;
  v137 = __Block_byref_object_copy__14821;
  v138 = __Block_byref_object_dispose__14822;
  v139 = 0;
  if (a6 == 1)
  {
    goto LABEL_13;
  }

  if (PAMediaConversionIsCancellationError())
  {
    v145[3] = 1;
    v18 = MEMORY[0x1E696ABC0];
    v167 = *MEMORY[0x1E696AA08];
    v168[0] = v90;
    v19 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v168 forKeys:&v167 count:1];
    v20 = [v18 errorWithDomain:*MEMORY[0x1E69BFF48] code:47002 userInfo:v19];
LABEL_9:
    v23 = *(v135 + 5);
    *(v135 + 5) = v20;
    goto LABEL_11;
  }

  v21 = MEMORY[0x19EAEE3C0](v90);
  v145[3] = 2;
  if (v21)
  {
    v22 = MEMORY[0x1E696ABC0];
    v165 = *MEMORY[0x1E696AA08];
    v166 = v90;
    v19 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v166 forKeys:&v165 count:1];
    v20 = [v22 errorWithDomain:*MEMORY[0x1E69BFF48] code:47021 userInfo:v19];
    goto LABEL_9;
  }

  v19 = [MEMORY[0x1E696AEC0] stringWithFormat:@"media conversion failed with status: %ld", a6];
  v24 = MEMORY[0x1E696ABC0];
  v25 = *MEMORY[0x1E696AA08];
  v163[0] = *MEMORY[0x1E696A278];
  v163[1] = v25;
  v164[0] = v19;
  v164[1] = v90;
  v23 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v164 forKeys:v163 count:2];
  v26 = [v24 errorWithDomain:*MEMORY[0x1E69BFF48] code:47007 userInfo:v23];
  v27 = *(v135 + 5);
  *(v135 + 5) = v26;

LABEL_11:
  if (v145[3])
  {
    v28 = 0;
    goto LABEL_27;
  }

LABEL_13:
  if (a2)
  {
    v29 = v13;
  }

  else
  {
    v29 = v14;
  }

  v30 = v29;
  v31 = objc_alloc(MEMORY[0x1E69C0718]);
  v32 = [*(a1 + 40) libraryBundle];
  v33 = [v32 timeZoneLookup];
  v28 = [v31 initWithMediaURL:v30 options:12 timeZoneLookup:v33 shouldCache:0];

  if (!v28)
  {
    v145[3] = 3;
    v34 = MEMORY[0x1E696AEC0];
    v35 = [v30 path];
    v36 = [v34 stringWithFormat:@"unable to load metadata from file at path: %@", v35];

    v37 = MEMORY[0x1E696ABC0];
    v161 = *MEMORY[0x1E696A278];
    v162 = v36;
    v38 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v162 forKeys:&v161 count:1];
    v39 = [v37 errorWithDomain:*MEMORY[0x1E69BFF48] code:47007 userInfo:v38];
    v40 = *(v135 + 5);
    *(v135 + 5) = v39;
  }

  if (!v145[3] && a2)
  {
    v41 = [v28 contentType];
    if (v41)
    {
      v42 = v41;
      if ([v41 conformsToType:*MEMORY[0x1E6982E58]] & 1) != 0 || (objc_msgSend(v42, "conformsToType:", *MEMORY[0x1E6982E00]))
      {
        v43 = v42;
LABEL_26:

        goto LABEL_27;
      }

      v44 = [v42 conformsToType:*MEMORY[0x1E6982E10]];

      if (v44)
      {
        goto LABEL_27;
      }
    }

    v145[3] = 3;
    v45 = MEMORY[0x1E696AEC0];
    v46 = [v28 contentType];
    v47 = [v46 identifier];
    v43 = [v45 stringWithFormat:@"rendered image type (%@) is not primary format", v47];

    v48 = MEMORY[0x1E696ABC0];
    v159 = *MEMORY[0x1E696A278];
    v160 = v43;
    v42 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v160 forKeys:&v159 count:1];
    v49 = [v48 errorWithDomain:*MEMORY[0x1E69BFF48] code:47007 userInfo:v42];
    v50 = *(v135 + 5);
    *(v135 + 5) = v49;

    goto LABEL_26;
  }

LABEL_27:
  v51 = [*(a1 + 40) managedObjectContext];
  v130 = 0;
  v131 = &v130;
  v132 = 0x2020000000;
  v133 = 0;
  v52 = v145[3];
  if (!v52)
  {
    v53 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
    {
      v54 = *(a1 + 48);
      LODWORD(v156) = 138543362;
      *(&v156 + 4) = v54;
      _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_DEBUG, "[%{public}@] Media conversion success for deferred adjustment", &v156, 0xCu);
    }

    v55 = *(a1 + 40);
    v115[0] = MEMORY[0x1E69E9820];
    v115[1] = 3221225472;
    v115[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1223;
    v115[3] = &unk_1E7567998;
    v116 = v51;
    v56 = *(a1 + 56);
    v124 = &v144;
    v57 = *(a1 + 48);
    v125 = &v130;
    v129 = a5;
    v58 = *(a1 + 40);
    v59 = *(a1 + 64);
    *&v60 = v58;
    *(&v60 + 1) = v59;
    *&v61 = v56;
    *(&v61 + 1) = v57;
    v117 = v61;
    v118 = v60;
    v119 = v13;
    v120 = v14;
    v126 = buf;
    v127 = *(a1 + 128);
    v62 = *(a1 + 72);
    v63 = *(a1 + 136);
    v121 = v62;
    v128 = v63;
    v122 = v90;
    v123 = *(a1 + 80);
    [v55 performBlockAndWait:v115];

    v52 = v145[3];
  }

  *&v156 = 0;
  *(&v156 + 1) = &v156;
  v157 = 0x2020000000;
  v158 = 0;
  if (v52 <= 4)
  {
    if (v52 > 1)
    {
      if ((v52 - 2) >= 2)
      {
        if (v52 != 4)
        {
          goto LABEL_56;
        }

        v64 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v64, OS_LOG_TYPE_DEBUG))
        {
          v65 = *(a1 + 48);
          *v150 = 138543362;
          v151 = v65;
          _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished but asset has been deleted, dropping renders", v150, 0xCu);
        }

        goto LABEL_55;
      }

      goto LABEL_40;
    }

    if (v52)
    {
      if (v52 == 1)
      {
        v72 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
        {
          v73 = *(a1 + 48);
          *v150 = 138543874;
          v151 = v73;
          v152 = 2048;
          v153 = a6;
          v154 = 2112;
          v155 = v90;
          _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_INFO, "[%{public}@] Media conversion cancelled adjustment, status: %ld, error: %@", v150, 0x20u);
        }

        v110[0] = MEMORY[0x1E69E9820];
        v110[1] = 3221225472;
        v110[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1245;
        v110[3] = &unk_1E75778C0;
        v111 = v51;
        v112 = *(a1 + 56);
        v74 = *(a1 + 48);
        v75 = *(a1 + 128);
        v113 = v74;
        v114 = v75;
        [v111 performBlockAndWait:v110];
      }

      goto LABEL_56;
    }

    goto LABEL_53;
  }

  if (v52 > 6)
  {
    if ((v52 - 7) < 2)
    {
LABEL_40:
      v66 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
      {
        v67 = *(a1 + 48);
        v68 = *(v135 + 5);
        *v150 = 138543618;
        v151 = v67;
        v152 = 2112;
        v153 = v68;
        _os_log_impl(&dword_19BF1F000, v66, OS_LOG_TYPE_ERROR, "[%{public}@] Failed to generate deferred adjustment with error: %@", v150, 0x16u);
      }

      v69 = *(a1 + 40);
      v91[0] = MEMORY[0x1E69E9820];
      v91[1] = 3221225472;
      v91[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1250;
      v91[3] = &unk_1E7576B70;
      v92 = v51;
      v93 = *(a1 + 56);
      v70 = *(a1 + 48);
      v71 = *(a1 + 128);
      v94 = v70;
      v95 = v71;
      v96 = a5;
      [v69 performBlockAndWait:v91];

      goto LABEL_56;
    }

    if (v52 != 9)
    {
      goto LABEL_56;
    }

LABEL_53:
    v64 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v64, OS_LOG_TYPE_DEBUG))
    {
      v78 = *(a1 + 48);
      *v150 = 138543362;
      v151 = v78;
      _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment succeeded", v150, 0xCu);
    }

LABEL_55:

    *(v141 + 24) = 1;
    goto LABEL_56;
  }

  if (v52 != 5)
  {
    v64 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v64, OS_LOG_TYPE_DEBUG))
    {
      v76 = *(a1 + 48);
      v77 = v131[3];
      *v150 = 138543618;
      v151 = v76;
      v152 = 2048;
      v153 = v77;
      _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished with stale request (new hash = %tu) but deferred processing state no longer needs adjustment, dropping renders and not restarting", v150, 0x16u);
    }

    goto LABEL_55;
  }

  if (*(a1 + 152) > 2uLL)
  {
    v81 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v81, OS_LOG_TYPE_ERROR))
    {
      v82 = *(a1 + 48);
      *v150 = 138543362;
      v151 = v82;
      _os_log_impl(&dword_19BF1F000, v81, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment reached max stale retry count, bailing out", v150, 0xCu);
    }

    v83 = MEMORY[0x1E696ABC0];
    v148 = *MEMORY[0x1E696A578];
    v149 = @"Generate deferred adjustment reached max stale retry count, bailing out";
    v84 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v149 forKeys:&v148 count:1];
    v85 = [v83 errorWithDomain:*MEMORY[0x1E69BFF48] code:46512 userInfo:v84];
    v86 = *(v135 + 5);
    *(v135 + 5) = v85;
  }

  else
  {
    v97[0] = MEMORY[0x1E69E9820];
    v97[1] = 3221225472;
    v97[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1246;
    v97[3] = &unk_1E75679C0;
    v98 = v51;
    v99 = *(a1 + 56);
    v106 = &v156;
    v100 = *(a1 + 48);
    v107 = &v130;
    v101 = *(a1 + 88);
    v102 = *(a1 + 96);
    v79 = *(a1 + 104);
    v80 = *(a1 + 152);
    v103 = v79;
    v109 = v80;
    v104 = *(a1 + 80);
    v105 = *(a1 + 112);
    v108 = &v140;
    [v98 performBlockAndWait:v97];
  }

LABEL_56:
  if ((*(*(&v156 + 1) + 24) & 1) == 0)
  {
    (*(*(a1 + 120) + 16))();
  }

  _Block_object_dispose(&v156, 8);
  _Block_object_dispose(&v130, 8);

  _Block_object_dispose(buf, 8);
  _Block_object_dispose(&v140, 8);
  _Block_object_dispose(&v144, 8);
}

uint64_t __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1273(uint64_t a1)
{
  if ([*(a1 + 32) deferredProcessingNeeded] == 2 || (result = objc_msgSend(*(a1 + 32), "deferredProcessingNeeded"), result == 9))
  {
    v3 = *(a1 + 32);

    return [v3 setDeferredProcessingNeeded:0];
  }

  return result;
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1223(uint64_t a1)
{
  v65 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v58 = 0;
  v4 = [v2 existingObjectWithID:v3 error:&v58];
  v5 = v58;
  if (!*(*(*(a1 + 112) + 8) + 24))
  {
    if (v4)
    {
      if (![v4 isDeleted])
      {
        goto LABEL_9;
      }
    }

    else
    {
      v6 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        v8 = *(a1 + 40);
        v7 = *(a1 + 48);
        *buf = 138543874;
        v60 = v7;
        v61 = 2112;
        v62 = v8;
        v63 = 2112;
        v64 = v5;
        _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "[%{public}@] Asset with object ID %@ not found: %@", buf, 0x20u);
      }
    }

    *(*(*(a1 + 112) + 8) + 24) = 4;
  }

LABEL_9:
  if (!*(*(*(a1 + 112) + 8) + 24))
  {
    v9 = [v4 additionalAttributes];
    [v9 setDeferredProcessingCandidateOptions:0];

    if (!*(*(*(a1 + 112) + 8) + 24))
    {
      *(*(*(a1 + 120) + 8) + 24) = [v4 deferredProcessingHash];
      if (*(a1 + 152) != *(*(*(a1 + 120) + 8) + 24))
      {
        v10 = [v4 deferredProcessingNeeded];
        v11 = 5;
        if (v10 != 2)
        {
          v11 = 6;
        }

        *(*(*(a1 + 112) + 8) + 24) = v11;
      }
    }
  }

  if (*(*(*(a1 + 112) + 8) + 24) || ![v4 isVideo])
  {
    v16 = 0;
  }

  else
  {
    v12 = [v4 persistedResourcesMatching:&__block_literal_global_1226];
    v13 = [v12 anyObject];

    if (v13)
    {
      v14 = [*(a1 + 56) pathManager];
      v15 = [MEMORY[0x1E69BF178] defaultFileExtensionForAssetType:0];
      v16 = [v14 temporaryRenderContentURLForInternalRendersWithExtension:v15];

      v17 = MEMORY[0x1E695DFF8];
      v18 = [v4 pathForTransientVideoPosterFramePreview];
      v19 = [v17 fileURLWithPath:v18];

      v20 = *(a1 + 64);
      v57 = 0;
      v21 = [MEMORY[0x1E69BF238] ingestItemAtURL:v19 toURL:v16 type:3 options:6 capabilities:v20 error:&v57];
      v22 = v57;
      if ((v21 & 1) == 0)
      {
        v23 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
        {
          v24 = *(a1 + 48);
          *buf = 138543874;
          v60 = v24;
          v61 = 2112;
          v62 = v19;
          v63 = 2112;
          v64 = v22;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_ERROR, "[%{public}@] Nonfatal - failed to ingest video poster to temporary URL from existing URL: %@, error: %@", buf, 0x20u);
        }

        v16 = 0;
      }
    }

    else
    {
      v16 = 0;
    }
  }

  v25 = *(a1 + 112);
  if (!*(*(v25 + 8) + 24))
  {
    v26 = *(a1 + 72);
    v27 = *(a1 + 80);
    v28 = *(*(a1 + 128) + 8);
    obj = *(v28 + 40);
    v29 = [v4 updateDeferredAdjustmentWithFullSizeRenderImageURL:v26 videoURL:v27 videoPosterURL:v16 error:&obj];
    objc_storeStrong((v28 + 40), obj);
    v25 = *(a1 + 112);
    if ((v29 & 1) == 0)
    {
      *(*(v25 + 8) + 24) = 7;
      v25 = *(a1 + 112);
    }
  }

  if (*(*(v25 + 8) + 24))
  {
    goto LABEL_28;
  }

  if ([v4 isPhoto])
  {
    v31 = &__block_literal_global_1229;
  }

  else
  {
    if (![v4 isVideo])
    {
LABEL_28:
      v30 = 0;
      goto LABEL_34;
    }

    v31 = &__block_literal_global_1232;
  }

  v32 = [v4 persistedResourcesMatching:v31];
  v30 = [v32 anyObject];

LABEL_34:
  if ([*(a1 + 32) hasChanges])
  {
    v33 = *(a1 + 32);
    if (*(*(*(a1 + 112) + 8) + 24))
    {
      [v33 rollback];
    }

    else
    {
      v34 = *(*(a1 + 128) + 8);
      v55 = *(v34 + 40);
      v35 = [v33 save:&v55];
      objc_storeStrong((v34 + 40), v55);
      if ((v35 & 1) == 0)
      {
        v36 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          v37 = *(a1 + 48);
          v38 = *(*(*(a1 + 128) + 8) + 40);
          *buf = 138543618;
          v60 = v37;
          v61 = 2112;
          v62 = v38;
          _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment save failed %@", buf, 0x16u);
        }

        *(*(*(a1 + 112) + 8) + 24) = 8;
      }
    }
  }

  v39 = *(*(a1 + 112) + 8);
  v40 = *(v39 + 24);
  if (!v40)
  {
    *(v39 + 24) = 9;
    v40 = *(*(*(a1 + 112) + 8) + 24);
  }

  if (v40 == 9)
  {
    v41 = 1;
  }

  else
  {
    v41 = 3;
  }

  PLSendDeferredProcessingAnalytics(v4, v30, *(*(*(a1 + 136) + 8) + 40), v41);
  v42 = [*(a1 + 88) objectForKeyedSubscript:*MEMORY[0x1E69AE950]];
  [v42 integerValue];
  IsBackground = PAMediaConversionJobPriorityIsBackground();

  if (IsBackground)
  {
    v44 = @"BG";
  }

  else
  {
    v44 = @"IN";
  }

  v45 = @"Tail";
  if (!IsBackground)
  {
    v45 = @"Head";
  }

  v46 = MEMORY[0x1E695DF00];
  v47 = v45;
  v48 = v44;
  [v46 timeIntervalSinceReferenceDate];
  v50 = v49 - *(*(*(a1 + 144) + 8) + 24);
  [MEMORY[0x1E695DF00] timeIntervalSinceReferenceDate];
  v52 = v51;
  v53 = [v4 addedDate];
  [v53 timeIntervalSinceReferenceDate];
  PLBuildAndSendFinalizationAnalytics(v4, *(a1 + 96), 1, v48, v47, *(a1 + 104), v50, v52 - v54);
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1245(void *a1)
{
  v16 = *MEMORY[0x1E69E9840];
  v2 = a1[4];
  v3 = a1[5];
  v9 = 0;
  v4 = [v2 existingObjectWithID:v3 error:&v9];
  v5 = v9;
  if (v4)
  {
    PLSendDeferredProcessingAnalytics(v4, 0, *(*(a1[7] + 8) + 40), 2);
  }

  else
  {
    v6 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = a1[5];
      v7 = a1[6];
      *buf = 138543874;
      v11 = v7;
      v12 = 2112;
      v13 = v8;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "[%{public}@] Asset with object ID %@ not found: %@", buf, 0x20u);
    }
  }
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1246(uint64_t a1)
{
  v15 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) existingObjectWithID:*(a1 + 40) error:0];
  v3 = v2;
  if (v2 && ([v2 isDeleted] & 1) == 0)
  {
    *(*(*(a1 + 96) + 8) + 24) = 1;
    v7 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = *(a1 + 48);
      v9 = *(*(*(a1 + 104) + 8) + 24);
      *buf = 138543618;
      v12 = v8;
      v13 = 2048;
      v14 = v9;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished but edit is stale with new hash: %tu, restarting", buf, 0x16u);
    }

    v10 = [v3 _generateDeferredAdjustmentWithImageConversionClient:*(a1 + 56) videoConversionClient:*(a1 + 64) reason:*(a1 + 72) retryNumber:*(a1 + 120) + 1 allowCancellationByService:0 clientBundleID:*(a1 + 80) completion:*(a1 + 88)];
  }

  else
  {
    v4 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEBUG))
    {
      v5 = *(a1 + 48);
      v6 = *(*(*(a1 + 104) + 8) + 24);
      *buf = 138543618;
      v12 = v5;
      v13 = 2048;
      v14 = v6;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished with stale request (new hash = %tu) but asset was deleted, dropping renders and not restarting", buf, 0x16u);
    }

    *(*(*(a1 + 112) + 8) + 24) = 1;
  }
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1250(uint64_t a1)
{
  v36 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v29 = 0;
  v4 = [v2 existingObjectWithID:v3 error:&v29];
  v5 = v29;
  if (v4)
  {
    v6 = [v4 isDeleted];
    v7 = [v4 deferredProcessingHash];
    if ((v6 & 1) == 0)
    {
      v8 = 1;
      if (*(a1 + 64) != v7)
      {
LABEL_15:
        v16 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v17 = *(a1 + 48);
          if (v6)
          {
            v18 = 0;
            v19 = @"asset deleted";
          }

          else if (v8)
          {
            v18 = 0;
            v19 = @"stale";
          }

          else
          {
            v20 = MEMORY[0x1E696AEC0];
            v21 = [v4 deferredProcessingNeeded];
            v22 = v21 > 0xA ? 0 : off_1E7567B18[v21];
            v6 = v22;
            v19 = [v20 stringWithFormat:@"cannot overwrite deferred processing state: %@", v6];
            v18 = 1;
          }

          *buf = 138543618;
          v31 = v17;
          v32 = 2114;
          v33 = v19;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment failed, skipping repair for reason: %{public}@", buf, 0x16u);
          if (v18)
          {
          }
        }

LABEL_27:
        if ([*(a1 + 32) hasChanges])
        {
          v23 = *(a1 + 32);
          v28 = 0;
          v24 = [v23 save:&v28];
          v25 = v28;
          if ((v24 & 1) == 0)
          {
            v26 = PLPhotoEditGetLog();
            if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
            {
              v27 = *(a1 + 48);
              *buf = 138543618;
              v31 = v27;
              v32 = 2112;
              v33 = v25;
              _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment save failed %@", buf, 0x16u);
            }
          }
        }

        PLSendDeferredProcessingAnalytics(v4, 0, *(*(*(a1 + 56) + 8) + 40), 3);
        goto LABEL_34;
      }

      v12 = [v4 deferredProcessingNeeded];
      if (v12 <= 9 && ((1 << v12) & 0x315) != 0)
      {
        v14 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
        {
          v15 = *(a1 + 48);
          *buf = 138543362;
          v31 = v15;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment failed, marking asset for repair adjustment failure", buf, 0xCu);
        }

        [v4 setDeferredProcessingNeeded:9];
        goto LABEL_27;
      }
    }

    v8 = 0;
    goto LABEL_15;
  }

  v9 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
  {
    v11 = *(a1 + 40);
    v10 = *(a1 + 48);
    *buf = 138543874;
    v31 = v10;
    v32 = 2112;
    v33 = v11;
    v34 = 2112;
    v35 = v5;
    _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment failed, skipping repair, asset with object ID %@ not found: %@", buf, 0x20u);
  }

LABEL_34:
}

- (void)_setupMediaConversionSourceURLCollection:(id)collection destinationURLCollection:(id)lCollection baseVersion:(int64_t)version
{
  collectionCopy = collection;
  lCollectionCopy = lCollection;
  v9 = [(PLManagedAsset *)self _sourceURLForAsyncEditWithBaseVersion:version];
  v10 = *MEMORY[0x1E69AE8B8];
  [collectionCopy setResourceURL:v9 forRole:*MEMORY[0x1E69AE8B8]];
  if ([(PLManagedAsset *)self isPhoto])
  {
    fileTypeForFullsizeRenderImage = [(PLManagedAsset *)self fileTypeForFullsizeRenderImage];
    v12 = MEMORY[0x1E69C08F0];
    v13 = [MEMORY[0x1E6982C40] typeWithIdentifier:fileTypeForFullsizeRenderImage];
    v14 = [v12 preferredOrFallbackFilenameExtensionForType:v13];

    pathManager = [(PLManagedObject *)self pathManager];
    v16 = [pathManager temporaryRenderContentURLForInternalRendersWithExtension:v14];

    [lCollectionCopy setResourceURL:v16 forRole:v10 deleteOnDeallocation:1];
    if ([(PLManagedAsset *)self _shouldSetupVideoComplementForAsyncEditWithBaseVersion:version])
    {
      v29 = lCollectionCopy;
      if (version)
      {
        [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
      }

      else
      {
        [(PLManagedAsset *)self pathForVideoComplementFile];
      }
      v28 = ;
      v19 = [MEMORY[0x1E695DFF8] fileURLWithPath:v28 isDirectory:0];
      v20 = *MEMORY[0x1E69AE8C0];
      [collectionCopy setResourceURL:v19 forRole:*MEMORY[0x1E69AE8C0]];
      pathManager2 = [(PLManagedObject *)self pathManager];
      v22 = [MEMORY[0x1E69BF178] defaultFileExtensionForAssetType:1];
      v23 = [pathManager2 temporaryRenderContentURLForInternalRendersWithExtension:v22];

      lCollectionCopy = v29;
      [v29 setResourceURL:v23 forRole:v20 deleteOnDeallocation:1];
    }

    goto LABEL_10;
  }

  if ([(PLManagedAsset *)self isVideo])
  {
    pathManager3 = [(PLManagedObject *)self pathManager];
    v18 = [MEMORY[0x1E69BF178] defaultFileExtensionForAssetType:1];
    fileTypeForFullsizeRenderImage = [pathManager3 temporaryRenderContentURLForInternalRendersWithExtension:v18];

    [lCollectionCopy setResourceURL:fileTypeForFullsizeRenderImage forRole:v10 deleteOnDeallocation:1];
LABEL_10:
  }

  pathForAdjustmentSecondaryDataFile = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
  if (pathForAdjustmentSecondaryDataFile)
  {
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    v26 = [defaultManager fileExistsAtPath:pathForAdjustmentSecondaryDataFile];

    if (v26)
    {
      v27 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForAdjustmentSecondaryDataFile];
      [collectionCopy setResourceURL:v27 forRole:*MEMORY[0x1E69AE8B0]];
    }
  }
}

- (unint64_t)deferredProcessingHash
{
  adjustmentTimestamp = [(PLManagedAsset *)self adjustmentTimestamp];
  v4 = [adjustmentTimestamp hash];
  v5 = [MEMORY[0x1E696AD98] numberWithUnsignedShort:{-[PLManagedAsset deferredProcessingNeeded](self, "deferredProcessingNeeded")}];
  v6 = [v5 hash];

  return v6 ^ v4;
}

- (BOOL)_shouldSetupVideoComplementForAsyncEditWithBaseVersion:(int64_t)version
{
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  canPlayPhotoIris = isPhotoIris;
  if (version && isPhotoIris)
  {
    canPlayPhotoIris = [(PLManagedAsset *)self canPlayPhotoIris];
  }

  if (version == 1 && canPlayPhotoIris)
  {
    modernResources = [(PLManagedAsset *)self modernResources];
    v8 = [modernResources objectsPassingTest:&__block_literal_global_1207];
    LOBYTE(canPlayPhotoIris) = [v8 count] != 0;
  }

  return canPlayPhotoIris;
}

BOOL __73__PLManagedAsset__shouldSetupVideoComplementForAsyncEditWithBaseVersion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 version] == 1 && objc_msgSend(v2, "resourceType") == 3;

  return v3;
}

- (id)_sourceURLForAsyncEditWithBaseVersion:(int64_t)version
{
  if (!version)
  {
    if ([(PLManagedAsset *)self isRAWPlusJPEGWithRAWOnTop])
    {
      [(PLManagedAsset *)self urlForSideCarImageFile];
    }

    else
    {
      [(PLManagedAsset *)self mainFileURL];
    }
    v7 = ;
    goto LABEL_12;
  }

  if ([(PLManagedAsset *)self isPhoto])
  {
    v4 = MEMORY[0x1E695DFF8];
    pathForPenultimateFullsizeRenderImageFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
LABEL_8:
    v6 = pathForPenultimateFullsizeRenderImageFile;
    v7 = [v4 fileURLWithPath:pathForPenultimateFullsizeRenderImageFile isDirectory:0];

    goto LABEL_12;
  }

  if ([(PLManagedAsset *)self isVideo])
  {
    v4 = MEMORY[0x1E695DFF8];
    pathForPenultimateFullsizeRenderImageFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    goto LABEL_8;
  }

  v7 = 0;
LABEL_12:

  return v7;
}

- (void)synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:(id)path withCompletionHandler:(id)handler
{
  pathCopy = path;
  handlerCopy = handler;
  v9 = objc_autoreleasePoolPush();
  if ((PLIsAssetsd() & 1) == 0)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:10773 description:@"synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath is only safe from inside of assetsd!"];
  }

  v10 = objc_alloc_init(MEMORY[0x1E696AC08]);
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  pathForSubstandardFullsizeRenderImageFile = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
  if (!pathCopy)
  {
    pathCopy = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  }

  if (([v10 fileExistsAtPath:pathCopy] & 1) == 0 && objc_msgSend(v10, "fileExistsAtPath:", pathForOriginalFile) && objc_msgSend(v10, "fileExistsAtPath:", pathForSubstandardFullsizeRenderImageFile))
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke;
    v15[3] = &unk_1E7567970;
    v15[4] = self;
    v16 = pathForOriginalFile;
    v17 = pathCopy;
    v18 = v10;
    v19 = pathForSubstandardFullsizeRenderImageFile;
    v20 = handlerCopy;
    [(PLManagedAsset *)self synchronouslyFetchAdjustmentBlobWithCompletionHandler:v15];
  }

  else
  {
    v13 = [PLResourceInstaller onDemand_installAdjustedFullSizeRenderResourceAtFilePath:pathCopy forAsset:self];
    if (handlerCopy)
    {
      (*(handlerCopy + 2))(handlerCopy, pathCopy);
    }
  }

  objc_autoreleasePoolPop(v9);
}

void __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke(uint64_t a1, void *a2, uint64_t a3, void *a4, void *a5, uint64_t a6, uint64_t a7, void *a8, void *a9)
{
  v13 = a2;
  v14 = a4;
  v15 = a5;
  v16 = a8;
  v17 = a9;
  v18 = [v14 isEqualToString:@"com.apple.mobileiphoto"];
  if (v18)
  {
    LOBYTE(v18) = [v15 isEqualToString:@"2"];
  }

  if (!v13 || (v18 & 1) != 0)
  {
    [*(a1 + 56) copyItemAtPath:*(a1 + 64) toPath:*(a1 + 48) error:0];
    v27 = *(a1 + 72);
    if (v27)
    {
      (*(v27 + 16))(v27, *(a1 + 48));
    }
  }

  else
  {
    v28 = v17;
    v29 = v16;
    timeout = dispatch_time(0, 60000000000);
    v31 = [*(a1 + 32) originalOrientation];
    v44 = 0;
    v45 = &v44;
    v46 = 0x2020000000;
    v47 = 0;
    v39 = 0;
    v40 = &v39;
    v41 = 0x3010000000;
    v42 = &unk_19C721442;
    v19 = MEMORY[0x1E695F060];
    v43 = *MEMORY[0x1E695F060];
    v20 = dispatch_group_create();
    dispatch_group_enter(v20);
    v22 = *(a1 + 32);
    v21 = *(a1 + 40);
    v32[0] = MEMORY[0x1E69E9820];
    v32[1] = 3221225472;
    v32[2] = __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke_2;
    v32[3] = &unk_1E7567948;
    v37 = &v44;
    v38 = &v39;
    v23 = *(a1 + 48);
    v33 = *(a1 + 56);
    v34 = *(a1 + 64);
    v35 = *(a1 + 48);
    v24 = v20;
    v36 = v24;
    [v22 _asyncGenerateRenderImageFileWithSize:v14 formatIdentifier:v15 formatVersion:v13 adjustmentDataBlob:v21 originalImageFilePath:v31 originalImageEXIFOrientation:v23 renderedImageFilePath:*v19 completionHandler:{v19[1], v32}];
    dispatch_group_wait(v24, timeout);
    if (*(v45 + 24) == 1)
    {
      [*(a1 + 32) setWidth:v40[4]];
      [*(a1 + 32) setHeight:v40[5]];
      v25 = [PLResourceInstaller onDemand_installAdjustedFullSizeRenderResourceAtFilePath:*(a1 + 48) forAsset:*(a1 + 32)];
    }

    v26 = *(a1 + 72);
    if (v26)
    {
      (*(v26 + 16))(v26, *(a1 + 48));
    }

    _Block_object_dispose(&v39, 8);
    _Block_object_dispose(&v44, 8);
    v17 = v28;
    v16 = v29;
  }
}

void __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2, double a3, double a4)
{
  if (a2)
  {
    *(*(*(a1 + 64) + 8) + 24) = 1;
    v5 = *(*(a1 + 72) + 8);
    *(v5 + 32) = a3;
    *(v5 + 40) = a4;
  }

  else
  {
    [*(a1 + 32) copyItemAtPath:*(a1 + 40) toPath:*(a1 + 48) error:0];
  }

  v6 = *(a1 + 56);

  dispatch_group_leave(v6);
}

- (void)_asyncGenerateRenderImageFileWithSize:(CGSize)size formatIdentifier:(id)identifier formatVersion:(id)version adjustmentDataBlob:(id)blob originalImageFilePath:(id)path originalImageEXIFOrientation:(int64_t)orientation renderedImageFilePath:(id)filePath completionHandler:(id)self0
{
  v49 = *MEMORY[0x1E69E9840];
  pathCopy = path;
  filePathCopy = filePath;
  handlerCopy = handler;
  blobCopy = blob;
  versionCopy = version;
  identifierCopy = identifier;
  if ((PLIsAssetsd() & 1) == 0)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:10742 description:@"_asyncGenerateRenderImageFileWithSize is only safe from inside of assetsd!"];
  }

  v20 = objc_alloc_init(PLPhotoEditPersistenceManager);
  [(PLManagedAsset *)self photoIrisVideoDuration];
  v21 = [PLPhotoEditImportProperties importPropertiesWithEXIFOrientation:orientation duration:CMTimeGetSeconds(&time)];
  v22 = MEMORY[0x1E696AEC0];
  v23 = objc_opt_class();
  uuid = [(PLManagedAsset *)self uuid];
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  v26 = [v22 stringWithFormat:@"<%@:%p uuid=%@, path=%@>", v23, self, uuid, pathForOriginalFile];

  v47 = 0;
  v27 = [(PLPhotoEditPersistenceManager *)v20 loadPhotoEditData:blobCopy formatIdentifier:identifierCopy formatVersion:versionCopy importProperties:v21 error:&v47];

  v28 = v47;
  if (v27)
  {
    v29 = pathCopy;
    v30 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathCopy isDirectory:0];
    v31 = [[PLPhotoEditSource alloc] initWithURL:v30 type:0 image:0 useEmbeddedPreview:0];
    v39 = v28;
    v32 = v21;
    v33 = v20;
    v34 = [[PLPhotoEditRenderer alloc] initWithEditSource:v31];
    [(PLPhotoEditRenderer *)v34 setCompositionController:v27];
    v43[0] = MEMORY[0x1E69E9820];
    v43[1] = 3221225472;
    v43[2] = __197__PLManagedAsset__asyncGenerateRenderImageFileWithSize_formatIdentifier_formatVersion_adjustmentDataBlob_originalImageFilePath_originalImageEXIFOrientation_renderedImageFilePath_completionHandler___block_invoke;
    v43[3] = &unk_1E7567920;
    v35 = filePathCopy;
    v44 = filePathCopy;
    v45 = v26;
    v36 = handlerCopy;
    v46 = handlerCopy;
    [(PLPhotoEditRenderer *)v34 generateJPEGImageDataWithCompressionQuality:0 livePhotoPairingIdentifier:v43 completionHandler:0.899999976];

    v20 = v33;
    v21 = v32;
    v28 = v39;
  }

  else
  {
    v37 = PLBackendGetLog();
    v35 = filePathCopy;
    v29 = pathCopy;
    if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
    {
      LODWORD(time.value) = 138412546;
      *(&time.value + 4) = v26;
      LOWORD(time.flags) = 2112;
      *(&time.flags + 2) = v28;
      _os_log_impl(&dword_19BF1F000, v37, OS_LOG_TYPE_ERROR, "Could not upgrade substandard render for %@ ([PLPhotoEditPersistenceManager loadPhotoEditData:] failed. Error: %@)", &time, 0x16u);
    }

    v36 = handlerCopy;
    (*(handlerCopy + 2))(handlerCopy, 0, *MEMORY[0x1E695F060], *(MEMORY[0x1E695F060] + 8));
  }
}

uint64_t __197__PLManagedAsset__asyncGenerateRenderImageFileWithSize_formatIdentifier_formatVersion_adjustmentDataBlob_originalImageFilePath_originalImageEXIFOrientation_renderedImageFilePath_completionHandler___block_invoke(void *a1, void *a2, double a3, double a4, double a5, double a6)
{
  v28 = *MEMORY[0x1E69E9840];
  v9 = [a2 writeToFile:a1[4] options:1073741825 error:0];
  v10 = PLBackendGetLog();
  v11 = v10;
  if (v9)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v12 = a1[5];
      v20 = 138412802;
      v21 = v12;
      v22 = 1024;
      v23 = a5;
      v24 = 1024;
      v25 = a6;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEBUG, "Upgraded substandard render for %@ to %dx%d", &v20, 0x18u);
    }

    v13.n128_f64[0] = a5;
    v14.n128_f64[0] = a6;
    return (*(a1[6] + 16))(v13, v14);
  }

  else
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v17 = a1[4];
      v16 = a1[5];
      v20 = 138413058;
      v21 = v16;
      v22 = 1024;
      v23 = a5;
      v24 = 1024;
      v25 = a6;
      v26 = 2112;
      v27 = v17;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "Could not upgrade substandard render for %@ to %dx%d, failed saving to %@", &v20, 0x22u);
    }

    v18.n128_u64[0] = *MEMORY[0x1E695F060];
    v19.n128_u64[0] = *(MEMORY[0x1E695F060] + 8);
    return (*(a1[6] + 16))(v18, v19);
  }
}

- (void)generateLargeThumbnailFileIfNecessary
{
  v13[1] = *MEMORY[0x1E69E9840];
  v3 = objc_autoreleasePoolPush();
  v4 = objc_alloc(MEMORY[0x1E695DEF0]);
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  v6 = [v4 initWithContentsOfFile:pathForOriginalFile options:8 error:0];

  if ([(__CFData *)v6 length])
  {
    uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
    if (uniformTypeIdentifier)
    {
      v12 = *MEMORY[0x1E696E118];
      uniformTypeIdentifier2 = [(PLManagedAsset *)self uniformTypeIdentifier];
      v13[0] = uniformTypeIdentifier2;
      v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v13 forKeys:&v12 count:1];
    }

    else
    {
      v9 = 0;
    }

    v10 = CGImageSourceCreateWithData(v6, v9);
    LOBYTE(v11) = 0;
    [(PLManagedAsset *)self generateThumbnailsWithImageSource:v10 imageData:v6 metadata:0 allowMediumPreview:0 forceSRGBConversion:0 forFinalCameraImage:0 outSmallThumbnailData:0 isPreviewSource:v11];
    if (v10)
    {
      CFRelease(v10);
    }
  }

  objc_autoreleasePoolPop(v3);
}

- (NSString)pathForLargeDisplayableImageFile
{
  v5 = 0;
  v2 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:self format:0 allowMetadataSnapshot:0 forceLarge:0 outFilePath:&v5 outImageType:0];
  v3 = v5;

  return v3;
}

- (NSString)pathForVideoFile
{
  if ([(PLManagedAsset *)self isVideo])
  {
    pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
    v4 = objc_opt_new();
    v5 = [v4 fileExistsAtPath:pathForFullsizeRenderVideoFile isDirectory:0];

    if ((v5 & 1) == 0)
    {
      if ([(PLManagedAsset *)self hasNonSlomoAdjustments])
      {
        pathForOriginalFile = 0;
      }

      else
      {
        pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
      }

      pathForFullsizeRenderVideoFile = pathForOriginalFile;
    }
  }

  else
  {
    pathForFullsizeRenderVideoFile = 0;
  }

  return pathForFullsizeRenderVideoFile;
}

- (NSString)pathForVideoPreviewFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedLargeThumbnailFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedLargeThumbnailFile];
  }
  v3 = ;

  return v3;
}

- (NSString)pathForTrimmedVideoFile
{
  pathForVideoFile = [(PLManagedAsset *)self pathForVideoFile];
  v3 = pathForVideoFile;
  if (pathForVideoFile)
  {
    stringByDeletingPathExtension = [pathForVideoFile stringByDeletingPathExtension];
    v5 = [stringByDeletingPathExtension stringByAppendingPathExtension:@"TRIM.MOV"];
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)fileURLForFullsizeRenderImage
{
  v2 = MEMORY[0x1E695DFF8];
  pathForFullsizeRenderImageFile = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  v4 = [v2 fileURLWithPath:pathForFullsizeRenderImageFile isDirectory:0];

  return v4;
}

- (id)fileURLForMetadataWithExtension:(id)extension
{
  extensionCopy = extension;
  directory = [(PLManagedAsset *)self directory];
  if (directory)
  {
    pathManager = [(PLManagedObject *)self pathManager];
    filename = [(PLManagedAsset *)self filename];
    v8 = [pathManager URLForMetadataWithExtension:extensionCopy forMediaInMainDirectory:directory withFilename:filename];
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (id)pathForMetadataWithExtension:(id)extension
{
  v3 = [(PLManagedAsset *)self fileURLForMetadataWithExtension:extension];
  path = [v3 path];

  return path;
}

- (NSString)pathForMetadataDirectory
{
  directory = [(PLManagedAsset *)self directory];
  if (directory)
  {
    shouldUseUBFPathManager = [(PLManagedAsset *)self shouldUseUBFPathManager];
    v5 = MEMORY[0x1E695DFF8];
    pathManager = [(PLManagedObject *)self pathManager];
    v7 = pathManager;
    if (shouldUseUBFPathManager)
    {
      v8 = [pathManager photoDirectoryWithType:10];
      v9 = [v8 stringByAppendingPathComponent:directory];
      v10 = [v5 fileURLWithPath:v9 isDirectory:1];
    }

    else
    {
      v8 = [pathManager photoMetadataDirectoryForMediaInMainDirectory:directory];
      v10 = [v5 fileURLWithPath:v8 isDirectory:1];
    }
  }

  else
  {
    v10 = 0;
  }

  path = [v10 path];

  return path;
}

- (NSString)fileExtension
{
  filename = [(PLManagedAsset *)self filename];
  pathExtension = [filename pathExtension];

  return pathExtension;
}

- (NSArray)allUniformTypeIdentifiers
{
  v3 = MEMORY[0x1E695DF70];
  sidecars = [(PLManagedAsset *)self sidecars];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(sidecars, "count") + 1}];

  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  if (uniformTypeIdentifier)
  {
    uniformTypeIdentifier2 = [(PLManagedAsset *)self uniformTypeIdentifier];
    [v5 addObject:uniformTypeIdentifier2];
  }

  else
  {
    [v5 addObject:&stru_1F0F06D80];
  }

  sidecars2 = [(PLManagedAsset *)self sidecars];
  v9 = [sidecars2 count];

  if (v9)
  {
    sortedSidecarFiles = [(PLManagedAsset *)self sortedSidecarFiles];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __43__PLManagedAsset_allUniformTypeIdentifiers__block_invoke;
    v12[3] = &unk_1E7577F08;
    v13 = v5;
    [sortedSidecarFiles enumerateObjectsUsingBlock:v12];
  }

  return v5;
}

void __43__PLManagedAsset_allUniformTypeIdentifiers__block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uniformTypeIdentifier];
  v5 = v3;
  if (v3)
  {
    v4 = v3;
  }

  else
  {
    v4 = &stru_1F0F06D80;
  }

  [*(a1 + 32) addObject:v4];
}

- (id)allFileExtensions
{
  v3 = MEMORY[0x1E695DF70];
  sidecars = [(PLManagedAsset *)self sidecars];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(sidecars, "count") + 1}];

  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  pathExtension = [pathForOriginalFile pathExtension];

  if ([pathExtension length])
  {
    [v5 addObject:pathExtension];
  }

  sidecars2 = [(PLManagedAsset *)self sidecars];
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __35__PLManagedAsset_allFileExtensions__block_invoke;
  v11[3] = &unk_1E75678F8;
  v9 = v5;
  v12 = v9;
  [sidecars2 enumerateObjectsUsingBlock:v11];

  return v9;
}

void __35__PLManagedAsset_allFileExtensions__block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 filename];
  v4 = [v3 pathExtension];

  [*(a1 + 32) addObject:v4];
}

- (void)getFileURL:(id *)l originalFilename:(id *)filename uti:(id *)uti fileSize:(unint64_t *)size forSidecarMatchingUTI:(id)i requireExactMatch:(BOOL)match
{
  v16 = [MEMORY[0x1E69C08F0] typeWithIdentifier:i];
  v13 = [PLManagedAsset sidecarFileMatchingContentType:"sidecarFileMatchingContentType:requireExactMatch:requireSort:" requireExactMatch:? requireSort:?];
  v14 = v13;
  if (l)
  {
    *l = [v13 fileURL];
  }

  if (size)
  {
    compressedSize = [v14 compressedSize];
    *size = [compressedSize unsignedLongLongValue];
  }

  if (filename)
  {
    *filename = [v14 originalFilename];
  }

  if (uti)
  {
    *uti = [v14 uniformTypeIdentifier];
  }
}

- (NSString)pathForOriginalFile
{
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  path = [mainFileURL path];

  return path;
}

- (NSURL)persistedFileSystemAttributesFileURL
{
  if ([(PLManagedAsset *)self hasDeferredProcessingPreviewFile]&& ![(PLManagedAsset *)self hasOriginalFile])
  {
    fileURLForCurrentDeferredProcessingPreviewFile = [(PLManagedAsset *)self fileURLForCurrentDeferredProcessingPreviewFile];
  }

  else
  {
    fileURLForCurrentDeferredProcessingPreviewFile = [(PLManagedAsset *)self mainFileURL];
  }

  return fileURLForCurrentDeferredProcessingPreviewFile;
}

- (NSURL)mainFileURL
{
  if (!-[PLManagedAsset isReferencedAsset](self, "isReferencedAsset") || (-[PLManagedAsset masterResourceForCPLType:](self, "masterResourceForCPLType:", 1), v3 = objc_claimAutoreleasedReturnValue(), [v3 fileSystemBookmark], v4 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v4, "fileSystemURL"), directory = objc_claimAutoreleasedReturnValue(), v4, v3, !directory))
  {
    directory = [(PLManagedAsset *)self directory];

    if (directory)
    {
      v6 = MEMORY[0x1E695DFF8];
      pathManager = [(PLManagedObject *)self pathManager];
      directory2 = [(PLManagedAsset *)self directory];
      filename = [(PLManagedAsset *)self filename];
      v10 = [pathManager assetMainFilePathWithDirectory:directory2 filename:filename bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
      directory = [v6 fileURLWithPath:v10 isDirectory:0];
    }
  }

  return directory;
}

- (NSString)pathForComputeSyncMediaAnalysisPayloadFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    pathForComputeDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:3 resourceType:14 recipeID:327691 originalFilename:0 customSuffix:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForComputeDirectory];
    path = [v9 path];
  }

  else
  {
    pathForComputeDirectory = [(PLManagedAsset *)self pathForComputeDirectory];
    path = [pathForComputeDirectory stringByAppendingPathComponent:@"ComputeSyncMediaAnalysisPayload.dat"];
  }

  return path;
}

- (NSString)pathForComputeSyncWrapperFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    pathForComputeDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:3 resourceType:14 recipeID:327689 originalFilename:0 customSuffix:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForComputeDirectory];
    path = [v9 path];
  }

  else
  {
    pathForComputeDirectory = [(PLManagedAsset *)self pathForComputeDirectory];
    path = [pathForComputeDirectory stringByAppendingPathComponent:@"ComputeSyncWrapper.dat"];
  }

  return path;
}

- (id)pathForAdjustedSmallVideoFile
{
  shouldUseUBFPathManager = [(PLManagedAsset *)self shouldUseUBFPathManager];
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  if (shouldUseUBFPathManager)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!isPhotoIris)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131277;
    }

    else
    {
      v12 = 131081;
    }

    v13 = [v8 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:v12];

    pathManager = [(PLManagedObject *)self pathManager];
    v15 = [pathManager readOnlyUrlWithIdentifier:v13];
    path = [v15 path];
  }

  else
  {
    v17 = @"small.MP4";
    if (isPhotoIris)
    {
      v17 = @"small.MOV";
    }

    v18 = v17;
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    v13 = [stringByDeletingPathExtension stringByAppendingPathExtension:v18];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathManager stringByAppendingPathComponent:v13];
  }

  return path;
}

- (id)pathForNonAdjustedSmallVideoFile
{
  shouldUseUBFPathManager = [(PLManagedAsset *)self shouldUseUBFPathManager];
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  if (shouldUseUBFPathManager)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!isPhotoIris)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131277;
    }

    else
    {
      v12 = 131081;
    }

    v13 = [v8 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:v12];

    pathManager = [(PLManagedObject *)self pathManager];
    v15 = [pathManager readOnlyUrlWithIdentifier:v13];
    path = [v15 path];
  }

  else
  {
    if (isPhotoIris)
    {
      v17 = @"small.MOV";
    }

    else
    {
      v17 = @"small.MP4";
    }

    path = [(PLManagedAsset *)self pathForMetadataWithExtension:v17];
  }

  return path;
}

- (id)pathForAdjustedLargeVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:131077];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:@"large.MOV"];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathManager stringByAppendingPathComponent:v7];
  }

  return path;
}

- (id)pathForAdjustedMediumHDRVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:131475];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:@"medium-hdr.MOV"];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathManager stringByAppendingPathComponent:v7];
  }

  return path;
}

- (id)pathForAdjustedMediumVideoFile
{
  shouldUseUBFPathManager = [(PLManagedAsset *)self shouldUseUBFPathManager];
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  if (shouldUseUBFPathManager)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!isPhotoIris)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131275;
    }

    else
    {
      v12 = 131079;
    }

    v13 = [v8 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:v12];

    pathManager = [(PLManagedObject *)self pathManager];
    v15 = [pathManager readOnlyUrlWithIdentifier:v13];
    path = [v15 path];
  }

  else
  {
    v17 = @"medium.MP4";
    if (isPhotoIris)
    {
      v17 = @"medium.MOV";
    }

    v18 = v17;
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    v13 = [stringByDeletingPathExtension stringByAppendingPathExtension:v18];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathManager stringByAppendingPathComponent:v13];
  }

  return path;
}

- (id)pathForNonAdjustedLargeVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:131077];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    path = [(PLManagedAsset *)self pathForMetadataWithExtension:@"large.MOV"];
  }

  return path;
}

- (id)pathForNonAdjustedMediumHDRVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:131475];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    path = [(PLManagedAsset *)self pathForMetadataWithExtension:@"medium-hdr.MOV"];
  }

  return path;
}

- (id)pathForNonAdjustedMediumVideoFile
{
  shouldUseUBFPathManager = [(PLManagedAsset *)self shouldUseUBFPathManager];
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  if (shouldUseUBFPathManager)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!isPhotoIris)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131275;
    }

    else
    {
      v12 = 131079;
    }

    v13 = [v8 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:v12];

    pathManager = [(PLManagedObject *)self pathManager];
    v15 = [pathManager readOnlyUrlWithIdentifier:v13];
    path = [v15 path];
  }

  else
  {
    if (isPhotoIris)
    {
      v17 = @"medium.MOV";
    }

    else
    {
      v17 = @"medium.MP4";
    }

    path = [(PLManagedAsset *)self pathForMetadataWithExtension:v17];
  }

  return path;
}

- (id)fileURLForAdjustedMediumThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:65743];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
  }

  else
  {
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    extensionForMediumThumbnailFile = [objc_opt_class() extensionForMediumThumbnailFile];
    v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:extensionForMediumThumbnailFile];

    v13 = MEMORY[0x1E695DFF8];
    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v14 = [pathManager stringByAppendingPathComponent:v7];
    v9 = [v13 fileURLWithPath:v14 isDirectory:0];
  }

  return v9;
}

- (id)fileURLForNonAdjustedMediumThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    extensionForMediumThumbnailFile = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:65743];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:extensionForMediumThumbnailFile];
  }

  else
  {
    extensionForMediumThumbnailFile = [objc_opt_class() extensionForMediumThumbnailFile];
    v9 = [(PLManagedAsset *)self fileURLForMetadataWithExtension:extensionForMediumThumbnailFile];
  }

  return v9;
}

- (id)pathForMediumVideoFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedMediumVideoFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedMediumVideoFile];
  }
  v3 = ;

  return v3;
}

- (id)fileURLForMediumThumbnailFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self fileURLForAdjustedMediumThumbnailFile];
  }

  else
  {
    [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForAdjustedMediumThumbnailFile
{
  fileURLForAdjustedMediumThumbnailFile = [(PLManagedAsset *)self fileURLForAdjustedMediumThumbnailFile];
  path = [fileURLForAdjustedMediumThumbnailFile path];

  return path;
}

- (id)pathForNonAdjustedMediumThumbnailFile
{
  fileURLForNonAdjustedMediumThumbnailFile = [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  path = [fileURLForNonAdjustedMediumThumbnailFile path];

  return path;
}

- (NSString)pathForMediumThumbnailFile
{
  fileURLForMediumThumbnailFile = [(PLManagedAsset *)self fileURLForMediumThumbnailFile];
  path = [fileURLForMediumThumbnailFile path];

  return path;
}

- (id)fileURLForDeferredVideoComplement
{
  pathForDeferredVideoComplementFile = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  if (pathForDeferredVideoComplementFile)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForDeferredVideoComplementFile isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForCurrentDeferredProcessingPreviewFile
{
  pathForDeferredProcessingPreviewFile = [(PLManagedAsset *)self pathForDeferredProcessingPreviewFile];
  if (pathForDeferredProcessingPreviewFile)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForDeferredProcessingPreviewFile isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForAsyncAdjustedRenderPreviewImage
{
  pathForAsyncAdjustedRenderPreviewImageFile = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
  if (pathForAsyncAdjustedRenderPreviewImageFile)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForAsyncAdjustedRenderPreviewImageFile isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForFullsizeRenderVideo
{
  pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
  if (pathForFullsizeRenderVideoFile)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForFullsizeRenderVideoFile isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForOriginalVideoComplement
{
  pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
  if (pathForVideoComplementFile)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForVideoComplementFile isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForAdjustedLargeThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:65741];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
  }

  else
  {
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    extensionForLargeThumbnailFile = [objc_opt_class() extensionForLargeThumbnailFile];
    v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:extensionForLargeThumbnailFile];

    v13 = MEMORY[0x1E695DFF8];
    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v14 = [pathManager stringByAppendingPathComponent:v7];
    v9 = [v13 fileURLWithPath:v14 isDirectory:0];
  }

  return v9;
}

- (id)fileURLForNonAdjustedLargeThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    extensionForLargeThumbnailFile = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:65741];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:extensionForLargeThumbnailFile];
  }

  else
  {
    extensionForLargeThumbnailFile = [objc_opt_class() extensionForLargeThumbnailFile];
    v9 = [(PLManagedAsset *)self fileURLForMetadataWithExtension:extensionForLargeThumbnailFile];
  }

  return v9;
}

- (NSURL)fileURLForLargeThumbnailFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self fileURLForAdjustedLargeThumbnailFile];
  }

  else
  {
    [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForAlchemistImage
{
  v3 = objc_opt_class();
  uuid = [(PLManagedAsset *)self uuid];
  bundleScope = [(PLManagedAsset *)self bundleScope];
  directory = [(PLManagedAsset *)self directory];
  filename = [(PLManagedAsset *)self filename];
  pathManager = [(PLManagedObject *)self pathManager];
  v9 = [v3 pathForAlchemistImageWithUUID:uuid bundleScope:bundleScope directory:directory filename:filename pathManager:pathManager];

  return v9;
}

- (id)pathForAlchemistV2ResourceFileWithRecipeID:(unsigned int)d
{
  v3 = *&d;
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v6 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6983148] identifier];
    currentHandler = [v6 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:3 resourceType:14 recipeID:v3 originalFilename:0 customSuffix:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v12 = [pathManager readOnlyUrlWithIdentifier:currentHandler];
    path = [v12 path];

LABEL_14:
    goto LABEL_16;
  }

  if (v3 > 327698)
  {
    if (v3 == 327699)
    {
      v14 = PLResourceAlchemistV2Widget1x2Filename();
    }

    else
    {
      if (v3 != 327701)
      {
        goto LABEL_15;
      }

      v14 = PLResourceAlchemistV2WallpaperFilename();
    }
  }

  else if (v3 == 327695)
  {
    v14 = PLResourceAlchemistV2OneUpFilename();
  }

  else
  {
    if (v3 != 327697)
    {
      goto LABEL_15;
    }

    v14 = PLResourceAlchemistV2Widget1x1Filename();
  }

  currentHandler = v14;
  if (v14)
  {
    pathManager = [(PLManagedAsset *)self pathForComputeDirectory];
    path = [pathManager stringByAppendingPathComponent:currentHandler];
    goto LABEL_14;
  }

LABEL_15:
  currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
  [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:10262 description:{@"Invalid parameter not satisfying: %@", @"filename"}];
  path = 0;
LABEL_16:

  return path;
}

- (id)pathForGenerativePlaygroundFaceResourcesFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    pathForComputeDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:3 resourceType:14 recipeID:327693 originalFilename:0 customSuffix:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForComputeDirectory];
    path = [v9 path];
  }

  else
  {
    pathForComputeDirectory = [(PLManagedAsset *)self pathForComputeDirectory];
    path = [pathForComputeDirectory stringByAppendingPathComponent:@"GenerativePlaygroundFaceResources.dat"];
  }

  return path;
}

- (id)pathForWallpaperComputeResourcesFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    pathForComputeDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:3 resourceType:14 recipeID:327687 originalFilename:0 customSuffix:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForComputeDirectory];
    path = [v9 path];
  }

  else
  {
    pathForComputeDirectory = [(PLManagedAsset *)self pathForComputeDirectory];
    path = [pathForComputeDirectory stringByAppendingPathComponent:@"WallpaperComputeResources.dat"];
  }

  return path;
}

- (id)pathForAdjustedLargeThumbnailFile
{
  fileURLForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self fileURLForAdjustedLargeThumbnailFile];
  path = [fileURLForAdjustedLargeThumbnailFile path];

  return path;
}

- (id)pathForNonAdjustedLargeThumbnailFile
{
  fileURLForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  path = [fileURLForNonAdjustedLargeThumbnailFile path];

  return path;
}

- (NSString)pathForLargeThumbnailFile
{
  fileURLForLargeThumbnailFile = [(PLManagedAsset *)self fileURLForLargeThumbnailFile];
  path = [fileURLForLargeThumbnailFile path];

  return path;
}

- (id)pathForAdjustedLargeSizeImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:65739];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:@"large.JPG"];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathManager stringByAppendingPathComponent:v7];
  }

  return path;
}

- (id)pathForNonAdjustedLargeSizeImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:65739];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    path = [(PLManagedAsset *)self pathForMetadataWithExtension:@"large.JPG"];
  }

  return path;
}

- (id)pathForLargeSizeImageFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedLargeSizeImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForAsyncAdjustedRenderPreviewImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:65941];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v9 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"AsyncRenderPreview.JPG"];
  }

  return path;
}

- (id)pathForNonAdjustedFullsizeImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:65737];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    path = [(PLManagedAsset *)self pathForMetadataWithExtension:@"full.JPG"];
  }

  return path;
}

- (id)pathForFullsizeImageFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedFullsizeImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForVideoComplementSpatialOverCaptureContentFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    pathExtension = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 resourceType:11];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathExtension];
    path = [v9 path];
  }

  else
  {
    pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
    pathExtension = [pathForVideoComplementFile pathExtension];
    pathManager = [pathForVideoComplementFile stringByDeletingPathExtension];
    v9 = [pathManager stringByAppendingString:*MEMORY[0x1E69BFFB0]];
    path = [v9 stringByAppendingPathExtension:pathExtension];
  }

  return path;
}

- (id)pathForSpatialOverCaptureContentFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = MEMORY[0x1E69BF298];
    uuid = [(PLManagedAsset *)self uuid];
    originalUniformTypeIdentifier = [(PLManagedAsset *)self originalUniformTypeIdentifier];
    LODWORD(v3) = [v3 isValidFileIdentifierParametersForUUID:uuid utiString:originalUniformTypeIdentifier originalFilename:0];

    path = 0;
    if (!v3)
    {
      goto LABEL_6;
    }

    v7 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid2 = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    originalUniformTypeIdentifier2 = [(PLManagedAsset *)self originalUniformTypeIdentifier];
    pathExtension = [v7 initWithAssetUuid:uuid2 bundleScope:bundleScope uti:originalUniformTypeIdentifier2 resourceVersion:0 resourceType:10];

    pathManager = [(PLManagedObject *)self pathManager];
    v13 = [pathManager readOnlyUrlWithIdentifier:pathExtension];
    path = [v13 path];
  }

  else
  {
    pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
    pathExtension = [pathForOriginalFile pathExtension];
    pathManager = [pathForOriginalFile stringByDeletingPathExtension];
    v13 = [pathManager stringByAppendingString:*MEMORY[0x1E69BFFB0]];
    path = [v13 stringByAppendingPathExtension:pathExtension];
  }

LABEL_6:

  return path;
}

- (id)pathForDeferredProcessingPreviewFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = &stru_1F0F06D80;
  }

  else
  {
    pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
    pathExtension = [pathForOriginalFile pathExtension];
    deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
    v7 = MEMORY[0x1E69BFF98];
    if (deferredProcessingNeeded != 10)
    {
      v7 = MEMORY[0x1E69BFCF0];
    }

    v8 = *v7;
    stringByDeletingPathExtension = [pathForOriginalFile stringByDeletingPathExtension];
    v10 = [stringByDeletingPathExtension stringByAppendingString:v8];
    v3 = [v10 stringByAppendingPathExtension:pathExtension];
  }

  return v3;
}

- (id)pathForDeferredVideoComplementFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = 0;
  }

  else
  {
    pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
    pathExtension = [pathForVideoComplementFile pathExtension];
    v6 = *MEMORY[0x1E69BFE88];
    stringByDeletingPathExtension = [pathForVideoComplementFile stringByDeletingPathExtension];
    v8 = [stringByDeletingPathExtension stringByAppendingString:v6];
    v3 = [v8 stringByAppendingPathExtension:pathExtension];
  }

  return v3;
}

- (id)pathForVideoComplementFile
{
  if (![(PLManagedAsset *)self shouldUseUBFPathManager]|| [(PLManagedAsset *)self isCloudSharedAsset])
  {
    pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
    stringByDeletingPathExtension = [pathForOriginalFile stringByDeletingPathExtension];
    path = [stringByDeletingPathExtension stringByAppendingPathExtension:@"MOV"];
LABEL_4:

    goto LABEL_5;
  }

  if (!-[PLManagedAsset isReferencedAsset](self, "isReferencedAsset") || (-[PLManagedAsset masterResourceForCPLType:](self, "masterResourceForCPLType:", 18), v7 = objc_claimAutoreleasedReturnValue(), [v7 fileSystemBookmark], v8 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "fileSystemURL"), v9 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v9, "path"), path = objc_claimAutoreleasedReturnValue(), v9, v8, v7, !path))
  {
    v10 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    stringByDeletingPathExtension = [v10 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 resourceType:3];

    pathForOriginalFile = [(PLManagedObject *)self pathManager];
    v14 = [pathForOriginalFile readOnlyUrlWithIdentifier:stringByDeletingPathExtension];
    path = [v14 path];

    goto LABEL_4;
  }

LABEL_5:

  return path;
}

- (id)pathForAdjustedMediaMetadataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:327683];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    filename = [(PLManagedAsset *)self filename];
    stringByDeletingPathExtension = [filename stringByDeletingPathExtension];
    v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:@"media.dat"];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathManager stringByAppendingPathComponent:v7];
  }

  return path;
}

- (id)pathForVideoMetadataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    stringByDeletingPathExtension = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 resourceType:13];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:stringByDeletingPathExtension];
    [v9 path];
  }

  else
  {
    v10 = *MEMORY[0x1E69C0020];
    v9 = [(PLManagedAsset *)self pathForMetadataWithExtension:*MEMORY[0x1E69C0020]];
    stringByDeletingPathExtension = [v9 stringByDeletingPathExtension];
    pathManager = [stringByDeletingPathExtension stringByAppendingString:*MEMORY[0x1E69C0028]];
    [pathManager stringByAppendingPathExtension:v10];
  }
  v11 = ;

  return v11;
}

- (id)pathForMediaMetadataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 recipeID:327683];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:v7];
    path = [v9 path];
  }

  else
  {
    path = [(PLManagedAsset *)self pathForMetadataWithExtension:@"media.dat"];
  }

  return path;
}

- (id)pathForCameraMetadataFile
{
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  pathManager = [photoLibrary pathManager];
  v5 = [pathManager privateDirectoryWithSubType:9 createIfNeeded:1 error:0];

  originalFilename = [(PLManagedAsset *)self originalFilename];
  stringByDeletingPathExtension = [originalFilename stringByDeletingPathExtension];
  v8 = [stringByDeletingPathExtension stringByAppendingPathExtension:*MEMORY[0x1E69C00C0]];

  v9 = [v5 stringByAppendingPathComponent:v8];

  return v9;
}

- (id)pathForAdjustmentSecondaryDataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 resourceType:7];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v9 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"AdjustmentsSecondary.data"];
  }

  return path;
}

- (id)pathForAdjustmentDataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982D60] identifier];
    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v9 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"Adjustments.data"];
  }

  return path;
}

- (id)pathForOriginalAdjustmentFile
{
  pathManager = [(PLManagedObject *)self pathManager];
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v4 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    supplementalResourceAAEType = [MEMORY[0x1E69C08F0] supplementalResourceAAEType];
    identifier = [supplementalResourceAAEType identifier];
    uppercaseString = [v4 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 resourceType:5];

    filename = [pathManager readOnlyUrlWithIdentifier:uppercaseString];
    path = [filename path];
  }

  else
  {
    uppercaseString = [*MEMORY[0x1E69C0E18] uppercaseString];
    [uppercaseString UTF8String];
    filename = [(PLManagedAsset *)self filename];
    directory = [(PLManagedAsset *)self directory];
    v13 = PLDCIMURLForResourcePropertiesAndPathManager();
    path = [v13 path];
  }

  return path;
}

- (id)pathForAdjustmentFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F68] identifier];
    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v9 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"Adjustments.plist"];
  }

  return path;
}

- (id)pathForPenultimateFullsizeRenderVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:1 recipeID:0];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v9 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"PenultimateFullSizeRender.mov"];
  }

  return path;
}

- (id)pathForPenultimateFullsizeRenderImageFileWithUTI:(id)i
{
  iCopy = i;
  if (!iCopy)
  {
    iCopy = [*MEMORY[0x1E6982E58] identifier];
  }

  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v5 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    lowercaseString = [v5 initWithAssetUuid:uuid bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:iCopy recipeID:{1, 0}];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:lowercaseString];
    [v9 path];
  }

  else
  {
    v10 = [objc_opt_class() preferredFileExtensionForType:iCopy];
    lowercaseString = [v10 lowercaseString];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v9 = [pathManager stringByAppendingPathComponent:@"PenultimateFullSizeRender"];
    [v9 stringByAppendingPathExtension:lowercaseString];
  }
  v11 = ;

  return v11;
}

- (id)pathForPenultimateFullsizeRenderImageFile
{
  penultimateImageResource = [(PLManagedAsset *)self penultimateImageResource];
  v4 = penultimateImageResource;
  if (penultimateImageResource)
  {
    uniformTypeIdentifier = [penultimateImageResource uniformTypeIdentifier];
    identifier = [uniformTypeIdentifier identifier];
  }

  else
  {
    identifier = [*MEMORY[0x1E6982E58] identifier];
  }

  v7 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFileWithUTI:identifier];

  return v7;
}

- (id)pathForFullsizeRenderVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982F80] identifier];
    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v7 = 131272;
    }

    else
    {
      v7 = 0x20000;
    }

    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:v7];

    pathManager = [(PLManagedObject *)self pathManager];
    v10 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v10 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"FullSizeRender.mov"];
  }

  return path;
}

- (id)pathForLocalVideoKeyFrame
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    thumbnailIdentifier = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:3 recipeID:65749];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:thumbnailIdentifier];
    path = [v9 path];
  }

  else
  {
    thumbnailIdentifier = [(PLManagedAsset *)self thumbnailIdentifier];

    if (thumbnailIdentifier)
    {
      v11 = objc_alloc(MEMORY[0x1E696AF20]);
      thumbnailIdentifier2 = [(PLManagedAsset *)self thumbnailIdentifier];
      v13 = [v11 initWithString:thumbnailIdentifier2];

      thumbnailIdentifier = [v13 path];
    }

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager photoDirectoryWithType:31 createIfNeeded:1 error:0];
    v14 = [v9 stringByAppendingPathComponent:thumbnailIdentifier];
    path = [v14 stringByAppendingPathComponent:@"LocalVideoKeyFrame.jpg"];
  }

  return path;
}

- (id)pathForTransientVideoPosterFramePreview
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:65948];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v9 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"VideoPosterFramePreview.jpg"];
  }

  return path;
}

- (id)pathForBestAvailableFullsizeRenderImageFileOutIsSubstandard:(BOOL *)substandard
{
  fileManager = [MEMORY[0x1E69BF238] fileManager];
  pathForFullsizeRenderImageFile = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  if (![fileManager fileExistsAtPath:pathForFullsizeRenderImageFile])
  {
    goto LABEL_24;
  }

  v7 = pathForFullsizeRenderImageFile;
  v8 = v7;
  if (substandard)
  {
    *substandard = 0;
  }

  pathForAsyncAdjustedRenderPreviewImageFile = v7;
  if (!v7)
  {
LABEL_24:
    identifier = [*MEMORY[0x1E6982E00] identifier];
    v8 = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:identifier];

    if (![fileManager fileExistsAtPath:v8])
    {
      goto LABEL_9;
    }

    v11 = v8;
    v8 = v11;
    if (substandard)
    {
      *substandard = 0;
    }

    pathForAsyncAdjustedRenderPreviewImageFile = v11;
    if (!v11)
    {
LABEL_9:
      pathForSubstandardFullsizeRenderImageFile = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];

      if (![fileManager fileExistsAtPath:pathForSubstandardFullsizeRenderImageFile])
      {
        goto LABEL_14;
      }

      v13 = pathForSubstandardFullsizeRenderImageFile;
      v8 = v13;
      if (substandard)
      {
        *substandard = 1;
      }

      pathForAsyncAdjustedRenderPreviewImageFile = v13;
      if (!v13)
      {
        pathForSubstandardFullsizeRenderImageFile = 0;
LABEL_14:
        pathForAsyncAdjustedRenderPreviewImageFile = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];

        if ([fileManager fileExistsAtPath:pathForAsyncAdjustedRenderPreviewImageFile])
        {
          v14 = pathForAsyncAdjustedRenderPreviewImageFile;
          v8 = v14;
          if (substandard)
          {
            *substandard = 1;
          }

          pathForAsyncAdjustedRenderPreviewImageFile = v14;
        }

        else
        {
          v8 = 0;
        }
      }
    }
  }

  return v8;
}

- (id)pathForSubstandardFullsizeRenderImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    identifier = [*MEMORY[0x1E6982E58] identifier];
    pathForAdjustmentDirectory = [v3 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 recipeID:65937];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:pathForAdjustmentDirectory];
    path = [v9 path];
  }

  else
  {
    pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    path = [pathForAdjustmentDirectory stringByAppendingPathComponent:@"SubstandardFullSizeRender.jpg"];
  }

  return path;
}

- (id)pathForFullsizeRenderImageFileWithUTI:(id)i
{
  iCopy = i;
  if (!iCopy)
  {
    iCopy = [*MEMORY[0x1E6982E58] identifier];
  }

  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v5 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    lowercaseString = [v5 initWithAssetUuid:uuid bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:iCopy recipeID:{2, 65938}];

    pathManager = [(PLManagedObject *)self pathManager];
    v9 = [pathManager readOnlyUrlWithIdentifier:lowercaseString];
    [v9 path];
  }

  else
  {
    v10 = [objc_opt_class() preferredFileExtensionForType:iCopy];
    lowercaseString = [v10 lowercaseString];

    pathManager = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v9 = [pathManager stringByAppendingPathComponent:@"FullSizeRender"];
    [v9 stringByAppendingPathExtension:lowercaseString];
  }
  v11 = ;

  return v11;
}

- (id)fileTypeForFullsizeRenderImage
{
  if ([(PLManagedAsset *)self isPhoto]&& ([(PLManagedAsset *)self uniformTypeIdentifier], (v3 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v4 = v3;
    uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  }

  else
  {
    uniformTypeIdentifier = [*MEMORY[0x1E6982E58] identifier];
  }

  if ([objc_opt_class() isPrimaryImageFormatForUTI:uniformTypeIdentifier])
  {
    identifier = [*MEMORY[0x1E6982E10] identifier];
    v7 = [uniformTypeIdentifier isEqualToString:identifier];

    if ((v7 & 1) == 0)
    {
      goto LABEL_12;
    }

    v8 = MEMORY[0x1E6982E00];
  }

  else
  {
    isRAW = [(PLManagedAsset *)self isRAW];
    v8 = MEMORY[0x1E6982E58];
    if (!isRAW && [(PLManagedAsset *)self hdrType]== 11)
    {
      v8 = MEMORY[0x1E6982E00];
    }
  }

  identifier2 = [*v8 identifier];

  uniformTypeIdentifier = identifier2;
LABEL_12:

  return uniformTypeIdentifier;
}

- (id)pathForFullsizeRenderImageFile
{
  v3 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_1085];
  fileURL = [v3 fileURL];
  v5 = fileURL;
  if (fileURL)
  {
    path = [fileURL path];
  }

  else
  {
    fileTypeForFullsizeRenderImage = [(PLManagedAsset *)self fileTypeForFullsizeRenderImage];
    path = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:fileTypeForFullsizeRenderImage];
  }

  return path;
}

BOOL __48__PLManagedAsset_pathForFullsizeRenderImageFile__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 recipeID] == 65938 && objc_msgSend(v2, "version") == 2;

  return v3;
}

- (BOOL)_migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat
{
  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  v4 = objc_alloc(MEMORY[0x1E69C0910]);
  v5 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForAdjustmentFile isDirectory:0];
  v6 = [v4 initWithURL:v5];

  v7 = 0;
  if ([v6 isRecognizedFormat])
  {
    v8 = objc_alloc(MEMORY[0x1E69C0910]);
    if (v6)
    {
      [v6 slowMotionTimeRange];
    }

    else
    {
      memset(v21, 0, sizeof(v21));
    }

    [v6 slowMotionRate];
    v9 = [v8 initWithSlowMotionTimeRange:v21 rate:?];
    adjustmentFormatIdentifier = [v9 adjustmentFormatIdentifier];
    adjustmentFormatIdentifier2 = [v6 adjustmentFormatIdentifier];
    if ([adjustmentFormatIdentifier isEqualToString:adjustmentFormatIdentifier2])
    {
      adjustmentFormatVersion = [v9 adjustmentFormatVersion];
      adjustmentFormatVersion2 = [v6 adjustmentFormatVersion];
      if ([adjustmentFormatVersion isEqualToString:adjustmentFormatVersion2])
      {
        adjustmentData = [v9 adjustmentData];
        adjustmentData2 = [v6 adjustmentData];
        v20 = [adjustmentData isEqualToData:adjustmentData2];

        if (v20)
        {
          v7 = 0;
LABEL_14:

          goto LABEL_15;
        }

LABEL_11:
        adjustmentTimestamp = [v9 adjustmentTimestamp];

        if (!adjustmentTimestamp)
        {
          dateCreated = [(PLManagedAsset *)self dateCreated];
          [v9 setAdjustmentTimestamp:dateCreated];
        }

        v18 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForSLMAdjustmentsWithMainFileMetadata:0];
        [(PLManagedAsset *)self setAdjustments:v9 options:v18];

        v7 = 1;
        goto LABEL_14;
      }
    }

    goto LABEL_11;
  }

LABEL_15:

  return v7;
}

- (BOOL)_migrateLegacySLMAdjustments
{
  v23 = *MEMORY[0x1E69E9840];
  pathForLegacySlalomRegionsArchive = [(PLManagedAsset *)self pathForLegacySlalomRegionsArchive];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v5 = [defaultManager fileExistsAtPath:pathForLegacySlalomRegionsArchive];

  if (v5)
  {
    v6 = objc_alloc(MEMORY[0x1E69C0910]);
    v7 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForLegacySlalomRegionsArchive isDirectory:0];
    v8 = [v6 initWithURL:v7];

    v9 = v8 != 0;
    if (v8)
    {
      adjustmentTimestamp = [v8 adjustmentTimestamp];

      if (!adjustmentTimestamp)
      {
        dateCreated = [(PLManagedAsset *)self dateCreated];
        [v8 setAdjustmentTimestamp:dateCreated];
      }

      v12 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForSLMAdjustmentsWithMainFileMetadata:0];
      [(PLManagedAsset *)self setAdjustments:v8 options:v12];
    }

    defaultManager2 = [MEMORY[0x1E696AC08] defaultManager];
    v18 = 0;
    v14 = [defaultManager2 removeItemAtPath:pathForLegacySlalomRegionsArchive error:&v18];
    v15 = v18;

    if (!v14 || v15)
    {
      v16 = PLMigrationGetLog();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v20 = pathForLegacySlalomRegionsArchive;
        v21 = 2112;
        v22 = v15;
        _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "_migrateLegacySLMAdjustments failed to remove %@: %@", buf, 0x16u);
      }
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)migrateLegacyVideoAdjustments
{
  if ([(PLManagedAsset *)self kind]!= 1)
  {
    return 0;
  }

  if ([(PLManagedAsset *)self kindSubtype]!= 101)
  {
    return 0;
  }

  [MEMORY[0x1E69BF328] maskForMigrateLegacyVideoAdjustmentsExclusions];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    return 0;
  }

  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v7 = [defaultManager fileExistsAtPath:pathForAdjustmentFile];

  if (v7)
  {
    _migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat = [(PLManagedAsset *)self _migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat];
  }

  else
  {
    _migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat = [(PLManagedAsset *)self _migrateLegacySLMAdjustments];
  }

  v3 = _migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat;

  return v3;
}

- (BOOL)_setDefaultCinematicAdjustementsWithMainFileMetadata:(id)metadata
{
  metadataCopy = metadata;
  v5 = +[PLCompositionHelper newIdentityCompositionController];
  adjustmentConstants = [v5 adjustmentConstants];
  [v5 setMediaType:2];
  pIPortraitVideoAdjustmentKey = [adjustmentConstants PIPortraitVideoAdjustmentKey];
  [v5 modifyAdjustmentWithKey:pIPortraitVideoAdjustmentKey modificationBlock:&__block_literal_global_1082];

  v8 = [PLPhotoEditExportProperties exportPropertiesWithImageWidth:[(PLManagedAsset *)self originalWidth] imageHeight:[(PLManagedAsset *)self originalHeight] exifOrientation:0];
  v9 = objc_alloc_init(PLPhotoEditPersistenceManager);
  v17 = 0;
  v18 = 0;
  v10 = [(PLPhotoEditPersistenceManager *)v9 dataFromCompositionController:v5 outFormatIdentifier:&v18 outFormatVersion:&v17 exportProperties:v8];
  v11 = v18;
  v12 = v17;
  v13 = objc_alloc(MEMORY[0x1E69C0660]);
  v14 = [v13 initWithFormatIdentifier:v11 formatVersion:v12 data:v10 baseVersion:0 editorBundleID:*MEMORY[0x1E69C0E58] renderTypes:128];

  if (v14)
  {
    v15 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForCinematicCaptureIngestWithMainFileMetadata:metadataCopy];
    [(PLManagedAsset *)self setAdjustments:v14 options:v15];
  }

  return v14 != 0;
}

- (BOOL)_setDefaultSlowMotionAdjustmentsWithMainFileMetadata:(id)metadata
{
  v31 = *MEMORY[0x1E69E9840];
  metadataCopy = metadata;
  if ([metadataCopy isSyndicationOriginated])
  {
    if (metadataCopy)
    {
      [metadataCopy duration];
      v5 = HIDWORD(v26);
      v6 = v27;
    }

    else
    {
      v6 = 0;
      v5 = 0;
      v26 = 0uLL;
      *&v27 = 0;
    }

    v29 = v26;
    v30 = DWORD2(v26);
    nominalFrameRate = [metadataCopy nominalFrameRate];
    [nominalFrameRate floatValue];
    v11 = v10;
  }

  else
  {
    nominalFrameRate = [(PLManagedAsset *)self mainFileURL];
    v8 = [MEMORY[0x1E6988168] assetWithURL:nominalFrameRate];
    v9 = v8;
    if (v8)
    {
      [v8 duration];
      v5 = HIDWORD(v26);
      v6 = v27;
    }

    else
    {
      v6 = 0;
      v5 = 0;
      v26 = 0uLL;
      *&v27 = 0;
    }

    v29 = v26;
    v30 = DWORD2(v26);
    v12 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:v9];
    firstObject = [v12 firstObject];
    [firstObject nominalFrameRate];
    v11 = v14;
  }

  if (v5)
  {
    v27 = 0u;
    v28 = 0u;
    v26 = 0u;
    *&v23 = v29;
    *(&v23 + 1) = __PAIR64__(v5, v30);
    *&v24 = v6;
    [MEMORY[0x1E69C0910] defaultSlowMotionTimeRangeForDuration:&v23];
    LODWORD(v16) = v11;
    [MEMORY[0x1E69C0910] defaultSlowMotionRateForNominalFrameRate:v16];
    v18 = v17;
    v19 = objc_alloc(MEMORY[0x1E69C0910]);
    v23 = v26;
    v24 = v27;
    v25 = v28;
    v20 = [v19 initWithSlowMotionTimeRange:&v23 rate:{COERCE_DOUBLE(__PAIR64__(DWORD1(v28), v18))}];
    v15 = v20 != 0;
    if (v20)
    {
      v21 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForSLMAdjustmentsWithMainFileMetadata:metadataCopy];
      [(PLManagedAsset *)self setAdjustments:v20 options:v21];
    }
  }

  else
  {
    v15 = 0;
  }

  return v15;
}

- (BOOL)setDefaultAdjustmentsIfNecessaryWithMainFileMetadata:(id)metadata
{
  metadataCopy = metadata;
  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v7 = [defaultManager fileExistsAtPath:pathForAdjustmentFile];

  if (v7)
  {
    goto LABEL_8;
  }

  if ([(PLManagedAsset *)self kindSubtype]!= 101 || ![(PLManagedAsset *)self _setDefaultSlowMotionAdjustmentsWithMainFileMetadata:metadataCopy])
  {
    if ([metadataCopy isCinematicVideo])
    {
      cinematicVideoIntent = [metadataCopy cinematicVideoIntent];

      if (cinematicVideoIntent)
      {
        v8 = [(PLManagedAsset *)self _setDefaultCinematicAdjustementsWithMainFileMetadata:metadataCopy];
        goto LABEL_9;
      }
    }

LABEL_8:
    v8 = 0;
    goto LABEL_9;
  }

  v8 = 1;
LABEL_9:

  return v8;
}

- (BOOL)setCurrentAdjustmentAsOriginalAdjustment
{
  v15 = *MEMORY[0x1E69E9840];
  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  fileManager = [MEMORY[0x1E69BF238] fileManager];
  if ([fileManager fileExistsAtPath:pathForAdjustmentFile])
  {
    pathForOriginalAdjustmentFile = [(PLManagedAsset *)self pathForOriginalAdjustmentFile];
    v12 = 0;
    v6 = [fileManager copyItemAtPath:pathForAdjustmentFile toPath:pathForOriginalAdjustmentFile error:&v12];
    v7 = v12;
    if (v6)
    {
      v8 = [PLResourceInstaller onDemand_installOriginalAdjustmentResourceIfPresentForAsset:self];
      v9 = v8 != 0;
    }

    else
    {
      v8 = PLBackendGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v14 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Error copying adjustment to original adjustment with error: %@", buf, 0xCu);
      }

      v9 = 0;
    }
  }

  else
  {
    pathForOriginalAdjustmentFile = PLBackendGetLog();
    if (os_log_type_enabled(pathForOriginalAdjustmentFile, OS_LOG_TYPE_ERROR))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      v14 = uuid;
      _os_log_impl(&dword_19BF1F000, pathForOriginalAdjustmentFile, OS_LOG_TYPE_ERROR, "Tried to set original adjustment for an asset without an adjustment: %{public}@", buf, 0xCu);
    }

    v9 = 0;
  }

  return v9;
}

- (void)synchronouslyFetchAdjustmentDataWithCompletionHandler:(id)handler
{
  handlerCopy = handler;
  if (handlerCopy)
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];

    if (unmanagedAdjustment && [(PLManagedAsset *)self hasAdjustments])
    {
      adjustmentFormatIdentifier = [unmanagedAdjustment adjustmentFormatIdentifier];
      adjustmentFormatVersion = [unmanagedAdjustment adjustmentFormatVersion];
      additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
      editorBundleID = [additionalAttributes2 editorBundleID];

      adjustmentBaseImageFormat = [unmanagedAdjustment adjustmentBaseImageFormat];
      integerValue = [adjustmentBaseImageFormat integerValue];

      pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
      adjustmentTimestamp = [unmanagedAdjustment adjustmentTimestamp];
      v21 = pathForAdjustmentFile;
      if ([(PLManagedAsset *)self shouldUseUBFPathManager])
      {
        stringByDeletingPathExtension = [pathForAdjustmentFile stringByDeletingPathExtension];
        [stringByDeletingPathExtension stringByAppendingPathExtension:@"in_flight"];
      }

      else
      {
        stringByDeletingPathExtension = [(PLManagedAsset *)self pathForAdjustmentDirectory];
        [stringByDeletingPathExtension stringByAppendingPathComponent:@"in_flight"];
      }
      v14 = ;

      adjustmentRenderTypes = [unmanagedAdjustment adjustmentRenderTypes];
    }

    else
    {
      adjustmentRenderTypes = 0;
      adjustmentTimestamp = 0;
      v21 = 0;
      v14 = 0;
      integerValue = 0;
      editorBundleID = 0;
      adjustmentFormatVersion = 0;
      adjustmentFormatIdentifier = 0;
    }

    v15 = objc_alloc_init(MEMORY[0x1E696AC08]);
    v16 = objc_opt_class();
    objc_sync_enter(v16);
    v17 = [v15 fileExistsAtPath:v14 isDirectory:0];
    objc_sync_exit(v16);

    if (v17)
    {
      v18 = PLBackendGetLog();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "pathForMarkerFileExists. resetting adjustment", buf, 2u);
      }

      [v15 removeItemAtPath:v14 error:0];
      [(PLManagedAsset *)self revertToOriginal];
      integerValue = 0;
      adjustmentFormatVersion = 0;
      adjustmentFormatIdentifier = 0;
    }

    (*(handlerCopy + 2))(handlerCopy, adjustmentFormatIdentifier, adjustmentFormatVersion, editorBundleID, integerValue, v21, adjustmentRenderTypes, adjustmentTimestamp, 0);
  }
}

- (void)_cleanupPenultimateResources
{
  v29 = *MEMORY[0x1E69E9840];
  v3 = PLBackendGetLog();
  if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "Cleaning up penultimate resources", buf, 2u);
  }

  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  pathForPenultimateFullsizeRenderImageFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
  if ([defaultManager fileExistsAtPath:pathForPenultimateFullsizeRenderImageFile])
  {
    v24 = 0;
    v6 = [defaultManager removeItemAtPath:pathForPenultimateFullsizeRenderImageFile error:&v24];
    v7 = v24;
    v8 = PLBackendGetLog();
    v9 = v8;
    if (v6)
    {
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v26 = pathForPenultimateFullsizeRenderImageFile;
        v10 = "Removed pathForPenultimateFullsizeRenderImageFile %@";
        v11 = v9;
        v12 = OS_LOG_TYPE_INFO;
        v13 = 12;
LABEL_9:
        _os_log_impl(&dword_19BF1F000, v11, v12, v10, buf, v13);
      }
    }

    else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v26 = pathForPenultimateFullsizeRenderImageFile;
      v27 = 2112;
      v28 = v7;
      v10 = "Failed to remove pathForPenultimateFullsizeRenderImageFile %@: %@";
      v11 = v9;
      v12 = OS_LOG_TYPE_ERROR;
      v13 = 22;
      goto LABEL_9;
    }
  }

  [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:15];
  pathForPenultimateFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
  if ([defaultManager fileExistsAtPath:pathForPenultimateFullsizeRenderVideoFile])
  {
    v23 = 0;
    v15 = [defaultManager removeItemAtPath:pathForPenultimateFullsizeRenderVideoFile error:&v23];
    v16 = v23;
    v17 = PLBackendGetLog();
    v18 = v17;
    if (v15)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v26 = pathForPenultimateFullsizeRenderVideoFile;
        v19 = "Removed pathForPenultimateFullsizeRenderVideoFile %@";
        v20 = v18;
        v21 = OS_LOG_TYPE_INFO;
        v22 = 12;
LABEL_17:
        _os_log_impl(&dword_19BF1F000, v20, v21, v19, buf, v22);
      }
    }

    else if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v26 = pathForPenultimateFullsizeRenderVideoFile;
      v27 = 2112;
      v28 = v16;
      v19 = "Failed to remove pathForPenultimateFullsizeRenderVideoFile %@: %@";
      v20 = v18;
      v21 = OS_LOG_TYPE_ERROR;
      v22 = 22;
      goto LABEL_17;
    }
  }

  [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:20];
  [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:25];
}

- (BOOL)updateDeferredAdjustmentWithFullSizeRenderImageURL:(id)l videoURL:(id)rL videoPosterURL:(id)uRL error:(id *)error
{
  v52 = *MEMORY[0x1E69E9840];
  lCopy = l;
  rLCopy = rL;
  uRLCopy = uRL;
  if (lCopy && [(PLManagedAsset *)self isPhoto])
  {
    v12 = lCopy;
    pathExtension = [v12 pathExtension];
    v14 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:pathExtension assetType:0];

    v15 = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:v14];
    fileURLForFullsizeRenderVideo = [MEMORY[0x1E695DFF8] fileURLWithPath:v15 isDirectory:0];

    fileURLForFullsizeRenderImage = 0;
  }

  else if (rLCopy && [(PLManagedAsset *)self isVideo])
  {
    v12 = rLCopy;
    fileURLForFullsizeRenderVideo = [(PLManagedAsset *)self fileURLForFullsizeRenderVideo];
    fileURLForFullsizeRenderImage = [(PLManagedAsset *)self fileURLForFullsizeRenderImage];
  }

  else
  {
    fileURLForFullsizeRenderImage = 0;
    fileURLForFullsizeRenderVideo = 0;
    v12 = 0;
  }

  v42 = rLCopy;
  if ([(PLManagedAsset *)self isPhotoIris])
  {
    v18 = rLCopy;
  }

  else
  {
    v18 = 0;
  }

  v43 = v18;
  v19 = MEMORY[0x1E695DF90];
  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  v21 = [v19 dictionaryWithContentsOfFile:pathForAdjustmentFile];

  v22 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    *buf = 138412546;
    v49 = v12;
    v50 = 2112;
    v51 = fileURLForFullsizeRenderVideo;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Update deferred adjustment ingesting rendered media at source URL: %@ to destination URL: %@", buf, 0x16u);
  }

  if ([fileURLForFullsizeRenderVideo isEqual:v12])
  {
    v23 = 0;
  }

  else
  {
    v23 = 3;
  }

  v24 = objc_alloc_init(PLMutableAssetAdjustmentOptions);
  [(PLMutableAssetAdjustmentOptions *)v24 setRenderedContentURL:v12];
  [(PLMutableAssetAdjustmentOptions *)v24 setRenderedVideoComplementContentURL:v43];
  v41 = uRLCopy;
  [(PLMutableAssetAdjustmentOptions *)v24 setRenderedVideoPosterContentURL:uRLCopy];
  [(PLMutableAssetAdjustmentOptions *)v24 setFileIngestionType:v23];
  [(PLMutableAssetAdjustmentOptions *)v24 setShouldUpdateAttributes:1];
  v47 = 0;
  v25 = [(PLManagedAsset *)self _ingestAndApplyMetadataChangesFromAdjustments:0 updateAdjustmentDictionary:v21 options:v24 fullSizeRenderURL:fileURLForFullsizeRenderVideo videoPosterRenderURL:fileURLForFullsizeRenderImage isRevertToOriginal:0 error:&v47];
  v26 = v47;
  v27 = v26;
  if (v25)
  {
    [(PLManagedAsset *)self _writeOutAdjustmentsToFile:v21];
    v40 = lCopy;
    if ([(PLManagedAsset *)self deferredProcessingNeeded]== 2 || [(PLManagedAsset *)self deferredProcessingNeeded]== 9)
    {
      pathForAsyncAdjustedRenderPreviewImageFile = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
      if (pathForAsyncAdjustedRenderPreviewImageFile)
      {
        v46 = 0;
        v29 = [MEMORY[0x1E69BF238] removeItemAtPath:pathForAsyncAdjustedRenderPreviewImageFile error:&v46];
        v30 = v46;
        if ((v29 & 1) == 0)
        {
          v38 = v30;
          v31 = PLBackendGetLog();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            v49 = pathForAsyncAdjustedRenderPreviewImageFile;
            v50 = 2112;
            v51 = v38;
            _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "Couldn't remove async render preview image %@ with error: %@", buf, 0x16u);
          }

          v30 = v38;
        }
      }

      [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
    }

    if (fileURLForFullsizeRenderImage && (v32 = CGImageSourceCreateWithURL(fileURLForFullsizeRenderImage, 0)) != 0)
    {
      v44 = 0;
      v45 = 0;
      [PLManagedAsset createThumbnailImage:&v45 previewImage:&v44 withToBeReleasedImageSource:v32];
      v33 = v45;
      v34 = v44;
    }

    else
    {
      v34 = 0;
      v33 = 0;
    }

    LOWORD(v37) = 0;
    [(PLManagedAsset *)self _updateDerivativesAndThumbnails:1 withPreviewImage:v34 thumbnailImage:v33 metadata:0 didRevertToOriginal:0 updateInternalResources:1 isSubstandardRender:v37 isDeferred:?];

    lCopy = v40;
  }

  else if (error)
  {
    v35 = v26;
    *error = v27;
  }

  return v25;
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types withMetadata:(id)metadata
{
  if ([metadata isSpatialMedia])
  {
    v5 = 4096;
  }

  else
  {
    v5 = 0;
  }

  return v5 | types & 0xFFFFEFFF;
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types forSpatialTypeOfAVAsset:(id)asset
{
  assetCopy = asset;
  if ([(PLManagedAsset *)self spatialType])
  {
    v7 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVAsset:assetCopy timeZoneLookup:0];
    if ([v7 isSpatialMedia])
    {
      v8 = 4096;
    }

    else
    {
      v8 = 0;
    }

    types = v8 | types & 0xFFFFEFFF;
  }

  return types;
}

- (BOOL)_ingestAndApplyMetadataChangesFromAdjustments:(id)adjustments updateAdjustmentDictionary:(id)dictionary options:(id)options fullSizeRenderURL:(id)l videoPosterRenderURL:(id)rL isRevertToOriginal:(BOOL)original error:(id *)error
{
  originalCopy = original;
  v165 = *MEMORY[0x1E69E9840];
  adjustmentsCopy = adjustments;
  dictionaryCopy = dictionary;
  optionsCopy = options;
  lCopy = l;
  rLCopy = rL;
  fileManager = [MEMORY[0x1E69BF238] fileManager];
  v16 = objc_initWeak(location, self);

  v17 = objc_alloc(MEMORY[0x1E69BF270]);
  v139[0] = MEMORY[0x1E69E9820];
  v139[1] = 3221225472;
  v139[2] = __163__PLManagedAsset__ingestAndApplyMetadataChangesFromAdjustments_updateAdjustmentDictionary_options_fullSizeRenderURL_videoPosterRenderURL_isRevertToOriginal_error___block_invoke;
  v139[3] = &unk_1E7573318;
  objc_copyWeak(&v141, location);
  v18 = lCopy;
  v140 = v18;
  v126 = [v17 initWithBlock:v139];

  objc_destroyWeak(&v141);
  objc_destroyWeak(location);
  v19 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    uuid = [(PLManagedAsset *)self uuid];
    renderedContentURL = [optionsCopy renderedContentURL];
    renderedVideoComplementContentURL = [optionsCopy renderedVideoComplementContentURL];
    renderedVideoPosterContentURL = [optionsCopy renderedVideoPosterContentURL];
    fileIngestionType = [optionsCopy fileIngestionType];
    isSubstandardRender = [optionsCopy isSubstandardRender];
    v26 = @"NO";
    *location = 138545410;
    *&location[4] = uuid;
    v149 = 2112;
    if (isSubstandardRender)
    {
      v27 = @"YES";
    }

    else
    {
      v27 = @"NO";
    }

    v150 = renderedContentURL;
    if (originalCopy)
    {
      v26 = @"YES";
    }

    v151 = 2112;
    v152 = v18;
    v153 = 2112;
    v154 = renderedVideoComplementContentURL;
    v155 = 2112;
    v156 = renderedVideoPosterContentURL;
    v157 = 2112;
    v158 = rLCopy;
    v159 = 2048;
    v160 = fileIngestionType;
    v161 = 2112;
    v162 = v27;
    v163 = 2112;
    v164 = v26;
    _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_INFO, "Ingest and apply metadata changes for asset %{public}@ from renderedContentURL %@ fullSizeRenderURL %@ renderedVideoComplementContentURL %@ videoPosterContentURL %@ videoPosterRenderURL %@ ingestionType %ld isSubstandardRender %@ isRevertToOriginal %@", location, 0x5Cu);
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setAdjustedStableHash:0];

  [(PLManagedAsset *)self revalidateFaceAreaPoints];
  renderedContentURL2 = [optionsCopy renderedContentURL];
  if (v18)
  {
    v30 = renderedContentURL2 == 0;
  }

  else
  {
    v30 = 1;
  }

  v31 = !v30;

  if (v31)
  {
    pathManager = [(PLManagedObject *)self pathManager];
    capabilities = [pathManager capabilities];

    path = [v18 path];
    stringByDeletingLastPathComponent = [path stringByDeletingLastPathComponent];
    v138 = 0;
    v36 = [fileManager createDirectoryAtPath:stringByDeletingLastPathComponent withIntermediateDirectories:1 attributes:0 error:&v138];
    v37 = v138;

    if ((v36 & 1) == 0)
    {
      v50 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
      {
        *location = 138412546;
        *&location[4] = v18;
        v149 = 2112;
        v150 = v37;
        _os_log_impl(&dword_19BF1F000, v50, OS_LOG_TYPE_ERROR, "Failed to create directory for %@: %@", location, 0x16u);
      }

      v51 = MEMORY[0x1E696ABC0];
      v52 = *MEMORY[0x1E696A278];
      v146[0] = *MEMORY[0x1E696AA08];
      v146[1] = v52;
      v147[0] = v37;
      v147[1] = @"Failed to create directory for full size render";
      v41 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v147 forKeys:v146 count:2];
      v53 = [v51 errorWithDomain:*MEMORY[0x1E69BFF48] code:47011 userInfo:v41];
      goto LABEL_32;
    }

    v38 = MEMORY[0x1E69BF238];
    renderedContentURL3 = [optionsCopy renderedContentURL];
    v137 = 0;
    v40 = [v38 ingestItemAtURL:renderedContentURL3 toURL:v18 type:objc_msgSend(optionsCopy options:"fileIngestionType") capabilities:6 error:{capabilities, &v137}];
    v41 = v137;

    if ((v40 & 1) == 0 && ([optionsCopy isSubstandardRender] & 1) == 0)
    {
      v58 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        renderedContentURL4 = [optionsCopy renderedContentURL];
        *location = 138412546;
        *&location[4] = renderedContentURL4;
        v149 = 2112;
        v150 = v41;
        _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_ERROR, "Failed to ingest %@: %@", location, 0x16u);
      }

      v60 = MEMORY[0x1E696ABC0];
      v61 = *MEMORY[0x1E696A278];
      v144[0] = *MEMORY[0x1E696AA08];
      v144[1] = v61;
      v145[0] = v41;
      v145[1] = @"Failed to ingest full size render";
      v62 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v145 forKeys:v144 count:2];
      v53 = [v60 errorWithDomain:*MEMORY[0x1E69BFF48] code:47011 userInfo:v62];

      goto LABEL_32;
    }

    if (!-[PLManagedAsset isVideo](self, "isVideo") || (([optionsCopy renderedVideoPosterContentURL], v42 = objc_claimAutoreleasedReturnValue(), rLCopy) ? (v43 = v42 == 0) : (v43 = 1), v43 ? (v44 = 0) : (v44 = 1), v42, !v44))
    {
LABEL_44:
      adjustmentSecondaryDataURL = [optionsCopy adjustmentSecondaryDataURL];
      v65 = adjustmentSecondaryDataURL == 0;

      if (v65)
      {
        goto LABEL_47;
      }

      v66 = MEMORY[0x1E695DFF8];
      pathForAdjustmentSecondaryDataFile = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
      v68 = [v66 fileURLWithPath:pathForAdjustmentSecondaryDataFile isDirectory:0];

      v69 = MEMORY[0x1E69BF238];
      adjustmentSecondaryDataURL2 = [optionsCopy adjustmentSecondaryDataURL];
      v135 = 0;
      v71 = [v69 ingestItemAtURL:adjustmentSecondaryDataURL2 toURL:v68 type:objc_msgSend(optionsCopy options:"fileIngestionType") capabilities:6 error:{capabilities, &v135}];
      v41 = v135;

      if (v71)
      {

LABEL_47:
        if (![(PLManagedAsset *)self isPhotoIris])
        {
LABEL_80:

          goto LABEL_81;
        }

        videoCpVisibilityState = [(PLManagedAsset *)self videoCpVisibilityState];
        v72 = MEMORY[0x1E695DFF8];
        pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        v125 = [v72 fileURLWithPath:pathForFullsizeRenderVideoFile isDirectory:0];

        renderedVideoComplementContentURL2 = [optionsCopy renderedVideoComplementContentURL];

        if (renderedVideoComplementContentURL2)
        {
          v75 = MEMORY[0x1E69BF238];
          renderedVideoComplementContentURL3 = [optionsCopy renderedVideoComplementContentURL];
          v134 = 0;
          v77 = [v75 ingestItemAtURL:renderedVideoComplementContentURL3 toURL:v125 type:objc_msgSend(optionsCopy options:"fileIngestionType") capabilities:6 error:{capabilities, &v134}];
          v78 = v134;

          if (v77)
          {

            if ([optionsCopy shouldUpdateAttributes])
            {
              if ([(PLManagedAsset *)self depthType]!= 1 || ([(PLManagedAsset *)self videoCpVisibilityState]& 1) == 0)
              {
                LOWORD(videoCpVisibilityState) = videoCpVisibilityState | 8;
              }

              v79 = [MEMORY[0x1E6987E28] assetWithURL:v125];
              [(PLManagedAsset *)self _updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:v79];
              additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
              unmanagedAdjustment = [additionalAttributes2 unmanagedAdjustment];

              adjustmentRenderTypes = [unmanagedAdjustment adjustmentRenderTypes];
              v82 = [(PLManagedAsset *)self playbackVariationFromAVAsset:v79 isLivePhotoVideoComplement:1];
              v83 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:adjustmentRenderTypes withPlaybackVariation:v82];
              if ([(PLManagedAsset *)self playbackVariation]!= v82)
              {
                [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v82];
              }

              if (adjustmentRenderTypes != v83)
              {
                [unmanagedAdjustment setAdjustmentRenderTypes:v83];
              }

              goto LABEL_77;
            }

            goto LABEL_79;
          }

          if ((PLIsErrorFileNotFound() & 1) == 0)
          {
            v90 = PLPhotoEditGetLog();
            if (os_log_type_enabled(v90, OS_LOG_TYPE_ERROR))
            {
              renderedVideoComplementContentURL4 = [optionsCopy renderedVideoComplementContentURL];
              *location = 138412546;
              *&location[4] = renderedVideoComplementContentURL4;
              v149 = 2112;
              v150 = v78;
              _os_log_impl(&dword_19BF1F000, v90, OS_LOG_TYPE_ERROR, "Nonfatal - Error ingesting video complement %@: %@", location, 0x16u);
            }
          }

          shouldUpdateAttributes = [optionsCopy shouldUpdateAttributes];
        }

        else
        {
          shouldUpdateAttributes = [optionsCopy shouldUpdateAttributes];
        }

        if (shouldUpdateAttributes)
        {
          if ([optionsCopy fileIngestionType] || !videoCpVisibilityState)
          {
            if ((videoCpVisibilityState & 2) == 0)
            {
              v93 = videoCpVisibilityState & 0xFFF6 | 1;
LABEL_78:
              v94 = v93;
              [(PLManagedAsset *)self setVideoCpVisibilityState:v93];
              v95 = objc_opt_class();
              videoCpDurationValue = [(PLManagedAsset *)self videoCpDurationValue];
              isCloudSharedAsset = [(PLManagedAsset *)self isCloudSharedAsset];
              path2 = [v125 path];
              v99 = [v95 isPhotoIrisPlaceholderWithPhotoIris:1 videoCpDuration:videoCpDurationValue isCloudShared:isCloudSharedAsset videoCpFilePath:path2];

              -[PLManagedAsset updatePlaybackStyleWithLivePhotoPlayability:](self, "updatePlaybackStyleWithLivePhotoPlayability:", [objc_opt_class() canPlayPhotoIrisWithPhotoIris:1 photoIrisPlaceholder:v99 hasAdjustments:1 videoCpVisibilityState:v94]);
              goto LABEL_79;
            }

            [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:0];
          }

          else
          {
            v92 = PLMigrationGetLog();
            if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
            {
              *location = 67109120;
              *&location[4] = videoCpVisibilityState;
              _os_log_impl(&dword_19BF1F000, v92, OS_LOG_TYPE_INFO, "The video complement is missing, and we are perserving existing PLVideoComplementVisibilityState on rebuild: %hu", location, 8u);
            }
          }

LABEL_77:
          v93 = videoCpVisibilityState;
          goto LABEL_78;
        }

LABEL_79:

        goto LABEL_80;
      }

      v84 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v84, OS_LOG_TYPE_ERROR))
      {
        adjustmentSecondaryDataURL3 = [optionsCopy adjustmentSecondaryDataURL];
        *location = 138412546;
        *&location[4] = adjustmentSecondaryDataURL3;
        v149 = 2112;
        v150 = v41;
        _os_log_impl(&dword_19BF1F000, v84, OS_LOG_TYPE_ERROR, "Failed to ingest adjustment secondary data %@: %@", location, 0x16u);
      }

      v86 = MEMORY[0x1E696ABC0];
      v87 = *MEMORY[0x1E696A278];
      v142[0] = *MEMORY[0x1E696AA08];
      v142[1] = v87;
      v143[0] = v41;
      v143[1] = @"Failed to ingest adjustment secondary data";
      v88 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v143 forKeys:v142 count:2];
      v53 = [v86 errorWithDomain:*MEMORY[0x1E69BFF48] code:47011 userInfo:v88];

LABEL_32:
      goto LABEL_33;
    }

    v45 = MEMORY[0x1E69BF238];
    renderedVideoPosterContentURL2 = [optionsCopy renderedVideoPosterContentURL];
    v136 = 0;
    v47 = [v45 ingestItemAtURL:renderedVideoPosterContentURL2 toURL:rLCopy type:objc_msgSend(optionsCopy options:"fileIngestionType") capabilities:6 error:{capabilities, &v136}];
    v48 = v136;

    if (v47)
    {
      v49 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_DEBUG))
      {
        *location = 138412290;
        *&location[4] = rLCopy;
        _os_log_impl(&dword_19BF1F000, v49, OS_LOG_TYPE_DEBUG, "Ingested video poster to %@", location, 0xCu);
      }
    }

    else
    {
      if (PLIsErrorFileNotFound())
      {
LABEL_43:

        goto LABEL_44;
      }

      v49 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
      {
        renderedVideoPosterContentURL3 = [optionsCopy renderedVideoPosterContentURL];
        *location = 138412546;
        *&location[4] = renderedVideoPosterContentURL3;
        v149 = 2112;
        v150 = v48;
        _os_log_impl(&dword_19BF1F000, v49, OS_LOG_TYPE_ERROR, "Nonfatal - error ingesting video poster %@: %@", location, 0x16u);
      }
    }

    goto LABEL_43;
  }

LABEL_81:
  if ([optionsCopy shouldUpdateAttributes])
  {
    mainFileURL = [(PLManagedAsset *)self mainFileURL];
    mainFileMetadata = [optionsCopy mainFileMetadata];
    v133 = 0;
    v102 = [(PLManagedAsset *)self updateAttributesFromMainFileURL:mainFileURL mainFileMetadata:mainFileMetadata fullSizeRenderURL:v18 error:&v133];
    v53 = v133;

    if (!v102 || originalCopy)
    {
      if (v102)
      {
        v103 = 1;
        goto LABEL_105;
      }

LABEL_33:
      v54 = v53;
      v55 = v54;
      if (error)
      {
        v56 = v54;
        v57 = 0;
        *error = v55;
      }

      else
      {
        v57 = 0;
      }

      goto LABEL_114;
    }
  }

  else
  {
    v53 = 0;
    v103 = 1;
    if (originalCopy)
    {
      goto LABEL_105;
    }
  }

  if ([optionsCopy shouldUpdateAttributes])
  {
    additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
    unmanagedAdjustment2 = [additionalAttributes3 unmanagedAdjustment];

    if (!unmanagedAdjustment2)
    {
LABEL_103:

      goto LABEL_104;
    }

    adjustmentRenderTypes2 = [unmanagedAdjustment2 adjustmentRenderTypes];
    v106 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:[(PLManagedAsset *)self updateAdjustmentRenderTypes:adjustmentRenderTypes2 withDepthType:[(PLManagedAsset *)self depthType]] withAdjustmentState:[(PLManagedAsset *)self cameraProcessingAdjustmentState]];
    v107 = [dictionaryCopy objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
    v108 = [dictionaryCopy objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
    v109 = [dictionaryCopy objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
    v110 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v106 withAdjustmentData:v107 formatIdentifier:v108 formatVersion:v109];

    if (v18)
    {
      if ([(PLManagedAsset *)self isVideo])
      {
        objectValue2 = [MEMORY[0x1E6987E28] assetWithURL:v18];
        if (objectValue2)
        {
          v112 = [(PLManagedAsset *)self playbackVariationFromAVAsset:objectValue2 isLivePhotoVideoComplement:0];
          v113 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v110 withPlaybackVariation:v112];
          if ([(PLManagedAsset *)self playbackVariation]!= v112)
          {
            [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v112];
          }

          v110 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v113 forSpatialTypeOfAVAsset:objectValue2];
        }

        else
        {
          v115 = PLPhotoEditGetLog();
          if (os_log_type_enabled(v115, OS_LOG_TYPE_ERROR))
          {
            *location = 138412290;
            *&location[4] = v18;
            _os_log_impl(&dword_19BF1F000, v115, OS_LOG_TYPE_ERROR, "Unable to create AVAssest from %@", location, 0xCu);
          }

          objectValue2 = 0;
        }
      }

      else
      {
        if (![(PLManagedAsset *)self isPhoto])
        {
          goto LABEL_101;
        }

        objectValue = [v126 objectValue];
        v110 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v110 withMetadata:objectValue];

        objectValue2 = [v126 objectValue];
        [(PLManagedAsset *)self setSpatialTypeFromMetadata:objectValue2];
      }
    }

LABEL_101:
    if (adjustmentRenderTypes2 != v110)
    {
      [unmanagedAdjustment2 setAdjustmentRenderTypes:v110];
    }

    goto LABEL_103;
  }

LABEL_104:
  additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
  unmanagedAdjustment3 = [additionalAttributes4 unmanagedAdjustment];

  [(PLManagedAsset *)self _updateAdjustmentFromAssetAdjustment:adjustmentsCopy unmanagedAdjustment:unmanagedAdjustment3 fullSizeRenderURL:v18 options:optionsCopy];
  v103 = 0;
LABEL_105:
  if (-[PLManagedAsset isPhoto](self, "isPhoto") && [optionsCopy shouldUpdateAttributes])
  {
    mainFileMetadata2 = [optionsCopy mainFileMetadata];
    [(PLManagedAsset *)self updatePanoramosityWithMetadata:mainFileMetadata2];
  }

  if ((v103 & 1) != 0 || ![optionsCopy fileIngestionType])
  {
    v57 = 1;
    v55 = v53;
  }

  else
  {
    additionalAttributes5 = [(PLManagedAsset *)self additionalAttributes];
    unmanagedAdjustment4 = [additionalAttributes5 unmanagedAdjustment];

    if ([unmanagedAdjustment4 adjustmentRenderTypes])
    {
      v121 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(unmanagedAdjustment4, "adjustmentRenderTypes")}];
      [dictionaryCopy setObject:v121 forKey:*MEMORY[0x1E69BF390]];
    }

    [(PLManagedAsset *)self _writeOutAdjustmentsToFile:dictionaryCopy];

    v55 = v53;
    v57 = 1;
  }

LABEL_114:

  return v57;
}

id __163__PLManagedAsset__ingestAndApplyMetadataChangesFromAdjustments_updateAdjustmentDictionary_options_fullSizeRenderURL_videoPosterRenderURL_isRevertToOriginal_error___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v3 = [objc_alloc(MEMORY[0x1E69C0718]) initWithImageURL:*(a1 + 32) contentType:0 options:13 timeZoneLookup:0 cacheImageSource:1 cacheImageData:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)_updateDerivativesAndThumbnails:(BOOL)thumbnails withPreviewImage:(id)image thumbnailImage:(id)thumbnailImage metadata:(id)metadata didRevertToOriginal:(BOOL)original updateInternalResources:(BOOL)resources isSubstandardRender:(BOOL)render isDeferred:(BOOL)self0
{
  resourcesCopy = resources;
  originalCopy = original;
  thumbnailsCopy = thumbnails;
  renderCopy2 = render;
  v108 = *MEMORY[0x1E69E9840];
  imageCopy = image;
  thumbnailImageCopy = thumbnailImage;
  metadataCopy = metadata;
  if (thumbnailsCopy)
  {
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    libraryServicesManager = [photoLibrary libraryServicesManager];
    modelMigrator = [libraryServicesManager modelMigrator];
    isPostProcessingLightweightMigration = [modelMigrator isPostProcessingLightweightMigration];

    if ((isPostProcessingLightweightMigration & 1) == 0)
    {
      v73 = metadataCopy;
      v75 = thumbnailImageCopy;
      v79 = imageCopy;
      v77 = originalCopy;
      if (!originalCopy)
      {
        fileManager = [MEMORY[0x1E69BF238] fileManager];
        v23 = objc_alloc_init(MEMORY[0x1E695DFA8]);
        pathForLargeThumbnailFile = [(PLManagedAsset *)self pathForLargeThumbnailFile];
        [v23 pl_addObjectIfNotNil:pathForLargeThumbnailFile];

        pathForMediumThumbnailFile = [(PLManagedAsset *)self pathForMediumThumbnailFile];
        [v23 pl_addObjectIfNotNil:pathForMediumThumbnailFile];

        pathForLargeSizeImageFile = [(PLManagedAsset *)self pathForLargeSizeImageFile];
        [v23 pl_addObjectIfNotNil:pathForLargeSizeImageFile];

        pathForSubstandardFullsizeRenderImageFile = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
        [v23 pl_addObjectIfNotNil:pathForSubstandardFullsizeRenderImageFile];

        v97 = 0u;
        v98 = 0u;
        v95 = 0u;
        v96 = 0u;
        v28 = v23;
        v29 = [v28 countByEnumeratingWithState:&v95 objects:v107 count:16];
        if (v29)
        {
          v30 = v29;
          v31 = *v96;
          do
          {
            for (i = 0; i != v30; ++i)
            {
              if (*v96 != v31)
              {
                objc_enumerationMutation(v28);
              }

              v33 = *(*(&v95 + 1) + 8 * i);
              if ([fileManager fileExistsAtPath:v33])
              {
                v34 = PLBackendGetLog();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
                {
                  uuid = [(PLManagedAsset *)self uuid];
                  *buf = 138412546;
                  v100 = v33;
                  v101 = 2114;
                  v102 = uuid;
                  _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_INFO, "Removing %@ for asset %{public}@", buf, 0x16u);
                }

                v94 = 0;
                v36 = [fileManager removeItemAtPath:v33 error:&v94];
                v37 = v94;
                if ((v36 & 1) == 0)
                {
                  v38 = PLBackendGetLog();
                  if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 138412546;
                    v100 = v33;
                    v101 = 2112;
                    v102 = v37;
                    _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_ERROR, "Failed to remove %@: %@", buf, 0x16u);
                  }
                }
              }
            }

            v30 = [v28 countByEnumeratingWithState:&v95 objects:v107 count:16];
          }

          while (v30);
        }
      }

      [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:3];
      [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:4];
      modernResources = [(PLManagedAsset *)self modernResources];
      v40 = [modernResources objectsPassingTest:&__block_literal_global_1062];

      v92 = 0u;
      v93 = 0u;
      v90 = 0u;
      v91 = 0u;
      v41 = v40;
      v42 = [v41 countByEnumeratingWithState:&v90 objects:v106 count:16];
      if (v42)
      {
        v43 = v42;
        v44 = *v91;
        do
        {
          for (j = 0; j != v43; ++j)
          {
            if (*v91 != v44)
            {
              objc_enumerationMutation(v41);
            }

            v46 = *(*(&v90 + 1) + 8 * j);
            if ([v46 isLocallyAvailable])
            {
              v47 = PLBackendGetLog();
              if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
              {
                recipeID = [v46 recipeID];
                uuid2 = [(PLManagedAsset *)self uuid];
                *buf = 134349314;
                v100 = recipeID;
                v101 = 2114;
                v102 = uuid2;
                _os_log_impl(&dword_19BF1F000, v47, OS_LOG_TYPE_INFO, "Marking resource with recipe ID %{public}lu as locally unavailable for asset %{public}@", buf, 0x16u);
              }
            }

            [v46 markAsNotLocallyAvailable];
          }

          v43 = [v41 countByEnumeratingWithState:&v90 objects:v106 count:16];
        }

        while (v43);
      }

      imageCopy = v79;
      metadataCopy = v73;
      thumbnailImageCopy = v75;
      if (![(PLManagedAsset *)self isPlaceholderAsset])
      {
        BYTE2(v72) = 0;
        LOWORD(v72) = 256;
        [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:v79 fromImageSource:v75 imageData:0 metadata:0 forceSRGBConversion:v73 forFinalCameraImage:0 saveCameraPreviewWellImage:v72 reduceProcessingForIngest:?];
      }

      originalCopy = v77;
      renderCopy2 = render;
    }
  }

  if (renderCopy2 && deferred && !originalCopy)
  {
    v74 = metadataCopy;
    v76 = thumbnailImageCopy;
    v78 = originalCopy;
    v80 = imageCopy;
    v88 = 0u;
    v89 = 0u;
    v86 = 0u;
    v87 = 0u;
    modernResources2 = [(PLManagedAsset *)self modernResources];
    v51 = [modernResources2 countByEnumeratingWithState:&v86 objects:v105 count:16];
    if (v51)
    {
      v52 = v51;
      v53 = *v87;
      v54 = 0x1E69BF000uLL;
      v82 = *v87;
      do
      {
        for (k = 0; k != v52; ++k)
        {
          if (*v87 != v53)
          {
            objc_enumerationMutation(modernResources2);
          }

          v56 = *(*(&v86 + 1) + 8 * k);
          if ([v56 isLocallyAvailable] && objc_msgSend(v56, "isAdjustedFullSizeRenderResource"))
          {
            v57 = PLPhotoEditGetLog();
            if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
            {
              fileURL = [v56 fileURL];
              fileURL2 = [v56 fileURL];
              lastPathComponent = [fileURL2 lastPathComponent];
              [(PLManagedAsset *)self uuid];
              v61 = modernResources2;
              v63 = v62 = v54;
              *buf = 138412802;
              v100 = fileURL;
              v101 = 2114;
              v102 = lastPathComponent;
              v103 = 2114;
              v104 = v63;
              _os_log_impl(&dword_19BF1F000, v57, OS_LOG_TYPE_INFO, "Removing stale render at path %@ (filename: %{public}@) for asset %{public}@ due to deferred rendering", buf, 0x20u);

              v54 = v62;
              modernResources2 = v61;
              v53 = v82;
            }

            v64 = *(v54 + 568);
            fileURL3 = [v56 fileURL];
            v85 = 0;
            LOBYTE(v64) = [v64 removeItemAtURL:fileURL3 error:&v85];
            v66 = v85;

            if ((v64 & 1) == 0)
            {
              v67 = PLPhotoEditGetLog();
              if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
              {
                fileURL4 = [v56 fileURL];
                *buf = 138543618;
                v100 = fileURL4;
                v101 = 2112;
                v102 = v66;
                _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "Failed to remove %{public}@: %@", buf, 0x16u);
              }
            }

            [v56 markAsNotLocallyAvailable];
          }
        }

        v52 = [modernResources2 countByEnumeratingWithState:&v86 objects:v105 count:16];
      }

      while (v52);
    }

    imageCopy = v80;
    originalCopy = v78;
    metadataCopy = v74;
    thumbnailImageCopy = v76;
  }

  if (resourcesCopy)
  {
    [(PLManagedAsset *)self deleteAdjustedResources];
    v84 = 0;
    v69 = [PLResourceInstaller installInternalResourcesForExistingAsset:self assumeNoExistingResources:0 referencedResourceURLs:0 error:&v84];
    v70 = v84;
    if (!v69)
    {
      v71 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v71, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v100 = v70;
        _os_log_impl(&dword_19BF1F000, v71, OS_LOG_TYPE_ERROR, "Unable to install resources after adjustment change: %@", buf, 0xCu);
      }
    }

    if (originalCopy)
    {
      [(PLManagedAsset *)self reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker];
    }
  }
}

uint64_t __166__PLManagedAsset__updateDerivativesAndThumbnails_withPreviewImage_thumbnailImage_metadata_didRevertToOriginal_updateInternalResources_isSubstandardRender_isDeferred___block_invoke(uint64_t a1, void *a2)
{
  v2 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(a2, "recipeID")}];
  v3 = [&unk_1F0FBF490 containsObject:v2];

  return v3;
}

- (void)removeComputeResourceWithRecipeID:(unsigned int)d atPath:(id)path
{
  v18 = *MEMORY[0x1E69E9840];
  pathCopy = path;
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __59__PLManagedAsset_removeComputeResourceWithRecipeID_atPath___block_invoke;
  v14[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  dCopy = d;
  v7 = [(PLManagedAsset *)self persistedResourcesMatching:v14];
  anyObject = [v7 anyObject];

  if (anyObject)
  {
    [anyObject deleteResource];
  }

  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v13 = 0;
  v10 = [defaultManager removeItemAtPath:pathCopy error:&v13];
  v11 = v13;

  if ((v10 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
  {
    v12 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v17 = pathCopy;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Error removing file at path: '%@'", buf, 0xCu);
    }
  }
}

BOOL __59__PLManagedAsset_removeComputeResourceWithRecipeID_atPath___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 recipeID] == *(a1 + 32) && objc_msgSend(v3, "resourceType") == 14;

  return v4;
}

- (void)_removeComputeResourcesOnEdit
{
  v18 = *MEMORY[0x1E69E9840];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v3 = [&unk_1F0FBF478 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v14;
    do
    {
      v6 = 0;
      do
      {
        if (*v14 != v5)
        {
          objc_enumerationMutation(&unk_1F0FBF478);
        }

        unsignedIntValue = [*(*(&v13 + 1) + 8 * v6) unsignedIntValue];
        if ((unsignedIntValue - 327687) <= 0xE)
        {
          if (((1 << (unsignedIntValue - 7)) & 0x5500) != 0)
          {
            v8 = unsignedIntValue;
            pathForWallpaperComputeResourcesFile = [(PLManagedAsset *)self pathForAlchemistV2ResourceFileWithRecipeID:unsignedIntValue];
            selfCopy3 = self;
            v11 = v8;
LABEL_9:
            [(PLManagedAsset *)selfCopy3 removeComputeResourceWithRecipeID:v11 atPath:pathForWallpaperComputeResourcesFile];

            goto LABEL_10;
          }

          if (unsignedIntValue == 327687)
          {
            pathForWallpaperComputeResourcesFile = [(PLManagedAsset *)self pathForWallpaperComputeResourcesFile];
            selfCopy3 = self;
            v11 = 327687;
            goto LABEL_9;
          }

          if (unsignedIntValue == 327693)
          {
            pathForWallpaperComputeResourcesFile = [(PLManagedAsset *)self pathForGenerativePlaygroundFaceResourcesFile];
            v11 = 327693;
            selfCopy3 = self;
            goto LABEL_9;
          }
        }

LABEL_10:
        ++v6;
      }

      while (v4 != v6);
      v12 = [&unk_1F0FBF478 countByEnumeratingWithState:&v13 objects:v17 count:16];
      v4 = v12;
    }

    while (v12);
  }
}

- (void)setAdjustments:(id)adjustments options:(id)options
{
  v199 = *MEMORY[0x1E69E9840];
  adjustmentsCopy = adjustments;
  optionsCopy = options;
  selfCopy = self;
  if ([(PLManagedAsset *)self isVideo]|| [(PLManagedAsset *)self isPhoto])
  {
    oslog = [adjustmentsCopy adjustmentFormatIdentifier];
    adjustmentFormatVersion = [adjustmentsCopy adjustmentFormatVersion];
    fileIngestionType = [optionsCopy fileIngestionType];
    if (![(PLManagedAsset *)self hasAdjustments]&& !oslog)
    {
LABEL_190:

      goto LABEL_191;
    }

    v7 = fileIngestionType == 0;
    adjustmentTimestamp = [adjustmentsCopy adjustmentTimestamp];
    if (!adjustmentTimestamp)
    {
      adjustmentTimestamp = [MEMORY[0x1E695DF00] date];
      [adjustmentsCopy setAdjustmentTimestamp:adjustmentTimestamp];
      v7 = 0;
    }

    obj = objc_opt_class();
    objc_sync_enter(obj);
    fileManager = [MEMORY[0x1E69BF238] fileManager];
    v186 = 0;
    v187 = &v186;
    v188 = 0x2020000000;
    v189 = 0;
    uUIDString = [MEMORY[0x1E69BF320] UUIDString];
    v8 = PLImageManagerGetLog();
    spid = os_signpost_id_generate(v8);
    v9 = v8;

    v10 = v9;
    v11 = v10;
    if (spid - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v10))
    {
      *buf = 138543362;
      *&buf[4] = uUIDString;
      _os_signpost_emit_with_name_impl(&dword_19BF1F000, v11, OS_SIGNPOST_INTERVAL_BEGIN, spid, "AssetSetAdjustments", "adjustmentUuid = %{public}@", buf, 0xCu);
    }

    v155 = v11;
    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v196 = __Block_byref_object_copy__14821;
    v197 = __Block_byref_object_dispose__14822;
    v198 = 0;
    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      v12 = objc_alloc(MEMORY[0x1E69BF298]);
      uuid = [(PLManagedAsset *)self uuid];
      bundleScope = [(PLManagedAsset *)self bundleScope];
      identifier = [*MEMORY[0x1E6982F68] identifier];
      v16 = [v12 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:2 resourceType:31];

      pathManager = [(PLManagedObject *)self pathManager];
      v182[0] = MEMORY[0x1E69E9820];
      v182[1] = 3221225472;
      v182[2] = __41__PLManagedAsset_setAdjustments_options___block_invoke;
      v182[3] = &unk_1E75678B0;
      v184 = buf;
      v185 = &v186;
      v183 = fileManager;
      [pathManager obtainAccessAndWaitWithFileWithIdentifier:v16 mode:2 toURLWithHandler:v182];

      v156 = 0;
      data = v183;
    }

    else
    {
      pathForAdjustmentDirectory = [(PLManagedAsset *)self pathForAdjustmentDirectory];
      v21 = [(__CFString *)pathForAdjustmentDirectory stringByAppendingPathComponent:@"in_flight"];
      v156 = pathForAdjustmentDirectory;
      v22 = *(*&buf[8] + 40);
      *(*&buf[8] + 40) = v21;

      if (v7)
      {
        goto LABEL_21;
      }

      v181 = 0;
      v23 = [fileManager createDirectoryAtPath:pathForAdjustmentDirectory withIntermediateDirectories:1 attributes:0 error:&v181];
      v16 = v181;
      if ((v23 & 1) == 0)
      {
        v24 = PLBackendGetLog();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          *v191 = 138412546;
          v192 = v156;
          v193 = 2112;
          v194 = v16;
          _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Failed to create directory at %@: %@", v191, 0x16u);
        }
      }

      v25 = *(*&buf[8] + 40);
      data = [MEMORY[0x1E695DEF0] data];
      v26 = [fileManager createFileAtPath:v25 contents:data attributes:0];
      *(v187 + 24) = v26;
    }

LABEL_21:
    dictionary = [MEMORY[0x1E695DF90] dictionary];
    v27 = objc_opt_class();
    renderedContentURL = [optionsCopy renderedContentURL];
    pathExtension = [renderedContentURL pathExtension];
    v159 = [v27 uniformTypeIdentifierFromPathExtension:pathExtension assetType:{-[PLManagedAsset kind](self, "kind")}];

    v163 = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:v159];
    if (oslog)
    {
      v30 = adjustmentFormatVersion == 0;
    }

    else
    {
      v30 = 1;
    }

    v31 = !v30;
    v162 = v31;
    if (!v30)
    {
      if ([optionsCopy isDeferred])
      {
        deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
        if (deferredProcessingNeeded <= 9 && ((1 << deferredProcessingNeeded) & 0x315) != 0 && ![(PLManagedAsset *)self isPhotoIrisPlaceholder])
        {
          [(PLManagedAsset *)self setDeferredProcessingNeeded:2];
          photoLibrary = [(PLManagedObject *)self photoLibrary];
          libraryServicesManager = [photoLibrary libraryServicesManager];
          backgroundJobService = [libraryServicesManager backgroundJobService];
          photoLibrary2 = [(PLManagedObject *)self photoLibrary];
          v37 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
          [backgroundJobService signalBackgroundProcessingNeededOnLibrary:photoLibrary2 workerTypes:v37];
        }
      }

      else if ([(PLManagedAsset *)self deferredProcessingNeeded]== 2 || [(PLManagedAsset *)self deferredProcessingNeeded]== 9)
      {
        [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
      }

      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];

      if (!unmanagedAdjustment)
      {
        managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
        unmanagedAdjustment = [(PLManagedObject *)PLUnmanagedAdjustment insertInManagedObjectContext:managedObjectContext];

        additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
        [additionalAttributes2 setUnmanagedAdjustment:unmanagedAdjustment];
      }

      [(__CFString *)unmanagedAdjustment setUuid:uUIDString];
      if ([optionsCopy isSubstandardRender])
      {
        if ([optionsCopy isDeferred])
        {
          [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
        }

        else
        {
          [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
        }
        v53 = ;

        v74 = PLBackendGetLog();
        if (os_log_type_enabled(v74, OS_LOG_TYPE_INFO))
        {
          isDeferred = [optionsCopy isDeferred];
          v76 = @"NO";
          if (isDeferred)
          {
            v76 = @"YES";
          }

          *v191 = 138412546;
          v192 = v53;
          v193 = 2112;
          v194 = v76;
          _os_log_impl(&dword_19BF1F000, v74, OS_LOG_TYPE_INFO, "Updating destinationPathForRenderedImageContent to substandardRender path: %@ deferred: %@", v191, 0x16u);
        }
      }

      else
      {
        v53 = v163;
      }

      v77 = +[PLManagedAsset adjustmentBaseVersionFromPFAdjustmentsBaseVersion:](PLManagedAsset, "adjustmentBaseVersionFromPFAdjustmentsBaseVersion:", [adjustmentsCopy adjustmentBaseVersion]);
      renderedContentURL2 = [optionsCopy renderedContentURL];
      v79 = renderedContentURL2 == 0;

      if (!v79 && !v7)
      {
        penultimateRenderedJPEGData = [optionsCopy penultimateRenderedJPEGData];
        penultimateRenderedVideoContentURL = [optionsCopy penultimateRenderedVideoContentURL];
        penultimateRenderedVideoComplementContentURL = [optionsCopy penultimateRenderedVideoComplementContentURL];
        v77 = -[PLManagedAsset _prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:penultimateRenderedJPEGData:penultimateRenderedVideoContentURL:penultimateRenderedVideoComplementContentURL:fileIngestionType:](self, "_prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:penultimateRenderedJPEGData:penultimateRenderedVideoContentURL:penultimateRenderedVideoComplementContentURL:fileIngestionType:", v77, penultimateRenderedJPEGData, penultimateRenderedVideoContentURL, penultimateRenderedVideoComplementContentURL, [optionsCopy fileIngestionType]);
      }

      editorBundleID = [adjustmentsCopy editorBundleID];
      v84 = editorBundleID;
      v85 = &stru_1F0F06D80;
      if (editorBundleID)
      {
        v85 = editorBundleID;
      }

      metadataFromMediaPropertiesOrOriginalResource = v85;

      if (!v7)
      {
        [dictionary setObject:oslog forKey:*MEMORY[0x1E69BF380]];
        [dictionary setObject:adjustmentFormatVersion forKey:*MEMORY[0x1E69BF388]];
        v87 = [MEMORY[0x1E696AD98] numberWithInteger:v77];
        [dictionary setObject:v87 forKey:*MEMORY[0x1E69BF368]];

        [dictionary setObject:metadataFromMediaPropertiesOrOriginalResource forKey:*MEMORY[0x1E69BF378]];
        [dictionary setObject:adjustmentTimestamp forKey:*MEMORY[0x1E69BF398]];
        adjustmentData = [adjustmentsCopy adjustmentData];
        if (adjustmentData)
        {
          [dictionary setObject:adjustmentData forKey:*MEMORY[0x1E69BF370]];
        }
      }

      [(PLManagedAsset *)self setEditorBundleID:metadataFromMediaPropertiesOrOriginalResource];
      adjustmentRenderTypes = [adjustmentsCopy adjustmentRenderTypes];
      [(PLManagedAsset *)self setAssetAdjustmentsStateFromAdjustmentRenderType:adjustmentRenderTypes];
      [(__CFString *)unmanagedAdjustment setAdjustmentRenderTypes:adjustmentRenderTypes];
      [(__CFString *)unmanagedAdjustment setAdjustmentFormatIdentifier:oslog];
      [(__CFString *)unmanagedAdjustment setAdjustmentFormatVersion:adjustmentFormatVersion];
      v90 = [MEMORY[0x1E696AD98] numberWithInteger:v77];
      [(__CFString *)unmanagedAdjustment setAdjustmentBaseImageFormat:v90];

      [(__CFString *)unmanagedAdjustment setAdjustmentTimestamp:adjustmentTimestamp];
      v91 = SBSCopyLocalizedApplicationNameForDisplayIdentifier();
      [(__CFString *)unmanagedAdjustment setEditorLocalizedName:v91];
      v92 = PLBackendGetLog();
      if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
      {
        uuid2 = [(PLManagedAsset *)selfCopy uuid];
        *v191 = 138412546;
        v192 = unmanagedAdjustment;
        v193 = 2114;
        v194 = uuid2;
        _os_log_impl(&dword_19BF1F000, v92, OS_LOG_TYPE_INFO, "Setting unmanaged adjustment %@ to asset %{public}@", v191, 0x16u);
      }

      if ([(PLManagedAsset *)selfCopy isPhoto])
      {
        penultimateRenderedJPEGData2 = [optionsCopy penultimateRenderedJPEGData];
        if (penultimateRenderedJPEGData2)
        {
          penultimateRenderedJPEGData3 = [optionsCopy penultimateRenderedJPEGData];
          v96 = penultimateRenderedJPEGData3;
        }

        else
        {
          v100 = MEMORY[0x1E695DEF0];
          penultimateRenderedJPEGData3 = [(PLManagedAsset *)selfCopy pathForPenultimateFullsizeRenderImageFile];
          v96 = [v100 dataWithContentsOfFile:penultimateRenderedJPEGData3];
        }

        v101 = objc_opt_class();
        adjustmentData2 = [adjustmentsCopy adjustmentData];
        v102 = [v101 cloudAdjustmentFingerprintWithAdjustmentDataBlob:adjustmentData2 formatIdentifier:oslog formatVersion:adjustmentFormatVersion editorBundleID:metadataFromMediaPropertiesOrOriginalResource baseVersion:v77 baseImageData:v96];
      }

      else
      {
        penultimateRenderedVideoContentURL2 = [optionsCopy penultimateRenderedVideoContentURL];
        if (penultimateRenderedVideoContentURL2)
        {
          penultimateRenderedVideoContentURL3 = [optionsCopy penultimateRenderedVideoContentURL];
          adjustmentData2 = penultimateRenderedVideoContentURL3;
        }

        else
        {
          v103 = MEMORY[0x1E695DFF8];
          penultimateRenderedVideoContentURL3 = [(PLManagedAsset *)selfCopy pathForPenultimateFullsizeRenderVideoFile];
          adjustmentData2 = [v103 fileURLWithPath:penultimateRenderedVideoContentURL3];
        }

        path = [(__CFString *)adjustmentData2 path];
        v105 = [fileManager fileExistsAtPath:path];

        if (v105)
        {
          nonPrivateFingerprintScheme = [MEMORY[0x1E6994AE0] nonPrivateFingerprintScheme];
          v180 = 0;
          v96 = [nonPrivateFingerprintScheme fingerPrintForFileAtURL:adjustmentData2 error:&v180];
          v107 = v180;

          if (!v96)
          {
            v108 = PLBackendGetLog();
            if (os_log_type_enabled(v108, OS_LOG_TYPE_ERROR))
            {
              *v191 = 138412546;
              v192 = adjustmentData2;
              v193 = 2112;
              v194 = v107;
              _os_log_impl(&dword_19BF1F000, v108, OS_LOG_TYPE_ERROR, "Failed to calculate base fingerprint for penultimate video at url: %@, error: %@", v191, 0x16u);
            }
          }
        }

        else
        {
          v96 = 0;
        }

        v109 = objc_opt_class();
        adjustmentData3 = [adjustmentsCopy adjustmentData];
        v102 = [v109 cloudAdjustmentFingerprintWithAdjustmentDataBlob:adjustmentData3 formatIdentifier:oslog formatVersion:adjustmentFormatVersion editorBundleID:metadataFromMediaPropertiesOrOriginalResource baseVersion:v77 baseFingerprint:v96];
      }

      v111 = PLBackendGetLog();
      if (os_log_type_enabled(v111, OS_LOG_TYPE_INFO))
      {
        *v191 = 138412290;
        v192 = v102;
        _os_log_impl(&dword_19BF1F000, v111, OS_LOG_TYPE_INFO, "Calculating cloud adjustment fingerprint at set time: %@", v191, 0xCu);
      }

      [(__CFString *)unmanagedAdjustment setOtherAdjustmentsFingerprint:v102];
      v163 = v53;
      goto LABEL_126;
    }

    if ([optionsCopy isDeferred])
    {
      v38 = PLBackendGetLog();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        uuid3 = [(PLManagedAsset *)self uuid];
        *v191 = 138543362;
        v192 = uuid3;
        _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_ERROR, "Unsupported adjustment, revert and deferred are incompatible for asset %{public}@", v191, 0xCu);
      }
    }

    [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
    [(PLManagedAsset *)self deleteAdjustedResources];
    if (v7)
    {
LABEL_69:
      [(PLManagedAsset *)selfCopy setEditorBundleID:0];
      [(PLManagedAsset *)selfCopy setAdjustmentsState:0];
      additionalAttributes3 = [(PLManagedAsset *)selfCopy additionalAttributes];
      unmanagedAdjustment = [additionalAttributes3 unmanagedAdjustment];

      v62 = PLBackendGetLog();
      if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
      {
        uuid4 = [(PLManagedAsset *)selfCopy uuid];
        *v191 = 138412546;
        v192 = unmanagedAdjustment;
        v193 = 2114;
        v194 = uuid4;
        _os_log_impl(&dword_19BF1F000, v62, OS_LOG_TYPE_INFO, "Reverting unmanaged adjustment %@ for asset %{public}@", v191, 0x16u);
      }

      v64 = PLPhotosStatusGetLog();
      if (os_log_type_enabled(v64, OS_LOG_TYPE_DEFAULT))
      {
        uuid5 = [(PLManagedAsset *)selfCopy uuid];
        *v191 = 138412546;
        v192 = unmanagedAdjustment;
        v193 = 2114;
        v194 = uuid5;
        _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEFAULT, "Reverting unmanaged adjustment %@ for asset %{public}@", v191, 0x16u);
      }

      v66 = PLPhotosStatusGetLog();
      if (os_log_type_enabled(v66, OS_LOG_TYPE_DEFAULT))
      {
        callStackSymbols = [MEMORY[0x1E696AF00] callStackSymbols];
        *v191 = 138412290;
        v192 = callStackSymbols;
        _os_log_impl(&dword_19BF1F000, v66, OS_LOG_TYPE_DEFAULT, "%@", v191, 0xCu);
      }

      if (unmanagedAdjustment)
      {
        [(__CFString *)unmanagedAdjustment setAdjustmentFormatIdentifier:0];
        [(__CFString *)unmanagedAdjustment setAdjustmentFormatVersion:0];
        [(__CFString *)unmanagedAdjustment setAdjustmentTimestamp:adjustmentTimestamp];
        [(__CFString *)unmanagedAdjustment setAdjustmentRenderTypes:0];
        [(__CFString *)unmanagedAdjustment setOtherAdjustmentsFingerprint:0];
        [(__CFString *)unmanagedAdjustment setAdjustmentBaseImageFormat:&unk_1F0FBB248];
      }

      if (-[PLManagedAsset isPhotoIris](selfCopy, "isPhotoIris") && [optionsCopy shouldUpdateAttributes])
      {
        if ([(PLManagedAsset *)selfCopy playbackStyle]!= 3)
        {
          [(PLManagedAsset *)selfCopy setPlaybackStyle:3];
        }

        pathForVideoComplementFile = [(PLManagedAsset *)selfCopy pathForVideoComplementFile];
        v69 = MEMORY[0x1E6987E28];
        v70 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForVideoComplementFile];
        v71 = [v69 assetWithURL:v70];

        if (v71)
        {
          v72 = PLBackendGetLog();
          if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
          {
            uuid6 = [(PLManagedAsset *)selfCopy uuid];
            *v191 = 138543618;
            v192 = uuid6;
            v193 = 2112;
            v194 = pathForVideoComplementFile;
            _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_INFO, "Updating Live Photo properties for asset %{public}@ from %@", v191, 0x16u);
          }

          [(PLManagedAsset *)selfCopy _updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:v71];
          [(PLManagedAsset *)selfCopy updatePlaybackVariationAndLoopingStyleFromAVAsset:v71];
        }

        else
        {
          v112 = PLBackendGetLog();
          if (os_log_type_enabled(v112, OS_LOG_TYPE_ERROR))
          {
            uuid7 = [(PLManagedAsset *)selfCopy uuid];
            *v191 = 138412546;
            v192 = pathForVideoComplementFile;
            v193 = 2114;
            v194 = uuid7;
            _os_log_impl(&dword_19BF1F000, v112, OS_LOG_TYPE_ERROR, "Failed to create avAsset from %@ to update Live Photo properties for asset %{public}@", v191, 0x16u);
          }
        }
      }

      if (![(PLManagedAsset *)selfCopy isPhoto])
      {
LABEL_127:

        if (-[PLManagedAsset isPhoto](selfCopy, "isPhoto") || [optionsCopy isDeferred])
        {
          fileURLForFullsizeRenderVideo = 0;
          if (v163 && oslog && adjustmentFormatVersion)
          {
            fileURLForFullsizeRenderVideo = [MEMORY[0x1E695DFF8] fileURLWithPath:v163 isDirectory:0];
          }

          if ([(PLManagedAsset *)selfCopy isVideo])
          {
            renderedVideoPosterContentURL = [optionsCopy renderedVideoPosterContentURL];
            v116 = renderedVideoPosterContentURL == 0;

            if (!v116)
            {
              v117 = MEMORY[0x1E695DFF8];
              pathForTransientVideoPosterFramePreview = [(PLManagedAsset *)selfCopy pathForTransientVideoPosterFramePreview];
              fileURLForFullsizeRenderImage = [v117 fileURLWithPath:pathForTransientVideoPosterFramePreview];

              goto LABEL_141;
            }
          }
        }

        else
        {
          renderedContentURL3 = [optionsCopy renderedContentURL];
          if (renderedContentURL3)
          {
            isVideo = [(PLManagedAsset *)selfCopy isVideo];

            if (isVideo)
            {
              fileURLForFullsizeRenderVideo = [(PLManagedAsset *)selfCopy fileURLForFullsizeRenderVideo];
              fileURLForFullsizeRenderImage = [(PLManagedAsset *)selfCopy fileURLForFullsizeRenderImage];
              goto LABEL_141;
            }
          }

          fileURLForFullsizeRenderVideo = 0;
        }

        fileURLForFullsizeRenderImage = 0;
LABEL_141:
        [(PLManagedAsset *)selfCopy _ingestAndApplyMetadataChangesFromAdjustments:adjustmentsCopy updateAdjustmentDictionary:dictionary options:optionsCopy fullSizeRenderURL:fileURLForFullsizeRenderVideo videoPosterRenderURL:fileURLForFullsizeRenderImage isRevertToOriginal:v162 ^ 1u error:0];
        v122 = v155;
        v123 = v122;
        if (spid - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v122))
        {
          *v191 = 0;
          _os_signpost_emit_with_name_impl(&dword_19BF1F000, v123, OS_SIGNPOST_INTERVAL_END, spid, "AssetSetAdjustments", "", v191, 2u);
        }

        date = [MEMORY[0x1E695DF00] date];
        [(PLManagedAsset *)selfCopy setModificationDate:date];

        if ([optionsCopy shouldOverwriteFullSizeRenderSize])
        {
          [optionsCopy fullSizeRenderSize];
          [(PLManagedAsset *)selfCopy setWidth:v125];
          [optionsCopy fullSizeRenderSize];
          [(PLManagedAsset *)selfCopy setHeight:v126];
          if ([(PLManagedAsset *)selfCopy isPhoto])
          {
            mainFileMetadata = [optionsCopy mainFileMetadata];
            [(PLManagedAsset *)selfCopy updatePanoramosityWithMetadata:mainFileMetadata];
          }
        }

        if (-[PLManagedAsset isVideo](selfCopy, "isVideo") && (([optionsCopy isSubstandardRender] & 1) != 0 || objc_msgSend(optionsCopy, "isDeferred")))
        {
          [optionsCopy fullSizeRenderDuration];
          if (((v128 & 0x7FFFFFFFFFFFFFFFuLL) - 0x10000000000000) >> 53 <= 0x3FE)
          {
            [optionsCopy fullSizeRenderDuration];
            [(PLManagedAsset *)selfCopy setDuration:?];
          }
        }

        if ((v162 & 1) == 0 && [(PLManagedAsset *)selfCopy kindSubtype]== 101)
        {
          mainFileMetadata2 = [optionsCopy mainFileMetadata];
          [(PLManagedAsset *)selfCopy setDefaultAdjustmentsIfNecessaryWithMainFileMetadata:mainFileMetadata2];
        }

        if (*(v187 + 24) == 1)
        {
          [fileManager removeItemAtPath:*(*&buf[8] + 40) error:0];
        }

        _Block_object_dispose(buf, 8);
        _Block_object_dispose(&v186, 8);

        objc_sync_exit(obj);
        if (-[PLManagedAsset isVideo](selfCopy, "isVideo") && (([optionsCopy isDeferred] & 1) != 0 || objc_msgSend(optionsCopy, "shouldUpdateAttributes")))
        {
          [(PLManagedAsset *)selfCopy pruneLocalVideoKeyFrameImage];
        }

        [(PLManagedAsset *)selfCopy _removeComputeResourcesOnEdit];
        if (![optionsCopy isDeferred] || (objc_msgSend(optionsCopy, "isSubstandardRender") & 1) != 0 || objc_msgSend(optionsCopy, "shouldGenerateThumbnails"))
        {
          if ([(PLManagedAsset *)selfCopy isVideo])
          {
            if ([optionsCopy isDeferred])
            {
              v130 = MEMORY[0x1E695DFF8];
              pathForTransientVideoPosterFramePreview2 = [(PLManagedAsset *)selfCopy pathForTransientVideoPosterFramePreview];
              v132 = [v130 fileURLWithPath:pathForTransientVideoPosterFramePreview2];
            }

            else
            {
              pathForTransientVideoPosterFramePreview2 = [(PLManagedAsset *)selfCopy fileURLForFullsizeRenderImage];
              v132 = pathForTransientVideoPosterFramePreview2;
            }

            v135 = v132;
            v136 = v135;
            if (!v135)
            {
              v137 = PLPhotoEditGetLog();
              if (os_log_type_enabled(v137, OS_LOG_TYPE_DEBUG))
              {
                *buf = 0;
                _os_log_impl(&dword_19BF1F000, v137, OS_LOG_TYPE_DEBUG, "No custom video poster provided, default to standard preview image", buf, 2u);
              }

              v138 = MEMORY[0x1E695DFF8];
              pathForAsyncAdjustedRenderPreviewImageFile = [(PLManagedAsset *)selfCopy pathForAsyncAdjustedRenderPreviewImageFile];
              v136 = [v138 fileURLWithPath:pathForAsyncAdjustedRenderPreviewImageFile];
            }

            v133 = CGImageSourceCreateWithURL(v136, 0);
            if (v133)
            {
              v140 = PLPhotoEditGetLog();
              if (os_log_type_enabled(v140, OS_LOG_TYPE_INFO))
              {
                uuid8 = [(PLManagedAsset *)selfCopy uuid];
                *buf = 138412546;
                *&buf[4] = v136;
                *&buf[12] = 2114;
                *&buf[14] = uuid8;
                _os_log_impl(&dword_19BF1F000, v140, OS_LOG_TYPE_INFO, "Creating thumbnail image from %@ for video asset %{public}@", buf, 0x16u);
              }

              v171 = 0;
              v172 = 0;
              [PLManagedAsset createThumbnailImage:&v172 previewImage:&v171 withToBeReleasedImageSource:v133];
              v134 = v172;
              v133 = v171;
            }

            else
            {
              v134 = 0;
            }
          }

          else
          {
            v133 = 0;
            v134 = 0;
          }

          v142 = PLImageManagerGetLog();
          v143 = os_signpost_id_generate(v142);
          v144 = v142;

          v145 = v144;
          v146 = v145;
          if (v143 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v145))
          {
            *buf = 0;
            _os_signpost_emit_with_name_impl(&dword_19BF1F000, v146, OS_SIGNPOST_INTERVAL_BEGIN, v143, "UpdateDerivativeAndThumbnailAdjustments", "Begin potential updates on derivatives and thumbnails after setting adjustments.", buf, 2u);
          }

          v147 = v146;
          shouldGenerateThumbnails = [optionsCopy shouldGenerateThumbnails];
          mainFileMetadata3 = [optionsCopy mainFileMetadata];
          if ([optionsCopy shouldUpdateAttributes])
          {
            isDeferred2 = 1;
          }

          else
          {
            isDeferred2 = [optionsCopy isDeferred];
          }

          isSubstandardRender = [optionsCopy isSubstandardRender];
          BYTE1(v154) = [optionsCopy isDeferred];
          LOBYTE(v154) = isSubstandardRender;
          [(PLManagedAsset *)selfCopy _updateDerivativesAndThumbnails:shouldGenerateThumbnails withPreviewImage:v133 thumbnailImage:v134 metadata:mainFileMetadata3 didRevertToOriginal:v162 ^ 1u updateInternalResources:isDeferred2 isSubstandardRender:v154 isDeferred:?];

          v152 = v147;
          v153 = v152;
          if (v143 - 1 < 0xFFFFFFFFFFFFFFFELL && os_signpost_enabled(v152))
          {
            *buf = 0;
            _os_signpost_emit_with_name_impl(&dword_19BF1F000, v153, OS_SIGNPOST_INTERVAL_END, v143, "UpdateDerivativeAndThumbnailAdjustments", "", buf, 2u);
          }
        }

        goto LABEL_190;
      }

      metadataFromMediaPropertiesOrOriginalResource = [(PLManagedAsset *)selfCopy metadataFromMediaPropertiesOrOriginalResource];
      [(PLManagedAsset *)selfCopy setDepthTypeFromMetadata:metadataFromMediaPropertiesOrOriginalResource];
      [(PLManagedAsset *)selfCopy setSpatialTypeFromMetadata:metadataFromMediaPropertiesOrOriginalResource];
      [(PLManagedAsset *)selfCopy updateImageExtendedGenerativeAttributesFromMetadata:metadataFromMediaPropertiesOrOriginalResource];
      [(PLManagedAsset *)selfCopy setCurrentSleetCastFromMetadata:metadataFromMediaPropertiesOrOriginalResource];
LABEL_126:

      goto LABEL_127;
    }

    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      v178 = 0u;
      v179 = 0u;
      v176 = 0u;
      v177 = 0u;
      adjustedFileURLs = [(PLManagedAsset *)self adjustedFileURLs];
      v41 = 0;
      v42 = [adjustedFileURLs countByEnumeratingWithState:&v176 objects:v190 count:16];
      if (v42)
      {
        v43 = *v177;
        do
        {
          for (i = 0; i != v42; ++i)
          {
            if (*v177 != v43)
            {
              objc_enumerationMutation(adjustedFileURLs);
            }

            v45 = *(*(&v176 + 1) + 8 * i);
            v175 = v41;
            v46 = [MEMORY[0x1E69BF238] removeItemAtURL:v45 error:&v175];
            v47 = v175;

            v41 = v47;
            if ((v46 & 1) == 0)
            {
              v48 = PLBackendGetLog();
              if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
              {
                *v191 = 138412546;
                v192 = v45;
                v193 = 2112;
                v194 = v41;
                _os_log_impl(&dword_19BF1F000, v48, OS_LOG_TYPE_ERROR, "Failed to remove adjusted resource %@: %@", v191, 0x16u);
              }
            }
          }

          v42 = [adjustedFileURLs countByEnumeratingWithState:&v176 objects:v190 count:16];
        }

        while (v42);
      }
    }

    else
    {
      v174 = 0;
      v54 = [MEMORY[0x1E69BF238] removeItemAtPath:v156 error:&v174];
      v41 = v174;
      if (v54)
      {
LABEL_64:
        pathManager2 = [(PLManagedObject *)selfCopy pathManager];
        uuid9 = [(PLManagedAsset *)selfCopy uuid];
        v57 = [pathManager2 URLForPartialVideoDirectoryWithAssetUUID:uuid9];

        v173 = v41;
        LOBYTE(uuid9) = [MEMORY[0x1E69BF238] removeItemAtURL:v57 error:&v173];
        v58 = v173;

        if ((uuid9 & 1) == 0)
        {
          v59 = PLBackendGetLog();
          if (os_log_type_enabled(v59, OS_LOG_TYPE_ERROR))
          {
            uuid10 = [(PLManagedAsset *)selfCopy uuid];
            *v191 = 138543618;
            v192 = uuid10;
            v193 = 2112;
            v194 = v58;
            _os_log_impl(&dword_19BF1F000, v59, OS_LOG_TYPE_ERROR, "Failed to remove partial video directory for assetUUID %{public}@: %@", v191, 0x16u);
          }
        }

        goto LABEL_69;
      }

      adjustedFileURLs = PLBackendGetLog();
      if (os_log_type_enabled(adjustedFileURLs, OS_LOG_TYPE_ERROR))
      {
        *v191 = 138412546;
        v192 = v156;
        v193 = 2112;
        v194 = v41;
        _os_log_impl(&dword_19BF1F000, adjustedFileURLs, OS_LOG_TYPE_ERROR, "Failed to remove adjustment directory %@: %@", v191, 0x16u);
      }
    }

    goto LABEL_64;
  }

  oslog = PLPhotoEditGetLog();
  if (os_log_type_enabled(oslog, OS_LOG_TYPE_ERROR))
  {
    uuid11 = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    *&buf[4] = uuid11;
    _os_log_impl(&dword_19BF1F000, oslog, OS_LOG_TYPE_ERROR, "setAdjustments for non-photo non-video asset %{public}@ is invalid", buf, 0xCu);
  }

LABEL_191:
}

void __41__PLManagedAsset_setAdjustments_options___block_invoke(void *a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (a2)
  {
    v6 = [a2 path];
    v7 = [v6 stringByDeletingPathExtension];
    v8 = [v7 stringByAppendingPathExtension:@"in_flight"];
    v9 = *(a1[5] + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = a1[4];
    v12 = *(*(a1[5] + 8) + 40);
    v13 = [MEMORY[0x1E695DEF0] data];
    *(*(a1[6] + 8) + 24) = [v11 createFileAtPath:v12 contents:v13 attributes:0];
  }

  else
  {
    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = 138412290;
      v16 = v5;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Failed to obtain the adjustment marker path. Error: %@", &v15, 0xCu);
    }
  }
}

- (void)_writeOutAdjustmentsToFile:(id)file
{
  v27 = *MEMORY[0x1E69E9840];
  fileCopy = file;
  v18 = 0;
  v5 = [MEMORY[0x1E696AE40] dataWithPropertyList:fileCopy format:100 options:0 error:&v18];
  v6 = v18;
  if (!v5 || (-[PLManagedAsset pathForAdjustmentFile](self, "pathForAdjustmentFile"), v7 = objc_claimAutoreleasedReturnValue(), v17 = v6, v8 = [v5 writeToFile:v7 options:1073741825 error:&v17], v9 = v17, v6, v7, v6 = v9, (v8 & 1) == 0))
  {
    v10 = *MEMORY[0x1E69BF370];
    v11 = [fileCopy objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
    v12 = v11;
    if (v11)
    {
      v13 = [MEMORY[0x1E696AEC0] stringWithFormat:@"<%lu bytes>", objc_msgSend(v11, "length")];
      [fileCopy setObject:v13 forKeyedSubscript:v10];
    }

    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
      v16 = @"write failed";
      *buf = 138413058;
      v20 = pathForAdjustmentFile;
      if (!v5)
      {
        v16 = @"unable to encode dictionary as data";
      }

      v21 = 2112;
      v22 = fileCopy;
      v23 = 2112;
      v24 = v16;
      v25 = 2112;
      v26 = v6;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Failed to create adjustment file %@ from adjustment dictionary %@ (%@): %@", buf, 0x2Au);
    }
  }
}

- (void)updateAdjustmentFileWithAdjustmentRenderTypes:(unsigned int)types
{
  v3 = *&types;
  v18 = *MEMORY[0x1E69E9840];
  v5 = objc_alloc(MEMORY[0x1E695DEF0]);
  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  v7 = [v5 initWithContentsOfFile:pathForAdjustmentFile];

  if (v7)
  {
    v13 = 0;
    v8 = [MEMORY[0x1E696AE40] propertyListWithData:v7 options:0 format:0 error:&v13];
    v9 = v13;
    if (v8)
    {
      v10 = [v8 mutableCopy];
      v11 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v3];
      [v10 setObject:v11 forKey:*MEMORY[0x1E69BF390]];

      [(PLManagedAsset *)self _writeOutAdjustmentsToFile:v10];
    }

    else
    {
      v10 = PLBackendGetLog();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        pathForAdjustmentFile2 = [(PLManagedAsset *)self pathForAdjustmentFile];
        *buf = 138412546;
        v15 = pathForAdjustmentFile2;
        v16 = 2112;
        v17 = v9;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "Failed to read adjustment file %@, %@", buf, 0x16u);
      }
    }
  }
}

- (unsigned)_calculateRenderTypeAdditionalFlagCheckAndUpdateIfNeededUnmanagedAdjustment:(id)adjustment options:(id)options hasAdjustments:(BOOL)adjustments
{
  adjustmentsCopy = adjustments;
  adjustmentCopy = adjustment;
  optionsCopy = options;
  if ([(PLManagedAsset *)self isPhoto])
  {
    if ([optionsCopy skipCheckSleetCastAdjustment])
    {
      v10 = 4;
    }

    else
    {
      v10 = 6;
    }

    if (!adjustmentsCopy)
    {
      goto LABEL_14;
    }
  }

  else
  {
    v10 = 0;
    if (!adjustmentsCopy)
    {
      goto LABEL_14;
    }
  }

  if ([optionsCopy shouldCheckForLegacyCameraAutoAdjustment] && (objc_msgSend(optionsCopy, "skipCheckCameraAutoAdjustment") & 1) == 0)
  {
    if ([(PLManagedAsset *)self _isCameraAutoAdjustmentChecksNeededAndUpdateAsset])
    {
      v10 |= 1u;
    }

    else if (([adjustmentCopy adjustmentRenderTypes] & 0x4000) == 0)
    {
      [adjustmentCopy setAdjustmentRenderTypes:{objc_msgSend(adjustmentCopy, "adjustmentRenderTypes") | 0x4000}];
    }
  }

LABEL_14:

  return v10;
}

- (void)_processRenderTypeUpdateForGenerativeEditsWithUnmanagedAdjustment:(id)adjustment fullSizeRenderURL:(id)l hasAdjustments:(BOOL)adjustments
{
  if (adjustments)
  {
    v6 = [(PLManagedAsset *)self fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:l];
    [(PLManagedAsset *)self updateImageExtendedGenerativeAttributesFromMetadata:v6];
  }
}

- (void)_processRenderTypeUpdateForSleetCastWithUnmanagedAdjustment:(id)adjustment fullSizeRenderURL:(id)l settingPayload:(id)payload hasAdjustments:(BOOL)adjustments
{
  adjustmentsCopy = adjustments;
  adjustmentCopy = adjustment;
  lCopy = l;
  payloadCopy = payload;
  if (adjustmentsCopy && ([adjustmentCopy adjustmentRenderTypes] & 0x8000) != 0)
  {
    v13 = [payloadCopy objectForKeyedSubscript:*MEMORY[0x1E69C0960]];
    -[PLManagedAsset setCurrentSleetCast:](self, "setCurrentSleetCast:", [v13 shortValue]);
  }

  else
  {
    v12 = [(PLManagedAsset *)self fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:lCopy];
    if (v12)
    {
      v13 = v12;
      [(PLManagedAsset *)self setCurrentSleetCastFromMetadata:v12];
    }

    else
    {
      if ([(PLManagedAsset *)self currentSleetCast])
      {
        [(PLManagedAsset *)self setCurrentSleetCast:0];
      }

      v13 = 0;
    }
  }
}

- (void)_processRenderTypeUpdateForCameraAutoWithUnmanagedAdjustment:(id)adjustment options:(id)options hasAdjustments:(BOOL)adjustments updateRenderFlagsResult:(BOOL)result
{
  resultCopy = result;
  adjustmentsCopy = adjustments;
  adjustmentCopy = adjustment;
  optionsCopy = options;
  v11 = optionsCopy;
  if (adjustmentsCopy && ([optionsCopy skipCheckCameraAutoAdjustment] & 1) == 0)
  {
    if (resultCopy)
    {
      -[PLManagedAsset setAssetAdjustmentsStateFromAdjustmentRenderType:](self, "setAssetAdjustmentsStateFromAdjustmentRenderType:", [adjustmentCopy adjustmentRenderTypes]);
    }

    else if (([v11 shouldCheckForLegacyCameraAutoAdjustment] & 1) == 0 && (objc_msgSend(adjustmentCopy, "adjustmentRenderTypes") & 0x4000) == 0)
    {
      [adjustmentCopy setAdjustmentRenderTypes:{objc_msgSend(adjustmentCopy, "adjustmentRenderTypes") | 0x4000}];
    }
  }
}

- (void)_updateAdjustmentFromAssetAdjustment:(id)adjustment unmanagedAdjustment:(id)unmanagedAdjustment fullSizeRenderURL:(id)l options:(id)options
{
  unmanagedAdjustmentCopy = unmanagedAdjustment;
  lCopy = l;
  optionsCopy = options;
  adjustmentCopy = adjustment;
  v13 = [(PLManagedAsset *)self _calculateRenderTypeAdditionalFlagCheckAndUpdateIfNeededUnmanagedAdjustment:unmanagedAdjustmentCopy options:optionsCopy hasAdjustments:adjustment != 0];
  v14 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v15 = [unmanagedAdjustmentCopy updateRenderTypeFlagsForAssetAdjustments:adjustmentCopy checkFlag:v13 settingPayload:v14];

  [(PLManagedAsset *)self _processRenderTypeUpdateForCameraAutoWithUnmanagedAdjustment:unmanagedAdjustmentCopy options:optionsCopy hasAdjustments:adjustment != 0 updateRenderFlagsResult:v15];
  if ((v13 & 2) != 0)
  {
    [(PLManagedAsset *)self _processRenderTypeUpdateForSleetCastWithUnmanagedAdjustment:unmanagedAdjustmentCopy fullSizeRenderURL:lCopy settingPayload:v14 hasAdjustments:adjustment != 0];
  }

  if ((v13 & 4) != 0)
  {
    [(PLManagedAsset *)self _processRenderTypeUpdateForGenerativeEditsWithUnmanagedAdjustment:unmanagedAdjustmentCopy fullSizeRenderURL:lCopy hasAdjustments:adjustment != 0];
  }
}

- (BOOL)_isCameraAutoAdjustmentChecksNeededAndUpdateAsset
{
  if ([(PLManagedAsset *)self adjustmentsState]== 3)
  {
    return 0;
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];

  if (!unmanagedAdjustment)
  {
    if ([(PLManagedAsset *)self adjustmentsState])
    {
      [(PLManagedAsset *)self setAdjustmentsState:0];
    }

    return 0;
  }

  adjustmentFormatVersion = [unmanagedAdjustment adjustmentFormatVersion];
  v3 = [adjustmentFormatVersion compare:*MEMORY[0x1E69C0E60] options:64] < 0 || -[PLManagedAsset adjustmentsState](self, "adjustmentsState") == 1;

  return v3;
}

- (void)setAssetAdjustmentsStateFromAdjustmentRenderType:(unsigned int)type
{
  typeCopy = type;
  adjustmentsState = [(PLManagedAsset *)self adjustmentsState];
  if ((typeCopy & 0x2000) != 0)
  {
    if (adjustmentsState == 3)
    {
      return;
    }

    v6 = 3;
  }

  else
  {
    if (adjustmentsState == 2)
    {
      return;
    }

    v6 = 2;
  }

  [(PLManagedAsset *)self setAdjustmentsState:v6];
}

- (void)updateAssetPropertiesFromAdjustmentFile
{
  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  v9 = pathForAdjustmentFile;
  if (pathForAdjustmentFile)
  {
    v4 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForAdjustmentFile isDirectory:0];
    v5 = [objc_alloc(MEMORY[0x1E69C0660]) initWithURL:v4];
  }

  else
  {
    v5 = 0;
  }

  v6 = objc_alloc_init(PLMutableAssetAdjustmentOptions);
  [(PLMutableAssetAdjustmentOptions *)v6 setSkipCheckCameraAutoAdjustment:1];
  if ([(PLManagedAsset *)self currentSleetCast])
  {
    [(PLMutableAssetAdjustmentOptions *)v6 setSkipCheckSleetCastAdjustment:1];
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];

  [(PLManagedAsset *)self _updateAdjustmentFromAssetAdjustment:v5 unmanagedAdjustment:unmanagedAdjustment fullSizeRenderURL:0 options:v6];
}

- (void)updateAssetAdjustmentsStateIfNeededFromAdjustmentFile
{
  if ([(PLManagedAsset *)self _isCameraAutoAdjustmentChecksNeededAndUpdateAsset])
  {
    pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:? isDirectory:?];
    v4 = [objc_alloc(MEMORY[0x1E69C0660]) initWithURL:v3];
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];

    if ([unmanagedAdjustment updateRenderTypeFlagsForAssetAdjustments:v4 checkFlag:1 settingPayload:0])
    {
      -[PLManagedAsset setAssetAdjustmentsStateFromAdjustmentRenderType:](self, "setAssetAdjustmentsStateFromAdjustmentRenderType:", [unmanagedAdjustment adjustmentRenderTypes]);
      -[PLManagedAsset updateAdjustmentFileWithAdjustmentRenderTypes:](self, "updateAdjustmentFileWithAdjustmentRenderTypes:", [unmanagedAdjustment adjustmentRenderTypes]);
    }

    else if ([(PLManagedAsset *)self adjustmentsState]<= 1)
    {
      -[PLManagedAsset setAssetAdjustmentsStateFromAdjustmentRenderType:](self, "setAssetAdjustmentsStateFromAdjustmentRenderType:", [unmanagedAdjustment adjustmentRenderTypes]);
    }
  }
}

- (int64_t)_prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:(int64_t)version penultimateRenderedJPEGData:(id)data penultimateRenderedVideoContentURL:(id)l penultimateRenderedVideoComplementContentURL:(id)rL fileIngestionType:(int64_t)type
{
  v101 = *MEMORY[0x1E69E9840];
  dataCopy = data;
  lCopy = l;
  rLCopy = rL;
  context = objc_autoreleasePoolPush();
  fileManager = [MEMORY[0x1E69BF238] fileManager];
  if ([(PLManagedAsset *)self isPhoto])
  {
    [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
  }
  v80 = ;
  if ([(PLManagedAsset *)self isPhoto])
  {
    [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
  }
  v78 = ;
  isVideo = [(PLManagedAsset *)self isVideo];
  if (version != 2)
  {
    if (version != 1)
    {
      goto LABEL_22;
    }

    v15 = isVideo ? lCopy : dataCopy;
    if (([fileManager fileExistsAtPath:v78] & 1) != 0 || v15)
    {
      goto LABEL_22;
    }

    v16 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = PLAdjustmentBaseVersionDescription();
      v18 = PLAdjustmentBaseVersionDescription();
      *buf = 138412802;
      v88 = v17;
      v89 = 2112;
      v90 = v78;
      v91 = 2112;
      v92 = v18;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "[RM] Base version is %@ but no file exists at %@, defaulting to %@", buf, 0x20u);
    }
  }

  if ([fileManager fileExistsAtPath:v80])
  {
    version = 2;
  }

  else
  {
    v19 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      v20 = PLAdjustmentBaseVersionDescription();
      v21 = PLAdjustmentBaseVersionDescription();
      *buf = 138412802;
      v88 = v20;
      v89 = 2112;
      v90 = v80;
      v91 = 2112;
      v92 = v21;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_DEFAULT, "[RM] Base version is %@ but no file exists at %@, defaulting to %@", buf, 0x20u);
    }

    version = 0;
  }

LABEL_22:
  pathManager = [(PLManagedObject *)self pathManager];
  capabilities = [pathManager capabilities];

  v24 = PLPhotoEditGetLog();
  v25 = rLCopy;
  if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
  {
    uuid = [(PLManagedAsset *)self uuid];
    if ([(PLManagedAsset *)self isPhoto])
    {
      if ([(PLManagedAsset *)self isPhotoIris])
      {
        v27 = @"live photo";
      }

      else
      {
        v27 = @"photo";
      }
    }

    else
    {
      v27 = @"video";
    }

    v28 = PLAdjustmentBaseVersionDescription();
    v29 = v28;
    *buf = 138544898;
    v30 = @"YES";
    v88 = uuid;
    if (!dataCopy)
    {
      v30 = @"NO";
    }

    v89 = 2112;
    v90 = v27;
    v91 = 2112;
    v92 = v28;
    v93 = 2112;
    v94 = v80;
    v95 = 2112;
    v96 = v30;
    v97 = 2112;
    v98 = lCopy;
    v99 = 2112;
    v25 = rLCopy;
    v100 = rLCopy;
    _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_DEFAULT, "[RM] Preparing resources for adjustment for asset %{public}@ (%@) with base version %@ fullSizeRenderFile: %@ penultimate data: %@ penultimateRenderedVideoContentURL: %@ penultimateRenderedVideoComplementContentURL: %@", buf, 0x48u);
  }

  if (![(PLManagedAsset *)self isPhoto])
  {
    v41 = MEMORY[0x1E695DFF8];
    pathForPenultimateFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    v43 = [v41 fileURLWithPath:pathForPenultimateFullsizeRenderVideoFile isDirectory:0];

    if (!lCopy)
    {
      if ((version | 2) == 2 && ([(PLManagedAsset *)self _cleanupPenultimateResources], version == 2))
      {
        v65 = MEMORY[0x1E69BF238];
        v66 = [MEMORY[0x1E695DFF8] fileURLWithPath:v80 isDirectory:0];
        v81 = 0;
        LOBYTE(v65) = [v65 ingestItemAtURL:v66 toURL:v43 type:3 options:2 capabilities:capabilities error:&v81];
        v33 = v81;

        if ((v65 & 1) == 0)
        {
          v67 = PLPhotoEditGetLog();
          if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412802;
            v88 = v80;
            v89 = 2112;
            v90 = v43;
            v91 = 2112;
            v92 = v33;
            _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "Failed to ingest pathForFullsizeRenderFile %@ to %@: %@", buf, 0x20u);
          }
        }

        [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:16];
        version = 1;
      }

      else
      {
        v33 = 0;
      }

      goto LABEL_71;
    }

    v82 = 0;
    v44 = [MEMORY[0x1E69BF238] ingestItemAtURL:lCopy toURL:v43 type:type options:6 capabilities:capabilities error:&v82];
    v33 = v82;
    if (v44)
    {
LABEL_71:

LABEL_72:
      goto LABEL_73;
    }

    v45 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412802;
      v88 = lCopy;
      v89 = 2112;
      v90 = v43;
      v91 = 2112;
      v92 = v33;
      _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_ERROR, "Failed to ingest penultimateRenderedVideoContentURL %@ to %@: %@", buf, 0x20u);
    }

LABEL_69:

    goto LABEL_71;
  }

  if (dataCopy)
  {
    pathForPenultimateFullsizeRenderImageFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
    v86 = 0;
    v32 = [(__CFString *)dataCopy writeToFile:pathForPenultimateFullsizeRenderImageFile options:1073741825 error:&v86];
    v33 = v86;

    v34 = PLPhotoEditGetLog();
    v35 = v34;
    if (v32)
    {
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_63;
      }

      pathForPenultimateFullsizeRenderImageFile2 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
      *buf = 138412290;
      v88 = pathForPenultimateFullsizeRenderImageFile2;
      v37 = "Written penultimateFullsizeRenderImage to %@";
      v38 = v35;
      v39 = OS_LOG_TYPE_DEFAULT;
      v40 = 12;
    }

    else
    {
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_63;
      }

      pathForPenultimateFullsizeRenderImageFile2 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
      *buf = 138412546;
      v88 = pathForPenultimateFullsizeRenderImageFile2;
      v89 = 2112;
      v90 = v33;
      v37 = "Failed to write penultimateFullsizeRenderImage %@: %@";
      v38 = v35;
      v39 = OS_LOG_TYPE_ERROR;
      v40 = 22;
    }

    _os_log_impl(&dword_19BF1F000, v38, v39, v37, buf, v40);

LABEL_63:
    isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
    if (!v25 || !isPhotoIris)
    {
      goto LABEL_72;
    }

    v69 = MEMORY[0x1E695DFF8];
    pathForPenultimateFullsizeRenderVideoFile2 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    v43 = [v69 fileURLWithPath:pathForPenultimateFullsizeRenderVideoFile2 isDirectory:0];

    v85 = 0;
    LOBYTE(pathForPenultimateFullsizeRenderVideoFile2) = [MEMORY[0x1E69BF238] ingestItemAtURL:v25 toURL:v43 type:type options:6 capabilities:capabilities error:&v85];
    v45 = v85;
    if ((pathForPenultimateFullsizeRenderVideoFile2 & 1) == 0)
    {
      v71 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v71, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v88 = v25;
        v89 = 2112;
        v90 = v43;
        v91 = 2112;
        v92 = v45;
        _os_log_impl(&dword_19BF1F000, v71, OS_LOG_TYPE_ERROR, "Failed to ingest penultimateRenderedVideoComplementContentURL %@ to penultimateRenderedVideoComplementURL %@: %@", buf, 0x20u);
      }
    }

    goto LABEL_69;
  }

  if ((version | 2) == 2)
  {
    [(PLManagedAsset *)self _cleanupPenultimateResources];
    if (version == 2)
    {
      pathExtension = [(__CFString *)v80 pathExtension];
      v43 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:pathExtension assetType:0];

      v47 = MEMORY[0x1E695DFF8];
      v48 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFileWithUTI:v43];
      v49 = [v47 fileURLWithPath:v48 isDirectory:0];

      v50 = MEMORY[0x1E69BF238];
      v51 = v49;
      v52 = [MEMORY[0x1E695DFF8] fileURLWithPath:v80 isDirectory:0];
      v84 = 0;
      v75 = v51;
      LOBYTE(v50) = [v50 ingestItemAtURL:v52 toURL:v51 type:3 options:2 capabilities:capabilities error:&v84];
      v33 = v84;

      if ((v50 & 1) == 0)
      {
        v53 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_DEFAULT))
        {
          pathForPenultimateFullsizeRenderImageFile3 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
          *buf = 138412802;
          v88 = v80;
          v89 = 2112;
          v90 = pathForPenultimateFullsizeRenderImageFile3;
          v91 = 2112;
          v92 = v33;
          _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_DEFAULT, "Failed to ingest pathForFullsizeRenderFile %@ to pathForPenultimateFullsizeRenderImageFile %@: %@", buf, 0x20u);
        }
      }

      [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:2];
      pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
      if ([fileManager fileExistsAtPath:pathForFullsizeRenderVideoFile])
      {
        v56 = MEMORY[0x1E69BF238];
        v74 = pathForFullsizeRenderVideoFile;
        v57 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForFullsizeRenderVideoFile isDirectory:0];
        v58 = MEMORY[0x1E695DFF8];
        pathForPenultimateFullsizeRenderVideoFile3 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
        v59 = [v58 fileURLWithPath:pathForPenultimateFullsizeRenderVideoFile3 isDirectory:0];
        v83 = 0;
        v60 = v56;
        v61 = v57;
        LOBYTE(v57) = [v60 ingestItemAtURL:v57 toURL:v59 type:3 options:2 capabilities:capabilities error:&v83];
        v62 = v83;

        if ((v57 & 1) == 0)
        {
          v63 = PLPhotoEditGetLog();
          if (os_log_type_enabled(v63, OS_LOG_TYPE_DEFAULT))
          {
            pathForPenultimateFullsizeRenderVideoFile4 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
            *buf = 138412802;
            v88 = v74;
            v89 = 2112;
            v90 = pathForPenultimateFullsizeRenderVideoFile4;
            v91 = 2112;
            v92 = v62;
            _os_log_impl(&dword_19BF1F000, v63, OS_LOG_TYPE_DEFAULT, "Failed to ingest pathForFullsizeRenderVideoFile %@ to pathForPenultimateFullsizeRenderVideoFile %@: %@", buf, 0x20u);
          }
        }

        [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:16];

        pathForFullsizeRenderVideoFile = v74;
      }

      version = 1;
      dataCopy = 0;
      goto LABEL_71;
    }
  }

LABEL_73:

  objc_autoreleasePoolPop(context);
  return version;
}

- (void)revertToOriginal
{
  v8 = *MEMORY[0x1E69E9840];
  v3 = PLBackendGetLog();
  if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
  {
    uuid = [(PLManagedAsset *)self uuid];
    v6 = 138543362;
    v7 = uuid;
    _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "Reverting to original for asset %{public}@", &v6, 0xCu);
  }

  v5 = +[PLAssetAdjustmentOptions assetAdjustmentOptionsForRevertingToOriginal];
  [(PLManagedAsset *)self setAdjustments:0 options:v5];
}

- (id)_availableCloudResourcesForPhotosRequireUnadjusted:(BOOL)unadjusted allowPenultimate:(BOOL)penultimate
{
  penultimateCopy = penultimate;
  unadjustedCopy = unadjusted;
  v27 = *MEMORY[0x1E69E9840];
  if (_availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__onceToken != -1)
  {
    dispatch_once(&_availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__onceToken, &__block_literal_global_990);
  }

  v6 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v7 = _availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__photoTypes;
  v8 = [v7 countByEnumeratingWithState:&v22 objects:v26 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v23;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v23 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v22 + 1) + 8 * i);
        integerValue = [v12 integerValue];
        if (unadjustedCopy)
        {
          v21 = 0;
          v14 = [(PLManagedAsset *)self _isMasterResourceAvailableForResourceType:integerValue outResource:&v21];
          v15 = v21;
          if (v14)
          {
            goto LABEL_16;
          }
        }

        else
        {
          v20 = 0;
          v16 = [(PLManagedAsset *)self _isAdjustedResourceAvailableForResourceType:integerValue outResource:&v20];
          v15 = v20;
          if (v16 && ([v12 integerValue] != 15 || penultimateCopy))
          {
LABEL_16:
            [v6 addObject:v15];
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v22 objects:v26 count:16];
    }

    while (v9);
  }

  return v6;
}

void __86__PLManagedAsset__availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate___block_invoke()
{
  v0 = _availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__photoTypes;
  _availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__photoTypes = &unk_1F0FBF460;
}

- (BOOL)_isResourceAvailableForResourceType:(unint64_t)type outResource:(id *)resource
{
  if ([PLManagedAsset _isAdjustedResourceAvailableForResourceType:"_isAdjustedResourceAvailableForResourceType:outResource:" outResource:?])
  {
    return 1;
  }

  return [(PLManagedAsset *)self _isMasterResourceAvailableForResourceType:type outResource:resource];
}

- (BOOL)_isAdjustedResourceAvailableForResourceType:(unint64_t)type outResource:(id *)resource
{
  v5 = [(PLManagedAsset *)self assetResourceForCPLType:type];
  if (resource)
  {
    v5 = v5;
    *resource = v5;
  }

  v6 = v5 != 0;

  return v6;
}

- (BOOL)_isMasterResourceAvailableForResourceType:(unint64_t)type outResource:(id *)resource
{
  master = [(PLManagedAsset *)self master];
  if (!master)
  {
    v8 = 0;
    if (!resource)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v8 = [(PLManagedAsset *)self masterResourceForCPLType:type];
  if (resource)
  {
LABEL_3:
    v9 = v8;
    *resource = v8;
  }

LABEL_4:

  return v8 != 0;
}

- (BOOL)shouldUseNonAdjustedVideo
{
  v6 = 0;
  v7 = &v6;
  v8 = 0x2020000000;
  v9 = ![(PLManagedAsset *)self hasAdjustments];
  if ((v7[3] & 1) == 0 && [(PLManagedAsset *)self isDefaultAdjustedSlomo])
  {
    v5[0] = MEMORY[0x1E69E9820];
    v5[1] = 3221225472;
    v5[2] = __43__PLManagedAsset_shouldUseNonAdjustedVideo__block_invoke;
    v5[3] = &unk_1E75714E0;
    v5[4] = &v6;
    [(PLManagedAsset *)self synchronouslyFetchAdjustmentDataWithCompletionHandler:v5];
  }

  if ((v7[3] & 1) == 0 && [(PLManagedAsset *)self isPhotoIris]&& [(PLManagedAsset *)self hasAdjustments]&& [(PLManagedAsset *)self videoCpVisibilityState]== 2 && ![(PLManagedAsset *)self deferredProcessingNeeded])
  {
    *(v7 + 24) = 1;
  }

  v3 = *(v7 + 24);
  _Block_object_dispose(&v6, 8);
  return v3;
}

uint64_t __43__PLManagedAsset_shouldUseNonAdjustedVideo__block_invoke(uint64_t a1, uint64_t a2, uint64_t a3)
{
  result = [MEMORY[0x1E69C0910] isRecognizedSlowMotionFormatWithIdentifier:a2 version:a3];
  *(*(*(a1 + 32) + 8) + 24) = result;
  return result;
}

- (id)unadjustedDerivativeImageURLs
{
  v43 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E695DFA8] set];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke;
  aBlock[3] = &unk_1E7567860;
  v4 = v3;
  v36 = v4;
  v5 = _Block_copy(aBlock);
  masterThumbnailFileURLIfLocal = [(PLManagedAsset *)self masterThumbnailFileURLIfLocal];
  [v4 pl_addObjectIfNotNil:masterThumbnailFileURLIfLocal];

  fileURLForNonAdjustedMediumThumbnailFile = [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  [v4 pl_addObjectIfNotNil:fileURLForNonAdjustedMediumThumbnailFile];

  fileURLForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  [v4 pl_addObjectIfNotNil:fileURLForNonAdjustedLargeThumbnailFile];

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  contextualVideoThumbnailURLs = [(PLManagedAsset *)self contextualVideoThumbnailURLs];
  v10 = [contextualVideoThumbnailURLs countByEnumeratingWithState:&v31 objects:v41 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v32;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v32 != v12)
        {
          objc_enumerationMutation(contextualVideoThumbnailURLs);
        }

        [v4 addObject:*(*(&v31 + 1) + 8 * i)];
      }

      v11 = [contextualVideoThumbnailURLs countByEnumeratingWithState:&v31 objects:v41 count:16];
    }

    while (v11);
  }

  pathForNonAdjustedLargeSizeImageFile = [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
  v5[2](v5, pathForNonAdjustedLargeSizeImageFile, 0);

  pathForNonAdjustedFullsizeImageFile = [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
  v5[2](v5, pathForNonAdjustedFullsizeImageFile, 0);

  v26[0] = MEMORY[0x1E69E9820];
  v26[1] = 3221225472;
  v27 = __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke_2;
  v28 = &unk_1E7567888;
  v25 = v5;
  selfCopy = self;
  v30 = v25;
  v16 = v26;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  v17 = [&unk_1F0FBF550 countByEnumeratingWithState:&v37 objects:v42 count:16];
  if (v17)
  {
    v18 = v17;
    v19 = *v38;
    do
    {
      for (j = 0; j != v18; ++j)
      {
        if (*v38 != v19)
        {
          objc_enumerationMutation(&unk_1F0FBF550);
        }

        unsignedIntValue = [*(*(&v37 + 1) + 8 * j) unsignedIntValue];
        if ((unsignedIntValue - 327695) <= 6 && ((1 << (unsignedIntValue - 15)) & 0x55) != 0)
        {
          v27(v16, unsignedIntValue);
        }
      }

      v18 = [&unk_1F0FBF550 countByEnumeratingWithState:&v37 objects:v42 count:16];
    }

    while (v18);
  }

  v23 = v4;
  return v4;
}

void __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v7 = a2;
  if ([v7 length])
  {
    v5 = *(a1 + 32);
    v6 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7 isDirectory:a3];
    [v5 pl_addObjectIfNotNil:v6];
  }
}

void __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke_2(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) pathForAlchemistV2ResourceFileWithRecipeID:a2];
  (*(v2 + 16))(v2, v3, 0);
}

- (id)adjustedFileURLs
{
  v54 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E695DFA8] set];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __34__PLManagedAsset_adjustedFileURLs__block_invoke;
  aBlock[3] = &unk_1E7567860;
  v4 = v3;
  v47 = v4;
  v5 = _Block_copy(aBlock);
  pathForFullsizeRenderImageFile = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  v5[2](v5, pathForFullsizeRenderImageFile, 0);

  pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
  v5[2](v5, pathForFullsizeRenderVideoFile, 0);

  pathForSubstandardFullsizeRenderImageFile = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
  v5[2](v5, pathForSubstandardFullsizeRenderImageFile, 0);

  pathForPenultimateFullsizeRenderImageFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
  v5[2](v5, pathForPenultimateFullsizeRenderImageFile, 0);

  pathForPenultimateFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
  v5[2](v5, pathForPenultimateFullsizeRenderVideoFile, 0);

  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  v5[2](v5, pathForAdjustmentFile, 0);

  pathForAdjustmentDataFile = [(PLManagedAsset *)self pathForAdjustmentDataFile];
  v5[2](v5, pathForAdjustmentDataFile, 0);

  pathForAdjustedLargeSizeImageFile = [(PLManagedAsset *)self pathForAdjustedLargeSizeImageFile];
  v5[2](v5, pathForAdjustedLargeSizeImageFile, 0);

  pathForAsyncAdjustedRenderPreviewImageFile = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
  v5[2](v5, pathForAsyncAdjustedRenderPreviewImageFile, 0);

  fileURLForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self fileURLForAdjustedLargeThumbnailFile];
  [v4 pl_addObjectIfNotNil:fileURLForAdjustedLargeThumbnailFile];

  fileURLForAdjustedMediumThumbnailFile = [(PLManagedAsset *)self fileURLForAdjustedMediumThumbnailFile];
  [v4 pl_addObjectIfNotNil:fileURLForAdjustedMediumThumbnailFile];

  pathForAdjustedLargeVideoFile = [(PLManagedAsset *)self pathForAdjustedLargeVideoFile];
  v5[2](v5, pathForAdjustedLargeVideoFile, 0);

  pathForAdjustedMediumVideoFile = [(PLManagedAsset *)self pathForAdjustedMediumVideoFile];
  v5[2](v5, pathForAdjustedMediumVideoFile, 0);

  pathForAdjustedMediumHDRVideoFile = [(PLManagedAsset *)self pathForAdjustedMediumHDRVideoFile];
  v5[2](v5, pathForAdjustedMediumHDRVideoFile, 0);

  pathForAdjustedSmallVideoFile = [(PLManagedAsset *)self pathForAdjustedSmallVideoFile];
  v5[2](v5, pathForAdjustedSmallVideoFile, 0);

  pathForAdjustmentSecondaryDataFile = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
  v5[2](v5, pathForAdjustmentSecondaryDataFile, 0);

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  contextualVideoThumbnailURLs = [(PLManagedAsset *)self contextualVideoThumbnailURLs];
  v23 = [contextualVideoThumbnailURLs countByEnumeratingWithState:&v42 objects:v52 count:16];
  if (v23)
  {
    v24 = v23;
    v25 = *v43;
    do
    {
      for (i = 0; i != v24; ++i)
      {
        if (*v43 != v25)
        {
          objc_enumerationMutation(contextualVideoThumbnailURLs);
        }

        [v4 addObject:*(*(&v42 + 1) + 8 * i)];
      }

      v24 = [contextualVideoThumbnailURLs countByEnumeratingWithState:&v42 objects:v52 count:16];
    }

    while (v24);
  }

  v37[0] = MEMORY[0x1E69E9820];
  v37[1] = 3221225472;
  v38 = __34__PLManagedAsset_adjustedFileURLs__block_invoke_2;
  v39 = &unk_1E7567888;
  v36 = v5;
  selfCopy = self;
  v41 = v36;
  v27 = v37;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v51 = 0u;
  v28 = [&unk_1F0FBF550 countByEnumeratingWithState:&v48 objects:v53 count:16];
  if (v28)
  {
    v29 = v28;
    v30 = *v49;
    do
    {
      for (j = 0; j != v29; ++j)
      {
        if (*v49 != v30)
        {
          objc_enumerationMutation(&unk_1F0FBF550);
        }

        unsignedIntValue = [*(*(&v48 + 1) + 8 * j) unsignedIntValue];
        if ((unsignedIntValue - 327695) <= 6 && ((1 << (unsignedIntValue - 15)) & 0x55) != 0)
        {
          v38(v27, unsignedIntValue);
        }
      }

      v29 = [&unk_1F0FBF550 countByEnumeratingWithState:&v48 objects:v53 count:16];
    }

    while (v29);
  }

  v34 = v4;
  return v4;
}

void __34__PLManagedAsset_adjustedFileURLs__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v7 = a2;
  if ([v7 length])
  {
    v5 = *(a1 + 32);
    v6 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7 isDirectory:a3];
    [v5 pl_addObjectIfNotNil:v6];
  }
}

void __34__PLManagedAsset_adjustedFileURLs__block_invoke_2(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) pathForAlchemistV2ResourceFileWithRecipeID:a2];
  (*(v2 + 16))(v2, v3, 0);
}

- (NSSet)allFileURLs
{
  v109 = *MEMORY[0x1E69E9840];
  sidecars = [(PLManagedAsset *)self sidecars];
  v4 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(sidecars, "count") + 1}];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __29__PLManagedAsset_allFileURLs__block_invoke;
  aBlock[3] = &unk_1E7567860;
  v5 = v4;
  v98 = v5;
  v6 = _Block_copy(aBlock);
  if (![(PLManagedAsset *)self isReferencedAsset])
  {
    filename = [(PLManagedAsset *)self filename];
    v8 = [filename length];

    if (v8)
    {
      pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
      v6[2](v6, pathForOriginalFile, 0);
    }

    v95 = 0u;
    v96 = 0u;
    v93 = 0u;
    v94 = 0u;
    v10 = sidecars;
    v11 = [v10 countByEnumeratingWithState:&v93 objects:v104 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v94;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v94 != v13)
          {
            objc_enumerationMutation(v10);
          }

          fileURL = [*(*(&v93 + 1) + 8 * i) fileURL];
          if (fileURL)
          {
            [(NSSet *)v5 addObject:fileURL];
          }
        }

        v12 = [v10 countByEnumeratingWithState:&v93 objects:v104 count:16];
      }

      while (v12);
    }

    pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
    v6[2](v6, pathForVideoComplementFile, 0);

    pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForSpatialOverCaptureContentFile];
    v6[2](v6, pathForSpatialOverCaptureContentFile, 0);

    pathForVideoComplementSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForVideoComplementSpatialOverCaptureContentFile];
    v6[2](v6, pathForVideoComplementSpatialOverCaptureContentFile, 0);

    pathForOriginalAdjustmentFile = [(PLManagedAsset *)self pathForOriginalAdjustmentFile];
    v6[2](v6, pathForOriginalAdjustmentFile, 0);
  }

  fileURLForNonAdjustedMediumThumbnailFile = [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  [(NSSet *)v5 pl_addObjectIfNotNil:fileURLForNonAdjustedMediumThumbnailFile];

  fileURLForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  [(NSSet *)v5 pl_addObjectIfNotNil:fileURLForNonAdjustedLargeThumbnailFile];

  pathForNonAdjustedLargeSizeImageFile = [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
  v6[2](v6, pathForNonAdjustedLargeSizeImageFile, 0);

  pathForNonAdjustedFullsizeImageFile = [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
  v6[2](v6, pathForNonAdjustedFullsizeImageFile, 0);

  if ([(PLManagedAsset *)self isCloudSharedAsset])
  {
    v24 = 3;
    do
    {
      v25 = [(PLManagedAsset *)self cloudSharedAssetPathForPlaceholderKind:v24];
      v26 = v24;
      v6[2](v6, v25, 0);

      ++v24;
    }

    while (v26 < 0xA);
  }

  pathForNonAdjustedMediumVideoFile = [(PLManagedAsset *)self pathForNonAdjustedMediumVideoFile];
  v6[2](v6, pathForNonAdjustedMediumVideoFile, 0);

  pathForNonAdjustedMediumHDRVideoFile = [(PLManagedAsset *)self pathForNonAdjustedMediumHDRVideoFile];
  v6[2](v6, pathForNonAdjustedMediumHDRVideoFile, 0);

  pathForNonAdjustedSmallVideoFile = [(PLManagedAsset *)self pathForNonAdjustedSmallVideoFile];
  v6[2](v6, pathForNonAdjustedSmallVideoFile, 0);

  fileURLForThumbnailFile = [(PLManagedAsset *)self fileURLForThumbnailFile];
  [(NSSet *)v5 pl_addObjectIfNotNil:fileURLForThumbnailFile];

  pathForMutationsDirectory = [(PLManagedAsset *)self pathForMutationsDirectory];
  v83 = pathForMutationsDirectory;
  if (pathForMutationsDirectory)
  {
    v32 = pathForMutationsDirectory;
    pathManager = [(PLManagedObject *)self pathManager];
    v34 = [pathManager photoDirectoryWithType:9];
    v35 = [v34 hasPrefix:v32];

    if (v35)
    {
      v36 = PLBackendGetLog();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543618;
        v106 = uuid;
        v107 = 2112;
        v108 = v83;
        _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "Asset %{public}@ has incorrect mutation directory %@, skip removing the directory.", buf, 0x16u);
      }
    }

    else
    {
      v36 = [MEMORY[0x1E695DFF8] fileURLWithPath:v32 isDirectory:1];
      [(NSSet *)v5 pl_addObjectIfNotNil:v36];
    }
  }

  v82 = sidecars;
  if ([(PLManagedAsset *)self shouldUseUBFPathManager]&& [(PLManagedAsset *)self hasAdjustments])
  {
    adjustedFileURLs = [(PLManagedAsset *)self adjustedFileURLs];
    [(NSSet *)v5 unionSet:adjustedFileURLs];
  }

  pathForLegacySlalomRegionsArchive = [(PLManagedAsset *)self pathForLegacySlalomRegionsArchive];
  v6[2](v6, pathForLegacySlalomRegionsArchive, 0);

  pathForDiagnosticFile = [(PLManagedAsset *)self pathForDiagnosticFile];
  v6[2](v6, pathForDiagnosticFile, 0);

  pathForDeferredProcessingPreviewFile = [(PLManagedAsset *)self pathForDeferredProcessingPreviewFile];
  v6[2](v6, pathForDeferredProcessingPreviewFile, 0);

  pathForCameraMetadataFile = [(PLManagedAsset *)self pathForCameraMetadataFile];
  v6[2](v6, pathForCameraMetadataFile, 0);

  pathForDeferredVideoComplementFile = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  v6[2](v6, pathForDeferredVideoComplementFile, 0);

  pathForSpatialOverCaptureDiagnosticFile = [(PLManagedAsset *)self pathForSpatialOverCaptureDiagnosticFile];
  v6[2](v6, pathForSpatialOverCaptureDiagnosticFile, 0);

  pathForReframeDiagnosticDirectory = [(PLManagedAsset *)self pathForReframeDiagnosticDirectory];
  v6[2](v6, pathForReframeDiagnosticDirectory, 1);

  pathForCameraMetadataDiagnosticFile = [(PLManagedAsset *)self pathForCameraMetadataDiagnosticFile];
  v6[2](v6, pathForCameraMetadataDiagnosticFile, 0);

  pathForCameraSpatialOverCaptureMetadataDiagnosticFile = [(PLManagedAsset *)self pathForCameraSpatialOverCaptureMetadataDiagnosticFile];
  v6[2](v6, pathForCameraSpatialOverCaptureMetadataDiagnosticFile, 0);

  pathForOriginalVideoComplementDiagnosticFile = [(PLManagedAsset *)self pathForOriginalVideoComplementDiagnosticFile];
  v6[2](v6, pathForOriginalVideoComplementDiagnosticFile, 0);

  pathManager2 = [(PLManagedObject *)self pathManager];
  isDCIM = [pathManager2 isDCIM];

  if (isDCIM && [(PLManagedAsset *)self isFinderSyncedAsset])
  {
    pathManager3 = [(PLManagedObject *)self pathManager];
    iTunesSyncedFaceDataDirectory = [pathManager3 iTunesSyncedFaceDataDirectory];
    uuid2 = [(PLManagedAsset *)self uuid];
    v54 = [iTunesSyncedFaceDataDirectory stringByAppendingPathComponent:uuid2];
    v55 = [v54 stringByAppendingPathExtension:@"plist"];

    v6[2](v6, v55, 0);
  }

  pathForLocalVideoKeyFrame = [(PLManagedAsset *)self pathForLocalVideoKeyFrame];
  v6[2](v6, pathForLocalVideoKeyFrame, 0);

  pathManager4 = [(PLManagedObject *)self pathManager];
  uuid3 = [(PLManagedAsset *)self uuid];
  v59 = [pathManager4 URLForPartialVideoDirectoryWithAssetUUID:uuid3];
  path = [v59 path];
  v6[2](v6, path, 1);

  pathForWallpaperComputeResourcesFile = [(PLManagedAsset *)self pathForWallpaperComputeResourcesFile];
  v6[2](v6, pathForWallpaperComputeResourcesFile, 0);

  pathForComputeSyncWrapperFile = [(PLManagedAsset *)self pathForComputeSyncWrapperFile];
  v6[2](v6, pathForComputeSyncWrapperFile, 0);

  pathForComputeSyncMediaAnalysisPayloadFile = [(PLManagedAsset *)self pathForComputeSyncMediaAnalysisPayloadFile];
  v6[2](v6, pathForComputeSyncMediaAnalysisPayloadFile, 0);

  pathForGenerativePlaygroundFaceResourcesFile = [(PLManagedAsset *)self pathForGenerativePlaygroundFaceResourcesFile];
  v6[2](v6, pathForGenerativePlaygroundFaceResourcesFile, 0);

  pathManager5 = [(PLManagedObject *)self pathManager];
  LODWORD(uuid3) = [pathManager5 isDCIM];

  if (uuid3)
  {
    pathForComputeDirectory = [(PLManagedAsset *)self pathForComputeDirectory];
    v6[2](v6, pathForComputeDirectory, 1);
  }

  v91 = 0u;
  v92 = 0u;
  v89 = 0u;
  v90 = 0u;
  contextualVideoThumbnailURLs = [(PLManagedAsset *)self contextualVideoThumbnailURLs];
  v68 = [contextualVideoThumbnailURLs countByEnumeratingWithState:&v89 objects:v103 count:16];
  if (v68)
  {
    v69 = v68;
    v70 = *v90;
    do
    {
      for (j = 0; j != v69; ++j)
      {
        if (*v90 != v70)
        {
          objc_enumerationMutation(contextualVideoThumbnailURLs);
        }

        [(NSSet *)v5 addObject:*(*(&v89 + 1) + 8 * j)];
      }

      v69 = [contextualVideoThumbnailURLs countByEnumeratingWithState:&v89 objects:v103 count:16];
    }

    while (v69);
  }

  v84[0] = MEMORY[0x1E69E9820];
  v84[1] = 3221225472;
  v85 = __29__PLManagedAsset_allFileURLs__block_invoke_986;
  v86 = &unk_1E7567888;
  v81 = v6;
  selfCopy = self;
  v88 = v81;
  v72 = v84;
  v99 = 0u;
  v100 = 0u;
  v101 = 0u;
  v102 = 0u;
  v73 = [&unk_1F0FBF550 countByEnumeratingWithState:&v99 objects:buf count:16];
  if (v73)
  {
    v74 = v73;
    v75 = *v100;
    do
    {
      for (k = 0; k != v74; ++k)
      {
        if (*v100 != v75)
        {
          objc_enumerationMutation(&unk_1F0FBF550);
        }

        unsignedIntValue = [*(*(&v99 + 1) + 8 * k) unsignedIntValue];
        if ((unsignedIntValue - 327695) <= 6 && ((1 << (unsignedIntValue - 15)) & 0x55) != 0)
        {
          v85(v72, unsignedIntValue);
        }
      }

      v74 = [&unk_1F0FBF550 countByEnumeratingWithState:&v99 objects:buf count:16];
    }

    while (v74);
  }

  v79 = v5;
  return v5;
}

void __29__PLManagedAsset_allFileURLs__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v7 = a2;
  if ([v7 length])
  {
    v5 = *(a1 + 32);
    v6 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7 isDirectory:a3];
    [v5 pl_addObjectIfNotNil:v6];
  }
}

void __29__PLManagedAsset_allFileURLs__block_invoke_986(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) pathForAlchemistV2ResourceFileWithRecipeID:a2];
  (*(v2 + 16))(v2, v3, 0);
}

- (NSSet)filePathsWithoutThumbs
{
  v20 = *MEMORY[0x1E69E9840];
  sidecars = [(PLManagedAsset *)self sidecars];
  v4 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(sidecars, "count") + 1}];
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  if (pathForOriginalFile)
  {
    [v4 addObject:pathForOriginalFile];
  }

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  v6 = sidecars;
  v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v16;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v16 != v9)
        {
          objc_enumerationMutation(v6);
        }

        fileURL = [*(*(&v15 + 1) + 8 * i) fileURL];
        v12 = fileURL;
        if (fileURL)
        {
          path = [fileURL path];
          [v4 addObject:path];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v8);
  }

  return v4;
}

- (NSString)pathForComputeDirectory
{
  directory = [(PLManagedAsset *)self directory];
  filename = [(PLManagedAsset *)self filename];
  pathManager = [(PLManagedObject *)self pathManager];
  v6 = [pathManager assetPathForComputeDirectoryWithDirectory:directory filename:filename];

  return v6;
}

- (NSString)pathForAdjustmentDirectory
{
  pathForMutationsDirectory = [(PLManagedAsset *)self pathForMutationsDirectory];
  v3 = [PLManagedAsset pathForAdjustmentDirectoryWithMutationsDirectory:pathForMutationsDirectory];

  return v3;
}

- (id)pathForMutationsDirectory
{
  directory = [(PLManagedAsset *)self directory];
  filename = [(PLManagedAsset *)self filename];
  pathManager = [(PLManagedObject *)self pathManager];
  v6 = [pathManager assetPathForMutationsDirectoryWithDirectory:directory filename:filename];

  return v6;
}

- (BOOL)shouldUseUBFPathManager
{
  selfCopy = self;
  pathManager = [(PLManagedObject *)self pathManager];
  LOBYTE(selfCopy) = [pathManager shouldUseFileIdentifierForBundleScope:{-[PLManagedAsset bundleScope](selfCopy, "bundleScope")}];

  return selfCopy;
}

- (BOOL)isSavedPhotosAsset
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    return 1;
  }

  pl_dispatch_once();
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  path = [mainFileURL path];

  if (path)
  {
    v3 = [isSavedPhotosAsset_savedPhotosDirectoryRegEx numberOfMatchesInString:path options:0 range:{0, objc_msgSend(path, "length")}] == 1;
  }

  else
  {
    v3 = 1;
  }

  return v3;
}

void __36__PLManagedAsset_isSavedPhotosAsset__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E696AE70]) initWithPattern:@"[1-9][0-9][0-9]APPLE" options:0 error:0];
  v1 = isSavedPhotosAsset_savedPhotosDirectoryRegEx;
  isSavedPhotosAsset_savedPhotosDirectoryRegEx = v0;
}

- (BOOL)couldBeStoredInDCIM
{
  [MEMORY[0x1E69BF328] maskForCouldBeStoredInDCIM];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (id)originalVideoComplementUniformTypeIdentifier
{
  if (![(PLManagedAsset *)self isPhotoIris])
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:8045 description:{@"Requires a live photo asset but type/subtype are %d/%d", -[PLManagedAsset kind](self, "kind"), -[PLManagedAsset kindSubtype](self, "kindSubtype")}];
  }

  photoLibrary = [(PLManagedObject *)self photoLibrary];
  isCloudPhotoLibraryEnabled = [photoLibrary isCloudPhotoLibraryEnabled];

  if (isCloudPhotoLibraryEnabled)
  {
    v17 = 0;
    v6 = [(PLManagedAsset *)self _isResourceAvailableForResourceType:18 outResource:&v17];
    v7 = v17;
    v8 = v7;
    identifier = 0;
    if (v6)
    {
      uniformTypeIdentifier = [v7 uniformTypeIdentifier];
      identifier = [uniformTypeIdentifier identifier];
    }
  }

  else
  {
    v11 = MEMORY[0x1E69C08F0];
    pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
    pathExtension = [pathForVideoComplementFile pathExtension];
    v14 = [v11 typeWithFilenameExtension:pathExtension];
    identifier = [v14 identifier];
  }

  return identifier;
}

- (id)originalUniformTypeIdentifier
{
  v16[1] = *MEMORY[0x1E69E9840];
  master = [(PLManagedAsset *)self master];

  if (master)
  {
    master2 = [(PLManagedAsset *)self master];
    uniformTypeIdentifier = [master2 uniformTypeIdentifier];

    goto LABEL_9;
  }

  if (![(PLManagedAsset *)self hasAdjustments])
  {
    uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
LABEL_9:
    pathForOriginalFile2 = 0;
    if (uniformTypeIdentifier)
    {
      goto LABEL_13;
    }

    goto LABEL_10;
  }

  if ([(PLManagedAsset *)self kind])
  {
    goto LABEL_11;
  }

  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  if (!pathForOriginalFile)
  {
    goto LABEL_11;
  }

  pathForOriginalFile2 = pathForOriginalFile;
  v15 = *MEMORY[0x1E696E0A8];
  v16[0] = MEMORY[0x1E695E110];
  v8 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v16 forKeys:&v15 count:1];
  v9 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForOriginalFile2 isDirectory:0];
  v10 = CGImageSourceCreateWithURL(v9, v8);

  if (v10)
  {
    uniformTypeIdentifier = CGImageSourceGetType(v10);
    CFRelease(v10);
  }

  else
  {
    uniformTypeIdentifier = 0;
  }

  if (uniformTypeIdentifier)
  {
    goto LABEL_13;
  }

LABEL_10:
  if (!pathForOriginalFile2)
  {
LABEL_11:
    pathForOriginalFile2 = [(PLManagedAsset *)self pathForOriginalFile];
  }

  v11 = MEMORY[0x1E69C08F0];
  pathExtension = [pathForOriginalFile2 pathExtension];
  v13 = [v11 typeWithFilenameExtension:pathExtension];
  uniformTypeIdentifier = [v13 identifier];

LABEL_13:

  return uniformTypeIdentifier;
}

- (void)updateAssetKindFromUniformTypeIdentifier
{
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [PLManagedAsset assetTypeFromUniformTypeIdentifier:uniformTypeIdentifier];

  [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:v4];
}

- (void)updateAssetKindAndPlaybackStyleIfNeededWithKind:(signed __int16)kind
{
  kindCopy = kind;
  if ([(PLManagedAsset *)self kind]!= kind)
  {
    [(PLManagedAsset *)self setKind:kindCopy];
    if (![(PLManagedAsset *)self playbackVariation])
    {
      v5 = [objc_opt_class() defaultPlaybackStyleFromAssetType:kindCopy subtype:0 playbackVariation:{-[PLManagedAsset playbackVariation](self, "playbackVariation")}];

      [(PLManagedAsset *)self setPlaybackStyle:v5];
    }
  }
}

- (id)nonDynamicOriginalUTI
{
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  path = [mainFileURL path];
  pathExtension = [path pathExtension];

  if ([PLManagedAsset isKnownFileExtension:pathExtension])
  {
    v6 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:pathExtension assetType:[(PLManagedAsset *)self kind]];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)setUniformTypeIdentifierFromOriginalFile
{
  nonDynamicOriginalUTI = [(PLManagedAsset *)self nonDynamicOriginalUTI];
  [(PLManagedAsset *)self setUniformTypeIdentifier:nonDynamicOriginalUTI];
}

- (void)setUniformTypeIdentifierFromPathExtension:(id)extension
{
  extensionCopy = extension;
  v5 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:extensionCopy assetType:[(PLManagedAsset *)self kind]];

  [(PLManagedAsset *)self setUniformTypeIdentifier:v5];
}

- (BOOL)isScreenRecording
{
  if ([(PLManagedAsset *)self kindSubtype]== 103)
  {
    return 1;
  }

  if ([(PLManagedAsset *)self kind]!= 1)
  {
    return 0;
  }

  originalFilename = [(PLManagedAsset *)self originalFilename];
  v5 = [PLManagedAsset isScreenRecordingFileName:originalFilename];

  return v5;
}

- (BOOL)_isPartOfAvalancheWithKind:(unsigned __int16)kind
{
  kindCopy = kind;
  if ([(PLManagedAsset *)self avalancheKind]== kind)
  {
    if (kindCopy == 2)
    {
      avalancheUUID = [(PLManagedAsset *)self avalancheUUID];
      v7 = avalancheUUID == 0;
    }

    else
    {
      if (kindCopy != 1)
      {
        if (kindCopy)
        {
          return 1;
        }

        avalancheUUID = [(PLManagedAsset *)self avalancheUUID];
        v6 = avalancheUUID == 0;
        goto LABEL_13;
      }

      avalancheUUID = [(PLManagedAsset *)self avalancheUUID];
      if (!avalancheUUID)
      {
        v6 = 0;
LABEL_13:

        return v6;
      }

      v7 = [(PLManagedAsset *)self avalanchePickType]== 0;
    }

    v6 = !v7;
    goto LABEL_13;
  }

  return 0;
}

- (BOOL)isOriginalRAW
{
  originalFilename = [(PLManagedAsset *)self originalFilename];
  pathExtension = [originalFilename pathExtension];

  v5 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:pathExtension assetType:[(PLManagedAsset *)self kind]];
  v6 = [MEMORY[0x1E69C08F0] typeWithIdentifier:v5];
  v7 = [v6 conformsToType:*MEMORY[0x1E6982F88]];

  return v7;
}

- (BOOL)isRAW
{
  v2 = MEMORY[0x1E69C08F0];
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [v2 typeWithIdentifier:uniformTypeIdentifier];
  v5 = [v4 conformsToType:*MEMORY[0x1E6982F88]];

  return v5;
}

- (BOOL)isPrimaryImageFormat
{
  v3 = objc_opt_class();
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  LOBYTE(v3) = [v3 isPrimaryImageFormatForUTI:uniformTypeIdentifier];

  return v3;
}

- (BOOL)isHEIF
{
  v2 = MEMORY[0x1E69C08F0];
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [v2 typeWithIdentifier:uniformTypeIdentifier];
  v5 = [v4 conformsToType:*MEMORY[0x1E6983138]];

  return v5;
}

- (BOOL)isJPEG
{
  v2 = MEMORY[0x1E69C08F0];
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [v2 typeWithIdentifier:uniformTypeIdentifier];
  v5 = [v4 isEqual:*MEMORY[0x1E6982E58]];

  return v5;
}

- (void)reportSharedAssetIncrementalChange:(id)change
{
  changeCopy = change;
  if ([changeCopy collectionChangeType])
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:7723 description:@"only supports private/shared transitions against the shared state or suggested-by-photos state for an asset being updated (not inserted or deleted)"];
  }

  moment = [(PLManagedAsset *)self moment];
  [moment reportSharedAssetContainerIncrementalChange:changeCopy forAllAssetsCountKey:@"assetsCount"];

  v7 = [objc_alloc(MEMORY[0x1E695DFA8]) initWithCapacity:6];
  v18 = MEMORY[0x1E69E9820];
  v19 = 3221225472;
  v20 = __53__PLManagedAsset_reportSharedAssetIncrementalChange___block_invoke;
  v21 = &unk_1E7567838;
  v22 = changeCopy;
  v23 = v7;
  v8 = v7;
  v9 = changeCopy;
  v10 = _Block_copy(&v18);
  v11 = [(PLManagedAsset *)self highlightBeingAssets:v18];
  v10[2](v10, v11, @"assetsCount");

  highlightBeingSummaryAssets = [(PLManagedAsset *)self highlightBeingSummaryAssets];
  v10[2](v10, highlightBeingSummaryAssets, @"summaryCount");

  highlightBeingExtendedAssets = [(PLManagedAsset *)self highlightBeingExtendedAssets];
  v10[2](v10, highlightBeingExtendedAssets, @"extendedCount");

  dayGroupHighlightBeingAssets = [(PLManagedAsset *)self dayGroupHighlightBeingAssets];
  v10[2](v10, dayGroupHighlightBeingAssets, @"dayGroupAssetsCount");

  dayGroupHighlightBeingSummaryAssets = [(PLManagedAsset *)self dayGroupHighlightBeingSummaryAssets];
  v10[2](v10, dayGroupHighlightBeingSummaryAssets, @"dayGroupSummaryAssetsCount");

  dayGroupHighlightBeingExtendedAssets = [(PLManagedAsset *)self dayGroupHighlightBeingExtendedAssets];
  v10[2](v10, dayGroupHighlightBeingExtendedAssets, @"dayGroupExtendedAssetsCount");
}

void __53__PLManagedAsset_reportSharedAssetIncrementalChange___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v8 = a2;
  v5 = a3;
  v6 = *(a1 + 32);
  if (v8)
  {
    if ([*(a1 + 32) hasSuggestionChanges])
    {
      if ([*(a1 + 40) containsObject:v8])
      {
        v7 = [*(a1 + 32) copy];

        [v7 setSuggestionStateChange:0];
        v6 = v7;
      }

      else
      {
        [*(a1 + 40) addObject:v8];
      }
    }

    [v8 reportSharedAssetContainerIncrementalChange:v6 forAllAssetsCountKey:v5];
  }
}

- (void)removeLibraryScopeAndContributors
{
  [(PLManagedAsset *)self setLibraryScope:0];

  [(PLManagedAsset *)self setLibraryScopeContributors:0];
}

- (void)setLibraryScope:(id)scope withContributors:(id)contributors
{
  contributorsCopy = contributors;
  [(PLManagedAsset *)self setLibraryScope:scope];
  [(PLManagedAsset *)self setLibraryScopeContributors:contributorsCopy];
}

- (void)setLibraryScopeWithCurrentUserAsContributor:(id)contributor
{
  contributorCopy = contributor;
  currentUserParticipant = [contributorCopy currentUserParticipant];
  if (currentUserParticipant)
  {
    v5 = [MEMORY[0x1E695DFD8] setWithObject:currentUserParticipant];
    [(PLManagedAsset *)self setLibraryScope:contributorCopy withContributors:v5];
  }

  else
  {
    [(PLManagedAsset *)self setLibraryScope:contributorCopy withContributors:0];
  }
}

- (void)setCollectionShare:(id)share withContributor:(id)contributor
{
  contributorCopy = contributor;
  [(PLManagedAsset *)self setCollectionShare:share];
  [(PLManagedAsset *)self setCollectionShareContributor:contributorCopy];
}

- (void)setCollectionShareWithCurrentUserAsContributor:(id)contributor
{
  contributorCopy = contributor;
  currentUserParticipant = [contributorCopy currentUserParticipant];
  [(PLManagedAsset *)self setCollectionShare:contributorCopy withContributor:currentUserParticipant];
}

- (void)setCollectionShareContributor:(id)contributor
{
  contributorCopy = contributor;
  if (contributorCopy)
  {
    collectionShareAssetContributor = [(PLManagedAsset *)self collectionShareAssetContributor];

    if (!collectionShareAssetContributor)
    {
      managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
      v6 = [(PLManagedObject *)PLAssetContributor insertInManagedObjectContext:managedObjectContext];

      [(PLManagedAsset *)self setCollectionShareAssetContributor:v6];
    }

    collectionShareAssetContributor2 = [(PLManagedAsset *)self collectionShareAssetContributor];
    [collectionShareAssetContributor2 setParticipant:contributorCopy];
    goto LABEL_5;
  }

  if ((MEMORY[0x19EAEE520]() & 1) == 0 && ([(PLManagedAsset *)self cloudIsMyAsset]& 1) == 0)
  {
    collectionShareAssetContributor2 = [MEMORY[0x1E696AEC0] stringWithFormat:@"TTR: Inconsistent Shared Albums participant state"];
    v8 = MEMORY[0x1E696AEC0];
    uuid = [(PLManagedAsset *)self uuid];
    callStackSymbols = [MEMORY[0x1E696AF00] callStackSymbols];
    v11 = [v8 stringWithFormat:@"Your Shared Albums have experienced an unexpected state, please file a Radar against Photos to help us diagnose the issue. \n\nAsset UUID: %@ \n\nCalled by stack: %@", uuid, callStackSymbols];

    [PLDiagnostics fileRadarUserNotificationWithHeader:@"Inconsistent Shared Albums participant state detected" message:@"Your Shared Albums have experienced an unexpected state radarTitle:please file a Radar against Photos to help us diagnose the issue" radarDescription:collectionShareAssetContributor2, v11];
LABEL_5:
  }
}

- (PLShareParticipant)collectionShareContributor
{
  collectionShareAssetContributor = [(PLManagedAsset *)self collectionShareAssetContributor];
  participant = [collectionShareAssetContributor participant];

  return participant;
}

- (void)setLibraryScopeContributors:(id)contributors
{
  v37 = *MEMORY[0x1E69E9840];
  contributorsCopy = contributors;
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  v26 = contributorsCopy;
  v6 = [contributorsCopy mutableCopy];
  selfCopy = self;
  libraryScopeAssetContributors = [(PLManagedAsset *)self libraryScopeAssetContributors];
  v8 = [libraryScopeAssetContributors mutableCopy];

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  v9 = [v8 copy];
  v10 = [v9 countByEnumeratingWithState:&v31 objects:v36 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v32;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v32 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v31 + 1) + 8 * i);
        participant = [v14 participant];
        v16 = [v6 containsObject:participant];

        if (v16)
        {
          participant2 = [v14 participant];
          [v6 removeObject:participant2];
        }

        else
        {
          [managedObjectContext deleteObject:v14];
          [v8 removeObject:v14];
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v31 objects:v36 count:16];
    }

    while (v11);
  }

  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  v18 = v6;
  v19 = [v18 countByEnumeratingWithState:&v27 objects:v35 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v28;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v28 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v27 + 1) + 8 * j);
        v24 = [(PLManagedObject *)PLAssetContributor insertInManagedObjectContext:managedObjectContext];
        [v24 setParticipant:v23];
        [v8 addObject:v24];
      }

      v20 = [v18 countByEnumeratingWithState:&v27 objects:v35 count:16];
    }

    while (v20);
  }

  [(PLManagedAsset *)selfCopy setLibraryScopeAssetContributors:v8];
}

- (NSSet)libraryScopeContributors
{
  v16 = *MEMORY[0x1E69E9840];
  libraryScopeAssetContributors = [(PLManagedAsset *)self libraryScopeAssetContributors];
  v3 = [objc_alloc(MEMORY[0x1E695DFA8]) initWithCapacity:{objc_msgSend(libraryScopeAssetContributors, "count")}];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v4 = libraryScopeAssetContributors;
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v12;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v4);
        }

        participant = [*(*(&v11 + 1) + 8 * i) participant];
        [v3 addObject:participant];
      }

      v6 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  return v3;
}

- (BOOL)hasNonSlomoAdjustments
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v3 = MEMORY[0x1E69C0910];
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];
    adjustmentFormatIdentifier = [unmanagedAdjustment adjustmentFormatIdentifier];
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    unmanagedAdjustment2 = [additionalAttributes2 unmanagedAdjustment];
    adjustmentFormatVersion = [unmanagedAdjustment2 adjustmentFormatVersion];
    v10 = [v3 isRecognizedSlowMotionFormatWithIdentifier:adjustmentFormatIdentifier version:adjustmentFormatVersion] ^ 1;
  }

  else
  {
    LOBYTE(v10) = 0;
  }

  return v10;
}

- (BOOL)hasUnrenderedAsyncAdjustments
{
  deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
  result = 1;
  if (deferredProcessingNeeded <= 8)
  {
    if (deferredProcessingNeeded == 1)
    {
      if ([(PLManagedAsset *)self hasAdjustments])
      {
        return 1;
      }
    }

    else if (deferredProcessingNeeded == 2)
    {
      return result;
    }

    return 0;
  }

  if (deferredProcessingNeeded == 9)
  {
    return result;
  }

  if (deferredProcessingNeeded != 10)
  {
    return 0;
  }

  return [(PLManagedAsset *)self hasAdjustments];
}

- (BOOL)hasJustBeenHidden
{
  changedValues = [(PLManagedAsset *)self changedValues];
  v3 = [changedValues objectForKeyedSubscript:@"visibilityState"];

  if (v3)
  {
    v4 = [v3 shortValue] != 0;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (BOOL)hasJustBeenShown
{
  changedValues = [(PLManagedAsset *)self changedValues];
  v3 = [changedValues objectForKeyedSubscript:@"visibilityState"];

  if (v3)
  {
    v4 = [v3 shortValue] == 0;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)_updatePackedBadgeAttributesIfNeeded:(int)needed
{
  v3 = *&needed;
  if ([(PLManagedAsset *)self packedBadgeAttributes]!= needed)
  {

    [(PLManagedAsset *)self setPackedBadgeAttributes:v3];
  }
}

- (void)setDetectedScreenshotBadgeAttribute:(BOOL)attribute
{
  attributeCopy = attribute;
  packedBadgeAttributes = [(PLManagedAsset *)self packedBadgeAttributes];
  if (attributeCopy)
  {
    v6 = 1024;
  }

  else
  {
    v6 = 0;
  }

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:packedBadgeAttributes & 0xFFFFFBFF | v6];
}

- (void)setSensitivityAnalysisState:(unsigned __int8)state
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFC7F | ((state & 7) << 7);

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setSpatialAudioControlBadgeAttribute:(unsigned __int8)attribute
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFBF | ((attribute & 1) << 6);

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setPlaybackControlBadgeAttribute:(unsigned __int8)attribute
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFDF | (32 * (attribute & 1u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setEditableDepthBadgeAttribute:(unsigned __int8)attribute
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFEF | (16 * (attribute & 1u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setProResBadgeAttribute:(unsigned __int8)attribute
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFF7 | (8 * (attribute & 1u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setKeywordBadgeAttribute:(unsigned __int8)attribute
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFFE | attribute & 1;

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)recalculateRAWBadgeAttribute
{
  if ([(PLManagedAsset *)self isRAWPlusJPEG])
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    originalResourceChoice = [additionalAttributes originalResourceChoice];
    unsignedIntegerValue = [originalResourceChoice unsignedIntegerValue];

    v6 = 0x2020102u >> (8 * unsignedIntegerValue);
    if (unsignedIntegerValue >= 4)
    {
      LOBYTE(v6) = 0;
    }
  }

  else if ([(PLManagedAsset *)self isRAWOnly])
  {
    LOBYTE(v6) = 3;
  }

  else
  {
    LOBYTE(v6) = 0;
  }

  [(PLManagedAsset *)self setRAWBadgeAttribute:v6];
}

- (void)setRAWBadgeAttribute:(unsigned __int8)attribute
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFF9 | (2 * (attribute & 3u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setIsSmartStyleableWithMetadata:(id)metadata
{
  metadataCopy = metadata;
  smartStyleIsReversible = [metadataCopy smartStyleIsReversible];
  bOOLValue = [smartStyleIsReversible BOOLValue];

  smartStyleExpectingReversibility = [metadataCopy smartStyleExpectingReversibility];
  bOOLValue2 = [smartStyleExpectingReversibility BOOLValue];

  importedByBundleIdentifier = [(PLManagedAsset *)self importedByBundleIdentifier];
  v10 = [importedByBundleIdentifier isEqualToString:*MEMORY[0x1E69BF420]];

  if (bOOLValue)
  {
    extendedAttributes = [(PLManagedAsset *)self extendedAttributes];
    sleetCast = [extendedAttributes sleetCast];
    v13 = ([sleetCast intValue] < 1) | v10;

    if ((v13 & 1) == 0)
    {
      if (![metadataCopy containsCustomStylesMetadataBlob])
      {
        v15 = PLPhotoKitIngestGetLog();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          *v17 = 0;
          _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEFAULT, "Missing smart style custom metadata.", v17, 2u);
        }

        goto LABEL_11;
      }

      goto LABEL_9;
    }
  }

  if ((bOOLValue2 & v10) != 1 || [(PLManagedAsset *)self deferredProcessingNeeded]!= 1)
  {
    if ((bOOLValue & v10) != 1)
    {
      goto LABEL_12;
    }

LABEL_9:
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    v15 = additionalAttributes;
    v16 = 1;
    goto LABEL_10;
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v15 = additionalAttributes;
  v16 = 2;
LABEL_10:
  [additionalAttributes setSleetIsReversible:v16];
LABEL_11:

LABEL_12:
}

- (BOOL)isTimelapsePlaceholder
{
  if ([(PLManagedAsset *)self kindSubtype]== 102 && ([(PLManagedAsset *)self duration], v3 == 0.0))
  {
    pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    v6 = [defaultManager fileExistsAtPath:pathForOriginalFile] ^ 1;
  }

  else
  {
    LOBYTE(v6) = 0;
  }

  return v6;
}

- (BOOL)isIncludedInCloudFeeds
{
  [MEMORY[0x1E69BF328] maskForCloudSharedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isIncludedInMoments
{
  [MEMORY[0x1E69BF328] maskForAssetsIncludedInMoments];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)canPerformEditOperation:(unint64_t)operation
{
  v22 = 0;
  v23 = &v22;
  v24 = 0x2020000000;
  v25 = 0;
  if (operation == 102)
  {
    [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders];
    [(PLManagedAsset *)self savedAssetType];
    v7 = PLValidatedSavedAssetTypeApplies();
    *(v23 + 24) = v7;
    if (v7)
    {
      if (![(PLManagedAsset *)self hasLibraryScope])
      {
        v6 = [objc_opt_class() _isLibraryScopeExiting:self] ^ 1;
        v8 = v23;
        goto LABEL_13;
      }

LABEL_9:
      v8 = v23;
      v6 = 1;
LABEL_13:
      *(v8 + 24) = v6;
      goto LABEL_14;
    }

LABEL_11:
    v6 = 0;
    goto LABEL_14;
  }

  if (operation != 103)
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke;
    aBlock[3] = &unk_1E7576208;
    aBlock[4] = self;
    aBlock[5] = &v22;
    aBlock[6] = operation;
    v9 = _Block_copy(aBlock);
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_2;
    v20[3] = &unk_1E7577EA0;
    v20[4] = &v22;
    v10 = _Block_copy(v20);
    v19[0] = MEMORY[0x1E69E9820];
    v19[1] = 3221225472;
    v19[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_3;
    v19[3] = &unk_1E7567810;
    v19[4] = &v22;
    v19[5] = operation;
    v11 = _Block_copy(v19);
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_4;
    v18[3] = &unk_1E7576208;
    v18[5] = &v22;
    v18[6] = operation;
    v18[4] = self;
    v12 = _Block_copy(v18);
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_5;
    v17[3] = &unk_1E7567810;
    v17[4] = &v22;
    v17[5] = operation;
    v13 = _Block_copy(v17);
    [MEMORY[0x1E69BF328] executeBlockForSavedAssetType:-[PLManagedAsset savedAssetType](self unknown:"savedAssetType") photoBooth:v9 photoStream:v9 camera:v11 cloudShared:v9 cameraConnectionKit:v12 cloudPhotoLibrary:v9 wallpaper_UNUSED:v9 momentShared:v10 placeholder:v9 referenced:v13 alternate:v9 guest:v9 companionSynced:v11 recovered:v9 legacyImport:v11 collectionShare:v10 unrecognized:{v9, v10}];
    v6 = *(v23 + 24);

    goto LABEL_14;
  }

  [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders];
  [(PLManagedAsset *)self savedAssetType];
  v5 = PLValidatedSavedAssetTypeApplies();
  *(v23 + 24) = v5;
  if (!v5)
  {
    goto LABEL_11;
  }

  if (![(PLManagedAsset *)self hasLibraryScope])
  {
    goto LABEL_9;
  }

  if ([objc_opt_class() _isLibraryScopeExiting:self])
  {
    v6 = 0;
    *(v23 + 24) = 0;
  }

  else
  {
    predicateToIncludeOnlyContentContributedByCurrentUser = [objc_opt_class() predicateToIncludeOnlyContentContributedByCurrentUser];
    v16 = [predicateToIncludeOnlyContentContributedByCurrentUser evaluateWithObject:self];
    *(v23 + 24) = v16;

    v6 = *(v23 + 24);
  }

LABEL_14:
  _Block_object_dispose(&v22, 8);
  return v6 & 1;
}

uint64_t __42__PLManagedAsset_canPerformEditOperation___block_invoke(uint64_t result)
{
  v1 = result;
  if (*(result + 48) == 101 && (result = [*(result + 32) hasLibraryScope], result))
  {
    result = [objc_opt_class() _isLibraryScopeExiting:*(v1 + 32)];
    if (result)
    {
      v2 = 0;
    }

    else
    {
      result = [*(v1 + 32) shareState];
      v2 = result == 1;
    }

    *(*(*(v1 + 40) + 8) + 24) = v2;
  }

  else
  {
    *(*(*(v1 + 40) + 8) + 24) = 1;
  }

  return result;
}

void __42__PLManagedAsset_canPerformEditOperation___block_invoke_4(uint64_t a1)
{
  if (*(a1 + 48) == 1)
  {
    if (([*(a1 + 32) cloudIsMyAsset] & 1) == 0)
    {
      v2 = [*(a1 + 32) cloudShareAlbum];
      if (![v2 isOwnedCloudSharedAlbum])
      {
        v4 = [*(a1 + 32) collectionShare];
        v3 = [v4 isCurrentUserOwner];

        goto LABEL_7;
      }
    }

    v3 = 1;
LABEL_7:
    *(*(*(a1 + 40) + 8) + 24) = v3;
  }
}

- (BOOL)_hasScreenshotDimensions
{
  pl_dispatch_once();
  [(PLManagedAsset *)self originalWidth];
  [(PLManagedAsset *)self originalHeight];
  v3 = DCIM_NSValueFromCGSize();
  v4 = DCIM_NSValueFromCGSize();
  if ([_hasScreenshotDimensions_screenDimensions containsObject:v3])
  {
    v5 = 1;
  }

  else
  {
    v5 = [_hasScreenshotDimensions_screenDimensions containsObject:v4];
  }

  return v5;
}

void __42__PLManagedAsset__hasScreenshotDimensions__block_invoke()
{
  v6 = [MEMORY[0x1E695DF70] arrayWithCapacity:20];
  v0 = 1;
  while (2)
  {
    switch(v0)
    {
      case 1:
      case 2:
      case 3:
      case 4:
      case 5:
      case 6:
      case 7:
      case 8:
      case 9:
      case 11:
      case 12:
      case 13:
      case 14:
      case 15:
      case 16:
      case 17:
      case 18:
      case 19:
        goto LABEL_4;
      case 10:
        v1 = DCIM_NSValueFromCGSize();
        [v6 addObject:v1];

LABEL_4:
        v2 = DCIM_NSValueFromCGSize();
        [v6 addObject:v2];

        goto LABEL_5;
      case 20:
        v3 = DCIM_NSValueFromCGSize();
        [v6 addObject:v3];

        goto LABEL_8;
      default:
LABEL_5:
        if (++v0 != 21)
        {
          continue;
        }

LABEL_8:
        v4 = [objc_alloc(MEMORY[0x1E695DFD8]) initWithArray:v6];
        v5 = _hasScreenshotDimensions_screenDimensions;
        _hasScreenshotDimensions_screenDimensions = v4;

        return;
    }
  }
}

- (BOOL)hasScreenshotMetadata
{
  imageProperties = [(PLManagedAsset *)self imageProperties];
  if (imageProperties)
  {
    objc_opt_class();
    v3 = [imageProperties objectForKey:*MEMORY[0x1E696D9B0]];
    if (objc_opt_isKindOfClass())
    {
      v4 = v3;
    }

    else
    {
      v4 = 0;
    }

    v5 = v4;

    if (v5)
    {
      objc_opt_class();
      v6 = [v5 objectForKey:*MEMORY[0x1E696DB40]];
      if (objc_opt_isKindOfClass())
      {
        v7 = v6;
      }

      else
      {
        v7 = 0;
      }

      v8 = v7;

      v9 = [v8 isEqualToString:@"Screenshot"];
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)_hasPanoramaDimensions
{
  height = [(PLManagedAsset *)self height];
  if (height)
  {
    v4 = height;
    width = [(PLManagedAsset *)self width];
    v6 = width / v4;
    if (v6 > 2.0 || v6 < 0.5)
    {
      if (width <= v4)
      {
        v8 = v4;
      }

      else
      {
        v8 = width;
      }

      if (width >= v4)
      {
        v9 = v4;
      }

      else
      {
        v9 = width;
      }

      LOBYTE(height) = v9 > 800 && v8 < 30000;
    }

    else
    {
      LOBYTE(height) = 0;
    }
  }

  return height;
}

- (BOOL)isPanorama
{
  isPhoto = [(PLManagedAsset *)self isPhoto];
  if (isPhoto)
  {
    LOBYTE(isPhoto) = [(PLManagedAsset *)self kindSubtype]== 1;
  }

  return isPhoto;
}

- (BOOL)isColorAware
{
  if ([(PLManagedAsset *)self isPhoto])
  {
    return 1;
  }

  return [(PLManagedAsset *)self isPhotoIris];
}

- (BOOL)hasVideoComponent
{
  isVideo = [(PLManagedAsset *)self isVideo];
  kindSubtype = [(PLManagedAsset *)self kindSubtype];
  return (kindSubtype - 100) < 5 || kindSubtype == 2 || isVideo;
}

- (BOOL)isHDVideo
{
  isVideo = [(PLManagedAsset *)self isVideo];
  if (isVideo)
  {
    width = [(PLManagedAsset *)self width];
    height = [(PLManagedAsset *)self height];
    LOBYTE(isVideo) = width >= 720 && height > 1279 || width > 1279 && height > 719;
  }

  return isVideo;
}

- (BOOL)isStreamedVideo
{
  isVideo = [(PLManagedAsset *)self isVideo];
  if (isVideo)
  {
    LOBYTE(isVideo) = [(PLManagedAsset *)self kindSubtype]== 100;
  }

  return isVideo;
}

- (PLCloudSharedAlbumProtocol)cloudShareAlbum
{
  v16 = *MEMORY[0x1E69E9840];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  albums = [(PLManagedAsset *)self albums];
  v3 = [albums countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v12;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(albums);
        }

        v8 = *(*(&v11 + 1) + 8 * i);
        if ([v8 isCloudSharedAlbum])
        {
          v9 = v8;

          v5 = v9;
        }
      }

      v4 = [albums countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (BOOL)isCloudPhotoLibraryAsset
{
  [MEMORY[0x1E69BF328] maskForCloudPhotoLibraryAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isVisibleForSocialGroupKeyAssetFetch
{
  if (([(PLManagedAsset *)self hidden]& 1) != 0 || [(PLManagedAsset *)self trashedState]|| ![(PLManagedAsset *)self avalanchePickTypeIsVisible])
  {
    v3 = 0;
  }

  else
  {
    [MEMORY[0x1E69BF328] maskForSocialGroupKeyAssetFetch];
    [(PLManagedAsset *)self savedAssetType];
    v3 = PLValidatedSavedAssetTypeApplies();
  }

  photoLibrary = [(PLManagedObject *)self photoLibrary];
  isCloudPhotoLibraryEnabled = [photoLibrary isCloudPhotoLibraryEnabled];

  if (isCloudPhotoLibraryEnabled)
  {
    if (!v3)
    {
      return 0;
    }

    return ![(PLManagedAsset *)self isPhotoStreamPhoto];
  }

  if (v3)
  {
    [(PLManagedAsset *)self setVisibilityState:0];
    return ![(PLManagedAsset *)self isPhotoStreamPhoto];
  }

  return 0;
}

- (BOOL)isReferencedAsset
{
  [MEMORY[0x1E69BF328] maskForReferencedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isCameraConnectionKitAsset
{
  [MEMORY[0x1E69BF328] maskForCameraConnectionKitAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isCPLSharingScopeAsset
{
  [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLSharingScopes];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isCloudSharedAsset
{
  [MEMORY[0x1E69BF328] maskForCloudSharedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isFinderSyncedAsset
{
  [MEMORY[0x1E69BF328] maskForFinderSyncedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isPlaceholderAsset
{
  [MEMORY[0x1E69BF328] maskForPlaceholderAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isPhotoStreamPhoto
{
  [MEMORY[0x1E69BF328] maskForPhotoStreamAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (CLLocationCoordinate2D)gpsCoordinate
{
  location = [(PLManagedAsset *)self location];
  v3 = location;
  v5 = *MEMORY[0x1E6985CC0];
  v4 = *(MEMORY[0x1E6985CC0] + 8);
  if (location)
  {
    [location coordinate];
    v7 = v6;
    v9 = v8;
    if ([PLLocationUtils canUseCoordinate:?])
    {
      v4 = v9;
      v5 = v7;
    }
  }

  v10 = v5;
  v11 = v4;
  result.longitude = v11;
  result.latitude = v10;
  return result;
}

- (id)managedAssetForPhotoLibrary:(id)library
{
  libraryCopy = library;
  photoLibrary = [(PLManagedObject *)self photoLibrary];

  if (photoLibrary == libraryCopy)
  {
    selfCopy = self;
  }

  else
  {
    selfCopy = 0;
  }

  return selfCopy;
}

- (void)setImageSize:(CGSize)size
{
  height = size.height;
  [(PLManagedAsset *)self setWidth:vcvtpd_s64_f64(size.width)];
  v5 = vcvtpd_s64_f64(height);

  [(PLManagedAsset *)self setHeight:v5];
}

- (CGSize)imageSize
{
  width = [(PLManagedAsset *)self width];
  height = [(PLManagedAsset *)self height];
  v5 = width;
  result.height = height;
  result.width = v5;
  return result;
}

- (unsigned)shareState
{
  libraryScope = [(PLManagedAsset *)self libraryScope];

  if (!libraryScope)
  {
    return 0;
  }

  predicateToIncludeOnlyContentContributedByCurrentUser = [objc_opt_class() predicateToIncludeOnlyContentContributedByCurrentUser];
  v5 = [predicateToIncludeOnlyContentContributedByCurrentUser evaluateWithObject:self];

  if (v5)
  {
    return 1;
  }

  else
  {
    return 2;
  }
}

- (id)imageDataForThumbGenerationAndIfNeededRAWUTI:(id *)i isPreviewSource:(BOOL *)source
{
  v35 = *MEMORY[0x1E69E9840];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  if ([(PLManagedAsset *)self hasUnrenderedAsyncAdjustments])
  {
    pathForAsyncAdjustedRenderPreviewImageFile = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
    v9 = [defaultManager fileExistsAtPath:pathForAsyncAdjustedRenderPreviewImageFile];
    v10 = v9;
    if (v9)
    {
      pathForLargeThumbnailFile2 = pathForAsyncAdjustedRenderPreviewImageFile;
    }

    else
    {
      pathForLargeThumbnailFile2 = 0;
    }
  }

  else
  {
    v10 = 0;
    pathForLargeThumbnailFile2 = 0;
  }

  isPhoto = [(PLManagedAsset *)self isPhoto];
  if (!pathForLargeThumbnailFile2 && isPhoto)
  {
    if ([(PLManagedAsset *)self hasAdjustments])
    {
      pathForLargeThumbnailFile2 = [(PLManagedAsset *)self pathForBestAvailableFullsizeRenderImageFileOutIsSubstandard:0];
      pathForLargeThumbnailFile = PLThumbnailsGetLog();
      if (os_log_type_enabled(pathForLargeThumbnailFile, OS_LOG_TYPE_DEBUG))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138412546;
        v32 = pathForLargeThumbnailFile2;
        v33 = 2114;
        v34 = uuid;
        _os_log_impl(&dword_19BF1F000, pathForLargeThumbnailFile, OS_LOG_TYPE_DEBUG, "Best available file for thumbnail generation is %@ for uuid %{public}@", buf, 0x16u);
      }
    }

    else
    {
      pathForLargeThumbnailFile = [(PLManagedAsset *)self pathForLargeThumbnailFile];
      if ([defaultManager fileExistsAtPath:pathForLargeThumbnailFile])
      {
        pathForLargeThumbnailFile = pathForLargeThumbnailFile;
        pathForLargeThumbnailFile2 = pathForLargeThumbnailFile;
      }

      else
      {
        pathForFullsizeImageFile = [(PLManagedAsset *)self pathForFullsizeImageFile];
        if ([defaultManager fileExistsAtPath:pathForFullsizeImageFile])
        {
          pathForLargeThumbnailFile2 = pathForFullsizeImageFile;
        }

        else
        {
          pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
          if ([defaultManager fileExistsAtPath:pathForOriginalFile])
          {
            v30 = pathForOriginalFile;
            pathForLargeThumbnailFile2 = pathForOriginalFile;
            pathExtension = [pathForLargeThumbnailFile2 pathExtension];
            v18 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:pathExtension assetType:[(PLManagedAsset *)self kind]];

            v19 = v18;
            if (v18)
            {
              [MEMORY[0x1E6982C40] typeWithIdentifier:v18];
              v20 = v29 = v18;
              v21 = [v20 conformsToType:*MEMORY[0x1E6982F88]];

              v19 = v29;
              if (v21)
              {
                if (i)
                {
                  v22 = v29;
                  *i = v29;
                }

                v23 = PLBackendGetLog();
                if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
                {
                  *buf = 138412546;
                  v32 = pathForLargeThumbnailFile2;
                  v33 = 2112;
                  v34 = pathForFullsizeImageFile;
                  _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_DEFAULT, "Rebuilding thumbs from RAW file (%@) because fullsize image is missing (%@). This might cause assetsd to jetsam.", buf, 0x16u);
                }
              }
            }

            pathForOriginalFile = v30;
          }

          else
          {
            pathForLargeThumbnailFile2 = 0;
          }
        }
      }
    }
  }

  if (!pathForLargeThumbnailFile2)
  {
    if (!-[PLManagedAsset isVideo](self, "isVideo") && ([defaultManager fileExistsAtPath:0] & 1) != 0)
    {
      pathForLargeThumbnailFile2 = 0;
      goto LABEL_48;
    }

    pathForLargeThumbnailFile2 = [(PLManagedAsset *)self pathForLargeThumbnailFile];
    if (([defaultManager fileExistsAtPath:pathForLargeThumbnailFile2] & 1) == 0)
    {
      pathForMediumThumbnailFile = [(PLManagedAsset *)self pathForMediumThumbnailFile];

      if (([defaultManager fileExistsAtPath:pathForMediumThumbnailFile] & 1) != 0 || (!-[PLManagedAsset isPhoto](self, "isPhoto") || -[PLManagedAsset hasAdjustments](self, "hasAdjustments")) && (!-[PLManagedAsset isVideo](self, "isVideo") || -[PLManagedAsset hasAdjustments](self, "hasAdjustments") && !-[PLManagedAsset isDefaultAdjustedSlomo](self, "isDefaultAdjustedSlomo")))
      {
        pathForLargeThumbnailFile2 = pathForMediumThumbnailFile;
      }

      else
      {
        pathForLargeThumbnailFile2 = [(PLManagedAsset *)self pathForOriginalFile];
      }
    }

    if (!pathForLargeThumbnailFile2)
    {
      goto LABEL_48;
    }
  }

  if (![defaultManager fileExistsAtPath:pathForLargeThumbnailFile2])
  {
LABEL_48:
    v27 = 0;
    if (!source)
    {
      goto LABEL_50;
    }

    goto LABEL_49;
  }

  v25 = PLThumbnailsGetLog();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
  {
    uuid2 = [(PLManagedAsset *)self uuid];
    *buf = 138543618;
    v32 = uuid2;
    v33 = 2112;
    v34 = pathForLargeThumbnailFile2;
    _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Rebuilding thumbnail for %{public}@ with %@", buf, 0x16u);
  }

  v27 = [MEMORY[0x1E695DEF0] dataWithContentsOfFile:pathForLargeThumbnailFile2 options:1 error:0];
  if (source)
  {
LABEL_49:
    *source = v10;
  }

LABEL_50:

  return v27;
}

- (void)setFaceRegionsFromImageMetadata:(CGImageMetadata *)metadata
{
  if (metadata)
  {
    v5 = PLGetFaceRegionsFromImageMetadata(metadata);
    v4 = PLManagedAssetEncodeFaceRegions(v5);
    [(PLManagedAsset *)self setFaceRegions:v4];
  }
}

- (void)setFaceRegionsFromCGImageProperties:(id)properties
{
  v5 = PLGetFaceRegionsFromCGImageProperties(properties);
  v4 = PLManagedAssetEncodeFaceRegions(v5);
  [(PLManagedAsset *)self setFaceRegions:v4];
}

- (BOOL)setVideoInfoFromFileAtURL:(id)l mainFileMetadata:(id)metadata fullSizeRenderURL:(id)rL overwriteOriginalProperties:(BOOL)properties
{
  propertiesCopy = properties;
  v37 = *MEMORY[0x1E69E9840];
  lCopy = l;
  metadataCopy = metadata;
  rLCopy = rL;
  if (lCopy | metadataCopy)
  {
    v34 = 0;
    v14 = [(PLManagedAsset *)self _effectiveMetadataForMainFileURL:lCopy mainFileMetadata:metadataCopy fullSizeRenderURL:rLCopy shouldCache:0 error:&v34];
    v15 = v34;
    v16 = v14 != 0;
    if (v14)
    {
      v17 = objc_autoreleasePoolPush();
      [(PLManagedAsset *)self updateVideoAttributesFromMetadata:v14 overwriteOriginalProperties:propertiesCopy];
      if (propertiesCopy)
      {
        if (rLCopy)
        {
          currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
          [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:6740 description:@"Overwriting original properties should only happen when fullSizeRenderURL is nil"];
        }

        [v14 orientedPixelSize];
        v19 = v18;
        [(PLManagedAsset *)self setOriginalWidth:v20];
        [(PLManagedAsset *)self setOriginalHeight:v19];
        gpsLocation = [v14 gpsLocation];
        if (gpsLocation && (v22 = gpsLocation, [v14 gpsLocation], v23 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v23, "coordinate"), v24 = +[PLLocationUtils canUseCoordinate:](PLLocationUtils, "canUseCoordinate:"), v23, v22, v24))
        {
          gpsLocation2 = [v14 gpsLocation];
          [(PLManagedAsset *)self setLocation:gpsLocation2];
        }

        else
        {
          [(PLManagedAsset *)self setLocation:0];
        }

        originatingAssetIdentifier = [v14 originatingAssetIdentifier];
        if (originatingAssetIdentifier)
        {
          additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
          [additionalAttributes setOriginatingAssetIdentifier:originatingAssetIdentifier];
        }

        if (PLPlatformExtendedAttributesSupported() && ![(PLManagedAsset *)self isCloudSharedAsset])
        {
          [(PLManagedAsset *)self updateVideoExtendedAttributesFromMetadata:v14];
        }

        author = [v14 author];
        v30 = [author isEqual:@"ReplayKitRecording"];

        if (v30)
        {
          [(PLManagedAsset *)self setKindSubtype:103];
        }

        v17 = v33;
      }

      objc_autoreleasePoolPop(v17);
    }

    else
    {
      v26 = PLBackendGetLog();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v36 = v15;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Unable to load metadata with error: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    v16 = 0;
  }

  return v16;
}

- (id)_effectiveMetadataForMainFileURL:(id)l mainFileMetadata:(id)metadata fullSizeRenderURL:(id)rL shouldCache:(BOOL)cache error:(id *)error
{
  cacheCopy = cache;
  v52 = *MEMORY[0x1E69E9840];
  lCopy = l;
  metadataCopy = metadata;
  rLCopy = rL;
  if ([metadataCopy isSyndicationOriginated])
  {
    v16 = metadataCopy;
    v17 = 0;
  }

  else
  {
    if (rLCopy)
    {
      v18 = 0;
    }

    else
    {
      v18 = metadataCopy;
    }

    v19 = v18;
    v16 = v19;
    if (v19)
    {
      fileURL = [v19 fileURL];

      if (fileURL)
      {
        v21 = 0;
        v16 = metadataCopy;
        goto LABEL_24;
      }
    }

    aSelector = a2;
    errorCopy = error;
    if (rLCopy)
    {
      v22 = rLCopy;
    }

    else
    {
      v22 = lCopy;
    }

    v23 = v22;
    if (v23)
    {
      v24 = v23;
      v25 = objc_alloc(MEMORY[0x1E69C0718]);
      photoLibrary = [(PLManagedObject *)self photoLibrary];
      libraryBundle = [photoLibrary libraryBundle];
      timeZoneLookup = [libraryBundle timeZoneLookup];
      v29 = v25;
      v23 = v24;
      v30 = [v29 initWithMediaURL:v24 options:12 timeZoneLookup:timeZoneLookup shouldCache:cacheCopy];

      v16 = v30;
    }

    if (v16)
    {
      v17 = 0;
    }

    else
    {
      v31 = PLMigrationGetLog();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = NSStringFromSelector(aSelector);
        path = [v23 path];
        *buf = 138412546;
        v49 = v32;
        v50 = 2112;
        v51 = path;
        _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "%@ Unable to get file metadata for '%@', skip updating asset attributes", buf, 0x16u);
      }

      aSelectora = MEMORY[0x1E696ABC0];
      v34 = *MEMORY[0x1E69BFF48];
      v46 = *MEMORY[0x1E696A278];
      v35 = MEMORY[0x1E696AEC0];
      path2 = [v23 path];
      v37 = [v35 stringWithFormat:@"Unable to load file metadata from path %@", path2];
      v47 = v37;
      [MEMORY[0x1E695DF20] dictionaryWithObjects:&v47 forKeys:&v46 count:1];
      v39 = v38 = v23;
      v17 = [aSelectora errorWithDomain:v34 code:47020 userInfo:v39];

      v23 = v38;
    }

    error = errorCopy;
  }

  v40 = v17;
  v21 = v40;
  if (!v16)
  {
    if (error)
    {
      v41 = v40;
      v16 = 0;
      *error = v21;
    }

    else
    {
      v16 = 0;
    }
  }

LABEL_24:

  return v16;
}

- (id)_metadataFromMediaProperties:(id)properties uniformTypeIdentifier:(id)identifier block:(id)block
{
  v33 = *MEMORY[0x1E69E9840];
  propertiesCopy = properties;
  identifierCopy = identifier;
  blockCopy = block;
  objc_opt_class();
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  if (objc_opt_isKindOfClass())
  {
    v12 = managedObjectContext;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  pl_libraryBundle = [v13 pl_libraryBundle];

  timeZoneLookup = [pl_libraryBundle timeZoneLookup];

  if (!propertiesCopy)
  {
    goto LABEL_16;
  }

  kind = [(PLManagedAsset *)self kind];
  if ((kind - 1) < 2)
  {
    v19 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVProxyData:propertiesCopy timeZoneLookup:timeZoneLookup];
    if (!v19)
    {
      goto LABEL_16;
    }

    goto LABEL_11;
  }

  if (kind == 3)
  {
    v22 = PLBackendGetLog();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v31 = 67109120;
      LODWORD(v32) = [(PLManagedAsset *)self kind];
      _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Unexpected asset kind: %d", &v31, 8u);
    }

LABEL_16:
    if (!blockCopy)
    {
LABEL_30:
      v20 = PLBackendGetLog();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
      {
        uuid = [(PLManagedAsset *)self uuid];
        v31 = 138543362;
        v32 = uuid;
        _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Failed to obtain media metadata for asset: %{public}@", &v31, 0xCu);
      }

      v19 = 0;
      goto LABEL_33;
    }

    v20 = blockCopy[2](blockCopy);
    kind2 = [(PLManagedAsset *)self kind];
    if ((kind2 - 1) >= 2)
    {
      if (kind2 == 3)
      {
        v27 = PLBackendGetLog();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
        {
          kind3 = [(PLManagedAsset *)self kind];
          v31 = 67109120;
          LODWORD(v32) = kind3;
          _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_ERROR, "Unexpected asset kind: %d", &v31, 8u);
        }
      }

      else if (!kind2)
      {
        v24 = [objc_alloc(MEMORY[0x1E69C0718]) initWithImageURL:v20 contentType:0 options:12 timeZoneLookup:timeZoneLookup cacheImageSource:1 cacheImageData:0];
        goto LABEL_22;
      }

LABEL_29:

      goto LABEL_30;
    }

    v24 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVURL:v20 options:12 timeZoneLookup:timeZoneLookup];
LABEL_22:
    v19 = v24;
    if (v24)
    {
      v25 = PLBackendGetLog();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
      {
        uuid2 = [(PLManagedAsset *)self uuid];
        v31 = 138543362;
        v32 = uuid2;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Metadata obtained from file url for asset: %{public}@", &v31, 0xCu);
      }

      goto LABEL_33;
    }

    goto LABEL_29;
  }

  if (kind)
  {
    goto LABEL_16;
  }

  v17 = objc_alloc(MEMORY[0x1E69C0718]);
  v18 = [MEMORY[0x1E69C08F0] typeWithIdentifier:identifierCopy];
  v19 = [v17 initWithImageSourceProxyOrEncodedImagePropertyData:propertiesCopy contentType:v18 timeZoneLookup:timeZoneLookup];

  if (!v19)
  {
    goto LABEL_16;
  }

LABEL_11:
  v20 = PLBackendGetLog();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
  {
    uuid3 = [(PLManagedAsset *)self uuid];
    v31 = 138543362;
    v32 = uuid3;
    _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Metadata obtained from mediaMetadata data for asset: %{public}@", &v31, 0xCu);
  }

LABEL_33:

  return v19;
}

- (id)fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:(id)l
{
  lCopy = l;
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
    v12 = MEMORY[0x1E69E9820];
    v13 = 3221225472;
    v14 = __93__PLManagedAsset_fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL___block_invoke;
    v15 = &unk_1E75677C0;
    v16 = lCopy;
    selfCopy = self;
    v6 = [(PLManagedAsset *)self _metadataFromMediaProperties:0 uniformTypeIdentifier:uniformTypeIdentifier block:&v12];

    if (!v6)
    {
      v7 = [(PLManagedAsset *)self additionalAttributes:v12];
      mediaMetadata = [v7 mediaMetadata];
      data = [mediaMetadata data];

      uniformTypeIdentifier2 = [(PLManagedAsset *)self uniformTypeIdentifier];
      v6 = [(PLManagedAsset *)self _metadataFromMediaProperties:data uniformTypeIdentifier:uniformTypeIdentifier2 block:0];
    }
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

id __93__PLManagedAsset_fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) pathForAdjustedFullsizeImageFile];
  v4 = v3;
  if (v2)
  {
    v5 = 1;
  }

  else
  {
    v5 = v3 == 0;
  }

  if (!v5)
  {
    v2 = [MEMORY[0x1E695DFF8] fileURLWithPath:v3 isDirectory:0];
  }

  return v2;
}

- (id)metadataFromMediaPropertiesOrOriginalResource
{
  master = [(PLManagedAsset *)self master];
  mediaMetadata = [master mediaMetadata];
  data = [mediaMetadata data];

  master2 = [(PLManagedAsset *)self master];
  uniformTypeIdentifier = [master2 uniformTypeIdentifier];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __63__PLManagedAsset_metadataFromMediaPropertiesOrOriginalResource__block_invoke;
  v10[3] = &unk_1E7567798;
  v10[4] = self;
  v8 = [(PLManagedAsset *)self _metadataFromMediaProperties:data uniformTypeIdentifier:uniformTypeIdentifier block:v10];

  return v8;
}

- (void)updateVideoAttributesFromMetadata:(id)metadata overwriteOriginalProperties:(BOOL)properties
{
  propertiesCopy = properties;
  metadataCopy = metadata;
  if (metadataCopy)
  {
    v23 = metadataCopy;
    durationTimeInterval = [metadataCopy durationTimeInterval];
    [durationTimeInterval doubleValue];
    v9 = v8;

    [(PLManagedAsset *)self duration];
    if (vabdd_f64(v10, v9) > 0.00000011920929)
    {
      [(PLManagedAsset *)self setDuration:v9];
    }

    [v23 orientedPixelSize];
    v12 = v11;
    v14 = v13;
    if (v11 != [(PLManagedAsset *)self width])
    {
      [(PLManagedAsset *)self setWidth:v12];
    }

    if (v14 != [(PLManagedAsset *)self height])
    {
      [(PLManagedAsset *)self setHeight:v14];
    }

    highFrameRateState = [(PLManagedAsset *)self highFrameRateState];
    if ([v23 isSloMo])
    {
      if (propertiesCopy)
      {
        v16 = highFrameRateState | 3;
        [(PLManagedAsset *)self setKindSubtype:101];
      }

      else
      {
        v16 = highFrameRateState | 2;
      }
    }

    else if (highFrameRateState)
    {
      v16 = highFrameRateState & 0xFFFD;
    }

    else
    {
      v16 = highFrameRateState;
    }

    if ([(PLManagedAsset *)self highFrameRateState]!= v16)
    {
      [(PLManagedAsset *)self setHighFrameRateState:v16];
    }

    [(PLManagedAsset *)self setPlaybackControlBadgeAttributeFromMetadata:v23];
    if (-[PLManagedAsset kindSubtype](self, "kindSubtype") != 102 && [v23 isTimelapse])
    {
      [(PLManagedAsset *)self setKindSubtype:102];
    }

    if (-[PLManagedAsset kindSubtype](self, "kindSubtype") != 104 && [v23 isActionCam])
    {
      [(PLManagedAsset *)self setKindSubtype:104];
    }

    playbackVariation = [v23 playbackVariation];
    -[PLManagedAsset updatePlaybackVariationAndLoopingStyleFromVariation:](self, "updatePlaybackVariationAndLoopingStyleFromVariation:", [playbackVariation unsignedIntegerValue]);

    [(PLManagedAsset *)self updateSmartStyleVideoCastFromMetadata:v23];
    montageString = [v23 montageString];
    if (montageString)
    {
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes setMontage:montageString];
    }

    mediaGroupUUID = [(PLManagedAsset *)self mediaGroupUUID];
    v21 = [mediaGroupUUID length];

    if (!v21)
    {
      livePhotoPairingIdentifier = [v23 livePhotoPairingIdentifier];
      if (livePhotoPairingIdentifier)
      {
        [(PLManagedAsset *)self setMediaGroupUUID:livePhotoPairingIdentifier];
      }
    }

    [(PLManagedAsset *)self setTimeExifTimestampStringFromMetadata:v23];
    [(PLManagedAsset *)self setSpatialTypeFromMetadata:v23];
    if ([v23 isHDR])
    {
      [(PLManagedAsset *)self _setHDRTypeFromMetadata:v23];
    }

    if ([v23 isCinematicVideo])
    {
      [(PLManagedAsset *)self setDepthTypeFromMetadata:v23];
    }

    [(PLManagedAsset *)self setSpatialAudioControlBadgeAttributeFromMetadata:v23];
    if ([v23 isProRes])
    {
      [(PLManagedAsset *)self setIsMagicCarpet:1];
      [(PLManagedAsset *)self setProResBadgeAttribute:1];
    }

    [(PLManagedAsset *)self setCameraCaptureDeviceFromMetadata:v23];

    metadataCopy = v23;
  }
}

- (void)updateAudioExtendedAttributesFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (metadataCopy)
  {
    durationTimeInterval = [metadataCopy durationTimeInterval];
    [durationTimeInterval doubleValue];
    v7 = v6;

    duration = [v4 duration];
    [duration doubleValue];
    v10 = vabdd_f64(v9, v7);

    if (v10 > 2.22044605e-16)
    {
      v11 = [MEMORY[0x1E696AD98] numberWithDouble:v7];
      [v4 setDuration:v11];
    }

    audioSampleRate = [metadataCopy audioSampleRate];
    [audioSampleRate doubleValue];
    v14 = v13;

    sampleRate = [v4 sampleRate];
    [sampleRate doubleValue];
    v17 = vabdd_f64(v16, v14);

    if (v17 > 2.22044605e-16)
    {
      v18 = [MEMORY[0x1E696AD98] numberWithDouble:v14];
      [v4 setSampleRate:v18];
    }

    audioTrackFormat = [metadataCopy audioTrackFormat];
    unsignedIntegerValue = [audioTrackFormat unsignedIntegerValue];

    trackFormat = [v4 trackFormat];
    unsignedIntegerValue2 = [trackFormat unsignedIntegerValue];

    if (unsignedIntegerValue2 != unsignedIntegerValue)
    {
      v23 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:unsignedIntegerValue];
      [v4 setTrackFormat:v23];
    }

    audioDataRate = [metadataCopy audioDataRate];
    [audioDataRate doubleValue];
    v26 = v25;

    bitrate = [v4 bitrate];
    [bitrate doubleValue];
    v29 = vabdd_f64(v28, v26);

    if (v29 > 2.22044605e-16)
    {
      v30 = [MEMORY[0x1E696AD98] numberWithDouble:v14];
      [v4 setBitrate:v30];
    }
  }
}

- (void)updateVideoExtendedAttributesFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (metadataCopy)
  {
    [(PLManagedAsset *)self _updateCoreExtendedAttributes:v4 fromMetadata:metadataCopy];
    v5 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(metadataCopy, "orientation")}];
    [v4 setOrientation:v5];

    durationTimeInterval = [metadataCopy durationTimeInterval];
    if (durationTimeInterval)
    {
      duration = [v4 duration];
      [duration doubleValue];
      v9 = v8;
      [durationTimeInterval doubleValue];
      v11 = vabdd_f64(v9, v10);

      if (v11 > 2.22044605e-16)
      {
        [v4 setDuration:durationTimeInterval];
      }
    }

    nominalFrameRate = [metadataCopy nominalFrameRate];
    if (nominalFrameRate)
    {
      v13 = [v4 fps];
      [v13 doubleValue];
      v15 = v14;
      [nominalFrameRate doubleValue];
      v17 = vabdd_f64(v15, v16);

      if (v17 > 2.22044605e-16)
      {
        [v4 setFps:nominalFrameRate];
      }
    }

    firstVideoTrackCodecString = [metadataCopy firstVideoTrackCodecString];
    codec = [v4 codec];
    v20 = [firstVideoTrackCodecString isEqualToString:codec];

    if ((v20 & 1) == 0)
    {
      [v4 setCodec:firstVideoTrackCodecString];
    }
  }
}

- (BOOL)setImageInfoFromImageMetadata:(id)metadata overwriteOriginalProperties:(BOOL)properties
{
  propertiesCopy = properties;
  metadataCopy = metadata;
  if (metadataCopy)
  {
    v7 = objc_autoreleasePoolPush();
    cgImageProperties = [metadataCopy cgImageProperties];
    [(PLManagedAsset *)self _setSizeAndOrientationFromMetadata:metadataCopy];
    cgImageMetadata = [metadataCopy cgImageMetadata];
    if (cgImageMetadata)
    {
      [(PLManagedAsset *)self setFaceRegionsFromImageMetadata:cgImageMetadata];
      [(PLManagedAsset *)self revalidateFaceAreaPoints];
    }

    contentType = [metadataCopy contentType];
    identifier = [contentType identifier];
    [(PLManagedAsset *)self setUniformTypeIdentifier:identifier];

    if (propertiesCopy)
    {
      [(PLManagedAsset *)self _setOriginalSizeAndOrientationFromMetadata:metadataCopy];
      if (cgImageProperties)
      {
        [(PLManagedAsset *)self setThumbnailDataFromImageProperties:cgImageProperties];
      }

      gpsLocation = [metadataCopy gpsLocation];
      [(PLManagedAsset *)self setLocation:gpsLocation];

      [(PLManagedAsset *)self _setSavedAssetTypeFromMetadata:metadataCopy];
      [(PLManagedAsset *)self setKeywordsFromImageProperties:cgImageProperties];
      [(PLManagedAsset *)self _setPhotoIrisPropertiesFromMetadata:metadataCopy];
      [(PLManagedAsset *)self updateKindSubtypeIfScreenshotWithMetadata:metadataCopy];
      [(PLManagedAsset *)self updatePanoramosityWithMetadata:metadataCopy];
      if (![(PLManagedAsset *)self isCloudSharedAsset])
      {
        [(PLManagedAsset *)self setImageInfoFromOriginalImageMetadata:metadataCopy];
      }

      v13 = MEMORY[0x1E69BF2A0];
      pl_photoLibrary = [(PLManagedAsset *)self pl_photoLibrary];
      pathManager = [pl_photoLibrary pathManager];
      libraryURL = [pathManager libraryURL];
      v17 = [v13 wellKnownPhotoLibraryIdentifierForURL:libraryURL];

      if (v17 != 3)
      {
        [(PLManagedAsset *)self _setBurstUuidFromMetadata:metadataCopy];
      }

      originatingAssetIdentifier = [metadataCopy originatingAssetIdentifier];
      if (originatingAssetIdentifier)
      {
        additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
        [additionalAttributes setOriginatingAssetIdentifier:originatingAssetIdentifier];
      }
    }

    else
    {
      [(PLManagedAsset *)self setDepthTypeFromMetadata:metadataCopy];
      [(PLManagedAsset *)self _setHDRGainFromMetadata:metadataCopy];
    }

    objc_autoreleasePoolPop(v7);
  }

  return metadataCopy != 0;
}

- (void)_setBurstUuidFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  avalancheUUID = [(PLManagedAsset *)self avalancheUUID];
  if (avalancheUUID)
  {
LABEL_2:

    goto LABEL_3;
  }

  [MEMORY[0x1E69BF328] maskForAvalancheSupportedAssets];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    avalancheUUID = [metadataCopy burstUuid];
    if (avalancheUUID)
    {
      [(PLManagedAsset *)self setAvalancheUUID:avalancheUUID];
      [(PLManagedAsset *)self setAvalanchePickType:1];
      [(PLManagedAsset *)self setAvalancheKind:1];
      if (+[PLAvalanche shouldOnlyShowAvalanchePicks])
      {
        [(PLManagedAsset *)self setVisibilityState:2];
      }
    }

    goto LABEL_2;
  }

LABEL_3:
}

- (void)setImageInfoFromOriginalImageMetadata:(id)metadata
{
  metadataCopy = metadata;
  if (metadataCopy)
  {
    [(PLManagedAsset *)self setCameraCaptureDeviceFromMetadata:metadataCopy];
    [(PLManagedAsset *)self _setHDRTypeFromMetadata:metadataCopy];
    [(PLManagedAsset *)self _setColorSpaceNameFromMetadata:metadataCopy];
    [(PLManagedAsset *)self setDepthTypeFromMetadata:metadataCopy];
    [(PLManagedAsset *)self setEditableDepthBadgeAttributeFromMetadata:metadataCopy];
    [(PLManagedAsset *)self setSpatialTypeFromMetadata:metadataCopy];
    [(PLManagedAsset *)self updatePlaybackVariationAndStyleFromOriginalMetadata:metadataCopy];
    [(PLManagedAsset *)self _setHDRGainFromMetadata:metadataCopy];
    [(PLManagedAsset *)self _setSOCGroupIdentifierFromMetadata:metadataCopy];
    [(PLManagedAsset *)self setTimeExifTimestampStringFromMetadata:metadataCopy];
    [(PLManagedAsset *)self setCurrentSleetCastFromMetadata:metadataCopy];
    if (PLPlatformExtendedAttributesSupported())
    {
      [(PLManagedAsset *)self updateImageExtendedAttributesFromMetadata:metadataCopy];
    }
  }
}

- (id)evaluateWhiteBalanceValueWithOriginalExifProperties:(id)properties
{
  propertiesCopy = properties;
  v4 = [propertiesCopy objectForKey:*MEMORY[0x1E696DB50]];
  v5 = v4;
  if (v4)
  {
    if (([v4 isEqualToNumber:&unk_1F0FBB0B0] & 1) == 0)
    {
      v6 = [propertiesCopy objectForKey:*MEMORY[0x1E696DA68]];

      v5 = v6;
      if (!v6)
      {
        v7 = [propertiesCopy objectForKey:*MEMORY[0x1E696D440]];
        v8 = v7;
        if (v7 && (v9 = [v7 integerValue], v9 <= 0x15))
        {
          v5 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:evaluateWhiteBalanceValueWithOriginalExifProperties__canonWhiteBalance[v9]];
        }

        else
        {
          v5 = 0;
        }
      }
    }
  }

  return v5;
}

- (void)updateImageExtendedGenerativeAttributesFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (metadataCopy)
  {
    generativeAIImageType = [metadataCopy generativeAIImageType];
    [v4 setGenerativeAIType:generativeAIImageType];

    credit = [metadataCopy credit];
    [v4 setCredit:credit];
  }

  else
  {
    [v4 setGenerativeAIType:0];
    [v4 setCredit:0];
  }
}

- (void)updateImageExtendedAttributesFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (metadataCopy)
  {
    [(PLManagedAsset *)self _updateCoreExtendedAttributes:v4 fromMetadata:metadataCopy];
    fNumber = [metadataCopy fNumber];
    [v4 setAperture:fNumber];

    exposureBias = [metadataCopy exposureBias];
    [v4 setExposureBias:exposureBias];

    v7 = [MEMORY[0x1E696AD98] numberWithBool:{objc_msgSend(metadataCopy, "flashFired")}];
    [v4 setFlashFired:v7];

    focalLength = [metadataCopy focalLength];
    [v4 setFocalLength:focalLength];

    focalLengthIn35mm = [metadataCopy focalLengthIn35mm];
    [v4 setFocalLengthIn35mm:focalLengthIn35mm];

    v10 = [metadataCopy iso];
    [v4 setIso:v10];

    lensModel = [metadataCopy lensModel];
    [v4 setLensModel:lensModel];

    meteringMode = [metadataCopy meteringMode];
    [v4 setMeteringMode:meteringMode];

    exposureTime = [metadataCopy exposureTime];
    [v4 setShutterSpeed:exposureTime];

    v14 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(metadataCopy, "orientation")}];
    [v4 setOrientation:v14];

    semanticStyleToneBias = [metadataCopy semanticStyleToneBias];
    [v4 setSlushSceneBias:semanticStyleToneBias];

    semanticStyleWarmthBias = [metadataCopy semanticStyleWarmthBias];
    [v4 setSlushWarmthBias:semanticStyleWarmthBias];

    semanticStyleRenderingVersion = [metadataCopy semanticStyleRenderingVersion];
    [v4 setSlushVersion:semanticStyleRenderingVersion];

    semanticStylePreset = [metadataCopy semanticStylePreset];
    [v4 setSlushPreset:semanticStylePreset];

    v19 = [MEMORY[0x1E696AD98] numberWithShort:{objc_msgSend(metadataCopy, "smartStyleCast")}];
    [v4 setSleetCast:v19];

    smartStyleToneBias = [metadataCopy smartStyleToneBias];
    [v4 setSleetToneBias:smartStyleToneBias];

    smartStyleColorBias = [metadataCopy smartStyleColorBias];
    [v4 setSleetColorBias:smartStyleColorBias];

    smartStyleIntensity = [metadataCopy smartStyleIntensity];
    [v4 setSleetIntensity:smartStyleIntensity];

    smartStyleRenderingVersion = [metadataCopy smartStyleRenderingVersion];
    [v4 setSleetRenderingVersion:smartStyleRenderingVersion];

    [(PLManagedAsset *)self setIsSmartStyleableWithMetadata:metadataCopy];
    digitalZoomRatio = [metadataCopy digitalZoomRatio];
    [v4 setDigitalZoomRatio:digitalZoomRatio];

    [(PLManagedAsset *)self updateImageExtendedGenerativeAttributesFromMetadata:metadataCopy];
    whiteBalance = [metadataCopy whiteBalance];
    if (whiteBalance)
    {
      [v4 setWhiteBalance:whiteBalance];
    }
  }
}

- (void)_updateCoreExtendedAttributes:(id)attributes fromMetadata:(id)metadata
{
  attributesCopy = attributes;
  metadataCopy = metadata;
  if (!attributesCopy || !metadataCopy)
  {
    goto LABEL_21;
  }

  creationDateSource = [metadataCopy creationDateSource];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setDateCreatedSource:creationDateSource];

  creationDateSource2 = [metadataCopy creationDateSource];
  if ((creationDateSource2 - 1) < 3)
  {
    utcCreationDate = [metadataCopy utcCreationDate];

    if (!utcCreationDate)
    {
      [(PLManagedAsset *)self _updateCoreDateExtendedAttributes:attributesCopy fromMetadata:0];
      additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes2 setDateCreatedSource:0];

      goto LABEL_10;
    }

    selfCopy2 = self;
    v12 = attributesCopy;
    v13 = metadataCopy;
    goto LABEL_8;
  }

  if (!creationDateSource2)
  {
    selfCopy2 = self;
    v12 = attributesCopy;
    v13 = 0;
LABEL_8:
    [(PLManagedAsset *)selfCopy2 _updateCoreDateExtendedAttributes:v12 fromMetadata:v13];
  }

LABEL_10:
  cameraMake = [metadataCopy cameraMake];
  cameraMake2 = [attributesCopy cameraMake];
  v17 = [cameraMake isEqualToString:cameraMake2];

  if ((v17 & 1) == 0)
  {
    [attributesCopy setCameraMake:cameraMake];
  }

  cameraModel = [metadataCopy cameraModel];
  cameraModel2 = [attributesCopy cameraModel];
  v20 = [cameraModel isEqualToString:cameraModel2];

  if ((v20 & 1) == 0)
  {
    [attributesCopy setCameraModel:cameraModel];
  }

  lensModel = [metadataCopy lensModel];
  if (lensModel)
  {
    [attributesCopy setLensModel:lensModel];
  }

  focalLengthIn35mm = [metadataCopy focalLengthIn35mm];
  if (focalLengthIn35mm)
  {
    [attributesCopy setFocalLengthIn35mm:focalLengthIn35mm];
  }

  gpsLocation = [metadataCopy gpsLocation];
  v24 = gpsLocation;
  if (gpsLocation)
  {
    v25 = MEMORY[0x1E696AD98];
    [gpsLocation coordinate];
    v26 = [v25 numberWithDouble:?];
    [attributesCopy setLatitude:v26];

    v27 = MEMORY[0x1E696AD98];
    [v24 coordinate];
    v29 = [v27 numberWithDouble:v28];
    [attributesCopy setLongitude:v29];
  }

LABEL_21:
}

- (void)_updateCoreDateExtendedAttributes:(id)attributes fromMetadata:(id)metadata
{
  metadataCopy = metadata;
  attributesCopy = attributes;
  utcCreationDate = [metadataCopy utcCreationDate];
  [attributesCopy setDateCreated:utcCreationDate];

  timeZoneName = [metadataCopy timeZoneName];
  [attributesCopy setTimezoneName:timeZoneName];

  timeZoneOffset = [metadataCopy timeZoneOffset];

  [attributesCopy setTimezoneOffset:timeZoneOffset];
}

- (BOOL)updateExtendedAttributesWithMetadata:(id)metadata error:(id *)error
{
  v36[1] = *MEMORY[0x1E69E9840];
  metadataCopy = metadata;
  if (!PLPlatformExtendedAttributesSupported())
  {
    v16 = 1;
    goto LABEL_20;
  }

  if ([(PLManagedAsset *)self kind]== 3)
  {
    v7 = MEMORY[0x1E696AEC0];
    uuid = [(PLManagedAsset *)self uuid];
    v9 = [v7 stringWithFormat:@"Unsupported asset kind for asset: %@", uuid];

    v10 = MEMORY[0x1E696ABC0];
    v11 = *MEMORY[0x1E69BFF48];
    v29 = *MEMORY[0x1E696A578];
    v30 = v9;
    v12 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v30 forKeys:&v29 count:1];
    v13 = [v10 errorWithDomain:v11 code:46309 userInfo:v12];

    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543362;
      v34 = v9;
LABEL_15:
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "%{public}@", buf, 0xCu);
    }
  }

  else
  {
    if (metadataCopy)
    {
      v13 = 0;
      kind = [(PLManagedAsset *)self kind];
      v16 = 1;
      if (kind > 1)
      {
        if (kind != 2)
        {
          if (kind != 3)
          {
            goto LABEL_17;
          }

          v22 = MEMORY[0x1E696AEC0];
          uuid2 = [(PLManagedAsset *)self uuid];
          v9 = [v22 stringWithFormat:@"Unsupported asset kind for asset: %@", uuid2];

          v24 = MEMORY[0x1E696ABC0];
          v25 = *MEMORY[0x1E69BFF48];
          v35 = *MEMORY[0x1E696A578];
          v36[0] = v9;
          v26 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v36 forKeys:&v35 count:1];
          v13 = [v24 errorWithDomain:v25 code:46309 userInfo:v26];

          v14 = PLBackendGetLog();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
          {
            *buf = 138543362;
            v34 = v9;
            goto LABEL_15;
          }

          goto LABEL_16;
        }

        [(PLManagedAsset *)self updateAudioExtendedAttributesFromMetadata:metadataCopy];
      }

      else if (kind)
      {
        [(PLManagedAsset *)self updateVideoExtendedAttributesFromMetadata:metadataCopy];
      }

      else
      {
        [(PLManagedAsset *)self updateImageExtendedAttributesFromMetadata:metadataCopy];
      }

      v13 = 0;
      if (!error)
      {
        goto LABEL_19;
      }

      goto LABEL_18;
    }

    v17 = MEMORY[0x1E696AEC0];
    uuid3 = [(PLManagedAsset *)self uuid];
    v9 = [v17 stringWithFormat:@"Missing metadata for asset %@. File not on disk", uuid3];

    v19 = MEMORY[0x1E696ABC0];
    v20 = *MEMORY[0x1E69BFF48];
    v31 = *MEMORY[0x1E696A578];
    v32 = v9;
    v21 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v32 forKeys:&v31 count:1];
    v13 = [v19 errorWithDomain:v20 code:41004 userInfo:v21];

    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543362;
      v34 = v9;
      goto LABEL_15;
    }
  }

LABEL_16:

  v16 = 0;
LABEL_17:
  if (error)
  {
LABEL_18:
    v27 = v13;
    *error = v13;
  }

LABEL_19:

LABEL_20:
  return v16;
}

- (BOOL)updateExtendedAttributesWithError:(id *)error
{
  metadataFromMediaPropertiesOrOriginalResource = [(PLManagedAsset *)self metadataFromMediaPropertiesOrOriginalResource];
  LOBYTE(error) = [(PLManagedAsset *)self updateExtendedAttributesWithMetadata:metadataFromMediaPropertiesOrOriginalResource error:error];

  return error;
}

- (id)extendedAttributesCreateIfNeeded:(BOOL)needed
{
  neededCopy = needed;
  extendedAttributes = [(PLManagedAsset *)self extendedAttributes];
  if (!extendedAttributes && neededCopy)
  {
    if (PLPlatformExtendedAttributesSupported())
    {
      managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
      v7 = +[PLExtendedAttributes entityName];
      extendedAttributes = PLSafeInsertNewObjectForEntityForNameInManagedObjectContext(v7, managedObjectContext, 0);

      if (extendedAttributes)
      {
        [(PLManagedAsset *)self setExtendedAttributes:extendedAttributes];
      }
    }

    else
    {
      extendedAttributes = 0;
    }
  }

  return extendedAttributes;
}

- (void)setCurrentSleetCastFromMetadata:(id)metadata
{
  smartStyleCast = [metadata smartStyleCast];

  [(PLManagedAsset *)self setCurrentSleetCast:smartStyleCast];
}

- (void)updateSmartStyleVideoCastFromMetadata:(id)metadata
{
  smartStyleVideoCastValue = [metadata smartStyleVideoCastValue];

  [(PLManagedAsset *)self setCurrentSleetCast:smartStyleVideoCastValue];
}

- (BOOL)updatePlaybackVariationAndLoopingStyleFromAVAsset:(id)asset
{
  assetCopy = asset;
  v5 = [(PLManagedAsset *)self playbackVariationFromAVAsset:assetCopy isLivePhotoVideoComplement:[(PLManagedAsset *)self isPhotoIris]];

  return [(PLManagedAsset *)self updatePlaybackVariationAndLoopingStyleFromVariation:v5];
}

- (BOOL)updatePlaybackVariationAndLoopingStyleFromVariation:(unsigned __int16)variation
{
  variationCopy = variation;
  playbackVariation = [(PLManagedAsset *)self playbackVariation];
  playbackStyle = [(PLManagedAsset *)self playbackStyle];
  [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:variationCopy];
  return playbackVariation != [(PLManagedAsset *)self playbackVariation]|| playbackStyle != [(PLManagedAsset *)self playbackStyle];
}

- (unsigned)playbackVariationFromAVAsset:(id)asset isLivePhotoVideoComplement:(BOOL)complement
{
  v17 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  v5 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVAsset:assetCopy timeZoneLookup:0];
  playbackVariation = [v5 playbackVariation];
  unsignedIntegerValue = [playbackVariation unsignedIntegerValue];

  if (unsignedIntegerValue >= 4)
  {
    v8 = PLBackendGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      playbackVariation2 = [v5 playbackVariation];
      v13 = 138412546;
      v14 = playbackVariation2;
      v15 = 2112;
      v16 = assetCopy;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Unrecognized variation identifier %@ in %@", &v13, 0x16u);
    }
  }

  playbackVariation3 = [v5 playbackVariation];
  unsignedIntegerValue2 = [playbackVariation3 unsignedIntegerValue];

  return unsignedIntegerValue2;
}

- (BOOL)updatePlaybackVariationAndStyleFromOriginalMetadata:(id)metadata
{
  v13 = *MEMORY[0x1E69E9840];
  metadataCopy = metadata;
  v6 = metadataCopy;
  if (!metadataCopy)
  {
    v8 = PLBackendGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = NSStringFromSelector(a2);
      v11 = 138412290;
      v12 = v9;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "%@: nil metadata", &v11, 0xCu);
    }

    goto LABEL_12;
  }

  if (![metadataCopy isAnimatedImage])
  {
    if (-[PLManagedAsset isPhotoIris](self, "isPhotoIris") && [v6 isLongExposure] && -[PLManagedAsset playbackVariation](self, "playbackVariation") != 3)
    {
      [(PLManagedAsset *)self setPlaybackVariation:3];
      goto LABEL_5;
    }

LABEL_12:
    v7 = 0;
    goto LABEL_13;
  }

  if ([(PLManagedAsset *)self playbackStyle]== 2)
  {
    goto LABEL_12;
  }

  [(PLManagedAsset *)self setPlaybackStyle:2];
LABEL_5:
  v7 = 1;
LABEL_13:

  return v7;
}

- (void)updatePlaybackStyleWithLivePhotoPlayability:(BOOL)playability
{
  if (playability)
  {
    if ([objc_opt_class() _isLoopingVideoPlaybackVariation:{-[PLManagedAsset playbackVariation](self, "playbackVariation")}])
    {
      v4 = 5;
    }

    else
    {
      v4 = 3;
    }
  }

  else
  {
    v4 = 1;
  }

  if (v4 != [(PLManagedAsset *)self playbackStyle])
  {

    [(PLManagedAsset *)self setPlaybackStyle:v4];
  }
}

- (void)_setColorSpaceNameFromMetadata:(id)metadata
{
  defaultProfileName = [metadata defaultProfileName];
  [(PLManagedAsset *)self setOriginalColorSpace:defaultProfileName];
}

- (void)_setSOCGroupIdentifierFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  spatialOverCaptureIdentifier = [metadataCopy spatialOverCaptureIdentifier];

  [additionalAttributes setSpatialOverCaptureGroupIdentifier:spatialOverCaptureIdentifier];
}

- (void)_setPhotoIrisPropertiesFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  livePhotoPairingIdentifier = [metadataCopy livePhotoPairingIdentifier];
  v5 = [livePhotoPairingIdentifier length];

  if (v5)
  {
    livePhotoPairingIdentifier2 = [metadataCopy livePhotoPairingIdentifier];
    [(PLManagedAsset *)self setMediaGroupUUID:livePhotoPairingIdentifier2];
  }
}

- (void)setKeywordsFromImageProperties:(id)properties
{
  v4 = [properties objectForKey:*MEMORY[0x1E696DD90]];
  if (v4)
  {
    v9 = v4;
    v5 = [v4 objectForKey:*MEMORY[0x1E696DDD0]];
    v6 = [MEMORY[0x1E695DFA8] setWithArray:v5];
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    keywordManager = [photoLibrary keywordManager];
    [keywordManager setKeywords:v6 forAsset:self];

    v4 = v9;
  }
}

- (void)_setSavedAssetTypeFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  if (!-[PLManagedAsset savedAssetType](self, "savedAssetType") && [metadataCopy isPhotoBooth])
  {
    -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForPhotoBoothAsset]);
  }
}

- (void)_setOriginalSizeAndOrientationFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  if ([metadataCopy isSyndicationOriginated])
  {
    -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [metadataCopy orientation]);
    [metadataCopy exifPixelSize];
    [(PLManagedAsset *)self setOriginalWidth:v4];
    [metadataCopy exifPixelSize];
    [(PLManagedAsset *)self setOriginalHeight:v5];
  }

  else
  {
    cgImageProperties = [metadataCopy cgImageProperties];
    [(PLManagedAsset *)self setOriginalSizeAndOrientationFromImageProperties:cgImageProperties];
  }
}

- (void)setOriginalSizeAndOrientationFromImageProperties:(id)properties
{
  PFGetDimensionsFromImageProperties();
  v4 = 0;
  v5 = 0;
  v6 = 0;
  if (![(PLManagedAsset *)self originalOrientation])
  {
    -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [v4 shortValue]);
  }

  -[PLManagedAsset setOriginalWidth:](self, "setOriginalWidth:", [v5 longLongValue]);
  -[PLManagedAsset setOriginalHeight:](self, "setOriginalHeight:", [v6 longLongValue]);
}

- (void)_setHDRGainFromMetadata:(id)metadata
{
  hdrGain = [metadata hdrGain];
  hdrGain2 = [(PLManagedAsset *)self hdrGain];
  IsEqual = PLNumberIsEqual(hdrGain2, hdrGain);

  if (!IsEqual)
  {
    [(PLManagedAsset *)self setHdrGain:hdrGain];
  }
}

- (void)setSpatialAudioControlBadgeAttributeFromMetadata:(id)metadata
{
  if ([metadata hasSpatialAudio])
  {

    [(PLManagedAsset *)self setSpatialAudioControlBadgeAttribute:1];
  }
}

- (void)setPlaybackControlBadgeAttributeFromMetadata:(id)metadata
{
  nominalFrameRate = [metadata nominalFrameRate];
  [nominalFrameRate doubleValue];
  v6 = v5;

  if (v6 >= 45.0)
  {

    [(PLManagedAsset *)self setPlaybackControlBadgeAttribute:1];
  }
}

- (void)setEditableDepthBadgeAttributeFromMetadata:(id)metadata
{
  if ([metadata hasDepthDataAndIsNotRenderedSDOF])
  {

    [(PLManagedAsset *)self setEditableDepthBadgeAttribute:1];
  }
}

- (void)setDepthTypeFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  if ([metadataCopy isPortrait])
  {
    v4 = 1;
  }

  else if ([metadataCopy isMovie] && (objc_msgSend(metadataCopy, "isCinematicVideo") & 1) != 0)
  {
    v4 = 2;
  }

  else
  {
    customRendered = [metadataCopy customRendered];
    if (customRendered > 9u)
    {
      v4 = 0;
    }

    else
    {
      v4 = word_19C60B864[customRendered & 0xF];
    }
  }

  if (v4 != [(PLManagedAsset *)self depthType])
  {
    [(PLManagedAsset *)self setDepthType:v4];
  }
}

- (void)_setSizeAndOrientationFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  if ([metadataCopy isSyndicationOriginated])
  {
    -[PLManagedAsset setOrientation:](self, "setOrientation:", [metadataCopy orientation]);
    [metadataCopy orientedPixelSize];
    [(PLManagedAsset *)self setWidth:v4];
    [metadataCopy orientedPixelSize];
    [(PLManagedAsset *)self setHeight:v5];
  }

  else
  {
    cgImageProperties = [metadataCopy cgImageProperties];
    [(PLManagedAsset *)self setSizeAndOrientationFromImageProperties:cgImageProperties];
  }
}

- (void)setSizeAndOrientationFromImageProperties:(id)properties
{
  PFGetDimensionsFromImageProperties();
  v4 = 0;
  v5 = 0;
  v6 = 0;
  -[PLManagedAsset setOrientation:](self, "setOrientation:", [v4 shortValue]);
  [(PLManagedAsset *)self orientation];
  v7 = PLExifOrientationSwapsWidthAndHeight();
  v8 = v7 == 0;
  if (v7)
  {
    v9 = v6;
  }

  else
  {
    v9 = v5;
  }

  if (v8)
  {
    v10 = v6;
  }

  else
  {
    v10 = v5;
  }

  -[PLManagedAsset setWidth:](self, "setWidth:", [v9 longLongValue]);
  -[PLManagedAsset setHeight:](self, "setHeight:", [v10 longLongValue]);
}

- (BOOL)setTimeExifTimestampStringFromMetadata:(id)metadata
{
  creationDateString = [metadata creationDateString];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  exifTimestampString = [additionalAttributes exifTimestampString];

  if (creationDateString | exifTimestampString && ([exifTimestampString isEqualToString:creationDateString] & 1) == 0)
  {
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    [additionalAttributes2 setExifTimestampString:creationDateString];

    v7 = 1;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)setCameraCaptureDeviceFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  isFrontFacingCamera = [metadataCopy isFrontFacingCamera];
  isFrontAndRearComposition = [metadataCopy isFrontAndRearComposition];

  if (isFrontAndRearComposition)
  {
    v7 = 2;
  }

  else
  {
    v7 = isFrontFacingCamera;
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  cameraCaptureDevice = [additionalAttributes cameraCaptureDevice];

  if (cameraCaptureDevice != v7)
  {
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    [additionalAttributes2 setCameraCaptureDevice:v7];
  }

  return cameraCaptureDevice != v7;
}

- (void)setSpatialTypeFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  if ([metadataCopy isSpatialMedia])
  {
    if ([metadataCopy isAlchemist])
    {
      v4 = 2;
    }

    else
    {
      v4 = 1;
    }
  }

  else
  {
    v4 = 0;
  }

  [(PLManagedAsset *)self setSpatialType:v4];
}

- (BOOL)_setHDRTypeFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  if ([metadataCopy hasHDRGainMap] & 1) != 0 || (objc_msgSend(metadataCopy, "hasISOGainMap"))
  {
    v5 = 10;
  }

  else if (![metadataCopy customRendered] || (v5 = objc_msgSend(metadataCopy, "customRendered"), (v5 - 2) >= 3u))
  {
    if ([metadataCopy isMovie] && (objc_msgSend(metadataCopy, "isHDR") & 1) != 0)
    {
      v5 = 5;
    }

    else if (([metadataCopy isMovie] & 1) == 0 && ((objc_msgSend(metadataCopy, "isHDR_TS22028") & 1) != 0 || objc_msgSend(metadataCopy, "isHDR_ExtendedRange")))
    {
      v5 = 11;
    }

    else
    {
      v5 = 0;
    }
  }

  hdrType = [(PLManagedAsset *)self hdrType];
  if (v5 != hdrType)
  {
    [(PLManagedAsset *)self setHdrType:v5];
  }

  return v5 != hdrType;
}

- (id)formattedCameraModel
{
  extendedAttributes = [(PLManagedAsset *)self extendedAttributes];
  formattedCameraModel = [extendedAttributes formattedCameraModel];

  return formattedCameraModel;
}

- (id)cameraModel
{
  extendedAttributes = [(PLManagedAsset *)self extendedAttributes];
  cameraModel = [extendedAttributes cameraModel];

  return cameraModel;
}

- (id)lensModel
{
  v3 = objc_autoreleasePoolPush();
  if ([(PLManagedAsset *)self isPhoto])
  {
    imageProperties = [(PLManagedAsset *)self imageProperties];
    v5 = imageProperties;
    if (imageProperties)
    {
      v6 = [imageProperties objectForKey:*MEMORY[0x1E696D9B0]];
      v7 = v6;
      if (v6)
      {
        v8 = [v6 objectForKey:*MEMORY[0x1E696DA58]];
      }

      else
      {
        v8 = 0;
      }
    }

    else
    {
      v8 = 0;
    }
  }

  else
  {
    v8 = 0;
  }

  objc_autoreleasePoolPop(v3);

  return v8;
}

- (id)cameraMake
{
  v3 = objc_autoreleasePoolPush();
  if (![(PLManagedAsset *)self isPhoto])
  {
    if (![(PLManagedAsset *)self isVideo])
    {
      stringValue = 0;
      goto LABEL_13;
    }

    v5 = [(PLManagedAsset *)self avAssetProxyForOriginalAllowReadFromFile:1];
    metadata = [v5 metadata];
    if (metadata)
    {
      v9 = [MEMORY[0x1E6987FE0] metadataItemsFromArray:metadata withKey:*MEMORY[0x1E69878E0] keySpace:*MEMORY[0x1E6987850]];
      firstObject = [v9 firstObject];
      stringValue = [firstObject stringValue];

      goto LABEL_10;
    }

LABEL_9:
    stringValue = 0;
    goto LABEL_10;
  }

  imageProperties = [(PLManagedAsset *)self imageProperties];
  v5 = imageProperties;
  if (!imageProperties)
  {
    stringValue = 0;
    goto LABEL_12;
  }

  v6 = [imageProperties objectForKey:*MEMORY[0x1E696DF28]];
  metadata = v6;
  if (!v6)
  {
    goto LABEL_9;
  }

  stringValue = [v6 objectForKey:*MEMORY[0x1E696DF48]];
LABEL_10:

LABEL_12:
LABEL_13:
  objc_autoreleasePoolPop(v3);

  return stringValue;
}

- (id)_avAssetProxyForFullSize:(BOOL)size allowReadFromFile:(BOOL)file
{
  fileCopy = file;
  if (![(PLManagedAsset *)self isVideo])
  {
    v7 = 0;
    goto LABEL_22;
  }

  if (size)
  {
    [(PLManagedAsset *)self additionalAttributes];
  }

  else
  {
    [(PLManagedAsset *)self master];
  }
  v8 = ;
  mediaMetadata = [v8 mediaMetadata];

  data = [mediaMetadata data];
  if (!data)
  {
    v7 = 0;
    goto LABEL_12;
  }

  v11 = [MEMORY[0x1E696AE40] propertyListWithData:data options:0 format:0 error:0];
  if (v11)
  {
    v7 = [MEMORY[0x1E6987E28] assetProxyWithPropertyList:v11];
  }

  else
  {
    v7 = 0;
  }

  if (!v7)
  {
LABEL_12:
    if (fileCopy)
    {
      if (size)
      {
        [(PLManagedAsset *)self fileURLForFullsizeRenderVideo];
      }

      else
      {
        [(PLManagedAsset *)self mainFileURL];
      }
      v12 = ;
      if (v12 && ([MEMORY[0x1E696AC08] defaultManager], v13 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v12, "path"), v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v13, "fileExistsAtPath:isDirectory:", v14, 0), v14, v13, v15))
      {
        v7 = [MEMORY[0x1E6987E28] assetWithURL:v12];
      }

      else
      {
        v7 = 0;
      }
    }
  }

LABEL_22:

  return v7;
}

- (id)imageProperties
{
  objc_opt_class();
  master = [(PLManagedAsset *)self master];
  mediaMetadata = [master mediaMetadata];
  v5 = [mediaMetadata valueForKey:@"data"];
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (!v7 || ((objc_opt_class(), [MEMORY[0x1E696AE40] propertyListWithData:v7 options:0 format:0 error:0], v8 = objc_claimAutoreleasedReturnValue(), (objc_opt_isKindOfClass() & 1) == 0) ? (v9 = 0) : (v9 = v8), v10 = v9, v8, !v10))
  {
    mainFileURL = [(PLManagedAsset *)self mainFileURL];
    if (mainFileURL && ([MEMORY[0x1E696AC08] defaultManager], v12 = objc_claimAutoreleasedReturnValue(), objc_msgSend(mainFileURL, "path"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v12, "fileExistsAtPath:isDirectory:", v13, 0), v13, v12, v14) && (v15 = CGImageSourceCreateWithURL(mainFileURL, 0)) != 0)
    {
      v16 = v15;
      objc_opt_class();
      v17 = [objc_opt_class() newImagePropertiesFromImageSource:v16];
      if (objc_opt_isKindOfClass())
      {
        v18 = v17;
      }

      else
      {
        v18 = 0;
      }

      v8 = v18;

      CFRelease(v16);
    }

    else
    {
      v8 = 0;
    }
  }

  return v8;
}

- (void)setMetadataFromCustomRenderedValue:(int64_t)value
{
  valueCopy = value;
  v5 = [PLManagedAsset imageHDRTypeFromCustomRenderedValue:valueCopy];
  if (v5)
  {
    [(PLManagedAsset *)self setHdrType:v5];
  }

  v6 = [PLManagedAsset imageDepthTypeFromCustomRenderedValue:valueCopy];
  if (v6)
  {

    [(PLManagedAsset *)self setDepthType:v6];
  }
}

- (void)updateWithCustomAssetProperties:(id)properties
{
  v33 = *MEMORY[0x1E69E9840];
  propertiesCopy = properties;
  v25 = [propertiesCopy objectForKeyedSubscript:@"dateCreated"];
  if (v25)
  {
    [(PLManagedAsset *)self setDateCreated:?];
    [(PLManagedAsset *)self didSetCustomDateCreated];
  }

  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  v5 = propertiesCopy;
  v6 = [v5 countByEnumeratingWithState:&v27 objects:v32 count:16];
  if (v6)
  {
    v8 = *v28;
    *&v7 = 138543618;
    v24 = v7;
    do
    {
      v9 = 0;
      do
      {
        if (*v28 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v27 + 1) + 8 * v9);
        if (([v10 isEqualToString:{@"dateCreated", v24}] & 1) == 0 && (objc_msgSend(v10, "isEqualToString:", @"trashedReason") & 1) == 0)
        {
          if ([v10 isEqualToString:@"trashedState"])
          {
            v11 = [v5 objectForKeyedSubscript:v10];
            bOOLValue = [v11 BOOLValue];

            if (([(PLManagedAsset *)self canMoveToTrash]& bOOLValue) == 1)
            {
              v13 = [v5 objectForKeyedSubscript:@"trashedReason"];
              v14 = v13;
              if (v13)
              {
                unsignedShortValue = [v13 unsignedShortValue];
              }

              else
              {
                unsignedShortValue = 0;
              }

              [(PLManagedAsset *)self trashWithReason:unsignedShortValue];
            }
          }

          else if ([v10 isEqualToString:@"photoIrisVideoDuration"])
          {
            memset(&v31, 0, sizeof(v31));
            v16 = [v5 objectForKeyedSubscript:v10];
            CMTimeMakeFromDictionary(&v31, v16);

            v26 = v31;
            [(PLManagedAsset *)self setPhotoIrisVideoDuration:&v26];
          }

          else if ([v10 isEqualToString:@"photoIrisStillDisplayTime"])
          {
            memset(&v31, 0, sizeof(v31));
            v17 = [v5 objectForKeyedSubscript:v10];
            CMTimeMakeFromDictionary(&v31, v17);

            v26 = v31;
            [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&v26];
          }

          else if ([v10 isEqualToString:@"location"])
          {
            v18 = [v5 objectForKeyedSubscript:v10];
            dateCreated = [(PLManagedAsset *)self dateCreated];
            v20 = [PLManagedAsset newLocationFromLocationData:v18 timestampIfMissing:dateCreated];

            [v20 coordinate];
            if ([PLLocationUtils canUseCoordinate:?])
            {
              [(PLManagedAsset *)self setLocation:v20];
              [(PLManagedAsset *)self didSetCustomLocation];
            }
          }

          else if ([v10 isEqualToString:@"hdrType"])
          {
            v21 = [v5 objectForKeyedSubscript:v10];
            -[PLManagedAsset setHdrType:](self, "setHdrType:", [v21 unsignedIntegerValue]);
          }

          else
          {
            v22 = [v5 objectForKeyedSubscript:v10];
            [(PLManagedAsset *)self setValue:v22 forKeyPath:v10];
          }
        }

        ++v9;
      }

      while (v6 != v9);
      v23 = [v5 countByEnumeratingWithState:&v27 objects:v32 count:16];
      v6 = v23;
    }

    while (v23);
  }
}

- (void)setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:(id)identifier originalFilename:(id)filename
{
  identifierCopy = identifier;
  filenameCopy = filename;
  directory = [(PLManagedAsset *)self directory];
  if ([directory length])
  {
    filename = [(PLManagedAsset *)self filename];
    v9 = [filename length];

    if (v9)
    {
      goto LABEL_10;
    }
  }

  else
  {
  }

  v10 = objc_alloc(MEMORY[0x1E69BF298]);
  uuid = [(PLManagedAsset *)self uuid];
  v12 = [v10 initWithAssetUuid:uuid bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:identifierCopy resourceType:0 recipeID:31 originalFilename:0 customSuffix:{filenameCopy, 0}];

  pathManager = [(PLManagedObject *)self pathManager];
  v14 = [pathManager readOnlyUrlWithIdentifier:v12];

  directory2 = [(PLManagedAsset *)self directory];
  v16 = [directory2 length];

  if (!v16)
  {
    pathManager2 = [(PLManagedObject *)self pathManager];
    path = [v14 path];
    stringByDeletingLastPathComponent = [path stringByDeletingLastPathComponent];
    v20 = [pathManager2 assetAbbreviatedMetadataDirectoryForDirectory:stringByDeletingLastPathComponent type:4 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];

    [(PLManagedAsset *)self setDirectory:v20];
  }

  filename2 = [(PLManagedAsset *)self filename];
  v22 = [filename2 length];

  if (!v22)
  {
    lastPathComponent = [v14 lastPathComponent];
    [(PLManagedAsset *)self setFilename:lastPathComponent];
  }

LABEL_10:
}

- (BOOL)setAttributesFromMainFileURL:(id)l mainFileMetadata:(id)metadata savedAssetType:(signed __int16)type bundleScope:(unsigned __int16)scope isPlaceholder:(BOOL)placeholder placeholderFileURL:(id)rL imageSource:(CGImageSource *)source imageData:(id *)self0
{
  scopeCopy = scope;
  typeCopy = type;
  v89 = *MEMORY[0x1E69E9840];
  lCopy = l;
  metadataCopy = metadata;
  rLCopy = rL;
  if (!(lCopy | metadataCopy))
  {
    metadataCopy = 0;
    lCopy = 0;
    goto LABEL_43;
  }

  if (!placeholder && ([metadataCopy isSyndicationOriginated] & 1) == 0)
  {
    v84 = 0;
    v19 = [(PLManagedAsset *)self _effectiveMetadataForMainFileURL:lCopy mainFileMetadata:metadataCopy fullSizeRenderURL:0 shouldCache:1 error:&v84];
    v20 = v84;

    if (v19)
    {
      fileURL = [v19 fileURL];

      metadataCopy = v19;
      lCopy = fileURL;
      goto LABEL_6;
    }

    v63 = PLBackendGetLog();
    if (os_log_type_enabled(v63, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v86 = v20;
      _os_log_impl(&dword_19BF1F000, v63, OS_LOG_TYPE_ERROR, "Unable to load metadata with error: %@", buf, 0xCu);
    }

    metadataCopy = 0;
LABEL_43:
    v64 = 0;
    v53 = rLCopy;
    goto LABEL_58;
  }

LABEL_6:
  context = objc_autoreleasePoolPush();
  v22 = 32;
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    [MEMORY[0x1E69BF328] maskForCloudSharedAsset];
    if (PLValidatedSavedAssetTypeApplies())
    {
      v22 = 23;
    }

    else
    {
      v22 = 32;
    }
  }

  aSelector = a2;
  if (lCopy)
  {
    pathManager = [(PLManagedObject *)self pathManager];
    path = [lCopy path];
    stringByDeletingLastPathComponent = [path stringByDeletingLastPathComponent];
    v26 = [pathManager assetAbbreviatedMetadataDirectoryForDirectory:stringByDeletingLastPathComponent type:v22 bundleScope:scopeCopy];

    v27 = v26;
  }

  else
  {
    v27 = 0;
  }

  sourceCopy = source;
  lastPathComponent = [lCopy lastPathComponent];
  v81 = v27;
  [(PLManagedAsset *)self setDirectory:v27];
  [(PLManagedAsset *)self setFilename:lastPathComponent];
  [(PLManagedAsset *)self setOriginalFilename:lastPathComponent];
  if (placeholder)
  {
    pathExtension = [lCopy pathExtension];
    [(PLManagedAsset *)self setUniformTypeIdentifierFromPathExtension:pathExtension];

    dateCreated = [(PLManagedAsset *)self dateCreated];

    if (dateCreated)
    {
      goto LABEL_29;
    }

    sourceCopy3 = source;
    modificationDate = [(PLManagedAsset *)self modificationDate];
    [(PLManagedAsset *)self setDateCreated:modificationDate];
  }

  else
  {
    sourceCopy3 = source;
    fileSystemProperties = [metadataCopy fileSystemProperties];
    v34 = [fileSystemProperties objectForKeyedSubscript:*MEMORY[0x1E696A350]];
    if (v34)
    {
      [(PLManagedAsset *)self setModificationDate:v34];
    }

    else
    {
      date = [MEMORY[0x1E695DF00] date];
      [(PLManagedAsset *)self setModificationDate:date];
    }

    contentType = [metadataCopy contentType];
    identifier = [contentType identifier];
    [(PLManagedAsset *)self setUniformTypeIdentifier:identifier];

    title = [metadataCopy title];
    [(PLManagedAsset *)self setTitle:title];

    captionAbstract = [metadataCopy captionAbstract];
    [(PLManagedAsset *)self setLongDescription:captionAbstract];

    artworkContentDescription = [metadataCopy artworkContentDescription];
    [(PLManagedAsset *)self setAccessibilityDescription:artworkContentDescription];

    modificationDate = [(PLManagedAsset *)self additionalAttributes];
    dateCreated2 = [(PLManagedAsset *)self dateCreated];

    if (!dateCreated2)
    {
      utcCreationDate = [metadataCopy utcCreationDate];
      [(PLManagedAsset *)self setDateCreated:utcCreationDate];

      [modificationDate setDateCreatedSource:{objc_msgSend(metadataCopy, "creationDateSource")}];
    }

    [(PLManagedAsset *)self setTimeExifTimestampStringFromMetadata:metadataCopy];
    timeZoneName = [modificationDate timeZoneName];

    if (!timeZoneName)
    {
      timeZoneName2 = [metadataCopy timeZoneName];
      [modificationDate setTimeZoneName:timeZoneName2];
    }

    timeZoneOffset = [modificationDate timeZoneOffset];

    if (!timeZoneOffset)
    {
      timeZoneOffset2 = [metadataCopy timeZoneOffset];
      [modificationDate setTimeZoneOffset:timeZoneOffset2];
    }

    fileSize = [metadataCopy fileSize];
    if (fileSize)
    {
      [(PLManagedAsset *)self setOriginalFilesize:fileSize];
    }

    spatialOverCaptureIdentifier = [metadataCopy spatialOverCaptureIdentifier];
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    [additionalAttributes setSpatialOverCaptureGroupIdentifier:spatialOverCaptureIdentifier];
  }

  sourceCopy = sourceCopy3;
LABEL_29:
  [(PLManagedAsset *)self updateAssetKindFromUniformTypeIdentifier];
  dateCreated3 = [(PLManagedAsset *)self dateCreated];
  [dateCreated3 timeIntervalSinceReferenceDate];
  [(PLManagedAsset *)self setSortToken:?];

  [(PLManagedAsset *)self setSavedAssetType:typeCopy];
  [(PLManagedAsset *)self setBundleScope:scopeCopy];
  kind = [(PLManagedAsset *)self kind];
  if (kind)
  {
    v52 = v81;
    v53 = rLCopy;
    if (kind == 1 && !placeholder)
    {
      [(PLManagedAsset *)self setVideoInfoFromFileAtURL:lCopy mainFileMetadata:metadataCopy fullSizeRenderURL:0 overwriteOriginalProperties:1];
    }

    goto LABEL_52;
  }

  v52 = v81;
  v53 = rLCopy;
  if (!placeholder)
  {
    [(PLManagedAsset *)self setImageInfoFromImageMetadata:metadataCopy overwriteOriginalProperties:1];
    goto LABEL_52;
  }

  if (!rLCopy)
  {
    goto LABEL_52;
  }

  v83 = 0;
  v54 = [MEMORY[0x1E69C08F0] typeForURL:rLCopy error:&v83];
  v55 = v83;
  if (!v54)
  {
    v79 = sourceCopy;
    v61 = PLBackendGetLog();
    if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
    {
      v65 = NSStringFromSelector(aSelector);
      path2 = [rLCopy path];
      *buf = 138412546;
      v86 = v65;
      v87 = 2112;
      v88 = path2;
      _os_log_impl(&dword_19BF1F000, v61, OS_LOG_TYPE_ERROR, "%@ Couldn't get uti for '%@'.", buf, 0x16u);

      v52 = v81;
    }

    goto LABEL_50;
  }

  if ([v54 conformsToType:*MEMORY[0x1E6982E30]])
  {
    v75 = v55;
    v76 = v54;
    v79 = sourceCopy;
    v73 = objc_alloc(MEMORY[0x1E69C0718]);
    v56 = MEMORY[0x1E695DFF8];
    path3 = [rLCopy path];
    v57 = [v56 fileURLWithPath:path3];
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    libraryBundle = [photoLibrary libraryBundle];
    timeZoneLookup = [libraryBundle timeZoneLookup];
    v61 = [v73 initWithImageURL:v57 contentType:0 options:12 timeZoneLookup:timeZoneLookup cacheImageSource:1 cacheImageData:0];

    if (v61)
    {
      utcCreationDate2 = [v61 utcCreationDate];
      [(PLManagedAsset *)self setDateCreated:utcCreationDate2];

      [(PLManagedAsset *)self setImageInfoFromImageMetadata:v61 overwriteOriginalProperties:1];
      v53 = rLCopy;
    }

    else
    {
      v67 = PLBackendGetLog();
      v53 = rLCopy;
      if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
      {
        v68 = NSStringFromSelector(aSelector);
        path4 = [rLCopy path];
        *buf = 138412546;
        v86 = v68;
        v87 = 2112;
        v88 = path4;
        _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "%@ Unable to read metadata from '%@'", buf, 0x16u);
      }

      v61 = 0;
    }

    v52 = v81;
    v55 = v75;
    v54 = v76;
LABEL_50:

    sourceCopy = v79;
  }

LABEL_52:
  objc_autoreleasePoolPop(context);
  imageSource = [metadataCopy imageSource];
  if (sourceCopy && imageSource)
  {
    v71 = CFRetain([metadataCopy imageSource]);
    *sourceCopy = CFAutorelease(v71);
  }

  if (data)
  {
    *data = [metadataCopy imageData];
  }

  v64 = 1;
LABEL_58:

  return v64;
}

- (BOOL)updateAttributesFromMainFileURL:(id)l mainFileMetadata:(id)metadata fullSizeRenderURL:(id)rL error:(id *)error
{
  v29 = *MEMORY[0x1E69E9840];
  lCopy = l;
  metadataCopy = metadata;
  rLCopy = rL;
  v26 = 0;
  v13 = [(PLManagedAsset *)self _effectiveMetadataForMainFileURL:lCopy mainFileMetadata:metadataCopy fullSizeRenderURL:rLCopy shouldCache:0 error:&v26];
  v14 = v26;
  if (v13)
  {
    v15 = objc_autoreleasePoolPush();
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    isCloudPhotoLibraryEnabled = [photoLibrary isCloudPhotoLibraryEnabled];

    if (isCloudPhotoLibraryEnabled && ![(PLManagedAsset *)self hasAdjustments])
    {
      master = [(PLManagedAsset *)self master];
      contentType = master;
      if (!master)
      {
        [(PLManagedAsset *)self setUniformTypeIdentifierFromOriginalFile];
        goto LABEL_6;
      }

      uniformTypeIdentifier = [master uniformTypeIdentifier];
    }

    else
    {
      contentType = [v13 contentType];
      uniformTypeIdentifier = [contentType identifier];
    }

    v20 = uniformTypeIdentifier;
    [(PLManagedAsset *)self setUniformTypeIdentifier:uniformTypeIdentifier];

LABEL_6:
    [(PLManagedAsset *)self updateAssetKindFromUniformTypeIdentifier];
    kind = [(PLManagedAsset *)self kind];
    if (kind)
    {
      if (kind == 1)
      {
        [(PLManagedAsset *)self setVideoInfoFromFileAtURL:lCopy mainFileMetadata:metadataCopy fullSizeRenderURL:rLCopy overwriteOriginalProperties:0];
      }
    }

    else
    {
      [(PLManagedAsset *)self setImageInfoFromImageMetadata:v13 overwriteOriginalProperties:0];
    }

    objc_autoreleasePoolPop(v15);
    goto LABEL_15;
  }

  v22 = PLBackendGetLog();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v28 = v14;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Unable to load metadata with error: %@", buf, 0xCu);
  }

  if (error)
  {
    v23 = v14;
    *error = v14;
  }

LABEL_15:

  return v13 != 0;
}

- (id)addLegacyFaceWithRelativeRect:(CGRect)rect identifier:(signed __int16)identifier albumUUID:(id)d
{
  identifierCopy = identifier;
  height = rect.size.height;
  width = rect.size.width;
  y = rect.origin.y;
  x = rect.origin.x;
  dCopy = d;
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  v13 = [(PLManagedObject *)PLManagedLegacyFace insertInManagedObjectContext:managedObjectContext];

  [v13 setRelativeRect:{x, y, width, height}];
  [v13 setIdentifier:identifierCopy];
  [v13 setAlbumUUID:dCopy];

  [v13 setAsset:self];

  return v13;
}

- (id)legacyFaceWithIdentifier:(signed __int16)identifier
{
  identifierCopy = identifier;
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  legacyFaces = [(PLManagedAsset *)self legacyFaces];
  v5 = [legacyFaces countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(legacyFaces);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 identifier] == identifierCopy)
        {
          v10 = v9;
          goto LABEL_11;
        }
      }

      v6 = [legacyFaces countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_11:

  return v10;
}

- (void)setLocationFromPersistedAttributes:(id)attributes
{
  v4 = [attributes dataForKey:*MEMORY[0x1E69BFD48]];
  if (v4)
  {
    v7 = v4;
    dateCreated = [(PLManagedAsset *)self dateCreated];
    v6 = [PLManagedAsset newLocationFromLocationData:v7 timestampIfMissing:dateCreated];

    if (v6)
    {
      [v6 coordinate];
      if ([PLLocationUtils canUseCoordinate:?])
      {
        [(PLManagedAsset *)self setLocation:v6];
      }
    }

    v4 = v7;
  }
}

- (void)synchronizeWithPersistedFileSystemAttributes
{
  v167 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self isValidTypeForPersistence])
  {
    v3 = objc_autoreleasePoolPush();
    persistedFileSystemAttributesFileURL = [(PLManagedAsset *)self persistedFileSystemAttributesFileURL];
    if (!persistedFileSystemAttributesFileURL)
    {
LABEL_206:

      objc_autoreleasePoolPop(v3);
      return;
    }

    v5 = [MEMORY[0x1E69BF230] persistedAttributesForFileAtURL:persistedFileSystemAttributesFileURL];
    v6 = *MEMORY[0x1E69BFE68];
    v7 = [v5 UUIDStringForKey:*MEMORY[0x1E69BFE68]];
    v148 = v7;
    if (v7)
    {
      [(PLManagedAsset *)self setUuid:v7];
      v8 = 0;
    }

    else
    {
      v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      uuid = [(PLManagedAsset *)self uuid];
      [v8 setUUIDString:uuid forKey:v6];
    }

    v165 = 0;
    v10 = *MEMORY[0x1E69BFE18];
    if ([v5 getUInt16:&v165 forKey:*MEMORY[0x1E69BFE18]])
    {
      [MEMORY[0x1E69BF328] maskForIsValidForBackup];
      if (PLValidatedSavedAssetTypeApplies())
      {
        [(PLManagedAsset *)self setSavedAssetType:v165];
      }
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      [v8 setUInt16:-[PLManagedAsset savedAssetType](self forKey:{"savedAssetType"), v10}];
    }

    v11 = *MEMORY[0x1E69BFD90];
    v12 = [v5 stringForKey:*MEMORY[0x1E69BFD90]];
    v147 = v12;
    if (v12)
    {
      [(PLManagedAsset *)self setImportedByBundleIdentifier:v12];
    }

    else
    {
      importedByBundleIdentifier = [(PLManagedAsset *)self importedByBundleIdentifier];

      if (importedByBundleIdentifier)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        importedByBundleIdentifier2 = [(PLManagedAsset *)self importedByBundleIdentifier];
        [v8 setString:importedByBundleIdentifier2 forKey:v11];
      }
    }

    v15 = *MEMORY[0x1E69BFD98];
    v16 = [v5 stringForKey:*MEMORY[0x1E69BFD98]];
    v146 = v16;
    if (v16)
    {
      [(PLManagedAsset *)self setImportedByDisplayName:v16];
    }

    else
    {
      importedByDisplayName = [(PLManagedAsset *)self importedByDisplayName];

      if (importedByDisplayName)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        importedByDisplayName2 = [(PLManagedAsset *)self importedByDisplayName];
        [v8 setString:importedByDisplayName2 forKey:v15];
      }
    }

    v19 = *MEMORY[0x1E69BFDF0];
    v20 = [v5 UUIDStringForKey:*MEMORY[0x1E69BFDF0]];
    v145 = v20;
    if (v20)
    {
      [(PLManagedAsset *)self setOriginalAssetsUUID:v20];
    }

    else
    {
      originalAssetsUUID = [(PLManagedAsset *)self originalAssetsUUID];

      if (originalAssetsUUID)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        originalAssetsUUID2 = [(PLManagedAsset *)self originalAssetsUUID];
        [v8 setUUIDString:originalAssetsUUID2 forKey:v19];
      }
    }

    v23 = *MEMORY[0x1E69BFD20];
    v24 = [v5 UUIDStringForKey:*MEMORY[0x1E69BFD20]];
    v144 = v24;
    if (v24)
    {
      [(PLManagedAsset *)self setAvalancheUUID:v24];
    }

    else
    {
      avalancheUUID = [(PLManagedAsset *)self avalancheUUID];

      if (avalancheUUID)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        avalancheUUID2 = [(PLManagedAsset *)self avalancheUUID];
        [v8 setUUIDString:avalancheUUID2 forKey:v23];
      }
    }

    v164 = 0;
    v27 = *MEMORY[0x1E69BFD18];
    if ([v5 getUInt16:&v164 forKey:*MEMORY[0x1E69BFD18]])
    {
      avalancheUUID3 = [(PLManagedAsset *)self avalancheUUID];

      if (avalancheUUID3)
      {
        [(PLManagedAsset *)self setAvalanchePickType:v164];
        selfCopy2 = self;
        v30 = 1;
      }

      else
      {
        [(PLManagedAsset *)self setAvalanchePickType:0];
        selfCopy2 = self;
        v30 = 0;
      }

      [(PLManagedAsset *)selfCopy2 setAvalancheKind:v30];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      avalancheKind = [(PLManagedAsset *)self avalancheKind];
      if (avalancheKind >= 2)
      {
        if (avalancheKind != 2)
        {
          goto LABEL_48;
        }

        v33 = v8;
        avalanchePickType = 0;
      }

      else
      {
        avalanchePickType = [(PLManagedAsset *)self avalanchePickType];
        v33 = v8;
      }

      [v33 setUInt16:avalanchePickType forKey:v27];
    }

LABEL_48:
    v163 = 0;
    v34 = *MEMORY[0x1E69BFD88];
    if ([v5 getUInt16:&v163 forKey:*MEMORY[0x1E69BFD88]])
    {
      [(PLManagedAsset *)self setHidden:v163 != 0];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      [v8 setUInt16:-[PLManagedAsset hidden](self forKey:{"hidden"), v34}];
    }

    v162 = 0;
    v35 = *MEMORY[0x1E69BFD80];
    if ([v5 getUInt16:&v162 forKey:*MEMORY[0x1E69BFD80]])
    {
      [(PLManagedAsset *)self setFavorite:v162 != 0];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      [v8 setUInt16:-[PLManagedAsset favorite](self forKey:{"favorite"), v35}];
    }

    v161 = 0;
    v36 = *MEMORY[0x1E69BFE20];
    if ([v5 getUInt16:&v161 forKey:*MEMORY[0x1E69BFE20]])
    {
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes setSceneAnalysisIsFromPreview:v161 != 0];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      [v8 setUInt16:objc_msgSend(additionalAttributes forKey:{"sceneAnalysisIsFromPreview"), v36}];
    }

    v160 = 0;
    v38 = *MEMORY[0x1E69BFE78];
    if ([v5 getUInt16:&v160 forKey:*MEMORY[0x1E69BFE78]])
    {
      additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes2 setViewPresentation:v160];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      v8 = v8;

      additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
      [v8 setUInt16:objc_msgSend(additionalAttributes2 forKey:{"viewPresentation"), v38}];
    }

    v159 = 0;
    v40 = *MEMORY[0x1E69BFE58];
    if ([v5 getUInt16:&v159 forKey:*MEMORY[0x1E69BFE58]])
    {
      if ([(PLManagedAsset *)self canMoveToTrash]&& v159)
      {
        buf[0] = 0;
        [v5 getUInt16:buf forKey:*MEMORY[0x1E69BFE60]];
        [(PLManagedAsset *)self trashWithReason:buf[0]];
      }
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      [v8 setUInt16:-[PLManagedAsset isInTrash](self forKey:{"isInTrash"), v40}];
      trashedReason = [(PLManagedAsset *)self trashedReason];
      [v8 setUInt16:trashedReason forKey:*MEMORY[0x1E69BFE60]];
    }

    v158 = 0;
    v42 = *MEMORY[0x1E69BFD60];
    if ([v5 getUInt16:&v158 forKey:*MEMORY[0x1E69BFD60]])
    {
      if (v158 >= 2u)
      {
        [(PLManagedAsset *)self setDeferredProcessingNeeded:?];
        photoLibrary = [(PLManagedObject *)self photoLibrary];
        v44 = photoLibrary;
        if (photoLibrary)
        {
          libraryServicesManager = [photoLibrary libraryServicesManager];
          backgroundJobService = [libraryServicesManager backgroundJobService];
          v47 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
          [backgroundJobService signalBackgroundProcessingNeededOnLibrary:v44 workerTypes:v47];
        }
      }
    }

    else if ([(PLManagedAsset *)self deferredProcessingNeeded])
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      [v8 setUInt16:-[PLManagedAsset deferredProcessingNeeded](self forKey:{"deferredProcessingNeeded"), v42}];
    }

    v48 = *MEMORY[0x1E69BFE08];
    v49 = [v5 stringForKey:*MEMORY[0x1E69BFE08]];
    if (v49)
    {
      [(PLManagedAsset *)self setDisableFileSystemPersistency:1];
      [(PLManagedAsset *)self setPublicGlobalUUID:v49];
      [(PLManagedAsset *)self setDisableFileSystemPersistency:0];
    }

    else
    {
      publicGlobalUUID = [(PLManagedAsset *)self publicGlobalUUID];

      if (publicGlobalUUID)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        publicGlobalUUID2 = [(PLManagedAsset *)self publicGlobalUUID];
        [v8 setString:publicGlobalUUID2 forKey:v48];
      }
    }

    v52 = *MEMORY[0x1E69BFE50];
    v53 = [v5 stringForKey:*MEMORY[0x1E69BFE50]];
    if (v53)
    {
      [(PLManagedAsset *)self setTitle:v53];
    }

    else
    {
      title = [(PLManagedAsset *)self title];

      if (title)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        title2 = [(PLManagedAsset *)self title];
        [v8 setString:title2 forKey:v52];
      }
    }

    v56 = *MEMORY[0x1E69BFD00];
    v57 = [v5 stringForKey:*MEMORY[0x1E69BFD00]];
    v141 = v57;
    if (v53)
    {
      [(PLManagedAsset *)self setAccessibilityDescription:v57];
    }

    else
    {
      accessibilityDescription = [(PLManagedAsset *)self accessibilityDescription];

      if (accessibilityDescription)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        accessibilityDescription2 = [(PLManagedAsset *)self accessibilityDescription];
        [v8 setString:accessibilityDescription2 forKey:v56];
      }
    }

    v143 = v49;
    localTimeZone = [MEMORY[0x1E695DFE8] localTimeZone];
    v60 = *MEMORY[0x1E69BFE40];
    v61 = [v5 stringForKey:*MEMORY[0x1E69BFE40]];
    additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
    additionalAttributes4 = additionalAttributes3;
    v140 = v61;
    if (v61)
    {
      [additionalAttributes3 setTimeZoneName:v61];
    }

    else
    {
      timeZoneName = [additionalAttributes3 timeZoneName];

      if (timeZoneName)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
        timeZoneName2 = [additionalAttributes4 timeZoneName];
        [v8 setString:timeZoneName2 forKey:v60];
      }

      else
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        additionalAttributes4 = [localTimeZone name];
        [v8 setString:additionalAttributes4 forKey:v60];
      }
    }

    v157 = 0;
    v66 = *MEMORY[0x1E69BFE48];
    v67 = [v5 getInt32:&v157 forKey:*MEMORY[0x1E69BFE48]];
    additionalAttributes5 = [(PLManagedAsset *)self additionalAttributes];
    additionalAttributes6 = additionalAttributes5;
    if (v67)
    {
      v70 = [MEMORY[0x1E696AD98] numberWithUnsignedLong:v157];
      [additionalAttributes6 setTimeZoneOffset:v70];
    }

    else
    {
      timeZoneOffset = [additionalAttributes5 timeZoneOffset];

      if (timeZoneOffset)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        additionalAttributes6 = [(PLManagedAsset *)self additionalAttributes];
        timeZoneOffset2 = [additionalAttributes6 timeZoneOffset];
        [v8 setInt32:objc_msgSend(timeZoneOffset2 forKey:{"longValue"), v66}];
      }

      else
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
        }

        additionalAttributes6 = [(PLManagedAsset *)self dateCreated];
        [v8 setInt32:objc_msgSend(localTimeZone forKey:{"secondsFromGMTForDate:", additionalAttributes6), v66}];
      }
    }

    v73 = *MEMORY[0x1E69BFD70];
    v74 = [v5 stringForKey:*MEMORY[0x1E69BFD70]];
    additionalAttributes7 = [(PLManagedAsset *)self additionalAttributes];
    additionalAttributes13 = additionalAttributes7;
    v139 = v74;
    if (v74)
    {
      [additionalAttributes7 setLongDescription:v74];
    }

    else
    {
      longDescription = [additionalAttributes7 longDescription];

      if (!longDescription)
      {
LABEL_127:
        v79 = *MEMORY[0x1E69BFD08];
        v80 = [v5 dataForKey:*MEMORY[0x1E69BFD08]];
        if (v80 && ([MEMORY[0x1E696AE40] propertyListWithData:v80 options:0 format:0 error:0], addedDateData = objc_claimAutoreleasedReturnValue(), addedDateData, addedDateData))
        {
          [(PLManagedAsset *)self setAddedDate:addedDateData];
        }

        else
        {
          addedDate = [(PLManagedAsset *)self addedDate];

          if (!addedDate)
          {
            goto LABEL_135;
          }

          if (!v8)
          {
            v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
          }

          addedDateData = [(PLManagedAsset *)self addedDateData];
          [v8 setData:addedDateData forKey:v79];
        }

LABEL_135:
        v83 = *MEMORY[0x1E69BFDF8];
        v84 = [v5 stringForKey:*MEMORY[0x1E69BFDF8]];
        v137 = v84;
        v138 = v80;
        if (v84)
        {
          [(PLManagedAsset *)self setOriginalFilename:v84];
        }

        else
        {
          originalFilename = [(PLManagedAsset *)self originalFilename];

          if (originalFilename)
          {
            if (!v8)
            {
              v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
            }

            originalFilename2 = [(PLManagedAsset *)self originalFilename];
            [v8 setString:originalFilename2 forKey:v83];
          }
        }

        v87 = *MEMORY[0x1E69BFDE0];
        v88 = [v5 stringForKey:*MEMORY[0x1E69BFDE0]];
        if (v88)
        {
          v89 = v88;
          v90 = [(PLManagedAsset *)self _mediaGroupUUIDFromPersistence:v88];

          [(PLManagedAsset *)self setMediaGroupUUID:v90];
        }

        else
        {
          _mediaGroupUUIDForPersistence = [(PLManagedAsset *)self _mediaGroupUUIDForPersistence];
          if (!_mediaGroupUUIDForPersistence)
          {
LABEL_148:
            v92 = *MEMORY[0x1E69BFD78];
            v93 = [v5 dataForKey:*MEMORY[0x1E69BFD78]];
            v136 = v93;
            if (v93)
            {
              [(PLManagedAsset *)self _setVideoComplementData:v93];
            }

            else if ([(PLManagedAsset *)self _hasVideoComplementData])
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
              }

              v8 = v8;

              videoComplementData = [(PLManagedAsset *)self videoComplementData];
              [v8 setData:videoComplementData forKey:v92];
            }

            v156 = 0;
            v95 = *MEMORY[0x1E69BFE70];
            if ([v5 getUInt16:&v156 forKey:*MEMORY[0x1E69BFE70]])
            {
              [(PLManagedAsset *)self setVideoCpVisibilityState:v156];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
              }

              v8 = v8;

              [v8 setUInt16:-[PLManagedAsset videoCpVisibilityState](self forKey:{"videoCpVisibilityState"), v95}];
            }

            v96 = *MEMORY[0x1E69BFE00];
            v97 = [v5 dataForKey:*MEMORY[0x1E69BFE00]];
            v135 = v97;
            if (v97)
            {
              [(PLManagedAsset *)self setPlaceAnnotationData:v97];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
              }

              v8 = v8;

              placeAnnotationData = [(PLManagedAsset *)self placeAnnotationData];
              [v8 setData:placeAnnotationData forKey:v96];
            }

            v155 = 0;
            v99 = *MEMORY[0x1E69BFDA0];
            if ([v5 getUInt16:&v155 forKey:*MEMORY[0x1E69BFDA0]])
            {
              if (v155)
              {
                [(PLManagedAsset *)self setImportedBy:?];
              }

              else if ([(PLManagedAsset *)self importedBy])
              {
                if (!v8)
                {
                  v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
                }

                v8 = v8;

                [v8 setUInt16:-[PLManagedAsset importedBy](self forKey:{"importedBy"), v99}];
              }
            }

            v154 = 0;
            v100 = *MEMORY[0x1E69BFD38];
            if ([v5 getUInt16:&v154 forKey:*MEMORY[0x1E69BFD38]])
            {
              [(PLManagedAsset *)self setCurrentSleetCast:v154];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
              }

              v8 = v8;

              [v8 setUInt16:-[PLManagedAsset currentSleetCast](self forKey:{"currentSleetCast"), v100}];
            }

            v101 = *MEMORY[0x1E69BFE28];
            v102 = [v5 stringForKey:*MEMORY[0x1E69BFE28]];
            v134 = v102;
            v150 = persistedFileSystemAttributesFileURL;
            if (v102)
            {
              v103 = v102;
              additionalAttributes8 = [(PLManagedAsset *)self additionalAttributes];
              [additionalAttributes8 setSpatialOverCaptureGroupIdentifier:v103];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
              }

              v8 = v8;

              additionalAttributes8 = [(PLManagedAsset *)self additionalAttributes];
              spatialOverCaptureGroupIdentifier = [additionalAttributes8 spatialOverCaptureGroupIdentifier];
              [v8 setString:spatialOverCaptureGroupIdentifier forKey:v101];
            }

            v106 = *MEMORY[0x1E69BFE38];
            v107 = [v5 stringForKey:*MEMORY[0x1E69BFE38]];
            v132 = v107;
            if (v107)
            {
              v108 = v107;
              v109 = v3;
              additionalAttributes9 = [(PLManagedAsset *)self additionalAttributes];
              [additionalAttributes9 setSyndicationIdentifier:v108];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
              }

              v109 = v3;
              v8 = v8;

              additionalAttributes9 = [(PLManagedAsset *)self additionalAttributes];
              syndicationIdentifier = [additionalAttributes9 syndicationIdentifier];
              [v8 setString:syndicationIdentifier forKey:v106];
            }

            v112 = *MEMORY[0x1E69BFDD0];
            v113 = [v5 dataForKey:*MEMORY[0x1E69BFDD0]];
            v114 = MEMORY[0x1E696ACD0];
            v115 = MEMORY[0x1E695DFD8];
            v116 = objc_opt_class();
            v117 = [v115 setWithObjects:{v116, objc_opt_class(), 0}];
            v153 = 0;
            v133 = v113;
            v118 = [v114 unarchivedObjectOfClasses:v117 fromData:v113 error:&v153];
            v119 = v153;

            v142 = v53;
            if ([v118 count])
            {
              additionalAttributes10 = [(PLManagedAsset *)self additionalAttributes];
              [additionalAttributes10 setLibraryScopeAssetContributorsToUpdate:v118];
              v3 = v109;
            }

            else
            {
              v3 = v109;
              if (v119)
              {
                additionalAttributes10 = PLBackendGetLog();
                if (os_log_type_enabled(additionalAttributes10, OS_LOG_TYPE_ERROR))
                {
                  *buf = 138412290;
                  *&buf[2] = v119;
                  _os_log_impl(&dword_19BF1F000, additionalAttributes10, OS_LOG_TYPE_ERROR, "libraryScopeAssetContributorsToUpdate unarchiving failed: %@", buf, 0xCu);
                }
              }

              else
              {
                if (!v8)
                {
                  v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v150];
                }

                v8 = v8;

                v128 = MEMORY[0x1E696ACC8];
                additionalAttributes11 = [(PLManagedAsset *)self additionalAttributes];
                libraryScopeAssetContributorsToUpdate = [additionalAttributes11 libraryScopeAssetContributorsToUpdate];
                v152 = 0;
                additionalAttributes10 = [v128 archivedDataWithRootObject:libraryScopeAssetContributorsToUpdate requiringSecureCoding:1 error:&v152];
                v119 = v152;

                if (v119)
                {
                  v131 = PLBackendGetLog();
                  v3 = v109;
                  if (os_log_type_enabled(v131, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 138412290;
                    *&buf[2] = v119;
                    _os_log_impl(&dword_19BF1F000, v131, OS_LOG_TYPE_ERROR, "libraryScopeAssetContributorsToUpdate archiving failed: %@", buf, 0xCu);
                  }
                }

                else
                {
                  [v8 setData:additionalAttributes10 forKey:v112];
                  v3 = v109;
                }
              }
            }

            v151 = 0;
            v121 = *MEMORY[0x1E69BFE30];
            if ([v5 getUInt16:&v151 forKey:*MEMORY[0x1E69BFE30]])
            {
              additionalAttributes12 = [(PLManagedAsset *)self additionalAttributes];
              [additionalAttributes12 setSyndicationHistory:v151];
              v123 = 0x1E696A000;
            }

            else
            {
              v123 = 0x1E696A000uLL;
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v150];
              }

              v8 = v8;

              additionalAttributes12 = [(PLManagedAsset *)self additionalAttributes];
              [v8 setUInt16:objc_msgSend(additionalAttributes12 forKey:{"syndicationHistory"), v121}];
            }

            v124 = [v5 dataForKey:*MEMORY[0x1E69BFD40]];
            if (v124)
            {
              v125 = [*(v123 + 3648) propertyListWithData:v124 options:0 format:0 error:0];

              if (v125)
              {
                [(PLManagedAsset *)self setDateCreated:v125];
              }
            }

            v126 = [v5 stringForKey:*MEMORY[0x1E69BFD28]];
            if (v126)
            {
              [(PLManagedAsset *)self setCloudAssetGUID:v126];
            }

            *buf = 0;
            v127 = *MEMORY[0x1E69BFDD8];
            if ([v5 getUInt64:buf forKey:*MEMORY[0x1E69BFDD8]])
            {
              [(PLManagedAsset *)self setLibraryScopeShareState:*buf];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v150];
              }

              v8 = v8;

              [v8 setUInt64:-[PLManagedAsset libraryScopeShareState](self forKey:{"libraryScopeShareState"), v127}];
            }

            [(PLManagedAsset *)self setLocationFromPersistedAttributes:v5];
            if (v8)
            {
              [v8 persist];
            }

            persistedFileSystemAttributesFileURL = v150;
            goto LABEL_206;
          }

          v90 = _mediaGroupUUIDForPersistence;
          if (!v8)
          {
            v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
          }

          v8 = v8;

          [v8 setString:v90 forKey:v87];
        }

        goto LABEL_148;
      }

      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
      }

      additionalAttributes13 = [(PLManagedAsset *)self additionalAttributes];
      longDescription2 = [additionalAttributes13 longDescription];
      [v8 setString:longDescription2 forKey:v73];
    }

    goto LABEL_127;
  }
}

- (void)persistMetadataToFileURL:(id)l
{
  v57 = *MEMORY[0x1E69E9840];
  lCopy = l;
  if (!lCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:4563 description:{@"Invalid parameter not satisfying: %@", @"url"}];
  }

  v6 = objc_autoreleasePoolPush();
  v7 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:lCopy];
  uuid = [(PLManagedAsset *)self uuid];
  [v7 setUUIDString:uuid forKey:*MEMORY[0x1E69BFE68]];

  savedAssetType = [(PLManagedAsset *)self savedAssetType];
  [v7 setUInt16:savedAssetType forKey:*MEMORY[0x1E69BFE18]];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  managedObjectContextStoreUUID = [photoLibrary managedObjectContextStoreUUID];
  [v7 setString:managedObjectContextStoreUUID forKey:*MEMORY[0x1E69BFD58]];

  avalancheKind = [(PLManagedAsset *)self avalancheKind];
  if (avalancheKind >= 2)
  {
    if (avalancheKind != 2)
    {
      goto LABEL_8;
    }

    avalanchePickType = 0;
  }

  else
  {
    avalancheUUID = [(PLManagedAsset *)self avalancheUUID];
    [v7 setUUIDString:avalancheUUID forKey:*MEMORY[0x1E69BFD20]];

    avalanchePickType = [(PLManagedAsset *)self avalanchePickType];
  }

  [v7 setUInt16:avalanchePickType forKey:*MEMORY[0x1E69BFD18]];
LABEL_8:
  hidden = [(PLManagedAsset *)self hidden];
  [v7 setUInt16:hidden forKey:*MEMORY[0x1E69BFD88]];
  favorite = [(PLManagedAsset *)self favorite];
  [v7 setUInt16:favorite forKey:*MEMORY[0x1E69BFD80]];
  isInTrash = [(PLManagedAsset *)self isInTrash];
  [v7 setUInt16:isInTrash forKey:*MEMORY[0x1E69BFE58]];
  trashedReason = [(PLManagedAsset *)self trashedReason];
  [v7 setUInt16:trashedReason forKey:*MEMORY[0x1E69BFE60]];
  deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
  [v7 setUInt16:deferredProcessingNeeded forKey:*MEMORY[0x1E69BFD60]];
  dateCreatedData = [(PLManagedAsset *)self dateCreatedData];
  [v7 setData:dateCreatedData forKey:*MEMORY[0x1E69BFD40]];

  locationData = [(PLManagedAsset *)self locationData];
  [v7 setData:locationData forKey:*MEMORY[0x1E69BFD48]];

  addedDateData = [(PLManagedAsset *)self addedDateData];
  [v7 setData:addedDateData forKey:*MEMORY[0x1E69BFD08]];

  [MEMORY[0x1E69BF328] maskForIsValidForFileSystemPersistence];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
    [v7 setString:cloudAssetGUID forKey:*MEMORY[0x1E69BFD28]];
  }

  videoComplementData = [(PLManagedAsset *)self videoComplementData];
  [v7 setData:videoComplementData forKey:*MEMORY[0x1E69BFD78]];

  videoCpVisibilityState = [(PLManagedAsset *)self videoCpVisibilityState];
  [v7 setUInt16:videoCpVisibilityState forKey:*MEMORY[0x1E69BFE70]];
  libraryScopeShareState = [(PLManagedAsset *)self libraryScopeShareState];
  [v7 setUInt64:libraryScopeShareState forKey:*MEMORY[0x1E69BFDD8]];
  currentSleetCast = [(PLManagedAsset *)self currentSleetCast];
  [v7 setUInt16:currentSleetCast forKey:*MEMORY[0x1E69BFD38]];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  importedByBundleIdentifier = [additionalAttributes importedByBundleIdentifier];
  [v7 setString:importedByBundleIdentifier forKey:*MEMORY[0x1E69BFD90]];

  importedByDisplayName = [additionalAttributes importedByDisplayName];
  [v7 setString:importedByDisplayName forKey:*MEMORY[0x1E69BFD98]];

  originalAssetsUUID = [additionalAttributes originalAssetsUUID];
  [v7 setUUIDString:originalAssetsUUID forKey:*MEMORY[0x1E69BFDF0]];

  publicGlobalUUID = [additionalAttributes publicGlobalUUID];
  [v7 setString:publicGlobalUUID forKey:*MEMORY[0x1E69BFE08]];

  title = [additionalAttributes title];
  [v7 setString:title forKey:*MEMORY[0x1E69BFE50]];

  accessibilityDescription = [additionalAttributes accessibilityDescription];
  [v7 setString:accessibilityDescription forKey:*MEMORY[0x1E69BFD00]];

  timeZoneName = [additionalAttributes timeZoneName];
  [v7 setString:timeZoneName forKey:*MEMORY[0x1E69BFE40]];

  timeZoneOffset = [additionalAttributes timeZoneOffset];
  intValue = [timeZoneOffset intValue];
  [v7 setInt32:intValue forKey:*MEMORY[0x1E69BFE48]];

  longDescription = [additionalAttributes longDescription];
  [v7 setString:longDescription forKey:*MEMORY[0x1E69BFD70]];

  originalFilename = [additionalAttributes originalFilename];
  [v7 setString:originalFilename forKey:*MEMORY[0x1E69BFDF8]];

  placeAnnotationData = [additionalAttributes placeAnnotationData];
  [v7 setData:placeAnnotationData forKey:*MEMORY[0x1E69BFE00]];

  if ([additionalAttributes importedBy])
  {
    importedBy = [additionalAttributes importedBy];
    [v7 setUInt16:importedBy forKey:*MEMORY[0x1E69BFDA0]];
  }

  _mediaGroupUUIDForPersistence = [(PLManagedAsset *)self _mediaGroupUUIDForPersistence];
  [v7 setString:_mediaGroupUUIDForPersistence forKey:*MEMORY[0x1E69BFDE0]];
  spatialOverCaptureGroupIdentifier = [additionalAttributes spatialOverCaptureGroupIdentifier];
  [v7 setString:spatialOverCaptureGroupIdentifier forKey:*MEMORY[0x1E69BFE28]];

  syndicationIdentifier = [additionalAttributes syndicationIdentifier];
  [v7 setString:syndicationIdentifier forKey:*MEMORY[0x1E69BFE38]];

  syndicationHistory = [additionalAttributes syndicationHistory];
  [v7 setUInt16:syndicationHistory forKey:*MEMORY[0x1E69BFE30]];
  sceneAnalysisIsFromPreview = [additionalAttributes sceneAnalysisIsFromPreview];
  [v7 setUInt16:sceneAnalysisIsFromPreview forKey:*MEMORY[0x1E69BFE20]];
  viewPresentation = [additionalAttributes viewPresentation];
  [v7 setUInt16:viewPresentation forKey:*MEMORY[0x1E69BFE78]];
  v48 = MEMORY[0x1E696ACC8];
  libraryScopeAssetContributorsToUpdate = [additionalAttributes libraryScopeAssetContributorsToUpdate];
  v54 = 0;
  v50 = [v48 archivedDataWithRootObject:libraryScopeAssetContributorsToUpdate requiringSecureCoding:1 error:&v54];
  v51 = v54;

  if (v51)
  {
    v52 = PLBackendGetLog();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v56 = v51;
      _os_log_impl(&dword_19BF1F000, v52, OS_LOG_TYPE_ERROR, "libraryScopeAssetContributorsToUpdate archiving failed: %@", buf, 0xCu);
    }
  }

  else
  {
    [v7 setData:v50 forKey:*MEMORY[0x1E69BFDD0]];
  }

  [v7 persist];

  objc_autoreleasePoolPop(v6);
}

- (void)persistMetadataToFilesystem
{
  if (PLIsAssetsd() && [(PLManagedAsset *)self isValidTypeForPersistence])
  {
    persistedFileSystemAttributesFileURL = [(PLManagedAsset *)self persistedFileSystemAttributesFileURL];
    if (persistedFileSystemAttributesFileURL)
    {
      v4 = persistedFileSystemAttributesFileURL;
      [(PLManagedAsset *)self persistMetadataToFileURL:persistedFileSystemAttributesFileURL];
      persistedFileSystemAttributesFileURL = v4;
    }
  }
}

- (id)_mediaGroupUUIDForPersistence
{
  mediaGroupUUID = [(PLManagedAsset *)self mediaGroupUUID];
  if (mediaGroupUUID && [(PLManagedAsset *)self isVideo])
  {
    v4 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@%@", @"failed-", mediaGroupUUID];

    mediaGroupUUID = v4;
  }

  return mediaGroupUUID;
}

- (id)addedDateData
{
  v2 = MEMORY[0x1E696AE40];
  addedDate = [(PLManagedAsset *)self addedDate];
  v4 = [v2 dataWithPropertyList:addedDate format:200 options:0 error:0];

  return v4;
}

- (id)dateCreatedData
{
  v2 = MEMORY[0x1E696AE40];
  dateCreated = [(PLManagedAsset *)self dateCreated];
  v4 = [v2 dataWithPropertyList:dateCreated format:200 options:0 error:0];

  return v4;
}

- (BOOL)hasLegacyRequiredResourcesLocallyAvailable
{
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  isCloudPhotoLibraryEnabled = [photoLibrary isCloudPhotoLibraryEnabled];

  if (!isCloudPhotoLibraryEnabled)
  {
    return 1;
  }

  return [(PLManagedAsset *)self checkAllResourcesRequiredForCPLDisableWithReachableBlock:0];
}

- (BOOL)hasOriginalFile
{
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  v5 = [defaultManager fileExistsAtPath:pathForOriginalFile isDirectory:0];

  return v5;
}

- (BOOL)isValidTypeForPersistence
{
  [MEMORY[0x1E69BF328] maskForIsValidForFileSystemPersistence];
  [(PLManagedAsset *)self savedAssetType];
  v3 = PLValidatedSavedAssetTypeApplies();
  if (v3)
  {
    v3 = [MEMORY[0x1E69BF2A0] bundleScopeShouldBePersistedForRebuild:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
    if (v3)
    {
      if ([(PLManagedAsset *)self hasOriginalFile])
      {
        LOBYTE(v3) = 1;
      }

      else
      {

        LOBYTE(v3) = [(PLManagedAsset *)self hasDeferredProcessingPreviewFile];
      }
    }
  }

  return v3;
}

- (NSString)uuidDescription
{
  v3 = MEMORY[0x1E696AEC0];
  objectID = [(PLManagedAsset *)self objectID];
  pl_shortURI = [objectID pl_shortURI];
  uuid = [(PLManagedAsset *)self uuid];
  v7 = [v3 stringWithFormat:@"<%@ %@>", pl_shortURI, uuid];

  return v7;
}

- (id)loggingDescription
{
  string = [MEMORY[0x1E696AD60] string];
  v4 = objc_autoreleasePoolPush();
  uuidDescription = [(PLManagedAsset *)self uuidDescription];
  [string appendFormat:@"%@ ", uuidDescription];

  array = [MEMORY[0x1E695DF70] array];
  _kindDescription = [(PLManagedAsset *)self _kindDescription];
  if (_kindDescription)
  {
    [array addObject:_kindDescription];
  }

  _savedAssetTypeDescription = [(PLManagedAsset *)self _savedAssetTypeDescription];

  if (_savedAssetTypeDescription)
  {
    _savedAssetTypeDescription2 = [(PLManagedAsset *)self _savedAssetTypeDescription];
    [array addObject:_savedAssetTypeDescription2];
  }

  v10 = MEMORY[0x1E696AEC0];
  dateCreated = [(PLManagedAsset *)self dateCreated];
  v12 = [v10 stringWithFormat:@"created:%@", dateCreated];
  [array addObject:v12];

  v13 = MEMORY[0x1E696AEC0];
  addedDate = [(PLManagedAsset *)self addedDate];
  v15 = [v13 stringWithFormat:@"added:%@", addedDate];
  [array addObject:v15];

  if ([array count])
  {
    objc_msgSend(string, "appendString:", @" (");
    v16 = [array componentsJoinedByString:{@", "}];
    [string appendString:v16];

    [string appendString:@""]);
  }

  objc_autoreleasePoolPop(v4);

  return string;
}

- (id)_compactDebugDescription
{
  v3 = objc_autoreleasePoolPush();
  objectID = [(PLManagedAsset *)self objectID];
  uRIRepresentation = [objectID URIRepresentation];
  path = [uRIRepresentation path];
  pathComponents = [path pathComponents];

  if ([pathComponents count] >= 2)
  {
    v8 = [pathComponents subarrayWithRange:{objc_msgSend(pathComponents, "count") - 2, 2}];

    pathComponents = v8;
  }

  v9 = [MEMORY[0x1E696AEC0] pathWithComponents:pathComponents];
  v10 = MEMORY[0x1E696AEC0];
  uuid = [(PLManagedAsset *)self uuid];
  v12 = [v10 stringWithFormat:@"%@ [%@]", uuid, v9];

  objc_autoreleasePoolPop(v3);

  return v12;
}

- (id)_kindDescription
{
  kind = [(PLManagedAsset *)self kind];
  if (kind > 2)
  {
    return @"unknown";
  }

  else
  {
    return qword_1E7567BD0[kind];
  }
}

- (id)_savedAssetTypeDescription
{
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeDescription();
}

- (id)_hdrTypeDescription
{
  hdrType = [(PLManagedAsset *)self hdrType];
  if (hdrType > 0xB)
  {
    return @"HDR";
  }

  else
  {
    return off_1E7567B70[hdrType];
  }
}

- (void)unregisterForChanges
{
  if (self->_isRegisteredForChanges)
  {
    self->_isRegisteredForChanges = 0;
    v4 = +[PLChangeNotificationCenter defaultCenter];
    [(PLManagedAsset *)self removeObserver:v4 forKeyPath:@"cloudComments" context:&PLChangeNotificationCenterKVOContext];
    [(PLManagedAsset *)self removeObserver:v4 forKeyPath:@"likeComments" context:&PLChangeNotificationCenterKVOContext];
  }
}

- (void)registerForChanges
{
  if ([(PLManagedObject *)self isRegisteredWithUserInterfaceContext]&& [(PLManagedAsset *)self isCloudSharedAsset]&& !self->_isRegisteredForChanges)
  {
    self->_isRegisteredForChanges = 1;
    v3 = +[PLChangeNotificationCenter defaultCenter];
    [(PLManagedAsset *)self addObserver:v3 forKeyPath:@"cloudComments" options:8 context:&PLChangeNotificationCenterKVOContext];
    [(PLManagedAsset *)self addObserver:v3 forKeyPath:@"likeComments" options:8 context:&PLChangeNotificationCenterKVOContext];
  }
}

- (BOOL)_isValidUTI:(id)i forService:(id)service
{
  iCopy = i;
  serviceCopy = service;
  if (-[PLManagedAsset isPhoto](self, "isPhoto") && ![serviceCopy caseInsensitiveCompare:@"MMS"])
  {
    v10 = [MEMORY[0x1E69C08F0] typeWithIdentifier:iCopy];
    if ([v10 isEqual:*MEMORY[0x1E6982E58]] & 1) != 0 || (objc_msgSend(v10, "isEqual:", *MEMORY[0x1E6982F28]))
    {
      v8 = 1;
    }

    else
    {
      v8 = [v10 isEqual:*MEMORY[0x1E6982DE8]];
    }
  }

  else
  {
    v8 = 1;
  }

  return v8;
}

- (id)pathToOriginalVideoFile
{
  v15 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self isStreamedVideo]&& ([(PLManagedAsset *)self originalAssetsUUID], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    originalAssetsUUID = [(PLManagedAsset *)self originalAssetsUUID];
    v6 = [photoLibrary assetWithUUID:originalAssetsUUID];

    if (v6 && (-[PLManagedAsset duration](self, "duration"), v8 = v7, [v6 duration], v8 == v9))
    {
      pathForVideoFile = [v6 pathForVideoFile];
      v11 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v13 = 138412290;
        v14 = pathForVideoFile;
        _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEBUG, "pathToOriginalVideoFile %@", &v13, 0xCu);
      }
    }

    else
    {
      pathForVideoFile = 0;
    }
  }

  else
  {
    pathForVideoFile = 0;
  }

  return pathForVideoFile;
}

- (NSURL)cachedNonPersistedVideoPlaybackURL
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = self->cachedNonPersistedVideoPlaybackURL;
  cachedNonPersistedVideoPlaybackURLExpiration = [(PLManagedAsset *)self cachedNonPersistedVideoPlaybackURLExpiration];
  if (v3)
  {
    v5 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      date = [MEMORY[0x1E695DF00] date];
      [date timeIntervalSinceDate:cachedNonPersistedVideoPlaybackURLExpiration];
      v12 = 138412546;
      v13 = cachedNonPersistedVideoPlaybackURLExpiration;
      v14 = 2048;
      v15 = v7;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "cachedNonPersistedVideoPlaybackURLExpiration %@ %lf", &v12, 0x16u);
    }

    date2 = [MEMORY[0x1E695DF00] date];
    v9 = [cachedNonPersistedVideoPlaybackURLExpiration compare:date2];

    if (v9 != 1)
    {
      v10 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v12 = 138412290;
        v13 = cachedNonPersistedVideoPlaybackURLExpiration;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEFAULT, "cachedNonPersistedVideoPlaybackURL expired on %@", &v12, 0xCu);
      }

      v3 = 0;
    }
  }

  return v3;
}

- (void)_coordinatesFromDoubles:(double)doubles faceMaxX:(double)x faceMinY:(double)y faceMaxY:(double)maxY minX:(double *)minX maxX:(double *)maxX minY:(double *)minY maxY:(double *)self0
{
  if (*minX < doubles && *minX > -1.0)
  {
    doubles = *minX;
  }

  *minX = doubles;
  yCopy = *minY;
  if (*minY >= y || yCopy <= -1.0)
  {
    yCopy = y;
  }

  *minY = yCopy;
  if (*maxX >= x)
  {
    xCopy = *maxX;
  }

  else
  {
    xCopy = x;
  }

  if (*maxX <= -1.0)
  {
    xCopy2 = x;
  }

  else
  {
    xCopy2 = xCopy;
  }

  *maxX = xCopy2;
  if (*a10 >= maxY)
  {
    maxYCopy = *a10;
  }

  else
  {
    maxYCopy = maxY;
  }

  if (*a10 <= -1.0)
  {
    maxYCopy2 = maxY;
  }

  else
  {
    maxYCopy2 = maxYCopy;
  }

  *a10 = maxYCopy2;
}

- (void)revalidateFaceAreaPoints
{
  v49 = *MEMORY[0x1E69E9840];
  *&v46 = -1.0;
  *&v47 = -1.0;
  *&v44 = -1.0;
  *&v45 = -1.0;
  detectedFaces = [(PLManagedAsset *)self detectedFaces];
  v4 = [detectedFaces count];

  if (v4)
  {
    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    detectedFaces2 = [(PLManagedAsset *)self detectedFaces];
    v6 = [detectedFaces2 countByEnumeratingWithState:&v40 objects:v48 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v41;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v41 != v8)
          {
            objc_enumerationMutation(detectedFaces2);
          }

          v10 = *(*(&v40 + 1) + 8 * i);
          if (([v10 isTorsoOnly] & 1) == 0)
          {
            [v10 centerX];
            v12 = v11;
            [v10 centerY];
            v14 = v13;
            [v10 size];
            v16 = v15 * 0.5;
            v17 = fmax(v12 - v15 * 0.5, 0.0);
            v18 = v12 + v16;
            if (v12 + v16 > 1.0)
            {
              v18 = 1.0;
            }

            v19 = fmax(v14 - v16, 0.0);
            v20 = v14 + v16;
            if (v20 > 1.0)
            {
              v20 = 1.0;
            }

            [(PLManagedAsset *)self _coordinatesFromDoubles:&v47 faceMaxX:&v45 faceMinY:&v46 faceMaxY:&v44 minX:v17 maxX:v18 minY:v19 maxY:v20];
          }
        }

        v7 = [detectedFaces2 countByEnumeratingWithState:&v40 objects:v48 count:16];
      }

      while (v7);
    }

LABEL_20:

    v36 = *&v46;
    v35 = *&v47;
    v38 = *&v44;
    v37 = *&v45;
    goto LABEL_21;
  }

  faceRegions = [(PLManagedAsset *)self faceRegions];

  if (faceRegions)
  {
    faceRegions2 = [(PLManagedAsset *)self faceRegions];
    detectedFaces2 = PLManagedAssetDecodeFaceRegions(faceRegions2);

    if ([detectedFaces2 count])
    {
      v23 = 0;
      do
      {
        v24 = [detectedFaces2 objectAtIndexedSubscript:v23];
        v25 = MEMORY[0x19EAED7C0]();
        v27 = v26;
        v29 = v28;
        v31 = v30;

        v50.origin.x = v25;
        v50.origin.y = v27;
        v50.size.width = v29;
        v50.size.height = v31;
        MinX = CGRectGetMinX(v50);
        v51.origin.x = v25;
        v51.origin.y = v27;
        v51.size.width = v29;
        v51.size.height = v31;
        MaxX = CGRectGetMaxX(v51);
        v52.origin.x = v25;
        v52.origin.y = v27;
        v52.size.width = v29;
        v52.size.height = v31;
        MinY = CGRectGetMinY(v52);
        v53.origin.x = v25;
        v53.origin.y = v27;
        v53.size.width = v29;
        v53.size.height = v31;
        [(PLManagedAsset *)self _coordinatesFromDoubles:&v47 faceMaxX:&v45 faceMinY:&v46 faceMaxY:&v44 minX:MinX maxX:MaxX minY:MinY maxY:CGRectGetMaxY(v53)];
        ++v23;
      }

      while ([detectedFaces2 count] > v23);
    }

    goto LABEL_20;
  }

  v38 = -1.0;
  v36 = -1.0;
  v37 = -1.0;
  v35 = -1.0;
LABEL_21:
  v39 = [(PLManagedAsset *)self _combineFaceAreaPointValuesToInt64WithMinX:v35 maxX:v37 minY:v36 maxY:v38];
  if ([(PLManagedAsset *)self faceAreaPoints]!= v39)
  {
    [(PLManagedAsset *)self setFaceAreaPoints:v39];
  }
}

- (void)setLibraryScope:(id)scope
{
  scopeCopy = scope;
  v8 = 0;
  v9 = &v8;
  v10 = 0x2020000000;
  v11 = 0;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __34__PLManagedAsset_setLibraryScope___block_invoke;
  v7[3] = &unk_1E7567770;
  v7[4] = &v8;
  [(PLManagedObject *)self pl_safeSetValue:scopeCopy forKey:@"libraryScope" valueDidChangeHandler:v7];
  if (*(v9 + 24) == 1)
  {
    v5 = [PLLibraryScope participationStateFromLibraryScope:scopeCopy];
    v6 = [MEMORY[0x1E696AD98] numberWithShort:v5];
    [(PLManagedObject *)self pl_safeSetValue:v6 forKey:@"activeLibraryScopeParticipationState" valueDidChangeHandler:0];
  }

  _Block_object_dispose(&v8, 8);
}

- (void)setAvalanchePickType:(int)type
{
  v4 = [MEMORY[0x1E696AD98] numberWithInt:*&type];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v4 forKey:@"avalanchePickType"];
}

- (void)setSavedAssetType:(signed __int16)type
{
  typeCopy = type;
  savedAssetType = [(PLManagedAsset *)self savedAssetType];
  if (savedAssetType != typeCopy && savedAssetType == [MEMORY[0x1E69BF328] savedAssetTypeForPromoteToGuestAsset])
  {
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    libraryServicesManager = [photoLibrary libraryServicesManager];
    wellKnownPhotoLibraryIdentifier = [libraryServicesManager wellKnownPhotoLibraryIdentifier];

    if (wellKnownPhotoLibraryIdentifier != 3)
    {
      currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
      [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:4131 description:{@"Invalid parameter not satisfying: %@", @"self.photoLibrary.libraryServicesManager.wellKnownPhotoLibraryIdentifier == PLWellKnownPhotoLibraryIdentifierSyndication"}];
    }
  }

  v11 = [MEMORY[0x1E696AD98] numberWithShort:typeCopy];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v11 forKey:@"savedAssetType"];
}

- (void)setTrashedState:(signed __int16)state
{
  v4 = [MEMORY[0x1E696AD98] numberWithShort:state];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v4 forKey:@"trashedState"];
}

- (void)setHidden:(BOOL)hidden
{
  v4 = [MEMORY[0x1E696AD98] numberWithBool:hidden];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v4 forKey:@"hidden"];
}

- (void)_setAllowedForAnalysisDependentValue:(id)value forKey:(id)key
{
  valueCopy = value;
  keyCopy = key;
  if (!keyCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:4106 description:{@"Invalid parameter not satisfying: %@", @"key"}];
  }

  objc_initWeak(&location, self);
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __62__PLManagedAsset__setAllowedForAnalysisDependentValue_forKey___block_invoke;
  v10[3] = &unk_1E7567748;
  objc_copyWeak(&v11, &location);
  [(PLManagedObject *)self pl_safeSetValue:valueCopy forKey:keyCopy valueDidChangeHandler:v10];
  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);
}

void __62__PLManagedAsset__setAllowedForAnalysisDependentValue_forKey___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained calculateAllowedForAnalysis];
  v2 = [WeakRetained additionalAttributes];
  v3 = [v2 allowedForAnalysis];

  if (v1 != v3)
  {
    v4 = [WeakRetained additionalAttributes];
    [v4 setAllowedForAnalysis:v1];
  }
}

- (void)setUuid:(id)uuid
{
  uuidCopy = uuid;
  objc_initWeak(&location, self);
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __26__PLManagedAsset_setUuid___block_invoke;
  v6[3] = &unk_1E7568790;
  objc_copyWeak(&v8, &location);
  v5 = uuidCopy;
  v7 = v5;
  [(PLManagedObject *)self pl_safeSetValue:v5 forKey:@"uuid" valueDidChangeHandler:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __26__PLManagedAsset_setUuid___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x1E69E9840];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained analysisStates];

  v4 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v9;
    do
    {
      v7 = 0;
      do
      {
        if (*v9 != v6)
        {
          objc_enumerationMutation(v3);
        }

        [*(*(&v8 + 1) + 8 * v7++) setAssetUUID:*(a1 + 32)];
      }

      while (v5 != v7);
      v5 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v5);
  }
}

- (void)_dateCreatedDidChange:(id)change
{
  v21 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  [changeCopy timeIntervalSinceReferenceDate];
  v6 = v5;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  analysisStates = [(PLManagedAsset *)self analysisStates];
  v8 = [analysisStates countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v17;
    do
    {
      v11 = 0;
      do
      {
        if (*v17 != v10)
        {
          objc_enumerationMutation(analysisStates);
        }

        [*(*(&v16 + 1) + 8 * v11++) setSortToken:v6];
      }

      while (v9 != v11);
      v9 = [analysisStates countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v9);
  }

  mediaAnalysisAttributesInsertingIfNecessary = [(PLManagedAsset *)self mediaAnalysisAttributesInsertingIfNecessary];
  [mediaAnalysisAttributesInsertingIfNecessary setAssetDateCreated:changeCopy];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setInferredTimeZoneOffset:0];

  cachedDateCreated = self->_cachedDateCreated;
  self->_cachedDateCreated = 0;

  cachedLocalDateCreated = self->_cachedLocalDateCreated;
  self->_cachedLocalDateCreated = 0;
}

- (void)setDateCreated:(id)created
{
  createdCopy = created;
  objc_initWeak(&location, self);
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __33__PLManagedAsset_setDateCreated___block_invoke;
  v6[3] = &unk_1E7568790;
  objc_copyWeak(&v8, &location);
  v5 = createdCopy;
  v7 = v5;
  [(PLManagedObject *)self pl_safeSetValue:v5 forKey:@"dateCreated" valueDidChangeHandler:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __33__PLManagedAsset_setDateCreated___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained _dateCreatedDidChange:*(a1 + 32)];
}

- (void)setMoment:(id)moment
{
  momentCopy = moment;
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  hasLibraryScope = [(PLManagedAsset *)self hasLibraryScope];
  libraryServicesManager = [photoLibrary libraryServicesManager];
  databaseContext = [libraryServicesManager databaseContext];
  momentLibrary = [databaseContext momentLibrary];
  if (photoLibrary == momentLibrary)
  {
    v10 = 1;
  }

  else
  {
    v10 = MEMORY[0x19EAEE520]();
  }

  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __28__PLManagedAsset_setMoment___block_invoke;
  v12[3] = &unk_1E7567720;
  v14 = v10;
  v15 = hasLibraryScope;
  v12[4] = self;
  v13 = momentCopy;
  v11 = momentCopy;
  [(PLManagedObject *)self pl_safeSetValue:v11 forKey:@"moment" valueDidChangeHandler:v12];
}

void __28__PLManagedAsset_setMoment___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 48) == 1)
  {
    v8 = v3;
    v4 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
    [(PLSharedAssetsContainerIncrementalChange *)v4 setCollectionChangeType:1];
    v5 = *(a1 + 49) ? 1 : 2;
    [(PLSharedAssetsContainerIncrementalChange *)v4 setSharingChange:v5];
    [(PLSharedAssetsContainerIncrementalChange *)v4 setSuggestionStateChange:0];
    -[PLSharedAssetsContainerIncrementalChange setMediaType:](v4, "setMediaType:", [*(a1 + 32) kind] != 0);
    [*(a1 + 40) reportSharedAssetContainerIncrementalChange:v4 forAllAssetsCountKey:@"assetsCount"];

    v3 = v8;
    if (*(a1 + 48))
    {
      v6 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
      [(PLSharedAssetsContainerIncrementalChange *)v6 setCollectionChangeType:2];
      if (*(a1 + 49))
      {
        v7 = 1;
      }

      else
      {
        v7 = 2;
      }

      [(PLSharedAssetsContainerIncrementalChange *)v6 setSharingChange:v7];
      [(PLSharedAssetsContainerIncrementalChange *)v6 setSuggestionStateChange:0];
      -[PLSharedAssetsContainerIncrementalChange setMediaType:](v6, "setMediaType:", [*(a1 + 32) kind] != 0);
      [v8 reportSharedAssetContainerIncrementalChange:v6 forAllAssetsCountKey:@"assetsCount"];

      v3 = v8;
    }
  }
}

- (void)setOriginalAsset:(id)asset
{
  uuid = [asset uuid];
  [(PLManagedAsset *)self setOriginalAssetsUUID:uuid];
}

- (PLManagedAsset)originalAsset
{
  originalAssetsUUID = [(PLManagedAsset *)self originalAssetsUUID];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v5 = [PLManagedAsset assetWithUUID:originalAssetsUUID inLibrary:photoLibrary];

  return v5;
}

- (CGSize)originalImageSize
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalWidth = [additionalAttributes originalWidth];
  [originalWidth doubleValue];
  v5 = v4;
  originalHeight = [additionalAttributes originalHeight];
  [originalHeight doubleValue];
  v8 = v7;

  v9 = v5;
  v10 = v8;
  result.height = v10;
  result.width = v9;
  return result;
}

- (BOOL)isOriginalSRGB
{
  originalColorSpace = [(PLManagedAsset *)self originalColorSpace];

  if (!originalColorSpace)
  {
    return 1;
  }

  originalColorSpace2 = [(PLManagedAsset *)self originalColorSpace];
  v5 = [originalColorSpace2 isEqualToString:@"sRGB IEC61966-2.1"];

  return v5;
}

- (int64_t)originalImageOrientation
{
  [(PLManagedAsset *)self originalOrientation];

  return PLImageOrientationFromExifOrientation();
}

- (void)didSave
{
  self->_setCustomCreationDate = 0;
  self->_setCustomLocation = 0;
  v2.receiver = self;
  v2.super_class = PLManagedAsset;
  [(PLManagedObject *)&v2 didSave];
}

- (id)duplicateAlbum
{
  v18 = *MEMORY[0x1E69E9840];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryServicesManager = [photoLibrary libraryServicesManager];

  if (libraryServicesManager)
  {
    v5 = [PLDuplicateProcessor isDuplicateProcessorEnabledForLibraryServicesManager:libraryServicesManager];
  }

  else
  {
    v5 = 1;
  }

  albums = [(PLManagedAsset *)self albums];

  v7 = 0;
  if (albums && v5)
  {
    v15 = 0u;
    v16 = 0u;
    v13 = 0u;
    v14 = 0u;
    albums2 = [(PLManagedAsset *)self albums];
    v7 = [albums2 countByEnumeratingWithState:&v13 objects:v17 count:16];
    if (v7)
    {
      v9 = *v14;
      while (2)
      {
        for (i = 0; i != v7; i = i + 1)
        {
          if (*v14 != v9)
          {
            objc_enumerationMutation(albums2);
          }

          v11 = *(*(&v13 + 1) + 8 * i);
          if ([v11 isDuplicateAlbum])
          {
            v7 = v11;
            goto LABEL_16;
          }
        }

        v7 = [albums2 countByEnumeratingWithState:&v13 objects:v17 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }

LABEL_16:
  }

  return v7;
}

- (void)removeFromDuplicateAlbum
{
  duplicateAlbum = [(PLManagedAsset *)self duplicateAlbum];
  if (duplicateAlbum)
  {
    v5 = duplicateAlbum;
    [(PLManagedAsset *)self setDuplicateAssetVisibilityState:0];
    mutableAssets = [v5 mutableAssets];
    [mutableAssets removeObject:self];

    duplicateAlbum = v5;
  }
}

- (void)_resetAllMediaProcessingVersionsIncludingVideo:(BOOL)video
{
  videoCopy = video;
  for (i = 0; i != 8; ++i)
  {
    v6 = qword_19C60B768[i];
    if (v6 > 0x14)
    {
      continue;
    }

    if (((1 << v6) & 0x19140C) != 0)
    {
      v7 = 1;
LABEL_5:
      PLResetMediaProcessingStateOnAsset(v6, self, v7);
      continue;
    }

    if (v6 == 1)
    {
      if (videoCopy)
      {
        v7 = 75841;
        goto LABEL_5;
      }
    }

    else if (v6 == 17)
    {
      v7 = 5121;
      goto LABEL_5;
    }
  }
}

- (void)_resetMediaAnalysisStateOnEditIncludingVideo:(BOOL)video
{
  videoCopy = video;
  [(PLManagedAsset *)self _clearOverallAestheticScore];
  [(PLManagedAsset *)self _deleteComputedAttributes];
  [(PLManagedAsset *)self _clearPreferredCropRect];
  [(PLManagedAsset *)self _clearAcceptableCropRect];
  [(PLManagedAsset *)self removeAllStillFrameSceneClassifications];
  [(PLManagedAsset *)self _reloadWidgetTimelineIfNeeded];
  [(PLManagedAsset *)self removeFromDuplicateAlbum];
  [(PLManagedAsset *)self _clearStickerConfidenceAttributes];
  [(PLManagedAsset *)self _resetAllMediaProcessingVersionsIncludingVideo:videoCopy];
  if (videoCopy)
  {
    [(PLManagedAsset *)self removeAllTemporalSceneClassifications];

    [(PLManagedAsset *)self deleteContextualVideoThumbnailFilesWithError:0];
  }
}

- (void)_duplicateProcessingChanges:(id)changes
{
  changesCopy = changes;
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryServicesManager = [photoLibrary libraryServicesManager];
  v6 = [PLDuplicateProcessor isDuplicateProcessorEnabledForLibraryServicesManager:libraryServicesManager];

  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = [changesCopy objectForKeyedSubscript:@"hidden"];

    v9 = [changesCopy objectForKeyedSubscript:@"trashedState"];

    v10 = [changesCopy objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

    if (v8)
    {
      if (([(PLManagedAsset *)self hidden]& 1) != 0)
      {
        goto LABEL_8;
      }

      if (!v9)
      {
        goto LABEL_10;
      }
    }

    else if (!v9)
    {
LABEL_11:
      if (v10)
      {
        [(PLManagedAsset *)self removeFromDuplicateAlbum];
LABEL_15:
        v11 = 1;
        goto LABEL_19;
      }

      if ([PLDuplicateAsset isDuplicateAssetSortChangedObject:self])
      {
        duplicateAlbum = [(PLManagedAsset *)self duplicateAlbum];
        [duplicateAlbum sortAssets];
      }

LABEL_18:
      v11 = 0;
LABEL_19:
      v13 = [changesCopy objectForKeyedSubscript:@"kindSubtype"];

      if (v13)
      {
        kindSubtype = [(PLManagedAsset *)self kindSubtype];
        v13 = 4 * (kindSubtype != 10);
        v15 = 4 * (kindSubtype == 10);
        v11 = 1;
      }

      else
      {
        v15 = 0;
      }

      v16 = [changesCopy objectForKeyedSubscript:@"kind"];

      if (v16)
      {
        if ([(PLManagedAsset *)self kind]== 1 || [(PLManagedAsset *)self kind]== 2)
        {
          v15 = v15 | 2;
        }

        else
        {
          v13 = v13 | 2;
        }

        v11 = 1;
      }

      v17 = [changesCopy objectForKeyedSubscript:@"playbackStyle"];

      if (v17)
      {
        playbackStyle = [(PLManagedAsset *)self playbackStyle];
        if (playbackStyle == 2)
        {
          v13 = v13;
        }

        else
        {
          v13 = v13 | 8;
        }

        if (playbackStyle == 2)
        {
          v15 = v15 | 8;
        }

        else
        {
          v15 = v15;
        }
      }

      else if (!v11)
      {
LABEL_39:
        objc_autoreleasePoolPop(v7);
        goto LABEL_40;
      }

      if (v15 | v13)
      {
        additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
        [additionalAttributes addDuplicateDetectorPerceptualProcessingStates:v15 removeProcessingStates:v13];
      }

      uuid = [(PLManagedAsset *)self uuid];
      photoLibrary2 = [(PLManagedObject *)self photoLibrary];
      [PLDuplicateProcessor signalDuplicateBackgroundJobItemForAssetUUID:uuid requiresMetadataProcessing:1 library:photoLibrary2];

      goto LABEL_39;
    }

    if (![(PLManagedAsset *)self isInTrash])
    {
LABEL_10:
      if (([(PLManagedAsset *)self hidden]& 1) == 0 && ![(PLManagedAsset *)self isInTrash]&& !v10)
      {
        goto LABEL_15;
      }

      goto LABEL_11;
    }

LABEL_8:
    if (!v10)
    {
      [(PLManagedAsset *)self removeFromDuplicateAlbum];
      goto LABEL_18;
    }

    goto LABEL_10;
  }

LABEL_40:
}

- (void)_recordAssetPersonEdgeAndSocialGroupContainmentUpdateIfNeededWithChangedValues:(id)values inContext:(id)context
{
  valuesCopy = values;
  contextCopy = context;
  v7 = [valuesCopy objectForKey:@"hidden"];
  if (v7 || ([valuesCopy objectForKey:@"trashedState"], (v7 = objc_claimAutoreleasedReturnValue()) != 0))
  {

LABEL_4:
    delayedSaveActions = [contextCopy delayedSaveActions];
    [delayedSaveActions recordAssetPersonEdgeUpdateNeededForAsset:self];

    delayedSaveActions2 = [contextCopy delayedSaveActions];
    [delayedSaveActions2 recordSocialGroupContainmentUpdateNeededForAsset:self];

    goto LABEL_5;
  }

  v10 = [valuesCopy objectForKey:@"visibilityState"];

  if (v10)
  {
    goto LABEL_4;
  }

LABEL_5:
}

- (void)willSave
{
  v198[1] = *MEMORY[0x1E69E9840];
  v192.receiver = self;
  v192.super_class = PLManagedAsset;
  [(PLManagedObject *)&v192 willSave];
  if ([(PLManagedAsset *)self isDeleted]&& ((PLIsAssetsd() & 1) != 0 || MEMORY[0x19EAEE520]()))
  {
    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    [PLGraphNode cleanupDanglingNodeReferencesToDeletedActorsInContext:managedObjectContext];
  }

  managedObjectContext2 = [(PLManagedAsset *)self managedObjectContext];
  userInfo = [managedObjectContext2 userInfo];
  v6 = [userInfo objectForKeyedSubscript:@"updatingAssetPersonEdgesKey"];

  changedValues = [(PLManagedAsset *)self changedValues];
  if ([changedValues count] || !v6)
  {
  }

  else
  {
    bOOLValue = [v6 BOOLValue];

    if (bOOLValue)
    {
      goto LABEL_214;
    }
  }

  managedObjectContext3 = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v190 = v6;
    userInfo2 = [managedObjectContext3 userInfo];
    v11 = [PLClientServerTransaction transactionFromUserInfo:userInfo2];

    if (v11)
    {
      [v11 pushChangeScopesBatch];
    }

    v189 = v11;
    changedValues2 = [(PLManagedAsset *)self changedValues];
    isSyncableChange = [(PLManagedAsset *)self isSyncableChange];
    v14 = [changedValues2 objectForKeyedSubscript:@"modificationDate"];

    if (!v14 && isSyncableChange)
    {
      date = [MEMORY[0x1E695DF00] date];
      [(PLManagedAsset *)self setModificationDate:date];
    }

    if (([(PLManagedAsset *)self isDeleted]& 1) != 0)
    {
      goto LABEL_105;
    }

    v16 = [changedValues2 objectForKeyedSubscript:@"libraryScope"];
    if (v16)
    {
      v17 = v16;
      v18 = [changedValues2 objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

      if (!v18)
      {
        v19 = PLBackendGetLog();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_FAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_FAULT, "[PLManagedAsset willSave] detected a change with changedValues[libraryScope] but no corresponding change to activeLibraryScopeParticipationState.", buf, 2u);
        }

        libraryScope = [(PLManagedAsset *)self libraryScope];
        v21 = [PLLibraryScope participationStateFromLibraryScope:libraryScope];

        v22 = [MEMORY[0x1E696AD98] numberWithShort:v21];
        [(PLManagedObject *)self pl_safeSetValue:v22 forKey:@"activeLibraryScopeParticipationState" valueDidChangeHandler:0];
      }
    }

    if ([(PLManagedAsset *)self isPhoto])
    {
      if ([(PLManagedAsset *)self isInserted]&& [(PLManagedAsset *)self isCloudSharedAsset]&& [(PLManagedAsset *)self visibilityState]!= 2)
      {
        [(PLManagedAsset *)self setVisibilityState:2];
      }

      v23 = [changedValues2 objectForKeyedSubscript:@"avalanchePickType"];
      if (v23)
      {
        v186 = 1;
      }

      else
      {
        v24 = [changedValues2 objectForKeyedSubscript:@"avalancheUUID"];
        v186 = v24 != 0;
      }
    }

    else
    {
      v186 = 0;
    }

    v25 = [changedValues2 objectForKeyedSubscript:@"dateCreated"];
    if (v25)
    {
      v26 = v25;
      v27 = [changedValues2 objectForKeyedSubscript:@"sortToken"];

      if (!v27)
      {
        dateCreated = [(PLManagedAsset *)self dateCreated];
        [dateCreated timeIntervalSinceReferenceDate];
        v30 = v29;

        [(PLManagedAsset *)self sortToken];
        if (vabdd_f64(v31, v30) > 2.22044605e-16)
        {
          [(PLManagedAsset *)self setSortToken:v30];
        }
      }
    }

    v32 = [changedValues2 objectForKeyedSubscript:@"hidden"];

    v33 = [changedValues2 objectForKeyedSubscript:@"favorite"];

    v34 = [changedValues2 objectForKeyedSubscript:@"trashedState"];

    v183 = [changedValues2 objectForKeyedSubscript:@"deferredProcessingNeeded"];

    v35 = [changedValues2 objectForKeyedSubscript:@"addedDate"];

    if ([(PLManagedAsset *)self isCloudSharedAsset])
    {
      v185 = 0;
    }

    else
    {
      v36 = [changedValues2 objectForKeyedSubscript:@"cloudAssetGUID"];
      v185 = v36 != 0;
    }

    v37 = [changedValues2 objectForKeyedSubscript:@"mediaGroupUUID"];

    v38 = [changedValues2 objectForKeyedSubscript:@"videoCpDurationValue"];
    if (v38)
    {
      v184 = 1;
    }

    else
    {
      v39 = v35;
      v40 = v37;
      v41 = [changedValues2 objectForKeyedSubscript:@"additionalAttributes.videoCpDurationTimescale"];
      if (v41)
      {
        v184 = 1;
      }

      else
      {
        v42 = [changedValues2 objectForKeyedSubscript:@"additionalAttributes.videoCpDisplayValue"];
        if (v42)
        {
          v184 = 1;
        }

        else
        {
          v43 = [changedValues2 objectForKeyedSubscript:@"additionalAttributes.videoCpDisplayTimescale"];
          v184 = v43 != 0;

          v42 = 0;
        }
      }

      v37 = v40;
      v35 = v39;
    }

    v44 = [changedValues2 objectForKeyedSubscript:@"videoCpVisibilityState"];

    v182 = [changedValues2 objectForKeyedSubscript:@"libraryScopeShareState"];

    v45 = [changedValues2 objectForKeyedSubscript:@"trashedReason"];

    [(PLManagedAsset *)self _recordAssetPersonEdgeAndSocialGroupContainmentUpdateIfNeededWithChangedValues:changedValues2 inContext:managedObjectContext3];
    if (v32)
    {
      v46 = 1;
    }

    else
    {
      v46 = v186;
    }

    if ((v46 & 1) == 0 && !v33 && !v34 && !self->_setCustomCreationDate && !self->_setCustomLocation && v35 == 0 && !v185 && v37 == 0 && !v184 && !v44 && !v183 && !v182 && !v45)
    {
LABEL_97:
      [(PLManagedAsset *)self _duplicateProcessingChanges:changedValues2];
      if (([(PLManagedAsset *)self isInserted]& 1) == 0)
      {
        v66 = [changedValues2 objectForKeyedSubscript:@"complete"];
        if (v66 || ([changedValues2 objectForKeyedSubscript:@"deferredProcessingNeeded"], (v66 = objc_claimAutoreleasedReturnValue()) != 0))
        {
        }

        else
        {
          v101 = [changedValues2 objectForKeyedSubscript:@"adjustmentTimestamp"];

          if (!v101)
          {
            goto LABEL_105;
          }
        }
      }

      uuid = [(PLManagedAsset *)self uuid];
      if (uuid)
      {
        v68 = uuid;
        photoLibrary = [(PLManagedObject *)self photoLibrary];
        libraryServicesManager = [photoLibrary libraryServicesManager];
        isCloudPhotoLibraryEnabled = [libraryServicesManager isCloudPhotoLibraryEnabled];

        if ((isCloudPhotoLibraryEnabled & 1) == 0)
        {
          photoLibrary2 = [(PLManagedObject *)self photoLibrary];
          uuid2 = [(PLManagedAsset *)self uuid];
          v74 = [photoLibrary2 addBackgroundJobWorkItemIfNeededWithIdentifier:uuid2 jobType:8 jobFlags:0];

          if (v74)
          {
            photoLibrary3 = [(PLManagedObject *)self photoLibrary];
            libraryServicesManager2 = [photoLibrary3 libraryServicesManager];
            backgroundJobService = [libraryServicesManager2 backgroundJobService];
            photoLibrary4 = [(PLManagedObject *)self photoLibrary];
            v79 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:8];
            [backgroundJobService signalBackgroundProcessingNeededOnLibrary:photoLibrary4 workerTypes:v79];
          }
        }
      }

LABEL_105:
      if (([(PLManagedAsset *)self isInserted]& 1) != 0 || [(PLManagedAsset *)self isDeleted])
      {
        delayedSaveActions = [managedObjectContext3 delayedSaveActions];
        [delayedSaveActions recordBackgroundUploadEvent];
      }

      v81 = [changedValues2 objectForKeyedSubscript:@"savedAssetType"];

      if (v81)
      {
        v198[0] = @"savedAssetType";
        v82 = [MEMORY[0x1E695DEC8] arrayWithObjects:v198 count:1];
        v83 = [(PLManagedAsset *)self committedValuesForKeys:v82];

        v84 = [v83 objectForKeyedSubscript:@"savedAssetType"];
        shortValue = [v84 shortValue];

        v86 = [changedValues2 objectForKeyedSubscript:@"savedAssetType"];
        shortValue2 = [v86 shortValue];

        if (([MEMORY[0x1E69BF328] allowSavedAssetTypeMutationFrom:shortValue to:shortValue2] & 1) == 0)
        {
          photoLibrary5 = [(PLManagedObject *)self photoLibrary];
          isUnitTesting = [photoLibrary5 isUnitTesting];

          if ((isUnitTesting & 1) == 0)
          {
            v90 = PLBackendGetLog();
            if (os_log_type_enabled(v90, OS_LOG_TYPE_FAULT))
            {
              uuid3 = [(PLManagedAsset *)self uuid];
              *buf = 138543874;
              v195 = uuid3;
              v196 = 1024;
              *v197 = shortValue;
              *&v197[4] = 1024;
              *&v197[6] = shortValue2;
              _os_log_impl(&dword_19BF1F000, v90, OS_LOG_TYPE_FAULT, "Attempting to modify the saved asset type is not permitted for asset %{public}@. From: %d to: %d", buf, 0x18u);
            }
          }
        }
      }

      v92 = [changedValues2 objectForKeyedSubscript:@"videoKeyFrameValue"];

      if (v92)
      {
        [(PLManagedAsset *)self resetKeyFaceOnVideoKeyFrameChange];
        v93 = [changedValues2 objectForKeyedSubscript:@"modificationDate"];

        if (!v93)
        {
          date2 = [MEMORY[0x1E695DF00] date];
          [(PLManagedAsset *)self setModificationDate:date2];
        }

        if ([(PLManagedAsset *)self isVideo]&& ![(PLManagedAsset *)self isCloudSharedAsset])
        {
          [(PLManagedAsset *)self videoKeyFrameTime];
          if ((v191 & 0x1D) == 1)
          {
            localVideoKeyFrameResource = [(PLManagedAsset *)self localVideoKeyFrameResource];

            if (localVideoKeyFrameResource)
            {
              v96 = PLBackendGetLog();
              if (os_log_type_enabled(v96, OS_LOG_TYPE_DEBUG))
              {
                uuid4 = [(PLManagedAsset *)self uuid];
                *buf = 138543362;
                v195 = uuid4;
                _os_log_impl(&dword_19BF1F000, v96, OS_LOG_TYPE_DEBUG, "Pruning local video key frame due to media analysis key frame time change change for asset: %{public}@", buf, 0xCu);
              }

              [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
            }

            else
            {
              v102 = [PLResourceInstaller onDemand_installLocalVideoKeyFrameForAsset:self];
            }
          }

          else
          {
            v98 = PLBackendGetLog();
            if (os_log_type_enabled(v98, OS_LOG_TYPE_DEBUG))
            {
              uuid5 = [(PLManagedAsset *)self uuid];
              *buf = 138543362;
              v195 = uuid5;
              _os_log_impl(&dword_19BF1F000, v98, OS_LOG_TYPE_DEBUG, "Pruning and deleting local key frame resource due to media analysis key frame time invalidated for asset: %{public}@", buf, 0xCu);
            }

            [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
            localVideoKeyFrameResource2 = [(PLManagedAsset *)self localVideoKeyFrameResource];
            [localVideoKeyFrameResource2 deleteResource];
          }
        }

        [(PLManagedAsset *)self _resetMediaAnalysisStateOnEditIncludingVideo:0];
      }

      if ([(PLManagedAsset *)self _hasBecomeNonVisibleToMemoriesAndPersonsAndSuggestions:changedValues2]&& ![(PLManagedAsset *)self isCloudSharedAsset]&& ![(PLManagedAsset *)self isPlaceholderAsset])
      {
        [(PLManagedAsset *)self fixupMemoriesWithMissingKeyAsset];
        [(PLManagedAsset *)self removeAssetFromRelatedSuggestionsAndFixupSuggestions];
      }

      v103 = [changedValues2 objectForKeyedSubscript:@"favorite"];
      if (v103)
      {
      }

      else
      {
        v104 = [changedValues2 objectForKeyedSubscript:@"albums"];

        if (!v104)
        {
          goto LABEL_141;
        }
      }

      [(PLManagedAsset *)self removeAssetFromUserAlbumSuggestionIfNeededWithChangedValues:changedValues2];
      v105 = [changedValues2 objectForKeyedSubscript:@"albums"];

      if (v105)
      {
        [(PLManagedAsset *)self _updateAlbumAssociationIfNeededWithChangedValues:changedValues2];
      }

LABEL_141:
      v106 = [changedValues2 objectForKeyedSubscript:@"trashedState"];
      if (v106 || ([changedValues2 objectForKeyedSubscript:@"hidden"], (v106 = objc_claimAutoreleasedReturnValue()) != 0))
      {
      }

      else
      {
        v169 = [changedValues2 objectForKeyedSubscript:@"dateCreated"];

        if (!v169)
        {
LABEL_145:
          v109 = [changedValues2 objectForKeyedSubscript:@"detectedFaces"];

          if (v109)
          {
            [(PLManagedAsset *)self revalidateFaceAreaPoints];
          }

          v110 = [changedValues2 objectForKeyedSubscript:@"trashedState"];
          if (v110)
          {
            v111 = v110;
            trashedState = [(PLManagedAsset *)self trashedState];

            if (trashedState == 2)
            {
              delayedSaveActions2 = [managedObjectContext3 delayedSaveActions];
              [delayedSaveActions2 recordAssetForDuetDelete:self];
            }
          }

          v114 = [changedValues2 objectForKey:@"modernResources"];
          v115 = [changedValues2 objectForKeyedSubscript:@"deferredProcessingNeeded"];

          v116 = v115 | v114;
          v117 = [changedValues2 objectForKeyedSubscript:@"additionalAttributes.originalResourceChoice"];

          v118 = (v117 | v114) != 0;
          if (v116)
          {
            [(PLManagedAsset *)self recalculateImageRequestHints];
          }

          if (v118)
          {
            [(PLManagedAsset *)self recalculateRAWBadgeAttribute];
          }

          v119 = [changedValues2 objectForKeyedSubscript:@"adjustmentTimestamp"];

          if (v119)
          {
            [(PLManagedAsset *)self _resetMediaAnalysisStateOnEditIncludingVideo:1];
            additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
            hasDuplicateMatchingData = [additionalAttributes hasDuplicateMatchingData];

            if (hasDuplicateMatchingData)
            {
              additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
              [additionalAttributes2 setDuplicateMatchingData:0 duplicateMatchingAlternateData:0 processingSucceeded:1];
            }

            if (![(PLManagedAsset *)self isValidForPerceptualProcessing])
            {
              uuid6 = [(PLManagedAsset *)self uuid];
              photoLibrary6 = [(PLManagedObject *)self photoLibrary];
              [PLDuplicateProcessor signalDuplicateBackgroundJobItemForAssetUUID:uuid6 requiresMetadataProcessing:1 library:photoLibrary6];
            }
          }

          if (([(PLManagedAsset *)self isDeleted]& 1) == 0)
          {
            mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];

            if (!mediaAnalysisAttributes)
            {
              v126 = PLBackendGetLog();
              if (os_log_type_enabled(v126, OS_LOG_TYPE_FAULT))
              {
                pl_shortDescription = [(NSManagedObject *)self pl_shortDescription];
                *buf = 138412290;
                v195 = pl_shortDescription;
                _os_log_impl(&dword_19BF1F000, v126, OS_LOG_TYPE_FAULT, "mediaAnalysisAttributes is unexpectedly nil: %@", buf, 0xCu);
              }
            }
          }

          v128 = [changedValues2 objectForKeyedSubscript:@"mediaAnalysisAttributes"];

          if (v128)
          {
            v129 = PLBackendGetLog();
            if (os_log_type_enabled(v129, OS_LOG_TYPE_DEBUG))
            {
              *buf = 0;
              _os_log_impl(&dword_19BF1F000, v129, OS_LOG_TYPE_DEBUG, "Pruning local video key frame due to media analysis attributes relationship change", buf, 2u);
            }

            [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
          }

          [(PLManagedAsset *)self ensurePlaybackStyleConsistencyWithKindSubtype:changedValues2];
          photoLibrary7 = [(PLManagedObject *)self photoLibrary];
          libraryServicesManager3 = [photoLibrary7 libraryServicesManager];

          if ([libraryServicesManager3 wellKnownPhotoLibraryIdentifier] == 3 && (-[PLManagedAsset isDeleted](self, "isDeleted") & 1) == 0)
          {
            v132 = v114;
            v193[0] = @"savedAssetType";
            v193[1] = @"syndicationState";
            v133 = [MEMORY[0x1E695DEC8] arrayWithObjects:v193 count:2];
            v134 = [(PLManagedAsset *)self committedValuesForKeys:v133];

            v135 = objc_opt_class();
            v136 = [v134 objectForKeyedSubscript:@"savedAssetType"];
            integerValue = [v136 integerValue];
            v138 = [v134 objectForKeyedSubscript:@"syndicationState"];
            LODWORD(v135) = [v135 shouldSyncAssetToSPLWithSavedAssetType:integerValue syndicationState:{objc_msgSend(v138, "integerValue")}];

            if (v135 != [(PLManagedAsset *)self shouldSyncToSPL])
            {
              photoLibrary8 = [(PLManagedObject *)self photoLibrary];
              uuid7 = [(PLManagedAsset *)self uuid];
              v141 = [photoLibrary8 addBackgroundJobWorkItemIfNeededWithIdentifier:uuid7 jobType:0 jobFlags:1];

              if (v141)
              {
                v142 = PLSyndicationGetLog();
                if (os_log_type_enabled(v142, OS_LOG_TYPE_DEBUG))
                {
                  uuid8 = [(PLManagedAsset *)self uuid];
                  shouldSyncToSPL = [(PLManagedAsset *)self shouldSyncToSPL];
                  v145 = @"should not";
                  if (shouldSyncToSPL)
                  {
                    v145 = @"should";
                  }

                  *buf = 138412546;
                  v195 = uuid8;
                  v196 = 2112;
                  *v197 = v145;
                  _os_log_impl(&dword_19BF1F000, v142, OS_LOG_TYPE_DEBUG, "GuestAssetSync: property changes to asset: %@ indicate %@ sync to SPL, triggering update", buf, 0x16u);
                }

                backgroundJobService2 = [libraryServicesManager3 backgroundJobService];
                photoLibrary9 = [(PLManagedObject *)self photoLibrary];
                v148 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:0];
                [backgroundJobService2 signalBackgroundProcessingNeededOnLibrary:photoLibrary9 workerTypes:v148];
              }
            }

            v114 = v132;
          }

          if ([(PLManagedAsset *)self shouldPurgeSyndicationResourcesWithChangedValues:changedValues2])
          {
            [(PLManagedAsset *)self purgeSyndicationResourcesAfterMediaAnalysisProcessing];
          }

          if (PLPlatformMomentsSupported())
          {
            delayedSaveActions3 = [managedObjectContext3 delayedSaveActions];
            [delayedSaveActions3 recordAssetForMomentUpdate:self];
          }

          if (PLPlatformCloudFeedSupported())
          {
            delayedSaveActions4 = [managedObjectContext3 delayedSaveActions];
            [delayedSaveActions4 recordAssetForCloudFeedUpdate:self];
          }

          if (([(PLManagedAsset *)self isDeleted]& 1) == 0)
          {
            [PLDelayedSearchIndexUpdates recordAssetIfNeeded:self];
          }

          [managedObjectContext3 recordAvalancheUUIDForUpdate:self];
          photoLibrary10 = [(PLManagedObject *)self photoLibrary];
          libraryServicesManager4 = [photoLibrary10 libraryServicesManager];
          modelMigrator = [libraryServicesManager4 modelMigrator];
          if ([modelMigrator isPostProcessingLightweightMigration])
          {
          }

          else
          {
            v154 = managedObjectContext3;
            v155 = libraryServicesManager3;
            v156 = v114;
            photoLibrary11 = [(PLManagedObject *)self photoLibrary];
            thumbnailManager = [photoLibrary11 thumbnailManager];
            if (([thumbnailManager isRebuildingThumbnails] & 1) != 0 || !PLCameraPreviewWellSupportedOnCurrentDevice())
            {

              v114 = v156;
              libraryServicesManager3 = v155;
              managedObjectContext3 = v154;
            }

            else
            {
              isInserted = [(PLManagedAsset *)self isInserted];

              v114 = v156;
              libraryServicesManager3 = v155;
              managedObjectContext3 = v154;
              if (isInserted & 1) != 0 || ([v154 userInfo], v159 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v159, "objectForKeyedSubscript:", @"com.apple.photos.PLCameraPreviewWellNeedsUpdate"), v160 = objc_claimAutoreleasedReturnValue(), v161 = objc_msgSend(v160, "BOOLValue"), v160, v159, (v161) || (-[PLManagedObject photoLibrary](self, "photoLibrary"), v162 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v162, "libraryServicesManager"), v163 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v163, "cameraPreviewWellManager"), v164 = objc_claimAutoreleasedReturnValue(), v165 = objc_msgSend(v164, "shouldReconsiderCameraPreviewWellImageForUpdatedAsset:thumbnailWasGenerated:", self, 0), v164, v163, v162, !v165))
              {
LABEL_196:
                if (_os_feature_enabled_impl())
                {
                  if (([(PLManagedAsset *)self isDeleted]& 1) == 0)
                  {
                    if (PLPlatformMomentsSupported())
                    {
                      highlightBeingExtendedAssets = [(PLManagedAsset *)self highlightBeingExtendedAssets];
                      if (highlightBeingExtendedAssets)
                      {
                        v167 = highlightBeingExtendedAssets;
                        v168 = [changedValues2 objectForKeyedSubscript:@"dateCreated"];
                        if (v168)
                        {

                          goto LABEL_205;
                        }

                        v170 = [changedValues2 objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

                        if (v170)
                        {
LABEL_205:
                          highlightBeingExtendedAssets2 = [(PLManagedAsset *)self highlightBeingExtendedAssets];
                          kind = [highlightBeingExtendedAssets2 kind];

                          if (!kind)
                          {
                            highlightBeingExtendedAssets3 = [(PLManagedAsset *)self highlightBeingExtendedAssets];
                            [highlightBeingExtendedAssets3 recalculateCollageAssets];
                          }
                        }
                      }
                    }
                  }
                }

                v174 = [changedValues2 objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

                if (v174)
                {
                  photoLibrary12 = [(PLManagedObject *)self photoLibrary];
                  uuid9 = [(PLManagedAsset *)self uuid];
                  v177 = [photoLibrary12 addBackgroundJobWorkItemIfNeededWithIdentifier:uuid9 jobType:9 jobFlags:1];

                  if (v177)
                  {
                    photoLibrary13 = [(PLManagedObject *)self photoLibrary];
                    v179 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:9];
                    [photoLibrary13 signalBackgroundProcessingNeededForWorkerTypes:v179];
                  }
                }

                if (v189)
                {
                  [v189 popChangeScopesBatch];
                }

                v6 = v190;
                goto LABEL_213;
              }

              photoLibrary10 = [managedObjectContext3 userInfo];
              [photoLibrary10 setObject:MEMORY[0x1E695E118] forKeyedSubscript:@"com.apple.photos.PLCameraPreviewWellNeedsUpdate"];
            }
          }

          goto LABEL_196;
        }
      }

      delayedSaveActions5 = [managedObjectContext3 delayedSaveActions];
      [delayedSaveActions5 recordAssetForAlbumCountsDateRangeAndKeyAssetsUpdate:self];

      delayedSaveActions6 = [managedObjectContext3 delayedSaveActions];
      [delayedSaveActions6 recordAssetForImportSessionCountsAndDateRangeUpdate:self];

      goto LABEL_145;
    }

    v181 = v45;
    persistedFileSystemAttributesFileURL = [(PLManagedAsset *)self persistedFileSystemAttributesFileURL];
    if (!persistedFileSystemAttributesFileURL || ![(PLManagedAsset *)self isValidTypeForPersistence])
    {
LABEL_96:

      goto LABEL_97;
    }

    v180 = v37;
    v48 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:persistedFileSystemAttributesFileURL];
    if (v186)
    {
      avalancheKind = [(PLManagedAsset *)self avalancheKind];
      if (avalancheKind < 2)
      {
        avalancheUUID = [(PLManagedAsset *)self avalancheUUID];
        [v48 setUUIDString:avalancheUUID forKey:*MEMORY[0x1E69BFD20]];

        avalanchePickType = [(PLManagedAsset *)self avalanchePickType];
LABEL_68:
        [v48 setUInt16:avalanchePickType forKey:*MEMORY[0x1E69BFD18]];
        goto LABEL_69;
      }

      if (avalancheKind == 2)
      {
        avalanchePickType = 0;
        goto LABEL_68;
      }
    }

LABEL_69:
    if (v32)
    {
      hidden = [(PLManagedAsset *)self hidden];
      [v48 setUInt16:hidden forKey:*MEMORY[0x1E69BFD88]];
    }

    if (v33)
    {
      favorite = [(PLManagedAsset *)self favorite];
      [v48 setUInt16:favorite forKey:*MEMORY[0x1E69BFD80]];
    }

    if (v34)
    {
      isInTrash = [(PLManagedAsset *)self isInTrash];
      [v48 setUInt16:isInTrash forKey:*MEMORY[0x1E69BFE58]];
    }

    if (v183)
    {
      deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
      [v48 setUInt16:deferredProcessingNeeded forKey:*MEMORY[0x1E69BFD60]];
    }

    if (self->_setCustomCreationDate)
    {
      [(PLManagedAsset *)self dateCreatedData];
      v56 = v55 = v35;
      [v48 setData:v56 forKey:*MEMORY[0x1E69BFD40]];

      v35 = v55;
    }

    if (self->_setCustomLocation)
    {
      [(PLManagedAsset *)self locationData];
      v58 = v57 = v35;
      [v48 setData:v58 forKey:*MEMORY[0x1E69BFD48]];

      v35 = v57;
    }

    if (v35)
    {
      addedDateData = [(PLManagedAsset *)self addedDateData];
      [v48 setData:addedDateData forKey:*MEMORY[0x1E69BFD08]];
    }

    if (v185)
    {
      cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
      [v48 setString:cloudAssetGUID forKey:*MEMORY[0x1E69BFD28]];
    }

    if (v180)
    {
      _mediaGroupUUIDForPersistence = [(PLManagedAsset *)self _mediaGroupUUIDForPersistence];
      [v48 setString:_mediaGroupUUIDForPersistence forKey:*MEMORY[0x1E69BFDE0]];
    }

    if (v184)
    {
      videoComplementData = [(PLManagedAsset *)self videoComplementData];
      [v48 setData:videoComplementData forKey:*MEMORY[0x1E69BFD78]];
    }

    if (v44)
    {
      videoCpVisibilityState = [(PLManagedAsset *)self videoCpVisibilityState];
      [v48 setUInt16:videoCpVisibilityState forKey:*MEMORY[0x1E69BFE70]];
    }

    if (v182)
    {
      libraryScopeShareState = [(PLManagedAsset *)self libraryScopeShareState];
      [v48 setUInt64:libraryScopeShareState forKey:*MEMORY[0x1E69BFDD8]];
    }

    if (v181)
    {
      trashedReason = [(PLManagedAsset *)self trashedReason];
      [v48 setUInt16:trashedReason forKey:*MEMORY[0x1E69BFE60]];
    }

    [v48 persist];

    goto LABEL_96;
  }

LABEL_213:

LABEL_214:
}

- (void)recalculateIsRecentlySaved
{
  v3 = [MEMORY[0x1E696AD98] numberWithShort:{-[PLManagedAsset importedBy](self, "importedBy")}];
  v4 = [&unk_1F0FBF448 containsObject:v3];

  importedByBundleIdentifier = [(PLManagedAsset *)self importedByBundleIdentifier];
  v6 = [importedByBundleIdentifier isEqualToString:@"com.apple.camera.CameraMessagesApp"];

  v7 = [MEMORY[0x1E696AD98] numberWithBool:((v6 | v4) & 1) == 0];
  [(PLManagedObject *)self pl_safeSetValue:v7 forKey:@"isRecentlySaved" valueDidChangeHandler:0];
}

- (void)recalculateIsDetectedScreenshot
{
  v21 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self kind]&& [(PLManagedAsset *)self kind]!= 1)
  {
    v15 = 0;
LABEL_28:
    v17 = [MEMORY[0x1E696AD98] numberWithBool:v15];
    [(PLManagedObject *)self pl_safeSetValue:v17 forKey:@"isDetectedScreenshot" valueDidChangeHandler:0];

    [(PLManagedAsset *)self setDetectedScreenshotBadgeAttribute:v15];
    return;
  }

  if (![(PLManagedAsset *)self kind])
  {
    if ([(PLManagedAsset *)self kindSubtype]!= 10)
    {
      goto LABEL_6;
    }

    goto LABEL_17;
  }

  if ([(PLManagedAsset *)self kind]== 1 && [(PLManagedAsset *)self kindSubtype]== 103)
  {
LABEL_17:
    v15 = 1;
    goto LABEL_28;
  }

LABEL_6:
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryServicesManager = [photoLibrary libraryServicesManager];

  v4 = libraryServicesManager;
  if (!libraryServicesManager || (v5 = [libraryServicesManager isSearchIndexingEnabled], v4 = libraryServicesManager, v5))
  {
    searchIndexingEngine = [v4 searchIndexingEngine];
    configuration = [searchIndexingEngine configuration];
    sceneTaxonomyProvider = [configuration sceneTaxonomyProvider];

    if (libraryServicesManager && !sceneTaxonomyProvider)
    {
      v9 = PLBackendGetLog();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_FAULT))
      {
        searchIndexingEngine2 = [libraryServicesManager searchIndexingEngine];
        *buf = 138543362;
        v20 = searchIndexingEngine2;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_FAULT, "configuration.sceneTaxonomyProvider nil on searchIndexingEngine: %{public}@", buf, 0xCu);
      }
    }

    v11 = [PLUtilityAsset utilityAssetFromManagedAsset:self usingPool:0];
    v12 = [sceneTaxonomyProvider searchIndexSceneTaxonomyForSceneAnalysisVersion:{objc_msgSend(v11, "sceneAnalysisVersion")}];
    v13 = objc_alloc(MEMORY[0x1E69C1A38]);
    if (v12)
    {
      v14 = [v13 initWithSceneTaxonomy:v12];
    }

    else
    {
      v14 = [v13 initWithSceneAnalysisVersion:{objc_msgSend(v11, "sceneAnalysisVersion")}];
    }

    v16 = v14;
    v15 = 0;
    if (v11 && v14)
    {
      if (objc_opt_class())
      {
        v15 = [MEMORY[0x1E69C1AC0] screenshotInferredInAsset:v11 usingSceneModel:v16];
      }

      else
      {
        v15 = 0;
      }
    }

    goto LABEL_28;
  }
}

- (BOOL)_checkForAndAddFrameDropRecoveryForPhotoKitIngest
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    return 0;
  }

  v4 = [(PLManagedAsset *)self importedBy]!= 1 && [(PLManagedAsset *)self importedBy]!= 2;
  v5 = [objc_alloc(MEMORY[0x1E695E000]) initWithSuiteName:@"com.apple.mobileslideshow"];
  v6 = [v5 BOOLForKey:@"PLFrameDropRecoveryEnableOnOlderDevices"];
  v3 = ((PLPlatformIsFrameDropRecoverySupported() & 1) != 0 || v6) && [(PLManagedAsset *)self videoDeferredProcessingNeeded]== 0 && !v4;

  return v3;
}

- (void)ensurePlaybackStyleConsistencyWithKindSubtype:(id)subtype
{
  v14[1] = *MEMORY[0x1E69E9840];
  v4 = [subtype objectForKeyedSubscript:@"kindSubtype"];

  if (v4)
  {
    v14[0] = @"kindSubtype";
    v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v14 count:1];
    v6 = [(PLManagedAsset *)self committedValuesForKeys:v5];

    v7 = [v6 objectForKey:@"kindSubtype"];
    shortValue = [v7 shortValue];

    if ([(PLManagedAsset *)self kindSubtype]|| shortValue != 2)
    {
      goto LABEL_12;
    }

    [(PLManagedObject *)self pl_safeSetValue:&unk_1F0FBB0C8 forKey:@"playbackStyle" valueDidChangeHandler:0];
    if (-[PLManagedAsset sensitivityAnalysisState](self, "sensitivityAnalysisState") == 2 && (-[PLManagedAsset collectionShareContributor](self, "collectionShareContributor"), (v9 = objc_claimAutoreleasedReturnValue()) != 0) && (v10 = v9, -[PLManagedAsset collectionShareContributor](self, "collectionShareContributor"), v11 = objc_claimAutoreleasedReturnValue(), v12 = [v11 isCurrentUser], v11, v10, (v12 & 1) != 0) || -[PLManagedAsset sensitivityAnalysisState](self, "sensitivityAnalysisState") == 3)
    {
      v13 = 1;
    }

    else
    {
      if ([(PLManagedAsset *)self sensitivityAnalysisState]!= 2)
      {
LABEL_12:

        return;
      }

      [(PLManagedAsset *)self setCompactSCSensitivityAnalysis:0];
      v13 = 0;
    }

    [(PLManagedAsset *)self setSensitivityAnalysisState:v13];
    goto LABEL_12;
  }
}

- (void)_reloadWidgetTimelineIfNeeded
{
  v41 = *MEMORY[0x1E69E9840];
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    suggestionsBeingKeyAssets = [(PLManagedAsset *)self suggestionsBeingKeyAssets];
    v5 = [suggestionsBeingKeyAssets copy];

    v6 = [v5 countByEnumeratingWithState:&v33 objects:v40 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v34;
LABEL_4:
      v9 = 0;
      while (1)
      {
        if (*v34 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v33 + 1) + 8 * v9);
        if ([v10 featuredState] == 1)
        {
          break;
        }

        if (v7 == ++v9)
        {
          v7 = [v5 countByEnumeratingWithState:&v33 objects:v40 count:16];
          if (v7)
          {
            goto LABEL_4;
          }

          goto LABEL_10;
        }
      }

      type = [v10 type];
      v11 = type != 6;
      if (type == 6)
      {
        delayedSaveActions = [managedObjectContext delayedSaveActions];
        uuid = [v10 uuid];
        [delayedSaveActions recordWallpaperSuggestionReloadForUUID:uuid];
        goto LABEL_16;
      }

      type2 = [v10 type];
      delayedSaveActions = PLBackendGetLog();
      v15 = os_log_type_enabled(delayedSaveActions, OS_LOG_TYPE_INFO);
      if (type2 == 7)
      {
        if (!v15)
        {
LABEL_17:

          goto LABEL_18;
        }

        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v39 = uuid;
        _os_log_impl(&dword_19BF1F000, delayedSaveActions, OS_LOG_TYPE_INFO, "Recording Album widget timeline invalidation due to asset with featured suggestion being adjusted %{public}@", buf, 0xCu);
LABEL_16:

        goto LABEL_17;
      }

      if (v15)
      {
        uuid2 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v39 = uuid2;
        _os_log_impl(&dword_19BF1F000, delayedSaveActions, OS_LOG_TYPE_INFO, "Recording ForYou widget timeline invalidation due to asset with featured suggestion being adjusted %{public}@", buf, 0xCu);
      }

      v26 = 0;
    }

    else
    {
LABEL_10:
      v11 = 0;
LABEL_18:

      v31 = 0u;
      v32 = 0u;
      v29 = 0u;
      v30 = 0u;
      memoriesBeingKeyAsset = [(PLManagedAsset *)self memoriesBeingKeyAsset];
      v18 = [memoriesBeingKeyAsset copy];

      v19 = [v18 countByEnumeratingWithState:&v29 objects:v37 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v30;
LABEL_20:
        v22 = 0;
        while (1)
        {
          if (*v30 != v21)
          {
            objc_enumerationMutation(v18);
          }

          if ([*(*(&v29 + 1) + 8 * v22) featuredState] == 1)
          {
            break;
          }

          if (v20 == ++v22)
          {
            v20 = [v18 countByEnumeratingWithState:&v29 objects:v37 count:16];
            if (v20)
            {
              goto LABEL_20;
            }

            goto LABEL_26;
          }
        }

        v23 = PLBackendGetLog();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          uuid3 = [(PLManagedAsset *)self uuid];
          *buf = 138543362;
          v39 = uuid3;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_INFO, "Recording ForYou widget timeline invalidation due to key asset with featured memory being adjusted %{public}@", buf, 0xCu);
        }

        delayedSaveActions2 = [managedObjectContext delayedSaveActions];
        [delayedSaveActions2 recordWidgetTimelineReloadNeededForType:0];

        if (!v11)
        {
          goto LABEL_36;
        }
      }

      else
      {
LABEL_26:

        if (!v11)
        {
          goto LABEL_36;
        }
      }

      v26 = 1;
    }

    delayedSaveActions3 = [managedObjectContext delayedSaveActions];
    [delayedSaveActions3 recordWidgetTimelineReloadNeededForType:v26];
  }

LABEL_36:
}

- (void)_clearStickerConfidenceAttributes
{
  mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
  [mediaAnalysisAttributes pl_safeSetValue:&unk_1F0FBB0B0 forKey:@"visualSearchStickerConfidenceVersion" valueDidChangeHandler:0];
  [(PLManagedObject *)self pl_safeSetValue:&unk_1F0FC0880 forKey:@"stickerConfidenceScore" valueDidChangeHandler:0];
}

- (void)_clearOverallAestheticScore
{
  [(PLManagedAsset *)self overallAestheticScore];
  if (*&v3 != 0.5)
  {
    LODWORD(v3) = 0.5;

    [(PLManagedAsset *)self setOverallAestheticScore:v3];
  }
}

- (void)_clearAcceptableCropRect
{
  if ([(PLManagedAsset *)self packedAcceptableCropRect])
  {

    [(PLManagedAsset *)self setPackedAcceptableCropRect:0];
  }
}

- (void)_clearPreferredCropRect
{
  if ([(PLManagedAsset *)self packedPreferredCropRect])
  {

    [(PLManagedAsset *)self setPackedPreferredCropRect:0];
  }
}

- (void)_deleteComputedAttributes
{
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  computedAttributes = [(PLManagedAsset *)self computedAttributes];

  if (computedAttributes)
  {
    computedAttributes2 = [(PLManagedAsset *)self computedAttributes];
    [managedObjectContext deleteObject:computedAttributes2];
  }
}

- (void)_updateAlbumAssociationIfNeeded
{
  v12 = *MEMORY[0x1E69E9840];
  v7 = 0u;
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  albums = [(PLManagedAsset *)self albums];
  v4 = [albums countByEnumeratingWithState:&v7 objects:v11 count:16];
  if (v4)
  {
    v5 = *v8;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v8 != v5)
        {
          objc_enumerationMutation(albums);
        }

        if ([*(*(&v7 + 1) + 8 * i) supportsAssetAssociativity])
        {
          v4 = 1;
          goto LABEL_11;
        }
      }

      v4 = [albums countByEnumeratingWithState:&v7 objects:v11 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  if ([(PLManagedAsset *)self albumAssociativity]!= v4)
  {
    [(PLManagedAsset *)self setAlbumAssociativity:v4];
  }
}

- (void)_updateAlbumAssociationIfNeededWithChangedValues:(id)values
{
  v4 = [values objectForKeyedSubscript:@"albumAssociativity"];

  if (!v4)
  {

    [(PLManagedAsset *)self _updateAlbumAssociationIfNeeded];
  }
}

- (void)removeAssetFromUserAlbumSuggestionIfNeededWithChangedValues:(id)values
{
  v38[1] = *MEMORY[0x1E69E9840];
  valuesCopy = values;
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [valuesCopy objectForKeyedSubscript:@"favorite"];
    if (v6)
    {
      v7 = v6;
      favorite = [(PLManagedAsset *)self favorite];

      if ((favorite & 1) == 0)
      {
        delayedSaveActions = [managedObjectContext delayedSaveActions];
        objectID = [(PLManagedAsset *)self objectID];
        [delayedSaveActions recordAssetIDForWidgetFavoriteAlbumRemoval:objectID];

        delayedSaveActions2 = [managedObjectContext delayedSaveActions];
        objectID2 = [(PLManagedAsset *)self objectID];
        [delayedSaveActions2 recordAssetIDForWallpaperFavoriteAlbumRemoval:objectID2];
      }
    }

    v13 = [valuesCopy objectForKeyedSubscript:@"albums"];

    if (v13)
    {
      v38[0] = @"albums";
      v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v38 count:1];
      v15 = [(PLManagedAsset *)self committedValuesForKeys:v14];

      v16 = [v15 objectForKey:@"albums"];
      albums = [(PLManagedAsset *)self albums];
      v18 = [v16 mutableCopy];
      [v18 minusSet:albums];
      if ([v18 count])
      {
        v30 = albums;
        v31 = v16;
        v32 = v15;
        v35 = 0u;
        v36 = 0u;
        v33 = 0u;
        v34 = 0u;
        v29 = v18;
        v19 = v18;
        v20 = [v19 countByEnumeratingWithState:&v33 objects:v37 count:16];
        if (v20)
        {
          v21 = v20;
          v22 = *v34;
          do
          {
            for (i = 0; i != v21; ++i)
            {
              if (*v34 != v22)
              {
                objc_enumerationMutation(v19);
              }

              v24 = *(*(&v33 + 1) + 8 * i);
              if (([v24 isDeleted] & 1) == 0)
              {
                delayedSaveActions3 = [managedObjectContext delayedSaveActions];
                objectID3 = [(PLManagedAsset *)self objectID];
                [delayedSaveActions3 recordAssetID:objectID3 forWidgetUserAlbumRemoval:v24];

                delayedSaveActions4 = [managedObjectContext delayedSaveActions];
                objectID4 = [(PLManagedAsset *)self objectID];
                [delayedSaveActions4 recordAssetID:objectID4 forWallpaperUserAlbumRemoval:v24];
              }
            }

            v21 = [v19 countByEnumeratingWithState:&v33 objects:v37 count:16];
          }

          while (v21);
        }

        v16 = v31;
        v15 = v32;
        v18 = v29;
        albums = v30;
      }
    }
  }
}

- (void)_removeKeyAssetFromSuggestions:(id)suggestions
{
  v31 = *MEMORY[0x1E69E9840];
  suggestionsCopy = suggestions;
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_31;
  }

  v26 = 0u;
  v27 = 0u;
  v24 = 0u;
  v25 = 0u;
  delayedSaveActions3 = [suggestionsCopy copy];
  v7 = [delayedSaveActions3 countByEnumeratingWithState:&v24 objects:v30 count:16];
  if (!v7)
  {
    goto LABEL_30;
  }

  v8 = v7;
  v22 = suggestionsCopy;
  v23 = 0;
  v9 = *v25;
  do
  {
    for (i = 0; i != v8; ++i)
    {
      if (*v25 != v9)
      {
        objc_enumerationMutation(delayedSaveActions3);
      }

      v11 = *(*(&v24 + 1) + 8 * i);
      [v11 replaceKeyAsset:self];
      if ([v11 isEmpty])
      {
        v12 = PLBackendGetLog();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v29 = v11;
          _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_INFO, "Deleting suggestion %@ due to it containing no more assets", buf, 0xCu);
        }

        [managedObjectContext deleteObject:v11];
      }

      else
      {
        photoLibrary = [managedObjectContext photoLibrary];
        [v11 updateCachedCounts:photoLibrary];
      }

      if ([v11 featuredState] == 1)
      {
        if ([v11 type] == 6)
        {
          delayedSaveActions = [managedObjectContext delayedSaveActions];
          uuid = [v11 uuid];
          [delayedSaveActions recordWallpaperSuggestionReloadForUUID:uuid];
        }

        else
        {
          type = [v11 type];
          delayedSaveActions = PLBackendGetLog();
          v17 = os_log_type_enabled(delayedSaveActions, OS_LOG_TYPE_INFO);
          if (type == 7)
          {
            if (!v17)
            {
              BYTE4(v23) = 1;
              goto LABEL_23;
            }

            uuid2 = [v11 uuid];
            *buf = 138543362;
            v29 = uuid2;
            BYTE4(v23) = 1;
            v19 = delayedSaveActions;
            v20 = "Recording Album widget timeline invalidation due to featured suggestion's %{public}@ key asset being removed";
          }

          else
          {
            if (!v17)
            {
              LOBYTE(v23) = 1;
              goto LABEL_23;
            }

            uuid2 = [v11 uuid];
            *buf = 138543362;
            v29 = uuid2;
            LOBYTE(v23) = 1;
            v19 = delayedSaveActions;
            v20 = "Recording ForYou widget timeline invalidation due to featured suggestion's %{public}@ key asset being removed";
          }

          _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_INFO, v20, buf, 0xCu);
        }

LABEL_23:

        continue;
      }
    }

    v8 = [delayedSaveActions3 countByEnumeratingWithState:&v24 objects:v30 count:16];
  }

  while (v8);

  if (v23)
  {
    delayedSaveActions2 = [managedObjectContext delayedSaveActions];
    [delayedSaveActions2 recordWidgetTimelineReloadNeededForType:0];
  }

  suggestionsCopy = v22;
  if ((v23 & 0x100000000) != 0)
  {
    delayedSaveActions3 = [managedObjectContext delayedSaveActions];
    [delayedSaveActions3 recordWidgetTimelineReloadNeededForType:1];
LABEL_30:
  }

LABEL_31:
}

- (void)removeAssetFromRelatedSuggestionsAndFixupSuggestions
{
  v19 = *MEMORY[0x1E69E9840];
  v3 = objc_autoreleasePoolPush();
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v16 = 0u;
    v17 = 0u;
    v14 = 0u;
    v15 = 0u;
    suggestionsBeingRepresentativeAssets = [(PLManagedAsset *)self suggestionsBeingRepresentativeAssets];
    v6 = [suggestionsBeingRepresentativeAssets copy];

    v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v15;
      do
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v15 != v9)
          {
            objc_enumerationMutation(v6);
          }

          v11 = *(*(&v14 + 1) + 8 * i);
          [v11 removeRepresentativeAsset:self];
          photoLibrary = [managedObjectContext photoLibrary];
          [v11 updateCachedCounts:photoLibrary];
        }

        v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
      }

      while (v8);
    }

    suggestionsBeingKeyAssets = [(PLManagedAsset *)self suggestionsBeingKeyAssets];
    [(PLManagedAsset *)self _removeKeyAssetFromSuggestions:suggestionsBeingKeyAssets];
  }

  objc_autoreleasePoolPop(v3);
}

- (void)resetKeyFaceOnVideoKeyFrameChange
{
  v22 = *MEMORY[0x1E69E9840];
  context = objc_autoreleasePoolPush();
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  detectedFaces = [(PLManagedAsset *)self detectedFaces];
  v4 = [detectedFaces countByEnumeratingWithState:&v13 objects:v21 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v14;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(detectedFaces);
        }

        personBeingKeyFace = [*(*(&v13 + 1) + 8 * i) personBeingKeyFace];
        if (personBeingKeyFace)
        {
          v9 = PLBackendGetLog();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
          {
            uuid = [(PLManagedAsset *)self uuid];
            personUUID = [personBeingKeyFace personUUID];
            *buf = 138543618;
            v18 = uuid;
            v19 = 2114;
            v20 = personUUID;
            _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Video key frame change on asset %{public}@: Resetting key face for person %{public}@", buf, 0x16u);
          }

          [personBeingKeyFace setKeyFace:0 pickSource:0];
        }
      }

      v5 = [detectedFaces countByEnumeratingWithState:&v13 objects:v21 count:16];
    }

    while (v5);
  }

  objc_autoreleasePoolPop(context);
}

- (void)fixupMemoriesWithMissingKeyAsset
{
  v39 = *MEMORY[0x1E69E9840];
  v3 = objc_autoreleasePoolPush();
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) != 0 && ![managedObjectContext resetCloudLibraryMode])
  {
    v25 = v3;
    v5 = [MEMORY[0x1E695DFA8] set];
    array = [MEMORY[0x1E695DF70] array];
    array2 = [MEMORY[0x1E695DF70] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    selfCopy = self;
    memoriesBeingKeyAsset = [(PLManagedAsset *)self memoriesBeingKeyAsset];
    v9 = [memoriesBeingKeyAsset countByEnumeratingWithState:&v28 objects:v38 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(memoriesBeingKeyAsset);
          }

          v13 = *(*(&v28 + 1) + 8 * i);
          calculateKeyAsset = [v13 calculateKeyAsset];
          if (calculateKeyAsset)
          {
            [array addObject:v13];
            v15 = array2;
            v16 = calculateKeyAsset;
          }

          else
          {
            v15 = v5;
            v16 = v13;
          }

          [v15 addObject:v16];
        }

        v10 = [memoriesBeingKeyAsset countByEnumeratingWithState:&v28 objects:v38 count:16];
      }

      while (v10);
    }

    if ([array count])
    {
      v17 = 0;
      do
      {
        v18 = [array objectAtIndexedSubscript:v17];
        v19 = [array2 objectAtIndexedSubscript:v17];
        v20 = PLBackendGetLog();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          *buf = 138412802;
          v33 = v18;
          v34 = 2112;
          v35 = selfCopy;
          v36 = 2112;
          v37 = v19;
          _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_INFO, "Updating keyAsset for memory %@ from %@ to %@", buf, 0x20u);
        }

        [v18 setKeyAsset:v19];
        if ([v18 featuredState] == 1)
        {
          delayedSaveActions = [managedObjectContext delayedSaveActions];
          [delayedSaveActions recordWidgetTimelineReloadNeededForType:0];

          v22 = PLBackendGetLog();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            uuid = [v18 uuid];
            *buf = 138543362;
            v33 = uuid;
            _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Recording ForYou widget timeline invalidation due to memory %{public}@ keyAsset update", buf, 0xCu);
          }
        }

        ++v17;
      }

      while ([array count] > v17);
    }

    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __50__PLManagedAsset_fixupMemoriesWithMissingKeyAsset__block_invoke;
    v26[3] = &unk_1E756B088;
    v27 = managedObjectContext;
    [v5 enumerateObjectsUsingBlock:v26];

    v3 = v25;
  }

  objc_autoreleasePoolPop(v3);
}

void __50__PLManagedAsset_fixupMemoriesWithMissingKeyAsset__block_invoke(uint64_t a1, void *a2)
{
  v7 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = PLBackendGetLog();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = 138412290;
    v6 = v3;
    _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_INFO, "Deleting memory %@ due to no key asset found", &v5, 0xCu);
  }

  [*(a1 + 32) deleteObject:v3];
}

- (BOOL)_hasBecomeNonVisibleToMemoriesAndPersonsAndSuggestions:(id)suggestions
{
  suggestionsCopy = suggestions;
  if (-[PLManagedAsset isDeleted](self, "isDeleted") & 1) != 0 || ([suggestionsCopy objectForKeyedSubscript:@"trashedState"], v5 = objc_claimAutoreleasedReturnValue(), v5, v5) && (objc_msgSend(suggestionsCopy, "objectForKey:", @"trashedState"), v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(v6, "intValue"), v6, v7) || (objc_msgSend(suggestionsCopy, "objectForKeyedSubscript:", @"hidden"), v8 = objc_claimAutoreleasedReturnValue(), v8, v8) && (objc_msgSend(suggestionsCopy, "objectForKey:", @"hidden"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v9, "BOOLValue"), v9, (v10))
  {
    LOBYTE(v11) = 1;
  }

  else
  {
    v13 = [suggestionsCopy objectForKeyedSubscript:@"avalanchePickType"];

    if (v13)
    {
      v14 = [suggestionsCopy objectForKey:@"avalanchePickType"];
      v11 = !-[PLManagedAsset _isVisibleAvalanchePickType:](self, "_isVisibleAvalanchePickType:", [v14 intValue]);
    }

    else
    {
      LOBYTE(v11) = 0;
    }
  }

  return v11;
}

- (void)_updateOriginalResourceChoice
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  if ([(PLManagedAsset *)self isPhoto]&& [(PLManagedAsset *)self hasAdjustments])
  {
    unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];
    v4 = unmanagedAdjustment;
    if (unmanagedAdjustment && ([unmanagedAdjustment adjustmentBaseImageFormat], v5 = objc_claimAutoreleasedReturnValue(), v6 = objc_msgSend(v5, "integerValue"), v5, v6))
    {
      v7 = 0;
    }

    else
    {
      mainFileURL = [(PLManagedAsset *)self mainFileURL];
      pathExtension = [mainFileURL pathExtension];
      v10 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:pathExtension assetType:[(PLManagedAsset *)self kind]];

      if (v10)
      {
        v11 = [MEMORY[0x1E6982C40] typeWithIdentifier:v10];
        v12 = [v11 conformsToType:*MEMORY[0x1E6982F88]];

        if (v12)
        {
          v7 = 3;
        }

        else
        {
          v7 = 0;
        }
      }

      else
      {
        v7 = 0;
      }
    }
  }

  else
  {
    v7 = 0;
  }

  originalResourceChoice = [additionalAttributes originalResourceChoice];
  unsignedIntegerValue = [originalResourceChoice unsignedIntegerValue];

  if (v7 != unsignedIntegerValue)
  {
    v15 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v7];
    [additionalAttributes setOriginalResourceChoice:v15];
  }
}

- (void)reevaluateCameraProcessingAdjustmentState
{
  v4 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_573];
  if (v4)
  {
    v3 = [(PLManagedAsset *)self cameraProcessingAdjustmentState]| 1;
  }

  else
  {
    v3 = 0;
  }

  [(PLManagedAsset *)self setCameraProcessingAdjustmentState:v3];
}

BOOL __59__PLManagedAsset_reevaluateCameraProcessingAdjustmentState__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 version])
  {
    v3 = 0;
  }

  else
  {
    v3 = [v2 resourceType] == 10 || objc_msgSend(v2, "resourceType") == 11;
  }

  return v3;
}

- (BOOL)setTrashedState:(signed __int16)state forResourceType:(unint64_t)type
{
  stateCopy = state;
  v21 = *MEMORY[0x1E69E9840];
  v7 = [(PLManagedAsset *)self masterResourceForCPLType:type];
  v8 = v7;
  if (v7 && [v7 supportsTrashedState])
  {
    v9 = PLBackendGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      uuid = [(PLManagedAsset *)self uuid];
      objectID = [v8 objectID];
      v12 = [MEMORY[0x1E6994B90] descriptionForResourceType:type];
      v19 = 67109890;
      *v20 = stateCopy;
      *&v20[4] = 2114;
      *&v20[6] = uuid;
      *&v20[14] = 2112;
      *&v20[16] = objectID;
      *&v20[24] = 2112;
      *&v20[26] = v12;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_INFO, "Setting resource trashedState to %i for asset %{public}@, resource %@, cplType %@", &v19, 0x26u);
    }

    [v8 applyTrashedState:stateCopy];
    v13 = 1;
  }

  else
  {
    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      uuid2 = [(PLManagedAsset *)self uuid];
      if (v8)
      {
        objectID2 = [v8 objectID];
      }

      else
      {
        objectID2 = @"<no master resource for cplType>";
      }

      v17 = [MEMORY[0x1E6994B90] descriptionForResourceType:type];
      v19 = 138543874;
      *v20 = uuid2;
      *&v20[8] = 2112;
      *&v20[10] = objectID2;
      *&v20[18] = 2112;
      *&v20[20] = v17;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Resource does not support trashedState %{public}@, resource %@, cplType %@", &v19, 0x20u);
      if (v8)
      {
      }
    }

    v13 = 0;
  }

  return v13;
}

- (void)expungeTrashedSpatialOverCaptureResources
{
  v13 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self persistedResourcesMatching:&__block_literal_global_568];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v9;
    do
    {
      v7 = 0;
      do
      {
        if (*v9 != v6)
        {
          objc_enumerationMutation(v3);
        }

        -[PLManagedAsset setTrashedState:forResourceType:](self, "setTrashedState:forResourceType:", 2, [*(*(&v8 + 1) + 8 * v7++) cplType]);
      }

      while (v5 != v7);
      v5 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v5);
  }
}

BOOL __59__PLManagedAsset_expungeTrashedSpatialOverCaptureResources__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 version] && (objc_msgSend(v2, "resourceType") == 10 || objc_msgSend(v2, "resourceType") == 11) && objc_msgSend(v2, "trashedState") != 0;

  return v3;
}

- (BOOL)setTrashedStateOnSpatialOverCaptureResources:(signed __int16)resources
{
  resourcesCopy = resources;
  v13 = *MEMORY[0x1E69E9840];
  if (setTrashedStateOnSpatialOverCaptureResources__onceToken != -1)
  {
    dispatch_once(&setTrashedStateOnSpatialOverCaptureResources__onceToken, &__block_literal_global_565);
  }

  if (resourcesCopy == 1 && (setTrashedStateOnSpatialOverCaptureResources__ignoreSOCSetTrashedStateChange & 1) != 0)
  {
    v5 = PLBackendGetLog();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      uuid = [(PLManagedAsset *)self uuid];
      v9 = 138412546;
      v10 = @"PLIgnoreSOCPrune";
      v11 = 2114;
      v12 = uuid;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_INFO, "ignoring setTrashedState for SOC resources: %@ = YES for asset %{public}@", &v9, 0x16u);
    }

    return 0;
  }

  else
  {
    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v8 = [(PLManagedAsset *)self setTrashedState:resourcesCopy forResourceType:24];
    }

    else
    {
      v8 = 1;
    }

    return [(PLManagedAsset *)self setTrashedState:resourcesCopy forResourceType:23]&& v8;
  }
}

void __63__PLManagedAsset_setTrashedStateOnSpatialOverCaptureResources___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  setTrashedStateOnSpatialOverCaptureResources__ignoreSOCSetTrashedStateChange = [v0 BOOLForKey:@"PLIgnoreSOCPrune"];
}

- (BOOL)isSyncableChange
{
  v22 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self savedAssetTypeIsSupportedForUpload])
  {
    changedValues = [(PLManagedAsset *)self changedValues];
    v17 = 0u;
    v18 = 0u;
    v19 = 0u;
    v20 = 0u;
    v4 = +[PLManagedAsset listOfSyncedProperties];
    v5 = [v4 countByEnumeratingWithState:&v17 objects:v21 count:16];
    if (v5)
    {
      v6 = *v18;
      while (2)
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v18 != v6)
          {
            objc_enumerationMutation(v4);
          }

          v8 = [changedValues objectForKey:*(*(&v17 + 1) + 8 * i)];

          if (v8)
          {
            LOBYTE(v5) = 1;
            goto LABEL_13;
          }
        }

        v5 = [v4 countByEnumeratingWithState:&v17 objects:v21 count:16];
        if (v5)
        {
          continue;
        }

        break;
      }
    }

LABEL_13:

    v10 = [changedValues objectForKey:@"cloudLocalState"];
    v11 = v10;
    if (v10)
    {
      if ([v10 intValue])
      {
        v12 = v5;
      }

      else
      {
        v12 = 1;
      }

      if (v12)
      {
        goto LABEL_23;
      }
    }

    else if (v5)
    {
      goto LABEL_23;
    }

    v13 = [changedValues objectForKey:@"savedAssetType"];
    if (!v13 || (v14 = v13, v15 = [(PLManagedAsset *)self cloudLocalState], v14, v15))
    {
      v9 = 0;
LABEL_26:

      return v9;
    }

LABEL_23:
    if ([(PLManagedAsset *)self isPlaceholderAsset])
    {
      v9 = [PLManagedAsset validShareForPlaceholderAsset:self];
    }

    else
    {
      v9 = 1;
    }

    goto LABEL_26;
  }

  return 0;
}

- (BOOL)_updateKindSubtypeIfScreenshotWithCheckTask:(id)task
{
  taskCopy = task;
  if (!taskCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2805 description:{@"Invalid parameter not satisfying: %@", @"checkTask"}];
  }

  if ([(PLManagedAsset *)self isPhotoIris]|| ![(PLManagedAsset *)self isPhoto]|| [(PLManagedAsset *)self kindSubtype]== 10 || !taskCopy[2](taskCopy))
  {
    v6 = 0;
  }

  else
  {
    [(PLManagedAsset *)self setKindSubtype:10];
    v6 = 1;
  }

  return v6;
}

- (BOOL)updateKindSubtypeIfScreenshotWithMetadata:(id)metadata
{
  metadataCopy = metadata;
  if (!metadataCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2787 description:{@"Invalid parameter not satisfying: %@", @"metadata"}];
  }

  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __60__PLManagedAsset_updateKindSubtypeIfScreenshotWithMetadata___block_invoke;
  v10[3] = &unk_1E7570878;
  v10[4] = self;
  v11 = metadataCopy;
  v6 = metadataCopy;
  v7 = [(PLManagedAsset *)self _updateKindSubtypeIfScreenshotWithCheckTask:v10];

  return v7;
}

uint64_t __60__PLManagedAsset_updateKindSubtypeIfScreenshotWithMetadata___block_invoke(uint64_t a1)
{
  v2 = objc_opt_class();
  v3 = [*(a1 + 40) contentType];
  v4 = [v2 _isScreenshotWithType:v3 hasScreenshotDimensions:objc_msgSend(*(a1 + 32) hasScreenshotMetadata:{"_hasScreenshotDimensions"), objc_msgSend(*(a1 + 32), "_hasScreenshotMetadataWithMetadata:", *(a1 + 40))}];

  return v4;
}

- (BOOL)updateKindSubtypeIfScreenshot
{
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __47__PLManagedAsset_updateKindSubtypeIfScreenshot__block_invoke;
  v3[3] = &unk_1E7573368;
  v3[4] = self;
  return [(PLManagedAsset *)self _updateKindSubtypeIfScreenshotWithCheckTask:v3];
}

uint64_t __47__PLManagedAsset_updateKindSubtypeIfScreenshot__block_invoke(uint64_t a1)
{
  v2 = objc_opt_class();
  v3 = MEMORY[0x1E69C08F0];
  v4 = [*(a1 + 32) uniformTypeIdentifier];
  v5 = [v3 typeWithIdentifier:v4];
  v6 = [v2 _isScreenshotWithType:v5 hasScreenshotDimensions:objc_msgSend(*(a1 + 32) hasScreenshotMetadata:{"_hasScreenshotDimensions"), objc_msgSend(*(a1 + 32), "hasScreenshotMetadata")}];

  return v6;
}

- (void)updatePanoramosityWithMetadata:(id)metadata
{
  metadataCopy = metadata;
  if (![(PLManagedAsset *)self isPhotoIris]&& [(PLManagedAsset *)self kindSubtype]!= 10 && [(PLManagedAsset *)self isPhoto])
  {
    if (!metadataCopy)
    {
      metadataCopy = [(PLManagedAsset *)self metadataFromMediaPropertiesOrOriginalResource];
    }

    if (!-[PLManagedAsset _hasPanoramaDimensions](self, "_hasPanoramaDimensions") || ([metadataCopy isScreenshot] & 1) != 0 || (v5 = -[PLManagedAsset height](self, "height"), v5 > -[PLManagedAsset width](self, "width")) && !objc_msgSend(metadataCopy, "isPanorama"))
    {
      if ([(PLManagedAsset *)self kindSubtype]!= 1)
      {
        goto LABEL_11;
      }

      v4 = 0;
      goto LABEL_10;
    }

    if ([(PLManagedAsset *)self kindSubtype]!= 1)
    {
      v4 = 1;
LABEL_10:
      [(PLManagedAsset *)self setKindSubtype:v4];
    }
  }

LABEL_11:
}

- (BOOL)validateForUpdate:(id *)update
{
  v16 = *MEMORY[0x1E69E9840];
  v5 = [PLManagedAsset correctedOrientation:[(PLManagedAsset *)self orientation]];
  if (v5 != [(PLManagedAsset *)self orientation])
  {
    [(PLManagedAsset *)self setOrientation:v5];
  }

  v13.receiver = self;
  v13.super_class = PLManagedAsset;
  v6 = [(PLManagedAsset *)&v13 validateForUpdate:update];
  if (v6)
  {
    changedValues = [(PLManagedAsset *)self changedValues];
    v8 = [changedValues objectForKeyedSubscript:@"libraryScope"];
    if (v8)
    {
    }

    else
    {
      v9 = [changedValues objectForKeyedSubscript:@"libraryScopeShareState"];

      if (!v9)
      {
LABEL_12:

        return v6;
      }
    }

    if ([(PLManagedAsset *)self hasLibraryScope]&& [(PLManagedAsset *)self isSuggestedForSharingByPhotos])
    {
      v10 = PLBackendGetLog();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v15 = uuid;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEFAULT, "Correcting libraryScopeShareState on asset %{public}@, for failing rule: a shared asset should not be marked as suggested for sharing.", buf, 0xCu);
      }

      PLLibraryScopeAssetRemoveSuggestedByClientType(self);
    }

    goto LABEL_12;
  }

  return v6;
}

- (BOOL)validateForInsert:(id *)insert
{
  v5 = [PLManagedAsset correctedOrientation:[(PLManagedAsset *)self orientation]];
  if (v5 != [(PLManagedAsset *)self orientation])
  {
    [(PLManagedAsset *)self setOrientation:v5];
  }

  collectionShareContributor = [(PLManagedAsset *)self collectionShareContributor];
  if (collectionShareContributor)
  {
    v7 = collectionShareContributor;
    collectionShareContributor2 = [(PLManagedAsset *)self collectionShareContributor];
    if ([collectionShareContributor2 isCurrentUser])
    {
      sensitivityAnalysisState = [(PLManagedAsset *)self sensitivityAnalysisState];

      if (!sensitivityAnalysisState)
      {
        [(PLManagedAsset *)self setSensitivityAnalysisState:4];
      }
    }

    else
    {
    }
  }

  v11.receiver = self;
  v11.super_class = PLManagedAsset;
  return [(PLManagedAsset *)&v11 validateForInsert:insert];
}

- (void)applyTrashedState:(signed __int16)state withTrashedReason:(unsigned __int16)reason expungeReasonFromClient:(id)client
{
  reasonCopy = reason;
  stateCopy = state;
  v23 = *MEMORY[0x1E69E9840];
  clientCopy = client;
  if (![(PLManagedAsset *)self canMoveToTrash])
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2655 description:@"expect trashable asset"];
  }

  if (stateCopy == 2)
  {
    if ([(PLManagedAsset *)self trashedState]!= 1 && [(PLManagedAsset *)self trashedState])
    {
      goto LABEL_25;
    }

    v14 = objc_alloc_init(MEMORY[0x1E696AD60]);
    if ([(PLManagedAsset *)self trashedState]== 1)
    {
      v17 = @"User deleted asset in trashedState.";
    }

    else
    {
      v17 = @"User deleted asset in non-trashedState";
    }

    [v14 appendString:v17];
    if (clientCopy)
    {
      [v14 appendFormat:@" Client expunge reason: %@", clientCopy];
    }

    [(PLManagedAsset *)self setTrashedState:2];
    uuid = [PLAssetTransactionReason transactionReason:v14];
    [(PLManagedAsset *)self deleteWithReason:uuid];
    goto LABEL_23;
  }

  if (stateCopy == 1)
  {
    if ([(PLManagedAsset *)self trashedState])
    {
      goto LABEL_25;
    }

    [(PLManagedAsset *)self setTrashedState:1];
    date = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setTrashedDate:date];

    [(PLManagedAsset *)self setTrashedReason:reasonCopy];
    if ([(PLManagedAsset *)self hasLibraryScope]&& ([(PLManagedAsset *)self libraryScopeShareState]& 0x800000) != 0)
    {
      libraryScope = [(PLManagedAsset *)self libraryScope];
      currentUserParticipant = [libraryScope currentUserParticipant];
      [(PLManagedAsset *)self setTrashedByParticipant:currentUserParticipant];
    }

    v14 = PLPhotosStatusGetLog();
    if (!os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
LABEL_24:

      goto LABEL_25;
    }

    uuid = [(PLManagedAsset *)self uuid];
    dateCreated = [(PLManagedAsset *)self dateCreated];
    *buf = 138543618;
    v20 = uuid;
    v21 = 2114;
    v22 = dateCreated;
    _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Asset %{public}@ (created on %{public}@) was trashed.", buf, 0x16u);

LABEL_23:
    goto LABEL_24;
  }

  if (!stateCopy && [(PLManagedAsset *)self trashedState]== 1)
  {
    [(PLManagedAsset *)self setTrashedState:0];
    [(PLManagedAsset *)self setTrashedDate:0];
    [(PLManagedAsset *)self setTrashedReason:0];
    trashedByParticipant = [(PLManagedAsset *)self trashedByParticipant];

    if (trashedByParticipant)
    {
      [(PLManagedAsset *)self setTrashedByParticipant:0];
    }
  }

LABEL_25:
}

- (void)deleteFromDatabaseOnlyWithReason:(id)reason
{
  reasonCopy = reason;
  if ((PLIsAssetsd() & 1) == 0)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2601 description:@"deleteFromDatabaseOnly is only safe from inside of assetsd!"];
  }

  self->_didPrepareForDeletion = 1;
  [(PLManagedAsset *)self deleteWithReason:reasonCopy];
}

- (void)deleteFromDatabaseOnly
{
  if ((PLIsAssetsd() & 1) == 0)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2592 description:@"deleteFromDatabaseOnly is only safe from inside of assetsd!"];
  }

  self->_didPrepareForDeletion = 1;
  v5 = [PLAssetTransactionReason transactionReason:@"Deleting from database only"];
  [(PLManagedAsset *)self deleteWithReason:v5];
}

- (void)delete
{
  v25 = *MEMORY[0x1E69E9840];
  if (!self->_deleteReasonExists)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2578 description:@"Asset deletion must specify a reason.  Please use deleteWithReason:"];
  }

  isCameraConnectionKitAsset = [(PLManagedAsset *)self isCameraConnectionKitAsset];
  v4 = PLPhotosStatusGetLog();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);
  if (isCameraConnectionKitAsset)
  {
    if (v5)
    {
      directory = [(PLManagedAsset *)self directory];
      filename = [(PLManagedAsset *)self filename];
      objectID = [(PLManagedAsset *)self objectID];
      uuid = [(PLManagedAsset *)self uuid];
      dateCreated = [(PLManagedAsset *)self dateCreated];
      v15 = 138544386;
      v16 = directory;
      v17 = 2112;
      v18 = filename;
      v19 = 2114;
      v20 = objectID;
      v21 = 2114;
      v22 = uuid;
      v23 = 2114;
      v24 = dateCreated;
      v11 = "Deleting %{public}@/%@ [%{public}@ %{public}@] (created on %{public}@)";
LABEL_8:
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEFAULT, v11, &v15, 0x34u);
    }
  }

  else if (v5)
  {
    directory = [(PLManagedAsset *)self directory];
    filename = [(PLManagedAsset *)self filename];
    objectID = [(PLManagedAsset *)self objectID];
    uuid = [(PLManagedAsset *)self uuid];
    dateCreated = [(PLManagedAsset *)self dateCreated];
    v15 = 138544386;
    v16 = directory;
    v17 = 2114;
    v18 = filename;
    v19 = 2114;
    v20 = objectID;
    v21 = 2114;
    v22 = uuid;
    v23 = 2114;
    v24 = dateCreated;
    v11 = "Deleting %{public}@/%{public}@ [%{public}@ %{public}@] (created on %{public}@)";
    goto LABEL_8;
  }

  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  [managedObjectContext deleteObject:self];

  self->_deleteReasonExists = 0;
}

- (void)deleteWithReason:(id)reason
{
  v10 = *MEMORY[0x1E69E9840];
  reasonCopy = reason;
  v5 = PLPhotosStatusGetLog();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    reason = [reasonCopy reason];
    v8 = 138543362;
    v9 = reason;
    _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "Delete reason: %{public}@", &v8, 0xCu);
  }

  reason2 = [reasonCopy reason];
  [(PLManagedAsset *)self setDeleteReason:reason2];

  self->_deleteReasonExists = 1;
  [(PLManagedAsset *)self delete];
}

- (BOOL)isDeletableFromAssetsLibrary
{
  v3 = [(PLManagedAsset *)self canPerformEditOperation:1];
  if (v3)
  {
    if ([(PLManagedAsset *)self isCloudSharedAsset])
    {
      LOBYTE(v3) = 0;
    }

    else
    {
      LOBYTE(v3) = ![(PLManagedAsset *)self isPhotoStreamPhoto];
    }
  }

  return v3;
}

- (BOOL)isEditableFromAssetsLibrary
{
  v3 = [(PLManagedAsset *)self canPerformEditOperation:2];
  if (v3)
  {
    if (([(PLManagedAsset *)self isDeleted]& 1) != 0 || [(PLManagedAsset *)self isCloudSharedAsset])
    {
      LOBYTE(v3) = 0;
    }

    else
    {
      LOBYTE(v3) = ![(PLManagedAsset *)self isPhotoStreamPhoto];
    }
  }

  return v3;
}

- (id)decodedFaceRegions
{
  faceRegions = [(PLManagedAsset *)self faceRegions];
  v3 = PLManagedAssetDecodeFaceRegions(faceRegions);

  return v3;
}

- (void)_loadReverseGeoIfNeeded
{
  if (!self->_didLoadReverseGeo)
  {
    locationInfo = [(PLManagedAsset *)self locationInfo];
    if (locationInfo)
    {
      v8 = locationInfo;
      location = [(PLManagedAsset *)self location];

      locationInfo = v8;
      if (location)
      {
        self->_isLocatedAtHome = [v8 isHome];
        localizedDescription = [v8 localizedDescription];
        v6 = [localizedDescription copy];
        reverseGeoDescription = self->_reverseGeoDescription;
        self->_reverseGeoDescription = v6;

        locationInfo = v8;
      }
    }

    self->_didLoadReverseGeo = 1;
  }
}

- (id)reverseGeoDescription
{
  [(PLManagedAsset *)self _loadReverseGeoIfNeeded];
  reverseGeoDescription = self->_reverseGeoDescription;

  return reverseGeoDescription;
}

- (id)avalanchePickDescription
{
  avalanchePickType = [(PLManagedAsset *)self avalanchePickType];
  string = [MEMORY[0x1E696AD60] string];
  v4 = string;
  if (!avalanchePickType)
  {
    v5 = @" PLAvalancheTypeNotInBurst";
LABEL_14:
    [v4 appendString:v5];
    goto LABEL_15;
  }

  if (avalanchePickType)
  {
    [string appendString:@" PLAvalancheTypeUnknown"];
    if ((avalanchePickType & 2) == 0)
    {
LABEL_4:
      if ((avalanchePickType & 4) == 0)
      {
        goto LABEL_5;
      }

      goto LABEL_11;
    }
  }

  else if ((avalanchePickType & 2) == 0)
  {
    goto LABEL_4;
  }

  [v4 appendString:@" PLAvalancheTypeNotPicked"];
  if ((avalanchePickType & 4) == 0)
  {
LABEL_5:
    if ((avalanchePickType & 8) == 0)
    {
      goto LABEL_6;
    }

LABEL_12:
    [v4 appendString:@" PLAvalancheTypeUserFavorite"];
    if ((avalanchePickType & 0x10) == 0)
    {
      goto LABEL_15;
    }

    goto LABEL_13;
  }

LABEL_11:
  [v4 appendString:@" PLAvalancheTypeAutoPicked"];
  if ((avalanchePickType & 8) != 0)
  {
    goto LABEL_12;
  }

LABEL_6:
  if ((avalanchePickType & 0x10) != 0)
  {
LABEL_13:
    v5 = @" PLAvalancheTypeStack";
    goto LABEL_14;
  }

LABEL_15:

  return v4;
}

- (BOOL)isAvalanchePhoto
{
  avalanchePickType = [(PLManagedAsset *)self avalanchePickType];
  if (avalanchePickType)
  {

    LOBYTE(avalanchePickType) = [(PLManagedAsset *)self isPartOfBurst];
  }

  return avalanchePickType;
}

- (BOOL)isAvalancheStackPhoto
{
  if (([(PLManagedAsset *)self avalanchePickType]& 0x10) == 0)
  {
    return 0;
  }

  return [(PLManagedAsset *)self isPartOfBurst];
}

- (BOOL)avalanchePickTypeIsVisible
{
  avalanchePickType = [(PLManagedAsset *)self avalanchePickType];

  return [(PLManagedAsset *)self _isVisibleAvalanchePickType:avalanchePickType];
}

- (void)setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:(unsigned __int16)variation
{
  variationCopy = variation;
  if ([(PLManagedAsset *)self playbackVariation]!= variation)
  {
    [(PLManagedAsset *)self setPlaybackVariation:variationCopy];
    playbackStyle = [(PLManagedAsset *)self playbackStyle];
    if ([objc_opt_class() _isLoopingVideoPlaybackVariation:variationCopy])
    {
      v6 = 5;
    }

    else
    {
      if (playbackStyle != 5)
      {
        return;
      }

      if ([(PLManagedAsset *)self isPhotoIris])
      {
        v6 = 3;
      }

      else
      {
        v6 = 4;
      }
    }

    if (playbackStyle != v6)
    {

      [(PLManagedAsset *)self setPlaybackStyle:v6];
    }
  }
}

- (unsigned)_playbackVariationWithAdjustmentRenderTypes:(unsigned int)types
{
  if ((types & 8) != 0)
  {
    LOWORD(v3) = 2;
  }

  else
  {
    v3 = ((types << 29) >> 31) & 3;
  }

  if (types)
  {
    return 1;
  }

  else
  {
    return v3;
  }
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types withPlaybackVariation:(unsigned __int16)variation
{
  if ((variation - 1) > 2)
  {
    v4 = 0;
  }

  else
  {
    v4 = dword_19C60B858[(variation - 1)];
  }

  return v4 | types & 0xFFFFFFF2;
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)types withDepthType:(signed __int16)type
{
  v4 = (type == 2) << 7;
  if (type == 1)
  {
    v4 = 2;
  }

  return v4 | types & 0xFFFFFF7D;
}

- (void)setCameraProcessingAdjustmentStateFromAdjustmentRenderTypes:(unsigned int)types
{
  v4 = (types >> 2) & 0xC | [(PLManagedAsset *)self cameraProcessingAdjustmentState]& 0xFFFFFFF3;

  [(PLManagedAsset *)self setCameraProcessingAdjustmentState:v4];
}

- (void)setDepthTypeFromAdjustmentRenderTypes:(unsigned int)types
{
  if ((types & 2) != 0)
  {
    v3 = 1;
LABEL_5:
    [(PLManagedAsset *)self setDepthType:v3];
    return;
  }

  if ((types & 0x80) != 0)
  {
    v3 = 2;
    goto LABEL_5;
  }
}

- (void)setPlaybackVariationAndLoopingStyleFromAdjustmentRenderTypes:(unsigned int)types
{
  v4 = [(PLManagedAsset *)self _playbackVariationWithAdjustmentRenderTypes:*&types];

  [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v4];
}

- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)d mainFileMetadata:(id)metadata videoURL:(id)l spatialOverCaptureURL:(id)rL videoDuration:(id *)duration stillDisplayTime:(id *)time options:(unint64_t)options
{
  v58 = *MEMORY[0x1E69E9840];
  dCopy = d;
  metadataCopy = metadata;
  lCopy = l;
  rLCopy = rL;
  if (![(PLManagedAsset *)self isPhoto])
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2254 description:{@"expect photo when changing to photoIris but type is %d", -[PLManagedAsset kind](self, "kind")}];
  }

  isPhoto = [(PLManagedAsset *)self isPhoto];
  _checkForAndAddFrameDropRecoveryForPhotoKitIngest = [(PLManagedAsset *)self _checkForAndAddFrameDropRecoveryForPhotoKitIngest];
  path = [lCopy path];
  pathForDeferredVideoComplementFile = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  v22 = [path isEqualToString:pathForDeferredVideoComplementFile];

  if (!isPhoto)
  {
    v25 = 0;
    path4 = 0;
    path2 = 0;
    goto LABEL_45;
  }

  v23 = v22 | _checkForAndAddFrameDropRecoveryForPhotoKitIngest;
  v49 = v22 | _checkForAndAddFrameDropRecoveryForPhotoKitIngest;
  if ((options & 2) != 0)
  {
    path2 = [lCopy path];
  }

  else
  {
    if (([metadataCopy isSyndicationOriginated] & 1) == 0)
    {
      path3 = [lCopy path];
      if (v23)
      {
        [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
      }

      else
      {
        [(PLManagedAsset *)self pathForVideoComplementFile];
      }
      path2 = ;
      v27 = [(PLManagedAsset *)self _linkVideoFileFromSourcePath:path3 toDestinationPath:path2];

      if (!rLCopy)
      {
        goto LABEL_18;
      }

      goto LABEL_15;
    }

    path2 = 0;
  }

  v27 = 1;
  if (!rLCopy)
  {
    goto LABEL_18;
  }

LABEL_15:
  if (v27)
  {
    path4 = [rLCopy path];
    if ((options & 2) != 0)
    {
      [rLCopy path];
    }

    else
    {
      [(PLManagedAsset *)self pathForVideoComplementSpatialOverCaptureContentFile];
    }
    v45 = ;
    v46 = [(PLManagedAsset *)self _linkVideoFileFromSourcePath:path4 toDestinationPath:v45];

    if (v46)
    {
      goto LABEL_19;
    }

LABEL_44:
    v25 = 0;
    goto LABEL_45;
  }

LABEL_18:
  path4 = 0;
  if (!v27)
  {
    goto LABEL_44;
  }

LABEL_19:
  [(PLManagedAsset *)self setKindSubtype:2];
  master = [(PLManagedAsset *)self master];

  if (master)
  {
    v30 = PLBackendGetLog();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      *&buf[4] = uuid;
      _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_INFO, "Mark the master to be not pushed, we just detect the video complement %{public}@", buf, 0xCu);
    }

    master2 = [(PLManagedAsset *)self master];
    [master2 setCloudLocalState:0];
  }

  *buf = *&duration->var0;
  var3 = duration->var3;
  v54 = *&time->var0;
  v55 = time->var3;
  [(PLManagedAsset *)self updatePhotoIrisMetadataWithMediaGroupUUID:dCopy videoDuration:buf stillDisplayTime:&v54];
  if (([metadataCopy isSyndicationOriginated] & 1) == 0)
  {
    [MEMORY[0x1E69BF230] persistString:0 forKey:*MEMORY[0x1E69BFDE0] fileURL:lCopy];
  }

  if ([(PLManagedAsset *)self canPlayPhotoIris])
  {
    [(PLManagedAsset *)self setPlaybackStyle:3];
    [(PLManagedAsset *)self updatePlaybackVariationAndStyleFromOriginalMetadata:metadataCopy];
  }

  if (path4)
  {
    [(PLManagedAsset *)self setCameraProcessingAdjustmentState:[(PLManagedAsset *)self cameraProcessingAdjustmentState]| 1];
  }

  if (_checkForAndAddFrameDropRecoveryForPhotoKitIngest)
  {
    [(PLManagedAsset *)self setVideoDeferredProcessingNeeded:1];
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    libraryServicesManager = [photoLibrary libraryServicesManager];
    backgroundJobService = [libraryServicesManager backgroundJobService];
    photoLibrary2 = [(PLManagedObject *)self photoLibrary];
    v37 = [PLBackgroundJobWorkerTypes typesMaskForVideoDeferredProcessingNeeded:[(PLManagedAsset *)self videoDeferredProcessingNeeded]];
    [backgroundJobService signalBackgroundProcessingNeededOnLibrary:photoLibrary2 workerTypes:v37];
  }

  v25 = 1;
  if (![(PLManagedAsset *)self isCloudSharedAsset]&& path2)
  {
    photoLibrary3 = [(PLManagedObject *)self photoLibrary];
    libraryID = [photoLibrary3 libraryID];
    v40 = PLDataStoreForClassIDAndLibraryID(0, libraryID);

    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    v42 = [PLResourceInstaller validatedExternalResourceForLocalVideoIfPresentAtPath:path2 context:managedObjectContext];

    if (v42)
    {
      [v42 setVersion:0];
      [v42 setResourceType:3];
      if (v49)
      {
        [v42 setRecipeID:131279];
      }

      v53 = 0;
      [v40 storeExternalResource:v42 forAsset:self options:0 error:0 resultingResource:&v53];
    }

    if (path4)
    {
      managedObjectContext2 = [(PLManagedAsset *)self managedObjectContext];
      v44 = [PLResourceInstaller validatedExternalResourceForLocalVideoIfPresentAtPath:path4 context:managedObjectContext2];

      if (v44)
      {
        [v44 setVersion:0];
        [v44 setResourceType:11];
        v52 = 0;
        [v40 storeExternalResource:v44 forAsset:self options:0 error:0 resultingResource:&v52];
      }
    }

    v25 = 1;
  }

LABEL_45:

  return v25;
}

- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)d mainFileMetadata:(id)metadata videoURL:(id)l videoDuration:(id *)duration stillDisplayTime:(id *)time options:(unint64_t)options
{
  v10 = *duration;
  v9 = *time;
  return [(PLManagedAsset *)self becomePhotoIrisWithMediaGroupUUID:d mainFileMetadata:metadata videoURL:l spatialOverCaptureURL:0 videoDuration:&v10 stillDisplayTime:&v9 options:options];
}

- (BOOL)_linkVideoFileFromSourcePath:(id)path toDestinationPath:(id)destinationPath
{
  v28[1] = *MEMORY[0x1E69E9840];
  pathCopy = path;
  destinationPathCopy = destinationPath;
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  if ([pathCopy isEqualToString:destinationPathCopy] && (objc_msgSend(defaultManager, "fileExistsAtPath:", destinationPathCopy) & 1) != 0)
  {
    v8 = 1;
  }

  else
  {
    v27 = *MEMORY[0x1E696A3A0];
    v28[0] = *MEMORY[0x1E696A388];
    v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v28 forKeys:&v27 count:1];
    v20 = 0;
    v10 = [defaultManager setAttributes:v9 ofItemAtPath:pathCopy error:&v20];
    v11 = v20;

    if ((v10 & 1) == 0)
    {
      v12 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v22 = pathCopy;
        v23 = 2112;
        v24 = v11;
        _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Unable to assign data protection to %@: %@", buf, 0x16u);
      }
    }

    v13 = MEMORY[0x1E69BF238];
    v14 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathCopy isDirectory:0];
    v15 = [MEMORY[0x1E695DFF8] fileURLWithPath:destinationPathCopy isDirectory:0];
    v19 = 0;
    v8 = [v13 copyItemAtURL:v14 toURL:v15 error:&v19];
    v16 = v19;

    if ((v8 & 1) == 0)
    {
      v17 = PLBackendGetLog();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v22 = pathCopy;
        v23 = 2112;
        v24 = destinationPathCopy;
        v25 = 2112;
        v26 = v16;
        _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "failed to copy video file from %@ to %@: %@", buf, 0x20u);
      }
    }
  }

  return v8;
}

- (void)updatePhotoIrisVisibilityStateWithVitalityScore:(id)score
{
  v12 = *MEMORY[0x1E69E9840];
  scoreCopy = score;
  v5 = scoreCopy;
  if (scoreCopy)
  {
    [scoreCopy floatValue];
    if (v6 < 0.5)
    {
      v7 = PLBackendGetLog();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v10 = 138543362;
        v11 = v5;
        _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_INFO, "Setting VC visibility state to hidden with vitalityScore:%{public}@", &v10, 0xCu);
      }

      [(PLManagedAsset *)self setVideoCpVisibilityState:[(PLManagedAsset *)self videoCpVisibilityState]| 5];
    }
  }

  else
  {
    v8 = PLBackendGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      uuid = [(PLManagedAsset *)self uuid];
      v10 = 138543362;
      v11 = uuid;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Vitality thresholding was requested for asset %{public}@ but vitality score was nil", &v10, 0xCu);
    }
  }
}

- (void)updatePhotoIrisMetadataWithMediaGroupUUID:(id)d videoDuration:(id *)duration stillDisplayTime:(id *)time
{
  dCopy = d;
  mediaGroupUUID = [(PLManagedAsset *)self mediaGroupUUID];
  v10 = [mediaGroupUUID isEqualToString:dCopy];

  if ((v10 & 1) == 0)
  {
    [(PLManagedAsset *)self setMediaGroupUUID:dCopy];
  }

  v11 = *&duration->var0;
  var3 = duration->var3;
  [(PLManagedAsset *)self setPhotoIrisVideoDuration:&v11];
  v11 = *&time->var0;
  var3 = time->var3;
  [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&v11];
}

- (void)_updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:(id)asset
{
  v24 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  v5 = PFVideoComplementMetadataForVideoAVAssetPreloadingValues();
  v6 = v5;
  memset(&v21[1], 0, sizeof(CMTime));
  v7 = MEMORY[0x1E6960C70];
  if (!v5)
  {
    memset(v21, 0, 24);
    goto LABEL_8;
  }

  [v5 videoDuration];
  memset(v21, 0, 24);
  [v6 imageDisplayTime];
  if (v21[1].value)
  {
    goto LABEL_18;
  }

  if ((v21[0].flags & 1) == 0)
  {
LABEL_8:
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && (v10 = assetCopy, [v10 URL], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(MEMORY[0x1E696AC08], "defaultManager"), v12 = objc_claimAutoreleasedReturnValue(), v10, -[NSObject path](v11, "path"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v12, "fileExistsAtPath:", v13), v13, v12, v11))
    {
      uuid2 = PLPhotoEditGetLog();
      if (os_log_type_enabled(uuid2, OS_LOG_TYPE_FAULT))
      {
        uuid = [(PLManagedAsset *)self uuid];
        v17 = @"does not";
        LODWORD(buf.value) = 138543874;
        *(&buf.value + 4) = uuid;
        LOWORD(buf.flags) = 2112;
        if (v14)
        {
          v17 = @"does";
        }

        *(&buf.flags + 2) = v17;
        HIWORD(buf.epoch) = 2112;
        v23 = v11;
        _os_log_impl(&dword_19BF1F000, uuid2, OS_LOG_TYPE_FAULT, "asset %{public}@ photo iris still display time is invalid and duration is 0, rejecting times, backing video file %@ exist at url: %@", &buf, 0x20u);
      }
    }

    else
    {
      v11 = PLPhotoEditGetLog();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_FAULT))
      {
LABEL_17:

        v21[1] = *v7;
        goto LABEL_18;
      }

      uuid2 = [(PLManagedAsset *)self uuid];
      LODWORD(buf.value) = 138543618;
      *(&buf.value + 4) = uuid2;
      LOWORD(buf.flags) = 2112;
      *(&buf.flags + 2) = assetCopy;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_FAULT, "asset %{public}@ photo iris still display time is invalid and duration is 0, rejecting times, likely failed to read temporal metadata from avasset: %@", &buf, 0x16u);
    }

    goto LABEL_17;
  }

  v8 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    uuid3 = [(PLManagedAsset *)self uuid];
    LODWORD(buf.value) = 138543618;
    *(&buf.value + 4) = uuid3;
    LOWORD(buf.flags) = 2112;
    *(&buf.flags + 2) = assetCopy;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "asset %{public}@ photo iris duration is 0, video will likely be unplayable, avasset: %@", &buf, 0x16u);
  }

LABEL_18:
  buf = v21[0];
  v19 = *&v7->value;
  *&time2.value = *&v7->value;
  epoch = v7->epoch;
  time2.epoch = epoch;
  if (CMTimeCompare(&buf, &time2))
  {
    buf = v21[0];
    [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&buf];
  }

  buf = v21[1];
  *&time2.value = v19;
  time2.epoch = epoch;
  if (CMTimeCompare(&buf, &time2))
  {
    buf = v21[1];
    [(PLManagedAsset *)self setPhotoIrisVideoDuration:&buf];
  }
}

- (id)photoIrisSidecarIgnoringSubtype:(BOOL)subtype
{
  if (subtype || [(PLManagedAsset *)self isPhotoIris])
  {
    v4 = [(PLManagedAsset *)self sidecarFileMatchingContentType:*MEMORY[0x1E6982EE8] requireExactMatch:0 requireSort:1];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)_setVideoComplementData:(id)data
{
  v8 = *MEMORY[0x1E6960C70];
  v9 = *(MEMORY[0x1E6960C70] + 16);
  v6 = v8;
  v7 = v9;
  [PLAdditionalAssetAttributes fromExtraDurationData:data getStillDisplayTime:&v8 videoDuration:&v6];
  v4 = v6;
  v5 = v7;
  [(PLManagedAsset *)self setPhotoIrisVideoDuration:&v4];
  v4 = v8;
  v5 = v9;
  [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&v4];
}

- (id)videoComplementData
{
  if ([(PLManagedAsset *)self _hasVideoComplementData])
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    memset(&v9, 0, sizeof(v9));
    CMTimeMake(&v9, [additionalAttributes videoCpDisplayValue], objc_msgSend(additionalAttributes, "videoCpDisplayTimescale"));
    memset(&v8, 0, sizeof(v8));
    CMTimeMake(&v8, -[PLManagedAsset videoCpDurationValue](self, "videoCpDurationValue"), [additionalAttributes videoCpDurationTimescale]);
    v7 = v9;
    v6 = v8;
    v4 = [PLAdditionalAssetAttributes newExtraDurationDataFromStillDisplayTime:&v7 videoDuration:&v6];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (BOOL)_hasVideoComplementData
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = -[PLManagedAsset videoCpDurationValue](self, "videoCpDurationValue") || [additionalAttributes videoCpDurationTimescale] || objc_msgSend(additionalAttributes, "videoCpDisplayValue") || objc_msgSend(additionalAttributes, "videoCpDisplayTimescale") != 0;

  return v4;
}

- (void)setPhotoIrisVideoDuration:(id *)duration
{
  [(PLManagedAsset *)self photoIrisVideoDuration];
  v6 = *duration;
  if (CMTimeCompare(&v6, &time2))
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    [(PLManagedAsset *)self setVideoCpDurationValue:duration->var0];
    [additionalAttributes setVideoCpDurationTimescale:duration->var1];
  }
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisVideoDuration
{
  videoCpDurationValue = [(PLManagedAsset *)self videoCpDurationValue];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  videoCpDurationTimescale = [additionalAttributes videoCpDurationTimescale];

  retstr->var0 = 0;
  *&retstr->var1 = 0;
  retstr->var3 = 0;

  return CMTimeMake(retstr, videoCpDurationValue, videoCpDurationTimescale);
}

- (void)setPhotoIrisStillDisplayTime:(id *)time
{
  [(PLManagedAsset *)self photoIrisStillDisplayTime];
  v6 = *time;
  if (CMTimeCompare(&v6, &time2))
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    [additionalAttributes setVideoCpDisplayValue:time->var0];
    [additionalAttributes setVideoCpDisplayTimescale:time->var1];
  }
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisStillDisplayTime
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  videoCpDisplayValue = [additionalAttributes videoCpDisplayValue];

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  videoCpDisplayTimescale = [additionalAttributes2 videoCpDisplayTimescale];

  retstr->var0 = 0;
  *&retstr->var1 = 0;
  retstr->var3 = 0;

  return CMTimeMake(retstr, videoCpDisplayValue, videoCpDisplayTimescale);
}

- (BOOL)hasAdjustedVideoComplement
{
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  if (isPhotoIris)
  {
    isPhotoIris = [(PLManagedAsset *)self hasAdjustments];
    if (isPhotoIris)
    {
      return ([(PLManagedAsset *)self videoCpVisibilityState]>> 3) & 1;
    }
  }

  return isPhotoIris;
}

- (BOOL)canPlayPhotoIris
{
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  isPhotoIrisPlaceholder = [(PLManagedAsset *)self isPhotoIrisPlaceholder];
  hasAdjustments = [(PLManagedAsset *)self hasAdjustments];
  videoCpVisibilityState = [(PLManagedAsset *)self videoCpVisibilityState];
  v7 = objc_opt_class();

  return [v7 canPlayPhotoIrisWithPhotoIris:isPhotoIris photoIrisPlaceholder:isPhotoIrisPlaceholder hasAdjustments:hasAdjustments videoCpVisibilityState:videoCpVisibilityState];
}

- (BOOL)isPhotoIrisPlaceholder
{
  selfCopy = self;
  isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
  videoCpDurationValue = [(PLManagedAsset *)selfCopy videoCpDurationValue];
  isCloudSharedAsset = [(PLManagedAsset *)selfCopy isCloudSharedAsset];
  pathForVideoComplementFile = [(PLManagedAsset *)selfCopy pathForVideoComplementFile];
  LOBYTE(selfCopy) = [objc_opt_class() isPhotoIrisPlaceholderWithPhotoIris:isPhotoIris videoCpDuration:videoCpDurationValue isCloudShared:isCloudSharedAsset videoCpFilePath:pathForVideoComplementFile];

  return selfCopy;
}

- (BOOL)isPhotoIris
{
  isPhoto = [(PLManagedAsset *)self isPhoto];
  if (isPhoto)
  {
    LOBYTE(isPhoto) = [(PLManagedAsset *)self kindSubtype]== 2;
  }

  return isPhoto;
}

- (void)setLocation:(id)location
{
  locationCopy = location;
  [(PLManagedAsset *)self willChangeValueForKey:@"location"];
  [(PLManagedAsset *)self setCachedLocation:locationCopy];
  [(PLManagedAsset *)self didChangeValueForKey:@"location"];
  v4 = [PLManagedAsset newLocationDataFromLocation:locationCopy];
  [(PLManagedAsset *)self setLocationData:v4];
  if (v4)
  {
    [locationCopy coordinate];
    [(PLManagedAsset *)self setLatitude:?];
    [locationCopy coordinate];
    [(PLManagedAsset *)self setLongitude:v5];
    [locationCopy horizontalAccuracy];
    v7 = v6;
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    v9 = -1.0;
    if (v7 != 0.0)
    {
      [locationCopy horizontalAccuracy];
    }

    [additionalAttributes setGpsHorizontalAccuracy:v9];

    [locationCopy coordinate];
    v10 = [PLLocationUtils canUseCoordinate:?];
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    additionalAttributes4 = additionalAttributes2;
    if (v10)
    {
      v13 = [MEMORY[0x1E696AD98] numberWithInt:{objc_msgSend(locationCopy, "pl_locationHash")}];
      [additionalAttributes4 setLocationHash:v13];
    }

    else
    {
      [additionalAttributes2 setLocationHash:0];
    }
  }

  else
  {
    v14 = MEMORY[0x1E6985CC0];
    [(PLManagedAsset *)self setLatitude:*MEMORY[0x1E6985CC0]];
    [(PLManagedAsset *)self setLongitude:*(v14 + 8)];
    additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
    [additionalAttributes3 setLocationHash:0];

    additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
    [additionalAttributes4 setGpsHorizontalAccuracy:-1.0];
  }

  [(PLManagedAsset *)self setReverseLocationDataIsValid:v4 == 0];
  [(PLManagedAsset *)self setShiftedLocationIsValid:0];
}

- (CLLocation)location
{
  [(PLManagedAsset *)self willAccessValueForKey:@"location"];
  cachedLocation = [(PLManagedAsset *)self cachedLocation];
  [(PLManagedAsset *)self didAccessValueForKey:@"location"];
  if (!cachedLocation)
  {
    locationData = [(PLManagedAsset *)self locationData];
    dateCreated = [(PLManagedAsset *)self dateCreated];
    cachedLocation = [PLManagedAsset newLocationFromLocationData:locationData timestampIfMissing:dateCreated];
    if (cachedLocation)
    {
      [(PLManagedAsset *)self willChangeValueForKey:@"location"];
      [(PLManagedAsset *)self setCachedLocation:cachedLocation];
      [(PLManagedAsset *)self didChangeValueForKey:@"location"];
    }
  }

  return cachedLocation;
}

- (BOOL)isLocatedAtCoordinates:(CLLocationCoordinate2D)coordinates
{
  longitude = coordinates.longitude;
  latitude = coordinates.latitude;
  location = [(PLManagedAsset *)self location];
  v6 = location;
  if (location)
  {
    [location coordinate];
    v8 = v7;
    v10 = v9;
  }

  else
  {
    v8 = *MEMORY[0x1E6985CC0];
    v10 = *(MEMORY[0x1E6985CC0] + 8);
  }

  if ([PLLocationUtils canUseCoordinate:latitude, longitude])
  {
    v11 = vabdd_f64(latitude, v8) < 2.22044605e-16;
    LOBYTE(v12) = vabdd_f64(longitude, v10) < 2.22044605e-16 && v11;
  }

  else
  {
    v12 = ![PLLocationUtils canUseCoordinate:v8, v10];
  }

  return v12;
}

- (BOOL)isSemanticEnhanceProcessingCandidate
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v3 = ([additionalAttributes deferredProcessingCandidateOptions] >> 3) & 1;

  return v3;
}

- (BOOL)isLocalVideoKeyFrameValid
{
  if ([(PLManagedAsset *)self hasAdjustments]|| [(PLManagedAsset *)self bundleScope]== 3)
  {
    return 0;
  }

  [MEMORY[0x1E69BF328] maskForGuestAsset];
  [(PLManagedAsset *)self savedAssetType];
  return PLValidatedSavedAssetTypeApplies() ^ 1;
}

- (BOOL)resetVideoKeyFrameTime
{
  videoKeyFrameValue = [(PLManagedAsset *)self videoKeyFrameValue];
  v4 = videoKeyFrameValue != 0;
  if (videoKeyFrameValue)
  {
    [(PLManagedAsset *)self setVideoKeyFrameValue:0];
  }

  if ([(PLManagedAsset *)self videoKeyFrameTimeScale])
  {
    [(PLManagedAsset *)self setVideoKeyFrameTimeScale:0];
    return 1;
  }

  return v4;
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)videoKeyFrameTime
{
  videoKeyFrameValue = [(PLManagedAsset *)self videoKeyFrameValue];
  videoKeyFrameTimeScale = [(PLManagedAsset *)self videoKeyFrameTimeScale];

  return CMTimeMake(retstr, videoKeyFrameValue, videoKeyFrameTimeScale);
}

- (void)setVideoKeyFrameTime:(id *)time
{
  [(PLManagedAsset *)self setVideoKeyFrameValue:time->var0];
  var1 = time->var1;

  [(PLManagedAsset *)self setVideoKeyFrameTimeScale:var1];
}

- (void)prepareForDeletion
{
  v46 = *MEMORY[0x1E69E9840];
  v41.receiver = self;
  v41.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v41 prepareForDeletion];
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  if ((PLIsAssetsd() & 1) != 0 || MEMORY[0x19EAEE520]())
  {
    [PLGraphNode registerDeletedNodeActorForDanglingNodeCleanup:self];
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [PLDelayedSearchIndexUpdates recordAssetIfNeeded:self];
    if (([managedObjectContext mergingChanges] & 1) == 0)
    {
      photoLibrary = [(PLManagedObject *)self photoLibrary];
      isCloudPhotoLibraryEnabled = [photoLibrary isCloudPhotoLibraryEnabled];

      if (isCloudPhotoLibraryEnabled)
      {
        master = [(PLManagedAsset *)self master];
        v7 = master;
        if (master)
        {
          if (([master isDeleted] & 1) == 0)
          {
            uuid = [(PLManagedAsset *)self uuid];
            v9 = [v7 hasResourcesOtherThanForAssetUuid:uuid];

            if ((v9 & 1) == 0)
            {
              v10 = PLBackendGetLog();
              if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
              {
                pl_shortDescription = [v7 pl_shortDescription];
                *buf = 138543362;
                selfCopy = pl_shortDescription;
                _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_INFO, "Deleting master %{public}@, last resource was removed since we deleted the asset", buf, 0xCu);
              }

              [managedObjectContext deleteObject:v7];
            }
          }
        }
      }

      if (PLPlatformMomentsSupported())
      {
        delayedSaveActions = [managedObjectContext delayedSaveActions];
        [delayedSaveActions recordAssetForMomentUpdate:self];
      }

      [managedObjectContext recordAvalancheUUIDForUpdate:self];
      if (!self->_didPrepareForDeletion)
      {
        self->_didPrepareForDeletion = 1;
        if ([(PLManagedAsset *)self savedAssetTypeIsSupportedForUpload])
        {
          [MEMORY[0x1E69BF328] maskForMomentSharedAsset];
          [(PLManagedAsset *)self savedAssetType];
          if (PLValidatedSavedAssetTypeApplies())
          {
            v13 = PLBackendGetLog();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              uuid2 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              selfCopy = uuid2;
              v15 = "Not propagating asset delete to cloud as asset is a MomentShared asset is set: %@";
LABEL_23:
              _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_INFO, v15, buf, 0xCu);
            }
          }

          else
          {
            if ([(PLManagedAsset *)self isPlaceholderAsset])
            {
              v13 = PLBackendGetLog();
              if (!os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
              {
                goto LABEL_24;
              }

              uuid2 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              selfCopy = uuid2;
              v15 = "Not propagating asset delete to cloud as asset is a placeholder asset is set: %@";
              goto LABEL_23;
            }

            if (![(PLManagedAsset *)self isLocalOnlyDelete])
            {
              uuid3 = [(PLManagedAsset *)self uuid];
              if (uuid3)
              {
              }

              else
              {
                cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];

                if (!cloudAssetGUID)
                {
                  v13 = PLBackendGetLog();
                  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
                  {
                    *buf = 138412290;
                    selfCopy = self;
                    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_INFO, "Not propagating asset delete to cloud as its uuid & cloudAssetGUID cannot be fetched: %@", buf, 0xCu);
                  }

                  goto LABEL_24;
                }
              }

              scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
              stringRepresentation = [scopedIdentifier stringRepresentation];
              [(PLManagedAsset *)self setCloudAssetGUID:stringRepresentation];

              [managedObjectContext recordCloudDeletionForObject:self];
              goto LABEL_25;
            }

            v13 = PLBackendGetLog();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              uuid2 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              selfCopy = uuid2;
              v15 = "Not propagating asset delete to cloud as isLocalOnlyDelete is set: %@";
              goto LABEL_23;
            }
          }
        }

        else
        {
          v13 = PLBackendGetLog();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            uuid2 = [(PLManagedAsset *)self uuid];
            *buf = 138412290;
            selfCopy = uuid2;
            v15 = "Not propagating asset delete to cloud as saved asset type is not supported for upload: %@";
            goto LABEL_23;
          }
        }

LABEL_24:

LABEL_25:
        if (PLIsAssetsd() && ([(PLManagedAsset *)self hasOutstandingDeferredCaptureProcessing]|| [(PLManagedAsset *)self hasUnrenderedAsyncAdjustments]))
        {
          [(PLManagedAsset *)self requestDeletionOfDeferredPhotoProcessingIntermediates];
        }

        v16 = [PLFilesystemDeletionInfo deletionInfoWithAsset:self];
        if (v16)
        {
          if (!PLIsAssetsd())
          {
            v33 = PLBackendGetLog();
            if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
            {
              uuid4 = [(PLManagedAsset *)self uuid];
              mainFileURL = [(PLManagedAsset *)self mainFileURL];
              path = [mainFileURL path];
              *buf = 138543618;
              selfCopy = uuid4;
              v44 = 2112;
              v45 = path;
              _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_INFO, "Registering file system deletion info for assetsd to process %{public}@ %@", buf, 0x16u);
            }

            [managedObjectContext registerFilesystemDeletionInfo:v16];
            goto LABEL_47;
          }

          v17 = objc_opt_new();
          [v17 addFilesystemDeletionInfo:v16];
          photoLibrary2 = [(PLManagedObject *)self photoLibrary];
          [v17 deleteAllRemainingFilesAndThumbnailsWithPhotoLibrary:photoLibrary2];

          photoLibrary3 = [(PLManagedObject *)self photoLibrary];
          libraryServicesManager = [photoLibrary3 libraryServicesManager];

          if ([(PLManagedAsset *)libraryServicesManager wellKnownPhotoLibraryIdentifier]== 3)
          {
            v21 = PLSyndicationGetLog();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
            {
              uuid5 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              selfCopy = uuid5;
              _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEBUG, "GuestAssetSync: preparing to delete syndication asset: %@, triggering update", buf, 0xCu);
            }

            photoLibrary4 = [(PLManagedObject *)self photoLibrary];
            uuid6 = [(PLManagedAsset *)self uuid];
            v25 = [photoLibrary4 addBackgroundJobWorkItemIfNeededWithIdentifier:uuid6 jobType:0 jobFlags:2];

            if (v25)
            {
              backgroundJobService = [(PLManagedAsset *)libraryServicesManager backgroundJobService];
              photoLibrary5 = [(PLManagedObject *)self photoLibrary];
              v28 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:0];
              [backgroundJobService signalBackgroundProcessingNeededOnLibrary:photoLibrary5 workerTypes:v28];
            }
          }

          if ([(PLManagedAsset *)libraryServicesManager wellKnownPhotoLibraryIdentifier]== 1)
          {
            [MEMORY[0x1E69BF328] maskForGuestAsset];
            [(PLManagedAsset *)self savedAssetType];
            if ((PLValidatedSavedAssetTypeApplies() & 1) == 0)
            {
              additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
              syndicationIdentifier = [additionalAttributes syndicationIdentifier];

              if (syndicationIdentifier)
              {
                [(PLManagedAsset *)self updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:0];
              }
            }
          }
        }

        else
        {
          v17 = PLBackendGetLog();
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
LABEL_43:

LABEL_47:
            goto LABEL_48;
          }

          libraryServicesManager = [(PLManagedAsset *)self uuid];
          mainFileURL2 = [(PLManagedAsset *)self mainFileURL];
          path2 = [mainFileURL2 path];
          *buf = 138543618;
          selfCopy = libraryServicesManager;
          v44 = 2112;
          v45 = path2;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_INFO, "No file system deletion info for %{public}@ %@", buf, 0x16u);
        }

        goto LABEL_43;
      }
    }
  }

LABEL_48:
}

- (void)setImportSessionAlbumWithImportSessionID:(id)d
{
  v23 = *MEMORY[0x1E69E9840];
  dCopy = d;
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  if (dCopy)
  {
    importSession = [(PLManagedAsset *)self importSession];
    importSessionID = [importSession importSessionID];
    v8 = [importSessionID isEqualToString:dCopy];

    if (v8)
    {
LABEL_18:

      goto LABEL_19;
    }

    userInfo = [managedObjectContext userInfo];
    dictionary = [userInfo objectForKeyedSubscript:@"importSessionObjectIDCache"];

    if (!dictionary)
    {
      dictionary = [MEMORY[0x1E695DF90] dictionary];
      userInfo2 = [managedObjectContext userInfo];
      [userInfo2 setObject:dictionary forKeyedSubscript:@"importSessionObjectIDCache"];
    }

    v12 = [dictionary objectForKeyedSubscript:dCopy];
    if (v12 && ([managedObjectContext objectRegisteredForID:v12], (v13 = objc_claimAutoreleasedReturnValue()) != 0) || (+[PLImportSession albumWithImportSessionID:inManagedObjectContext:](PLImportSession, "albumWithImportSessionID:inManagedObjectContext:", dCopy, managedObjectContext), (v13 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v14 = v13;
      v15 = PLBackendGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *v21 = 138412546;
        *&v21[4] = dCopy;
        *&v21[12] = 2112;
        *&v21[14] = uuid;
        v17 = "Found importSessionAlbum (%@) for asset uuid %@";
LABEL_12:
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_INFO, v17, v21, 0x16u);
      }
    }

    else
    {
      v14 = [PLImportSession insertNewImportSessionAlbumWithImportSessionID:dCopy inManagedObjectContext:managedObjectContext];
      v15 = PLBackendGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *v21 = 138412546;
        *&v21[4] = dCopy;
        *&v21[12] = 2112;
        *&v21[14] = uuid;
        v17 = "Created importSessionAlbum (%@) for asset uuid %@";
        goto LABEL_12;
      }
    }

    if (importSession)
    {
      v18 = PLBackendGetLog();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        uuid2 = [(PLManagedAsset *)self uuid];
        *v21 = 138412802;
        *&v21[4] = importSession;
        *&v21[12] = 2112;
        *&v21[14] = dCopy;
        *&v21[22] = 2112;
        v22 = uuid2;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEFAULT, "Changed importSessionAlbum (%@) to (%@) for asset uuid %@", v21, 0x20u);
      }
    }

    [(PLManagedAsset *)self setImportSession:v14, *v21, *&v21[16]];
    [v14 updateImportDatesFromAddedAsset:self];
    objectID = [v14 objectID];
    [dictionary setObject:objectID forKeyedSubscript:dCopy];

    goto LABEL_18;
  }

LABEL_19:
}

- (PLRevGeoLocationInfo)locationInfo
{
  reverseLocationData = [(PLManagedAsset *)self reverseLocationData];
  v3 = [PLRevGeoLocationInfo infoFromPlistData:reverseLocationData];

  return v3;
}

- (PLRevGeoPlaceAnnotation)placeAnnotation
{
  v14 = *MEMORY[0x1E69E9840];
  placeAnnotationData = [(PLManagedAsset *)self placeAnnotationData];
  if (placeAnnotationData)
  {
    v9 = 0;
    v4 = [MEMORY[0x1E696ACD0] unarchivedObjectOfClass:objc_opt_class() fromData:placeAnnotationData error:&v9];
    v5 = v9;
    if (!v4)
    {
      v6 = PLBackendGetLog();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543618;
        v11 = uuid;
        v12 = 2114;
        v13 = v5;
        _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "Failed to read placeAnnotation from asset with ID %{public}@, error:%{public}@", buf, 0x16u);
      }
    }
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_sizeOfVideoPreviewForAVAsset:(id)asset
{
  v28 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v5 = 2;
  }

  else
  {
    v5 = 0;
  }

  v24[0] = MEMORY[0x1E69E9820];
  v24[1] = 3221225472;
  v24[2] = __48__PLManagedAsset__sizeOfVideoPreviewForAVAsset___block_invoke;
  v24[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  v25 = v5;
  v6 = [(PLManagedAsset *)self firstPersistedResourceMatching:v24];
  v7 = v6;
  v8 = *MEMORY[0x1E695F060];
  v9 = *(MEMORY[0x1E695F060] + 8);
  if (v6)
  {
    orientedWidth = [v6 orientedWidth];
    orientedHeight = [v7 orientedHeight];
  }

  else
  {
    [PLManagedAsset dimensionsForAVAsset:assetCopy];
    if (v12 <= 0.0 || (v14 = v13, v13 <= 0.0))
    {
      v19 = PLThumbnailsGetLog();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v27 = uuid;
        _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Asset %{public}@ attempting to size preview image for video with 0 dimensions", buf, 0xCu);
      }

      orientedHeight = v9;
      orientedWidth = v8;
    }

    else
    {
      orientedWidth = v12;
      [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:4];
      PFScaleFactorForMaximumPixelCount();
      v16 = v15 < 1.0;
      v17 = orientedWidth * v15;
      v18 = v14 * v15;
      if (v16)
      {
        orientedHeight = v18;
      }

      else
      {
        orientedHeight = v14;
      }

      if (v16)
      {
        orientedWidth = v17;
      }
    }
  }

  if (orientedWidth == v8 && orientedHeight == v9)
  {
    v22 = 0;
  }

  else
  {
    v22 = DCIM_NSValueFromCGSize();
  }

  return v22;
}

BOOL __48__PLManagedAsset__sizeOfVideoPreviewForAVAsset___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 recipeID] == 65741 && objc_msgSend(v3, "version") == *(a1 + 32);

  return v4;
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data metadata:(id)metadata forceSRGBConversion:(BOOL)conversion forFinalCameraImage:(BOOL)cameraImage saveCameraPreviewWellImage:(BOOL)self0 reduceProcessingForIngest:(BOOL)self1
{
  v94[1] = *MEMORY[0x1E69E9840];
  imageCopy = image;
  thumbnailImageCopy = thumbnailImage;
  dataCopy = data;
  metadataCopy = metadata;
  context = objc_autoreleasePoolPush();
  if (!(imageCopy | thumbnailImageCopy) && [(PLManagedAsset *)self resetVideoKeyFrameTimeAndDeleteKeyFrameResource])
  {
    v18 = PLThumbnailsGetLog();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      v88 = uuid;
      _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_INFO, "Reset media analysis key frame due to generating thumbs for asset %{public}@", buf, 0xCu);
    }
  }

  v20 = PLThumbnailsGetLog();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
  {
    uuid2 = [(PLManagedAsset *)self uuid];
    *buf = 138412290;
    v88 = uuid2;
    _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "[RM]: generating and updating thumbnails for asset %@", buf, 0xCu);
  }

  photoLibrary = [(PLManagedObject *)self photoLibrary];
  thumbnailManager = [photoLibrary thumbnailManager];

  effectiveThumbnailIndex = [(PLManagedAsset *)self effectiveThumbnailIndex];
  if (![(PLManagedAsset *)self hasAllThumbs])
  {
    photoLibrary2 = [(PLManagedObject *)self photoLibrary];
    effectiveThumbnailIndex = [PLThumbnailIndexes nextAvailableThumbnailIndexInLibrary:photoLibrary2];
  }

  [(PLManagedAsset *)self setEffectiveThumbnailIndex:effectiveThumbnailIndex];
  v26 = PLThumbnailsGetLog();
  v73 = thumbnailManager;
  if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
  {
    [(PLManagedAsset *)self uuid];
    v28 = v27 = dataCopy;
    *buf = 138412546;
    v88 = v28;
    v89 = 2048;
    v90 = effectiveThumbnailIndex;
    _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_DEBUG, "[RM]: setting effective thumbnail index for %@ at index %lu", buf, 0x16u);

    dataCopy = v27;
    thumbnailManager = v73;
  }

  v70 = thumbnailImageCopy;
  if (![(PLManagedAsset *)self isVideo])
  {
    goto LABEL_16;
  }

  photoLibrary3 = [(PLManagedObject *)self photoLibrary];
  if ([photoLibrary3 isCloudPhotoLibraryEnabled])
  {
    isCloudSharedAsset = [(PLManagedAsset *)self isCloudSharedAsset];

    if (isCloudSharedAsset || [(PLManagedAsset *)self hasLargerThanThumbResourceLocal])
    {
LABEL_16:
      v31 = 0;
      goto LABEL_19;
    }

    photoLibrary3 = [(PLManagedAsset *)self pathForVideoFile];
    if (photoLibrary3)
    {
      defaultManager = [MEMORY[0x1E696AC08] defaultManager];
      v49 = dataCopy;
      v50 = [defaultManager fileExistsAtPath:photoLibrary3 isDirectory:0];

      v31 = v50 ^ 1;
      dataCopy = v49;
      thumbnailManager = v73;
    }

    else
    {
      v31 = 1;
    }
  }

  else
  {
    v31 = 0;
  }

LABEL_19:
  v86 = 0;
  if ((![(PLManagedAsset *)self isVideo]|| ![(PLManagedAsset *)self isBundleScopeSyndication]) && ![(PLManagedAsset *)self isPhoto]&& (([(PLManagedAsset *)self isStreamedVideo]| v31) & 1) == 0 && ![(PLManagedAsset *)self hasUnrenderedAsyncAdjustments])
  {
    if (![(PLManagedAsset *)self isVideo])
    {
      v41 = v70;
      goto LABEL_54;
    }

    if (imageCopy && v70)
    {
      v40 = 0;
      v41 = v70;
    }

    else
    {
      v61 = dataCopy;
      pathForVideoFile = [(PLManagedAsset *)self pathForVideoFile];
      v82 = v70;
      v83 = imageCopy;
      v81[0] = MEMORY[0x1E69E9820];
      v81[1] = 3221225472;
      v81[2] = __205__PLManagedAsset_generateAndUpdateThumbnailsWithPreviewImage_thumbnailImage_fromImageSource_imageData_metadata_forceSRGBConversion_forFinalCameraImage_saveCameraPreviewWellImage_reduceProcessingForIngest___block_invoke;
      v81[3] = &unk_1E75676F8;
      v81[4] = self;
      PLPreviewImageAndDurationForVideoAtPathWithPreferredTime(0, pathForVideoFile, &v83, &v82, v81);
      v63 = v83;

      v41 = v82;
      if (v63)
      {
        v40 = 0;
        imageCopy = v63;
        dataCopy = v61;
      }

      else
      {
        v64 = [(PLManagedAsset *)self imageDataForThumbGenerationAndIfNeededRAWUTI:0 isPreviewSource:0];
        v40 = v64;
        if (v64)
        {
          v65 = v64;
          imageCopy = DCIM_newPLImageWithData();
        }

        else
        {
          imageCopy = 0;
        }

        dataCopy = v61;
      }
    }

    pathForVideoPreviewFile = [(PLManagedAsset *)self pathForVideoPreviewFile];
    PLWriteImageWithEmbeddedThumbnailToPath(imageCopy, v41, pathForVideoPreviewFile);

    fileURLForThumbnailFile = [(PLManagedAsset *)self fileURLForThumbnailFile];
    [PLManagedAsset createTHMFileWithPreviewImage:imageCopy thumbnailImage:v41 fileURLForThumbnailFile:fileURLForThumbnailFile];
    thumbnailManager = v73;
    goto LABEL_43;
  }

  sourceCopy = source;
  if (!source)
  {
    if (dataCopy)
    {
      v33 = 0;
      v34 = 0;
    }

    else
    {
      v85 = 0;
      dataCopy = [(PLManagedAsset *)self imageDataForThumbGenerationAndIfNeededRAWUTI:&v85 isPreviewSource:&v86];
      v37 = v85;
      v34 = v37;
      if (!dataCopy)
      {
        v36 = 0;
LABEL_36:

        sourceCopy = v36;
        goto LABEL_37;
      }

      if (v37)
      {
        v93 = *MEMORY[0x1E696E118];
        v94[0] = v37;
        v33 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v94 forKeys:&v93 count:1];
      }

      else
      {
        v33 = 0;
      }
    }

    v35 = CGImageSourceCreateWithData(dataCopy, v33);
    if (v35)
    {
      v36 = v35;
      CFAutorelease(v35);
    }

    else
    {
      v36 = 0;
      v75 = dataCopy;
      v38 = PLThumbnailsGetLog();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        v68 = [(__CFData *)v75 length];
        _compactDebugDescription = [(PLManagedAsset *)self _compactDebugDescription];
        *buf = 134218498;
        v88 = v75;
        thumbnailManager = v73;
        v89 = 2048;
        v90 = v68;
        v91 = 2114;
        v92 = _compactDebugDescription;
        _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_ERROR, "Unable to generate image source from data %p (length %lu) for asset %{public}@", buf, 0x20u);
      }

      dataCopy = v75;
    }

    goto LABEL_36;
  }

LABEL_37:
  source = sourceCopy;
  if (imageCopy || ingest)
  {
    LOBYTE(v67) = v86;
    [PLManagedAsset generateThumbnailsWithImageSource:"generateThumbnailsWithImageSource:imageData:metadata:allowMediumPreview:forceSRGBConversion:forFinalCameraImage:outSmallThumbnailData:isPreviewSource:" imageData:0 metadata:v67 allowMediumPreview:? forceSRGBConversion:? forFinalCameraImage:? outSmallThumbnailData:? isPreviewSource:?];
    fileURLForThumbnailFile = 0;
    if (!v31)
    {
      goto LABEL_40;
    }
  }

  else
  {
    v84 = 0;
    LOBYTE(v67) = v86;
    [PLManagedAsset generateThumbnailsWithImageSource:"generateThumbnailsWithImageSource:imageData:metadata:allowMediumPreview:forceSRGBConversion:forFinalCameraImage:outSmallThumbnailData:isPreviewSource:" imageData:&v84 metadata:v67 allowMediumPreview:? forceSRGBConversion:? forFinalCameraImage:? outSmallThumbnailData:? isPreviewSource:?];
    fileURLForThumbnailFile = v84;
    imageCopy = DCIM_newPLImageWithData();
    if (!v31)
    {
LABEL_40:
      v40 = fileURLForThumbnailFile;
      v41 = v70;
      goto LABEL_43;
    }
  }

  [(PLManagedAsset *)self fileURLForThumbnailFile];
  v43 = v42 = dataCopy;
  v41 = v70;
  [PLManagedAsset createTHMFileWithPreviewImage:imageCopy thumbnailImage:v70 fileURLForThumbnailFile:v43];

  dataCopy = v42;
  thumbnailManager = v73;
  v40 = fileURLForThumbnailFile;
LABEL_43:

  if (v40)
  {
    v44 = [PLImageContainer alloc];
    v45 = 0;
LABEL_45:
    identifier = [*MEMORY[0x1E6982E58] identifier];
    v47 = [(PLImageContainer *)v44 initWithPLImage:imageCopy backingData:v40 uniformTypeIdentifier:identifier auxiliaryImageRecords:v45];

    goto LABEL_61;
  }

LABEL_54:
  v40 = DCIM_storedJPEGDataFromImage();
  v45 = [MEMORY[0x1E69C0708] auxiliaryImageRecordsToPreserveForDerivativesFromPrimaryImageInImageSource:source];
  if (imageCopy | v40)
  {
    v44 = [PLImageContainer alloc];
    if (v40)
    {
      goto LABEL_45;
    }
  }

  else
  {
    v51 = PLThumbnailsGetLog();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
    {
      _compactDebugDescription2 = [(PLManagedAsset *)self _compactDebugDescription];
      *buf = 138543362;
      v88 = _compactDebugDescription2;
      _os_log_impl(&dword_19BF1F000, v51, OS_LOG_TYPE_ERROR, "Missing preview image and data to set as thumbnail for asset %{public}@", buf, 0xCu);
    }

    v44 = [PLImageContainer alloc];
  }

  v47 = [(PLImageContainer *)v44 initWithPLImage:imageCopy backingData:0 uniformTypeIdentifier:0 auxiliaryImageRecords:v45];
  v40 = 0;
LABEL_61:
  [thumbnailManager setThumbnailsForAsset:self withImage:v47];
  if (wellImage)
  {
    photoLibrary4 = [(PLManagedObject *)self photoLibrary];
    libraryServicesManager = [photoLibrary4 libraryServicesManager];
    if (![libraryServicesManager isSystemPhotoLibrary] || !PLCameraPreviewWellSupportedOnCurrentDevice())
    {
LABEL_75:

      goto LABEL_76;
    }

    [(PLManagedObject *)self photoLibrary];
    v55 = v76 = dataCopy;
    [v55 thumbnailManager];
    v56 = v41;
    v58 = v57 = imageCopy;
    isRebuildingThumbnails = [v58 isRebuildingThumbnails];

    imageCopy = v57;
    v41 = v56;
    thumbnailManager = v73;

    dataCopy = v76;
    if ((isRebuildingThumbnails & 1) == 0)
    {
      photoLibrary4 = [(PLManagedObject *)self photoLibrary];
      libraryServicesManager2 = [photoLibrary4 libraryServicesManager];
      libraryServicesManager = [libraryServicesManager2 cameraPreviewWellManager];

      if ([libraryServicesManager shouldReconsiderCameraPreviewWellImageForUpdatedAsset:self thumbnailWasGenerated:1])
      {
        managedObjectContext = [photoLibrary4 managedObjectContext];
        if ([photoLibrary4 pendingTransactions])
        {
          v78[0] = MEMORY[0x1E69E9820];
          v78[1] = 3221225472;
          v78[2] = __205__PLManagedAsset_generateAndUpdateThumbnailsWithPreviewImage_thumbnailImage_fromImageSource_imageData_metadata_forceSRGBConversion_forFinalCameraImage_saveCameraPreviewWellImage_reduceProcessingForIngest___block_invoke_431;
          v78[3] = &unk_1E7578848;
          v79 = libraryServicesManager;
          v80 = managedObjectContext;
          [photoLibrary4 addCompletionHandlerToCurrentTransaction:v78];
        }

        else
        {
          [libraryServicesManager refreshPreviewWellImageWithContext:managedObjectContext avoidNotificationIfLinkIsAlreadySet:0];
        }

        thumbnailManager = v73;
      }

      else
      {
        thumbnailManager = v73;
      }

      goto LABEL_75;
    }
  }

LABEL_76:

  objc_autoreleasePoolPop(context);
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data metadata:(id)metadata forceSRGBConversion:(BOOL)conversion saveCameraPreviewWellImage:(BOOL)wellImage
{
  BYTE2(v9) = 0;
  BYTE1(v9) = wellImage;
  LOBYTE(v9) = 0;
  [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:image fromImageSource:thumbnailImage imageData:source metadata:data forceSRGBConversion:metadata forFinalCameraImage:conversion saveCameraPreviewWellImage:v9 reduceProcessingForIngest:?];
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data forceSRGBConversion:(BOOL)conversion reduceProcessingForIngest:(BOOL)ingest
{
  BYTE2(v8) = ingest;
  LOWORD(v8) = 256;
  [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:image fromImageSource:thumbnailImage imageData:source metadata:data forceSRGBConversion:0 forFinalCameraImage:conversion saveCameraPreviewWellImage:v8 reduceProcessingForIngest:?];
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fromImageSource:(CGImageSource *)source imageData:(id)data forceSRGBConversion:(BOOL)conversion
{
  BYTE2(v7) = 0;
  LOWORD(v7) = 256;
  [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:image fromImageSource:thumbnailImage imageData:source metadata:data forceSRGBConversion:0 forFinalCameraImage:conversion saveCameraPreviewWellImage:v7 reduceProcessingForIngest:?];
}

- (void)setThumbnailDataFromImageProperties:(id)properties
{
  v12 = [properties objectForKey:*MEMORY[0x1E696D9B0]];
  v4 = [v12 objectForKey:*MEMORY[0x1E696E060]];
  v5 = [v12 objectForKey:*MEMORY[0x1E696E068]];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setEmbeddedThumbnailOffset:v4];

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes2 setEmbeddedThumbnailLength:v5];

  v8 = [v12 objectForKey:@"JPEGInterchangeFormatWidth"];
  v9 = [v12 objectForKey:@"JPEGInterchangeFormatHeight"];
  additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes3 setEmbeddedThumbnailWidth:v8];

  additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes4 setEmbeddedThumbnailHeight:v9];
}

- (id)thumbnailIdentifier
{
  uuid = [(PLManagedAsset *)self uuid];
  directory = [(PLManagedAsset *)self directory];
  filename = [(PLManagedAsset *)self filename];
  bundleScope = [(PLManagedAsset *)self bundleScope];
  pathManager = [(PLManagedObject *)self pathManager];
  v8 = [PLThumbnailManager thumbnailIdentifierWithAssetUUID:uuid directory:directory filename:filename bundleScope:bundleScope pathManager:pathManager];

  return v8;
}

- (BOOL)hasMasterThumb
{
  v3 = objc_opt_class();
  thumbnailIndex = [(PLManagedAsset *)self thumbnailIndex];

  return [v3 hasMasterThumbWithThumbnailIndex:thumbnailIndex];
}

- (BOOL)hasAllThumbs
{
  v3 = objc_opt_class();
  thumbnailIndex = [(PLManagedAsset *)self thumbnailIndex];

  return [v3 hasAllThumbsWithThumbnailIndex:thumbnailIndex];
}

- (void)setEffectiveThumbnailIndex:(unint64_t)index
{
  thumbnailIndex = [(PLManagedAsset *)self thumbnailIndex];
  if (index > 0x989680)
  {
    index = 0xFFFFFFFFLL;
  }

  else
  {
    index = index;
  }

  [(PLManagedAsset *)self setThumbnailIndex:index];
  if ((index & 0x80000000) != 0 || thumbnailIndex != -2)
  {

    [(PLManagedAsset *)self recalculateImageRequestHints];
  }

  else
  {

    [(PLManagedAsset *)self insertTableThumbImageRequestHints];
  }
}

- (unint64_t)effectiveThumbnailIndex
{
  LODWORD(result) = [(PLManagedAsset *)self thumbnailIndex];
  if ((result & 0x80000000) != 0)
  {
    return 0x7FFFFFFFFFFFFFFFLL;
  }

  else
  {
    return result;
  }
}

- (unint64_t)syndicationProcessingVersion
{
  mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
  syndicationProcessingVersion = [mediaAnalysisAttributes syndicationProcessingVersion];

  return syndicationProcessingVersion;
}

- (unsigned)syndicationProcessingValue
{
  mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
  syndicationProcessingValue = [mediaAnalysisAttributes syndicationProcessingValue];

  return syndicationProcessingValue;
}

- (id)mediaAnalysisAttributesInsertingIfNecessary
{
  v10 = *MEMORY[0x1E69E9840];
  mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
  if (!mediaAnalysisAttributes)
  {
    v4 = PLBackendGetLog();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_FAULT))
    {
      uuidDescription = [(PLManagedAsset *)self uuidDescription];
      v8 = 138412290;
      v9 = uuidDescription;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_FAULT, "mediaAnalysisAttributes is unexpectedly nil for asset: %@", &v8, 0xCu);
    }

    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    mediaAnalysisAttributes = [(PLManagedObject *)PLMediaAnalysisAssetAttributes insertInManagedObjectContext:managedObjectContext];

    [(PLManagedAsset *)self setMediaAnalysisAttributes:mediaAnalysisAttributes];
  }

  return mediaAnalysisAttributes;
}

- (unsigned)syndicationHistory
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationHistory = [additionalAttributes syndicationHistory];

  return syndicationHistory;
}

- (void)setImportedByBundleIdentifier:(id)identifier
{
  identifierCopy = identifier;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setImportedByBundleIdentifier:identifierCopy];
}

- (NSString)importedByBundleIdentifier
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  importedByBundleIdentifier = [additionalAttributes importedByBundleIdentifier];

  return importedByBundleIdentifier;
}

- (void)setShiftedLocationIsValid:(BOOL)valid
{
  validCopy = valid;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setShiftedLocationIsValid:validCopy];
}

- (BOOL)shiftedLocationIsValid
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  shiftedLocationIsValid = [additionalAttributes shiftedLocationIsValid];

  return shiftedLocationIsValid;
}

- (void)setShiftedLocation:(id)location
{
  locationCopy = location;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setShiftedLocation:locationCopy];
}

- (CLLocation)shiftedLocation
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  shiftedLocation = [additionalAttributes shiftedLocation];

  return shiftedLocation;
}

- (void)setImportedBy:(signed __int16)by
{
  byCopy = by;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setImportedBy:byCopy];
}

- (signed)importedBy
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  importedBy = [additionalAttributes importedBy];

  return importedBy;
}

- (void)setPlaceAnnotationData:(id)data
{
  dataCopy = data;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setPlaceAnnotationData:dataCopy];
}

- (NSData)placeAnnotationData
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  placeAnnotationData = [additionalAttributes placeAnnotationData];

  return placeAnnotationData;
}

- (void)setReverseLocationDataIsValid:(BOOL)valid
{
  validCopy = valid;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithBool:validCopy];
  [additionalAttributes setReverseLocationDataIsValid:v4];
}

- (BOOL)reverseLocationDataIsValid
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  reverseLocationDataIsValid = [additionalAttributes reverseLocationDataIsValid];
  bOOLValue = [reverseLocationDataIsValid BOOLValue];

  return bOOLValue;
}

- (void)setReverseLocationData:(id)data
{
  dataCopy = data;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setReverseLocationData:dataCopy];
}

- (NSData)reverseLocationData
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  reverseLocationData = [additionalAttributes reverseLocationData];

  return reverseLocationData;
}

- (void)_handleHighlightRelationshipChangeForKey:(id)key forAssetCountKey:(id)countKey newValue:(id)value
{
  keyCopy = key;
  countKeyCopy = countKey;
  valueCopy = value;
  if (keyCopy)
  {
    if (countKeyCopy)
    {
      goto LABEL_3;
    }
  }

  else
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:1181 description:{@"Invalid parameter not satisfying: %@", @"key"}];

    if (countKeyCopy)
    {
      goto LABEL_3;
    }
  }

  currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
  [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:1182 description:{@"Invalid parameter not satisfying: %@", @"countKey"}];

LABEL_3:
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  hasLibraryScope = [(PLManagedAsset *)self hasLibraryScope];
  libraryScopeShareState = [(PLManagedAsset *)self libraryScopeShareState];
  v15 = 1;
  if (libraryScopeShareState > 65537)
  {
    if (libraryScopeShareState != 65538 && libraryScopeShareState != 65552)
    {
      goto LABEL_9;
    }
  }

  else if (libraryScopeShareState != 2 && libraryScopeShareState != 16)
  {
LABEL_9:
    v15 = 0;
  }

  libraryServicesManager = [photoLibrary libraryServicesManager];
  databaseContext = [libraryServicesManager databaseContext];
  momentLibrary = [databaseContext momentLibrary];
  v19 = photoLibrary == momentLibrary;

  v25[0] = MEMORY[0x1E69E9820];
  v25[1] = 3221225472;
  v25[2] = __85__PLManagedAsset__handleHighlightRelationshipChangeForKey_forAssetCountKey_newValue___block_invoke;
  v25[3] = &unk_1E75676D0;
  v30 = v19;
  v31 = hasLibraryScope;
  v32 = v15;
  v26 = keyCopy;
  selfCopy = self;
  v28 = valueCopy;
  v29 = countKeyCopy;
  v20 = countKeyCopy;
  v21 = valueCopy;
  v22 = keyCopy;
  [(PLManagedObject *)self pl_safeSetValue:v21 forKey:v22 valueDidChangeHandler:v25];
}

void __85__PLManagedAsset__handleHighlightRelationshipChangeForKey_forAssetCountKey_newValue___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 64) == 1)
  {
    v10 = v3;
    v4 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
    [(PLSharedAssetsContainerIncrementalChange *)v4 setCollectionChangeType:1];
    if (*(a1 + 65))
    {
      v5 = 1;
    }

    else
    {
      v5 = 2;
    }

    [(PLSharedAssetsContainerIncrementalChange *)v4 setSharingChange:v5];
    if ([*(a1 + 32) isEqual:@"highlightBeingAssets"])
    {
      if (*(a1 + 66))
      {
        v6 = 1;
      }

      else
      {
        v6 = 2;
      }

      [(PLSharedAssetsContainerIncrementalChange *)v4 setSuggestionStateChange:v6];
    }

    -[PLSharedAssetsContainerIncrementalChange setMediaType:](v4, "setMediaType:", [*(a1 + 40) kind] != 0);
    [*(a1 + 48) reportSharedAssetContainerIncrementalChange:v4 forAllAssetsCountKey:*(a1 + 56)];

    v3 = v10;
    if (*(a1 + 64))
    {
      v7 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
      [(PLSharedAssetsContainerIncrementalChange *)v7 setCollectionChangeType:2];
      if (*(a1 + 65))
      {
        v8 = 1;
      }

      else
      {
        v8 = 2;
      }

      [(PLSharedAssetsContainerIncrementalChange *)v7 setSharingChange:v8];
      if ([*(a1 + 32) isEqual:@"highlightBeingAssets"])
      {
        if (*(a1 + 66))
        {
          v9 = 1;
        }

        else
        {
          v9 = 2;
        }

        [(PLSharedAssetsContainerIncrementalChange *)v7 setSuggestionStateChange:v9];
      }

      -[PLSharedAssetsContainerIncrementalChange setMediaType:](v7, "setMediaType:", [*(a1 + 40) kind] != 0);
      [v10 reportSharedAssetContainerIncrementalChange:v7 forAllAssetsCountKey:*(a1 + 56)];

      v3 = v10;
    }
  }
}

- (BOOL)isSuggestedForSharingByPhotos
{
  libraryScopeShareState = [(PLManagedAsset *)self libraryScopeShareState];
  result = 1;
  if (libraryScopeShareState > 65537)
  {
    if (libraryScopeShareState != 65538 && libraryScopeShareState != 65552)
    {
      return 0;
    }
  }

  else if (libraryScopeShareState != 2 && libraryScopeShareState != 16)
  {
    return 0;
  }

  return result;
}

- (BOOL)hasLibraryScope
{
  v2 = [(PLManagedAsset *)self objectIDsForRelationshipNamed:@"libraryScope"];
  v3 = [v2 count] != 0;

  return v3;
}

- (NSString)originalFilename
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalFilename = [additionalAttributes originalFilename];

  return originalFilename;
}

- (BOOL)isWalrusEnabled
{
  if ((MEMORY[0x19EAEE520]() & 1) == 0)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:1160 description:{@"Invalid parameter not satisfying: %@", @"PLIsXcTest()"}];
  }

  return 0;
}

- (id)libraryID
{
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryID = [photoLibrary libraryID];

  return libraryID;
}

- (PLManagedAssetID)assetID
{
  assetID = self->_assetID;
  if (!assetID)
  {
    v4 = [[PLManagedAssetID alloc] initWithManagedAsset:self];
    v5 = self->_assetID;
    self->_assetID = v4;

    assetID = self->_assetID;
  }

  return assetID;
}

- (CGSize)unorientedSize
{
  width = [(PLManagedAsset *)self width];
  height = [(PLManagedAsset *)self height];
  orientation = [(PLManagedAsset *)self orientation];
  if (orientation == 8 || orientation == 6)
  {
    v6 = height;
    v7 = width;
    v8 = 1;
LABEL_4:
    v9 = v6;
    goto LABEL_5;
  }

  v10 = orientation - 5;
  v8 = v10 < 4;
  v6 = height;
  v7 = width;
  v9 = width;
  if (v10 <= 3)
  {
    goto LABEL_4;
  }

LABEL_5:
  if (v8)
  {
    v6 = v7;
  }

  result.height = v6;
  result.width = v9;
  return result;
}

- (void)setHeight:(int64_t)height
{
  [(PLManagedAsset *)self willChangeValueForKey:@"height"];
  self->_height = height;

  [(PLManagedAsset *)self didChangeValueForKey:@"height"];
}

- (int64_t)height
{
  [(PLManagedAsset *)self willAccessValueForKey:@"height"];
  height = self->_height;
  [(PLManagedAsset *)self didAccessValueForKey:@"height"];
  return height;
}

- (void)setWidth:(int64_t)width
{
  [(PLManagedAsset *)self willChangeValueForKey:@"width"];
  self->_width = width;

  [(PLManagedAsset *)self didChangeValueForKey:@"width"];
}

- (int64_t)width
{
  [(PLManagedAsset *)self willAccessValueForKey:@"width"];
  width = self->_width;
  [(PLManagedAsset *)self didAccessValueForKey:@"width"];
  return width;
}

- (NSSet)allDetectedFaces
{
  detectedFaces = [(PLManagedAsset *)self detectedFaces];
  v4 = [detectedFaces mutableCopy];

  temporalDetectedFaces = [(PLManagedAsset *)self temporalDetectedFaces];
  [v4 unionSet:temporalDetectedFaces];

  v6 = [v4 copy];

  return v6;
}

- (void)didTurnIntoFault
{
  reverseGeoDescription = self->_reverseGeoDescription;
  self->_reverseGeoDescription = 0;

  self->_isLocatedAtHome = 0;
  self->_didLoadReverseGeo = 0;
  v4.receiver = self;
  v4.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v4 didTurnIntoFault];
}

- (void)willTurnIntoFault
{
  [(PLManagedAsset *)self unregisterForChanges];
  v3.receiver = self;
  v3.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v3 willTurnIntoFault];
}

- (void)awakeFromFetch
{
  v3.receiver = self;
  v3.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v3 awakeFromFetch];
  [(PLManagedAsset *)self registerForChanges];
}

- (void)awakeFromInsert
{
  v8.receiver = self;
  v8.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v8 awakeFromInsert];
  uUIDString = [MEMORY[0x1E69BF320] UUIDString];
  [(PLManagedAsset *)self setUuid:uUIDString];

  [(PLManagedAsset *)self setKind:3];
  [(PLManagedAsset *)self setPlaybackStyle:0];
  [(PLManagedAsset *)self setHdrType:0];
  -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForAwakeFromInsert]);
  [(PLManagedAsset *)self setTrashedState:0];
  date = [MEMORY[0x1E695DF00] date];
  [(PLManagedAsset *)self setAddedDate:date];

  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  v6 = [(PLManagedObject *)PLAdditionalAssetAttributes insertInManagedObjectContext:managedObjectContext];
  if (v6)
  {
    [(PLManagedAsset *)self setAdditionalAttributes:v6];
    v7 = [(PLManagedObject *)PLMediaAnalysisAssetAttributes insertInManagedObjectContext:managedObjectContext];
    if (v7)
    {
      [(PLManagedAsset *)self setMediaAnalysisAttributes:v7];
      [(PLManagedAsset *)self registerForChanges];
      [(PLManagedAsset *)self setComplete:1];
    }
  }
}

- (void)dealloc
{
  [(PLManagedAsset *)self unregisterForChanges];
  reverseGeoDescription = self->_reverseGeoDescription;
  self->_reverseGeoDescription = 0;

  v4.receiver = self;
  v4.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v4 dealloc];
}

+ (id)attributeValidationRules
{
  v84[2] = *MEMORY[0x1E69E9840];
  v2 = objc_alloc_init(MEMORY[0x1E695DF90]);
  date = [MEMORY[0x1E695DF00] date];
  v3 = _PLPropertyValidationRuleMake(5, @"addedDate", 0, 0, date, 0);
  [v2 setObject:v3 forKeyedSubscript:@"addedDate"];

  v4 = _PLPropertyValidationRuleMake(3, @"adjustmentsState", &unk_1F0FBB308, 0, 0, 0);
  v5 = _PLPropertyValidationRuleMake(9, @"adjustmentTimestamp", 0, 0, 0, 0);
  v6 = v4;
  v70 = v4;
  reverseRule = [v4 reverseRule];
  v84[0] = reverseRule;
  v84[1] = v5;
  v69 = v5;
  v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v84 count:2];
  v68 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v8];

  v83[0] = v6;
  reverseRule2 = [v5 reverseRule];
  v83[1] = reverseRule2;
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v83 count:2];
  v67 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v10];

  v82[0] = v68;
  v82[1] = v67;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v82 count:2];
  v12 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v11];
  [v2 setObject:v12 forKeyedSubscript:@"adjustmentTimestamp"];

  v13 = _PLPropertyValidationRuleMake(3, @"complete", MEMORY[0x1E695E118], 0, 0, 0);
  [v2 setObject:v13 forKeyedSubscript:@"complete"];

  v14 = _PLPropertyValidationRuleMake(5, @"dateCreated", 0, 0, date, 0);
  [v2 setObject:v14 forKeyedSubscript:@"dateCreated"];

  v15 = _PLPropertyValidationRuleMake(2, @"directory", 0, 0, 0, 0);
  [v2 setObject:v15 forKeyedSubscript:@"directory"];

  v16 = _PLPropertyValidationRuleMake(2, @"filename", 0, 0, 0, 0);
  [v2 setObject:v16 forKeyedSubscript:@"filename"];

  v17 = _PLPropertyValidationRuleMake(6, @"kind", 0, 0, 0, &unk_1F0FBF4C0);
  v66 = _PLPropertyValidationRuleMake(4, @"height", &unk_1F0FBB0B0, 0, 0, 0);
  v65 = _PLPropertyValidationRuleMake(4, @"width", &unk_1F0FBB0B0, 0, 0, 0);
  v81[0] = v17;
  v81[1] = v66;
  v18 = v17;
  v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:v81 count:2];
  v64 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v19];

  v80[0] = v18;
  v80[1] = v65;
  v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v80 count:2];
  v62 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v20];

  v79[0] = v64;
  v21 = v18;
  v63 = v18;
  reverseRule3 = [v18 reverseRule];
  v79[1] = reverseRule3;
  v23 = [MEMORY[0x1E695DEC8] arrayWithObjects:v79 count:2];
  v24 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v23];
  [v2 setObject:v24 forKeyedSubscript:@"height"];

  v78[0] = v62;
  reverseRule4 = [v21 reverseRule];
  v78[1] = reverseRule4;
  v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:v78 count:2];
  v27 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v26];
  [v2 setObject:v27 forKeyedSubscript:@"width"];

  v28 = _PLPropertyValidationRuleMake(6, @"kind", 0, 0, 0, &unk_1F0FBF4D8);
  [v2 setObject:v28 forKeyedSubscript:@"kind"];

  v29 = _PLPropertyValidationRuleMake(6, @"kindSubtype", 0, 0, 0, &unk_1F0FBF4F0);
  [v2 setObject:v29 forKeyedSubscript:@"kindSubtype"];

  v30 = _PLPropertyValidationRuleMake(12, @"lastSharedDate", 0, 0, date, 0);
  [v2 setObject:v30 forKeyedSubscript:@"lastSharedDate"];

  v31 = _PLPropertyValidationRuleMake(12, @"modificationDate", 0, 0, date, 0);
  [v2 setObject:v31 forKeyedSubscript:@"modificationDate"];

  v32 = _PLPropertyValidationRuleMake(5, @"orientation", 0, &unk_1F0FBB308, &unk_1F0FBB398, 0);
  [v2 setObject:v32 forKeyedSubscript:@"orientation"];

  v33 = _PLPropertyValidationRuleMake(6, @"playbackStyle", 0, 0, 0, &unk_1F0FBF508);
  [v2 setObject:v33 forKeyedSubscript:@"playbackStyle"];

  v34 = _PLPropertyValidationRuleMake(6, @"playbackVariation", 0, 0, 0, &unk_1F0FBF520);
  [v2 setObject:v34 forKeyedSubscript:@"playbackVariation"];

  v61 = [MEMORY[0x1E69BF328] predicateArrayArgumentForMask:{objc_msgSend(MEMORY[0x1E69BF328], "maskForValidSavedAssetTypesDuringMacMigration")}];
  v35 = _PLPropertyValidationRuleMake(6, @"savedAssetType", 0, 0, 0, v61);
  [v2 setObject:v35 forKeyedSubscript:@"savedAssetType"];

  v36 = _PLPropertyValidationRuleMake(3, @"trashedState", &unk_1F0FBB110, 0, 0, 0);
  v37 = _PLPropertyValidationRuleMake(9, @"trashedDate", 0, 0, 0, 0);
  v77[0] = v36;
  v77[1] = v37;
  v60 = v36;
  v38 = [MEMORY[0x1E695DEC8] arrayWithObjects:v77 count:2];
  v59 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v38];

  reverseRule5 = [v36 reverseRule];
  v76[0] = reverseRule5;
  reverseRule6 = [v37 reverseRule];
  v76[1] = reverseRule6;
  v41 = [MEMORY[0x1E695DEC8] arrayWithObjects:v76 count:2];
  v58 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v41];

  v75[0] = v59;
  v75[1] = v58;
  v42 = [MEMORY[0x1E695DEC8] arrayWithObjects:v75 count:2];
  v43 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v42];
  [v2 setObject:v43 forKeyedSubscript:@"trashedDate"];

  v44 = _PLPropertyValidationRuleMake(6, @"trashedState", 0, 0, 0, &unk_1F0FBF538);
  [v2 setObject:v44 forKeyedSubscript:@"trashedState"];

  v45 = _PLPropertyValidationRuleMake(2, @"uniformTypeIdentifier", 0, 0, 0, 0);
  [v2 setObject:v45 forKeyedSubscript:@"uniformTypeIdentifier"];

  v46 = _PLPropertyValidationRuleMake(2, @"uuid", 0, 0, 0, 0);
  [v2 setObject:v46 forKeyedSubscript:@"uuid"];

  v47 = _PLPropertyValidationRuleMake(3, @"kindSubtype", &unk_1F0FBB0E0, 0, 0, 0);
  v48 = _PLPropertyValidationRuleMake(3, @"videoCpDurationValue", &unk_1F0FBB0B0, 0, 0, 0);
  v74[0] = v47;
  reverseRule7 = [v48 reverseRule];
  v74[1] = reverseRule7;
  v50 = [MEMORY[0x1E695DEC8] arrayWithObjects:v74 count:2];
  v51 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v50];

  reverseRule8 = [v47 reverseRule];
  v73[0] = reverseRule8;
  v73[1] = v48;
  v53 = [MEMORY[0x1E695DEC8] arrayWithObjects:v73 count:2];
  v54 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v53];

  v72[0] = v51;
  v72[1] = v54;
  v55 = [MEMORY[0x1E695DEC8] arrayWithObjects:v72 count:2];
  v56 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v55];
  [v2 setObject:v56 forKeyedSubscript:@"videoCpDurationValue"];

  return v2;
}

+ (void)batchFetchAssetsByFaceUUIDWithFaceUUIDs:(id)ds library:(id)library completion:(id)completion
{
  dsCopy = ds;
  libraryCopy = library;
  completionCopy = completion;
  if (!completionCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:12130 description:@"Completion handler is mandatory"];
  }

  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke;
  v16[3] = &unk_1E7576F38;
  v17 = libraryCopy;
  v18 = dsCopy;
  v19 = completionCopy;
  v12 = completionCopy;
  v13 = dsCopy;
  v14 = libraryCopy;
  [v14 performBlockAndWait:v16];
}

void __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke(uint64_t a1)
{
  v14[1] = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) managedObjectContext];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", @"uuid", *(a1 + 40)];
  v4 = MEMORY[0x1E695D5E0];
  v5 = +[PLDetectedFace entityName];
  v6 = [v4 fetchRequestWithEntityName:v5];

  v14[0] = @"assetForFace";
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v14 count:1];
  [v6 setRelationshipKeyPathsForPrefetching:v7];

  [v6 setPredicate:v3];
  v8 = [MEMORY[0x1E695DF90] dictionary];
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke_2;
  v12[3] = &unk_1E75770B8;
  v9 = v8;
  v13 = v9;
  v10 = [v2 enumerateObjectsFromFetchRequest:v6 count:0 usingDefaultBatchSizeWithBlock:v12];
  if (v10)
  {
    (*(*(a1 + 48) + 16))();
  }

  else
  {
    v11 = [objc_alloc(MEMORY[0x1E695DF20]) initWithDictionary:v9];
    (*(*(a1 + 48) + 16))();
  }
}

void __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = [v5 associatedAssetForFaceOrTorso:1 orTemporal:1];
  if (v3)
  {
    v4 = [v5 uuid];
    [*(a1 + 32) setObject:v3 forKey:v4];
  }
}

+ (id)uuidFromAssetURL:(id)l fileExtension:(id *)extension sidecarIndex:(id *)index
{
  v46 = *MEMORY[0x1E69E9840];
  lCopy = l;
  v8 = objc_autoreleasePoolPush();
  scheme = [lCopy scheme];
  if ([scheme isEqualToString:@"assets-library"])
  {
    host = [lCopy host];
    v11 = [host isEqualToString:@"asset"];

    if (!v11)
    {
      goto LABEL_26;
    }

    scheme = [lCopy query];
    if ([scheme length] >= 0x65)
    {

      objc_autoreleasePoolPop(v8);
      v29 = 0;
      goto LABEL_32;
    }

    v12 = [scheme componentsSeparatedByString:@"&"];
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v44 = 0u;
    v13 = [v12 countByEnumeratingWithState:&v41 objects:v45 count:16];
    if (v13)
    {
      v14 = v13;
      v33 = scheme;
      v34 = v8;
      extensionCopy = extension;
      indexCopy = index;
      v37 = lCopy;
      v38 = v12;
      v39 = 0;
      v15 = 0;
      v16 = 0;
      v17 = *v42;
      while (1)
      {
        v18 = 0;
        do
        {
          if (*v42 != v17)
          {
            objc_enumerationMutation(v12);
          }

          v19 = [*(*(&v41 + 1) + 8 * v18) componentsSeparatedByString:{@"=", v33}];
          if ([v19 count] >= 2)
          {
            v20 = [v19 objectAtIndex:0];
            v21 = [v19 objectAtIndex:1];
            if ([v20 isEqualToString:@"id"])
            {
              v22 = v16;
              v16 = v21;
              goto LABEL_14;
            }

            if ([v20 isEqualToString:@"ext"])
            {
              v22 = v15;
              v15 = v21;
              goto LABEL_14;
            }

            if ([v20 isEqualToString:@"sci"])
            {
              v22 = [MEMORY[0x1E696AE88] scannerWithString:v21];
              v40 = 0;
              if ([v22 scanInt:&v40])
              {
                [MEMORY[0x1E696AD98] numberWithInt:v40];
                v23 = v16;
                v25 = v24 = v15;

                v39 = v25;
                v15 = v24;
                v16 = v23;
                v12 = v38;
              }

LABEL_14:
            }
          }

          ++v18;
        }

        while (v14 != v18);
        v26 = [v12 countByEnumeratingWithState:&v41 objects:v45 count:16];
        v14 = v26;
        if (!v26)
        {
          v27 = v15;

          index = indexCopy;
          lCopy = v37;
          v8 = v34;
          extension = extensionCopy;
          v28 = v39;
          goto LABEL_27;
        }
      }
    }
  }

LABEL_26:
  v28 = 0;
  v27 = 0;
  v16 = 0;
LABEL_27:
  objc_autoreleasePoolPop(v8);
  if (extension)
  {
    v30 = v27;
    *extension = v27;
  }

  if (index)
  {
    v31 = v28;
    *index = v28;
  }

  v29 = v16;

LABEL_32:

  return v29;
}

+ (id)fileURLFromAssetURL:(id)l photoLibrary:(id)library
{
  lCopy = l;
  libraryCopy = library;
  v8 = objc_autoreleasePoolPush();
  v14 = 0;
  v9 = [self photoFromAssetURL:lCopy photoLibrary:libraryCopy sidecar:&v14];
  v10 = v14;
  v11 = v10;
  if (v10)
  {
    [v10 fileURL];
  }

  else
  {
    [v9 mainFileURL];
  }
  v12 = ;

  objc_autoreleasePoolPop(v8);

  return v12;
}

+ (id)photoFromAssetURL:(id)l photoLibrary:(id)library sidecar:(id *)sidecar
{
  v24 = *MEMORY[0x1E69E9840];
  lCopy = l;
  libraryCopy = library;
  v10 = objc_autoreleasePoolPush();
  scheme = [lCopy scheme];
  if (([scheme isEqualToString:@"assets-library"] & 1) == 0)
  {

    goto LABEL_11;
  }

  host = [lCopy host];
  v13 = [host isEqualToString:@"asset"];

  if (!v13)
  {
LABEL_11:
    objc_autoreleasePoolPop(v10);
    v17 = 0;
    goto LABEL_12;
  }

  v20 = 0;
  v21 = 0;
  v14 = [self uuidFromAssetURL:lCopy fileExtension:&v21 sidecarIndex:&v20];
  v15 = v21;
  v16 = v20;
  if (![v14 length] || (objc_msgSend(objc_opt_class(), "assetWithUUID:inLibrary:", v14, libraryCopy), (v17 = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v18 = PLBackendGetLog();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543362;
      v23 = v14;
      _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Could not find asset with UUID %{public}@", buf, 0xCu);
    }

    v17 = 0;
  }

  objc_autoreleasePoolPop(v10);
  if (sidecar)
  {
    *sidecar = 0;
  }

LABEL_12:

  return v17;
}

+ (id)assetsLibraryURLWithUUID:(id)d extension:(id)extension
{
  v4 = MEMORY[0x1E695DFF8];
  extension = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@://%@/%@.%@?%@=%@&%@=%@", @"assets-library", @"asset", @"asset", extension, @"id", d, @"ext", extension];
  v6 = [v4 URLWithString:extension];

  return v6;
}

+ (id)preferredFileExtensionForType:(id)type
{
  v3 = [MEMORY[0x1E69C08F0] typeWithIdentifier:type];
  v4 = v3;
  if (!v3)
  {
    v6 = PLBackendGetLog();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      *v10 = 0;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "Empty utiType. Default to JPG extension.", v10, 2u);
    }

LABEL_7:
    v5 = @"JPG";
    goto LABEL_17;
  }

  if ([v3 isEqual:*MEMORY[0x1E6983008]])
  {
    v5 = @"TIF";
    goto LABEL_17;
  }

  if ([v4 isEqual:*MEMORY[0x1E6982F28]])
  {
    v5 = @"PNG";
    goto LABEL_17;
  }

  if (([v4 isEqual:*MEMORY[0x1E6982DE8]] & 1) == 0)
  {
    if (([v4 isEqual:*MEMORY[0x1E6982E58]] & 1) == 0)
    {
      v7 = [MEMORY[0x1E69C08F0] preferredOrFallbackFilenameExtensionForType:v4];
      uppercaseString = [v7 uppercaseString];

      if (uppercaseString)
      {
        v5 = uppercaseString;
      }

      else
      {
        v5 = @"JPG";
      }

      goto LABEL_17;
    }

    goto LABEL_7;
  }

  v5 = @"GIF";
LABEL_17:

  return v5;
}

+ (BOOL)isKnownFileExtension:(id)extension
{
  uppercaseString = [extension uppercaseString];
  if ([uppercaseString isEqualToString:@"TIF"] & 1) != 0 || (objc_msgSend(uppercaseString, "isEqualToString:", @"PNG") & 1) != 0 || (objc_msgSend(uppercaseString, "isEqualToString:", @"GIF") & 1) != 0 || (objc_msgSend(uppercaseString, "isEqualToString:", @"JPG"))
  {
    LOBYTE(v4) = 1;
  }

  else
  {
    v6 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:uppercaseString];
    v7 = v6;
    if (v6)
    {
      v4 = [v6 isDynamic] ^ 1;
    }

    else
    {
      LOBYTE(v4) = 0;
    }
  }

  return v4;
}

+ (BOOL)isValidFileURLForImport:(id)import
{
  importCopy = import;
  lastPathComponent = [importCopy lastPathComponent];
  v5 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@.%@", *MEMORY[0x1E69C0028], *MEMORY[0x1E69C0020]];
  v6 = [lastPathComponent hasSuffix:v5];

  if (v6)
  {
    v7 = 0;
  }

  else
  {
    pathExtension = [importCopy pathExtension];
    v7 = [PLManagedAsset isValidFileExtensionForImport:pathExtension];
  }

  return v7;
}

+ (BOOL)isValidFileExtensionForImport:(id)import
{
  importCopy = import;
  v4 = ([importCopy isEqualToString:@"DBG"] & 1) == 0 && !objc_msgSend(importCopy, "isEqualToString:", @"SLM");

  return v4;
}

+ (id)diagnosticFilePathForLibrary:(id)library mainFilename:(id)filename createIfNeeded:(BOOL)needed
{
  neededCopy = needed;
  filenameCopy = filename;
  pathManager = [library pathManager];
  v9 = [pathManager privateDirectoryWithSubType:8 createIfNeeded:neededCopy error:0];

  stringByDeletingPathExtension = [filenameCopy stringByDeletingPathExtension];

  v11 = [stringByDeletingPathExtension stringByAppendingPathExtension:@"DBG"];

  v12 = [v9 stringByAppendingPathComponent:v11];

  return v12;
}

+ (id)pathForAlchemistImageWithUUID:(id)d bundleScope:(unsigned __int16)scope directory:(id)directory filename:(id)filename pathManager:(id)manager
{
  scopeCopy = scope;
  dCopy = d;
  directoryCopy = directory;
  filenameCopy = filename;
  managerCopy = manager;
  if ([managerCopy shouldUseFileIdentifierForBundleScope:scopeCopy])
  {
    v15 = objc_alloc(MEMORY[0x1E69BF298]);
    identifier = [*MEMORY[0x1E6982E00] identifier];
    v17 = [v15 initWithAssetUuid:dCopy bundleScope:scopeCopy uti:identifier resourceVersion:3 resourceType:15 recipeID:66137 originalFilename:0 customSuffix:0];

    v18 = [managerCopy readOnlyUrlWithIdentifier:v17];
    path = [v18 path];
  }

  else
  {
    v17 = [managerCopy assetPathForComputeDirectoryWithDirectory:directoryCopy filename:filenameCopy];
    path = [v17 stringByAppendingPathComponent:@"Alchemist.heic"];
  }

  return path;
}

+ (id)pathForAdjustmentDataFileWithPathManager:(id)manager bundleScope:(unsigned __int16)scope uuid:(id)uuid directory:(id)directory filename:(id)filename
{
  scopeCopy = scope;
  managerCopy = manager;
  uuidCopy = uuid;
  directoryCopy = directory;
  filenameCopy = filename;
  if ([managerCopy shouldUseFileIdentifierForBundleScope:scopeCopy])
  {
    v15 = objc_alloc(MEMORY[0x1E69BF298]);
    identifier = [*MEMORY[0x1E6982D60] identifier];
    v17 = [v15 initWithAssetUuid:uuidCopy bundleScope:0 uti:identifier resourceVersion:2 recipeID:0];

    v18 = [managerCopy readOnlyUrlWithIdentifier:v17];
    [v18 path];
  }

  else
  {
    v17 = [managerCopy assetPathForMutationsDirectoryWithDirectory:directoryCopy filename:filenameCopy];
    v18 = [PLManagedAsset pathForAdjustmentDirectoryWithMutationsDirectory:v17];
    [v18 stringByAppendingPathComponent:@"Adjustments.data"];
  }
  v19 = ;

  return v19;
}

+ (id)pathForAdjustmentFileWithPathManager:(id)manager bundleScope:(unsigned __int16)scope uuid:(id)uuid directory:(id)directory filename:(id)filename
{
  scopeCopy = scope;
  managerCopy = manager;
  uuidCopy = uuid;
  directoryCopy = directory;
  filenameCopy = filename;
  if ([managerCopy shouldUseFileIdentifierForBundleScope:scopeCopy])
  {
    v15 = objc_alloc(MEMORY[0x1E69BF298]);
    identifier = [*MEMORY[0x1E6982F68] identifier];
    v17 = [v15 initWithAssetUuid:uuidCopy bundleScope:0 uti:identifier resourceVersion:2 recipeID:0];

    v18 = [managerCopy readOnlyUrlWithIdentifier:v17];
    [v18 path];
  }

  else
  {
    v17 = [managerCopy assetPathForMutationsDirectoryWithDirectory:directoryCopy filename:filenameCopy];
    v18 = [PLManagedAsset pathForAdjustmentDirectoryWithMutationsDirectory:v17];
    [v18 stringByAppendingPathComponent:@"Adjustments.plist"];
  }
  v19 = ;

  return v19;
}

+ (id)pathForMutationsDirectoryWithDirectory:(id)directory filename:(id)filename
{
  directoryCopy = directory;
  filenameCopy = filename;
  v7 = objc_autoreleasePoolPush();
  systemLibraryPathManager = [MEMORY[0x1E69BF2A0] systemLibraryPathManager];
  v9 = [systemLibraryPathManager assetAbbreviatedMetadataDirectoryForDirectory:directoryCopy type:32 bundleScope:0];
  stringByDeletingPathExtension = [filenameCopy stringByDeletingPathExtension];
  if (v9 && ([v9 length] ? (v11 = stringByDeletingPathExtension == 0) : (v11 = 1), !v11 && objc_msgSend(stringByDeletingPathExtension, "length")))
  {
    v12 = [systemLibraryPathManager photoDirectoryWithType:9];
    v13 = v12;
    if (v12)
    {
      v14 = [v12 stringByAppendingPathComponent:v9];

      v13 = [v14 stringByAppendingPathComponent:stringByDeletingPathExtension];
    }
  }

  else
  {
    v13 = 0;
  }

  objc_autoreleasePoolPop(v7);

  return v13;
}

+ (signed)assetTypeFromUniformTypeIdentifier:(id)identifier
{
  v3 = [MEMORY[0x1E69C08F0] typeWithIdentifier:identifier];
  if ([v3 conformsToType:*MEMORY[0x1E6982EE8]])
  {
    v4 = 1;
  }

  else if ([v3 conformsToType:*MEMORY[0x1E6982E30]] & 1) != 0 || (objc_msgSend(v3, "conformsToType:", *MEMORY[0x1E6982F10]))
  {
    v4 = 0;
  }

  else if ([v3 conformsToType:*MEMORY[0x1E6982CD0]])
  {
    v4 = 2;
  }

  else
  {
    v4 = 3;
  }

  return v4;
}

+ (id)uniformTypeIdentifierFromPathExtension:(id)extension assetType:(signed __int16)type
{
  v4 = [self uniformTypeFromPathExtension:extension assetType:type];
  identifier = [v4 identifier];

  return identifier;
}

+ (id)uniformTypeFromPathExtension:(id)extension assetType:(signed __int16)type
{
  typeCopy = type;
  extensionCopy = extension;
  if (typeCopy > 2)
  {
    v6 = MEMORY[0x1E6982D50];
  }

  else
  {
    v6 = qword_1E7567BE8[typeCopy];
  }

  v7 = *v6;
  v8 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:extensionCopy conformingToType:v7];
  if ([v8 isDynamic])
  {
    v9 = [MEMORY[0x1E6982C40] typeWithFilenameExtension:extensionCopy];

    v8 = v9;
  }

  return v8;
}

+ (BOOL)isScreenRecordingFileName:(id)name
{
  nameCopy = name;
  v4 = ([nameCopy hasPrefix:@"RPReplay"] & 1) != 0 || objc_msgSend(nameCopy, "hasPrefix:", @"ScreenRecording");

  return v4;
}

+ (BOOL)isPrimaryImageFormatForUTI:(id)i
{
  if (!i)
  {
    return 0;
  }

  v3 = [MEMORY[0x1E6982C40] typeWithIdentifier:?];
  v4 = v3;
  if (v3)
  {
    if ([v3 conformsToType:*MEMORY[0x1E6982E58]] & 1) != 0 || (objc_msgSend(v4, "conformsToType:", *MEMORY[0x1E6982E00]))
    {
      v5 = 1;
    }

    else
    {
      v5 = [v4 conformsToType:*MEMORY[0x1E6982E10]];
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

+ (unsigned)defaultPlaybackStyleFromAssetType:(signed __int16)type subtype:(signed __int16)subtype playbackVariation:(unsigned __int16)variation
{
  v5 = 0x3000500050003uLL >> (16 * variation);
  if (variation >= 4u)
  {
    LOWORD(v5) = 0;
  }

  if (subtype == 2)
  {
    v6 = v5;
  }

  else
  {
    v6 = 1;
  }

  if (type)
  {
    v6 = 0;
  }

  if (type == 1)
  {
    v7 = 4;
  }

  else
  {
    v7 = v6;
  }

  if (type == 2)
  {
    return 4;
  }

  else
  {
    return v7;
  }
}

+ (id)allHDRValues
{
  if (allHDRValues_onceToken != -1)
  {
    dispatch_once(&allHDRValues_onceToken, &__block_literal_global_961);
  }

  v3 = allHDRValues_hdrValues;

  return v3;
}

void __30__PLManagedAsset_allHDRValues__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E695DFD8]) initWithObjects:{&unk_1F0FBB0E0, &unk_1F0FBB128, &unk_1F0FBB140, &unk_1F0FBB158, &unk_1F0FBB170, 0}];
  v1 = allHDRValues_hdrValues;
  allHDRValues_hdrValues = v0;
}

+ (signed)imageHDRTypeFromCustomRenderedValue:(signed __int16)value
{
  valueCopy = value;
  if (value - 2 >= 3)
  {
    return 0;
  }

  return valueCopy;
}

+ (signed)imageDepthTypeFromCustomRenderedValue:(signed __int16)value
{
  if (value > 9)
  {
    return 0;
  }

  else
  {
    return word_19C60B864[value];
  }
}

+ (BOOL)guaranteedFlashOffForAssetAtURL:(id)l
{
  v3 = CGImageSourceCreateWithURL(l, 0);
  if (!v3)
  {
    return 0;
  }

  v4 = v3;
  v5 = PLImageSourceCopyPropertiesAtIndexDecodingRawIfNecessary(v3, 0, 0);
  v6 = [(__CFDictionary *)v5 objectForKey:*MEMORY[0x1E696D9B0]];
  v7 = [v6 objectForKey:*MEMORY[0x1E696D9F0]];
  v8 = v7;
  if (v7)
  {
    v9 = ([v7 integerValue] & 1) == 0;
  }

  else
  {
    v9 = 0;
  }

  CFRelease(v4);

  return v9;
}

+ (BOOL)_isLibraryScopeExiting:(id)exiting
{
  exitingCopy = exiting;
  v13 = 0;
  v14 = &v13;
  v15 = 0x2020000000;
  v16 = 0;
  libraryScope = [exitingCopy libraryScope];
  v5 = libraryScope;
  if (libraryScope)
  {
    v6 = [libraryScope exitState] != 0;
    *(v14 + 24) = v6;
  }

  else
  {
    photoLibrary = [exitingCopy photoLibrary];
    v10[0] = MEMORY[0x1E69E9820];
    v10[1] = 3221225472;
    v10[2] = __41__PLManagedAsset__isLibraryScopeExiting___block_invoke;
    v10[3] = &unk_1E7578910;
    v8 = photoLibrary;
    v11 = v8;
    v12 = &v13;
    [v8 performBlockAndWait:v10];

    v6 = *(v14 + 24);
  }

  _Block_object_dispose(&v13, 8);
  return v6 & 1;
}

void __41__PLManagedAsset__isLibraryScopeExiting___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLLibraryScope entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"exitState", 0];
  [v4 setPredicate:v5];

  [v4 setResultType:4];
  v6 = [*(a1 + 32) managedObjectContext];
  v10 = 0;
  v7 = [v6 countForFetchRequest:v4 error:&v10];
  v8 = v10;

  if (v7 == 1)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
  }

  else if (v7 == 0x7FFFFFFFFFFFFFFFLL)
  {
    v9 = PLPhotoKitGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      *buf = 136315394;
      v12 = "+[PLManagedAsset _isLibraryScopeExiting:]_block_invoke";
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "Failed to fetch exit library scope for %s: %@", buf, 0x16u);
    }
  }
}

+ (BOOL)isHFRVideoAVAsset:(id)asset
{
  v3 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:asset];
  if ([v3 count])
  {
    v4 = [v3 objectAtIndex:0];
    [v4 nominalFrameRate];
    v6 = v5 >= 105.0;
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

+ (CGSize)dimensionsForAVAsset:(id)asset
{
  width = *MEMORY[0x1E695F060];
  height = *(MEMORY[0x1E695F060] + 8);
  if (asset)
  {
    v5 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:asset];
    if ([v5 count])
    {
      v6 = [v5 objectAtIndex:0];
      [v6 naturalSize];
      v8 = v7;
      v10 = v9;
      if (v6)
      {
        [v6 preferredTransform];
      }

      v14.size.width = v10 * 0.0 + 0.0 * v8;
      v14.size.height = v14.size.width;
      v14.origin.x = 0.0;
      v14.origin.y = 0.0;
      v15 = CGRectStandardize(v14);
      width = v15.size.width;
      height = v15.size.height;
    }
  }

  v11 = width;
  v12 = height;
  result.height = v12;
  result.width = v11;
  return result;
}

+ (CGSize)dimensionsForVideoAtURL:(id)l
{
  v3 = [MEMORY[0x1E6987E28] assetWithURL:l];
  [PLManagedAsset dimensionsForAVAsset:v3];
  v5 = v4;
  v7 = v6;

  v8 = v5;
  v9 = v7;
  result.height = v9;
  result.width = v8;
  return result;
}

+ (CGSize)sizeOfImageAtURL:(id)l outOrientation:(signed __int16 *)orientation
{
  v36 = *MEMORY[0x1E69E9840];
  lCopy = l;
  longLongValue = *MEMORY[0x1E695F060];
  longLongValue2 = *(MEMORY[0x1E695F060] + 8);
  v29 = 0;
  v9 = [objc_alloc(MEMORY[0x1E695DEF0]) initWithContentsOfURL:lCopy options:1 error:&v29];
  v10 = v29;
  if ([v9 length])
  {
    v11 = v10 == 0;
  }

  else
  {
    v11 = 0;
  }

  if (!v11)
  {
    v12 = PLBackendGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v33 = lCopy;
      v34 = 2112;
      v35 = v10;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Unable to read imageData from file '%@'. Error: %@", buf, 0x16u);
    }

    goto LABEL_26;
  }

  orientationCopy = orientation;
  context = objc_autoreleasePoolPush();
  v13 = MEMORY[0x1E69C08F0];
  pathExtension = [lCopy pathExtension];
  v15 = [v13 typeWithIdentifier:pathExtension];

  if (v15)
  {
    v30 = *MEMORY[0x1E696E118];
    identifier = [v15 identifier];
    v31 = identifier;
    v17 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v31 forKeys:&v30 count:1];
  }

  else
  {
    v17 = 0;
  }

  v18 = CGImageSourceCreateWithData(v9, v17);
  if (!v18)
  {

    v21 = 0;
    v22 = 0;
    v23 = 0;
LABEL_19:
    v24 = PLBackendGetLog();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v33 = lCopy;
      _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Failed to get size of image at %@", buf, 0xCu);
    }

    goto LABEL_22;
  }

  v19 = v18;
  v20 = [self newImagePropertiesFromImageSource:v18];
  if (v20)
  {
    PFGetDimensionsFromImageProperties();
    v21 = 0;
    v22 = 0;
    v23 = 0;
  }

  else
  {
    v23 = 0;
    v22 = 0;
    v21 = 0;
  }

  CFRelease(v19);

  if (!v22 || !v23)
  {
    goto LABEL_19;
  }

  longLongValue = [v22 longLongValue];
  longLongValue2 = [v23 longLongValue];
LABEL_22:
  if (orientationCopy && v21)
  {
    *orientationCopy = [v21 shortValue];
  }

  objc_autoreleasePoolPop(context);
LABEL_26:

  v25 = longLongValue;
  v26 = longLongValue2;
  result.height = v26;
  result.width = v25;
  return result;
}

+ (id)_ptpCalendar
{
  pl_dispatch_once();
  v2 = _ptpCalendar__myCalendar;

  return v2;
}

void __30__PLManagedAsset__ptpCalendar__block_invoke()
{
  v0 = objc_alloc(MEMORY[0x1E695DEE8]);
  v1 = [v0 initWithCalendarIdentifier:*MEMORY[0x1E695D850]];
  v2 = _ptpCalendar__myCalendar;
  _ptpCalendar__myCalendar = v1;
}

+ (void)ptpResetEventAndFilenameMapping
{
  v2 = +[PLManagedAsset _ptpEventInfoIsolationQueue];
  pl_dispatch_sync();
}

void __49__PLManagedAsset_ptpResetEventAndFilenameMapping__block_invoke()
{
  v0 = +[PLManagedAsset eventInfoForPTP];
  [v0 removeAllObjects];
}

+ (void)ptpSetAssetIDForEventAndFilenameKey:(id)key value:(id)value
{
  keyCopy = key;
  valueCopy = value;
  v7 = +[PLManagedAsset _ptpEventInfoIsolationQueue];
  v10 = keyCopy;
  v11 = valueCopy;
  v8 = valueCopy;
  v9 = keyCopy;
  pl_dispatch_sync();
}

void __60__PLManagedAsset_ptpSetAssetIDForEventAndFilenameKey_value___block_invoke(uint64_t a1)
{
  v2 = +[PLManagedAsset eventInfoForPTP];
  v3 = [v2 objectForKey:*(a1 + 32)];

  if (!v3)
  {
    v4 = +[PLManagedAsset eventInfoForPTP];
    [v4 setValue:*(a1 + 40) forKey:*(a1 + 32)];
  }
}

+ (id)ptpAssetIDForEventAndFilenameKey:(id)key
{
  keyCopy = key;
  v8 = 0;
  v9 = &v8;
  v10 = 0x3032000000;
  v11 = __Block_byref_object_copy__14821;
  v12 = __Block_byref_object_dispose__14822;
  v13 = 0;
  v4 = +[PLManagedAsset _ptpEventInfoIsolationQueue];
  v7 = keyCopy;
  pl_dispatch_sync();

  v5 = v9[5];
  _Block_object_dispose(&v8, 8);

  return v5;
}

void __51__PLManagedAsset_ptpAssetIDForEventAndFilenameKey___block_invoke(uint64_t a1)
{
  v5 = +[PLManagedAsset eventInfoForPTP];
  v2 = [v5 objectForKey:*(a1 + 32)];
  v3 = *(*(a1 + 40) + 8);
  v4 = *(v3 + 40);
  *(v3 + 40) = v2;
}

+ (id)_ptpEventInfoIsolationQueue
{
  pl_dispatch_once();
  v2 = _ptpEventInfoIsolationQueue_ptpQueue;

  return v2;
}

void __45__PLManagedAsset__ptpEventInfoIsolationQueue__block_invoke()
{
  v0 = dispatch_queue_create("com.apple.assetsd.ptpeventinfoisolationqueue", 0);
  v1 = _ptpEventInfoIsolationQueue_ptpQueue;
  _ptpEventInfoIsolationQueue_ptpQueue = v0;
}

+ (id)eventInfoForPTP
{
  pl_dispatch_once();
  v2 = eventInfoForPTP_eventInfo;

  return v2;
}

void __33__PLManagedAsset_eventInfoForPTP__block_invoke()
{
  v0 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v1 = eventInfoForPTP_eventInfo;
  eventInfoForPTP_eventInfo = v0;
}

+ (id)newImagePropertiesFromImageSource:(CGImageSource *)source
{
  v3 = [MEMORY[0x1E69C0708] imagePropertiesFromImageSource:source];
  v4 = v3;
  v5 = MEMORY[0x1E695E0F8];
  if (v3)
  {
    v5 = v3;
  }

  v6 = v5;

  return v6;
}

+ (PLManagedAsset)assetWithObjectID:(id)d inManagedObjectContext:(id)context
{
  v19 = *MEMORY[0x1E69E9840];
  dCopy = d;
  contextCopy = context;
  if (dCopy)
  {
    v7 = objc_autoreleasePoolPush();
    v14 = 0;
    v8 = [contextCopy existingObjectWithID:dCopy error:&v14];
    v9 = v14;
    if (v9)
    {
      v10 = v9;
      v11 = PLBackendGetLog();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        *buf = 138543618;
        v16 = dCopy;
        v17 = 2112;
        v18 = v10;
        _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "Failed to fetch asset %{public}@: %@.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      v12 = 0;
    }

    else
    {
      objc_autoreleasePoolPop(v7);
      v12 = v8;
    }
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

+ (PLManagedAsset)assetWithUUID:(id)d inManagedObjectContext:(id)context
{
  dCopy = d;
  contextCopy = context;
  if (dCopy)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = MEMORY[0x1E695D5E0];
    v9 = +[PLManagedAsset entityName];
    v10 = [v8 fetchRequestWithEntityName:v9];

    dCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid == %@", dCopy];
    [v10 setPredicate:dCopy];
    [v10 setFetchLimit:1];
    v15 = 0;
    v12 = [contextCopy executeFetchRequest:v10 error:&v15];
    if ([v12 count])
    {
      v13 = [v12 objectAtIndex:0];
    }

    else
    {
      v13 = 0;
    }

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

+ (id)assetsWithValidatedSavedAssetTypeMask:(unsigned int)mask inManagedObjectContext:(id)context
{
  v4 = *&mask;
  contextCopy = context;
  v6 = objc_autoreleasePoolPush();
  v7 = objc_alloc_init(MEMORY[0x1E695D5E0]);
  v8 = [objc_opt_class() entityInManagedObjectContext:contextCopy];
  [v7 setEntity:v8];

  v9 = [MEMORY[0x1E69BF328] predicateForIncludeMask:v4 useIndex:1];
  [v7 setPredicate:v9];
  v12 = 0;
  v10 = [contextCopy executeFetchRequest:v7 error:&v12];

  objc_autoreleasePoolPop(v6);

  return v10;
}

+ (unint64_t)countUsedAssetsWithKind:(signed __int16)kind excludeTrashed:(BOOL)trashed excludeInvisible:(BOOL)invisible excludeCloudShared:(BOOL)shared excludePhotoStream:(BOOL)stream inManagedObjectContext:(id)context
{
  streamCopy = stream;
  sharedCopy = shared;
  invisibleCopy = invisible;
  trashedCopy = trashed;
  kindCopy = kind;
  v54[1] = *MEMORY[0x1E69E9840];
  contextCopy = context;
  v14 = objc_autoreleasePoolPush();
  v15 = objc_alloc_init(MEMORY[0x1E695D5E0]);
  v16 = +[PLManagedAsset entityName];
  v17 = PLSafeEntityForNameInManagedObjectContext(v16, contextCopy, 0);

  if (v17)
  {
    v48 = streamCopy;
    v49 = sharedCopy;
    v50 = v14;
    [v15 setEntity:v17];
    array = [MEMORY[0x1E695DF70] array];
    v19 = MEMORY[0x1E696ABC8];
    v20 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"complete"];
    v54[0] = v20;
    v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v54 count:1];
    v22 = [v19 expressionForFunction:@"noindex:" arguments:v21];

    v23 = [MEMORY[0x1E696ABC8] expressionForConstantValue:&unk_1F0FBB0B0];
    v24 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v22 rightExpression:v23 modifier:0 type:5 options:0];
    [array addObject:v24];

    v25 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"kind"];
    v26 = MEMORY[0x1E696ABC8];
    v27 = [MEMORY[0x1E696AD98] numberWithShort:kindCopy];
    v28 = [v26 expressionForConstantValue:v27];

    v29 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v25 rightExpression:v28 modifier:0 type:4 options:0];
    [array addObject:v29];

    if (trashedCopy)
    {
      v30 = MEMORY[0x1E696ABC8];
      v31 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"trashedState"];
      v53 = v31;
      v32 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v53 count:1];
      v33 = [v30 expressionForFunction:@"noindex:" arguments:v32];

      v34 = [MEMORY[0x1E696ABC8] expressionForConstantValue:&unk_1F0FBB0B0];
      v35 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v33 rightExpression:v34 modifier:0 type:4 options:0];
      [array addObject:v35];
    }

    if (invisibleCopy)
    {
      v36 = MEMORY[0x1E696ABC8];
      v37 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"visibilityState"];
      v52 = v37;
      v38 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v52 count:1];
      v39 = [v36 expressionForFunction:@"noindex:" arguments:v38];

      v40 = [MEMORY[0x1E696ABC8] expressionForConstantValue:&unk_1F0FBB110];
      v41 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v39 rightExpression:v40 modifier:0 type:4 options:0];
      [array addObject:v41];
    }

    BYTE2(v47) = 0;
    LOWORD(v47) = 256;
    v42 = [MEMORY[0x1E69BF328] validatedSavedAssetTypeMaskUnknown:0 photoBooth:0 photoStream:v48 camera:0 cloudShared:v49 cameraConnectionKit:0 cloudPhotoLibrary:0x10001010000 wallpaper_UNUSED:v47 momentShared:? placeholder:? referenced:? alternate:? guest:? companionSynced:? recovered:? collectionShare:? legacyImport:?];
    v43 = [MEMORY[0x1E69BF328] predicateForExcludeMask:v42 useIndex:0];
    [array addObject:v43];

    v44 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:array];
    [v15 setPredicate:v44];
    v51 = 0;
    v45 = [contextCopy countForFetchRequest:v15 error:&v51];

    v14 = v50;
  }

  else
  {
    v45 = 0;
  }

  objc_autoreleasePoolPop(v14);
  return v45;
}

+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)library urgency:(int64_t)urgency sizeOption:(unint64_t)option
{
  v43[1] = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  managedObjectContext = [libraryCopy managedObjectContext];
  if (option)
  {
    v10 = objc_alloc_init(MEMORY[0x1E695DFA8]);
    if (option)
    {
      v11 = +[PLInternalResource nonOriginalCPLResourceTypes];
      [v10 addObjectsFromArray:v11];
    }

    if ((option & 2) != 0)
    {
      v12 = +[PLInternalResource originalCPLResourceTypesForMaster];
      [v10 addObjectsFromArray:v12];

      v13 = +[PLInternalResource originalCPLResourceTypesForAsset];
      [v10 addObjectsFromArray:v13];
    }

    v14 = MEMORY[0x1E695D5E0];
    v15 = +[PLInternalResource entityName];
    v16 = [v14 fetchRequestWithEntityName:v15];

    [v16 setResultType:2];
    v17 = [PLInternalResource purgeablePushedPredicateForCPLResourceTypes:v10 urgency:urgency];
    [v16 setPredicate:v17];

    v18 = objc_alloc_init(MEMORY[0x1E695D5C8]);
    [v18 setName:@"totalFileSize"];
    v19 = [MEMORY[0x1E696ABC8] expressionWithFormat:@"sum:(dataLength)"];
    [v18 setExpression:v19];

    [v18 setExpressionResultType:300];
    v43[0] = v18;
    v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v43 count:1];
    [v16 setPropertiesToFetch:v20];

    v38 = 0;
    v21 = [managedObjectContext executeFetchRequest:v16 error:&v38];
    v22 = v38;
    if (v21)
    {
      if ([v21 count] == 1)
      {
        v23 = [v21 objectAtIndexedSubscript:0];
        v24 = [v23 objectForKeyedSubscript:@"totalFileSize"];
        longLongValue = [v24 longLongValue];

        if (longLongValue >= 1)
        {
          v37 = -1;
          if (PLIsAssetsd())
          {
            libraryServicesManager = [libraryCopy libraryServicesManager];
            cloudPhotoLibraryManager = [libraryServicesManager cloudPhotoLibraryManager];

            v28 = [cloudPhotoLibraryManager sizeOfResourcesToUploadByCPL:0];
            v37 = v28;
          }

          else
          {
            assetsdClient = [libraryCopy assetsdClient];
            libraryInternalClient = [assetsdClient libraryInternalClient];
            v36 = v22;
            [libraryInternalClient synchronouslyGetSizeOfResourcesToUploadByCPL:&v37 error:&v36];
            v35 = v36;

            v28 = v37;
            v22 = v35;
          }

          if (longLongValue >= v28)
          {
            longLongValue -= v28;
          }

          else
          {
            longLongValue = 0;
          }

          v33 = PLBackendGetLog();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 134218240;
            v40 = longLongValue;
            v41 = 2048;
            v42 = v37;
            _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_DEFAULT, "totalPurgeableSizeOnDiskInLibrary pushedSize=%lld sizeOfResourcesToUpload=%lld", buf, 0x16u);
          }
        }

        goto LABEL_23;
      }
    }

    else
    {
      v29 = PLBackendGetLog();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = NSStringFromSelector(a2);
        *buf = 138412546;
        v40 = v30;
        v41 = 2112;
        v42 = v22;
        _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "%@ failed to calculate size %@", buf, 0x16u);
      }
    }

    longLongValue = 0;
LABEL_23:

    goto LABEL_24;
  }

  longLongValue = 0;
LABEL_24:

  return longLongValue;
}

+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)library urgency:(int64_t)urgency
{
  libraryCopy = library;
  if ([libraryCopy isCloudPhotoLibraryEnabled])
  {
    libraryBundle = [libraryCopy libraryBundle];
    v8 = [PLCPLSettings settingsWithLibraryBundle:libraryBundle];

    if ([v8 isKeepOriginalsEnabled])
    {
      v9 = 1;
    }

    else
    {
      v9 = 3;
    }
  }

  else
  {
    v9 = 0;
  }

  v10 = [self totalPurgeableSizeOnDiskInLibrary:libraryCopy urgency:urgency sizeOption:v9];

  return v10;
}

+ (id)_createAssetModelToInsert:(id)insert uuid:(id)uuid replacementUUID:(id)d
{
  v20 = *MEMORY[0x1E69E9840];
  insertCopy = insert;
  uuidCopy = uuid;
  dCopy = d;
  v12 = dCopy;
  if (uuidCopy && dCopy)
  {
    if ([uuidCopy isEqualToString:dCopy])
    {
      currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
      [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:5107 description:{@"Invalid parameter not satisfying: %@", @"![uuid isEqualToString:replacementUUID]"}];
    }
  }

  else if (!dCopy)
  {
    goto LABEL_10;
  }

  v14 = [self assetWithUUID:v12 inLibrary:insertCopy];
  if (v14)
  {
    goto LABEL_12;
  }

  v15 = PLBackendGetLog();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v19 = v12;
    _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Could find photo with UUID %@. This will cause duplicates.", buf, 0xCu);
  }

LABEL_10:
  managedObjectContext = [insertCopy managedObjectContext];
  v14 = [(PLManagedObject *)PLManagedAsset insertInManagedObjectContext:managedObjectContext];

  if (uuidCopy)
  {
    [v14 setUuid:uuidCopy];
  }

LABEL_12:

  return v14;
}

+ (id)_insertAssetIntoPhotoLibrary:(id)library mainFileURL:(id)l mainFileMetadata:(id)metadata savedAssetType:(signed __int16)type bundleScope:(unsigned __int16)scope uuid:(id)uuid replacementUUID:(id)d imageSource:(CGImageSource *)self0 imageData:(id *)self1 isPlaceholder:(BOOL)self2 deleteFileOnFailure:(BOOL)self3
{
  scopeCopy = scope;
  typeCopy = type;
  v39 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  lCopy = l;
  metadataCopy = metadata;
  uuidCopy = uuid;
  dCopy = d;
  pathManager = [libraryCopy pathManager];
  v24 = [pathManager shouldUseFileIdentifierForBundleScope:scopeCopy];

  if (lCopy)
  {
    if (v24)
    {
      [MEMORY[0x1E69BF328] maskForReferencedAsset];
      if ((PLValidatedSavedAssetTypeApplies() & 1) == 0)
      {
        if (!uuidCopy)
        {
          currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
          [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:5078 description:{@"Invalid parameter not satisfying: %@", @"uuid"}];
        }

        path = [lCopy path];
        v26 = [path containsString:uuidCopy];

        if ((v26 & 1) == 0)
        {
          currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
          [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:5080 description:{@"Invalid parameter not satisfying: %@", @"[mainFileURL.path containsString:uuid]"}];
        }
      }
    }
  }

  v27 = [self _createAssetModelToInsert:libraryCopy uuid:uuidCopy replacementUUID:dCopy];
  v28 = v27;
  if (!placeholder && ([v27 setAttributesFromMainFileURL:lCopy mainFileMetadata:metadataCopy savedAssetType:typeCopy bundleScope:scopeCopy isPlaceholder:0 placeholderFileURL:0 imageSource:source imageData:data] & 1) == 0)
  {
    v29 = PLMigrationGetLog();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      path2 = [lCopy path];
      *buf = 138412290;
      v38 = path2;
      _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "Failed to set attributes for asset at path %@", buf, 0xCu);
    }

    if (failure)
    {
      v31 = [PLAssetTransactionReason transactionReason:@"[_insertAssetIntoPhotoLibrary:mainFileURL:savedAssetType:replacementUUID:imageSource:imageData:sPlaceholder:deleteFileOnFailure:] We failed to set the asset's attributes, so we are now deleting the non-placeholder asset that was replaced."];
      [v28 deleteWithReason:v31];
    }

    else
    {
      v31 = [PLAssetTransactionReason transactionReason:@"[_insertAssetIntoPhotoLibrary:mainFileURL:savedAssetType:replacementUUID:imageSource:imageData:sPlaceholder:deleteFileOnFailure:] We failed to set the asset's attributes, so we are now deleting the non-placeholder asset that was replaced from the database only because deleteMainFileOnFailure was NO."];
      [v28 deleteFromDatabaseOnlyWithReason:v31];
    }

    v28 = 0;
  }

  return v28;
}

+ (id)fetchPredicateForLegacyRequiredResourcesLocallyAvailable:(BOOL)available photoLibrary:(id)library
{
  libraryCopy = library;
  v6 = libraryCopy;
  if (available || [libraryCopy isCloudPhotoLibraryEnabled])
  {
    v7 = +[PLManagedAsset predicateForAssetsWithCompleteResourcesOnAsset];
  }

  else
  {
    v7 = [MEMORY[0x1E696AE18] predicateWithValue:1];
  }

  v8 = v7;

  return v8;
}

+ (id)cloudMasterMediaMetadataForAssetObjectID:(id)d managedObjectContext:(id)context error:(id *)error
{
  v20 = *MEMORY[0x1E69E9840];
  contextCopy = context;
  dCopy = d;
  fetchRequest = [objc_opt_class() fetchRequest];
  dCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudMaster.assets CONTAINS %@", dCopy];

  [fetchRequest setPredicate:dCopy];
  v17 = 0;
  v11 = [contextCopy executeFetchRequest:fetchRequest error:&v17];

  v12 = v17;
  if (v11)
  {
    firstObject = [v11 firstObject];
    v14 = [firstObject valueForKey:@"data"];
  }

  else
  {
    firstObject = PLBackendGetLog();
    if (os_log_type_enabled(firstObject, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v12;
      _os_log_impl(&dword_19BF1F000, firstObject, OS_LOG_TYPE_ERROR, "Fetch for media metadata failed: %@", buf, 0xCu);
    }

    v14 = 0;
  }

  if (error)
  {
    v15 = v12;
    *error = v12;
  }

  return v14;
}

+ (void)updateAllAlbumAssociationIfNeededWithLibrary:(id)library
{
  v25[1] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E695D5E0];
  libraryCopy = library;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v25[0] = @"albums";
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:1];
  [v6 setRelationshipKeyPathsForPrefetching:v7];

  managedObjectContext = [libraryCopy managedObjectContext];

  v9 = [PLEnumerateAndSaveController alloc];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __63__PLManagedAsset_updateAllAlbumAssociationIfNeededWithLibrary___block_invoke;
  v21[3] = &unk_1E7575B30;
  v10 = managedObjectContext;
  v22 = v10;
  v11 = [(PLEnumerateAndSaveController *)v9 initWithName:@"library asset album associativity" fetchRequest:v6 context:v10 options:4 generateContextBlock:v21 didFetchObjectIDsBlock:0 processResultBlock:&__block_literal_global_593];
  v20 = 0;
  v12 = [(PLEnumerateAndSaveController *)v11 processObjectsWithError:&v20];
  v13 = v20;
  v14 = PLBackendGetLog();
  v15 = v14;
  if (v12)
  {
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      v16 = "Completed asset album associativity recovery";
      v17 = v15;
      v18 = OS_LOG_TYPE_INFO;
      v19 = 2;
LABEL_6:
      _os_log_impl(&dword_19BF1F000, v17, v18, v16, buf, v19);
    }
  }

  else if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v24 = v13;
    v16 = "Failed to perform asset album associativity recovery. Error: %@";
    v17 = v15;
    v18 = OS_LOG_TYPE_ERROR;
    v19 = 12;
    goto LABEL_6;
  }
}

+ (BOOL)validShareForPlaceholderAsset:(id)asset
{
  assetCopy = asset;
  if ([assetCopy isPlaceholderAsset] && (objc_msgSend(assetCopy, "shareRelationship"), v4 = objc_claimAutoreleasedReturnValue(), v4, v4))
  {
    shareRelationship = [assetCopy shareRelationship];
    shareURL = [shareRelationship shareURL];
    v7 = shareURL != 0;
  }

  else
  {
    v7 = 1;
  }

  return v7;
}

+ (BOOL)_isScreenshotWithType:(id)type hasScreenshotDimensions:(BOOL)dimensions hasScreenshotMetadata:(BOOL)metadata
{
  metadataCopy = metadata;
  typeCopy = type;
  if ([typeCopy conformsToType:*MEMORY[0x1E6982F28]])
  {
    LOBYTE(metadataCopy) = dimensions | metadataCopy;
  }

  else if (([typeCopy conformsToType:*MEMORY[0x1E6982E58]] & 1) == 0)
  {
    metadataCopy &= [typeCopy conformsToType:*MEMORY[0x1E6982E00]];
  }

  return metadataCopy;
}

+ (signed)correctedOrientation:(signed __int16)orientation
{
  orientationCopy = orientation;
  if (orientation - 9 < 0xFFFFFFF8)
  {
    return 1;
  }

  return orientationCopy;
}

+ (void)deleteOldPlaceholderAssetsInManagedObjectContext:(id)context
{
  v32 = *MEMORY[0x1E69E9840];
  contextCopy = context;
  v4 = objc_autoreleasePoolPush();
  date = [MEMORY[0x1E695DF00] date];
  v6 = objc_opt_new();
  [v6 setDay:-7];
  v7 = [MEMORY[0x1E695DEE8] calendarWithIdentifier:*MEMORY[0x1E695D850]];
  v8 = [v7 dateByAddingComponents:v6 toDate:date options:0];

  v9 = PLBackendGetLog();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    *buf = 138543362;
    v31 = v8;
    _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_INFO, "Deleting old placeholder assets older than %{public}@", buf, 0xCu);
  }

  v10 = MEMORY[0x1E695D5E0];
  v11 = +[PLManagedAsset entityName];
  v12 = [v10 fetchRequestWithEntityName:v11];

  v13 = MEMORY[0x1E696AB28];
  v14 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForPlaceholderAsset"), 1}];
  v29[0] = v14;
  v15 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K < %@", @"addedDate", v8];
  v29[1] = v15;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v29 count:2];
  v17 = [v13 andPredicateWithSubpredicates:v16];
  [v12 setPredicate:v17];

  v18 = [objc_alloc(MEMORY[0x1E695D538]) initWithFetchRequest:v12];
  [v18 setResultType:2];
  v28 = 0;
  v19 = [contextCopy executeRequest:v18 error:&v28];
  v20 = v28;
  v21 = PLBackendGetLog();
  v22 = v21;
  if (v19)
  {
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      [v19 result];
      v27 = date;
      v23 = contextCopy;
      v25 = v24 = v4;
      unsignedLongValue = [v25 unsignedLongValue];
      *buf = 134217984;
      v31 = unsignedLongValue;
      _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Deleted %lu placeholder assets", buf, 0xCu);

      v4 = v24;
      contextCopy = v23;
      date = v27;
    }
  }

  else if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v31 = v20;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Failed to delete old placeholder assets %@", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
}

+ (BOOL)isVideoComplementVisibilityStatePlayable:(unsigned __int16)playable hasAdjustments:(BOOL)adjustments
{
  v4 = (playable >> 3) & 1;
  if ((playable & 9) == 0)
  {
    v4 = !adjustments | ((playable & 2) >> 1);
  }

  if ((playable & 4) != 0)
  {
    LOBYTE(v4) = playable ^ 1;
  }

  return v4 & 1;
}

+ (id)videoComplementVisibilityStatePlayablePredicate
{
  v13[2] = *MEMORY[0x1E69E9840];
  v2 = [MEMORY[0x1E695DF70] arrayWithCapacity:4];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(videoCpVisibilityState & %i) != 0 AND (videoCpVisibilityState & %i) == 0", 4, 1];
  [v2 addObject:v3];
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(videoCpVisibilityState & %i) != 0 AND (videoCpVisibilityState & %i) == 0", 8, 4];
  [v2 addObject:v4];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(videoCpVisibilityState & %i) != 0 AND (videoCpVisibilityState & %i) == 0 AND (videoCpVisibilityState & %i) == 0 AND (videoCpVisibilityState & %i) == 0", 2, 1, 8, 4];
  [v2 addObject:v5];
  v6 = MEMORY[0x1E696AB28];
  v7 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %i", @"videoCpVisibilityState", 0];
  v13[0] = v7;
  v8 = [PLManagedAsset predicateForUnadjustedAssetsWithKeyPathToAsset:0];
  v13[1] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:2];
  v10 = [v6 andPredicateWithSubpredicates:v9];

  [v2 addObject:v10];
  v11 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v2];

  return v11;
}

+ (BOOL)canPlayPhotoIrisWithPhotoIris:(BOOL)iris photoIrisPlaceholder:(BOOL)placeholder hasAdjustments:(BOOL)adjustments videoCpVisibilityState:(unsigned __int16)state
{
  if (!iris || placeholder)
  {
    return 0;
  }

  else
  {
    return [self isVideoComplementVisibilityStatePlayable:state hasAdjustments:adjustments];
  }
}

+ (BOOL)isPhotoIrisPlaceholderWithPhotoIris:(BOOL)iris videoCpDuration:(int64_t)duration isCloudShared:(BOOL)shared videoCpFilePath:(id)path
{
  irisCopy = iris;
  pathCopy = path;
  v10 = pathCopy;
  LOBYTE(v11) = 0;
  if (!duration && !shared && irisCopy)
  {
    if (pathCopy)
    {
      defaultManager = [MEMORY[0x1E696AC08] defaultManager];
      v11 = [defaultManager fileExistsAtPath:v10] ^ 1;
    }

    else
    {
      LOBYTE(v11) = 1;
    }
  }

  return v11;
}

+ (id)predicateToExcludeVideosWithVideoKeyFrameSetWithKeyPathToAsset:(id)asset
{
  assetCopy = asset;
  if (!assetCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:1876 description:{@"Invalid parameter not satisfying: %@", @"keyPathToAsset"}];
  }

  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K.%K != %d || (%K.%K == %d && %K.%K == %d)", assetCopy, @"kind", 1, assetCopy, @"videoKeyFrameValue", 0, assetCopy, @"videoKeyFrameTimeScale", 0];

  return v6;
}

+ (void)clearImportSessionObjectIDCacheOnManagedObjectContext:(id)context
{
  contextCopy = context;
  if ([contextCopy isValidForSelector:a2 error:0])
  {
    userInfo = [contextCopy userInfo];
    [userInfo removeObjectForKey:@"importSessionObjectIDCache"];
  }
}

+ (id)_importAlbumIsolationQueue
{
  pl_dispatch_once();
  v2 = _importAlbumIsolationQueue_importAlbumQueue;

  return v2;
}

void __44__PLManagedAsset__importAlbumIsolationQueue__block_invoke()
{
  v0 = dispatch_queue_create("com.apple.assetsd.importalbumisolationqueue", 0);
  v1 = _importAlbumIsolationQueue_importAlbumQueue;
  _importAlbumIsolationQueue_importAlbumQueue = v0;
}

+ (BOOL)invalidateReverseLocationDataOnAllAssetsInManagedObjectContext:(id)context error:(id *)error
{
  v25[1] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D560];
  contextCopy = context;
  v7 = [v5 alloc];
  v8 = +[PLAdditionalAssetAttributes entityName];
  v9 = [v7 initWithEntityName:v8];

  v24 = @"reverseLocationDataIsValid";
  v25[0] = MEMORY[0x1E695E110];
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v25 forKeys:&v24 count:1];
  [v9 setPropertiesToUpdate:v10];

  [v9 setResultType:0];
  v21 = 0;
  v11 = [contextCopy executeRequest:v9 error:&v21];

  v12 = v21;
  v13 = v12;
  if (v11)
  {
    v14 = PLMomentsGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      v15 = "Location data invalidated for all assets";
      v16 = v14;
      v17 = OS_LOG_TYPE_DEFAULT;
      v18 = 2;
LABEL_8:
      _os_log_impl(&dword_19BF1F000, v16, v17, v15, buf, v18);
    }
  }

  else
  {
    if (error)
    {
      v19 = v12;
      *error = v13;
    }

    v14 = PLMomentsGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v23 = v13;
      v15 = "Failed to batch-invalidate location data for all assets: %@";
      v16 = v14;
      v17 = OS_LOG_TYPE_ERROR;
      v18 = 12;
      goto LABEL_8;
    }
  }

  return v11 != 0;
}

+ (void)createTHMFileWithPreviewImage:(id)image thumbnailImage:(id)thumbnailImage fileURLForThumbnailFile:(id)file
{
  v7 = MEMORY[0x1E69BF248];
  fileCopy = file;
  thumbnailImageCopy = thumbnailImage;
  imageCopy = image;
  defaultFormatChooser = [v7 defaultFormatChooser];
  indexSheetUnbakedFormat = [defaultFormatChooser indexSheetUnbakedFormat];

  [indexSheetUnbakedFormat size];
  v13 = v12;
  v15 = v14;
  DCIM_sizeFromPLImage();
  if (v13 >= v15)
  {
    v18 = v13;
  }

  else
  {
    v18 = v15;
  }

  if (v16 >= v17)
  {
    v16 = v17;
  }

  if (v18 >= v16)
  {
    v19 = imageCopy;
  }

  else
  {
    v19 = thumbnailImageCopy;
  }

  v20 = v19;
  DCIM_sizeFromPLImage();
  PLSquareCropRectForSize();
  v21 = PLCreateCroppedImageFromImage();

  v22 = DCIM_newJPEGRepresentationWithPLImage();
  [v22 writeToURL:fileCopy atomically:0];
}

+ (BOOL)hasMasterThumbWithThumbnailIndex:(int64_t)index
{
  if (index == -2)
  {
    return 1;
  }

  else
  {
    return [self hasAllThumbsWithThumbnailIndex:?];
  }
}

+ (id)predicateForAssetsIncompletelyProcessedForSensitivity
{
  v17[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == 0", @"compactSCSensitivityAnalysis", 0];
  v17[0] = v3;
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"kind", 1];
  v15[0] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"kindSubtype", 2];
  v15[1] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:2];
  v8 = [v4 orPredicateWithSubpredicates:v7];
  v16[0] = v8;
  v9 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K & %d) == 0", @"packedBadgeAttributes", 256];
  v16[1] = v9;
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v16 count:2];
  v11 = [v4 andPredicateWithSubpredicates:v10];
  v17[1] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:2];
  v13 = [v2 orPredicateWithSubpredicates:v12];

  return v13;
}

+ (id)predicateForStyleableAssets
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > %d", @"currentSleetCast", 0];
  v8[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > 0", @"additionalAttributes.sleetIsReversible"];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 andPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)predicateForAdjustedAssetsWithKeyPathToAsset:(id)asset
{
  if (asset)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K.%K != %i", asset, @"adjustmentsState", 0];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %i", @"adjustmentsState", 0, v5];
  }
  v3 = ;

  return v3;
}

+ (id)predicateForUnadjustedAssetsWithKeyPathToAsset:(id)asset
{
  if (asset)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K.%K == %i", asset, @"adjustmentsState", 0];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %i", @"adjustmentsState", 0, v5];
  }
  v3 = ;

  return v3;
}

+ (id)predicateForAssetSubtype:(signed __int16)subtype
{
  subtypeCopy = subtype;
  if (!subtype)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:836 description:{@"Invalid parameter not satisfying: %@", @"subtype != PLAssetSubtypeNone"}];
  }

  return [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K != %d) AND (%K == %d)", @"kindSubtype", 0, @"kindSubtype", subtypeCopy];
}

+ (id)predicateForBurstStackAssets
{
  v10[4] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"avalancheKind", 1];
  v10[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K >= %d", @"avalanchePickType", 16];
  v10[1] = v4;
  0x7FFFFFFFLL = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K <= %d", @"avalanchePickType", 0x7FFFFFFFLL];
  v10[2] = 0x7FFFFFFFLL;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K & %i) == %i", @"avalanchePickType", 16, 16];
  v10[3] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:4];
  v8 = [v2 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateForAvalancheKindAssetsWithKind:(unsigned __int16)kind
{
  v9[2] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"avalancheUUID"];
  v9[0] = v4;
  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAvalancheSupportedAssets"), 0}];
  v9[1] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:2];
  v7 = [v3 andPredicateWithSubpredicates:v6];

  return v7;
}

+ (id)_predicateForAvalancheKindAssetsWithUUID:(id)d kind:(unsigned __int16)kind
{
  kindCopy = kind;
  v12[2] = *MEMORY[0x1E69E9840];
  v6 = MEMORY[0x1E696AB28];
  v7 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"avalancheUUID", d];
  v12[0] = v7;
  v8 = [self predicateForAvalancheKindAssetsWithKind:kindCopy];
  v12[1] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:2];
  v10 = [v6 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (NSPredicate)predicateToIncludeSharedLibrarySharingSuggestionsAssets
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSharedLibraryExclusions"), 0}];
  v8[0] = v3;
  v4 = PLManagedAssetPredicateToFetchAssetsSuggestedForSharing();
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 andPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)predicateToIncludeSharedLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)state
{
  stateCopy = state;
  v12[3] = *MEMORY[0x1E69E9840];
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSharedLibraryExclusions"), 0}];
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"visibilityState", 0, v5];
  v12[1] = v6;
  if (stateCopy)
  {
    v7 = @"%K == %d";
  }

  else
  {
    v7 = @"noindex:(%K) == %d";
  }

  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:v7, @"activeLibraryScopeParticipationState", 1];
  v12[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:3];
  v10 = [v4 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateToIncludePrivateLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)state
{
  stateCopy = state;
  v12[3] = *MEMORY[0x1E69E9840];
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSharedLibraryExclusions"), 0}];
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"visibilityState", 0, v5];
  v12[1] = v6;
  if (stateCopy)
  {
    v7 = @"%K == %d";
  }

  else
  {
    v7 = @"noindex:(%K) == %d";
  }

  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:v7, @"activeLibraryScopeParticipationState", 0];
  v12[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:3];
  v10 = [v4 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateForReframedAssets
{
  pl_dispatch_once();
  v2 = predicateForReframedAssets_predicate;

  return v2;
}

void __44__PLManagedAsset_predicateForReframedAssets__block_invoke()
{
  v6 = [MEMORY[0x1E695DF70] array];
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 4];
  [v6 addObject:v0];

  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 5];
  [v6 addObject:v1];

  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 13];
  [v6 addObject:v2];

  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 12];
  [v6 addObject:v3];

  v4 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v6];
  v5 = predicateForReframedAssets_predicate;
  predicateForReframedAssets_predicate = v4;
}

+ (id)predicateForSpatialOverCaptureAssets
{
  pl_dispatch_once();
  v2 = predicateForSpatialOverCaptureAssets_predicate;

  return v2;
}

void __54__PLManagedAsset_predicateForSpatialOverCaptureAssets__block_invoke()
{
  v6 = [MEMORY[0x1E695DF70] array];
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 1];
  [v6 addObject:v0];

  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 5];
  [v6 addObject:v1];

  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 13];
  [v6 addObject:v2];

  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 9];
  [v6 addObject:v3];

  v4 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v6];
  v5 = predicateForSpatialOverCaptureAssets_predicate;
  predicateForSpatialOverCaptureAssets_predicate = v4;
}

+ (id)predicateForAssetSharingFilter:(signed __int16)filter noindex:(BOOL)noindex
{
  v4 = filter == 1;
  if (noindex)
  {
    v5 = @"noindex:(%K) == %d";
  }

  else
  {
    v5 = @"%K == %d";
  }

  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:v5, @"activeLibraryScopeParticipationState", v4];

  return v6;
}

+ (id)predicateToIncludeBothPrivateAssetsAndSharedContentContributedByCurrentUser
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = +[PLManagedAsset predicateToIncludeOnlyContentContributedByCurrentUser];
  v8[0] = v3;
  v4 = [PLManagedAsset predicateForAssetSharingFilter:0];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 orPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToFaceVersion:(id)version
{
  v10[2] = *MEMORY[0x1E69E9840];
  if (version)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K >= %d", @"additionalAttributes.faceAnalysisVersion", objc_msgSend(version, "intValue")];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > %d", @"additionalAttributes.faceAnalysisVersion", 0];
  }
  v4 = ;
  v5 = MEMORY[0x1E696AB28];
  predicateToIncludeOnlyAllowedForAnalysisAssets = [self predicateToIncludeOnlyAllowedForAnalysisAssets];
  v10[0] = predicateToIncludeOnlyAllowedForAnalysisAssets;
  v10[1] = v4;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:2];
  v8 = [v5 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestFaceVersion
{
  v3 = +[PLMediaAnalysisServiceRequestAdapter currentFaceVersion];
  v4 = [self predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToFaceVersion:v3];

  return v4;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToSceneVersion:(id)version
{
  v10[2] = *MEMORY[0x1E69E9840];
  if (version)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K >= %d", @"additionalAttributes.sceneAnalysisVersion", objc_msgSend(version, "intValue")];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > %d", @"additionalAttributes.sceneAnalysisVersion", 0];
  }
  v4 = ;
  v5 = MEMORY[0x1E696AB28];
  predicateToIncludeOnlyAllowedForAnalysisAssets = [self predicateToIncludeOnlyAllowedForAnalysisAssets];
  v10[0] = predicateToIncludeOnlyAllowedForAnalysisAssets;
  v10[1] = v4;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:2];
  v8 = [v5 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestSceneVersion
{
  v3 = +[PLMediaAnalysisServiceRequestAdapter currentSceneVersion];
  v4 = [self predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToSceneVersion:v3];

  return v4;
}

+ (id)predicateToExcludeNonVisibleStackedAssets
{
  v13[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d", @"avalancheKind", 2];
  v13[0] = v3;
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"avalancheKind", 2];
  v12[0] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"avalanchePickType", 20];
  v12[1] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:2];
  v8 = [v4 andPredicateWithSubpredicates:v7];
  v13[1] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:2];
  v10 = [v2 orPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateToIncludeDuplicateAssetVisibilityStateMostRelevant
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"duplicateAssetVisibilityState", 0];
  v8[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"duplicateAssetVisibilityState", 2];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 orPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)_predicateForDepthType:(signed __int16)type
{
  typeCopy = type;
  v13[2] = *MEMORY[0x1E69E9840];
  if (!type)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:580 description:{@"Invalid parameter not satisfying: %@", @"depthType != PLDepthTypeNone"}];
  }

  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K != %d)", @"depthType", 0];
  v13[0] = v5;
  typeCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K == %d)", @"depthType", typeCopy];
  v13[1] = typeCopy;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:2];
  v8 = [v4 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateToLimitToCaptureSessionIdentifier:(id)identifier
{
  identifierCopy = identifier;
  if (!identifierCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:550 description:{@"Invalid parameter not satisfying: %@", @"captureSessionIdentifier != nil"}];
  }

  identifierCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"captureSessionIdentifier", identifierCopy];

  return identifierCopy;
}

+ (id)predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath:(id)path
{
  v11[1] = *MEMORY[0x1E69E9840];
  pathCopy = path;
  pl_dispatch_once();
  v10 = @"thumbnailIndex";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath__pl_once_object_16;
  v6 = [v4 expressionForKeyPath:pathCopy];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __91__PLManagedAsset_predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:($thumbnailIndex) == %d OR noindex:($thumbnailIndex) >= %d", 4294967294, 0];
  v0 = [v2 copy];
  v1 = predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath__pl_once_object_16;
  predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath__pl_once_object_16 = v0;
}

+ (id)predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath:(id)path
{
  v11[1] = *MEMORY[0x1E69E9840];
  pathCopy = path;
  pl_dispatch_once();
  v10 = @"avalanchePickType";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath__pl_once_object_15;
  v6 = [v4 expressionForKeyPath:pathCopy];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __86__PLManagedAsset_predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(noindex:($avalanchePickType) = %d) OR (noindex:($avalanchePickType) >= %d AND (((noindex:($avalanchePickType) & %i) == %i) OR ((noindex:($avalanchePickType) & %i) == %i)))", 0, 8, 8, 8, 16, 16];
  v0 = [v2 copy];
  v1 = predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath__pl_once_object_15;
  predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath__pl_once_object_15 = v0;
}

+ (id)predicateToExcludeRestrictedLockedAssets
{
  pl_dispatch_once();
  v2 = predicateToExcludeRestrictedLockedAssets_pl_once_object_13;

  return v2;
}

void __58__PLManagedAsset_predicateToExcludeRestrictedLockedAssets__block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d AND noindex:(%K) == NO", @"trashedState", 0, @"hidden"];
  v0 = [v2 copy];
  v1 = predicateToExcludeRestrictedLockedAssets_pl_once_object_13;
  predicateToExcludeRestrictedLockedAssets_pl_once_object_13 = v0;
}

+ (id)predicateToExcludeHiddenAssetsWithHiddenKeyPath:(id)path
{
  v11[1] = *MEMORY[0x1E69E9840];
  pathCopy = path;
  pl_dispatch_once();
  v10 = @"hidden";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeHiddenAssetsWithHiddenKeyPath__pl_once_object_12;
  v6 = [v4 expressionForKeyPath:pathCopy];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __66__PLManagedAsset_predicateToExcludeHiddenAssetsWithHiddenKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:($hidden) == NO"];
  v0 = [v2 copy];
  v1 = predicateToExcludeHiddenAssetsWithHiddenKeyPath__pl_once_object_12;
  predicateToExcludeHiddenAssetsWithHiddenKeyPath__pl_once_object_12 = v0;
}

+ (id)predicateToExcludeTrashedAssetsWithTrashedStateKeyPath:(id)path
{
  v11[1] = *MEMORY[0x1E69E9840];
  pathCopy = path;
  pl_dispatch_once();
  v10 = @"trashedState";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeTrashedAssetsWithTrashedStateKeyPath__pl_once_object_11;
  v6 = [v4 expressionForKeyPath:pathCopy];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __73__PLManagedAsset_predicateToExcludeTrashedAssetsWithTrashedStateKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:($trashedState) == %d", 0];
  v0 = [v2 copy];
  v1 = predicateToExcludeTrashedAssetsWithTrashedStateKeyPath__pl_once_object_11;
  predicateToExcludeTrashedAssetsWithTrashedStateKeyPath__pl_once_object_11 = v0;
}

+ (id)videoAssetsForMediaGroupUUID:(id)d moc:(id)moc
{
  v20[1] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D5E0];
  mocCopy = moc;
  dCopy = d;
  v8 = +[PLManagedAsset entityName];
  v9 = [v5 fetchRequestWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"mediaGroupUUID = %@ AND noindex:(kind) = %d", dCopy, 1];

  [v9 setPredicate:v10];
  v11 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"addedDate" ascending:0];
  v20[0] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
  [v9 setSortDescriptors:v12];

  v17 = 0;
  v13 = [mocCopy executeFetchRequest:v9 error:&v17];

  v14 = v17;
  if (!v13)
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v14;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "%@", buf, 0xCu);
    }
  }

  return v13;
}

+ (id)imageAssetsForMediaGroupUUID:(id)d moc:(id)moc
{
  v20[1] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D5E0];
  mocCopy = moc;
  dCopy = d;
  v8 = +[PLManagedAsset entityName];
  v9 = [v5 fetchRequestWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@ AND noindex:(%K) = %d", @"mediaGroupUUID", dCopy, @"kind", 0];

  [v9 setPredicate:v10];
  v11 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"addedDate" ascending:0];
  v20[0] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
  [v9 setSortDescriptors:v12];

  v17 = 0;
  v13 = [mocCopy executeFetchRequest:v9 error:&v17];

  v14 = v17;
  if (!v13)
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v14;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "%@", buf, 0xCu);
    }
  }

  return v13;
}

+ (id)assetsWithGroupingUUID:(id)d inManagedObjectContext:(id)context
{
  v18 = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D5E0];
  contextCopy = context;
  dCopy = d;
  v8 = +[PLManagedAsset entityName];
  v9 = [v5 fetchRequestWithEntityName:v8];

  dCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"groupingUUID == %@", dCopy];

  [v9 setPredicate:dCopy];
  v15 = 0;
  v11 = [contextCopy executeFetchRequest:v9 error:&v15];

  v12 = v15;
  if (!v11)
  {
    v13 = PLBackendGetLog();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v17 = v12;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Fetch for grouped assets failed with error %@", buf, 0xCu);
    }
  }

  return v11;
}

+ (id)assetUUIDsByObjectIDs:(id)ds withFilterPredicate:(id)predicate context:(id)context error:(id *)error
{
  v44[2] = *MEMORY[0x1E69E9840];
  dsCopy = ds;
  predicateCopy = predicate;
  contextCopy = context;
  v12 = MEMORY[0x1E695D5E0];
  v13 = +[PLManagedAsset entityName];
  v14 = [v12 fetchRequestWithEntityName:v13];

  dsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"self IN %@", dsCopy];
  v16 = dsCopy;
  if (predicateCopy)
  {
    v17 = MEMORY[0x1E696AB28];
    v44[0] = dsCopy;
    v44[1] = predicateCopy;
    v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v44 count:2];
    v19 = [v17 andPredicateWithSubpredicates:v18];

    v16 = v19;
  }

  [v14 setPredicate:v16];
  v43[0] = @"objectID";
  v43[1] = @"uuid";
  v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v43 count:2];
  [v14 setPropertiesToFetch:v20];
  [v14 setResultType:2];
  v37 = 0;
  v38 = &v37;
  v39 = 0x3032000000;
  v40 = __Block_byref_object_copy__14821;
  v41 = __Block_byref_object_dispose__14822;
  v42 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__14821;
  v35 = __Block_byref_object_dispose__14822;
  v36 = 0;
  v26[0] = MEMORY[0x1E69E9820];
  v26[1] = 3221225472;
  v26[2] = __74__PLManagedAsset_assetUUIDsByObjectIDs_withFilterPredicate_context_error___block_invoke;
  v26[3] = &unk_1E7578898;
  v21 = contextCopy;
  v27 = v21;
  v22 = v14;
  v28 = v22;
  v29 = &v31;
  v30 = &v37;
  [v21 performBlockAndWait:v26];
  v23 = v38[5];
  if (error && !v23)
  {
    *error = v32[5];
    v23 = v38[5];
  }

  v24 = v23;

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);

  return v24;
}

void __74__PLManagedAsset_assetUUIDsByObjectIDs_withFilterPredicate_context_error___block_invoke(void *a1)
{
  v29[1] = *MEMORY[0x1E69E9840];
  v2 = a1[4];
  v3 = a1[5];
  v26[0] = 0;
  v4 = [v2 executeFetchRequest:v3 error:v26];
  v5 = v26[0];
  v21 = v5;
  if (v4)
  {
    v6 = [MEMORY[0x1E695DF90] dictionary];
    v7 = *(a1[7] + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;

    v24 = 0u;
    v25 = 0u;
    v22 = 0u;
    v23 = 0u;
    v9 = v4;
    v10 = [v9 countByEnumeratingWithState:&v22 objects:v27 count:16];
    if (v10)
    {
      v11 = *v23;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v23 != v11)
          {
            objc_enumerationMutation(v9);
          }

          v13 = *(*(&v22 + 1) + 8 * i);
          v14 = [v13 objectForKeyedSubscript:@"uuid"];
          v15 = [v13 objectForKeyedSubscript:@"objectID"];
          [*(*(a1[7] + 8) + 40) setObject:v14 forKey:v15];
        }

        v10 = [v9 countByEnumeratingWithState:&v22 objects:v27 count:16];
      }

      while (v10);
    }
  }

  else
  {
    v16 = MEMORY[0x1E696ABC0];
    v28 = *MEMORY[0x1E696A278];
    v9 = [v5 debugDescription];
    v29[0] = v9;
    v17 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v29 forKeys:&v28 count:1];
    v18 = [v16 errorWithDomain:*MEMORY[0x1E69BFF48] code:46301 userInfo:v17];
    v19 = *(a1[6] + 8);
    v20 = *(v19 + 40);
    *(v19 + 40) = v18;
  }
}

+ (id)assetsWithObjectIDs:(id)ds inLibrary:(id)library
{
  dsCopy = ds;
  libraryCopy = library;
  if ([dsCopy count])
  {
    v7 = objc_autoreleasePoolPush();
    dsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"self IN %@", dsCopy];
    v9 = MEMORY[0x1E695D5E0];
    v10 = +[PLManagedAsset entityName];
    v11 = [v9 fetchRequestWithEntityName:v10];

    [v11 setIncludesPendingChanges:0];
    [v11 setPredicate:dsCopy];
    if ([dsCopy count] >= 0x65)
    {
      [v11 setFetchBatchSize:100];
    }

    managedObjectContext = [libraryCopy managedObjectContext];
    v15 = 0;
    v13 = [managedObjectContext executeFetchRequest:v11 error:&v15];

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

+ (PLManagedAsset)assetWithObjectID:(id)d inLibrary:(id)library
{
  dCopy = d;
  managedObjectContext = [library managedObjectContext];
  v8 = [self assetWithObjectID:dCopy inManagedObjectContext:managedObjectContext];

  return v8;
}

+ (unint64_t)countForAssetsWithUUIDs:(id)ds uuidKeyPath:(id)path includePendingChanges:(BOOL)changes inManagedObjectContext:(id)context error:(id *)error
{
  changesCopy = changes;
  dsCopy = ds;
  pathCopy = path;
  contextCopy = context;
  if ([dsCopy count])
  {
    v14 = objc_autoreleasePoolPush();
    dsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", pathCopy, dsCopy];
    v16 = MEMORY[0x1E695D5E0];
    v17 = +[PLManagedAsset entityName];
    v18 = [v16 fetchRequestWithEntityName:v17];

    [v18 setIncludesPendingChanges:changesCopy];
    [v18 setPredicate:dsCopy];
    v23 = 0;
    v19 = [contextCopy countForFetchRequest:v18 error:&v23];
    v20 = v23;

    objc_autoreleasePoolPop(v14);
    if (error && v19 == 0x7FFFFFFFFFFFFFFFLL)
    {
      v21 = v20;
      *error = v20;
      v19 = 0x7FFFFFFFFFFFFFFFLL;
    }
  }

  else
  {
    v19 = 0;
    v20 = 0;
  }

  return v19;
}

+ (id)assetsWithUUIDs:(id)ds options:(unint64_t)options inManagedObjectContext:(id)context
{
  optionsCopy = options;
  dsCopy = ds;
  contextCopy = context;
  if ([dsCopy count])
  {
    v9 = objc_autoreleasePoolPush();
    dsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid IN %@", dsCopy];
    v11 = MEMORY[0x1E695D5E0];
    v12 = +[PLManagedAsset entityName];
    v13 = [v11 fetchRequestWithEntityName:v12];

    [v13 setIncludesPendingChanges:optionsCopy & 1];
    if ((optionsCopy & 2) != 0)
    {
      v14 = [MEMORY[0x1E695DEC8] arrayWithObject:@"uuid"];
      [v13 setPropertiesToFetch:v14];
    }

    [v13 setPredicate:dsCopy];
    v17 = 0;
    v15 = [contextCopy executeFetchRequest:v13 error:&v17];

    objc_autoreleasePoolPop(v9);
  }

  else
  {
    v15 = 0;
  }

  return v15;
}

+ (id)assetsWithUUIDs:(id)ds options:(unint64_t)options inLibrary:(id)library
{
  dsCopy = ds;
  managedObjectContext = [library managedObjectContext];
  v10 = [self assetsWithUUIDs:dsCopy options:options inManagedObjectContext:managedObjectContext];

  return v10;
}

+ (PLManagedAsset)assetWithUUID:(id)d inLibrary:(id)library
{
  dCopy = d;
  managedObjectContext = [library managedObjectContext];
  v8 = [self assetWithUUID:dCopy inManagedObjectContext:managedObjectContext];

  return v8;
}

+ (BOOL)hasRequiredExtendedAttributesForMainFileURL:(id)l
{
  lCopy = l;
  v5 = objc_autoreleasePoolPush();
  v6 = [MEMORY[0x1E69BF230] persistedAttributesForFileAtURL:lCopy];
  LOBYTE(self) = [self hasRequiredExtendedAttributesForPersistanceAttributes:v6];

  objc_autoreleasePoolPop(v5);
  return self;
}

+ (BOOL)hasRequiredExtendedAttributesForPersistanceAttributes:(id)attributes
{
  v3 = [attributes UUIDStringForKey:*MEMORY[0x1E69BFE68]];
  v4 = [v3 length] != 0;

  return v4;
}

- (id)_imagePropertiesFromMetadata:(id)metadata
{
  metadataCopy = metadata;
  cgImageProperties = [metadataCopy cgImageProperties];

  if (cgImageProperties)
  {
    cgImageProperties2 = [metadataCopy cgImageProperties];
  }

  else
  {
    if ([(PLManagedAsset *)self isBundleScopeSyndication])
    {
      v7 = 0;
      goto LABEL_7;
    }

    cgImageProperties2 = [(PLManagedAsset *)self imageProperties];
  }

  v7 = cgImageProperties2;
LABEL_7:

  return v7;
}

- (id)generatePortraitAdjustment:(id *)adjustment
{
  v32[3] = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self depthType]== 1 && ![(PLManagedAsset *)self hasAdjustments])
  {
    v25 = 0;
    v26 = &v25;
    v27 = 0x3032000000;
    v28 = __Block_byref_object_copy__14821;
    v29 = __Block_byref_object_dispose__14822;
    v30 = 0;
    v23[0] = 0;
    v23[1] = v23;
    v23[2] = 0x3032000000;
    v23[3] = __Block_byref_object_copy__14821;
    v23[4] = __Block_byref_object_dispose__14822;
    v24 = 0;
    v5 = *MEMORY[0x1E69AE948];
    v32[0] = MEMORY[0x1E695E118];
    v6 = *MEMORY[0x1E69AE900];
    v31[0] = v5;
    v31[1] = v6;
    uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
    v32[1] = uniformTypeIdentifier;
    v31[2] = *MEMORY[0x1E69AE970];
    v8 = [MEMORY[0x1E696AD98] numberWithShort:{-[PLManagedAsset originalOrientation](self, "originalOrientation")}];
    v32[2] = v8;
    v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v32 forKeys:v31 count:3];

    v10 = dispatch_block_create(DISPATCH_BLOCK_INHERIT_QOS_CLASS, &__block_literal_global_2819);
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    imageConversionServiceClient = [photoLibrary imageConversionServiceClient];

    mainFileURL = [(PLManagedAsset *)self mainFileURL];
    v16 = MEMORY[0x1E69E9820];
    v17 = 3221225472;
    v18 = __66__PLManagedAsset_ThumbnailGeneration__generatePortraitAdjustment___block_invoke_2;
    v19 = &unk_1E7567AD8;
    v21 = &v25;
    v22 = v23;
    v14 = v10;
    v20 = v14;
    [imageConversionServiceClient convertImageAtSourceURL:mainFileURL options:v9 completionHandler:&v16];

    dispatch_block_wait(v14, 0xFFFFFFFFFFFFFFFFLL);
    v4 = [v26[5] objectForKeyedSubscript:{*MEMORY[0x1E69AE8F0], v16, v17, v18, v19}];

    _Block_object_dispose(v23, 8);
    _Block_object_dispose(&v25, 8);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

void __66__PLManagedAsset_ThumbnailGeneration__generatePortraitAdjustment___block_invoke_2(void *a1, uint64_t a2, void *a3, void *a4)
{
  v6 = a3;
  v7 = a4;
  v8 = *(a1[5] + 8);
  v9 = *(v8 + 40);
  *(v8 + 40) = v6;
  v13 = v6;

  v10 = *(a1[6] + 8);
  v11 = *(v10 + 40);
  *(v10 + 40) = v7;
  v12 = v7;

  (*(a1[4] + 16))();
}

- (void)generateThumbnailsWithImageSource:(CGImageSource *)source imageData:(id)data metadata:(id)metadata allowMediumPreview:(BOOL)preview forceSRGBConversion:(BOOL)conversion forFinalCameraImage:(BOOL)image outSmallThumbnailData:(id *)thumbnailData isPreviewSource:(BOOL)self0
{
  imageCopy = image;
  conversionCopy = conversion;
  v135[1] = *MEMORY[0x1E69E9840];
  dataCopy = data;
  metadataCopy = metadata;
  isrc = source;
  if (!source)
  {
    v17 = 0;
    goto LABEL_85;
  }

  context = objc_autoreleasePoolPush();
  [(PLManagedAsset *)self orientation];
  if (PLExifOrientationSwapsWidthAndHeight())
  {
    height = [(PLManagedAsset *)self height];
    width = [(PLManagedAsset *)self width];
  }

  else
  {
    height = [(PLManagedAsset *)self width];
    width = [(PLManagedAsset *)self height];
  }

  v18 = width;
  v19 = height;
  [(PLManagedAsset *)self imageSize];
  v21 = v20;
  v23 = v22;
  v126 = 0.0;
  v127 = 0.0;
  v124 = 0.0;
  v125 = 0.0;
  [objc_opt_class() computePreCropThumbnailSize:&v126 andPostCropSize:&v124 forOrientedOriginalSize:1 andCroppedSize:height isLargeThumbnail:{v18, v20, v22}];
  v122 = 0.0;
  v123 = 0.0;
  v121[0] = 0;
  v121[1] = 0;
  [objc_opt_class() computePreCropThumbnailSize:&v122 andPostCropSize:v121 forOrientedOriginalSize:0 andCroppedSize:height isLargeThumbnail:{v18, v21, v23}];
  if (v122 >= v123)
  {
    v24 = v122;
  }

  else
  {
    v24 = v123;
  }

  embeddedThumbnailWidth = [(PLManagedAsset *)self embeddedThumbnailWidth];
  embeddedThumbnailHeight = [(PLManagedAsset *)self embeddedThumbnailHeight];
  if (embeddedThumbnailWidth <= embeddedThumbnailHeight)
  {
    v27 = embeddedThumbnailHeight;
  }

  else
  {
    v27 = embeddedThumbnailWidth;
  }

  v91 = v27;
  fileURLForLargeThumbnailFile = [(PLManagedAsset *)self fileURLForLargeThumbnailFile];
  v117 = 0;
  v118 = &v117;
  v119 = 0x2020000000;
  v120 = 0;
  v113 = 0;
  v114 = &v113;
  v115 = 0x2020000000;
  v116 = 0;
  if (v19 >= v18)
  {
    v18 = v19;
  }

  if (v124 >= v125)
  {
    v29 = v124;
  }

  else
  {
    v29 = v125;
  }

  v30 = MEMORY[0x1E69C08F0];
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  v94 = [v30 typeWithIdentifier:uniformTypeIdentifier];

  if ([(PLManagedAsset *)self isPhoto])
  {
    v32 = [v94 conformsToType:*MEMORY[0x1E6982F88]];
    v33 = conversionCopy;
  }

  else
  {
    v33 = conversionCopy;
    v32 = 0;
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __189__PLManagedAsset_ThumbnailGeneration__generateThumbnailsWithImageSource_imageData_metadata_allowMediumPreview_forceSRGBConversion_forFinalCameraImage_outSmallThumbnailData_isPreviewSource___block_invoke;
  aBlock[3] = &unk_1E7567AB0;
  aBlock[4] = self;
  v106 = &v117;
  url = fileURLForLargeThumbnailFile;
  v104 = url;
  v108 = v18;
  v109 = v29;
  v110 = v32;
  previewSourceCopy = previewSource;
  previewCopy = preview;
  v105 = dataCopy;
  v107 = &v113;
  v96 = _Block_copy(aBlock);
  v34 = v33;
  v35 = v96[2]();
  if (v35)
  {
    uRLByDeletingLastPathComponent = [(__CFURL *)url URLByDeletingLastPathComponent];
    v102 = 0;
    v37 = [uRLByDeletingLastPathComponent getResourceValue:&v102 forKey:*MEMORY[0x1E695DB20] error:0];
    v38 = v102;
    if ((v37 & 1) == 0)
    {
      defaultManager = [MEMORY[0x1E696AC08] defaultManager];
      v101 = 0;
      v40 = [defaultManager createDirectoryAtURL:uRLByDeletingLastPathComponent withIntermediateDirectories:1 attributes:0 error:&v101];
      v41 = v101;

      if ((v40 & 1) == 0)
      {
        v42 = PLThumbnailsGetLog();
        if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
        {
          path = [uRLByDeletingLastPathComponent path];
          *buf = 138412546;
          v129 = path;
          v130 = 2112;
          v131 = v41;
          _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Unable to create directory '%@': %@", buf, 0x16u);
        }

LABEL_40:

        goto LABEL_41;
      }

      goto LABEL_41;
    }

    goto LABEL_42;
  }

  if (thumbnailData)
  {
    if (*(v118 + 24) == 1)
    {
      if ((v114[3] & 1) == 0)
      {
        fileURLForMediumThumbnailFile = url;
        goto LABEL_31;
      }

LABEL_30:
      fileURLForMediumThumbnailFile = [(PLManagedAsset *)self fileURLForMediumThumbnailFile];
LABEL_31:
      uRLByDeletingLastPathComponent = fileURLForMediumThumbnailFile;
      if (!fileURLForMediumThumbnailFile)
      {
LABEL_43:

        goto LABEL_44;
      }

      v38 = [MEMORY[0x1E695DEF0] dataWithContentsOfURL:fileURLForMediumThumbnailFile options:1 error:0];
      if ([(__CFData *)v38 length])
      {
        uniformTypeIdentifier2 = [(PLManagedAsset *)self uniformTypeIdentifier];
        if (uniformTypeIdentifier2)
        {
          v134 = *MEMORY[0x1E696E118];
          uniformTypeIdentifier3 = [(PLManagedAsset *)self uniformTypeIdentifier];
          v135[0] = uniformTypeIdentifier3;
          v41 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v135 forKeys:&v134 count:1];
        }

        else
        {
          v41 = 0;
        }

        v47 = CGImageSourceCreateWithData(v38, v41);
        CFAutorelease(v47);
        if (!v47)
        {
          v42 = PLThumbnailsGetLog();
          if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
          {
            v48 = [(__CFData *)v38 length];
            _compactDebugDescription = [(PLManagedAsset *)self _compactDebugDescription];
            *buf = 134218242;
            v129 = v48;
            v130 = 2114;
            v131 = _compactDebugDescription;
            _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Unable to generate image source from data (length %lu) for asset %{public}@", buf, 0x16u);
          }

          goto LABEL_40;
        }

        isrc = v47;
LABEL_41:
      }

LABEL_42:

      goto LABEL_43;
    }

    if (v114[3])
    {
      goto LABEL_30;
    }
  }

LABEL_44:
  v50 = PLThumbnailsGetLog();
  v95 = [(PLManagedAsset *)self _imagePropertiesFromMetadata:metadataCopy];
  v51 = MEMORY[0x1E6982E58];
  if (v35)
  {
    v52 = PLThumbnailsGetLog();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      _compactDebugDescription2 = [(PLManagedAsset *)self _compactDebugDescription];
      *buf = 138543362;
      v129 = _compactDebugDescription2;
      _os_log_impl(&dword_19BF1F000, v52, OS_LOG_TYPE_INFO, "Unable to generate thumbnails via hardware decoder, falling back to software for %{public}@", buf, 0xCu);
    }

    identifier = [*v51 identifier];
    v55 = CGImageDestinationCreateWithURL(url, identifier, 1uLL, 0);

    if (v55)
    {
      v56 = objc_alloc(MEMORY[0x1E69C06B0]);
      v57 = MetadataForPreviewJPGFromOriginalMetadata(v95);
      v58 = [v56 initWithOptions:v57];

      v59 = os_signpost_id_generate(v50);
      v60 = v50;
      v61 = v60;
      spid = v59;
      v62 = v59 - 1;
      if (v59 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v60))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v129 = uuid;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v61, OS_SIGNPOST_INTERVAL_BEGIN, spid, "generateThumbnailsWithImageSource_SW_Lg1", "uuid: %{public}@", buf, 0xCu);
      }

      v64 = v126;
      if (v126 < v127)
      {
        v64 = v127;
      }

      [v58 setMaximumLongSideLength:v64];
      [v58 setIncludeHDRGainMaps:1];
      if (v34)
      {
        [v58 setColorBehavior:2];
      }

      PrimaryImageIndex = CGImageSourceGetPrimaryImageIndex(isrc);
      options = [v58 options];
      CGImageDestinationAddImageFromSource(v55, isrc, PrimaryImageIndex, options);

      if (!CGImageDestinationFinalize(v55))
      {
        v67 = PLThumbnailsGetLog();
        if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
        {
          _compactDebugDescription3 = [(PLManagedAsset *)self _compactDebugDescription];
          options2 = [v58 options];
          *buf = 138543874;
          v129 = _compactDebugDescription3;
          v130 = 2114;
          v131 = isrc;
          v132 = 2114;
          v133 = options2;
          _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "Failed to generate large thumbnail for %{public}@ from image source %{public}@ with options %{public}@", buf, 0x20u);

          v51 = MEMORY[0x1E6982E58];
        }
      }

      CFRelease(v55);
      v70 = v61;
      v71 = v70;
      if (v62 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v70))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v71, OS_SIGNPOST_INTERVAL_END, spid, "generateThumbnailsWithImageSource_SW_Lg1", "", buf, 2u);
      }
    }
  }

  if (thumbnailData)
  {
    v17 = objc_alloc_init(MEMORY[0x1E695DF88]);
    identifier2 = [*v51 identifier];
    v73 = CGImageDestinationCreateWithData(v17, identifier2, 1uLL, 0);

    if (v73)
    {
      v74 = objc_alloc(MEMORY[0x1E69C06B0]);
      v75 = MetadataForPreviewJPGFromOriginalMetadata(v95);
      v76 = [v74 initWithOptions:v75];

      v77 = v91;
      if (v24 > v91)
      {
        v77 = v24;
      }

      [v76 setMaximumLongSideLength:v77];
      [v76 setColorBehavior:3];
      [v76 setIncludeHDRGainMaps:1];
      if (v34)
      {
        [v76 setColorBehavior:2];
      }

      if (imageCopy)
      {
        [v76 setObject:&unk_1F0FBB0B0 forKeyedSubscript:*MEMORY[0x1E696E110]];
      }

      v78 = os_signpost_id_generate(v50);
      v79 = v50;
      v80 = v79;
      if (v78 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v79))
      {
        uuid2 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v129 = uuid2;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v80, OS_SIGNPOST_INTERVAL_BEGIN, v78, "generateThumbnailsWithImageSource_SW_Sm2", "uuid: %{public}@", buf, 0xCu);
      }

      v82 = CGImageSourceGetPrimaryImageIndex(isrc);
      options3 = [v76 options];
      CGImageDestinationAddImageFromSource(v73, isrc, v82, options3);

      if (!CGImageDestinationFinalize(v73))
      {
        v84 = PLThumbnailsGetLog();
        if (os_log_type_enabled(v84, OS_LOG_TYPE_ERROR))
        {
          _compactDebugDescription4 = [(PLManagedAsset *)self _compactDebugDescription];
          options4 = [v76 options];
          *buf = 138543874;
          v129 = _compactDebugDescription4;
          v130 = 2114;
          v131 = isrc;
          v132 = 2114;
          v133 = options4;
          _os_log_impl(&dword_19BF1F000, v84, OS_LOG_TYPE_ERROR, "Failed to generate small thumbnail for %{public}@ from image source %{public}@ with options %{public}@", buf, 0x20u);
        }

        v17 = 0;
      }

      CFRelease(v73);
      v87 = v80;
      v88 = v87;
      if (v78 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v87))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v88, OS_SIGNPOST_INTERVAL_END, v78, "generateThumbnailsWithImageSource_SW_Sm2", "", buf, 2u);
      }
    }
  }

  else
  {
    v17 = 0;
  }

  _Block_object_dispose(&v113, 8);
  _Block_object_dispose(&v117, 8);

  objc_autoreleasePoolPop(context);
  if (thumbnailData)
  {
    v89 = v17;
    *thumbnailData = v17;
  }

LABEL_85:
}

uint64_t __189__PLManagedAsset_ThumbnailGeneration__generateThumbnailsWithImageSource_imageData_metadata_allowMediumPreview_forceSRGBConversion_forFinalCameraImage_outSmallThumbnailData_isPreviewSource___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) photoLibrary];
  if (([v2 isCloudPhotoLibraryEnabled] & 1) == 0)
  {
    v3 = [*(a1 + 32) isCPLSharingScopeAsset];

    if (v3)
    {
      return 0;
    }

    v5 = *(a1 + 40);
    v21 = 0;
    v6 = *MEMORY[0x1E695DB20];
    v7 = [v5 getResourceValue:&v21 forKey:*MEMORY[0x1E695DB20] error:0];
    v8 = v21;
    *(*(*(a1 + 56) + 8) + 24) = v7;
    v9 = *(a1 + 72);
    v10 = *(a1 + 80);
    v11 = [*(a1 + 32) width];
    v12 = [*(a1 + 32) height];
    v13 = [*(a1 + 32) isSavedPhotosAsset];
    if ((*(a1 + 48) || (*(*(*(a1 + 56) + 8) + 24) & 1) == 0) && ((*(a1 + 88) & 1) != 0 || ((v9 / v10 > 1.22474487) & ~v13) != 0 || v12 * v11 >= 25000000))
    {
      v14 = *(a1 + 89);
      if ((v14 & 1) == 0)
      {
        if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && *(a1 + 90) == 1)
        {
          v15 = [*(a1 + 32) fileURLForMediumThumbnailFile];
          v20 = 0;
          v16 = [v15 getResourceValue:&v20 forKey:v6 error:0];
          v17 = v20;

          *(*(*(a1 + 64) + 8) + 24) = v16;
          v18 = *(*(*(a1 + 64) + 8) + 24) | v14;

          if (v18)
          {
            v4 = 0;
            v8 = v17;
LABEL_18:

            return v4;
          }

          v8 = v17;
        }

        v4 = [*(a1 + 32) avalanchePickTypeIsVisible];
        goto LABEL_18;
      }
    }

    v4 = 0;
    goto LABEL_18;
  }

  return 0;
}

- (void)copyAuxiliaryImagesFromImageSource:(CGImageSource *)source toDestination:(CGImageDestination *)destination fromImageAtIndex:(unint64_t)index imageProperties:(id)properties applyingOrientation:(signed __int16)orientation scalingToLongSideLength:(int64_t)length
{
  orientationCopy = orientation;
  v13 = MEMORY[0x1E69C0708];
  propertiesCopy = properties;
  v15 = [v13 auxiliaryImagesToPreserveForDerivativesFromImageSource:source imageIndex:index];
  v16 = [propertiesCopy objectForKeyedSubscript:*MEMORY[0x1E696DED8]];
  integerValue = [v16 integerValue];

  v18 = [propertiesCopy objectForKeyedSubscript:*MEMORY[0x1E696DEC8]];

  integerValue2 = [v18 integerValue];
  if (integerValue <= integerValue2)
  {
    v20 = integerValue2;
  }

  else
  {
    v20 = integerValue;
  }

  v21 = [MEMORY[0x1E69C0708] transformAuxiliaryImages:v15 scaleFactor:orientationCopy applyingOrientation:length / v20];
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __165__PLManagedAsset_ThumbnailGeneration__copyAuxiliaryImagesFromImageSource_toDestination_fromImageAtIndex_imageProperties_applyingOrientation_scalingToLongSideLength___block_invoke;
  v22[3] = &__block_descriptor_40_e39_v32__0__NSString_8__NSDictionary_16_B24l;
  v22[4] = destination;
  [v21 enumerateKeysAndObjectsUsingBlock:v22];
}

- (int64_t)cameraProcessingAdjustmentTrashedState
{
  v15 = *MEMORY[0x1E69E9840];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v3 = [modernResources countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v11;
    v6 = 1;
LABEL_3:
    v7 = 0;
    while (1)
    {
      if (*v11 != v5)
      {
        objc_enumerationMutation(modernResources);
      }

      v8 = *(*(&v10 + 1) + 8 * v7);
      if ([v8 supportsTrashedState])
      {
        if ([v8 isTrashedOrExpunged])
        {
          break;
        }
      }

      if (v4 == ++v7)
      {
        v4 = [modernResources countByEnumeratingWithState:&v10 objects:v14 count:16];
        if (v4)
        {
          goto LABEL_3;
        }

        goto LABEL_10;
      }
    }
  }

  else
  {
LABEL_10:
    v6 = 0;
  }

  return v6;
}

- (CGSize)videoComplementSpatialOverCaptureSize
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v3 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v13;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v13 != v5)
        {
          objc_enumerationMutation(modernResources);
        }

        v7 = *(*(&v12 + 1) + 8 * i);
        if ([v7 resourceType] == 11)
        {
          unorientedWidth = [v7 unorientedWidth];
          unorientedHeight = [v7 unorientedHeight];

          goto LABEL_11;
        }
      }

      v4 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  unorientedWidth = *MEMORY[0x1E695F060];
  unorientedHeight = *(MEMORY[0x1E695F060] + 8);
LABEL_11:
  v10 = unorientedWidth;
  v11 = unorientedHeight;
  result.height = v11;
  result.width = v10;
  return result;
}

- (CGSize)spatialOverCaptureSize
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v3 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v13;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v13 != v5)
        {
          objc_enumerationMutation(modernResources);
        }

        v7 = *(*(&v12 + 1) + 8 * i);
        if ([v7 resourceType] == 10)
        {
          unorientedWidth = [v7 unorientedWidth];
          unorientedHeight = [v7 unorientedHeight];

          goto LABEL_11;
        }
      }

      v4 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  unorientedWidth = *MEMORY[0x1E695F060];
  unorientedHeight = *(MEMORY[0x1E695F060] + 8);
LABEL_11:
  v10 = unorientedWidth;
  v11 = unorientedHeight;
  result.height = v11;
  result.width = v10;
  return result;
}

- (unint64_t)ptpCloudMasterOriginalFileSize
{
  v2 = [(PLManagedAsset *)self masterResourceForCPLType:1];
  dataLength = [v2 dataLength];

  return dataLength;
}

- (NSData)faceRegions
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  faceRegions = [additionalAttributes faceRegions];

  return faceRegions;
}

- (void)setFaceRegions:(id)regions
{
  regionsCopy = regions;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setFaceRegions:regionsCopy];
}

- (void)setAccessibilityDescription:(id)description
{
  descriptionCopy = description;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setAccessibilityDescription:descriptionCopy];
}

- (NSString)accessibilityDescription
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  accessibilityDescription = [additionalAttributes accessibilityDescription];

  return accessibilityDescription;
}

- (void)setTitle:(id)title
{
  titleCopy = title;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setTitle:titleCopy];
}

- (NSString)title
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  title = [additionalAttributes title];

  return title;
}

- (void)setLongDescription:(id)description
{
  descriptionCopy = description;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setLongDescription:descriptionCopy];
}

- (NSString)longDescription
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  longDescription = [additionalAttributes longDescription];

  return longDescription;
}

- (void)setLocationHash:(int)hash
{
  v3 = *&hash;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithInt:v3];
  [additionalAttributes setLocationHash:v4];
}

- (int)locationHash
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  locationHash = [additionalAttributes locationHash];
  intValue = [locationHash intValue];

  return intValue;
}

- (void)setEmbeddedThumbnailHeight:(signed __int16)height
{
  heightCopy = height;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:heightCopy];
  [additionalAttributes setEmbeddedThumbnailHeight:v4];
}

- (signed)embeddedThumbnailHeight
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  embeddedThumbnailHeight = [additionalAttributes embeddedThumbnailHeight];
  shortValue = [embeddedThumbnailHeight shortValue];

  return shortValue;
}

- (void)setEmbeddedThumbnailWidth:(signed __int16)width
{
  widthCopy = width;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:widthCopy];
  [additionalAttributes setEmbeddedThumbnailWidth:v4];
}

- (signed)embeddedThumbnailWidth
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  embeddedThumbnailWidth = [additionalAttributes embeddedThumbnailWidth];
  shortValue = [embeddedThumbnailWidth shortValue];

  return shortValue;
}

- (void)setEmbeddedThumbnailLength:(int)length
{
  v3 = *&length;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithInt:v3];
  [additionalAttributes setEmbeddedThumbnailLength:v4];
}

- (int)embeddedThumbnailLength
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  embeddedThumbnailLength = [additionalAttributes embeddedThumbnailLength];
  intValue = [embeddedThumbnailLength intValue];

  return intValue;
}

- (void)setEmbeddedThumbnailOffset:(int)offset
{
  v3 = *&offset;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithInt:v3];
  [additionalAttributes setEmbeddedThumbnailOffset:v4];
}

- (int)embeddedThumbnailOffset
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  embeddedThumbnailOffset = [additionalAttributes embeddedThumbnailOffset];
  intValue = [embeddedThumbnailOffset intValue];

  return intValue;
}

- (NSData)embeddedThumbnailData
{
  v3 = objc_autoreleasePoolPush();
  embeddedThumbnailOffset = [(PLManagedAsset *)self embeddedThumbnailOffset];
  embeddedThumbnailLength = [(PLManagedAsset *)self embeddedThumbnailLength];
  if (embeddedThumbnailLength && (v6 = embeddedThumbnailLength, v7 = MEMORY[0x1E696AC00], -[PLManagedAsset mainFileURL](self, "mainFileURL"), v8 = objc_claimAutoreleasedReturnValue(), v12 = 0, [v7 fileHandleForReadingFromURL:v8 error:&v12], v9 = objc_claimAutoreleasedReturnValue(), v8, v9))
  {
    [v9 seekToFileOffset:embeddedThumbnailOffset];
    v10 = [v9 readDataOfLength:v6];
    [v9 closeFile];
    if ([v10 length] != v6)
    {

      v10 = 0;
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    objc_autoreleasePoolPop(v3);
    v10 = 0;
  }

  return v10;
}

- (void)setOriginalFilesize:(unint64_t)filesize
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithUnsignedLongLong:filesize];
  [additionalAttributes setOriginalFilesize:v4];
}

- (unint64_t)originalFilesize
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalFilesize = [additionalAttributes originalFilesize];
  unsignedLongLongValue = [originalFilesize unsignedLongLongValue];

  return unsignedLongLongValue;
}

- (void)setOriginalOrientation:(signed __int16)orientation
{
  v4 = [PLManagedAsset correctedOrientation:orientation];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v5 = [MEMORY[0x1E696AD98] numberWithShort:v4];
  [additionalAttributes setOriginalOrientation:v5];
}

- (signed)originalOrientation
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalOrientation = [additionalAttributes originalOrientation];
  shortValue = [originalOrientation shortValue];

  return shortValue;
}

- (void)setOriginalFilename:(id)filename
{
  filenameCopy = filename;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setOriginalFilename:filenameCopy];
}

- (void)setPublicGlobalUUID:(id)d
{
  dCopy = d;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setPublicGlobalUUID:dCopy];
}

- (NSString)publicGlobalUUID
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  publicGlobalUUID = [additionalAttributes publicGlobalUUID];

  return publicGlobalUUID;
}

- (void)setOriginalHash:(id)hash
{
  hashCopy = hash;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setOriginalHash:hashCopy];
}

- (NSData)originalHash
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalHash = [additionalAttributes originalHash];

  return originalHash;
}

- (void)setOriginalWidth:(int64_t)width
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithLongLong:width];
  [additionalAttributes setOriginalWidth:v4];
}

- (int64_t)originalWidth
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalWidth = [additionalAttributes originalWidth];
  longLongValue = [originalWidth longLongValue];

  return longLongValue;
}

- (void)setOriginalHeight:(int64_t)height
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithLongLong:height];
  [additionalAttributes setOriginalHeight:v4];
}

- (int64_t)originalHeight
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalHeight = [additionalAttributes originalHeight];
  longLongValue = [originalHeight longLongValue];

  return longLongValue;
}

- (void)setOriginalAssetsUUID:(id)d
{
  dCopy = d;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setOriginalAssetsUUID:dCopy];
}

- (NSString)originalAssetsUUID
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalAssetsUUID = [additionalAttributes originalAssetsUUID];

  return originalAssetsUUID;
}

- (void)setEditorBundleID:(id)d
{
  dCopy = d;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setEditorBundleID:dCopy];
}

- (NSString)editorBundleID
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  editorBundleID = [additionalAttributes editorBundleID];

  return editorBundleID;
}

- (void)setImportedByDisplayName:(id)name
{
  nameCopy = name;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setImportedByDisplayName:nameCopy];
}

- (NSString)importedByDisplayName
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  importedByDisplayName = [additionalAttributes importedByDisplayName];

  return importedByDisplayName;
}

+ (void)computePreCropThumbnailSize:(CGSize *)size andPostCropSize:(CGSize *)cropSize forOrientedOriginalSize:(CGSize)originalSize andCroppedSize:(CGSize)croppedSize isLargeThumbnail:(BOOL)thumbnail
{
  thumbnailCopy = thumbnail;
  height = croppedSize.height;
  width = croppedSize.width;
  v10 = originalSize.height;
  v11 = originalSize.width;
  if (PLMaxIOSurfaceDimension_onceToken != -1)
  {
    dispatch_once(&PLMaxIOSurfaceDimension_onceToken, &__block_literal_global_13720);
  }

  v14 = PLMaxIOSurfaceDimension_maxDimension;
  defaultFormatChooser = [MEMORY[0x1E69BF248] defaultFormatChooser];
  v16 = defaultFormatChooser;
  if (thumbnailCopy)
  {
    fullScreenFormatForCurrentDevice = [defaultFormatChooser fullScreenFormatForCurrentDevice];

    v18 = MEMORY[0x19EAEEA40]([fullScreenFormatForCurrentDevice fullSizeDesiredLongSide], objc_msgSend(fullScreenFormatForCurrentDevice, "fullSizeMinShortSide"), objc_msgSend(fullScreenFormatForCurrentDevice, "fullSizeMaxLongSide"), 2, width, height);
    v20 = v19;
    v16 = fullScreenFormatForCurrentDevice;
  }

  else
  {
    masterThumbnailFormat = [defaultFormatChooser masterThumbnailFormat];
    [masterThumbnailFormat scaledSizeForSourceSize:1 capLength:{width, height}];
    v18 = v22;
    v20 = v23;
  }

  v24 = ceil(v11 * (v18 / width));
  v25 = ceil(v10 * (v18 / width));
  v26 = v14;
  if (v24 > v14 || v25 > v26)
  {
    if (v24 > v26)
    {
      v24 = v14;
      v25 = v10 * v26 / v11;
    }

    if (v25 > v26)
    {
      v25 = v14;
      v24 = v11 * v26 / v10;
    }

    v28 = v18 != (width * v24 / v11);
    if (v20 != (height * v25 / v10))
    {
      v28 = 1;
    }

    if (v28)
    {
      v20 = (height * v25 / v10);
      v18 = (width * v24 / v11);
    }
  }

  if (v24 >= 2.0)
  {
    v24 = ((v24 + (v24 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (v25 >= 2.0)
  {
    v25 = ((v25 + (v25 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (v18 >= 2.0)
  {
    v18 = ((v18 + (v18 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (v20 >= 2.0)
  {
    v20 = ((v20 + (v20 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (cropSize)
  {
    cropSize->width = v18;
    cropSize->height = v20;
  }

  if (size)
  {
    size->width = v24;
    size->height = v25;
  }
}

+ (void)createThumbnailImage:(id *)image previewImage:(id *)previewImage withToBeReleasedImageSource:(CGImageSource *)source
{
  options = objc_alloc_init(MEMORY[0x1E695DF90]);
  v8 = MEMORY[0x1E695E118];
  [(__CFDictionary *)options setObject:MEMORY[0x1E695E118] forKeyedSubscript:*MEMORY[0x1E696E000]];
  [(__CFDictionary *)options setObject:v8 forKeyedSubscript:*MEMORY[0x1E696DFE8]];
  v9 = MEMORY[0x1E696AD98];
  defaultFormatChooser = [MEMORY[0x1E69BF248] defaultFormatChooser];
  masterThumbnailFormat = [defaultFormatChooser masterThumbnailFormat];
  [masterThumbnailFormat dimension];
  v12 = [v9 numberWithDouble:?];
  v13 = *MEMORY[0x1E696E100];
  [(__CFDictionary *)options setObject:v12 forKeyedSubscript:*MEMORY[0x1E696E100]];

  ThumbnailAtIndex = CGImageSourceCreateThumbnailAtIndex(source, 0, options);
  v15 = DCIM_newPLImageWithCGImage();
  CGImageRelease(ThumbnailAtIndex);
  [(__CFDictionary *)options setObject:&unk_1F0FBB428 forKeyedSubscript:v13];
  v16 = CGImageSourceCreateThumbnailAtIndex(source, 0, options);
  v17 = DCIM_newPLImageWithCGImage();
  CGImageRelease(v16);
  CFRelease(source);
  if (image)
  {
    v18 = v15;
    *image = v15;
  }

  if (previewImage)
  {
    v19 = v17;
    *previewImage = v17;
  }
}

+ (id)_newPathAndDateDictionariesByAssetUUIDFromFetchResults:(id)results photoLibrary:(id)library
{
  v41 = *MEMORY[0x1E69E9840];
  resultsCopy = results;
  libraryCopy = library;
  v28 = [objc_alloc(MEMORY[0x1E695DF90]) initWithCapacity:{objc_msgSend(resultsCopy, "count")}];
  pathManager = [libraryCopy pathManager];
  v29 = [pathManager photoDirectoryWithType:1];

  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = resultsCopy;
  v7 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = @"filename";
    v10 = *v33;
    do
    {
      v11 = 0;
      v30 = v8;
      do
      {
        if (*v33 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v32 + 1) + 8 * v11);
        v13 = [v12 objectForKey:@"directory"];
        v14 = [v12 objectForKey:v9];
        if ([v13 length] && objc_msgSend(v14, "length"))
        {
          v15 = v9;
          v16 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@/%@", v13, v14];
          v17 = [v29 stringByAppendingPathComponent:v16];

          v18 = [v12 objectForKey:@"uuid"];
          if ([v18 length])
          {
            v19 = [v12 objectForKey:@"dateCreated"];
            v20 = v19;
            if (v19)
            {
              v38[0] = @"date";
              v38[1] = @"path";
              v39[0] = v19;
              v39[1] = v17;
              v21 = MEMORY[0x1E695DF20];
              v22 = v39;
              v23 = v38;
              v24 = 2;
            }

            else
            {
              v36 = @"path";
              v37 = v17;
              v21 = MEMORY[0x1E695DF20];
              v22 = &v37;
              v23 = &v36;
              v24 = 1;
            }

            v25 = [v21 dictionaryWithObjects:v22 forKeys:v23 count:v24];
            [v28 setObject:v25 forKey:v18];
          }

          v9 = v15;
          v8 = v30;
        }

        ++v11;
      }

      while (v8 != v11);
      v8 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
    }

    while (v8);
  }

  return v28;
}

+ (id)pathAndDateDictionariesForAllIncompleteAssetsInManagedObjectContext:(id)context
{
  v33[4] = *MEMORY[0x1E69E9840];
  contextCopy = context;
  context = objc_autoreleasePoolPush();
  v5 = objc_alloc_init(MEMORY[0x1E695D5E0]);
  v6 = [objc_opt_class() entityInManagedObjectContext:contextCopy];
  [v5 setEntity:v6];
  [v5 setResultType:2];
  v33[0] = @"uuid";
  v33[1] = @"directory";
  v33[2] = @"filename";
  v33[3] = @"dateCreated";
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v33 count:4];
  [v5 setPropertiesToFetch:v7];

  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"complete == 0"];
  v9 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForPLSyncClientIncompleteAssetExclusions"), 1}];
  v10 = MEMORY[0x1E696AB28];
  v32[0] = v8;
  v32[1] = v9;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v32 count:2];
  v12 = v10;
  v13 = contextCopy;
  v14 = [v12 andPredicateWithSubpredicates:v11];

  [v5 setPredicate:v14];
  v27 = 0;
  v15 = [v13 executeFetchRequest:v5 error:&v27];
  v16 = v27;
  if (!v15)
  {
    v24 = v13;
    v17 = PLBackendGetLog();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = NSStringFromSelector(a2);
      *buf = 138412546;
      v29 = v18;
      v30 = 2112;
      v31 = v16;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "%@ failed to fetch incomplete assets %@", buf, 0x16u);
    }

    v13 = v24;
  }

  photoLibrary = [v13 photoLibrary];
  v20 = [self _newPathAndDateDictionariesByAssetUUIDFromFetchResults:v15 photoLibrary:photoLibrary];
  v21 = v13;
  v22 = v20;

  objc_autoreleasePoolPop(context);

  return v22;
}

- (void)simulateQuarantineOriginalImageResourceOnPush:(id)push
{
  v33 = *MEMORY[0x1E69E9840];
  pushCopy = push;
  if ([(PLManagedAsset *)self isPhoto])
  {
    v5 = objc_autoreleasePoolPush();
    identity = [pushCopy identity];
    fileURL = [identity fileURL];

    v8 = MEMORY[0x1E69C08F0];
    identity2 = [pushCopy identity];
    fileUTI = [identity2 fileUTI];
    v11 = [v8 typeWithIdentifier:fileUTI];

    v12 = *MEMORY[0x1E6982E58];
    if (([v11 conformsToType:*MEMORY[0x1E6982E58]] & 1) == 0 && !objc_msgSend(v11, "conformsToType:", *MEMORY[0x1E6982F28]))
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_20:

        objc_autoreleasePoolPop(v5);
        goto LABEL_21;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        *buf = 136315650;
        v28 = "[PLManagedAsset(CPLSimulateQuarantine) simulateQuarantineOriginalImageResourceOnPush:]";
        v29 = 2112;
        v30 = v11;
        v31 = 2112;
        v32 = fileURL;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "%s: unsupported uti: %@ for url: %@", buf, 0x20u);
      }

LABEL_19:

      goto LABEL_20;
    }

    v13 = [MEMORY[0x1E695F648] filterWithName:@"CISepiaTone"];
    [v13 setValue:&unk_1F0FC03E8 forKey:*MEMORY[0x1E695FAB8]];
    v14 = [MEMORY[0x1E695F658] imageWithContentsOfURL:fileURL];
    [v13 setValue:v14 forKey:*MEMORY[0x1E695FAB0]];
    outputImage = [v13 outputImage];
    context = [MEMORY[0x1E695F620] context];
    v24 = v5;
    if ([v11 conformsToType:v12])
    {
      colorSpace = [v14 colorSpace];
      v26 = 0;
      v18 = [context writeJPEGRepresentationOfImage:outputImage toURL:fileURL colorSpace:colorSpace options:MEMORY[0x1E695E0F8] error:&v26];
      v19 = v26;
      if (v18)
      {
LABEL_18:

        v5 = v24;
        goto LABEL_19;
      }
    }

    else if ([v11 conformsToType:*MEMORY[0x1E6982F28]])
    {
      v20 = CGColorSpaceCreateWithName(*MEMORY[0x1E695F1C0]);
      v21 = *MEMORY[0x1E695F920];
      v25 = 0;
      v22 = [context writePNGRepresentationOfImage:outputImage toURL:fileURL format:v21 colorSpace:v20 options:MEMORY[0x1E695E0F8] error:&v25];
      v19 = v25;
      CFRelease(v20);
      if (v22)
      {
        goto LABEL_18;
      }
    }

    else
    {
      v19 = 0;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v23 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        *buf = 136315394;
        v28 = "[PLManagedAsset(CPLSimulateQuarantine) simulateQuarantineOriginalImageResourceOnPush:]";
        v29 = 2112;
        v30 = fileURL;
        _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_ERROR, "%s: failed to write output: %@", buf, 0x16u);
      }
    }

    goto LABEL_18;
  }

LABEL_21:
}

- (BOOL)shouldSimulateQuarantineOriginalImageResourceOnPush
{
  if (shouldSimulateQuarantineOriginalImageResourceOnPush_onceToken != -1)
  {
    dispatch_once(&shouldSimulateQuarantineOriginalImageResourceOnPush_onceToken, &__block_literal_global_16666);
  }

  return shouldSimulateQuarantineOriginalImageResourceOnPush_simulateQuarantine;
}

void __92__PLManagedAsset_CPLSimulateQuarantine__shouldSimulateQuarantineOriginalImageResourceOnPush__block_invoke()
{
  if (MEMORY[0x19EAEE230]())
  {
    v0 = [MEMORY[0x1E695E000] standardUserDefaults];
    shouldSimulateQuarantineOriginalImageResourceOnPush_simulateQuarantine = [v0 BOOLForKey:@"PLSimulateQuarantineMasterImageOnPush"];
  }
}

- (BOOL)cleanUpMetadataPath
{
  v15 = *MEMORY[0x1E69E9840];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  pathForCameraMetadataFile = [(PLManagedAsset *)self pathForCameraMetadataFile];
  v10 = 0;
  v5 = [defaultManager removeItemAtPath:pathForCameraMetadataFile error:&v10];
  v6 = v10;

  if ((v5 & 1) == 0)
  {
    v7 = PLBackendGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      pathForCameraMetadataFile2 = [(PLManagedAsset *)self pathForCameraMetadataFile];
      *buf = 138412546;
      v12 = pathForCameraMetadataFile2;
      v13 = 2112;
      v14 = v6;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "[SemDev] Unable to remove MDATA file at path %@: %@", buf, 0x16u);
    }
  }

  return 1;
}

- (BOOL)promoteSemanticEnhancePreviewToFinalImage:(id *)image
{
  v20 = *MEMORY[0x1E69E9840];
  v17 = 0;
  v5 = [(PLManagedAsset *)self promoteDeferredPreviewToFinalImageWithOutError:&v17];
  v6 = v17;
  if (!v5)
  {
    v7 = PLDeferredProcessingGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v6;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "[SemDev] Error promoting deferred preview to final image: %@", buf, 0xCu);
    }
  }

  [(PLManagedAsset *)self cleanUpMetadataPath];
  [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setDeferredProcessingCandidateOptions:0];

  if ([(PLManagedAsset *)self hasAdjustments])
  {
    if (![(PLManagedAsset *)self isPhotoIrisPlaceholder])
    {
      [(PLManagedAsset *)self setDeferredProcessingNeeded:2];
      photoLibrary = [(PLManagedObject *)self photoLibrary];
      libraryServicesManager = [photoLibrary libraryServicesManager];
      backgroundJobService = [libraryServicesManager backgroundJobService];
      photoLibrary2 = [(PLManagedObject *)self photoLibrary];
      v14 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
      [backgroundJobService signalBackgroundProcessingNeededOnLibrary:photoLibrary2 workerTypes:v14];

LABEL_11:
      goto LABEL_12;
    }

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      photoLibrary = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(photoLibrary, OS_LOG_TYPE_DEFAULT))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v19 = uuid;
        _os_log_impl(&dword_19BF1F000, photoLibrary, OS_LOG_TYPE_DEFAULT, "Promoted semantic enhance preview to final image for adjusted live photo (%{public}@) which is still a placeholder, skipping deferred adjustment", buf, 0xCu);
      }

      goto LABEL_11;
    }
  }

LABEL_12:
  if (image && v6)
  {
    v15 = v6;
    *image = v6;
  }

  return v6 == 0;
}

- (BOOL)installFinalVideoComplementAndRemoveDeferredFilesWithOutError:(id *)error
{
  v23 = *MEMORY[0x1E69E9840];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  pathForDeferredVideoComplementFile = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  v18 = 0;
  v7 = [defaultManager removeItemAtPath:pathForDeferredVideoComplementFile error:&v18];
  v8 = v18;
  if (v7)
  {
  }

  else
  {
    v9 = PLIsErrorFileNotFound();

    if ((v9 & 1) == 0)
    {
      v13 = PLBackendGetLog();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        pathForDeferredVideoComplementFile2 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
        *buf = 138412546;
        v20 = pathForDeferredVideoComplementFile2;
        v21 = 2112;
        v22 = v8;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to remove item at path %@: %@", buf, 0x16u);
      }

      goto LABEL_11;
    }
  }

  v17 = v8;
  v10 = [(PLManagedAsset *)self _updateAndStoreFinalVideoComplementResourceWithOutError:&v17];
  v11 = v17;

  if (v10)
  {
    [(PLManagedAsset *)self deleteResourcesWithRecipeID:131279 andVersion:0];
    v12 = 1;
    goto LABEL_15;
  }

  v13 = PLBackendGetLog();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v20 = v11;
    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to update and store video complement resource with error: %@", buf, 0xCu);
  }

  v8 = v11;
LABEL_11:

  if (error)
  {
    v15 = v8;
    v12 = 0;
    *error = v8;
  }

  else
  {
    v12 = 0;
  }

  v11 = v8;
LABEL_15:

  return v12;
}

- (BOOL)promoteProxyToFinalVideoComplementWithOutError:(id *)error
{
  v31 = *MEMORY[0x1E69E9840];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v6 = MEMORY[0x1E69BF238];
  fileURLForDeferredVideoComplement = [(PLManagedAsset *)self fileURLForDeferredVideoComplement];
  fileURLForOriginalVideoComplement = [(PLManagedAsset *)self fileURLForOriginalVideoComplement];
  v26 = 0;
  v9 = [v6 copyItemAtURL:fileURLForDeferredVideoComplement toURL:fileURLForOriginalVideoComplement error:&v26];
  v10 = v26;
  if (v9 & 1) != 0 || ([MEMORY[0x1E69BF238] isFileExistsError:v10])
  {
    goto LABEL_3;
  }

  v18 = PLIsErrorFileNotFound();

  if ((v18 & 1) == 0)
  {
    fileURLForDeferredVideoComplement = PLBackendGetLog();
    if (!os_log_type_enabled(fileURLForDeferredVideoComplement, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_4;
    }

    fileURLForOriginalVideoComplement = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
    *buf = 138412546;
    v28 = fileURLForOriginalVideoComplement;
    v29 = 2112;
    v30 = v10;
    _os_log_impl(&dword_19BF1F000, fileURLForDeferredVideoComplement, OS_LOG_TYPE_ERROR, "[FDR] Error copying video complement proxy file %@, error: %@", buf, 0x16u);
LABEL_3:

LABEL_4:
  }

  v25 = v10;
  v11 = [(PLManagedAsset *)self _updateAndStoreFinalVideoComplementResourceWithOutError:&v25];
  v12 = v25;

  if (v11)
  {
    pathForDeferredVideoComplementFile = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
    v24 = v12;
    v14 = [defaultManager removeItemAtPath:pathForDeferredVideoComplementFile error:&v24];
    v15 = v24;

    if (v14)
    {

LABEL_14:
      [(PLManagedAsset *)self deleteResourcesWithRecipeID:131279 andVersion:0];
      v20 = 1;
      goto LABEL_22;
    }

    v19 = PLIsErrorFileNotFound();

    if (v19)
    {
      goto LABEL_14;
    }

    v16 = PLBackendGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      pathForDeferredVideoComplementFile2 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
      *buf = 138412546;
      v28 = pathForDeferredVideoComplementFile2;
      v29 = 2112;
      v30 = v15;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Failed to remove item at path %@: %@", buf, 0x16u);
    }

    v12 = v15;
  }

  else
  {
    v16 = PLBackendGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138543618;
      v28 = uuid;
      v29 = 2112;
      v30 = v12;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Failed to install resources for asset %{public}@: %@", buf, 0x16u);
    }
  }

  if (error)
  {
    v22 = v12;
    v20 = 0;
    *error = v12;
  }

  else
  {
    v20 = 0;
  }

  v15 = v12;
LABEL_22:

  return v20;
}

- (BOOL)_updateAndStoreFinalVideoComplementResourceWithOutError:(id *)error
{
  pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  v7 = [PLResourceInstaller validatedExternalResourceForLocalVideoIfPresentAtPath:pathForVideoComplementFile context:managedObjectContext];

  if (!v7)
  {
    LOBYTE(v11) = 0;
    if (!error)
    {
      goto LABEL_6;
    }

    goto LABEL_5;
  }

  [v7 setRecipeID:0];
  [v7 setResourceType:3];
  [v7 setVersion:0];
  assetID = [(PLManagedAsset *)self assetID];
  libraryID = [assetID libraryID];
  v10 = PLDataStoreForClassIDAndLibraryID(0, libraryID);

  v15 = 0;
  v16 = 0;
  v11 = [v10 storeExternalResource:v7 forAsset:self options:0 error:&v16 resultingResource:&v15];
  v12 = v16;
  v13 = v15;
  if (v11)
  {
    [(PLManagedAsset *)self deleteResourcesWithRecipeID:131280 andVersion:0];
  }

  if (error)
  {
LABEL_5:
    *error = 0;
  }

LABEL_6:

  return v11;
}

- (BOOL)transitionToDeferredProcessingNeededAdjustmentWithOriginalWidth:(unint64_t)width originalHeight:(unint64_t)height shouldSignalBackgroundProcessingNeeded:(BOOL)needed reason:(id)reason
{
  neededCopy = needed;
  v26 = *MEMORY[0x1E69E9840];
  reasonCopy = reason;
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    isPhotoIrisPlaceholder = [(PLManagedAsset *)self isPhotoIrisPlaceholder];
    if (!isPhotoIrisPlaceholder)
    {
      [(PLManagedAsset *)self setHeight:height];
      [(PLManagedAsset *)self setWidth:width];
      [(PLManagedAsset *)self setDeferredProcessingNeeded:2];
      v15 = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG))
      {
        uuid = [(PLManagedAsset *)self uuid];
        v22 = 138543618;
        v23 = reasonCopy;
        v24 = 2114;
        v25 = uuid;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEBUG, "%{public}@ finished, transitioning asset (%{public}@) to deferred processing needed adjustment", &v22, 0x16u);
      }

      if (!neededCopy)
      {
        v14 = 1;
        goto LABEL_13;
      }

      photoLibrary = [(PLManagedObject *)self photoLibrary];
      libraryServicesManager = [photoLibrary libraryServicesManager];
      backgroundJobService = [libraryServicesManager backgroundJobService];
      photoLibrary2 = [(PLManagedObject *)self photoLibrary];
      v20 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
      [backgroundJobService signalBackgroundProcessingNeededOnLibrary:photoLibrary2 workerTypes:v20];

      goto LABEL_11;
    }

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      photoLibrary = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(photoLibrary, OS_LOG_TYPE_DEFAULT))
      {
        uuid2 = [(PLManagedAsset *)self uuid];
        v22 = 138543618;
        v23 = reasonCopy;
        v24 = 2114;
        v25 = uuid2;
        _os_log_impl(&dword_19BF1F000, photoLibrary, OS_LOG_TYPE_DEFAULT, "%{public}@, but adjusted live photo (%{public}@) is still a placeholder, skipping deferred adjustment", &v22, 0x16u);
      }

LABEL_11:
      v14 = !isPhotoIrisPlaceholder;

      goto LABEL_13;
    }
  }

  v14 = 0;
LABEL_13:

  return v14;
}

- (BOOL)promoteDeferredPreviewToFinalImageWithOutError:(id *)error
{
  v27 = *MEMORY[0x1E69E9840];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v19 = 0;
  v20 = &v19;
  v21 = 0x3032000000;
  v22 = __Block_byref_object_copy__17653;
  v23 = __Block_byref_object_dispose__17654;
  v24 = 0;
  v15 = 0;
  v16 = &v15;
  v17 = 0x2020000000;
  v18 = 0;
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  if (photoLibrary)
  {
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __90__PLManagedAsset_DeferredPhotoProcessing__promoteDeferredPreviewToFinalImageWithOutError___block_invoke;
    v11[3] = &unk_1E7578898;
    v11[4] = self;
    v12 = defaultManager;
    v13 = &v19;
    v14 = &v15;
    [photoLibrary performTransactionAndWait:v11];
  }

  else
  {
    v7 = PLBackendGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      objectID = [(PLManagedAsset *)self objectID];
      *buf = 138543362;
      v26 = objectID;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "photolibrary was nil for asset: %{public}@", buf, 0xCu);
    }
  }

  v9 = *(v16 + 24);
  if (error && (v16[3] & 1) == 0)
  {
    *error = v20[5];
    v9 = *(v16 + 24);
  }

  _Block_object_dispose(&v15, 8);
  _Block_object_dispose(&v19, 8);

  return v9 & 1;
}

void __90__PLManagedAsset_DeferredPhotoProcessing__promoteDeferredPreviewToFinalImageWithOutError___block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) mainFileURL];
  v3 = [*(a1 + 32) height];
  v4 = [*(a1 + 32) width];
  v5 = *(a1 + 40);
  v6 = [*(a1 + 32) fileURLForCurrentDeferredProcessingPreviewFile];
  v7 = *(*(a1 + 48) + 8);
  obj = *(v7 + 40);
  LODWORD(v5) = [v5 copyItemAtURL:v6 toURL:v2 error:&obj];
  objc_storeStrong((v7 + 40), obj);

  if (v5)
  {
    v8 = *(a1 + 32);
    v9 = *(*(a1 + 48) + 8);
    v19 = *(v9 + 40);
    v10 = [v8 installFinalImageAndRemoveDeferredFilesWithFinalImageURL:v2 previewImage:0 thumbnailImage:0 outError:&v19];
    objc_storeStrong((v9 + 40), v19);
    if (v10)
    {
      [*(a1 + 32) setSpatialType:0];
      v11 = [*(a1 + 32) additionalAttributes];
      [v11 setSleetIsReversible:0];

      *(*(*(a1 + 56) + 8) + 24) = 1;
    }

    else if (*(*(*(a1 + 48) + 8) + 40) && [MEMORY[0x1E69BF238] isFileExistsError:?])
    {
      *(*(*(a1 + 56) + 8) + 24) = 1;
      v17 = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18 = [*(a1 + 32) mainFileURL];
        *buf = 138412290;
        v22 = v18;
        _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Asset has already been finalized into slot, skipping promoting final image: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    v12 = PLDeferredProcessingGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = [*(a1 + 32) fileURLForCurrentDeferredProcessingPreviewFile];
      v14 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138412802;
      v22 = v13;
      v23 = 2112;
      v24 = v2;
      v25 = 2112;
      v26 = v14;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Failed to copy deferred preview: %@ into original slot: %@ with error: %@", buf, 0x20u);
    }

    [*(a1 + 32) requestDeletionOfDeferredPhotoProcessingIntermediates];
  }

  if (([*(a1 + 32) transitionToDeferredProcessingNeededAdjustmentWithOriginalWidth:v4 originalHeight:v3 shouldSignalBackgroundProcessingNeeded:0 reason:@"Promoted deferred preview to final image"] & 1) == 0 && objc_msgSend(*(a1 + 32), "deferredProcessingNeeded") != 7)
  {
    [*(a1 + 32) setDeferredProcessingNeeded:0];
  }

  v15 = [*(a1 + 32) additionalAttributes];
  v16 = [v15 deferredProcessingCandidateOptions];

  if ((v16 & 8) != 0)
  {
    *(*(*(a1 + 56) + 8) + 24) = [*(a1 + 32) cleanUpMetadataPath];
  }
}

- (BOOL)_updateAndStoreFinalPhotoResourceForResourceType:(unsigned int)type version:(unsigned int)version error:(id *)error
{
  v6 = *&version;
  v7 = *&type;
  v33 = *MEMORY[0x1E69E9840];
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  path = [mainFileURL path];
  width = [(PLManagedAsset *)self width];
  height = [(PLManagedAsset *)self height];
  LOWORD(v28) = [(PLManagedAsset *)self kind];
  v13 = [PLResourceInstaller generateValidatedExternalImageResourceOfType:v7 forFilePath:path requireFileToBePresent:1 version:v6 basedOnFullSizeWidth:width andHeight:height recipe:0 assetKind:v28 error:0];

  if (v13)
  {
    assetID = [(PLManagedAsset *)self assetID];
    libraryID = [assetID libraryID];
    dictionary2 = PLDataStoreForClassIDAndLibraryID(0, libraryID);

    v29 = 0;
    v30 = 0;
    LODWORD(assetID) = [dictionary2 storeExternalResource:v13 forAsset:self options:0 error:&v30 resultingResource:&v29];
    v17 = v30;
    v18 = v29;
    if (assetID)
    {
      [(PLManagedAsset *)self recalculateImageRequestHints];
      v19 = 0;
    }

    else
    {
      dictionary = [MEMORY[0x1E695DF90] dictionary];
      [v17 code];
      v24 = NSStringFromPLErrorCode();
      [dictionary setObject:v24 forKeyedSubscript:*MEMORY[0x1E696A278]];

      v25 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v6];
      [dictionary setObject:v25 forKeyedSubscript:@"version"];

      [dictionary setObject:v17 forKeyedSubscript:*MEMORY[0x1E696AA08]];
      v19 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:objc_msgSend(v17 userInfo:{"code"), dictionary}];
    }
  }

  else
  {
    v20 = PLBackendGetLog();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138412290;
      v32 = uuid;
      _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_ERROR, "Failed to install deferred photo processing resources for asset %@", buf, 0xCu);
    }

    dictionary2 = [MEMORY[0x1E695DF90] dictionary];
    assetID = NSStringFromPLErrorCode();
    [dictionary2 setObject:assetID forKeyedSubscript:*MEMORY[0x1E696A278]];

    v22 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v6];
    [dictionary2 setObject:v22 forKeyedSubscript:@"version"];

    v19 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:47010 userInfo:dictionary2];
    LOBYTE(assetID) = 0;
  }

  if (error)
  {
    v26 = v19;
    *error = v19;
  }

  return assetID;
}

- (BOOL)installFinalImageAndRemoveDeferredFilesWithFinalImageURL:(id)l previewImage:(id)image thumbnailImage:(id)thumbnailImage outError:(id *)error
{
  v35 = *MEMORY[0x1E69E9840];
  lCopy = l;
  thumbnailImageCopy = thumbnailImage;
  imageCopy = image;
  v13 = PLBackendGetLog();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
  {
    uuid = [(PLManagedAsset *)self uuid];
    *buf = 138412546;
    v30 = lCopy;
    v31 = 2112;
    v32 = uuid;
    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEBUG, "Installing final image and removing deferred files for url %@, uuid %@", buf, 0x16u);
  }

  photoLibrary = [(PLManagedObject *)self photoLibrary];
  savedAssetType = [(PLManagedAsset *)self savedAssetType];
  uuid2 = [(PLManagedAsset *)self uuid];
  LOBYTE(v27) = 1;
  LOBYTE(v26) = 0;
  v18 = [photoLibrary addDCIMEntryAtFileURL:lCopy mainFileMetadata:0 previewImage:imageCopy thumbnailImage:thumbnailImageCopy savedAssetType:savedAssetType replacementUUID:uuid2 publicGlobalUUID:0 extendedInfo:0 withUUID:0 isPlaceholder:v26 placeholderFileURL:0 forFinalCameraImage:v27];

  if (v18)
  {
    v28 = 0;
    v19 = [objc_opt_class() installResourcesForAssetAndRemoveDeferredProcessingPreviewFile:v18 error:&v28];
    v20 = v28;
    if (v19)
    {
      v21 = 1;
      goto LABEL_12;
    }
  }

  else
  {
    v20 = 0;
  }

  v22 = PLDeferredProcessingGetLog();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    uuid3 = [(PLManagedAsset *)self uuid];
    *buf = 138543874;
    v30 = uuid3;
    v31 = 2112;
    v32 = lCopy;
    v33 = 2112;
    v34 = v20;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Failed to install resources for asset %{public}@, at path %@, error: %@", buf, 0x20u);
  }

  if (error)
  {
    v24 = v20;
    v21 = 0;
    *error = v20;
  }

  else
  {
    v21 = 0;
  }

LABEL_12:

  return v21;
}

- (void)requestDeletionOfDeferredPhotoProcessingIntermediates
{
  v11 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(PLCaptureDeferredPhotoProcessor);
  if (!v3)
  {
    additionalAttributes2 = PLBackendGetLog();
    if (os_log_type_enabled(additionalAttributes2, OS_LOG_TYPE_ERROR))
    {
      uuid = [(PLManagedAsset *)self uuid];
      v9 = 138543362;
      v10 = uuid;
      _os_log_impl(&dword_19BF1F000, additionalAttributes2, OS_LOG_TYPE_ERROR, "Couldn't get a shared finalizer, unable to request intermediate deletions for asset: %{public}@", &v9, 0xCu);
    }

    goto LABEL_6;
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  deferredPhotoIdentifier = [additionalAttributes deferredPhotoIdentifier];

  if (deferredPhotoIdentifier)
  {
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    deferredPhotoIdentifier2 = [additionalAttributes2 deferredPhotoIdentifier];
    [(PLManagedAsset *)self _deleteDeferredIntermediatesForDeferredPhotoIdentifier:deferredPhotoIdentifier2 withFinalizer:v3];

LABEL_6:
  }
}

- (void)_deleteDeferredIntermediatesForDeferredPhotoIdentifier:(id)identifier withFinalizer:(id)finalizer
{
  v20 = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  finalizerCopy = finalizer;
  v8 = [objc_alloc(MEMORY[0x1E6987088]) initWithDeferredPhotoIdentifier:identifierCopy];
  v9 = PLBackendGetLog();
  v10 = v9;
  if (!finalizerCopy || !v8)
  {
    v13 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);
    if (finalizerCopy)
    {
      if (v13)
      {
        uuid = [(PLManagedAsset *)self uuid];
        v16 = 138412546;
        v17 = uuid;
        v18 = 2112;
        v19 = identifierCopy;
        v15 = "Requested deletion of intermediates for asset: %@, deferredUUID: %@ but that deferredUUID is not recognized";
LABEL_11:
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, v15, &v16, 0x16u);
      }
    }

    else if (v13)
    {
      uuid = [(PLManagedAsset *)self uuid];
      v16 = 138412546;
      v17 = uuid;
      v18 = 2112;
      v19 = identifierCopy;
      v15 = "Requested deletion of intermediates for asset: %@, deferredUUID: %@ but the shared finalizer was nil";
      goto LABEL_11;
    }

    goto LABEL_13;
  }

  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
  {
    uuid2 = [(PLManagedAsset *)self uuid];
    deferredPhotoIdentifier = [v8 deferredPhotoIdentifier];
    v16 = 138412546;
    v17 = uuid2;
    v18 = 2112;
    v19 = deferredPhotoIdentifier;
    _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEFAULT, "Requesting deletion of intermediates for asset: %@, deferredUUID: %@", &v16, 0x16u);
  }

  [finalizerCopy deletePersistentStorageForPhotoProxy:v8];
LABEL_13:
}

+ (BOOL)installResourcesForAssetAndRemoveDeferredProcessingPreviewFile:(id)file error:(id *)error
{
  v29 = *MEMORY[0x1E69E9840];
  fileCopy = file;
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  pathForDeferredProcessingPreviewFile = [fileCopy pathForDeferredProcessingPreviewFile];
  v8 = PLBackendGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    uuid = [fileCopy uuid];
    *buf = 138412546;
    v24 = pathForDeferredProcessingPreviewFile;
    v25 = 2114;
    v26 = uuid;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Deleting deferred preview at path: %@ for asset %{public}@", buf, 0x16u);
  }

  v22 = 0;
  v10 = [defaultManager removeItemAtPath:pathForDeferredProcessingPreviewFile error:&v22];
  v11 = v22;
  if (v10 & 1) != 0 || (PLIsErrorFileNotFound())
  {
    v21 = v11;
    v12 = [fileCopy _updateAndStoreFinalPhotoResourceForResourceType:0 version:0 error:&v21];
    v13 = v21;

    if (v12)
    {
      [fileCopy deleteResourcesWithRecipeID:65943 andVersion:0];
      [fileCopy deleteResourcesWithRecipeID:65951 andVersion:0];
      v14 = 1;
      goto LABEL_16;
    }

    v15 = PLDeferredProcessingGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      uuid2 = [fileCopy uuid];
      *buf = 138543618;
      v24 = uuid2;
      v25 = 2112;
      v26 = v13;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Error updating and storing final resource for asset %{public}@ with error %@", buf, 0x16u);
    }

    v11 = v13;
  }

  else
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v17 = [MEMORY[0x1E69BF220] descriptionWithPath:pathForDeferredProcessingPreviewFile];
      uuid3 = [fileCopy uuid];
      *buf = 138412802;
      v24 = v17;
      v25 = 2114;
      v26 = uuid3;
      v27 = 2112;
      v28 = v11;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Unable to delete deferred preview file: %@ for asset: %{public}@, with error: %@", buf, 0x20u);
    }
  }

  if (error)
  {
    v19 = v11;
    v14 = 0;
    *error = v11;
  }

  else
  {
    v14 = 0;
  }

  v13 = v11;
LABEL_16:

  return v14;
}

- (BOOL)isEligibleForSearchIndexing
{
  if (([(PLManagedAsset *)self isDeleted]& 1) != 0)
  {
    return 0;
  }

  v4 = objc_opt_class();
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v6 = [v4 isEligibleForSearchIndexingPredicateForLibraryIdentifier:{+[PLSpotlightDonationUtilities wellKnownPhotoLibraryIdentifierFromPLPhotoLibrary:](PLSpotlightDonationUtilities, "wellKnownPhotoLibraryIdentifierFromPLPhotoLibrary:", photoLibrary)}];
  v7 = [v6 evaluateWithObject:self];

  return v7;
}

+ (id)fetchAssetsWithUUIDs:(id)ds managedObjectContext:(id)context error:(id *)error
{
  v18[5] = *MEMORY[0x1E69E9840];
  dsCopy = ds;
  v9 = MEMORY[0x1E695D5E0];
  contextCopy = context;
  v11 = +[PLManagedAsset entityName];
  v12 = [v9 fetchRequestWithEntityName:v11];

  [v12 setIncludesPendingChanges:0];
  propertiesToFetch = [self propertiesToFetch];
  [v12 setPropertiesToFetch:propertiesToFetch];

  v18[0] = @"additionalAttributes";
  v18[1] = @"additionalAttributes.keywords";
  v18[2] = @"additionalAttributes.assetDescription";
  v18[3] = @"additionalAttributes.sceneClassifications";
  v18[4] = @"additionalAttributes.personReferences.person";
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v18 count:5];
  [v12 setRelationshipKeyPathsForPrefetching:v14];

  if ([dsCopy count] >= 0x65)
  {
    [v12 setFetchBatchSize:100];
  }

  dsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid IN %@", dsCopy];
  [v12 setPredicate:dsCopy];

  [v12 setFetchLimit:{objc_msgSend(dsCopy, "count")}];
  v16 = [contextCopy executeFetchRequest:v12 error:error];

  return v16;
}

+ (id)fetchAssetsWithUUIDs:(id)ds managedObjectContext:(id)context
{
  dsCopy = ds;
  v7 = MEMORY[0x1E695D5E0];
  contextCopy = context;
  v9 = +[PLManagedAsset entityName];
  v10 = [v7 fetchRequestWithEntityName:v9];

  [v10 setIncludesPendingChanges:0];
  propertiesToFetch = [self propertiesToFetch];
  [v10 setPropertiesToFetch:propertiesToFetch];

  relationshipKeyPathsToPrefetch = [self relationshipKeyPathsToPrefetch];
  [v10 setRelationshipKeyPathsForPrefetching:relationshipKeyPathsToPrefetch];

  if ([dsCopy count] >= 0x65)
  {
    [v10 setFetchBatchSize:100];
  }

  dsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid IN %@", dsCopy];
  [v10 setPredicate:dsCopy];

  [v10 setFetchLimit:{objc_msgSend(dsCopy, "count")}];
  v18 = 0;
  v14 = [contextCopy executeFetchRequest:v10 error:&v18];

  v15 = v18;
  if (v14)
  {
    [MEMORY[0x1E69BF2D0] successWithResult:v14];
  }

  else
  {
    [MEMORY[0x1E69BF2D0] failureWithError:v15];
  }
  v16 = ;

  return v16;
}

+ (id)relationshipKeyPathsToPrefetch
{
  v4[8] = *MEMORY[0x1E69E9840];
  v4[0] = @"additionalAttributes";
  v4[1] = @"additionalAttributes.keywords";
  v4[2] = @"additionalAttributes.assetDescription";
  v4[3] = @"extendedAttributes";
  v4[4] = @"mediaAnalysisAttributes.characterRecognitionAttributes";
  v4[5] = @"mediaAnalysisAttributes.visualSearchAttributes";
  v4[6] = @"dayGroupHighlightBeingAssets";
  v4[7] = @"moment";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:8];

  return v2;
}

+ (id)propertiesToFetch
{
  v4[1] = *MEMORY[0x1E69E9840];
  v4[0] = @"uuid";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:1];

  return v2;
}

+ (id)isEligibleForSearchIndexingPredicateForLibraryIdentifier:(int64_t)identifier
{
  v11[2] = *MEMORY[0x1E69E9840];
  pl_dispatch_once();
  if (identifier == 3)
  {
    v4 = MEMORY[0x1E696AE18];
    distantPast = [MEMORY[0x1E695DF00] distantPast];
    v6 = [v4 predicateWithFormat:@"noindex:(%K) != %@", @"dateCreated", distantPast];

    v7 = MEMORY[0x1E696AB28];
    v11[0] = isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276;
    v11[1] = v6;
    v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:2];
    v9 = [v7 andPredicateWithSubpredicates:v8];
  }

  else
  {
    v9 = isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276;
  }

  return v9;
}

void __91__PLManagedAsset_SearchIndexing__isEligibleForSearchIndexingPredicateForLibraryIdentifier___block_invoke()
{
  v8[4] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"visibilityState", 0];
  v8[0] = v1;
  v2 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSearchIndexExclusions"), 0}];
  v8[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == NO", @"hidden"];
  v8[2] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"trashedState", 0];
  v8[3] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:4];
  v6 = [v0 andPredicateWithSubpredicates:v5];
  v7 = isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276;
  isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276 = v6;
}

- (id)duplicateSortPropertyNamesSkip
{
  v4[1] = *MEMORY[0x1E69E9840];
  v4[0] = @"duplicateAssetVisibilityState";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:1];

  return v2;
}

- (id)duplicateSortPropertyNames
{
  v4[6] = *MEMORY[0x1E69E9840];
  v4[0] = @"favorite";
  v4[1] = @"latitude";
  v4[2] = @"longitude";
  v4[3] = @"dateCreated";
  v4[4] = @"playbackStyle";
  v4[5] = @"libraryScopeShareState";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:6];

  return v2;
}

+ (int64_t)pfAdjustmentsBaseVersionFromAdjustmentBaseVersion:(int64_t)version
{
  if (version == 1)
  {
    return 1;
  }

  else
  {
    return 2 * (version == 2);
  }
}

+ (int64_t)adjustmentBaseVersionFromPFAdjustmentsBaseVersion:(int64_t)version
{
  if (version == 1)
  {
    return 1;
  }

  else
  {
    return 2 * (version == 2);
  }
}

- (BOOL)unQuarantineIfPossible
{
  v40 = *MEMORY[0x1E69E9840];
  master = [(PLManagedAsset *)self master];
  cloudLocalState = [master cloudLocalState];

  if (cloudLocalState != 4)
  {
    return 0;
  }

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  master2 = [(PLManagedAsset *)self master];
  assets = [master2 assets];

  v7 = [assets countByEnumeratingWithState:&v33 objects:v39 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v34;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v34 != v9)
        {
          objc_enumerationMutation(assets);
        }

        v11 = *(*(&v33 + 1) + 8 * i);
        if ([v11 cloudLocalState] != 4)
        {
          v23 = 0;
          goto LABEL_31;
        }

        v31 = 0u;
        v32 = 0u;
        v29 = 0u;
        v30 = 0u;
        modernResources = [v11 modernResources];
        v13 = [modernResources countByEnumeratingWithState:&v29 objects:v38 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v30;
          while (2)
          {
            for (j = 0; j != v14; ++j)
            {
              if (*v30 != v15)
              {
                objc_enumerationMutation(modernResources);
              }

              v17 = *(*(&v29 + 1) + 8 * j);
              if ([v17 isCPLResource] && (objc_msgSend(v17, "isDerivative") & 1) == 0 && !objc_msgSend(v17, "isLocallyAvailable"))
              {
                v23 = 0;
                goto LABEL_30;
              }
            }

            v14 = [modernResources countByEnumeratingWithState:&v29 objects:v38 count:16];
            if (v14)
            {
              continue;
            }

            break;
          }
        }
      }

      v8 = [assets countByEnumeratingWithState:&v33 objects:v39 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  [(PLManagedAsset *)self setCloudLocalState:0];
  [(PLManagedAsset *)self setUploadAttempts:0];
  [(PLManagedAsset *)self setLastUploadAttemptDate:0];
  v27 = 0u;
  v28 = 0u;
  v25 = 0u;
  v26 = 0u;
  modernResources2 = [(PLManagedAsset *)self modernResources];
  v19 = [modernResources2 countByEnumeratingWithState:&v25 objects:v37 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v26;
    do
    {
      for (k = 0; k != v20; ++k)
      {
        if (*v26 != v21)
        {
          objc_enumerationMutation(modernResources2);
        }

        [*(*(&v25 + 1) + 8 * k) setCloudLocalState:0];
      }

      v20 = [modernResources2 countByEnumeratingWithState:&v25 objects:v37 count:16];
    }

    while (v20);
  }

  [(PLManagedAsset *)self setOriginalHash:0];
  assets = [(PLManagedAsset *)self managedObjectContext];
  modernResources = [(PLManagedAsset *)self master];
  [assets deleteObject:modernResources];
  v23 = 1;
LABEL_30:

LABEL_31:
  return v23;
}

- (id)photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:(id)identifier
{
  v30 = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  if (!identifierCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4553 description:@"Identifier must not be nil"];
  }

  collectionShare = [(PLManagedAsset *)self collectionShare];

  if (collectionShare)
  {
    currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4554 description:{@"CollectionShare assets should not be calling %s", "-[PLManagedAsset(CPL) photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:]"}];
  }

  momentShare = [(PLManagedAsset *)self momentShare];
  v8 = momentShare;
  if (momentShare)
  {
    uuid = [momentShare uuid];
    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    pathManager = [managedObjectContext pathManager];

    if (!pathManager)
    {
      pathManager = [MEMORY[0x1E69BF2A0] systemLibraryPathManager];
    }

    v12 = [pathManager privateDirectoryWithSubType:7];
    v13 = [v12 stringByAppendingPathComponent:uuid];
  }

  else
  {
    v14 = [identifierCopy hash];
    uuid = [MEMORY[0x1E696AEC0] stringWithFormat:@"group%u", v14 % 0x1F4];
    managedObjectContext2 = [(PLManagedAsset *)self managedObjectContext];
    pathManager2 = [managedObjectContext2 pathManager];
    pathManager = [pathManager2 photoDirectoryWithType:30];

    v13 = [pathManager stringByAppendingPathComponent:uuid];
  }

  v23 = 0;
  v17 = [MEMORY[0x1E69BF238] createDirectoryAtPath:v13 error:&v23];
  v18 = v23;
  if ((v17 & 1) == 0)
  {
    v19 = PLBackendGetLog();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      *buf = 136315650;
      v25 = "[PLManagedAsset(CPL) photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:]";
      v26 = 2112;
      v27 = v13;
      v28 = 2112;
      v29 = v18;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "%s: failed to create directory: %@ with error: %@", buf, 0x20u);
    }
  }

  return v13;
}

- (BOOL)faceDetectionComplete
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  faceAnalysisVersion = [additionalAttributes faceAnalysisVersion];
  v4 = +[PLMediaAnalysisServiceRequestAdapter currentFaceVersion];
  LOBYTE(faceAnalysisVersion) = [v4 intValue] == faceAnalysisVersion;

  return faceAnalysisVersion;
}

- (id)syncDescription
{
  v6[4] = *MEMORY[0x1E69E9840];
  v6[0] = @"cloudAssetGUID";
  v6[1] = @"uuid";
  v6[2] = @"master";
  v6[3] = @"detectedFaces";
  v3 = [MEMORY[0x1E695DEC8] arrayWithObjects:v6 count:4];
  v4 = [(NSManagedObject *)self truncatedDescriptionWithPropertyKeys:v3];

  return v4;
}

- (NSString)syncedAdjustmentFingerprint
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];
    otherAdjustmentsFingerprint = [unmanagedAdjustment otherAdjustmentsFingerprint];

    if (!otherAdjustmentsFingerprint)
    {
      otherAdjustmentsFingerprint = [(PLManagedAsset *)self _calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources];
    }
  }

  else
  {
    otherAdjustmentsFingerprint = 0;
  }

  return otherAdjustmentsFingerprint;
}

- (id)originalStableHashCacheIfNecessaryAndAdjustedStableHash:(id *)hash fullsizeRenderImageIfNecessary:(BOOL)necessary enableSaveIfNecessary:(BOOL)ifNecessary error:(id *)error
{
  ifNecessaryCopy = ifNecessary;
  necessaryCopy = necessary;
  v79 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalStableHash = [additionalAttributes originalStableHash];
  v9 = originalStableHash;
  if (originalStableHash)
  {
    v10 = 0;
    identifier = originalStableHash;
    goto LABEL_3;
  }

  master = [(PLManagedAsset *)self master];
  v17 = master;
  v10 = master != 0;
  if (!master)
  {
    goto LABEL_28;
  }

  scopedIdentifier = [master scopedIdentifier];
  identifier = [scopedIdentifier identifier];

  if (!identifier)
  {
    goto LABEL_28;
  }

  if (([MEMORY[0x1E6994AE0] isStableHash:identifier] & 1) == 0)
  {

LABEL_28:
    v72 = 0;
    v28 = [(PLManagedAsset *)self _canComputeMasterIdentifierOrStableHashWithError:?];
    v16 = v72;
    if (!v28 || (-[PLManagedAsset mainFileURL](self, "mainFileURL"), (v29 = objc_claimAutoreleasedReturnValue()) == 0) || ([MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash], v30 = objc_claimAutoreleasedReturnValue(), v71 = v16, objc_msgSend(v30, "fingerPrintForFileAtURL:error:", v29, &v71), identifier = objc_claimAutoreleasedReturnValue(), v20 = v71, v16, v30, v29, v16 = v20, !identifier))
    {
      if (error)
      {
        v31 = v16;
        identifier = 0;
        *error = v16;
      }

      else
      {
        identifier = 0;
      }

      goto LABEL_35;
    }

    goto LABEL_31;
  }

  v20 = 0;
LABEL_31:
  [additionalAttributes setOriginalStableHash:identifier];

LABEL_3:
  v12 = ![(PLManagedAsset *)self hasAdjustments];
  if (!hash)
  {
    LOBYTE(v12) = 1;
  }

  if ((v12 & 1) != 0 || ([additionalAttributes adjustedStableHash], v13 = objc_claimAutoreleasedReturnValue(), (*hash = v13) != 0))
  {
LABEL_7:
    if (!v9 && ifNecessaryCopy)
    {
      goto LABEL_9;
    }

    goto LABEL_37;
  }

  if (!v10)
  {
    goto LABEL_46;
  }

  allAssetCPLResources = [(PLManagedAsset *)self allAssetCPLResources];
  bestResourceTypeForAdjustedStableHash = [(PLManagedAsset *)self bestResourceTypeForAdjustedStableHash];
  if (bestResourceTypeForAdjustedStableHash)
  {
    v69 = 0u;
    v70 = 0u;
    v68 = 0u;
    v67 = 0u;
    v22 = allAssetCPLResources;
    v23 = [v22 countByEnumeratingWithState:&v67 objects:v78 count:16];
    if (v23)
    {
      v24 = *v68;
      while (2)
      {
        for (i = 0; i != v23; ++i)
        {
          if (*v68 != v24)
          {
            objc_enumerationMutation(v22);
          }

          v26 = *(*(&v67 + 1) + 8 * i);
          if ([v26 cplType] == bestResourceTypeForAdjustedStableHash)
          {
            v27 = v26;
            goto LABEL_41;
          }
        }

        v23 = [v22 countByEnumeratingWithState:&v67 objects:v78 count:16];
        if (v23)
        {
          continue;
        }

        break;
      }
    }

    v27 = 0;
LABEL_41:

    stableHash = [v27 stableHash];
    v34 = stableHash;
    if (stableHash)
    {
      v35 = stableHash;
      *hash = v34;
    }

    else
    {
      fingerprint = [v27 fingerprint];
      *hash = fingerprint;
    }
  }

  if (!*hash)
  {
LABEL_46:
    if (![(PLManagedAsset *)self isPhoto])
    {
      if (![(PLManagedAsset *)self isDefaultAdjustedSlomo])
      {
        pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        if (pathForFullsizeRenderVideoFile)
        {
          v38 = [objc_alloc(MEMORY[0x1E695DFF8]) initFileURLWithPath:pathForFullsizeRenderVideoFile isDirectory:0];
          fingerprintSchemeForStableHash = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
          v58 = 0;
          v40 = [fingerprintSchemeForStableHash fingerPrintForFileAtURL:v38 error:&v58];
          v41 = v58;
          v42 = v40;
          *hash = v40;
        }

        else
        {
          v41 = 0;
        }

        if (!*hash && error)
        {
          v51 = v41;
          *error = v41;
        }
      }

LABEL_63:
      if (!*hash)
      {
        goto LABEL_7;
      }

      goto LABEL_64;
    }

    *&buf = 0;
    *(&buf + 1) = &buf;
    v74 = 0x3032000000;
    v75 = __Block_byref_object_copy__51017;
    v76 = __Block_byref_object_dispose__51018;
    v77 = 0;
    v61 = 0;
    v62 = &v61;
    v63 = 0x3032000000;
    v64 = __Block_byref_object_copy__51017;
    v65 = __Block_byref_object_dispose__51018;
    v66 = 0;
    if (necessaryCopy)
    {
      v60[0] = MEMORY[0x1E69E9820];
      v60[1] = 3221225472;
      v60[2] = __138__PLManagedAsset_CPL__originalStableHashCacheIfNecessaryAndAdjustedStableHash_fullsizeRenderImageIfNecessary_enableSaveIfNecessary_error___block_invoke;
      v60[3] = &unk_1E756D898;
      v60[4] = &buf;
      v60[5] = &v61;
      [(PLManagedAsset *)self synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:0 withCompletionHandler:v60];
    }

    else
    {
      pathForFullsizeImageFile = [(PLManagedAsset *)self pathForFullsizeImageFile];
      v44 = [objc_alloc(MEMORY[0x1E695DFF8]) initFileURLWithPath:pathForFullsizeImageFile isDirectory:0];
      fingerprintSchemeForStableHash2 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
      v46 = (v62 + 5);
      obj = v62[5];
      v47 = [fingerprintSchemeForStableHash2 fingerPrintForFileAtURL:v44 error:&obj];
      objc_storeStrong(v46, obj);
      v48 = *(*(&buf + 1) + 40);
      *(*(&buf + 1) + 40) = v47;
    }

    v49 = *(*(&buf + 1) + 40);
    errorCopy = hash;
    if (!v49)
    {
      if (!error)
      {
LABEL_57:
        _Block_object_dispose(&v61, 8);

        _Block_object_dispose(&buf, 8);
        goto LABEL_63;
      }

      v49 = v62[5];
      errorCopy = error;
    }

    *errorCopy = v49;
    goto LABEL_57;
  }

LABEL_64:
  [additionalAttributes setAdjustedStableHash:?];
  if (ifNecessaryCopy)
  {
LABEL_9:
    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    v57 = 0;
    v15 = [managedObjectContext save:&v57];
    v16 = v57;

    if (v15)
    {
LABEL_36:

      goto LABEL_37;
    }

    v17 = PLBackendGetLog();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      LODWORD(buf) = 138412290;
      *(&buf + 4) = v16;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "Error trying to save cached stableHashes: %@", &buf, 0xCu);
    }

LABEL_35:

    goto LABEL_36;
  }

LABEL_37:

  return identifier;
}

- (uint64_t)_canComputeMasterIdentifierOrStableHashWithError:(uint64_t)result
{
  v10[1] = *MEMORY[0x1E69E9840];
  if (result)
  {
    v3 = result;
    if ([result complete])
    {
      if (([v3 isTimelapsePlaceholder] & 1) == 0 && !objc_msgSend(v3, "isPhotoIrisPlaceholder"))
      {
        return 1;
      }

      v4 = @"Asset is a placeholder";
    }

    else
    {
      v4 = @"Asset is not complete";
    }

    v5 = MEMORY[0x1E696ABC0];
    v6 = *MEMORY[0x1E69BFF48];
    v9 = *MEMORY[0x1E696A278];
    v10[0] = v4;
    v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v10 forKeys:&v9 count:1];
    v8 = [v5 errorWithDomain:v6 code:45701 userInfo:v7];
    if (a2)
    {
      v8 = v8;
      *a2 = v8;
    }

    return 0;
  }

  return result;
}

void __138__PLManagedAsset_CPL__originalStableHashCacheIfNecessaryAndAdjustedStableHash_fullsizeRenderImageIfNecessary_enableSaveIfNecessary_error___block_invoke(uint64_t a1, void *a2)
{
  if (a2)
  {
    v3 = MEMORY[0x1E695DFF8];
    v4 = a2;
    v5 = [[v3 alloc] initFileURLWithPath:v4 isDirectory:0];

    v6 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
    v7 = *(*(a1 + 40) + 8);
    obj = *(v7 + 40);
    v8 = [v6 fingerPrintForFileAtURL:v5 error:&obj];
    objc_storeStrong((v7 + 40), obj);
    v9 = *(*(a1 + 32) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;
  }
}

- (id)masterIdentifierCacheIfNecessaryAndOriginalStableHash:(id *)hash error:(id *)error
{
  v39 = *MEMORY[0x1E69E9840];
  master = [(PLManagedAsset *)self master];
  v9 = master;
  if (!master)
  {
    fingerprintContext = [(PLManagedAsset *)self fingerprintContext];
    fingerprintSchemeForNewMasterAsset = [fingerprintContext fingerprintSchemeForNewMasterAsset];
    *buf = fingerprintSchemeForNewMasterAsset;

    v36 = 0;
    LOBYTE(fingerprintContext) = [(PLManagedAsset *)self _canComputeMasterIdentifierOrStableHashWithError:?];
    unknownError = v36;
    if (fingerprintContext)
    {
      mainFileURL = [(PLManagedAsset *)self mainFileURL];
      if (mainFileURL)
      {
        v18 = mainFileURL;
        v34 = unknownError;
        v35 = 0;
        fingerprintSchemeForNewMasterAsset = [(PLManagedAsset *)self _computeNewMasterIdentifierAndStableHash:buf fingerprintScheme:mainFileURL forMasterFileURL:&v34 error:?];
        v19 = v34;

        v20 = v35;
        if (fingerprintSchemeForNewMasterAsset)
        {
          if (!v35)
          {
            currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
            [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4332 description:{@"Got a master identifier without an original stableHash for %@", self}];
          }

          additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
          [additionalAttributes setOriginalStableHash:v20];

          v22 = v20;
          *hash = v20;

          goto LABEL_16;
        }

        unknownError = v19;
        if (error)
        {
          goto LABEL_24;
        }

        goto LABEL_26;
      }
    }

    goto LABEL_23;
  }

  scopedIdentifier = [master scopedIdentifier];
  fingerprintSchemeForNewMasterAsset = [scopedIdentifier identifier];

  if (!fingerprintSchemeForNewMasterAsset)
  {
    unknownError = [MEMORY[0x1E6994AB0] unknownError];
    if (error)
    {
LABEL_24:
      v30 = unknownError;
      fingerprintSchemeForNewMasterAsset = 0;
      *error = unknownError;
LABEL_27:
      v19 = unknownError;
      goto LABEL_28;
    }

LABEL_26:
    fingerprintSchemeForNewMasterAsset = 0;
    goto LABEL_27;
  }

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  originalStableHash = [additionalAttributes2 originalStableHash];

  if (originalStableHash)
  {
    unknownError = 0;
    v15 = originalStableHash;
    goto LABEL_15;
  }

  v37 = 0;
  v15 = [(PLManagedAsset *)self _findMissingOriginalStableHashFromMaster:v9 error:&v37];
  unknownError = v37;
  if (!v15)
  {
LABEL_23:

    if (error)
    {
      goto LABEL_24;
    }

    goto LABEL_26;
  }

  additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes3 setOriginalStableHash:v15];

LABEL_15:
  additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
  *hash = [additionalAttributes4 originalStableHash];

  v19 = unknownError;
  if (!originalStableHash)
  {
LABEL_16:
    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    v33 = 0;
    v26 = [managedObjectContext save:&v33];
    v27 = v33;

    if ((v26 & 1) == 0)
    {
      v28 = PLBackendGetLog();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        *&buf[4] = v27;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Error trying to save cached stableHash: %@", buf, 0xCu);
      }
    }
  }

  if (!*hash)
  {
    currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4349 description:{@"Produced a master identifier without a stableHash for %@", self}];
  }

LABEL_28:

  return fingerprintSchemeForNewMasterAsset;
}

- (id)_computeNewMasterIdentifierAndStableHash:(id *)hash fingerprintScheme:(void *)scheme forMasterFileURL:(void *)l error:
{
  schemeCopy = scheme;
  if (self)
  {
    fingerprintContext = [self fingerprintContext];
    fingerprintSchemeForNewMasterAsset = [fingerprintContext fingerprintSchemeForNewMasterAsset];

    v22 = 0;
    v12 = [fingerprintSchemeForNewMasterAsset fingerPrintForFileAtURL:schemeCopy error:&v22];
    v13 = v22;
    v14 = v13;
    if (v12)
    {
      if ([fingerprintSchemeForNewMasterAsset isForStableHash])
      {
        v15 = v12;
        v16 = v14;
LABEL_8:
        objc_storeStrong(hash, fingerprintSchemeForNewMasterAsset);
        objc_storeStrong(a2, v15);
        goto LABEL_11;
      }

      fingerprintSchemeForStableHash = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
      v21 = v14;
      v15 = [fingerprintSchemeForStableHash fingerPrintForFileAtURL:schemeCopy error:&v21];
      v16 = v21;

      if (v15)
      {
        goto LABEL_8;
      }

      if (!l)
      {
LABEL_10:
        v15 = 0;
        v12 = 0;
        goto LABEL_11;
      }
    }

    else
    {
      v16 = v13;
      if (!l)
      {
        goto LABEL_10;
      }
    }

    v17 = v16;
    v15 = 0;
    v12 = 0;
    *l = v16;
LABEL_11:
    v19 = v12;

    goto LABEL_12;
  }

  v19 = 0;
LABEL_12:

  return v19;
}

- (id)_findMissingOriginalStableHashFromMaster:(id)master error:(id *)error
{
  v35 = *MEMORY[0x1E69E9840];
  masterCopy = master;
  scopedIdentifier = [masterCopy scopedIdentifier];
  identifier = [scopedIdentifier identifier];

  fingerprintScheme = [masterCopy fingerprintScheme];
  if ([fingerprintScheme isForStableHash] && identifier)
  {
    v10 = identifier;
  }

  else
  {
    v33 = 0;
    originalStableHash = [masterCopy stableHashFromOriginalResourceError:&v33];
    v12 = v33;
    v13 = v12;
    if (!originalStableHash)
    {
      selfCopy = self;
      v28 = v12;
      errorCopy = error;
      v31 = 0u;
      v32 = 0u;
      v29 = 0u;
      v30 = 0u;
      assets = [masterCopy assets];
      v15 = [assets countByEnumeratingWithState:&v29 objects:v34 count:16];
      if (v15)
      {
        v16 = v15;
        v17 = *v30;
        while (2)
        {
          for (i = 0; i != v16; ++i)
          {
            if (*v30 != v17)
            {
              objc_enumerationMutation(assets);
            }

            v19 = *(*(&v29 + 1) + 8 * i);
            v20 = objc_autoreleasePoolPush();
            additionalAttributes = [v19 additionalAttributes];
            originalStableHash = [additionalAttributes originalStableHash];

            objc_autoreleasePoolPop(v20);
            if (originalStableHash)
            {

              goto LABEL_17;
            }
          }

          v16 = [assets countByEnumeratingWithState:&v29 objects:v34 count:16];
          if (v16)
          {
            continue;
          }

          break;
        }
      }

      additionalAttributes2 = [(PLManagedAsset *)selfCopy additionalAttributes];
      originalHash = [additionalAttributes2 originalHash];

      originalStableHash = [originalHash base64EncodedStringWithOptions:0];

      if (originalStableHash)
      {
LABEL_17:
        v13 = v28;
      }

      else
      {
        v13 = v28;
        if (errorCopy)
        {
          v24 = v28;
          originalStableHash = 0;
          *errorCopy = v28;
        }

        else
        {
          originalStableHash = 0;
        }
      }
    }

    v10 = originalStableHash;
  }

  return v10;
}

- (unint64_t)bestResourceTypeForAdjustedStableHash
{
  if ([(PLManagedAsset *)self isPhoto])
  {
    return 2;
  }

  if ([(PLManagedAsset *)self isDefaultAdjustedSlomo])
  {
    return 0;
  }

  return 16;
}

- (id)descriptionForResources
{
  v26[1] = *MEMORY[0x1E69E9840];
  string = [MEMORY[0x1E696AD60] string];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dataStoreSubtype" ascending:1];
  v26[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:1];

  modernResources = [(PLManagedAsset *)self modernResources];
  allObjects = [modernResources allObjects];
  v8 = [allObjects sortedArrayUsingDescriptors:v5];

  if ([v8 count])
  {
    v20 = v5;
    [string appendFormat:@"%lu resources\n", objc_msgSend(v8, "count")];
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v19 = v8;
    v9 = v8;
    v10 = [v9 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v22;
      do
      {
        for (i = 0; i != v11; ++i)
        {
          if (*v22 != v12)
          {
            objc_enumerationMutation(v9);
          }

          v14 = *(*(&v21 + 1) + 8 * i);
          [string appendFormat:@"\t%@\n", v14];
          if ([v14 isLocallyAvailable])
          {
            fileURL = [v14 fileURL];
            path = [fileURL path];

            v17 = [PLCacheDeleteSupport purgeableStateDescriptionForFile:path];
            [string appendFormat:@"Purgeable: %@\n", v17];
          }
        }

        v11 = [v9 countByEnumeratingWithState:&v21 objects:v25 count:16];
      }

      while (v11);
    }

    v5 = v20;
    v8 = v19;
  }

  return string;
}

- (BOOL)supportsCloudUpload
{
  if (([(PLManagedAsset *)self isDeleted]& 1) != 0)
  {
    goto LABEL_15;
  }

  _syncablePredicate = [objc_opt_class() _syncablePredicate];
  v4 = [_syncablePredicate evaluateWithObject:self];

  if (!v4)
  {
    goto LABEL_15;
  }

  predicateForSupportedAssetTypesForUpload = [objc_opt_class() predicateForSupportedAssetTypesForUpload];
  v6 = [predicateForSupportedAssetTypesForUpload evaluateWithObject:self];

  if (!v6)
  {
    goto LABEL_15;
  }

  if ([(PLManagedAsset *)self isPartOfBurst])
  {
    if ([(PLManagedAsset *)self avalanchePickType]== 1)
    {
      goto LABEL_15;
    }
  }

  else if ([(PLManagedAsset *)self isTimelapsePlaceholder]|| [(PLManagedAsset *)self isPhotoIrisPlaceholder])
  {
    goto LABEL_15;
  }

  if (![(PLManagedAsset *)self isPlaceholderAsset])
  {
    goto LABEL_21;
  }

  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v8 = [PLManagedAsset shouldPerformServerCopyOnPlaceholderAsset:self photoLibrary:photoLibrary];

  if (!v8)
  {
LABEL_15:
    LOBYTE(v9) = 0;
    return v9;
  }

  v9 = [PLManagedAsset validShareForPlaceholderAsset:self];
  if (v9)
  {
LABEL_21:
    if ([(PLManagedAsset *)self isCPLSharingScopeAsset]&& ([(PLManagedAsset *)self shareRelationship], v10 = objc_claimAutoreleasedReturnValue(), v10, v10))
    {
      shareRelationship = [(PLManagedAsset *)self shareRelationship];
      status = [shareRelationship status];

      LOBYTE(v9) = status != 3;
    }

    else
    {
      LOBYTE(v9) = 1;
    }
  }

  return v9;
}

- (id)adjustedPathForCPLResourceType:(unint64_t)type
{
  v13 = *MEMORY[0x1E69E9840];
  if (type <= 6)
  {
    if (type > 3)
    {
      if (type == 4)
      {
        pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustedLargeThumbnailFile];
      }

      else
      {
        if (type == 5)
        {
          [(PLManagedAsset *)self pathForAdjustedMediumThumbnailFile];
        }

        else
        {
          [(PLManagedAsset *)self pathForAdjustedMediumVideoFile];
        }
        pathForAdjustedLargeThumbnailFile = ;
      }

      goto LABEL_31;
    }

    if (type == 2)
    {
      pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustedFullsizeImageFile];
      goto LABEL_31;
    }

    if (type == 3)
    {
      pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustedLargeSizeImageFile];
      goto LABEL_31;
    }
  }

  else if (type > 20)
  {
    switch(type)
    {
      case 0x15uLL:
        pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustedLargeVideoFile];
        goto LABEL_31;
      case 0x1BuLL:
        pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustedMediaMetadataFile];
        goto LABEL_31;
      case 0x1CuLL:
        pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustedMediumHDRVideoFile];
        goto LABEL_31;
    }
  }

  else
  {
    switch(type)
    {
      case 7uLL:
        pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustedSmallVideoFile];
        goto LABEL_31;
      case 0xDuLL:
        pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForAdjustmentDataFile];
        goto LABEL_31;
      case 0x13uLL:
        pathForAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        goto LABEL_31;
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v6 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v7 = [MEMORY[0x1E6994B90] descriptionForResourceType:type];
      v9 = 138412546;
      v10 = v7;
      v11 = 2112;
      selfCopy = self;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_DEBUG, "Unsupported resource type %@ for asset %@", &v9, 0x16u);
    }
  }

  pathForAdjustedLargeThumbnailFile = 0;
LABEL_31:

  return pathForAdjustedLargeThumbnailFile;
}

- (id)nonAdjustedPathForCPLResourceType:(unint64_t)type
{
  v13 = *MEMORY[0x1E69E9840];
  if (type <= 6)
  {
    if (type > 3)
    {
      if (type == 4)
      {
        pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForNonAdjustedLargeThumbnailFile];
      }

      else
      {
        if (type == 5)
        {
          [(PLManagedAsset *)self pathForNonAdjustedMediumThumbnailFile];
        }

        else
        {
          [(PLManagedAsset *)self pathForNonAdjustedMediumVideoFile];
        }
        pathForNonAdjustedLargeThumbnailFile = ;
      }

      goto LABEL_31;
    }

    if (type == 2)
    {
      pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
      goto LABEL_31;
    }

    if (type == 3)
    {
      pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
      goto LABEL_31;
    }
  }

  else if (type > 20)
  {
    switch(type)
    {
      case 0x15uLL:
        pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForNonAdjustedLargeVideoFile];
        goto LABEL_31;
      case 0x1AuLL:
        pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForVideoMetadataFile];
        goto LABEL_31;
      case 0x1CuLL:
        pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForNonAdjustedMediumHDRVideoFile];
        goto LABEL_31;
    }
  }

  else
  {
    switch(type)
    {
      case 7uLL:
        pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForNonAdjustedSmallVideoFile];
        goto LABEL_31;
      case 0xAuLL:
        pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForMediaMetadataFile];
        goto LABEL_31;
      case 0x12uLL:
        pathForNonAdjustedLargeThumbnailFile = [(PLManagedAsset *)self pathForVideoComplementFile];
        goto LABEL_31;
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v6 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v7 = [MEMORY[0x1E6994B90] descriptionForResourceType:type];
      v9 = 138412546;
      v10 = v7;
      v11 = 2112;
      selfCopy = self;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_DEBUG, "Unsupported resource type %@ for asset %@", &v9, 0x16u);
    }
  }

  pathForNonAdjustedLargeThumbnailFile = 0;
LABEL_31:

  return pathForNonAdjustedLargeThumbnailFile;
}

- (id)pathForCPLResourceType:(unint64_t)type adjusted:(BOOL)adjusted
{
  adjustedCopy = adjusted;
  if (type > 16)
  {
    if (type > 22)
    {
      if (type == 23)
      {
        pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForSpatialOverCaptureContentFile];
        goto LABEL_29;
      }

      if (type == 24)
      {
        pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForVideoComplementSpatialOverCaptureContentFile];
        goto LABEL_29;
      }

      if (type != 25)
      {
        goto LABEL_30;
      }
    }

    else
    {
      if (type == 17)
      {
        v8 = &__block_literal_global_597_51048;
        goto LABEL_25;
      }

      if (type != 20)
      {
        if (type != 22)
        {
          goto LABEL_30;
        }

        v8 = &__block_literal_global_601;
        goto LABEL_25;
      }
    }

    pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    goto LABEL_29;
  }

  if (type > 13)
  {
    if (type == 14)
    {
      pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
    }

    else
    {
      if (type == 15)
      {
        [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
      }

      else
      {
        [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
      }
      pathForSpatialOverCaptureContentFile = ;
    }
  }

  else
  {
    if (type != 1)
    {
      if (type != 8)
      {
        if (type == 9)
        {
          pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForXMPFile];
          goto LABEL_29;
        }

LABEL_30:
        if (adjustedCopy)
        {
          [(PLManagedAsset *)self adjustedPathForCPLResourceType:type];
        }

        else
        {
          [(PLManagedAsset *)self nonAdjustedPathForCPLResourceType:type];
        }
        v10 = ;
        goto LABEL_34;
      }

      v8 = &__block_literal_global_599;
LABEL_25:
      v9 = [(PLManagedAsset *)self firstPersistedResourceMatching:v8];
      v10 = [(PLManagedAsset *)self _pathForSidecarResource:v9];

      if (!v10)
      {
        goto LABEL_30;
      }

      goto LABEL_34;
    }

    pathForSpatialOverCaptureContentFile = [(PLManagedAsset *)self pathForOriginalFile];
  }

LABEL_29:
  v10 = pathForSpatialOverCaptureContentFile;
  if (!pathForSpatialOverCaptureContentFile)
  {
    goto LABEL_30;
  }

LABEL_34:

  return v10;
}

- (id)_pathForSidecarResource:(id)resource
{
  resourceCopy = resource;
  pathManager = [(PLManagedObject *)self pathManager];
  if (![pathManager isUBF])
  {
    sidecarRepresentation = [resourceCopy sidecarRepresentation];
    fileURL = [sidecarRepresentation fileURL];
    goto LABEL_5;
  }

  if (resourceCopy)
  {
    v6 = objc_alloc(MEMORY[0x1E69BF298]);
    uuid = [(PLManagedAsset *)self uuid];
    bundleScope = [(PLManagedAsset *)self bundleScope];
    uniformTypeIdentifier = [resourceCopy uniformTypeIdentifier];
    identifier = [uniformTypeIdentifier identifier];
    sidecarRepresentation = [v6 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 resourceType:{objc_msgSend(resourceCopy, "resourceType")}];

    fileURL = [pathManager readOnlyUrlWithIdentifier:sidecarRepresentation];
LABEL_5:
    v13 = fileURL;
    path = [fileURL path];

    goto LABEL_6;
  }

  path = 0;
LABEL_6:

  return path;
}

- (BOOL)savedAssetTypeIsSupportedForUpload
{
  [MEMORY[0x1E69BF328] maskForAssetsEligibleForCloudKitTransport];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (void)postProcessResourceDependentPropertyChangesFromAssetChange:(id)change inLibrary:(id)library
{
  v16 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  if ([changeCopy hasChangeType:2])
  {
    videoComplementVisibilityState = [changeCopy videoComplementVisibilityState];
    if ((videoComplementVisibilityState & 8) != 0)
    {
      v7 = [(PLManagedAsset *)self assetResourceForCPLType:19];
      if (v7)
      {
      }

      else if ([(PLManagedAsset *)self hasAdjustments]|| ([(PLManagedAsset *)self masterResourceForCPLType:18], v11 = objc_claimAutoreleasedReturnValue(), v11, !v11))
      {
        [(PLManagedAsset *)self setVideoCpVisibilityState:videoComplementVisibilityState & 0xFFF7];
        goto LABEL_14;
      }
    }
  }

  if (![changeCopy hasChangeType:8])
  {
    goto LABEL_18;
  }

  videoCpVisibilityState = [(PLManagedAsset *)self videoCpVisibilityState];
  if (![(PLManagedAsset *)self isPhotoIris])
  {
    goto LABEL_18;
  }

  if (![(PLManagedAsset *)self hasAdjustments])
  {
    goto LABEL_18;
  }

  if ((videoCpVisibilityState & 8) != 0)
  {
    goto LABEL_18;
  }

  v9 = [(PLManagedAsset *)self assetResourceForCPLType:19];
  if (!v9)
  {
    goto LABEL_18;
  }

  v10 = v9;
  [(PLManagedAsset *)self setVideoCpVisibilityState:videoCpVisibilityState | 8u];

LABEL_14:
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v12 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      uuid = [(PLManagedAsset *)self uuid];
      v14 = 138412290;
      v15 = uuid;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Updated full editing support for asset %@", &v14, 0xCu);
    }
  }

LABEL_18:
  if ([(PLManagedAsset *)self isPhotoIris])
  {
    [(PLManagedAsset *)self updatePlaybackStyleWithLivePhotoPlayability:[(PLManagedAsset *)self canPlayPhotoIris]];
  }
}

- (void)removeLocalFileForResource:(id)resource allowDCIMPath:(BOOL)path
{
  v27 = *MEMORY[0x1E69E9840];
  resourceCopy = resource;
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  pathManager = [managedObjectContext pathManager];
  v10 = [pathManager photoDirectoryWithType:4];

  v11 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v12 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      v24 = resourceCopy;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Removing local resource file for %@", buf, 0xCu);
    }
  }

  cplFileURL = [resourceCopy cplFileURL];
  path = [cplFileURL path];

  if (!path && ([path hasPrefix:v10] & 1) != 0 || !objc_msgSend(defaultManager, "fileExistsAtPath:", path))
  {
    if (*v11)
    {
      v16 = 0;
      goto LABEL_21;
    }

    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v24 = resourceCopy;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Skip removing local resource file for %@", buf, 0xCu);
    }

    v16 = 0;
    goto LABEL_20;
  }

  v22 = 0;
  v15 = [defaultManager removeItemAtPath:path error:&v22];
  v16 = v22;
  if (v15)
  {
    if ((*v11 & 1) == 0)
    {
      v17 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412290;
        v24 = resourceCopy;
        v18 = "Removed local resource file for %@";
        v19 = v17;
        v20 = OS_LOG_TYPE_DEBUG;
        v21 = 12;
LABEL_19:
        _os_log_impl(&dword_19BF1F000, v19, v20, v18, buf, v21);
        goto LABEL_20;
      }

      goto LABEL_20;
    }
  }

  else if ((*v11 & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v24 = resourceCopy;
      v25 = 2112;
      v26 = v16;
      v18 = "Can't remove local resource file for %@. Error: %@";
      v19 = v17;
      v20 = OS_LOG_TYPE_ERROR;
      v21 = 22;
      goto LABEL_19;
    }

LABEL_20:
  }

LABEL_21:
}

- (void)_removeAdjustmentDataResources
{
  v21 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  allAssetCPLResources = [(PLManagedAsset *)self allAssetCPLResources];
  v4 = [allAssetCPLResources countByEnumeratingWithState:&v14 objects:v20 count:16];
  if (v4)
  {
    v6 = v4;
    v7 = *v15;
    v8 = MEMORY[0x1E6994D48];
    *&v5 = 138412290;
    v13 = v5;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(allAssetCPLResources);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        if ([v10 cplType] == 13)
        {
          if ((*v8 & 1) == 0)
          {
            v11 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
            {
              *buf = v13;
              v19 = v10;
              _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Deleting the CPLResourceTypeAdjustmentData: %@", buf, 0xCu);
            }
          }

          [(PLManagedAsset *)self removeLocalFileForResource:v10];
          managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
          [managedObjectContext deleteObject:v10];
        }
      }

      v6 = [allAssetCPLResources countByEnumeratingWithState:&v14 objects:v20 count:16];
    }

    while (v6);
  }
}

- (BOOL)_isResourceType:(unint64_t)type inResources:(id)resources
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  resourcesCopy = resources;
  v6 = [resourcesCopy countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v13;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(resourcesCopy);
        }

        if ([*(*(&v12 + 1) + 8 * i) resourceType] == type)
        {
          v10 = 1;
          goto LABEL_11;
        }
      }

      v7 = [resourcesCopy countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_11:

  return v10;
}

- (void)markAsUnavailableCloudResourceOfType:(unint64_t)type
{
  v3 = [(PLManagedAsset *)self assetResourceForCPLType:type];
  [v3 markAsNotLocallyAvailable];
}

- (void)applyFacesFromAssetChange:(id)change inSyncContext:(id)context
{
  contextCopy = context;
  changeCopy = change;
  photoLibrary = [contextCopy photoLibrary];
  managedObjectContext = [photoLibrary managedObjectContext];
  [PLCPLFaceRebuildSupport rebuildDeferredFacesForAsset:self inManagedObjectContext:managedObjectContext];

  [PLCPLFacePullSupport applyFacesChangesFromAssetChange:changeCopy toAsset:self inSyncContext:contextCopy];
}

- (void)applySharingPropertiesFromAssetChange:(id)change inLibrary:(id)library
{
  v36 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  libraryCopy = library;
  sharingScopeIdentifier = [changeCopy sharingScopeIdentifier];
  if (!sharingScopeIdentifier)
  {
    if ([(PLManagedAsset *)self hasLibraryScope])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v14 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
        {
          libraryScope = [(PLManagedAsset *)self libraryScope];
          v30 = 138412546;
          v31 = libraryScope;
          v32 = 2112;
          v33 = changeCopy;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEBUG, "Clearing library scope %@ for asset change %@", &v30, 0x16u);
        }
      }

      [(PLManagedAsset *)self removeLibraryScopeAndContributors];
LABEL_41:
      updateSharingContributorUserIdentifiers = [changeCopy updateSharingContributorUserIdentifiers];
      v21 = [updateSharingContributorUserIdentifiers count];
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      libraryScopeAssetContributorsToUpdate = [additionalAttributes libraryScopeAssetContributorsToUpdate];
      v24 = libraryScopeAssetContributorsToUpdate;
      if (v21)
      {
        v25 = [MEMORY[0x1E695DFD8] setWithArray:updateSharingContributorUserIdentifiers];
        v26 = [v24 isEqualToSet:v25];

        if (v26)
        {
          additionalAttributes3 = [MEMORY[0x1E695DFD8] setWithArray:updateSharingContributorUserIdentifiers];
          additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
          [additionalAttributes2 setLibraryScopeAssetContributorsToUpdate:additionalAttributes3];

LABEL_46:
        }
      }

      else
      {
        v29 = [libraryScopeAssetContributorsToUpdate count];

        if (v29)
        {
          additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
          [additionalAttributes3 setLibraryScopeAssetContributorsToUpdate:0];
          goto LABEL_46;
        }
      }

LABEL_47:

      goto LABEL_48;
    }

    if (*MEMORY[0x1E6994D48])
    {
      goto LABEL_41;
    }

    v10 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v30 = 138412290;
      v31 = changeCopy;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEBUG, "Does not need to clear library scope for asset change %@", &v30, 0xCu);
    }

LABEL_40:

    goto LABEL_41;
  }

  managedObjectContext = [libraryCopy managedObjectContext];
  v10 = [(PLShare *)PLLibraryScope shareWithScopeIdentifier:sharingScopeIdentifier includeTrashed:1 inManagedObjectContext:managedObjectContext];

  if (v10)
  {
    sharingContributorUserIdentifiers = [changeCopy sharingContributorUserIdentifiers];
    if ([sharingContributorUserIdentifiers count])
    {
      v12 = [PLShareParticipant participantsWithUserIdentifiers:sharingContributorUserIdentifiers inScope:v10 inPhotoLibrary:libraryCopy];
      if (![v12 count]&& (*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v13 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
        {
          v30 = 138412546;
          v31 = sharingContributorUserIdentifiers;
          v32 = 2112;
          v33 = changeCopy;
          _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to fetch a local library scope contributors for sharing contributor user identifier %@ of asset change %@", &v30, 0x16u);
        }
      }
    }

    else
    {
      v12 = 0;
    }

    if ([v12 count])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v17 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
        {
          v30 = 138412802;
          v31 = v10;
          v32 = 2112;
          v33 = v12;
          v34 = 2112;
          v35 = changeCopy;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEBUG, "Setting library scope %@ and originator %@ for asset change %@", &v30, 0x20u);
        }
      }

      v18 = [MEMORY[0x1E695DFD8] setWithArray:v12];
      [(PLManagedAsset *)self setLibraryScope:v10 withContributors:v18];
    }

    else if ([sharingContributorUserIdentifiers count])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v19 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
        {
          v30 = 138412546;
          v31 = v10;
          v32 = 2112;
          v33 = changeCopy;
          _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_DEBUG, "Setting library scope %@ with no originators for asset change %@", &v30, 0x16u);
        }
      }

      [(PLManagedAsset *)self setLibraryScope:v10 withContributors:0];
    }

    else
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v20 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
        {
          v30 = 138412546;
          v31 = sharingScopeIdentifier;
          v32 = 2112;
          v33 = changeCopy;
          _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Setting library scope %@ and originator as current user for asset change %@", &v30, 0x16u);
        }
      }

      [(PLManagedAsset *)self setLibraryScopeWithCurrentUserAsContributor:v10];
    }

    PLLibraryScopeAssetSetAddToSharedZoneState(1, self);

    goto LABEL_40;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    updateSharingContributorUserIdentifiers = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(updateSharingContributorUserIdentifiers, OS_LOG_TYPE_ERROR))
    {
      v30 = 138412546;
      v31 = sharingScopeIdentifier;
      v32 = 2112;
      v33 = changeCopy;
      _os_log_impl(&dword_19BF1F000, updateSharingContributorUserIdentifiers, OS_LOG_TYPE_ERROR, "Failed to fetch a local library scope for sharing scope identifier %@ of asset change %@", &v30, 0x16u);
    }

    goto LABEL_47;
  }

LABEL_48:
}

- (void)applyPropertiesFromAssetChange:(id)change inLibrary:(id)library
{
  v156 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  libraryCopy = library;
  isFavorite = [(PLManagedAsset *)self isFavorite];
  if (isFavorite != [changeCopy isFavorite])
  {
    -[PLManagedAsset setFavorite:](self, "setFavorite:", [changeCopy isFavorite]);
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  scopedIdentifier = [changeCopy scopedIdentifier];
  identifier = [scopedIdentifier identifier];

  if (!identifier && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      LODWORD(buf.value) = 138412290;
      *(&buf.value + 4) = changeCopy;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "No identifier for assetChange %@", &buf, 0xCu);
    }
  }

  timeZoneName = [changeCopy timeZoneName];
  timeZoneName2 = [additionalAttributes timeZoneName];
  v14 = [timeZoneName2 isEqualToString:timeZoneName];

  if ((v14 & 1) == 0)
  {
    [additionalAttributes setTimeZoneName:timeZoneName];
  }

  timeZoneOffset = [changeCopy timeZoneOffset];
  v137 = timeZoneName;
  if (timeZoneOffset)
  {
    timeZoneOffset2 = [additionalAttributes timeZoneOffset];

    if (timeZoneOffset2 != timeZoneOffset)
    {
      [additionalAttributes setTimeZoneOffset:timeZoneOffset];
LABEL_14:
      [objc_opt_class() fixMissingOriginalTimezoneIfNeededForAsset:self];
      goto LABEL_15;
    }
  }

  if ((v14 & 1) == 0)
  {
    goto LABEL_14;
  }

LABEL_15:
  v136 = timeZoneOffset;
  if (identifier)
  {
    cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
    if (!cloudAssetGUID || (v18 = cloudAssetGUID, -[PLManagedAsset cloudAssetGUID](self, "cloudAssetGUID"), v19 = objc_claimAutoreleasedReturnValue(), v20 = [v19 isEqualToString:identifier], v19, v18, (v20 & 1) == 0))
    {
      [(PLManagedAsset *)self setCloudAssetGUID:identifier];
    }
  }

  v138 = identifier;
  recordModificationDate = [changeCopy recordModificationDate];
  if (recordModificationDate)
  {
    v22 = recordModificationDate;
    modificationDate = [(PLManagedAsset *)self modificationDate];
    if (modificationDate)
    {
      v24 = modificationDate;
      modificationDate2 = [(PLManagedAsset *)self modificationDate];
      recordModificationDate2 = [changeCopy recordModificationDate];
      v27 = [modificationDate2 isEqualToDate:recordModificationDate2];

      if (v27)
      {
        goto LABEL_25;
      }
    }

    else
    {
    }

    recordModificationDate3 = [changeCopy recordModificationDate];
    [(PLManagedAsset *)self setModificationDate:recordModificationDate3];
  }

LABEL_25:
  lastSharedDate = [changeCopy lastSharedDate];
  if (!lastSharedDate)
  {
    goto LABEL_31;
  }

  v30 = lastSharedDate;
  lastSharedDate2 = [(PLManagedAsset *)self lastSharedDate];
  if (!lastSharedDate2)
  {

    goto LABEL_30;
  }

  v32 = lastSharedDate2;
  lastSharedDate3 = [(PLManagedAsset *)self lastSharedDate];
  lastSharedDate4 = [changeCopy lastSharedDate];
  v35 = [lastSharedDate3 compare:lastSharedDate4];

  if (v35 == 1)
  {
LABEL_30:
    lastSharedDate5 = [changeCopy lastSharedDate];
    [(PLManagedAsset *)self setLastSharedDate:lastSharedDate5];
  }

LABEL_31:
  assetDate = [changeCopy assetDate];
  dateCreated = [(PLManagedAsset *)self dateCreated];

  if (assetDate)
  {
    if (!dateCreated)
    {
LABEL_35:
      [(PLManagedAsset *)self setDateCreated:assetDate];
      goto LABEL_38;
    }

    dateCreated2 = [(PLManagedAsset *)self dateCreated];
    v40 = [dateCreated2 isEqualToDate:assetDate];

    if ((v40 & 1) == 0)
    {
      [(PLManagedAsset *)self didSetCustomDateCreated];
      goto LABEL_35;
    }
  }

  else if (!dateCreated)
  {
    date = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setDateCreated:date];
  }

LABEL_38:
  v135 = assetDate;
  addedDate = [changeCopy addedDate];
  if (addedDate)
  {
    addedDate2 = [(PLManagedAsset *)self addedDate];
    v44 = [addedDate2 isEqualToDate:addedDate];

    if ((v44 & 1) == 0)
    {
      [(PLManagedAsset *)self setAddedDate:addedDate];
    }
  }

  v134 = addedDate;
  location = [(PLManagedAsset *)self location];
  location2 = [changeCopy location];
  v47 = [(PLManagedAsset *)self _location:location isEqualToLocationForUpdating:location2];

  if (!v47)
  {
    location3 = [changeCopy location];
    [(PLManagedAsset *)self setLocation:location3];
  }

  v49 = objc_opt_class();
  placeAnnotation = [changeCopy placeAnnotation];
  v51 = [v49 _dataFromCPLPlaceAnnotation:placeAnnotation];

  placeAnnotationData = [additionalAttributes placeAnnotationData];
  if (v51 != placeAnnotationData && ([v51 isEqualToData:placeAnnotationData] & 1) == 0)
  {
    [additionalAttributes setPlaceAnnotationData:v51];
  }

  v132 = placeAnnotationData;
  v133 = v51;
  keywords = [changeCopy keywords];

  if (keywords)
  {
    v54 = [PLKeywordManager keywordsForAsset:self];
    v55 = MEMORY[0x1E695DFD8];
    keywords2 = [changeCopy keywords];
    v57 = [v55 setWithArray:keywords2];

    if (([v54 isEqualToSet:v57] & 1) == 0)
    {
      keywordManager = [libraryCopy keywordManager];
      [keywordManager setKeywords:v57 forAsset:self];
    }
  }

  isHidden = [changeCopy isHidden];
  if (isHidden != [(PLManagedAsset *)self hidden])
  {
    -[PLManagedAsset setHidden:](self, "setHidden:", [changeCopy isHidden]);
  }

  longDescription = [(PLManagedAsset *)self longDescription];
  if (!longDescription || (v61 = longDescription, -[PLManagedAsset longDescription](self, "longDescription"), v62 = objc_claimAutoreleasedReturnValue(), [changeCopy extendedDescription], v63 = objc_claimAutoreleasedReturnValue(), v64 = objc_msgSend(v62, "isEqualToString:", v63), v63, v62, v61, (v64 & 1) == 0))
  {
    extendedDescription = [changeCopy extendedDescription];
    [(PLManagedAsset *)self setLongDescription:extendedDescription];
  }

  v139 = additionalAttributes;
  accessibilityDescription = [(PLManagedAsset *)self accessibilityDescription];
  if (!accessibilityDescription || (v67 = accessibilityDescription, -[PLManagedAsset accessibilityDescription](self, "accessibilityDescription"), v68 = objc_claimAutoreleasedReturnValue(), [changeCopy accessibilityDescription], v69 = objc_claimAutoreleasedReturnValue(), v70 = objc_msgSend(v68, "isEqualToString:", v69), v69, v68, v67, (v70 & 1) == 0))
  {
    accessibilityDescription2 = [changeCopy accessibilityDescription];
    [(PLManagedAsset *)self setAccessibilityDescription:accessibilityDescription2];
  }

  title = [(PLManagedAsset *)self title];
  if (!title || (v73 = title, -[PLManagedAsset title](self, "title"), v74 = objc_claimAutoreleasedReturnValue(), [changeCopy caption], v75 = objc_claimAutoreleasedReturnValue(), v76 = objc_msgSend(v74, "isEqualToString:", v75), v75, v74, v73, (v76 & 1) == 0))
  {
    caption = [changeCopy caption];
    [(PLManagedAsset *)self setTitle:caption];
  }

  [(PLManagedAsset *)self _updateAvalanchePropertiesFromAssetChange:changeCopy];
  -[PLManagedAsset _updateAssetSubtypeFromCPLAssetSubtype:](self, "_updateAssetSubtypeFromCPLAssetSubtype:", [changeCopy assetSubtype]);
  [(PLManagedAsset *)self updateKindSubtypeIfScreenshot];
  selfCopy = self;
  [(PLManagedAsset *)self updatePanoramosityWithMetadata:0];
  v140 = changeCopy;
  people = [changeCopy people];
  v79 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(people, "count")}];
  v148 = 0u;
  v149 = 0u;
  v150 = 0u;
  v151 = 0u;
  obj = people;
  v80 = [obj countByEnumeratingWithState:&v148 objects:v155 count:16];
  if (v80)
  {
    v81 = v80;
    v82 = *v149;
    do
    {
      for (i = 0; i != v81; ++i)
      {
        if (*v149 != v82)
        {
          objc_enumerationMutation(obj);
        }

        v84 = *(*(&v148 + 1) + 8 * i);
        personIdentifier = [v84 personIdentifier];
        if (personIdentifier)
        {
          extraProperties = [v84 extraProperties];
          v87 = [MEMORY[0x1E696AE40] dataWithPropertyList:extraProperties format:200 options:0 error:0];
          v88 = [PLPersonReference insertIntoPhotoLibrary:libraryCopy personUUID:personIdentifier personData:v87];
          [v79 addObject:v88];
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_72;
          }

          extraProperties = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(extraProperties, OS_LOG_TYPE_ERROR))
          {
            LODWORD(buf.value) = 138412290;
            *(&buf.value + 4) = v84;
            _os_log_impl(&dword_19BF1F000, extraProperties, OS_LOG_TYPE_ERROR, "Found a person reference %@ without personUUID, skipping update", &buf, 0xCu);
          }
        }

LABEL_72:
      }

      v81 = [obj countByEnumeratingWithState:&v148 objects:v155 count:16];
    }

    while (v81);
  }

  [v139 setPersonReferences:v79];
  playCount = [v140 playCount];
  if (playCount >= 1)
  {
    [v139 setPlayCount:playCount];
  }

  shareCount = [v140 shareCount];
  if (shareCount)
  {
    [v139 setShareCount:shareCount];
  }

  viewCount = [v140 viewCount];
  if (viewCount >= 1)
  {
    [v139 setViewCount:viewCount];
  }

  if ([MEMORY[0x1E6994A80] serverSupportsLastViewedDate])
  {
    lastViewedDate = [v140 lastViewedDate];
    if (lastViewedDate)
    {
      v93 = lastViewedDate;
      lastViewedDate2 = [v139 lastViewedDate];
      if (lastViewedDate2)
      {
        v95 = lastViewedDate2;
        lastViewedDate3 = [v139 lastViewedDate];
        lastViewedDate4 = [v140 lastViewedDate];
        v98 = [lastViewedDate3 compare:lastViewedDate4];

        if (v98 != 1)
        {
          goto LABEL_87;
        }
      }

      else
      {
      }

      lastViewedDate5 = [v140 lastViewedDate];
      [v139 setLastViewedDate:lastViewedDate5];
    }
  }

LABEL_87:
  collectionShare = [(PLManagedAsset *)selfCopy collectionShare];
  if (collectionShare)
  {
    v101 = collectionShare;
    contributorUserIdentifier = [v140 contributorUserIdentifier];

    if (contributorUserIdentifier)
    {
      contributorUserIdentifier2 = [v140 contributorUserIdentifier];
      v154 = contributorUserIdentifier2;
      v104 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v154 count:1];
      collectionShare2 = [(PLManagedAsset *)selfCopy collectionShare];
      v106 = [PLShareParticipant participantsWithUserIdentifiers:v104 inScope:collectionShare2 inPhotoLibrary:libraryCopy];

      if ([v106 count])
      {
        collectionShare3 = [(PLManagedAsset *)selfCopy collectionShare];
        firstObject = [v106 firstObject];
        [(PLManagedAsset *)selfCopy setCollectionShare:collectionShare3 withContributor:firstObject];
      }
    }
  }

  syndicationIdentifier = [v140 syndicationIdentifier];
  if (syndicationIdentifier)
  {
    syndicationIdentifier2 = [v139 syndicationIdentifier];
    v111 = [syndicationIdentifier2 isEqualToString:syndicationIdentifier];

    if ((v111 & 1) == 0)
    {
      if (([v139 setSyndicationIdentifier:syndicationIdentifier], !-[PLManagedAsset isPlaceholderAsset](selfCopy, "isPlaceholderAsset")) && !-[PLManagedAsset isCPLSharingScopeAsset](selfCopy, "isCPLSharingScopeAsset") || -[PLManagedAsset isPlaceholderAsset](selfCopy, "isPlaceholderAsset") && (-[PLManagedAsset shareRelationship](selfCopy, "shareRelationship"), v112 = objc_claimAutoreleasedReturnValue(), v112, !v112))
      {
        additionalAttributes2 = [(PLManagedAsset *)selfCopy additionalAttributes];
        syndicationIdentifier3 = [additionalAttributes2 syndicationIdentifier];
        if (syndicationIdentifier3)
        {
          v115 = syndicationIdentifier3;
          syndicationState = [(PLManagedAsset *)selfCopy syndicationState];

          if ((syndicationState & 2) == 0)
          {
            [(PLManagedAsset *)selfCopy syndicatedAssetDidSaveToUserLibrary];
          }
        }

        else
        {
        }
      }
    }
  }

  if ((_os_feature_enabled_impl() & 1) == 0)
  {
    PLLibraryScopeAssetSetLocalSharingStateValueFromSyncableShareStateValue([v140 sharedLibrarySharingState], selfCopy);
  }

  -[PLManagedAsset _updateViewPresentationFromCPLAssetViewPresentation:](selfCopy, "_updateViewPresentationFromCPLAssetViewPresentation:", [v140 viewPresentation]);
  inExpunged = [v140 inExpunged];
  if (inExpunged)
  {
    v142 = 0;
    v131 = 0;
    v118 = 2;
  }

  else
  {
    inTrash = [v140 inTrash];
    v142 = inTrash == 0;
    v131 = inTrash != 0;
    v118 = inTrash != 0;
  }

  trashedState = [(PLManagedAsset *)selfCopy trashedState];
  -[PLManagedAsset applyTrashedState:withTrashedReason:expungeReasonFromClient:](selfCopy, "applyTrashedState:withTrashedReason:expungeReasonFromClient:", v118, [v140 trashedReason], 0);
  dateDeleted = [v140 dateDeleted];
  [(PLManagedAsset *)selfCopy setTrashedDate:dateDeleted];

  if ([MEMORY[0x1E6994A80] serverSupportsDeletedByUserIdentifier])
  {
    deletedByUserIdentifier = [v140 deletedByUserIdentifier];
    if (deletedByUserIdentifier)
    {
      v123 = deletedByUserIdentifier;
      v124 = _os_feature_enabled_impl();

      if ((v124 & 1) == 0)
      {
        deletedByUserIdentifier2 = [v140 deletedByUserIdentifier];
        v153 = deletedByUserIdentifier2;
        v125 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v153 count:1];
        libraryScope = [(PLManagedAsset *)selfCopy libraryScope];
        v127 = [PLShareParticipant participantsWithUserIdentifiers:v125 inScope:libraryScope inPhotoLibrary:libraryCopy];

        if ([v127 count])
        {
          firstObject2 = [v127 firstObject];
          [(PLManagedAsset *)selfCopy setTrashedByParticipant:firstObject2];
        }
      }
    }
  }

  if (syndicationIdentifier && trashedState != v118)
  {
    if (v142)
    {
      [(PLManagedAsset *)selfCopy restoreSyndicatedAsset];
    }

    else if ((inExpunged | v131) == 1)
    {
      [(PLManagedAsset *)selfCopy rejectSyndicatedAsset];
    }
  }

  memset(&buf, 0, sizeof(buf));
  CMTimeMake(&buf, [v140 videoComplementDurationValue], objc_msgSend(v140, "videoComplementDurationTimescale"));
  memset(&v147, 0, sizeof(v147));
  CMTimeMake(&v147, [v140 videoComplementImageDisplayValue], objc_msgSend(v140, "videoComplementImageDisplayTimescale"));
  mediaGroupIdentifier = [v140 mediaGroupIdentifier];
  v146 = buf;
  v145 = v147;
  [(PLManagedAsset *)selfCopy updatePhotoIrisMetadataWithMediaGroupUUID:mediaGroupIdentifier videoDuration:&v146 stillDisplayTime:&v145];

  -[PLManagedAsset setVideoCpVisibilityState:](selfCopy, "setVideoCpVisibilityState:", [v140 videoComplementVisibilityState]);
}

- (BOOL)_location:(id)_location isEqualToLocationForUpdating:(id)updating
{
  _locationCopy = _location;
  updatingCopy = updating;
  v7 = updatingCopy;
  if (_locationCopy == updatingCopy)
  {
    v28 = 1;
  }

  else if ((_locationCopy == 0) == (updatingCopy != 0))
  {
    v28 = 0;
  }

  else
  {
    timestamp = [_locationCopy timestamp];
    timestamp2 = [v7 timestamp];
    [_locationCopy coordinate];
    v11 = v10;
    [v7 coordinate];
    if (v11 == v12 && ([_locationCopy coordinate], v14 = v13, objc_msgSend(v7, "coordinate"), v14 == v15) && (objc_msgSend(_locationCopy, "altitude"), v17 = v16, objc_msgSend(v7, "altitude"), v17 == v18) && (objc_msgSend(_locationCopy, "horizontalAccuracy"), v20 = v19, objc_msgSend(v7, "horizontalAccuracy"), v20 == v21) && (objc_msgSend(_locationCopy, "verticalAccuracy"), v23 = v22, objc_msgSend(v7, "verticalAccuracy"), v23 == v24) && (objc_msgSend(_locationCopy, "course"), v26 = v25, objc_msgSend(v7, "course"), v26 == v27))
    {
      if (timestamp | timestamp2)
      {
        v28 = 0;
        if (timestamp && timestamp2)
        {
          v28 = [timestamp isEqual:timestamp2];
        }
      }

      else
      {
        v28 = 1;
      }
    }

    else
    {
      v28 = 0;
    }
  }

  return v28;
}

- (void)setVideoInfoOnMasterFromAVAsset:(id)asset
{
  v17 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  master = [(PLManagedAsset *)self master];

  if (master)
  {
    plVideoCodecName = [assetCopy plVideoCodecName];
    master2 = [(PLManagedAsset *)self master];
    [master2 setCodecName:plVideoCodecName];

    v8 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:assetCopy];
    if ([v8 count])
    {
      v9 = [v8 objectAtIndex:0];
      master3 = [(PLManagedAsset *)self master];
      [v9 nominalFrameRate];
      LODWORD(v12) = llroundf(v11);
      [master3 setVideoFrameRate:v12];
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_8:

        goto LABEL_9;
      }

      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        master4 = [(PLManagedAsset *)self master];
        scopedIdentifier = [master4 scopedIdentifier];
        v15 = 138543362;
        v16 = scopedIdentifier;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "setVideoInfoFromAVAsset: videoTrack doesn't have a track of type AVMediaTypeVideo for %{public}@", &v15, 0xCu);
      }
    }

    goto LABEL_8;
  }

LABEL_9:
}

- (void)_applyPropertiesFromCloudMaster:(id)master
{
  v65 = *MEMORY[0x1E69E9840];
  masterCopy = master;
  [(PLManagedAsset *)self setMaster:masterCopy];
  creationDate = [masterCopy creationDate];
  dateCreated = [(PLManagedAsset *)self dateCreated];

  if (creationDate)
  {
    if (!dateCreated)
    {
      [(PLManagedAsset *)self setDateCreated:creationDate];
    }
  }

  else if (!dateCreated)
  {
    date = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setDateCreated:date];
  }

  uniformTypeIdentifier = [masterCopy uniformTypeIdentifier];
  if ([uniformTypeIdentifier length])
  {
    if (!uniformTypeIdentifier)
    {
      goto LABEL_32;
    }
  }

  else
  {
    v9 = MEMORY[0x1E6994D48];
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v62 = masterCopy;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "Missing UTI from cloudMaster %@, attempting to get it from resources", buf, 0xCu);
      }
    }

    v11 = [masterCopy rm_cloudResourcesForResourceType:1];
    firstObject = [v11 firstObject];

    if (firstObject)
    {
      uniformTypeIdentifier2 = [firstObject uniformTypeIdentifier];
      identifier = [uniformTypeIdentifier2 identifier];

      if (identifier)
      {
        if ((*v9 & 1) == 0)
        {
          v15 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            v62 = masterCopy;
            v63 = 2112;
            v64 = identifier;
            _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Setting UTI for cloudMaster %@ to %@", buf, 0x16u);
          }
        }

        [masterCopy setUniformTypeIdentifier:identifier];
      }

      else
      {
        if ((*v9 & 1) == 0)
        {
          v17 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412290;
            v62 = firstObject;
            _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "Missing UTI from original resource %@", buf, 0xCu);
          }
        }

        identifier = 0;
      }
    }

    else
    {
      if ((*v9 & 1) == 0)
      {
        v16 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v62 = masterCopy;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Missing original resource from %@", buf, 0xCu);
        }
      }

      identifier = uniformTypeIdentifier;
    }

    uniformTypeIdentifier = identifier;
    if (!identifier)
    {
      goto LABEL_32;
    }
  }

  uniformTypeIdentifier3 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v19 = [uniformTypeIdentifier3 isEqualToString:uniformTypeIdentifier];

  if (v19)
  {
LABEL_32:
    uniformTypeIdentifier4 = [(PLManagedAsset *)self uniformTypeIdentifier];

    uniformTypeIdentifier = uniformTypeIdentifier4;
    goto LABEL_34;
  }

  [(PLManagedAsset *)self setUniformTypeIdentifier:uniformTypeIdentifier];
  [(PLManagedAsset *)self updateAssetKindFromUniformTypeIdentifier];
LABEL_34:
  if ([(PLManagedAsset *)self kind]== 3)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
      {
        cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
        *buf = 138412546;
        v62 = cloudAssetGUID;
        v63 = 2112;
        v64 = uniformTypeIdentifier;
        _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEFAULT, "Unknown kind for asset %@ with UTI %@, attempting to promote from cloud master", buf, 0x16u);
      }
    }

    [(PLManagedAsset *)self attemptPromoteFromUnknownKindUsingCloudMaster];
  }

  originalFilename = [masterCopy originalFilename];
  if (originalFilename)
  {
    v24 = originalFilename;
    originalFilename2 = [masterCopy originalFilename];
    originalFilename3 = [(PLManagedAsset *)self originalFilename];
    v27 = [originalFilename2 isEqualToString:originalFilename3];

    if ((v27 & 1) == 0)
    {
      originalFilename4 = [masterCopy originalFilename];
      [(PLManagedAsset *)self setOriginalFilename:originalFilename4];
    }
  }

  originalOrientation = [(PLManagedAsset *)self originalOrientation];
  if (originalOrientation != [masterCopy originalOrientation])
  {
    -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [masterCopy originalOrientation]);
  }

  cloudAssetGUID2 = [(PLManagedAsset *)self cloudAssetGUID];
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    originalFilename5 = [(PLManagedAsset *)self originalFilename];
    [(PLManagedAsset *)self setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:uniformTypeIdentifier originalFilename:originalFilename5];
LABEL_57:

    goto LABEL_58;
  }

  directory = [(PLManagedAsset *)self directory];

  if (!directory)
  {
    v33 = [(PLManagedAsset *)self photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:cloudAssetGUID2];
    pathManager = [(PLManagedObject *)self pathManager];
    v35 = [pathManager assetAbbreviatedMetadataDirectoryForDirectory:v33 type:32 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
    [(PLManagedAsset *)self setDirectory:v35];
  }

  filename = [(PLManagedAsset *)self filename];

  if (!filename)
  {
    originalFilename6 = [(PLManagedAsset *)self originalFilename];
    pathExtension = [originalFilename6 pathExtension];
    uppercaseString = [pathExtension uppercaseString];

    if ([uppercaseString rangeOfString:&stru_1F0F2DA60] != 0x7FFFFFFFFFFFFFFFLL)
    {
      v40 = [&stru_1F0F06D80 copy];

      uppercaseString = v40;
    }

    if ([uppercaseString length] && !+[PLManagedAsset isKnownFileExtension:](PLManagedAsset, "isKnownFileExtension:", uppercaseString))
    {
      v41 = uppercaseString;
    }

    else
    {
      v41 = [PLManagedAsset preferredFileExtensionForType:uniformTypeIdentifier];
    }

    originalFilename5 = v41;
    v42 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@.%@", cloudAssetGUID2, v41];
    [(PLManagedAsset *)self setFilename:v42];

    goto LABEL_57;
  }

LABEL_58:
  v43 = [masterCopy rm_cloudResourcesForResourceType:18];
  v44 = [v43 count];

  if (v44)
  {
    [(PLManagedAsset *)self setKindSubtype:2];
  }

  v45 = [masterCopy rm_cloudResourcesForResourceType:23];
  v46 = [v45 count];

  if (v46)
  {
    [(PLManagedAsset *)self setCameraProcessingAdjustmentState:[(PLManagedAsset *)self cameraProcessingAdjustmentState]| 1];
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setImportedBy:{objc_msgSend(masterCopy, "importedBy")}];

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  importedByBundleIdentifier = [masterCopy importedByBundleIdentifier];
  [additionalAttributes2 setImportedByBundleIdentifier:importedByBundleIdentifier];

  additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
  importedByDisplayName = [masterCopy importedByDisplayName];
  [additionalAttributes3 setImportedByDisplayName:importedByDisplayName];

  [objc_opt_class() processMediaMetadataForAsset:self withCloudMaster:masterCopy];
  [objc_opt_class() fixMissingOriginalDateCreatedIfNeededForAsset:self withCloudMaster:masterCopy];
  fingerprintScheme = [masterCopy fingerprintScheme];
  LOBYTE(importedByDisplayName) = [fingerprintScheme isForStableHash];

  if (importedByDisplayName)
  {
    scopedIdentifier = [masterCopy scopedIdentifier];
    identifier2 = [scopedIdentifier identifier];

    if (!identifier2)
    {
      goto LABEL_74;
    }
  }

  else
  {
    v60 = 0;
    identifier2 = [masterCopy stableHashFromOriginalResourceError:&v60];
    v55 = v60;
    additionalAttributes4 = v55;
    if (!identifier2)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v57 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412546;
          v62 = masterCopy;
          v63 = 2112;
          v64 = additionalAttributes4;
          _os_log_impl(&dword_19BF1F000, v57, OS_LOG_TYPE_ERROR, "Failed to find master stable hash in original resource in %@: %@", buf, 0x16u);
        }
      }

      identifier2 = 0;
      goto LABEL_73;
    }
  }

  additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes4 setOriginalStableHash:identifier2];
LABEL_73:

LABEL_74:
  additionalAttributes5 = [(PLManagedAsset *)self additionalAttributes];
  originatingAssetIdentifier = [masterCopy originatingAssetIdentifier];
  [additionalAttributes5 setOriginatingAssetIdentifier:originatingAssetIdentifier];
}

- (id)localResourcePathForMasterResourceWithCPLType:(unint64_t)type andUTI:(id)i
{
  iCopy = i;
  if (type <= 0x16 && ((1 << type) & 0x420100) != 0)
  {
    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      pathManager = [(PLManagedObject *)self pathManager];
      v8 = [PLResourceInstaller resourceTypeFromCPLType:type assetType:[(PLManagedAsset *)self kind]];
      v9 = objc_alloc(MEMORY[0x1E69BF298]);
      uuid = [(PLManagedAsset *)self uuid];
      pathForOriginalFile = [v9 initWithAssetUuid:uuid bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:iCopy resourceType:{0, v8}];

      stringByDeletingPathExtension = [pathManager readOnlyUrlWithIdentifier:pathForOriginalFile];
      [stringByDeletingPathExtension path];
    }

    else
    {
      pathManager = [PLManagedAsset preferredFileExtensionForType:iCopy];
      pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
      stringByDeletingPathExtension = [pathForOriginalFile stringByDeletingPathExtension];
      [stringByDeletingPathExtension stringByAppendingPathExtension:pathManager];
    }
    v13 = ;
  }

  else
  {
    v13 = [(PLManagedAsset *)self pathForCPLResourceType:type adjusted:0];
  }

  return v13;
}

- (id)localResourcePathForMasterResource:(id)resource
{
  resourceCopy = resource;
  cplType = [resourceCopy cplType];
  uniformTypeIdentifier = [resourceCopy uniformTypeIdentifier];

  identifier = [uniformTypeIdentifier identifier];
  v8 = [(PLManagedAsset *)self localResourcePathForMasterResourceWithCPLType:cplType andUTI:identifier];

  return v8;
}

- (CGSize)_targetSizeForInputSize:(CGSize)size maxPixelSize:(unint64_t)pixelSize
{
  v4 = 1.0;
  if (size.height * size.width > pixelSize)
  {
    v4 = sqrt(pixelSize / (size.height * size.width));
  }

  v5 = size.width * v4;
  v6 = roundf(v5);
  v7 = size.height * v4;
  v8 = roundf(v7);
  result.height = v8;
  result.width = v6;
  return result;
}

- (id)_cplRelationsForAssetInLibrary:(id)library orderKeyManager:(id)manager
{
  v42 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  managerCopy = manager;
  v32 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v30 = libraryCopy;
  managedObjectContext = [libraryCopy managedObjectContext];
  v29 = managerCopy;
  v9 = [managerCopy albumsAndOrderValuesForAsset:self inManagedObjectContext:managedObjectContext];
  if ([v9 count] >= 2)
  {
    v11 = 0;
    *&v10 = 138412546;
    v27 = v10;
    selfCopy = self;
    v31 = managedObjectContext;
    while (1)
    {
      v12 = [v9 objectAtIndex:{v11, v27}];
      v13 = [managedObjectContext existingObjectWithID:v12 error:0];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        break;
      }

LABEL_21:

      v24 = [v9 count];
      v25 = v11 + 3;
      v11 += 2;
      if (v25 >= v24)
      {
        goto LABEL_26;
      }
    }

    v14 = v13;
    if (([v14 isCameraAlbum] & 1) == 0)
    {
      cloudGUID = [v14 cloudGUID];

      if (cloudGUID)
      {
        if ([v14 kindValue] == 2 || objc_msgSend(v14, "kindValue") == 4000 || objc_msgSend(v14, "isProjectAlbumSupportingCloudUpload"))
        {
          v16 = objc_alloc_init(MEMORY[0x1E6994AA8]);
          v17 = [v9 objectAtIndex:v11 + 1];
          cloudGUID2 = [v14 cloudGUID];
          [v16 setContainerIdentifier:cloudGUID2];

          v33 = v17;
          [v16 setPosition:[(PLManagedAsset *)v17 integerValue]];
          customKeyAsset = [v14 customKeyAsset];
          LODWORD(v17) = [customKeyAsset isEqual:self];

          if (v17)
          {
            [v16 setKeyAsset:1];
          }

          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v20 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
            {
              cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
              if ([v16 isKeyAsset])
              {
                v22 = @"(keyAsset)";
              }

              else
              {
                v22 = &stru_1F0F06D80;
              }

              cloudGUID3 = [v14 cloudGUID];
              *buf = 138413058;
              v35 = cloudAssetGUID;
              v36 = 2112;
              selfCopy2 = v33;
              v38 = 2112;
              v39 = v22;
              self = selfCopy;
              v40 = 2112;
              v41 = cloudGUID3;
              _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Sending asset %@ with position: %@ %@ album: %@", buf, 0x2Au);
            }
          }

          [v32 addObject:v16];

          managedObjectContext = v31;
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_20;
          }

          v16 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            *buf = v27;
            v35 = v14;
            v36 = 2112;
            selfCopy2 = self;
            _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Trying to send non-user created album/folder relation, or album type is unsupported for relation change. album: %@, asset: %@", buf, 0x16u);
          }
        }
      }
    }

LABEL_20:

    goto LABEL_21;
  }

LABEL_26:

  return v32;
}

- (void)_updateViewPresentationForCPLAssetChange:(id)change
{
  v12 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  cloudViewPresentation = [additionalAttributes cloudViewPresentation];

  if (cloudViewPresentation >= 2)
  {
    if (cloudViewPresentation == 1000)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v8 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
        {
          uuid = [(PLManagedAsset *)self uuid];
          v10 = 138543362;
          v11 = uuid;
          _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "A non-sync view presentation was set to cloudViewPresentation. Defaulting to Natural. Asset: %{public}@", &v10, 0xCu);
        }
      }

      cloudViewPresentation = 0;
    }
  }

  else
  {
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    cloudViewPresentation = -[PLManagedAsset _cplViewPresentationFromPLViewPresentation:](self, "_cplViewPresentationFromPLViewPresentation:", [additionalAttributes2 viewPresentation]);
  }

  [changeCopy setViewPresentation:cloudViewPresentation];
}

- (void)_updateViewPresentationFromCPLAssetViewPresentation:(signed __int16)presentation
{
  presentationCopy = presentation;
  v17 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setCloudViewPresentation:presentationCopy];

  if (presentationCopy == 1000)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        uuid = [(PLManagedAsset *)self uuid];
        v15 = 138543362;
        v16 = uuid;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Trying to set a non-sync view presentation on download - defaulting to natural. Asset: %{public}@", &v15, 0xCu);
      }
    }

    v7 = 0;
    v6 = 1;
  }

  else
  {
    v6 = presentationCopy != 1;
    v7 = presentationCopy == 1;
  }

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  viewPresentation = [additionalAttributes2 viewPresentation];

  if (viewPresentation != v7)
  {
    v12 = !v6;
    if (viewPresentation < 2)
    {
      v12 = 1;
    }

    if (v12)
    {
      additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes3 setViewPresentation:v7];
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
        return;
      }

      additionalAttributes3 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(additionalAttributes3, OS_LOG_TYPE_DEFAULT))
      {
        uuid2 = [(PLManagedAsset *)self uuid];
        v15 = 138543362;
        v16 = uuid2;
        _os_log_impl(&dword_19BF1F000, additionalAttributes3, OS_LOG_TYPE_DEFAULT, "Skip overwriting non-sync view presentation. Asset: %{public}@", &v15, 0xCu);
      }
    }
  }
}

- (void)_updateAssetSubtypeForCPLAssetChange:(id)change
{
  changeCopy = change;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  cloudKindSubtype = [additionalAttributes cloudKindSubtype];
  if (cloudKindSubtype - 100 >= 4 && cloudKindSubtype > 3u)
  {
    if (cloudKindSubtype)
    {
      goto LABEL_10;
    }
  }

  else if ([(PLManagedAsset *)self cplAssetSubtypeFromPLAssetSubtype:[(PLManagedAsset *)self kindSubtype]])
  {
    goto LABEL_10;
  }

  spatialType = [(PLManagedAsset *)self spatialType];
  isVideo = [(PLManagedAsset *)self isVideo];
  if (!spatialType && isVideo)
  {
    [additionalAttributes cameraCaptureDevice];
  }

LABEL_10:
  [changeCopy setAssetSubtype:?];
}

- (unint64_t)cplAssetSubtypeFromPLAssetSubtype:(signed __int16)subtype
{
  if (subtype <= 100)
  {
    v6 = 1;
    v7 = 2;
    v8 = 3;
    if (subtype != 10)
    {
      v8 = 0;
    }

    if (subtype != 2)
    {
      v7 = v8;
    }

    v9 = subtype == 1;
  }

  else
  {
    if (subtype <= 102)
    {
      if (subtype != 101)
      {
        return 101;
      }

      if (([(PLManagedAsset *)self highFrameRateState:v3]& 2) != 0)
      {
        return 100;
      }

      return 0;
    }

    v6 = 102;
    v7 = 103;
    if (subtype != 104)
    {
      v7 = 0;
    }

    v9 = subtype == 103;
  }

  if (v9)
  {
    return v6;
  }

  else
  {
    return v7;
  }
}

- (void)_updateAssetSubtypeFromCPLAssetSubtype:(unint64_t)subtype
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setCloudKindSubtype:subtype];

  highFrameRateState = [(PLManagedAsset *)self highFrameRateState];
  if (subtype > 99)
  {
    if (subtype == 103)
    {
      v13 = 104;
    }

    else
    {
      v13 = 0;
    }

    if (subtype == 102)
    {
      v14 = 103;
    }

    else
    {
      v14 = v13;
    }

    v15 = (2 * (highFrameRateState & 1)) | highFrameRateState;
    if (subtype == 101)
    {
      v16 = 102;
    }

    else
    {
      v16 = 0;
    }

    if (subtype == 100)
    {
      v17 = 101;
    }

    else
    {
      v15 = highFrameRateState;
      v17 = v16;
    }

    if (subtype <= 101)
    {
      v11 = v15;
    }

    else
    {
      v11 = highFrameRateState;
    }

    if (subtype <= 101)
    {
      v12 = v17;
    }

    else
    {
      v12 = v14;
    }
  }

  else
  {
    if (subtype == 3)
    {
      v7 = 10;
    }

    else
    {
      v7 = 0;
    }

    if (subtype == 2)
    {
      v8 = 2;
    }

    else
    {
      v8 = v7;
    }

    v9 = highFrameRateState & 0xFFFD;
    if ((highFrameRateState & 1) == 0)
    {
      v9 = highFrameRateState;
    }

    v10 = (highFrameRateState << 31 >> 31) & 0x65;
    if (subtype)
    {
      v9 = highFrameRateState;
      v10 = subtype == 1;
    }

    if (subtype <= 1)
    {
      v11 = v9;
    }

    else
    {
      v11 = highFrameRateState;
    }

    if (subtype <= 1)
    {
      v12 = v10;
    }

    else
    {
      v12 = v8;
    }
  }

  if ([(PLManagedAsset *)self kindSubtype]!= v12)
  {
    [(PLManagedAsset *)self setKindSubtype:v12];
  }

  if ([(PLManagedAsset *)self highFrameRateState]!= v11)
  {

    [(PLManagedAsset *)self setHighFrameRateState:v11];
  }
}

- (void)_updateAvalanchePropertiesFromAssetChange:(id)change
{
  v23 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  burstFlags = [changeCopy burstFlags];
  [additionalAttributes setCloudAvalanchePickType:burstFlags];
  v8 = [(PLManagedAsset *)self _avalancheTypeFromCplBurstFlags:burstFlags];
  if ([(PLManagedAsset *)self avalanchePickType]!= v8)
  {
    [(PLManagedAsset *)self setAvalanchePickType:v8];
    if (+[PLAvalanche shouldOnlyShowAvalanchePicks]&& ![(PLManagedAsset *)self avalanchePickTypeIsVisible])
    {
      [(PLManagedAsset *)self setVisibilityState:2];
      [(PLManagedAsset *)self setAlbums:0];
    }

    else if ([(PLManagedAsset *)self avalanchePickTypeIsVisible]&& [(PLManagedAsset *)self visibilityState])
    {
      [(PLManagedAsset *)self setVisibilityState:0];
    }
  }

  burstIdentifier = [changeCopy burstIdentifier];
  avalancheUUID = [(PLManagedAsset *)self avalancheUUID];
  v11 = [avalancheUUID isEqualToString:burstIdentifier];

  if ((v11 & 1) == 0)
  {
    [(PLManagedAsset *)self setAvalancheUUID:burstIdentifier];
    if (burstIdentifier)
    {
      [(PLManagedAsset *)self setAvalancheKind:1];
    }

    else if ([(PLManagedAsset *)self avalanchePickType])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v12 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
        {
          v13 = NSStringFromSelector(a2);
          uuid = [(PLManagedAsset *)self uuid];
          v15 = 138413058;
          v16 = v13;
          v17 = 2112;
          v18 = uuid;
          v19 = 2112;
          v20 = changeCopy;
          v21 = 1024;
          avalanchePickType = [(PLManagedAsset *)self avalanchePickType];
          _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "%@: No burst identifier for asset %@ from assetChange %@ with pick type %d", &v15, 0x26u);
        }
      }

      [(PLManagedAsset *)self setAvalanchePickType:0];
      [(PLManagedAsset *)self setAvalancheKind:0];
      [(PLManagedAsset *)self setVisibilityState:0];
    }
  }
}

- (void)_updateBurstFlagsForCPLAssetChange:(id)change photoLibrary:(id)library
{
  changeCopy = change;
  if ([(PLManagedAsset *)self avalancheKind]== 1)
  {
    avalancheUUID = [(PLManagedAsset *)self avalancheUUID];

    if (avalancheUUID)
    {
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      cloudAvalanchePickType = [additionalAttributes cloudAvalanchePickType];

      [changeCopy setBurstFlags:{-[PLManagedAsset cplBurstFlagsFromPLAvalancheType:](self, "cplBurstFlagsFromPLAvalancheType:", -[PLManagedAsset avalanchePickType](self, "avalanchePickType")) | (cloudAvalanchePickType & 0xFFFFFFC0)}];
      avalancheUUID2 = [(PLManagedAsset *)self avalancheUUID];
      [changeCopy setBurstIdentifier:avalancheUUID2];
    }
  }
}

- (id)cplAssetChangeWithMasterScopedIdentifier:(id)identifier withChangeType:(unint64_t)type shouldGenerateDerivatives:(BOOL)derivatives orderKeyManager:(id)manager computeSyncUploadEnabled:(BOOL)enabled inLibrary:(id)library
{
  enabledCopy = enabled;
  derivativesCopy = derivatives;
  v29 = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  managerCopy = manager;
  libraryCopy = library;
  collectionShare = [(PLManagedAsset *)self collectionShare];
  if (!collectionShare || (v18 = collectionShare, v19 = _os_feature_enabled_impl(), v18, (v19 & 1) != 0))
  {
    scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
    v21 = [MEMORY[0x1E6994A80] newChangeWithScopedIdentifier:scopedIdentifier changeType:type];
    if ([v21 hasChangeType:2])
    {
      [(PLManagedAsset *)self _applyPropertiesChangeToCPLAssetChange:v21 withMasterScopedIdentifier:identifierCopy computeSyncUploadEnabled:enabledCopy inLibrary:libraryCopy];
    }

    if ((_os_feature_enabled_impl() & 1) == 0 && [v21 hasChangeType:64])
    {
      [(PLManagedAsset *)self _applySharingChangeToCPLAssetChange:v21 inLibrary:libraryCopy];
    }

    if ([v21 hasChangeType:32])
    {
      [(PLManagedAsset *)self _applyFaceChangeToCPLAssetChange:v21 inLibrary:libraryCopy];
    }

    if ([v21 hasChangeType:8])
    {
      [(PLManagedAsset *)self _applyResourceChangeToCPLAsset:v21 forChangeType:type shouldGenerateDerivatives:derivativesCopy inLibrary:libraryCopy];
    }

    if ([v21 hasChangeType:16])
    {
      v22 = [(PLManagedAsset *)self _cplRelationsForAssetInLibrary:libraryCopy orderKeyManager:managerCopy];
      [v21 setContainerRelations:v22];
    }

    modificationDate = [(PLManagedAsset *)self modificationDate];
    [v21 setRecordModificationDate:modificationDate];

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v24 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEBUG))
      {
        v27 = 138412290;
        v28 = v21;
        _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_DEBUG, "CPLAssetChange %@", &v27, 0xCu);
      }
    }

LABEL_22:

    goto LABEL_23;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    scopedIdentifier = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(scopedIdentifier, OS_LOG_TYPE_ERROR))
    {
      scopedIdentifier2 = [(PLManagedAsset *)self scopedIdentifier];
      v27 = 138412290;
      v28 = scopedIdentifier2;
      _os_log_impl(&dword_19BF1F000, scopedIdentifier, OS_LOG_TYPE_ERROR, "Not generating CPLAssetChange for CollectionShare asset as FF is disabled %@", &v27, 0xCu);
    }

    v21 = 0;
    goto LABEL_22;
  }

  v21 = 0;
LABEL_23:

  return v21;
}

- (id)cplFullRecord
{
  v21 = *MEMORY[0x1E69E9840];
  master = [(PLManagedAsset *)self master];
  v4 = master;
  if (master)
  {
    scopedIdentifier = [(PLManagedAsset *)master scopedIdentifier];
    if (scopedIdentifier)
    {
      photoLibrary = [(PLManagedObject *)self photoLibrary];
      libraryServicesManager = [photoLibrary libraryServicesManager];
      databaseContext = [libraryServicesManager databaseContext];

      v9 = [PLRelationshipOrderKeyManager alloc];
      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __36__PLManagedAsset_CPL__cplFullRecord__block_invoke;
      v17[3] = &unk_1E7574C88;
      v18 = databaseContext;
      v10 = databaseContext;
      v11 = [(PLRelationshipOrderKeyManager *)v9 initWithGenerateContextBlock:v17];
      photoLibrary2 = [(PLManagedObject *)self photoLibrary];
      v13 = [PLManagedAsset isComputeSyncEnabledForDirection:0 library:photoLibrary2];

      photoLibrary3 = [(PLManagedObject *)self photoLibrary];
      v15 = [(PLManagedAsset *)self cplAssetChangeWithMasterScopedIdentifier:scopedIdentifier withChangeType:0 shouldGenerateDerivatives:1 orderKeyManager:v11 computeSyncUploadEnabled:v13 inLibrary:photoLibrary3];

LABEL_12:
      goto LABEL_13;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        selfCopy = v4;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "No masterScopedIdentifier found in master %@.", buf, 0xCu);
      }

      v15 = 0;
      goto LABEL_12;
    }

    scopedIdentifier = 0;
LABEL_7:
    v15 = 0;
LABEL_13:

    goto LABEL_14;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    scopedIdentifier = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(scopedIdentifier, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      selfCopy = self;
      _os_log_impl(&dword_19BF1F000, scopedIdentifier, OS_LOG_TYPE_ERROR, "Can't find master for asset %@.", buf, 0xCu);
    }

    goto LABEL_7;
  }

  v15 = 0;
LABEL_14:

  return v15;
}

id __36__PLManagedAsset_CPL__cplFullRecord__block_invoke(uint64_t a1, uint64_t a2)
{
  v9 = *MEMORY[0x1E69E9840];
  v4 = PLBackendGetLog();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v7 = 136315138;
    v8 = "[PLManagedAsset(CPL) cplFullRecord]_block_invoke";
    _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_INFO, "Generating PLRelationshipOrderKeyManager context on-demand for: %s...", &v7, 0xCu);
  }

  v5 = [objc_msgSend(*(a1 + 32) newShortLivedLibraryForOrderKeyManagerWithName:{a2), "managedObjectContext"}];

  return v5;
}

- (id)_generateVideoResourcesFromURL:(id)l withScopedIdentifier:(id)identifier forMaster:(BOOL)master
{
  masterCopy = master;
  v80[3] = *MEMORY[0x1E69E9840];
  lCopy = l;
  identifierCopy = identifier;
  v9 = [MEMORY[0x1E695DF70] arrayWithCapacity:3];
  if ((PLIsEDUMode() & 1) == 0)
  {
    fingerprintScheme = [(PLManagedAsset *)self fingerprintScheme];
    v11 = fingerprintScheme;
    if (fingerprintScheme)
    {
      invalidFingerprintScheme = fingerprintScheme;
    }

    else
    {
      invalidFingerprintScheme = [MEMORY[0x1E6994AE0] invalidFingerprintScheme];
    }

    v61 = invalidFingerprintScheme;

    isPhotoIris = [(PLManagedAsset *)self isPhotoIris];
    v14 = MEMORY[0x1E695DF70];
    v80[0] = &unk_1F0FBCCA0;
    v80[1] = &unk_1F0FBCC10;
    v80[2] = &unk_1F0FBCC28;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v80 count:3];
    v16 = [v14 arrayWithArray:v15];

    v17 = [MEMORY[0x1E6987E28] assetWithURL:lCopy];
    v56 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVAsset:v17 timeZoneLookup:0];
    v60 = isPhotoIris;
    if (!isPhotoIris && [v56 isHDR])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          [lCopy lastPathComponent];
          v20 = v19 = v17;
          *buf = 138412290;
          v72 = v20;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEFAULT, "Video resource %@ is HDR, requesting additional HDR medium derivative", buf, 0xCu);

          v17 = v19;
        }
      }

      [v16 addObject:&unk_1F0FBCCD0];
    }

    v69 = 0u;
    v70 = 0u;
    v67 = 0u;
    v68 = 0u;
    obj = v16;
    v21 = [obj countByEnumeratingWithState:&v67 objects:v79 count:16];
    if (v21)
    {
      v23 = v21;
      v24 = 0x1E6994000uLL;
      v64 = *v68;
      *&v22 = 138413058;
      v52 = v22;
      v54 = v9;
      v55 = lCopy;
      v59 = masterCopy;
      v57 = v17;
      selfCopy = self;
      do
      {
        v25 = 0;
        do
        {
          if (*v68 != v64)
          {
            objc_enumerationMutation(obj);
          }

          unsignedIntegerValue = [*(*(&v67 + 1) + 8 * v25) unsignedIntegerValue];
          if ([*(v24 + 3424) shouldGenerateVideoDerivativeForAVAsset:v17 forResourceType:unsignedIntegerValue adjusted:!masterCopy])
          {
            v27 = [(PLManagedAsset *)self _createVideoResourceFromVideoURL:lCopy withResourceType:unsignedIntegerValue scopedIdentifier:identifierCopy applyVideoAdjustments:1 forMaster:masterCopy forPhotoIris:v60 fingerprintScheme:v61];
            if (v27)
            {
              v28 = v27;
              defaultManager = [MEMORY[0x1E696AC08] defaultManager];
              path = [lCopy path];
              v31 = [defaultManager attributesOfItemAtPath:path error:0];
              fileSize = [v31 fileSize];

              identity = [v28 identity];
              if ([identity fileSize] < fileSize || objc_msgSend(v56, "firstVideoTrackCodec") != 1635148593)
              {
                goto LABEL_41;
              }

              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v34 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_DEFAULT))
                {
                  fileSize2 = [identity fileSize];
                  v36 = [MEMORY[0x1E6994B90] descriptionForResourceType:unsignedIntegerValue];
                  *buf = 134218498;
                  v72 = fileSize2;
                  v9 = v54;
                  v73 = 2048;
                  v74 = fileSize;
                  v75 = 2112;
                  v76 = v36;
                  _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_DEFAULT, "Generated derivative size %llu is larger than input size %llu for %@, will attempt to use the input resource instead.", buf, 0x20u);
                }
              }

              fileURL = [identity fileURL];
              v66 = 0;
              v38 = [defaultManager removeItemAtURL:fileURL error:&v66];
              v39 = v66;
              v40 = v39;
              if (v38)
              {
                v65 = v39;
                v41 = [defaultManager copyItemAtURL:v55 toURL:fileURL error:&v65];
                v53 = v65;

                if (v41)
                {
                  [fileURL removeAllCachedResourceValues];
                  path2 = [fileURL path];
                  fileUTI = [identity fileUTI];
                  v44 = objc_opt_class();
                  v45 = [(PLManagedAsset *)selfCopy _createCPLResourceFromResourcePath:path2 withResourceType:unsignedIntegerValue uniformTypeIdentifier:fileUTI scopedIdentifier:identifierCopy recordClass:v44 fingerprintScheme:v61];

                  v28 = v45;
                  lCopy = v55;
                  goto LABEL_38;
                }

                if ((*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  path2 = __CPLAssetsdOSLogDomain();
                  lCopy = v55;
                  if (os_log_type_enabled(path2, OS_LOG_TYPE_ERROR))
                  {
                    v49 = [MEMORY[0x1E6994B90] descriptionForResourceType:unsignedIntegerValue];
                    *buf = v52;
                    v72 = v49;
                    v73 = 2112;
                    v74 = v55;
                    v75 = 2112;
                    v76 = fileURL;
                    v77 = 2112;
                    v48 = v53;
                    v78 = v53;
                    _os_log_impl(&dword_19BF1F000, path2, OS_LOG_TYPE_ERROR, "Failed to copy the input video to be use for %@ from %@ to %@, fallback and use the generated video. Error: %@", buf, 0x2Au);
                  }

                  else
                  {
LABEL_38:
                    v48 = v53;
                  }

LABEL_39:

                  v40 = v48;
                  v9 = v54;
LABEL_40:

LABEL_41:
                  self = selfCopy;
                  [v9 addObject:v28];

                  masterCopy = v59;
                  v17 = v57;
LABEL_42:
                  v24 = 0x1E6994000;
                  goto LABEL_43;
                }

                v40 = v53;
              }

              else if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                path2 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(path2, OS_LOG_TYPE_ERROR))
                {
                  v47 = [MEMORY[0x1E6994B90] descriptionForResourceType:unsignedIntegerValue];
                  *buf = 138412802;
                  v72 = v47;
                  v73 = 2112;
                  v74 = fileURL;
                  v75 = 2112;
                  v76 = v40;
                  _os_log_impl(&dword_19BF1F000, path2, OS_LOG_TYPE_ERROR, "Failed to delete the oversized generated video derivative for %@ from %@, fallback and use the generated video. Error: %@", buf, 0x20u);
                }

                v48 = v40;
                lCopy = v55;
                goto LABEL_39;
              }

              lCopy = v55;
              goto LABEL_40;
            }

            if (*MEMORY[0x1E6994D48])
            {
              goto LABEL_44;
            }

            v28 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
            {
              v46 = [MEMORY[0x1E6994B90] descriptionForResourceType:unsignedIntegerValue];
              *buf = 138412546;
              v72 = v46;
              v73 = 2112;
              v74 = lCopy;
              _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Failed to generate video derivative for %@ from %@.", buf, 0x16u);

              goto LABEL_42;
            }

LABEL_43:
          }

LABEL_44:
          ++v25;
        }

        while (v23 != v25);
        v50 = [obj countByEnumeratingWithState:&v67 objects:v79 count:16];
        v23 = v50;
      }

      while (v50);
    }
  }

  return v9;
}

- (id)_createVideoResourceFromVideoURL:(uint64_t)l withResourceType:(void *)type scopedIdentifier:(int)identifier applyVideoAdjustments:(int)adjustments forMaster:(int)master forPhotoIris:(void *)iris fingerprintScheme:
{
  v80 = *MEMORY[0x1E69E9840];
  v57 = a2;
  typeCopy = type;
  irisCopy = iris;
  if (self)
  {
    if (PLIsEDUMode())
    {
      currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
      [currentHandler handleFailureInMethod:sel__createVideoResourceFromVideoURL_withResourceType_scopedIdentifier_applyVideoAdjustments_forMaster_forPhotoIris_fingerprintScheme_ object:self file:@"PLManagedAsset+CPL.m" lineNumber:977 description:@"Should not be generating video derivatives in EDU mode"];
    }

    v72 = 0;
    v73 = &v72;
    v74 = 0x3032000000;
    v75 = __Block_byref_object_copy__51017;
    v76 = __Block_byref_object_dispose__51018;
    v77 = 0;
    if (l <= 20)
    {
      if (l == 6)
      {
        v15 = *MEMORY[0x1E69872F8];
        v16 = MEMORY[0x1E6987300];
LABEL_19:
        v20 = *v16;
        v56 = v15;
        if (master)
        {
          v21 = v15;
        }

        else
        {
          v21 = *v16;
        }

        v22 = v21;
        if ((master & 1) == 0)
        {
          v19 = MEMORY[0x1E69874B8];
          v56 = v20;
          goto LABEL_27;
        }

        goto LABEL_26;
      }

      if (l == 7)
      {
        v15 = *MEMORY[0x1E69872F0];
        v16 = MEMORY[0x1E69872E8];
        goto LABEL_19;
      }

LABEL_11:
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        if (__CPLCloudPhotoServicesOSLogDomain_onceToken != -1)
        {
          dispatch_once(&__CPLCloudPhotoServicesOSLogDomain_onceToken, &__block_literal_global_913);
        }

        v18 = __CPLCloudPhotoServicesOSLogDomain_result;
        if (os_log_type_enabled(__CPLCloudPhotoServicesOSLogDomain_result, OS_LOG_TYPE_ERROR))
        {
          *buf = 134217984;
          *&buf[4] = l;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Unhandled CPL resource type: %ld, Unable to set preset for video derivatives.", buf, 0xCu);
        }
      }

      v56 = 0;
      if ((master & 1) == 0)
      {
        v19 = MEMORY[0x1E69874B8];
LABEL_27:
        v23 = *v19;
        defaultManager = [MEMORY[0x1E696AC08] defaultManager];
        v25 = [self pathForCPLResourceType:l adjusted:adjustments ^ 1u];
        [v25 stringByDeletingLastPathComponent];
        v52 = v71 = 0;
        v26 = [defaultManager createDirectoryIfNeededAtPath:? error:?];
        v53 = 0;
        if ((v26 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v27 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412290;
            *&buf[4] = v53;
            _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_ERROR, "Unable to create directory for video resource: %@", buf, 0xCu);
          }
        }

        v28 = [defaultManager fileExistsAtPath:v25];
        if (v28)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v29 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
            {
              *buf = 138412290;
              *&buf[4] = v25;
              _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_DEFAULT, "Derivative already exists at %@, removing", buf, 0xCu);
            }
          }

          [defaultManager removeItemAtPath:v25 error:0];
        }

        else if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v30 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
          {
            *buf = 138412290;
            *&buf[4] = v25;
            _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_DEBUG, "Derivative at %@ will be removed after sending to CPL", buf, 0xCu);
          }
        }

        v31 = [MEMORY[0x1E695DFF8] fileURLWithPath:v25 isDirectory:0];
        v32 = v31;
        if (identifier)
        {
          v33 = [PLSlalomUtilities synchronouslyFetchVideoAdjustmentsFromManagedAsset:self];
          v34 = v32;
        }

        else
        {
          v34 = v31;
          v33 = 0;
        }

        v35 = v23;
        v36 = [MEMORY[0x1E6988168] assetWithURL:v57];
        v37 = [objc_alloc(MEMORY[0x1E69C08F8]) initWithVideoAsset:v36 videoAdjustments:v33];
        v51 = v36;
        v38 = v33;
        v39 = v28 ^ 1;
        v40 = dispatch_semaphore_create(0);
        v60[0] = MEMORY[0x1E69E9820];
        v60[1] = 3221225472;
        v60[2] = __153__PLManagedAsset_CPL___createVideoResourceFromVideoURL_withResourceType_scopedIdentifier_applyVideoAdjustments_forMaster_forPhotoIris_fingerprintScheme___block_invoke;
        v60[3] = &unk_1E756D688;
        lCopy = l;
        v61 = v57;
        v41 = v34;
        v62 = v41;
        v42 = defaultManager;
        v63 = v42;
        v64 = irisCopy;
        v43 = v35;
        v65 = v43;
        v68 = &v72;
        v66 = typeCopy;
        v70 = v39;
        v44 = v40;
        v67 = v44;
        *buf = *MEMORY[0x1E6960CC0];
        v79 = *(MEMORY[0x1E6960CC0] + 16);
        v58 = *buf;
        v59 = v79;
        [PLVideoTranscoder transcodeVideoWithObjectBuilder:v37 outputURL:v41 startTime:buf endTime:&v58 presetName:v56 outputFileType:v43 metadata:0 completionHandler:v60];
        dispatch_semaphore_wait(v44, 0xFFFFFFFFFFFFFFFFLL);
        v45 = v73[5];
        if (v45)
        {
          if (*MEMORY[0x1E6994D48])
          {
LABEL_53:
            self = v45;

            _Block_object_dispose(&v72, 8);
            goto LABEL_54;
          }

          v46 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_DEBUG))
          {
            v47 = v73[5];
            *buf = 138412290;
            *&buf[4] = v47;
            _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_DEBUG, "Generated video resource %@", buf, 0xCu);
          }
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            v45 = 0;
            goto LABEL_53;
          }

          v46 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
          {
            scopedIdentifier = [self scopedIdentifier];
            *buf = 138412290;
            *&buf[4] = scopedIdentifier;
            _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_ERROR, "Failed to create video resource for %@", buf, 0xCu);
          }
        }

        v45 = v73[5];
        goto LABEL_53;
      }

LABEL_26:
      v19 = MEMORY[0x1E69874C0];
      goto LABEL_27;
    }

    if (l == 21)
    {
      v17 = MEMORY[0x1E6987310];
    }

    else
    {
      if (l != 28)
      {
        goto LABEL_11;
      }

      v17 = MEMORY[0x1E6987308];
    }

    v56 = *v17;
    goto LABEL_26;
  }

LABEL_54:

  return self;
}

- (id)_createCPLResourceFromResourcePath:(uint64_t)path withResourceType:(void *)type uniformTypeIdentifier:(void *)identifier scopedIdentifier:(void *)scopedIdentifier recordClass:(void *)class fingerprintScheme:
{
  v63 = *MEMORY[0x1E69E9840];
  v13 = a2;
  typeCopy = type;
  classCopy = class;
  v51 = classCopy;
  v52 = typeCopy;
  if (self)
  {
    v16 = classCopy;
    v17 = MEMORY[0x1E695DFF8];
    identifierCopy = identifier;
    v19 = [[v17 alloc] initFileURLWithPath:v13 isDirectory:0];
    v20 = [objc_alloc(MEMORY[0x1E6994B98]) initWithFileURL:v19];
    [v20 setAvailable:1];
    v21 = [objc_alloc(MEMORY[0x1E6994B90]) initWithResourceIdentity:v20 itemScopedIdentifier:identifierCopy resourceType:path];

    [v20 setFileUTI:typeCopy];
    if (path == 1)
    {
      originalWidth = [self originalWidth];
      originalHeight = [self originalHeight];
    }

    else
    {
      originalWidth = *MEMORY[0x1E695F060];
      originalHeight = *(MEMORY[0x1E695F060] + 8);
    }

    v24 = MEMORY[0x1E6994D48];
    scopedIdentifierCopy = scopedIdentifier;
    if (!typeCopy || originalWidth != 0.0 && originalHeight != 0.0)
    {
      v25 = v13;
      v26 = MEMORY[0x1E6994D48];
      goto LABEL_20;
    }

    v27 = [MEMORY[0x1E6982C40] typeWithIdentifier:typeCopy];
    if ([v27 conformsToType:*MEMORY[0x1E6982E30]])
    {
      [PLManagedAsset sizeOfImageAtURL:v19 outOrientation:0];
      originalWidth = v28;
      originalHeight = v29;
      if (*v24)
      {
LABEL_19:
        v25 = v13;
        v26 = v24;

LABEL_20:
        [v20 setImageDimensions:{originalWidth, originalHeight}];
        v56 = 0;
        v34 = *MEMORY[0x1E695DB50];
        v55 = 0;
        v35 = [v19 getResourceValue:&v56 forKey:v34 error:&v55];
        v36 = v56;
        v37 = v55;
        v50 = v21;
        if (v35)
        {
          [v20 setFileSize:{objc_msgSend(v36, "unsignedIntegerValue")}];
          if (!v19)
          {
LABEL_30:
            v42 = 0;
            v39 = 0;
            goto LABEL_31;
          }

          v54 = v37;
          [v16 fingerPrintForFileAtURL:v19 error:&v54];
          v39 = v38 = v16;
          v40 = v54;

          if (!v39)
          {
            v42 = 0;
            v37 = v40;
            goto LABEL_31;
          }

          if (([v38 isForStableHash] & 1) != 0 || !objc_msgSend(scopedIdentifierCopy, "requiresStableHashForResourceType:", path))
          {
            v42 = 0;
            v37 = v40;
            if (!v40)
            {
LABEL_41:
              v47 = *v26;
              v13 = v25;
              if ((v47 & 1) == 0)
              {
                v48 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v48, OS_LOG_TYPE_DEBUG))
                {
                  *buf = 138412802;
                  v58 = *&v39;
                  v59 = 2112;
                  v60 = *&v42;
                  v61 = 2112;
                  v62 = v25;
                  _os_log_impl(&dword_19BF1F000, v48, OS_LOG_TYPE_DEBUG, "Setting finger print %@ and stableHash %@ to %@", buf, 0x20u);
                }
              }

              [v20 setFingerPrint:v39];
              [v20 setStableHash:v42];
              v37 = 0;
              v45 = v50;
LABEL_36:

              goto LABEL_37;
            }

LABEL_31:
            v43 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Failed to generate finger print or stable hash for %@. Error: %@", v25, v37];
            if ((*v26 & 1) == 0)
            {
              v44 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
              {
                *buf = 138412546;
                v58 = *&v25;
                v59 = 2112;
                v60 = *&v37;
                _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Failed to generate finger print or stable hash for %@. Error: %@", buf, 0x16u);
              }
            }

            PLSimulateCrash();

            v45 = v50;
            v13 = v25;
            goto LABEL_36;
          }

          fingerprintSchemeForStableHash = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
          v53 = v40;
          v42 = [fingerprintSchemeForStableHash fingerPrintForFileAtURL:v19 error:&v53];
          v37 = v53;

          if (v42)
          {
            if (!v37)
            {
              goto LABEL_41;
            }

            goto LABEL_31;
          }
        }

        else
        {
          v39 = v19;
          v19 = 0;
        }

        goto LABEL_30;
      }

      v30 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
LABEL_18:

        goto LABEL_19;
      }

      *buf = 134218498;
      v58 = originalWidth;
      v59 = 2048;
      v60 = originalHeight;
      v61 = 2112;
      v62 = v13;
      v31 = "Read image size %lf.%lf from resource file %@.";
    }

    else
    {
      if (![v27 conformsToType:*MEMORY[0x1E6982EE8]])
      {
        goto LABEL_19;
      }

      [PLManagedAsset dimensionsForVideoAtURL:v19];
      originalWidth = v32;
      originalHeight = v33;
      if (*v24)
      {
        goto LABEL_19;
      }

      v30 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        goto LABEL_18;
      }

      *buf = 134218498;
      v58 = originalWidth;
      v59 = 2048;
      v60 = originalHeight;
      v61 = 2112;
      v62 = v13;
      v31 = "Read video size %lf.%lf from resource file %@.";
    }

    _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_DEBUG, v31, buf, 0x20u);
    goto LABEL_18;
  }

  v45 = 0;
LABEL_37:

  return v45;
}

void __153__PLManagedAsset_CPL___createVideoResourceFromVideoURL_withResourceType_scopedIdentifier_applyVideoAdjustments_forMaster_forPhotoIris_fingerprintScheme___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v41 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (!v6)
  {
    v12 = *(a1 + 48);
    v13 = [*(a1 + 40) path];
    LOBYTE(v12) = [v12 fileExistsAtPath:v13];

    if ((v12 & 1) == 0)
    {
      if (*MEMORY[0x1E6994D48])
      {
        v7 = 0;
        goto LABEL_27;
      }

      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v20 = [MEMORY[0x1E6994B90] descriptionForResourceType:*(a1 + 96)];
        v21 = *(a1 + 32);
        v22 = *(a1 + 40);
        *buf = 138412802;
        v34 = v20;
        v35 = 2112;
        v36 = v21;
        v37 = 2112;
        v38 = v22;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "failed to write video derivative type %@ for %@ to %@.", buf, 0x20u);
      }

      v7 = 0;
      goto LABEL_26;
    }

    v8 = [objc_alloc(MEMORY[0x1E6994B98]) initWithFileURL:*(a1 + 40)];
    v14 = *(a1 + 56);
    v15 = *(a1 + 40);
    v32 = 0;
    v9 = [v14 fingerPrintForFileAtURL:v15 error:&v32];
    v16 = v32;
    v17 = v16;
    if (!v9 || v16)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v23 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
        {
          v24 = *(a1 + 40);
          *buf = 138412546;
          v34 = v24;
          v35 = 2112;
          v36 = v17;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_ERROR, "Failed to create finger print for %@. Error: %@", buf, 0x16u);
        }
      }
    }

    else
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
        {
          v19 = *(a1 + 40);
          *buf = 138412546;
          v34 = v9;
          v35 = 2112;
          v36 = v19;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEBUG, "Setting finger print %@ to %@", buf, 0x16u);
        }
      }

      [v8 setFingerPrint:v9];
    }

    [v8 setFileUTI:*(a1 + 64)];
    v25 = *(a1 + 48);
    v26 = [*(a1 + 40) path];
    v31 = v17;
    v27 = [v25 attributesOfItemAtPath:v26 error:&v31];
    v7 = v31;

    if (!v7 && v27)
    {
      -[NSObject setFileSize:](v8, "setFileSize:", [v27 fileSize]);
    }

    [PLManagedAsset dimensionsForVideoAtURL:*(a1 + 40)];
    [v8 setImageDimensions:?];
    [v8 setAvailable:1];
    v28 = [objc_alloc(MEMORY[0x1E6994B90]) initWithResourceIdentity:v8 itemScopedIdentifier:*(a1 + 72) resourceType:*(a1 + 96)];
    v29 = *(*(a1 + 88) + 8);
    v30 = *(v29 + 40);
    *(v29 + 40) = v28;

    [*(*(*(a1 + 88) + 8) + 40) setDeleteAfterUpload:*(a1 + 104)];
    goto LABEL_25;
  }

  v7 = v6;
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v8 = __CPLAssetsdOSLogDomain();
    if (!os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
LABEL_26:

      goto LABEL_27;
    }

    v9 = [MEMORY[0x1E6994B90] descriptionForResourceType:*(a1 + 96)];
    v10 = *(a1 + 32);
    v11 = *(a1 + 40);
    *buf = 138413058;
    v34 = v9;
    v35 = 2112;
    v36 = v10;
    v37 = 2112;
    v38 = v11;
    v39 = 2112;
    v40 = v7;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "could not generate video derivative type %@ for %@ error %@, to write to %@", buf, 0x2Au);
LABEL_25:

    goto LABEL_26;
  }

LABEL_27:
  dispatch_semaphore_signal(*(a1 + 80));
}

- (id)_generatePosterFrameResourcesFromVideoURL:(id)l withScopedIdentifier:(id)identifier forMaster:(BOOL)master fingerprintScheme:(id)scheme
{
  masterCopy = master;
  v21 = *MEMORY[0x1E69E9840];
  lCopy = l;
  identifierCopy = identifier;
  schemeCopy = scheme;
  v13 = [MEMORY[0x1E695DF70] arrayWithCapacity:2];
  v14 = [(PLManagedAsset *)self _generatePosterFrameForVideoAtURL:lCopy withResourceType:4 scopedIdentifier:identifierCopy forMaster:masterCopy fingerprintScheme:schemeCopy];
  if (v14)
  {
    [v13 addObject:v14];
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v19 = 138412290;
      v20 = lCopy;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Failed to generate medium poster image for %@", &v19, 0xCu);
    }
  }

  v16 = [(PLManagedAsset *)self _generatePosterFrameForVideoAtURL:lCopy withResourceType:5 scopedIdentifier:identifierCopy forMaster:masterCopy fingerprintScheme:schemeCopy];
  if (v16)
  {
    [v13 addObject:v16];
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v19 = 138412290;
      v20 = lCopy;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "Failed to generate thumbnail poster image for %@", &v19, 0xCu);
    }
  }

  return v13;
}

- (id)_generatePosterFrameForVideoAtURL:(uint64_t)l withResourceType:(void *)type scopedIdentifier:(int)identifier forMaster:(void *)master fingerprintScheme:
{
  v58 = *MEMORY[0x1E69E9840];
  v11 = a2;
  typeCopy = type;
  masterCopy = master;
  if (self)
  {
    v12 = [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:l];
    [self imageSize];
    v15 = v14;
    v16 = v13;
    v17 = MEMORY[0x1E6994D48];
    if (v14 == 0.0 || v13 == 0.0)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          *buf = 134218498;
          v51 = v15;
          v52 = 2048;
          v53 = v16;
          v54 = 2112;
          v55 = v11;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Original size (width: %f height: %f) is invalid. Getting the size from the video file %@ directly", buf, 0x20u);
        }
      }

      [PLManagedAsset dimensionsForVideoAtURL:v11];
      v15 = v19;
      v16 = v20;
    }

    [self _targetSizeForInputSize:v12 maxPixelSize:{v15, v16}];
    v22 = v21;
    v24 = v23;
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    v26 = [self pathForCPLResourceType:l adjusted:identifier ^ 1u];
    [(__CFString *)v26 stringByDeletingLastPathComponent];
    v46 = v49[1] = 0;
    v27 = [defaultManager createDirectoryIfNeededAtPath:? error:?];
    v28 = 0;
    if ((v27 & 1) == 0 && (*v17 & 1) == 0)
    {
      v29 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v51 = *&v28;
        _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "Unable to create directory for video posterframe image: %@", buf, 0xCu);
      }
    }

    v30 = [defaultManager fileExistsAtPath:v26];
    if (v30)
    {
      if ((*v17 & 1) == 0)
      {
        v31 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
        {
          *buf = 138412290;
          v51 = *&v26;
          _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_DEBUG, "Poster frame exists at %@, removing", buf, 0xCu);
        }
      }

      [defaultManager removeItemAtPath:v26 error:0];
    }

    else if ((*v17 & 1) == 0)
    {
      v32 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412290;
        v51 = *&v26;
        _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_DEBUG, "Poster frame at %@ will be removed after sending to CPL", buf, 0xCu);
      }
    }

    v49[0] = v28;
    v33 = v11;
    v34 = [PLVideoTranscoder generatePosterFrameForVideoAtURL:v11 maxSize:v49 error:v22, v24];
    v35 = v49[0];

    if (!v35 && v34)
    {
      v36 = DCIM_CGImageRefFromPLImage();
      writeCGImageToPath(v36, v26, 0);
    }

    if ([defaultManager fileExistsAtPath:v26])
    {
      identifier = [*MEMORY[0x1E6982E58] identifier];
      v38 = objc_opt_class();
      selfCopy = self;
      lCopy = l;
      v42 = masterCopy;
      v41 = typeCopy;
      v43 = [(PLManagedAsset *)selfCopy _createCPLResourceFromResourcePath:v26 withResourceType:lCopy uniformTypeIdentifier:identifier scopedIdentifier:typeCopy recordClass:v38 fingerprintScheme:masterCopy];

      [v43 setDeleteAfterUpload:v30 ^ 1u];
    }

    else if (*v17)
    {
      v43 = 0;
      v42 = masterCopy;
      v41 = typeCopy;
    }

    else
    {
      v44 = __CPLAssetsdOSLogDomain();
      v42 = masterCopy;
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        *buf = 138413058;
        v51 = *&self;
        v52 = 2112;
        v53 = *&v33;
        v54 = 2112;
        v55 = v26;
        v56 = 2112;
        v57 = v35;
        _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Failed to write poster image for %@. Original file path: %@ Derivative path: %@ Error: %@", buf, 0x2Au);
      }

      v43 = 0;
      v41 = typeCopy;
    }
  }

  else
  {
    v33 = v11;
    v43 = 0;
    v42 = masterCopy;
    v41 = typeCopy;
  }

  return v43;
}

- (id)_createJPEGResourcesFromFullSizePath:(id)path withScopedIdentifier:(id)identifier forMaster:(BOOL)master forResourceTypes:(id)types fingerprintScheme:(id)scheme
{
  masterCopy = master;
  v113 = *MEMORY[0x1E69E9840];
  pathCopy = path;
  identifierCopy = identifier;
  typesCopy = types;
  schemeCopy = scheme;
  v81 = [MEMORY[0x1E695DF70] arrayWithCapacity:3];
  if (pathCopy)
  {
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    v12 = [defaultManager fileExistsAtPath:pathCopy];

    if (v12)
    {
      v13 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathCopy isDirectory:0];
      [PLManagedAsset sizeOfImageAtURL:v13 outOrientation:0];
      v15 = v14;
      v17 = v16;

      [MEMORY[0x1E6994B90] derivativeGenerationThreshold];
      v19 = v18;
      v93 = 0u;
      v94 = 0u;
      v95 = 0u;
      v96 = 0u;
      obj = typesCopy;
      v90 = [obj countByEnumeratingWithState:&v93 objects:v98 count:16];
      if (!v90)
      {
        goto LABEL_88;
      }

      v87 = *v94;
      v20 = (v15 * v17);
      v76 = *MEMORY[0x1E6982E58];
      v77 = pathCopy;
      while (1)
      {
        v21 = 0;
        do
        {
          if (*v94 != v87)
          {
            objc_enumerationMutation(obj);
          }

          unsignedIntegerValue = [*(*(&v93 + 1) + 8 * v21) unsignedIntegerValue];
          v23 = [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:unsignedIntegerValue];
          if (unsignedIntegerValue == 5 || (v19 * v23) <= v20)
          {
            v91 = pathCopy;
            v88 = identifierCopy;
            v89 = schemeCopy;
            if (!self)
            {
              v57 = 0;
              goto LABEL_54;
            }

            defaultManager2 = [MEMORY[0x1E696AC08] defaultManager];
            v25 = v91;
            if (([defaultManager2 fileExistsAtPath:v25] & 1) == 0)
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v26 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
                {
                  mainFileURL = [(PLManagedAsset *)self mainFileURL];
                  *buf = 138412546;
                  *&buf[4] = pathCopy;
                  *&buf[12] = 2112;
                  *&buf[14] = mainFileURL;
                  _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Input file to resize does not exist at %@, use main file %@ instead", buf, 0x16u);
                }
              }

              mainFileURL2 = [(PLManagedAsset *)self mainFileURL];
              path = [mainFileURL2 path];

              v25 = path;
              if (!path)
              {
                goto LABEL_40;
              }
            }

            if ([defaultManager2 fileExistsAtPath:v25])
            {
              [(PLManagedAsset *)self imageSize];
              v32 = v31;
              v33 = v30;
              if (v31 == 0.0 && v30 == 0.0)
              {
                if ((*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  v34 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 134218498;
                    *&buf[4] = v32;
                    *&buf[12] = 2048;
                    *&buf[14] = v33;
                    *&buf[22] = 2112;
                    v112 = v25;
                    _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_ERROR, "Original size (width: %f height: %f) is invalid. Getting the size from the image file %@ directly", buf, 0x20u);
                  }
                }

                v35 = [MEMORY[0x1E695DFF8] fileURLWithPath:v25 isDirectory:0];
                [PLManagedAsset sizeOfImageAtURL:v35 outOrientation:0];
                v32 = v36;
                v33 = v37;
              }

              v38 = [(PLManagedAsset *)self pathForCPLResourceType:unsignedIntegerValue adjusted:!masterCopy];
              if (v38)
              {
                v82 = [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:unsignedIntegerValue];
                [(PLManagedAsset *)self _targetSizeForInputSize:v82 maxPixelSize:v32, v33];
                v40 = v39;
                v42 = v41;
                stringByDeletingLastPathComponent = [v38 stringByDeletingLastPathComponent];
                v97 = 0;
                v43 = [defaultManager2 createDirectoryIfNeededAtPath:stringByDeletingLastPathComponent error:&v97];
                v79 = v97;
                if ((v43 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  v44 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 138412290;
                    *&buf[4] = v79;
                    _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Unable to create directory for image resource: %@", buf, 0xCu);
                  }
                }

                v80 = [defaultManager2 fileExistsAtPath:v38];
                if (v80)
                {
                  *v99 = 1;
                  v45 = [MEMORY[0x1E695DFF8] fileURLWithPath:v38 isDirectory:0];
                  [PLManagedAsset sizeOfImageAtURL:v45 outOrientation:v99];
                  v47 = v46;
                  v49 = v48;

                  if (*v99 == 1 && v40 == v47 && v42 == v49)
                  {
                    if ((*MEMORY[0x1E6994D48] & 1) == 0)
                    {
                      v50 = __CPLAssetsdOSLogDomain();
                      if (os_log_type_enabled(v50, OS_LOG_TYPE_DEBUG))
                      {
                        *buf = 138412290;
                        *&buf[4] = v38;
                        _os_log_impl(&dword_19BF1F000, v50, OS_LOG_TYPE_DEBUG, "Derivative already exists at %@, using it", buf, 0xCu);
                      }
                    }

                    v51 = 0;
                    *buf = 0;
                    *&buf[8] = buf;
                    *&buf[16] = 0x2020000000;
                    LOBYTE(v112) = 0;
LABEL_74:
                    if ([defaultManager2 fileExistsAtPath:v38])
                    {
                      identifier = [v76 identifier];
                      v71 = objc_opt_class();
                      v57 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v38 withResourceType:unsignedIntegerValue uniformTypeIdentifier:identifier scopedIdentifier:v88 recordClass:v71 fingerprintScheme:v89];

                      [v57 setDeleteAfterUpload:v51];
                      goto LABEL_81;
                    }

LABEL_76:
                    if ((*MEMORY[0x1E6994D48] & 1) == 0)
                    {
                      v72 = __CPLAssetsdOSLogDomain();
                      if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
                      {
                        *v99 = 138412802;
                        selfCopy = self;
                        v101 = 2112;
                        v102 = v25;
                        v103 = 2112;
                        v104 = v38;
                        _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_ERROR, "Failed to generate derivative for %@. Original file path: %@ Derivative path: %@", v99, 0x20u);
                      }
                    }

                    v57 = 0;
LABEL_81:
                    _Block_object_dispose(buf, 8);

                    v55 = *MEMORY[0x1E6994D48];
                    if (v57)
                    {
                      if ((*MEMORY[0x1E6994D48] & 1) == 0)
                      {
                        v56 = __CPLAssetsdOSLogDomain();
                        if (os_log_type_enabled(v56, OS_LOG_TYPE_DEBUG))
                        {
                          *buf = 138412290;
                          *&buf[4] = v57;
                          _os_log_impl(&dword_19BF1F000, v56, OS_LOG_TYPE_DEBUG, "Generated image resource %@", buf, 0xCu);
                        }

                        goto LABEL_52;
                      }

                      goto LABEL_53;
                    }

LABEL_48:
                    if ((v55 & 1) == 0)
                    {
                      v56 = __CPLAssetsdOSLogDomain();
                      if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
                      {
                        *buf = 138412290;
                        *&buf[4] = identifierCopy;
                        _os_log_impl(&dword_19BF1F000, v56, OS_LOG_TYPE_ERROR, "Failed to create image resource for %@", buf, 0xCu);
                      }

                      v57 = 0;
LABEL_52:

LABEL_53:
LABEL_54:

                      if (v57)
                      {
                        [v81 addObject:v57];
                      }

                      else if ((*MEMORY[0x1E6994D48] & 1) == 0)
                      {
                        v58 = __CPLAssetsdOSLogDomain();
                        if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
                        {
                          v59 = [MEMORY[0x1E6994B90] descriptionForResourceType:unsignedIntegerValue];
                          *v105 = 138412802;
                          *&v105[4] = v59;
                          *&v105[12] = 2112;
                          *&v105[14] = pathCopy;
                          *&v105[22] = 2112;
                          v106 = identifierCopy;
                          _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_ERROR, "Failed to generate image resource type %@ from fullsize image %@ for asset %@.", v105, 0x20u);
                        }
                      }

                      goto LABEL_61;
                    }

LABEL_85:
                    v57 = 0;
                    goto LABEL_53;
                  }

                  if ((*MEMORY[0x1E6994D48] & 1) == 0)
                  {
                    v61 = __CPLAssetsdOSLogDomain();
                    if (os_log_type_enabled(v61, OS_LOG_TYPE_DEBUG))
                    {
                      *buf = 138412290;
                      *&buf[4] = v38;
                      _os_log_impl(&dword_19BF1F000, v61, OS_LOG_TYPE_DEBUG, "Derivative exists at %@, but size doesn't match, removing", buf, 0xCu);
                    }
                  }

                  [defaultManager2 removeItemAtPath:v38 error:0];
                }

                else if ((*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  v60 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v60, OS_LOG_TYPE_DEBUG))
                  {
                    *buf = 138412290;
                    *&buf[4] = v38;
                    _os_log_impl(&dword_19BF1F000, v60, OS_LOG_TYPE_DEBUG, "Derivative at %@ will be removed after sending to CPL", buf, 0xCu);
                  }
                }

                *buf = 0;
                *&buf[8] = buf;
                *&buf[16] = 0x2020000000;
                LOBYTE(v112) = 0;
                v62 = dispatch_semaphore_create(0);
                v63 = MEMORY[0x1E696AEC0];
                v64 = [MEMORY[0x1E6994B90] descriptionForResourceType:unsignedIntegerValue];
                v65 = [v63 stringWithFormat:@"Managed asset image generation for resource type %@", v64];

                v66 = MEMORY[0x1E6994D60];
                v67 = [MEMORY[0x1E695DFF8] fileURLWithPath:v25 isDirectory:0];
                v68 = [MEMORY[0x1E695DFF8] fileURLWithPath:v38 isDirectory:0];
                *v105 = MEMORY[0x1E69E9820];
                *&v105[8] = 3221225472;
                *&v105[16] = __125__PLManagedAsset_CPL___createImageResourceForResourceType_withPreviewImagePath_scopedIdentifier_forMaster_fingerprintScheme___block_invoke;
                v106 = &unk_1E7571B80;
                v107 = v25;
                v108 = v38;
                v110 = buf;
                v69 = v62;
                v109 = v69;
                [v66 resizeImageAtURL:v67 destinationURL:v68 maximumPixelCount:v82 bakeInOrientation:1 colorOutput:0 reason:v65 completionHandler:v105];

                pathCopy = v77;
                dispatch_semaphore_wait(v69, 0xFFFFFFFFFFFFFFFFLL);

                if (*(*&buf[8] + 24) == 1)
                {
                  v51 = v80 ^ 1u;
                  goto LABEL_74;
                }

                goto LABEL_76;
              }

              if (*MEMORY[0x1E6994D48])
              {
                goto LABEL_85;
              }

              v52 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
              {
                *buf = 134218242;
                *&buf[4] = unsignedIntegerValue;
                *&buf[12] = 2112;
                *&buf[14] = self;
                v53 = v52;
                v54 = "No destination path found to write the derivative of type %lu for %@";
LABEL_46:
                _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_ERROR, v54, buf, 0x16u);
              }
            }

            else
            {
LABEL_40:
              if (*MEMORY[0x1E6994D48])
              {
                goto LABEL_85;
              }

              v52 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
              {
                *buf = 138412546;
                *&buf[4] = v25;
                *&buf[12] = 2112;
                *&buf[14] = identifierCopy;
                v53 = v52;
                v54 = "Failed to find image to resize at %@. Skipping derivative generation for %@";
                goto LABEL_46;
              }
            }

            v55 = *MEMORY[0x1E6994D48];
            goto LABEL_48;
          }

LABEL_61:
          ++v21;
        }

        while (v90 != v21);
        v73 = [obj countByEnumeratingWithState:&v93 objects:v98 count:16];
        v90 = v73;
        if (!v73)
        {
LABEL_88:

          break;
        }
      }
    }
  }

  return v81;
}

void __125__PLManagedAsset_CPL___createImageResourceForResourceType_withPreviewImagePath_scopedIdentifier_forMaster_fingerprintScheme___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v7 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = *(a1 + 32);
        v9 = *(a1 + 40);
        v13 = 138412802;
        v14 = v8;
        v15 = 2112;
        v16 = v9;
        v17 = 2112;
        v18 = v6;
        _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "Failed to resize image at %@ to %@: %@", &v13, 0x20u);
      }
    }
  }

  else
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
      {
        v11 = *(a1 + 32);
        v12 = *(a1 + 40);
        v13 = 138412546;
        v14 = v11;
        v15 = 2112;
        v16 = v12;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEBUG, "Resized %@ to %@", &v13, 0x16u);
      }
    }

    *(*(*(a1 + 56) + 8) + 24) = 1;
  }

  dispatch_semaphore_signal(*(a1 + 48));
}

- (void)_debugPrintAdjustmentState
{
  v19 = *MEMORY[0x1E69E9840];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v4 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v5 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];
      pathForFullsizeRenderImageFile = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
      v9 = [defaultManager fileExistsAtPath:pathForFullsizeRenderImageFile];
      v10 = @"missing";
      if (v9)
      {
        v10 = @"exists";
      }

      v15 = 138412546;
      v16 = unmanagedAdjustment;
      v17 = 2112;
      v18 = v10;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "UnmanagedAdjustment: %@ \nFull size render %@", &v15, 0x16u);
    }
  }

  pathForAdjustmentFile = [(PLManagedAsset *)self pathForAdjustmentFile];
  if ([defaultManager fileExistsAtPath:pathForAdjustmentFile])
  {
    v12 = [MEMORY[0x1E695DEF0] dataWithContentsOfFile:pathForAdjustmentFile];
    if (v12)
    {
      v13 = [MEMORY[0x1E696AE40] propertyListWithData:v12 options:0 format:0 error:0];
      if ((*v4 & 1) == 0)
      {
        v14 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          v15 = 138412290;
          v16 = v13;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Adjustment dictionary: %@", &v15, 0xCu);
        }
      }
    }

    else
    {
      if (*v4)
      {
LABEL_17:

        goto LABEL_18;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v15 = 138412290;
        v16 = pathForAdjustmentFile;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to load adjustment data from %@", &v15, 0xCu);
      }
    }

    goto LABEL_17;
  }

LABEL_18:
}

- (void)_applyResourceChangeToCPLAsset:(id)asset forChangeType:(unint64_t)type shouldGenerateDerivatives:(BOOL)derivatives inLibrary:(id)library
{
  derivativesCopy = derivatives;
  typeCopy = type;
  v114 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  libraryCopy = library;
  v12 = MEMORY[0x1E695DF70];
  allAssetCPLResources = [(PLManagedAsset *)self allAssetCPLResources];
  v14 = [v12 arrayWithCapacity:{objc_msgSend(allAssetCPLResources, "count")}];

  if (![(PLManagedAsset *)self isPlaceholderAsset])
  {
    fingerprintScheme = [(PLManagedAsset *)self fingerprintScheme];
    v28 = fingerprintScheme;
    if (fingerprintScheme)
    {
      invalidFingerprintScheme = fingerprintScheme;
    }

    else
    {
      invalidFingerprintScheme = [MEMORY[0x1E6994AE0] invalidFingerprintScheme];
    }

    v83 = invalidFingerprintScheme;

    hasAdjustedCPLThumbResource = [(PLManagedAsset *)self hasAdjustedCPLThumbResource];
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    sourceAssetForDuplicationCPLScopedIdentifier = [additionalAttributes sourceAssetForDuplicationCPLScopedIdentifier];

    if (sourceAssetForDuplicationCPLScopedIdentifier)
    {
      v81 = assetCopy;
      selfCopy2 = self;
      [(PLManagedAsset *)self allAssetCPLResources];
      v103 = 0u;
      v104 = 0u;
      v105 = 0u;
      obj = v106 = 0u;
      v34 = [obj countByEnumeratingWithState:&v103 objects:v113 count:16];
      if (v34)
      {
        v35 = v34;
        v36 = *v104;
        do
        {
          for (i = 0; i != v35; ++i)
          {
            if (*v104 != v36)
            {
              objc_enumerationMutation(obj);
            }

            v38 = *(*(&v103 + 1) + 8 * i);
            v39 = [v38 cplResourceIncludeFile:0];
            v40 = v39;
            if (v39)
            {
              [v39 setCanGenerateDerivative:0];
              identity = [v40 identity];
              [identity setFileURL:0];

              [v40 setSourceResourceType:{objc_msgSend(v38, "cplType")}];
              [v14 addObject:v40];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v42 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
              {
                scopedIdentifier = [(PLManagedAsset *)selfCopy2 scopedIdentifier];
                *buf = 138412546;
                v110 = v38;
                v111 = 2112;
                v112 = scopedIdentifier;
                _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Dedupe merge resource copy: Unable to create CPLResource from %@ with itemIdentifier %@", buf, 0x16u);
              }
            }
          }

          v35 = [obj countByEnumeratingWithState:&v103 objects:v113 count:16];
        }

        while (v35);
      }

      if ([v14 count])
      {
        additionalAttributes2 = [(PLManagedAsset *)selfCopy2 additionalAttributes];
        sourceAssetForDuplicationCPLScopedIdentifier2 = [additionalAttributes2 sourceAssetForDuplicationCPLScopedIdentifier];
        assetCopy = v81;
        [v81 setResourceCopyFromScopedIdentifier:sourceAssetForDuplicationCPLScopedIdentifier2];

        v46 = 0;
      }

      else
      {
        v46 = 0;
        assetCopy = v81;
      }

LABEL_74:
      v51 = v83;
LABEL_75:

      v94[0] = MEMORY[0x1E69E9820];
      v94[1] = 3221225472;
      v94[2] = __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke;
      v94[3] = &unk_1E756D768;
      v98 = v46 & 1;
      v26 = &v95;
      v94[4] = selfCopy2;
      v95 = v51;
      v96 = v14;
      v97 = assetCopy;
      allAssetCPLResources2 = v51;
      [(PLManagedAsset *)selfCopy2 synchronouslyFetchAdjustmentBlobWithCompletionHandler:v94];

      self = selfCopy2;
LABEL_76:

      goto LABEL_77;
    }

    if ((typeCopy & 8) != 0 || !hasAdjustedCPLThumbResource)
    {
      v51 = v83;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v52 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v52, OS_LOG_TYPE_DEBUG))
        {
          scopedIdentifier2 = [assetCopy scopedIdentifier];
          *buf = 138412290;
          v110 = scopedIdentifier2;
          _os_log_impl(&dword_19BF1F000, v52, OS_LOG_TYPE_DEBUG, "Generating derivatives for assetChange with identifier %@", buf, 0xCu);
        }
      }

      obj = [(PLManagedAsset *)self createResourcesForAssetInPhotoLibrary:libraryCopy shouldGenerateDerivatives:derivativesCopy];
      [v14 addObjectsFromArray:?];
      selfCopy2 = self;
      v46 = 0;
      goto LABEL_75;
    }

    obj = [MEMORY[0x1E696AC08] defaultManager];
    if ([(PLManagedAsset *)self isPhoto])
    {
      fileURLForFullsizeRenderImage = [(PLManagedAsset *)self fileURLForFullsizeRenderImage];
    }

    else
    {
      if (![(PLManagedAsset *)self isVideo])
      {
        goto LABEL_51;
      }

      fileURLForFullsizeRenderImage = [(PLManagedAsset *)self fileURLForFullsizeRenderVideo];
      if ([(PLManagedAsset *)self isDefaultAdjustedSlomo])
      {
        path = [fileURLForFullsizeRenderImage path];
        v55 = [obj fileExistsAtPath:path];

        if ((v55 & 1) == 0)
        {
          mainFileURL = [(PLManagedAsset *)self mainFileURL];

          fileURLForFullsizeRenderImage = mainFileURL;
        }
      }
    }

    if (fileURLForFullsizeRenderImage)
    {
      path2 = [fileURLForFullsizeRenderImage path];
      v50 = [obj fileExistsAtPath:path2];

LABEL_52:
      v85 = v50;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v57 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v57, OS_LOG_TYPE_DEFAULT))
        {
          resources = [(PLManagedAsset *)self resources];
          v59 = resources;
          v60 = @"NO";
          if (v50)
          {
            v60 = @"YES";
          }

          *buf = 138412546;
          v110 = resources;
          v111 = 2112;
          v112 = v60;
          _os_log_impl(&dword_19BF1F000, v57, OS_LOG_TYPE_DEFAULT, "Reusing existing cloud resources %@. canGenerateDerivative: %@", buf, 0x16u);
        }
      }

      v80 = libraryCopy;
      v82 = assetCopy;
      selfCopy3 = self;
      [(PLManagedAsset *)self allAssetCPLResources];
      v99 = 0u;
      v100 = 0u;
      v101 = 0u;
      v86 = v102 = 0u;
      v61 = [v86 countByEnumeratingWithState:&v99 objects:v108 count:16];
      v62 = v50;
      if (v61)
      {
        v63 = v61;
        v46 = 0;
        v64 = *v100;
        do
        {
          for (j = 0; j != v63; ++j)
          {
            if (*v100 != v64)
            {
              objc_enumerationMutation(v86);
            }

            v66 = *(*(&v99 + 1) + 8 * j);
            v67 = [v66 cplType] == 13;
            v68 = [v66 cplResourceIncludeFile:0];
            v69 = v68;
            if (v68)
            {
              [v68 setCanGenerateDerivative:v62];
              [v14 addObject:v69];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v70 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v70, OS_LOG_TYPE_ERROR))
              {
                scopedIdentifier3 = [(PLManagedAsset *)selfCopy3 scopedIdentifier];
                *buf = 138412546;
                v110 = v66;
                v111 = 2112;
                v112 = scopedIdentifier3;
                _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_ERROR, "Unable to create CPLResource from %@ with itemIdentifier %@", buf, 0x16u);

                v62 = v85;
              }
            }

            v46 |= v67;
          }

          v63 = [v86 countByEnumeratingWithState:&v99 objects:v108 count:16];
        }

        while (v63);
      }

      else
      {
        v46 = 0;
      }

      libraryCopy = v80;
      assetCopy = v82;
      selfCopy2 = selfCopy3;
      goto LABEL_74;
    }

LABEL_51:
    v50 = 0;
    goto LABEL_52;
  }

  if ([(PLManagedAsset *)self isPlaceholderAsset])
  {
    additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
    sourceAssetForDuplicationCPLScopedIdentifier3 = [additionalAttributes3 sourceAssetForDuplicationCPLScopedIdentifier];
    [assetCopy setResourceCopyFromScopedIdentifier:sourceAssetForDuplicationCPLScopedIdentifier3];

    if ([(PLManagedAsset *)self hasAdjustments])
    {
      selfCopy4 = self;
      allAssetCPLResources2 = [(PLManagedAsset *)self allAssetCPLResources];
      v90 = 0u;
      v91 = 0u;
      v92 = 0u;
      v93 = 0u;
      v19 = [allAssetCPLResources2 countByEnumeratingWithState:&v90 objects:v107 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v91;
        do
        {
          for (k = 0; k != v20; ++k)
          {
            if (*v91 != v21)
            {
              objc_enumerationMutation(allAssetCPLResources2);
            }

            v23 = *(*(&v90 + 1) + 8 * k);
            v24 = [v23 cplResourceIncludeFile:0];
            if (v24)
            {
              [v24 setSourceResourceType:{objc_msgSend(v23, "cplType")}];
              identity2 = [v24 identity];
              [identity2 setFileURL:0];

              [v24 setCanGenerateDerivative:0];
              [v14 addObject:v24];
            }
          }

          v20 = [allAssetCPLResources2 countByEnumeratingWithState:&v90 objects:v107 count:16];
        }

        while (v20);
      }

      v88[0] = MEMORY[0x1E69E9820];
      v88[1] = 3221225472;
      v88[2] = __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke_258;
      v88[3] = &unk_1E756D790;
      self = selfCopy4;
      v88[4] = selfCopy4;
      v26 = &v89;
      v89 = assetCopy;
      [(PLManagedAsset *)selfCopy4 synchronouslyFetchAdjustmentBlobWithCompletionHandler:v88];
      goto LABEL_76;
    }
  }

LABEL_77:
  [assetCopy setResources:v14];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v72 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v72, OS_LOG_TYPE_DEBUG))
    {
      orientation = [(PLManagedAsset *)self orientation];
      *buf = 67109120;
      LODWORD(v110) = orientation;
      _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_DEBUG, "Setting orientation %d to assetChange", buf, 8u);
    }
  }

  [assetCopy setOrientation:{-[PLManagedAsset orientation](self, "orientation")}];
  [(PLManagedAsset *)self duration];
  [assetCopy setDuration:llround(v74 * 1000.0)];
  [assetCopy setOriginalChoice:{-[PLManagedAsset originalResourceChoice](self, "originalResourceChoice")}];
  additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
  mediaMetadataType = [additionalAttributes4 mediaMetadataType];
  [assetCopy setAdjustedMediaMetaDataType:mediaMetadataType];

  additionalAttributes5 = [(PLManagedAsset *)self additionalAttributes];
  mediaMetadataData = [additionalAttributes5 mediaMetadataData];

  v79 = [mediaMetadataData length];
  if (v79 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
  {
    [assetCopy setAdjustedMediaMetaData:mediaMetadataData];
  }
}

void __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke(uint64_t a1, void *a2, int a3, void *a4, void *a5, uint64_t a6, unsigned int a7, void *a8)
{
  v64 = *MEMORY[0x1E69E9840];
  v15 = a2;
  v16 = a4;
  v17 = a5;
  v18 = a8;
  if (!v15)
  {
    [*(a1 + 56) setAdjustments:0];
    goto LABEL_41;
  }

  v19 = objc_alloc_init(MEMORY[0x1E6994A70]);
  [v19 setAdjustmentType:v16];
  [v19 setAdjustmentCompoundVersion:v17];
  [v19 setAdjustmentTimestamp:v18];
  [v19 setAdjustmentSourceType:a6 == 1];
  v20 = [*(a1 + 32) editorBundleID];
  [v19 setAdjustmentCreatorCode:v20];

  v55 = a3;
  if (a3)
  {
    v54 = a7;
    if (*(a1 + 64) == 1)
    {
      [*(a1 + 32) _removeAdjustmentDataResources];
    }

    v21 = [*(a1 + 32) pathForAdjustmentDataFile];
    v57 = 0;
    v22 = [(__CFString *)v21 stringByDeletingLastPathComponent];
    v23 = MEMORY[0x1E69BF238];
    v24 = [MEMORY[0x1E696AC08] defaultManager];
    LODWORD(v23) = [v23 createDirectoryAtPath:v22 error:&v57 usingFileManager:v24];

    v25 = v57;
    v26 = v25;
    if (v23)
    {
      v56 = v25;
      v27 = [v15 writeToFile:v21 options:1 error:&v56];
      v53 = v56;

      if (v27)
      {
        v28 = [*(a1 + 32) scopedIdentifier];
        v29 = *(a1 + 32);
        v30 = [*MEMORY[0x1E6982D60] identifier];
        v31 = objc_opt_class();
        v32 = v29;
        v33 = v28;
        v34 = [(PLManagedAsset *)v32 _createCPLResourceFromResourcePath:v21 withResourceType:13 uniformTypeIdentifier:v30 scopedIdentifier:v28 recordClass:v31 fingerprintScheme:*(a1 + 40)];

        if (v34)
        {
          v35 = [*(a1 + 32) storedResourceForCPLResource:v34 asset:*(a1 + 32) adjusted:1];
          [*(a1 + 48) addObject:v34];
          v36 = v33;
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v37 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT))
            {
              *buf = 138412290;
              v59 = v34;
              v38 = "Recreated the CPLResourceTypeAdjustmentData: %@";
              v39 = v37;
              v40 = OS_LOG_TYPE_DEFAULT;
LABEL_23:
              _os_log_impl(&dword_19BF1F000, v39, v40, v38, buf, 0xCu);
              goto LABEL_24;
            }

            goto LABEL_24;
          }
        }

        else
        {
          v36 = v33;
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v37 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              v59 = v36;
              v38 = "Unable to create CPL resource for adjustment data for asset %@";
              v39 = v37;
              v40 = OS_LOG_TYPE_ERROR;
              goto LABEL_23;
            }

LABEL_24:
          }
        }

        v26 = v53;
        goto LABEL_26;
      }

      if (*MEMORY[0x1E6994D48])
      {
        v26 = v53;
        goto LABEL_27;
      }

      v34 = __CPLAssetsdOSLogDomain();
      v26 = v53;
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_26;
      }

      *buf = 138412802;
      v59 = v15;
      v60 = 2112;
      v61 = v21;
      v62 = 2112;
      v63 = v53;
      v41 = "Failed to save adjustment data %@ to %@. Error: %@";
      v42 = v34;
      v43 = 32;
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_27:

        a7 = v54;
        goto LABEL_28;
      }

      v34 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
LABEL_26:

        goto LABEL_27;
      }

      *buf = 138412546;
      v59 = v21;
      v60 = 2112;
      v61 = v26;
      v41 = "Failed to create intermediate directory for %@. Error: %@";
      v42 = v34;
      v43 = 22;
    }

    _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, v41, buf, v43);
    goto LABEL_26;
  }

  [v19 setSimpleAdjustmentData:v15];
LABEL_28:
  v44 = [*(a1 + 32) additionalAttributes];
  v45 = [v44 unmanagedAdjustment];
  v46 = [v45 otherAdjustmentsFingerprint];

  if (!v46)
  {
    v46 = [*(a1 + 32) _calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources];
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v47 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
      {
        v48 = @"NO";
        if (v55)
        {
          v48 = @"YES";
        }

        *buf = 138412546;
        v59 = v46;
        v60 = 2112;
        v61 = v48;
        _os_log_impl(&dword_19BF1F000, v47, OS_LOG_TYPE_DEFAULT, "Calculating cloud adjustment fingerprint at push time: %@  (large? %@)", buf, 0x16u);
      }
    }

    v49 = [*(a1 + 32) additionalAttributes];
    v50 = [v49 unmanagedAdjustment];
    [v50 setOtherAdjustmentsFingerprint:v46];
  }

  [v19 setOtherAdjustmentsFingerprint:v46];
  [v19 setAdjustmentRenderTypes:a7];
  [*(a1 + 56) setAdjustments:v19];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v51 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_DEFAULT))
    {
      v52 = [v19 adjustmentSimpleDescription];
      *buf = 138412290;
      v59 = v52;
      _os_log_impl(&dword_19BF1F000, v51, OS_LOG_TYPE_DEFAULT, "CPLAdjustments: %@", buf, 0xCu);
    }
  }

LABEL_41:
}

void __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke_258(uint64_t a1, void *a2, uint64_t a3, void *a4, void *a5, uint64_t a6, unsigned int a7, void *a8)
{
  v20 = a2;
  v14 = a4;
  v15 = MEMORY[0x1E6994A70];
  v16 = a8;
  v17 = a5;
  v18 = objc_alloc_init(v15);
  if (v20)
  {
    [v18 setSimpleAdjustmentData:v20];
  }

  [v18 setAdjustmentType:v14];
  [v18 setAdjustmentCompoundVersion:v17];

  [v18 setAdjustmentSourceType:a6 == 1];
  v19 = [*(a1 + 32) editorBundleID];
  [v18 setAdjustmentCreatorCode:v19];

  [v18 setAdjustmentRenderTypes:a7];
  [v18 setAdjustmentTimestamp:v16];

  [*(a1 + 40) setAdjustments:v18];
}

- (id)_calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources
{
  v5 = 0;
  v6 = &v5;
  v7 = 0x3032000000;
  v8 = __Block_byref_object_copy__51017;
  v9 = __Block_byref_object_dispose__51018;
  v10 = 0;
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __93__PLManagedAsset_CPL___calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources__block_invoke;
  v4[3] = &unk_1E756D740;
  v4[4] = self;
  v4[5] = &v5;
  [(PLManagedAsset *)self synchronouslyFetchAdjustmentBlobWithCompletionHandler:v4];
  v2 = v6[5];
  _Block_object_dispose(&v5, 8);

  return v2;
}

void __93__PLManagedAsset_CPL___calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources__block_invoke(uint64_t a1, void *a2, int a3, void *a4, void *a5, uint64_t a6)
{
  v11 = a2;
  v12 = a4;
  v13 = a5;
  if (v11)
  {
    v14 = [*(a1 + 32) assetResourceForCPLType:15];
    v15 = [*(a1 + 32) assetResourceForCPLType:13];
    v16 = [v14 fingerprint];
    v17 = [v15 fingerprint];
    if (!a3 || v15)
    {
      v28 = objc_opt_class();
      v29 = a6;
      v19 = a3 == 0;
      if (a3)
      {
        v20 = 0;
      }

      else
      {
        v20 = v11;
      }

      v21 = v12;
      if (v19)
      {
        v22 = 0;
      }

      else
      {
        v22 = v17;
      }

      [*(a1 + 32) editorBundleID];
      v23 = v30 = v14;
      v24 = v22;
      v12 = v21;
      v25 = [v28 _cloudAdjustmentFingerprintWithAdjustmentDataBlob:v20 largeAdjustmentBlobFingerpint:v24 formatIdentifier:v21 formatVersion:v13 editorBundleID:v23 baseVersion:v29 baseImageData:0 baseImageFingerprint:v16];
      v26 = *(*(a1 + 40) + 8);
      v27 = *(v26 + 40);
      *(v26 + 40) = v25;

      v14 = v30;
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v18 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Attempting to calculate adjustment fingerprint from cloud resources which are missing", buf, 2u);
      }
    }
  }
}

- (void)synchronouslyFetchAdjustmentBlobWithCompletionHandler:(id)handler
{
  handlerCopy = handler;
  hasAdjustments = [(PLManagedAsset *)self hasAdjustments];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __77__PLManagedAsset_CPL__synchronouslyFetchAdjustmentBlobWithCompletionHandler___block_invoke;
  v7[3] = &unk_1E756D718;
  v9 = hasAdjustments;
  v7[4] = self;
  v8 = handlerCopy;
  v6 = handlerCopy;
  [(PLManagedAsset *)self synchronouslyFetchAdjustmentDataWithCompletionHandler:v7];
}

void __77__PLManagedAsset_CPL__synchronouslyFetchAdjustmentBlobWithCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4, uint64_t a5, void *a6, unsigned int a7, void *a8, void *a9)
{
  v39 = *MEMORY[0x1E69E9840];
  v13 = a2;
  v14 = a3;
  v15 = a8;
  v16 = a9;
  v17 = MEMORY[0x1E695DEF0];
  v18 = a6;
  v19 = [[v17 alloc] initWithContentsOfFile:v18];

  if (v19)
  {
    if ((*(a1 + 48) & 1) == 0)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v20 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = *(a1 + 32);
          *buf = 138412290;
          v38 = v21;
          _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_ERROR, "Asset %@ has adjustment data but no adjustment.", buf, 0xCu);
        }
      }

      [*(a1 + 32) _debugPrintAdjustmentState];
    }

    v22 = [MEMORY[0x1E696AE40] propertyListWithData:v19 options:0 format:0 error:0];
    v23 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
    if (v23)
    {
      if (v13)
      {
        goto LABEL_10;
      }
    }

    else
    {
      v31 = [*(a1 + 32) assetResourceForCPLType:13];
      v32 = v31;
      if (v31)
      {
        v23 = [v31 fileURL];

        if (v23)
        {
          v33 = objc_alloc(MEMORY[0x1E695DEF0]);
          v34 = [v32 fileURL];
          v23 = [v33 initWithContentsOfURL:v34];
        }
      }

      else
      {
        v23 = 0;
      }

      if (v13)
      {
LABEL_10:
        if (v14)
        {
          goto LABEL_11;
        }

        goto LABEL_33;
      }
    }

    v13 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
    if (v14)
    {
LABEL_11:
      if (v15)
      {
LABEL_12:
        v24 = [v23 length];
        v25 = v24 > [MEMORY[0x1E6994B60] maxInlineDataSize];

        goto LABEL_24;
      }

LABEL_34:
      v15 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF398]];
      goto LABEL_12;
    }

LABEL_33:
    v14 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
    if (v15)
    {
      goto LABEL_12;
    }

    goto LABEL_34;
  }

  v26 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v27 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_DEBUG, "AdjustmentsData path does not exist", buf, 2u);
    }
  }

  if (*(a1 + 48) == 1)
  {
    if ((*v26 & 1) == 0)
    {
      v28 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = *(a1 + 32);
        *buf = 138412290;
        v38 = v29;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Asset %@ has adjustment but no adjustmentsData.", buf, 0xCu);
      }
    }

    [*(a1 + 32) _debugPrintAdjustmentState];
  }

  v25 = 0;
  v23 = 0;
LABEL_24:
  v30 = *(a1 + 40);
  if (v30)
  {
    (*(v30 + 16))(v30, v23, v25, v13, v14, a5, a7, v15, v16);
  }
}

- (id)createResourcesForAssetInPhotoLibrary:(id)library shouldGenerateDerivatives:(BOOL)derivatives
{
  derivativesCopy = derivatives;
  v153 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  v136 = [MEMORY[0x1E695DF70] arrayWithCapacity:5];
  hasAdjustments = [(PLManagedAsset *)self hasAdjustments];
  scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  if (hasAdjustments)
  {
    fingerprintScheme = [(PLManagedAsset *)self fingerprintScheme];
    v8 = fingerprintScheme;
    if (fingerprintScheme)
    {
      invalidFingerprintScheme = fingerprintScheme;
    }

    else
    {
      invalidFingerprintScheme = [MEMORY[0x1E6994AE0] invalidFingerprintScheme];
    }

    v12 = invalidFingerprintScheme;

    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    pathManager = [managedObjectContext pathManager];
    v142 = 0;
    v125 = [pathManager photoDirectoryWithType:14 leafType:2 createIfNeeded:1 error:&v142];
    v132 = v142;

    if (v132 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        *&buf[4] = v132;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Unable to create directory for asset: %@", buf, 0xCu);
      }
    }

    pathForAdjustmentSecondaryDataFile = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
    if ([defaultManager fileExistsAtPath:pathForAdjustmentSecondaryDataFile])
    {
      identifier = [*MEMORY[0x1E6982D60] identifier];
      v17 = objc_opt_class();
      v18 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForAdjustmentSecondaryDataFile withResourceType:14 uniformTypeIdentifier:identifier scopedIdentifier:scopedIdentifier recordClass:v17 fingerprintScheme:v12];

      if (v18)
      {
        [v136 addObject:v18];
      }
    }

    uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
    penultimateImageResource = [(PLManagedAsset *)self penultimateImageResource];
    v131 = penultimateImageResource;
    if (penultimateImageResource)
    {
      uniformTypeIdentifier2 = [penultimateImageResource uniformTypeIdentifier];
      identifier2 = [uniformTypeIdentifier2 identifier];
    }

    else
    {
      identifier2 = uniformTypeIdentifier;
    }

    if ([(PLManagedAsset *)self isPhoto])
    {
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x3032000000;
      v150 = __Block_byref_object_copy__51017;
      v151 = __Block_byref_object_dispose__51018;
      v152 = 0;
      pathForFullsizeRenderImageFile = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
      isPartOfBurst = [(PLManagedAsset *)self isPartOfBurst];
      if (pathForFullsizeRenderImageFile)
      {
        v22 = isPartOfBurst;
      }

      else
      {
        v22 = 0;
      }

      if (v22 && ([defaultManager fileExistsAtPath:?] & 1) == 0)
      {
        v47 = MEMORY[0x1E696AEC0];
        identifier3 = [(PLManagedAsset *)scopedIdentifier identifier];
        v49 = [identifier3 stringByReplacingOccurrencesOfString:@"/" withString:@"_"];
        v50 = [v47 stringWithFormat:@"%@_render.JPG", v49];
        v51 = [v125 stringByAppendingPathComponent:v50];

        v23 = 1;
        pathForFullsizeRenderImageFile = v51;
      }

      else
      {
        v23 = 0;
      }

      v141[0] = MEMORY[0x1E69E9820];
      v141[1] = 3221225472;
      v141[2] = __87__PLManagedAsset_CPL__createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives___block_invoke;
      v141[3] = &unk_1E756D6D0;
      v141[4] = buf;
      [(PLManagedAsset *)self synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:pathForFullsizeRenderImageFile withCompletionHandler:v141];
      if (!*(*&buf[8] + 40) || ![defaultManager fileExistsAtPath:?])
      {
        if (*MEMORY[0x1E6994D48])
        {
LABEL_85:
          pathForPenultimateFullsizeRenderImageFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
          if ([defaultManager fileExistsAtPath:pathForPenultimateFullsizeRenderImageFile])
          {
            v79 = objc_opt_class();
            v80 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForPenultimateFullsizeRenderImageFile withResourceType:15 uniformTypeIdentifier:identifier2 scopedIdentifier:scopedIdentifier recordClass:v79 fingerprintScheme:v12];
            if (v80)
            {
              [v136 addObject:v80];
            }
          }

          if ([(PLManagedAsset *)self isPhotoIris])
          {
            pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
            if ([defaultManager fileExistsAtPath:pathForFullsizeRenderVideoFile])
            {
              pathExtension = [pathForFullsizeRenderVideoFile pathExtension];
              v83 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:pathExtension conformingToType:*MEMORY[0x1E6982EE8]];
              v84 = v83;
              v85 = *MEMORY[0x1E6982F80];
              if (v83)
              {
                v85 = v83;
              }

              v86 = v85;

              identifier4 = [v86 identifier];
              v88 = objc_opt_class();
              v89 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForFullsizeRenderVideoFile withResourceType:19 uniformTypeIdentifier:identifier4 scopedIdentifier:scopedIdentifier recordClass:v88 fingerprintScheme:v12];

              if (v89)
              {
                [v136 addObject:v89];
              }

              if (derivativesCopy)
              {
                v90 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForFullsizeRenderVideoFile isDirectory:0];
                v91 = [(PLManagedAsset *)self _generateVideoResourcesFromURL:v90 withScopedIdentifier:scopedIdentifier forMaster:0];

                [v136 addObjectsFromArray:v91];
              }
            }

            pathForPenultimateFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
            if ([defaultManager fileExistsAtPath:pathForPenultimateFullsizeRenderVideoFile])
            {
              pathExtension2 = [pathForPenultimateFullsizeRenderVideoFile pathExtension];
              v94 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:pathExtension2 conformingToType:*MEMORY[0x1E6982EE8]];
              v95 = v94;
              v96 = *MEMORY[0x1E6982F80];
              if (v94)
              {
                v96 = v94;
              }

              v97 = v96;

              identifier5 = [v97 identifier];
              v99 = objc_opt_class();
              v100 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForPenultimateFullsizeRenderVideoFile withResourceType:20 uniformTypeIdentifier:identifier5 scopedIdentifier:scopedIdentifier recordClass:v99 fingerprintScheme:v12];

              if (v100)
              {
                [v136 addObject:v100];
              }
            }
          }

          _Block_object_dispose(buf, 8);
          goto LABEL_140;
        }

        v55 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v55, OS_LOG_TYPE_ERROR))
        {
          v67 = *(*&buf[8] + 40);
          *v143 = 138412546;
          v144 = v67;
          v145 = 2112;
          selfCopy = self;
          _os_log_impl(&dword_19BF1F000, v55, OS_LOG_TYPE_ERROR, "Unable to find a full size render image at %@ to generate asset resources for asset %@", v143, 0x16u);
        }

LABEL_84:

        goto LABEL_85;
      }

      v52 = *(*&buf[8] + 40);
      v53 = objc_opt_class();
      v54 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v52 withResourceType:2 uniformTypeIdentifier:uniformTypeIdentifier scopedIdentifier:scopedIdentifier recordClass:v53 fingerprintScheme:v12];
      v55 = v54;
      if (!v54)
      {
LABEL_82:
        if (derivativesCopy)
        {
          v77 = [(PLManagedAsset *)self _createJPEGResourcesFromFullSizePath:*(*&buf[8] + 40) withScopedIdentifier:scopedIdentifier forMaster:0 fingerprintScheme:v12];
          [v136 addObjectsFromArray:v77];
        }

        goto LABEL_84;
      }

      [v54 setDeleteAfterUpload:v23];
      [v136 addObject:v55];
      v56 = [MEMORY[0x1E695DFF8] fileURLWithPath:*(*&buf[8] + 40)];
      v57 = [(PLManagedAsset *)self imageMediaMetadataForURL:v56];

      if (!v57)
      {
LABEL_81:

        goto LABEL_82;
      }

      v58 = [(PLManagedAsset *)v57 length];
      if (v58 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
      {
LABEL_80:
        additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
        [additionalAttributes setMediaMetadataData:v57];

        additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
        [additionalAttributes2 setMediaMetadataType:@"CGImageProperties"];

        goto LABEL_81;
      }

      pathForAdjustedMediaMetadataFile = [(PLManagedAsset *)self pathForAdjustedMediaMetadataFile];
      v140 = 0;
      v60 = _PLEnsureIntermediateDirectoriesExistForFilePath(pathForAdjustedMediaMetadataFile, &v140);
      v61 = v140;
      v62 = v61;
      if (!v60)
      {
        if (*MEMORY[0x1E6994D48])
        {
          v66 = 0;
          v124 = v61;
          goto LABEL_79;
        }

        v68 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
        {
          *v143 = 138412546;
          v144 = pathForAdjustedMediaMetadataFile;
          v145 = 2112;
          selfCopy = v62;
          _os_log_impl(&dword_19BF1F000, v68, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", v143, 0x16u);
        }

        v124 = v62;
        goto LABEL_77;
      }

      v139 = v61;
      v63 = [(PLManagedAsset *)v57 writeToFile:pathForAdjustedMediaMetadataFile options:1 error:&v139];
      v124 = v139;

      if (v63)
      {
        identifier6 = [*MEMORY[0x1E6982D60] identifier];
        v65 = objc_opt_class();
        v66 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForAdjustedMediaMetadataFile withResourceType:27 uniformTypeIdentifier:identifier6 scopedIdentifier:scopedIdentifier recordClass:v65 fingerprintScheme:v12];

        if (v66)
        {
          [v66 setDeleteAfterUpload:1];
          [v136 addObject:v66];
LABEL_79:

          goto LABEL_80;
        }

        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v68 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
          {
            *v143 = 138412290;
            v144 = scopedIdentifier;
            v69 = "Unable to create CPL resource for image properties data for asset %@";
            v70 = v68;
            v71 = 12;
            goto LABEL_76;
          }

          goto LABEL_77;
        }
      }

      else if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v68 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
        {
          *v143 = 138412802;
          v144 = v57;
          v145 = 2112;
          selfCopy = pathForAdjustedMediaMetadataFile;
          v147 = 2112;
          v148 = v124;
          v69 = "Failed to save image properties data %@ to %@. Error: %@";
          v70 = v68;
          v71 = 32;
LABEL_76:
          _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_ERROR, v69, v143, v71);
        }

LABEL_77:
      }

      v66 = 0;
      goto LABEL_79;
    }

    if (![(PLManagedAsset *)self isVideo])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v45 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
          kind = [(PLManagedAsset *)self kind];
          *buf = 67109120;
          *&buf[4] = kind;
          _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEFAULT, "Unsupported asset type %d", buf, 8u);
        }
      }

      goto LABEL_140;
    }

    pathForFullsizeRenderImageFile2 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
    if ([defaultManager fileExistsAtPath:pathForFullsizeRenderImageFile2])
    {
      identifier7 = [*MEMORY[0x1E6982E58] identifier];
      v25 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForFullsizeRenderImageFile2];
      v26 = CGImageSourceCreateWithURL(v25, 0);

      if (v26)
      {
        v27 = CGImageSourceGetType(v26);

        CFRelease(v26);
        identifier7 = v27;
      }

      v28 = objc_opt_class();
      v29 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForFullsizeRenderImageFile2 withResourceType:2 uniformTypeIdentifier:identifier7 scopedIdentifier:scopedIdentifier recordClass:v28 fingerprintScheme:v12];
      if (v29)
      {
        [v136 addObject:v29];
      }
    }

    pathForFullsizeRenderVideoFile2 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
    v30 = [defaultManager fileExistsAtPath:pathForFullsizeRenderVideoFile2];
    v31 = v30;
    if (!v30)
    {
LABEL_115:
      pathForPenultimateFullsizeRenderVideoFile2 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
      if ([defaultManager fileExistsAtPath:pathForPenultimateFullsizeRenderVideoFile2])
      {
        v104 = objc_opt_class();
        v105 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForPenultimateFullsizeRenderVideoFile2 withResourceType:25 uniformTypeIdentifier:uniformTypeIdentifier scopedIdentifier:scopedIdentifier recordClass:v104 fingerprintScheme:v12];
        if (v105)
        {
          [v136 addObject:v105];
        }
      }

      if (v31)
      {
        [MEMORY[0x1E695DFF8] fileURLWithPath:pathForFullsizeRenderVideoFile2 isDirectory:0];
      }

      else
      {
        [(PLManagedAsset *)self mainFileURL];
      }
      v106 = ;
      v107 = v106;
      if (!v106)
      {
        goto LABEL_139;
      }

      path = [v106 path];
      v109 = [defaultManager fileExistsAtPath:path];

      if (!v109)
      {
        goto LABEL_139;
      }

      if (derivativesCopy)
      {
        v110 = [(PLManagedAsset *)self _generatePosterFrameResourcesFromVideoURL:v107 withScopedIdentifier:scopedIdentifier forMaster:0 fingerprintScheme:v12];
        [v136 addObjectsFromArray:v110];
        v111 = [(PLManagedAsset *)self _generateVideoResourcesFromURL:v107 withScopedIdentifier:scopedIdentifier forMaster:0];
        [v136 addObjectsFromArray:v111];
      }

      else
      {
        if (![(PLManagedAsset *)self isDefaultAdjustedSlomo])
        {
LABEL_139:

LABEL_140:
          goto LABEL_141;
        }

        path2 = [v107 path];
        v113 = objc_opt_class();
        v110 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:path2 withResourceType:1000 uniformTypeIdentifier:uniformTypeIdentifier scopedIdentifier:scopedIdentifier recordClass:v113 fingerprintScheme:v12];

        if (v110)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v114 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v114, OS_LOG_TYPE_DEFAULT))
            {
              *buf = 138412290;
              *&buf[4] = v110;
              _os_log_impl(&dword_19BF1F000, v114, OS_LOG_TYPE_DEFAULT, "Adding adjustment original resource %@", buf, 0xCu);
            }
          }

          [v136 addObject:v110];
        }

        else
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v115 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v115, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              *&buf[4] = self;
              _os_log_impl(&dword_19BF1F000, v115, OS_LOG_TYPE_ERROR, "Failed to create adjustment original resource for %@", buf, 0xCu);
            }
          }

          v110 = 0;
        }
      }

      goto LABEL_139;
    }

    v32 = objc_opt_class();
    v33 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForFullsizeRenderVideoFile2 withResourceType:16 uniformTypeIdentifier:uniformTypeIdentifier scopedIdentifier:scopedIdentifier recordClass:v32 fingerprintScheme:v12];
    if (!v33)
    {
LABEL_114:

      goto LABEL_115;
    }

    [v136 addObject:v33];
    v34 = MEMORY[0x1E6988168];
    v35 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForFullsizeRenderVideoFile2];
    v122 = [v34 URLAssetWithURL:v35 options:0];

    if (!v122)
    {
LABEL_113:

      goto LABEL_114;
    }

    context = objc_autoreleasePoolPush();
    propertyListForProxy = [v122 propertyListForProxy];
    v121 = [MEMORY[0x1E696AE40] dataWithPropertyList:propertyListForProxy format:200 options:0 error:0];
    v36 = [v121 length];
    if (v36 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
LABEL_112:
      additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes3 setMediaMetadataData:v121];

      additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes4 setMediaMetadataType:@"AVAssetProxy"];

      objc_autoreleasePoolPop(context);
      goto LABEL_113;
    }

    pathForAdjustedMediaMetadataFile2 = [(PLManagedAsset *)self pathForAdjustedMediaMetadataFile];
    v138 = 0;
    v38 = _PLEnsureIntermediateDirectoriesExistForFilePath(pathForAdjustedMediaMetadataFile2, &v138);
    v39 = v138;
    v40 = v39;
    if (!v38)
    {
      if (*MEMORY[0x1E6994D48])
      {
        v118 = v39;
        goto LABEL_111;
      }

      v44 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        *&buf[4] = pathForAdjustedMediaMetadataFile2;
        *&buf[12] = 2112;
        *&buf[14] = v40;
        _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", buf, 0x16u);
      }

      v118 = v40;
      goto LABEL_110;
    }

    v137 = v39;
    v41 = [v121 writeToFile:pathForAdjustedMediaMetadataFile2 options:1 error:&v137];
    v118 = v137;

    if (v41)
    {
      identifier8 = [*MEMORY[0x1E6982D60] identifier];
      v43 = objc_opt_class();
      v44 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForAdjustedMediaMetadataFile2 withResourceType:27 uniformTypeIdentifier:identifier8 scopedIdentifier:scopedIdentifier recordClass:v43 fingerprintScheme:v12];

      if (v44)
      {
        [v44 setDeleteAfterUpload:1];
        [v136 addObject:v44];
LABEL_110:

        goto LABEL_111;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v44 = __CPLAssetsdOSLogDomain();
        if (!os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_110;
        }

        *buf = 138412290;
        *&buf[4] = scopedIdentifier;
        v72 = "Unable to create CPL resource for video properties data for asset %@";
        v73 = v44;
        v74 = 12;
        goto LABEL_109;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v44 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_110;
      }

      *buf = 138412802;
      *&buf[4] = v121;
      *&buf[12] = 2112;
      *&buf[14] = pathForAdjustedMediaMetadataFile2;
      *&buf[22] = 2112;
      v150 = v118;
      v72 = "Failed to save video properties data %@ to %@. Error: %@";
      v73 = v44;
      v74 = 32;
LABEL_109:
      _os_log_impl(&dword_19BF1F000, v73, OS_LOG_TYPE_ERROR, v72, buf, v74);
      goto LABEL_110;
    }

LABEL_111:

    goto LABEL_112;
  }

  additionalAttributes5 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes5 setMediaMetadataType:0];

  additionalAttributes6 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes6 setMediaMetadata:0];

  if (*MEMORY[0x1E6994D48])
  {
    goto LABEL_142;
  }

  v12 = __CPLAssetsdOSLogDomain();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
  {
    *buf = 138412290;
    *&buf[4] = self;
    _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Clear out resources for %@", buf, 0xCu);
  }

LABEL_141:

LABEL_142:
  if (createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_onceToken != -1)
  {
    dispatch_once(&createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_onceToken, &__block_literal_global_216);
  }

  v116 = [v136 filteredArrayUsingPredicate:createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_filterPredicate];
  [(PLManagedAsset *)self rm_createAssetResourcesForCPLResources:v116 inLibrary:libraryCopy];

  return v136;
}

void __87__PLManagedAsset_CPL__createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives___block_invoke_214()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithBlock:&__block_literal_global_219_51210];
  v1 = createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_filterPredicate;
  createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_filterPredicate = v0;
}

BOOL __87__PLManagedAsset_CPL__createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = [a2 resourceType];

  return [PLResourceInstaller isValidCPLResourceTypeForPersistence:v2];
}

- (id)imageMediaMetadataForURL:(id)l
{
  v21 = *MEMORY[0x1E69E9840];
  lCopy = l;
  objc_opt_class();
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  if (objc_opt_isKindOfClass())
  {
    v6 = managedObjectContext;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  v8 = MEMORY[0x1E69C08F0];
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  v10 = [v8 typeWithIdentifier:uniformTypeIdentifier];

  v11 = objc_alloc(MEMORY[0x1E69C0718]);
  pl_libraryBundle = [v7 pl_libraryBundle];
  timeZoneLookup = [pl_libraryBundle timeZoneLookup];
  v14 = [v11 initWithImageURL:lCopy contentType:v10 options:13 timeZoneLookup:timeZoneLookup cacheImageSource:1 cacheImageData:0];

  imageSourceProxyData = [v14 imageSourceProxyData];
  if (!imageSourceProxyData && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v16 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      pl_shortDescription = [(NSManagedObject *)self pl_shortDescription];
      v19 = 138412290;
      v20 = pl_shortDescription;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Failed to get image source proxy data for asset %@", &v19, 0xCu);
    }
  }

  return imageSourceProxyData;
}

- (BOOL)shouldIncludeInCPLCounts
{
  [MEMORY[0x1E69BF328] maskForIncludeInCPLCounts];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (id)bestAvailableAdjustedResource
{
  v19 = *MEMORY[0x1E69E9840];
  if (bestAvailableAdjustedResource_onceToken != -1)
  {
    dispatch_once(&bestAvailableAdjustedResource_onceToken, &__block_literal_global_148);
  }

  if ([(PLManagedAsset *)self isPhoto])
  {
    isLoopingVideo = [(PLManagedAsset *)self isLoopingVideo];
    v4 = &bestAvailableAdjustedResource_photoResourceTypePriority;
    if (isLoopingVideo)
    {
      v4 = &bestAvailableAdjustedResource_loopingPhotoResourceTypePriority;
    }
  }

  else
  {
    if (![(PLManagedAsset *)self isVideo])
    {
LABEL_19:
      v6 = 0;
      v12 = 0;
      goto LABEL_22;
    }

    v4 = &bestAvailableAdjustedResource_videoResourceTypePriority;
  }

  v5 = *v4;
  if (!v5)
  {
    goto LABEL_19;
  }

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v6 = v5;
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = -[PLManagedAsset assetResourceForCPLType:](self, "assetResourceForCPLType:", [*(*(&v14 + 1) + 8 * i) intValue]);
        if (v11)
        {
          v12 = v11;
          goto LABEL_21;
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  v12 = 0;
LABEL_21:

LABEL_22:

  return v12;
}

void __52__PLManagedAsset_CPL__bestAvailableAdjustedResource__block_invoke()
{
  v0 = bestAvailableAdjustedResource_photoResourceTypePriority;
  bestAvailableAdjustedResource_photoResourceTypePriority = &unk_1F0FBFBF8;

  v1 = bestAvailableAdjustedResource_loopingPhotoResourceTypePriority;
  bestAvailableAdjustedResource_loopingPhotoResourceTypePriority = &unk_1F0FBFC10;

  v2 = [MEMORY[0x1E69C0700] currentDeviceIsEligibleForHDRPlayback];
  v3 = &unk_1F0FBFC40;
  v4 = bestAvailableAdjustedResource_videoResourceTypePriority;
  if (v2)
  {
    v3 = &unk_1F0FBFC28;
  }

  bestAvailableAdjustedResource_videoResourceTypePriority = v3;
}

- (void)invalidateThumbnailIfNeededAfterMasterResourceChangeInLibrary:(id)library
{
  v16 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  if (![(PLManagedAsset *)self hasAdjustments])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v5 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
      {
        uuid = [(PLManagedAsset *)self uuid];
        cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
        v12 = 138412546;
        v13 = uuid;
        v14 = 2112;
        v15 = cloudAssetGUID;
        _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "Detecting a master resource change on an unadjusted asset, invalidate the thumbnail for this asset with uuid: %@ guid: %@", &v12, 0x16u);
      }
    }

    thumbnailManager = [libraryCopy thumbnailManager];
    thumbnailIdentifier = [(PLManagedAsset *)self thumbnailIdentifier];
    effectiveThumbnailIndex = [(PLManagedAsset *)self effectiveThumbnailIndex];
    uuid2 = [(PLManagedAsset *)self uuid];
    [thumbnailManager deleteThumbnailsWithIdentifier:thumbnailIdentifier orIndex:effectiveThumbnailIndex uuid:uuid2];

    [(PLManagedAsset *)self setEffectiveThumbnailIndex:0x7FFFFFFFFFFFFFFFLL];
  }
}

- (void)_applySharingChangeToCPLAssetChange:(id)change inLibrary:(id)library
{
  v28 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  libraryScopeShareState = [(PLManagedAsset *)self libraryScopeShareState];
  if ((libraryScopeShareState & 0x800000) != 0 && [(PLManagedAsset *)self hasLibraryScope])
  {
    libraryScope = [(PLManagedAsset *)self libraryScope];
    scopeIdentifier = [libraryScope scopeIdentifier];
    [changeCopy setSharingScopeIdentifier:scopeIdentifier];

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        libraryScope2 = [(PLManagedAsset *)self libraryScope];
        scopeIdentifier2 = [libraryScope2 scopeIdentifier];
        v24 = 138543618;
        v25 = scopeIdentifier2;
        v26 = 2114;
        v27 = changeCopy;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Setting libraryScopeIdentifier %{public}@ on CPLAssetChange %{public}@", &v24, 0x16u);
      }
    }
  }

  else
  {
    [changeCopy setSharingScopeIdentifier:0];
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v12 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
      {
        v24 = 138543362;
        v25 = changeCopy;
        _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Setting nil libraryScopeIdentifier on CPLAssetChange %{public}@", &v24, 0xCu);
      }
    }

    if ((libraryScopeShareState & 0x800000) == 0)
    {
      goto LABEL_14;
    }
  }

  libraryScopeContributors = [(PLManagedAsset *)self libraryScopeContributors];
  v14 = [libraryScopeContributors count];

  if (v14)
  {
    libraryScopeContributors2 = [(PLManagedAsset *)self libraryScopeContributors];
    v16 = [libraryScopeContributors2 _pl_map:&__block_literal_global_131_51227];
    allObjects = [v16 allObjects];
    [changeCopy setSharingContributorUserIdentifiers:allObjects];

    goto LABEL_15;
  }

LABEL_14:
  [changeCopy setSharingContributorUserIdentifiers:0];
LABEL_15:
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  libraryScopeAssetContributorsToUpdate = [additionalAttributes libraryScopeAssetContributorsToUpdate];
  v20 = [libraryScopeAssetContributorsToUpdate count];

  if (v20)
  {
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    libraryScopeAssetContributorsToUpdate2 = [additionalAttributes2 libraryScopeAssetContributorsToUpdate];
    allObjects2 = [libraryScopeAssetContributorsToUpdate2 allObjects];
    [changeCopy setUpdateSharingContributorUserIdentifiers:allObjects2];
  }
}

- (void)_applyPropertiesChangeToCPLAssetChange:(id)change withMasterScopedIdentifier:(id)identifier computeSyncUploadEnabled:(BOOL)enabled inLibrary:(id)library
{
  enabledCopy = enabled;
  v79 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  libraryCopy = library;
  identifier = [identifier identifier];
  [changeCopy setMasterIdentifier:identifier];

  [changeCopy setFavorite:{-[PLManagedAsset isFavorite](self, "isFavorite")}];
  [(PLManagedAsset *)self _updateBurstFlagsForCPLAssetChange:changeCopy photoLibrary:libraryCopy];
  lastSharedDate = [(PLManagedAsset *)self lastSharedDate];
  [changeCopy setLastSharedDate:lastSharedDate];

  addedDate = [(PLManagedAsset *)self addedDate];
  [changeCopy setAddedDate:addedDate];

  dateCreated = [(PLManagedAsset *)self dateCreated];

  if (!dateCreated)
  {
    date = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setDateCreated:date];
  }

  dateCreated2 = [(PLManagedAsset *)self dateCreated];
  [changeCopy setAssetDate:dateCreated2];

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  timeZoneName = [additionalAttributes timeZoneName];
  if (timeZoneName)
  {
    [changeCopy setTimeZoneName:timeZoneName];
  }

  timeZoneOffset = [additionalAttributes timeZoneOffset];
  if (timeZoneOffset)
  {
    [changeCopy setTimeZoneOffset:timeZoneOffset];
  }

  location = [(PLManagedAsset *)self location];
  [changeCopy setLocation:location];

  v22 = objc_opt_class();
  placeAnnotationData = [additionalAttributes placeAnnotationData];
  v24 = [v22 _placeAnnotationFromAnnotationData:placeAnnotationData];

  [changeCopy setPlaceAnnotation:v24];
  v25 = [PLKeywordManager keywordsForAsset:self];
  allObjects = [v25 allObjects];
  v27 = [allObjects sortedArrayWithOptions:1 usingComparator:&__block_literal_global_51230];
  v65 = allObjects;
  [changeCopy setKeywords:allObjects];
  [changeCopy setHidden:{-[PLManagedAsset hidden](self, "hidden")}];
  title = [(PLManagedAsset *)self title];
  [changeCopy setCaption:title];

  longDescription = [(PLManagedAsset *)self longDescription];
  [changeCopy setExtendedDescription:longDescription];

  accessibilityDescription = [(PLManagedAsset *)self accessibilityDescription];
  [changeCopy setAccessibilityDescription:accessibilityDescription];

  [(PLManagedAsset *)self _updateAssetSubtypeForCPLAssetChange:changeCopy];
  [changeCopy setAssetHDRType:{+[PLManagedAsset CPLAssetHDRTypeFromPLAssetHDRType:](PLManagedAsset, "CPLAssetHDRTypeFromPLAssetHDRType:", -[PLManagedAsset hdrType](self, "hdrType"))}];
  if ([(PLManagedAsset *)self isPhoto])
  {
    [changeCopy setCustomRenderedValue:{-[PLManagedAsset hdrType](self, "hdrType")}];
  }

  trashedState = [(PLManagedAsset *)self trashedState];
  v72 = libraryCopy;
  v71 = enabledCopy;
  v68 = timeZoneOffset;
  v69 = timeZoneName;
  v66 = v25;
  v67 = v24;
  v32 = trashedState == 2 || [(PLManagedAsset *)self trashedState]== 1;
  [changeCopy setInTrash:v32];
  [changeCopy setInExpunged:trashedState == 2];
  trashedDate = [(PLManagedAsset *)self trashedDate];
  [changeCopy setDateDeleted:trashedDate];

  v73 = changeCopy;
  [changeCopy setTrashedReason:{-[PLManagedAsset trashedReason](self, "trashedReason")}];
  v70 = additionalAttributes;
  personReferences = [additionalAttributes personReferences];
  v35 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(personReferences, "count")}];
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v77 = 0u;
  v36 = personReferences;
  v37 = [v36 countByEnumeratingWithState:&v74 objects:v78 count:16];
  if (v37)
  {
    v38 = v37;
    v39 = *v75;
    do
    {
      for (i = 0; i != v38; ++i)
      {
        if (*v75 != v39)
        {
          objc_enumerationMutation(v36);
        }

        v41 = *(*(&v74 + 1) + 8 * i);
        v42 = objc_alloc_init(MEMORY[0x1E6994B40]);
        personUUID = [v41 personUUID];
        [v42 setPersonIdentifier:personUUID];

        personData = [v41 personData];
        if (personData)
        {
          v45 = [MEMORY[0x1E696AE40] propertyListWithData:personData options:0 format:0 error:0];
          [v42 setExtraProperties:v45];
        }

        [v35 addObject:v42];
      }

      v38 = [v36 countByEnumeratingWithState:&v74 objects:v78 count:16];
    }

    while (v38);
  }

  [v73 setPeople:v35];
  [v73 setPlayCount:{objc_msgSend(v70, "playCount")}];
  [v73 setShareCount:{objc_msgSend(v70, "shareCount")}];
  [v73 setViewCount:{objc_msgSend(v70, "viewCount")}];
  if ([MEMORY[0x1E6994A80] serverSupportsLastViewedDate])
  {
    lastViewedDate = [v70 lastViewedDate];
    [v73 setLastViewedDate:lastViewedDate];
  }

  mediaGroupUUID = [(PLManagedAsset *)self mediaGroupUUID];
  [v73 setMediaGroupIdentifier:mediaGroupUUID];
  [(PLManagedAsset *)self photoIrisVideoDuration];
  [(PLManagedAsset *)self photoIrisStillDisplayTime];
  [v73 setVideoComplementDurationValue:0];
  [v73 setVideoComplementDurationTimescale:0];
  [v73 setVideoComplementImageDisplayValue:0];
  [v73 setVideoComplementImageDisplayTimescale:0];
  [v73 setVideoComplementVisibilityState:{-[PLManagedAsset videoCpVisibilityState](self, "videoCpVisibilityState")}];
  syndicationIdentifier = [v70 syndicationIdentifier];
  [v73 setSyndicationIdentifier:syndicationIdentifier];

  collectionShare = [(PLManagedAsset *)self collectionShare];
  if (collectionShare)
  {
    v50 = collectionShare;
    collectionShareContributor = [(PLManagedAsset *)self collectionShareContributor];

    if (collectionShareContributor)
    {
      collectionShareContributor2 = [(PLManagedAsset *)self collectionShareContributor];
      userIdentifier = [collectionShareContributor2 userIdentifier];
      [v73 setContributorUserIdentifier:userIdentifier];
    }
  }

  [(PLManagedAsset *)self _updateViewPresentationForCPLAssetChange:v73];
  if ((_os_feature_enabled_impl() & 1) == 0)
  {
    [v73 setSharedLibrarySharingState:{PLLibraryScopeAssetGetSyncableSharingStateValueFromLocalShareStateValue(-[PLManagedAsset libraryScopeShareState](self, "libraryScopeShareState"))}];
    if ([MEMORY[0x1E6994A80] serverSupportsDeletedByUserIdentifier])
    {
      trashedByParticipant = [(PLManagedAsset *)self trashedByParticipant];
      userIdentifier2 = [trashedByParticipant userIdentifier];

      if (userIdentifier2)
      {
        trashedByParticipant2 = [(PLManagedAsset *)self trashedByParticipant];
        userIdentifier3 = [trashedByParticipant2 userIdentifier];
        [v73 setDeletedByUserIdentifier:userIdentifier3];
      }
    }
  }

  if (v71)
  {
    computeSyncAttributes = [(PLManagedAsset *)self computeSyncAttributes];

    if (computeSyncAttributes)
    {
      computeSyncAttributes2 = [(PLManagedAsset *)self computeSyncAttributes];
      cloudComputeStateVersion = [computeSyncAttributes2 cloudComputeStateVersion];
      [v73 setComputeStateVersion:cloudComputeStateVersion];

      computeSyncAttributes3 = [(PLManagedAsset *)self computeSyncAttributes];
      cloudComputeStateAdjustmentFingerprint = [computeSyncAttributes3 cloudComputeStateAdjustmentFingerprint];
      [v73 setComputeStateAdjustmentFingerprint:cloudComputeStateAdjustmentFingerprint];

      computeSyncAttributes4 = [(PLManagedAsset *)self computeSyncAttributes];
      cloudComputeStateLastUpdatedDate = [computeSyncAttributes4 cloudComputeStateLastUpdatedDate];
      [v73 setComputeStateLastUpdatedDate:cloudComputeStateLastUpdatedDate];
    }
  }
}

- (id)fingerprintScheme
{
  master = [(PLManagedAsset *)self master];
  fingerprintScheme = [master fingerprintScheme];

  return fingerprintScheme;
}

- (id)fingerprintContext
{
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  fingerprintContext = [photoLibrary fingerprintContext];
  v4 = fingerprintContext;
  if (fingerprintContext)
  {
    mEMORY[0x1E6994AD8] = fingerprintContext;
  }

  else
  {
    mEMORY[0x1E6994AD8] = [MEMORY[0x1E6994AD8] sharedContext];
  }

  v6 = mEMORY[0x1E6994AD8];

  return v6;
}

- (id)scopedIdentifier
{
  selfCopy = self;
  v18 = *MEMORY[0x1E69E9840];
  cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
  if (cloudAssetGUID)
  {
    goto LABEL_4;
  }

  uuid = [(PLManagedAsset *)selfCopy uuid];
  if (uuid)
  {
    cloudAssetGUID = uuid;
    [(PLManagedAsset *)selfCopy setCloudAssetGUID:uuid];
LABEL_4:
    scopeIdentifier = [(PLManagedAsset *)selfCopy scopeIdentifier];
    selfCopy = [objc_alloc(MEMORY[0x1E6994BB8]) initWithScopeIdentifier:scopeIdentifier identifier:cloudAssetGUID];

    goto LABEL_5;
  }

  if (selfCopy)
  {
    v7 = MEMORY[0x1E696AEC0];
    objectID = [(PLManagedAsset *)selfCopy objectID];
    isDeleted = [(PLManagedAsset *)selfCopy isDeleted];
    v10 = @"NO";
    if (isDeleted)
    {
      v10 = @"YES";
    }

    v11 = v10;
    syncDescription = [(PLManagedAsset *)selfCopy syncDescription];
    callStackSymbols = [MEMORY[0x1E696AF00] callStackSymbols];
    v14 = [v7 stringWithFormat:@"Found asset with nil scope identifier %@ (isDeleted=%@) %@.\n\nSee rdar://problem/40112514\n\nBacktrace:\n%@", objectID, v11, syncDescription, callStackSymbols];

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138543362;
        v17 = v14;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "%{public}@", buf, 0xCu);
      }
    }

    [PLDiagnostics fileRadarUserNotificationWithHeader:@"Unexpected Photo Library state" message:@"Please file a Radar against Photos" radarTitle:@"TTR: asset with nil scope identifier" radarDescription:v14];

    selfCopy = 0;
  }

LABEL_5:

  return selfCopy;
}

- (id)scopeIdentifier
{
  shareRelationship = [(PLManagedAsset *)self shareRelationship];
  v4 = shareRelationship;
  if (shareRelationship)
  {
    scopeIdentifier = [shareRelationship scopeIdentifier];
  }

  else
  {
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    scopeIdentifier = [photoLibrary mainScopeIdentifier];
  }

  return scopeIdentifier;
}

- (id)cplMasterChangeInLibrary:(id)library shouldGenerateDerivatives:(BOOL)derivatives
{
  derivativesCopy = derivatives;
  v47 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  v7 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v8 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      selfCopy2 = self;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEBUG, "CPLMasterChange for %@", buf, 0xCu);
    }
  }

  master = [(PLManagedAsset *)self master];
  if (master || ([(PLManagedAsset *)self createMasterIfNecessaryInLibrary:libraryCopy], [(PLManagedAsset *)self master], (master = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v10 = master;
    v40 = derivativesCopy;
    v11 = [(PLManagedAsset *)self masterResourceForCPLType:1];
    v41 = [(PLManagedAsset *)self masterResourceForCPLType:18];
    v12 = [(PLManagedAsset *)self masterResourceForCPLType:5];
    v13 = [(PLManagedAsset *)self masterResourceForCPLType:17];
    v14 = [(PLManagedAsset *)self masterResourceForCPLType:23];
    v15 = [(PLManagedAsset *)self masterResourceForCPLType:24];
    v16 = v14 && ![v14 cloudLocalState] || v15 && !objc_msgSend(v15, "cloudLocalState");
    v42 = v13;
    if (!v11)
    {
      if (*v7)
      {
        v31 = 0;
        goto LABEL_57;
      }

      v19 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        [(PLManagedAsset *)self uuid];
        v20 = v12;
        v22 = v21 = libraryCopy;
        *buf = 138412546;
        selfCopy2 = v10;
        v45 = 2112;
        v46 = v22;
        _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Can't find original resource in master %@ for asset %@", buf, 0x16u);

        libraryCopy = v21;
        v12 = v20;
      }

      goto LABEL_55;
    }

    isLocallyAvailable = [v11 isLocallyAvailable];
    v39 = v12;
    if (v12)
    {
      v18 = [v12 cloudLocalState] == 0;
    }

    else
    {
      v18 = 1;
    }

    v23 = isLocallyAvailable & v18;
    if (!-[PLManagedAsset isPhotoIris](self, "isPhotoIris") || v41 && [v41 cloudLocalState] || (objc_msgSend(MEMORY[0x1E696AC08], "defaultManager"), v24 = objc_claimAutoreleasedReturnValue(), -[PLManagedAsset pathForVideoComplementFile](self, "pathForVideoComplementFile"), v38 = libraryCopy, v25 = objc_claimAutoreleasedReturnValue(), v26 = objc_msgSend(v24, "fileExistsAtPath:", v25), v25, libraryCopy = v38, v24, !v26))
    {
      if (!v42 || [v42 cloudLocalState] || !objc_msgSend(v42, "isLocallyAvailable"))
      {
LABEL_35:
        if (v23)
        {
          v19 = [(PLManagedAsset *)self createResourcesForMaster:v10 shouldGenerateDerivatives:v40 inPhotoLibrary:libraryCopy];
          v12 = v39;
          if ([v19 count])
          {
            v31 = [(PLManagedAsset *)v10 cplMasterPropertyChangeForAsset:self];
            [(PLManagedAsset *)v31 setResources:v19];
            v7 = MEMORY[0x1E6994D48];
LABEL_56:

LABEL_57:
            goto LABEL_58;
          }

          v7 = MEMORY[0x1E6994D48];
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v35 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              selfCopy2 = 0;
              _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_ERROR, "Unable to generate any resources for masterChange %@. Skipping upload", buf, 0xCu);
            }
          }

LABEL_55:
          v31 = 0;
          goto LABEL_56;
        }

        v31 = [(PLManagedAsset *)v10 cplMasterPropertyChangeForAsset:self];
        v19 = [(PLManagedAsset *)self rm_cplMasterResourcesFromCloudMaster:v10 addOriginalResourceMode:v16];
        [(PLManagedAsset *)v31 setResources:v19];
        isPlaceholderAsset = [(PLManagedAsset *)self isPlaceholderAsset];
        v7 = MEMORY[0x1E6994D48];
        v12 = v39;
        if (isPlaceholderAsset)
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_56;
          }

          v33 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412546;
            selfCopy2 = v31;
            v45 = 2112;
            v46 = v10;
            v34 = "Created CPLMaster %@ from placeholder master %@ for server side copy";
LABEL_49:
            _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_DEFAULT, v34, buf, 0x16u);
          }
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_56;
          }

          v33 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412546;
            selfCopy2 = v31;
            v45 = 2112;
            v46 = v10;
            v34 = "Created optimistic CPLMaster %@ from %@, assuming reset sync";
            goto LABEL_49;
          }
        }

        goto LABEL_56;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v27 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
        {
          [(PLManagedAsset *)self uuid];
          v30 = v29 = libraryCopy;
          *buf = 138412290;
          selfCopy2 = v30;
          _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_DEFAULT, "Asset %@ now has original alternate resource, will include it now", buf, 0xCu);

          libraryCopy = v29;
        }

        goto LABEL_33;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v27 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 138412290;
        selfCopy2 = uuid;
        _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_DEFAULT, "Asset %@ now has video complement resource, will include it now", buf, 0xCu);

        libraryCopy = v38;
      }

LABEL_33:
    }

    v16 = 1;
    goto LABEL_35;
  }

  if (*v7)
  {
    v31 = 0;
    v10 = 0;
    goto LABEL_62;
  }

  v11 = __CPLAssetsdOSLogDomain();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    selfCopy2 = self;
    _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "Asset %@ doesn't have a master.", buf, 0xCu);
  }

  v10 = 0;
  v31 = 0;
LABEL_58:

  if ((*v7 & 1) == 0)
  {
    v36 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      selfCopy2 = v31;
      _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_DEBUG, "CPLMasterChange %@", buf, 0xCu);
    }
  }

LABEL_62:

  return v31;
}

- (id)createResourcesForMaster:(id)master shouldGenerateDerivatives:(BOOL)derivatives inPhotoLibrary:(id)library
{
  derivativesCopy = derivatives;
  v184 = *MEMORY[0x1E69E9840];
  masterCopy = master;
  libraryCopy = library;
  v141 = [MEMORY[0x1E695DF70] arrayWithCapacity:5];
  v139 = [(PLManagedAsset *)self rm_cplMasterResourceForResourceType:1];
  if (!v139)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        *&buf[4] = masterCopy;
        _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_ERROR, "Unable to find original resource from master %@", buf, 0xCu);
      }
    }

    goto LABEL_168;
  }

  [v141 addObject:v139];
  selfCopy2 = self;
  if (![(PLManagedAsset *)self isPhoto])
  {
    if (![(PLManagedAsset *)self isVideo])
    {
      goto LABEL_167;
    }

    v151 = masterCopy;
    log = v141;
    if (!self)
    {
LABEL_165:

      goto LABEL_166;
    }

    mainFileURL = [(PLManagedAsset *)self mainFileURL];
    obj = [MEMORY[0x1E696AC08] defaultManager];
    scopedIdentifier = [v151 scopedIdentifier];
    fingerprintScheme = [v151 fingerprintScheme];
    if (mainFileURL)
    {
      path = [mainFileURL path];
      v23 = [obj fileExistsAtPath:path];

      if (v23)
      {
        if (derivativesCopy)
        {
          v24 = [(PLManagedAsset *)self _generatePosterFrameResourcesFromVideoURL:mainFileURL withScopedIdentifier:scopedIdentifier forMaster:1 fingerprintScheme:fingerprintScheme];
          [log addObjectsFromArray:v24];
          if (![(PLManagedAsset *)self isDefaultAdjustedSlomo])
          {
            v25 = [(PLManagedAsset *)self _generateVideoResourcesFromURL:mainFileURL withScopedIdentifier:scopedIdentifier forMaster:1];
            [log addObjectsFromArray:v25];
          }
        }
      }
    }

    [(PLManagedAsset *)self allMasterCPLResources];
    v175 = 0u;
    v176 = 0u;
    v26 = memset(v174, 0, sizeof(v174));
    v27 = [v26 countByEnumeratingWithState:v174 objects:buf count:16];
    if (v27)
    {
      v28 = **&v174[16];
      do
      {
        for (i = 0; i != v27; ++i)
        {
          if (**&v174[16] != v28)
          {
            objc_enumerationMutation(v26);
          }

          v30 = *(*&v174[8] + 8 * i);
          cplType = [v30 cplType];
          if ((cplType & 0xFFFFFFFFFFFFFFFELL) == 0x16)
          {
            v32 = objc_opt_class();
            fileURL = [v30 fileURL];
            *&v164 = 0;
            LOBYTE(v32) = [(PLManagedAsset *)self setFingerprintAndStableHashOnInternalResource:v30 recordClass:v32 resourceType:cplType resourceFileURL:fileURL fingerprintScheme:fingerprintScheme error:&v164];
            v34 = v164;

            if ((v32 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v35 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
              {
                fileURL2 = [v30 fileURL];
                path2 = [fileURL2 path];
                scopedIdentifier2 = [(PLManagedAsset *)self scopedIdentifier];
                *v177 = 138412802;
                *&v177[4] = path2;
                *&v177[12] = 2112;
                *&v177[14] = scopedIdentifier2;
                *&v177[22] = 2112;
                *&v177[24] = v34;
                _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_ERROR, "Failed to generate fingerprint for path %@ uuid %@. Error: %@", v177, 0x20u);
              }
            }

            v39 = [v30 cplResourceIncludeFile:1];
            if (v39)
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v40 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v40, OS_LOG_TYPE_DEBUG))
                {
                  *v177 = 138412290;
                  *&v177[4] = v39;
                  _os_log_impl(&dword_19BF1F000, v40, OS_LOG_TYPE_DEBUG, "Created original adjustment master resource %@", v177, 0xCu);
                }
              }

              [log addObject:v39];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v41 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
              {
                scopedIdentifier3 = [(PLManagedAsset *)self scopedIdentifier];
                *v177 = 138412290;
                *&v177[4] = scopedIdentifier3;
                _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_ERROR, "Unable to create original adjustment CPLResource with itemIdentifier %@", v177, 0xCu);
              }
            }
          }
        }

        v27 = [v26 countByEnumeratingWithState:v174 objects:buf count:16];
      }

      while (v27);
    }

    v43 = [MEMORY[0x1E6988168] URLAssetWithURL:mainFileURL options:0];
    if (!v43)
    {
LABEL_164:

      goto LABEL_165;
    }

    v44 = objc_autoreleasePoolPush();
    propertyListForProxy = [v43 propertyListForProxy];
    v46 = [MEMORY[0x1E696AE40] dataWithPropertyList:propertyListForProxy format:200 options:0 error:0];
    v47 = [v46 length];
    if (v47 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
LABEL_163:
      mediaMetadata = [v151 mediaMetadata];
      [mediaMetadata setValue:v46 forKey:@"data"];

      [v151 setMediaMetadataType:@"AVAssetProxy"];
      objc_autoreleasePoolPop(v44);
      goto LABEL_164;
    }

    pathForMediaMetadataFile = [(PLManagedAsset *)self pathForMediaMetadataFile];
    v169[0] = 0;
    stringByDeletingLastPathComponent = [pathForMediaMetadataFile stringByDeletingLastPathComponent];
    v50 = MEMORY[0x1E69BF238];
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    LODWORD(v50) = [v50 createDirectoryAtPath:stringByDeletingLastPathComponent error:v169 usingFileManager:defaultManager];

    v52 = v169[0];
    v53 = v52;
    if (!v50)
    {
      if (*MEMORY[0x1E6994D48])
      {
        v55 = v52;
        goto LABEL_162;
      }

      v58 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        *v177 = 138412546;
        *&v177[4] = pathForMediaMetadataFile;
        *&v177[12] = 2112;
        *&v177[14] = v53;
        _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", v177, 0x16u);
      }

      v55 = v53;
      goto LABEL_161;
    }

    v173 = v52;
    v54 = [v46 writeToFile:pathForMediaMetadataFile options:1 error:&v173];
    v55 = v173;

    if (v54)
    {
      identifier = [*MEMORY[0x1E6982D60] identifier];
      v57 = objc_opt_class();
      v58 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForMediaMetadataFile withResourceType:10 uniformTypeIdentifier:identifier scopedIdentifier:scopedIdentifier recordClass:v57 fingerprintScheme:fingerprintScheme];

      if (v58)
      {
        [v58 setDeleteAfterUpload:1];
        [log addObject:v58];
LABEL_161:

        goto LABEL_162;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v58 = __CPLAssetsdOSLogDomain();
        if (!os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_161;
        }

        *v177 = 138412290;
        *&v177[4] = scopedIdentifier;
        v126 = "Unable to create CPL resource for video properties data for asset %@";
        v127 = v58;
        v128 = 12;
        goto LABEL_160;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v58 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_161;
      }

      *v177 = 138412802;
      *&v177[4] = v46;
      *&v177[12] = 2112;
      *&v177[14] = pathForMediaMetadataFile;
      *&v177[22] = 2112;
      *&v177[24] = v55;
      v126 = "Failed to save video properties data %@ to %@. Error: %@";
      v127 = v58;
      v128 = 32;
LABEL_160:
      _os_log_impl(&dword_19BF1F000, v127, OS_LOG_TYPE_ERROR, v126, v177, v128);
      goto LABEL_161;
    }

LABEL_162:

    goto LABEL_163;
  }

  v143 = masterCopy;
  v136 = v139;
  v145 = v141;
  v132 = libraryCopy;
  if (!self)
  {
    goto LABEL_156;
  }

  scopedIdentifier4 = [v143 scopedIdentifier];
  mainFileURL2 = [(PLManagedAsset *)self mainFileURL];
  identity = [v136 identity];
  fileUTI = [identity fileUTI];
  [identity imageDimensions];
  [v143 setFullSizeJPEGSource:{+[PLCloudMaster fullSizeJPEGSourceForUTI:andImageDimensions:](PLCloudMaster, "fullSizeJPEGSourceForUTI:andImageDimensions:", fileUTI)}];

  fingerprintScheme2 = [v143 fingerprintScheme];
  defaultManager2 = [MEMORY[0x1E696AC08] defaultManager];
  if (!derivativesCopy)
  {
    goto LABEL_82;
  }

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v181 = __Block_byref_object_copy__51017;
  v182 = __Block_byref_object_dispose__51018;
  v183 = 0;
  path3 = [mainFileURL2 path];
  v10 = [MEMORY[0x1E695DF70] arrayWithArray:&unk_1F0FBFBC8];
  v11 = dispatch_semaphore_create(0);
  v12 = MEMORY[0x1E6994D60];
  v13 = MEMORY[0x1E695DFF8];
  v14 = NSTemporaryDirectory();
  v15 = [v13 fileURLWithPath:v14];
  v169[0] = MEMORY[0x1E69E9820];
  v169[1] = 3221225472;
  v169[2] = __136__PLManagedAsset_CPL___createPhotoResourcesForMaster_withOriginalResource_intoMasterResources_shouldGenerateDerivatives_inPhotoLibrary___block_invoke;
  v169[3] = &unk_1E756D660;
  v170 = v136;
  v172 = buf;
  v16 = v11;
  v171 = v16;
  [v12 generateFullSizeJPEGIfNecessaryFromInputResource:v170 destinationDirectory:v15 fingerprintScheme:fingerprintScheme2 completionHandler:v169];

  dispatch_semaphore_wait(v16, 0xFFFFFFFFFFFFFFFFLL);
  v17 = *(*&buf[8] + 40);
  if (v17)
  {
    resourceType = [v17 resourceType];
    v19 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:resourceType];
    [v10 removeObject:v19];

    if (resourceType == 4)
    {
      v20 = &unk_1F0FBCBC8;
    }

    else
    {
      if (resourceType != 5)
      {
LABEL_54:
        v132 = [(PLManagedAsset *)self pathForCPLResourceType:resourceType adjusted:0, v132];
        if (([defaultManager2 fileExistsAtPath:v132] & 1) == 0)
        {
          loga = [v132 stringByDeletingLastPathComponent];
          if (([defaultManager2 fileExistsAtPath:loga] & 1) == 0)
          {
            v173 = 0;
            v60 = [MEMORY[0x1E69BF238] createDirectoryAtPath:loga error:&v173 usingFileManager:defaultManager2];
            v61 = v173;
            if ((v60 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v62 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
              {
                *v174 = 138412546;
                *&v174[4] = v132;
                *&v174[12] = 2112;
                *&v174[14] = v61;
                _os_log_impl(&dword_19BF1F000, v62, OS_LOG_TYPE_ERROR, "Unable to create parent directory of fullsize derivative %@.Error: %@", v174, 0x16u);
              }
            }
          }

          identity2 = [*(*&buf[8] + 40) identity];
          fileURL3 = [identity2 fileURL];

          pathManager = [v132 pathManager];
          capabilities = [pathManager capabilities];

          v66 = MEMORY[0x1E69BF238];
          v67 = [MEMORY[0x1E695DFF8] fileURLWithPath:v132 isDirectory:0];
          v168 = 0;
          v68 = [v66 secureMoveItemAtURL:fileURL3 toURL:v67 capabilities:capabilities error:&v168];
          v69 = v168;

          if ((v68 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v70 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v70, OS_LOG_TYPE_ERROR))
            {
              *v174 = 138412802;
              *&v174[4] = fileURL3;
              *&v174[12] = 2112;
              *&v174[14] = v132;
              *&v174[22] = 2112;
              *&v174[24] = v69;
              _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_ERROR, "Failed to secure move fullsize derivative from %@ to %@.Error: %@", v174, 0x20u);
            }
          }
        }

        if ([defaultManager2 fileExistsAtPath:v132])
        {
          identifier2 = [*MEMORY[0x1E6982E58] identifier];
          v72 = objc_opt_class();
          v73 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v132 withResourceType:resourceType uniformTypeIdentifier:identifier2 scopedIdentifier:scopedIdentifier4 recordClass:v72 fingerprintScheme:fingerprintScheme2];

          if (v73)
          {
            [v73 setDeleteAfterUpload:1];
            [v145 addObject:v73];
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v74 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v74, OS_LOG_TYPE_ERROR))
            {
              *v174 = 138412290;
              *&v174[4] = v132;
              _os_log_impl(&dword_19BF1F000, v74, OS_LOG_TYPE_ERROR, "Unable to create CPL resource from %@", v174, 0xCu);
            }
          }
        }

        goto LABEL_81;
      }

      [v10 removeObject:&unk_1F0FBCBC8];
      v20 = &unk_1F0FBCBE0;
    }

    [v10 removeObject:{v20, v132}];
    goto LABEL_54;
  }

  v132 = path3;
LABEL_81:
  v1322 = [(PLManagedAsset *)self _createJPEGResourcesFromFullSizePath:v132 withScopedIdentifier:scopedIdentifier4 forMaster:1 forResourceTypes:v10 fingerprintScheme:fingerprintScheme2, v132];
  [v145 addObjectsFromArray:v1322];

  _Block_object_dispose(buf, 8);
LABEL_82:
  obja = [(PLManagedAsset *)self allMasterCPLResources];
  v166 = 0u;
  v167 = 0u;
  v164 = 0u;
  v165 = 0u;
  v153 = [obja countByEnumeratingWithState:&v164 objects:v174 count:16];
  if (!v153)
  {
    goto LABEL_128;
  }

  v142 = !derivativesCopy;
  v152 = *v165;
  do
  {
    v160 = 0;
    do
    {
      if (*v165 != v152)
      {
        objc_enumerationMutation(obja);
      }

      v76 = *(*(&v164 + 1) + 8 * v160);
      cplType2 = [v76 cplType];
      v78 = cplType2;
      if (cplType2 <= 0x18)
      {
        if (((1 << cplType2) & 0x1860104) != 0 || cplType2 == 22 && ([v76 uniformTypeIdentifier], v100 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v100, "identifier"), v101 = objc_claimAutoreleasedReturnValue(), objc_msgSend(MEMORY[0x1E69C08F0], "supplementalResourceAAEType"), v102 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v102, "identifier"), v103 = objc_claimAutoreleasedReturnValue(), v104 = objc_msgSend(v101, "isEqualToString:", v103), v103, v102, v101, v100, v104))
        {
          v79 = objc_opt_class();
          cplFileURL = [v76 cplFileURL];
          v163 = 0;
          v81 = [(PLManagedAsset *)self setFingerprintAndStableHashOnInternalResource:v76 recordClass:v79 resourceType:v78 resourceFileURL:cplFileURL fingerprintScheme:fingerprintScheme2 error:&v163];
          v154 = v163;

          if (v81)
          {
            goto LABEL_95;
          }

          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v82 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_ERROR))
            {
              fileURL4 = [v76 fileURL];
              path4 = [fileURL4 path];
              scopedIdentifier5 = [(PLManagedAsset *)self scopedIdentifier];
              *buf = 138412802;
              *&buf[4] = path4;
              *&buf[12] = 2112;
              *&buf[14] = scopedIdentifier5;
              *&buf[22] = 2112;
              v181 = v154;
              _os_log_impl(&dword_19BF1F000, v82, OS_LOG_TYPE_ERROR, "Failed to generate fingerprint for path %@ uuid %@. Error: %@", buf, 0x20u);
            }
          }

          if ([v76 isCPLOriginalResourceAssetHasAdjustments:0])
          {
LABEL_95:
            logb = [v76 cplResourceIncludeFile:1];
            if (logb)
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v86 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v86, OS_LOG_TYPE_DEBUG))
                {
                  *buf = 138412290;
                  *&buf[4] = logb;
                  _os_log_impl(&dword_19BF1F000, v86, OS_LOG_TYPE_DEBUG, "Created master resource %@", buf, 0xCu);
                }
              }

              [v76 setRemoteAvailability:1];
              [v145 addObject:logb];
              if ([v76 cplType] == 18 && ((PLIsEDUMode() | v142) & 1) == 0)
              {
                v144 = v143;
                array = [MEMORY[0x1E695DF70] array];
                v88 = [(PLManagedAsset *)self photoIrisSidecarIgnoringSubtype:0];
                scopedIdentifier6 = [v144 scopedIdentifier];
                fingerprintScheme3 = [v144 fingerprintScheme];
                v178 = 0u;
                v179 = 0u;
                memset(v177, 0, sizeof(v177));
                v91 = [&unk_1F0FBFBE0 countByEnumeratingWithState:v177 objects:buf count:16];
                if (v91)
                {
                  v92 = **&v177[16];
                  do
                  {
                    for (j = 0; j != v91; ++j)
                    {
                      if (**&v177[16] != v92)
                      {
                        objc_enumerationMutation(&unk_1F0FBFBE0);
                      }

                      unsignedIntegerValue = [*(*&v177[8] + 8 * j) unsignedIntegerValue];
                      fileURL5 = [v88 fileURL];
                      v96 = [(PLManagedAsset *)self _createVideoResourceFromVideoURL:fileURL5 withResourceType:unsignedIntegerValue scopedIdentifier:scopedIdentifier6 applyVideoAdjustments:0 forMaster:1 forPhotoIris:1 fingerprintScheme:fingerprintScheme3];

                      if (v96)
                      {
                        [array addObject:v96];
                      }
                    }

                    v91 = [&unk_1F0FBFBE0 countByEnumeratingWithState:v177 objects:buf count:16];
                  }

                  while (v91);
                }

                [v145 addObjectsFromArray:array];
                goto LABEL_115;
              }

              goto LABEL_119;
            }

            if (*MEMORY[0x1E6994D48])
            {
            }

            else
            {
              array = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(array, OS_LOG_TYPE_ERROR))
              {
                scopedIdentifier7 = [(PLManagedAsset *)self scopedIdentifier];
                *buf = 138412546;
                *&buf[4] = v76;
                *&buf[12] = 2112;
                *&buf[14] = scopedIdentifier7;
                _os_log_impl(&dword_19BF1F000, array, OS_LOG_TYPE_ERROR, "Unable to create CPLResource from %@ with itemIdentifier %@", buf, 0x16u);
              }

LABEL_115:

LABEL_119:
            }
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            logb = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(logb, OS_LOG_TYPE_ERROR))
            {
              v98 = [MEMORY[0x1E6994B90] shortDescriptionForResourceType:{objc_msgSend(v76, "cplType")}];
              scopedIdentifier8 = [v143 scopedIdentifier];
              *buf = 138543618;
              *&buf[4] = v98;
              *&buf[12] = 2112;
              *&buf[14] = scopedIdentifier8;
              _os_log_impl(&dword_19BF1F000, logb, OS_LOG_TYPE_ERROR, "Not adding resource of type: %{public}@ to master change identifier %@", buf, 0x16u);
            }

            goto LABEL_119;
          }
        }
      }

      ++v160;
    }

    while (v160 != v153);
    v105 = [obja countByEnumeratingWithState:&v164 objects:v174 count:16];
    v153 = v105;
  }

  while (v105);
LABEL_128:
  v106 = [(PLManagedAsset *)self imageMediaMetadataForURL:mainFileURL2];
  v107 = v106;
  if (v106)
  {
    v108 = [v106 length];
    if (v108 > [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
      v109 = MEMORY[0x1E6994D48];
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v110 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v110, OS_LOG_TYPE_DEFAULT))
        {
          pl_shortDescription = [(NSManagedObject *)self pl_shortDescription];
          *buf = 138412290;
          *&buf[4] = pl_shortDescription;
          _os_log_impl(&dword_19BF1F000, v110, OS_LOG_TYPE_DEFAULT, "Creating overflow image properties resource for asset %@", buf, 0xCu);
        }
      }

      pathForMediaMetadataFile2 = [(PLManagedAsset *)self pathForMediaMetadataFile];
      *v177 = 0;
      stringByDeletingLastPathComponent2 = [pathForMediaMetadataFile2 stringByDeletingLastPathComponent];
      v114 = MEMORY[0x1E69BF238];
      defaultManager3 = [MEMORY[0x1E696AC08] defaultManager];
      LODWORD(v114) = [v114 createDirectoryAtPath:stringByDeletingLastPathComponent2 error:v177 usingFileManager:defaultManager3];

      v116 = *v177;
      v117 = v116;
      if (v114)
      {
        v162 = v116;
        v118 = [v107 writeToFile:pathForMediaMetadataFile2 options:1 error:&v162];
        v119 = v162;

        if (v118)
        {
          identifier3 = [*MEMORY[0x1E6982D60] identifier];
          v121 = objc_opt_class();
          v122 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:pathForMediaMetadataFile2 withResourceType:10 uniformTypeIdentifier:identifier3 scopedIdentifier:scopedIdentifier4 recordClass:v121 fingerprintScheme:fingerprintScheme2];

          if (v122)
          {
            [v122 setDeleteAfterUpload:1];
            [v145 addObject:v122];
            goto LABEL_152;
          }

          if ((*v109 & 1) == 0)
          {
            v122 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v122, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              *&buf[4] = scopedIdentifier4;
              v123 = "Unable to create CPL resource for image properties data for asset %@";
              v124 = v122;
              v125 = 12;
LABEL_151:
              _os_log_impl(&dword_19BF1F000, v124, OS_LOG_TYPE_ERROR, v123, buf, v125);
            }

            goto LABEL_152;
          }
        }

        else if ((*v109 & 1) == 0)
        {
          v122 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v122, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412802;
            *&buf[4] = v107;
            *&buf[12] = 2112;
            *&buf[14] = pathForMediaMetadataFile2;
            *&buf[22] = 2112;
            v181 = v119;
            v123 = "Failed to save image properties data %@ to %@. Error: %@";
            v124 = v122;
            v125 = 32;
            goto LABEL_151;
          }

LABEL_152:
        }
      }

      else
      {
        if ((*v109 & 1) == 0)
        {
          v122 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v122, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            *&buf[4] = pathForMediaMetadataFile2;
            *&buf[12] = 2112;
            *&buf[14] = v117;
            _os_log_impl(&dword_19BF1F000, v122, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", buf, 0x16u);
          }

          v119 = v117;
          goto LABEL_152;
        }

        v119 = v116;
      }
    }

    mediaMetadata2 = [v143 mediaMetadata];
    [mediaMetadata2 setValue:v107 forKey:@"data"];

    [v143 setMediaMetadataType:@"CGImageProperties"];
  }

LABEL_156:
LABEL_166:
  selfCopy2 = self;
LABEL_167:
  [(PLManagedAsset *)selfCopy2 rm_createMasterResourcesForCPLResources:v141 master:masterCopy inLibrary:libraryCopy, v132];
LABEL_168:

  return v141;
}

void __136__PLManagedAsset_CPL___createPhotoResourcesForMaster_withOriginalResource_intoMasterResources_shouldGenerateDerivatives_inPhotoLibrary___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v14 = *MEMORY[0x1E69E9840];
  v6 = a2;
  v7 = a3;
  if (v7)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = *(a1 + 32);
        v10 = 138412546;
        v11 = v9;
        v12 = 2112;
        v13 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Failed to generate full size JPEG from %@: %@", &v10, 0x16u);
      }
    }
  }

  else
  {
    objc_storeStrong((*(*(a1 + 48) + 8) + 40), a2);
  }

  dispatch_semaphore_signal(*(a1 + 40));
}

- (BOOL)setFingerprintAndStableHashOnInternalResource:(id)resource recordClass:(Class)class resourceType:(unint64_t)type resourceFileURL:(id)l fingerprintScheme:(id)scheme error:(id *)error
{
  resourceCopy = resource;
  lCopy = l;
  schemeCopy = scheme;
  fingerprint = [resourceCopy fingerprint];
  if (!fingerprint || ![schemeCopy isValidFingerprint:fingerprint])
  {

    v27 = 0;
    v19 = [schemeCopy fingerPrintForFileAtURL:lCopy error:&v27];
    v20 = v27;
    fingerprint = 0;
    v21 = v20;
    if (!v19)
    {
      goto LABEL_15;
    }

    goto LABEL_8;
  }

  if (([schemeCopy isForStableHash] & 1) == 0)
  {
    if ([(objc_class *)class requiresStableHashForResourceType:type])
    {
      stableHash = [resourceCopy stableHash];

      if (!stableHash)
      {
        fingerprint = fingerprint;
        v20 = 0;
        v19 = fingerprint;
LABEL_8:
        if (([schemeCopy isForStableHash] & 1) != 0 || !-[objc_class requiresStableHashForResourceType:](class, "requiresStableHashForResourceType:", type))
        {
          v23 = 0;
          goto LABEL_13;
        }

        fingerprintSchemeForStableHash = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
        v26 = v20;
        v23 = [fingerprintSchemeForStableHash fingerPrintForFileAtURL:lCopy error:&v26];
        v21 = v26;

        if (v23)
        {
          v20 = v21;
LABEL_13:
          [resourceCopy setFingerprint:v19];
          [resourceCopy setStableHash:v23];

          v18 = 1;
          v21 = v20;
LABEL_18:

          goto LABEL_19;
        }

LABEL_15:
        if (error)
        {
          v24 = v21;
          v18 = 0;
          *error = v21;
        }

        else
        {
          v18 = 0;
        }

        goto LABEL_18;
      }
    }
  }

  v18 = 1;
LABEL_19:

  return v18;
}

- (void)setupPropertiesOnNewCloudMaster:(id)master withPlaceholderSourceAsset:(id)asset uniformTypeIdentifier:(id)identifier
{
  masterCopy = master;
  assetCopy = asset;
  identifierCopy = identifier;
  if (assetCopy)
  {
    selfCopy = assetCopy;
  }

  else
  {
    selfCopy = self;
  }

  v11 = selfCopy;
  dateCreated = [(PLManagedAsset *)v11 dateCreated];
  [masterCopy setCreationDate:dateCreated];

  addedDate = [(PLManagedAsset *)v11 addedDate];
  [masterCopy setImportDate:addedDate];

  if (identifierCopy)
  {
    [masterCopy setUniformTypeIdentifier:identifierCopy];
  }

  [masterCopy setOriginalOrientation:{-[PLManagedAsset originalOrientation](v11, "originalOrientation")}];
  originalFilename = [(PLManagedAsset *)v11 originalFilename];

  if (originalFilename)
  {
    originalFilename2 = [(PLManagedAsset *)v11 originalFilename];
    [masterCopy setOriginalFilename:originalFilename2];
  }

  additionalAttributes = [(PLManagedAsset *)v11 additionalAttributes];
  originatingAssetIdentifier = [additionalAttributes originatingAssetIdentifier];
  [masterCopy setOriginatingAssetIdentifier:originatingAssetIdentifier];

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  [masterCopy setImportedBy:{objc_msgSend(additionalAttributes2, "importedBy")}];

  additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
  importedByBundleIdentifier = [additionalAttributes3 importedByBundleIdentifier];
  [masterCopy setImportedByBundleIdentifier:importedByBundleIdentifier];

  additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
  importedByDisplayName = [additionalAttributes4 importedByDisplayName];
  [masterCopy setImportedByDisplayName:importedByDisplayName];
}

- (void)setupPropertiesOnExistingMaster:(id)master
{
  v29 = *MEMORY[0x1E69E9840];
  masterCopy = master;
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  [(PLManagedAsset *)self rm_createNewResourcesIn:masterCopy inManagedObjectContext:managedObjectContext];

  [(PLManagedAsset *)self setMaster:masterCopy];
  originalFilename = [masterCopy originalFilename];
  if (originalFilename)
  {
    v7 = originalFilename;
    originalFilename2 = [(PLManagedAsset *)self originalFilename];
    originalFilename3 = [masterCopy originalFilename];
    v10 = [originalFilename2 isEqualToString:originalFilename3];

    if ((v10 & 1) == 0)
    {
      originalFilename4 = [masterCopy originalFilename];
      [(PLManagedAsset *)self setOriginalFilename:originalFilename4];
    }
  }

  importedByBundleIdentifier = [(PLManagedAsset *)self importedByBundleIdentifier];
  if (importedByBundleIdentifier)
  {
    v13 = importedByBundleIdentifier;
    importedByBundleIdentifier2 = [masterCopy importedByBundleIdentifier];
    importedByBundleIdentifier3 = [(PLManagedAsset *)self importedByBundleIdentifier];
    v16 = [importedByBundleIdentifier2 isEqualToString:importedByBundleIdentifier3];

    if ((v16 & 1) == 0)
    {
      importedByBundleIdentifier4 = [(PLManagedAsset *)self importedByBundleIdentifier];
      [masterCopy updateImportedByBundleIdentifier:importedByBundleIdentifier4];
    }
  }

  importedByDisplayName = [(PLManagedAsset *)self importedByDisplayName];
  if (importedByDisplayName)
  {
    v19 = importedByDisplayName;
    importedByDisplayName2 = [masterCopy importedByDisplayName];
    importedByDisplayName3 = [(PLManagedAsset *)self importedByDisplayName];
    v22 = [importedByDisplayName2 isEqualToString:importedByDisplayName3];

    if ((v22 & 1) == 0)
    {
      importedByDisplayName4 = [(PLManagedAsset *)self importedByDisplayName];
      [masterCopy updateImportedByDisplayName:importedByDisplayName4];
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v24 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
    {
      v25 = 138412546;
      v26 = masterCopy;
      v27 = 2112;
      selfCopy = self;
      _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_DEFAULT, "Found an existing cloud master %@ for %@", &v25, 0x16u);
    }
  }
}

- (void)createMasterIfNecessaryInLibrary:(id)library
{
  v35 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  master = [(PLManagedAsset *)self master];
  if (!master && ![(PLManagedAsset *)self isTimelapsePlaceholder]&& [(PLManagedAsset *)self complete]&& ![(PLManagedAsset *)self isPhotoIrisPlaceholder]&& ![(PLManagedAsset *)self isPlaceholderAsset])
  {
    mainFileURL = [(PLManagedAsset *)self mainFileURL];
    if ([(PLManagedAsset *)self hasAdjustments])
    {
      [(PLManagedAsset *)self nonDynamicOriginalUTI];
    }

    else
    {
      [(PLManagedAsset *)self uniformTypeIdentifier];
    }
    v10 = ;
    v29 = 0;
    v30 = 0;
    v28 = 0;
    v11 = [(PLManagedAsset *)self _computeNewMasterIdentifierAndStableHash:&v30 fingerprintScheme:mainFileURL forMasterFileURL:&v28 error:?];
    v7 = v28;
    if (v11)
    {
      v12 = v29;
      if (!v29)
      {
        currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
        [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:261 description:{@"originalStableHash for %@ should have been computed", self}];
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v13 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
        {
          *buf = 138412290;
          selfCopy = v11;
          _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEBUG, "Master asset finger print %@", buf, 0xCu);
        }
      }

      v27 = mainFileURL;
      v14 = v10;
      shareRelationship = [(PLManagedAsset *)self shareRelationship];
      managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
      master = [PLCloudMaster cloudMasterWithGUID:v11 inShare:shareRelationship prefetchResources:0 inManagedObjectContext:managedObjectContext];

      if (master)
      {
        [(PLManagedAsset *)self setupPropertiesOnExistingMaster:master];
        mainFileURL = v27;
      }

      else
      {
        shareRelationship2 = [(PLManagedAsset *)self shareRelationship];
        master = [PLCloudMaster insertIntoPhotoLibrary:libraryCopy withCloudMasterGUID:v11 inShare:shareRelationship2];

        [(PLManagedAsset *)self setupPropertiesOnNewCloudMaster:master withPlaceholderSourceAsset:0 uniformTypeIdentifier:v10];
        [(PLManagedAsset *)self setMaster:master];
        path = [(PLManagedAsset *)v27 path];
        scopedIdentifier = [master scopedIdentifier];
        v21 = objc_opt_class();
        v22 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:path withResourceType:1 uniformTypeIdentifier:v14 scopedIdentifier:scopedIdentifier recordClass:v21 fingerprintScheme:v30];

        if (v22)
        {
          v23 = [(PLManagedAsset *)self storedResourceForCPLResource:v22 asset:self adjusted:0];
          v10 = v14;
          mainFileURL = v27;
          if ([(PLManagedAsset *)self shouldSimulateQuarantineOriginalImageResourceOnPush])
          {
            [(PLManagedAsset *)self simulateQuarantineOriginalImageResourceOnPush:v22];
          }
        }

        else
        {
          v10 = v14;
          mainFileURL = v27;
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v24 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              selfCopy = self;
              _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "CreateMaster: Can't create CPLResource for originalResource for asset %@", buf, 0xCu);
            }
          }

          [(PLManagedAsset *)self setCloudLocalState:2];
        }
      }

      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes setOriginalStableHash:v12];
    }

    else
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v17 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412546;
          selfCopy = mainFileURL;
          v33 = 2112;
          v34 = v7;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "CreateMaster: Failed to generate finger print for %@. Error: %@", buf, 0x16u);
        }
      }

      [(PLManagedAsset *)self setCloudLocalState:2];
      master = 0;
      v12 = v29;
    }

    goto LABEL_9;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v7 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138412290;
      selfCopy = uuid;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_DEFAULT, "Skipping creating master for asset: %@", buf, 0xCu);
    }

LABEL_9:
  }
}

- (id)existingCloudMasterNeedsRepush:(BOOL *)repush
{
  v44 = *MEMORY[0x1E69E9840];
  master = [(PLManagedAsset *)self master];
  if (master)
  {
    v6 = master;
    v7 = 0;
    if (!repush)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v39 = 0;
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  v37 = 0;
  v38 = 0;
  v10 = [(PLManagedAsset *)self _computeNewMasterIdentifierAndStableHash:&v38 fingerprintScheme:mainFileURL forMasterFileURL:&v37 error:?];
  v11 = v37;
  v12 = v11;
  if (!v10 || v11)
  {
    v6 = 0;
    v7 = 0;
    v27 = v39;
  }

  else
  {
    shareRelationship = [(PLManagedAsset *)self shareRelationship];
    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    v6 = [PLCloudMaster cloudMasterWithGUID:v10 inShare:shareRelationship prefetchResources:0 inManagedObjectContext:managedObjectContext];

    if (v6)
    {
      managedObjectContext2 = [(PLManagedAsset *)self managedObjectContext];
      [(PLManagedAsset *)self rm_createNewResourcesIn:v6 inManagedObjectContext:managedObjectContext2];

      [(PLManagedAsset *)self setMaster:v6];
      originalFilename = [v6 originalFilename];
      if (originalFilename)
      {
        v17 = originalFilename;
        originalFilename2 = [(PLManagedAsset *)self originalFilename];
        originalFilename3 = [v6 originalFilename];
        v20 = [originalFilename2 isEqualToString:originalFilename3];

        if ((v20 & 1) == 0)
        {
          originalFilename4 = [v6 originalFilename];
          [(PLManagedAsset *)self setOriginalFilename:originalFilename4];
        }
      }

      importedByBundleIdentifier = [(PLManagedAsset *)self importedByBundleIdentifier];
      if (importedByBundleIdentifier && (v23 = importedByBundleIdentifier, [v6 importedByBundleIdentifier], v24 = objc_claimAutoreleasedReturnValue(), -[PLManagedAsset importedByBundleIdentifier](self, "importedByBundleIdentifier"), v25 = objc_claimAutoreleasedReturnValue(), v26 = objc_msgSend(v24, "isEqualToString:", v25), v25, v24, v23, (v26 & 1) == 0))
      {
        importedByBundleIdentifier2 = [(PLManagedAsset *)self importedByBundleIdentifier];
        [v6 updateImportedByBundleIdentifier:importedByBundleIdentifier2];

        v7 = 1;
      }

      else
      {
        v7 = 0;
      }

      importedByDisplayName = [(PLManagedAsset *)self importedByDisplayName];
      if (importedByDisplayName)
      {
        v30 = importedByDisplayName;
        importedByDisplayName2 = [v6 importedByDisplayName];
        importedByDisplayName3 = [(PLManagedAsset *)self importedByDisplayName];
        v33 = [importedByDisplayName2 isEqualToString:importedByDisplayName3];

        if ((v33 & 1) == 0)
        {
          importedByDisplayName4 = [(PLManagedAsset *)self importedByDisplayName];
          [v6 updateImportedByDisplayName:importedByDisplayName4];

          v7 = 1;
        }
      }

      if (*MEMORY[0x1E6994D48])
      {
        v12 = 0;
      }

      else
      {
        v35 = __CPLAssetsdOSLogDomain();
        v12 = 0;
        if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412546;
          v41 = v6;
          v42 = 2112;
          selfCopy = self;
          _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_DEFAULT, "Found an existing cloud master %@ for %@", buf, 0x16u);
        }
      }
    }

    else
    {
      v7 = 0;
    }

    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    v27 = v39;
    [additionalAttributes setOriginalStableHash:v39];
  }

  if (repush)
  {
LABEL_3:
    *repush = v7;
  }

LABEL_4:

  return v6;
}

- (void)incrementUploadAttempts
{
  v3 = ([(PLManagedAsset *)self uploadAttempts]+ 1);

  [(PLManagedAsset *)self setUploadAttempts:v3];
}

- (void)setUploadAttempts:(signed __int16)attempts
{
  attemptsCopy = attempts;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:attemptsCopy];
  [additionalAttributes setUploadAttempts:v4];
}

- (signed)uploadAttempts
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  uploadAttempts = [additionalAttributes uploadAttempts];
  shortValue = [uploadAttempts shortValue];

  return shortValue;
}

- (void)setLastUploadAttemptDate:(id)date
{
  dateCopy = date;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setLastUploadAttemptDate:dateCopy];
}

- (id)lastUploadAttemptDate
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  lastUploadAttemptDate = [additionalAttributes lastUploadAttemptDate];

  return lastUploadAttemptDate;
}

- (void)setOriginalResourceChoice:(unint64_t)choice
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:choice];
  [additionalAttributes setOriginalResourceChoice:v4];
}

- (unint64_t)originalResourceChoice
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalResourceChoice = [additionalAttributes originalResourceChoice];
  shortValue = [originalResourceChoice shortValue];

  return shortValue;
}

+ (id)_placeAnnotationFromAnnotationData:(id)data
{
  if (data)
  {
    v3 = [MEMORY[0x1E696AE40] propertyListWithData:data options:0 format:0 error:0];
    if (v3)
    {
      v4 = objc_alloc_init(MEMORY[0x1E6994B48]);
      v5 = [v3 objectForKey:@"level"];
      [v4 setPlaceLevel:v5];

      v6 = [v3 objectForKey:@"name"];
      [v4 setPlaceName:v6];
    }

    else
    {
      v4 = 0;
    }
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

+ (id)_dataFromCPLPlaceAnnotation:(id)annotation
{
  annotationCopy = annotation;
  if (annotationCopy)
  {
    dictionary = [MEMORY[0x1E695DF90] dictionary];
    placeName = [annotationCopy placeName];

    if (placeName)
    {
      placeName2 = [annotationCopy placeName];
      [dictionary setObject:placeName2 forKey:@"name"];
    }

    placeLevel = [annotationCopy placeLevel];

    if (placeLevel)
    {
      placeLevel2 = [annotationCopy placeLevel];
      [dictionary setObject:placeLevel2 forKey:@"level"];
    }

    v9 = [MEMORY[0x1E696AE40] dataWithPropertyList:dictionary format:200 options:0 error:0];
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

+ (id)quarantinedAssetsInLibrary:(id)library
{
  v3 = MEMORY[0x1E695D5E0];
  libraryCopy = library;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v7 = [PLManagedAsset predicateForUploadableAssetsWithCloudLocalState:4];
  [v6 setPredicate:v7];

  managedObjectContext = [libraryCopy managedObjectContext];

  v11 = 0;
  v9 = [managedObjectContext executeFetchRequest:v6 error:&v11];

  return v9;
}

+ (id)failedToPushAssetInLibrary:(id)library
{
  v3 = MEMORY[0x1E695D5E0];
  libraryCopy = library;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v7 = [PLManagedAsset predicateForUploadableAssetsWithCloudLocalState:2];
  [v6 setPredicate:v7];

  managedObjectContext = [libraryCopy managedObjectContext];

  v11 = 0;
  v9 = [managedObjectContext executeFetchRequest:v6 error:&v11];

  return v9;
}

+ (id)toUploadAssetsInLibrary:(id)library
{
  v3 = MEMORY[0x1E695D5E0];
  libraryCopy = library;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v7 = [PLManagedAsset predicateForUploadableAssetsWithMasterCloudLocalStateNotEqualTo:3];
  [v6 setPredicate:v7];

  managedObjectContext = [libraryCopy managedObjectContext];

  v11 = 0;
  v9 = [managedObjectContext executeFetchRequest:v6 error:&v11];

  return v9;
}

+ (void)resetAssetsCloudStateInLibrary:(id)library
{
  v33 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  v4 = objc_autoreleasePoolPush();
  v5 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v6 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_DEFAULT, "Resetting cloudLocalState of assets", buf, 2u);
    }
  }

  v7 = objc_alloc(MEMORY[0x1E695D560]);
  v8 = +[PLManagedAsset entityName];
  v9 = [v7 initWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(cloudLocalState != %d)", 0];
  [v9 setPredicate:v10];
  [v9 setResultType:2];
  [v9 setPropertiesToUpdate:&unk_1F0FC0758];
  managedObjectContext = [libraryCopy managedObjectContext];
  v28 = 0;
  v12 = [managedObjectContext executeRequest:v9 error:&v28];
  v13 = v28;

  if (v13)
  {
    if (*v5)
    {
      goto LABEL_13;
    }

    v14 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v32 = v13;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Failed to batch  assets: %@", buf, 0xCu);
    }
  }

  else
  {
    if (*v5)
    {
      goto LABEL_13;
    }

    v14 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      result = [v12 result];
      *buf = 138412290;
      v32 = result;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Batch updated %@ assets", buf, 0xCu);
    }
  }

LABEL_13:
  objc_autoreleasePoolPop(v4);
  v16 = objc_autoreleasePoolPush();
  if ((*v5 & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Resetting uploadAttempts of assets", buf, 2u);
    }
  }

  v18 = [objc_alloc(MEMORY[0x1E695D560]) initWithEntityName:@"AdditionalAssetAttributes"];
  v19 = [MEMORY[0x1E696AE18] predicateWithFormat:@"lastUploadAttemptDate != nil OR uploadAttempts > 0"];
  [v18 setPredicate:v19];
  [v18 setResultType:2];
  v29[0] = @"uploadAttempts";
  v29[1] = @"lastUploadAttemptDate";
  v30[0] = &unk_1F0FBCD18;
  null = [MEMORY[0x1E695DFB0] null];
  v30[1] = null;
  v21 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v30 forKeys:v29 count:2];
  [v18 setPropertiesToUpdate:v21];

  managedObjectContext2 = [libraryCopy managedObjectContext];
  v27 = 0;
  v23 = [managedObjectContext2 executeRequest:v18 error:&v27];
  v24 = v27;

  if (v24)
  {
    if ((*v5 & 1) == 0)
    {
      v25 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v32 = v24;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "Failed to batch assets: %@", buf, 0xCu);
      }

LABEL_24:
    }
  }

  else if ((*v5 & 1) == 0)
  {
    v25 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
    {
      result2 = [v23 result];
      *buf = 138412290;
      v32 = result2;
      _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEFAULT, "Batch updated %@ assets", buf, 0xCu);
    }

    goto LABEL_24;
  }

  objc_autoreleasePoolPop(v16);
}

+ (id)assetsToRetryInLibrary:(id)library limit:(unint64_t)limit
{
  v41[2] = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  managedObjectContext = [libraryCopy managedObjectContext];
  context = objc_autoreleasePoolPush();
  v4 = MEMORY[0x1E695D5E0];
  v5 = +[PLManagedAsset entityName];
  v6 = [v4 fetchRequestWithEntityName:v5];

  date = [MEMORY[0x1E695DF00] date];
  v31 = [date dateByAddingTimeInterval:-86400.0];

  v29 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND additionalAttributes.lastUploadAttemptDate != nil AND additionalAttributes.lastUploadAttemptDate < %@ AND additionalAttributes.uploadAttempts > 1", 0, v31];
  v8 = MEMORY[0x1E696AB28];
  v9 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil", @"momentShare"];
  v41[0] = v9;
  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"momentShare.shareURL"];
  v41[1] = v10;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v41 count:2];
  v12 = [v8 orPredicateWithSubpredicates:v11];

  v13 = MEMORY[0x1E696AB28];
  v14 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil", @"collectionShare"];
  v40[0] = v14;
  v15 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"collectionShare.shareURL"];
  v40[1] = v15;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v40 count:2];
  v17 = [v13 orPredicateWithSubpredicates:v16];

  v18 = MEMORY[0x1E696AB28];
  v39[0] = v29;
  v19 = +[PLManagedAsset _syncablePredicate];
  v39[1] = v19;
  predicateForSupportedAssetTypesForUpload = [self predicateForSupportedAssetTypesForUpload];
  v39[2] = predicateForSupportedAssetTypesForUpload;
  v39[3] = v12;
  v39[4] = v17;
  v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v39 count:5];
  v22 = [v18 andPredicateWithSubpredicates:v21];

  v23 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:0];
  v38[0] = v23;
  v24 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"additionalAttributes.uploadAttempts" ascending:1];
  v38[1] = v24;
  v25 = [MEMORY[0x1E695DEC8] arrayWithObjects:v38 count:2];
  [v6 setSortDescriptors:v25];

  v37 = @"additionalAttributes";
  v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v37 count:1];
  [v6 setRelationshipKeyPathsForPrefetching:v26];

  [v6 setPredicate:v22];
  [v6 setFetchLimit:vcvtpd_u64_f64((limit >> 1) + 0.5)];
  v36 = 0;
  v27 = [managedObjectContext executeFetchRequest:v6 error:&v36];

  objc_autoreleasePoolPop(context);

  return v27;
}

+ (id)_notPushedAssetsToUploadInitiallyInManagedObjectContext:(id)context withSavedAssetTypePredicate:(id)predicate shouldSort:(BOOL)sort limit:(unint64_t)limit
{
  sortCopy = sort;
  v30[4] = *MEMORY[0x1E69E9840];
  contextCopy = context;
  predicateCopy = predicate;
  context = objc_autoreleasePoolPush();
  v11 = MEMORY[0x1E695D5E0];
  v12 = +[PLManagedAsset entityName];
  v13 = [v11 fetchRequestWithEntityName:v12];

  v14 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND additionalAttributes.uploadAttempts <= 1", 0];
  _predicateForTrashedAssetsToExcludeInInitialUpload = [self _predicateForTrashedAssetsToExcludeInInitialUpload];
  v16 = MEMORY[0x1E696AB28];
  v30[0] = predicateCopy;
  v30[1] = v14;
  v17 = +[PLManagedAsset _syncablePredicate];
  v30[2] = v17;
  v30[3] = _predicateForTrashedAssetsToExcludeInInitialUpload;
  v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:4];
  v19 = [v16 andPredicateWithSubpredicates:v18];

  if (sortCopy)
  {
    v20 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:0];
    v29 = v20;
    v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v29 count:1];
    [v13 setSortDescriptors:v21];
  }

  v28 = @"additionalAttributes";
  v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v28 count:1];
  [v13 setRelationshipKeyPathsForPrefetching:v22];

  [v13 setPredicate:v19];
  [v13 setFetchLimit:vcvtpd_u64_f64((limit >> 1) + 0.5)];
  v27 = 0;
  v23 = [contextCopy executeFetchRequest:v13 error:&v27];

  objc_autoreleasePoolPop(context);

  return v23;
}

+ (id)assetsToUploadInitiallyInManagedObjectContext:(id)context limit:(unint64_t)limit
{
  v45[2] = *MEMORY[0x1E69E9840];
  contextCopy = context;
  predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders = [self predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  v8 = [self _notPushedAssetsToUploadInitiallyInManagedObjectContext:contextCopy withSavedAssetTypePredicate:predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders shouldSort:1 limit:limit];
  if (![v8 count])
  {
    v37 = predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders;
    limitCopy = limit;
    v9 = MEMORY[0x1E696AB28];
    v31 = MEMORY[0x1E696AB28];
    v35 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForMomentSharedAsset"), 1}];
    v44[0] = v35;
    v33 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"momentShare.shareURL"];
    v44[1] = v33;
    v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v44 count:2];
    v11 = [v9 andPredicateWithSubpredicates:v10];
    v45[0] = v11;
    v39 = contextCopy;
    v12 = MEMORY[0x1E696AB28];
    v13 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForCollectionShareAsset"), 1}];
    v43[0] = v13;
    v14 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"collectionShare.shareURL"];
    v43[1] = v14;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v43 count:2];
    v16 = [v12 andPredicateWithSubpredicates:v15];
    v45[1] = v16;
    v17 = [MEMORY[0x1E695DEC8] arrayWithObjects:v45 count:2];
    v18 = [v31 orPredicateWithSubpredicates:v17];

    contextCopy = v39;
    v19 = [self _notPushedAssetsToUploadInitiallyInManagedObjectContext:v39 withSavedAssetTypePredicate:v18 shouldSort:0 limit:limitCopy];

    if (![v19 count])
    {
      v32 = MEMORY[0x1E696AB28];
      v36 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForPlaceholderAsset"), 1}];
      v42[0] = v36;
      v20 = MEMORY[0x1E696AB28];
      v34 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil && %K == nil", @"momentShare", @"collectionShare"];
      v40[0] = v34;
      v30 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil || %K != nil", @"momentShare.shareURL", @"collectionShare.shareURL"];
      v40[1] = v30;
      v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v40 count:2];
      v22 = [v20 orPredicateWithSubpredicates:v21];
      v41[0] = v22;
      v23 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"master"];
      v41[1] = v23;
      v24 = [MEMORY[0x1E695DEC8] arrayWithObjects:v41 count:2];
      v25 = [v20 andPredicateWithSubpredicates:v24];
      v42[1] = v25;
      v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:v42 count:2];
      v27 = [v32 andPredicateWithSubpredicates:v26];

      contextCopy = v39;
      v28 = [self _notPushedAssetsToUploadInitiallyInManagedObjectContext:v39 withSavedAssetTypePredicate:v27 shouldSort:0 limit:limitCopy];

      v19 = v28;
    }

    v8 = v19;
    predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders = v37;
  }

  return v8;
}

+ (id)_predicateForTrashedAssetsToExcludeInInitialUpload
{
  if (_predicateForTrashedAssetsToExcludeInInitialUpload_onceToken != -1)
  {
    dispatch_once(&_predicateForTrashedAssetsToExcludeInInitialUpload_onceToken, &__block_literal_global_544_51359);
  }

  v3 = _predicateForTrashedAssetsToExcludeInInitialUpload_normalOrNeverPushedAssetPredicate;

  return v3;
}

void __73__PLManagedAsset_CPL___predicateForTrashedAssetsToExcludeInInitialUpload__block_invoke()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d OR %K == nil", @"trashedState", 0, @"cloudAssetGUID"];
  v1 = _predicateForTrashedAssetsToExcludeInInitialUpload_normalOrNeverPushedAssetPredicate;
  _predicateForTrashedAssetsToExcludeInInitialUpload_normalOrNeverPushedAssetPredicate = v0;
}

+ (id)predicateForUnpushedDeferredAssets
{
  if (predicateForUnpushedDeferredAssets_onceToken != -1)
  {
    dispatch_once(&predicateForUnpushedDeferredAssets_onceToken, &__block_literal_global_533);
  }

  v3 = predicateForUnpushedDeferredAssets_predicate;

  return v3;
}

void __57__PLManagedAsset_CPL__predicateForUnpushedDeferredAssets__block_invoke()
{
  v9[5] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"cloudLocalState", 0];
  v9[0] = v1;
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != 0", @"complete"];
  v9[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d OR noindex:(%K) != %d", @"deferredProcessingNeeded", 0, @"videoDeferredProcessingNeeded", 0];
  v9[2] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) < %llu", @"additionalAttributes.cloudRecoveryState", 0x80000000];
  v9[3] = v4;
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"trashedState", 0];
  v9[4] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:5];
  v7 = [v0 andPredicateWithSubpredicates:v6];
  v8 = predicateForUnpushedDeferredAssets_predicate;
  predicateForUnpushedDeferredAssets_predicate = v7;
}

+ (id)_syncablePredicate
{
  if (_syncablePredicate_onceToken_51394 != -1)
  {
    dispatch_once(&_syncablePredicate_onceToken_51394, &__block_literal_global_525);
  }

  v3 = _syncablePredicate_predicate;

  return v3;
}

void __41__PLManagedAsset_CPL___syncablePredicate__block_invoke()
{
  v7[3] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != 0", @"complete"];
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"deferredProcessingNeeded", 0, v1];
  v7[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"videoDeferredProcessingNeeded", 0];
  v7[2] = v3;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v7 count:3];
  v5 = [v0 andPredicateWithSubpredicates:v4];
  v6 = _syncablePredicate_predicate;
  _syncablePredicate_predicate = v5;
}

+ (unint64_t)countOfNotUploadedAssetsInPhotoLibrary:(id)library forAssetType:(signed __int16)type error:(id *)error
{
  libraryCopy = library;
  v24 = 0;
  v25 = &v24;
  v26 = 0x2020000000;
  v27 = 0;
  v18 = 0;
  v19 = &v18;
  v20 = 0x3032000000;
  v21 = __Block_byref_object_copy__51017;
  v22 = __Block_byref_object_dispose__51018;
  v23 = 0;
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __81__PLManagedAsset_CPL__countOfNotUploadedAssetsInPhotoLibrary_forAssetType_error___block_invoke;
  v13[3] = &unk_1E756D870;
  typeCopy = type;
  v15 = &v24;
  v8 = libraryCopy;
  v14 = v8;
  v16 = &v18;
  [v8 performBlockAndWait:v13];
  v9 = v25[3];
  v10 = v19[5];
  if (v9 == 0x7FFFFFFFFFFFFFFFLL && error)
  {
    v10 = v10;
    *error = v10;
  }

  v11 = v25[3];
  _Block_object_dispose(&v18, 8);

  _Block_object_dispose(&v24, 8);
  return v11;
}

void __81__PLManagedAsset_CPL__countOfNotUploadedAssetsInPhotoLibrary_forAssetType_error___block_invoke(uint64_t a1)
{
  v27[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = +[PLManagedAsset predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  if (*(a1 + 56))
  {
    v6 = @"%K == %d";
  }

  else
  {
    v6 = @"noindex:(%K) == %d";
  }

  v7 = [MEMORY[0x1E696AE18] predicateWithFormat:v6, @"kind", *(a1 + 56)];
  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil", @"master"];
  v9 = [MEMORY[0x1E696AE18] predicateWithFormat:@"master.cloudLocalState != %d", 3];
  v10 = MEMORY[0x1E696AB28];
  v27[0] = v8;
  v27[1] = v9;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v27 count:2];
  v12 = [v10 orPredicateWithSubpredicates:v11];

  v13 = MEMORY[0x1E696AB28];
  v26[0] = v5;
  v26[1] = v7;
  v26[2] = v12;
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:3];
  v15 = [v13 andPredicateWithSubpredicates:v14];
  [v4 setPredicate:v15];

  v16 = [*(a1 + 32) managedObjectContext];
  v17 = *(*(a1 + 48) + 8);
  obj = *(v17 + 40);
  v18 = [v16 countForFetchRequest:v4 error:&obj];
  objc_storeStrong((v17 + 40), obj);
  *(*(*(a1 + 40) + 8) + 24) = v18;

  if (*(*(*(a1 + 40) + 8) + 24) == 0x7FFFFFFFFFFFFFFFLL && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v19 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138412546;
      v23 = v4;
      v24 = 2112;
      v25 = v20;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Error on fetch: %@, error: %@", buf, 0x16u);
    }
  }
}

+ (unint64_t)iCPLAssetCountInPhotoLibrary:(id)library
{
  libraryCopy = library;
  v10 = 0;
  v11 = &v10;
  v12 = 0x2020000000;
  v13 = 0x7FFFFFFFFFFFFFFFLL;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __52__PLManagedAsset_CPL__iCPLAssetCountInPhotoLibrary___block_invoke;
  v7[3] = &unk_1E7578910;
  v4 = libraryCopy;
  v8 = v4;
  v9 = &v10;
  [v4 performBlockAndWait:v7];
  v5 = v11[3];

  _Block_object_dispose(&v10, 8);
  return v5;
}

void __52__PLManagedAsset_CPL__iCPLAssetCountInPhotoLibrary___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders"), 0}];
  [v4 setPredicate:v5];

  [v4 setResultType:4];
  v6 = [*(a1 + 32) managedObjectContext];
  v10 = 0;
  v7 = [v6 countForFetchRequest:v4 error:&v10];
  v8 = v10;

  if (v7 == 0x7FFFFFFFFFFFFFFFLL)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v12 = v8;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "Failed to fetch asset count. Error: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    *(*(*(a1 + 40) + 8) + 24) = v7;
  }
}

+ (unint64_t)countOfDeferredAssetsToSyncInPhotoLibrary:(id)library outAssetList:(id)list
{
  libraryCopy = library;
  listCopy = list;
  v15 = 0;
  v16 = &v15;
  v17 = 0x2020000000;
  v18 = 0;
  if (listCopy)
  {
    v10[0] = MEMORY[0x1E69E9820];
    v10[1] = 3221225472;
    v10[2] = __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke;
    v10[3] = &unk_1E7576680;
    selfCopy = self;
    v11 = libraryCopy;
    v13 = &v15;
    v12 = listCopy;
    [v11 performBlockAndWait:v10];

    v8 = v16[3];
  }

  else
  {
    v8 = 0;
  }

  _Block_object_dispose(&v15, 8);

  return v8;
}

void __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke(uint64_t a1)
{
  v25[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [*(a1 + 56) predicateForUnpushedDeferredAssets];
  v6 = MEMORY[0x1E696AB28];
  v25[0] = v5;
  v7 = +[PLManagedAsset predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  v25[1] = v7;
  v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:2];
  v9 = [v6 andPredicateWithSubpredicates:v8];

  [v4 setPredicate:v9];
  v24 = @"uuid";
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v24 count:1];
  [v4 setPropertiesToFetch:v10];

  [v4 setResultType:2];
  v11 = [*(a1 + 32) managedObjectContext];
  v21 = 0;
  v12 = [v11 executeFetchRequest:v4 error:&v21];
  v13 = v21;
  if (v12)
  {
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke_2;
    v16[3] = &unk_1E756D848;
    v14 = *(a1 + 48);
    v17 = @"uuid";
    v20 = v14;
    v18 = *(a1 + 32);
    v19 = *(a1 + 40);
    [v12 enumerateObjectsUsingBlock:v16];

    v15 = v17;
LABEL_6:

    goto LABEL_7;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v23 = v13;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Could not fetch the UUID of deferred assets: %@", buf, 0xCu);
    }

    goto LABEL_6;
  }

LABEL_7:
}

void __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 objectForKeyedSubscript:*(a1 + 32)];
  if (v3)
  {
    ++*(*(*(a1 + 56) + 8) + 24);
    v7 = v3;
    v4 = objc_alloc(MEMORY[0x1E6994BB8]);
    v5 = [*(a1 + 40) mainScopeIdentifier];
    v6 = [v4 initWithScopeIdentifier:v5 identifier:v7];

    [*(a1 + 48) addObject:v6];
    v3 = v7;
  }
}

+ (unint64_t)totalSizeOfUnpushedOriginalsInPhotoLibrary:(id)library outMasterList:(id)list isInitialUpload:(BOOL)upload
{
  libraryCopy = library;
  listCopy = list;
  if (listCopy)
  {
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke;
    v11[3] = &unk_1E7576118;
    uploadCopy = upload;
    selfCopy = self;
    v12 = libraryCopy;
    v13 = listCopy;
    [v12 performBlockAndWait:v11];
  }

  return 0;
}

void __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke(uint64_t a1)
{
  v23[1] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND complete != 0 AND master != nil AND master.placeholderState != %d AND master.cloudMasterGUID != nil AND master.cloudMasterGUID != ''", 0, 1];
  v6 = +[PLManagedAsset predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  v7 = [objc_alloc(MEMORY[0x1E695DF70]) initWithObjects:{v5, v6, 0}];
  if (*(a1 + 56) == 1)
  {
    v8 = [*(a1 + 48) _predicateForTrashedAssetsToExcludeInInitialUpload];
    [v7 addObject:v8];
  }

  v9 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v7];
  [v4 setPredicate:v9];
  v10 = objc_alloc_init(MEMORY[0x1E695D5C8]);
  [v10 setName:@"cloudMasterGUID"];
  v11 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"master.cloudMasterGUID"];
  [v10 setExpression:v11];

  [v10 setExpressionResultType:700];
  v23[0] = v10;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v23 count:1];
  [v4 setPropertiesToFetch:v12];

  [v4 setResultType:2];
  v13 = [*(a1 + 32) managedObjectContext];
  v20 = 0;
  v14 = [v13 executeFetchRequest:v4 error:&v20];
  v15 = v20;
  if (v14)
  {
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke_2;
    v17[3] = &unk_1E756D820;
    v18 = *(a1 + 32);
    v19 = *(a1 + 40);
    [v14 enumerateObjectsUsingBlock:v17];

    v16 = v18;
LABEL_8:

    goto LABEL_9;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v16 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v15;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Could not fetch total size of unpushed original assets: %@", buf, 0xCu);
    }

    goto LABEL_8;
  }

LABEL_9:
}

void __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 objectForKey:@"cloudMasterGUID"];
  if (v3)
  {
    v7 = v3;
    v4 = objc_alloc(MEMORY[0x1E6994BB8]);
    v5 = [*(a1 + 32) mainScopeIdentifier];
    v6 = [v4 initWithScopeIdentifier:v5 identifier:v7];

    [*(a1 + 40) addObject:v6];
    v3 = v7;
  }
}

+ (id)predicateForAssetsToCheckForDeletionOnCPLDisable
{
  v9[2] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 1}];
  v9[0] = v4;
  _syncablePredicate = [self _syncablePredicate];
  v9[1] = _syncablePredicate;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:2];
  v7 = [v3 andPredicateWithSubpredicates:v6];

  return v7;
}

+ (id)predicateForUploadableAssetsWithoutCloudLocalState:(signed __int16)state
{
  v12[3] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = MEMORY[0x1E696AE18];
  v5 = [MEMORY[0x1E696AD98] numberWithShort:state];
  v6 = [v4 predicateWithFormat:@"noindex:(%K) != %@", @"cloudLocalState", v5];
  v12[0] = v6;
  v7 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 0}];
  v12[1] = v7;
  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"trashedState", 2];
  v12[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:3];
  v10 = [v3 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateForUploadableAssetsWithCloudLocalStates:(id)states
{
  v10[3] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [self _predicateForCloudLocalStates:states];
  v10[0] = v4;
  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 0}];
  v10[1] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d", @"trashedState", 2];
  v10[2] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:3];
  v8 = [v3 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)_predicateForCloudLocalStates:(id)states
{
  v18 = *MEMORY[0x1E69E9840];
  statesCopy = states;
  array = [MEMORY[0x1E695DF70] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = statesCopy;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"cloudLocalState", *(*(&v13 + 1) + 8 * i), v13];
        [array addObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:array];

  return v11;
}

+ (id)predicateForUploadableAssetsWithCloudLocalState:(signed __int16)state
{
  v8[1] = *MEMORY[0x1E69E9840];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:state];
  v8[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:1];
  v6 = [self predicateForUploadableAssetsWithCloudLocalStates:v5];

  return v6;
}

+ (id)predicateForUploadableAssetsWithMasterCloudLocalStateNotEqualTo:(signed __int16)to
{
  v10[3] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d && %K != %d", @"master.cloudLocalState", to, @"master.cloudLocalState", 4];
  v10[0] = v4;
  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 1}];
  v10[1] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"$K != %d", @"trashedState", 2];
  v10[2] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:3];
  v8 = [v3 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders
{
  v2 = MEMORY[0x1E69BF328];
  maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders = [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders];

  return [v2 predicateForIncludeMask:maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders useIndex:0];
}

+ (id)predicateForSupportedAssetTypesForUpload
{
  v2 = MEMORY[0x1E69BF328];
  maskForAssetsEligibleForCloudKitTransport = [MEMORY[0x1E69BF328] maskForAssetsEligibleForCloudKitTransport];

  return [v2 predicateForIncludeMask:maskForAssetsEligibleForCloudKitTransport useIndex:0];
}

+ (id)objectsWithScopedIdentifiers:(id)identifiers forEntityName:(id)name prefetchResources:(BOOL)resources relationshipKeyPathsForPrefetching:(id)prefetching inLibrary:(id)library
{
  resourcesCopy = resources;
  v69[2] = *MEMORY[0x1E69E9840];
  identifiersCopy = identifiers;
  nameCopy = name;
  prefetchingCopy = prefetching;
  libraryCopy = library;
  if (identifiersCopy && ![identifiersCopy count])
  {
    v35 = MEMORY[0x1E695E0F0];
  }

  else
  {
    v14 = +[PLCloudMaster entityName];
    v15 = [nameCopy isEqualToString:v14];

    if ((v15 & 1) == 0)
    {
      v16 = +[PLManagedAsset entityName];
      v17 = [nameCopy isEqualToString:v16];

      if ((v17 & 1) == 0)
      {
        currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
        [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:3485 description:@"Entity name must be either Asset or CloudMaster."];
      }
    }

    if (identifiersCopy)
    {
      context = objc_autoreleasePoolPush();
      managedObjectContext = [libraryCopy managedObjectContext];
      v53 = [identifiersCopy _pl_filter:&__block_literal_global_414];

      v19 = MEMORY[0x1E696AEB0];
      v20 = NSStringFromSelector(sel_scopeIdentifier);
      v21 = [v19 sortDescriptorWithKey:v20 ascending:1];
      v69[0] = v21;
      v22 = MEMORY[0x1E696AEB0];
      v23 = NSStringFromSelector(sel_identifier);
      v24 = [v22 sortDescriptorWithKey:v23 ascending:1];
      v69[1] = v24;
      v25 = [MEMORY[0x1E695DEC8] arrayWithObjects:v69 count:2];
      v26 = [v53 sortedArrayUsingDescriptors:v25];

      array = [MEMORY[0x1E695DF70] array];
      array2 = [MEMORY[0x1E695DF70] array];
      v64[0] = 0;
      v64[1] = v64;
      v64[2] = 0x3032000000;
      v64[3] = __Block_byref_object_copy__51017;
      v64[4] = __Block_byref_object_dispose__51018;
      v65 = 0;
      v57[0] = MEMORY[0x1E69E9820];
      v57[1] = 3221225472;
      v57[2] = __129__PLManagedAsset_CPL__objectsWithScopedIdentifiers_forEntityName_prefetchResources_relationshipKeyPathsForPrefetching_inLibrary___block_invoke_2;
      v57[3] = &unk_1E756D7F8;
      v62 = v64;
      v29 = v26;
      v58 = v29;
      v48 = array;
      v59 = v48;
      v60 = libraryCopy;
      v63 = v15;
      v30 = array2;
      v61 = v30;
      [v29 enumerateObjectsUsingBlock:v57];
      v31 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v30];
      v32 = v31;
      if (v15)
      {
        v33 = v31;
        v34 = MEMORY[0x1E695D5E0];
        +[PLCloudMaster entityName];
      }

      else
      {
        v36 = MEMORY[0x1E696AB28];
        v68[0] = v31;
        predicateForSupportedAssetTypesForUpload = [self predicateForSupportedAssetTypesForUpload];
        v68[1] = predicateForSupportedAssetTypesForUpload;
        v38 = [MEMORY[0x1E695DEC8] arrayWithObjects:v68 count:2];
        v33 = [v36 andPredicateWithSubpredicates:v38];

        v34 = MEMORY[0x1E695D5E0];
        +[PLManagedAsset entityName];
      }
      v39 = ;
      v40 = [v34 fetchRequestWithEntityName:v39];

      [v40 setPredicate:v33];
      [v40 setFetchLimit:{objc_msgSend(v53, "count")}];
      if ([v53 count] >= 0x65)
      {
        [v40 setFetchBatchSize:100];
      }

      v41 = [MEMORY[0x1E695DFA8] setWithArray:prefetchingCopy];
      v42 = v41;
      if (resourcesCopy)
      {
        if (v15)
        {
          v43 = @"assets.modernResources";
        }

        else
        {
          [v41 addObject:@"modernResources"];
          v43 = @"master";
        }

        [v42 addObject:v43];
      }

      allObjects = [v42 allObjects];
      [v40 setRelationshipKeyPathsForPrefetching:allObjects];

      v56 = 0;
      v35 = [managedObjectContext executeFetchRequest:v40 error:&v56];
      v45 = v56;
      if (!v35 && (*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v46 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v67 = v45;
          _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_ERROR, "Could not fetch objects by scoped identifier: %@", buf, 0xCu);
        }
      }

      _Block_object_dispose(v64, 8);
      objc_autoreleasePoolPop(context);
      identifiersCopy = v53;
    }

    else
    {
      v35 = 0;
    }
  }

  return v35;
}

void __129__PLManagedAsset_CPL__objectsWithScopedIdentifiers_forEntityName_prefetchResources_relationshipKeyPathsForPrefetching_inLibrary___block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = [v5 scopeIdentifier];
  v32 = [v5 identifier];

  v7 = *(*(*(a1 + 64) + 8) + 40);
  if (v7)
  {
    v8 = [v7 isEqualToString:v6] ^ 1;
  }

  else
  {
    v8 = 0;
  }

  v9 = [*(a1 + 32) count] - 1;
  if ((v8 & 1) != 0 || v9 == a3)
  {
    if (v9 == a3)
    {
      [*(a1 + 40) addObject:v32];
    }

    v10 = v6;
    if (v8)
    {
      v10 = *(*(*(a1 + 64) + 8) + 40);
    }

    v11 = v10;
    v12 = [*(a1 + 48) mainScopeIdentifier];
    v13 = [v11 isEqualToString:v12];

    if (v13)
    {
      v14 = *(a1 + 72);
      v15 = MEMORY[0x1E696AE18];
      v16 = [*(a1 + 40) copy];
      v17 = v16;
      if (v14 == 1)
      {
        [v15 predicateWithFormat:@"cloudMasterGUID IN %@ AND noindex:(%K) == NULL AND noindex:(%K) == NULL", v16, @"momentShare", @"collectionShare", v31];
      }

      else
      {
        [v15 predicateWithFormat:@"%K IN %@ AND noindex:(%K) == NULL AND noindex:(%K) == NULL", @"cloudAssetGUID", v16, @"momentShare", @"collectionShare"];
      }

      goto LABEL_25;
    }

    v18 = [PLMomentShare scopeIdentifierPrefixInLibrary:*(a1 + 48)];
    v19 = [v11 hasPrefix:v18];

    if (v19)
    {
      v20 = *(a1 + 72);
      v21 = MEMORY[0x1E696AE18];
      v17 = [*(a1 + 40) copy];
      if (v20 == 1)
      {
        v30 = v11;
        v22 = @"momentShare.scopeIdentifier";
LABEL_20:
        [v21 predicateWithFormat:@"cloudMasterGUID IN %@ AND %K == %@", v17, v22, v30, v31];
        v27 = LABEL_25:;

        goto LABEL_26;
      }

      v26 = @"momentShare.scopeIdentifier";
    }

    else
    {
      v23 = [PLCollectionShare scopeIdentifierPrefixInLibrary:*(a1 + 48)];
      v24 = [v11 hasPrefix:v23];

      if (!v24)
      {
        v27 = [MEMORY[0x1E696AE18] predicateWithValue:0];
LABEL_26:
        [*(a1 + 56) addObject:v27];
        [*(a1 + 40) removeAllObjects];

        goto LABEL_27;
      }

      v25 = *(a1 + 72);
      v21 = MEMORY[0x1E696AE18];
      v17 = [*(a1 + 40) copy];
      if (v25 == 1)
      {
        v30 = v11;
        v22 = @"collectionShare.scopeIdentifier";
        goto LABEL_20;
      }

      v26 = @"collectionShare.scopeIdentifier";
    }

    [v21 predicateWithFormat:@"%K IN %@ AND %K == %@", @"cloudAssetGUID", v17, v26, v11];
    goto LABEL_25;
  }

LABEL_27:
  [*(a1 + 40) addObject:v32];
  v28 = *(*(a1 + 64) + 8);
  v29 = *(v28 + 40);
  *(v28 + 40) = v6;
}

uint64_t __129__PLManagedAsset_CPL__objectsWithScopedIdentifiers_forEntityName_prefetchResources_relationshipKeyPathsForPrefetching_inLibrary___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

+ (id)assetsWithScopedIdentifiers:(id)identifiers prefetchResources:(BOOL)resources relationshipKeyPathsForPrefetching:(id)prefetching inLibrary:(id)library
{
  resourcesCopy = resources;
  libraryCopy = library;
  prefetchingCopy = prefetching;
  identifiersCopy = identifiers;
  v13 = +[PLManagedAsset entityName];
  v14 = [self objectsWithScopedIdentifiers:identifiersCopy forEntityName:v13 prefetchResources:resourcesCopy relationshipKeyPathsForPrefetching:prefetchingCopy inLibrary:libraryCopy];

  return v14;
}

+ (PLManagedAsset)assetWithScopedIdentifier:(id)identifier inLibrary:(id)library prefetchResources:(BOOL)resources
{
  resourcesCopy = resources;
  v16 = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  v8 = MEMORY[0x1E695DEC8];
  libraryCopy = library;
  identifierCopy2 = identifier;
  v11 = [v8 arrayWithObjects:&identifierCopy count:1];

  v12 = [self assetsWithScopedIdentifiers:v11 prefetchResources:resourcesCopy relationshipKeyPathsForPrefetching:0 inLibrary:{libraryCopy, identifierCopy, v16}];

  firstObject = [v12 firstObject];

  return firstObject;
}

+ (id)assetsByScopedIdentifiers:(id)identifiers relationshipKeyPathsForPrefetching:(id)prefetching inLibrary:(id)library
{
  v5 = [self assetsWithScopedIdentifiers:identifiers prefetchResources:0 relationshipKeyPathsForPrefetching:prefetching inLibrary:library];
  v6 = [v5 _pl_indexBy:&__block_literal_global_408_51479];

  return v6;
}

+ (id)assetsByCloudAssetUUID:(id)d inLibrary:(id)library
{
  v24 = *MEMORY[0x1E69E9840];
  dCopy = d;
  libraryCopy = library;
  v8 = [MEMORY[0x1E695DF90] dictionaryWithCapacity:{objc_msgSend(dCopy, "count")}];
  context = objc_autoreleasePoolPush();
  v9 = [MEMORY[0x1E6994BB8] scopedIdentifiersFromArrayOfUnknownIdentifiers:dCopy];
  v10 = [self assetsWithScopedIdentifiers:v9 prefetchResources:0 relationshipKeyPathsForPrefetching:0 inLibrary:libraryCopy];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v11 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v11)
  {
    v12 = v11;
    v13 = *v20;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v20 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v19 + 1) + 8 * i);
        cloudAssetGUID = [v15 cloudAssetGUID];
        [v8 setObject:v15 forKey:cloudAssetGUID];
      }

      v12 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v12);
  }

  objc_autoreleasePoolPop(context);

  return v8;
}

+ (void)markMomentShareAndCollectionShareAssetsAsCopied:(id)copied
{
  v92 = *MEMORY[0x1E69E9840];
  copiedCopy = copied;
  if ([copiedCopy count])
  {
    firstObject = [copiedCopy firstObject];
    photoLibrary = [firstObject photoLibrary];

    v68 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(copiedCopy, "count")}];
    dictionary = [MEMORY[0x1E695DF90] dictionary];
    dictionary2 = [MEMORY[0x1E695DF90] dictionary];
    v81 = 0u;
    v82 = 0u;
    v83 = 0u;
    v84 = 0u;
    v63 = copiedCopy;
    obj = copiedCopy;
    v5 = [obj countByEnumeratingWithState:&v81 objects:v91 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v82;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v82 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v9 = *(*(&v81 + 1) + 8 * i);
          v10 = objc_autoreleasePoolPush();
          v80 = 0;
          v11 = [v9 originalStableHashCacheIfNecessaryAndAdjustedStableHash:&v80 fullsizeRenderImageIfNecessary:0 enableSaveIfNecessary:1 error:0];
          v12 = v80;
          if (v11)
          {
            if (v12)
            {
              v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@", @"adjustedStableHash", v12];
              v14 = dictionary2;
              v15 = v9;
              v16 = v12;
            }

            else
            {
              v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@", @"originalStableHash", v11];
              v14 = dictionary;
              v15 = v9;
              v16 = v11;
            }

            [v14 setObject:v15 forKeyedSubscript:v16];
            isCPLSharingScopeAsset = [v9 isCPLSharingScopeAsset];
            v18 = MEMORY[0x1E69BF328];
            if (isCPLSharingScopeAsset)
            {
              maskForUserLibrary = [MEMORY[0x1E69BF328] maskForUserLibrary];
            }

            else
            {
              maskForUserLibrary = [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLSharingScopes];
            }

            v20 = [v18 predicateForIncludeMask:maskForUserLibrary useIndex:0 keyPathPrefix:@"asset"];
            v21 = MEMORY[0x1E696AB28];
            v90[0] = v13;
            v90[1] = v20;
            v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v90 count:2];
            v23 = [v21 andPredicateWithSubpredicates:v22];

            [v68 addObject:v23];
          }

          objc_autoreleasePoolPop(v10);
        }

        v6 = [obj countByEnumeratingWithState:&v81 objects:v91 count:16];
      }

      while (v6);
    }

    v24 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v68];
    v25 = MEMORY[0x1E695D5E0];
    v26 = +[PLAdditionalAssetAttributes entityName];
    v27 = [v25 fetchRequestWithEntityName:v26];

    [v27 setPredicate:v24];
    v89 = @"asset";
    v28 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v89 count:1];
    [v27 setRelationshipKeyPathsForPrefetching:v28];

    managedObjectContext = [photoLibrary managedObjectContext];
    v79 = 0;
    v30 = [managedObjectContext executeFetchRequest:v27 error:&v79];
    v31 = v79;

    if (v30)
    {
      v59 = v31;
      v61 = v27;
      v62 = v24;
      obja = [MEMORY[0x1E695DFA8] set];
      v75 = 0u;
      v76 = 0u;
      v77 = 0u;
      v78 = 0u;
      v60 = v30;
      v32 = v30;
      v33 = [v32 countByEnumeratingWithState:&v75 objects:v86 count:16];
      if (!v33)
      {
        goto LABEL_35;
      }

      v34 = v33;
      v35 = *v76;
      while (1)
      {
        for (j = 0; j != v34; ++j)
        {
          if (*v76 != v35)
          {
            objc_enumerationMutation(v32);
          }

          asset = [*(*(&v75 + 1) + 8 * j) asset];
          v74 = 0;
          v38 = [asset originalStableHashCacheIfNecessaryAndAdjustedStableHash:&v74 fullsizeRenderImageIfNecessary:0 enableSaveIfNecessary:1 error:0];
          v39 = v74;
          if (v39)
          {
            v40 = dictionary2;
            v41 = v39;
          }

          else
          {
            v40 = dictionary;
            v41 = v38;
          }

          v42 = [v40 objectForKeyedSubscript:v41];
          v43 = v42;
          if (v42)
          {
            if ([v42 isCPLSharingScopeAsset] && (objc_msgSend(v43, "shareRelationship"), v44 = objc_claimAutoreleasedReturnValue(), v45 = objc_msgSend(v44, "status"), v44, v45 != 1))
            {
              v48 = obja;
              v49 = v43;
            }

            else
            {
              shareRelationship = [asset shareRelationship];
              status = [shareRelationship status];

              if (status == 1)
              {
                goto LABEL_33;
              }

              v48 = obja;
              v49 = asset;
            }

            [v48 addObject:v49];
          }

LABEL_33:
        }

        v34 = [v32 countByEnumeratingWithState:&v75 objects:v86 count:16];
        if (!v34)
        {
LABEL_35:

          v72 = 0u;
          v73 = 0u;
          v70 = 0u;
          v71 = 0u;
          v50 = obja;
          v51 = [v50 countByEnumeratingWithState:&v70 objects:v85 count:16];
          if (v51)
          {
            v52 = v51;
            v53 = *v71;
            v54 = MEMORY[0x1E6994D48];
            do
            {
              for (k = 0; k != v52; ++k)
              {
                if (*v71 != v53)
                {
                  objc_enumerationMutation(v50);
                }

                v56 = *(*(&v70 + 1) + 8 * k);
                additionalAttributes = [v56 additionalAttributes];
                [additionalAttributes setDestinationAssetCopyState:2];

                if ((*v54 & 1) == 0)
                {
                  v58 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v58, OS_LOG_TYPE_DEBUG))
                  {
                    *buf = 67109378;
                    *v88 = 2;
                    *&v88[4] = 2112;
                    *&v88[6] = v56;
                    _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_DEBUG, "Setting destinationAssetCopyState %d for asset %@", buf, 0x12u);
                  }
                }
              }

              v52 = [v50 countByEnumeratingWithState:&v70 objects:v85 count:16];
            }

            while (v52);
          }

          v27 = v61;
          v24 = v62;
          v31 = v59;
          v30 = v60;
          goto LABEL_50;
        }
      }
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v50 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
      {
        *buf = 138543618;
        *v88 = v24;
        *&v88[8] = 2112;
        *&v88[10] = v31;
        _os_log_impl(&dword_19BF1F000, v50, OS_LOG_TYPE_ERROR, "Failed to fetch assets with same fingerprint with predicate: %{public}@, error: %@", buf, 0x16u);
      }

LABEL_50:
    }

    copiedCopy = v63;
  }
}

+ (id)listOfSharingRelationshipsRelevantForUpload
{
  pl_dispatch_once();
  v2 = listOfSharingRelationshipsRelevantForUpload_result;

  return v2;
}

void __66__PLManagedAsset_CPL__listOfSharingRelationshipsRelevantForUpload__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E695DEC8]) initWithObjects:{@"libraryScope", @"libraryScopeAssetContributors", 0}];
  v1 = listOfSharingRelationshipsRelevantForUpload_result;
  listOfSharingRelationshipsRelevantForUpload_result = v0;
}

+ (id)listOfSharingAttributesRelevantForUpload
{
  pl_dispatch_once();
  v2 = listOfSharingAttributesRelevantForUpload_result;

  return v2;
}

void __63__PLManagedAsset_CPL__listOfSharingAttributesRelevantForUpload__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E695DEC8]) initWithObjects:{@"libraryScopeShareState", 0}];
  v1 = listOfSharingAttributesRelevantForUpload_result;
  listOfSharingAttributesRelevantForUpload_result = v0;
}

+ (id)listOfSyncedProperties
{
  pl_dispatch_once();
  v2 = listOfSyncedProperties_result_51506;

  return v2;
}

void __45__PLManagedAsset_CPL__listOfSyncedProperties__block_invoke(uint64_t a1)
{
  v6 = [objc_alloc(MEMORY[0x1E695DF70]) initWithObjects:{@"favorite", @"lastSharedDate", @"addedDate", @"dateCreated", @"locationData", 0x1F0F09000, @"title", @"visibilityState", @"avalancheUUID", @"avalanchePickType", @"kindSubtype", @"hdrType", @"trashedState", @"trashedDate", @"mediaGroupUUID", @"videoCpDurationValue", @"videoCpVisibilityState", @"sortToken", @"adjustmentsState", @"orientation", @"duration", @"deferredProcessingNeeded", @"cameraProcessingAdjustmentState", @"videoDeferredProcessingNeeded", @"savedAssetType", 0}];
  if ((_os_feature_enabled_impl() & 1) == 0)
  {
    [v6 addObject:@"trashedByParticipant"];
    v2 = [*(a1 + 32) listOfSharingAttributesRelevantForUpload];
    [v6 addObjectsFromArray:v2];

    v3 = [*(a1 + 32) listOfSharingRelationshipsRelevantForUpload];
    [v6 addObjectsFromArray:v3];
  }

  v4 = [v6 copy];
  v5 = listOfSyncedProperties_result_51506;
  listOfSyncedProperties_result_51506 = v4;
}

+ (void)fixMissingOriginalTimezoneIfNeededForAsset:(id)asset
{
  v20 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  if (PLPlatformExtendedAttributesSupported())
  {
    v4 = [assetCopy extendedAttributesCreateIfNeeded:1];
    dateCreated = [v4 dateCreated];
    timezoneOffset = [v4 timezoneOffset];
    if (timezoneOffset)
    {

LABEL_12:
      goto LABEL_13;
    }

    timezoneName = [v4 timezoneName];

    if (timezoneName)
    {
      goto LABEL_12;
    }

    additionalAttributes = [assetCopy additionalAttributes];
    timeZoneName = [additionalAttributes timeZoneName];
    if (timeZoneName)
    {
    }

    else
    {
      additionalAttributes2 = [assetCopy additionalAttributes];
      timeZoneOffset = [additionalAttributes2 timeZoneOffset];

      if (!timeZoneOffset)
      {
        if (!dateCreated)
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_12;
          }

          localTimeZone = __CPLAssetsdOSLogDomain();
          if (!os_log_type_enabled(localTimeZone, OS_LOG_TYPE_DEBUG))
          {
            goto LABEL_11;
          }

          uuid = [assetCopy uuid];
          v18 = 138543362;
          v19 = uuid;
          _os_log_impl(&dword_19BF1F000, localTimeZone, OS_LOG_TYPE_DEBUG, "Unable to set original timezone for asset: %{public}@", &v18, 0xCu);
LABEL_10:

LABEL_11:
          goto LABEL_12;
        }

        localTimeZone = [MEMORY[0x1E695DFE8] localTimeZone];
        name = [localTimeZone name];
        [v4 setTimezoneName:name];

        timeZoneOffset2 = [MEMORY[0x1E696AD98] numberWithInteger:{-[NSObject secondsFromGMTForDate:](localTimeZone, "secondsFromGMTForDate:", dateCreated)}];
LABEL_9:
        uuid = timeZoneOffset2;
        [v4 setTimezoneOffset:timeZoneOffset2];
        goto LABEL_10;
      }
    }

    additionalAttributes3 = [assetCopy additionalAttributes];
    timeZoneName2 = [additionalAttributes3 timeZoneName];
    [v4 setTimezoneName:timeZoneName2];

    localTimeZone = [assetCopy additionalAttributes];
    timeZoneOffset2 = [localTimeZone timeZoneOffset];
    goto LABEL_9;
  }

LABEL_13:
}

+ (void)fixMissingOriginalDateCreatedIfNeededForAsset:(id)asset withCloudMaster:(id)master
{
  assetCopy = asset;
  masterCopy = master;
  if (PLPlatformExtendedAttributesSupported())
  {
    v6 = [assetCopy extendedAttributesCreateIfNeeded:1];
    dateCreated = [v6 dateCreated];

    if (!dateCreated)
    {
      creationDate = [masterCopy creationDate];
      if (creationDate)
      {
        [v6 setDateCreated:creationDate];
        additionalAttributes = [assetCopy additionalAttributes];
        [additionalAttributes setDateCreatedSource:3];
      }
    }
  }
}

+ (void)processMediaMetadataForAsset:(id)asset withCloudMaster:(id)master
{
  v47 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  masterCopy = master;
  mediaMetadata = [masterCopy mediaMetadata];
  v8 = [mediaMetadata valueForKey:@"data"];

  if (v8)
  {
    v42 = 0;
    v9 = [MEMORY[0x1E696AE40] propertyListWithData:v8 options:0 format:0 error:&v42];
    v10 = v42;
    if (v9)
    {
      objc_opt_class();
      managedObjectContext = [assetCopy managedObjectContext];
      if (objc_opt_isKindOfClass())
      {
        v12 = managedObjectContext;
      }

      else
      {
        v12 = 0;
      }

      v13 = v12;

      kind = [assetCopy kind];
      if (kind <= 1)
      {
        if (kind)
        {
          v15 = [MEMORY[0x1E6987E28] assetProxyWithPropertyList:v9];
          if (v15)
          {
            v39 = v10;
            [assetCopy setVideoInfoOnMasterFromAVAsset:v15];
            v16 = objc_alloc(MEMORY[0x1E69C0718]);
            pl_libraryBundle = [v13 pl_libraryBundle];
            timeZoneLookup = [pl_libraryBundle timeZoneLookup];
            cloudAssetGUID5 = [v16 initWithAVAsset:v15 timeZoneLookup:timeZoneLookup];

            [assetCopy updateVideoAttributesFromMetadata:cloudAssetGUID5 overwriteOriginalProperties:1];
            if ([assetCopy cameraProcessingAdjustmentState])
            {
              spatialOverCaptureIdentifier = [cloudAssetGUID5 spatialOverCaptureIdentifier];
              if (spatialOverCaptureIdentifier)
              {
                additionalAttributes = [assetCopy additionalAttributes];
                [additionalAttributes setSpatialOverCaptureGroupIdentifier:spatialOverCaptureIdentifier];
              }
            }

            if (PLPlatformExtendedAttributesSupported())
            {
              [assetCopy updateVideoExtendedAttributesFromMetadata:cloudAssetGUID5];
            }

            v10 = v39;
          }

          else
          {
            if ([assetCopy isCPLSharingScopeAsset])
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v33 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
                {
                  cloudAssetGUID = [assetCopy cloudAssetGUID];
                  *buf = 138412290;
                  v44 = cloudAssetGUID;
                  _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_ERROR, "Shared video asset with invalid mediaProperties detected, clearing mediaMetadata on CMM master with GUID %@", buf, 0xCu);
                }
              }

              mediaMetadata2 = [masterCopy mediaMetadata];
              [mediaMetadata2 setValue:0 forKey:@"data"];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v36 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
              {
                cloudAssetGUID2 = [assetCopy cloudAssetGUID];
                *buf = 138412290;
                v44 = cloudAssetGUID2;
                _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "Video asset with invalid mediaProperties detected with GUID %@", buf, 0xCu);
              }
            }

            cloudAssetGUID5 = 0;
          }

LABEL_40:

          goto LABEL_41;
        }

        v22 = objc_alloc(MEMORY[0x1E69C0718]);
        v23 = MEMORY[0x1E69C08F0];
        [assetCopy uniformTypeIdentifier];
        v24 = v40 = v10;
        v25 = [v23 typeWithIdentifier:v24];
        pl_libraryBundle2 = [v13 pl_libraryBundle];
        timeZoneLookup2 = [pl_libraryBundle2 timeZoneLookup];
        cloudAssetGUID5 = [v22 initWithImageSourceProxyOrEncodedImagePropertyData:v8 contentType:v25 timeZoneLookup:timeZoneLookup2];

        v10 = v40;
        [assetCopy setImageInfoFromOriginalImageMetadata:cloudAssetGUID5];
LABEL_41:

        goto LABEL_42;
      }

      if (kind == 2)
      {
        if (PLPlatformExtendedAttributesSupported())
        {
          cloudAssetGUID5 = [MEMORY[0x1E6987E28] assetProxyWithPropertyList:v9];
          if (cloudAssetGUID5)
          {
            v28 = objc_alloc(MEMORY[0x1E69C0718]);
            [v13 pl_libraryBundle];
            v29 = v41 = v10;
            timeZoneLookup3 = [v29 timeZoneLookup];
            v15 = [v28 initWithAVAsset:cloudAssetGUID5 timeZoneLookup:timeZoneLookup3];

            v10 = v41;
            [assetCopy updateAudioExtendedAttributesFromMetadata:v15];
          }

          else
          {
            if (*MEMORY[0x1E6994D48])
            {
              cloudAssetGUID5 = 0;
              goto LABEL_41;
            }

            v15 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
            {
              cloudAssetGUID3 = [assetCopy cloudAssetGUID];
              *buf = 138412290;
              v44 = cloudAssetGUID3;
              _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Audio asset with invalid mediaProperties detected with GUID %@", buf, 0xCu);
            }
          }

          goto LABEL_40;
        }
      }

      else if (kind != 3)
      {
        goto LABEL_42;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        cloudAssetGUID5 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(cloudAssetGUID5, OS_LOG_TYPE_ERROR))
        {
          cloudAssetGUID4 = [assetCopy cloudAssetGUID];
          kind2 = [assetCopy kind];
          *buf = 138412546;
          v44 = cloudAssetGUID4;
          v45 = 1024;
          LODWORD(v46) = kind2;
          _os_log_impl(&dword_19BF1F000, cloudAssetGUID5, OS_LOG_TYPE_ERROR, "Media properties on unexpected asset kind with GUID %@, kind %d", buf, 0x12u);
        }

        goto LABEL_41;
      }
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_43:

        goto LABEL_44;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        cloudAssetGUID5 = [assetCopy cloudAssetGUID];
        *buf = 138543618;
        v44 = cloudAssetGUID5;
        v45 = 2112;
        v46 = v10;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Media metadata for asset asset %{public}@ failed to decode: error: %@", buf, 0x16u);
        goto LABEL_41;
      }
    }

LABEL_42:

    goto LABEL_43;
  }

LABEL_44:
}

+ (void)processAdjustedMediaMetadataForAsset:(id)asset
{
  assetCopy = asset;
  if (![assetCopy kind])
  {
    v3 = [assetCopy fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:0];
    if (v3)
    {
      [assetCopy setSpatialTypeFromMetadata:v3];
    }
  }

  [assetCopy updateAssetPropertiesFromAdjustmentFile];
}

+ (void)fixupCloudPhotoLibraryAsset:(id)asset withCloudMaster:(id)master inLibrary:(id)library
{
  assetCopy = asset;
  masterCopy = master;
  libraryCopy = library;
  if (!masterCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:2612 description:{@"Invalid parameter not satisfying: %@", @"cloudMaster"}];
  }

  if ([masterCopy cloudLocalState] != 3)
  {
    [masterCopy setCloudLocalState:3];
  }

  if ([assetCopy cloudLocalState] != 1)
  {
    [assetCopy setCloudLocalState:1];
  }

  [assetCopy _applyPropertiesFromCloudMaster:masterCopy];
  managedObjectContext = [libraryCopy managedObjectContext];
  [assetCopy rm_createMasterResourcesIn:masterCopy inManagedObjectContext:managedObjectContext];
}

+ (id)createCloudPhotoLibraryAssetWithAssetRecord:(id)record withCloudMaster:(id)master inLibrary:(id)library
{
  v48 = *MEMORY[0x1E69E9840];
  recordCopy = record;
  masterCopy = master;
  libraryCopy = library;
  v12 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v13 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      v47 = recordCopy;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEBUG, "Creating asset with CPLAssetChange %@", buf, 0xCu);
    }
  }

  scopedIdentifier = [recordCopy scopedIdentifier];
  v44 = 0;
  v15 = [PLShare getShareIfNecessary:&v44 forCPLRecordWithClass:objc_opt_class() scopedIdentifier:scopedIdentifier inLibrary:libraryCopy];
  v16 = v44;
  v17 = 0;
  if (!v15)
  {
    goto LABEL_28;
  }

  LOWORD(v42) = 257;
  v17 = +[PLManagedAsset insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:](PLManagedAsset, "insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:", libraryCopy, 0, 0, [MEMORY[0x1E69BF328] savedAssetTypeForCloudPhotoLibraryAsset], 0, 0, 0, 0, 0, v42);
  identifier = [scopedIdentifier identifier];
  [v17 setCloudAssetGUID:?];
  subclassKind = [objc_opt_class() subclassKind];
  if (subclassKind <= 1)
  {
    if (subclassKind)
    {
      [v17 setMomentShare:v16];
      [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForMomentSharedAsset")}];
      [v17 setBundleScope:1];
      additionalAttributes = [v17 additionalAttributes];
      [additionalAttributes setShareType:1];

      additionalAttributes2 = [v17 additionalAttributes];
      owner = [v16 owner];
      [owner userIdentifier];
      v23 = v22 = v12;
      [additionalAttributes2 setShareOriginator:v23];

      v12 = v22;
    }

    else
    {
      [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForCloudPhotoLibraryAsset")}];
    }

    goto LABEL_17;
  }

  if (subclassKind == 2)
  {
    [MEMORY[0x1E696AAA8] currentHandler];
    v34 = v33 = v12;
    [v34 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:2595 description:{@"Asset cannot have library scope scopes %@", recordCopy}];

    v12 = v33;
    goto LABEL_17;
  }

  if (subclassKind != 3)
  {
LABEL_17:
    [v17 setCloudLocalState:1];
    if (masterCopy)
    {
      v35 = objc_autoreleasePoolPush();
      [v17 _applyPropertiesFromCloudMaster:masterCopy];
      managedObjectContext = [libraryCopy managedObjectContext];
      [v17 rm_createMasterResourcesIn:masterCopy inManagedObjectContext:managedObjectContext];

      objc_autoreleasePoolPop(v35);
    }

    else if ((*v12 & 1) == 0)
    {
      v37 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v47 = v17;
        _os_log_impl(&dword_19BF1F000, v37, OS_LOG_TYPE_ERROR, "Unable to find matching cloud master for %@", buf, 0xCu);
      }
    }

    if ((*v12 & 1) == 0)
    {
      v38 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412290;
        v47 = v17;
        _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_DEBUG, "Created asset %@", buf, 0xCu);
      }
    }

LABEL_28:
    v17 = v17;
    v39 = v17;
    goto LABEL_29;
  }

  contributorUserIdentifier = [recordCopy contributorUserIdentifier];

  if (contributorUserIdentifier)
  {
    contributorUserIdentifier2 = [recordCopy contributorUserIdentifier];
    v45 = contributorUserIdentifier2;
    v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v45 count:1];
    v27 = [PLShareParticipant participantsWithUserIdentifiers:v26 inScope:v16 inPhotoLibrary:libraryCopy];

    if ([v27 count])
    {
      firstObject = [v27 firstObject];
      [v17 setCollectionShare:v16 withContributor:firstObject];
    }

    [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForCollectionShareAsset")}];
    [v17 setBundleScope:5];
    additionalAttributes3 = [v17 additionalAttributes];
    [additionalAttributes3 setShareType:3];

    additionalAttributes4 = [v17 additionalAttributes];
    owner2 = [v16 owner];
    userIdentifier = [owner2 userIdentifier];
    [additionalAttributes4 setShareOriginator:userIdentifier];

    v12 = MEMORY[0x1E6994D48];
    goto LABEL_17;
  }

  currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
  [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:2583 description:{@"Attempting to insert a collection share asset from CPL without contributor info %@", recordCopy}];

  v39 = 0;
LABEL_29:

  return v39;
}

+ (id)_cloudAdjustmentFingerprintWithAdjustmentDataBlob:(id)blob largeAdjustmentBlobFingerpint:(id)fingerpint formatIdentifier:(id)identifier formatVersion:(id)version editorBundleID:(id)d baseVersion:(int64_t)baseVersion baseImageData:(id)data baseImageFingerprint:(id)self0
{
  v32 = *MEMORY[0x1E69E9840];
  blobCopy = blob;
  fingerpintCopy = fingerpint;
  identifierCopy = identifier;
  versionCopy = version;
  dCopy = d;
  dataCopy = data;
  fingerprintCopy = fingerprint;
  v21 = objc_alloc_init(MEMORY[0x1E69C0658]);
  [v21 setAdjustmentType:identifierCopy];
  [v21 setAdjustmentCompoundVersion:versionCopy];
  [v21 setAdjustmentCreatorCode:dCopy];
  v22 = baseVersion == 1;
  [v21 setAdjustmentSourceType:v22];
  if (fingerpintCopy)
  {
    [v21 setLargeAdjustmentDataFingerprint:fingerpintCopy];
  }

  else
  {
    v23 = [blobCopy length];
    if (v23 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
      [v21 setSimpleAdjustmentData:blobCopy];
    }

    else
    {
      [v21 setLargeAdjustmentData:blobCopy];
    }
  }

  if (fingerprintCopy)
  {
    [v21 setBaseImageFingerprint:fingerprintCopy];
  }

  else
  {
    [v21 setBaseImage:dataCopy];
  }

  v24 = [PLDescriptionBuilder prettyMultiLineDescriptionBuilderWithObject:v21 indent:0];
  [v24 appendName:@"formatIdentifier" object:identifierCopy];
  [v24 appendName:@"formatVersion" object:versionCopy];
  [v24 appendName:@"editorBundleID" object:dCopy];
  [v24 appendName:@"sourceType" integerValue:v22];
  if (fingerpintCopy)
  {
    [v24 appendName:@"largeAdjustmentBlobFingerprint" object:fingerpintCopy];
    if (fingerprintCopy)
    {
LABEL_11:
      [v24 appendName:@"baseImageFingerprint" object:fingerprintCopy];
      goto LABEL_14;
    }
  }

  else
  {
    [v24 appendName:@"adjustmentBlobLength" unsignedIntegerValue:{objc_msgSend(blobCopy, "length")}];
    if (fingerprintCopy)
    {
      goto LABEL_11;
    }
  }

  [v24 appendName:@"baseImageDataLength" unsignedIntegerValue:{objc_msgSend(dataCopy, "length")}];
LABEL_14:
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v25 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
    {
      build = [v24 build];
      *buf = 138412290;
      v31 = build;
      _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Calculating cloud adjustment fingerprint with the following parts: %@", buf, 0xCu);
    }
  }

  v27 = [MEMORY[0x1E69C0660] fingerprintWithAssetAdjustmentFingerprintData:v21];

  return v27;
}

+ (id)_predicateForAssetsWithNotCompleteResourcesOnResource
{
  pl_dispatch_once();
  v2 = _predicateForAssetsWithNotCompleteResourcesOnResource_predicate;

  return v2;
}

void __76__PLManagedAsset_CPL___predicateForAssetsWithNotCompleteResourcesOnResource__block_invoke()
{
  v27[2] = *MEMORY[0x1E69E9840];
  v0 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v23 = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset.master == NULL"];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset.master != NULL"];
  v2 = MEMORY[0x1E696AE18];
  v3 = +[PLInternalResource originalCPLResourceTypesForMaster];
  v4 = [v2 predicateWithFormat:@"dataStoreClassID == %d AND dataStoreSubtype IN %@ AND version == %d AND localAvailability <= %d", 0, v3, 0, 0xFFFFFFFFLL];

  v5 = MEMORY[0x1E696AB28];
  v27[0] = v1;
  v27[1] = v4;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v27 count:2];
  v7 = [v5 andPredicateWithSubpredicates:v6];

  v8 = MEMORY[0x1E696AB28];
  v26[0] = v23;
  v26[1] = v7;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:2];
  v10 = [v8 orPredicateWithSubpredicates:v9];
  [v0 addObject:v10];

  v11 = [PLManagedAsset predicateForAdjustedAssetsWithKeyPathToAsset:@"asset"];
  v12 = MEMORY[0x1E696AE18];
  v13 = +[PLInternalResource originalCPLResourceTypesForAsset];
  v14 = [v12 predicateWithFormat:@"dataStoreClassID == %d AND dataStoreSubtype IN %@ AND version IN %@ AND localAvailability <= %d", 0, v13, &unk_1F0FBFC58, 0xFFFFFFFFLL];

  v15 = MEMORY[0x1E696AB28];
  v25[0] = v11;
  v25[1] = v14;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:2];
  v17 = [v15 andPredicateWithSubpredicates:v16];

  v18 = MEMORY[0x1E696AB28];
  v24 = v17;
  v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v24 count:1];
  v20 = [v18 orPredicateWithSubpredicates:v19];
  [v0 addObject:v20];

  v21 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v0];
  v22 = _predicateForAssetsWithNotCompleteResourcesOnResource_predicate;
  _predicateForAssetsWithNotCompleteResourcesOnResource_predicate = v21;
}

+ (id)predicateForAssetsWithCompleteResourcesOnAsset
{
  pl_dispatch_once();
  v2 = predicateForAssetsWithCompleteResourcesOnAsset_predicate;

  return v2;
}

void __69__PLManagedAsset_CPL__predicateForAssetsWithCompleteResourcesOnAsset__block_invoke()
{
  v24[2] = *MEMORY[0x1E69E9840];
  v0 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v19 = [MEMORY[0x1E696AE18] predicateWithFormat:@"master == NULL"];
  v20 = [MEMORY[0x1E696AE18] predicateWithFormat:@"master != NULL"];
  v1 = +[PLInternalResource predicateForAllOriginalResourcesLocallyAvailable];
  v2 = MEMORY[0x1E696AB28];
  v24[0] = v20;
  v24[1] = v1;
  v3 = [MEMORY[0x1E695DEC8] arrayWithObjects:v24 count:2];
  v4 = [v2 andPredicateWithSubpredicates:v3];

  v5 = MEMORY[0x1E696AB28];
  v23[0] = v19;
  v23[1] = v4;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v23 count:2];
  v7 = [v5 orPredicateWithSubpredicates:v6];
  [v0 addObject:v7];

  v8 = [PLManagedAsset predicateForUnadjustedAssetsWithKeyPathToAsset:0];
  v9 = [PLManagedAsset predicateForAdjustedAssetsWithKeyPathToAsset:0];
  v10 = +[PLInternalResource predicateForAllFullSizeResourcesLocallyAvailable];
  v11 = MEMORY[0x1E696AB28];
  v22[0] = v9;
  v22[1] = v10;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v22 count:2];
  v13 = [v11 andPredicateWithSubpredicates:v12];

  v14 = MEMORY[0x1E696AB28];
  v21[0] = v8;
  v21[1] = v13;
  v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v21 count:2];
  v16 = [v14 orPredicateWithSubpredicates:v15];
  [v0 addObject:v16];

  v17 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v0];
  v18 = predicateForAssetsWithCompleteResourcesOnAsset_predicate;
  predicateForAssetsWithCompleteResourcesOnAsset_predicate = v17;
}

+ (void)countOfAssetsWithRequiredResourcesNotLocallyAvailableInLibrary:(id)library outCount:(unint64_t *)count photoCount:(unint64_t *)photoCount videoCount:(unint64_t *)videoCount
{
  v22[2] = *MEMORY[0x1E69E9840];
  v10 = MEMORY[0x1E69BF328];
  libraryCopy = library;
  v12 = [v10 predicateForIncludeMask:objc_msgSend(v10 useIndex:"maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders") keyPathPrefix:{0, @"asset"}];
  v13 = +[PLManagedAsset _predicateForAssetsWithNotCompleteResourcesOnResource];
  v14 = MEMORY[0x1E696AB28];
  v22[0] = v12;
  v22[1] = v13;
  v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v22 count:2];
  v16 = [v14 andPredicateWithSubpredicates:v15];

  managedObjectContext = [libraryCopy managedObjectContext];

  v18 = [self _countOfAssetsByKindWithResourcePredicate:v16 inContext:managedObjectContext];

  if (v18)
  {
    v19 = [self _sumOfCountsInCountedSet:v18];
    v20 = [v18 countForObject:&unk_1F0FBCC40];
    v21 = [v18 countForObject:&unk_1F0FBCC58];
    if (!count)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v21 = 0;
  v20 = 0;
  v19 = 0;
  if (count)
  {
LABEL_3:
    *count = v19;
  }

LABEL_4:
  if (photoCount)
  {
    *photoCount = v20;
  }

  if (videoCount)
  {
    *videoCount = v21;
  }
}

+ (id)_countOfAssetsByKindWithResourcePredicate:(id)predicate inContext:(id)context
{
  v35[1] = *MEMORY[0x1E69E9840];
  predicateCopy = predicate;
  contextCopy = context;
  v7 = MEMORY[0x1E695D5E0];
  v8 = +[PLInternalResource entityName];
  v9 = [v7 fetchRequestWithEntityName:v8];

  v35[0] = @"asset";
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v35 count:1];
  [v9 setRelationshipKeyPathsForPrefetching:v10];

  [v9 setPredicate:predicateCopy];
  v34[0] = @"asset";
  v34[1] = @"asset.kind";
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v34 count:2];
  [v9 setPropertiesToGroupBy:v11];

  v33 = @"asset.kind";
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v33 count:1];
  [v9 setPropertiesToFetch:v12];

  [v9 setResultType:2];
  v29 = 0;
  v13 = [contextCopy executeFetchRequest:v9 error:&v29];
  v14 = v29;
  if (v13)
  {
    v15 = [objc_alloc(MEMORY[0x1E696AB50]) initWithCapacity:4];
    v25 = 0u;
    v26 = 0u;
    v27 = 0u;
    v28 = 0u;
    v16 = v13;
    v17 = [v16 countByEnumeratingWithState:&v25 objects:v32 count:16];
    if (v17)
    {
      v18 = v17;
      v23 = contextCopy;
      v24 = predicateCopy;
      v19 = *v26;
      do
      {
        for (i = 0; i != v18; ++i)
        {
          if (*v26 != v19)
          {
            objc_enumerationMutation(v16);
          }

          v21 = [*(*(&v25 + 1) + 8 * i) objectForKeyedSubscript:{@"asset.kind", v23, v24, v25}];
          [v15 addObject:v21];
        }

        v18 = [v16 countByEnumeratingWithState:&v25 objects:v32 count:16];
      }

      while (v18);
      contextCopy = v23;
      predicateCopy = v24;
    }
  }

  else
  {
    v16 = PLBackendGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v31 = v14;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "failed to count assets by kind: %@", buf, 0xCu);
    }

    v15 = 0;
  }

  return v15;
}

+ (unint64_t)_sumOfCountsInCountedSet:(id)set
{
  v15 = *MEMORY[0x1E69E9840];
  setCopy = set;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v4 = [setCopy countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = 0;
    v7 = *v11;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(setCopy);
        }

        v6 += [setCopy countForObject:*(*(&v10 + 1) + 8 * i)];
      }

      v5 = [setCopy countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v5);
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

+ (unint64_t)CPLAssetHDRTypeFromPLAssetHDRType:(signed __int16)type
{
  if ((type - 2) < 3)
  {
    return (type - 2) + 1;
  }

  else
  {
    return 0;
  }
}

+ (void)createMastersInLibrary:(id)library
{
  libraryCopy = library;
  managedObjectContext = [libraryCopy managedObjectContext];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke;
  v8[3] = &unk_1E75782F8;
  v10 = libraryCopy;
  selfCopy = self;
  v9 = managedObjectContext;
  v6 = libraryCopy;
  v7 = managedObjectContext;
  [v6 performTransactionAndWait:v8];
}

void __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke(id *a1)
{
  v26[3] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND master == nil", 0];
  v6 = MEMORY[0x1E696AB28];
  v26[0] = v5;
  v7 = [a1[6] predicateForSupportedAssetTypesForUpload];
  v26[1] = v7;
  v8 = [a1[6] _syncablePredicate];
  v26[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:3];
  v10 = [v6 andPredicateWithSubpredicates:v9];

  v25 = @"master";
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v25 count:1];
  [v4 setRelationshipKeyPathsForPrefetching:v11];

  v12 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:0];
  v24[0] = v12;
  v13 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"additionalAttributes.uploadAttempts" ascending:1];
  v24[1] = v13;
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v24 count:2];
  [v4 setSortDescriptors:v14];

  [v4 setPredicate:v10];
  v21 = 0;
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke_2;
  v18[3] = &unk_1E75781C0;
  v15 = a1[4];
  v19 = a1[5];
  v20 = a1[4];
  v16 = [v15 enumerateObjectsFromFetchRequest:v4 count:&v21 usingDefaultBatchSizeWithBlock:v18];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 134217984;
      v23 = v21;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "cloudMaster creation done: %li", buf, 0xCu);
    }
  }
}

void __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v12 = *MEMORY[0x1E69E9840];
  [a2 createMasterIfNecessaryInLibrary:*(a1 + 32)];
  if (__ROR8__(0x8F5C28F5C28F5C29 * a3, 2) <= 0x28F5C28F5C28F5CuLL && [*(a1 + 40) hasChanges])
  {
    v5 = *(a1 + 40);
    v9 = 0;
    v6 = [v5 save:&v9];
    v7 = v9;
    if ((v6 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v11 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "failed to save after creating master for some assets %@", buf, 0xCu);
      }
    }
  }
}

- (void)removeSidecar:(id)sidecar
{
  sidecarCopy = sidecar;
  asset = [sidecarCopy asset];
  [asset deleteResourceForSidecarRepresentation:sidecarCopy];
}

- (id)fileURLForHypotheticalSidecarFileWithFilename:(id)filename
{
  v16 = *MEMORY[0x1E69E9840];
  filenameCopy = filename;
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  v6 = pathForOriginalFile;
  if (pathForOriginalFile)
  {
    lastPathComponent = [pathForOriginalFile lastPathComponent];
    v8 = [filenameCopy isEqualToString:lastPathComponent];

    if ((v8 & 1) == 0)
    {
      stringByDeletingLastPathComponent = [v6 stringByDeletingLastPathComponent];
      v10 = [stringByDeletingLastPathComponent stringByAppendingPathComponent:filenameCopy];
      v11 = [MEMORY[0x1E695DFF8] fileURLWithPath:v10 isDirectory:0];

      goto LABEL_8;
    }
  }

  else
  {
    v12 = PLBackendGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v14 = 138412290;
      selfCopy = self;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Unable to get original file path for %@", &v14, 0xCu);
    }
  }

  v11 = 0;
LABEL_8:

  return v11;
}

- (id)urlForSideCarImageFile
{
  v2 = [(PLManagedAsset *)self sidecarFileMatchingContentType:*MEMORY[0x1E6982E30] requireExactMatch:0 requireSort:1];
  fileURL = [v2 fileURL];

  return fileURL;
}

- (BOOL)addSidecarFileAtIndex:(unint64_t)index sidecarURL:(id)l withFilename:(id)filename compressedSize:(id)size captureDate:(id)date modificationDate:(id)modificationDate uniformTypeIdentifier:(id)identifier imageOrientation:(unsigned int)self0 pathManager:(id)self1
{
  v49 = *MEMORY[0x1E69E9840];
  lCopy = l;
  filenameCopy = filename;
  sizeCopy = size;
  dateCopy = date;
  modificationDateCopy = modificationDate;
  identifierCopy = identifier;
  managerCopy = manager;
  if (managerCopy)
  {
    if (filenameCopy)
    {
      goto LABEL_3;
    }
  }

  else
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLInternalResource+SidecarAdoption.m" lineNumber:245 description:{@"Invalid parameter not satisfying: %@", @"pathManager"}];

    if (filenameCopy)
    {
LABEL_3:
      if (sizeCopy)
      {
        goto LABEL_4;
      }

LABEL_17:
      v44 = 0;
      v35 = [lCopy getResourceValue:&v44 forKey:*MEMORY[0x1E695DB50] error:0];
      v36 = v44;
      v37 = v36;
      if (v35)
      {
        sizeCopy = v36;
      }

      if (filenameCopy)
      {
        goto LABEL_5;
      }

LABEL_20:
      v26 = 0;
      goto LABEL_21;
    }
  }

  filenameCopy = [lCopy lastPathComponent];
  if (!sizeCopy)
  {
    goto LABEL_17;
  }

LABEL_4:
  if (!filenameCopy)
  {
    goto LABEL_20;
  }

LABEL_5:
  filename = [(PLManagedAsset *)self filename];
  v25 = [filenameCopy isEqualToString:filename];

  v26 = 0;
  if (lCopy && (v25 & 1) == 0 && sizeCopy)
  {
    v40 = dateCopy;
    pathForVideoComplementFile = [(PLManagedAsset *)self pathForVideoComplementFile];
    lastPathComponent = [pathForVideoComplementFile lastPathComponent];
    v29 = [filenameCopy isEqual:lastPathComponent];

    if (v29)
    {
      v26 = 0;
      dateCopy = v40;
    }

    else
    {
      [MEMORY[0x1E696AD98] numberWithUnsignedInteger:index];
      v30 = v42 = modificationDateCopy;
      v31 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:orientation];
      v43 = 0;
      v26 = [PLResourceInstaller installSupplementalResourceForExistingFileAtURL:lCopy ptpTrashedState:0 index:v30 forAsset:self imageOrientation:v31 resultingResource:0 error:&v43];
      v32 = v43;

      dateCopy = v40;
      modificationDateCopy = v42;
      if (!v26)
      {
        v39 = v32;
        v33 = PLBackendGetLog();
        if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412546;
          v46 = v39;
          v47 = 2112;
          selfCopy = self;
          _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_ERROR, "Error: %@, while storing supplemental resource for asset: %@", buf, 0x16u);
        }

        v32 = v39;
      }
    }
  }

LABEL_21:

  return v26;
}

- (id)sidecarFileMatchingContentType:(id)type requireExactMatch:(BOOL)match requireSort:(BOOL)sort
{
  v25 = *MEMORY[0x1E69E9840];
  typeCopy = type;
  if (sort)
  {
    [(PLManagedAsset *)self sortedSidecarFiles];
  }

  else
  {
    [(PLManagedAsset *)self sidecars];
  }

  v22 = 0u;
  v23 = 0u;
  v20 = 0u;
  v9 = v21 = 0u;
  v10 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v21;
    while (2)
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v21 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v20 + 1) + 8 * i);
        v15 = MEMORY[0x1E69C08F0];
        uniformTypeIdentifier = [v14 uniformTypeIdentifier];
        v17 = [v15 typeWithIdentifier:uniformTypeIdentifier];

        if (typeCopy && v17)
        {
          if (match)
          {
            if ([v17 isEqual:typeCopy])
            {
              goto LABEL_18;
            }
          }

          else if ([v17 conformsToType:typeCopy])
          {
LABEL_18:
            v18 = v14;

            goto LABEL_19;
          }
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
      if (v11)
      {
        continue;
      }

      break;
    }
  }

  v18 = 0;
LABEL_19:

  return v18;
}

- (id)sidecarWithResourceObjectID:(id)d
{
  dCopy = d;
  modernResources = [(PLManagedAsset *)self modernResources];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __63__PLManagedAsset_SidecarAdoption__sidecarWithResourceObjectID___block_invoke;
  v10[3] = &unk_1E7577AB0;
  v11 = dCopy;
  v6 = dCopy;
  v7 = [modernResources _pl_firstObjectPassingTest:v10];

  sidecarRepresentation = [v7 sidecarRepresentation];

  return sidecarRepresentation;
}

uint64_t __63__PLManagedAsset_SidecarAdoption__sidecarWithResourceObjectID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 objectID];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (NSArray)sortedSidecarFiles
{
  if (sortedSidecarFiles_s_onceToken != -1)
  {
    dispatch_once(&sortedSidecarFiles_s_onceToken, &__block_literal_global_53101);
  }

  sidecars = [(PLManagedAsset *)self sidecars];
  v4 = [sidecars sortedArrayUsingDescriptors:sortedSidecarFiles_s_descriptors];

  return v4;
}

void __53__PLManagedAsset_SidecarAdoption__sortedSidecarFiles__block_invoke()
{
  v3[1] = *MEMORY[0x1E69E9840];
  v0 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"index" ascending:1];
  v3[0] = v0;
  v1 = [MEMORY[0x1E695DEC8] arrayWithObjects:v3 count:1];
  v2 = sortedSidecarFiles_s_descriptors;
  sortedSidecarFiles_s_descriptors = v1;
}

- (id)sidecars
{
  v17 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v5 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(modernResources);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 canRepresentAsSidecar])
        {
          sidecarRepresentation = [v9 sidecarRepresentation];
          [v3 addObject:sidecarRepresentation];
        }
      }

      v6 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v6);
  }

  return v3;
}

- (BOOL)installSparseFullStageComputeSyncResourceIfNeeded
{
  v18 = *MEMORY[0x1E69E9840];
  computeSyncAttributes = [(PLManagedAsset *)self computeSyncAttributes];
  cloudComputeStateVersion = [computeSyncAttributes cloudComputeStateVersion];
  cloudComputeStateAdjustmentFingerprint = [computeSyncAttributes cloudComputeStateAdjustmentFingerprint];
  v6 = [(PLManagedAsset *)self _shouldIngestComputeSyncFromCloudWithCloudVersion:cloudComputeStateVersion cloudAdjustmentFingerprint:cloudComputeStateAdjustmentFingerprint currentMajorVersion:1];

  if (v6)
  {
    v13 = 0;
    v7 = [(PLManagedAsset *)self _installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:1 error:&v13];
    v8 = v13;

    v9 = v7 != 0;
    if (!v7 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138412546;
        v15 = v8;
        v16 = 2114;
        v17 = scopedIdentifier;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "[CCSS][Migration] Failed to install empty compute sync resource %@ for asset %{public}@", buf, 0x16u);
      }
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)applyComputeSyncPayloadWithComputeStateRecord:(id)record originatedFromPrefetch:(BOOL)prefetch error:(id *)error
{
  prefetchCopy = prefetch;
  v32 = *MEMORY[0x1E69E9840];
  recordCopy = record;
  fileURL = [recordCopy fileURL];

  if (!fileURL)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138543362;
        v29 = scopedIdentifier;
        v23 = "[CCSS] Nil fileURL from compute state record to asset %{public}@";
LABEL_16:
        _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_ERROR, v23, buf, 0xCu);
      }

LABEL_17:
    }

LABEL_18:
    v16 = 0;
LABEL_19:
    v24 = v16;
    v19 = v24;
    if (error)
    {
      v25 = v24;
      v20 = 0;
      *error = v19;
    }

    else
    {
      v20 = 0;
    }

    goto LABEL_22;
  }

  v10 = MEMORY[0x1E695DEF0];
  fileURL2 = [recordCopy fileURL];
  path = [fileURL2 path];
  v13 = [v10 dataWithContentsOfFile:path];

  if (!v13)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138543362;
        v29 = scopedIdentifier;
        v23 = "[CCSS] Nil data read from compute state record to asset %{public}@";
        goto LABEL_16;
      }

      goto LABEL_17;
    }

    goto LABEL_18;
  }

  v14 = objc_opt_new();
  v27 = 0;
  v15 = [v14 applyComputeSyncWrapperData:v13 toAsset:self error:&v27];
  v16 = v27;

  if (!v15)
  {
    goto LABEL_19;
  }

  if (![PLComputeSyncAttributes updateLocalComputeSyncAttributesForAsset:self cloudRecordComputeState:recordCopy originatedFromPrefetch:prefetchCopy]&& (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      scopedIdentifier2 = [(PLManagedAsset *)self scopedIdentifier];
      *buf = 138412546;
      v29 = recordCopy;
      v30 = 2114;
      v31 = scopedIdentifier2;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "[CCSS] Failed to extract version from cloudVersion: %@, asset: %{public}@", buf, 0x16u);
    }
  }

  v19 = v16;
  v20 = 1;
LABEL_22:

  return v20;
}

- (void)updateComputeSyncResourceAfterDownloadWithResource:(id)resource onDemandDownload:(BOOL)download
{
  downloadCopy = download;
  v33 = *MEMORY[0x1E69E9840];
  resourceCopy = resource;
  if (!resourceCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+ComputeSync.m" lineNumber:383 description:{@"Invalid parameter not satisfying: %@", @"computeSyncResource"}];
  }

  pathForComputeSyncWrapperFile = [(PLManagedAsset *)self pathForComputeSyncWrapperFile];
  scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
  [resourceCopy markAsLocallyAvailableWithFilePath:pathForComputeSyncWrapperFile];
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v26 = 0;
  v11 = [defaultManager attributesOfItemAtPath:pathForComputeSyncWrapperFile error:&v26];
  v12 = v26;

  if (v11)
  {
    [resourceCopy setDataLength:{objc_msgSend(v11, "fileSize")}];
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v13 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412802;
      v28 = pathForComputeSyncWrapperFile;
      v29 = 2114;
      v30 = scopedIdentifier;
      v31 = 2112;
      v32 = v12;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "[CCSS] Unable to extract attributes for file %@ asset %{public}@: %@", buf, 0x20u);
    }
  }

  fileURL = [resourceCopy fileURL];
  if (fileURL && (-[PLManagedObject pathManager](self, "pathManager"), v15 = objc_claimAutoreleasedReturnValue(), [v15 capabilities], v16 = objc_claimAutoreleasedReturnValue(), v17 = objc_msgSend(v16, "isCentralizedCacheDeleteCapable"), v16, v15, v17))
  {
    v24 = v12;
    v25 = 0;
    v18 = [PLCacheDeleteSupport markPurgeableForFileAtURL:fileURL withUrgency:downloadCopy outInode:&v25 error:&v24];
    v19 = v24;

    if (v18)
    {
      if (!v25)
      {
        v22 = PLResourceCachingGetLog();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v28 = fileURL;
          _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Unexpected inode value of 0 for %@", buf, 0xCu);
        }

        date = [MEMORY[0x1E696AEC0] stringWithFormat:@"Unexpected inode value of 0 for %@", fileURL];
        PLSimulateCrash();
        goto LABEL_24;
      }

      fileID = [resourceCopy fileID];
      if (fileID != v25)
      {
        [resourceCopy setFileID:?];
      }

      if (downloadCopy)
      {
        date = [MEMORY[0x1E695DF00] date];
        [resourceCopy setCloudLastOnDemandDownloadDate:date];
LABEL_24:
      }
    }

    else if (PLIsErrorEqualToCode())
    {
      [resourceCopy markAsNotLocallyAvailable];
    }
  }

  else
  {
    v19 = v12;
  }
}

- (BOOL)copyComputeSyncResourceFromCPLFilePath:(id)path error:(id *)error
{
  v28 = *MEMORY[0x1E69E9840];
  pathCopy = path;
  pathForComputeSyncWrapperFile = [(PLManagedAsset *)self pathForComputeSyncWrapperFile];
  v8 = MEMORY[0x1E69BF238];
  v9 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathCopy];
  v10 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForComputeSyncWrapperFile];
  pathManager = [(PLManagedObject *)self pathManager];
  capabilities = [pathManager capabilities];
  v19 = 0;
  v13 = [v8 ingestItemAtURL:v9 toURL:v10 type:1 options:14 capabilities:capabilities error:&v19];
  v14 = v19;

  if ((v13 & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138413058;
        v21 = pathCopy;
        v22 = 2112;
        v23 = pathForComputeSyncWrapperFile;
        v24 = 2112;
        v25 = v14;
        v26 = 2114;
        v27 = scopedIdentifier;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Failed to copy from file %@ to file %@ with error: %@ %{public}@", buf, 0x2Au);
      }
    }

    if (error)
    {
      v17 = v14;
      *error = v14;
    }
  }

  return v13;
}

- (id)_installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:(BOOL)file error:(id *)error
{
  fileCopy = file;
  v22 = *MEMORY[0x1E69E9840];
  v7 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_110_56511];
  if (v7)
  {
    v8 = v7;
    v9 = 0;
    goto LABEL_4;
  }

  v10 = [PLResourceRecipe recipeFromID:327689];
  v17 = 0;
  v8 = [PLResourceInstaller onDemand_installEmptyComputeResourceWithRecipe:v10 forAsset:self error:&v17];
  v9 = v17;

  if (v8)
  {
LABEL_4:
    if (fileCopy && [v8 isLocallyAvailable])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v11 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
          singleLineDescription = [v8 singleLineDescription];
          *buf = 138543618;
          v19 = scopedIdentifier;
          v20 = 2112;
          v21 = singleLineDescription;
          _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "[CCSS] Removing existing ComputeSync local file on asset %{public}@ since we've chosen to install another one from the cloud: %@", buf, 0x16u);
        }
      }

      [(PLManagedAsset *)self removeLocalFileForResource:v8 allowDCIMPath:1];
      [v8 markAsNotLocallyAvailable];
    }

    [v8 resetPrefetchState];
    [v8 setRemoteAvailability:1];
    goto LABEL_12;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v9;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Failed to install empty compute sync resource with error: %@", buf, 0xCu);
    }
  }

  if (error)
  {
    v16 = v9;
    v8 = 0;
    *error = v9;
  }

  else
  {
    v8 = 0;
  }

LABEL_12:

  return v8;
}

- (BOOL)_shouldIngestComputeSyncFromCloudWithCloudVersion:(id)version cloudAdjustmentFingerprint:(id)fingerprint currentMajorVersion:(unint64_t)majorVersion
{
  v35 = *MEMORY[0x1E69E9840];
  versionCopy = version;
  fingerprintCopy = fingerprint;
  v10 = MEMORY[0x1E696AD60];
  scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
  fingerprintCopy = [v10 stringWithFormat:@"[CCSS] Consumption policy for %@ with cloudVersion %@ and cloudAdjustmentFingerprint %@", scopedIdentifier, versionCopy, fingerprintCopy];

  if (_shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__onceToken != -1)
  {
    dispatch_once(&_shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__onceToken, &__block_literal_global_69);
  }

  if (_shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__ignoreShouldIngestChecks != 1)
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    adjustedStableHash = [additionalAttributes adjustedStableHash];
    if ([adjustedStableHash length])
    {
    }

    else
    {
      v17 = [fingerprintCopy length];

      if (!v17)
      {
        goto LABEL_12;
      }
    }

    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    adjustedStableHash2 = [additionalAttributes2 adjustedStableHash];
    v20 = [fingerprintCopy isEqualToString:adjustedStableHash2];

    if ((v20 & 1) == 0)
    {
      additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
      adjustedStableHash3 = [additionalAttributes3 adjustedStableHash];
      [fingerprintCopy appendFormat:@", cloudAdjustmentFingerprint does not match local adjustedStableHash %@. Overall decision: NO", adjustedStableHash3];

      if (*MEMORY[0x1E6994D48])
      {
        v14 = 0;
        goto LABEL_41;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v32 = fingerprintCopy;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "%@", buf, 0xCu);
      }

      v14 = 0;
      goto LABEL_40;
    }

LABEL_12:
    v13 = [objc_alloc(MEMORY[0x1E6994B78]) initWithString:versionCopy];
    if (![v13 majorVersion])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v27 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
        {
          scopedIdentifier2 = [(PLManagedAsset *)self scopedIdentifier];
          *buf = 138412546;
          v32 = v13;
          v33 = 2112;
          v34 = scopedIdentifier2;
          _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_ERROR, "[CCSS] Failed to extract non-zero MajorVersion from cloudVersion: %@, asset: %@", buf, 0x16u);
        }
      }

      goto LABEL_35;
    }

    majorVersion = [v13 majorVersion];
    stage = [v13 stage];
    computeSyncAttributes = [(PLManagedAsset *)self computeSyncAttributes];
    localAnalysisStage = [computeSyncAttributes localAnalysisStage];

    if (majorVersion == majorVersion)
    {
      [fingerprintCopy appendFormat:@", CloudVersion == Runtime(%d), VersionDecision: YES", 2];
      if (stage == localAnalysisStage)
      {
        [fingerprintCopy appendFormat:@", CloudAssetStage == Local(%zu), StageDecision: NO", stage];
LABEL_35:
        v14 = 0;
        goto LABEL_36;
      }

      if (stage <= localAnalysisStage)
      {
        [fingerprintCopy appendFormat:@", CloudAssetStage < Local(%zu), StageDecision: NO", localAnalysisStage];
        goto LABEL_35;
      }

      if (stage >= 0x3B7)
      {
        [fingerprintCopy appendFormat:@", CloudAssetStage > PLManagedAssetComputeSyncHighestAllowedStage Local(%zu), StageDecision: NO", localAnalysisStage];
        goto LABEL_35;
      }
    }

    else
    {
      if (majorVersion > majorVersion)
      {
        [fingerprintCopy appendFormat:@", CloudVersion > Runtime(%d), VersionDecision: NO", 2];
        goto LABEL_35;
      }

      [fingerprintCopy appendFormat:@", CloudVersion < Runtime(%d), VersionDecision: YES", 2];
      v14 = 0;
      if (localAnalysisStage || stage <= localAnalysisStage)
      {
LABEL_36:
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v29 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v29, OS_LOG_TYPE_DEBUG))
          {
            *buf = 138412290;
            v32 = fingerprintCopy;
            _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_DEBUG, "%@", buf, 0xCu);
          }
        }

        goto LABEL_40;
      }

      localAnalysisStage = 0;
    }

    [fingerprintCopy appendFormat:@", CloudAssetStage > Local(%zu), StageDecision: YES", localAnalysisStage];
    [fingerprintCopy appendFormat:@", Overall decision: %@", @"YES"];
    v14 = 1;
    goto LABEL_36;
  }

  [fingerprintCopy appendString:@", Ignoring actual policy since PLCCSSIgnoreShouldIngestChecks is set. Overall decision override: YES"];
  if (*MEMORY[0x1E6994D48])
  {
    v14 = 1;
    goto LABEL_41;
  }

  v13 = __CPLAssetsdOSLogDomain();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
  {
    *buf = 138412290;
    v32 = fingerprintCopy;
    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "%@", buf, 0xCu);
  }

  v14 = 1;
LABEL_40:

LABEL_41:
  return v14;
}

void __128__PLManagedAsset_ComputeSync___shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  _shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__ignoreShouldIngestChecks = [v0 BOOLForKey:@"PLCCSSIgnoreShouldIngestChecks"];
}

- (BOOL)_shouldInstallComputeSyncResourceFromCloudWithCPLAssetChange:(id)change
{
  changeCopy = change;
  computeStateVersion = [changeCopy computeStateVersion];
  computeStateAdjustmentFingerprint = [changeCopy computeStateAdjustmentFingerprint];

  if ([computeStateVersion length])
  {
    v7 = [(PLManagedAsset *)self _shouldIngestComputeSyncFromCloudWithCloudVersion:computeStateVersion cloudAdjustmentFingerprint:computeStateAdjustmentFingerprint currentMajorVersion:2];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)shouldDownloadComputeSyncPayload
{
  v13 = *MEMORY[0x1E69E9840];
  if (shouldDownloadComputeSyncPayload_onceToken != -1)
  {
    dispatch_once(&shouldDownloadComputeSyncPayload_onceToken, &__block_literal_global_59);
  }

  if (shouldDownloadComputeSyncPayload_disallowComputeSyncPayloadDownload == 1)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v3 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT))
      {
        scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
        v11 = 138412290;
        v12 = scopedIdentifier;
        _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_DEFAULT, "[CCSS] Returning NO for shouldDownloadComputeSyncPayload as PLCCSSDisallowComputeSyncPayloadDownload is set. Asset: %@", &v11, 0xCu);
      }
    }

    return 0;
  }

  else
  {
    computeSyncAttributes = [(PLManagedAsset *)self computeSyncAttributes];
    cloudComputeStateVersion = [computeSyncAttributes cloudComputeStateVersion];

    computeSyncAttributes2 = [(PLManagedAsset *)self computeSyncAttributes];
    cloudComputeStateAdjustmentFingerprint = [computeSyncAttributes2 cloudComputeStateAdjustmentFingerprint];

    if ([cloudComputeStateVersion length])
    {
      v5 = [(PLManagedAsset *)self _shouldIngestComputeSyncFromCloudWithCloudVersion:cloudComputeStateVersion cloudAdjustmentFingerprint:cloudComputeStateAdjustmentFingerprint currentMajorVersion:2];
    }

    else
    {
      v5 = 0;
    }
  }

  return v5;
}

void __63__PLManagedAsset_ComputeSync__shouldDownloadComputeSyncPayload__block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  shouldDownloadComputeSyncPayload_disallowComputeSyncPayloadDownload = [v0 BOOLForKey:@"PLCCSSDisallowComputeSyncPayloadDownload"];
}

- (void)applyComputeSyncPropertiesFromAssetChange:(id)change inLibrary:(id)library didInstallComputeSyncResource:(BOOL *)resource computeSyncDownloadEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v21 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  computeStateVersion = [changeCopy computeStateVersion];
  computeStateAdjustmentFingerprint = [changeCopy computeStateAdjustmentFingerprint];
  computeStateLastUpdatedDate = [changeCopy computeStateLastUpdatedDate];
  [PLComputeSyncAttributes updateCloudComputeSyncAttributesForAsset:self cloudVersion:computeStateVersion cloudAdjustmentFingerprint:computeStateAdjustmentFingerprint cloudLastUpdatedDate:computeStateLastUpdatedDate];

  if (enabledCopy && [(PLManagedAsset *)self _shouldInstallComputeSyncResourceFromCloudWithCPLAssetChange:changeCopy])
  {
    v16 = 0;
    v13 = [(PLManagedAsset *)self _installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:1 error:&v16];
    v14 = v16;

    if (v13)
    {
      if (resource)
      {
        *resource = 1;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v18 = v14;
        v19 = 2112;
        v20 = changeCopy;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Failed to install empty compute sync resource %@ from asset change %@", buf, 0x16u);
      }
    }
  }
}

- (id)_currentComputeStateVersion
{
  v3 = MEMORY[0x1E696AEC0];
  computeSyncAttributes = [(PLManagedAsset *)self computeSyncAttributes];
  localAnalysisMajorVersion = [computeSyncAttributes localAnalysisMajorVersion];
  computeSyncAttributes2 = [(PLManagedAsset *)self computeSyncAttributes];
  v7 = [v3 stringWithFormat:@"%i.%i", localAnalysisMajorVersion, objc_msgSend(computeSyncAttributes2, "localAnalysisStage")];

  return v7;
}

- (BOOL)shouldPushComputeSync
{
  v14 = objc_opt_class();
  computeSyncAttributes = [(PLManagedAsset *)self computeSyncAttributes];
  localAnalysisMajorVersion = [computeSyncAttributes localAnalysisMajorVersion];
  computeSyncAttributes2 = [(PLManagedAsset *)self computeSyncAttributes];
  localAnalysisStage = [computeSyncAttributes2 localAnalysisStage];
  computeSyncAttributes3 = [(PLManagedAsset *)self computeSyncAttributes];
  cloudComputeStateVersion = [computeSyncAttributes3 cloudComputeStateVersion];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  adjustedStableHash = [additionalAttributes adjustedStableHash];
  computeSyncAttributes4 = [(PLManagedAsset *)self computeSyncAttributes];
  cloudComputeStateAdjustmentFingerprint = [computeSyncAttributes4 cloudComputeStateAdjustmentFingerprint];
  scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
  LOBYTE(localAnalysisMajorVersion) = [v14 _shouldPushComputeSyncWithLocalMajorVersion:localAnalysisMajorVersion localAnalaysisStage:localAnalysisStage cloudComputeStateVersionStr:cloudComputeStateVersion localAdjustmentFingerprint:adjustedStableHash cloudAdjustmentFingerprint:cloudComputeStateAdjustmentFingerprint scopedIdentifier:scopedIdentifier];

  return localAnalysisMajorVersion;
}

- (BOOL)installComputeSyncResourceAfterAttachtoCPLWithError:(id *)error
{
  v7 = 0;
  v4 = [(PLManagedAsset *)self _installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:0 error:&v7];
  v5 = v7;
  if (v4)
  {
    [(PLManagedAsset *)self updateComputeSyncResourceAfterDownloadWithResource:v4 onDemandDownload:0];
    [v4 setCloudPrefetchCount:10];
  }

  return 1;
}

- (void)deleteComputeSyncResourceIfExists
{
  v11 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_56566];
  if (v3)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v4 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
      {
        scopedIdentifier = [(PLManagedAsset *)self scopedIdentifier];
        singleLineDescription = [v3 singleLineDescription];
        v7 = 138543618;
        v8 = scopedIdentifier;
        v9 = 2112;
        v10 = singleLineDescription;
        _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEFAULT, "[CCSS] Removing existing ComputeSync resource on asset %{public}@: %@", &v7, 0x16u);
      }
    }

    [(PLManagedAsset *)self removeLocalFileForResource:v3 allowDCIMPath:1];
    [v3 deleteResource];
  }
}

+ (BOOL)markUnavailableComputeSyncResourcesWithManagedObjectContext:(id)context error:(id *)error
{
  v25[2] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D560];
  contextCopy = context;
  v7 = [v5 alloc];
  v8 = +[PLInternalResource entityName];
  v9 = [v7 initWithEntityName:v8];

  327689 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"recipeID", 327689];
  [v9 setPredicate:327689];

  [v9 setResultType:2];
  v24[0] = @"localAvailability";
  v24[1] = @"dataStoreKeyData";
  v25[0] = &unk_1F0FBCEB0;
  null = [MEMORY[0x1E695DFB0] null];
  v25[1] = null;
  v12 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v25 forKeys:v24 count:2];
  [v9 setPropertiesToUpdate:v12];

  v21 = 0;
  v13 = [contextCopy executeRequest:v9 error:&v21];

  v14 = v21;
  if (v13)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        result = [v13 result];
        *buf = 138412290;
        v23 = result;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEFAULT, "Marked unavailable %@ compute sync resources", buf, 0xCu);
      }
    }

    v17 = v14;
    if (error)
    {
      *error = v17;
    }
  }

  else
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v18 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v23 = v14;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Failed to mark unavailble compute sync resources: %@", buf, 0xCu);
      }
    }

    v19 = v14;
  }

  return v13 != 0;
}

+ (BOOL)_checkComputeSyncUploadPolicyWithCPLConfiguration:(id)configuration library:(id)library debugMode:(BOOL)mode debugLog:(id)log
{
  modeCopy = mode;
  v40 = *MEMORY[0x1E69E9840];
  configurationCopy = configuration;
  libraryCopy = library;
  logCopy = log;
  v12 = MEMORY[0x1E69BF188];
  pathManager = [libraryCopy pathManager];
  libraryURL = [pathManager libraryURL];
  v15 = [v12 appPrivateDataForLibraryURL:libraryURL];

  v16 = [v15 valueForKey:@"ComputeSyncUploadPolicy.cachedResult"];
  if (_checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__onceToken != -1)
  {
    dispatch_once(&_checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__onceToken, &__block_literal_global_198_56586);
  }

  if (_checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__skipComputeSyncUploadPolicyChecks != 1)
  {
    if (!v16)
    {
      goto LABEL_12;
    }

    if ([v16 BOOLValue])
    {
      if (!modeCopy)
      {
        goto LABEL_5;
      }

      [logCopy appendFormat:@"%@: %@ %@\n", @"Policy: Cached result", @"YES", &stru_1F0F06D80];
    }

    else
    {
      [logCopy appendFormat:@"%@: %@ %@\n", @"Policy: Cached result", @"NO", @"policyCachedResult is NO"];
    }

    if (([v16 BOOLValue] & 1) == 0)
    {
      v18 = [v15 valueForKey:@"ComputeSyncUploadPolicy.lastCheckedDate"];
      v19 = v18;
      if (v18)
      {
        [v18 timeIntervalSinceNow];
        v21 = fabs(v20);
        if (v21 < 86400.0 && !modeCopy)
        {

          goto LABEL_43;
        }

        v17 = v21 < 86400.0;
        if (v21 < 86400.0)
        {
          v22 = @"NO";
        }

        else
        {
          v22 = @"YES";
        }

        [logCopy appendFormat:@"%@: %@ %@\n", @"Policy: Last checked date", v22, v19];
      }

      else
      {
        v17 = 0;
      }
    }

    else
    {
LABEL_12:
      v17 = 0;
    }

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __108__PLManagedAsset_ComputeSync___checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog___block_invoke_2;
    aBlock[3] = &unk_1E756E378;
    v37 = modeCopy;
    v36 = v15;
    v23 = _Block_copy(aBlock);
    v24 = [configurationCopy valueForKey:@"feature.computesync.policy.minassetcount"];
    unsignedIntegerValue = [v24 unsignedIntegerValue];

    if (!unsignedIntegerValue)
    {
      unsignedIntegerValue = 10000;
    }

    v26 = [PLManagedAsset iCPLAssetCountInPhotoLibrary:libraryCopy];
    if (v26 >= unsignedIntegerValue)
    {
      v30 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Threshold: %tu, Count: %tu", unsignedIntegerValue, v26];
      v31 = v30;
      if (v30)
      {
        v32 = v30;
      }

      else
      {
        v32 = &stru_1F0F06D80;
      }

      [logCopy appendFormat:@"%@: %@ %@\n", @"Policy: Asset threshold", @"YES", v32];

      if (!v17)
      {
        v33 = 1;
        v23[2](v23, 1);
        goto LABEL_41;
      }
    }

    else
    {
      v23[2](v23, 0);
      v27 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Threshold: %tu, Count: %tu", unsignedIntegerValue, v26];
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v28 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v39 = v27;
          _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_DEFAULT, "[CCSS] Upload policy check: Caching NO due to asset count threshold. %@", buf, 0xCu);
        }
      }

      if (!modeCopy)
      {

LABEL_42:
        goto LABEL_43;
      }

      v29 = &stru_1F0F06D80;
      if (v27)
      {
        v29 = v27;
      }

      [logCopy appendFormat:@"%@: %@ %@\n", @"Policy: Asset threshold", @"NO", v29];
    }

    v33 = 0;
LABEL_41:
    LOBYTE(modeCopy) = v33 | modeCopy ^ 1;
    goto LABEL_42;
  }

  [logCopy appendFormat:@"%@: %@ %@\n", @"Policy: Override policy checks (PLCCSSSkipUploadPolicyChecks)", @"YES", &stru_1F0F06D80];
LABEL_5:
  LOBYTE(modeCopy) = 1;
LABEL_43:

  return modeCopy;
}

void __108__PLManagedAsset_ComputeSync___checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x1E69E9840];
  if ((*(a1 + 40) & 1) == 0)
  {
    v4 = *(a1 + 32);
    v5 = [MEMORY[0x1E695DF00] now];
    v15 = 0;
    v6 = [v4 setValue:v5 forKey:@"ComputeSyncUploadPolicy.lastCheckedDate" error:&v15];
    v7 = v15;

    v8 = MEMORY[0x1E6994D48];
    if ((v6 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v17 = v7;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "[CCSS] Policy: Failed to persist date to app private data: %@", buf, 0xCu);
      }
    }

    v10 = *(a1 + 32);
    v11 = [MEMORY[0x1E696AD98] numberWithBool:a2];
    v14 = v7;
    LOBYTE(v10) = [v10 setValue:v11 forKey:@"ComputeSyncUploadPolicy.cachedResult" error:&v14];
    v12 = v14;

    if ((v10 & 1) == 0 && (*v8 & 1) == 0)
    {
      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v17 = v12;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "[CCSS] Policy: Failed to persist number to app private data: %@", buf, 0xCu);
      }
    }
  }
}

void __108__PLManagedAsset_ComputeSync___checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  _checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__skipComputeSyncUploadPolicyChecks = [v0 BOOLForKey:@"PLCCSSSkipUploadPolicyChecks"];
}

+ (BOOL)isComputeSyncEnabledForDirection:(int64_t)direction library:(id)library debugMode:(BOOL)mode debugLog:(id *)log
{
  modeCopy = mode;
  v65 = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  v11 = objc_alloc(MEMORY[0x1E696AD60]);
  v12 = direction != 0;
  v13 = @"upload";
  if (direction)
  {
    v13 = @"download";
  }

  v14 = [v11 initWithFormat:@"Compute Sync enabled check for direction: %@", v13];
  if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__onceToken == -1)
  {
    if (direction)
    {
      goto LABEL_5;
    }

LABEL_15:
    if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSUpload == 1)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
        {
          *buf = 0;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEBUG, "[CCSS] Upload disabled using PLCCSSDisableComputeSyncUpload default", buf, 2u);
        }
      }

      if ((modeCopy & 1) == 0)
      {
LABEL_58:
        LOBYTE(modeCopy) = 0;
        goto LABEL_86;
      }

      v16 = @"PLCCSSDisableComputeSyncUpload set";
LABEL_22:
      [v14 appendFormat:@"%@: %@ %@\n", @"UserDefault", @"NO", v16];
      v17 = 1;
      goto LABEL_24;
    }

LABEL_23:
    v12 = 0;
    v17 = 0;
    goto LABEL_24;
  }

  dispatch_once(&isComputeSyncEnabledForDirection_library_debugMode_debugLog__onceToken, &__block_literal_global_141_56625);
  if (!direction)
  {
    goto LABEL_15;
  }

LABEL_5:
  if (direction != 1)
  {
    goto LABEL_23;
  }

  if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSDownload == 1)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEBUG, "[CCSS] Download disabled using PLCCSSDisableComputeSyncDownload default", buf, 2u);
      }
    }

    if (!modeCopy)
    {
      goto LABEL_86;
    }

    v16 = @"PLCCSSDisableComputeSyncDownload set";
    goto LABEL_22;
  }

  v17 = 0;
  v12 = 1;
LABEL_24:
  if (PLPlatformComputeSyncSupported())
  {
    v58 = v17;
    v19 = modeCopy;
    selfCopy2 = self;
    v20 = @"YES";
LABEL_32:
    [v14 appendFormat:@"%@: %@ %@\n", @"Platform supported", v20, &stru_1F0F06D80];
    libraryServicesManager = [libraryCopy libraryServicesManager];
    isSystemPhotoLibrary = [libraryServicesManager isSystemPhotoLibrary];

    v24 = @"YES";
    if (isSystemPhotoLibrary)
    {
      goto LABEL_39;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v25 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "[CCSS] Compute sync is only supporrted on the System Photo Library; disabling compute sync", buf, 2u);
      }
    }

    if (v19)
    {
      v58 = 1;
      v24 = @"NO";
LABEL_39:
      logCopy = log;
      [v14 appendFormat:@"%@: %@ %@\n", @"Is SPL", v24, &stru_1F0F06D80];
      if (v12)
      {
        [v14 appendFormat:@"%@: %@ %@\n", @"Download allowed", @"YES", @"reason: Not DawnBurstG"];
      }

      v26 = libraryCopy;
      libraryServicesManager2 = [libraryCopy libraryServicesManager];
      cloudPhotoLibraryManager = [libraryServicesManager2 cloudPhotoLibraryManager];
      cplConfiguration = [cloudPhotoLibraryManager cplConfiguration];

      cloudPhotoLibraryManager2 = [libraryServicesManager2 cloudPhotoLibraryManager];
      cplStatus = [cloudPhotoLibraryManager2 cplStatus];
      isKeychainCDPEnabled = [cplStatus isKeychainCDPEnabled];

      v33 = @"YES";
      modeCopy = v19;
      if ((isKeychainCDPEnabled & 1) == 0)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v34 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
          {
            *buf = 0;
            _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_DEBUG, "[CCSS] Device keychain CDP is disabled; disabling compute sync", buf, 2u);
          }
        }

        if (!v19)
        {
          v42 = cplConfiguration;
          libraryCopy = v26;
          goto LABEL_85;
        }

        v58 = 1;
        v33 = @"NO";
      }

      [v14 appendFormat:@"%@: %@ %@\n", @"Device CDP", v33, &stru_1F0F06D80];
      v35 = @"feature.version.computesync.upload";
      v36 = @"upload";
      if (direction)
      {
        v36 = 0;
        v35 = 0;
      }

      if (direction == 1)
      {
        v37 = @"download";
      }

      else
      {
        v37 = v36;
      }

      if (direction == 1)
      {
        v38 = @"feature.version.computesync.download";
      }

      else
      {
        v38 = v35;
      }

      v55 = cplConfiguration;
      v39 = [cplConfiguration valueForKey:v38];
      unsignedIntValue = [v39 unsignedIntValue];

      if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__skipServerFFChecks == 1)
      {
        [v14 appendFormat:@"%@: %@ %@\n", @"Force enabling compute sync & skipping server FF check (PLCCSSSkipServerFFCheck): ", @"YES", &stru_1F0F06D80];
        v41 = logCopy;
        v42 = cplConfiguration;
        libraryCopy = v26;
      }

      else
      {
        v43 = unsignedIntValue;
        libraryCopy = v26;
        if (unsignedIntValue >= 3)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v44 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v44, OS_LOG_TYPE_DEBUG))
            {
              *buf = 134218498;
              v60 = 2;
              v61 = 2048;
              v62 = v43;
              v63 = 2114;
              v64 = v37;
              _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_DEBUG, "[CCSS] Client release version is %zd and server minimum release version is %zd. Disabled compute sync %{public}@ since client release version is less than server minimum release version", buf, 0x20u);
            }
          }

          v45 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Client version is %zd, server version is %zd", 2, v43];
          v46 = v45;
          v41 = logCopy;
          if (!v19)
          {

            v42 = v55;
            goto LABEL_85;
          }

          if (v45)
          {
            v47 = v45;
          }

          else
          {
            v47 = &stru_1F0F06D80;
          }

          [v14 appendFormat:@"%@: %@ %@\n", @"Server FF", @"NO", v47];

          v48 = 1;
          v42 = v55;
          if (!direction)
          {
            goto LABEL_76;
          }

          goto LABEL_81;
        }

        v49 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Client version is %zd, server version is %zd", 2, unsignedIntValue];
        v50 = v49;
        if (v49)
        {
          v51 = v49;
        }

        else
        {
          v51 = &stru_1F0F06D80;
        }

        [v14 appendFormat:@"%@: %@ %@\n", @"Server FF", @"YES", v51];

        v41 = logCopy;
        v42 = v55;
      }

      v48 = v58;
      if (!direction)
      {
LABEL_76:
        v52 = [selfCopy2 _checkComputeSyncUploadPolicyWithCPLConfiguration:v42 library:libraryCopy debugMode:modeCopy debugLog:v14];
        if ((v52 & 1) != 0 || modeCopy)
        {
          v48 |= v52 ^ 1;
          v53 = @"NO";
          if (v52)
          {
            v53 = @"YES";
          }

          [v14 appendFormat:@"%@: %@ %@\n", @"Policy: Overall", v53, &stru_1F0F06D80];
          goto LABEL_81;
        }

LABEL_85:

        goto LABEL_86;
      }

LABEL_81:
      if (v41 && modeCopy)
      {
        *v41 = [v14 copy];
      }

      LOBYTE(modeCopy) = v48 & modeCopy ^ 1;
      goto LABEL_85;
    }

    goto LABEL_58;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v21 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEBUG, "[CCSS] Compute sync is currently unsupported on watchOS; disabling compute sync", buf, 2u);
    }
  }

  if (modeCopy)
  {
    v19 = modeCopy;
    selfCopy2 = self;
    v58 = 1;
    v20 = @"NO";
    goto LABEL_32;
  }

LABEL_86:

  return modeCopy;
}

void __91__PLManagedAsset_ComputeSync__isComputeSyncEnabledForDirection_library_debugMode_debugLog___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSUpload = [v0 BOOLForKey:@"PLCCSSDisableComputeSyncUpload"];

  v1 = [MEMORY[0x1E695E000] standardUserDefaults];
  isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSDownload = [v1 BOOLForKey:@"PLCCSSDisableComputeSyncDownload"];

  v2 = [MEMORY[0x1E695E000] standardUserDefaults];
  isComputeSyncEnabledForDirection_library_debugMode_debugLog__skipServerFFChecks = [v2 BOOLForKey:@"PLCCSSSkipServerFFCheck"];
}

+ (BOOL)_shouldPushComputeSyncWithLocalMajorVersion:(signed __int16)version localAnalaysisStage:(signed __int16)stage cloudComputeStateVersionStr:(id)str localAdjustmentFingerprint:(id)fingerprint cloudAdjustmentFingerprint:(id)adjustmentFingerprint scopedIdentifier:(id)identifier
{
  stageCopy = stage;
  versionCopy = version;
  v38 = *MEMORY[0x1E69E9840];
  fingerprintCopy = fingerprint;
  adjustmentFingerprintCopy = adjustmentFingerprint;
  identifierCopy = identifier;
  if (str)
  {
    v16 = MEMORY[0x1E6994B78];
    strCopy = str;
    v18 = [[v16 alloc] initWithString:strCopy];

    v19 = [objc_alloc(MEMORY[0x1E6994B78]) initWithMajorVersion:versionCopy stage:stageCopy];
    v20 = [v19 compare:v18];
    if (v20 == -1)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v22 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_DEBUG))
        {
          v28 = 138543874;
          v29 = identifierCopy;
          v30 = 2112;
          v31 = v18;
          v32 = 2112;
          v33 = v19;
          v23 = "[CCSS] Not pushing compute sync payload for %{public}@. Cloud version %@ is higher than local version %@";
          v24 = v22;
          v25 = OS_LOG_TYPE_DEBUG;
          v26 = 32;
LABEL_16:
          _os_log_impl(&dword_19BF1F000, v24, v25, v23, &v28, v26);
        }

LABEL_17:
      }
    }

    else
    {
      if (v20)
      {
LABEL_7:
        v21 = 1;
LABEL_19:

        goto LABEL_20;
      }

      if (fingerprintCopy && adjustmentFingerprintCopy)
      {
        if (([fingerprintCopy isEqual:adjustmentFingerprintCopy] & 1) == 0)
        {
          goto LABEL_7;
        }
      }

      else if (fingerprintCopy | adjustmentFingerprintCopy)
      {
        goto LABEL_7;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v22 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
        {
          v28 = 138544386;
          v29 = identifierCopy;
          v30 = 2112;
          v31 = v19;
          v32 = 2112;
          v33 = fingerprintCopy;
          v34 = 2112;
          v35 = v18;
          v36 = 2112;
          v37 = adjustmentFingerprintCopy;
          v23 = "[CCSS] Not pushing compute sync payload for %{public}@. Versions match and adjustment fingerprints match, Local: %@ %@, Cloud: %@ %@";
          v24 = v22;
          v25 = OS_LOG_TYPE_DEFAULT;
          v26 = 52;
          goto LABEL_16;
        }

        goto LABEL_17;
      }
    }

    v21 = 0;
    goto LABEL_19;
  }

  v21 = stageCopy > 0;
LABEL_20:

  return v21;
}

+ (id)generateFullComputeStateRecordForRecord:(id)record payloadHelper:(id)helper destinationDirectoryURL:(id)l inPhotoLibrary:(id)library
{
  v63 = *MEMORY[0x1E69E9840];
  recordCopy = record;
  helperCopy = helper;
  lCopy = l;
  libraryCopy = library;
  itemScopedIdentifier = [recordCopy itemScopedIdentifier];

  if (itemScopedIdentifier)
  {
    itemScopedIdentifier2 = [recordCopy itemScopedIdentifier];
    v15 = [PLManagedAsset assetWithScopedIdentifier:itemScopedIdentifier2 inLibrary:libraryCopy prefetchResources:1];

    if (v15)
    {
      computeSyncAttributes = [v15 computeSyncAttributes];
      if (!computeSyncAttributes)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v24 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            itemScopedIdentifier3 = [recordCopy itemScopedIdentifier];
            *buf = 138543618;
            v56 = itemScopedIdentifier3;
            v57 = 2112;
            v58 = recordCopy;
            _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Asset %{public}@ doesn't have a compute sync attributes relationship %@", buf, 0x16u);
          }

          goto LABEL_26;
        }

        computeSyncAttributes = 0;
        goto LABEL_18;
      }

      version = [recordCopy version];
      _currentComputeStateVersion = [v15 _currentComputeStateVersion];
      v19 = [version isEqualToString:_currentComputeStateVersion];

      if ((v19 & 1) == 0)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v24 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            itemScopedIdentifier4 = [recordCopy itemScopedIdentifier];
            _currentComputeStateVersion2 = [v15 _currentComputeStateVersion];
            version2 = [recordCopy version];
            *buf = 138544130;
            v56 = itemScopedIdentifier4;
            v57 = 2114;
            v58 = _currentComputeStateVersion2;
            v59 = 2114;
            v60 = version2;
            v61 = 2112;
            v62 = recordCopy;
            _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Asset %{public}@ version %{public}@ doesn't match compute state record version %{public}@ %@", buf, 0x2Au);

            goto LABEL_25;
          }

LABEL_26:
          v28 = 0;
LABEL_27:

          goto LABEL_28;
        }

LABEL_18:
        v28 = 0;
LABEL_28:

        goto LABEL_29;
      }

      adjustmentFingerprint = [recordCopy adjustmentFingerprint];
      additionalAttributes = [v15 additionalAttributes];
      adjustedStableHash = [additionalAttributes adjustedStableHash];

      if (adjustmentFingerprint && adjustedStableHash)
      {
        v23 = [adjustmentFingerprint isEqual:adjustedStableHash];

        if ((v23 & 1) == 0)
        {
          goto LABEL_8;
        }
      }

      else
      {

        if (adjustmentFingerprint | adjustedStableHash)
        {
LABEL_8:
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v24 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
            {
              _currentComputeStateVersion2 = [recordCopy itemScopedIdentifier];
              additionalAttributes2 = [v15 additionalAttributes];
              adjustedStableHash2 = [additionalAttributes2 adjustedStableHash];
              adjustmentFingerprint2 = [recordCopy adjustmentFingerprint];
              *buf = 138544130;
              v56 = _currentComputeStateVersion2;
              v57 = 2114;
              v58 = adjustedStableHash2;
              v59 = 2114;
              v60 = adjustmentFingerprint2;
              v61 = 2112;
              v62 = recordCopy;
              _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Asset %{public}@ adjustmentFingerprint %{public}@ doesn't match compute state record adjustmentFingerprint %{public}@ %@", buf, 0x2Au);

LABEL_25:
              goto LABEL_26;
            }

            goto LABEL_26;
          }

          goto LABEL_18;
        }
      }

      computeSyncAttributes2 = [v15 computeSyncAttributes];
      v24 = [helperCopy computeSyncWrapperURLForAsset:v15 analysisStage:{objc_msgSend(computeSyncAttributes2, "localAnalysisStage")}];

      if (!v24)
      {
        if (*MEMORY[0x1E6994D48])
        {
          v24 = 0;
          goto LABEL_26;
        }

        v46 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
        {
          scopedIdentifier = [v15 scopedIdentifier];
          *buf = 138543618;
          v56 = scopedIdentifier;
          v57 = 2112;
          v58 = recordCopy;
          _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Nil compute sync payload URL generated for asset %{public}@ %@", buf, 0x16u);
        }

        v28 = 0;
LABEL_52:

        goto LABEL_27;
      }

      v54 = 0;
      v35 = [v15 installComputeSyncResourceAfterAttachtoCPLWithError:&v54];
      v50 = v54;
      if ((v35 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v36 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          scopedIdentifier2 = [v15 scopedIdentifier];
          *buf = 138412546;
          v56 = scopedIdentifier2;
          v57 = 2112;
          v58 = v50;
          _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[CCSS] Failed to install resource for asset %@ after compute state record upload: %@", buf, 0x16u);
        }
      }

      v38 = MEMORY[0x1E696AEC0];
      uUID = [MEMORY[0x1E696AFB0] UUID];
      uUIDString = [uUID UUIDString];
      v41 = [v38 stringWithFormat:@"%@.dat", uUIDString];
      v52 = [lCopy URLByAppendingPathComponent:v41];

      v42 = MEMORY[0x1E69BF238];
      pathManager = [libraryCopy pathManager];
      capabilities = [pathManager capabilities];
      v53 = 0;
      LOBYTE(v42) = [v42 ingestItemAtURL:v24 toURL:v52 type:1 options:10 capabilities:capabilities error:&v53];
      v49 = v53;

      if (v42)
      {
        v45 = v52;
        v28 = [recordCopy copyAddingFileURL:v52];
      }

      else
      {
        v45 = v52;
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v48 = __CPLAssetsdOSLogDomain();
          v46 = v50;
          if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
          {
            *buf = 138543874;
            v56 = v24;
            v57 = 2114;
            v58 = v52;
            v59 = 2112;
            v60 = recordCopy;
            _os_log_impl(&dword_19BF1F000, v48, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Unable to copy payload from URL %{public}@ to %{public}@ %@", buf, 0x20u);
          }

          v28 = 0;
          goto LABEL_51;
        }

        v28 = 0;
      }

      v46 = v50;
LABEL_51:

      goto LABEL_52;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      computeSyncAttributes = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(computeSyncAttributes, OS_LOG_TYPE_ERROR))
      {
        itemScopedIdentifier5 = [recordCopy itemScopedIdentifier];
        *buf = 138543618;
        v56 = itemScopedIdentifier5;
        v57 = 2112;
        v58 = recordCopy;
        _os_log_impl(&dword_19BF1F000, computeSyncAttributes, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Unable to fetch asset with scopedIdentifier %{public}@ for compute state record %@", buf, 0x16u);
      }

      goto LABEL_18;
    }

    v15 = 0;
LABEL_14:
    v28 = 0;
LABEL_29:

    goto LABEL_30;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v56 = recordCopy;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Nil item scoped identifier in compute state record: %@", buf, 0xCu);
    }

    goto LABEL_14;
  }

  v28 = 0;
LABEL_30:

  return v28;
}

+ (id)createSparseComputeStateRecordsForAssets:(id)assets inPhotoLibrary:(id)library
{
  assetsCopy = assets;
  libraryCopy = library;
  v7 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v17 = 0;
  v18 = &v17;
  v19 = 0x3032000000;
  v20 = __Block_byref_object_copy__56697;
  v21 = __Block_byref_object_dispose__56698;
  v22 = [objc_alloc(MEMORY[0x1E695DF70]) initWithCapacity:{objc_msgSend(v7, "count")}];
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __87__PLManagedAsset_ComputeSync__createSparseComputeStateRecordsForAssets_inPhotoLibrary___block_invoke;
  v13[3] = &unk_1E7578820;
  v8 = assetsCopy;
  v14 = v8;
  v9 = libraryCopy;
  v15 = v9;
  v16 = &v17;
  [v9 performBlockAndWait:v13];
  if ([v18[5] count])
  {
    v10 = v18[5];
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  _Block_object_dispose(&v17, 8);

  return v11;
}

void __87__PLManagedAsset_ComputeSync__createSparseComputeStateRecordsForAssets_inPhotoLibrary___block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 32);
  v3 = +[(PLManagedObjectJournalEntryPayload *)PLAssetComputeSyncJournalEntryPayload];
  v21 = a1;
  v4 = [PLManagedAsset assetsWithScopedIdentifiers:v2 prefetchResources:0 relationshipKeyPathsForPrefetching:v3 inLibrary:*(a1 + 40)];

  v24 = 0u;
  v25 = 0u;
  v22 = 0u;
  v23 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v22 objects:v26 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v23;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v23 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v22 + 1) + 8 * i);
        if ([v10 shouldPushComputeSync])
        {
          v11 = [v10 analysisStateModificationDate];
          v12 = v11;
          if (v11)
          {
            v13 = v11;
          }

          else
          {
            v13 = [MEMORY[0x1E695DF00] date];
          }

          v14 = v13;

          v15 = objc_alloc(MEMORY[0x1E6994B68]);
          v16 = [v10 scopedIdentifier];
          v17 = [v10 _currentComputeStateVersion];
          v18 = [v10 additionalAttributes];
          v19 = [v18 adjustedStableHash];
          v20 = [v15 initWithItemScopedIdentifier:v16 version:v17 fileURL:0 adjustmentFingerprint:v19 lastUpdatedDate:v14];

          [*(*(*(v21 + 48) + 8) + 40) addObject:v20];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v22 objects:v26 count:16];
    }

    while (v7);
  }
}

- (BOOL)sceneAnalysisWasPerformedOnLatestAdjustment
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  if ([additionalAttributes sceneAnalysisVersion])
  {
    dateForComparingAdjustmentVersions = [(PLManagedAsset *)self dateForComparingAdjustmentVersions];
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    sceneAnalysisTimestamp = [additionalAttributes2 sceneAnalysisTimestamp];
    v7 = [dateForComparingAdjustmentVersions isEqualToDate:sceneAnalysisTimestamp];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)removeAllTemporalSceneClassifications
{
  v17 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  temporalSceneClassifications = [additionalAttributes temporalSceneClassifications];
  v4 = [temporalSceneClassifications copy];

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        managedObjectContext = [v10 managedObjectContext];
        [managedObjectContext deleteObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }
}

- (void)removeAllStillFrameSceneClassifications
{
  v17 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  sceneClassifications = [additionalAttributes sceneClassifications];
  v4 = [sceneClassifications copy];

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        managedObjectContext = [v10 managedObjectContext];
        [managedObjectContext deleteObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }
}

- (void)removeTemporalSceneClassificationsOfType:(int64_t)type
{
  v19 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  temporalSceneClassifications = [additionalAttributes temporalSceneClassifications];
  v6 = [temporalSceneClassifications copy];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        if ([v12 classificationType] == type)
        {
          managedObjectContext = [v12 managedObjectContext];
          [managedObjectContext deleteObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }
}

- (void)removeSceneClassificationsOfType:(int64_t)type
{
  v19 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  sceneClassifications = [additionalAttributes sceneClassifications];
  v6 = [sceneClassifications copy];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        if ([v12 classificationType] == type)
        {
          managedObjectContext = [v12 managedObjectContext];
          [managedObjectContext deleteObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }
}

- (BOOL)calculateAllowedForAnalysis
{
  [MEMORY[0x1E69BF328] maskForAllowedForAnalysis];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    montage = [additionalAttributes montage];
    if (montage)
    {
      v5 = 0;
    }

    else
    {
      extendedAttributes = [(PLManagedAsset *)self extendedAttributes];
      generativeAIType = [extendedAttributes generativeAIType];
      v5 = [generativeAIType intValue] != 1;
    }
  }

  else
  {
    v5 = 0;
  }

  v8 = ([(PLManagedAsset *)self hidden]& 1) == 0 && ![(PLManagedAsset *)self trashedState]&& [(PLManagedAsset *)self avalanchePickTypeIsVisible];
  return v5 && v8;
}

- (NSDate)dateForComparingAdjustmentVersions
{
  adjustmentTimestamp = [(PLManagedAsset *)self adjustmentTimestamp];
  v4 = adjustmentTimestamp;
  if (adjustmentTimestamp)
  {
    dateCreated = adjustmentTimestamp;
  }

  else
  {
    dateCreated = [(PLManagedAsset *)self dateCreated];
  }

  v6 = dateCreated;

  return v6;
}

- (id)analysisStateForWorkerType:(signed __int16)type
{
  typeCopy = type;
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  analysisStates = [(PLManagedAsset *)self analysisStates];
  v5 = [analysisStates countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(analysisStates);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 workerType] == typeCopy)
        {
          v10 = v9;
          goto LABEL_11;
        }
      }

      v6 = [analysisStates countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_11:

  return v10;
}

- (BOOL)_analysisStateWasChangedForWorkerType:(signed __int16)type
{
  v3 = [(PLManagedAsset *)self analysisStateForWorkerType:type];
  changedValues = [v3 changedValues];
  v5 = [changedValues count] != 0;

  return v5;
}

- (void)setUserCloudSharedLiked:(BOOL)liked
{
  likedCopy = liked;
  v26 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self userCloudSharedLiked]!= liked)
  {
    if (likedCopy)
    {
      photoLibrary = [(PLManagedObject *)self photoLibrary];
      v6 = [PLCloudSharedComment insertNewCommentIntoAsset:self commentDate:0 withText:0 isLike:1 isMyComment:1 inLibrary:photoLibrary];
      v23[0] = MEMORY[0x1E69E9820];
      v23[1] = 3221225472;
      v23[2] = __62__PLManagedAsset_PLCloudSharedAsset__setUserCloudSharedLiked___block_invoke;
      v23[3] = &unk_1E7578848;
      v23[4] = self;
      v24 = v6;
      v7 = v6;
      [photoLibrary addCompletionHandlerToCurrentTransaction:v23];
    }

    else
    {
      v21 = 0u;
      v22 = 0u;
      v19 = 0u;
      v20 = 0u;
      likeComments = [(PLManagedAsset *)self likeComments];
      photoLibrary = [likeComments countByEnumeratingWithState:&v19 objects:v25 count:16];
      if (photoLibrary)
      {
        v9 = *v20;
        while (2)
        {
          for (i = 0; i != photoLibrary; i = i + 1)
          {
            if (*v20 != v9)
            {
              objc_enumerationMutation(likeComments);
            }

            v11 = *(*(&v19 + 1) + 8 * i);
            isMyComment = [v11 isMyComment];
            bOOLValue = [isMyComment BOOLValue];

            if (bOOLValue)
            {
              photoLibrary = v11;
              goto LABEL_14;
            }
          }

          photoLibrary = [likeComments countByEnumeratingWithState:&v19 objects:v25 count:16];
          if (photoLibrary)
          {
            continue;
          }

          break;
        }
      }

LABEL_14:

      collectionShare = [(PLManagedAsset *)self collectionShare];
      collectionShareKind = [collectionShare collectionShareKind];
      photoLibrary2 = [(PLManagedObject *)self photoLibrary];
      v7 = [PLCollectionShare syncBackendForKind:collectionShareKind photoLibrary:photoLibrary2];

      if (v7)
      {
        cloudGUID = [photoLibrary cloudGUID];

        if (cloudGUID)
        {
          cloudGUID2 = [photoLibrary cloudGUID];
          [v7 deleteCommentWithGUIDFromServer:cloudGUID2];
        }
      }

      [(PLManagedAsset *)self deleteComment:photoLibrary];
    }
  }
}

void __62__PLManagedAsset_PLCloudSharedAsset__setUserCloudSharedLiked___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionShare];
  v3 = [v2 collectionShareKind];
  v4 = [*(a1 + 32) photoLibrary];
  v6 = [PLCollectionShare syncBackendForKind:v3 photoLibrary:v4];

  v5 = v6;
  if (v6)
  {
    [v6 publishCloudSharedCommentToServer:*(a1 + 40)];
    v5 = v6;
  }
}

- (void)userReadAllCloudSharedComments
{
  orderedCloudComments = [(PLManagedAsset *)self orderedCloudComments];
  lastObject = [orderedCloudComments lastObject];
  commentDate = [lastObject commentDate];

  orderedLikeComments = [(PLManagedAsset *)self orderedLikeComments];
  lastObject2 = [orderedLikeComments lastObject];
  commentDate2 = [lastObject2 commentDate];

  v8 = commentDate != 0;
  if (commentDate && commentDate2)
  {
    v8 = [commentDate compare:commentDate2] == 1;
  }

  if (v8)
  {
    v9 = commentDate;
  }

  else
  {
    v9 = commentDate2;
  }

  v10 = v9;
  cloudAssetGUID = [(PLManagedAsset *)self cloudAssetGUID];
  [PLPhotoSharingHelper markCommentsForAssetCollectionWithGUID:cloudAssetGUID asViewedWithLastViewedDate:v10];
}

- (NSOrderedSet)orderedLikeComments
{
  v9[1] = *MEMORY[0x1E69E9840];
  [(PLManagedAsset *)self willAccessValueForKey:@"likeComments"];
  likeComments = [(PLManagedAsset *)self likeComments];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"commentDate" ascending:1];
  v9[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
  v6 = [likeComments sortedArrayUsingDescriptors:v5];

  [(PLManagedAsset *)self didAccessValueForKey:@"likeComments"];
  v7 = [MEMORY[0x1E695DFB8] orderedSetWithArray:v6];

  return v7;
}

- (NSOrderedSet)orderedCloudComments
{
  v9[1] = *MEMORY[0x1E69E9840];
  [(PLManagedAsset *)self willAccessValueForKey:@"cloudComments"];
  cloudComments = [(PLManagedAsset *)self cloudComments];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"commentDate" ascending:1];
  v9[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
  v6 = [cloudComments sortedArrayUsingDescriptors:v5];

  [(PLManagedAsset *)self didAccessValueForKey:@"cloudComments"];
  v7 = [MEMORY[0x1E695DFB8] orderedSetWithArray:v6];

  return v7;
}

- (unint64_t)_countForCommentRelationshipNamed:(id)named inverseRelationshipName:(id)name
{
  namedCopy = named;
  nameCopy = name;
  v9 = nameCopy;
  if (!namedCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLCloudSharedAsset.m" lineNumber:393 description:{@"Invalid parameter not satisfying: %@", @"assetRelationshipName"}];

    if (v9)
    {
      goto LABEL_3;
    }

LABEL_9:
    currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLCloudSharedAsset.m" lineNumber:394 description:{@"Invalid parameter not satisfying: %@", @"inverseRelationshipName"}];

    goto LABEL_3;
  }

  if (!nameCopy)
  {
    goto LABEL_9;
  }

LABEL_3:
  if (([(PLManagedAsset *)self isFault]& 1) != 0 || ([(PLManagedAsset *)self hasFaultForRelationshipNamed:namedCopy]& 1) != 0)
  {
    v10 = MEMORY[0x1E695D5E0];
    v11 = +[PLCloudSharedComment entityName];
    v12 = [v10 fetchRequestWithEntityName:v11];

    v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@", v9, self];
    [v12 setPredicate:v13];

    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    v15 = [managedObjectContext countForFetchRequest:v12 error:0];
  }

  else
  {
    v12 = [(PLManagedAsset *)self valueForKey:namedCopy];
    v15 = [v12 count];
  }

  return v15;
}

- (BOOL)userCloudSharedLiked
{
  v14 = *MEMORY[0x1E69E9840];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  likeComments = [(PLManagedAsset *)self likeComments];
  v3 = [likeComments countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v3)
  {
    v4 = *v10;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v10 != v4)
        {
          objc_enumerationMutation(likeComments);
        }

        isMyComment = [*(*(&v9 + 1) + 8 * i) isMyComment];
        bOOLValue = [isMyComment BOOLValue];

        if (bOOLValue)
        {
          LOBYTE(v3) = 1;
          goto LABEL_11;
        }
      }

      v3 = [likeComments countByEnumeratingWithState:&v9 objects:v13 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v3;
}

- (void)userDeleteCloudSharedComment:(id)comment
{
  commentCopy = comment;
  collectionShare = [(PLManagedAsset *)self collectionShare];
  collectionShareKind = [collectionShare collectionShareKind];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v7 = [PLCollectionShare syncBackendForKind:collectionShareKind photoLibrary:photoLibrary];

  if (v7)
  {
    cloudGUID = [commentCopy cloudGUID];

    if (cloudGUID)
    {
      cloudGUID2 = [commentCopy cloudGUID];
      [v7 deleteCommentWithGUIDFromServer:cloudGUID2];
    }
  }

  [(PLManagedAsset *)self deleteComment:commentCopy];
}

- (id)userAddCloudSharedCommentWithText:(id)text
{
  textCopy = text;
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v6 = [PLCloudSharedComment insertNewCommentIntoAsset:self commentDate:0 withText:textCopy isLike:0 isMyComment:1 inLibrary:photoLibrary];

  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __72__PLManagedAsset_PLCloudSharedAsset__userAddCloudSharedCommentWithText___block_invoke;
  v11[3] = &unk_1E7578848;
  v11[4] = self;
  v7 = v6;
  v12 = v7;
  [photoLibrary addCompletionHandlerToCurrentTransaction:v11];
  v8 = v12;
  v9 = v7;

  return v7;
}

void __72__PLManagedAsset_PLCloudSharedAsset__userAddCloudSharedCommentWithText___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionShare];
  v3 = [v2 collectionShareKind];
  v4 = [*(a1 + 32) photoLibrary];
  v6 = [PLCollectionShare syncBackendForKind:v3 photoLibrary:v4];

  v5 = v6;
  if (v6)
  {
    [v6 publishCloudSharedCommentToServer:*(a1 + 40)];
    v5 = v6;
  }
}

- (BOOL)cloudHasSameOwnerAsAsset:(id)asset
{
  if (!asset)
  {
    return 0;
  }

  assetCopy = asset;
  collectionShareContributor = [(PLManagedAsset *)self collectionShareContributor];
  collectionShareContributor2 = [assetCopy collectionShareContributor];

  LOBYTE(assetCopy) = [collectionShareContributor isEqual:collectionShareContributor2];
  return assetCopy;
}

- (int)cloudCommentsStatusForOwnedAsset:(BOOL)asset
{
  totalCommentsCount = [(PLManagedAsset *)self totalCommentsCount];
  if (totalCommentsCount)
  {
    if ([(PLManagedAsset *)self cloudHasUnseenComments])
    {
      LODWORD(totalCommentsCount) = 2;
    }

    else
    {
      LODWORD(totalCommentsCount) = 1;
    }
  }

  return totalCommentsCount;
}

- (void)deleteComment:(id)comment
{
  v61 = *MEMORY[0x1E69E9840];
  commentCopy = comment;
  v5 = commentCopy;
  if (commentCopy)
  {
    isLike = [commentCopy isLike];
    bOOLValue = [isLike BOOLValue];

    if (bOOLValue)
    {
      [v5 setLikedAsset:0];
    }

    else
    {
      [v5 setCommentedAsset:0];
    }

    isMyComment = [v5 isMyComment];
    bOOLValue2 = [isMyComment BOOLValue];

    [(PLManagedAsset *)self cloudHasCommentsByMe];
    if (bOOLValue2)
    {
      v55 = 0u;
      v56 = 0u;
      v53 = 0u;
      v54 = 0u;
      cloudComments = [(PLManagedAsset *)self cloudComments];
      v11 = [cloudComments countByEnumeratingWithState:&v53 objects:v60 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v54;
LABEL_8:
        v14 = 0;
        while (1)
        {
          if (*v54 != v13)
          {
            objc_enumerationMutation(cloudComments);
          }

          v15 = *(*(&v53 + 1) + 8 * v14);
          if (v15 != v5)
          {
            isMyComment2 = [v15 isMyComment];
            bOOLValue3 = [isMyComment2 BOOLValue];

            if (bOOLValue3)
            {
              goto LABEL_47;
            }
          }

          if (v12 == ++v14)
          {
            v12 = [cloudComments countByEnumeratingWithState:&v53 objects:v60 count:16];
            if (v12)
            {
              goto LABEL_8;
            }

            break;
          }
        }
      }

      v51 = 0u;
      v52 = 0u;
      v49 = 0u;
      v50 = 0u;
      cloudComments = [(PLManagedAsset *)self likeComments];
      v18 = [cloudComments countByEnumeratingWithState:&v49 objects:v59 count:16];
      if (v18)
      {
        v19 = v18;
        v20 = *v50;
LABEL_17:
        v21 = 0;
        while (1)
        {
          if (*v50 != v20)
          {
            objc_enumerationMutation(cloudComments);
          }

          v22 = *(*(&v49 + 1) + 8 * v21);
          if (v22 != v5)
          {
            isMyComment3 = [v22 isMyComment];
            bOOLValue4 = [isMyComment3 BOOLValue];

            if (bOOLValue4)
            {
              break;
            }
          }

          if (v19 == ++v21)
          {
            v19 = [cloudComments countByEnumeratingWithState:&v49 objects:v59 count:16];
            if (v19)
            {
              goto LABEL_17;
            }

            goto LABEL_24;
          }
        }

LABEL_47:

        [(PLManagedAsset *)self cloudHasCommentsConversation];
        goto LABEL_49;
      }

LABEL_24:

      [(PLManagedAsset *)self setCloudHasCommentsByMe:0];
      if (([(PLManagedAsset *)self cloudHasCommentsConversation]& 1) == 0)
      {
        goto LABEL_49;
      }

      goto LABEL_46;
    }

    if (![(PLManagedAsset *)self cloudHasCommentsConversation])
    {
LABEL_49:
      managedObjectContext = [v5 managedObjectContext];
      [managedObjectContext deleteObject:v5];

      goto LABEL_50;
    }

    v47 = 0u;
    v48 = 0u;
    v45 = 0u;
    v46 = 0u;
    cloudComments2 = [(PLManagedAsset *)self cloudComments];
    v26 = [cloudComments2 countByEnumeratingWithState:&v45 objects:v58 count:16];
    if (v26)
    {
      v27 = v26;
      v28 = *v46;
LABEL_29:
      v29 = 0;
      while (1)
      {
        if (*v46 != v28)
        {
          objc_enumerationMutation(cloudComments2);
        }

        v30 = *(*(&v45 + 1) + 8 * v29);
        if (v30 != v5)
        {
          isMyComment4 = [v30 isMyComment];
          bOOLValue5 = [isMyComment4 BOOLValue];

          if (!bOOLValue5)
          {
            break;
          }
        }

        if (v27 == ++v29)
        {
          v27 = [cloudComments2 countByEnumeratingWithState:&v45 objects:v58 count:16];
          if (v27)
          {
            goto LABEL_29;
          }

          goto LABEL_36;
        }
      }
    }

    else
    {
LABEL_36:

      v43 = 0u;
      v44 = 0u;
      v41 = 0u;
      v42 = 0u;
      cloudComments2 = [(PLManagedAsset *)self likeComments];
      v33 = [cloudComments2 countByEnumeratingWithState:&v41 objects:v57 count:16];
      if (!v33)
      {
LABEL_45:

LABEL_46:
        [(PLManagedAsset *)self setCloudHasCommentsConversation:0];
        goto LABEL_49;
      }

      v34 = v33;
      v35 = *v42;
LABEL_38:
      v36 = 0;
      while (1)
      {
        if (*v42 != v35)
        {
          objc_enumerationMutation(cloudComments2);
        }

        v37 = *(*(&v41 + 1) + 8 * v36);
        if (v37 != v5)
        {
          isMyComment5 = [v37 isMyComment];
          bOOLValue6 = [isMyComment5 BOOLValue];

          if (!bOOLValue6)
          {
            break;
          }
        }

        if (v34 == ++v36)
        {
          v34 = [cloudComments2 countByEnumeratingWithState:&v41 objects:v57 count:16];
          if (v34)
          {
            goto LABEL_38;
          }

          goto LABEL_45;
        }
      }
    }

    goto LABEL_49;
  }

LABEL_50:
}

- (void)addComment:(id)comment
{
  commentCopy = comment;
  if (commentCopy)
  {
    v12 = commentCopy;
    isMyComment = [commentCopy isMyComment];
    bOOLValue = [isMyComment BOOLValue];

    cloudHasCommentsByMe = [(PLManagedAsset *)self cloudHasCommentsByMe];
    if (([(PLManagedAsset *)self cloudHasCommentsConversation]& 1) != 0)
    {
      goto LABEL_10;
    }

    if (cloudHasCommentsByMe)
    {
      if (bOOLValue)
      {
        goto LABEL_12;
      }
    }

    else
    {
      if (!bOOLValue)
      {
LABEL_12:
        isLike = [v12 isLike];
        bOOLValue2 = [isLike BOOLValue];

        if (bOOLValue2)
        {
          v10 = @"likeComments";
        }

        else
        {
          v10 = @"cloudComments";
        }

        v11 = [(PLManagedAsset *)self mutableSetValueForKey:v10];
        [v11 addObject:v12];

        commentCopy = v12;
        goto LABEL_16;
      }

      if (![(PLManagedAsset *)self cloudCommentsCount]&& ![(PLManagedAsset *)self likeCommentsCount])
      {
LABEL_10:
        if (!(cloudHasCommentsByMe & 1 | ((bOOLValue & 1) == 0)))
        {
          [(PLManagedAsset *)self setCloudHasCommentsByMe:1];
        }

        goto LABEL_12;
      }
    }

    [(PLManagedAsset *)self setCloudHasCommentsConversation:1];
    goto LABEL_10;
  }

LABEL_16:
}

- (id)cloudSharedAssetPathForPlaceholderKind:(signed __int16)kind
{
  kindCopy = kind;
  [(PLManagedAsset *)self isCloudSharedAsset];
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  if (kindCopy > 7)
  {
    switch(kindCopy)
    {
      case 8:
        v6 = @"MOV";
        break;
      case 9:
        v6 = @"medium.MP4";
        break;
      case 10:
        v6 = @"small.MP4";
        break;
      default:
        goto LABEL_16;
    }
  }

  else
  {
    switch(kindCopy)
    {
      case 3:
        v6 = @"thumb.JPG";
        break;
      case 4:
        v7 = MEMORY[0x1E69C08F0];
        uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
        v9 = [v7 typeWithIdentifier:uniformTypeIdentifier];
        v10 = [v9 isEqual:*MEMORY[0x1E6982DE8]];

        if ((v10 & 1) == 0)
        {
          goto LABEL_16;
        }

        v6 = @"GIF";
        break;
      case 7:
        v6 = @"poster.JPG";
        break;
      default:
        goto LABEL_16;
    }
  }

  v11 = [(PLManagedAsset *)self _cloudSharedPathWithExtension:v6];

  pathForOriginalFile = v11;
LABEL_16:

  return pathForOriginalFile;
}

- (id)_cloudSharedPathWithExtension:(id)extension
{
  extensionCopy = extension;
  pathForOriginalFile = [(PLManagedAsset *)self pathForOriginalFile];
  stringByDeletingPathExtension = [pathForOriginalFile stringByDeletingPathExtension];
  v7 = [stringByDeletingPathExtension stringByAppendingPathExtension:extensionCopy];

  return v7;
}

- (NSString)cloudOwnerDisplayName
{
  cloudOwnerFirstName = [(PLManagedAsset *)self cloudOwnerFirstName];
  cloudOwnerLastName = [(PLManagedAsset *)self cloudOwnerLastName];
  cloudOwnerFullName = [(PLManagedAsset *)self cloudOwnerFullName];
  v6 = [PLCloudSharedAlbum cloudOwnerDisplayNameWithFirstName:cloudOwnerFirstName lastName:cloudOwnerLastName fullName:cloudOwnerFullName emailKey:0 includingEmail:0 allowsEmail:0 emailAddressManager:0];

  return v6;
}

- (NSString)cloudOwnerFullName
{
  collectionShareContributor = [(PLManagedAsset *)self collectionShareContributor];
  fullName = [collectionShareContributor fullName];

  return fullName;
}

- (NSString)cloudOwnerLastName
{
  collectionShareContributor = [(PLManagedAsset *)self collectionShareContributor];
  nameComponents = [collectionShareContributor nameComponents];
  familyName = [nameComponents familyName];

  return familyName;
}

- (NSString)cloudOwnerFirstName
{
  collectionShareContributor = [(PLManagedAsset *)self collectionShareContributor];
  nameComponents = [collectionShareContributor nameComponents];
  givenName = [nameComponents givenName];

  return givenName;
}

- (NSString)cloudOwnerEmail
{
  collectionShareContributor = [(PLManagedAsset *)self collectionShareContributor];
  emailAddress = [collectionShareContributor emailAddress];

  return emailAddress;
}

+ (id)lightweightReimportFileNameWithGUID:(id)d type:(id)type
{
  dCopy = d;
  if (d)
  {
    if (type)
    {
      typeCopy = type;
    }

    else
    {
      typeCopy = @"JPG";
    }

    typeCopy2 = type;
    dCopy = [dCopy stringByAppendingPathExtension:typeCopy];
  }

  return dCopy;
}

+ (void)markAssetAsRecentlyUsed:(id)used
{
  usedCopy = used;
  cloudAssetGUID = [usedCopy cloudAssetGUID];
  if (cloudAssetGUID)
  {
    pathManager = [usedCopy pathManager];
    pathManager2 = [usedCopy pathManager];

    if (!pathManager2)
    {
      currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
      [currentHandler handleFailureInMethod:a2 object:self file:@"PLCloudSharedAsset.m" lineNumber:541 description:{@"Invalid parameter not satisfying: %@", @"asset.pathManager"}];
    }

    pl_dispatch_once();
    v11 = cloudAssetGUID;
    v9 = pathManager;
    pl_dispatch_async();
  }
}

void __62__PLManagedAsset_PLCloudSharedAsset__markAssetAsRecentlyUsed___block_invoke_129(uint64_t a1)
{
  v35 = *MEMORY[0x1E69E9840];
  v2 = PLPhotoSharingGetLog();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT))
  {
    v3 = *(a1 + 32);
    *buf = 138412290;
    v30 = v3;
    _os_log_impl(&dword_19BF1F000, v2, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) markAssetAsRecentlyUsed %@", buf, 0xCu);
  }

  v4 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
  if (!markAssetAsRecentlyUsed__recentlyUsedGUIDS)
  {
    v5 = [objc_opt_class() persistedRecentlyUsedGUIDSWithPathManager:*(a1 + 40)];
    v6 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
    markAssetAsRecentlyUsed__recentlyUsedGUIDS = v5;

    v7 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS count];
      *buf = 134217984;
      v30 = v8;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) loaded recently used list with %lu entries", buf, 0xCu);
    }

    v4 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
    if (!markAssetAsRecentlyUsed__recentlyUsedGUIDS)
    {
      v9 = objc_alloc(MEMORY[0x1E695DFA0]);
      v10 = [v9 initWithCapacity:markAssetAsRecentlyUsed__maxListSize];
      v11 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
      markAssetAsRecentlyUsed__recentlyUsedGUIDS = v10;

      v4 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
    }
  }

  if ([v4 containsObject:*(a1 + 32)])
  {
    [markAssetAsRecentlyUsed__recentlyUsedGUIDS removeObject:*(a1 + 32)];
  }

  [markAssetAsRecentlyUsed__recentlyUsedGUIDS addObject:*(a1 + 32)];
  ++markAssetAsRecentlyUsed__changesSinceLastSave;
  v12 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS count];
  if (v12 >= markAssetAsRecentlyUsed__maxListSize)
  {
    [markAssetAsRecentlyUsed__recentlyUsedGUIDS removeObjectsInRange:{0, v12 - markAssetAsRecentlyUsed__maxListSize}];
    v12 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS count];
  }

  if (markAssetAsRecentlyUsed__changesSinceLastSave > markAssetAsRecentlyUsed__maxChangesBetweenSaves)
  {
    v13 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 134218496;
      v30 = v12;
      v31 = 2048;
      v32 = markAssetAsRecentlyUsed__changesSinceLastSave;
      v33 = 2048;
      v34 = markAssetAsRecentlyUsed__maxChangesBetweenSaves;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) will save recently used list with size %lu changes since last save %lu maxChangesBetweenSaves %lu", buf, 0x20u);
    }

    v14 = [MEMORY[0x1E696AC08] defaultManager];
    v15 = [objc_opt_class() recentlyUsedGUIDsPathWithPathManager:*(a1 + 40)];
    v28 = 0;
    v16 = [v14 removeItemAtPath:v15 error:&v28];
    v17 = v28;
    if ((v16 & 1) == 0 && [v14 fileExistsAtPath:v15])
    {
      v18 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v30 = v17;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR deleting recently used list :%@", buf, 0xCu);
      }
    }

    v19 = MEMORY[0x1E696AE40];
    v20 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS array];
    v27 = 0;
    v21 = [v19 dataWithPropertyList:v20 format:200 options:0 error:&v27];
    v22 = v27;

    if (v21)
    {
      v26 = v22;
      v23 = [v21 writeToFile:v15 options:1073741825 error:&v26];
      v24 = v26;

      if (v23)
      {
LABEL_28:
        markAssetAsRecentlyUsed__changesSinceLastSave = 0;

        return;
      }

      v25 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v30 = v24;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR failed to write recently used list: %@", buf, 0xCu);
      }

      v22 = v24;
    }

    else
    {
      v25 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v30 = v22;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR failed to serialize recently used list: %@", buf, 0xCu);
      }
    }

    v24 = v22;
    goto LABEL_28;
  }
}

void __62__PLManagedAsset_PLCloudSharedAsset__markAssetAsRecentlyUsed___block_invoke()
{
  v14 = *MEMORY[0x1E69E9840];
  v0 = dispatch_queue_create("com.apple.PLCloudSharedAssetSaveJob.recentlyUsedAssetsQueue", 0);
  v1 = markAssetAsRecentlyUsed__recentlyUsedAssetsQueue;
  markAssetAsRecentlyUsed__recentlyUsedAssetsQueue = v0;

  CFPreferencesAppSynchronize(@"com.apple.mobileslideshow");
  keyExistsAndHasValidFormat = 0;
  AppIntegerValue = CFPreferencesGetAppIntegerValue(@"sharingRecentlyUsedListMax", @"com.apple.mobileslideshow", &keyExistsAndHasValidFormat);
  if (AppIntegerValue)
  {
    v3 = keyExistsAndHasValidFormat == 0;
  }

  else
  {
    v3 = 1;
  }

  v4 = 200;
  if (!v3)
  {
    v4 = AppIntegerValue;
  }

  markAssetAsRecentlyUsed__maxListSize = v4;
  v5 = CFPreferencesGetAppIntegerValue(@"sharingRecentlyUsedMaxChangesBetweenSaves", @"com.apple.mobileslideshow", &keyExistsAndHasValidFormat);
  if (v5)
  {
    v6 = keyExistsAndHasValidFormat == 0;
  }

  else
  {
    v6 = 1;
  }

  v7 = 10;
  if (!v6)
  {
    v7 = v5;
  }

  markAssetAsRecentlyUsed__maxChangesBetweenSaves = v7;
  v8 = PLPhotoSharingGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    *buf = 134218240;
    v11 = markAssetAsRecentlyUsed__maxListSize;
    v12 = 2048;
    v13 = markAssetAsRecentlyUsed__maxChangesBetweenSaves;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) maxListSize %lu maxChangesBetweenSaves %lu", buf, 0x16u);
  }
}

+ (id)persistedRecentlyUsedGUIDSWithPathManager:(id)manager
{
  v12 = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E695DEF0];
  v4 = [self recentlyUsedGUIDsPathWithPathManager:manager];
  v5 = [v3 dataWithContentsOfFile:v4];

  if (v5)
  {
    v6 = [MEMORY[0x1E696AE40] propertyListWithData:v5 options:0 format:0 error:0];
    if (v6)
    {
      v7 = [objc_alloc(MEMORY[0x1E695DFA0]) initWithArray:v6];
    }

    else
    {
      v8 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v10 = 138412290;
        v11 = 0;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR failed to de-serialize recently used list: %@", &v10, 0xCu);
      }

      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

+ (id)fetchRequestForSortedCloudSharedAssetsWithPlaceholderKindsRequiringThumbnails:(BOOL)thumbnails additionalPredicate:(id)predicate ascending:(BOOL)ascending
{
  ascendingCopy = ascending;
  thumbnailsCopy = thumbnails;
  predicateCopy = predicate;
  v8 = MEMORY[0x1E695D5E0];
  v9 = +[PLManagedAsset entityName];
  v10 = [v8 fetchRequestWithEntityName:v9];

  v11 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v12 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForCloudSharedAsset"), 1}];
  [v11 addObject:v12];

  if (thumbnailsCopy)
  {
    0xFFFFFFFFLL = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"thumbnailIndex", 0xFFFFFFFFLL];
    [v11 addObject:0xFFFFFFFFLL];
  }

  if (predicateCopy)
  {
    [v11 addObject:predicateCopy];
  }

  v14 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v11];
  [v10 setPredicate:v14];
  v15 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"cloudServerPublishDate" ascending:ascendingCopy];
  v16 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"cloudBatchPublishDate" ascending:ascendingCopy];
  v17 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:ascendingCopy];
  v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:{v15, v16, v17, 0}];
  [v10 setSortDescriptors:v18];

  [v10 setFetchBatchSize:100];

  return v10;
}

+ (id)cloudSharedAssetsWithGUIDs:(id)ds inLibrary:(id)library
{
  v20[2] = *MEMORY[0x1E69E9840];
  dsCopy = ds;
  libraryCopy = library;
  v7 = objc_autoreleasePoolPush();
  managedObjectContext = [libraryCopy managedObjectContext];
  v9 = MEMORY[0x1E696AB28];
  dsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", @"cloudAssetGUID", dsCopy];
  v20[0] = dsCopy;
  v11 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForCloudSharedAsset"), 1}];
  v20[1] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:2];
  v13 = [v9 andPredicateWithSubpredicates:v12];

  v14 = MEMORY[0x1E695D5E0];
  v15 = +[PLManagedAsset entityName];
  v16 = [v14 fetchRequestWithEntityName:v15];

  if ([dsCopy count] >= 0x65)
  {
    [v16 setFetchBatchSize:100];
  }

  [v16 setPredicate:v13];
  v19 = 0;
  v17 = [managedObjectContext executeFetchRequest:v16 error:&v19];

  objc_autoreleasePoolPop(v7);

  return v17;
}

+ (id)allCloudSharedAssetsInLibrary:(id)library
{
  managedObjectContext = [library managedObjectContext];
  v5 = [self assetsWithValidatedSavedAssetTypeMask:objc_msgSend(MEMORY[0x1E69BF328] inManagedObjectContext:{"maskForCloudSharedAsset"), managedObjectContext}];

  return v5;
}

- (id)payloadForChangedKeys:(id)keys
{
  keysCopy = keys;
  if ([(PLManagedAsset *)self isValidForJournalPersistence])
  {
    v5 = [(PLManagedObjectJournalEntryPayload *)[PLAssetJournalEntryPayload alloc] initWithManagedObject:self changedKeys:keysCopy];
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)payloadIDForTombstone:(id)tombstone
{
  v3 = [tombstone objectForKeyedSubscript:@"uuid"];
  v4 = [PLJournalEntryPayloadIDFactory payloadIDWithUUIDString:v3];

  return v4;
}

- (id)payloadID
{
  uuid = [(PLManagedAsset *)self uuid];
  v3 = [PLJournalEntryPayloadIDFactory payloadIDWithUUIDString:uuid];

  return v3;
}

- (BOOL)isValidForJournalPersistence
{
  v2 = MEMORY[0x1E69BF2A0];
  bundleScope = [(PLManagedAsset *)self bundleScope];

  return [v2 bundleScopeShouldBePersistedForRebuild:bundleScope];
}

- (BOOL)_setupPlaceholderAdjustmentPropertiesFromSourceAsset:(id)asset bakeInAdjustmentsFromSourceAsset:(BOOL)sourceAsset library:(id)library
{
  v32 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  libraryCopy = library;
  if ([assetCopy hasAdjustments])
  {
    v10 = MEMORY[0x1E6994D48];
    if (sourceAsset)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v11 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          uuid = [assetCopy uuid];
          uuid2 = [(PLManagedAsset *)self uuid];
          *buf = 138412546;
          v27 = uuid;
          v28 = 2112;
          selfCopy = uuid2;
          _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Baking in adjustments from sourceAsset: %@ into placeholderAsset: %@", buf, 0x16u);
        }
      }

      -[PLManagedAsset setOriginalHeight:](self, "setOriginalHeight:", [assetCopy height]);
      -[PLManagedAsset setOriginalWidth:](self, "setOriginalWidth:", [assetCopy width]);
      -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [assetCopy orientation]);
      [(PLManagedAsset *)self setVideoCpVisibilityState:0];
      goto LABEL_8;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        uuid3 = [assetCopy uuid];
        uuid4 = [(PLManagedAsset *)self uuid];
        *buf = 138412546;
        v27 = uuid3;
        v28 = 2112;
        selfCopy = uuid4;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEFAULT, "Copying adjustments from sourceAsset: %@ to placeholderAsset: %@", buf, 0x16u);
      }
    }

    v25 = 0;
    v18 = [PLUnmanagedAdjustment copyUnmanagedAdjustmentFromSourceAsset:assetCopy forPlaceholderAsset:self inLibrary:libraryCopy error:&v25];
    v19 = v25;
    v14 = v19 == 0;
    if (v19)
    {
      if (*v10)
      {
LABEL_19:

        goto LABEL_20;
      }

      additionalAttributes3 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(additionalAttributes3, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v27 = assetCopy;
        v28 = 2112;
        selfCopy = self;
        v30 = 2112;
        v31 = v19;
        _os_log_impl(&dword_19BF1F000, additionalAttributes3, OS_LOG_TYPE_ERROR, "Failed to copy unmanaged adjustmnent from sourceAsset: %@ to placeholderAsset: %@, %@", buf, 0x20u);
      }
    }

    else
    {
      -[PLManagedAsset setAdjustmentsState:](self, "setAdjustmentsState:", [assetCopy adjustmentsState]);
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      additionalAttributes2 = [assetCopy additionalAttributes];
      adjustedStableHash = [additionalAttributes2 adjustedStableHash];
      [additionalAttributes setAdjustedStableHash:adjustedStableHash];

      additionalAttributes3 = [(PLManagedAsset *)self additionalAttributes];
      [additionalAttributes3 setUnmanagedAdjustment:v18];
    }

    goto LABEL_19;
  }

LABEL_8:
  v14 = 1;
LABEL_20:

  return v14;
}

- (BOOL)setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:(id)asset placeholderAssetUUID:(id)d bundleScope:(unsigned __int16)scope share:(id)share importSessionID:(id)iD bakeInAdjustmentsFromSourceAsset:(BOOL)sourceAsset flattenLivePhoto:(BOOL)photo copyTitleDescriptionAndKeywords:(BOOL)self0 copyCameraProcessingAdjustmentResources:(BOOL)self1 library:(id)self2
{
  sourceAssetCopy = sourceAsset;
  scopeCopy = scope;
  v101 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  dCopy = d;
  shareCopy = share;
  iDCopy = iD;
  libraryCopy = library;
  v96 = shareCopy;
  subclassKind = [objc_opt_class() subclassKind];
  [(PLManagedAsset *)self setUuid:dCopy];
  v92 = dCopy;
  [(PLManagedAsset *)self setCloudAssetGUID:dCopy];
  dateCreated = [assetCopy dateCreated];
  [(PLManagedAsset *)self setDateCreated:dateCreated];

  uniformTypeIdentifier = [assetCopy uniformTypeIdentifier];
  [(PLManagedAsset *)self setUniformTypeIdentifier:uniformTypeIdentifier];

  -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForPlaceholder]);
  [(PLManagedAsset *)self setBundleScope:scopeCopy];
  -[PLManagedAsset setHeight:](self, "setHeight:", [assetCopy height]);
  -[PLManagedAsset setWidth:](self, "setWidth:", [assetCopy width]);
  -[PLManagedAsset setOriginalHeight:](self, "setOriginalHeight:", [assetCopy originalHeight]);
  -[PLManagedAsset setOriginalWidth:](self, "setOriginalWidth:", [assetCopy originalWidth]);
  -[PLManagedAsset setKind:](self, "setKind:", [assetCopy kind]);
  -[PLManagedAsset setKindSubtype:](self, "setKindSubtype:", [assetCopy kindSubtype]);
  -[PLManagedAsset setPlaybackStyle:](self, "setPlaybackStyle:", [assetCopy playbackStyle]);
  -[PLManagedAsset setPlaybackVariation:](self, "setPlaybackVariation:", [assetCopy playbackVariation]);
  -[PLManagedAsset setVideoCpDurationValue:](self, "setVideoCpDurationValue:", [assetCopy videoCpDurationValue]);
  -[PLManagedAsset setVideoCpVisibilityState:](self, "setVideoCpVisibilityState:", [assetCopy videoCpVisibilityState]);
  -[PLManagedAsset setOrientation:](self, "setOrientation:", [assetCopy orientation]);
  -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [assetCopy originalOrientation]);
  [assetCopy duration];
  [(PLManagedAsset *)self setDuration:?];
  -[PLManagedAsset setHdrType:](self, "setHdrType:", [assetCopy hdrType]);
  mediaGroupUUID = [assetCopy mediaGroupUUID];
  [(PLManagedAsset *)self setMediaGroupUUID:mediaGroupUUID];

  location = [assetCopy location];
  [(PLManagedAsset *)self setLocation:location];

  reverseLocationData = [assetCopy reverseLocationData];
  [(PLManagedAsset *)self setReverseLocationData:reverseLocationData];

  -[PLManagedAsset setPackedPreferredCropRect:](self, "setPackedPreferredCropRect:", [assetCopy packedPreferredCropRect]);
  -[PLManagedAsset setPackedAcceptableCropRect:](self, "setPackedAcceptableCropRect:", [assetCopy packedAcceptableCropRect]);
  -[PLManagedAsset setHighFrameRateState:](self, "setHighFrameRateState:", [assetCopy highFrameRateState]);
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  scopedIdentifier = [assetCopy scopedIdentifier];
  [additionalAttributes setSourceAssetForDuplicationCPLScopedIdentifier:scopedIdentifier];

  if (subclassKind == 1)
  {
    [(PLManagedAsset *)self setMomentShare:shareCopy];
  }

  else if (subclassKind == 3)
  {
    [(PLManagedAsset *)self setCollectionShareWithCurrentUserAsContributor:shareCopy];
  }

  else if (subclassKind == 2)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Share.m" lineNumber:394 description:{@"%s called with invalid subclass kind", "-[PLManagedAsset(Share) setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:placeholderAssetUUID:bundleScope:share:importSessionID:bakeInAdjustmentsFromSourceAsset:flattenLivePhoto:copyTitleDescriptionAndKeywords:copyCameraProcessingAdjustmentResources:library:]"}];
  }

  if (resources)
  {
    -[PLManagedAsset setCameraProcessingAdjustmentState:](self, "setCameraProcessingAdjustmentState:", [assetCopy cameraProcessingAdjustmentState]);
    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
    additionalAttributes3 = [assetCopy additionalAttributes];
    spatialOverCaptureGroupIdentifier = [additionalAttributes3 spatialOverCaptureGroupIdentifier];
    [additionalAttributes2 setSpatialOverCaptureGroupIdentifier:spatialOverCaptureGroupIdentifier];
  }

  additionalAttributes4 = [(PLManagedAsset *)self additionalAttributes];
  additionalAttributes5 = [assetCopy additionalAttributes];
  [additionalAttributes4 setVideoCpDisplayTimescale:{objc_msgSend(additionalAttributes5, "videoCpDisplayTimescale")}];
  [additionalAttributes4 setVideoCpDisplayValue:{objc_msgSend(additionalAttributes5, "videoCpDisplayValue")}];
  [additionalAttributes4 setVideoCpDurationTimescale:{objc_msgSend(additionalAttributes5, "videoCpDurationTimescale")}];
  originalFilename = [additionalAttributes5 originalFilename];
  [additionalAttributes4 setOriginalFilename:originalFilename];

  originalFilesize = [additionalAttributes5 originalFilesize];
  [additionalAttributes4 setOriginalFilesize:originalFilesize];

  timeZoneOffset = [additionalAttributes5 timeZoneOffset];
  [additionalAttributes4 setTimeZoneOffset:timeZoneOffset];

  timeZoneName = [additionalAttributes5 timeZoneName];
  [additionalAttributes4 setTimeZoneName:timeZoneName];

  if (keywords)
  {
    title = [additionalAttributes5 title];
    [additionalAttributes4 setTitle:title];

    accessibilityDescription = [additionalAttributes5 accessibilityDescription];
    [additionalAttributes4 setAccessibilityDescription:accessibilityDescription];

    longDescription = [additionalAttributes5 longDescription];
    [additionalAttributes4 setLongDescription:longDescription];

    v42 = [PLKeywordManager keywordsForAsset:assetCopy];
    if ([v42 count])
    {
      v43 = [PLKeywordManager alloc];
      pathManager = [(PLManagedObject *)self pathManager];
      v45 = [(PLKeywordManager *)v43 initWithPathManager:pathManager];

      [(PLKeywordManager *)v45 setKeywords:v42 forAsset:self];
    }
  }

  momentShare = [assetCopy momentShare];

  if (momentShare)
  {
    [additionalAttributes4 setImportedBy:7];
    [additionalAttributes4 setShareType:1];
    momentShare2 = [assetCopy momentShare];
  }

  else
  {
    collectionShare = [assetCopy collectionShare];

    if (!collectionShare)
    {
      goto LABEL_18;
    }

    [additionalAttributes4 setImportedBy:15];
    [additionalAttributes4 setShareType:3];
    momentShare2 = [assetCopy collectionShare];
  }

  v49 = momentShare2;
  owner = [momentShare2 owner];
  userIdentifier = [owner userIdentifier];
  [additionalAttributes4 setShareOriginator:userIdentifier];

  additionalAttributes6 = [assetCopy additionalAttributes];
  syndicationIdentifier = [additionalAttributes6 syndicationIdentifier];
  [additionalAttributes4 setSyndicationIdentifier:syndicationIdentifier];

LABEL_18:
  photoCopy2 = photo;
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  isCloudPhotoLibraryEnabled = [photoLibrary isCloudPhotoLibraryEnabled];

  if (isCloudPhotoLibraryEnabled)
  {
    v57 = libraryCopy;
    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      v58 = [(PLManagedAsset *)self _setupPlaceholderAdjustmentPropertiesFromSourceAsset:assetCopy bakeInAdjustmentsFromSourceAsset:sourceAssetCopy library:libraryCopy];
      [(PLManagedAsset *)self setFilename:0];
      [(PLManagedAsset *)self setDirectory:0];
      originalUniformTypeIdentifier = [(PLManagedAsset *)self originalUniformTypeIdentifier];
      originalFilename2 = [(PLManagedAsset *)self originalFilename];
      [(PLManagedAsset *)self setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:originalUniformTypeIdentifier originalFilename:originalFilename2];

      v61 = iDCopy;
      if (!photo)
      {
        goto LABEL_33;
      }
    }

    else
    {
      if (subclassKind == 1)
      {
        pathManager2 = [libraryCopy pathManager];
        v63 = [pathManager2 privateDirectoryWithSubType:7];
        uuid = [v96 uuid];
        v65 = [v63 stringByAppendingPathComponent:uuid];

        libraryServicesManager = [libraryCopy libraryServicesManager];
        imageWriter = [libraryServicesManager imageWriter];
        fileExtension = [assetCopy fileExtension];
        v69 = v65;
        v70 = [imageWriter pathForNewAssetWithDirectoryPath:v65 fileName:v92 extension:fileExtension];

        v91 = v70;
        v71 = [MEMORY[0x1E695DFF8] fileURLWithPath:v70 isDirectory:0];
        pathManager3 = [(PLManagedObject *)self pathManager];
        path = [v71 path];
        stringByDeletingLastPathComponent = [path stringByDeletingLastPathComponent];
        v75 = [pathManager3 assetAbbreviatedMetadataDirectoryForDirectory:stringByDeletingLastPathComponent type:32 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];

        v76 = v69;
        v57 = libraryCopy;

        lastPathComponent = [v71 lastPathComponent];
        [(PLManagedAsset *)self setDirectory:v75];
        [(PLManagedAsset *)self setFilename:lastPathComponent];
      }

      else
      {
        v76 = [(PLManagedAsset *)self photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:dCopy];
        pathForOriginalFile = [assetCopy pathForOriginalFile];
        pathExtension = [pathForOriginalFile pathExtension];
        uppercaseString = [pathExtension uppercaseString];

        v91 = uppercaseString;
        v71 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@.%@", v92, uppercaseString];
        pathManager4 = [(PLManagedObject *)self pathManager];
        v82 = [pathManager4 assetAbbreviatedMetadataDirectoryForDirectory:v76 type:32 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
        [(PLManagedAsset *)self setDirectory:v82];

        [(PLManagedAsset *)self setFilename:v71];
      }

      v58 = [(PLManagedAsset *)self _setupPlaceholderAdjustmentPropertiesFromSourceAsset:assetCopy bakeInAdjustmentsFromSourceAsset:sourceAssetCopy library:v57];
      v61 = iDCopy;
      photoCopy2 = photo;
      if (!photo)
      {
        goto LABEL_33;
      }
    }
  }

  else
  {
    v58 = 1;
    v57 = libraryCopy;
    v61 = iDCopy;
    if (!photo)
    {
      goto LABEL_33;
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v83 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v83, OS_LOG_TYPE_DEFAULT))
    {
      uuid2 = [assetCopy uuid];
      uuid3 = [(PLManagedAsset *)self uuid];
      *buf = 138412546;
      v98 = uuid2;
      v99 = 2112;
      v100 = uuid3;
      _os_log_impl(&dword_19BF1F000, v83, OS_LOG_TYPE_DEFAULT, "Flattening live photo from sourceAsset: %@ to placeholderAsset: %@", buf, 0x16u);

      v61 = iDCopy;
    }
  }

  [(PLManagedAsset *)self setPlaybackStyle:1];
LABEL_33:
  if (sourceAssetCopy && [assetCopy isLoopingVideo])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v86 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v86, OS_LOG_TYPE_DEFAULT))
      {
        uuid4 = [(PLManagedAsset *)self uuid];
        uuid5 = [assetCopy uuid];
        *buf = 138412546;
        v98 = uuid4;
        v99 = 2112;
        v100 = uuid5;
        _os_log_impl(&dword_19BF1F000, v86, OS_LOG_TYPE_DEFAULT, "Resetting kind, kindSubtype and VideoCP state on baked-in placeholder asset %@ as source asset is looping video %@", buf, 0x16u);

        v61 = iDCopy;
      }
    }

    [(PLManagedAsset *)self setKind:1];
  }

  else if (!photoCopy2)
  {
    goto LABEL_42;
  }

  [(PLManagedAsset *)self setKindSubtype:0];
  [(PLManagedAsset *)self setVideoCpDurationValue:0];
  [(PLManagedAsset *)self setVideoCpVisibilityState:0];
  additionalAttributes7 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes7 setVideoCpDisplayTimescale:0];
  [additionalAttributes7 setVideoCpDisplayValue:0];
  [additionalAttributes7 setVideoCpDurationTimescale:0];

LABEL_42:
  if (v61)
  {
    [(PLManagedAsset *)self setImportSessionAlbumWithImportSessionID:v61];
  }

  return v58;
}

- (unint64_t)masterResourceTypeForAdjustedAssetResourceType:(unint64_t)type flattenLivePhoto:(BOOL)photo
{
  if (photo)
  {
    if (type - 2 >= 4)
    {
      return 0;
    }

    else
    {
      return qword_19C60FF78[type - 2];
    }
  }

  if (type > 0x1C)
  {
    goto LABEL_14;
  }

  if (((1 << type) & 0x102201F8) != 0)
  {
    return type;
  }

  if (type == 16)
  {
    return [(PLManagedAsset *)self isVideo];
  }

  if (type != 19)
  {
LABEL_14:
    if (type != 2)
    {
      return 0;
    }

    if ([(PLManagedAsset *)self isLoopingVideo])
    {
      return 2;
    }

    return [(PLManagedAsset *)self isPhoto];
  }

  if ([(PLManagedAsset *)self isLoopingVideo])
  {
    return 1;
  }

  else
  {
    return 18;
  }
}

- (id)sortPlaceholderCloudResourcesByOrderOfCloudReReference:(id)reference
{
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __80__PLManagedAsset_Share__sortPlaceholderCloudResourcesByOrderOfCloudReReference___block_invoke;
  v5[3] = &unk_1E75753D0;
  v6 = &unk_1F0FC0180;
  v3 = [reference sortedArrayUsingComparator:v5];

  return v3;
}

uint64_t __80__PLManagedAsset_Share__sortPlaceholderCloudResourcesByOrderOfCloudReReference___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a3;
  v6 = [a2 cplType];
  v7 = [v5 cplType];

  v8 = MEMORY[0x1E696AD98];
  v9 = *(a1 + 32);
  v10 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v6];
  v11 = [v8 numberWithUnsignedInteger:{objc_msgSend(v9, "indexOfObject:", v10)}];

  v12 = MEMORY[0x1E696AD98];
  v13 = *(a1 + 32);
  v14 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v7];
  v15 = [v12 numberWithUnsignedInteger:{objc_msgSend(v13, "indexOfObject:", v14)}];

  v16 = [v11 compare:v15];
  return v16;
}

- (id)filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources:(id)resources
{
  v3 = MEMORY[0x1E696AE18];
  resourcesCopy = resources;
  v5 = [v3 predicateWithBlock:&__block_literal_global_97_103348];
  v6 = [resourcesCopy filteredArrayUsingPredicate:v5];

  return v6;
}

BOOL __96__PLManagedAsset_Share__filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 cplType] != 23 && objc_msgSend(v2, "cplType") != 24;

  return v3;
}

- (id)fetchSourceAssetForDuplicationIfExists
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  sourceAssetForDuplicationCPLScopedIdentifier = [additionalAttributes sourceAssetForDuplicationCPLScopedIdentifier];

  if (sourceAssetForDuplicationCPLScopedIdentifier)
  {
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    v6 = [PLManagedAsset assetWithScopedIdentifier:sourceAssetForDuplicationCPLScopedIdentifier inLibrary:photoLibrary prefetchResources:0];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)setDestinationAssetCopyStateOnSourceAsset:(signed __int16)asset
{
  assetCopy = asset;
  fetchSourceAssetForDuplicationIfExists = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if (fetchSourceAssetForDuplicationIfExists)
  {
    v6 = fetchSourceAssetForDuplicationIfExists;
    additionalAttributes = [fetchSourceAssetForDuplicationIfExists additionalAttributes];
    [additionalAttributes setDestinationAssetCopyState:assetCopy];

    fetchSourceAssetForDuplicationIfExists = v6;
  }
}

- (void)fixupPlaceholderAssetWithSavedAssetType:(signed __int16)type
{
  [(PLManagedAsset *)self setSavedAssetType:type];
  fetchSourceAssetForDuplicationIfExists = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if (fetchSourceAssetForDuplicationIfExists)
  {
    additionalAttributes = [fetchSourceAssetForDuplicationIfExists additionalAttributes];
    [additionalAttributes setDestinationAssetCopyState:2];
  }

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes2 setSourceAssetForDuplicationCPLScopedIdentifier:0];

  v6 = objc_opt_class();
  master = [(PLManagedAsset *)self master];
  [v6 processMediaMetadataForAsset:self withCloudMaster:master];
}

- (id)shareRelationship
{
  momentShare = [(PLManagedAsset *)self momentShare];

  if (momentShare)
  {
    momentShare2 = [(PLManagedAsset *)self momentShare];
  }

  else
  {
    collectionShare = [(PLManagedAsset *)self collectionShare];

    if (collectionShare)
    {
      momentShare2 = [(PLManagedAsset *)self collectionShare];
    }

    else
    {
      momentShare2 = 0;
    }
  }

  return momentShare2;
}

- (BOOL)placeholder_shouldAllowServerCopy
{
  if (PLCloudPhotoLibraryMultiLibarySyncingEnabled_onceToken != -1)
  {
    dispatch_once(&PLCloudPhotoLibraryMultiLibarySyncingEnabled_onceToken, &__block_literal_global_60348);
  }

  return (PLCloudPhotoLibraryMultiLibarySyncingEnabled_multiLibrarySyncingEnabled & 1) == 0;
}

- (BOOL)placeholder_shouldFlattenLivePhoto
{
  fetchSourceAssetForDuplicationIfExists = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if ([fetchSourceAssetForDuplicationIfExists isPhotoIris])
  {
    v4 = ![(PLManagedAsset *)self isPhotoIris];
  }

  else
  {
    LOBYTE(v4) = 0;
  }

  return [(PLManagedAsset *)self playbackStyle]== 1 && v4;
}

- (BOOL)placeholder_shouldBakeInAdjustments
{
  fetchSourceAssetForDuplicationIfExists = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if ([fetchSourceAssetForDuplicationIfExists hasAdjustments])
  {
    v4 = ![(PLManagedAsset *)self hasAdjustments];
  }

  else
  {
    LOBYTE(v4) = 0;
  }

  return v4;
}

+ (id)_videoComplementURLForSharingFromAsset:(id)asset
{
  v23 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  v4 = PLPhotoSharingGetLog();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    uuid = [assetCopy uuid];
    *buf = 138412290;
    v20 = uuid;
    _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEFAULT, "Determining video complement path to use. UUID: %@", buf, 0xCu);
  }

  v18 = 0;
  v6 = [assetCopy isPlayableVideo:&v18];
  v7 = v18;
  if (v6)
  {
    hasAdjustedVideoComplement = [assetCopy hasAdjustedVideoComplement];
    v9 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      if (hasAdjustedVideoComplement)
      {
        v10 = @"adjusted";
      }

      else
      {
        v10 = @"original";
      }

      uuid2 = [assetCopy uuid];
      *buf = 138412546;
      v20 = v10;
      v21 = 2112;
      v22 = uuid2;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Using the %@ original video component. UUID: %@", buf, 0x16u);
    }

    if (hasAdjustedVideoComplement)
    {
      [assetCopy pathForFullsizeRenderVideoFile];
    }

    else
    {
      [assetCopy pathForVideoComplementFile];
    }
    pathForMediumVideoFile = ;
  }

  else
  {
    v13 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      uuid3 = [assetCopy uuid];
      *buf = 138412546;
      v20 = v7;
      v21 = 2112;
      v22 = uuid3;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "Falling back to medium, since the original video component is unsupported. Codec: %@, UUID: %@", buf, 0x16u);
    }

    pathForMediumVideoFile = [assetCopy pathForMediumVideoFile];
  }

  v15 = pathForMediumVideoFile;
  v16 = [MEMORY[0x1E695DFF8] fileURLWithPath:pathForMediumVideoFile isDirectory:0];

  return v16;
}

+ (void)_createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs:(id)ds withBatchCommentText:(id)text adjustmentBakeInOptionsDictionary:(id)dictionary collectionShare:(id)share library:(id)library completionHandler:(id)handler
{
  dsCopy = ds;
  textCopy = text;
  dictionaryCopy = dictionary;
  shareCopy = share;
  libraryCopy = library;
  handlerCopy = handler;
  v19 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(dsCopy, "count")}];
  pathManager = [libraryCopy pathManager];
  capabilities = [pathManager capabilities];

  v47 = 0;
  v48 = &v47;
  v49 = 0x3032000000;
  v50 = __Block_byref_object_copy__103360;
  v51 = __Block_byref_object_dispose__103361;
  v52 = 0;
  v41 = 0;
  v42 = &v41;
  v43 = 0x3032000000;
  v44 = __Block_byref_object_copy__103360;
  v45 = __Block_byref_object_dispose__103361;
  v46 = 0;
  v30[0] = MEMORY[0x1E69E9820];
  v30[1] = 3221225472;
  v30[2] = __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke;
  v30[3] = &unk_1E75754A0;
  v22 = libraryCopy;
  v31 = v22;
  v38 = &v41;
  v23 = shareCopy;
  v32 = v23;
  v24 = dsCopy;
  v33 = v24;
  v25 = textCopy;
  v34 = v25;
  v26 = dictionaryCopy;
  v35 = v26;
  selfCopy = self;
  v27 = capabilities;
  v36 = v27;
  v28 = v19;
  v37 = v28;
  v39 = &v47;
  [v22 performTransactionAndWait:v30];
  handlerCopy[2](handlerCopy, v28, v48[5], v42[5]);

  _Block_object_dispose(&v41, 8);
  _Block_object_dispose(&v47, 8);
}

void __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke(uint64_t a1)
{
  v168[1] = *MEMORY[0x1E69E9840];
  v111 = +[PLPhotoSharingHelper sharingPersonID];
  if ([*(a1 + 32) isUnitTesting])
  {

    v111 = @"UnitTestID";
  }

  else if (!v111)
  {
    v101 = MEMORY[0x1E696ABC0];
    v167 = *MEMORY[0x1E696A278];
    v168[0] = @"sharingPersonID is nil";
    v111 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v168 forKeys:&v167 count:1];
    v102 = [v101 errorWithDomain:@"com.apple.photolibraryservices" code:5 userInfo:v111];
    v103 = *(*(a1 + 88) + 8);
    obj = *(v103 + 40);
    *(v103 + 40) = v102;
    goto LABEL_89;
  }

  if (*(a1 + 40))
  {
    v1 = [PLManagedAsset assetsWithUUIDs:*(a1 + 48) options:1 inLibrary:*(a1 + 32)];
    v2 = [v1 count];
    if (v2 != [*(a1 + 48) count])
    {
      v3 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_ERROR))
      {
        v4 = [v1 count];
        v5 = [*(a1 + 48) count];
        *buf = 134218240;
        *&buf[4] = v4;
        *&buf[12] = 2048;
        *&buf[14] = v5;
        _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_ERROR, "ERROR: Only found %lu originalAssets, expected %lu", buf, 0x16u);
      }
    }

    v124 = [MEMORY[0x1E695DF90] dictionaryWithCapacity:{objc_msgSend(v1, "count")}];
    v151 = 0u;
    v152 = 0u;
    v149 = 0u;
    v150 = 0u;
    obj = v1;
    v6 = [obj countByEnumeratingWithState:&v149 objects:v164 count:16];
    if (v6)
    {
      v7 = *v150;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v150 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v9 = *(*(&v149 + 1) + 8 * i);
          v10 = [v9 uuid];
          [v124 setObject:v9 forKey:v10];
        }

        v6 = [obj countByEnumeratingWithState:&v149 objects:v164 count:16];
      }

      while (v6);
    }

    v107 = [MEMORY[0x1E69BF320] UUIDString];
    v108 = [MEMORY[0x1E695DF00] date];
    v106 = [*(a1 + 56) length];
    v11 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(*(a1 + 64), "count")}];
    v12 = *(a1 + 64);
    v147[0] = MEMORY[0x1E69E9820];
    v147[1] = 3221225472;
    v147[2] = __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_199;
    v147[3] = &unk_1E7575450;
    v110 = v11;
    v148 = v110;
    [v12 enumerateKeysAndObjectsUsingBlock:v147];
    v13 = *(a1 + 48);
    v143 = 0u;
    v144 = 0u;
    v145 = 0u;
    v146 = 0u;
    v116 = v13;
    v120 = [v116 countByEnumeratingWithState:&v143 objects:v163 count:16];
    if (v120)
    {
      v119 = *v144;
      v115 = *MEMORY[0x1E696A278];
      v109 = *MEMORY[0x1E696AA08];
      v105 = *MEMORY[0x1E6987348];
      v104 = *MEMORY[0x1E69874B8];
      do
      {
        for (j = 0; j != v120; ++j)
        {
          if (*v144 != v119)
          {
            objc_enumerationMutation(v116);
          }

          v15 = *(*(&v143 + 1) + 8 * j);
          v16 = [v124 objectForKey:v15];
          if (v16)
          {
            context = objc_autoreleasePoolPush();
            v17 = [v16 isVideo];
            v118 = [v16 playbackVariation];
            v18 = [v16 isLoopingVideo];
            if (v18)
            {
              v19 = PLPhotoSharingGetLog();
              if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
              {
                *buf = 134217984;
                *&buf[4] = v118;
                _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_DEFAULT, "Sharing looping video with playback variation %ld", buf, 0xCu);
              }

              if (v17)
              {
                v125 = [v16 pathForVideoFile];
                v20 = PLPhotoSharingGetLog();
                if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
                {
                  *buf = 138412290;
                  *&buf[4] = v125;
                  v21 = v20;
                  v22 = "Original is a looping video, use the original file %@";
                  goto LABEL_41;
                }

LABEL_42:

                if (!v125)
                {
                  v128 = [MEMORY[0x1E696AEC0] stringWithFormat:@"No local file path on disk to support sharing asset %@", v15];
                  v26 = MEMORY[0x1E696ABC0];
                  v161 = v115;
                  v162 = v128;
                  v27 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v162 forKeys:&v161 count:1];
                  v28 = [v26 errorWithDomain:@"com.apple.photolibraryservices" code:7 userInfo:v27];
                  v127 = 0;
                  v29 = *(*(a1 + 88) + 8);
                  v30 = *(v29 + 40);
                  *(v29 + 40) = v28;
LABEL_83:

                  objc_autoreleasePoolPop(context);
                  goto LABEL_84;
                }

                v127 = [MEMORY[0x1E695DFF8] fileURLWithPath:v125 isDirectory:0];
                if ([v16 canPlayPhotoIris] && (objc_msgSend(v16, "uuid"), v24 = objc_claimAutoreleasedReturnValue(), v25 = objc_msgSend(v110, "containsObject:", v24), v24, ((v18 | v25) & 1) == 0))
                {
                  v128 = [*(a1 + 104) _videoComplementURLForSharingFromAsset:v16];
                }

                else
                {
                  v128 = 0;
                }

                v31 = [MEMORY[0x1E696AFB0] UUID];
                v27 = [v31 UUIDString];

                v121 = [v127 pathExtension];
                v32 = [*(a1 + 40) scopeIdentifier];
                v33 = [*(a1 + 32) pathManager];
                v126 = [PLCloudSharedAssetSaveJob nextDCIMSaveFileURLForCloudPersonID:v111 cloudAlbumGUID:v32 pathManager:v33 fileExtension:v121 assetUUID:v27];

                if (v128)
                {
                  v34 = [v126 URLByDeletingLastPathComponent];
                  v35 = [v126 lastPathComponent];
                  v36 = [v35 stringByDeletingPathExtension];

                  v37 = [v128 pathExtension];
                  v38 = [v37 uppercaseString];
                  v39 = [v36 stringByAppendingPathExtension:v38];

                  v40 = [v34 URLByAppendingPathComponent:v39];

                  if (!v17)
                  {
                    goto LABEL_58;
                  }
                }

                else
                {
                  v40 = 0;
                  if (!v17)
                  {
                    goto LABEL_58;
                  }
                }

                if ([v16 isDefaultAdjustedSlomo] && objc_msgSend(v16, "isPlayableVideo:", 0))
                {
                  v41 = PLPhotoSharingGetLog();
                  if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
                  {
                    *buf = 138412290;
                    *&buf[4] = v126;
                    _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_DEFAULT, "Original is a slow-mo, flatten the video to %@", buf, 0xCu);
                  }

                  v113 = v40;
                  v42 = v105;
                  v43 = dispatch_semaphore_create(0);
                  *buf = 0;
                  *&buf[8] = buf;
                  *&buf[16] = 0x2020000000;
                  LOBYTE(v160) = 0;
                  v44 = [PLSlalomUtilities videoAVObjectBuilderForManagedAsset:v16 applyVideoAdjustments:1];
                  v136[0] = MEMORY[0x1E69E9820];
                  v136[1] = 3221225472;
                  v136[2] = __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_209;
                  v136[3] = &unk_1E7575478;
                  v137 = v127;
                  v45 = v126;
                  v46 = *(a1 + 88);
                  v138 = v45;
                  v140 = v46;
                  v141 = buf;
                  v47 = v43;
                  v139 = v47;
                  v134 = *MEMORY[0x1E6960CC0];
                  v135 = *(MEMORY[0x1E6960CC0] + 16);
                  v132 = v134;
                  v133 = v135;
                  [PLVideoTranscoder transcodeVideoWithObjectBuilder:v44 outputURL:v45 startTime:&v134 endTime:&v132 presetName:v42 outputFileType:v104 metadata:0 completionHandler:v136];
                  dispatch_semaphore_wait(v47, 0xFFFFFFFFFFFFFFFFLL);
                  LOBYTE(v43) = *(*&buf[8] + 24);

                  v40 = v113;
                  _Block_object_dispose(buf, 8);

                  if (v43)
                  {
LABEL_82:

                    v30 = v121;
                    goto LABEL_83;
                  }
                }

                else
                {
LABEL_58:
                  v131 = 0;
                  v48 = [MEMORY[0x1E69BF238] copyItemAtURL:v127 toURL:v126 error:&v131];
                  v49 = v131;
                  v50 = v49;
                  if ((v48 & 1) == 0)
                  {
                    v63 = MEMORY[0x1E696AEC0];
                    v64 = [v127 path];
                    v65 = [v126 path];
                    v66 = [v63 stringWithFormat:@"Unable to copy %@ to %@: %@", v64, v65, v50];

                    v67 = MEMORY[0x1E696ABC0];
                    v157[0] = v115;
                    v157[1] = v109;
                    v158[0] = v66;
                    v158[1] = v50;
                    v68 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v158 forKeys:v157 count:2];
                    v69 = [v67 errorWithDomain:@"com.apple.photolibraryservices" code:9 userInfo:v68];
                    v70 = *(*(a1 + 88) + 8);
                    v71 = *(v70 + 40);
                    *(v70 + 40) = v69;

                    goto LABEL_82;
                  }
                }

                *&v132 = 0;
                v51 = *(a1 + 32);
                v52 = [MEMORY[0x1E69BF328] savedAssetTypeForCloudSharedAsset];
                v130 = 0;
                v53 = [PLManagedAsset insertAssetIntoPhotoLibrary:v51 mainFileURL:v126 savedAssetType:v52 bundleScope:2 uuid:v27 replacementUUID:0 imageSource:&v132 imageData:&v130];
                v114 = v130;
                v54 = [PLPhotoSharingHelper photoSharingOriginalFilenameForAsset:v16];
                [v53 setOriginalFilename:v54];

                if (v53)
                {
                  if ([v53 isVideo])
                  {
                    v129 = 0;
                    v55 = [v53 isPlayableVideo:&v129];
                    v56 = v129;
                    v112 = v56;
                    if ((v55 & 1) == 0)
                    {
                      v57 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Can't play new asset for file at %@, with codec: %@", v126, v56];
                      v58 = MEMORY[0x1E696ABC0];
                      v153 = v115;
                      v154 = v57;
                      v59 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v154 forKeys:&v153 count:1];
                      v60 = [v58 errorWithDomain:@"com.apple.photolibraryservices" code:10 userInfo:v59];
                      v61 = *(*(a1 + 88) + 8);
                      v62 = *(v61 + 40);
                      *(v61 + 40) = v60;

LABEL_81:
                      goto LABEL_82;
                    }
                  }

                  else
                  {
                    v112 = 0;
                  }

                  [v53 setVisibilityState:2];
                  v76 = PLPhotoSharingGetLog();
                  if (os_log_type_enabled(v76, OS_LOG_TYPE_DEFAULT))
                  {
                    *buf = 138412290;
                    *&buf[4] = v15;
                    _os_log_impl(&dword_19BF1F000, v76, OS_LOG_TYPE_DEFAULT, "Generating new thumbnails for asset with UUID %@", buf, 0xCu);
                  }

                  [v53 generateAndUpdateThumbnailsWithPreviewImage:0 thumbnailImage:0 fromImageSource:v132 imageData:v114 forceSRGBConversion:1];
                  v57 = [MEMORY[0x1E69BF320] UUIDString];
                  v77 = [v16 additionalAttributes];
                  v78 = [v77 originalFilename];
                  v79 = [v53 additionalAttributes];
                  [v79 setOriginalFilename:v78];

                  [v53 setCloudAssetGUID:v57];
                  [v53 setCloudBatchID:v107];
                  [v53 setCloudBatchPublishDate:v108];
                  [v53 setCloudIsMyAsset:1];
                  [v53 setCloudIsDeletable:1];
                  v80 = [v16 dateCreated];
                  [v53 setDateCreated:v80];

                  [v53 setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v118];
                  if (v17)
                  {
                    v81 = [v16 uuid];
                    [v53 setOriginalAssetsUUID:v81];

                    v82 = PLPhotoSharingGetLog();
                    if (os_log_type_enabled(v82, OS_LOG_TYPE_DEFAULT))
                    {
                      v83 = [v53 originalAssetsUUID];
                      *buf = 138412290;
                      *&buf[4] = v83;
                      _os_log_impl(&dword_19BF1F000, v82, OS_LOG_TYPE_DEFAULT, "Saved original video uuid %@ for later playback", buf, 0xCu);
                    }
                  }

                  if (v128)
                  {
                    v84 = [v16 mediaGroupUUID];
                    [v16 photoIrisVideoDuration];
                    [v16 photoIrisStillDisplayTime];
                    [v53 becomePhotoIrisWithMediaGroupUUID:v84 mainFileMetadata:0 videoURL:v128 videoDuration:buf stillDisplayTime:&v134 options:0];
                  }

                  [v53 setCollectionShareWithCurrentUserAsContributor:*(a1 + 40)];
                  v85 = PLPhotoSharingGetLog();
                  if (os_log_type_enabled(v85, OS_LOG_TYPE_DEFAULT))
                  {
                    v86 = [v126 path];
                    *buf = 138412802;
                    *&buf[4] = v127;
                    *&buf[12] = 2112;
                    *&buf[14] = v86;
                    *&buf[22] = 2112;
                    v160 = v57;
                    _os_log_impl(&dword_19BF1F000, v85, OS_LOG_TYPE_DEFAULT, "Created copy of original asset at %@ to %@ and assigned it new cloudAssetGUID %@", buf, 0x20u);
                  }

                  [*(a1 + 80) addObject:v53];
                  if (v106 && !*(*(*(a1 + 96) + 8) + 40))
                  {
                    v87 = [PLCloudSharedComment insertNewCommentIntoAsset:v53 commentDate:0 withText:*(a1 + 56) isLike:0 isMyComment:1 inLibrary:*(a1 + 32)];
                    v88 = *(*(a1 + 96) + 8);
                    v89 = *(v88 + 40);
                    *(v88 + 40) = v87;

                    v90 = *(*(*(a1 + 96) + 8) + 40);
                    v91 = [MEMORY[0x1E696AD98] numberWithBool:1];
                    [v90 setIsCaption:v91];

                    v92 = *(*(*(a1 + 96) + 8) + 40);
                    v93 = [MEMORY[0x1E696AD98] numberWithBool:1];
                    [v92 setIsBatchComment:v93];
                  }

                  [PLResourceInstaller installInternalResourcesForExistingAsset:v53 assumeNoExistingResources:1 referencedResourceURLs:0 error:0];
                  goto LABEL_81;
                }

                v112 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Couldn't insert new asset for file at %@", v126];
                v72 = MEMORY[0x1E696ABC0];
                v155 = v115;
                v156 = v112;
                v57 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v156 forKeys:&v155 count:1];
                v73 = [v72 errorWithDomain:@"com.apple.photolibraryservices" code:10 userInfo:v57];
                v74 = *(*(a1 + 88) + 8);
                v75 = *(v74 + 40);
                *(v74 + 40) = v73;

                goto LABEL_81;
              }

              v125 = [v16 pathForFullsizeRenderVideoFile];
              v20 = PLPhotoSharingGetLog();
              if (!os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                goto LABEL_42;
              }

              *buf = 138412290;
              *&buf[4] = v125;
              v21 = v20;
              v22 = "Original is a regular photo, use the full size render video file %@";
            }

            else if (v17)
            {
              if ([v16 isPlayableVideo:0])
              {
                if ([v16 isCloudSharedAsset])
                {
                  [v16 cloudSharedAssetPathForPlaceholderKind:9];
                }

                else
                {
                  [v16 pathForVideoFile];
                }
                v125 = ;
              }

              else
              {
                v125 = [v16 pathForMediumVideoFile];
              }

              v20 = PLPhotoSharingGetLog();
              if (!os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                goto LABEL_42;
              }

              *buf = 138412290;
              *&buf[4] = v125;
              v21 = v20;
              v22 = "Original is a video, use the video file %@";
            }

            else
            {
              v142 = 0;
              v23 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:v16 format:0 allowMetadataSnapshot:0 forceLarge:1 outFilePath:&v142 outImageType:0];
              v125 = v142;
              v20 = PLPhotoSharingGetLog();
              if (!os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                goto LABEL_42;
              }

              *buf = 138412290;
              *&buf[4] = v125;
              v21 = v20;
              v22 = "Original is not a video, use the large displayable image file %@";
            }

LABEL_41:
            _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEFAULT, v22, buf, 0xCu);
            goto LABEL_42;
          }

LABEL_84:
        }

        v120 = [v116 countByEnumeratingWithState:&v143 objects:v163 count:16];
      }

      while (v120);
    }

    [*(a1 + 40) setLastModifiedDate:v108];
    [*(a1 + 40) recomputeCachedValues];
  }

  else
  {
    v94 = MEMORY[0x1E696AEC0];
    v95 = [0 scopeIdentifier];
    obj = [v94 stringWithFormat:@"Couldn't find SharedStream Collection Share with scopeIdentifier %@ to publish assets from", v95];

    v96 = MEMORY[0x1E696ABC0];
    v165 = *MEMORY[0x1E696A278];
    v166 = obj;
    v97 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v166 forKeys:&v165 count:1];
    v98 = [v96 errorWithDomain:@"com.apple.photolibraryservices" code:6 userInfo:v97];
    v99 = *(*(a1 + 88) + 8);
    v100 = *(v99 + 40);
    *(v99 + 40) = v98;
  }

LABEL_89:
}

void __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_199(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  if ([a3 flattenLivePhotoToStillIfNeeded])
  {
    [*(a1 + 32) addObject:v5];
  }
}

void __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_209(uint64_t a1, uint64_t a2, void *a3)
{
  v22[2] = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (v4)
  {
    v5 = MEMORY[0x1E696AEC0];
    v6 = [*(a1 + 32) path];
    v7 = [*(a1 + 40) path];
    v8 = [v5 stringWithFormat:@"Could not generate trimmed video for %@ to %@ error %@", v6, v7, v4];

    v9 = MEMORY[0x1E696ABC0];
    v10 = *MEMORY[0x1E696AA08];
    v21[0] = *MEMORY[0x1E696A278];
    v21[1] = v10;
    v22[0] = v8;
    v22[1] = v4;
    v11 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v22 forKeys:v21 count:2];
    v12 = [v9 errorWithDomain:@"com.apple.photolibraryservices" code:8 userInfo:v11];
    v13 = *(*(a1 + 56) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    *(*(*(a1 + 64) + 8) + 24) = 1;
  }

  else
  {
    v8 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v15 = [*(a1 + 32) path];
      v16 = [*(a1 + 40) path];
      *buf = 138412546;
      v18 = v15;
      v19 = 2112;
      v20 = v16;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "generated trimmed video of %@ to %@ ", buf, 0x16u);
    }
  }

  dispatch_semaphore_signal(*(a1 + 48));
}

+ (BOOL)attemptToRecreateMasterAndAssetResourcesForPlaceholderAssetRepush:(id)repush sourceAsset:(id)asset library:(id)library
{
  repushCopy = repush;
  assetCopy = asset;
  libraryCopy = library;
  placeholder_shouldBakeInAdjustments = [repushCopy placeholder_shouldBakeInAdjustments];
  placeholder_shouldFlattenLivePhoto = [repushCopy placeholder_shouldFlattenLivePhoto];
  if ([PLManagedAsset createMasterForPlaceholderAsset:repushCopy withSourceAsset:assetCopy shouldBakeInAdjustments:placeholder_shouldBakeInAdjustments shouldFlattenLivePhoto:placeholder_shouldFlattenLivePhoto placeholderResourceURLToSourceResourceURLMap:0 photoLibrary:libraryCopy])
  {
    v12 = [PLManagedAsset createAssetResourcesForPlaceholderAsset:repushCopy withSourceAsset:assetCopy shouldBakeInAdjustments:placeholder_shouldBakeInAdjustments shouldFlattenLivePhoto:placeholder_shouldFlattenLivePhoto placeholderResourceURLToSourceResourceURLMap:0 photoLibrary:libraryCopy];
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

+ (BOOL)cloneResourceFileFromURL:(id)l toURL:(id)rL forDestinationResource:(id)resource forDestinationAsset:(id)asset fileManager:(id)manager error:(id *)error
{
  v49[1] = *MEMORY[0x1E69E9840];
  lCopy = l;
  rLCopy = rL;
  resourceCopy = resource;
  assetCopy = asset;
  managerCopy = manager;
  path = [rLCopy path];
  stringByDeletingLastPathComponent = [path stringByDeletingLastPathComponent];
  v41 = 0;
  v20 = [managerCopy createDirectoryAtPath:stringByDeletingLastPathComponent withIntermediateDirectories:1 attributes:0 error:&v41];
  v21 = v41;

  if (!v20)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v26 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier = [assetCopy scopedIdentifier];
        *buf = 138412802;
        v43 = rLCopy;
        v44 = 2112;
        v45 = lCopy;
        v46 = 2112;
        v47 = scopedIdentifier;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Failed to create directory for resource at %@ from %@. Asset: %@", buf, 0x20u);
      }
    }

    if (error)
    {
      goto LABEL_22;
    }

    goto LABEL_10;
  }

  v40 = v21;
  v22 = [managerCopy copyItemAtURL:lCopy toURL:rLCopy error:&v40];
  v23 = v40;

  if (!v22)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v28 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier2 = [assetCopy scopedIdentifier];
        *buf = 138412802;
        v43 = rLCopy;
        v44 = 2112;
        v45 = lCopy;
        v46 = 2112;
        v47 = scopedIdentifier2;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Failed to clone resource at %@ from %@. Asset: %@", buf, 0x20u);
      }
    }

    if (!error)
    {
      v25 = 0;
      goto LABEL_24;
    }

    v21 = v23;
    goto LABEL_22;
  }

  path2 = [rLCopy path];
  [resourceCopy markAsLocallyAvailableWithFilePath:path2];

  if (([resourceCopy copyPurgeabilityFromFileURL:lCopy] & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v30 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier3 = [assetCopy scopedIdentifier];
        *buf = 138412546;
        v43 = rLCopy;
        v44 = 2112;
        v45 = scopedIdentifier3;
        _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_ERROR, "Failed to update purgeability of resource at %@. Asset: %@", buf, 0x16u);
      }
    }

    v38 = MEMORY[0x1E696ABC0];
    v32 = *MEMORY[0x1E69BFF48];
    v48 = *MEMORY[0x1E696A578];
    v33 = MEMORY[0x1E696AEC0];
    scopedIdentifier4 = [assetCopy scopedIdentifier];
    v34 = [v33 stringWithFormat:@"Failed to update purgeability of resource at %@. Asset: %@", rLCopy, scopedIdentifier4];
    v49[0] = v34;
    v35 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v49 forKeys:&v48 count:1];
    v21 = [v38 errorWithDomain:v32 code:47011 userInfo:v35];

    if (error)
    {
LABEL_22:
      v36 = v21;
      v25 = 0;
      *error = v21;
      goto LABEL_23;
    }

LABEL_10:
    v25 = 0;
LABEL_23:
    v23 = v21;
    goto LABEL_24;
  }

  v25 = 1;
LABEL_24:

  return v25;
}

+ (void)_cloneResourcesForSharePlaceholderAsset:(id)asset withPlaceholderResourceURLToSourceResourceURLMap:(id)map fileManager:(id)manager photoLibrary:(id)library
{
  v31 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  mapCopy = map;
  managerCopy = manager;
  allMasterCPLResources = [assetCopy allMasterCPLResources];
  v12 = assetCopy;
  allAssetCPLResources = [assetCopy allAssetCPLResources];
  v14 = [allMasterCPLResources setByAddingObjectsFromSet:allAssetCPLResources];

  v28 = 0u;
  v29 = 0u;
  v26 = 0u;
  v27 = 0u;
  v15 = v14;
  v16 = [v15 countByEnumeratingWithState:&v26 objects:v30 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v27;
    do
    {
      for (i = 0; i != v17; ++i)
      {
        if (*v27 != v18)
        {
          objc_enumerationMutation(v15);
        }

        v20 = *(*(&v26 + 1) + 8 * i);
        cplFileURL = [v20 cplFileURL];
        v22 = [mapCopy objectForKeyedSubscript:cplFileURL];
        v23 = v22;
        if (cplFileURL)
        {
          v24 = v22 == 0;
        }

        else
        {
          v24 = 1;
        }

        if (!v24)
        {
          [self cloneResourceFileFromURL:v22 toURL:cplFileURL forDestinationResource:v20 forDestinationAsset:v12 fileManager:managerCopy error:0];
        }
      }

      v17 = [v15 countByEnumeratingWithState:&v26 objects:v30 count:16];
    }

    while (v17);
  }

  [v12 generateAndUpdateThumbnailsWithPreviewImage:0 thumbnailImage:0 fromImageSource:0 imageData:0 forceSRGBConversion:0];
}

+ (BOOL)createAssetResourcesForPlaceholderAsset:(id)asset withSourceAsset:(id)sourceAsset shouldBakeInAdjustments:(BOOL)adjustments shouldFlattenLivePhoto:(BOOL)photo placeholderResourceURLToSourceResourceURLMap:(id)map photoLibrary:(id)library
{
  v46 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  mapCopy = map;
  if (adjustments)
  {
    goto LABEL_30;
  }

  allAssetCPLResources = [sourceAsset allAssetCPLResources];
  if (![allAssetCPLResources count])
  {
    goto LABEL_29;
  }

  v13 = [MEMORY[0x1E695DFA8] set];
  v33 = allAssetCPLResources;
  allObjects = [allAssetCPLResources allObjects];
  v15 = [assetCopy sortPlaceholderCloudResourcesByOrderOfCloudReReference:allObjects];

  v39 = 0u;
  v40 = 0u;
  v37 = 0u;
  v38 = 0u;
  obj = v15;
  v16 = [obj countByEnumeratingWithState:&v37 objects:v45 count:16];
  if (!v16)
  {
    goto LABEL_28;
  }

  v17 = v16;
  v18 = *v38;
  do
  {
    for (i = 0; i != v17; ++i)
    {
      if (*v38 != v18)
      {
        objc_enumerationMutation(obj);
      }

      v20 = *(*(&v37 + 1) + 8 * i);
      fingerprint = [v20 fingerprint];
      v22 = [v13 containsObject:fingerprint];

      if (v22)
      {
        if (*MEMORY[0x1E6994D48])
        {
          continue;
        }

        v23 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412546;
          v42 = v20;
          v43 = 2112;
          selfCopy = self;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_DEFAULT, "Skipping asset resource from re-referencing since it has the same fingerprint as another resource on this asset. Skipped resource: %@, asset: %@", buf, 0x16u);
        }
      }

      else
      {
        v24 = [assetCopy pathForCPLResourceType:objc_msgSend(v20 adjusted:{"cplType"), objc_msgSend(assetCopy, "hasAdjustments")}];
        v23 = v24;
        if (v24 && [v24 length])
        {
          v25 = [v20 validatedExternalResourceRepresentationUsingFileURL:0];
          [v25 setSidecarIndex:0];
          v26 = [assetCopy storedResourceForExternalResource:v25 asset:assetCopy];
          [v26 resetPrefetchState];
          fingerprint2 = [v26 fingerprint];
          [v13 addObject:fingerprint2];

          fileURL = [v20 fileURL];
          cplFileURL = [v26 cplFileURL];
          v30 = cplFileURL;
          if (mapCopy && fileURL && cplFileURL)
          {
            [mapCopy setObject:fileURL forKeyedSubscript:cplFileURL];
          }
        }

        else
        {
          v25 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Skipping asset resource from re-referencing since it has an invalid filePath. Skipped resource: %@, asset: %@", v20, self];
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v31 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              v42 = v25;
              _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "%@", buf, 0xCu);
            }
          }

          PLSimulateCrash();
        }
      }
    }

    v17 = [obj countByEnumeratingWithState:&v37 objects:v45 count:16];
  }

  while (v17);
LABEL_28:

  allAssetCPLResources = v33;
LABEL_29:

LABEL_30:
  return 1;
}

+ (BOOL)createMasterForPlaceholderAsset:(id)asset withSourceAsset:(id)sourceAsset shouldBakeInAdjustments:(BOOL)adjustments shouldFlattenLivePhoto:(BOOL)photo placeholderResourceURLToSourceResourceURLMap:(id)map photoLibrary:(id)library
{
  photoCopy = photo;
  adjustmentsCopy = adjustments;
  v160 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  sourceAssetCopy = sourceAsset;
  mapCopy = map;
  libraryCopy = library;
  master = [sourceAssetCopy master];

  if (master)
  {
    if ([sourceAssetCopy hasAdjustments])
    {
      [sourceAssetCopy nonDynamicOriginalUTI];
    }

    else
    {
      [sourceAssetCopy uniformTypeIdentifier];
    }
    v139 = ;
    v142 = assetCopy;
    if (!adjustmentsCopy)
    {
      v151 = 0;
      v152 = 0;
      v27 = [sourceAssetCopy masterIdentifierCacheIfNecessaryAndOriginalStableHash:&v152 error:&v151];
      v138 = v152;
      v28 = v151;
      v140 = v27;
      if (!v27)
      {
        v19 = v139;
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v35 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
          {
            scopedIdentifier = [assetCopy scopedIdentifier];
            *buf = 138412546;
            v155 = scopedIdentifier;
            v156 = 2112;
            v157 = v28;
            _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_ERROR, "Failed to retrieve source asset fingerprint for placeholder asset %@, error: %@", buf, 0x16u);

            v19 = v139;
          }
        }

        v22 = 0;
        v33 = v138;
        goto LABEL_109;
      }

      v29 = adjustmentsCopy;
      v30 = libraryCopy;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v31 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
        {
          scopedIdentifier2 = [assetCopy scopedIdentifier];
          *buf = 138412546;
          v155 = scopedIdentifier2;
          v156 = 2112;
          v157 = v140;
          _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_DEFAULT, "Not baking in adjustments during master creation for asset: %@, using fingerprint: %@", buf, 0x16u);
        }
      }

      v137 = mapCopy;

      if (v138)
      {
        libraryCopy = v30;
        adjustmentsCopy = v29;
        goto LABEL_42;
      }

      currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
      [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Share.m" lineNumber:894 description:{@"Failed to produce a stableHash for %@ from %@", assetCopy, sourceAssetCopy}];
      v138 = 0;
      libraryCopy = v30;
      adjustmentsCopy = v29;
LABEL_41:

LABEL_42:
      shareRelationship = [assetCopy shareRelationship];
      managedObjectContext = [libraryCopy managedObjectContext];
      v57 = [PLCloudMaster cloudMasterWithGUID:v140 inShare:shareRelationship prefetchResources:0 inManagedObjectContext:managedObjectContext];

      if (v57)
      {
        [assetCopy setupPropertiesOnExistingMaster:v57];
        mapCopy = v137;
        v58 = v138;
        v19 = v139;
        v59 = v57;
LABEL_108:

        v22 = 1;
        v33 = v140;
LABEL_109:

        goto LABEL_110;
      }

      shareRelationship2 = [assetCopy shareRelationship];
      v61 = [PLCloudMaster insertIntoPhotoLibrary:libraryCopy withCloudMasterGUID:v140 inShare:shareRelationship2];

      [assetCopy setupPropertiesOnNewCloudMaster:v61 withPlaceholderSourceAsset:sourceAssetCopy uniformTypeIdentifier:v139];
      [v61 setPlaceholderState:1];
      v133 = v61;
      [assetCopy setMaster:v61];
      if (adjustmentsCopy)
      {
        [sourceAssetCopy allAssetCPLResources];
      }

      else
      {
        [sourceAssetCopy allMasterCPLResources];
      }
      v62 = ;
      allObjects = [v62 allObjects];

      LODWORD(v62) = [sourceAssetCopy cameraProcessingAdjustmentState];
      v64 = v137;
      v134 = sourceAssetCopy;
      v136 = libraryCopy;
      if (v62 != [assetCopy cameraProcessingAdjustmentState])
      {
        v65 = [assetCopy filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources:allObjects];

        allObjects = v65;
      }

      v132 = allObjects;
      [assetCopy sortPlaceholderCloudResourcesByOrderOfCloudReReference:allObjects];
      v145 = 0u;
      v146 = 0u;
      v147 = 0u;
      obj = v148 = 0u;
      v66 = [obj countByEnumeratingWithState:&v145 objects:v153 count:16];
      if (!v66)
      {
LABEL_94:
        v92 = v64;
        [assetCopy reevaluateCameraProcessingAdjustmentState];
        if (adjustmentsCopy)
        {
          kind = [assetCopy kind];
          sourceAssetCopy = v134;
          v59 = v133;
          if (kind == [v134 kind])
          {
            additionalAttributes = [v134 additionalAttributes];
            mediaMetadataType = [additionalAttributes mediaMetadataType];
            [v133 setMediaMetadataType:mediaMetadataType];

            additionalAttributes2 = [v134 additionalAttributes];
            mediaMetadataData = [additionalAttributes2 mediaMetadataData];

            if (mediaMetadataData)
            {
              mediaMetadata = [v133 mediaMetadata];
              [mediaMetadata setValue:mediaMetadataData forKey:@"data"];
            }
          }

          v99 = [assetCopy masterResourceForCPLType:1];
          uniformTypeIdentifier = [v99 uniformTypeIdentifier];
          identifier = [uniformTypeIdentifier identifier];
          [v133 setUniformTypeIdentifier:identifier];

          uniformTypeIdentifier2 = [v99 uniformTypeIdentifier];
          identifier2 = [uniformTypeIdentifier2 identifier];
          [assetCopy setUniformTypeIdentifier:identifier2];

          uniformTypeIdentifier3 = [v99 uniformTypeIdentifier];
          identifier3 = [uniformTypeIdentifier3 identifier];
          mediaMetadataData2 = [PLManagedAsset preferredFileExtensionForType:identifier3];

          if (mediaMetadataData2)
          {
            originalFilename = [v133 originalFilename];
            stringByDeletingPathExtension = [originalFilename stringByDeletingPathExtension];
            v109 = [stringByDeletingPathExtension stringByAppendingPathExtension:mediaMetadataData2];
            [v133 setOriginalFilename:v109];

            filename = [assetCopy filename];
            stringByDeletingPathExtension2 = [filename stringByDeletingPathExtension];
            v112 = [stringByDeletingPathExtension2 stringByAppendingPathExtension:mediaMetadataData2];
            [assetCopy setFilename:v112];
          }

          additionalAttributes3 = [assetCopy additionalAttributes];
          filename2 = [assetCopy filename];
          [additionalAttributes3 setOriginalFilename:filename2];

          [v133 setOriginalOrientation:{objc_msgSend(assetCopy, "originalOrientation")}];
          scopedIdentifier3 = [v134 scopedIdentifier];
          [v133 setSourceMasterForDuplicationCPLScopedIdentifier:scopedIdentifier3];
        }

        else
        {
          sourceAssetCopy = v134;
          master2 = [v134 master];
          mediaMetadataType2 = [master2 mediaMetadataType];
          v59 = v133;
          [v133 setMediaMetadataType:mediaMetadataType2];

          master3 = [v134 master];
          mediaMetadata2 = [master3 mediaMetadata];
          v99 = [mediaMetadata2 valueForKey:@"data"];

          if (v99)
          {
            mediaMetadata3 = [v133 mediaMetadata];
            [mediaMetadata3 setValue:v99 forKey:@"data"];
          }

          additionalAttributes4 = [assetCopy additionalAttributes];
          additionalAttributes5 = [v134 additionalAttributes];
          mediaMetadataType3 = [additionalAttributes5 mediaMetadataType];
          [additionalAttributes4 setMediaMetadataType:mediaMetadataType3];

          additionalAttributes6 = [v134 additionalAttributes];
          mediaMetadataData2 = [additionalAttributes6 mediaMetadataData];

          if (mediaMetadataData2)
          {
            additionalAttributes7 = [assetCopy additionalAttributes];
            [additionalAttributes7 setMediaMetadataData:mediaMetadataData2];
          }

          scopedIdentifier3 = [v134 master];
          v115ScopedIdentifier = [scopedIdentifier3 scopedIdentifier];
          [v133 setSourceMasterForDuplicationCPLScopedIdentifier:v115ScopedIdentifier];
        }

        additionalAttributes8 = [assetCopy additionalAttributes];
        v58 = v138;
        [additionalAttributes8 setOriginalStableHash:v138];

        mapCopy = v92;
        libraryCopy = v136;
        v19 = v139;
        goto LABEL_108;
      }

      v67 = v66;
      v68 = *v146;
      v141 = *MEMORY[0x1E6982EC8];
LABEL_51:
      v69 = 0;
      while (1)
      {
        if (*v146 != v68)
        {
          objc_enumerationMutation(obj);
        }

        v70 = *(*(&v145 + 1) + 8 * v69);
        cplType = [v70 cplType];
        fingerprint = [v70 fingerprint];

        if (fingerprint)
        {
          v73 = cplType > 0x1B || ((1 << cplType) & 0xC404400) == 0;
          if (v73 && (![v70 unorientedHeight] || !objc_msgSend(v70, "unorientedWidth")))
          {
            if (*MEMORY[0x1E6994D48])
            {
              goto LABEL_83;
            }

            v75 = __CPLAssetsdOSLogDomain();
            if (!os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
            {
              goto LABEL_82;
            }

            scopedIdentifier4 = [assetCopy scopedIdentifier];
            *buf = 138412546;
            v155 = v70;
            v156 = 2112;
            v157 = scopedIdentifier4;
            v77 = v75;
            v78 = OS_LOG_TYPE_ERROR;
            v79 = "Skipping resource from re-referencing since its height or width is nil. Resource is in a really bad state. Skipped resource: %@, asset: %@";
            goto LABEL_67;
          }

          if (!adjustmentsCopy)
          {
            if (photoCopy)
            {
              v74 = [PLManagedAsset resourceTypeForUnadjustedFlattenedLivePhotoAssetResourceType:cplType];
              if (!v74)
              {
                if (*MEMORY[0x1E6994D48])
                {
                  goto LABEL_83;
                }

                v75 = __CPLAssetsdOSLogDomain();
                if (!os_log_type_enabled(v75, OS_LOG_TYPE_DEFAULT))
                {
                  goto LABEL_82;
                }

                scopedIdentifier4 = [assetCopy scopedIdentifier];
                *buf = 138412546;
                v155 = v70;
                v156 = 2112;
                v157 = scopedIdentifier4;
                v77 = v75;
                v78 = OS_LOG_TYPE_DEFAULT;
                v79 = "Skipping resource from re-referencing since we're flattening a live photo and we don't want this resource for flattening. Skipped resource: %@, asset: %@";
                goto LABEL_67;
              }

LABEL_70:
              cplType = v74;
            }

            v75 = [v70 validatedExternalResourceRepresentationUsingFileURL:0];
            [v75 setVersion:0];
            [v75 setCplType:cplType];
            -[NSObject setSourceCplType:](v75, "setSourceCplType:", [v70 cplType]);
            [v75 setSidecarIndex:0];
            if (adjustmentsCopy)
            {
              v80 = assetCopy;
              v81 = adjustmentsCopy;
              v82 = v64;
              if ([v80 isLoopingVideo])
              {
                if (cplType != 1)
                {
                  uniformTypeIdentifier4 = [v70 uniformTypeIdentifier];
                  conformsToMovie = [uniformTypeIdentifier4 conformsToMovie];

                  if (conformsToMovie)
                  {
                    identifier4 = [v141 identifier];
                    v86 = [PLUniformTypeIdentifier utiWithIdentifier:identifier4];
                    [v75 setUniformTypeIdentifier:v86];
                  }
                }
              }

              -[NSObject setRecipeID:](v75, "setRecipeID:", +[PLResourceInstaller recipeIDFromCPLResourceType:assetType:fromAdjustedSet:](PLResourceInstaller, "recipeIDFromCPLResourceType:assetType:fromAdjustedSet:", cplType, [v142 kind], 0));
              v64 = v82;
              adjustmentsCopy = v81;
              assetCopy = v142;
            }

            v87 = [assetCopy storedResourceForExternalResource:v75 asset:assetCopy];
            [v87 resetPrefetchState];
            fileURL = [v70 fileURL];
            cplFileURL = [v87 cplFileURL];
            v90 = cplFileURL;
            if (v64 && fileURL && cplFileURL)
            {
              [v64 setObject:fileURL forKeyedSubscript:cplFileURL];
            }

            goto LABEL_82;
          }

          v74 = [assetCopy masterResourceTypeForAdjustedAssetResourceType:cplType flattenLivePhoto:photoCopy];
          if (v74)
          {
            goto LABEL_70;
          }

          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v75 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v75, OS_LOG_TYPE_DEFAULT))
            {
              scopedIdentifier4 = [assetCopy scopedIdentifier];
              *buf = 138412546;
              v155 = v70;
              v156 = 2112;
              v157 = scopedIdentifier4;
              v77 = v75;
              v78 = OS_LOG_TYPE_DEFAULT;
              v79 = "Skipping resource from re-referencing since it's a asset resource we don't want in a master when baking-in adjustments. Skipped resource: %@, asset: %@";
              goto LABEL_67;
            }

LABEL_82:
          }
        }

        else if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v75 = __CPLAssetsdOSLogDomain();
          if (!os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_82;
          }

          scopedIdentifier4 = [assetCopy scopedIdentifier];
          *buf = 138412546;
          v155 = v70;
          v156 = 2112;
          v157 = scopedIdentifier4;
          v77 = v75;
          v78 = OS_LOG_TYPE_ERROR;
          v79 = "Skipping resource from re-referencing since its fingerprint is nil. Resource is in a really bad state. Skipped resource: %@, asset: %@";
LABEL_67:
          _os_log_impl(&dword_19BF1F000, v77, v78, v79, buf, 0x16u);

          goto LABEL_82;
        }

LABEL_83:
        if (v67 == ++v69)
        {
          v91 = [obj countByEnumeratingWithState:&v145 objects:v153 count:16];
          v67 = v91;
          if (!v91)
          {
            goto LABEL_94;
          }

          goto LABEL_51;
        }
      }
    }

    bestAvailableAdjustedResource = [sourceAssetCopy bestAvailableAdjustedResource];
    if (bestAvailableAdjustedResource)
    {
      currentHandler = bestAvailableAdjustedResource;
      fingerprint2 = [bestAvailableAdjustedResource fingerprint];
      if (fingerprint2)
      {
        v140 = fingerprint2;
        v137 = mapCopy;
        v26 = 0;
      }

      else
      {
        v37 = adjustmentsCopy;
        v38 = libraryCopy;
        fingerprintContext = [sourceAssetCopy fingerprintContext];
        fingerprintSchemeForNewMasterAsset = [fingerprintContext fingerprintSchemeForNewMasterAsset];
        fileURL2 = [currentHandler fileURL];
        v150 = 0;
        v42 = [fingerprintSchemeForNewMasterAsset fingerPrintForFileAtURL:fileURL2 error:&v150];
        v43 = v150;

        v140 = v42;
        if (!v42)
        {
          if (*MEMORY[0x1E6994D48])
          {
            v140 = 0;
            libraryCopy = v38;
            assetCopy = v142;
            goto LABEL_121;
          }

          v129 = __CPLAssetsdOSLogDomain();
          assetCopy = v142;
          if (os_log_type_enabled(v129, OS_LOG_TYPE_ERROR))
          {
            scopedIdentifier5 = [v142 scopedIdentifier];
            *buf = 138412546;
            v155 = scopedIdentifier5;
            v156 = 2112;
            v157 = v43;
            _os_log_impl(&dword_19BF1F000, v129, OS_LOG_TYPE_ERROR, "Baking in adjustments during master creation but failed to find a source primary adjusted resource fingerprint for asset: %@ - %@", buf, 0x16u);
          }

          v140 = 0;
          libraryCopy = v38;
LABEL_120:

LABEL_121:
          v22 = 0;
          v19 = v139;
          v33 = v140;
          goto LABEL_109;
        }

        v137 = mapCopy;
        v26 = v43;
        libraryCopy = v38;
        adjustmentsCopy = v37;
        assetCopy = v142;
      }

      v44 = MEMORY[0x1E6994D48];
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v45 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
          scopedIdentifier6 = [assetCopy scopedIdentifier];
          v47 = adjustmentsCopy;
          v48 = libraryCopy;
          v49 = [MEMORY[0x1E6994B90] descriptionForResourceType:{objc_msgSend(currentHandler, "cplType")}];
          *buf = 138412802;
          v155 = scopedIdentifier6;
          v156 = 2112;
          v157 = v49;
          v158 = 2112;
          v159 = v140;
          _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEFAULT, "Baking in adjustments during master creation for asset: %@, using source's primary adjusted resource with type: %@ fingerprint: %@", buf, 0x20u);

          libraryCopy = v48;
          adjustmentsCopy = v47;
          assetCopy = v142;
        }
      }

      stableHash = [currentHandler stableHash];
      if (stableHash)
      {
        goto LABEL_40;
      }

      if ([MEMORY[0x1E6994AE0] isStableHash:v140])
      {
        stableHash = v140;
LABEL_40:
        v138 = stableHash;

        goto LABEL_41;
      }

      v51 = adjustmentsCopy;
      v135 = libraryCopy;
      fingerprintSchemeForStableHash = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
      fileURL3 = [currentHandler fileURL];
      v149 = v26;
      v54 = [fingerprintSchemeForStableHash fingerPrintForFileAtURL:fileURL3 error:&v149];
      v43 = v149;

      if (v54)
      {
        stableHash = v54;
        v26 = v43;
        libraryCopy = v135;
        adjustmentsCopy = v51;
        assetCopy = v142;
        goto LABEL_40;
      }

      assetCopy = v142;
      if (*v44)
      {
        libraryCopy = v135;
        mapCopy = v137;
        goto LABEL_121;
      }

      v129 = __CPLAssetsdOSLogDomain();
      mapCopy = v137;
      if (os_log_type_enabled(v129, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier7 = [v142 scopedIdentifier];
        *buf = 138412546;
        v155 = scopedIdentifier7;
        v156 = 2112;
        v157 = v43;
        _os_log_impl(&dword_19BF1F000, v129, OS_LOG_TYPE_ERROR, "Baking in adjustments during master creation but failed to find a source primary adjusted resource stable hash for asset: %@ - %@", buf, 0x16u);
      }

      libraryCopy = v135;
      goto LABEL_120;
    }

    v19 = v139;
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v33 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        scopedIdentifier8 = [assetCopy scopedIdentifier];
        *buf = 138412290;
        v155 = scopedIdentifier8;
        _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_ERROR, "Baking in adjustments during master creation but failed to find a source primary adjusted resource for asset: %@", buf, 0xCu);
      }

      v22 = 0;
      goto LABEL_109;
    }
  }

  else
  {
    if (*MEMORY[0x1E6994D48])
    {
      v22 = 0;
      goto LABEL_111;
    }

    v19 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      uuid = [sourceAssetCopy uuid];
      uuid2 = [assetCopy uuid];
      *buf = 138412802;
      v155 = uuid;
      v156 = 2112;
      v157 = uuid2;
      v158 = 2080;
      v159 = "+[PLManagedAsset(Share) createMasterForPlaceholderAsset:withSourceAsset:shouldBakeInAdjustments:shouldFlattenLivePhoto:placeholderResourceURLToSourceResourceURLMap:photoLibrary:]";
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Source asset %@ for placeholder asset %@ does not have a master. Bailing out of %s", buf, 0x20u);
    }
  }

  v22 = 0;
LABEL_110:

LABEL_111:
  return v22;
}

+ (BOOL)createShareAssetsForShare:(id)share batchedSourceAssetsToCopy:(id)copy creationRequestSourceAssetsToShareAssetsMap:(id)map curatedSourceAssets:(id)assets adjustmentBakeInOptionsDictionary:(id)dictionary metadataCopyOptionsDictionary:(id)optionsDictionary keySourceAssetIdentifier:(id)identifier commentText:(id)self0 clientConnection:(id)self1 library:(id)self2 error:(id *)self3
{
  v148[1] = *MEMORY[0x1E69E9840];
  shareCopy = share;
  copyCopy = copy;
  mapCopy = map;
  assetsCopy = assets;
  dictionaryCopy = dictionary;
  optionsDictionaryCopy = optionsDictionary;
  identifierCopy = identifier;
  textCopy = text;
  connectionCopy = connection;
  libraryCopy = library;
  v131 = 0;
  v132 = &v131;
  v133 = 0x3032000000;
  v134 = __Block_byref_object_copy__103360;
  v135 = __Block_byref_object_dispose__103361;
  v136 = 0;
  v103 = shareCopy;
  subclassKind = [objc_opt_class() subclassKind];
  v97 = objc_alloc_init(MEMORY[0x1E696AC08]);
  if (subclassKind == 3)
  {
    v19 = shareCopy;
    if ([v19 collectionShareKind] == 2)
    {
      array = [copyCopy array];
      v126 = MEMORY[0x1E69E9820];
      v127 = 3221225472;
      v128 = __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke;
      v129 = &unk_1E7575420;
      v130[0] = v19;
      v130[1] = &v131;
      v99 = v130[0];
      [self _createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs:array withBatchCommentText:textCopy adjustmentBakeInOptionsDictionary:dictionaryCopy collectionShare:? library:? completionHandler:?];

      v21 = v130;
      v22 = v132[5] == 0;
      goto LABEL_74;
    }
  }

  v23 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v123[0] = MEMORY[0x1E69E9820];
  v123[1] = 3221225472;
  v123[2] = __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke_2;
  v123[3] = &unk_1E7578238;
  v100 = assetsCopy;
  v124 = v100;
  v99 = v23;
  v125 = v99;
  [mapCopy enumerateKeysAndObjectsUsingBlock:v123];
  v91 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@ AND (noindex:(%K) == NULL OR noindex:(%K) == NULL)", @"uuid", copyCopy, @"momentShare", @"collectionShare"];
  v24 = MEMORY[0x1E695D5E0];
  v25 = +[PLManagedAsset entityName];
  v95 = [v24 fetchRequestWithEntityName:v25];

  [v95 setPredicate:v91];
  [v95 setFetchLimit:{objc_msgSend(copyCopy, "count")}];
  v148[0] = @"additionalAttributes";
  v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:v148 count:1];
  [v95 setRelationshipKeyPathsForPrefetching:v26];

  if ([copyCopy count] >= 0x65)
  {
    [v95 setFetchBatchSize:100];
  }

  v27 = [copyCopy count];
  v22 = v27 == 0;
  if (!v27)
  {
    if (*MEMORY[0x1E6994D48])
    {
      v30 = 0;
      v88 = 0;
      v22 = 1;
      goto LABEL_20;
    }

    v31 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(buf) = 0;
      _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_DEFAULT, "Zero batchedSourceAssetsToCopy: passed in", &buf, 2u);
    }

    v88 = 0;
    goto LABEL_19;
  }

  managedObjectContext = [libraryCopy managedObjectContext];
  v122 = 0;
  v29 = [managedObjectContext executeFetchRequest:v95 error:&v122];
  v88 = v122;

  if (!v29)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v32 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        buf = 138412290;
        v140 = v88;
        _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_ERROR, "Failed to fetch assets to copy: %@", &buf, 0xCu);
      }
    }

    v33 = MEMORY[0x1E696ABC0];
    v146 = *MEMORY[0x1E696A578];
    v31 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Failed to fetch assets to copy: %@", v88];
    v147 = v31;
    v34 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v147 forKeys:&v146 count:1];
    v35 = [v33 errorWithDomain:*MEMORY[0x1E69BFF48] code:-1000001 userInfo:v34];
    v36 = v132[5];
    v132[5] = v35;

LABEL_19:
    v30 = 0;
    goto LABEL_20;
  }

  v22 = 1;
  v30 = v29;
LABEL_20:
  v89 = v30;
  if (![v30 count])
  {
    goto LABEL_64;
  }

  v120 = 0u;
  v121 = 0u;
  v118 = 0u;
  v119 = 0u;
  obj = v89;
  v37 = [obj countByEnumeratingWithState:&v118 objects:v145 count:16];
  if (!v37)
  {
    goto LABEL_63;
  }

  v111 = *v119;
  v107 = *MEMORY[0x1E69BFF48];
  v108 = *MEMORY[0x1E696A578];
  do
  {
    v38 = 0;
    v112 = v37;
    do
    {
      if (*v119 != v111)
      {
        objc_enumerationMutation(obj);
      }

      v39 = *(*(&v118 + 1) + 8 * v38);
      context = objc_autoreleasePoolPush();
      if (subclassKind <= 1u)
      {
        if (subclassKind)
        {
          v40 = subclassKind == 1;
          goto LABEL_34;
        }

LABEL_33:
        currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
        [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Share.m" lineNumber:713 description:{@"%s called with invalid subclass kind", "+[PLManagedAsset(Share) createShareAssetsForShare:batchedSourceAssetsToCopy:creationRequestSourceAssetsToShareAssetsMap:curatedSourceAssets:adjustmentBakeInOptionsDictionary:metadataCopyOptionsDictionary:keySourceAssetIdentifier:commentText:clientConnection:library:error:]"}];

        v40 = 0;
        goto LABEL_34;
      }

      if (subclassKind == 2)
      {
        goto LABEL_33;
      }

      if (subclassKind == 3)
      {
        v40 = 5;
      }

      else
      {
        v40 = 0;
      }

LABEL_34:
      uuid = [v39 uuid];
      LOWORD(v87) = 257;
      v43 = +[PLManagedAsset insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:](PLManagedAsset, "insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:", libraryCopy, 0, 0, [MEMORY[0x1E69BF328] savedAssetTypeForPlaceholder], v40, 0, 0, 0, 0, v87);
      uuid2 = [v43 uuid];
      if (!v43)
      {
        v57 = MEMORY[0x1E696ABC0];
        v143 = v108;
        v58 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Failed to create placeholder asset"];
        v144 = v58;
        v59 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v144 forKeys:&v143 count:1];
        v60 = [v57 errorWithDomain:v107 code:-1000001 userInfo:v59];
        v61 = v132[5];
        v132[5] = v60;

LABEL_43:
        v22 = 0;
        goto LABEL_61;
      }

      if (!v22)
      {
        goto LABEL_43;
      }

      v117 = 0;
      v45 = [dictionaryCopy objectForKeyedSubscript:uuid];
      v46 = [self shouldBakeInAdjustmentsAndFlattenLivePhoto:&v117 forSourceAsset:v39 adjustmentBakeInOptions:v45];
      v106 = v45;
      if ([v45 flattenLivePhotoToStillIfNeeded])
      {
        v117 = 1;
        v46 |= [v39 hasAdjustments];
      }

      v113 = [optionsDictionaryCopy objectForKeyedSubscript:uuid];
      shouldCopyTitleDescriptionAndKeywords = [v113 shouldCopyTitleDescriptionAndKeywords];
      BYTE2(v86) = [v113 shouldCopySpatialOverCaptureResources];
      BYTE1(v86) = shouldCopyTitleDescriptionAndKeywords;
      LOBYTE(v86) = v117;
      v48 = [v43 setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:v39 placeholderAssetUUID:uuid2 bundleScope:v40 share:v103 importSessionID:0 bakeInAdjustmentsFromSourceAsset:v46 & 1 flattenLivePhoto:v86 copyTitleDescriptionAndKeywords:libraryCopy copyCameraProcessingAdjustmentResources:? library:?];
      v49 = v48;
      if (subclassKind == 1)
      {
        if (v48)
        {
          uuid3 = [v39 uuid];
          v51 = [uuid3 isEqualToString:identifierCopy];

          if (v51)
          {
            v52 = v103;
            v53 = objc_alloc(MEMORY[0x1E6994B28]);
            previewData = [v52 previewData];
            v55 = [v53 initWithData:previewData];

            [v55 setKeyAssetIdentifier:uuid2];
            data = [v55 data];
            [v52 setPreviewData:data];
          }

LABEL_45:
          if ([v100 containsObject:uuid])
          {
            [v99 addObject:uuid2];
          }
        }
      }

      else if (v48)
      {
        goto LABEL_45;
      }

      v109 = objc_alloc_init(MEMORY[0x1E695DF90]);
      if (v49 && [self createMasterForPlaceholderAsset:v43 withSourceAsset:v39 shouldBakeInAdjustments:v46 & 1 shouldFlattenLivePhoto:v117 placeholderResourceURLToSourceResourceURLMap:v109 photoLibrary:libraryCopy] && objc_msgSend(self, "createAssetResourcesForPlaceholderAsset:withSourceAsset:shouldBakeInAdjustments:shouldFlattenLivePhoto:placeholderResourceURLToSourceResourceURLMap:photoLibrary:", v43, v39, v46 & 1, v117, v109, libraryCopy))
      {
        [self _cloneResourcesForSharePlaceholderAsset:v43 withPlaceholderResourceURLToSourceResourceURLMap:v109 fileManager:v97 photoLibrary:libraryCopy];
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v62 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_DEFAULT))
          {
            scopedIdentifier = [v43 scopedIdentifier];
            scopedIdentifier2 = [v39 scopedIdentifier];
            buf = 138412546;
            v140 = scopedIdentifier;
            v141 = 2112;
            v142 = scopedIdentifier2;
            _os_log_impl(&dword_19BF1F000, v62, OS_LOG_TYPE_DEFAULT, "Preparing share asset %@ for server copy from source asset %@", &buf, 0x16u);
          }
        }

        additionalAttributes = [v39 additionalAttributes];
        v22 = 1;
        [additionalAttributes setDestinationAssetCopyState:1];
      }

      else
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v66 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
          {
            scopedIdentifier3 = [v43 scopedIdentifier];
            scopedIdentifier4 = [v39 scopedIdentifier];
            buf = 138412546;
            v140 = scopedIdentifier3;
            v141 = 2112;
            v142 = scopedIdentifier4;
            _os_log_impl(&dword_19BF1F000, v66, OS_LOG_TYPE_ERROR, "Failed to prepare share asset %@ for server copy from source asset %@", &buf, 0x16u);
          }
        }

        v69 = MEMORY[0x1E696ABC0];
        v137 = v108;
        v70 = MEMORY[0x1E696AEC0];
        scopedIdentifier5 = [v43 scopedIdentifier];
        scopedIdentifier6 = [v39 scopedIdentifier];
        v73 = [v70 stringWithFormat:@"Failed to prepare share asset %@ for server copy from source asset %@", scopedIdentifier5, scopedIdentifier6];
        v138 = v73;
        v74 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v138 forKeys:&v137 count:1];
        v75 = [v69 errorWithDomain:v107 code:-1000001 userInfo:v74];
        v76 = v132[5];
        v132[5] = v75;

        additionalAttributes = [v39 additionalAttributes];
        [additionalAttributes setDestinationAssetCopyState:0xFFFFFFFFLL];
        v22 = 0;
      }

LABEL_61:
      objc_autoreleasePoolPop(context);
      ++v38;
    }

    while (v112 != v38);
    v37 = [obj countByEnumeratingWithState:&v118 objects:v145 count:16];
  }

  while (v37);
LABEL_63:

LABEL_64:
  [v103 recomputeCachedValues];
  if (subclassKind == 1)
  {
    v77 = v103;
    if ([v99 count])
    {
      v78 = objc_alloc(MEMORY[0x1E6994B28]);
      previewData2 = [v77 previewData];
      v80 = [v78 initWithData:previewData2];

      allObjects = [v99 allObjects];
      v82 = [allObjects mutableCopy];
      [v80 setCuratedAssetIdentifiers:v82];

      data2 = [v80 data];
      [v77 setPreviewData:data2];
    }
  }

  if (error)
  {
    v84 = v22;
  }

  else
  {
    v84 = 1;
  }

  if ((v84 & 1) == 0)
  {
    *error = v132[5];
  }

  v21 = &v124;
LABEL_74:

  _Block_object_dispose(&v131, 8);
  return v22;
}

void __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke(uint64_t a1, uint64_t a2, uint64_t a3, void *a4)
{
  v7 = a4;
  [*(a1 + 32) publishAssets:a2 withComment:a3];
  v8 = *(*(a1 + 40) + 8);
  v9 = *(v8 + 40);
  *(v8 + 40) = v7;
}

void __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v5 = a3;
  if ([*(a1 + 32) containsObject:a2])
  {
    [*(a1 + 40) addObject:v5];
  }
}

+ (BOOL)shouldBakeInAdjustmentsAndFlattenLivePhoto:(BOOL *)photo forSourceAsset:(id)asset adjustmentBakeInOptions:(id)options
{
  v24 = *MEMORY[0x1E69E9840];
  assetCopy = asset;
  optionsCopy = options;
  if ([assetCopy hasAdjustments])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        scopedIdentifier = [assetCopy scopedIdentifier];
        *buf = 138412546;
        *&buf[4] = scopedIdentifier;
        *&buf[12] = 2112;
        *&buf[14] = optionsCopy;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Determining whether to bake in adjustments in source asset: %@, with adjustment bake-in options: %@", buf, 0x16u);
      }
    }

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x2020000000;
    v23 = 0;
    v18 = 0;
    v19 = &v18;
    v20 = 0x2020000000;
    v21 = 0;
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __107__PLManagedAsset_Share__shouldBakeInAdjustmentsAndFlattenLivePhoto_forSourceAsset_adjustmentBakeInOptions___block_invoke;
    v13[3] = &unk_1E75753F8;
    v14 = assetCopy;
    v15 = optionsCopy;
    v16 = &v18;
    v17 = buf;
    [v14 synchronouslyFetchAdjustmentBlobWithCompletionHandler:v13];
    if (photo)
    {
      *photo = *(v19 + 24);
    }

    v11 = *(*&buf[8] + 24);

    _Block_object_dispose(&v18, 8);
    _Block_object_dispose(buf, 8);
  }

  else
  {
    v11 = 0;
  }

  return v11 & 1;
}

void __107__PLManagedAsset_Share__shouldBakeInAdjustmentsAndFlattenLivePhoto_forSourceAsset_adjustmentBakeInOptions___block_invoke(uint64_t a1, void *a2, uint64_t a3, void *a4, void *a5, uint64_t a6, uint64_t a7, void *a8, void *a9)
{
  v118 = *MEMORY[0x1E69E9840];
  v13 = a2;
  v88 = a4;
  v86 = a5;
  v85 = a8;
  v84 = a9;
  if (v13)
  {
    v14 = objc_alloc_init(PLPhotoEditPersistenceManager);
    v15 = [(PLPhotoEditPersistenceManager *)v14 debugDescriptionForAdjustmentData:v13];
  }

  else
  {
    v15 = 0;
  }

  if ([*(a1 + 32) isPhotoIris] && objc_msgSend(*(a1 + 40), "shouldBakeInIfLivePhotoPlaybackDisabled") && (objc_msgSend(*(a1 + 32), "canPlayPhotoIris") & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v16 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        v17 = [*(a1 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v17;
        _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments and flatten because Live Photo playback is disabled in source asset: %@", buf, 0xCu);
      }
    }

    *(*(*(a1 + 48) + 8) + 24) = 1;
    *(*(*(a1 + 56) + 8) + 24) = 1;
  }

  v90 = a1;
  v87 = v15;
  if ((*(*(*(a1 + 48) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfLivePhotoMuted])
  {
    v109 = 0u;
    v110 = 0u;
    v107 = 0u;
    v108 = 0u;
    v18 = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
    v19 = [v18 countByEnumeratingWithState:&v107 objects:v115 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v108;
      v22 = *MEMORY[0x1E69C0E30];
      v23 = *MEMORY[0x1E69C0E50];
      while (2)
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v108 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v25 = *(*(&v107 + 1) + 8 * i);
          v26 = [v25 objectForKeyedSubscript:v22];
          v27 = [v25 objectForKeyedSubscript:@"enabled"];
          if ([v26 isEqualToString:v23] && objc_msgSend(v27, "BOOLValue"))
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v28 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
              {
                v29 = [*(a1 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v29;
                _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because Live Photo is muted in source asset: %@", buf, 0xCu);
              }
            }

            *(*(*(a1 + 56) + 8) + 24) = 1;

            goto LABEL_29;
          }
        }

        v20 = [v18 countByEnumeratingWithState:&v107 objects:v115 count:16];
        if (v20)
        {
          continue;
        }

        break;
      }
    }

LABEL_29:

    v15 = v87;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfAdjustedByThirdParty] && (objc_msgSend(v88, "isEqualToString:", *MEMORY[0x1E69C0E58]) & 1) == 0 && (objc_msgSend(v88, "isEqualToString:", *MEMORY[0x1E69C0E98]) & 1) == 0 && (objc_msgSend(v88, "isEqualToString:", *MEMORY[0x1E69C0E90]) & 1) == 0 && (IPAAdjustmentsComeFromSupportedApp() & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v30 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v31 = [*(a1 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v31;
        _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because third-party edits are applied in source asset: %@", buf, 0xCu);
      }
    }

    *(*(*(a1 + 56) + 8) + 24) = 1;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) != 0 || ![*(a1 + 40) shouldBakeInIfCropped])
  {
    goto LABEL_70;
  }

  v105 = 0u;
  v106 = 0u;
  v103 = 0u;
  v104 = 0u;
  obj = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
  v32 = [obj countByEnumeratingWithState:&v103 objects:v114 count:16];
  if (!v32)
  {
    goto LABEL_69;
  }

  v33 = v32;
  v34 = *v104;
  v35 = *MEMORY[0x1E69C0E30];
  v36 = *MEMORY[0x1E69C0E68];
  v82 = *MEMORY[0x1E69C0EC0];
  v83 = *MEMORY[0x1E69C0E40];
  v81 = v13;
  while (2)
  {
    for (j = 0; j != v33; ++j)
    {
      if (*v104 != v34)
      {
        objc_enumerationMutation(obj);
      }

      v38 = *(*(&v103 + 1) + 8 * j);
      v39 = [v38 objectForKeyedSubscript:{v35, v81}];
      v40 = [v38 objectForKeyedSubscript:@"enabled"];
      if ([v39 isEqualToString:v36] && (!v40 || objc_msgSend(v40, "BOOLValue")))
      {
        a1 = v90;
        if (*MEMORY[0x1E6994D48])
        {
LABEL_68:
          *(*(*(a1 + 56) + 8) + 24) = 1;

          v13 = v81;
          v15 = v87;
          goto LABEL_69;
        }

        v45 = __CPLAssetsdOSLogDomain();
        if (!os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
LABEL_67:

          goto LABEL_68;
        }

        v46 = [*(v90 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v46;
        v47 = "Will bake in adjustments because of cropping edits in source asset: %@";
LABEL_66:
        _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEFAULT, v47, buf, 0xCu);

        goto LABEL_67;
      }

      if ([v39 isEqualToString:v36])
      {
        v41 = v34;
        v42 = [v38 objectForKeyedSubscript:v83];
        v43 = [v42 objectForKeyedSubscript:v82];
        if (![v43 BOOLValue])
        {
          v44 = [v39 isEqualToString:@"VideoReframe"];

          v34 = v41;
          if (v44)
          {
            goto LABEL_63;
          }

          goto LABEL_56;
        }

LABEL_63:
        if (*MEMORY[0x1E6994D48])
        {
          a1 = v90;
          goto LABEL_68;
        }

        v45 = __CPLAssetsdOSLogDomain();
        a1 = v90;
        if (!os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_67;
        }

        v46 = [*(v90 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v46;
        v47 = "Will bake in adjustments because of reframe edits in source asset: %@";
        goto LABEL_66;
      }

      if ([v39 isEqualToString:@"VideoReframe"])
      {
        goto LABEL_63;
      }

LABEL_56:
    }

    v33 = [obj countByEnumeratingWithState:&v103 objects:v114 count:16];
    v13 = v81;
    a1 = v90;
    v15 = v87;
    if (v33)
    {
      continue;
    }

    break;
  }

LABEL_69:

LABEL_70:
  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfTimelineTrimmed])
  {
    v101 = 0u;
    v102 = 0u;
    v99 = 0u;
    v100 = 0u;
    v48 = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
    v49 = [v48 countByEnumeratingWithState:&v99 objects:v113 count:16];
    if (v49)
    {
      v50 = v49;
      v51 = *v100;
      v52 = *MEMORY[0x1E69C0E30];
      v53 = *MEMORY[0x1E69C0EA8];
      while (2)
      {
        for (k = 0; k != v50; ++k)
        {
          if (*v100 != v51)
          {
            objc_enumerationMutation(v48);
          }

          v55 = *(*(&v99 + 1) + 8 * k);
          v56 = [v55 objectForKeyedSubscript:v52];
          v57 = [v55 objectForKeyedSubscript:@"enabled"];
          if ([v56 isEqualToString:v53] && (!v57 || objc_msgSend(v57, "BOOLValue")))
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v58 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v58, OS_LOG_TYPE_DEFAULT))
              {
                v59 = [*(v90 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v59;
                _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because of timeline trimming edits in source asset: %@", buf, 0xCu);
              }
            }

            *(*(*(v90 + 56) + 8) + 24) = 1;

            goto LABEL_88;
          }
        }

        v50 = [v48 countByEnumeratingWithState:&v99 objects:v113 count:16];
        if (v50)
        {
          continue;
        }

        break;
      }
    }

LABEL_88:

    a1 = v90;
    v15 = v87;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfPortraitDepthEffectEnabled])
  {
    v97 = 0u;
    v98 = 0u;
    v95 = 0u;
    v96 = 0u;
    v60 = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
    v61 = [v60 countByEnumeratingWithState:&v95 objects:v112 count:16];
    if (v61)
    {
      v62 = v61;
      v63 = *v96;
      v64 = *MEMORY[0x1E69C0E30];
      v65 = *MEMORY[0x1E69C0E70];
      while (2)
      {
        for (m = 0; m != v62; ++m)
        {
          if (*v96 != v63)
          {
            objc_enumerationMutation(v60);
          }

          v67 = *(*(&v95 + 1) + 8 * m);
          v68 = [v67 objectForKeyedSubscript:v64];
          v69 = [v67 objectForKeyedSubscript:@"enabled"];
          if ([v68 isEqualToString:v65] && (!v69 || objc_msgSend(v69, "BOOLValue")))
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v70 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v70, OS_LOG_TYPE_DEFAULT))
              {
                v71 = [*(v90 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v71;
                _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because of portrait depth effect in source asset: %@", buf, 0xCu);
              }
            }

            *(*(*(v90 + 56) + 8) + 24) = 1;

            goto LABEL_107;
          }
        }

        v62 = [v60 countByEnumeratingWithState:&v95 objects:v112 count:16];
        if (v62)
        {
          continue;
        }

        break;
      }
    }

LABEL_107:

    a1 = v90;
    v15 = v87;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfContainsPenultimateResources])
  {
    v93 = 0u;
    v94 = 0u;
    v91 = 0u;
    v92 = 0u;
    v72 = [*(a1 + 32) modernResources];
    v73 = [v72 countByEnumeratingWithState:&v91 objects:v111 count:16];
    if (v73)
    {
      v74 = v73;
      v75 = *v92;
      v76 = MEMORY[0x1E6994D48];
      do
      {
        for (n = 0; n != v74; ++n)
        {
          if (*v92 != v75)
          {
            objc_enumerationMutation(v72);
          }

          v78 = *(*(&v91 + 1) + 8 * n);
          if ([v78 version] == 1 && (objc_msgSend(v78, "isDerivative") & 1) == 0)
          {
            if ((*v76 & 1) == 0)
            {
              v79 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v79, OS_LOG_TYPE_DEFAULT))
              {
                v80 = [*(a1 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v80;
                _os_log_impl(&dword_19BF1F000, v79, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because penultimate resources exist in source asset: %@", buf, 0xCu);

                a1 = v90;
              }
            }

            *(*(*(a1 + 56) + 8) + 24) = 1;
          }
        }

        v74 = [v72 countByEnumeratingWithState:&v91 objects:v111 count:16];
      }

      while (v74);
    }

    v15 = v87;
  }
}

+ (unint64_t)resourceTypeForUnadjustedFlattenedLivePhotoAssetResourceType:(unint64_t)type
{
  result = type;
  if ((type + 1 > 0x1C || ((1 << (type + 1)) & 0x1185FE7F) == 0) && type - 1000 >= 2)
  {
    return 0;
  }

  return result;
}

+ (BOOL)shouldPerformServerCopyWithSourceAsset:(id)asset copyingFromShare:(BOOL)share photoLibrary:(id)library
{
  shareCopy = share;
  assetCopy = asset;
  libraryCopy = library;
  if ([libraryCopy isCloudPhotoLibraryEnabled] && objc_msgSend(assetCopy, "placeholder_shouldAllowServerCopy"))
  {
    if (shareCopy)
    {
      master = [assetCopy master];
      mediaMetadata = [master mediaMetadata];
      v11 = [mediaMetadata valueForKey:@"data"];

      if (v11)
      {
        pathManager = [libraryCopy pathManager];
        v13 = CPLStatusFromPathManager(pathManager);
        exitDeleteTime = [v13 exitDeleteTime];
        if (exitDeleteTime)
        {
        }

        else if (([v13 isExceedingQuota] & 1) == 0)
        {
          v15 = 1;
          goto LABEL_12;
        }

        v15 = 0;
LABEL_12:

        goto LABEL_13;
      }

      v15 = 0;
    }

    else
    {
      allMasterCPLResources = [assetCopy allMasterCPLResources];
      allAssetCPLResources = [assetCopy allAssetCPLResources];
      v11 = [allMasterCPLResources setByAddingObjectsFromSet:allAssetCPLResources];

      allObjects = [v11 allObjects];
      LOBYTE(allAssetCPLResources) = [allObjects _pl_any:&__block_literal_global_103470];

      allAssetCPLResources2 = [assetCopy allAssetCPLResources];
      allObjects2 = [allAssetCPLResources2 allObjects];
      v21 = [allObjects2 _pl_any:&__block_literal_global_93];

      master2 = [assetCopy master];
      LOBYTE(allAssetCPLResources2) = master2 == 0;

      v15 = ((allAssetCPLResources2 | v21 | allAssetCPLResources) & 1) - 1;
    }

LABEL_13:

    goto LABEL_14;
  }

  v15 = 0;
LABEL_14:

  return v15 & 1;
}

BOOL __94__PLManagedAsset_Share__shouldPerformServerCopyWithSourceAsset_copyingFromShare_photoLibrary___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 cloudLocalState] == 1)
  {
    v3 = [v2 fingerprint];
    v4 = v3 == 0;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

+ (BOOL)shouldPerformServerCopyOnPlaceholderAsset:(id)asset photoLibrary:(id)library
{
  libraryCopy = library;
  fetchSourceAssetForDuplicationIfExists = [asset fetchSourceAssetForDuplicationIfExists];
  shareRelationship = [fetchSourceAssetForDuplicationIfExists shareRelationship];

  LOBYTE(self) = [self shouldPerformServerCopyWithSourceAsset:fetchSourceAssetForDuplicationIfExists copyingFromShare:shareRelationship != 0 photoLibrary:libraryCopy];
  return self;
}

- (void)setWasGuestAsset:(BOOL)asset
{
  assetCopy = asset;
  v14 = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationHistory = [additionalAttributes syndicationHistory];
  if (assetCopy)
  {
    v7 = 1;
  }

  else
  {
    v7 = 2;
  }

  if (v7 != syndicationHistory)
  {
    if (syndicationHistory == 1)
    {
      v8 = PLSyndicationGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        uuid = [(PLManagedAsset *)self uuid];
        v12 = 138543362;
        v13 = uuid;
        v10 = "GuestAssetSync: leaving asset %{public}@ marked as wasGuestAsset";
LABEL_13:
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_INFO, v10, &v12, 0xCu);
      }
    }

    else
    {
      [additionalAttributes setSyndicationHistory:v7];
      v8 = PLSyndicationGetLog();
      v11 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
      if (assetCopy)
      {
        if (v11)
        {
          uuid = [(PLManagedAsset *)self uuid];
          v12 = 138543362;
          v13 = uuid;
          v10 = "GuestAssetSync: marked asset %{public}@ as wasGuestAsset";
          goto LABEL_13;
        }
      }

      else if (v11)
      {
        uuid = [(PLManagedAsset *)self uuid];
        v12 = 138543362;
        v13 = uuid;
        v10 = "GuestAssetSync: marked asset %{public}@ as wasNotGuestAsset";
        goto LABEL_13;
      }
    }
  }
}

- (void)purgeSyndicationResourcesOriginalsOnly:(BOOL)only
{
  onlyCopy = only;
  v48 = *MEMORY[0x1E69E9840];
  v34 = objc_alloc_init(MEMORY[0x1E696AC08]);
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v6 = [modernResources countByEnumeratingWithState:&v39 objects:v47 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v40;
    v36 = *MEMORY[0x1E69BFF00];
    *&v7 = 138412546;
    v33 = v7;
    v35 = onlyCopy;
    do
    {
      v10 = 0;
      do
      {
        if (*v40 != v9)
        {
          objc_enumerationMutation(modernResources);
        }

        v11 = *(*(&v39 + 1) + 8 * v10);
        if ([v11 dataStoreClassID] == 3)
        {
          if ([v11 isLocallyAvailable])
          {
            if (onlyCopy && ([v11 isOriginalResource] & 1) == 0)
            {
              v16 = PLSyndicationGetLog();
              if (!os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
              {
                goto LABEL_23;
              }

              uuid = [(PLManagedAsset *)self uuid];
              *buf = 138543618;
              v44 = uuid;
              v45 = 2112;
              v46 = v11;
              v25 = v16;
              v26 = OS_LOG_TYPE_INFO;
              v27 = "Skipping purge of syndication asset %{public}@ resource that is not an original %@";
              goto LABEL_22;
            }

            additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
            importedByBundleIdentifier = [additionalAttributes importedByBundleIdentifier];
            v14 = [importedByBundleIdentifier isEqualToString:v36];

            if (!v14)
            {
              goto LABEL_24;
            }

            fileURL = [v11 fileURL];
            v16 = fileURL;
            if (fileURL)
            {
              path = [fileURL path];
              v38 = 0;
              v18 = [PLCacheDeleteSupport isPurgeableFile:path outIsPhotoType:0 outUrgencyLevel:0 error:&v38];
              v19 = v38;

              if (v18)
              {
                v20 = PLSyndicationGetLog();
                if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
                {
                  uuid2 = [(PLManagedAsset *)self uuid];
                  *buf = 138543618;
                  v44 = uuid2;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_INFO, "Purge syndication asset %{public}@ resource %@", buf, 0x16u);
                }

                v37 = 0;
                v22 = [v34 removeItemAtURL:v16 error:&v37];
                v23 = v37;
                if (v22 || PLIsErrorFileNotFound())
                {
                  [v11 markAsNotLocallyAvailableAfterPurge];
                }

                else
                {
                  v30 = PLSyndicationGetLog();
                  if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
                  {
                    v31 = [MEMORY[0x1E69BF220] descriptionWithFileURL:v16];
                    *buf = v33;
                    v44 = v31;
                    v45 = 2112;
                    v46 = v23;
                    _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_ERROR, "purgeSyndicationResources: removeItemAtURL:%@ failed: %@", buf, 0x16u);
                  }
                }

                onlyCopy = v35;
              }

              else
              {
                if (PLIsErrorFileNotFound())
                {
                  [v11 markAsNotLocallyAvailableAfterPurge];
                }

                else
                {
                  v28 = PLSyndicationGetLog();
                  if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
                  {
                    v29 = [MEMORY[0x1E69BF220] descriptionWithFileURL:v16];
                    *buf = v33;
                    v44 = v29;
                    v45 = 2112;
                    v46 = v19;
                    _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_INFO, "File is not purgeable at %@ error %@", buf, 0x16u);
                  }
                }

                onlyCopy = v35;
              }
            }
          }

          else
          {
            v16 = PLSyndicationGetLog();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              uuid = [(PLManagedAsset *)self uuid];
              *buf = 138543618;
              v44 = uuid;
              v45 = 2112;
              v46 = v11;
              v25 = v16;
              v26 = OS_LOG_TYPE_INFO;
              v27 = "Skipping purge of syndication asset %{public}@ resource that is already not locally available %@";
              goto LABEL_22;
            }
          }
        }

        else
        {
          v16 = PLSyndicationGetLog();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            uuid = [(PLManagedAsset *)self uuid];
            *buf = 138543618;
            v44 = uuid;
            v45 = 2112;
            v46 = v11;
            v25 = v16;
            v26 = OS_LOG_TYPE_ERROR;
            v27 = "Skipping non-syndication resource found during asset %{public}@ purgeSyndicationResources %@";
LABEL_22:
            _os_log_impl(&dword_19BF1F000, v25, v26, v27, buf, 0x16u);
          }
        }

LABEL_23:

LABEL_24:
        ++v10;
      }

      while (v8 != v10);
      v32 = [modernResources countByEnumeratingWithState:&v39 objects:v47 count:16];
      v8 = v32;
    }

    while (v32);
  }
}

- (BOOL)fullAnalysisComplete
{
  mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
  mediaAnalysisVersion = [mediaAnalysisAttributes mediaAnalysisVersion];
  v4 = +[PLMediaAnalysisServiceRequestAdapter currentMediaAnalysisVersion];
  LOBYTE(mediaAnalysisVersion) = mediaAnalysisVersion == [v4 intValue];

  return mediaAnalysisVersion;
}

- (BOOL)_tuAnalysisComplete
{
  mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
  textUnderstandingVersion = [mediaAnalysisAttributes textUnderstandingVersion];
  v4 = +[PLMediaAnalysisServiceRequestAdapter currentTUAlgorithmVersion];
  LOBYTE(textUnderstandingVersion) = [v4 intValue] == textUnderstandingVersion;

  return textUnderstandingVersion;
}

- (BOOL)isReadyForPurgeSyndicationResources
{
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryServicesManager = [photoLibrary libraryServicesManager];

  v5 = [libraryServicesManager wellKnownPhotoLibraryIdentifier] == 3 && -[PLManagedAsset faceDetectionComplete](self, "faceDetectionComplete") && -[PLManagedAsset _tuAnalysisComplete](self, "_tuAnalysisComplete") && -[PLManagedAsset fullAnalysisComplete](self, "fullAnalysisComplete");
  return v5;
}

- (BOOL)shouldPurgeSyndicationResourcesWithChangedValues:(id)values
{
  v4 = [values objectForKeyedSubscript:@"faceAdjustmentVersion"];

  if (!v4)
  {
    return 0;
  }

  return [(PLManagedAsset *)self isReadyForPurgeSyndicationResources];
}

- (void)setConversationAlbumWithConversationID:(id)d
{
  v36 = *MEMORY[0x1E69E9840];
  dCopy = d;
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  if (dCopy)
  {
    conversation = [(PLManagedAsset *)self conversation];
    importSessionID = [conversation importSessionID];
    v8 = [importSessionID isEqualToString:dCopy];

    if (v8)
    {
      goto LABEL_27;
    }

    userInfo = [managedObjectContext userInfo];
    dictionary = [userInfo objectForKeyedSubscript:@"conversationObjectIDCache"];

    if (!dictionary)
    {
      dictionary = [MEMORY[0x1E695DF90] dictionary];
      userInfo2 = [managedObjectContext userInfo];
      [userInfo2 setObject:dictionary forKeyedSubscript:@"conversationObjectIDCache"];
    }

    v12 = [dictionary objectForKeyedSubscript:dCopy];
    if (v12 && ([managedObjectContext objectRegisteredForID:v12], (v13 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v14 = v13;
    }

    else
    {
      photoLibrary = [(PLManagedObject *)self photoLibrary];
      v14 = [PLConversation albumWithConversationID:dCopy inLibrary:photoLibrary];

      if (!v14)
      {
        v14 = [PLConversation insertNewConversationAlbumWithConversationID:dCopy inManagedObjectContext:managedObjectContext];
        v17 = PLSyndicationGetLog();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          [v14 uuid];
          v19 = v18 = v12;
          uuid = [(PLManagedAsset *)self uuid];
          *buf = 138543618;
          v31 = v19;
          v32 = 2112;
          v33 = uuid;
          v21 = "Created conversationAlbum (%{public}@) for asset uuid %@";
          goto LABEL_15;
        }

LABEL_16:

        if (conversation)
        {
          v22 = PLSyndicationGetLog();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            [conversation uuid];
            v23 = v29 = v12;
            uuid2 = [v14 uuid];
            uuid3 = [(PLManagedAsset *)self uuid];
            *buf = 138543874;
            v31 = v23;
            v32 = 2114;
            v33 = uuid2;
            v34 = 2112;
            v35 = uuid3;
            _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Changed conversationAlbum (%{public}@) to (%{public}@) for asset uuid %@", buf, 0x20u);

            v12 = v29;
          }
        }

        [(PLManagedAsset *)self setConversation:v14];
        [v14 updateConversationDatesFromAddedAsset:self];
        objectID = [v14 objectID];
        [dictionary setObject:objectID forKeyedSubscript:dCopy];

        syndicationState = [(PLManagedAsset *)self syndicationState];
        syndicate = [v14 syndicate];
        if (syndicate == 1)
        {
          syndicationState &= ~4u;
        }

        else if (!syndicate)
        {
          syndicationState |= 4u;
        }

        if ([(PLManagedAsset *)self syndicationState]!= syndicationState)
        {
          [(PLManagedAsset *)self setSyndicationState:syndicationState];
        }

        goto LABEL_27;
      }
    }

    v17 = PLSyndicationGetLog();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      [v14 uuid];
      v19 = v18 = v12;
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138543618;
      v31 = v19;
      v32 = 2112;
      v33 = uuid;
      v21 = "Found conversationAlbum (%{public}@) for asset uuid %@";
LABEL_15:
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_INFO, v21, buf, 0x16u);

      v12 = v18;
      goto LABEL_16;
    }

    goto LABEL_16;
  }

  conversation = PLSyndicationGetLog();
  if (os_log_type_enabled(conversation, OS_LOG_TYPE_ERROR))
  {
    uuid4 = [(PLManagedAsset *)self uuid];
    *buf = 138412290;
    v31 = uuid4;
    _os_log_impl(&dword_19BF1F000, conversation, OS_LOG_TYPE_ERROR, "Unable to create conversationAlbum with nil conversationID for asset uuid %@", buf, 0xCu);
  }

LABEL_27:
}

- (void)_updateIMCoreSyndicationForIdentifier:(id)identifier hide:(BOOL)hide
{
  identifierCopy = identifier;
  if (_updateIMCoreSyndicationForIdentifier_hide__onceToken != -1)
  {
    dispatch_once(&_updateIMCoreSyndicationForIdentifier_hide__onceToken, &__block_literal_global_173_104044);
  }

  v6 = _updateIMCoreSyndicationForIdentifier_hide__queue;
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __74__PLManagedAsset_Syndication___updateIMCoreSyndicationForIdentifier_hide___block_invoke_2;
  v8[3] = &unk_1E7576F80;
  hideCopy = hide;
  v9 = identifierCopy;
  v7 = identifierCopy;
  dispatch_async(v6, v8);
}

void __74__PLManagedAsset_Syndication___updateIMCoreSyndicationForIdentifier_hide___block_invoke_2(uint64_t a1)
{
  v14 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 40);
  v3 = PLSyndicationGetLog();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_INFO);
  if (v2 != 1)
  {
    if (v4)
    {
      v10 = *(a1 + 32);
      *buf = 138543362;
      v13 = v10;
      _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "calling IMCore to un-hide %{public}@ from syndication", buf, 0xCu);
    }

    if (IMCoreLibraryCore() && getIMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc())
    {
      v6 = *(a1 + 32);
      IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc = getIMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc();
      if (!IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc)
      {
        v8 = [MEMORY[0x1E696AAA8] currentHandler];
        v9 = [MEMORY[0x1E696AEC0] stringWithUTF8String:"void softlink_IMSPIUnhideSyndicationForAttachmentGUID(NSString *__strong)"];
        [v8 handleFailureInFunction:v9 file:@"PLManagedAsset+Syndication.m" lineNumber:73 description:{@"%s", dlerror()}];
LABEL_21:

        __break(1u);
      }

      goto LABEL_13;
    }

    v6 = PLSyndicationGetLog();
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_19;
    }

    *buf = 0;
    v11 = "IMCore SPI for un-hiding attachment is not available";
LABEL_18:
    _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_INFO, v11, buf, 2u);
    goto LABEL_19;
  }

  if (v4)
  {
    v5 = *(a1 + 32);
    *buf = 138543362;
    v13 = v5;
    _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "rejectSyndicatedAsset: calling IMCore to remove %{public}@ from syndication", buf, 0xCu);
  }

  if (!IMCoreLibraryCore() || !getIMSPIRemoveAttachmentGUIDFromSyndicationSymbolLoc())
  {
    v6 = PLSyndicationGetLog();
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_19;
    }

    *buf = 0;
    v11 = "IMCore SPI for removing attachment is not available";
    goto LABEL_18;
  }

  v6 = *(a1 + 32);
  IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc = getIMSPIRemoveAttachmentGUIDFromSyndicationSymbolLoc();
  if (!IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc)
  {
    v8 = [MEMORY[0x1E696AAA8] currentHandler];
    v9 = [MEMORY[0x1E696AEC0] stringWithUTF8String:"void softlink_IMSPIRemoveAttachmentGUIDFromSyndication(NSString *__strong)"];
    [v8 handleFailureInFunction:v9 file:@"PLManagedAsset+Syndication.m" lineNumber:72 description:{@"%s", dlerror()}];
    goto LABEL_21;
  }

LABEL_13:
  IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc(v6);
LABEL_19:
}

void __74__PLManagedAsset_Syndication___updateIMCoreSyndicationForIdentifier_hide___block_invoke()
{
  v0 = dispatch_queue_create("updateIMCoreSyndicationForIdentifier", 0);
  v1 = _updateIMCoreSyndicationForIdentifier_hide__queue;
  _updateIMCoreSyndicationForIdentifier_hide__queue = v0;
}

- (void)_updateSyndicationState:(unsigned __int16)state enabled:(BOOL)enabled logPrefix:(id)prefix
{
  enabledCopy = enabled;
  stateCopy = state;
  v29 = *MEMORY[0x1E69E9840];
  prefixCopy = prefix;
  syndicationState = [(PLManagedAsset *)self syndicationState];
  if (enabledCopy)
  {
    v10 = syndicationState | stateCopy;
  }

  else
  {
    v10 = syndicationState & ~stateCopy;
  }

  v11 = PLSyndicationGetLog();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v10 == syndicationState)
  {
    if (v12)
    {
      uuid = [(PLManagedAsset *)self uuid];
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      syndicationIdentifier = [additionalAttributes syndicationIdentifier];
      v16 = PLManagedAssetSyndicationStateDescription(syndicationState);
      v21 = 138544130;
      v22 = prefixCopy;
      v23 = 2114;
      v24 = uuid;
      v25 = 2114;
      v26 = syndicationIdentifier;
      v27 = 2114;
      v28 = v16;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "%{public}@ %{public}@ / %{public}@ syndicationState unchanged %{public}@", &v21, 0x2Au);
    }
  }

  else
  {
    if (v12)
    {
      uuid2 = [(PLManagedAsset *)self uuid];
      additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
      syndicationIdentifier2 = [additionalAttributes2 syndicationIdentifier];
      v20 = PLManagedAssetSyndicationStateDescription(v10);
      v21 = 138544130;
      v22 = prefixCopy;
      v23 = 2114;
      v24 = uuid2;
      v25 = 2114;
      v26 = syndicationIdentifier2;
      v27 = 2114;
      v28 = v20;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "%{public}@ %{public}@ / %{public}@ set syndicationState to %{public}@", &v21, 0x2Au);
    }

    [(PLManagedAsset *)self setSyndicationState:v10];
  }
}

- (void)unsaveSyndicatedAsset
{
  v3 = NSStringFromSelector(a2);
  [(PLManagedAsset *)self _updateSyndicationState:10 enabled:0 logPrefix:v3];

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationIdentifier = [additionalAttributes syndicationIdentifier];

  [(PLManagedAsset *)self _updateIMCoreSyndicationForIdentifier:syndicationIdentifier hide:0];
}

- (void)restoreSyndicatedAsset
{
  v3 = NSStringFromSelector(a2);
  [(PLManagedAsset *)self _updateSyndicationState:8 enabled:0 logPrefix:v3];

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationIdentifier = [additionalAttributes syndicationIdentifier];

  [(PLManagedAsset *)self _updateIMCoreSyndicationForIdentifier:syndicationIdentifier hide:0];
}

- (void)rejectSyndicatedAsset
{
  v26 = *MEMORY[0x1E69E9840];
  v3 = NSStringFromSelector(a2);
  [(PLManagedAsset *)self _updateSyndicationState:8 enabled:1 logPrefix:v3];

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationIdentifier = [additionalAttributes syndicationIdentifier];

  v6 = PLSyndicationGetLog();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    uuid = [(PLManagedAsset *)self uuid];
    *buf = 136315650;
    v21 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]";
    v22 = 2114;
    v23 = uuid;
    v24 = 2114;
    v25 = syndicationIdentifier;
    _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_INFO, "%s %{public}@ / %{public}@", buf, 0x20u);
  }

  [(PLManagedAsset *)self _updateIMCoreSyndicationForIdentifier:syndicationIdentifier hide:1];
  v18 = 0;
  v8 = [PLLibraryServicesManager runningLibraryServicesManagerForWellKnownPhotoLibraryIdentifier:1 error:&v18];
  v9 = v18;
  v10 = PLSyndicationGetLog();
  v11 = v10;
  if (v8)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      importedByBundleIdentifier = [(PLManagedAsset *)self importedByBundleIdentifier];
      *buf = 136315650;
      v21 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]";
      v22 = 2114;
      v23 = syndicationIdentifier;
      v24 = 2114;
      v25 = importedByBundleIdentifier;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "%s calling SPL syndicationDeleteManager to delete %{public}@ for bundleID %{public}@", buf, 0x20u);
    }

    syndicationDeleteManager = [v8 syndicationDeleteManager];
    importedByBundleIdentifier2 = [(PLManagedAsset *)self importedByBundleIdentifier];
    v19 = syndicationIdentifier;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v19 count:1];
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __52__PLManagedAsset_Syndication__rejectSyndicatedAsset__block_invoke;
    v16[3] = &unk_1E75781E8;
    v17 = syndicationIdentifier;
    [syndicationDeleteManager processDeletesForBundleID:importedByBundleIdentifier2 identifiers:v15 completion:v16];

    v11 = v17;
  }

  else if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
  {
    *buf = 136315650;
    v21 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]";
    v22 = 2114;
    v23 = syndicationIdentifier;
    v24 = 2112;
    v25 = v9;
    _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "%s failed attempting to delete %{public}@ from SPL, error %@", buf, 0x20u);
  }
}

void __52__PLManagedAsset_Syndication__rejectSyndicatedAsset__block_invoke(uint64_t a1)
{
  v8 = *MEMORY[0x1E69E9840];
  v2 = PLSyndicationGetLog();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    v3 = *(a1 + 32);
    v4 = 136315394;
    v5 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]_block_invoke";
    v6 = 2114;
    v7 = v3;
    _os_log_impl(&dword_19BF1F000, v2, OS_LOG_TYPE_INFO, "%s done deleting %{public}@ from SPL", &v4, 0x16u);
  }
}

- (void)_updateDestinationAssetCopyStateOnCMMAsset
{
  v27[2] = *MEMORY[0x1E69E9840];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationIdentifier = [additionalAttributes syndicationIdentifier];

  photoLibrary = [(PLManagedObject *)self photoLibrary];
  v6 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForMomentSharedAsset"), 1}];
  v7 = MEMORY[0x1E696AB28];
  v26 = syndicationIdentifier;
  v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v26 count:1];
  v9 = [PLManagedAsset predicateForSyndicatedAssetIdentifiers:v8 includeRejected:1];
  v27[0] = v9;
  v27[1] = v6;
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v27 count:2];
  v11 = [v7 andPredicateWithSubpredicates:v10];

  v12 = MEMORY[0x1E695D5E0];
  v13 = +[PLManagedAsset entityName];
  v14 = [v12 fetchRequestWithEntityName:v13];

  [v14 setPredicate:v11];
  [v14 setFetchLimit:1];
  managedObjectContext = [photoLibrary managedObjectContext];
  v21 = 0;
  v16 = [managedObjectContext executeFetchRequest:v14 error:&v21];
  v17 = v21;

  if (v16)
  {
    firstObject = [v16 firstObject];
    v19 = firstObject;
    if (firstObject)
    {
      additionalAttributes2 = [firstObject additionalAttributes];
      [additionalAttributes2 setDestinationAssetCopyState:2];
    }
  }

  else
  {
    v19 = PLSyndicationGetLog();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543618;
      v23 = syndicationIdentifier;
      v24 = 2112;
      v25 = v17;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Fetching syndication CMM asset for %{public}@ failed: %@", buf, 0x16u);
    }
  }
}

- (void)updateSyndicationStateWithSavedToLibrary:(BOOL)library
{
  libraryCopy = library;
  v24 = *MEMORY[0x1E69E9840];
  syndicationState = [(PLManagedAsset *)self syndicationState];
  v6 = syndicationState & 0xFFFFFFFD;
  if (libraryCopy)
  {
    v7 = 2;
  }

  else
  {
    v7 = 0;
  }

  v8 = v6 | v7;
  if ((v6 | v7) != syndicationState)
  {
    v9 = syndicationState;
    v10 = PLSyndicationGetLog();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      uuid = [(PLManagedAsset *)self uuid];
      additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
      syndicationIdentifier = [additionalAttributes syndicationIdentifier];
      v14 = PLManagedAssetSyndicationStateDescription(v9);
      v15 = PLManagedAssetSyndicationStateDescription(v8);
      v16 = 138544130;
      v17 = uuid;
      v18 = 2114;
      v19 = syndicationIdentifier;
      v20 = 2114;
      v21 = v14;
      v22 = 2114;
      v23 = v15;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_INFO, "Updating syndication state on asset %{public}@ / %{public}@ from %{public}@ to %{public}@", &v16, 0x2Au);
    }

    [(PLManagedAsset *)self setSyndicationState:v8];
  }
}

- (void)updateSyndicationStateWithSyndicationProcessingValue:(unsigned __int16)value
{
  if ((value & 0x1000) != 0)
  {
    [(PLManagedAsset *)self updateSyndicationStateWithSavedToLibrary:1];
  }
}

- (void)updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:(BOOL)library
{
  v5 = objc_opt_class();
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationIdentifier = [additionalAttributes syndicationIdentifier];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __91__PLManagedAsset_Syndication__updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary___block_invoke;
  v8[3] = &__block_descriptor_33_e24_v16__0__PLManagedAsset_8l;
  libraryCopy = library;
  [v5 performTransactionOnSyndicationLibraryWithSyndicationIdentifier:syndicationIdentifier block:v8];
}

- (BOOL)shouldSyncToSPL
{
  v3 = objc_opt_class();
  savedAssetType = [(PLManagedAsset *)self savedAssetType];
  syndicationState = [(PLManagedAsset *)self syndicationState];

  return [v3 shouldSyncAssetToSPLWithSavedAssetType:savedAssetType syndicationState:syndicationState];
}

- (void)_preserveRelationshipsOfDeletedGuestAsset:(id)asset
{
  assetCopy = asset;
  entity = [assetCopy entity];
  relationshipsByName = [entity relationshipsByName];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __73__PLManagedAsset_Syndication___preserveRelationshipsOfDeletedGuestAsset___block_invoke;
  v8[3] = &unk_1E75754F0;
  v9 = assetCopy;
  selfCopy = self;
  v7 = assetCopy;
  [relationshipsByName enumerateKeysAndObjectsUsingBlock:v8];
}

void __73__PLManagedAsset_Syndication___preserveRelationshipsOfDeletedGuestAsset___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (([v5 hasPrefix:@"memoriesBeing"] & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"suggestionsBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"dayGroupHighlightBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"highlightBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"monthHighlightBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"yearHighlightBeing") & 1) != 0 || objc_msgSend(v5, "isEqualToString:", @"moment"))
  {
    v7 = [v6 isToMany];
    v8 = *(a1 + 32);
    v9 = [v6 name];
    v10 = [v8 valueForKey:v9];

    if (v7)
    {
      if ([v10 count])
      {
        v11 = [v10 copy];
        v12 = PLSyndicationGetLog();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = [v6 name];
          v14 = [*(a1 + 32) uuid];
          v15 = [*(a1 + 40) uuid];
          v25 = 138543874;
          v26 = v13;
          v27 = 2114;
          v28 = v14;
          v29 = 2114;
          v30 = v15;
          _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_INFO, "Preserve relationships: copying %{public}@ from %{public}@ to %{public}@", &v25, 0x20u);
        }

        v16 = *(a1 + 40);
        v17 = [v6 name];
        [v16 setValue:v11 forKey:v17];

        goto LABEL_21;
      }

      v11 = PLSyndicationGetLog();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        goto LABEL_20;
      }
    }

    else
    {
      v11 = PLSyndicationGetLog();
      v18 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
      if (v10)
      {
        if (v18)
        {
          v19 = [v6 name];
          v20 = [*(a1 + 32) uuid];
          v21 = [*(a1 + 40) uuid];
          v25 = 138543874;
          v26 = v19;
          v27 = 2114;
          v28 = v20;
          v29 = 2114;
          v30 = v21;
          _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "Preserve relationships: setting %{public}@ from %{public}@ to %{public}@", &v25, 0x20u);
        }

        v22 = *(a1 + 40);
        v11 = [v6 name];
        [v22 setValue:v10 forKey:v11];
        goto LABEL_21;
      }

      if (v18)
      {
LABEL_20:
        v23 = [*(a1 + 32) uuid];
        v24 = [v6 name];
        v25 = 138543618;
        v26 = v23;
        v27 = 2114;
        v28 = v24;
        _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "Preserve relationships: guest asset %{public}@ has no %{public}@", &v25, 0x16u);
      }
    }

LABEL_21:
  }
}

- (void)syndicatedAssetDidSaveToUserLibrary
{
  v49 = *MEMORY[0x1E69E9840];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryServicesManager = [photoLibrary libraryServicesManager];
  isSystemPhotoLibrary = [libraryServicesManager isSystemPhotoLibrary];

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationIdentifier = [additionalAttributes syndicationIdentifier];

  v8 = PLSyndicationGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    [(PLManagedAsset *)self uuid];
    v10 = v9 = photoLibrary;
    v11 = @"other";
    *buf = 138543874;
    v44 = v10;
    v45 = 2114;
    if (isSystemPhotoLibrary)
    {
      v11 = @"SPL";
    }

    v46 = syndicationIdentifier;
    v47 = 2114;
    v48 = v11;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Syndicated asset %{public}@ / %{public}@ did save to user library (%{public}@)", buf, 0x20u);

    photoLibrary = v9;
  }

  v38 = isSystemPhotoLibrary;

  v12 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForGuestAsset"), 1}];
  v13 = MEMORY[0x1E696AB28];
  v39 = syndicationIdentifier;
  v41 = syndicationIdentifier;
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v41 count:1];
  v15 = [PLManagedAsset predicateForSyndicatedAssetIdentifiers:v14 includeRejected:1];
  v42[0] = v15;
  v42[1] = v12;
  v37 = v12;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v42 count:2];
  v17 = [v13 andPredicateWithSubpredicates:v16];

  v18 = MEMORY[0x1E695D5E0];
  v19 = +[PLManagedAsset entityName];
  v20 = [v18 fetchRequestWithEntityName:v19];

  [v20 setPredicate:v17];
  [v20 setFetchLimit:1];
  managedObjectContext = [photoLibrary managedObjectContext];
  v40 = 0;
  v22 = [managedObjectContext executeFetchRequest:v20 error:&v40];
  v23 = v40;

  firstObject = [v22 firstObject];
  if (firstObject)
  {
    v25 = PLSyndicationGetLog();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      uuid = [firstObject uuid];
      additionalAttributes2 = [firstObject additionalAttributes];
      [additionalAttributes2 syndicationIdentifier];
      v36 = v17;
      v28 = v23;
      v30 = v29 = photoLibrary;
      *buf = 138543618;
      v44 = uuid;
      v45 = 2114;
      v46 = v30;
      _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_INFO, "Found existing guest asset %{public}@ with syndication identifier %{public}@", buf, 0x16u);

      photoLibrary = v29;
      v23 = v28;
      v17 = v36;
    }

    [(PLManagedAsset *)self _preserveRelationshipsOfDeletedGuestAsset:firstObject];
    v31 = MEMORY[0x1E696AEC0];
    uuid2 = [firstObject uuid];
    uuid3 = [(PLManagedAsset *)self uuid];
    v34 = [v31 stringWithFormat:@"Deleting guest asset (uuid: %@) because we just ingested it as a full asset (uuid: %@)", uuid2, uuid3];

    v35 = [PLAssetTransactionReason transactionReason:v34];
    [firstObject deleteWithReason:v35];

    [(PLManagedAsset *)self setWasGuestAsset:1];
  }

  else
  {
    [(PLManagedAsset *)self setWasGuestAsset:0];
  }

  if (v38)
  {
    [(PLManagedAsset *)self updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:1];
  }

  [(PLManagedAsset *)self _updateDestinationAssetCopyStateOnCMMAsset];
}

- (BOOL)eligibleForGuestAssetPromotion
{
  [(PLManagedAsset *)self curationScore];
  if (v3 < 0.5)
  {
    return 0;
  }

  mediaAnalysisAttributes = [(PLManagedAsset *)self mediaAnalysisAttributes];
  v4 = ([mediaAnalysisAttributes syndicationProcessingValue] & 0x7EF0) != 0;

  return v4;
}

- (BOOL)resetGuestAssetPromotion:(id *)promotion
{
  v25 = *MEMORY[0x1E69E9840];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryBundle = [photoLibrary libraryBundle];
  libraryServicesManager = [libraryBundle libraryServicesManager];
  wellKnownPhotoLibraryIdentifier = [libraryServicesManager wellKnownPhotoLibraryIdentifier];

  [MEMORY[0x1E69BF328] maskForAllowedToResetGuestAssetPromotion];
  [(PLManagedAsset *)self savedAssetType];
  v9 = PLValidatedSavedAssetTypeApplies();
  if (wellKnownPhotoLibraryIdentifier == 3)
  {
    v10 = v9;
  }

  else
  {
    v10 = 0;
  }

  v11 = PLSyndicationGetLog();
  v12 = v11;
  if (v10)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      uuid = [(PLManagedAsset *)self uuid];
      v19 = 138543362;
      v20 = uuid;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_INFO, "resetting guest asset promotion for asset %{public}@", &v19, 0xCu);
    }

    -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForInsertIntoSyndicationLibrary]);
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      uuid2 = [(PLManagedAsset *)self uuid];
      [(PLManagedAsset *)self savedAssetType];
      v15 = PLValidatedSavedAssetTypeDescription();
      v16 = PLStringFromWellKnownPhotoLibraryIdentifier();
      v19 = 138543874;
      v20 = uuid2;
      v21 = 2114;
      v22 = v15;
      v23 = 2114;
      v24 = v16;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "reset guest asset promotion is forbidden for asset %{public}@ %{public}@ in %{public}@", &v19, 0x20u);
    }

    v17 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:41005 userInfo:0];
    if (promotion)
    {
      v17 = v17;
      *promotion = v17;
    }
  }

  return v10;
}

- (BOOL)promoteToGuestAsset:(id *)asset
{
  v27 = *MEMORY[0x1E69E9840];
  if (([(PLManagedAsset *)self syndicationState]& 1) != 0)
  {
    v10 = PLSyndicationGetLog();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      uuid = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      v24 = uuid;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "promotion to guest asset %{public}@ is forbidden for self shared asset", buf, 0xCu);
    }

    v12 = MEMORY[0x1E696ABC0];
    v13 = *MEMORY[0x1E69BFF48];
    v21 = *MEMORY[0x1E696A278];
    v14 = MEMORY[0x1E696AEC0];
    uuidDescription = [(PLManagedAsset *)self uuidDescription];
    v16 = [v14 stringWithFormat:@"self-shared asset %@ cannot be promoted to guest", uuidDescription];
    v22 = v16;
    v17 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v22 forKeys:&v21 count:1];
    v18 = [v12 errorWithDomain:v13 code:41005 userInfo:v17];
    if (asset)
    {
      v18 = v18;
      *asset = v18;
    }

    return 0;
  }

  [MEMORY[0x1E69BF328] maskForAllowedToPromoteToGuestAsset];
  [(PLManagedAsset *)self savedAssetType];
  v5 = PLValidatedSavedAssetTypeApplies();
  v6 = PLSyndicationGetLog();
  v7 = v6;
  if (!v5)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      uuid2 = [(PLManagedAsset *)self uuid];
      *buf = 138543618;
      v24 = uuid2;
      v25 = 1024;
      savedAssetType = [(PLManagedAsset *)self savedAssetType];
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "promotion to guest asset %{public}@ is forbidden for savedAssetType %hd", buf, 0x12u);
    }

    v20 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:41005 userInfo:0];
    if (asset)
    {
      v20 = v20;
      *asset = v20;
    }

    return 0;
  }

  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    uuid3 = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    v24 = uuid3;
    _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_INFO, "promoting asset %{public}@ to guest", buf, 0xCu);
  }

  -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForPromoteToGuestAsset]);
  return 1;
}

- (BOOL)syndicationOriginalResourcesAreLocal
{
  syndicationOriginalResource = [(PLManagedAsset *)self syndicationOriginalResource];
  v4 = syndicationOriginalResource;
  if (syndicationOriginalResource)
  {
    resourceType = [syndicationOriginalResource resourceType];
    version = [v4 version];
    recipeID = [v4 recipeID];
    uniformTypeIdentifier = [v4 uniformTypeIdentifier];
    identifier = [uniformTypeIdentifier identifier];
    v10 = [(PLManagedAsset *)self syndicationResourceURLForResourceType:resourceType version:version recipeID:recipeID utiString:identifier error:0];

    v14 = 0;
    if (v10)
    {
      defaultManager = [MEMORY[0x1E696AC08] defaultManager];
      path = [v10 path];
      v13 = [defaultManager fileExistsAtPath:path];

      if (v13)
      {
        v14 = 1;
      }
    }
  }

  else
  {
    v14 = 0;
  }

  if ([(PLManagedAsset *)self isPhotoIris])
  {
    v15 = 0;
    if (!v14)
    {
      return v14;
    }
  }

  else
  {
    filename = [(PLManagedAsset *)self filename];
    v15 = filename != 0;

    if (!v14)
    {
      return v14;
    }
  }

  if (!v15)
  {
    syndicationOriginalVideoComplementResource = [(PLManagedAsset *)self syndicationOriginalVideoComplementResource];
    v18 = syndicationOriginalVideoComplementResource;
    if (syndicationOriginalVideoComplementResource)
    {
      resourceType2 = [syndicationOriginalVideoComplementResource resourceType];
      version2 = [v18 version];
      recipeID2 = [v18 recipeID];
      uniformTypeIdentifier2 = [v18 uniformTypeIdentifier];
      identifier2 = [uniformTypeIdentifier2 identifier];
      v24 = [(PLManagedAsset *)self syndicationResourceURLForResourceType:resourceType2 version:version2 recipeID:recipeID2 utiString:identifier2 error:0];

      if (!v24 || ([MEMORY[0x1E696AC08] defaultManager], v25 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v24, "path"), v26 = objc_claimAutoreleasedReturnValue(), v27 = objc_msgSend(v25, "fileExistsAtPath:", v26), v26, v25, (v27 & 1) == 0))
      {
        LOBYTE(v14) = 0;
      }
    }

    else
    {
      LOBYTE(v14) = 0;
    }
  }

  return v14;
}

BOOL __73__PLManagedAsset_Syndication__syndicationOriginalVideoComplementResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 resourceType] == 3 && !objc_msgSend(v2, "version") && (objc_msgSend(v2, "recipeID") & 1) == 0;

  return v3;
}

- (id)syndicationOriginalResource
{
  v18 = *MEMORY[0x1E69E9840];
  kind = [(PLManagedAsset *)self kind];
  if (kind >= 3)
  {
    v4 = 31;
  }

  else
  {
    v4 = kind;
  }

  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __58__PLManagedAsset_Syndication__syndicationOriginalResource__block_invoke;
  v12[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  v13 = v4;
  v5 = [(PLManagedAsset *)self firstPersistedResourceMatching:v12];
  if (!v5)
  {
    v5 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_104115];
    if (v5)
    {
      v6 = PLSyndicationGetLog();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_FAULT))
      {
        syndicationDescription = [(PLManagedAsset *)self syndicationDescription];
        resourceType = [v5 resourceType];
        if (resourceType > 0x1F)
        {
          v9 = @"invalid";
        }

        else
        {
          v9 = off_1E75663B0[resourceType];
        }

        v10 = v9;
        *buf = 138543618;
        v15 = syndicationDescription;
        v16 = 2114;
        v17 = v10;
        _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_FAULT, "Syndication asset (%{public}@) has possibly inconsistent original resource with type: %{public}@", buf, 0x16u);
      }
    }
  }

  return v5;
}

BOOL __58__PLManagedAsset_Syndication__syndicationOriginalResource__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v5 = v3;
  v6 = [v5 resourceType] == v4 && !objc_msgSend(v5, "version") && (objc_msgSend(v5, "recipeID") & 1) == 0;

  return v6;
}

- (id)syndicationResourceURLForResourceType:(unsigned int)type version:(unsigned int)version recipeID:(unsigned int)d utiString:(id)string error:(id *)error
{
  v8 = *&d;
  v9 = *&version;
  v10 = *&type;
  v31[1] = *MEMORY[0x1E69E9840];
  stringCopy = string;
  v13 = MEMORY[0x1E69BF298];
  uuid = [(PLManagedAsset *)self uuid];
  originalFilename = [(PLManagedAsset *)self originalFilename];
  LODWORD(v13) = [v13 isValidFileIdentifierParametersForUUID:uuid utiString:stringCopy originalFilename:originalFilename];

  if (v13)
  {
    pathManager = [(PLManagedObject *)self pathManager];
    v17 = [(PLManagedAsset *)self syndicationFileIdentifierForResourceType:v10 version:v9 recipeID:v8 utiString:stringCopy];
    v18 = [pathManager readOnlyUrlWithIdentifier:v17];

    if (v18)
    {
      goto LABEL_8;
    }

    v19 = MEMORY[0x1E696ABC0];
    v20 = *MEMORY[0x1E69BFF48];
    v30 = *MEMORY[0x1E696A578];
    v31[0] = @"Failed to create url from identifier";
    v21 = MEMORY[0x1E695DF20];
    v22 = v31;
    v23 = &v30;
  }

  else
  {
    v19 = MEMORY[0x1E696ABC0];
    v20 = *MEMORY[0x1E69BFF48];
    v28 = *MEMORY[0x1E696A578];
    v29 = @"Invalid file identifier parameters";
    v21 = MEMORY[0x1E695DF20];
    v22 = &v29;
    v23 = &v28;
  }

  v24 = [v21 dictionaryWithObjects:v22 forKeys:v23 count:1];
  v25 = [v19 errorWithDomain:v20 code:46801 userInfo:v24];

  if (error)
  {
    v26 = v25;
    *error = v25;
  }

  v18 = 0;
LABEL_8:

  return v18;
}

- (id)syndicationFileIdentifierForResourceType:(unsigned int)type version:(unsigned int)version recipeID:(unsigned int)d utiString:(id)string
{
  v6 = *&d;
  v7 = *&version;
  v8 = *&type;
  stringCopy = string;
  if (v8 == 16)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:531 description:{@"Invalid parameter not satisfying: %@", @"resourceType != PLResourceTypeContextualVideoThumbnail"}];
  }

  v12 = objc_alloc(MEMORY[0x1E69BF298]);
  uuid = [(PLManagedAsset *)self uuid];
  originalFilename = [(PLManagedAsset *)self originalFilename];
  v15 = [v12 initWithAssetUuid:uuid bundleScope:3 uti:stringCopy resourceVersion:v7 resourceType:v8 recipeID:v6 originalFilename:originalFilename customSuffix:0];

  return v15;
}

- (id)syndicationDescription
{
  v3 = +[PLDescriptionBuilder plainDescriptionBuilder];
  uuid = [(PLManagedAsset *)self uuid];
  [v3 appendName:@"uuid" object:uuid];

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  syndicationIdentifier = [additionalAttributes syndicationIdentifier];
  [v3 appendName:@"syndicationIdentifier" object:syndicationIdentifier];

  [v3 appendName:@"kind" unsignedIntegerValue:{-[PLManagedAsset kind](self, "kind")}];
  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];
  [v3 appendName:@"uti" object:uniformTypeIdentifier];

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  importedByBundleIdentifier = [additionalAttributes2 importedByBundleIdentifier];
  [v3 appendName:@"importedBy" object:importedByBundleIdentifier];

  syndicationResourcesDescription = [(PLManagedAsset *)self syndicationResourcesDescription];
  [v3 appendName:@"resources" object:syndicationResourcesDescription];

  build = [v3 build];

  return build;
}

- (id)syndicationResourcesDescription
{
  v23 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E696AD60]);
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  obj = [(PLManagedAsset *)self modernResources];
  v4 = [obj countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v19;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v19 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v18 + 1) + 8 * i);
        v9 = +[PLDescriptionBuilder plainDescriptionBuilder];
        resourceType = [v8 resourceType];
        v11 = @"invalid";
        if (resourceType <= 0x1F)
        {
          v11 = off_1E75663B0[resourceType];
        }

        v12 = v11;
        [v9 appendName:@"type" object:v12];

        dataStore = [v8 dataStore];
        v14 = [dataStore descriptionForSubtype:{objc_msgSend(v8, "dataStoreSubtype")}];
        [v9 appendName:@"dataStoreSubtype" object:v14];

        build = [v9 build];
        [v3 appendFormat:@"<%@>", build];
      }

      v5 = [obj countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v5);
  }

  return v3;
}

- (BOOL)becomeSyndicationLivePhotoWithVideoComplementContentType:(id)type
{
  v4 = [PLResourceInstaller onDemand_installOriginalVideoComplementForSyndicationAsset:self contentType:type];
  if (v4)
  {
    [(PLManagedAsset *)self setKindSubtype:2];
  }

  return v4 != 0;
}

- (void)setSyndicationFilenameAndDirectoryWithOriginalFilename:(id)filename
{
  filenameCopy = filename;
  if (!filenameCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:489 description:{@"Invalid parameter not satisfying: %@", @"originalFilename"}];
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setOriginalFilename:filenameCopy];

  uniformTypeIdentifier = [(PLManagedAsset *)self uniformTypeIdentifier];

  if (uniformTypeIdentifier)
  {
    uniformTypeIdentifier2 = [(PLManagedAsset *)self uniformTypeIdentifier];
    [(PLManagedAsset *)self setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:uniformTypeIdentifier2 originalFilename:filenameCopy];
  }
}

- (void)setSyndicationLivePhotoAttributesFromMainFileURL:(id)l mainFileMetadata:(id)metadata videoComplementFileURL:(id)rL videoComplementMetadata:(id)complementMetadata
{
  lCopy = l;
  metadataCopy = metadata;
  rLCopy = rL;
  complementMetadataCopy = complementMetadata;
  if (lCopy)
  {
    if (rLCopy)
    {
      goto LABEL_3;
    }
  }

  else
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:457 description:{@"Invalid parameter not satisfying: %@", @"fileURL"}];

    if (rLCopy)
    {
      goto LABEL_3;
    }
  }

  currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
  [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:458 description:{@"Invalid parameter not satisfying: %@", @"videoComplementFileURL"}];

LABEL_3:
  if (![complementMetadataCopy isSyndicationOriginated])
  {
    v17 = objc_alloc(MEMORY[0x1E69C0918]);
    path = [rLCopy path];
    path2 = [lCopy path];
    v16 = [v17 initWithPathToVideo:path pathToImage:path2];

    pairingIdentifier = [v16 pairingIdentifier];
    v21 = pairingIdentifier;
    v34 = 0uLL;
    v35 = 0;
    if (v16)
    {
      [v16 imageDisplayTime];
      v32 = 0uLL;
      v33 = 0;
      [v16 originalVideoDuration];
      if (!v21)
      {
        goto LABEL_19;
      }
    }

    else
    {
      v32 = 0uLL;
      v33 = 0;
      if (!pairingIdentifier)
      {
LABEL_19:

        goto LABEL_20;
      }
    }

    if (BYTE12(v32))
    {
      v30 = v32;
      v31 = v33;
      v28 = v34;
      v29 = v35;
      [(PLManagedAsset *)self becomePhotoIrisWithMediaGroupUUID:v21 mainFileMetadata:metadataCopy videoURL:rLCopy videoDuration:&v30 stillDisplayTime:&v28 options:0];
    }

    goto LABEL_19;
  }

  livePhotoPairingIdentifier = [complementMetadataCopy livePhotoPairingIdentifier];
  v16 = livePhotoPairingIdentifier;
  v34 = 0uLL;
  v35 = 0;
  if (complementMetadataCopy)
  {
    [complementMetadataCopy stillImageDisplayTime];
    v32 = 0uLL;
    v33 = 0;
    [complementMetadataCopy duration];
    if (!v16)
    {
      goto LABEL_20;
    }
  }

  else
  {
    v32 = 0uLL;
    v33 = 0;
    if (!livePhotoPairingIdentifier)
    {
      goto LABEL_20;
    }
  }

  if (BYTE12(v34) & 1) != 0 && (BYTE12(v32))
  {
    [(PLManagedAsset *)self setKindSubtype:2];
    v30 = v32;
    v31 = v33;
    v28 = v34;
    v29 = v35;
    [(PLManagedAsset *)self updatePhotoIrisMetadataWithMediaGroupUUID:v16 videoDuration:&v30 stillDisplayTime:&v28];
    if ([(PLManagedAsset *)self canPlayPhotoIris])
    {
      [(PLManagedAsset *)self setPlaybackStyle:3];
      [(PLManagedAsset *)self updatePlaybackVariationAndStyleFromOriginalMetadata:metadataCopy];
    }

    syndicationOriginalVideoComplementResource = [(PLManagedAsset *)self syndicationOriginalVideoComplementResource];
    [complementMetadataCopy exifPixelSize];
    [syndicationOriginalVideoComplementResource setUnorientedWidth:v23];
    [complementMetadataCopy exifPixelSize];
    [syndicationOriginalVideoComplementResource setUnorientedHeight:v24];
    firstVideoTrackCodecString = [complementMetadataCopy firstVideoTrackCodecString];
    [syndicationOriginalVideoComplementResource setCodecFourCharCodeName:firstVideoTrackCodecString];

    [syndicationOriginalVideoComplementResource setLocalAvailability:1];
    [syndicationOriginalVideoComplementResource setDataLength:{objc_msgSend(complementMetadataCopy, "fileSize")}];
  }

LABEL_20:
}

- (void)setSyndicationAttributesFromMainFileURL:(id)l metadata:(id)metadata
{
  v19 = *MEMORY[0x1E69E9840];
  metadataCopy = metadata;
  lCopy = l;
  [(PLManagedAsset *)self setDateCreated:0];
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalFilename = [additionalAttributes originalFilename];

  directory = [(PLManagedAsset *)self directory];
  filename = [(PLManagedAsset *)self filename];
  [(PLManagedAsset *)self setAttributesFromMainFileURL:lCopy mainFileMetadata:metadataCopy savedAssetType:[(PLManagedAsset *)self savedAssetType] bundleScope:3 isPlaceholder:0 placeholderFileURL:0 imageSource:0 imageData:0];

  additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes2 setOriginalFilename:originalFilename];

  [(PLManagedAsset *)self setDirectory:directory];
  [(PLManagedAsset *)self setFilename:filename];
  dateCreated = [(PLManagedAsset *)self dateCreated];

  if (!dateCreated)
  {
    addedDate = [(PLManagedAsset *)self addedDate];
    [(PLManagedAsset *)self setDateCreated:addedDate];

    v15 = PLSyndicationGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      addedDate2 = [(PLManagedAsset *)self addedDate];
      *buf = 138412290;
      v18 = addedDate2;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_INFO, "dateCreated is nil, falling back to addedDate %@", buf, 0xCu);
    }
  }

  [(PLManagedAsset *)self persistMetadataToFilesystem];
}

- (void)_updateModificationDateForSyndication
{
  v3 = [MEMORY[0x1E695DF00] now];
  [(PLManagedAsset *)self setModificationDate:v3];
}

- (void)_fixDistantPastContentCreationDateWithItem:(id)item
{
  v29 = *MEMORY[0x1E69E9840];
  attributeSet = [item attributeSet];
  contentCreationDate = [attributeSet contentCreationDate];

  if (contentCreationDate)
  {
    addedDate = [(PLManagedAsset *)self addedDate];
    v7 = [contentCreationDate isEqualToDate:addedDate];

    if ((v7 & 1) == 0)
    {
      v8 = PLSyndicationGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        uuid = [(PLManagedAsset *)self uuid];
        additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
        syndicationIdentifier = [additionalAttributes syndicationIdentifier];
        addedDate2 = [(PLManagedAsset *)self addedDate];
        v21 = 138544130;
        v22 = uuid;
        v23 = 2114;
        v24 = syndicationIdentifier;
        v25 = 2114;
        v26 = addedDate2;
        v27 = 2114;
        v28 = contentCreationDate;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "[sync] asset (%{public}@ / %{public}@) addedDate (%{public}@ does not match Spotlight content creation date: %{public}@, repairing date", &v21, 0x2Au);
      }

      [(PLManagedAsset *)self setAddedDate:contentCreationDate];
      dateCreated = [(PLManagedAsset *)self dateCreated];
      distantPast = [MEMORY[0x1E695DF00] distantPast];
      if ([dateCreated isEqualToDate:distantPast])
      {
        dateCreated2 = [(PLManagedAsset *)self dateCreated];
        v16 = [contentCreationDate isEqualToDate:dateCreated2];

        if ((v16 & 1) == 0)
        {
          v17 = PLSyndicationGetLog();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
          {
            uuid2 = [(PLManagedAsset *)self uuid];
            additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
            syndicationIdentifier2 = [additionalAttributes2 syndicationIdentifier];
            v21 = 138543618;
            v22 = uuid2;
            v23 = 2114;
            v24 = syndicationIdentifier2;
            _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "[sync] asset (%{public}@ / %{public}@) dateCreated is distantPast, repairing date", &v21, 0x16u);
          }

          [(PLManagedAsset *)self setDateCreated:contentCreationDate];
        }
      }

      else
      {
      }

      [(PLManagedAsset *)self _updateModificationDateForSyndication];
    }
  }
}

- (void)_updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:(id)date
{
  dateCopy = date;
  v4 = [MEMORY[0x1E695DF00] now];
  confirmedSpotlightSyncDate = [(PLManagedAsset *)self confirmedSpotlightSyncDate];

  if (!confirmedSpotlightSyncDate)
  {
    goto LABEL_6;
  }

  if (!dateCopy)
  {
    goto LABEL_7;
  }

  confirmedSpotlightSyncDate2 = [(PLManagedAsset *)self confirmedSpotlightSyncDate];
  if ([confirmedSpotlightSyncDate2 compare:dateCopy] != -1)
  {

    goto LABEL_7;
  }

  v7 = [dateCopy compare:v4];

  if (v7 == -1)
  {
LABEL_6:
    [(PLManagedAsset *)self setConfirmedSpotlightSyncDate:v4];
  }

LABEL_7:
}

- (void)_setSyndicationStateFromContentsOfSearchableItem:(id)item
{
  v19 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  syndicationState = [(PLManagedAsset *)self syndicationState];
  v6 = syndicationState & 0xFFF6 | PLSearchableItemMessageIsFromMe(itemCopy);
  if (PLSearchableItemMessagesIsSyndicatableMedia(itemCopy))
  {
    v7 = 0;
  }

  else
  {
    v7 = 8;
  }

  v8 = v6 | v7;
  if (syndicationState != v8)
  {
    v9 = PLSyndicationGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      uniqueIdentifier = [itemCopy uniqueIdentifier];
      v11 = PLManagedAssetSyndicationStateDescription(syndicationState);
      v12 = PLManagedAssetSyndicationStateDescription(v8);
      v13 = 138543874;
      v14 = uniqueIdentifier;
      v15 = 2114;
      v16 = v11;
      v17 = 2114;
      v18 = v12;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "[sync] setting syndication state from spotlight item %{public}@, %{public}@ -> %{public}@", &v13, 0x20u);
    }

    [(PLManagedAsset *)self setSyndicationState:v8];
    [(PLManagedAsset *)self _updateModificationDateForSyndication];
  }
}

- (void)_populateSyndicationAssetWithAssetType:(signed __int16)type subtype:(signed __int16)subtype contentType:(id)contentType videoComplementContentType:(id)complementContentType originalFilename:(id)filename
{
  subtypeCopy = subtype;
  typeCopy = type;
  v26 = *MEMORY[0x1E69E9840];
  complementContentTypeCopy = complementContentType;
  filenameCopy = filename;
  contentTypeCopy = contentType;
  [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:typeCopy];
  identifier = [contentTypeCopy identifier];

  [(PLManagedAsset *)self setUniformTypeIdentifier:identifier];
  if (filenameCopy)
  {
    [(PLManagedAsset *)self setSyndicationFilenameAndDirectoryWithOriginalFilename:filenameCopy];
  }

  v16 = [PLResourceInstaller onDemand_installOriginalResourceForSyndicationAsset:self];
  if (subtypeCopy == 2)
  {
    if (![(PLManagedAsset *)self becomeSyndicationLivePhotoWithVideoComplementContentType:complementContentTypeCopy])
    {
      v17 = PLSyndicationGetLog();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        uuid = [(PLManagedAsset *)self uuid];
        identifier2 = [complementContentTypeCopy identifier];
        v22 = 138543618;
        v23 = uuid;
        v24 = 2114;
        v25 = identifier2;
        _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "[sync] failed to promote asset to live photo: %{public}@, content type: %{public}@", &v22, 0x16u);
      }
    }
  }

  else
  {
    [(PLManagedAsset *)self setKindSubtype:subtypeCopy];
  }

  v20 = [PLResourceRecipe recipeFromID:65741];
  v21 = [PLResourceInstaller onDemand_installPrimaryImageResourceWithRecipe:v20 version:0 forAsset:self requireFileToBePresent:0];
  [v21 setDataStoreClassID:3];
  [v21 setDataStoreSubtype:4];
  [v21 setLocalAvailability:4294934528];
  [v21 setSyndicationLocalAvailabilityWithAvailable:0 additionalFlags:2];
}

- (void)setConfirmedSpotlightSyncDate:(id)date
{
  dateCopy = date;
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  [additionalAttributes setLastUploadAttemptDate:dateCopy];
}

- (NSDate)confirmedSpotlightSyncDate
{
  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  lastUploadAttemptDate = [additionalAttributes lastUploadAttemptDate];

  return lastUploadAttemptDate;
}

+ (void)performTransactionOnSyndicationLibraryWithSyndicationIdentifier:(id)identifier block:(id)block
{
  v19 = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  blockCopy = block;
  v16 = 0;
  v8 = PLCreateShortLivedWellKnownPhotoLibrary(3, "+[PLManagedAsset(Syndication) performTransactionOnSyndicationLibraryWithSyndicationIdentifier:block:]", &v16);
  v9 = v16;
  if (v8)
  {
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __101__PLManagedAsset_Syndication__performTransactionOnSyndicationLibraryWithSyndicationIdentifier_block___block_invoke;
    v11[3] = &unk_1E7576078;
    selfCopy = self;
    v12 = identifierCopy;
    v13 = v8;
    v14 = blockCopy;
    [v13 performTransaction:v11];

    v10 = v12;
  }

  else
  {
    v10 = PLSyndicationGetLog();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v18 = v9;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "matchingAssetFromSyndicationLibrary: Unable to open syndication photo library: %@", buf, 0xCu);
    }
  }
}

void __101__PLManagedAsset_Syndication__performTransactionOnSyndicationLibraryWithSyndicationIdentifier_block___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 56) assetWithSyndicationIdentifier:*(a1 + 32) inLibrary:*(a1 + 40)];
  v3 = PLSyndicationGetLog();
  v4 = v3;
  if (v2)
  {
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v5 = [v2 uuid];
      v6 = *(a1 + 32);
      v8 = 138543618;
      v9 = v5;
      v10 = 2114;
      v11 = v6;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_INFO, "found matching asset %{public}@ in syndication library for %{public}@", &v8, 0x16u);
    }

    (*(*(a1 + 48) + 16))();
  }

  else
  {
    if (os_log_type_enabled(v3, OS_LOG_TYPE_ERROR))
    {
      v7 = *(a1 + 32);
      v8 = 138543362;
      v9 = v7;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_ERROR, "unable to find matching asset in syndication library for %{public}@", &v8, 0xCu);
    }
  }
}

+ (id)predicateForShouldSyncToSPL
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForGuestAsset"), 0}];
  v8[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"syndicationState", 0];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 andPredicateWithSubpredicates:v5];

  return v6;
}

+ (BOOL)shouldSyncAssetToSPLWithSavedAssetType:(signed __int16)type syndicationState:(unsigned __int16)state
{
  stateCopy = state;
  [MEMORY[0x1E69BF328] maskForGuestAsset];
  result = PLValidatedSavedAssetTypeApplies();
  if (stateCopy)
  {
    return 0;
  }

  return result;
}

+ (id)createOrUpdateObjectFromSearchableItem:(id)item library:(id)library fullIndexSyncStartDate:(id)date createIfNeeded:(BOOL)needed didCreate:(BOOL *)create isSyndicatable:(BOOL *)syndicatable error:(id *)error
{
  neededCopy = needed;
  v91 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  libraryCopy = library;
  dateCopy = date;
  v82 = 0;
  attributeSet = [itemCopy attributeSet];
  contentURL = [attributeSet contentURL];

  IsHidden = PLSearchableItemMessagesIsHidden(itemCopy);
  v19 = PLSearchableItemMessagesIsSyndicatableMedia(itemCopy) & (IsHidden ^ 1);
  v20 = PLSyndicationGetLog();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
  {
    uniqueIdentifier = [itemCopy uniqueIdentifier];
    v22 = @"not syndicatable";
    *buf = 138543874;
    v84 = uniqueIdentifier;
    if (v19)
    {
      v22 = @"syndicatable";
    }

    v85 = 2114;
    v86 = v22;
    v87 = 2112;
    v88 = contentURL;
    _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEFAULT, "[sync] considering spotlight item with ID: %{public}@ (%{public}@) for syndication asset with content URL: %@", buf, 0x20u);
  }

  if (v19)
  {
    v80 = 0;
    v81 = 0;
    v23 = PLAssetTypeForSearchableItem(itemCopy, &v81, &v80);
    v76 = v81;
    v24 = v80;
    if (v23 < 2)
    {
      v79 = v24;
      v25 = [PLManagedAsset _syndicationAssetForSearchableItem:itemCopy inLibrary:libraryCopy createIfNeeded:neededCopy didCreate:&v82 error:&v79];
      v74 = v79;

      v75 = dateCopy;
      if (!v82)
      {
        [v25 _fixDistantPastContentCreationDateWithItem:itemCopy];
        attributeSet2 = [itemCopy attributeSet];
        photosDonationState = [attributeSet2 photosDonationState];
        if ([photosDonationState integerValue])
        {

          v42 = v76;
        }

        else
        {
          isEligibleForSearchIndexing = [v25 isEligibleForSearchIndexing];

          v42 = v76;
          if (!isEligibleForSearchIndexing)
          {
LABEL_38:
            [v25 _setSyndicationStateFromContentsOfSearchableItem:itemCopy];
            dateCopy = v75;
            [v25 _updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:v75];
            v24 = v74;
            goto LABEL_39;
          }

          v55 = PLSyndicationGetLog();
          if (os_log_type_enabled(v55, OS_LOG_TYPE_DEFAULT))
          {
            uniqueIdentifier2 = [itemCopy uniqueIdentifier];
            uuid = [v25 uuid];
            *buf = 138543618;
            v84 = uniqueIdentifier2;
            v85 = 2114;
            v86 = uuid;
            _os_log_impl(&dword_19BF1F000, v55, OS_LOG_TYPE_DEFAULT, "[sync] Spotlight record (id: %{public}@) matches existing asset in library but photos donation is missing, scheduling asset (%{public}@) for indexing", buf, 0x16u);
          }

          attributeSet2 = [v25 uuid];
          v58 = [PLBackgroundJobWorkItem addSearchIndexWorkItemIfNeededWithIdentifier:attributeSet2 flags:14 inLibrary:libraryCopy];
        }

LABEL_37:

        goto LABEL_38;
      }

      v26 = PLSyndicationGetLog();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        [v25 uuid];
        v27 = v72 = contentURL;
        additionalAttributes = [v25 additionalAttributes];
        syndicationIdentifier = [additionalAttributes syndicationIdentifier];
        *buf = 138543618;
        v84 = v27;
        v85 = 2114;
        v86 = syndicationIdentifier;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_DEFAULT, "[sync] created asset with uuid: %{public}@, syndication ID: %{public}@", buf, 0x16u);

        contentURL = v72;
      }

      createCopy = create;

      v30 = PLSearchableItemMessagesChatUniqueIdentifier(itemCopy);
      if (v30)
      {
        [v25 setConversationAlbumWithConversationID:v30];
      }

      v71 = v30;
      v31 = PLSearchableItemMessagesLivePhotoVideoURL(itemCopy);
      bundleID = [itemCopy bundleID];
      v33 = [bundleID isEqualToString:*MEMORY[0x1E69BFF00]];

      v34 = 0;
      v35 = 0;
      v73 = v31;
      if (v33 && v31)
      {
        if (v23)
        {
          v36 = PLSyndicationGetLog();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            uuid2 = [v25 uuid];
            bundleID2 = [itemCopy bundleID];
            additionalAttributes2 = [v25 additionalAttributes];
            syndicationIdentifier2 = [additionalAttributes2 syndicationIdentifier];
            *buf = 138543874;
            v84 = uuid2;
            v85 = 2114;
            v86 = bundleID2;
            v87 = 2114;
            v88 = syndicationIdentifier2;
            _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[sync] ignoring video complement key for non-image asset: %{public}@, bundle ID: %{public}@, syndication ID: %{public}@", buf, 0x20u);
          }

          v35 = 0;
        }

        else
        {
          v61 = MEMORY[0x1E6982C40];
          pathExtension = [v31 pathExtension];
          v35 = [v61 typeWithFilenameExtension:pathExtension conformingToType:*MEMORY[0x1E6982EE8]];

          if (v35 && ![v35 isDynamic])
          {
            v34 = 2;
            goto LABEL_19;
          }

          v36 = PLSyndicationGetLog();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            pathExtension2 = [v73 pathExtension];
            uuid3 = [v25 uuid];
            bundleID3 = [itemCopy bundleID];
            additionalAttributes3 = [v25 additionalAttributes];
            syndicationIdentifier3 = [additionalAttributes3 syndicationIdentifier];
            *buf = 138544130;
            v84 = pathExtension2;
            v85 = 2114;
            v86 = uuid3;
            v87 = 2114;
            v88 = bundleID3;
            v89 = 2114;
            v90 = syndicationIdentifier3;
            v64 = syndicationIdentifier3;
            _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[sync] unexpected video complement uti for file extension: %{public}@, storing as image only, asset: %{public}@, bundle ID: %{public}@, syndication ID: %{public}@", buf, 0x2Au);
          }
        }

        v34 = 0;
      }

LABEL_19:
      lastPathComponent = [contentURL lastPathComponent];
      v41 = v23;
      v42 = v76;
      [v25 _populateSyndicationAssetWithAssetType:v41 subtype:v34 contentType:v76 videoComplementContentType:v35 originalFilename:lastPathComponent];

      create = createCopy;
      attributeSet2 = v71;
      goto LABEL_37;
    }

    if (v23 == 2)
    {
      v46 = PLSyndicationGetLog();
      v42 = v76;
      if (os_log_type_enabled(v46, OS_LOG_TYPE_DEBUG))
      {
        [itemCopy uniqueIdentifier];
        v48 = v47 = dateCopy;
        *buf = 138543362;
        v84 = v48;
        v49 = "[sync] skipping audio spotlight item with ID: %{public}@";
        v50 = v46;
        v51 = OS_LOG_TYPE_DEBUG;
        v52 = 12;
LABEL_31:
        _os_log_impl(&dword_19BF1F000, v50, v51, v49, buf, v52);

        dateCopy = v47;
      }
    }

    else
    {
      v46 = PLSyndicationGetLog();
      v42 = v76;
      if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
      {
        [itemCopy uniqueIdentifier];
        v48 = v47 = dateCopy;
        *buf = 138543618;
        v84 = v48;
        v85 = 2112;
        v86 = v24;
        v49 = "[sync] unable to sync spotlight item (unknown asset type) with ID: %{public}@, error: %@";
        v50 = v46;
        v51 = OS_LOG_TYPE_ERROR;
        v52 = 22;
        goto LABEL_31;
      }
    }

    v25 = 0;
LABEL_39:

    goto LABEL_40;
  }

  v78 = 0;
  v25 = [PLManagedAsset _syndicationAssetForSearchableItem:itemCopy inLibrary:libraryCopy createIfNeeded:0 didCreate:0 error:&v78];
  v24 = v78;
  if (v25)
  {
    if (IsHidden)
    {
      [libraryCopy managedObjectContext];
      v45 = v44 = dateCopy;
      [v45 deleteObject:v25];

      dateCopy = v44;
    }

    else
    {
      [v25 _setSyndicationStateFromContentsOfSearchableItem:itemCopy];
      [v25 _updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:dateCopy];
    }
  }

LABEL_40:
  if (create)
  {
    *create = v82;
  }

  if (syndicatable)
  {
    *syndicatable = v19;
  }

  if (error)
  {
    v59 = v24;
    *error = v24;
  }

  return v25;
}

+ (id)predicateForSyndicatedAssetIdentifiersSuffix:(id)suffix
{
  v21 = *MEMORY[0x1E69E9840];
  suffixCopy = suffix;
  array = [MEMORY[0x1E695DF70] array];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"additionalAttributes.syndicationIdentifier"];
  [array addObject:v5];

  array2 = [MEMORY[0x1E695DF70] array];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v7 = suffixCopy;
  v8 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v17;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v17 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K ENDSWITH %@", @"additionalAttributes.syndicationIdentifier", *(*(&v16 + 1) + 8 * i), v16];
        [array2 addObject:v12];
      }

      v9 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v9);
  }

  v13 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:array2];
  [array addObject:v13];
  v14 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:array];

  return v14;
}

+ (id)predicateForSyndicatedAssetIdentifiers:(id)identifiers includeRejected:(BOOL)rejected
{
  v18[2] = *MEMORY[0x1E69E9840];
  identifiersCopy = identifiers;
  if (identifiersCopy)
  {
    v7 = MEMORY[0x1E696AB28];
    v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"additionalAttributes.syndicationIdentifier"];
    v18[0] = v8;
    identifiersCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", @"additionalAttributes.syndicationIdentifier", identifiersCopy];
    v18[1] = identifiersCopy;
    v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v18 count:2];
    v11 = [v7 andPredicateWithSubpredicates:v10];

    if (rejected)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v11 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"additionalAttributes.syndicationIdentifier"];
  if (!rejected)
  {
LABEL_3:
    v12 = MEMORY[0x1E696AB28];
    v17[0] = v11;
    filterPredicateToExcludeNoSyndicationAssets = [self filterPredicateToExcludeNoSyndicationAssets];
    v17[1] = filterPredicateToExcludeNoSyndicationAssets;
    v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:2];
    v15 = [v12 andPredicateWithSubpredicates:v14];

    v11 = v15;
  }

LABEL_4:

  return v11;
}

+ (PLManagedAsset)assetWithSyndicationIdentifier:(id)identifier inLibrary:(id)library
{
  v30[2] = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  libraryCopy = library;
  if (identifierCopy)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = MEMORY[0x1E695D5E0];
    v10 = +[PLManagedAsset entityName];
    v11 = [v9 fetchRequestWithEntityName:v10];

    v12 = MEMORY[0x1E696AB28];
    v29 = identifierCopy;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v29 count:1];
    v14 = [self predicateForSyndicatedAssetIdentifiers:v13 includeRejected:1];
    v30[0] = v14;
    v15 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSyndicationIdentifierFetchExclusions"), 0}];
    v30[1] = v15;
    v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:2];
    v17 = [v12 andPredicateWithSubpredicates:v16];

    [v11 setPredicate:v17];
    managedObjectContext = [libraryCopy managedObjectContext];
    v26 = 0;
    v19 = [managedObjectContext executeFetchRequest:v11 error:&v26];
    v20 = v26;

    v21 = [v19 count];
    if (v21)
    {
      v22 = v21;
      v23 = [v19 objectAtIndex:0];
      if (v22 != 1)
      {
        v24 = PLSyndicationGetLog();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          *buf = 138543362;
          v28 = identifierCopy;
          _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Found more than one asset with syndication identifier %{public}@", buf, 0xCu);
        }
      }
    }

    else
    {
      v23 = 0;
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v23 = 0;
  }

  return v23;
}

+ (id)_syndicationAssetForSearchableItem:(id)item inLibrary:(id)library createIfNeeded:(BOOL)needed didCreate:(BOOL *)create error:(id *)error
{
  neededCopy = needed;
  v39[2] = *MEMORY[0x1E69E9840];
  libraryCopy = library;
  itemCopy = item;
  uniqueIdentifier = [itemCopy uniqueIdentifier];
  attributeSet = [itemCopy attributeSet];
  bundleID = [attributeSet bundleID];

  attributeSet2 = [itemCopy attributeSet];

  contentCreationDate = [attributeSet2 contentCreationDate];

  v15 = MEMORY[0x1E695D5E0];
  v16 = +[PLManagedAsset entityName];
  v17 = [v15 fetchRequestWithEntityName:v16];

  v18 = MEMORY[0x1E696AB28];
  v38 = uniqueIdentifier;
  v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v38 count:1];
  v20 = [self predicateForSyndicatedAssetIdentifiers:v19 includeRejected:1];
  v39[0] = v20;
  v21 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"additionalAttributes.importedByBundleIdentifier", bundleID];
  v39[1] = v21;
  v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v39 count:2];
  v23 = [v18 andPredicateWithSubpredicates:v22];
  [v17 setPredicate:v23];

  managedObjectContext = [libraryCopy managedObjectContext];
  v37 = 0;
  v25 = [managedObjectContext executeFetchRequest:v17 error:&v37];
  v26 = v37;

  firstObject = [v25 firstObject];
  if (!firstObject && neededCopy)
  {
    uUID = [MEMORY[0x1E696AFB0] UUID];
    uUIDString = [uUID UUIDString];

    v30 = [self _insertSyndicationAssetIntoPhotoLibrary:libraryCopy uuid:uUIDString syndicationIdentifier:uniqueIdentifier bundleID:bundleID addedDate:contentCreationDate];
    firstObject = v30;
    if (create && v30)
    {
      *create = 1;
    }
  }

  if (error)
  {
    v31 = v26;
    *error = v26;
  }

  return firstObject;
}

+ (id)_insertSyndicationAssetIntoPhotoLibrary:(id)library uuid:(id)uuid syndicationIdentifier:(id)identifier bundleID:(id)d addedDate:(id)date
{
  v11 = MEMORY[0x1E69BF328];
  dateCopy = date;
  dCopy = d;
  identifierCopy = identifier;
  uuidCopy = uuid;
  libraryCopy = library;
  LOWORD(v22) = 1;
  v17 = +[PLManagedAsset insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:](PLManagedAsset, "insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:", libraryCopy, 0, 0, [v11 savedAssetTypeForInsertIntoSyndicationLibrary], 3, uuidCopy, 0, 0, 0, v22);

  additionalAttributes = [v17 additionalAttributes];
  [additionalAttributes setSyndicationIdentifier:identifierCopy];

  [v17 setBundleScope:3];
  [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForInsertIntoSyndicationLibrary")}];
  [v17 setImportedBy:12];
  additionalAttributes2 = [v17 additionalAttributes];
  [additionalAttributes2 setImportedByBundleIdentifier:dCopy];

  [v17 setAddedDate:dateCopy];
  distantPast = [MEMORY[0x1E695DF00] distantPast];
  [v17 setDateCreated:distantPast];

  return v17;
}

- (BOOL)anyInternalResourceIsLocal
{
  v12 = *MEMORY[0x1E69E9840];
  v7 = 0u;
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v3 = [modernResources countByEnumeratingWithState:&v7 objects:v11 count:16];
  if (v3)
  {
    v4 = *v8;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v8 != v4)
        {
          objc_enumerationMutation(modernResources);
        }

        if ([*(*(&v7 + 1) + 8 * i) isLocallyAvailable])
        {
          LOBYTE(v3) = 1;
          goto LABEL_11;
        }
      }

      v3 = [modernResources countByEnumeratingWithState:&v7 objects:v11 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v3;
}

- (id)allRequiredResourcesForCPLDisable
{
  hasAdjustments = [(PLManagedAsset *)self hasAdjustments];
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __59__PLManagedAsset_RM_CPL__allRequiredResourcesForCPLDisable__block_invoke;
  v6[3] = &__block_descriptor_33_e28_B16__0__PLInternalResource_8l;
  v7 = hasAdjustments;
  v4 = [(PLManagedAsset *)self persistedResourcesMatching:v6];

  return v4;
}

- (BOOL)checkAllResourcesRequiredForCPLDisableWithReachableBlock:(id)block
{
  v38 = *MEMORY[0x1E69E9840];
  blockCopy = block;
  allRequiredResourcesForCPLDisable = [(PLManagedAsset *)self allRequiredResourcesForCPLDisable];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v6 = [allRequiredResourcesForCPLDisable countByEnumeratingWithState:&v31 objects:v37 count:16];
  if (!v6)
  {
    v9 = 0;
    goto LABEL_31;
  }

  v8 = v6;
  v9 = 0;
  v10 = *v32;
  v29 = 1;
  *&v7 = 67109378;
  v27 = v7;
  v28 = blockCopy;
  do
  {
    for (i = 0; i != v8; ++i)
    {
      if (*v32 != v10)
      {
        objc_enumerationMutation(allRequiredResourcesForCPLDisable);
      }

      v12 = *(*(&v31 + 1) + 8 * i);
      cplFileURL = [v12 cplFileURL];
      v14 = cplFileURL;
      if (cplFileURL)
      {
        v30 = 0;
        v15 = [cplFileURL checkResourceIsReachableAndReturnError:&v30];
        v16 = v30;
        if (v15)
        {
          if (blockCopy)
          {
            blockCopy[2](blockCopy, v14, v12);
          }

          goto LABEL_25;
        }

        if (PLIsErrorFileNotFound())
        {
          if ([v12 cloudLocalState] == 3)
          {
            v29 = 0;
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v19 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
            {
              v20 = allRequiredResourcesForCPLDisable;
              v21 = v9;
              cloudLocalState = [v12 cloudLocalState];
              objectID = [v12 objectID];
              *buf = v27;
              *v36 = cloudLocalState;
              v9 = v21;
              allRequiredResourcesForCPLDisable = v20;
              blockCopy = v28;
              *&v36[4] = 2114;
              *&v36[6] = objectID;
              _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: unreachable resource with cloudLocalState %d, skipping: %{public}@", buf, 0x12u);
            }
          }

          ++v9;
          goto LABEL_25;
        }

        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          objectID3 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(objectID3, OS_LOG_TYPE_ERROR))
          {
            objectID2 = [v12 objectID];
            *buf = 138543618;
            *v36 = objectID2;
            *&v36[8] = 2112;
            *&v36[10] = v16;
            _os_log_impl(&dword_19BF1F000, objectID3, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: failed for resource: %{public}@, error: %@", buf, 0x16u);
          }

          goto LABEL_19;
        }
      }

      else
      {
        if (*MEMORY[0x1E6994D48])
        {
          goto LABEL_26;
        }

        v16 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          objectID3 = [v12 objectID];
          *buf = 138543362;
          *v36 = objectID3;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: nil fileURL for CPL original resource: %{public}@", buf, 0xCu);
LABEL_19:
        }
      }

LABEL_25:

LABEL_26:
    }

    v8 = [allRequiredResourcesForCPLDisable countByEnumeratingWithState:&v31 objects:v37 count:16];
  }

  while (v8);
  if ((v29 & 1) == 0)
  {
    goto LABEL_36;
  }

LABEL_31:
  if (v9 == [allRequiredResourcesForCPLDisable count])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v24 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: all original resources unavailable, returning NO", buf, 2u);
      }
    }

LABEL_36:
    v25 = 0;
  }

  else
  {
    v25 = 1;
  }

  return v25;
}

- (void)updateSpatialTypeFromAdjustmentRenderTypes:(unsigned int)types hasAdjustment:(BOOL)adjustment adjustedMediaMetadata:(id)metadata
{
  adjustmentCopy = adjustment;
  typesCopy = types;
  metadataCopy = metadata;
  if ([(PLManagedAsset *)self isPhoto])
  {
    if (adjustmentCopy)
    {
      if ((typesCopy & 0x1000) == 0)
      {
        selfCopy2 = self;
        v9 = 0;
LABEL_11:
        [(PLManagedAsset *)selfCopy2 setSpatialType:v9];
        goto LABEL_12;
      }

      if (!metadataCopy)
      {
        selfCopy2 = self;
        v9 = 1;
        goto LABEL_11;
      }

      metadataFromMediaPropertiesOrOriginalResource = [objc_alloc(MEMORY[0x1E69C0718]) initWithImageSourceProxyOrEncodedImagePropertyData:metadataCopy contentType:0 timeZoneLookup:0];
    }

    else
    {
      if (![(PLManagedAsset *)self hasAdjustments])
      {
        goto LABEL_12;
      }

      metadataFromMediaPropertiesOrOriginalResource = [(PLManagedAsset *)self metadataFromMediaPropertiesOrOriginalResource];
    }

    v11 = metadataFromMediaPropertiesOrOriginalResource;
    [(PLManagedAsset *)self setSpatialTypeFromMetadata:metadataFromMediaPropertiesOrOriginalResource];
  }

LABEL_12:
}

- (id)rm_applyResourcesFromAssetChange:(id)change inLibrary:(id)library
{
  v172 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  libraryCopy = library;
  v138 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
  if (deferredProcessingNeeded <= 0xA && ((0x5F6u >> deferredProcessingNeeded) & 1) != 0)
  {
    if ([(PLManagedAsset *)self hasAdjustments])
    {
      adjustmentTimestamp = [(PLManagedAsset *)self adjustmentTimestamp];
      recordModificationDate = [changeCopy recordModificationDate];
      v10 = [adjustmentTimestamp compare:recordModificationDate];

      if (v10 == 1)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v11 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
          {
            deferredProcessingNeeded2 = [(PLManagedAsset *)self deferredProcessingNeeded];
            if (deferredProcessingNeeded2 > 0xA)
            {
              v13 = 0;
            }

            else
            {
              v13 = off_1E7567B18[deferredProcessingNeeded2];
            }

            v132 = v13;
            adjustmentTimestamp2 = [(PLManagedAsset *)self adjustmentTimestamp];
            recordModificationDate2 = [changeCopy recordModificationDate];
            *buf = 138413058;
            *v167 = changeCopy;
            *&v167[8] = 2112;
            *&v167[10] = v132;
            v168 = 2112;
            v169 = adjustmentTimestamp2;
            v170 = 2112;
            v171 = recordModificationDate2;
            _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Skipping resources change for record %@ because deferred processing is %@, asset adj time %@, record modification time %@", buf, 0x2Au);
          }
        }

        v62 = [v138 copy];
        goto LABEL_184;
      }
    }
  }

  v161 = 0u;
  v162 = 0u;
  v159 = 0u;
  v160 = 0u;
  allAssetCPLResources = [(PLManagedAsset *)self allAssetCPLResources];
  v15 = [allAssetCPLResources countByEnumeratingWithState:&v159 objects:v165 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v160;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v160 != v17)
        {
          objc_enumerationMutation(allAssetCPLResources);
        }

        v19 = *(*(&v159 + 1) + 8 * i);
        cplType = [v19 cplType];
        resources = [changeCopy resources];
        if (![(PLManagedAsset *)self _isResourceType:cplType inResources:resources])
        {

LABEL_18:
          [(PLManagedAsset *)self removeLocalFileForResource:v19];
          [v19 deleteResource];
          continue;
        }

        v22 = +[PLResourceInstaller isValidCPLResourceTypeForPersistence:](PLResourceInstaller, "isValidCPLResourceTypeForPersistence:", [v19 cplType]);

        if (!v22)
        {
          goto LABEL_18;
        }
      }

      v16 = [allAssetCPLResources countByEnumeratingWithState:&v159 objects:v165 count:16];
    }

    while (v16);
  }

  bestResourceTypeForAdjustedStableHash = [(PLManagedAsset *)self bestResourceTypeForAdjustedStableHash];
  v155 = 0u;
  v156 = 0u;
  v157 = 0u;
  v158 = 0u;
  obj = [changeCopy resources];
  v145 = changeCopy;
  selfCopy = self;
  v148 = [obj countByEnumeratingWithState:&v155 objects:v164 count:16];
  if (!v148)
  {
    v141 = 0;
    goto LABEL_53;
  }

  v141 = 0;
  v146 = *v156;
  do
  {
    for (j = 0; j != v148; ++j)
    {
      if (*v156 != v146)
      {
        objc_enumerationMutation(obj);
      }

      v24 = *(*(&v155 + 1) + 8 * j);
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v25 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          *buf = 138412290;
          *v167 = v24;
          _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Asset resource: %@", buf, 0xCu);
        }
      }

      resourceType = [v24 resourceType];
      v27 = [(PLManagedAsset *)self assetResourceForCPLType:resourceType];
      if (v27)
      {
        selfCopy2 = self;
        identity = [v24 identity];
        fingerPrint = [identity fingerPrint];
        identity2 = [v24 identity];
        stableHash = [identity2 stableHash];
        fingerprintContext = [(PLManagedAsset *)selfCopy2 fingerprintContext];
        v34 = [v27 isEquivalentToFingerprint:fingerPrint andStableHash:stableHash fingerprintContext:fingerprintContext] ^ 1;

        changeCopy = v145;
      }

      else
      {
        v34 = 0;
      }

      if (!+[PLResourceInstaller isValidCPLResourceTypeForPersistence:](PLResourceInstaller, "isValidCPLResourceTypeForPersistence:", [v27 cplType]))
      {
        v35 = 0;
        self = selfCopy;
LABEL_48:

        goto LABEL_49;
      }

      self = selfCopy;
      v35 = [(PLManagedAsset *)selfCopy storedResourceForCPLResource:v24 asset:selfCopy adjusted:1];

      if (v35)
      {
        if ([v35 isLocallyAvailable])
        {
          if (v34)
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v36 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v36, OS_LOG_TYPE_DEFAULT))
              {
                singleLineDescription = [v35 singleLineDescription];
                *buf = 138412546;
                *v167 = singleLineDescription;
                *&v167[8] = 2112;
                *&v167[10] = v24;
                _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_DEFAULT, "Removing local resource %@ that does not match cloud resource %@", buf, 0x16u);
              }
            }

            [(PLManagedAsset *)selfCopy removeLocalFileForResource:v35];
            [v35 markAsNotLocallyAvailable];
          }

          else
          {
            [v138 addObject:v35];
          }
        }

        if ([v35 cloudLocalState] != 3)
        {
          [v35 setCloudLocalState:3];
        }

        if (resourceType == bestResourceTypeForAdjustedStableHash)
        {
          [v24 stableHash];
          v141 = v27 = v141;
          goto LABEL_48;
        }
      }

LABEL_49:
    }

    v148 = [obj countByEnumeratingWithState:&v155 objects:v164 count:16];
  }

  while (v148);
LABEL_53:

  [(PLManagedAsset *)self persistedResourcesWithRecipeID:65937 andVersion:2];
  v151 = 0u;
  v152 = 0u;
  v153 = 0u;
  v38 = v154 = 0u;
  v39 = [v38 countByEnumeratingWithState:&v151 objects:v163 count:16];
  if (v39)
  {
    v40 = v39;
    v41 = *v152;
    do
    {
      for (k = 0; k != v40; ++k)
      {
        if (*v152 != v41)
        {
          objc_enumerationMutation(v38);
        }

        v43 = *(*(&v151 + 1) + 8 * k);
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v44 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v44, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412290;
            *v167 = v43;
            _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_DEFAULT, "Removing substandard resource %@", buf, 0xCu);
          }
        }

        [(PLManagedAsset *)selfCopy removeLocalFileForResource:v43];
        [v43 deleteResource];
      }

      v40 = [v38 countByEnumeratingWithState:&v151 objects:v163 count:16];
    }

    while (v40);
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v45 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
    {
      orientation = [(PLManagedAsset *)selfCopy orientation];
      orientation2 = [changeCopy orientation];
      *buf = 67109376;
      *v167 = orientation;
      *&v167[4] = 2048;
      *&v167[6] = orientation2;
      _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEBUG, "Current orientation: %d. AssetChange orientation: %ld", buf, 0x12u);
    }
  }

  orientation3 = [(PLManagedAsset *)selfCopy orientation];
  if ([changeCopy orientation] != orientation3)
  {
    -[PLManagedAsset setOrientation:](selfCopy, "setOrientation:", [changeCopy orientation]);
  }

  [(PLManagedAsset *)selfCopy duration];
  v50 = (v49 * 1000.0);
  duration = [changeCopy duration];
  if (duration != v50)
  {
    v52 = duration;
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v53 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
      {
        *buf = 134218240;
        *v167 = v50;
        *&v167[8] = 2048;
        *&v167[10] = v52;
        _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_DEBUG, "Current duration: %ld. AssetChange duration: %ld", buf, 0x16u);
      }
    }

    [(PLManagedAsset *)selfCopy setDuration:v52 / 1000.0];
  }

  originalChoice = [changeCopy originalChoice];
  if (originalChoice != [(PLManagedAsset *)selfCopy originalResourceChoice])
  {
    [(PLManagedAsset *)selfCopy setOriginalResourceChoice:originalChoice];
  }

  adjustedMediaMetaDataType = [changeCopy adjustedMediaMetaDataType];
  adjustedMediaMetaData = [changeCopy adjustedMediaMetaData];
  additionalAttributes = [(PLManagedAsset *)selfCopy additionalAttributes];
  [additionalAttributes setMediaMetadataType:adjustedMediaMetaDataType];

  additionalAttributes2 = [(PLManagedAsset *)selfCopy additionalAttributes];
  [additionalAttributes2 setMediaMetadataData:adjustedMediaMetaData];

  additionalAttributes3 = [(PLManagedAsset *)selfCopy additionalAttributes];
  adjustedStableHash = [additionalAttributes3 adjustedStableHash];

  v61 = v141;
  if (v141 && [v141 isEqualToString:adjustedStableHash])
  {
    v62 = v138;
    goto LABEL_183;
  }

  adjustments = [changeCopy adjustments];
  v64 = adjustments;
  if (adjustments)
  {
    adjustmentType = [adjustments adjustmentType];

    if (adjustmentType)
    {
      simpleAdjustmentData = [v64 simpleAdjustmentData];

      adjustmentCompoundVersion = [v64 adjustmentCompoundVersion];

      adjustmentCreatorCode = [v64 adjustmentCreatorCode];

      obja = [v64 adjustmentTimestamp];

      v66 = -[PLManagedAsset _plAdjustmentBaseVersionFromCPLAdjustmentSourceType:](selfCopy, "_plAdjustmentBaseVersionFromCPLAdjustmentSourceType:", [v64 adjustmentSourceType]);
      adjustmentRenderTypes = [v64 adjustmentRenderTypes];
      v68 = 1;
      [(PLManagedAsset *)selfCopy updateSpatialTypeFromAdjustmentRenderTypes:adjustmentRenderTypes hasAdjustment:1 adjustedMediaMetadata:adjustedMediaMetaData];
      if (*MEMORY[0x1E6994D48])
      {
        goto LABEL_95;
      }

      goto LABEL_86;
    }
  }

  [(PLManagedAsset *)selfCopy updateSpatialTypeFromAdjustmentRenderTypes:0 hasAdjustment:0 adjustedMediaMetadata:adjustedMediaMetaData];
  adjustmentRenderTypes = 0;
  obja = 0;
  v68 = 0;
  adjustmentType = 0;
  simpleAdjustmentData = 0;
  adjustmentCreatorCode = 0;
  v66 = 0;
  adjustmentCompoundVersion = @"0";
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
LABEL_86:
    v69 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v69, OS_LOG_TYPE_DEBUG))
    {
      v70 = @"NO";
      if (v68)
      {
        v70 = @"YES";
      }

      *buf = 138412290;
      *v167 = v70;
      _os_log_impl(&dword_19BF1F000, v69, OS_LOG_TYPE_DEBUG, "has adjustment: %@", buf, 0xCu);
    }

    if (v68)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v71 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v71, OS_LOG_TYPE_DEFAULT))
        {
          uuid = [(PLManagedAsset *)selfCopy uuid];
          *buf = 138543874;
          *v167 = adjustmentType;
          *&v167[8] = 2114;
          *&v167[10] = adjustmentCompoundVersion;
          v168 = 2114;
          v169 = uuid;
          _os_log_impl(&dword_19BF1F000, v71, OS_LOG_TYPE_DEFAULT, "Setting adjustment type: %{public}@ version: %{public}@ to asset %{public}@", buf, 0x20u);
        }
      }

LABEL_95:
      if (!simpleAdjustmentData)
      {
        v73 = [(PLManagedAsset *)selfCopy assetResourceForCPLType:13];
        cplFileURL = [v73 cplFileURL];
        if (cplFileURL && [v73 isLocallyAvailable])
        {
          simpleAdjustmentData = [objc_alloc(MEMORY[0x1E695DEF0]) initWithContentsOfURL:cplFileURL];
        }

        else
        {
          simpleAdjustmentData = 0;
        }
      }
    }
  }

  v75 = objc_alloc(MEMORY[0x1E69C0660]);
  v76 = [PLManagedAsset pfAdjustmentsBaseVersionFromAdjustmentBaseVersion:v66];
  v137 = adjustmentType;
  v77 = adjustmentCreatorCode;
  v78 = [v75 initWithFormatIdentifier:adjustmentType formatVersion:adjustmentCompoundVersion data:simpleAdjustmentData baseVersion:v76 editorBundleID:adjustmentCreatorCode renderTypes:adjustmentRenderTypes];
  v79 = +[PLAssetAdjustmentOptions assetAdjustmentOptionsForApplyingResourcesFromCPL];
  v80 = selfCopy;
  v135 = v78;
  [(PLManagedAsset *)selfCopy setAdjustments:v78 options:v79];

  additionalAttributes4 = [(PLManagedAsset *)selfCopy additionalAttributes];
  unmanagedAdjustment = [additionalAttributes4 unmanagedAdjustment];

  v140 = unmanagedAdjustment;
  if (unmanagedAdjustment)
  {
    if (obja)
    {
      [unmanagedAdjustment setAdjustmentTimestamp:?];
    }

    v80 = selfCopy;
    if ([(PLManagedAsset *)selfCopy isVideo]|| [(PLManagedAsset *)selfCopy isPhotoIris])
    {
      [(PLManagedAsset *)selfCopy setPlaybackVariationAndLoopingStyleFromAdjustmentRenderTypes:adjustmentRenderTypes];
    }

    if ([(PLManagedAsset *)selfCopy isPhoto])
    {
      [(PLManagedAsset *)selfCopy setDepthTypeFromAdjustmentRenderTypes:adjustmentRenderTypes];
    }

    [(PLManagedAsset *)selfCopy setCameraProcessingAdjustmentStateFromAdjustmentRenderTypes:adjustmentRenderTypes];
  }

  if ([(PLManagedAsset *)v80 hasAdjustments])
  {
    additionalAttributes5 = [(PLManagedAsset *)v80 additionalAttributes];
    mediaMetadata = [additionalAttributes5 mediaMetadata];

    if (!mediaMetadata)
    {
      additionalAttributes6 = [(PLManagedAsset *)v80 additionalAttributes];
      [additionalAttributes6 setMediaMetadataData:adjustedMediaMetaData];
    }
  }

  additionalAttributes7 = [(PLManagedAsset *)v80 additionalAttributes];
  [additionalAttributes7 setAdjustedStableHash:v141];

  recordModificationDate3 = [v145 recordModificationDate];
  [(PLManagedAsset *)v80 setModificationDate:recordModificationDate3];

  if ([(PLManagedAsset *)v80 hasNonSlomoAdjustments])
  {
    if ([(PLManagedAsset *)v80 isVideo])
    {
      v88 = 16;
      goto LABEL_116;
    }

    v107 = [(PLManagedAsset *)v80 assetResourceForCPLType:2];
    if (v107 || ([(PLManagedAsset *)v80 assetResourceForCPLType:4], (v107 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v90 = v107;
      v61 = v141;
LABEL_140:
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v108 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v108, OS_LOG_TYPE_DEBUG))
        {
          singleLineDescription2 = [v90 singleLineDescription];
          *buf = 138412290;
          *v167 = singleLineDescription2;
          _os_log_impl(&dword_19BF1F000, v108, OS_LOG_TYPE_DEBUG, "Updating asset width/height from resource %@", buf, 0xCu);
        }
      }

      unorientedWidth = [v90 unorientedWidth];
      if (unorientedWidth < 1)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v120 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v120, OS_LOG_TYPE_ERROR))
          {
            [v90 singleLineDescription];
            v121 = adjustedStableHash;
            v123 = v122 = adjustedMediaMetaDataType;
            *buf = 134218242;
            *v167 = unorientedWidth;
            *&v167[8] = 2112;
            *&v167[10] = v123;
            _os_log_impl(&dword_19BF1F000, v120, OS_LOG_TYPE_ERROR, "Invalid width %lld from resource %@", buf, 0x16u);

            adjustedMediaMetaDataType = v122;
            adjustedStableHash = v121;
            v77 = adjustmentCreatorCode;
          }
        }

        unorientedHeight = [v90 unorientedHeight];
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v125 = unorientedHeight;
          v126 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v126, OS_LOG_TYPE_ERROR))
          {
            [v90 singleLineDescription];
            v127 = adjustedStableHash;
            v129 = v128 = adjustedMediaMetaDataType;
            *buf = 134218242;
            *v167 = v125;
            *&v167[8] = 2112;
            *&v167[10] = v129;
            _os_log_impl(&dword_19BF1F000, v126, OS_LOG_TYPE_ERROR, "Invalid height %lld from resource %@", buf, 0x16u);

            adjustedMediaMetaDataType = v128;
            adjustedStableHash = v127;
            v77 = adjustmentCreatorCode;
          }
        }
      }

      else
      {
        v111 = selfCopy;
        if ([(PLManagedAsset *)selfCopy width]!= unorientedWidth)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v112 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v112, OS_LOG_TYPE_DEBUG))
            {
              width = [(PLManagedAsset *)selfCopy width];
              *buf = 134218240;
              *v167 = width;
              *&v167[8] = 2048;
              *&v167[10] = unorientedWidth;
              _os_log_impl(&dword_19BF1F000, v112, OS_LOG_TYPE_DEBUG, "Setting asset width from %lld to %lld", buf, 0x16u);
            }
          }

          v111 = selfCopy;
          [(PLManagedAsset *)selfCopy setWidth:unorientedWidth];
        }

        unorientedHeight2 = [v90 unorientedHeight];
        if ([(PLManagedAsset *)v111 height]!= unorientedHeight2)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v115 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v115, OS_LOG_TYPE_DEBUG))
            {
              height = [(PLManagedAsset *)selfCopy height];
              *buf = 134218240;
              *v167 = height;
              *&v167[8] = 2048;
              *&v167[10] = unorientedHeight2;
              _os_log_impl(&dword_19BF1F000, v115, OS_LOG_TYPE_DEBUG, "Setting asset height from %lld to %lld", buf, 0x16u);
            }
          }

          [(PLManagedAsset *)selfCopy setHeight:unorientedHeight2];
        }
      }

      uniformTypeIdentifier = [v90 uniformTypeIdentifier];
      identifier = [uniformTypeIdentifier identifier];

      if (identifier)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v100 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v100, OS_LOG_TYPE_DEFAULT))
          {
            [v90 singleLineDescription];
            v101 = adjustedStableHash;
            v103 = v102 = adjustedMediaMetaDataType;
            *buf = 138412546;
            *v167 = identifier;
            *&v167[8] = 2112;
            *&v167[10] = v103;
            v104 = "Setting uti to %@ from %@ due to adjustment";
            v105 = v100;
            v106 = OS_LOG_TYPE_DEFAULT;
LABEL_172:
            _os_log_impl(&dword_19BF1F000, v105, v106, v104, buf, 0x16u);

            adjustedMediaMetaDataType = v102;
            adjustedStableHash = v101;
            v77 = adjustmentCreatorCode;
          }

          goto LABEL_173;
        }

        goto LABEL_174;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v117 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v117, OS_LOG_TYPE_ERROR))
        {
          singleLineDescription3 = [v90 singleLineDescription];
          *buf = 138412290;
          *v167 = singleLineDescription3;
          v119 = "Resource %@ is missing uti";
LABEL_178:
          _os_log_impl(&dword_19BF1F000, v117, OS_LOG_TYPE_ERROR, v119, buf, 0xCu);

          v61 = v141;
        }

        goto LABEL_179;
      }

      goto LABEL_180;
    }

    v88 = 5;
LABEL_116:
    v61 = v141;
    v89 = [(PLManagedAsset *)selfCopy assetResourceForCPLType:v88];
    if (v89)
    {
      v90 = v89;
      goto LABEL_140;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v90 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v90, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v90, OS_LOG_TYPE_ERROR, "Did not find derivative resource to update asset size with, asset dimensions may be incorrect", buf, 2u);
      }

      goto LABEL_181;
    }
  }

  else
  {
    v61 = v141;
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v91 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v91, OS_LOG_TYPE_DEBUG))
      {
        _compactDebugDescription = [(PLManagedAsset *)selfCopy _compactDebugDescription];
        *buf = 138412290;
        *v167 = _compactDebugDescription;
        _os_log_impl(&dword_19BF1F000, v91, OS_LOG_TYPE_DEBUG, "Setting original size for asset %@", buf, 0xCu);
      }
    }

    originalWidth = [(PLManagedAsset *)selfCopy originalWidth];
    originalHeight = [(PLManagedAsset *)selfCopy originalHeight];
    if (originalWidth >= 1 && originalHeight >= 1)
    {
      v95 = originalHeight;
      v96 = [(PLManagedAsset *)selfCopy originalOrientation]- 5;
      if (v96 >= 4)
      {
        v97 = originalWidth;
      }

      else
      {
        v97 = v95;
      }

      if (v96 < 4)
      {
        v95 = originalWidth;
      }

      if (v97 != [(PLManagedAsset *)selfCopy width])
      {
        [(PLManagedAsset *)selfCopy setWidth:v97];
      }

      if (v95 != [(PLManagedAsset *)selfCopy height])
      {
        [(PLManagedAsset *)selfCopy setHeight:v95];
      }
    }

    v90 = [(PLManagedAsset *)selfCopy masterResourceForCPLType:1];
    uniformTypeIdentifier2 = [v90 uniformTypeIdentifier];
    identifier = [uniformTypeIdentifier2 identifier];

    if (identifier)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v100 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v100, OS_LOG_TYPE_DEBUG))
        {
          [v90 singleLineDescription];
          v101 = adjustedStableHash;
          v103 = v102 = adjustedMediaMetaDataType;
          *buf = 138412546;
          *v167 = identifier;
          *&v167[8] = 2112;
          *&v167[10] = v103;
          v104 = "Setting uti to %@ from %@";
          v105 = v100;
          v106 = OS_LOG_TYPE_DEBUG;
          goto LABEL_172;
        }

LABEL_173:
      }

LABEL_174:
      [(PLManagedAsset *)selfCopy setUniformTypeIdentifier:identifier];
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v117 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v117, OS_LOG_TYPE_ERROR))
      {
        singleLineDescription3 = [v90 singleLineDescription];
        *buf = 138412290;
        *v167 = singleLineDescription3;
        v119 = "Original resource %@ is missing uti";
        goto LABEL_178;
      }

LABEL_179:
    }

LABEL_180:

LABEL_181:
  }

  v62 = [v138 copy];

  changeCopy = v145;
LABEL_183:

LABEL_184:

  return v62;
}

- (void)rm_createAssetResourcesForCPLResources:(id)resources inLibrary:(id)library
{
  v42 = *MEMORY[0x1E69E9840];
  resourcesCopy = resources;
  libraryCopy = library;
  selfCopy = self;
  bestResourceTypeForAdjustedStableHash = [(PLManagedAsset *)self bestResourceTypeForAdjustedStableHash];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  obj = resourcesCopy;
  v8 = [obj countByEnumeratingWithState:&v31 objects:v41 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = 0;
    v11 = MEMORY[0x1E6994D48];
    v30 = *v32;
    selfCopy2 = selfCopy;
    while (1)
    {
      v13 = 0;
      v27 = v9;
      do
      {
        if (*v32 != v30)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v31 + 1) + 8 * v13);
        resourceType = [v14 resourceType];
        v16 = [(PLManagedAsset *)selfCopy2 assetResourceForCPLType:resourceType];
        if (v16)
        {
          if (*v11)
          {
            goto LABEL_15;
          }

          v17 = __CPLAssetsdOSLogDomain();
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
          {
            goto LABEL_14;
          }

          [v16 singleLineDescription];
          v18 = v11;
          v19 = v10;
          v21 = v20 = bestResourceTypeForAdjustedStableHash;
          cloudAssetGUID = [(PLManagedAsset *)selfCopy2 cloudAssetGUID];
          *buf = 138412802;
          v36 = v14;
          v37 = 2112;
          v38 = v21;
          v39 = 2112;
          v40 = cloudAssetGUID;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Applying properties from CPLResource %@ to local cloudResource %@ for asset %@", buf, 0x20u);

          bestResourceTypeForAdjustedStableHash = v20;
          v10 = v19;
          v11 = v18;
          v9 = v27;
          goto LABEL_13;
        }

        if (*v11)
        {
          goto LABEL_15;
        }

        v17 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
        {
          cloudAssetGUID = [(PLManagedAsset *)selfCopy2 cloudAssetGUID];
          *buf = 138412546;
          v36 = 0;
          v37 = 2112;
          v38 = cloudAssetGUID;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEBUG, "Created new cloudResource %@ for asset %@", buf, 0x16u);
LABEL_13:

          selfCopy2 = selfCopy;
        }

LABEL_14:

LABEL_15:
        v23 = [(PLManagedAsset *)selfCopy2 storedResourceForCPLResource:v14 asset:selfCopy2 adjusted:1];
        if (resourceType == bestResourceTypeForAdjustedStableHash)
        {
          stableHash = [v14 stableHash];

          v10 = stableHash;
        }

        ++v13;
      }

      while (v9 != v13);
      v9 = [obj countByEnumeratingWithState:&v31 objects:v41 count:16];
      if (!v9)
      {
        goto LABEL_21;
      }
    }
  }

  v10 = 0;
  selfCopy2 = self;
LABEL_21:

  additionalAttributes = [(PLManagedAsset *)selfCopy2 additionalAttributes];
  [additionalAttributes setAdjustedStableHash:v10];
}

- (id)rm_cplExpungeableMasterResourceStates
{
  v18 = *MEMORY[0x1E69E9840];
  allMasterCPLResources = [(PLManagedAsset *)self allMasterCPLResources];
  array = [MEMORY[0x1E695DF70] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = allMasterCPLResources;
  v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v14;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v14 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v13 + 1) + 8 * i);
        if ([v9 supportsTrashedState])
        {
          expungeableResourceStateRepresentation = [v9 expungeableResourceStateRepresentation];
          [array addObject:expungeableResourceStateRepresentation];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v6);
  }

  v11 = [array copy];

  return v11;
}

- (id)rm_cplMasterResourcesFromCloudMaster:(id)master addOriginalResourceMode:(BOOL)mode
{
  modeCopy = mode;
  v55 = *MEMORY[0x1E69E9840];
  masterCopy = master;
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v41 = objc_alloc_init(MEMORY[0x1E695DF70]);
  mainFileURL = [(PLManagedAsset *)self mainFileURL];
  selfCopy = self;
  master = [(PLManagedAsset *)self master];
  LODWORD(self) = [master placeholderState];

  selfCopy2 = self;
  v33 = mainFileURL;
  v35 = defaultManager;
  if (self == 1)
  {
    v9 = 0;
  }

  else
  {
    path = [mainFileURL path];
    v9 = [defaultManager fileExistsAtPath:path];
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = @"NO";
      if (v9)
      {
        v12 = @"YES";
      }

      *buf = 138412290;
      v49 = v12;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Reusing existing cloud resources, canGenerateDerivative: %@", buf, 0xCu);
    }
  }

  fingerprintScheme = [masterCopy fingerprintScheme];
  v44 = 0u;
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  modernResources = [(PLManagedAsset *)selfCopy modernResources];
  v14 = [modernResources countByEnumeratingWithState:&v44 objects:v54 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v45;
    do
    {
      v17 = 0;
      v18 = v41;
      do
      {
        if (*v45 != v16)
        {
          objc_enumerationMutation(modernResources);
        }

        v19 = *(*(&v44 + 1) + 8 * v17);
        if ([(__CFString *)v19 isCPLMasterResource])
        {
          if (modeCopy && ![(__CFString *)v19 cloudLocalState]&& [(__CFString *)v19 isCPLOriginalResource]&& [(__CFString *)v19 isLocallyAvailable])
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v20 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                *buf = 138412290;
                v49 = v19;
                _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEFAULT, "addOriginalResourceMode, including file for cplResource: %@", buf, 0xCu);
              }
            }

            v21 = objc_opt_class();
            cplType = [(__CFString *)v19 cplType];
            fileURL = [(__CFString *)v19 fileURL];
            v43 = 0;
            LOBYTE(v21) = [(PLManagedAsset *)selfCopy setFingerprintAndStableHashOnInternalResource:v19 recordClass:v21 resourceType:cplType resourceFileURL:fileURL fingerprintScheme:fingerprintScheme error:&v43];
            v24 = v43;

            v18 = v41;
            if ((v21 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v25 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
              {
                fileURL2 = [(__CFString *)v19 fileURL];
                path2 = [fileURL2 path];
                scopedIdentifier = [(PLManagedAsset *)selfCopy scopedIdentifier];
                *buf = 138412802;
                v49 = path2;
                v50 = 2112;
                v51 = scopedIdentifier;
                v52 = 2112;
                v53 = v24;
                _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "Failed to generate fingerprint for path %@ uuid %@. Error: %@", buf, 0x20u);

                v18 = v41;
              }
            }

            v27 = 1;
          }

          else
          {
            v27 = 0;
          }

          v28 = [(__CFString *)v19 cplResourceIncludeFile:v27];
          v29 = v28;
          if (v28)
          {
            if (v27)
            {
              [v28 setCanGenerateDerivative:v9];
              [(__CFString *)v19 setRemoteAvailability:1];
            }

            else
            {
              [v28 setCanGenerateDerivative:!modeCopy & v9];
            }

            if (selfCopy2 == 1)
            {
              [v29 setSourceResourceType:{-[__CFString cloudSourceType](v19, "cloudSourceType")}];
            }

            [v18 addObject:v29];
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v30 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
            {
              scopedIdentifier2 = [masterCopy scopedIdentifier];
              *buf = 138412546;
              v49 = v19;
              v50 = 2112;
              v51 = scopedIdentifier2;
              _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_ERROR, "Unable to create CPLResource from %@ with scopedIdentifier %@", buf, 0x16u);

              v18 = v41;
            }
          }
        }

        ++v17;
      }

      while (v15 != v17);
      v15 = [modernResources countByEnumeratingWithState:&v44 objects:v54 count:16];
    }

    while (v15);
  }

  return v41;
}

- (id)rm_cplMasterResourceForResourceType:(unint64_t)type
{
  v15 = *MEMORY[0x1E69E9840];
  v5 = [(PLManagedAsset *)self masterResourceForCPLType:?];
  v6 = v5;
  if (v5)
  {
    v7 = [v5 cplResourceIncludeFile:1];
  }

  else
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
      {
        v9 = [MEMORY[0x1E6994B90] descriptionForResourceType:type];
        v11 = 138412546;
        v12 = v9;
        v13 = 2112;
        selfCopy = self;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEBUG, "Unable to find master resource %@ in asset %@", &v11, 0x16u);
      }
    }

    v7 = 0;
  }

  return v7;
}

- (id)rm_cplResourceForResourceType:(unint64_t)type
{
  v5 = [(PLManagedAsset *)self assetResourceForCPLType:?];
  v6 = v5;
  if (v5)
  {
    [v5 cplResourceIncludeFile:1];
  }

  else
  {
    [(PLManagedAsset *)self rm_cplMasterResourceForResourceType:type];
  }
  v7 = ;

  return v7;
}

- (void)_rm_insertResource:(id)resource forOtherDuplicatedAssetInMaster:(id)master inPhotoLibrary:(id)library
{
  v36 = *MEMORY[0x1E69E9840];
  resourceCopy = resource;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  masterCopy = master;
  obj = [masterCopy assets];
  v8 = [obj countByEnumeratingWithState:&v25 objects:v35 count:16];
  if (v8)
  {
    v10 = v8;
    v11 = *v26;
    *&v9 = 138412802;
    v22 = v9;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v26 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v25 + 1) + 8 * i);
        uuid = [v13 uuid];
        uuid2 = [(PLManagedAsset *)self uuid];
        v16 = [uuid isEqualToString:uuid2];

        if ((v16 & 1) == 0)
        {
          v17 = [v13 _rm_localResourceURLForResource:resourceCopy];
          v18 = [resourceCopy validatedExternalResourceRepresentationUsingFileURL:v17];
          [PLManagedAsset _rm_copyResourceFileFrom:resourceCopy to:v18 forCloudMaster:masterCopy andAsset:v13];
          v19 = [(PLManagedAsset *)self storedResourceForExternalResource:v18 asset:v13];
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v20 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
            {
              uuid3 = [v13 uuid];
              *buf = v22;
              v30 = v19;
              v31 = 2112;
              v32 = masterCopy;
              v33 = 2112;
              v34 = uuid3;
              _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEFAULT, "Creating new internalResource %@ for master %@ (asset: %@)", buf, 0x20u);
            }
          }
        }
      }

      v10 = [obj countByEnumeratingWithState:&v25 objects:v35 count:16];
    }

    while (v10);
  }
}

- (id)_rm_localResourceURLForResource:(id)resource
{
  v3 = [(PLManagedAsset *)self localResourcePathForMasterResource:resource];
  if (v3)
  {
    v4 = [MEMORY[0x1E695DFF8] fileURLWithPath:v3 isDirectory:0];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)rm_createMasterResourcesForCPLResources:(id)resources master:(id)master inLibrary:(id)library
{
  v46 = *MEMORY[0x1E69E9840];
  resourcesCopy = resources;
  masterCopy = master;
  libraryCopy = library;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v43 = 0u;
  obj = resourcesCopy;
  v9 = [obj countByEnumeratingWithState:&v40 objects:v45 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v41;
    v30 = *v41;
    v31 = masterCopy;
    do
    {
      v12 = 0;
      v32 = v10;
      do
      {
        if (*v41 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v40 + 1) + 8 * v12);
        v14 = objc_autoreleasePoolPush();
        v15 = [masterCopy rm_assetAttachedResourcesForResourceType:{objc_msgSend(v13, "resourceType")}];
        if ([v15 count])
        {
          v38 = 0u;
          v39 = 0u;
          v36 = 0u;
          v37 = 0u;
          v16 = v15;
          v17 = [v16 countByEnumeratingWithState:&v36 objects:v44 count:16];
          if (v17)
          {
            v18 = v17;
            v19 = *v37;
            do
            {
              for (i = 0; i != v18; ++i)
              {
                if (*v37 != v19)
                {
                  objc_enumerationMutation(v16);
                }

                v21 = *(*(&v36 + 1) + 8 * i);
                asset = [v21 asset];

                if (asset)
                {
                  asset2 = [v21 asset];
                  asset3 = [v21 asset];
                  v25 = [asset2 storedResourceForCPLResource:v13 asset:asset3 adjusted:0];
                }
              }

              v18 = [v16 countByEnumeratingWithState:&v36 objects:v44 count:16];
            }

            while (v18);
            v11 = v30;
            masterCopy = v31;
            v10 = v32;
          }
        }

        else
        {
          v16 = [(PLManagedAsset *)self storedResourceForCPLResource:v13 asset:self adjusted:0];
          [(PLManagedAsset *)self _rm_insertResource:v16 forOtherDuplicatedAssetInMaster:masterCopy inPhotoLibrary:libraryCopy];
        }

        objc_autoreleasePoolPop(v14);
        ++v12;
      }

      while (v12 != v10);
      v10 = [obj countByEnumeratingWithState:&v40 objects:v45 count:16];
    }

    while (v10);
  }

  rm_assetUUIDToAssetAttachedResources = [masterCopy rm_assetUUIDToAssetAttachedResources];
  v34[0] = MEMORY[0x1E69E9820];
  v34[1] = 3221225472;
  v34[2] = __83__PLManagedAsset_RM_CPL__rm_createMasterResourcesForCPLResources_master_inLibrary___block_invoke;
  v34[3] = &unk_1E7576760;
  v35 = libraryCopy;
  v27 = libraryCopy;
  [rm_assetUUIDToAssetAttachedResources enumerateKeysAndObjectsUsingBlock:v34];
}

void __83__PLManagedAsset_RM_CPL__rm_createMasterResourcesForCPLResources_master_inLibrary___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v21 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 indexOfObjectPassingTest:&__block_literal_global_108441];
  if (v5 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v6 = [v4 objectAtIndexedSubscript:v5];
    [v6 setRemoteAvailability:1];
    v7 = [v4 indexOfObjectPassingTest:&__block_literal_global_51_108442];
    if (v7 != 0x7FFFFFFFFFFFFFFFLL)
    {
      v8 = [v4 objectAtIndexedSubscript:v7];
      v9 = [v8 fileURL];
      v10 = MEMORY[0x1E6994D48];
      if (v9)
      {
        v11 = [MEMORY[0x1E696AC08] defaultManager];
        v16 = 0;
        [v11 removeItemAtURL:v9 error:&v16];
        v12 = v16;

        if ((*v10 & 1) == 0)
        {
          v13 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            v18 = v9;
            v19 = 2112;
            v20 = v12;
            _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Removing %@ error: %@", buf, 0x16u);
          }
        }
      }

      if ((*v10 & 1) == 0)
      {
        v14 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v18 = v8;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Deleting %@", buf, 0xCu);
        }
      }

      v15 = [*(a1 + 32) managedObjectContext];
      [v15 deleteObject:v8];
    }
  }
}

- (void)rm_createMasterResourcesIn:(id)in inManagedObjectContext:(id)context
{
  v18 = *MEMORY[0x1E69E9840];
  inCopy = in;
  [(PLManagedAsset *)self rm_createNewResourcesIn:inCopy inManagedObjectContext:context];
  v7 = [(PLManagedAsset *)self masterResourceForCPLType:1];
  v8 = v7;
  if (v7)
  {
    unorientedWidth = [v7 unorientedWidth];
    unorientedHeight = [v8 unorientedHeight];
    [(PLManagedAsset *)self setOriginalWidth:unorientedWidth];
    [(PLManagedAsset *)self setOriginalHeight:unorientedHeight];
    if (![(PLManagedAsset *)self hasAdjustments]|| ![(PLManagedAsset *)self width]&& ![(PLManagedAsset *)self height])
    {
      v11 = [(PLManagedAsset *)self originalOrientation]- 5;
      if (v11 >= 4)
      {
        v12 = unorientedWidth;
      }

      else
      {
        v12 = unorientedHeight;
      }

      if (v11 >= 4)
      {
        unorientedWidth = unorientedHeight;
      }

      if (v12 != [(PLManagedAsset *)self width])
      {
        [(PLManagedAsset *)self setWidth:v12];
      }

      if (unorientedWidth != [(PLManagedAsset *)self height])
      {
        [(PLManagedAsset *)self setHeight:unorientedWidth];
      }
    }

    -[PLManagedAsset setOriginalFilesize:](self, "setOriginalFilesize:", [v8 dataLength]);
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v13 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = 138412546;
      v15 = inCopy;
      v16 = 2112;
      selfCopy = self;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Unable to find original resource in cloudMaster %@ for asset %@", &v14, 0x16u);
    }
  }
}

- (BOOL)rm_createNewResourcesIn:(id)in inManagedObjectContext:(id)context
{
  v73 = *MEMORY[0x1E69E9840];
  inCopy = in;
  contextCopy = context;
  modernResources = [inCopy modernResources];
  v9 = [modernResources copy];

  if (![v9 count])
  {
    uuid = [(PLManagedAsset *)self uuid];
    rm_assetUUIDToAssetAttachedResources = [inCopy rm_assetUUIDToAssetAttachedResources];
    if (![rm_assetUUIDToAssetAttachedResources count])
    {
      if (*MEMORY[0x1E6994D48])
      {
        v24 = 0;
        goto LABEL_43;
      }

      v28 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v67 = inCopy;
        v68 = 2112;
        selfCopy2 = self;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "No resources at all for cloudMaster %@, unable to create master resources for asset %@", buf, 0x16u);
      }

      v24 = 0;
LABEL_42:

LABEL_43:
      goto LABEL_44;
    }

    v26 = objc_alloc(MEMORY[0x1E695DFA8]);
    allKeys = [rm_assetUUIDToAssetAttachedResources allKeys];
    v28 = [v26 initWithArray:allKeys];

    [v28 removeObject:uuid];
    anyObject = [v28 anyObject];
    v30 = [rm_assetUUIDToAssetAttachedResources objectForKey:anyObject];
    v31 = [v30 count];
    v24 = v31 != 0;
    v52 = v30;
    if (v31)
    {
      v49 = anyObject;
      v50 = v28;
      v51 = v9;
      v32 = inCopy;
      v33 = [rm_assetUUIDToAssetAttachedResources objectForKeyedSubscript:uuid];
      v34 = [v33 count];
      v35 = [v30 count];

      if (v34 < v35)
      {
        v56 = 0u;
        v57 = 0u;
        v54 = 0u;
        v55 = 0u;
        obj = v30;
        v36 = [obj countByEnumeratingWithState:&v54 objects:v70 count:16];
        if (v36)
        {
          v37 = v36;
          v47 = v24;
          v48 = rm_assetUUIDToAssetAttachedResources;
          v38 = *v55;
          do
          {
            for (i = 0; i != v37; ++i)
            {
              if (*v55 != v38)
              {
                objc_enumerationMutation(obj);
              }

              v40 = *(*(&v54 + 1) + 8 * i);
              v41 = [(PLManagedAsset *)self _rm_localResourceURLForResource:v40];
              v42 = [v40 validatedExternalResourceRepresentationUsingFileURL:v41];
              [PLManagedAsset _rm_copyResourceFileFrom:v40 to:v42 forCloudMaster:v32 andAsset:self];
              v43 = [(PLManagedAsset *)self storedResourceForExternalResource:v42 asset:self];
            }

            v37 = [obj countByEnumeratingWithState:&v54 objects:v70 count:16];
          }

          while (v37);
          inCopy = v32;
          v28 = v50;
          v9 = v51;
          rm_assetUUIDToAssetAttachedResources = v48;
          v24 = v47;
        }

        else
        {
          inCopy = v32;
          v28 = v50;
          v9 = v51;
        }

        anyObject = v49;
        v44 = obj;
LABEL_40:

        goto LABEL_41;
      }

      inCopy = v32;
      v28 = v50;
      v9 = v51;
      anyObject = v49;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v44 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v44, OS_LOG_TYPE_DEFAULT))
        {
          uuid2 = [(PLManagedAsset *)self uuid];
          *buf = 138412290;
          v67 = uuid2;
          _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_DEFAULT, "Already have master resources for asset %@", buf, 0xCu);
        }

        goto LABEL_40;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v44 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v67 = inCopy;
        v68 = 2112;
        selfCopy2 = self;
        _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "No resources on other assets for cloudMaster %@, unable to create master resources for asset %@", buf, 0x16u);
      }

      goto LABEL_40;
    }

LABEL_41:

    goto LABEL_42;
  }

  v64 = 0u;
  v65 = 0u;
  v62 = 0u;
  v63 = 0u;
  v10 = v9;
  v11 = [v10 countByEnumeratingWithState:&v62 objects:v72 count:16];
  if (v11)
  {
    v12 = v11;
    v13 = *v63;
    do
    {
      for (j = 0; j != v12; ++j)
      {
        if (*v63 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v62 + 1) + 8 * j);
        v16 = [(PLManagedAsset *)self _rm_localResourceURLForResource:v15];
        v17 = [v15 validatedExternalResourceRepresentationUsingFileURL:v16];
        v18 = [(PLManagedAsset *)self storedResourceForExternalResource:v17 asset:self];
      }

      v12 = [v10 countByEnumeratingWithState:&v62 objects:v72 count:16];
    }

    while (v12);
  }

  v60 = 0u;
  v61 = 0u;
  v58 = 0u;
  v59 = 0u;
  uuid = v10;
  v20 = [uuid countByEnumeratingWithState:&v58 objects:v71 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v59;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v59 != v22)
        {
          objc_enumerationMutation(uuid);
        }

        [contextCopy deleteObject:*(*(&v58 + 1) + 8 * k)];
      }

      v21 = [uuid countByEnumeratingWithState:&v58 objects:v71 count:16];
    }

    while (v21);
  }

  v24 = 1;
LABEL_44:

  return v24;
}

- (id)storedResourceForExternalResource:(id)resource asset:(id)asset
{
  v20 = *MEMORY[0x1E69E9840];
  resourceCopy = resource;
  assetCopy = asset;
  assetID = [assetCopy assetID];
  libraryID = [assetID libraryID];
  v9 = [PLResourceDataStoreManager storeForExternalResource:resourceCopy inLibraryWithID:libraryID];

  v14 = 0;
  v15 = 0;
  LOBYTE(assetID) = [v9 storeExternalResource:resourceCopy forAsset:assetCopy options:0 error:&v15 resultingResource:&v14];

  v10 = v15;
  v11 = v14;
  if ((assetID & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v12 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v17 = resourceCopy;
      v18 = 2112;
      v19 = v10;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Failed to store external resource %@, reason: %@", buf, 0x16u);
    }
  }

  return v11;
}

- (id)storedResourceForCPLResource:(id)resource asset:(id)asset adjusted:(BOOL)adjusted
{
  adjustedCopy = adjusted;
  assetCopy = asset;
  v9 = [PLResourceInstaller generateExternalResourceFromCPLResource:resource asset:assetCopy fromAdjustedSet:adjustedCopy];
  v10 = [(PLManagedAsset *)self storedResourceForExternalResource:v9 asset:assetCopy];

  return v10;
}

- (BOOL)hasAdjustedCPLThumbResource
{
  v13 = *MEMORY[0x1E69E9840];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v3 = [modernResources countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = *v9;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v9 != v4)
        {
          objc_enumerationMutation(modernResources);
        }

        v6 = *(*(&v8 + 1) + 8 * i);
        if ([v6 cplType] == 5 && (objc_msgSend(v6, "isAdjustedResource") & 1) != 0)
        {
          LOBYTE(v3) = 1;
          goto LABEL_12;
        }
      }

      v3 = [modernResources countByEnumeratingWithState:&v8 objects:v12 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  return v3;
}

- (id)allCPLResourcesForPruning
{
  v17 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v5 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(modernResources);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ((([v9 isCPLAssetResource] & 1) != 0 || objc_msgSend(v9, "isCPLMasterResource")) && ((objc_msgSend(v9, "isLocallyAvailable") & 1) != 0 || objc_msgSend(v9, "cplType") == 5))
        {
          [v3 addObject:v9];
        }
      }

      v6 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v6);
  }

  allObjects = [v3 allObjects];

  return allObjects;
}

- (id)allMasterCPLResources
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v5 = [modernResources countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v12;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(modernResources);
        }

        v9 = *(*(&v11 + 1) + 8 * i);
        if ([v9 isCPLMasterResource])
        {
          [v3 addObject:v9];
        }
      }

      v6 = [modernResources countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  return v3;
}

- (id)allAssetCPLResources
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v5 = [modernResources countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v12;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(modernResources);
        }

        v9 = *(*(&v11 + 1) + 8 * i);
        if ([v9 isCPLAssetResource])
        {
          [v3 addObject:v9];
        }
      }

      v6 = [modernResources countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  return v3;
}

- (id)assetResourceForCPLType:(unint64_t)type
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v5 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(modernResources);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 cplType] == type && objc_msgSend(v9, "isCPLAssetResource"))
        {
          v10 = v9;
          goto LABEL_12;
        }
      }

      v6 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_12:

  return v10;
}

- (id)masterResourceForCPLType:(unint64_t)type
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v5 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(modernResources);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 cplType] == type && objc_msgSend(v9, "isCPLMasterResource"))
        {
          v10 = v9;
          goto LABEL_12;
        }
      }

      v6 = [modernResources countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_12:

  return v10;
}

- (id)resourceForCPLType:(unint64_t)type version:(unsigned int)version
{
  v19 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v7 = [modernResources countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(modernResources);
        }

        v11 = *(*(&v14 + 1) + 8 * i);
        if ([v11 cplType] == type && objc_msgSend(v11, "version") == version)
        {
          v12 = v11;
          goto LABEL_12;
        }
      }

      v8 = [modernResources countByEnumeratingWithState:&v14 objects:v18 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  v12 = 0;
LABEL_12:

  return v12;
}

+ (void)rm_cplResourceWasUploaded:(id)uploaded photoLibrary:(id)library
{
  v25 = *MEMORY[0x1E69E9840];
  uploadedCopy = uploaded;
  libraryCopy = library;
  v7 = objc_alloc_init(MEMORY[0x1E695DF70]);
  itemScopedIdentifier = [uploadedCopy itemScopedIdentifier];
  v9 = [PLManagedAsset assetWithScopedIdentifier:itemScopedIdentifier inLibrary:libraryCopy prefetchResources:1];
  resourceType = [uploadedCopy resourceType];
  if (v9)
  {
    v11 = [v9 assetResourceForCPLType:resourceType];
    if (v11)
    {
      [v7 addObject:v11];
    }
  }

  else
  {
    v12 = [PLCloudMaster cloudMasterWithScopedIdentifier:itemScopedIdentifier prefetchResources:1 inLibrary:libraryCopy];
    v11 = v12;
    if (v12)
    {
      v13 = [v12 rm_assetAttachedResourcesForResourceType:resourceType];
      [v7 addObjectsFromArray:v13];
    }
  }

  v22 = 0u;
  v23 = 0u;
  v20 = 0u;
  v21 = 0u;
  v14 = v7;
  v15 = [v14 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v21;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v21 != v17)
        {
          objc_enumerationMutation(v14);
        }

        v19 = *(*(&v20 + 1) + 8 * i);
        if ([v19 cloudLocalState] != 3)
        {
          [v19 setCloudLocalState:3];
        }

        if ([v19 remoteAvailability] != 1)
        {
          [v19 setRemoteAvailability:1];
        }
      }

      v16 = [v14 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v16);
  }
}

+ (void)_rm_copyResourceFileFrom:(id)from to:(id)to forCloudMaster:(id)master andAsset:(id)asset
{
  v49 = *MEMORY[0x1E69E9840];
  fromCopy = from;
  toCopy = to;
  masterCopy = master;
  assetCopy = asset;
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  fileURL = [fromCopy fileURL];
  path = [fileURL path];

  fileURL2 = [toCopy fileURL];
  path2 = [fileURL2 path];

  if (path && path2 && [defaultManager fileExistsAtPath:path] && (objc_msgSend(defaultManager, "fileExistsAtPath:", path2) & 1) == 0)
  {
    pathManager = [assetCopy pathManager];
    isUBF = [pathManager isUBF];
    if (isUBF)
    {
      v34 = pathManager;
      assetID = [assetCopy assetID];
      v40 = [masterCopy originalFilenameForResourceType:objc_msgSend(toCopy filePath:{"cplTypeWithAssetID:", assetID), path2}];

      if ([fromCopy resourceType] == 16)
      {
        currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
        [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM+CPL.m" lineNumber:253 description:{@"Invalid parameter not satisfying: %@", @"fromResource.resourceType != PLResourceTypeContextualVideoThumbnail"}];
      }

      v38 = objc_alloc(MEMORY[0x1E69BF298]);
      uuid = [assetCopy uuid];
      bundleScope = [assetCopy bundleScope];
      uniformTypeIdentifier = [toCopy uniformTypeIdentifier];
      identifier = [uniformTypeIdentifier identifier];
      v39 = [v38 initWithAssetUuid:uuid bundleScope:bundleScope uti:identifier resourceVersion:0 resourceType:objc_msgSend(toCopy recipeID:"resourceType") originalFilename:objc_msgSend(toCopy customSuffix:{"recipeID"), v40, 0}];

      pathManager = v34;
    }

    else
    {
      v39 = 0;
    }

    [path2 stringByDeletingLastPathComponent];
    v37 = v42[1] = 0;
    v24 = [defaultManager createDirectoryIfNeededAtPath:? error:?];
    v41 = 0;
    if (!v24)
    {
      v30 = v37;
      if (*MEMORY[0x1E6994D48])
      {
LABEL_25:

        goto LABEL_26;
      }

      v26 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v44 = v37;
        v45 = 2112;
        v46 = v41;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Failed to create directory for resource file at %@. Error: %@", buf, 0x16u);
      }

LABEL_24:

      goto LABEL_25;
    }

    v42[0] = 0;
    v25 = [defaultManager copyItemAtPath:path toPath:path2 error:v42];
    v26 = v42[0];
    if (v25)
    {
      v35 = pathManager;
      assetID2 = [assetCopy assetID];
      v28 = [toCopy cplTypeWithAssetID:assetID2];

      if (v28 == 1)
      {
        [assetCopy persistMetadataToFilesystem];
      }

      pathManager = v35;
      if (!isUBF)
      {
        if (PLResourceIsOriginalNonDerivativeWithType(toCopy))
        {
          [toCopy persistResourceTypeToFileURL];
        }

        goto LABEL_23;
      }

      v29 = [MEMORY[0x1E695DFF8] fileURLWithPath:path2 isDirectory:0];
      [v35 setExtendedAttributesWithIdentifier:v39 andURL:v29];
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_23:
        v30 = v37;
        goto LABEL_24;
      }

      v29 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v44 = path;
        v45 = 2112;
        v46 = path2;
        v47 = 2112;
        v48 = v26;
        _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "Failed to copy master resource file from %@ to duplicated asset %@. Error: %@", buf, 0x20u);
      }
    }

    goto LABEL_23;
  }

LABEL_26:
}

- (unsigned)fullSizeRenderResourceRecipeID
{
  kind = [(PLManagedAsset *)self kind];
  if (kind > 3)
  {
    return 0;
  }

  else
  {
    return dword_19C60B0B0[kind];
  }
}

- (BOOL)requiresVideoComplementDeferredFinalization
{
  pathForDeferredVideoComplementFile = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];

  if (pathForDeferredVideoComplementFile)
  {
    if ([(PLManagedAsset *)self videoDeferredProcessingNeeded])
    {
      return 1;
    }

    v5 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:131280 andVersion:0];
    if ([v5 count] == 1)
    {
      persistedOriginalVideoComplementResource = [(PLManagedAsset *)self persistedOriginalVideoComplementResource];

      if (!persistedOriginalVideoComplementResource)
      {
        return 1;
      }
    }

    else
    {
    }
  }

  return 0;
}

- (BOOL)requiresImageDeferredFinalization
{
  fileURLForCurrentDeferredProcessingPreviewFile = [(PLManagedAsset *)self fileURLForCurrentDeferredProcessingPreviewFile];

  if (!fileURLForCurrentDeferredProcessingPreviewFile)
  {
    return 0;
  }

  deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
  result = 1;
  if (deferredProcessingNeeded != 1 && deferredProcessingNeeded != 10)
  {
    return [(PLManagedAsset *)self resourceModelIndicatesImageDeferredFinalizationNeeded];
  }

  return result;
}

- (BOOL)resourceModelIndicatesImageDeferredFinalizationNeeded
{
  v3 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:65944 andVersion:0];
  v4 = 0;
  if ([v3 count] == 1)
  {
    persistedOriginalImageResource = [(PLManagedAsset *)self persistedOriginalImageResource];
    v4 = persistedOriginalImageResource == 0;
  }

  return v4;
}

- (BOOL)resourceModelIndicatesDeepFusionNeeded
{
  v3 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:65943 andVersion:0];
  v4 = 0;
  if ([v3 count] == 1)
  {
    persistedOriginalImageResource = [(PLManagedAsset *)self persistedOriginalImageResource];
    v4 = persistedOriginalImageResource == 0;
  }

  return v4;
}

- (void)reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker
{
  v46[1] = *MEMORY[0x1E69E9840];
  if (([(PLManagedAsset *)self isDeleted]& 1) == 0 && ![(PLManagedAsset *)self isCloudSharedAsset])
  {
    v3 = [PLResourceRecipe recipeFromID:65944];
    v4 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FC02B8];
    v5 = [MEMORY[0x1E695DFD8] setWithObject:&unk_1F0FBEE30];
    v6 = [PLResourceGenerator locallyUnavailableRecipesFromRecipes:v4 versions:v5 asset:self];

    v7 = [v6 containsObject:v3];
    v8 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_265_113176];

    if (v7 && !v8)
    {
      mainFileURL = [(PLManagedAsset *)self mainFileURL];
      path = [mainFileURL path];
      width = [(PLManagedAsset *)self width];
      height = [(PLManagedAsset *)self height];
      LOWORD(v40) = [(PLManagedAsset *)self kind];
      v13 = [PLResourceInstaller generateValidatedExternalImageResourceOfType:0 forFilePath:path requireFileToBePresent:0 version:0 basedOnFullSizeWidth:width andHeight:height recipe:v3 assetKind:v40 error:0];

      v46[0] = v13;
      v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v46 count:1];
      v15 = [PLResourceDataStoreManager storeExternalResources:v14 forAsset:self forLifecycleEvent:2 error:0];

      anyObject = [v15 anyObject];
      v17 = anyObject;
      if (anyObject)
      {
        [anyObject setLocalAvailabilityTarget:1];
        v18 = PLImageManagerGetLog();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          uuid = [(PLManagedAsset *)self uuid];
          *buf = 138543618;
          v43 = v3;
          v44 = 2114;
          v45 = uuid;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEFAULT, "[RM]: Scheduling generation of recipe: %{public}@ for asset uuid: %{public}@...", buf, 0x16u);
        }
      }

      photoLibrary = [(PLManagedObject *)self photoLibrary];
      libraryServicesManager = [photoLibrary libraryServicesManager];
      backgroundJobService = [libraryServicesManager backgroundJobService];
      [backgroundJobService signalBackgroundProcessingNeededOnLibrary:photoLibrary];
    }

    v23 = [PLResourceRecipe recipeFromID:131280];
    v24 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FC02D0];
    v25 = [MEMORY[0x1E695DFD8] setWithObject:&unk_1F0FBEE30];
    v26 = [PLResourceGenerator locallyUnavailableRecipesFromRecipes:v24 versions:v25 asset:self];

    v27 = [v26 containsObject:v23];
    v28 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_271_113178];
    v29 = v28;
    if (v27 && !v28)
    {
      v30 = objc_alloc_init(PLValidatedExternalResource);
      [(PLValidatedExternalResource *)v30 setResourceType:3];
      [(PLValidatedExternalResource *)v30 setVersion:0];
      -[PLValidatedExternalResource setRecipeID:](v30, "setRecipeID:", [v23 recipeID]);
      v41 = v30;
      v31 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v41 count:1];
      v32 = [PLResourceDataStoreManager storeExternalResources:v31 forAsset:self forLifecycleEvent:2 error:0];

      anyObject2 = [v32 anyObject];
      v34 = anyObject2;
      if (anyObject2)
      {
        [anyObject2 setLocalAvailabilityTarget:1];
        v35 = PLImageManagerGetLog();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
        {
          uuid2 = [(PLManagedAsset *)self uuid];
          *buf = 138543618;
          v43 = v23;
          v44 = 2114;
          v45 = uuid2;
          _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_DEFAULT, "[RM]: Scheduling generation of recipe: %{public}@ for asset uuid: %{public}@...", buf, 0x16u);
        }
      }

      photoLibrary2 = [(PLManagedObject *)self photoLibrary];
      libraryServicesManager2 = [photoLibrary2 libraryServicesManager];
      backgroundJobService2 = [libraryServicesManager2 backgroundJobService];
      [backgroundJobService2 signalBackgroundProcessingNeededOnLibrary:photoLibrary2];
    }
  }
}

BOOL __98__PLManagedAsset_RM__reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker__block_invoke_269(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 recipeID])
  {
    v3 = 0;
  }

  else
  {
    v3 = [v2 resourceType] == 3;
  }

  return v3;
}

BOOL __98__PLManagedAsset_RM__reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 recipeID])
  {
    v3 = 0;
  }

  else
  {
    v3 = [v2 resourceType] == 0;
  }

  return v3;
}

- (BOOL)repairAssetScopeValidationErrors:(id)errors
{
  v71 = *MEMORY[0x1E69E9840];
  errorsCopy = errors;
  v5 = +[PLResourceModelValidationError allPossibleErrorCodes];
  if (![errorsCopy count])
  {
    v6 = v5;

    errorsCopy = v6;
  }

  v7 = [errorsCopy mutableCopy];
  if ([v7 count])
  {
    hasChanges = 0;
    v49 = v5;
    v50 = errorsCopy;
    v48 = v7;
    while (1)
    {
      anyObject = [v7 anyObject];
      integerValue = [anyObject integerValue];
      if (integerValue <= 0xB)
      {
        break;
      }

LABEL_18:
      [v7 removeObject:{anyObject, v47}];

      if (![v7 count])
      {
        goto LABEL_66;
      }
    }

    if (((1 << integerValue) & 0xC14) != 0)
    {
      v10 = anyObject;
      imageRequestHints = [(PLManagedAsset *)self imageRequestHints];
      [(PLManagedAsset *)self recalculateImageRequestHints];
      imageRequestHints2 = [(PLManagedAsset *)self imageRequestHints];
      v52 = imageRequestHints;
      LOBYTE(imageRequestHints) = [imageRequestHints2 isEqualToData:imageRequestHints];

      if (imageRequestHints)
      {
        if ([(PLManagedAsset *)self hasMasterThumb]|| [(PLManagedAsset *)self thumbnailIndex]== -3)
        {
          v13 = PLImageManagerGetLog();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
          {
            objectID = [(PLManagedAsset *)self objectID];
            thumbnailIndex = [(PLManagedAsset *)self thumbnailIndex];
            *buf = 138543874;
            v64 = objectID;
            v65 = 2114;
            v66 = errorsCopy;
            v67 = 1024;
            LODWORD(v68) = thumbnailIndex;
            _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: Attempting to correct broken thumbnailIndex by regenerating thumbnails for objectID: %{public}@ for error codes: %{public}@, current thumbnailIndex: %d...", buf, 0x1Cu);
          }

          [(PLManagedAsset *)self generateAndUpdateThumbnailsWithPreviewImage:0 thumbnailImage:0 fromImageSource:0 imageData:0 forceSRGBConversion:0];
          hasChanges = [(PLManagedAsset *)self hasChanges];
        }
      }

      else
      {
        v16 = PLImageManagerGetLog();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          objectID2 = [(PLManagedAsset *)self objectID];
          thumbnailIndex2 = [(PLManagedAsset *)self thumbnailIndex];
          *buf = 138543874;
          v64 = objectID2;
          v65 = 2114;
          v66 = errorsCopy;
          v67 = 1024;
          LODWORD(v68) = thumbnailIndex2;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: Storing corrections to imageRequestHints for objectID: %{public}@ for error codes: %{public}@,  thumbnailIndex: %d...", buf, 0x1Cu);
        }

        hasChanges = 1;
      }

      [v7 removeObject:&unk_1F0FBEDE8];
      [v7 removeObject:&unk_1F0FBEE00];
      [v7 removeObject:&unk_1F0FBEE18];
      anyObject = v10;
      goto LABEL_17;
    }

    if (integerValue != 8)
    {
      goto LABEL_18;
    }

    v52 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FC02A0];
    if ([v52 count])
    {
      v19 = anyObject;
      v20 = objc_alloc_init(MEMORY[0x1E695DFA8]);
      v59 = 0u;
      v60 = 0u;
      v61 = 0u;
      v62 = 0u;
      modernResources = [(PLManagedAsset *)self modernResources];
      v22 = [modernResources countByEnumeratingWithState:&v59 objects:v70 count:16];
      if (v22)
      {
        v23 = v22;
        v24 = *v60;
        do
        {
          for (i = 0; i != v23; ++i)
          {
            if (*v60 != v24)
            {
              objc_enumerationMutation(modernResources);
            }

            v26 = +[PLResourceRecipe recipeFromID:](PLResourceRecipe, "recipeFromID:", [*(*(&v59 + 1) + 8 * i) recipeID]);
            if (v26)
            {
              [v20 addObject:v26];
            }
          }

          v23 = [modernResources countByEnumeratingWithState:&v59 objects:v70 count:16];
        }

        while (v23);
      }

      v27 = MEMORY[0x1E695DFA8];
      v28 = [v52 set];
      v29 = [v27 setWithSet:v28];

      [v29 minusSet:v20];
      v5 = v49;
      errorsCopy = v50;
      v7 = v48;
      anyObject = v19;
    }

    else
    {
      v29 = 0;
    }

    v51 = v29;
    if (![v29 count])
    {
LABEL_64:

LABEL_17:
      goto LABEL_18;
    }

    v47 = anyObject;
    v57 = 0u;
    v58 = 0u;
    v55 = 0u;
    v56 = 0u;
    v30 = v29;
    v31 = [v30 countByEnumeratingWithState:&v55 objects:v69 count:16];
    if (!v31)
    {
      goto LABEL_63;
    }

    v32 = v31;
    v33 = *v56;
LABEL_36:
    v34 = 0;
    while (1)
    {
      if (*v56 != v33)
      {
        objc_enumerationMutation(v30);
      }

      v35 = *(*(&v55 + 1) + 8 * v34);
      recipeID = [v35 recipeID];
      if (recipeID == 131272)
      {
        break;
      }

      if (recipeID == 0x20000)
      {
        pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        v38 = 1;
        if (!pathForFullsizeRenderVideoFile)
        {
          goto LABEL_55;
        }

        goto LABEL_47;
      }

      if (recipeID != 65938)
      {
        v44 = PLImageManagerGetLog();
        if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
        {
          *buf = 134218242;
          v64 = 8;
          v65 = 2114;
          v66 = v35;
          _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "[RM]: Repair: %ld failed unsupported recipe: %{public}@", buf, 0x16u);
        }

        pathForFullsizeRenderVideoFile = 0;
        goto LABEL_55;
      }

      pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
      v38 = 0;
      if (pathForFullsizeRenderVideoFile)
      {
        goto LABEL_47;
      }

LABEL_55:
      v43 = PLImageManagerGetLog();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 134218242;
        v64 = 8;
        v65 = 2114;
        v66 = v35;
        _os_log_impl(&dword_19BF1F000, v43, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: %ld failed file not found for recipeID: %{public}@", buf, 0x16u);
      }

LABEL_61:

      if (v32 == ++v34)
      {
        v32 = [v30 countByEnumeratingWithState:&v55 objects:v69 count:16];
        if (!v32)
        {
LABEL_63:

          v5 = v49;
          errorsCopy = v50;
          anyObject = v47;
          v7 = v48;
          goto LABEL_64;
        }

        goto LABEL_36;
      }
    }

    pathForFullsizeRenderVideoFile = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
    v38 = 3;
    if (!pathForFullsizeRenderVideoFile)
    {
      goto LABEL_55;
    }

LABEL_47:
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    v40 = [defaultManager fileExistsAtPath:pathForFullsizeRenderVideoFile];

    if (v40)
    {
      v41 = PLImageManagerGetLog();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 134218242;
        v64 = 8;
        v65 = 2114;
        v66 = v35;
        _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: %ld found file on disk for missing recipeID: %{public}@, attempting install", buf, 0x16u);
      }

      v54 = 0;
      v42 = [PLResourceInstaller onDemand_installExistingAdjustedResourceAtFilePath:pathForFullsizeRenderVideoFile withType:v38 recipe:v35 forAsset:self error:&v54];
      v43 = v54;
      if (v42)
      {
        hasChanges = [(PLManagedAsset *)self hasChanges];
      }

      else
      {
        v45 = PLImageManagerGetLog();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
        {
          *buf = 134218498;
          v64 = 8;
          v65 = 2114;
          v66 = v35;
          v67 = 2112;
          v68 = v43;
          _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_ERROR, "[RM]: Repair: %ld failed to install resource with recipeID: %{public}@, error: %@", buf, 0x20u);
        }
      }

      goto LABEL_61;
    }

    goto LABEL_55;
  }

  hasChanges = 0;
LABEL_66:

  return hasChanges & 1;
}

- (BOOL)_installExistingPurgeableResourceAtPath:(id)path dstPath:(id)dstPath error:(id *)error installResourceHandler:(id)handler
{
  v53 = *MEMORY[0x1E69E9840];
  pathCopy = path;
  dstPathCopy = dstPath;
  handlerCopy = handler;
  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v46 = 0;
  v13 = [defaultManager removeItemAtPath:dstPathCopy error:&v46];
  v14 = v46;

  if ((v13 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v48 = dstPathCopy;
      v49 = 2112;
      v50 = v14;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Nonfatal error removing existing resource at path: '%@', error: %@", buf, 0x16u);
    }
  }

  v42 = v14;
  v16 = MEMORY[0x1E69BF238];
  v17 = [MEMORY[0x1E695DFF8] fileURLWithPath:{pathCopy, error}];
  v18 = [MEMORY[0x1E695DFF8] fileURLWithPath:dstPathCopy];
  pathManager = [(PLManagedObject *)self pathManager];
  capabilities = [pathManager capabilities];
  v45 = 0;
  LODWORD(v16) = [v16 ingestItemAtURL:v17 toURL:v18 type:4 options:14 capabilities:capabilities error:&v45];
  v21 = v45;

  if (v16)
  {
    v44 = 0;
    v22 = [MEMORY[0x1E695DFF8] fileURLWithPath:dstPathCopy];
    v23 = [PLCacheDeleteSupport markPurgeableForFileAtURL:v22 withUrgency:0 outInode:&v44];

    if (!v23)
    {
      v32 = PLBackendGetLog();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v48 = dstPathCopy;
        _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_ERROR, "Error marking purgeable at path: '%@'", buf, 0xCu);
      }

      defaultManager2 = [MEMORY[0x1E696AC08] defaultManager];
      v43 = 0;
      v34 = [defaultManager2 removeItemAtPath:dstPathCopy error:&v43];
      v35 = v43;

      v31 = v41;
      if ((v34 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
      {
        v36 = PLBackendGetLog();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v48 = dstPathCopy;
          _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "Error removing file at path: '%@'", buf, 0xCu);
        }
      }

      error = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:47019 userInfo:0];

      goto LABEL_22;
    }

    v24 = handlerCopy[2](handlerCopy);
    if ([v24 isSuccess])
    {
      v25 = v44;
      result = [v24 result];
      [result setFileID:v25];

      v27 = 0;
      v28 = 1;
      goto LABEL_25;
    }

    error = [v24 error];
  }

  else
  {
    v29 = PLBackendGetLog();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412802;
      v48 = pathCopy;
      v49 = 2112;
      v50 = dstPathCopy;
      v51 = 2112;
      v52 = v21;
    }

    error = v21;
  }

  v31 = v41;
LABEL_22:
  v37 = error;
  v27 = v37;
  if (v31)
  {
    v38 = v37;
    *v31 = v27;
  }

  v28 = 0;
LABEL_25:

  return v28;
}

- (id)_originalResources
{
  modernResources = [(PLManagedAsset *)self modernResources];
  v3 = [modernResources _pl_map:&__block_literal_global_245];

  return v3;
}

id __40__PLManagedAsset_RM___originalResources__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 version] || objc_msgSend(v2, "recipeID"))
  {
    v3 = 0;
  }

  else
  {
    v5 = [v2 resourceType];
    v3 = 0;
    if (v5 <= 3 && v5 != 2)
    {
      v3 = v2;
    }
  }

  return v3;
}

- (void)makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:(int64_t)urgency completion:(id)completion
{
  v42[1] = *MEMORY[0x1E69E9840];
  completionCopy = completion;
  _originalResources = [(PLManagedAsset *)self _originalResources];
  if ([_originalResources count])
  {
    photoLibrary = [(PLManagedObject *)self photoLibrary];
    if (photoLibrary)
    {
      v8 = [MEMORY[0x1E695DFA8] set];
      array = [MEMORY[0x1E695DF70] array];
      v10 = dispatch_group_create();
      v36 = 0u;
      v37 = 0u;
      v38 = 0u;
      v39 = 0u;
      v24 = _originalResources;
      obj = _originalResources;
      v11 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v37;
        do
        {
          for (i = 0; i != v12; ++i)
          {
            if (*v37 != v13)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v36 + 1) + 8 * i);
            dispatch_group_enter(v10);
            v30[0] = MEMORY[0x1E69E9820];
            v30[1] = 3221225472;
            v30[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke;
            v30[3] = &unk_1E7577BE0;
            v30[4] = v15;
            v31 = v8;
            v32 = array;
            urgencyCopy = urgency;
            v16 = photoLibrary;
            v33 = v16;
            v34 = v10;
            [v16 performBlock:v30];
          }

          v12 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
        }

        while (v12);
      }

      v17 = qos_class_self();
      v18 = dispatch_queue_attr_make_with_qos_class(0, v17, 0);
      v19 = dispatch_queue_create("[PLManagedAsset(RM) makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:completion:]", v18);

      v20 = +[PLConcurrencyLimiter sharedLimiter];
      v27[0] = MEMORY[0x1E69E9820];
      v27[1] = 3221225472;
      v27[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_4;
      v27[3] = &unk_1E7577C08;
      v28 = array;
      v29 = completionCopy;
      v21 = array;
      [v20 groupNotify:v10 queue:v19 block:v27];

      _originalResources = v24;
    }

    else
    {
      v22 = MEMORY[0x1E696ABC0];
      v23 = *MEMORY[0x1E69BFF48];
      v41 = *MEMORY[0x1E696A278];
      v8 = [MEMORY[0x1E696AEC0] stringWithFormat:@"photoLibrary is nil in %s", "-[PLManagedAsset(RM) makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:completion:]"];
      v42[0] = v8;
      v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v42 forKeys:&v41 count:1];
      v19 = [v22 errorWithDomain:v23 code:46502 userInfo:v10];
      (*(completionCopy + 2))(completionCopy, v19);
    }
  }

  else
  {
    (*(completionCopy + 2))(completionCopy, 0);
  }
}

void __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke(uint64_t a1)
{
  v2 = objc_alloc_init(PLResourceLocalAvailabilityRequestOptions);
  [(PLResourceLocalAvailabilityRequestOptions *)v2 setNetworkAccessAllowed:1];
  v3 = [MEMORY[0x1E6994BA8] defaultOptions];
  [(PLResourceLocalAvailabilityRequestOptions *)v2 setDownloadOptions:v3];

  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_2;
  v10[3] = &unk_1E7577BB8;
  v4 = *(a1 + 32);
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  v14 = *(a1 + 72);
  *&v7 = *(a1 + 56);
  *(&v7 + 1) = *(a1 + 32);
  *&v8 = v5;
  *(&v8 + 1) = v6;
  v11 = v8;
  v12 = v7;
  v13 = *(a1 + 64);
  v9 = [v4 makeResourceLocallyAvailableWithOptions:v2 completion:v10];
}

void __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_4(uint64_t a1)
{
  v2 = [*(a1 + 32) firstObject];
  (*(*(a1 + 40) + 16))();
}

void __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    [*(a1 + 32) addObject:v5];
  }

  if (v6)
  {
    [*(a1 + 40) addObject:v6];
  }

  if (v5)
  {
    v12 = 0;
    v13 = 0;
    v7 = [PLCacheDeleteSupport markPurgeableForFileAtURL:v5 withUrgency:*(a1 + 72) outInode:&v13 error:&v12];
    v8 = v12;
    v9 = v8;
    if (v7)
    {
      v11[0] = MEMORY[0x1E69E9820];
      v11[1] = 3221225472;
      v11[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_3;
      v11[3] = &unk_1E7577B90;
      v10 = *(a1 + 48);
      v11[4] = *(a1 + 56);
      v11[5] = v13;
      [v10 performTransactionAndWait:v11];
    }

    else if (v8)
    {
      [*(a1 + 40) addObject:v8];
    }
  }

  dispatch_group_leave(*(a1 + 64));
}

uint64_t __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_3(uint64_t a1)
{
  result = [*(a1 + 32) fileID];
  if (result != *(a1 + 40))
  {
    v3 = *(a1 + 32);

    return [v3 setFileID:?];
  }

  return result;
}

- (BOOL)installExistingAlchemistV2ResourceFileAtPath:(id)path recipeID:(unsigned int)d error:(id *)error
{
  v6 = *&d;
  pathCopy = path;
  v9 = [(PLManagedAsset *)self pathForAlchemistV2ResourceFileWithRecipeID:v6];
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __82__PLManagedAsset_RM__installExistingAlchemistV2ResourceFileAtPath_recipeID_error___block_invoke;
  v12[3] = &unk_1E7577B68;
  v15 = v6;
  v13 = v9;
  selfCopy = self;
  v10 = v9;
  LOBYTE(error) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:pathCopy dstPath:v10 error:error installResourceHandler:v12];

  return error;
}

id __82__PLManagedAsset_RM__installExistingAlchemistV2ResourceFileAtPath_recipeID_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:*(a1 + 48)];
  v3 = [PLResourceInstaller onDemand_installExistingAlchemistV2ResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (BOOL)installExistingGenerativePlaygroundFaceResourcesFileAtPath:(id)path error:(id *)error
{
  pathCopy = path;
  pathForGenerativePlaygroundFaceResourcesFile = [(PLManagedAsset *)self pathForGenerativePlaygroundFaceResourcesFile];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __87__PLManagedAsset_RM__installExistingGenerativePlaygroundFaceResourcesFileAtPath_error___block_invoke;
  v10[3] = &unk_1E7577B40;
  v11 = pathForGenerativePlaygroundFaceResourcesFile;
  selfCopy = self;
  v8 = pathForGenerativePlaygroundFaceResourcesFile;
  LOBYTE(error) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:pathCopy dstPath:v8 error:error installResourceHandler:v10];

  return error;
}

id __87__PLManagedAsset_RM__installExistingGenerativePlaygroundFaceResourcesFileAtPath_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:327693];
  v3 = [PLResourceInstaller onDemand_installExistingComputeResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (BOOL)installExistingAlchemistImageAtPath:(id)path error:(id *)error
{
  pathCopy = path;
  pathForAlchemistImage = [(PLManagedAsset *)self pathForAlchemistImage];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __64__PLManagedAsset_RM__installExistingAlchemistImageAtPath_error___block_invoke;
  v10[3] = &unk_1E7577B40;
  v11 = pathForAlchemistImage;
  selfCopy = self;
  v8 = pathForAlchemistImage;
  LOBYTE(error) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:pathCopy dstPath:v8 error:error installResourceHandler:v10];

  return error;
}

id __64__PLManagedAsset_RM__installExistingAlchemistImageAtPath_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:66137];
  v3 = [PLResourceInstaller onDemand_installExistingAdjustmentSuggestionResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (BOOL)installExistingWallpaperComputeResourcesFileAtPath:(id)path error:(id *)error
{
  pathCopy = path;
  pathForWallpaperComputeResourcesFile = [(PLManagedAsset *)self pathForWallpaperComputeResourcesFile];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __79__PLManagedAsset_RM__installExistingWallpaperComputeResourcesFileAtPath_error___block_invoke;
  v10[3] = &unk_1E7577B40;
  v11 = pathForWallpaperComputeResourcesFile;
  selfCopy = self;
  v8 = pathForWallpaperComputeResourcesFile;
  LOBYTE(error) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:pathCopy dstPath:v8 error:error installResourceHandler:v10];

  return error;
}

id __79__PLManagedAsset_RM__installExistingWallpaperComputeResourcesFileAtPath_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:327687];
  v3 = [PLResourceInstaller onDemand_installExistingComputeResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (id)mediaMetadataForResourceVersion:(unsigned int)version mediaMetadataType:(id *)type
{
  v20 = *MEMORY[0x1E69E9840];
  if (version == 2)
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    mediaMetadata = [additionalAttributes mediaMetadata];
    data = [mediaMetadata data];

    additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
  }

  else
  {
    if (version)
    {
      v15 = PLImageManagerGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        v18 = 134217984;
        versionCopy2 = version;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[RM]: Invalid resource version for media metadata: %ld", &v18, 0xCu);
      }

      data = 0;
      goto LABEL_12;
    }

    master = [(PLManagedAsset *)self master];
    mediaMetadata2 = [master mediaMetadata];
    data = [mediaMetadata2 data];

    additionalAttributes2 = [(PLManagedAsset *)self master];
  }

  v13 = additionalAttributes2;
  mediaMetadataType = [additionalAttributes2 mediaMetadataType];

  if (data && !mediaMetadataType)
  {
    v15 = PLImageManagerGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v18 = 134217984;
      versionCopy2 = version;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[RM]: Media metadata with version: %ld has no type string", &v18, 0xCu);
    }

LABEL_12:

    mediaMetadataType = 0;
  }

  if (type)
  {
    v16 = mediaMetadataType;
    *type = mediaMetadataType;
  }

  return data;
}

- (BOOL)isRAWPlusJPEGWithRAWOnTop
{
  if (![(PLManagedAsset *)self isRAWPlusJPEG])
  {
    return 0;
  }

  additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
  originalResourceChoice = [additionalAttributes originalResourceChoice];
  v5 = [originalResourceChoice unsignedIntegerValue] == 1;

  return v5;
}

- (BOOL)isRAWPlusJPEG
{
  primaryStoreOriginalResource = [(PLManagedAsset *)self primaryStoreOriginalResource];
  uniformTypeIdentifier = [primaryStoreOriginalResource uniformTypeIdentifier];

  if ([uniformTypeIdentifier isPrimaryImageFormat])
  {
    _anyOriginalNonDerivativeAlternateImageResource = [(PLManagedAsset *)self _anyOriginalNonDerivativeAlternateImageResource];
    uniformTypeIdentifier2 = [_anyOriginalNonDerivativeAlternateImageResource uniformTypeIdentifier];
    conformsToRawImage = [uniformTypeIdentifier2 conformsToRawImage];
  }

  else
  {
    conformsToRawImage = 0;
  }

  return conformsToRawImage;
}

- (BOOL)isRAWOnly
{
  primaryStoreOriginalResource = [(PLManagedAsset *)self primaryStoreOriginalResource];
  uniformTypeIdentifier = [primaryStoreOriginalResource uniformTypeIdentifier];
  conformsToRawImage = [uniformTypeIdentifier conformsToRawImage];

  return conformsToRawImage;
}

- (BOOL)pruneLocalVideoKeyFrameImage
{
  v15 = *MEMORY[0x1E69E9840];
  isVideo = [(PLManagedAsset *)self isVideo];
  if (isVideo)
  {
    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    pathForLocalVideoKeyFrame = [(PLManagedAsset *)self pathForLocalVideoKeyFrame];
    v12 = 0;
    v6 = [defaultManager removeItemAtPath:pathForLocalVideoKeyFrame error:&v12];
    v7 = v12;

    if ((v6 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
    {
      v8 = PLBackendGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v14 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Error removing local video key frame: %@", buf, 0xCu);
      }
    }

    localVideoKeyFrameResource = [(PLManagedAsset *)self localVideoKeyFrameResource];
    isLocallyAvailable = [localVideoKeyFrameResource isLocallyAvailable];
    if (isLocallyAvailable)
    {
      [localVideoKeyFrameResource markAsNotLocallyAvailable];
    }

    LOBYTE(isVideo) = v6 | isLocallyAvailable;
  }

  return isVideo;
}

- (BOOL)resetVideoKeyFrameTimeAndDeleteKeyFrameResource
{
  resetVideoKeyFrameTime = [(PLManagedAsset *)self resetVideoKeyFrameTime];
  pruneLocalVideoKeyFrameImage = [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
  localVideoKeyFrameResource = [(PLManagedAsset *)self localVideoKeyFrameResource];

  if (localVideoKeyFrameResource)
  {
    localVideoKeyFrameResource2 = [(PLManagedAsset *)self localVideoKeyFrameResource];
    [localVideoKeyFrameResource2 deleteResource];

    v7 = 1;
  }

  else
  {
    v7 = pruneLocalVideoKeyFrameImage || resetVideoKeyFrameTime;
  }

  return v7 & 1;
}

- (void)deleteResourceForSidecarRepresentation:(id)representation
{
  if (representation)
  {
    resource = [representation resource];
    [resource deleteResource];
  }
}

- (void)deleteResourcesWithRecipeID:(unsigned int)d andVersion:(unsigned int)version
{
  v14 = *MEMORY[0x1E69E9840];
  v4 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:*&d andVersion:*&version];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v10;
    do
    {
      v8 = 0;
      do
      {
        if (*v10 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(*(&v9 + 1) + 8 * v8++) deleteResource];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
    }

    while (v6);
  }
}

- (void)deleteAdjustedResources
{
  v28 = *MEMORY[0x1E69E9840];
  persistedAdjustedResources = [(PLManagedAsset *)self persistedAdjustedResources];
  if ([persistedAdjustedResources count])
  {
    v19 = 0u;
    v20 = 0u;
    v17 = 0u;
    v18 = 0u;
    v15 = persistedAdjustedResources;
    v3 = persistedAdjustedResources;
    v4 = [v3 countByEnumeratingWithState:&v17 objects:v27 count:16];
    if (v4)
    {
      v5 = v4;
      v6 = *v18;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v18 != v6)
          {
            objc_enumerationMutation(v3);
          }

          v8 = *(*(&v17 + 1) + 8 * i);
          v9 = PLImageManagerGetLog();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
          {
            uuid = [(PLManagedAsset *)self uuid];
            resourceType = [v8 resourceType];
            v12 = @"invalid";
            if (resourceType <= 0x1F)
            {
              v12 = off_1E75663B0[resourceType];
            }

            v13 = v12;
            v14 = +[PLResourceRecipe recipeFromID:](PLResourceRecipe, "recipeFromID:", [v8 recipeID]);
            *buf = 138412802;
            v22 = uuid;
            v23 = 2114;
            v24 = v13;
            v25 = 2114;
            v26 = v14;
            _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Deleting adjusted resource row for asset %{pubic}@, type: %{public}@, recipe: %{public}@", buf, 0x20u);
          }

          [v8 deleteResource];
        }

        v5 = [v3 countByEnumeratingWithState:&v17 objects:v27 count:16];
      }

      while (v5);
    }

    persistedAdjustedResources = v15;
  }
}

- (id)localVideoKeyFrameResource
{
  v2 = [(PLManagedAsset *)self persistedResourcesMatching:&__block_literal_global_227];
  anyObject = [v2 anyObject];

  return anyObject;
}

BOOL __48__PLManagedAsset_RM__localVideoKeyFrameResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 recipeID] == 65749 && !objc_msgSend(v2, "resourceType") && objc_msgSend(v2, "version") == 3;

  return v3;
}

- (id)penultimateImageResource
{
  v2 = [(PLManagedAsset *)self persistedResourcesMatching:&__block_literal_global_225];
  anyObject = [v2 anyObject];

  return anyObject;
}

BOOL __46__PLManagedAsset_RM__penultimateImageResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 version] == 1 && objc_msgSend(v2, "resourceType") == 0;

  return v3;
}

- (id)adjustmentDataResource
{
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"resourceType", &unk_1F0FBEDD0];
  v4 = [(PLManagedAsset *)self fetchResourcesForAssetVersions:&unk_1F0FC0288 allowDerivatives:0 additionalPredicate:v3 relationshipKeyPathsForPrefetching:0 error:0];
  firstObject = [v4 firstObject];

  return firstObject;
}

- (id)persistedResourcesWithRecipeID:(unsigned int)d andVersion:(unsigned int)version
{
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __64__PLManagedAsset_RM__persistedResourcesWithRecipeID_andVersion___block_invoke;
  v6[3] = &__block_descriptor_40_e28_B16__0__PLInternalResource_8l;
  dCopy = d;
  versionCopy = version;
  v4 = [(PLManagedAsset *)self persistedResourcesMatching:v6];

  return v4;
}

BOOL __64__PLManagedAsset_RM__persistedResourcesWithRecipeID_andVersion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 recipeID] == *(a1 + 32) && objc_msgSend(v3, "version") == *(a1 + 36);

  return v4;
}

- (id)resourcesWithVersion:(unsigned int)version
{
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __43__PLManagedAsset_RM__resourcesWithVersion___block_invoke;
  v5[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  versionCopy = version;
  v3 = [(PLManagedAsset *)self persistedResourcesMatching:v5];

  return v3;
}

- (id)fetchOrCreateResourceWithIdentity:(id)identity
{
  identityCopy = identity;
  if (!identityCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1162 description:{@"Invalid parameter not satisfying: %@", @"identity"}];
  }

  v6 = [(PLManagedAsset *)self fetchResourceWithIdentity:identityCopy error:0];
  if (!v6)
  {
    managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
    objectID = [(PLManagedAsset *)self objectID];
    v6 = [PLInternalResource insertResourceForAssetObjectID:objectID resourceIdentity:identityCopy inManagedObjectContext:managedObjectContext];
  }

  return v6;
}

- (id)fetchResourceWithIdentity:(id)identity error:(id *)error
{
  identityCopy = identity;
  if (!identityCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1148 description:{@"Invalid parameter not satisfying: %@", @"identity"}];
  }

  v12 = 0;
  v8 = [(PLManagedAsset *)self _persistedResourceForResourceIdentity:identityCopy error:&v12];
  v9 = v12;
  if (error && !v8 && v9)
  {
    v9 = v9;
    *error = v9;
  }

  return v8;
}

BOOL __65__PLManagedAsset_RM__persistedPenultimateVideoComplementResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && objc_msgSend(v2, "version") == 1 && objc_msgSend(v2, "resourceType") == 3;

  return v3;
}

BOOL __62__PLManagedAsset_RM__persistedOriginalVideoComplementResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && !objc_msgSend(v2, "version") && objc_msgSend(v2, "resourceType") == 3;

  return v3;
}

BOOL __52__PLManagedAsset_RM__persistedOriginalVideoResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && !objc_msgSend(v2, "version") && objc_msgSend(v2, "resourceType") == 1;

  return v3;
}

BOOL __52__PLManagedAsset_RM__persistedOriginalImageResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && !objc_msgSend(v2, "version") && objc_msgSend(v2, "resourceType") == 0;

  return v3;
}

- (id)firstPersistedResourceMatching:(id)matching
{
  v18 = *MEMORY[0x1E69E9840];
  matchingCopy = matching;
  if (!matchingCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1108 description:{@"Invalid parameter not satisfying: %@", @"filterBlock"}];
  }

  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  modernResources = [(PLManagedAsset *)self modernResources];
  v7 = [modernResources countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v7)
  {
    v8 = *v14;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(modernResources);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        if (matchingCopy[2](matchingCopy, v10))
        {
          v7 = v10;
          goto LABEL_13;
        }
      }

      v7 = [modernResources countByEnumeratingWithState:&v13 objects:v17 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_13:

  return v7;
}

- (id)persistedResourcesMatching:(id)matching
{
  matchingCopy = matching;
  if (!matchingCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1097 description:{@"Invalid parameter not satisfying: %@", @"filterBlock"}];
  }

  v6 = MEMORY[0x1E696AE18];
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __49__PLManagedAsset_RM__persistedResourcesMatching___block_invoke;
  v13[3] = &unk_1E7577AD8;
  v14 = matchingCopy;
  v7 = matchingCopy;
  v8 = [v6 predicateWithBlock:v13];
  modernResources = [(PLManagedAsset *)self modernResources];
  v10 = [modernResources filteredSetUsingPredicate:v8];

  return v10;
}

- (id)allFileBackedResources
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
  modernResources = [(PLManagedAsset *)self modernResources];
  allObjects = [modernResources allObjects];
  [v3 addObjectsFromArray:allObjects];

  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  v6 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:0, 0];
  v7 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v14;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v14 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v13 + 1) + 8 * i);
        if ((~[v11 recipeID] & 0x30000) != 0)
        {
          [v3 addObject:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v8);
  }

  return v3;
}

- (id)fetchResourcesForAssetVersions:(id)versions allowDerivatives:(BOOL)derivatives additionalPredicate:(id)predicate relationshipKeyPathsForPrefetching:(id)prefetching error:(id *)error
{
  derivativesCopy = derivatives;
  prefetchingCopy = prefetching;
  predicateCopy = predicate;
  versionsCopy = versions;
  v15 = objc_opt_class();
  objectID = [(PLManagedAsset *)self objectID];
  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  v18 = [v15 fetchResourcesForAssetWithObjectID:objectID inContext:managedObjectContext versions:versionsCopy includeVirtualResources:1 allowDerivatives:derivativesCopy excludeDynamicCPLResources:0 additionalPredicate:predicateCopy relationshipKeyPathsForPrefetching:prefetchingCopy error:error];

  return v18;
}

- (id)resourcesSortedByQualityWithOptions:(unsigned __int16)options
{
  optionsCopy = options;
  if (resourcesSortedByQualityWithOptions__s_onceToken != -1)
  {
    dispatch_once(&resourcesSortedByQualityWithOptions__s_onceToken, &__block_literal_global_179_113246);
  }

  array = [MEMORY[0x1E695DF70] array];
  modernResources = [(PLManagedAsset *)self modernResources];
  allObjects = [modernResources allObjects];
  [array addObjectsFromArray:allObjects];

  v8 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:optionsCopy];
  [array addObjectsFromArray:v8];

  [array sortUsingDescriptors:resourcesSortedByQualityWithOptions__s_sortDescriptors];

  return array;
}

void __58__PLManagedAsset_RM__resourcesSortedByQualityWithOptions___block_invoke()
{
  v3[1] = *MEMORY[0x1E69E9840];
  v0 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"qualitySortValue" ascending:1];
  v3[0] = v0;
  v1 = [MEMORY[0x1E695DEC8] arrayWithObjects:v3 count:1];
  v2 = resourcesSortedByQualityWithOptions__s_sortDescriptors;
  resourcesSortedByQualityWithOptions__s_sortDescriptors = v1;
}

- (BOOL)deleteContextualVideoThumbnailFilesWithError:(id *)error
{
  v17 = *MEMORY[0x1E69E9840];
  v5 = PLBackendGetLog();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    uuid = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    v16 = uuid;
    _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "Deleting contextual video thumbnails for asset %{public}@", buf, 0xCu);
  }

  v7 = [(PLManagedAsset *)self readonlyFileURLForContextualVideoThumbnailIdentifier:0];
  if (v7)
  {
    v8 = MEMORY[0x1E69BF238];
    uuid2 = [(PLManagedAsset *)self uuid];
    v14 = 0;
    LOBYTE(v8) = [v8 removeFilesInDirectoryAtURL:v7 withPrefix:uuid2 error:&v14 progress:0];
    v10 = v14;

    if (v8 & 1) != 0 || (PLIsErrorFileNotFound())
    {
      v11 = 1;
    }

    else if (error)
    {
      v13 = v10;
      v11 = 0;
      *error = v10;
    }

    else
    {
      v11 = 0;
    }
  }

  else
  {
    v11 = 1;
  }

  return v11;
}

- (id)contextualVideoThumbnailURLs
{
  v18 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self isVideo])
  {
    v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v13 = 0u;
    v14 = 0u;
    v15 = 0u;
    v16 = 0u;
    v4 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:0, 0];
    v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v14;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v14 != v7)
          {
            objc_enumerationMutation(v4);
          }

          v9 = *(*(&v13 + 1) + 8 * i);
          if ([v9 resourceType] == 16)
          {
            fileURL = [v9 fileURL];
            if (fileURL)
            {
              [v3 addObject:fileURL];
            }
          }
        }

        v6 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
      }

      while (v6);
    }

    v11 = [v3 copy];
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

- (id)writableFileURLForContextualVideoThumbnailIdentifier:(id)identifier
{
  v23 = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  assetID = [(PLManagedAsset *)self assetID];
  libraryID = [assetID libraryID];
  v7 = PLDataStoreForClassIDAndLibraryID(0, libraryID);

  v8 = [v7 writableFileURLForContextualVideoThumbnailIdentifier:identifierCopy asset:self];

  if (v8)
  {
    v9 = MEMORY[0x1E69BF238];
    uRLByDeletingLastPathComponent = [v8 URLByDeletingLastPathComponent];
    v16 = 0;
    v11 = [v9 createDirectoryAtURL:uRLByDeletingLastPathComponent error:&v16];
    v12 = v16;

    if ((v11 & 1) == 0)
    {
      v13 = PLBackendGetLog();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        uuid = [(PLManagedAsset *)self uuid];
        *buf = 136315650;
        v18 = "[PLManagedAsset(RM) writableFileURLForContextualVideoThumbnailIdentifier:]";
        v19 = 2114;
        v20 = uuid;
        v21 = 2112;
        v22 = v12;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "%s for asset %{public}@ failed: %@", buf, 0x20u);
      }
    }
  }

  return v8;
}

- (id)readonlyFileURLForContextualVideoThumbnailIdentifier:(id)identifier
{
  identifierCopy = identifier;
  assetID = [(PLManagedAsset *)self assetID];
  libraryID = [assetID libraryID];
  v7 = PLDataStoreForClassIDAndLibraryID(0, libraryID);

  v8 = [v7 readonlyFileURLForContextualVideoThumbnailIdentifier:identifierCopy asset:self];

  return v8;
}

- (BOOL)hasLargerThanThumbResourceLocal
{
  v15 = 0;
  v16 = &v15;
  v17 = 0x2020000000;
  v18 = 0;
  imageRequestHints = [(PLManagedAsset *)self imageRequestHints];
  width = [(PLManagedAsset *)self width];
  height = [(PLManagedAsset *)self height];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryID = [photoLibrary libraryID];
  assetID = [(PLManagedAsset *)self assetID];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke;
  v14[3] = &unk_1E7577A88;
  v14[4] = &v15;
  [PLManagedAsset enumerateImageRequestHintData:imageRequestHints assetWidth:width assetHeight:height libraryID:libraryID startingOffset:0 assetID:assetID block:v14];

  if ((v16[3] & 1) == 0 && [(PLManagedAsset *)self isVideo])
  {
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke_2;
    v13[3] = &unk_1E7577AB0;
    v13[4] = self;
    v9 = [(PLManagedAsset *)self persistedResourcesMatching:v13];
    v10 = [v9 count] != 0;
    *(v16 + 24) = v10;
  }

  v11 = *(v16 + 24);
  _Block_object_dispose(&v15, 8);
  return v11;
}

uint64_t __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke(uint64_t result, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, unsigned int a9, _BYTE *a10)
{
  if (!a9 || HIWORD(a9) - 3 >= 2u)
  {
    *(*(*(result + 32) + 8) + 24) = 1;
    *a10 = 1;
  }

  return result;
}

BOOL __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 localAvailability];
  v5 = [v3 resourceType];
  v6 = [v3 version];

  v7 = [*(a1 + 32) hasAdjustments];
  if (v5 != 1)
  {
    return 0;
  }

  if (v7)
  {
    v8 = 2;
  }

  else
  {
    v8 = 0;
  }

  return (v6 == 3 || v8 == v6) && v4 >= 0;
}

- (id)masterThumbnailFileURLIfLocal
{
  masterThumbnailResource = [(PLManagedAsset *)self masterThumbnailResource];
  fileURL = [masterThumbnailResource fileURL];

  return fileURL;
}

- (id)masterThumbnailResource
{
  v2 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:1];
  v3 = [v2 indexOfObjectPassingTest:&__block_literal_global_175];
  if (v3 == 0x7FFFFFFFFFFFFFFFLL)
  {
    v4 = 0;
  }

  else
  {
    v4 = [v2 objectAtIndex:v3];
  }

  return v4;
}

BOOL __45__PLManagedAsset_RM__masterThumbnailResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 recipeID];

  return [PLResourceDataStore isMasterThumbRecipeID:v2];
}

- (id)nonPersistedResourcesWithOptions:(unsigned __int16)options
{
  optionsCopy = options;
  v20 = *MEMORY[0x1E69E9840];
  v5 = [MEMORY[0x1E695DF70] arrayWithCapacity:5];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  assetID = [(PLManagedAsset *)self assetID];
  libraryID = [assetID libraryID];
  v8 = [PLResourceDataStoreManager storesForLibraryID:libraryID];

  v9 = [v8 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v16;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v16 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v15 + 1) + 8 * i) virtualResourcesForAsset:self options:optionsCopy];
        [v5 addObjectsFromArray:v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v10);
  }

  return v5;
}

- (id)mediaMetadataVirtualResources
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
  master = [(PLManagedAsset *)self master];
  mediaMetadata = [master mediaMetadata];
  data = [mediaMetadata data];

  if (data)
  {
    v7 = [PLMediaMetadataVirtualResource alloc];
    master2 = [(PLManagedAsset *)self master];
    mediaMetadata2 = [master2 mediaMetadata];
    data2 = [mediaMetadata2 data];
    v11 = -[PLMediaMetadataVirtualResource initWithAsset:resourceType:version:recipeID:dataLength:](v7, "initWithAsset:resourceType:version:recipeID:dataLength:", self, 9, 0, 327685, [data2 length]);

    [v3 addObject:v11];
  }

  if ([(PLManagedAsset *)self hasAdjustments])
  {
    additionalAttributes = [(PLManagedAsset *)self additionalAttributes];
    mediaMetadata3 = [additionalAttributes mediaMetadata];
    data3 = [mediaMetadata3 data];

    if (data3)
    {
      v15 = [PLMediaMetadataVirtualResource alloc];
      additionalAttributes2 = [(PLManagedAsset *)self additionalAttributes];
      mediaMetadata4 = [additionalAttributes2 mediaMetadata];
      data4 = [mediaMetadata4 data];
      v19 = -[PLMediaMetadataVirtualResource initWithAsset:resourceType:version:recipeID:dataLength:](v15, "initWithAsset:resourceType:version:recipeID:dataLength:", self, 9, 2, 327685, [data4 length]);

      [v3 addObject:v19];
    }
  }

  return v3;
}

- (void)recalculateImageRequestHintsForResource:(id)resource afterLocalAvailabilityChangeFrom:(signed __int16)from previousDataStoreKey:(id)key
{
  fromCopy = from;
  v51[1] = *MEMORY[0x1E69E9840];
  resourceCopy = resource;
  keyCopy = key;
  if (!resourceCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:752 description:{@"Invalid parameter not satisfying: %@", @"resource"}];
  }

  v45 = 0;
  v46 = &v45;
  v47 = 0x2020000000;
  v48 = 0;
  localAvailability = [resourceCopy localAvailability];
  if (fromCopy > 1 || localAvailability < 1)
  {
    localAvailability2 = [resourceCopy localAvailability];
    v11 = v46;
    if (fromCopy < 1 || (localAvailability2 & 0x80000000) == 0)
    {
      if (!v46[3])
      {
        goto LABEL_22;
      }

      goto LABEL_10;
    }

    v12 = 2;
  }

  else
  {
    v11 = v46;
    v12 = 1;
  }

  v11[3] = v12;
LABEL_10:
  v14 = objc_alloc(MEMORY[0x1E695DF88]);
  imageRequestHints = [(PLManagedAsset *)self imageRequestHints];
  v16 = [v14 initWithCapacity:{objc_msgSend(imageRequestHints, "length")}];

  width = [(PLManagedAsset *)self width];
  if ([(PLManagedAsset *)self height]* width < 1)
  {
    v21 = 0.0;
  }

  else
  {
    unorientedWidth = [resourceCopy unorientedWidth];
    unorientedHeight = [resourceCopy unorientedHeight];
    width2 = [(PLManagedAsset *)self width];
    v21 = (unorientedHeight * unorientedWidth) / ([(PLManagedAsset *)self height]* width2);
  }

  if (PLCanIncludeResourceInHints(resourceCopy, self))
  {
    v22 = objc_opt_class();
    v51[0] = resourceCopy;
    v23 = [MEMORY[0x1E695DEC8] arrayWithObjects:v51 count:1];
    v24 = [v22 calculateImageRequestHintsFromSortedResources:v23 asset:self];
  }

  else
  {
    v24 = 0;
  }

  v36 = objc_opt_class();
  imageRequestHints2 = [(PLManagedAsset *)self imageRequestHints];
  width3 = [(PLManagedAsset *)self width];
  height = [(PLManagedAsset *)self height];
  assetID = [(PLManagedAsset *)self assetID];
  libraryID = [assetID libraryID];
  assetID2 = [(PLManagedAsset *)self assetID];
  v38[0] = MEMORY[0x1E69E9820];
  v38[1] = 3221225472;
  v38[2] = __116__PLManagedAsset_RM__recalculateImageRequestHintsForResource_afterLocalAvailabilityChangeFrom_previousDataStoreKey___block_invoke;
  v38[3] = &unk_1E7577A40;
  v44 = v21;
  v39 = resourceCopy;
  v43 = &v45;
  v40 = keyCopy;
  v30 = v24;
  v41 = v30;
  v31 = v16;
  v42 = v31;
  [v36 enumerateImageRequestHintData:imageRequestHints2 assetWidth:width3 assetHeight:height libraryID:libraryID startingOffset:0 assetID:assetID2 block:v38];

  if (v46[3] == 1 && v30)
  {
    [v31 appendData:v30];
  }

  [(PLManagedAsset *)self setImageRequestHints:v31];
  v32 = PLImageManagerGetLog();
  if (os_log_type_enabled(v32, OS_LOG_TYPE_DEBUG))
  {
    v33 = [v31 length];
    *buf = 134217984;
    v50 = v33;
    _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_DEBUG, "[RM]: Inserted/removed imageRequestHint, length = %ld", buf, 0xCu);
  }

LABEL_22:
  _Block_object_dispose(&v45, 8);
}

void __116__PLManagedAsset_RM__recalculateImageRequestHintsForResource_afterLocalAvailabilityChangeFrom_previousDataStoreKey___block_invoke(uint64_t a1, uint64_t a2, int a3, float a4, uint64_t a5, void *a6, void *a7, uint64_t a8, uint64_t a9)
{
  v24 = a6;
  v16 = a7;
  v17 = *(a1 + 72);
  if (v17 <= a4)
  {
    if (vabds_f32(a4, v17) >= 0.00000011921 || a3 == 0)
    {
      v18 = 1;
    }

    else
    {
      v20 = [*(a1 + 32) uniformTypeIdentifier];
      v18 = [v20 isPrimaryImageFormat];
    }
  }

  else
  {
    v18 = 0;
  }

  v21 = *(*(*(a1 + 64) + 8) + 24);
  if (v21 == 2)
  {
    v22 = [v16 isEqualToKey:*(a1 + 40)];
    v23 = (*(*(a1 + 64) + 8) + 24);
    if (v22)
    {
LABEL_21:
      *v23 = 0;
      goto LABEL_22;
    }

    v21 = *v23;
  }

  if (v21 == 1 && (v18 & 1) != 0)
  {
    if (*(a1 + 48))
    {
      [*(a1 + 56) appendData:?];
    }

    [*(a1 + 56) appendBytes:a8 length:a9];
LABEL_20:
    v23 = (*(*(a1 + 64) + 8) + 24);
    goto LABEL_21;
  }

  [*(a1 + 56) appendBytes:a8 length:a9];
  if (a2 == 0x7FFFFFFFFFFFFFFFLL && v21 == 1)
  {
    if (*(a1 + 48))
    {
      [*(a1 + 56) appendData:?];
    }

    goto LABEL_20;
  }

LABEL_22:
}

- (void)insertTableThumbImageRequestHints
{
  v16 = *MEMORY[0x1E69E9840];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryID = [photoLibrary libraryID];
  v5 = PLDataStoreForClassIDAndLibraryID(1, libraryID);

  v6 = [v5 virtualResourcesForAsset:self options:1];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v7 = [v6 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v12;
    do
    {
      v10 = 0;
      do
      {
        if (*v12 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [(PLManagedAsset *)self recalculateImageRequestHintsForResource:*(*(&v11 + 1) + 8 * v10++) afterLocalAvailabilityChangeFrom:0xFFFFFFFFLL previousDataStoreKey:0];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v8);
  }
}

- (void)recalculateImageRequestHints
{
  v21 = *MEMORY[0x1E69E9840];
  v3 = PLImageManagerGetLog();
  v4 = os_signpost_id_make_with_pointer(v3, self);
  v5 = v3;
  v6 = v5;
  if (v4 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v5))
  {
    LOWORD(v17) = 0;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v6, OS_SIGNPOST_INTERVAL_BEGIN, v4, "ResourceModel", "RecalulateImageRequestHints", &v17, 2u);
  }

  v7 = objc_opt_class();
  v8 = [(PLManagedAsset *)self resourcesSortedByQualityWithOptions:1];
  v9 = [v7 calculateImageRequestHintsFromSortedResources:v8 asset:self];

  imageRequestHints = [(PLManagedAsset *)self imageRequestHints];
  v11 = [v9 isEqualToData:imageRequestHints];

  if ((v11 & 1) == 0)
  {
    v12 = PLImageManagerGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      uuid = [(PLManagedAsset *)self uuid];
      v14 = [v9 length];
      v17 = 138412546;
      v18 = uuid;
      v19 = 2048;
      v20 = v14;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "[RM]: Recalculated image request hints for %@, length = %ld", &v17, 0x16u);
    }

    [(PLManagedAsset *)self setImageRequestHints:v9];
  }

  v15 = v6;
  v16 = v15;
  if (v4 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v15))
  {
    LOWORD(v17) = 0;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v16, OS_SIGNPOST_INTERVAL_END, v4, "ResourceModel", "RecalulateImageRequestHints", &v17, 2u);
  }
}

- (BOOL)imageRequestHintsContainsResource:(id)resource
{
  resourceCopy = resource;
  v17 = 0;
  v18 = &v17;
  v19 = 0x2020000000;
  v20 = 0;
  v5 = objc_opt_class();
  imageRequestHints = [(PLManagedAsset *)self imageRequestHints];
  width = [(PLManagedAsset *)self width];
  height = [(PLManagedAsset *)self height];
  photoLibrary = [(PLManagedObject *)self photoLibrary];
  libraryID = [photoLibrary libraryID];
  assetID = [(PLManagedAsset *)self assetID];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __56__PLManagedAsset_RM__imageRequestHintsContainsResource___block_invoke;
  v14[3] = &unk_1E7577A18;
  v14[4] = self;
  v12 = resourceCopy;
  v15 = v12;
  v16 = &v17;
  [v5 enumerateImageRequestHintData:imageRequestHints assetWidth:width assetHeight:height libraryID:libraryID startingOffset:0 assetID:assetID block:v14];

  LOBYTE(imageRequestHints) = *(v18 + 24);
  _Block_object_dispose(&v17, 8);

  return imageRequestHints;
}

void __56__PLManagedAsset_RM__imageRequestHintsContainsResource___block_invoke(uint64_t a1, float a2, uint64_t a3, int a4, int a5, void *a6, void *a7, uint64_t a8, uint64_t a9, int a10, _BYTE *a11)
{
  v32 = a6;
  v16 = a7;
  v17 = [objc_opt_class() storeClassID];
  v18 = *(a1 + 32);
  if (v17 == 1)
  {
    v19 = [v18 width];
    if ([*(a1 + 32) height] * v19 < 1)
    {
      v23 = 0.0;
    }

    else
    {
      v20 = [*(a1 + 40) unorientedWidth];
      v21 = ([*(a1 + 40) unorientedHeight] * v20);
      v22 = [*(a1 + 32) width];
      v23 = v21 / ([*(a1 + 32) height] * v22);
    }

    if (vabds_f32(v23, a2) < 0.00000011921)
    {
      v30 = [*(a1 + 40) uniformTypeIdentifier];
      if ([v30 isPrimaryImageFormat] == a4 && objc_msgSend(*(a1 + 40), "isDefaultOrientation") == a5)
      {
        v31 = [*(a1 + 40) recipeID];

        if (v31 == a10)
        {
          *(*(*(a1 + 48) + 8) + 24) = 1;
          *a11 = 1;
        }
      }

      else
      {
      }
    }
  }

  else
  {
    v24 = [v18 assetID];
    v25 = [v32 resourceURLForKey:v16 assetID:v24];

    v26 = [*(a1 + 40) dataStore];
    v27 = [*(a1 + 40) dataStoreKey];
    v28 = [*(a1 + 40) assetID];
    v29 = [v26 resourceURLForKey:v27 assetID:v28];

    if (v25 && [v25 isEqual:v29])
    {
      *(*(*(a1 + 48) + 8) + 24) = 1;
      *a11 = 1;
    }
  }
}

- (id)validateForAssetID:(id)d resourceIdentity:(id)identity
{
  v114 = *MEMORY[0x1E69E9840];
  dCopy = d;
  identityCopy = identity;
  v106 = 0;
  v6 = [(PLManagedAsset *)self fetchResourcesForAssetVersions:0 allowDerivatives:1 additionalPredicate:0 relationshipKeyPathsForPrefetching:0 error:&v106];
  v71 = v106;
  v75 = objc_alloc_init(MEMORY[0x1E696AB50]);
  isCloudSharedAsset = [(PLManagedAsset *)self isCloudSharedAsset];
  v102 = 0u;
  v103 = 0u;
  v104 = 0u;
  v105 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v102 objects:v113 count:16];
  if (v8)
  {
    v9 = 0;
    v76 = 0;
    obj = 0;
    v82 = 0;
    v10 = 0;
    v11 = *v103;
    v12 = MEMORY[0x1E695E0F0];
    while (1)
    {
      v13 = v7;
      for (i = 0; i != v8; ++i)
      {
        if (*v103 != v11)
        {
          objc_enumerationMutation(v13);
        }

        v15 = *(*(&v102 + 1) + 8 * i);
        if (isCloudSharedAsset)
        {
          if (-[PLManagedAsset isVideo](self, "isVideo") && [v15 dataStoreSubtype] == 5 || !-[PLManagedAsset isVideo](self, "isVideo", v71) && objc_msgSend(v15, "dataStoreSubtype") == 3)
          {
            v10 = 1;
          }
        }

        else
        {
          v10 |= [v15 cplType] == 1;
        }

        if (![v15 resourceType] && (!objc_msgSend(v15, "isDerivative") || -[PLManagedAsset kind](self, "kind")))
        {
          if ([v15 version] == 2 && !objc_msgSend(v15, "isDerivative"))
          {
            obj = 1;
          }

          else if (![v15 version] && (objc_msgSend(v15, "recipeID") == 65943 || objc_msgSend(v15, "recipeID") == 65951))
          {
            deferredProcessingNeeded = [(PLManagedAsset *)self deferredProcessingNeeded];
            if (deferredProcessingNeeded == 10 || deferredProcessingNeeded == 1)
            {
              v17 = [PLResourceModelValidationError unexpectedLocalResourceError:v15];
              v80 = [v12 arrayByAddingObject:v17];

              v76 = 1;
              v82 = 1;
              v12 = v80;
              goto LABEL_28;
            }

            v76 = 1;
          }

          v82 = 1;
        }

LABEL_28:
        v9 |= [v15 resourceType] == 3;
        v18 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:{objc_msgSend(v15, "cplType")}];
        [v75 addObject:v18];
      }

      v7 = v13;
      v8 = [v13 countByEnumeratingWithState:&v102 objects:v113 count:16];
      if (!v8)
      {

        LODWORD(v8) = v76;
        v19 = v82;
        if (v10)
        {
          goto LABEL_34;
        }

        goto LABEL_33;
      }
    }
  }

  v19 = 0;
  obj = 0;
  v9 = 0;
  v12 = MEMORY[0x1E695E0F0];
LABEL_33:
  v20 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Missing original resource.", v71];
  v21 = [v12 arrayByAddingObject:v20];

  v12 = v21;
LABEL_34:
  if ([(PLManagedAsset *)self kind]== 1 && !(([(PLManagedAsset *)self deferredProcessingNeeded]!= 0) | v19 & 1))
  {
    v22 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Video asset missing its image resource."];
    v23 = [v12 arrayByAddingObject:v22];

    v12 = v23;
  }

  if ([(PLManagedAsset *)self hasAdjustments]&& ![(PLManagedAsset *)self deferredProcessingNeeded]&& !(([(PLManagedAsset *)self kind]!= 0) | obj & 1))
  {
    v24 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Adjusted image asset missing its full size render resource."];
    v25 = [v12 arrayByAddingObject:v24];

    v12 = v25;
  }

  deferredProcessingNeeded2 = [(PLManagedAsset *)self deferredProcessingNeeded];
  v28 = deferredProcessingNeeded2 != 10 && deferredProcessingNeeded2 != 1;
  if (((v28 | v8) & 1) == 0)
  {
    v29 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Asset in deferred processing via capture pipline state missing its preview image resource."];
    v30 = [v12 arrayByAddingObject:v29];

    v12 = v30;
  }

  if (!(v9 & 1 | ![(PLManagedAsset *)self isPhotoIris]))
  {
    v31 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Live photo with missing video complement resource."];
    v32 = [v12 arrayByAddingObject:v31];

    v12 = v32;
  }

  v100 = 0u;
  v101 = 0u;
  v98 = 0u;
  v99 = 0u;
  obja = v7;
  selfCopy = self;
  v77 = [obja countByEnumeratingWithState:&v98 objects:v112 count:16];
  if (v77)
  {
    v74 = *v99;
    v33 = MEMORY[0x1E695E0F0];
    do
    {
      v34 = 0;
      do
      {
        if (*v99 != v74)
        {
          objc_enumerationMutation(obja);
        }

        v81 = v34;
        v35 = *(*(&v98 + 1) + 8 * v34);
        v94 = 0u;
        v95 = 0u;
        v96 = 0u;
        v97 = 0u;
        v36 = obja;
        v37 = [v36 countByEnumeratingWithState:&v94 objects:v111 count:16];
        if (v37)
        {
          v38 = v37;
          v39 = *v95;
          v83 = v36;
          do
          {
            for (j = 0; j != v38; ++j)
            {
              if (*v95 != v39)
              {
                objc_enumerationMutation(v36);
              }

              v41 = *(*(&v94 + 1) + 8 * j);
              if (v35 != v41 && ([v33 containsObject:*(*(&v94 + 1) + 8 * j)] & 1) == 0 && PLResourceIdentityIsEqual(v35, v41))
              {
                v110[0] = v35;
                v110[1] = v41;
                v42 = [MEMORY[0x1E695DEC8] arrayWithObjects:v110 count:2];
                v43 = [PLResourceModelValidationError duplicateResourceErrorAmongResources:v42 forAsset:selfCopy];

                v44 = [v12 arrayByAddingObject:v43];

                v109[0] = v35;
                v109[1] = v41;
                v45 = [MEMORY[0x1E695DEC8] arrayWithObjects:v109 count:2];
                v46 = [v33 arrayByAddingObjectsFromArray:v45];

                v36 = v83;
                v33 = v46;
                v12 = v44;
              }
            }

            v38 = [v36 countByEnumeratingWithState:&v94 objects:v111 count:16];
          }

          while (v38);
        }

        v34 = v81 + 1;
      }

      while (v81 + 1 != v77);
      v77 = [v36 countByEnumeratingWithState:&v98 objects:v112 count:16];
    }

    while (v77);
  }

  else
  {
    v33 = MEMORY[0x1E695E0F0];
  }

  v92 = 0u;
  v93 = 0u;
  v90 = 0u;
  v91 = 0u;
  v47 = v75;
  v48 = [v47 countByEnumeratingWithState:&v90 objects:v108 count:16];
  if (v48)
  {
    v49 = v48;
    v50 = *v91;
    do
    {
      for (k = 0; k != v49; ++k)
      {
        if (*v91 != v50)
        {
          objc_enumerationMutation(v47);
        }

        v52 = *(*(&v90 + 1) + 8 * k);
        integerValue = [v52 integerValue];
        if (integerValue)
        {
          v54 = integerValue;
          v55 = [v47 countForObject:v52];
          hasAdjustments = [(PLManagedAsset *)selfCopy hasAdjustments];
          v57 = v54 > 0x1C || ((1 << v54) & 0x102104FC) == 0;
          v58 = 2;
          if (v57)
          {
            v58 = 1;
          }

          if (!hasAdjustments)
          {
            v58 = 1;
          }

          if (v55 > v58)
          {
            v59 = [PLResourceModelValidationError duplicatedCPLTypeAssetErrorForAsset:selfCopy cplType:v54];
            v60 = [v12 arrayByAddingObject:v59];

            v12 = v60;
          }
        }
      }

      v49 = [v47 countByEnumeratingWithState:&v90 objects:v108 count:16];
    }

    while (v49);
  }

  v88 = 0u;
  v89 = 0u;
  v86 = 0u;
  v87 = 0u;
  v61 = obja;
  v62 = [v61 countByEnumeratingWithState:&v86 objects:v107 count:16];
  if (v62)
  {
    v63 = v62;
    v64 = *v87;
    v65 = dCopy;
    do
    {
      v66 = 0;
      v67 = v12;
      do
      {
        if (*v87 != v64)
        {
          objc_enumerationMutation(v61);
        }

        v68 = [*(*(&v86 + 1) + 8 * v66) validateForAssetID:dCopy resourceIdentity:*(*(&v86 + 1) + 8 * v66)];
        v12 = [v67 arrayByAddingObjectsFromArray:v68];

        ++v66;
        v67 = v12;
      }

      while (v63 != v66);
      v63 = [v61 countByEnumeratingWithState:&v86 objects:v107 count:16];
    }

    while (v63);
  }

  else
  {
    v65 = dCopy;
  }

  v69 = v12;
  return v12;
}

- (id)virtualResourcesThatReplaceMissingPersistedResources:(id)resources
{
  v37 = *MEMORY[0x1E69E9840];
  resourcesCopy = resources;
  v5 = objc_alloc_init(MEMORY[0x1E695DF70]);
  if (![(PLManagedAsset *)self hasAdjustments])
  {
    goto LABEL_44;
  }

  [MEMORY[0x1E69BF328] maskForAssetsAllowingVirtualFullSizeRender];
  [(PLManagedAsset *)self savedAssetType];
  if (!PLValidatedSavedAssetTypeApplies())
  {
    goto LABEL_44;
  }

  selfCopy = self;
  v29 = resourcesCopy;
  v30 = v5;
  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  v6 = resourcesCopy;
  v7 = [v6 countByEnumeratingWithState:&v32 objects:v36 count:16];
  if (v7)
  {
    v8 = v7;
    v31 = 0;
    v9 = 0;
    v10 = 0;
    v11 = 0;
    v12 = *v33;
    do
    {
      v13 = 0;
      do
      {
        if (*v33 != v12)
        {
          objc_enumerationMutation(v6);
        }

        v14 = *(*(&v32 + 1) + 8 * v13);
        if ([v14 recipeID] == 65938)
        {
          v11 = 1;
        }

        else if ([v14 recipeID] == 131272)
        {
          v10 = 1;
        }

        else if ([v14 recipeID] == 0x20000)
        {
          v9 = 1;
        }

        else if (![v14 recipeID])
        {
          if ([v14 version] || objc_msgSend(v14, "resourceType") != 3)
          {
            if ([v14 version] == 1)
            {
              BYTE4(v31) |= [v14 resourceType] == 3;
            }
          }

          else
          {
            LOBYTE(v31) = 1;
          }
        }

        ++v13;
      }

      while (v8 != v13);
      v15 = [v6 countByEnumeratingWithState:&v32 objects:v36 count:16];
      v8 = v15;
    }

    while (v15);
  }

  else
  {
    v31 = 0;
    v9 = 0;
    v10 = 0;
    v11 = 0;
  }

  v16 = selfCopy;
  v5 = v30;
  if ([(PLManagedAsset *)selfCopy isPhoto]&& (v11 & 1) == 0)
  {
    v17 = [[PLFullSizeRenderImageVirtualResource alloc] initWithAsset:selfCopy];
    [v30 addObject:v17];
  }

  additionalAttributes = [(PLManagedAsset *)selfCopy additionalAttributes];
  unmanagedAdjustment = [additionalAttributes unmanagedAdjustment];
  adjustmentBaseImageFormat = [unmanagedAdjustment adjustmentBaseImageFormat];
  integerValue = [adjustmentBaseImageFormat integerValue];

  v22 = 0;
  if ((BYTE4(v31) & (integerValue == 1)) == 0 && (v31 & (integerValue == 0)) == 0)
  {
    if (integerValue)
    {
      if (integerValue != 1)
      {
        v22 = 1;
        goto LABEL_36;
      }

      persistedPenultimateVideoComplementResource = [(PLManagedAsset *)v16 persistedPenultimateVideoComplementResource];
    }

    else
    {
      persistedPenultimateVideoComplementResource = [(PLManagedAsset *)v16 persistedOriginalVideoComplementResource];
    }

    v22 = persistedPenultimateVideoComplementResource == 0;

LABEL_36:
    managedObjectContext = [(PLManagedAsset *)v16 managedObjectContext];
    [managedObjectContext refreshObject:v16 mergeChanges:{-[PLManagedAsset hasChanges](v16, "hasChanges")}];
  }

  if ([(PLManagedAsset *)v16 isPhotoIris]&& !(([(PLManagedAsset *)v16 playbackStyle]== 1) | (v10 | v22) & 1) && ![PLManagedAsset isPhotoIrisPlaceholderWithPhotoIris:1 videoCpDuration:[(PLManagedAsset *)v16 videoCpDurationValue] isCloudShared:[(PLManagedAsset *)v16 isCloudSharedAsset] videoCpFilePath:0])
  {
    v25 = [[PLFullSizeRenderVideoComplementVirtualResource alloc] initWithAsset:v16];
    [v30 addObject:v25];
  }

  resourcesCopy = v29;
  if ([(PLManagedAsset *)v16 isVideo]&& !(v9 & 1 | ![(PLManagedAsset *)v16 hasNonSlomoAdjustments]))
  {
    v26 = [[PLFullSizeRenderVideoVirtualResource alloc] initWithAsset:v16];
    [v30 addObject:v26];
  }

LABEL_44:

  return v5;
}

BOOL __69__PLManagedAsset_RM___anyOriginalNonDerivativeAlternateImageResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 resourceType] == 4 && !objc_msgSend(v2, "version") && (objc_msgSend(v2, "recipeID") & 1) == 0;

  return v3;
}

- (id)_persistedResourceForResourceIdentity:(id)identity error:(id *)error
{
  v42[5] = *MEMORY[0x1E69E9840];
  identityCopy = identity;
  if (!identityCopy)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:107 description:{@"Invalid parameter not satisfying: %@", @"identity"}];
  }

  managedObjectContext = [(PLManagedAsset *)self managedObjectContext];
  if (_persistedResourceForResourceIdentity_error__s_onceToken != -1)
  {
    dispatch_once(&_persistedResourceForResourceIdentity_error__s_onceToken, &__block_literal_global_96_113285);
  }

  uniformTypeIdentifier = [identityCopy uniformTypeIdentifier];
  identifier = [uniformTypeIdentifier identifier];
  v11 = PLFileTypeFromIdentifier(identifier);

  v12 = MEMORY[0x1E695DF70];
  compactRepresentation = [uniformTypeIdentifier compactRepresentation];
  v14 = [v12 arrayWithObject:compactRepresentation];

  if (v11)
  {
    identifier2 = [uniformTypeIdentifier identifier];
    v16 = [@"_" stringByAppendingString:identifier2];

    [v14 addObject:v16];
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __66__PLManagedAsset_RM___persistedResourceForResourceIdentity_error___block_invoke_2;
  aBlock[3] = &unk_1E7577980;
  v17 = identityCopy;
  v38 = v17;
  v18 = v14;
  v39 = v18;
  selfCopy = self;
  v19 = _Block_copy(aBlock);
  if ([(PLManagedAsset *)self isInserted])
  {
    firstObject = v19[2](v19);
  }

  else if (([(PLManagedAsset *)self hasFaultForRelationshipNamed:@"modernResources"]& 1) != 0 || (v19[2](v19), (firstObject = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v21 = _persistedResourceForResourceIdentity_error__s_fetchPredicateTemplate;
    v41[0] = @"ASSET";
    objectID = [(PLManagedAsset *)self objectID];
    v42[0] = objectID;
    v41[1] = @"RESOURCE_TYPE";
    v22 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(v17, "resourceType")}];
    v42[1] = v22;
    v41[2] = @"VERSION";
    errorCopy = error;
    v23 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(v17, "version")}];
    v42[2] = v23;
    v41[3] = @"RECIPEID";
    v24 = managedObjectContext;
    v25 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(v17, "recipeID")}];
    v41[4] = @"UTIS";
    v42[3] = v25;
    v42[4] = v18;
    v26 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v42 forKeys:v41 count:5];
    v27 = [v21 predicateWithSubstitutionVariables:v26];

    managedObjectContext = v24;
    v28 = +[PLInternalResource fetchRequest];
    [v28 setPredicate:v27];
    v36 = 0;
    v29 = [managedObjectContext executeFetchRequest:v28 error:&v36];
    v30 = v36;
    firstObject = [v29 firstObject];

    if (errorCopy && v30)
    {
      v31 = v30;
      *errorCopy = v30;
    }
  }

  return firstObject;
}

id __66__PLManagedAsset_RM___persistedResourceForResourceIdentity_error___block_invoke_2(uint64_t a1)
{
  v14[4] = *MEMORY[0x1E69E9840];
  v2 = _persistedResourceForResourceIdentity_error__s_intraAssetPredicateTemplate;
  v13[0] = @"RESOURCE_TYPE";
  v3 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(*(a1 + 32), "resourceType")}];
  v14[0] = v3;
  v13[1] = @"VERSION";
  v4 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(*(a1 + 32), "version")}];
  v14[1] = v4;
  v13[2] = @"RECIPEID";
  v5 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(*(a1 + 32), "recipeID")}];
  v13[3] = @"UTIS";
  v6 = *(a1 + 40);
  v14[2] = v5;
  v14[3] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v14 forKeys:v13 count:4];
  v8 = [v2 predicateWithSubstitutionVariables:v7];

  v9 = [*(a1 + 48) modernResources];
  v10 = [v9 filteredSetUsingPredicate:v8];
  v11 = [v10 anyObject];

  return v11;
}

void __66__PLManagedAsset_RM___persistedResourceForResourceIdentity_error___block_invoke()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset == $ASSET AND resourceType == $RESOURCE_TYPE AND version == $VERSION AND recipeID == $RECIPEID and compactUTI IN $UTIS"];
  v1 = _persistedResourceForResourceIdentity_error__s_fetchPredicateTemplate;
  _persistedResourceForResourceIdentity_error__s_fetchPredicateTemplate = v0;

  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"resourceType == $RESOURCE_TYPE AND version == $VERSION AND recipeID == $RECIPEID and compactUTI IN $UTIS"];
  v3 = _persistedResourceForResourceIdentity_error__s_intraAssetPredicateTemplate;
  _persistedResourceForResourceIdentity_error__s_intraAssetPredicateTemplate = v2;
}

+ (id)fetchResourcesForAssetWithObjectID:(id)d inContext:(id)context versions:(id)versions includeVirtualResources:(BOOL)resources allowDerivatives:(BOOL)derivatives excludeDynamicCPLResources:(BOOL)lResources additionalPredicate:(id)predicate relationshipKeyPathsForPrefetching:(id)self0 error:(id *)self1
{
  lResourcesCopy = lResources;
  derivativesCopy = derivatives;
  resourcesCopy = resources;
  v49[1] = *MEMORY[0x1E69E9840];
  dCopy = d;
  contextCopy = context;
  versionsCopy = versions;
  v19 = dCopy;
  predicateCopy = predicate;
  prefetchingCopy = prefetching;
  if (v19)
  {
    if (contextCopy)
    {
      goto LABEL_3;
    }
  }

  else
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1026 description:{@"Invalid parameter not satisfying: %@", @"assetObjectID"}];

    if (contextCopy)
    {
      goto LABEL_3;
    }
  }

  currentHandler2 = [MEMORY[0x1E696AAA8] currentHandler];
  [currentHandler2 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1027 description:{@"Invalid parameter not satisfying: %@", @"context"}];

LABEL_3:
  array = [MEMORY[0x1E695DF70] array];
  v45 = resourcesCopy;
  if (resourcesCopy)
  {
    array2 = [MEMORY[0x1E695DF70] array];
    if (versionsCopy)
    {
      versionsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"version IN %@", versionsCopy];
      [array2 addObject:versionsCopy];
    }

    if (!derivativesCopy)
    {
      predicateFilteringForNonDerivativeRecipeIDs = [objc_opt_class() predicateFilteringForNonDerivativeRecipeIDs];
      [array2 addObject:predicateFilteringForNonDerivativeRecipeIDs];
    }

    v25 = contextCopy;
    v43 = versionsCopy;
    if (predicateCopy)
    {
      [array2 addObject:predicateCopy];
    }

    v26 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:array2];
    v27 = [PLManagedAsset assetWithObjectID:v19 inManagedObjectContext:v25];
    v28 = [v27 nonPersistedResourcesWithOptions:0];
    v29 = [v28 filteredArrayUsingPredicate:v26];

    [array addObjectsFromArray:v29];
    versionsCopy = v43;
  }

  else
  {
    v27 = 0;
    v25 = contextCopy;
    v26 = 0;
  }

  selfCopy = self;
  v47 = v19;
  v31 = v19;
  v32 = versionsCopy;
  v33 = [selfCopy fetchRequestForResourcesWithObjectID:v31 versions:versionsCopy allowDerivatives:derivativesCopy excludeDynamicCPLResources:lResourcesCopy additionalPredicate:predicateCopy relationshipKeyPathsForPrefetching:prefetchingCopy];
  v34 = v25;
  v35 = [v25 executeFetchRequest:v33 error:error];
  [array addObjectsFromArray:v35];
  if (v45)
  {
    v36 = [v27 virtualResourcesThatReplaceMissingPersistedResources:v35];
    v37 = [v36 filteredArrayUsingPredicate:v26];

    [array addObjectsFromArray:v37];
  }

  v38 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"qualitySortValue" ascending:1];
  v49[0] = v38;
  v39 = [MEMORY[0x1E695DEC8] arrayWithObjects:v49 count:1];
  [array sortUsingDescriptors:v39];

  return array;
}

+ (id)fetchRequestForResourcesWithObjectID:(id)d versions:(id)versions allowDerivatives:(BOOL)derivatives excludeDynamicCPLResources:(BOOL)resources additionalPredicate:(id)predicate relationshipKeyPathsForPrefetching:(id)prefetching
{
  resourcesCopy = resources;
  dCopy = d;
  versionsCopy = versions;
  predicateCopy = predicate;
  v16 = MEMORY[0x1E695DF70];
  prefetchingCopy = prefetching;
  array = [v16 array];
  if (versionsCopy)
  {
    versionsCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"version IN %@", versionsCopy];
    [array addObject:versionsCopy];
  }

  if (derivatives)
  {
    if (!resourcesCopy)
    {
      goto LABEL_8;
    }

    predicateExcludingLocallyUnavailableDynamicCPLResources = [objc_opt_class() predicateExcludingLocallyUnavailableDynamicCPLResources];
  }

  else
  {
    predicateExcludingLocallyUnavailableDynamicCPLResources = [objc_opt_class() predicateFilteringForNonDerivativeRecipeIDs];
  }

  v21 = predicateExcludingLocallyUnavailableDynamicCPLResources;
  [array addObject:predicateExcludingLocallyUnavailableDynamicCPLResources];

LABEL_8:
  if (predicateCopy)
  {
    [array addObject:predicateCopy];
  }

  dCopy = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset == %@", dCopy];
  [array addObject:dCopy];

  v23 = +[PLInternalResource fetchRequest];
  v24 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:array];
  [v23 setPredicate:v24];

  [v23 setRelationshipKeyPathsForPrefetching:prefetchingCopy];
  [v23 setReturnsObjectsAsFaults:0];

  return v23;
}

+ (void)enumerateImageRequestHintData:(id)data assetWidth:(int64_t)width assetHeight:(int64_t)height libraryID:(id)d startingOffset:(int64_t)offset assetID:(id)iD block:(id)block
{
  v56 = *MEMORY[0x1E69E9840];
  dataCopy = data;
  dCopy = d;
  iDCopy = iD;
  blockCopy = block;
  v53 = 0;
  bytes = [dataCopy bytes];
  v44 = dataCopy;
  v18 = [dataCopy length];
  v49 = 0;
  v50 = &v49;
  v51 = 0x2020000000;
  offsetCopy = offset;
  if (v18 - 1 < offset)
  {
    currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
    [currentHandler handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:616 description:@"enumerateImageRequestHintData: startingOffset must be less than hint length when data is available."];
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __114__PLManagedAsset_RM__enumerateImageRequestHintData_assetWidth_assetHeight_libraryID_startingOffset_assetID_block___block_invoke;
  aBlock[3] = &unk_1E75779F0;
  aBlock[4] = &v49;
  aBlock[5] = v18;
  v19 = _Block_copy(aBlock);
  v20 = v50 + 3;
  v21 = v50[3];
  if (v21 < v18 && (v53 & 1) == 0)
  {
    widthCopy = width;
    heightCopy = height;
    v24 = (height * width);
    while (1)
    {
      v25 = bytes + v21;
      *v20 = v21 + 3;
      v26 = *(bytes + v21 + 2) & 3;
      v27 = PLDataStoreForClassIDAndLibraryID(v26, dCopy);
      if (!v27)
      {
        break;
      }

      v28 = [objc_opt_class() keyLengthWithDataPreview:*(bytes + v50[3])];
      if (!v28)
      {
        v41 = PLBackendGetLog();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
        {
          uuid = [iDCopy uuid];
          *buf = 138543362;
          v55 = uuid;
          _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_ERROR, "Invalid keyLen. Exiting hint enumeration for assetID: %{public}@", buf, 0xCu);
        }

        goto LABEL_29;
      }

      v29 = v50[3];
      _ZF = v26 == 3 || v26 == 0;
      if (_ZF && *(bytes + v29) >= 0x10u)
      {
        v31 = PLBackendGetLog();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
        {
          uuid2 = [iDCopy uuid];
          *buf = 138543362;
          v55 = uuid2;
          _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "Invalid FilePath strategy hint data. Skipping hint assetID: %{public}@", buf, 0xCu);
        }

        v19[2](v19, v28);
      }

      else
      {
        if (v26 > 1)
        {
          [v27 keyFromKeyStruct:bytes + v29];
        }

        else
        {
          [PLTaggedPointerDataStoreKey keyWithKeyStruct:bytes + v29 keyLength:v28 forStoreClassID:v26 inLibraryWithID:dCopy];
        }
        v33 = ;
        v34 = [v33 recipeIDForAssetID:iDCopy];
        v19[2](v19, v28);
        _H0 = *v25;
        __asm { FCVT            D0, H0 }

        v40 = sqrt(_D0);
        *&v40 = round(widthCopy / v40) * round(heightCopy / v40) / v24;
        (*(blockCopy + 2))(blockCopy, v50[3], (*(v25 + 2) >> 2) & 1, (*(v25 + 2) >> 3) & 1, v27, v33, v25, v28 + 3, *&v40, v34, &v53);
      }

      v20 = v50 + 3;
      v21 = v50[3];
      if (v21 >= v18 || (v53 & 1) != 0)
      {
        goto LABEL_30;
      }
    }

    v41 = PLImageManagerGetLog();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      *buf = 67109120;
      LODWORD(v55) = v26;
      _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_ERROR, "[RM]: unable to parse image request hints (can't find data store class for classID: %d", buf, 8u);
    }

    v27 = 0;
LABEL_29:
  }

LABEL_30:

  _Block_object_dispose(&v49, 8);
}

uint64_t __114__PLManagedAsset_RM__enumerateImageRequestHintData_assetWidth_assetHeight_libraryID_startingOffset_assetID_block___block_invoke(uint64_t result, unsigned int a2)
{
  *(*(*(result + 32) + 8) + 24) += a2;
  v2 = *(*(result + 32) + 8);
  if (!a2 || *(v2 + 24) >= *(result + 40))
  {
    *(v2 + 24) = 0x7FFFFFFFFFFFFFFFLL;
  }

  return result;
}

+ (id)calculateImageRequestHintsFromSortedResources:(id)resources asset:(id)asset
{
  v50 = *MEMORY[0x1E69E9840];
  resourcesCopy = resources;
  assetCopy = asset;
  data = [MEMORY[0x1E695DF88] data];
  v43 = 0u;
  v44 = 0u;
  v45 = 0u;
  v46 = 0u;
  v7 = resourcesCopy;
  v8 = 0x1E695D000uLL;
  obj = v7;
  v9 = [v7 countByEnumeratingWithState:&v43 objects:v49 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v44;
    v39 = *v44;
    do
    {
      v12 = 0;
      v41 = v10;
      do
      {
        if (*v44 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v43 + 1) + 8 * v12);
        if (PLCanIncludeResourceInHints(v13, assetCopy))
        {
          width = [assetCopy width];
          height = [assetCopy height];
          v16 = v13;
          v17 = [*(v8 + 3976) dataWithCapacity:3];
          dataStoreKey = [v16 dataStoreKey];
          keyData = [dataStoreKey keyData];

          if (keyData)
          {
            dataStore = [v16 dataStore];
            if (dataStore)
            {
              storeClassID = [objc_opt_class() storeClassID];
              unorientedWidth = [v16 unorientedWidth];
              unorientedHeight = [v16 unorientedHeight];
              _H0 = 5120;
              if (height * width >= 1)
              {
                _H0 = 5120;
                if (unorientedHeight * unorientedWidth >= 1)
                {
                  _S0 = 1.0 / ((unorientedHeight * unorientedWidth) / (height * width));
                  __asm { FCVT            H0, S0 }
                }
              }

              v30 = storeClassID & 3;
              if (fabsl(*&_H0) == COERCE_SHORT_FLOAT(31744))
              {
                v31 = COERCE_SHORT_FLOAT(31743);
              }

              else
              {
                v31 = *&_H0;
              }

              if ([v16 recipeID] == 65749)
              {
                LOWORD(v32) = COERCE_UNSIGNED_INT(1.0);
              }

              else
              {
                v32 = v31;
              }

              v47 = v32;
              uniformTypeIdentifier = [v16 uniformTypeIdentifier];
              if ([uniformTypeIdentifier isPrimaryImageFormat])
              {
                v34 = 4;
              }

              else
              {
                v34 = 0;
              }

              v35 = v34 | v30;

              if ([v16 isDefaultOrientation])
              {
                v36 = 8;
              }

              else
              {
                v36 = 0;
              }

              v48 = v35 | v36;
              [v17 appendBytes:&v47 length:3];
              [v17 appendData:keyData];
              v37 = v17;
              v8 = 0x1E695D000;
            }

            else
            {
              v37 = 0;
            }

            v11 = v39;
          }

          else
          {
            v37 = 0;
          }

          if ([v37 length])
          {
            [data appendData:v37];
          }

          v10 = v41;
        }

        ++v12;
      }

      while (v10 != v12);
      v10 = [obj countByEnumeratingWithState:&v43 objects:v49 count:16];
    }

    while (v10);
  }

  return data;
}

+ (id)debugDescriptionForHintData:(id)data assetWidth:(int64_t)width assetHeight:(int64_t)height assetID:(id)d
{
  dCopy = d;
  v11 = MEMORY[0x1E696AD60];
  dataCopy = data;
  v13 = objc_alloc_init(v11);
  uuid = [dCopy uuid];
  [v13 appendFormat:@"Image request hints for %@", uuid];

  libraryID = [dCopy libraryID];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __81__PLManagedAsset_RM__debugDescriptionForHintData_assetWidth_assetHeight_assetID___block_invoke;
  v21[3] = &unk_1E75779C8;
  v16 = v13;
  v22 = v16;
  v23 = dCopy;
  v17 = dCopy;
  [self enumerateImageRequestHintData:dataCopy assetWidth:width assetHeight:height libraryID:libraryID startingOffset:0 assetID:v17 block:v21];

  v18 = v23;
  v19 = v16;

  return v16;
}

void __81__PLManagedAsset_RM__debugDescriptionForHintData_assetWidth_assetHeight_assetID___block_invoke(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, void *a6)
{
  v7 = *(a1 + 32);
  v8 = a6;
  v11 = DCIM_NSStringFromCGSize();
  v9 = [v8 fileURLForAssetID:*(a1 + 40)];

  v10 = [v9 path];
  [v7 appendFormat:@"\n  %@ %@", v11, v10];
}

+ (id)predicateExcludingLocallyUnavailableDynamicCPLResources
{
  if (predicateExcludingLocallyUnavailableDynamicCPLResources_s_onceToken != -1)
  {
    dispatch_once(&predicateExcludingLocallyUnavailableDynamicCPLResources_s_onceToken, &__block_literal_global_54);
  }

  v3 = predicateExcludingLocallyUnavailableDynamicCPLResources_s_predicate;

  return v3;
}

void __77__PLManagedAsset_RM__predicateExcludingLocallyUnavailableDynamicCPLResources__block_invoke()
{
  v9[4] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"dataStoreClassID", 0];
  v9[0] = v1;
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"dataStoreSubtype", 0];
  v9[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K < %d", @"localAvailability", 1];
  v9[2] = v3;
  v4 = [MEMORY[0x1E6994B90] predicateMatchingDynamicFingerprintForKey:@"fingerprint"];
  v9[3] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:4];
  v6 = [v0 andPredicateWithSubpredicates:v5];
  v7 = [v0 notPredicateWithSubpredicate:v6];
  v8 = predicateExcludingLocallyUnavailableDynamicCPLResources_s_predicate;
  predicateExcludingLocallyUnavailableDynamicCPLResources_s_predicate = v7;
}

+ (id)predicateFilteringForNonDerivativeRecipeIDs
{
  if (predicateFilteringForNonDerivativeRecipeIDs_s_onceToken != -1)
  {
    dispatch_once(&predicateFilteringForNonDerivativeRecipeIDs_s_onceToken, &__block_literal_global_113364);
  }

  v3 = predicateFilteringForNonDerivativeRecipeIDs_s_predicate;

  return v3;
}

void __65__PLManagedAsset_RM__predicateFilteringForNonDerivativeRecipeIDs__block_invoke()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K == %d) || (%K & %d) != %d", @"recipeID", 0, @"recipeID", 1, 1];
  v1 = predicateFilteringForNonDerivativeRecipeIDs_s_predicate;
  predicateFilteringForNonDerivativeRecipeIDs_s_predicate = v0;
}

@end