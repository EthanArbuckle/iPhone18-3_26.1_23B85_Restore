@interface PLManagedAsset
+ (BOOL)_checkComputeSyncUploadPolicyWithCPLConfiguration:(id)a3 library:(id)a4 debugMode:(BOOL)a5 debugLog:(id)a6;
+ (BOOL)_isLibraryScopeExiting:(id)a3;
+ (BOOL)_isScreenshotWithType:(id)a3 hasScreenshotDimensions:(BOOL)a4 hasScreenshotMetadata:(BOOL)a5;
+ (BOOL)_shouldPushComputeSyncWithLocalMajorVersion:(signed __int16)a3 localAnalaysisStage:(signed __int16)a4 cloudComputeStateVersionStr:(id)a5 localAdjustmentFingerprint:(id)a6 cloudAdjustmentFingerprint:(id)a7 scopedIdentifier:(id)a8;
+ (BOOL)attemptToRecreateMasterAndAssetResourcesForPlaceholderAssetRepush:(id)a3 sourceAsset:(id)a4 library:(id)a5;
+ (BOOL)canPlayPhotoIrisWithPhotoIris:(BOOL)a3 photoIrisPlaceholder:(BOOL)a4 hasAdjustments:(BOOL)a5 videoCpVisibilityState:(unsigned __int16)a6;
+ (BOOL)cloneResourceFileFromURL:(id)a3 toURL:(id)a4 forDestinationResource:(id)a5 forDestinationAsset:(id)a6 fileManager:(id)a7 error:(id *)a8;
+ (BOOL)createAssetResourcesForPlaceholderAsset:(id)a3 withSourceAsset:(id)a4 shouldBakeInAdjustments:(BOOL)a5 shouldFlattenLivePhoto:(BOOL)a6 placeholderResourceURLToSourceResourceURLMap:(id)a7 photoLibrary:(id)a8;
+ (BOOL)createMasterForPlaceholderAsset:(id)a3 withSourceAsset:(id)a4 shouldBakeInAdjustments:(BOOL)a5 shouldFlattenLivePhoto:(BOOL)a6 placeholderResourceURLToSourceResourceURLMap:(id)a7 photoLibrary:(id)a8;
+ (BOOL)createShareAssetsForShare:(id)a3 batchedSourceAssetsToCopy:(id)a4 creationRequestSourceAssetsToShareAssetsMap:(id)a5 curatedSourceAssets:(id)a6 adjustmentBakeInOptionsDictionary:(id)a7 metadataCopyOptionsDictionary:(id)a8 keySourceAssetIdentifier:(id)a9 commentText:(id)a10 clientConnection:(id)a11 library:(id)a12 error:(id *)a13;
+ (BOOL)guaranteedFlashOffForAssetAtURL:(id)a3;
+ (BOOL)hasMasterThumbWithThumbnailIndex:(int64_t)a3;
+ (BOOL)hasRequiredExtendedAttributesForMainFileURL:(id)a3;
+ (BOOL)hasRequiredExtendedAttributesForPersistanceAttributes:(id)a3;
+ (BOOL)installResourcesForAssetAndRemoveDeferredProcessingPreviewFile:(id)a3 error:(id *)a4;
+ (BOOL)invalidateReverseLocationDataOnAllAssetsInManagedObjectContext:(id)a3 error:(id *)a4;
+ (BOOL)isComputeSyncEnabledForDirection:(int64_t)a3 library:(id)a4 debugMode:(BOOL)a5 debugLog:(id *)a6;
+ (BOOL)isHFRVideoAVAsset:(id)a3;
+ (BOOL)isKnownFileExtension:(id)a3;
+ (BOOL)isPhotoIrisPlaceholderWithPhotoIris:(BOOL)a3 videoCpDuration:(int64_t)a4 isCloudShared:(BOOL)a5 videoCpFilePath:(id)a6;
+ (BOOL)isPrimaryImageFormatForUTI:(id)a3;
+ (BOOL)isScreenRecordingFileName:(id)a3;
+ (BOOL)isValidFileExtensionForImport:(id)a3;
+ (BOOL)isValidFileURLForImport:(id)a3;
+ (BOOL)isVideoComplementVisibilityStatePlayable:(unsigned __int16)a3 hasAdjustments:(BOOL)a4;
+ (BOOL)markUnavailableComputeSyncResourcesWithManagedObjectContext:(id)a3 error:(id *)a4;
+ (BOOL)shouldBakeInAdjustmentsAndFlattenLivePhoto:(BOOL *)a3 forSourceAsset:(id)a4 adjustmentBakeInOptions:(id)a5;
+ (BOOL)shouldPerformServerCopyOnPlaceholderAsset:(id)a3 photoLibrary:(id)a4;
+ (BOOL)shouldPerformServerCopyWithSourceAsset:(id)a3 copyingFromShare:(BOOL)a4 photoLibrary:(id)a5;
+ (BOOL)shouldSyncAssetToSPLWithSavedAssetType:(signed __int16)a3 syndicationState:(unsigned __int16)a4;
+ (BOOL)validShareForPlaceholderAsset:(id)a3;
+ (CGSize)dimensionsForAVAsset:(id)a3;
+ (CGSize)dimensionsForVideoAtURL:(id)a3;
+ (CGSize)sizeOfImageAtURL:(id)a3 outOrientation:(signed __int16 *)a4;
+ (NSPredicate)predicateToIncludeSharedLibrarySharingSuggestionsAssets;
+ (PLManagedAsset)assetWithObjectID:(id)a3 inLibrary:(id)a4;
+ (PLManagedAsset)assetWithObjectID:(id)a3 inManagedObjectContext:(id)a4;
+ (PLManagedAsset)assetWithScopedIdentifier:(id)a3 inLibrary:(id)a4 prefetchResources:(BOOL)a5;
+ (PLManagedAsset)assetWithSyndicationIdentifier:(id)a3 inLibrary:(id)a4;
+ (PLManagedAsset)assetWithUUID:(id)a3 inLibrary:(id)a4;
+ (PLManagedAsset)assetWithUUID:(id)a3 inManagedObjectContext:(id)a4;
+ (id)_cloudAdjustmentFingerprintWithAdjustmentDataBlob:(id)a3 largeAdjustmentBlobFingerpint:(id)a4 formatIdentifier:(id)a5 formatVersion:(id)a6 editorBundleID:(id)a7 baseVersion:(int64_t)a8 baseImageData:(id)a9 baseImageFingerprint:(id)a10;
+ (id)_countOfAssetsByKindWithResourcePredicate:(id)a3 inContext:(id)a4;
+ (id)_createAssetModelToInsert:(id)a3 uuid:(id)a4 replacementUUID:(id)a5;
+ (id)_dataFromCPLPlaceAnnotation:(id)a3;
+ (id)_importAlbumIsolationQueue;
+ (id)_insertAssetIntoPhotoLibrary:(id)a3 mainFileURL:(id)a4 mainFileMetadata:(id)a5 savedAssetType:(signed __int16)a6 bundleScope:(unsigned __int16)a7 uuid:(id)a8 replacementUUID:(id)a9 imageSource:(CGImageSource *)a10 imageData:(id *)a11 isPlaceholder:(BOOL)a12 deleteFileOnFailure:(BOOL)a13;
+ (id)_insertSyndicationAssetIntoPhotoLibrary:(id)a3 uuid:(id)a4 syndicationIdentifier:(id)a5 bundleID:(id)a6 addedDate:(id)a7;
+ (id)_newPathAndDateDictionariesByAssetUUIDFromFetchResults:(id)a3 photoLibrary:(id)a4;
+ (id)_notPushedAssetsToUploadInitiallyInManagedObjectContext:(id)a3 withSavedAssetTypePredicate:(id)a4 shouldSort:(BOOL)a5 limit:(unint64_t)a6;
+ (id)_placeAnnotationFromAnnotationData:(id)a3;
+ (id)_predicateForAssetsWithNotCompleteResourcesOnResource;
+ (id)_predicateForAvalancheKindAssetsWithUUID:(id)a3 kind:(unsigned __int16)a4;
+ (id)_predicateForCloudLocalStates:(id)a3;
+ (id)_predicateForDepthType:(signed __int16)a3;
+ (id)_predicateForTrashedAssetsToExcludeInInitialUpload;
+ (id)_ptpCalendar;
+ (id)_ptpEventInfoIsolationQueue;
+ (id)_syncablePredicate;
+ (id)_syndicationAssetForSearchableItem:(id)a3 inLibrary:(id)a4 createIfNeeded:(BOOL)a5 didCreate:(BOOL *)a6 error:(id *)a7;
+ (id)_videoComplementURLForSharingFromAsset:(id)a3;
+ (id)allCloudSharedAssetsInLibrary:(id)a3;
+ (id)allHDRValues;
+ (id)assetUUIDsByObjectIDs:(id)a3 withFilterPredicate:(id)a4 context:(id)a5 error:(id *)a6;
+ (id)assetsByCloudAssetUUID:(id)a3 inLibrary:(id)a4;
+ (id)assetsByScopedIdentifiers:(id)a3 relationshipKeyPathsForPrefetching:(id)a4 inLibrary:(id)a5;
+ (id)assetsLibraryURLWithUUID:(id)a3 extension:(id)a4;
+ (id)assetsToConsiderForTypePromotionInContext:(id)a3 withExtensions:(id)a4 error:(id *)a5;
+ (id)assetsToRetryInLibrary:(id)a3 limit:(unint64_t)a4;
+ (id)assetsToUploadInitiallyInManagedObjectContext:(id)a3 limit:(unint64_t)a4;
+ (id)assetsWithGroupingUUID:(id)a3 inManagedObjectContext:(id)a4;
+ (id)assetsWithObjectIDs:(id)a3 inLibrary:(id)a4;
+ (id)assetsWithScopedIdentifiers:(id)a3 prefetchResources:(BOOL)a4 relationshipKeyPathsForPrefetching:(id)a5 inLibrary:(id)a6;
+ (id)assetsWithUUIDs:(id)a3 options:(unint64_t)a4 inLibrary:(id)a5;
+ (id)assetsWithUUIDs:(id)a3 options:(unint64_t)a4 inManagedObjectContext:(id)a5;
+ (id)assetsWithValidatedSavedAssetTypeMask:(unsigned int)a3 inManagedObjectContext:(id)a4;
+ (id)attributeValidationRules;
+ (id)calculateImageRequestHintsFromSortedResources:(id)a3 asset:(id)a4;
+ (id)cloudMasterMediaMetadataForAssetObjectID:(id)a3 managedObjectContext:(id)a4 error:(id *)a5;
+ (id)cloudSharedAssetsWithGUIDs:(id)a3 inLibrary:(id)a4;
+ (id)createCloudPhotoLibraryAssetWithAssetRecord:(id)a3 withCloudMaster:(id)a4 inLibrary:(id)a5;
+ (id)createOrUpdateObjectFromSearchableItem:(id)a3 library:(id)a4 fullIndexSyncStartDate:(id)a5 createIfNeeded:(BOOL)a6 didCreate:(BOOL *)a7 isSyndicatable:(BOOL *)a8 error:(id *)a9;
+ (id)createSparseComputeStateRecordsForAssets:(id)a3 inPhotoLibrary:(id)a4;
+ (id)debugDescriptionForHintData:(id)a3 assetWidth:(int64_t)a4 assetHeight:(int64_t)a5 assetID:(id)a6;
+ (id)diagnosticFilePathForLibrary:(id)a3 mainFilename:(id)a4 createIfNeeded:(BOOL)a5;
+ (id)eventInfoForPTP;
+ (id)failedToPushAssetInLibrary:(id)a3;
+ (id)fetchAssetsWithUUIDs:(id)a3 managedObjectContext:(id)a4;
+ (id)fetchAssetsWithUUIDs:(id)a3 managedObjectContext:(id)a4 error:(id *)a5;
+ (id)fetchPredicateForLegacyRequiredResourcesLocallyAvailable:(BOOL)a3 photoLibrary:(id)a4;
+ (id)fetchRequestForResourcesWithObjectID:(id)a3 versions:(id)a4 allowDerivatives:(BOOL)a5 excludeDynamicCPLResources:(BOOL)a6 additionalPredicate:(id)a7 relationshipKeyPathsForPrefetching:(id)a8;
+ (id)fetchRequestForSortedCloudSharedAssetsWithPlaceholderKindsRequiringThumbnails:(BOOL)a3 additionalPredicate:(id)a4 ascending:(BOOL)a5;
+ (id)fetchResourcesForAssetWithObjectID:(id)a3 inContext:(id)a4 versions:(id)a5 includeVirtualResources:(BOOL)a6 allowDerivatives:(BOOL)a7 excludeDynamicCPLResources:(BOOL)a8 additionalPredicate:(id)a9 relationshipKeyPathsForPrefetching:(id)a10 error:(id *)a11;
+ (id)fileURLFromAssetURL:(id)a3 photoLibrary:(id)a4;
+ (id)generateFullComputeStateRecordForRecord:(id)a3 payloadHelper:(id)a4 destinationDirectoryURL:(id)a5 inPhotoLibrary:(id)a6;
+ (id)imageAssetsForMediaGroupUUID:(id)a3 moc:(id)a4;
+ (id)isEligibleForSearchIndexingPredicateForLibraryIdentifier:(int64_t)a3;
+ (id)lightweightReimportFileNameWithGUID:(id)a3 type:(id)a4;
+ (id)listOfSharingAttributesRelevantForUpload;
+ (id)listOfSharingRelationshipsRelevantForUpload;
+ (id)listOfSyncedProperties;
+ (id)newImagePropertiesFromImageSource:(CGImageSource *)a3;
+ (id)newLocationDataFromLocation:(id)a3;
+ (id)newLocationFromLocationData:(id)a3 timestampIfMissing:(id)a4;
+ (id)objectsWithScopedIdentifiers:(id)a3 forEntityName:(id)a4 prefetchResources:(BOOL)a5 relationshipKeyPathsForPrefetching:(id)a6 inLibrary:(id)a7;
+ (id)pathAndDateDictionariesForAllIncompleteAssetsInManagedObjectContext:(id)a3;
+ (id)pathForAdjustmentDataFileWithPathManager:(id)a3 bundleScope:(unsigned __int16)a4 uuid:(id)a5 directory:(id)a6 filename:(id)a7;
+ (id)pathForAdjustmentFileWithPathManager:(id)a3 bundleScope:(unsigned __int16)a4 uuid:(id)a5 directory:(id)a6 filename:(id)a7;
+ (id)pathForAlchemistImageWithUUID:(id)a3 bundleScope:(unsigned __int16)a4 directory:(id)a5 filename:(id)a6 pathManager:(id)a7;
+ (id)pathForMutationsDirectoryWithDirectory:(id)a3 filename:(id)a4;
+ (id)persistedRecentlyUsedGUIDSWithPathManager:(id)a3;
+ (id)photoFromAssetURL:(id)a3 photoLibrary:(id)a4 sidecar:(id *)a5;
+ (id)predicateExcludingLocallyUnavailableDynamicCPLResources;
+ (id)predicateFilteringForNonDerivativeRecipeIDs;
+ (id)predicateForAdjustedAssetsWithKeyPathToAsset:(id)a3;
+ (id)predicateForAssetSharingFilter:(signed __int16)a3 noindex:(BOOL)a4;
+ (id)predicateForAssetSubtype:(signed __int16)a3;
+ (id)predicateForAssetsIncompletelyProcessedForSensitivity;
+ (id)predicateForAssetsToCheckForDeletionOnCPLDisable;
+ (id)predicateForAssetsWithCompleteResourcesOnAsset;
+ (id)predicateForAvalancheKindAssetsWithKind:(unsigned __int16)a3;
+ (id)predicateForBurstStackAssets;
+ (id)predicateForReframedAssets;
+ (id)predicateForShouldSyncToSPL;
+ (id)predicateForSpatialOverCaptureAssets;
+ (id)predicateForStyleableAssets;
+ (id)predicateForSupportedAssetTypesForUpload;
+ (id)predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders;
+ (id)predicateForSyndicatedAssetIdentifiers:(id)a3 includeRejected:(BOOL)a4;
+ (id)predicateForSyndicatedAssetIdentifiersSuffix:(id)a3;
+ (id)predicateForUnadjustedAssetsWithKeyPathToAsset:(id)a3;
+ (id)predicateForUnpushedDeferredAssets;
+ (id)predicateForUploadableAssetsWithCloudLocalState:(signed __int16)a3;
+ (id)predicateForUploadableAssetsWithCloudLocalStates:(id)a3;
+ (id)predicateForUploadableAssetsWithMasterCloudLocalStateNotEqualTo:(signed __int16)a3;
+ (id)predicateForUploadableAssetsWithoutCloudLocalState:(signed __int16)a3;
+ (id)predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath:(id)a3;
+ (id)predicateToExcludeCameraAutoAdjustments;
+ (id)predicateToExcludeHiddenAssetsWithHiddenKeyPath:(id)a3;
+ (id)predicateToExcludeNonVisibleStackedAssets;
+ (id)predicateToExcludeNonvisibleBurstAssets;
+ (id)predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath:(id)a3;
+ (id)predicateToExcludeRestrictedLockedAssets;
+ (id)predicateToExcludeTrashedAssets;
+ (id)predicateToExcludeTrashedAssetsWithTrashedStateKeyPath:(id)a3;
+ (id)predicateToExcludeVideosWithVideoKeyFrameSetWithKeyPathToAsset:(id)a3;
+ (id)predicateToIncludeBothPrivateAssetsAndSharedContentContributedByCurrentUser;
+ (id)predicateToIncludeDuplicateAssetVisibilityStateMostRelevant;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToFaceVersion:(id)a3;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestFaceVersion;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestSceneVersion;
+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToSceneVersion:(id)a3;
+ (id)predicateToIncludePrivateLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)a3;
+ (id)predicateToIncludeSharedLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)a3;
+ (id)predicateToLimitToCaptureSessionIdentifier:(id)a3;
+ (id)preferredFileExtensionForType:(id)a3;
+ (id)propertiesToFetch;
+ (id)ptpAssetIDForEventAndFilenameKey:(id)a3;
+ (id)quarantinedAssetsInLibrary:(id)a3;
+ (id)relationshipKeyPathsToPrefetch;
+ (id)toUploadAssetsInLibrary:(id)a3;
+ (id)uniformTypeFromPathExtension:(id)a3 assetType:(signed __int16)a4;
+ (id)uniformTypeIdentifierFromPathExtension:(id)a3 assetType:(signed __int16)a4;
+ (id)uuidFromAssetURL:(id)a3 fileExtension:(id *)a4 sidecarIndex:(id *)a5;
+ (id)videoAssetsForMediaGroupUUID:(id)a3 moc:(id)a4;
+ (id)videoComplementVisibilityStatePlayablePredicate;
+ (int64_t)_locationDataFormat:(id)a3;
+ (int64_t)adjustmentBaseVersionFromPFAdjustmentsBaseVersion:(int64_t)a3;
+ (int64_t)pfAdjustmentsBaseVersionFromAdjustmentBaseVersion:(int64_t)a3;
+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)a3 urgency:(int64_t)a4;
+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)a3 urgency:(int64_t)a4 sizeOption:(unint64_t)a5;
+ (signed)assetTypeFromUniformTypeIdentifier:(id)a3;
+ (signed)correctedOrientation:(signed __int16)a3;
+ (signed)imageDepthTypeFromCustomRenderedValue:(signed __int16)a3;
+ (signed)imageHDRTypeFromCustomRenderedValue:(signed __int16)a3;
+ (unint64_t)CPLAssetHDRTypeFromPLAssetHDRType:(signed __int16)a3;
+ (unint64_t)_sumOfCountsInCountedSet:(id)a3;
+ (unint64_t)countForAssetsWithUUIDs:(id)a3 uuidKeyPath:(id)a4 includePendingChanges:(BOOL)a5 inManagedObjectContext:(id)a6 error:(id *)a7;
+ (unint64_t)countOfDeferredAssetsToSyncInPhotoLibrary:(id)a3 outAssetList:(id)a4;
+ (unint64_t)countOfNotUploadedAssetsInPhotoLibrary:(id)a3 forAssetType:(signed __int16)a4 error:(id *)a5;
+ (unint64_t)countUsedAssetsWithKind:(signed __int16)a3 excludeTrashed:(BOOL)a4 excludeInvisible:(BOOL)a5 excludeCloudShared:(BOOL)a6 excludePhotoStream:(BOOL)a7 inManagedObjectContext:(id)a8;
+ (unint64_t)iCPLAssetCountInPhotoLibrary:(id)a3;
+ (unint64_t)resourceTypeForUnadjustedFlattenedLivePhotoAssetResourceType:(unint64_t)a3;
+ (unint64_t)totalSizeOfUnpushedOriginalsInPhotoLibrary:(id)a3 outMasterList:(id)a4 isInitialUpload:(BOOL)a5;
+ (unsigned)defaultPlaybackStyleFromAssetType:(signed __int16)a3 subtype:(signed __int16)a4 playbackVariation:(unsigned __int16)a5;
+ (void)_cloneResourcesForSharePlaceholderAsset:(id)a3 withPlaceholderResourceURLToSourceResourceURLMap:(id)a4 fileManager:(id)a5 photoLibrary:(id)a6;
+ (void)_createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs:(id)a3 withBatchCommentText:(id)a4 adjustmentBakeInOptionsDictionary:(id)a5 collectionShare:(id)a6 library:(id)a7 completionHandler:(id)a8;
+ (void)_rm_copyResourceFileFrom:(id)a3 to:(id)a4 forCloudMaster:(id)a5 andAsset:(id)a6;
+ (void)batchFetchAssetsByFaceUUIDWithFaceUUIDs:(id)a3 library:(id)a4 completion:(id)a5;
+ (void)clearImportSessionObjectIDCacheOnManagedObjectContext:(id)a3;
+ (void)computePreCropThumbnailSize:(CGSize *)a3 andPostCropSize:(CGSize *)a4 forOrientedOriginalSize:(CGSize)a5 andCroppedSize:(CGSize)a6 isLargeThumbnail:(BOOL)a7;
+ (void)countOfAssetsWithRequiredResourcesNotLocallyAvailableInLibrary:(id)a3 outCount:(unint64_t *)a4 photoCount:(unint64_t *)a5 videoCount:(unint64_t *)a6;
+ (void)createMastersInLibrary:(id)a3;
+ (void)createTHMFileWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fileURLForThumbnailFile:(id)a5;
+ (void)createThumbnailImage:(id *)a3 previewImage:(id *)a4 withToBeReleasedImageSource:(CGImageSource *)a5;
+ (void)deleteOldPlaceholderAssetsInManagedObjectContext:(id)a3;
+ (void)enumerateImageRequestHintData:(id)a3 assetWidth:(int64_t)a4 assetHeight:(int64_t)a5 libraryID:(id)a6 startingOffset:(int64_t)a7 assetID:(id)a8 block:(id)a9;
+ (void)fixMissingOriginalDateCreatedIfNeededForAsset:(id)a3 withCloudMaster:(id)a4;
+ (void)fixMissingOriginalTimezoneIfNeededForAsset:(id)a3;
+ (void)fixupCloudPhotoLibraryAsset:(id)a3 withCloudMaster:(id)a4 inLibrary:(id)a5;
+ (void)markAssetAsRecentlyUsed:(id)a3;
+ (void)markMomentShareAndCollectionShareAssetsAsCopied:(id)a3;
+ (void)performTransactionOnSyndicationLibraryWithSyndicationIdentifier:(id)a3 block:(id)a4;
+ (void)processAdjustedMediaMetadataForAsset:(id)a3;
+ (void)processMediaMetadataForAsset:(id)a3 withCloudMaster:(id)a4;
+ (void)ptpResetEventAndFilenameMapping;
+ (void)ptpSetAssetIDForEventAndFilenameKey:(id)a3 value:(id)a4;
+ (void)resetAssetsCloudStateInLibrary:(id)a3;
+ (void)rm_cplResourceWasUploaded:(id)a3 photoLibrary:(id)a4;
+ (void)updateAllAlbumAssociationIfNeededWithLibrary:(id)a3;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisStillDisplayTime;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisVideoDuration;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)videoKeyFrameTime;
- (BOOL)_analysisStateWasChangedForWorkerType:(signed __int16)a3;
- (BOOL)_checkForAndAddFrameDropRecoveryForPhotoKitIngest;
- (BOOL)_hasBecomeNonVisibleToMemoriesAndPersonsAndSuggestions:(id)a3;
- (BOOL)_hasPanoramaDimensions;
- (BOOL)_hasScreenshotDimensions;
- (BOOL)_hasVideoComplementData;
- (BOOL)_ingestAndApplyMetadataChangesFromAdjustments:(id)a3 updateAdjustmentDictionary:(id)a4 options:(id)a5 fullSizeRenderURL:(id)a6 videoPosterRenderURL:(id)a7 isRevertToOriginal:(BOOL)a8 error:(id *)a9;
- (BOOL)_installExistingPurgeableResourceAtPath:(id)a3 dstPath:(id)a4 error:(id *)a5 installResourceHandler:(id)a6;
- (BOOL)_isAdjustedResourceAvailableForResourceType:(unint64_t)a3 outResource:(id *)a4;
- (BOOL)_isCameraAutoAdjustmentChecksNeededAndUpdateAsset;
- (BOOL)_isMasterResourceAvailableForResourceType:(unint64_t)a3 outResource:(id *)a4;
- (BOOL)_isPartOfAvalancheWithKind:(unsigned __int16)a3;
- (BOOL)_isResourceAvailableForResourceType:(unint64_t)a3 outResource:(id *)a4;
- (BOOL)_isResourceType:(unint64_t)a3 inResources:(id)a4;
- (BOOL)_isValidUTI:(id)a3 forService:(id)a4;
- (BOOL)_linkVideoFileFromSourcePath:(id)a3 toDestinationPath:(id)a4;
- (BOOL)_location:(id)a3 isEqualToLocationForUpdating:(id)a4;
- (BOOL)_migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat;
- (BOOL)_migrateLegacySLMAdjustments;
- (BOOL)_setDefaultCinematicAdjustementsWithMainFileMetadata:(id)a3;
- (BOOL)_setDefaultSlowMotionAdjustmentsWithMainFileMetadata:(id)a3;
- (BOOL)_setHDRTypeFromMetadata:(id)a3;
- (BOOL)_setupPlaceholderAdjustmentPropertiesFromSourceAsset:(id)a3 bakeInAdjustmentsFromSourceAsset:(BOOL)a4 library:(id)a5;
- (BOOL)_shouldIngestComputeSyncFromCloudWithCloudVersion:(id)a3 cloudAdjustmentFingerprint:(id)a4 currentMajorVersion:(unint64_t)a5;
- (BOOL)_shouldInstallComputeSyncResourceFromCloudWithCPLAssetChange:(id)a3;
- (BOOL)_shouldSetupVideoComplementForAsyncEditWithBaseVersion:(int64_t)a3;
- (BOOL)_tuAnalysisComplete;
- (BOOL)_updateAndStoreFinalPhotoResourceForResourceType:(unsigned int)a3 version:(unsigned int)a4 error:(id *)a5;
- (BOOL)_updateAndStoreFinalVideoComplementResourceWithOutError:(id *)a3;
- (BOOL)_updateKindSubtypeIfScreenshotWithCheckTask:(id)a3;
- (BOOL)addSidecarFileAtIndex:(unint64_t)a3 sidecarURL:(id)a4 withFilename:(id)a5 compressedSize:(id)a6 captureDate:(id)a7 modificationDate:(id)a8 uniformTypeIdentifier:(id)a9 imageOrientation:(unsigned int)a10 pathManager:(id)a11;
- (BOOL)anyInternalResourceIsLocal;
- (BOOL)applyComputeSyncPayloadWithComputeStateRecord:(id)a3 originatedFromPrefetch:(BOOL)a4 error:(id *)a5;
- (BOOL)attemptPromoteFromUnknownKindUsingCloudMaster;
- (BOOL)avalanchePickTypeIsVisible;
- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)a3 mainFileMetadata:(id)a4 videoURL:(id)a5 spatialOverCaptureURL:(id)a6 videoDuration:(id *)a7 stillDisplayTime:(id *)a8 options:(unint64_t)a9;
- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)a3 mainFileMetadata:(id)a4 videoURL:(id)a5 videoDuration:(id *)a6 stillDisplayTime:(id *)a7 options:(unint64_t)a8;
- (BOOL)becomeSyndicationLivePhotoWithVideoComplementContentType:(id)a3;
- (BOOL)calculateAllowedForAnalysis;
- (BOOL)canPerformEditOperation:(unint64_t)a3;
- (BOOL)canPlayPhotoIris;
- (BOOL)checkAllResourcesRequiredForCPLDisableWithReachableBlock:(id)a3;
- (BOOL)cleanUpMetadataPath;
- (BOOL)cloudHasSameOwnerAsAsset:(id)a3;
- (BOOL)copyComputeSyncResourceFromCPLFilePath:(id)a3 error:(id *)a4;
- (BOOL)couldBeStoredInDCIM;
- (BOOL)deleteContextualVideoThumbnailFilesWithError:(id *)a3;
- (BOOL)eligibleForGuestAssetPromotion;
- (BOOL)faceDetectionComplete;
- (BOOL)fullAnalysisComplete;
- (BOOL)hasAdjustedCPLThumbResource;
- (BOOL)hasAdjustedVideoComplement;
- (BOOL)hasAllThumbs;
- (BOOL)hasJustBeenHidden;
- (BOOL)hasJustBeenShown;
- (BOOL)hasLargerThanThumbResourceLocal;
- (BOOL)hasLegacyRequiredResourcesLocallyAvailable;
- (BOOL)hasLibraryScope;
- (BOOL)hasMasterThumb;
- (BOOL)hasNonSlomoAdjustments;
- (BOOL)hasOriginalFile;
- (BOOL)hasScreenshotMetadata;
- (BOOL)hasUnrenderedAsyncAdjustments;
- (BOOL)hasVideoComponent;
- (BOOL)imageRequestHintsContainsResource:(id)a3;
- (BOOL)installComputeSyncResourceAfterAttachtoCPLWithError:(id *)a3;
- (BOOL)installExistingAlchemistImageAtPath:(id)a3 error:(id *)a4;
- (BOOL)installExistingAlchemistV2ResourceFileAtPath:(id)a3 recipeID:(unsigned int)a4 error:(id *)a5;
- (BOOL)installExistingGenerativePlaygroundFaceResourcesFileAtPath:(id)a3 error:(id *)a4;
- (BOOL)installExistingWallpaperComputeResourcesFileAtPath:(id)a3 error:(id *)a4;
- (BOOL)installFinalImageAndRemoveDeferredFilesWithFinalImageURL:(id)a3 previewImage:(id)a4 thumbnailImage:(id)a5 outError:(id *)a6;
- (BOOL)installFinalVideoComplementAndRemoveDeferredFilesWithOutError:(id *)a3;
- (BOOL)installSparseFullStageComputeSyncResourceIfNeeded;
- (BOOL)isAvalanchePhoto;
- (BOOL)isAvalancheStackPhoto;
- (BOOL)isCPLSharingScopeAsset;
- (BOOL)isCameraConnectionKitAsset;
- (BOOL)isCloudPhotoLibraryAsset;
- (BOOL)isCloudSharedAsset;
- (BOOL)isColorAware;
- (BOOL)isDefaultAdjustedSlomo;
- (BOOL)isDeletableFromAssetsLibrary;
- (BOOL)isEditableFromAssetsLibrary;
- (BOOL)isEligibleForSearchIndexing;
- (BOOL)isFinderSyncedAsset;
- (BOOL)isHDVideo;
- (BOOL)isHEIF;
- (BOOL)isIncludedInCloudFeeds;
- (BOOL)isIncludedInMoments;
- (BOOL)isJPEG;
- (BOOL)isLocalVideoKeyFrameValid;
- (BOOL)isLocatedAtCoordinates:(CLLocationCoordinate2D)a3;
- (BOOL)isMogul;
- (BOOL)isOriginalRAW;
- (BOOL)isOriginalSRGB;
- (BOOL)isPanorama;
- (BOOL)isPhotoIris;
- (BOOL)isPhotoIrisPlaceholder;
- (BOOL)isPhotoStreamPhoto;
- (BOOL)isPlaceholderAsset;
- (BOOL)isPlayableVideo:(id *)a3;
- (BOOL)isPrimaryImageFormat;
- (BOOL)isRAW;
- (BOOL)isRAWOnly;
- (BOOL)isRAWPlusJPEG;
- (BOOL)isRAWPlusJPEGWithRAWOnTop;
- (BOOL)isReadyForPurgeSyndicationResources;
- (BOOL)isReferencedAsset;
- (BOOL)isSavedPhotosAsset;
- (BOOL)isScreenRecording;
- (BOOL)isSemanticEnhanceProcessingCandidate;
- (BOOL)isStreamedVideo;
- (BOOL)isSuggestedForSharingByPhotos;
- (BOOL)isSyncableChange;
- (BOOL)isTimelapsePlaceholder;
- (BOOL)isValidForJournalPersistence;
- (BOOL)isValidTypeForPersistence;
- (BOOL)isVisibleForSocialGroupKeyAssetFetch;
- (BOOL)isWalrusEnabled;
- (BOOL)migrateLegacyVideoAdjustments;
- (BOOL)migrateLocationDataIfNeededAfterOTARestore:(BOOL)a3;
- (BOOL)placeholder_shouldAllowServerCopy;
- (BOOL)placeholder_shouldBakeInAdjustments;
- (BOOL)placeholder_shouldFlattenLivePhoto;
- (BOOL)promoteDeferredPreviewToFinalImageWithOutError:(id *)a3;
- (BOOL)promoteFromUnknownKind;
- (BOOL)promoteProxyToFinalVideoComplementWithOutError:(id *)a3;
- (BOOL)promoteSemanticEnhancePreviewToFinalImage:(id *)a3;
- (BOOL)promoteToGuestAsset:(id *)a3;
- (BOOL)pruneLocalVideoKeyFrameImage;
- (BOOL)renderableAdjustmentDictionary:(id *)a3 error:(id *)a4;
- (BOOL)repairAssetScopeValidationErrors:(id)a3;
- (BOOL)requiresImageDeferredFinalization;
- (BOOL)requiresVideoComplementDeferredFinalization;
- (BOOL)resetGuestAssetPromotion:(id *)a3;
- (BOOL)resetVideoKeyFrameTime;
- (BOOL)resetVideoKeyFrameTimeAndDeleteKeyFrameResource;
- (BOOL)resourceModelIndicatesDeepFusionNeeded;
- (BOOL)resourceModelIndicatesImageDeferredFinalizationNeeded;
- (BOOL)reverseLocationDataIsValid;
- (BOOL)rm_createNewResourcesIn:(id)a3 inManagedObjectContext:(id)a4;
- (BOOL)savedAssetTypeIsSupportedForUpload;
- (BOOL)sceneAnalysisWasPerformedOnLatestAdjustment;
- (BOOL)setAttributesFromMainFileURL:(id)a3 mainFileMetadata:(id)a4 savedAssetType:(signed __int16)a5 bundleScope:(unsigned __int16)a6 isPlaceholder:(BOOL)a7 placeholderFileURL:(id)a8 imageSource:(CGImageSource *)a9 imageData:(id *)a10;
- (BOOL)setCameraCaptureDeviceFromMetadata:(id)a3;
- (BOOL)setCurrentAdjustmentAsOriginalAdjustment;
- (BOOL)setDefaultAdjustmentsIfNecessaryWithMainFileMetadata:(id)a3;
- (BOOL)setFingerprintAndStableHashOnInternalResource:(id)a3 recordClass:(Class)a4 resourceType:(unint64_t)a5 resourceFileURL:(id)a6 fingerprintScheme:(id)a7 error:(id *)a8;
- (BOOL)setImageInfoFromImageMetadata:(id)a3 overwriteOriginalProperties:(BOOL)a4;
- (BOOL)setTimeExifTimestampStringFromMetadata:(id)a3;
- (BOOL)setTrashedState:(signed __int16)a3 forResourceType:(unint64_t)a4;
- (BOOL)setTrashedStateOnSpatialOverCaptureResources:(signed __int16)a3;
- (BOOL)setVideoInfoFromFileAtURL:(id)a3 mainFileMetadata:(id)a4 fullSizeRenderURL:(id)a5 overwriteOriginalProperties:(BOOL)a6;
- (BOOL)setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:(id)a3 placeholderAssetUUID:(id)a4 bundleScope:(unsigned __int16)a5 share:(id)a6 importSessionID:(id)a7 bakeInAdjustmentsFromSourceAsset:(BOOL)a8 flattenLivePhoto:(BOOL)a9 copyTitleDescriptionAndKeywords:(BOOL)a10 copyCameraProcessingAdjustmentResources:(BOOL)a11 library:(id)a12;
- (BOOL)shiftedLocationIsValid;
- (BOOL)shouldDownloadComputeSyncPayload;
- (BOOL)shouldIncludeInCPLCounts;
- (BOOL)shouldPurgeSyndicationResourcesWithChangedValues:(id)a3;
- (BOOL)shouldPushComputeSync;
- (BOOL)shouldSimulateQuarantineOriginalImageResourceOnPush;
- (BOOL)shouldSyncToSPL;
- (BOOL)shouldUseNonAdjustedVideo;
- (BOOL)shouldUseUBFPathManager;
- (BOOL)supportsCloudUpload;
- (BOOL)syndicationOriginalResourcesAreLocal;
- (BOOL)transitionToDeferredProcessingNeededAdjustmentWithOriginalWidth:(unint64_t)a3 originalHeight:(unint64_t)a4 shouldSignalBackgroundProcessingNeeded:(BOOL)a5 reason:(id)a6;
- (BOOL)unQuarantineIfPossible;
- (BOOL)updateAttributesFromMainFileURL:(id)a3 mainFileMetadata:(id)a4 fullSizeRenderURL:(id)a5 error:(id *)a6;
- (BOOL)updateDeferredAdjustmentWithFullSizeRenderImageURL:(id)a3 videoURL:(id)a4 videoPosterURL:(id)a5 error:(id *)a6;
- (BOOL)updateExtendedAttributesWithError:(id *)a3;
- (BOOL)updateExtendedAttributesWithMetadata:(id)a3 error:(id *)a4;
- (BOOL)updateKindSubtypeIfScreenshot;
- (BOOL)updateKindSubtypeIfScreenshotWithMetadata:(id)a3;
- (BOOL)updatePlaybackVariationAndLoopingStyleFromAVAsset:(id)a3;
- (BOOL)updatePlaybackVariationAndLoopingStyleFromVariation:(unsigned __int16)a3;
- (BOOL)updatePlaybackVariationAndStyleFromOriginalMetadata:(id)a3;
- (BOOL)userCloudSharedLiked;
- (BOOL)validateForInsert:(id *)a3;
- (BOOL)validateForUpdate:(id *)a3;
- (BOOL)visibilityStateIsEqualToState:(signed __int16)a3;
- (CGSize)_targetSizeForInputSize:(CGSize)a3 maxPixelSize:(unint64_t)a4;
- (CGSize)imageSize;
- (CGSize)originalImageSize;
- (CGSize)spatialOverCaptureSize;
- (CGSize)unorientedSize;
- (CGSize)videoComplementSpatialOverCaptureSize;
- (CLLocation)location;
- (CLLocation)shiftedLocation;
- (CLLocationCoordinate2D)gpsCoordinate;
- (CLLocationCoordinate2D)pl_coordinate;
- (NSArray)allUniformTypeIdentifiers;
- (NSArray)sortedSidecarFiles;
- (NSData)embeddedThumbnailData;
- (NSData)faceRegions;
- (NSData)originalHash;
- (NSData)placeAnnotationData;
- (NSData)reverseLocationData;
- (NSDate)confirmedSpotlightSyncDate;
- (NSDate)dateForComparingAdjustmentVersions;
- (NSDate)localDateCreated;
- (NSDate)pl_date;
- (NSNumber)rawTimeZoneOffsetValue;
- (NSOrderedSet)orderedCloudComments;
- (NSOrderedSet)orderedLikeComments;
- (NSSet)allDetectedFaces;
- (NSSet)allFileURLs;
- (NSSet)filePathsWithoutThumbs;
- (NSSet)libraryScopeContributors;
- (NSString)accessibilityDescription;
- (NSString)cloudOwnerDisplayName;
- (NSString)cloudOwnerEmail;
- (NSString)cloudOwnerFirstName;
- (NSString)cloudOwnerFullName;
- (NSString)cloudOwnerLastName;
- (NSString)editorBundleID;
- (NSString)fileExtension;
- (NSString)importedByBundleIdentifier;
- (NSString)importedByDisplayName;
- (NSString)longDescription;
- (NSString)originalAssetsUUID;
- (NSString)originalFilename;
- (NSString)pathForAdjustmentDirectory;
- (NSString)pathForComputeDirectory;
- (NSString)pathForComputeSyncMediaAnalysisPayloadFile;
- (NSString)pathForComputeSyncWrapperFile;
- (NSString)pathForLargeDisplayableImageFile;
- (NSString)pathForLargeThumbnailFile;
- (NSString)pathForLegacySlalomRegionsArchive;
- (NSString)pathForMediumThumbnailFile;
- (NSString)pathForMetadataDirectory;
- (NSString)pathForOriginalFile;
- (NSString)pathForPrebakedLandscapeScrubberThumbnails;
- (NSString)pathForPrebakedPortraitScrubberThumbnails;
- (NSString)pathForTrimmedVideoFile;
- (NSString)pathForVideoFile;
- (NSString)pathForVideoPreviewFile;
- (NSString)pathForXMPFile;
- (NSString)publicGlobalUUID;
- (NSString)rawTimeZoneName;
- (NSString)syncedAdjustmentFingerprint;
- (NSString)textBadgeString;
- (NSString)title;
- (NSString)uuidDescription;
- (NSURL)assetURL;
- (NSURL)cachedNonPersistedVideoPlaybackURL;
- (NSURL)fileURLForLargeThumbnailFile;
- (NSURL)mainFileURL;
- (NSURL)persistedFileSystemAttributesFileURL;
- (PLCloudSharedAlbumProtocol)cloudShareAlbum;
- (PLManagedAsset)originalAsset;
- (PLManagedAssetID)assetID;
- (PLRevGeoLocationInfo)locationInfo;
- (PLRevGeoPlaceAnnotation)placeAnnotation;
- (PLShareParticipant)collectionShareContributor;
- (double)gpsHorizontalAccuracy;
- (double)pl_gpsHorizontalAccuracy;
- (id)_avAssetProxyForFullSize:(BOOL)a3 allowReadFromFile:(BOOL)a4;
- (id)_availableCloudResourcesForPhotosRequireUnadjusted:(BOOL)a3 allowPenultimate:(BOOL)a4;
- (id)_calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources;
- (id)_cloudSharedPathWithExtension:(id)a3;
- (id)_compactDebugDescription;
- (id)_computeNewMasterIdentifierAndStableHash:(id *)a3 fingerprintScheme:(void *)a4 forMasterFileURL:(void *)a5 error:;
- (id)_cplRelationsForAssetInLibrary:(id)a3 orderKeyManager:(id)a4;
- (id)_createCPLResourceFromResourcePath:(uint64_t)a3 withResourceType:(void *)a4 uniformTypeIdentifier:(void *)a5 scopedIdentifier:(void *)a6 recordClass:(void *)a7 fingerprintScheme:;
- (id)_createJPEGResourcesFromFullSizePath:(id)a3 withScopedIdentifier:(id)a4 forMaster:(BOOL)a5 forResourceTypes:(id)a6 fingerprintScheme:(id)a7;
- (id)_createVideoResourceFromVideoURL:(uint64_t)a3 withResourceType:(void *)a4 scopedIdentifier:(int)a5 applyVideoAdjustments:(int)a6 forMaster:(int)a7 forPhotoIris:(void *)a8 fingerprintScheme:;
- (id)_currentComputeStateVersion;
- (id)_effectiveMetadataForMainFileURL:(id)a3 mainFileMetadata:(id)a4 fullSizeRenderURL:(id)a5 shouldCache:(BOOL)a6 error:(id *)a7;
- (id)_findMissingOriginalStableHashFromMaster:(id)a3 error:(id *)a4;
- (id)_generateDeferredAdjustmentWithImageConversionClient:(id)a3 videoConversionClient:(id)a4 reason:(id)a5 retryNumber:(unint64_t)a6 allowCancellationByService:(BOOL)a7 clientBundleID:(id)a8 completion:(id)a9;
- (id)_generatePosterFrameForVideoAtURL:(uint64_t)a3 withResourceType:(void *)a4 scopedIdentifier:(int)a5 forMaster:(void *)a6 fingerprintScheme:;
- (id)_generatePosterFrameResourcesFromVideoURL:(id)a3 withScopedIdentifier:(id)a4 forMaster:(BOOL)a5 fingerprintScheme:(id)a6;
- (id)_generateVideoResourcesFromURL:(id)a3 withScopedIdentifier:(id)a4 forMaster:(BOOL)a5;
- (id)_hdrTypeDescription;
- (id)_imagePropertiesFromMetadata:(id)a3;
- (id)_installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:(BOOL)a3 error:(id *)a4;
- (id)_kindDescription;
- (id)_mediaGroupUUIDForPersistence;
- (id)_metadataFromMediaProperties:(id)a3 uniformTypeIdentifier:(id)a4 block:(id)a5;
- (id)_originalResources;
- (id)_pathForSidecarResource:(id)a3;
- (id)_persistedResourceForResourceIdentity:(id)a3 error:(id *)a4;
- (id)_rm_localResourceURLForResource:(id)a3;
- (id)_savedAssetTypeDescription;
- (id)_sizeOfVideoPreviewForAVAsset:(id)a3;
- (id)_sourceURLForAsyncEditWithBaseVersion:(int64_t)a3;
- (id)activityViewController:(id)a3 itemForActivityType:(id)a4;
- (id)addLegacyFaceWithRelativeRect:(CGRect)a3 identifier:(signed __int16)a4 albumUUID:(id)a5;
- (id)addedDateData;
- (id)adjustedFileURLs;
- (id)adjustedPathForCPLResourceType:(unint64_t)a3;
- (id)adjustmentDataResource;
- (id)allAssetCPLResources;
- (id)allCPLResourcesForPruning;
- (id)allFileBackedResources;
- (id)allFileExtensions;
- (id)allMasterCPLResources;
- (id)allRequiredResourcesForCPLDisable;
- (id)analysisStateForWorkerType:(signed __int16)a3;
- (id)assetComparisonSortDescriptors;
- (id)assetResourceForCPLType:(unint64_t)a3;
- (id)assetURLForSidecarFile:(id)a3;
- (id)assetURLWithExtension:(id)a3;
- (id)avalanchePickDescription;
- (id)bestAvailableAdjustedResource;
- (id)cameraMake;
- (id)cameraModel;
- (id)cloudSharedAssetPathForPlaceholderKind:(signed __int16)a3;
- (id)contextualVideoThumbnailURLs;
- (id)cplAssetChangeWithMasterScopedIdentifier:(id)a3 withChangeType:(unint64_t)a4 shouldGenerateDerivatives:(BOOL)a5 orderKeyManager:(id)a6 computeSyncUploadEnabled:(BOOL)a7 inLibrary:(id)a8;
- (id)cplFullRecord;
- (id)cplMasterChangeInLibrary:(id)a3 shouldGenerateDerivatives:(BOOL)a4;
- (id)createResourcesForAssetInPhotoLibrary:(id)a3 shouldGenerateDerivatives:(BOOL)a4;
- (id)createResourcesForMaster:(id)a3 shouldGenerateDerivatives:(BOOL)a4 inPhotoLibrary:(id)a5;
- (id)dateCreatedData;
- (id)decodedFaceRegions;
- (id)descriptionForAnalysisStates;
- (id)descriptionForModernResources;
- (id)descriptionForNonCloudResources;
- (id)descriptionForResources;
- (id)descriptionForSceneAnalysis;
- (id)descriptionForSidecarFiles;
- (id)documentObservation;
- (id)duplicateAlbum;
- (id)duplicateSortPropertyNames;
- (id)duplicateSortPropertyNamesSkip;
- (id)edgesIn;
- (id)edgesOut;
- (id)evaluateWhiteBalanceValueWithOriginalExifProperties:(id)a3;
- (id)existingCloudMasterNeedsRepush:(BOOL *)a3;
- (id)extendedAttributesCreateIfNeeded:(BOOL)a3;
- (id)faceDescription;
- (id)fetchOrCreateResourceWithIdentity:(id)a3;
- (id)fetchResourceWithIdentity:(id)a3 error:(id *)a4;
- (id)fetchResourcesForAssetVersions:(id)a3 allowDerivatives:(BOOL)a4 additionalPredicate:(id)a5 relationshipKeyPathsForPrefetching:(id)a6 error:(id *)a7;
- (id)fetchSourceAssetForDuplicationIfExists;
- (id)fileTypeForFullsizeRenderImage;
- (id)fileURLForAdjustedLargeThumbnailFile;
- (id)fileURLForAdjustedMediumThumbnailFile;
- (id)fileURLForAsyncAdjustedRenderPreviewImage;
- (id)fileURLForCurrentDeferredProcessingPreviewFile;
- (id)fileURLForDeferredVideoComplement;
- (id)fileURLForFullsizeRenderImage;
- (id)fileURLForFullsizeRenderVideo;
- (id)fileURLForHypotheticalSidecarFileWithFilename:(id)a3;
- (id)fileURLForMediumThumbnailFile;
- (id)fileURLForMetadataWithExtension:(id)a3;
- (id)fileURLForNonAdjustedLargeThumbnailFile;
- (id)fileURLForNonAdjustedMediumThumbnailFile;
- (id)fileURLForOriginalVideoComplement;
- (id)filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources:(id)a3;
- (id)fingerprintContext;
- (id)fingerprintScheme;
- (id)firstPersistedResourceMatching:(id)a3;
- (id)formattedCameraModel;
- (id)fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:(id)a3;
- (id)generatePortraitAdjustment:(id *)a3;
- (id)imageDataForThumbGenerationAndIfNeededRAWUTI:(id *)a3 isPreviewSource:(BOOL *)a4;
- (id)imageMediaMetadataForURL:(id)a3;
- (id)imageProperties;
- (id)imageWithFormat:(unsigned __int16)a3;
- (id)largestAvailableDataRepresentationAndType:(id *)a3;
- (id)lastUploadAttemptDate;
- (id)legacyFaceWithIdentifier:(signed __int16)a3;
- (id)lensModel;
- (id)libraryID;
- (id)localDateAndCreateIfNeededWithLocalDateCreator:(id)a3;
- (id)localResourcePathForMasterResource:(id)a3;
- (id)localResourcePathForMasterResourceWithCPLType:(unint64_t)a3 andUTI:(id)a4;
- (id)localVideoKeyFrameResource;
- (id)loggingDescription;
- (id)managedAssetForPhotoLibrary:(id)a3;
- (id)masterIdentifierCacheIfNecessaryAndOriginalStableHash:(id *)a3 error:(id *)a4;
- (id)masterResourceForCPLType:(unint64_t)a3;
- (id)masterThumbnailFileURLIfLocal;
- (id)masterThumbnailResource;
- (id)mediaAnalysisAttributesInsertingIfNecessary;
- (id)mediaMetadataForResourceVersion:(unsigned int)a3 mediaMetadataType:(id *)a4;
- (id)mediaMetadataVirtualResources;
- (id)metadataFromMediaPropertiesOrOriginalResource;
- (id)nonAdjustedPathForCPLResourceType:(unint64_t)a3;
- (id)nonDynamicOriginalUTI;
- (id)nonPersistedResourcesWithOptions:(unsigned __int16)a3;
- (id)originalStableHashCacheIfNecessaryAndAdjustedStableHash:(id *)a3 fullsizeRenderImageIfNecessary:(BOOL)a4 enableSaveIfNecessary:(BOOL)a5 error:(id *)a6;
- (id)originalUniformTypeIdentifier;
- (id)originalVideoComplementUniformTypeIdentifier;
- (id)pasteBoardRepresentation;
- (id)pathForAdjustedLargeSizeImageFile;
- (id)pathForAdjustedLargeThumbnailFile;
- (id)pathForAdjustedLargeVideoFile;
- (id)pathForAdjustedMediaMetadataFile;
- (id)pathForAdjustedMediumHDRVideoFile;
- (id)pathForAdjustedMediumThumbnailFile;
- (id)pathForAdjustedMediumVideoFile;
- (id)pathForAdjustedSmallVideoFile;
- (id)pathForAdjustmentDataFile;
- (id)pathForAdjustmentFile;
- (id)pathForAdjustmentSecondaryDataFile;
- (id)pathForAlchemistImage;
- (id)pathForAlchemistV2ResourceFileWithRecipeID:(unsigned int)a3;
- (id)pathForAsyncAdjustedRenderPreviewImageFile;
- (id)pathForBestAvailableFullsizeRenderImageFileOutIsSubstandard:(BOOL *)a3;
- (id)pathForCPLResourceType:(unint64_t)a3 adjusted:(BOOL)a4;
- (id)pathForCameraMetadataDiagnosticFile;
- (id)pathForCameraMetadataFile;
- (id)pathForCameraSpatialOverCaptureMetadataDiagnosticFile;
- (id)pathForDeferredProcessingPreviewFile;
- (id)pathForDeferredVideoComplementFile;
- (id)pathForDiagnosticFile;
- (id)pathForFullsizeImageFile;
- (id)pathForFullsizeRenderImageFile;
- (id)pathForFullsizeRenderImageFileWithUTI:(id)a3;
- (id)pathForFullsizeRenderVideoFile;
- (id)pathForGenerativePlaygroundFaceResourcesFile;
- (id)pathForLargeSizeImageFile;
- (id)pathForLocalVideoKeyFrame;
- (id)pathForMediaMetadataFile;
- (id)pathForMediumVideoFile;
- (id)pathForMetadataWithExtension:(id)a3;
- (id)pathForMutationsDirectory;
- (id)pathForNonAdjustedFullsizeImageFile;
- (id)pathForNonAdjustedLargeSizeImageFile;
- (id)pathForNonAdjustedLargeThumbnailFile;
- (id)pathForNonAdjustedLargeVideoFile;
- (id)pathForNonAdjustedMediumHDRVideoFile;
- (id)pathForNonAdjustedMediumThumbnailFile;
- (id)pathForNonAdjustedMediumVideoFile;
- (id)pathForNonAdjustedSmallVideoFile;
- (id)pathForOriginalAdjustmentFile;
- (id)pathForOriginalVideoComplementDiagnosticFile;
- (id)pathForPenultimateFullsizeRenderImageFile;
- (id)pathForPenultimateFullsizeRenderImageFileWithUTI:(id)a3;
- (id)pathForPenultimateFullsizeRenderVideoFile;
- (id)pathForReframeDiagnosticDirectory;
- (id)pathForReframeDiagnosticFile;
- (id)pathForSpatialOverCaptureContentFile;
- (id)pathForSpatialOverCaptureDiagnosticFile;
- (id)pathForSubstandardFullsizeRenderImageFile;
- (id)pathForTransientVideoPosterFramePreview;
- (id)pathForVideoComplementFile;
- (id)pathForVideoComplementSpatialOverCaptureContentFile;
- (id)pathForVideoMetadataFile;
- (id)pathForWallpaperComputeResourcesFile;
- (id)pathToOriginalVideoFile;
- (id)payloadForChangedKeys:(id)a3;
- (id)payloadID;
- (id)payloadIDForTombstone:(id)a3;
- (id)penultimateImageResource;
- (id)persistedResourcesMatching:(id)a3;
- (id)persistedResourcesWithRecipeID:(unsigned int)a3 andVersion:(unsigned int)a4;
- (id)photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:(id)a3;
- (id)photoIrisSidecarIgnoringSubtype:(BOOL)a3;
- (id)readonlyFileURLForContextualVideoThumbnailIdentifier:(id)a3;
- (id)resourceForCPLType:(unint64_t)a3 version:(unsigned int)a4;
- (id)resourcesSortedByQualityWithOptions:(unsigned __int16)a3;
- (id)resourcesWithVersion:(unsigned int)a3;
- (id)reverseGeoDescription;
- (id)rm_applyResourcesFromAssetChange:(id)a3 inLibrary:(id)a4;
- (id)rm_cplExpungeableMasterResourceStates;
- (id)rm_cplMasterResourceForResourceType:(unint64_t)a3;
- (id)rm_cplMasterResourcesFromCloudMaster:(id)a3 addOriginalResourceMode:(BOOL)a4;
- (id)rm_cplResourceForResourceType:(unint64_t)a3;
- (id)scopeIdentifier;
- (id)scopedIdentifier;
- (id)shareRelationship;
- (id)shortenedFilePath;
- (id)sidecarFileMatchingContentType:(id)a3 requireExactMatch:(BOOL)a4 requireSort:(BOOL)a5;
- (id)sidecarWithResourceObjectID:(id)a3;
- (id)sidecars;
- (id)sortPlaceholderCloudResourcesByOrderOfCloudReReference:(id)a3;
- (id)storedResourceForCPLResource:(id)a3 asset:(id)a4 adjusted:(BOOL)a5;
- (id)storedResourceForExternalResource:(id)a3 asset:(id)a4;
- (id)syncDescription;
- (id)syndicationDescription;
- (id)syndicationFileIdentifierForResourceType:(unsigned int)a3 version:(unsigned int)a4 recipeID:(unsigned int)a5 utiString:(id)a6;
- (id)syndicationOriginalResource;
- (id)syndicationResourceURLForResourceType:(unsigned int)a3 version:(unsigned int)a4 recipeID:(unsigned int)a5 utiString:(id)a6 error:(id *)a7;
- (id)syndicationResourcesDescription;
- (id)thumbnailIdentifier;
- (id)unadjustedDerivativeImageURLs;
- (id)urlForSideCarImageFile;
- (id)userAddCloudSharedCommentWithText:(id)a3;
- (id)validateForAssetID:(id)a3 resourceIdentity:(id)a4;
- (id)videoComplementData;
- (id)virtualResourcesThatReplaceMissingPersistedResources:(id)a3;
- (id)writableFileURLForContextualVideoThumbnailIdentifier:(id)a3;
- (int)cloudCommentsStatusForOwnedAsset:(BOOL)a3;
- (int)embeddedThumbnailLength;
- (int)embeddedThumbnailOffset;
- (int)inferredTimeZoneOffset;
- (int)locationHash;
- (int64_t)_prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:(int64_t)a3 penultimateRenderedJPEGData:(id)a4 penultimateRenderedVideoContentURL:(id)a5 penultimateRenderedVideoComplementContentURL:(id)a6 fileIngestionType:(int64_t)a7;
- (int64_t)cameraProcessingAdjustmentTrashedState;
- (int64_t)compareToAsset:(id)a3;
- (int64_t)height;
- (int64_t)originalHeight;
- (int64_t)originalImageOrientation;
- (int64_t)originalWidth;
- (int64_t)width;
- (signed)embeddedThumbnailHeight;
- (signed)embeddedThumbnailWidth;
- (signed)importedBy;
- (signed)originalOrientation;
- (signed)uploadAttempts;
- (uint64_t)_canComputeMasterIdentifierOrStableHashWithError:(uint64_t)result;
- (unint64_t)_countForCommentRelationshipNamed:(id)a3 inverseRelationshipName:(id)a4;
- (unint64_t)bestResourceTypeForAdjustedStableHash;
- (unint64_t)cplAssetSubtypeFromPLAssetSubtype:(signed __int16)a3;
- (unint64_t)deferredProcessingHash;
- (unint64_t)effectiveThumbnailIndex;
- (unint64_t)masterResourceTypeForAdjustedAssetResourceType:(unint64_t)a3 flattenLivePhoto:(BOOL)a4;
- (unint64_t)originalFilesize;
- (unint64_t)originalResourceChoice;
- (unint64_t)ptpCloudMasterOriginalFileSize;
- (unint64_t)syndicationProcessingVersion;
- (unsigned)_calculateRenderTypeAdditionalFlagCheckAndUpdateIfNeededUnmanagedAdjustment:(id)a3 options:(id)a4 hasAdjustments:(BOOL)a5;
- (unsigned)_playbackVariationWithAdjustmentRenderTypes:(unsigned int)a3;
- (unsigned)expectedDeferredProcessingNeededOnAssetCreation;
- (unsigned)fullSizeRenderResourceRecipeID;
- (unsigned)playbackVariationFromAVAsset:(id)a3 isLivePhotoVideoComplement:(BOOL)a4;
- (unsigned)shareState;
- (unsigned)syndicationHistory;
- (unsigned)syndicationProcessingValue;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 forSpatialTypeOfAVAsset:(id)a4;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 withDepthType:(signed __int16)a4;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 withMetadata:(id)a4;
- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 withPlaybackVariation:(unsigned __int16)a4;
- (void)_applyPropertiesChangeToCPLAssetChange:(id)a3 withMasterScopedIdentifier:(id)a4 computeSyncUploadEnabled:(BOOL)a5 inLibrary:(id)a6;
- (void)_applyPropertiesFromCloudMaster:(id)a3;
- (void)_applyResourceChangeToCPLAsset:(id)a3 forChangeType:(unint64_t)a4 shouldGenerateDerivatives:(BOOL)a5 inLibrary:(id)a6;
- (void)_applySharingChangeToCPLAssetChange:(id)a3 inLibrary:(id)a4;
- (void)_asyncGenerateRenderImageFileWithSize:(CGSize)a3 formatIdentifier:(id)a4 formatVersion:(id)a5 adjustmentDataBlob:(id)a6 originalImageFilePath:(id)a7 originalImageEXIFOrientation:(int64_t)a8 renderedImageFilePath:(id)a9 completionHandler:(id)a10;
- (void)_cleanupPenultimateResources;
- (void)_clearAcceptableCropRect;
- (void)_clearOverallAestheticScore;
- (void)_clearPreferredCropRect;
- (void)_clearStickerConfidenceAttributes;
- (void)_coordinatesFromDoubles:(double)a3 faceMaxX:(double)a4 faceMinY:(double)a5 faceMaxY:(double)a6 minX:(double *)a7 maxX:(double *)a8 minY:(double *)a9 maxY:(double *)a10;
- (void)_dateCreatedDidChange:(id)a3;
- (void)_debugPrintAdjustmentState;
- (void)_deleteComputedAttributes;
- (void)_deleteDeferredIntermediatesForDeferredPhotoIdentifier:(id)a3 withFinalizer:(id)a4;
- (void)_duplicateProcessingChanges:(id)a3;
- (void)_fixDistantPastContentCreationDateWithItem:(id)a3;
- (void)_getLargestAvailableDataRepresentation:(id *)a3 type:(id *)a4;
- (void)_handleHighlightRelationshipChangeForKey:(id)a3 forAssetCountKey:(id)a4 newValue:(id)a5;
- (void)_loadReverseGeoIfNeeded;
- (void)_populateSyndicationAssetWithAssetType:(signed __int16)a3 subtype:(signed __int16)a4 contentType:(id)a5 videoComplementContentType:(id)a6 originalFilename:(id)a7;
- (void)_preserveRelationshipsOfDeletedGuestAsset:(id)a3;
- (void)_processRenderTypeUpdateForCameraAutoWithUnmanagedAdjustment:(id)a3 options:(id)a4 hasAdjustments:(BOOL)a5 updateRenderFlagsResult:(BOOL)a6;
- (void)_processRenderTypeUpdateForGenerativeEditsWithUnmanagedAdjustment:(id)a3 fullSizeRenderURL:(id)a4 hasAdjustments:(BOOL)a5;
- (void)_processRenderTypeUpdateForSleetCastWithUnmanagedAdjustment:(id)a3 fullSizeRenderURL:(id)a4 settingPayload:(id)a5 hasAdjustments:(BOOL)a6;
- (void)_recordAssetPersonEdgeAndSocialGroupContainmentUpdateIfNeededWithChangedValues:(id)a3 inContext:(id)a4;
- (void)_reloadWidgetTimelineIfNeeded;
- (void)_removeAdjustmentDataResources;
- (void)_removeComputeResourcesOnEdit;
- (void)_removeKeyAssetFromSuggestions:(id)a3;
- (void)_resetAllMediaProcessingVersionsIncludingVideo:(BOOL)a3;
- (void)_resetMediaAnalysisStateOnEditIncludingVideo:(BOOL)a3;
- (void)_rm_insertResource:(id)a3 forOtherDuplicatedAssetInMaster:(id)a4 inPhotoLibrary:(id)a5;
- (void)_setAllowedForAnalysisDependentValue:(id)a3 forKey:(id)a4;
- (void)_setBurstUuidFromMetadata:(id)a3;
- (void)_setColorSpaceNameFromMetadata:(id)a3;
- (void)_setHDRGainFromMetadata:(id)a3;
- (void)_setOriginalSizeAndOrientationFromMetadata:(id)a3;
- (void)_setPhotoIrisPropertiesFromMetadata:(id)a3;
- (void)_setSOCGroupIdentifierFromMetadata:(id)a3;
- (void)_setSavedAssetTypeFromMetadata:(id)a3;
- (void)_setSizeAndOrientationFromMetadata:(id)a3;
- (void)_setSyndicationStateFromContentsOfSearchableItem:(id)a3;
- (void)_setVideoComplementData:(id)a3;
- (void)_setupMediaConversionSourceURLCollection:(id)a3 destinationURLCollection:(id)a4 baseVersion:(int64_t)a5;
- (void)_updateAdjustmentFromAssetAdjustment:(id)a3 unmanagedAdjustment:(id)a4 fullSizeRenderURL:(id)a5 options:(id)a6;
- (void)_updateAlbumAssociationIfNeeded;
- (void)_updateAlbumAssociationIfNeededWithChangedValues:(id)a3;
- (void)_updateAssetSubtypeForCPLAssetChange:(id)a3;
- (void)_updateAssetSubtypeFromCPLAssetSubtype:(unint64_t)a3;
- (void)_updateAvalanchePropertiesFromAssetChange:(id)a3;
- (void)_updateBurstFlagsForCPLAssetChange:(id)a3 photoLibrary:(id)a4;
- (void)_updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:(id)a3;
- (void)_updateCoreDateExtendedAttributes:(id)a3 fromMetadata:(id)a4;
- (void)_updateCoreExtendedAttributes:(id)a3 fromMetadata:(id)a4;
- (void)_updateDerivativesAndThumbnails:(BOOL)a3 withPreviewImage:(id)a4 thumbnailImage:(id)a5 metadata:(id)a6 didRevertToOriginal:(BOOL)a7 updateInternalResources:(BOOL)a8 isSubstandardRender:(BOOL)a9 isDeferred:(BOOL)a10;
- (void)_updateDestinationAssetCopyStateOnCMMAsset;
- (void)_updateIMCoreSyndicationForIdentifier:(id)a3 hide:(BOOL)a4;
- (void)_updateModificationDateForSyndication;
- (void)_updateOriginalResourceChoice;
- (void)_updatePackedBadgeAttributesIfNeeded:(int)a3;
- (void)_updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:(id)a3;
- (void)_updateSyndicationState:(unsigned __int16)a3 enabled:(BOOL)a4 logPrefix:(id)a5;
- (void)_updateViewPresentationForCPLAssetChange:(id)a3;
- (void)_updateViewPresentationFromCPLAssetViewPresentation:(signed __int16)a3;
- (void)_writeOutAdjustmentsToFile:(id)a3;
- (void)addComment:(id)a3;
- (void)applyComputeSyncPropertiesFromAssetChange:(id)a3 inLibrary:(id)a4 didInstallComputeSyncResource:(BOOL *)a5 computeSyncDownloadEnabled:(BOOL)a6;
- (void)applyFacesFromAssetChange:(id)a3 inSyncContext:(id)a4;
- (void)applyPropertiesFromAssetChange:(id)a3 inLibrary:(id)a4;
- (void)applySharingPropertiesFromAssetChange:(id)a3 inLibrary:(id)a4;
- (void)applyTrashedState:(signed __int16)a3 withTrashedReason:(unsigned __int16)a4 expungeReasonFromClient:(id)a5;
- (void)awakeFromFetch;
- (void)awakeFromInsert;
- (void)copyAuxiliaryImagesFromImageSource:(CGImageSource *)a3 toDestination:(CGImageDestination *)a4 fromImageAtIndex:(unint64_t)a5 imageProperties:(id)a6 applyingOrientation:(signed __int16)a7 scalingToLongSideLength:(int64_t)a8;
- (void)createMasterIfNecessaryInLibrary:(id)a3;
- (void)dealloc;
- (void)delete;
- (void)deleteAdjustedResources;
- (void)deleteComment:(id)a3;
- (void)deleteComputeSyncResourceIfExists;
- (void)deleteFromDatabaseOnly;
- (void)deleteFromDatabaseOnlyWithReason:(id)a3;
- (void)deleteResourceForSidecarRepresentation:(id)a3;
- (void)deleteResourcesWithRecipeID:(unsigned int)a3 andVersion:(unsigned int)a4;
- (void)deleteWithReason:(id)a3;
- (void)didSave;
- (void)didTurnIntoFault;
- (void)ensurePlaybackStyleConsistencyWithKindSubtype:(id)a3;
- (void)expungeTrashedSpatialOverCaptureResources;
- (void)fixupMemoriesWithMissingKeyAsset;
- (void)fixupPlaceholderAssetWithSavedAssetType:(signed __int16)a3;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 forceSRGBConversion:(BOOL)a7;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 forceSRGBConversion:(BOOL)a7 reduceProcessingForIngest:(BOOL)a8;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 metadata:(id)a7 forceSRGBConversion:(BOOL)a8 forFinalCameraImage:(BOOL)a9 saveCameraPreviewWellImage:(BOOL)a10 reduceProcessingForIngest:(BOOL)a11;
- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 metadata:(id)a7 forceSRGBConversion:(BOOL)a8 saveCameraPreviewWellImage:(BOOL)a9;
- (void)generateLargeThumbnailFileIfNecessary;
- (void)generateThumbnailsWithImageSource:(CGImageSource *)a3 imageData:(id)a4 metadata:(id)a5 allowMediumPreview:(BOOL)a6 forceSRGBConversion:(BOOL)a7 forFinalCameraImage:(BOOL)a8 outSmallThumbnailData:(id *)a9 isPreviewSource:(BOOL)a10;
- (void)getFileURL:(id *)a3 originalFilename:(id *)a4 uti:(id *)a5 fileSize:(unint64_t *)a6 forSidecarMatchingUTI:(id)a7 requireExactMatch:(BOOL)a8;
- (void)incrementUploadAttempts;
- (void)insertTableThumbImageRequestHints;
- (void)invalidateThumbnailIfNeededAfterMasterResourceChangeInLibrary:(id)a3;
- (void)makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:(int64_t)a3 completion:(id)a4;
- (void)markAsUnavailableCloudResourceOfType:(unint64_t)a3;
- (void)persistMetadataToFileURL:(id)a3;
- (void)persistMetadataToFilesystem;
- (void)postProcessResourceDependentPropertyChangesFromAssetChange:(id)a3 inLibrary:(id)a4;
- (void)prepareForDeletion;
- (void)purgeSyndicationResourcesOriginalsOnly:(BOOL)a3;
- (void)recalculateImageRequestHints;
- (void)recalculateImageRequestHintsForResource:(id)a3 afterLocalAvailabilityChangeFrom:(signed __int16)a4 previousDataStoreKey:(id)a5;
- (void)recalculateIsDetectedScreenshot;
- (void)recalculateIsRecentlySaved;
- (void)recalculateRAWBadgeAttribute;
- (void)reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker;
- (void)reevaluateCameraProcessingAdjustmentState;
- (void)registerForChanges;
- (void)rejectSyndicatedAsset;
- (void)removeAllStillFrameSceneClassifications;
- (void)removeAllTemporalSceneClassifications;
- (void)removeAssetFromRelatedSuggestionsAndFixupSuggestions;
- (void)removeAssetFromUserAlbumSuggestionIfNeededWithChangedValues:(id)a3;
- (void)removeComputeResourceWithRecipeID:(unsigned int)a3 atPath:(id)a4;
- (void)removeFromDuplicateAlbum;
- (void)removeLibraryScopeAndContributors;
- (void)removeLocalFileForResource:(id)a3 allowDCIMPath:(BOOL)a4;
- (void)removeSceneClassificationsOfType:(int64_t)a3;
- (void)removeSidecar:(id)a3;
- (void)removeTemporalSceneClassificationsOfType:(int64_t)a3;
- (void)reportSharedAssetIncrementalChange:(id)a3;
- (void)requestDeletionOfDeferredPhotoProcessingIntermediates;
- (void)resetKeyFaceOnVideoKeyFrameChange;
- (void)restoreSyndicatedAsset;
- (void)revalidateFaceAreaPoints;
- (void)revertToOriginal;
- (void)rm_createAssetResourcesForCPLResources:(id)a3 inLibrary:(id)a4;
- (void)rm_createMasterResourcesForCPLResources:(id)a3 master:(id)a4 inLibrary:(id)a5;
- (void)rm_createMasterResourcesIn:(id)a3 inManagedObjectContext:(id)a4;
- (void)setAccessibilityDescription:(id)a3;
- (void)setAdjustments:(id)a3 options:(id)a4;
- (void)setAssetAdjustmentsStateFromAdjustmentRenderType:(unsigned int)a3;
- (void)setAvalanchePickType:(int)a3;
- (void)setCameraProcessingAdjustmentStateFromAdjustmentRenderTypes:(unsigned int)a3;
- (void)setCollectionShare:(id)a3 withContributor:(id)a4;
- (void)setCollectionShareContributor:(id)a3;
- (void)setCollectionShareWithCurrentUserAsContributor:(id)a3;
- (void)setConfirmedSpotlightSyncDate:(id)a3;
- (void)setConversationAlbumWithConversationID:(id)a3;
- (void)setCurrentSleetCastFromMetadata:(id)a3;
- (void)setDateCreated:(id)a3;
- (void)setDepthTypeFromAdjustmentRenderTypes:(unsigned int)a3;
- (void)setDepthTypeFromMetadata:(id)a3;
- (void)setDestinationAssetCopyStateOnSourceAsset:(signed __int16)a3;
- (void)setDetectedScreenshotBadgeAttribute:(BOOL)a3;
- (void)setEditableDepthBadgeAttribute:(unsigned __int8)a3;
- (void)setEditableDepthBadgeAttributeFromMetadata:(id)a3;
- (void)setEditorBundleID:(id)a3;
- (void)setEffectiveThumbnailIndex:(unint64_t)a3;
- (void)setEmbeddedThumbnailHeight:(signed __int16)a3;
- (void)setEmbeddedThumbnailLength:(int)a3;
- (void)setEmbeddedThumbnailOffset:(int)a3;
- (void)setEmbeddedThumbnailWidth:(signed __int16)a3;
- (void)setFaceRegions:(id)a3;
- (void)setFaceRegionsFromCGImageProperties:(id)a3;
- (void)setFaceRegionsFromImageMetadata:(CGImageMetadata *)a3;
- (void)setHeight:(int64_t)a3;
- (void)setHidden:(BOOL)a3;
- (void)setImageInfoFromOriginalImageMetadata:(id)a3;
- (void)setImageSize:(CGSize)a3;
- (void)setImportSessionAlbumWithImportSessionID:(id)a3;
- (void)setImportedBy:(signed __int16)a3;
- (void)setImportedByBundleIdentifier:(id)a3;
- (void)setImportedByDisplayName:(id)a3;
- (void)setIsSmartStyleableWithMetadata:(id)a3;
- (void)setKeywordBadgeAttribute:(unsigned __int8)a3;
- (void)setKeywordsFromImageProperties:(id)a3;
- (void)setLastUploadAttemptDate:(id)a3;
- (void)setLibraryScope:(id)a3;
- (void)setLibraryScope:(id)a3 withContributors:(id)a4;
- (void)setLibraryScopeContributors:(id)a3;
- (void)setLibraryScopeWithCurrentUserAsContributor:(id)a3;
- (void)setLocation:(id)a3;
- (void)setLocationFromPersistedAttributes:(id)a3;
- (void)setLocationHash:(int)a3;
- (void)setLongDescription:(id)a3;
- (void)setMetadataFromCustomRenderedValue:(int64_t)a3;
- (void)setMoment:(id)a3;
- (void)setOriginalAsset:(id)a3;
- (void)setOriginalAssetsUUID:(id)a3;
- (void)setOriginalFilename:(id)a3;
- (void)setOriginalFilesize:(unint64_t)a3;
- (void)setOriginalHash:(id)a3;
- (void)setOriginalHeight:(int64_t)a3;
- (void)setOriginalOrientation:(signed __int16)a3;
- (void)setOriginalResourceChoice:(unint64_t)a3;
- (void)setOriginalSizeAndOrientationFromImageProperties:(id)a3;
- (void)setOriginalWidth:(int64_t)a3;
- (void)setPhotoIrisStillDisplayTime:(id *)a3;
- (void)setPhotoIrisVideoDuration:(id *)a3;
- (void)setPlaceAnnotationData:(id)a3;
- (void)setPlaybackControlBadgeAttribute:(unsigned __int8)a3;
- (void)setPlaybackControlBadgeAttributeFromMetadata:(id)a3;
- (void)setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:(unsigned __int16)a3;
- (void)setPlaybackVariationAndLoopingStyleFromAdjustmentRenderTypes:(unsigned int)a3;
- (void)setProResBadgeAttribute:(unsigned __int8)a3;
- (void)setPublicGlobalUUID:(id)a3;
- (void)setRAWBadgeAttribute:(unsigned __int8)a3;
- (void)setReverseLocationData:(id)a3;
- (void)setReverseLocationDataIsValid:(BOOL)a3;
- (void)setSavedAssetType:(signed __int16)a3;
- (void)setSensitivityAnalysisState:(unsigned __int8)a3;
- (void)setShiftedLocation:(id)a3;
- (void)setShiftedLocationIsValid:(BOOL)a3;
- (void)setSizeAndOrientationFromImageProperties:(id)a3;
- (void)setSpatialAudioControlBadgeAttribute:(unsigned __int8)a3;
- (void)setSpatialAudioControlBadgeAttributeFromMetadata:(id)a3;
- (void)setSpatialTypeFromMetadata:(id)a3;
- (void)setSyndicationAttributesFromMainFileURL:(id)a3 metadata:(id)a4;
- (void)setSyndicationFilenameAndDirectoryWithOriginalFilename:(id)a3;
- (void)setSyndicationLivePhotoAttributesFromMainFileURL:(id)a3 mainFileMetadata:(id)a4 videoComplementFileURL:(id)a5 videoComplementMetadata:(id)a6;
- (void)setThumbnailDataFromImageProperties:(id)a3;
- (void)setTitle:(id)a3;
- (void)setTrashedState:(signed __int16)a3;
- (void)setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:(id)a3 originalFilename:(id)a4;
- (void)setUniformTypeIdentifierFromOriginalFile;
- (void)setUniformTypeIdentifierFromPathExtension:(id)a3;
- (void)setUploadAttempts:(signed __int16)a3;
- (void)setUserCloudSharedLiked:(BOOL)a3;
- (void)setUuid:(id)a3;
- (void)setVideoInfoOnMasterFromAVAsset:(id)a3;
- (void)setVideoKeyFrameTime:(id *)a3;
- (void)setWasGuestAsset:(BOOL)a3;
- (void)setWidth:(int64_t)a3;
- (void)setupPropertiesOnExistingMaster:(id)a3;
- (void)setupPropertiesOnNewCloudMaster:(id)a3 withPlaceholderSourceAsset:(id)a4 uniformTypeIdentifier:(id)a5;
- (void)simulateQuarantineOriginalImageResourceOnPush:(id)a3;
- (void)synchronizeWithPersistedFileSystemAttributes;
- (void)synchronouslyFetchAdjustmentBlobWithCompletionHandler:(id)a3;
- (void)synchronouslyFetchAdjustmentDataWithCompletionHandler:(id)a3;
- (void)synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:(id)a3 withCompletionHandler:(id)a4;
- (void)syndicatedAssetDidSaveToUserLibrary;
- (void)unregisterForChanges;
- (void)unsaveSyndicatedAsset;
- (void)updateAdjustmentFileWithAdjustmentRenderTypes:(unsigned int)a3;
- (void)updateAssetAdjustmentsStateIfNeededFromAdjustmentFile;
- (void)updateAssetKindAndPlaybackStyleIfNeededWithKind:(signed __int16)a3;
- (void)updateAssetKindFromUniformTypeIdentifier;
- (void)updateAssetPropertiesFromAdjustmentFile;
- (void)updateAudioExtendedAttributesFromMetadata:(id)a3;
- (void)updateComputeSyncResourceAfterDownloadWithResource:(id)a3 onDemandDownload:(BOOL)a4;
- (void)updateImageExtendedAttributesFromMetadata:(id)a3;
- (void)updateImageExtendedGenerativeAttributesFromMetadata:(id)a3;
- (void)updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:(BOOL)a3;
- (void)updatePanoramosityWithMetadata:(id)a3;
- (void)updatePhotoIrisMetadataWithMediaGroupUUID:(id)a3 videoDuration:(id *)a4 stillDisplayTime:(id *)a5;
- (void)updatePhotoIrisVisibilityStateWithVitalityScore:(id)a3;
- (void)updatePlaybackStyleWithLivePhotoPlayability:(BOOL)a3;
- (void)updateSmartStyleVideoCastFromMetadata:(id)a3;
- (void)updateSpatialTypeFromAdjustmentRenderTypes:(unsigned int)a3 hasAdjustment:(BOOL)a4 adjustedMediaMetadata:(id)a5;
- (void)updateSyndicationStateWithSavedToLibrary:(BOOL)a3;
- (void)updateSyndicationStateWithSyndicationProcessingValue:(unsigned __int16)a3;
- (void)updateVideoAttributesFromMetadata:(id)a3 overwriteOriginalProperties:(BOOL)a4;
- (void)updateVideoExtendedAttributesFromMetadata:(id)a3;
- (void)updateWithCustomAssetProperties:(id)a3;
- (void)userDeleteCloudSharedComment:(id)a3;
- (void)userReadAllCloudSharedComments;
- (void)willSave;
- (void)willTurnIntoFault;
@end

@implementation PLManagedAsset

+ (id)predicateToExcludeNonvisibleBurstAssets
{
  pl_dispatch_once();
  v2 = predicateToExcludeNonvisibleBurstAssets_pl_once_object_14;

  return v2;
}

void __57__PLManagedAsset_predicateToExcludeNonvisibleBurstAssets__block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath:@"avalanchePickType"];
  v1 = [v3 copy];
  v2 = predicateToExcludeNonvisibleBurstAssets_pl_once_object_14;
  predicateToExcludeNonvisibleBurstAssets_pl_once_object_14 = v1;
}

+ (id)predicateToExcludeTrashedAssets
{
  pl_dispatch_once();
  v2 = predicateToExcludeTrashedAssets_pl_once_object_10;

  return v2;
}

void __49__PLManagedAsset_predicateToExcludeTrashedAssets__block_invoke(uint64_t a1)
{
  v3 = [*(a1 + 32) predicateToExcludeTrashedAssetsWithTrashedStateKeyPath:@"trashedState"];
  v1 = [v3 copy];
  v2 = predicateToExcludeTrashedAssets_pl_once_object_10;
  predicateToExcludeTrashedAssets_pl_once_object_10 = v1;
}

+ (id)predicateToExcludeCameraAutoAdjustments
{
  pl_dispatch_once();
  v2 = predicateToExcludeCameraAutoAdjustments_pl_once_object_17;

  return v2;
}

void __57__PLManagedAsset_predicateToExcludeCameraAutoAdjustments__block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d", @"adjustmentsState", 3];
  v0 = [v2 copy];
  v1 = predicateToExcludeCameraAutoAdjustments_pl_once_object_17;
  predicateToExcludeCameraAutoAdjustments_pl_once_object_17 = v0;
}

- (BOOL)migrateLocationDataIfNeededAfterOTARestore:(BOOL)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self locationData];
  v6 = [PLManagedAsset _locationDataFormat:v5];
  if (v6 == 2)
  {
    v7 = 0;
    goto LABEL_15;
  }

  v8 = [(PLManagedAsset *)self dateCreated];
  v9 = [PLManagedAsset newLocationFromLocationData:v5 timestampIfMissing:v8];
  if (!v6)
  {
    v10 = [(PLManagedAsset *)self mainFileURL];
    if (-[PLManagedAsset complete](self, "complete") && ([MEMORY[0x1E696AC08] defaultManager], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v10, "path"), v12 = objc_claimAutoreleasedReturnValue(), v13 = objc_msgSend(v11, "fileExistsAtPath:isDirectory:", v12, 0), v12, v11, v13))
    {
      v14 = objc_alloc(MEMORY[0x1E69C0718]);
      v15 = [(PLManagedObject *)self photoLibrary];
      v16 = [v15 libraryBundle];
      v17 = [v16 timeZoneLookup];
      v18 = [v14 initWithMediaURL:v10 timeZoneLookup:v17];

      v19 = [v18 gpsLocation];
      if (v19)
      {
        v20 = objc_alloc(MEMORY[0x1E6985C40]);
        [v9 coordinate];
        v22 = v21;
        v24 = v23;
        [v19 altitude];
        v26 = v25;
        [v19 horizontalAccuracy];
        v28 = v27;
        [v19 verticalAccuracy];
        v30 = v29;
        [v19 course];
        v32 = v31;
        [v19 speed];
        v34 = v33;
        v35 = [v19 timestamp];
        v36 = [v20 initWithCoordinate:v35 altitude:v22 horizontalAccuracy:v24 verticalAccuracy:v26 course:v28 speed:v30 timestamp:{v32, v34}];

        v9 = v36;
      }
    }

    else if (!v3)
    {
      v7 = 0;
      goto LABEL_13;
    }

    [(PLManagedAsset *)self setLocation:v9];
    v7 = 1;
LABEL_13:

    goto LABEL_14;
  }

  [(PLManagedAsset *)self setLocation:v9];
  v7 = 1;
LABEL_14:

LABEL_15:
  if (v6 == 2)
  {
    v37 = 1;
  }

  else
  {
    v37 = v7;
  }

  return v37;
}

+ (id)newLocationFromLocationData:(id)a3 timestampIfMissing:(id)a4
{
  v6 = a3;
  v7 = a4;
  if (!v6 || ![v6 length])
  {
    goto LABEL_8;
  }

  v8 = [a1 _locationDataFormat:v6];
  if (!v8)
  {
    v18 = 0uLL;
    [v6 getBytes:&v18 length:16];
    v17 = CLLocationCoordinate2DMake(*&v18, *(&v18 + 1));
    v14 = 0;
    if (![PLLocationUtils canUseCoordinate:?])
    {
      goto LABEL_9;
    }

    v16 = [objc_alloc(MEMORY[0x1E6985C40]) initWithCoordinate:v7 altitude:v17.latitude horizontalAccuracy:v17.longitude verticalAccuracy:0.0 timestamp:{0.0, 0.0}];
LABEL_13:
    v14 = v16;
    goto LABEL_9;
  }

  if (v8 == 1)
  {
    v16 = [MEMORY[0x1E696ACD0] pl_safeUnarchiveObjectFromData:v6 class:objc_opt_class()];
    goto LABEL_13;
  }

  if (v8 != 2)
  {
LABEL_8:
    v14 = 0;
    goto LABEL_9;
  }

  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  [v6 getBytes:&v18 length:64];
  v9 = v19;
  v10 = v20;
  v11 = v21;
  v12 = CLLocationCoordinate2DMake(*&v18, *(&v18 + 1));
  v13 = [MEMORY[0x1E695DF00] dateWithTimeIntervalSinceReferenceDate:*(&v11 + 1)];
  if ([PLLocationUtils canUseCoordinate:v12.latitude, v12.longitude])
  {
    v14 = [objc_alloc(MEMORY[0x1E6985C40]) initWithCoordinate:v13 altitude:v12.latitude horizontalAccuracy:v12.longitude verticalAccuracy:v9 course:v10 speed:*&v11 timestamp:?];
  }

  else
  {
    v14 = 0;
  }

LABEL_9:
  return v14;
}

+ (int64_t)_locationDataFormat:(id)a3
{
  v3 = [a3 length];
  if ((v3 & 0xFFFFFFFFFFFFFFBFLL) != 0)
  {
    return v3 != 16;
  }

  else
  {
    return 2;
  }
}

+ (id)newLocationDataFromLocation:(id)a3
{
  if (!a3)
  {
    return 0;
  }

  v3 = a3;
  [v3 coordinate];
  [v3 coordinate];
  v14[1] = v5;
  [v3 altitude];
  v14[2] = v6;
  [v3 horizontalAccuracy];
  v14[3] = v7;
  [v3 verticalAccuracy];
  v14[4] = v8;
  [v3 course];
  v14[5] = v9;
  [v3 speed];
  v14[6] = v10;
  v11 = [v3 timestamp];

  [v11 timeIntervalSinceReferenceDate];
  v14[7] = v12;

  return [objc_alloc(MEMORY[0x1E695DEF0]) initWithBytes:v14 length:64];
}

- (id)documentObservation
{
  v16 = *MEMORY[0x1E69E9840];
  if (documentObservation_onceToken != -1)
  {
    dispatch_once(&documentObservation_onceToken, &__block_literal_global_7496);
  }

  if (documentObservation_observationClass)
  {
    v3 = [(PLManagedAsset *)self mediaAnalysisAttributes];
    v4 = [v3 characterRecognitionAttributes];
    v5 = [v4 characterRecognitionData];

    if (v5)
    {
      v11 = 0;
      v6 = [MEMORY[0x1E696ACD0] unarchivedObjectOfClass:documentObservation_observationClass fromData:v5 error:&v11];
      v7 = v11;
      if (!v6 && os_log_type_enabled(MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR))
      {
        v10 = [(PLManagedAsset *)self uuid];
        *buf = 138543618;
        v13 = v10;
        v14 = 2112;
        v15 = v7;
        _os_log_error_impl(&dword_19BF1F000, MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR, "Failed to unarchive OCR VNDocumentObservation for asset: %{public}@, error: %@", buf, 0x16u);
      }
    }

    else
    {
      v6 = 0;
    }

    v8 = v6;
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

void __42__PLManagedAsset_OCR__documentObservation__block_invoke()
{
  documentObservation_observationClass = NSClassFromString(&cfstr_Vndocumentobse.isa);
  if (!documentObservation_observationClass && os_log_type_enabled(MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR))
  {
    *v0 = 0;
    _os_log_error_impl(&dword_19BF1F000, MEMORY[0x1E69E9C10], OS_LOG_TYPE_ERROR, "VNDocumentObservation not available in current process.", v0, 2u);
  }
}

- (BOOL)promoteFromUnknownKind
{
  if ([(PLManagedAsset *)self kind]== 3)
  {
    v3 = [(PLManagedAsset *)self originalUniformTypeIdentifier];
    v4 = [MEMORY[0x1E69C08F0] typeWithIdentifier:v3];
    if ([v4 conformsToType:*MEMORY[0x1E6982E30]])
    {
      v5 = 0;
    }

    else
    {
      if (([v4 conformsToType:*MEMORY[0x1E6982EE8]] & 1) == 0)
      {
        if (![(PLManagedAsset *)self attemptPromoteFromUnknownKindUsingCloudMaster])
        {
          v6 = 0;
LABEL_11:

          return v6;
        }

LABEL_8:
        v7 = [(PLManagedObject *)self photoLibrary];
        v8 = [v7 thumbnailManager];

        v9 = [(PLManagedAsset *)self thumbnailIdentifier];
        v10 = [(PLManagedAsset *)self thumbnailIndex];
        v11 = [(PLManagedAsset *)self uuid];
        [v8 deleteThumbnailsWithIdentifier:v9 orIndex:v10 uuid:v11];

        [(PLManagedAsset *)self setEffectiveThumbnailIndex:0x7FFFFFFFFFFFFFFFLL];
        v12 = [(PLManagedAsset *)self uniformTypeIdentifier];

        if (!v12)
        {
          [(PLManagedAsset *)self setUniformTypeIdentifier:v3];
        }

        v6 = 1;
        goto LABEL_11;
      }

      v5 = 1;
    }

    [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:v5];
    goto LABEL_8;
  }

  return 0;
}

- (BOOL)attemptPromoteFromUnknownKindUsingCloudMaster
{
  v28 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self master];
  v4 = [v3 uniformTypeIdentifier];
  v5 = [v3 allAssetAttachedResources];
  v6 = MEMORY[0x1E696AE18];
  v7 = [MEMORY[0x1E6994B90] imageDerivativeTypes];
  v8 = [v6 predicateWithFormat:@"cplType IN %@", v7];
  v9 = [v5 filteredSetUsingPredicate:v8];
  v10 = [v9 count];

  if (v10)
  {
    if (*MEMORY[0x1E6994D48])
    {
      v13 = 0;
      goto LABEL_12;
    }

    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = [(PLManagedAsset *)self uuid];
      *buf = 138412802;
      v23 = v4;
      v24 = 2112;
      v25 = v12;
      v26 = 2112;
      v27 = v3;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Guessing PLAssetTypeImage for UTI: %@ on asset: %@ from master %@", buf, 0x20u);
    }

    v13 = 0;
  }

  else
  {
    v14 = MEMORY[0x1E696AE18];
    v15 = [MEMORY[0x1E6994B90] videoDerivativeTypes];
    v16 = [v14 predicateWithFormat:@"cplType IN %@", v15];
    v17 = [v5 filteredSetUsingPredicate:v16];
    v18 = [v17 count];

    if (!v18)
    {
      v20 = 0;
      goto LABEL_13;
    }

    if (*MEMORY[0x1E6994D48])
    {
      v13 = 1;
      goto LABEL_12;
    }

    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v19 = [(PLManagedAsset *)self uuid];
      *buf = 138412802;
      v23 = v4;
      v24 = 2112;
      v25 = v19;
      v26 = 2112;
      v27 = v3;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Guessing PLAssetTypeVideo for UTI: %@ on asset: %@ from master %@", buf, 0x20u);
    }

    v13 = 1;
  }

LABEL_12:
  [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:v13];
  v20 = 1;
LABEL_13:

  return v20;
}

+ (id)assetsToConsiderForTypePromotionInContext:(id)a3 withExtensions:(id)a4 error:(id *)a5
{
  v43 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  if (!v9)
  {
    v31 = [MEMORY[0x1E696AAA8] currentHandler];
    [v31 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+NewFormats.m" lineNumber:60 description:{@"Invalid parameter not satisfying: %@", @"context"}];
  }

  v34 = v9;
  if (!v10)
  {
    v32 = [MEMORY[0x1E696AAA8] currentHandler];
    [v32 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+NewFormats.m" lineNumber:61 description:{@"Invalid parameter not satisfying: %@", @"extensions"}];
  }

  v33 = [MEMORY[0x1E696AE18] predicateWithFormat:@"kind = %d", 3];
  v11 = [MEMORY[0x1E695DF70] array];
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  obj = v10;
  v12 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v38;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v38 != v14)
        {
          objc_enumerationMutation(obj);
        }

        v16 = MEMORY[0x1E696AE18];
        v17 = [MEMORY[0x1E696AEC0] stringWithFormat:@".%@", *(*(&v37 + 1) + 8 * i)];
        v18 = [v16 predicateWithFormat:@"filename ENDSWITH[c] %@", v17];
        [v11 addObject:v18];
      }

      v13 = [obj countByEnumeratingWithState:&v37 objects:v42 count:16];
    }

    while (v13);
  }

  v19 = MEMORY[0x1E696AB28];
  v41[0] = v33;
  v20 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v11];
  v41[1] = v20;
  v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v41 count:2];
  v22 = [v19 andPredicateWithSubpredicates:v21];

  v23 = MEMORY[0x1E695D5E0];
  v24 = +[PLManagedAsset entityName];
  v25 = [v23 fetchRequestWithEntityName:v24];

  [v25 setFetchBatchSize:100];
  [v25 setPredicate:v22];
  v36 = 0;
  v26 = [v34 executeFetchRequest:v25 error:&v36];
  v27 = v36;
  v28 = v27;
  if (a5 && v27)
  {
    v29 = v27;
    *a5 = v28;
  }

  return v26;
}

- (id)edgesIn
{
  v2 = [PLGraphNode nodeForActingObject:self createIfMissing:0];
  v3 = [v2 edgesIn];

  return v3;
}

- (id)edgesOut
{
  v2 = [PLGraphNode nodeForActingObject:self createIfMissing:0];
  v3 = [v2 edgesOut];

  return v3;
}

- (double)pl_gpsHorizontalAccuracy
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  [v2 gpsHorizontalAccuracy];
  v4 = v3;

  return v4;
}

- (NSDate)pl_date
{
  cachedDateCreated = self->_cachedDateCreated;
  if (!cachedDateCreated)
  {
    v4 = [(PLManagedAsset *)self dateCreated];
    v5 = self->_cachedDateCreated;
    self->_cachedDateCreated = v4;

    cachedDateCreated = self->_cachedDateCreated;
  }

  return cachedDateCreated;
}

- (CLLocationCoordinate2D)pl_coordinate
{
  if (!self->_isCoordinateCached)
  {
    [(PLManagedAsset *)self latitude];
    v4 = v3;
    [(PLManagedAsset *)self longitude];
    v6 = CLLocationCoordinate2DMake(v4, v5);
    v7 = [PLLocationUtils canUseCoordinate:?];
    p_cachedCoordinate = &self->_cachedCoordinate;
    if (v7)
    {
      p_cachedCoordinate->latitude = v6.latitude;
      self->_cachedCoordinate.longitude = v6.longitude;
    }

    else
    {
      *p_cachedCoordinate = *MEMORY[0x1E6985CC0];
    }

    self->_isCoordinateCached = 1;
  }

  latitude = self->_cachedCoordinate.latitude;
  longitude = self->_cachedCoordinate.longitude;
  result.longitude = longitude;
  result.latitude = latitude;
  return result;
}

- (id)activityViewController:(id)a3 itemForActivityType:(id)a4
{
  if ([a4 isEqualToString:@"com.apple.UIKit.activity.CopyToPasteboard"])
  {
    [(PLManagedAsset *)self pasteBoardRepresentation];
  }

  else
  {
    [(PLManagedAsset *)self assetURL];
  }
  v5 = ;

  return v5;
}

- (int)inferredTimeZoneOffset
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 inferredTimeZoneOffset];
  v4 = [v3 integerValue];

  return v4;
}

- (NSNumber)rawTimeZoneOffsetValue
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 timeZoneOffset];

  return v3;
}

- (NSString)rawTimeZoneName
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 timeZoneName];

  return v3;
}

- (id)localDateAndCreateIfNeededWithLocalDateCreator:(id)a3
{
  v4 = a3;
  v5 = self->_cachedLocalDateCreated;
  v6 = v5;
  if (v5)
  {
    v7 = v5;
  }

  else
  {
    v8 = [(PLManagedAsset *)self additionalAttributes];
    v9 = [v8 inferredTimeZoneOffset];
    if (!v9)
    {
      v10 = [v4 generateInferredTimeZoneOffsetForAsset:self];
      [v8 setInferredTimeZoneOffset:v10];
    }

    v7 = [(PLManagedAsset *)self localDateCreated];
  }

  return v7;
}

- (double)gpsHorizontalAccuracy
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  [v2 gpsHorizontalAccuracy];
  v4 = v3;

  return v4;
}

- (NSDate)localDateCreated
{
  cachedLocalDateCreated = self->_cachedLocalDateCreated;
  if (!cachedLocalDateCreated)
  {
    v4 = [(PLManagedAsset *)self pl_date];
    v5 = [v4 dateByAddingTimeInterval:{-[PLManagedAsset inferredTimeZoneOffset](self, "inferredTimeZoneOffset")}];
    v6 = self->_cachedLocalDateCreated;
    self->_cachedLocalDateCreated = v5;

    cachedLocalDateCreated = self->_cachedLocalDateCreated;
  }

  return cachedLocalDateCreated;
}

- (int64_t)compareToAsset:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self dateCreated];
  v6 = [v4 dateCreated];
  v7 = [v5 compare:v6];

  if (!v7)
  {
    v8 = [(PLManagedAsset *)self addedDate];
    v9 = [v4 addedDate];
    v7 = [v8 compare:v9];

    if (!v7)
    {
      v10 = [(PLManagedAsset *)self filename];
      v11 = [v4 filename];
      v7 = [v10 compare:v11];
    }
  }

  return v7;
}

- (id)assetComparisonSortDescriptors
{
  v7[3] = *MEMORY[0x1E69E9840];
  v2 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:1];
  v3 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"addedDate" ascending:{1, v2}];
  v7[1] = v3;
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"filename" ascending:1];
  v7[2] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v7 count:3];

  return v5;
}

- (BOOL)visibilityStateIsEqualToState:(signed __int16)a3
{
  if (!a3)
  {
    if ([(PLManagedAsset *)self visibilityState])
    {
      return 0;
    }

    goto LABEL_10;
  }

  if (a3 == 1)
  {
    if ([(PLManagedAsset *)self visibilityState]!= 1)
    {
      return 0;
    }

LABEL_10:
    if (([(PLManagedAsset *)self hidden]& 1) == 0)
    {
      return ![(PLManagedAsset *)self isInTrash];
    }

    return 0;
  }

  if (a3 != 2)
  {
    return 0;
  }

  if ([(PLManagedAsset *)self visibilityState]== 2 || ([(PLManagedAsset *)self hidden]& 1) != 0)
  {
    return 1;
  }

  return [(PLManagedAsset *)self isInTrash];
}

- (id)descriptionForModernResources
{
  v21 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E696AD60] string];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"qualitySortValue" ascending:1];
  v5 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"version" ascending:0];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v6 = [(PLManagedAsset *)self resourcesSortedByQualityWithOptions:0];
  v19[0] = v4;
  v19[1] = v5;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v19 count:2];
  v8 = [v6 sortedArrayUsingDescriptors:v7];

  v9 = [v8 countByEnumeratingWithState:&v15 objects:v20 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v16;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v16 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v15 + 1) + 8 * i) debugDescription];
        [v3 appendFormat:@"resource: %@\n", v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v15 objects:v20 count:16];
    }

    while (v10);
  }

  return v3;
}

- (id)faceDescription
{
  v19 = *MEMORY[0x1E69E9840];
  v3 = +[PLDescriptionBuilder plainMultiLineDescriptionBuilder];
  v4 = [(PLManagedAsset *)self faceAdjustmentVersion];
  [v3 appendName:@"adjustmentVersion" object:v4];

  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v3 appendName:@"analysisVersion" integerValue:{objc_msgSend(v5, "faceAnalysisVersion")}];

  v6 = [(PLManagedAsset *)self detectedFaces];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = [*(*(&v14 + 1) + 8 * i) debugLogDescription];
        [v3 appendName:@"face" object:v11];
      }

      v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v8);
  }

  v12 = [v3 build];

  return v12;
}

- (id)descriptionForNonCloudResources
{
  v3 = [MEMORY[0x1E696AD60] string];
  [v3 appendString:{@"CPL not enabled, resource list may not be complete\n"}];
  v4 = [(PLManagedAsset *)self pathForOriginalFile];
  v5 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Original", v4);
  [v3 appendString:v5];

  v6 = [(PLManagedAsset *)self pathForFullsizeImageFile];
  v7 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"FullSize", v6);
  [v3 appendString:v7];

  v8 = [(PLManagedAsset *)self pathForLargeThumbnailFile];
  v9 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Medium (3MP)", v8);
  [v3 appendString:v9];

  v10 = [(PLManagedAsset *)self pathForMediumThumbnailFile];
  v11 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Thumb", v10);
  [v3 appendString:v11];

  v12 = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
  v13 = __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(@"Substandard", v12);
  [v3 appendString:v13];

  return v3;
}

id __49__PLManagedAsset_descriptionForNonCloudResources__block_invoke(void *a1, void *a2)
{
  v3 = MEMORY[0x1E696AC08];
  v4 = a2;
  v5 = a1;
  v6 = [v3 defaultManager];
  v7 = [v6 fileExistsAtPath:v4];

  v8 = @"N";
  if (v7)
  {
    v8 = @"Y";
  }

  v9 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@ : %@ : %@\n", v5, v4, v8];

  return v9;
}

- (id)descriptionForSceneAnalysis
{
  v33 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [v3 sceneClassifications];

  v5 = MEMORY[0x1E696AD60];
  v6 = [(PLManagedAsset *)self additionalAttributes];
  v7 = [v6 sceneAnalysisVersion];
  v8 = [(PLManagedAsset *)self additionalAttributes];
  v9 = [v8 sceneAnalysisTimestamp];
  v10 = [v5 stringWithFormat:@"version: %ld\ntimestamp: %@\n%lu total", v7, v9, objc_msgSend(v4, "count")];

  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v11 = v4;
  v12 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v12)
  {
    v13 = v12;
    v14 = *v29;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v29 != v14)
        {
          objc_enumerationMutation(v11);
        }

        v16 = [*(*(&v28 + 1) + 8 * i) debugLogDescription];
        [v10 appendFormat:@"\n%@", v16];
      }

      v13 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
    }

    while (v13);
  }

  [(PLManagedAsset *)self packedPreferredCropRect];
  [(PLManagedAsset *)self packedAcceptableCropRect];
  PLSplitToCGRectFromInt64();
  PLSplitToCGRectFromInt64();
  v27 = vmulq_f64(0, vcvtq_f64_s64(*&self->_width));
  v35.origin = v27;
  v35.size = v27;
  v17 = NSStringFromRect(v35);
  v36.origin = v27;
  v36.size = v27;
  v18 = NSStringFromRect(v36);
  [v10 appendFormat:@"\nPreferred Crop Rect: %@\nAcceptable Crop Rect: %@", v17, v18];

  if ([(PLManagedAsset *)self faceAreaPoints]< 0)
  {
    v23 = *MEMORY[0x1E695F058];
    v24 = *(MEMORY[0x1E695F058] + 8);
    v20 = *(MEMORY[0x1E695F058] + 16);
    v22 = *(MEMORY[0x1E695F058] + 24);
  }

  else
  {
    PLSplitToDoubleFromInt64();
    width = self->_width;
    v20 = (0.0 - 0.0) * width;
    height = self->_height;
    v22 = (0.0 - 0.0) * height;
    v23 = 0.0 * width;
    v24 = 0.0 * height;
  }

  v25 = NSStringFromRect(*&v23);
  [v10 appendFormat:@"\nFace Area Rect: %@", v25];

  return v10;
}

- (id)descriptionForAnalysisStates
{
  v17 = *MEMORY[0x1E69E9840];
  v2 = [(PLManagedAsset *)self analysisStates];
  v3 = [MEMORY[0x1E696AD60] string];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = v2;
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v3 length])
        {
          [v3 appendFormat:@"\n"];
        }

        v10 = [v9 debugLogDescription];
        [v3 appendFormat:@"%@", v10];
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v6);
  }

  return v3;
}

- (id)descriptionForSidecarFiles
{
  v15 = *MEMORY[0x1E69E9840];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v2 = [(PLManagedAsset *)self sidecars];
  v3 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v11;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(v2);
        }

        v8 = *(*(&v10 + 1) + 8 * i);
        if (!v5)
        {
          v5 = [MEMORY[0x1E696AD60] string];
        }

        [v5 appendFormat:@"SIDECAR: %@", v8];
      }

      v4 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)shortenedFilePath
{
  v2 = [(PLManagedAsset *)self pathForOriginalFile];
  v3 = [v2 rangeOfString:@"/Media/"];
  if (v4)
  {
    v5 = [v2 substringWithRange:{v3, objc_msgSend(v2, "length") - v3}];
  }

  else
  {
    v5 = v2;
  }

  v6 = v5;

  return v6;
}

- (BOOL)isPlayableVideo:(id *)a3
{
  v5 = [(PLManagedAsset *)self isPhotoIris];
  if (![(PLManagedAsset *)self isVideo]&& !v5)
  {
    v6 = 0;
    if (!a3)
    {
      v7 = 0;
      goto LABEL_40;
    }

LABEL_39:
    v7 = 0;
    *a3 = v6;
    goto LABEL_40;
  }

  v8 = objc_autoreleasePoolPush();
  v9 = [(PLManagedObject *)self photoLibrary];
  v10 = [v9 isCloudPhotoLibraryEnabled];

  if (!v10)
  {
    if (v5)
    {
      [(PLManagedAsset *)self pathForVideoComplementFile];
    }

    else
    {
      [(PLManagedAsset *)self pathForOriginalFile];
    }
    v19 = ;
    v6 = 0;
    v7 = 1;
    if (!v19)
    {
      goto LABEL_36;
    }

    goto LABEL_30;
  }

  if (v5)
  {
    v11 = 18;
  }

  else
  {
    v11 = 1;
  }

  v35 = 0;
  v12 = [(PLManagedAsset *)self _isResourceAvailableForResourceType:v11 outResource:&v35];
  v13 = v35;
  v14 = v13;
  if (v12)
  {
    v15 = [v13 uniformTypeIdentifier];
    v16 = [v15 identifier];

    v17 = [v14 cplFileURL];
    v18 = [v17 path];

    if ([objc_opt_class() _isPlayableVideoUTI:v16])
    {
      if (v5)
      {
        v18 = v18;
        v6 = 0;
        v7 = 1;
        v19 = v18;
      }

      else
      {
        v20 = [(PLManagedAsset *)self master];
        v21 = [v20 mediaMetadata];
        v22 = [v21 valueForKey:@"data"];

        if (v22)
        {
          v23 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVProxyData:v22 timeZoneLookup:0];
          v24 = v23;
          if (v23)
          {
            v25 = [v23 isPlayable];
            v7 = v25;
            v6 = 0;
            if (a3 && (v25 & 1) == 0)
            {
              v6 = [v24 videoCodecName];
              v7 = 0;
            }
          }

          else
          {
            v6 = 0;
            v7 = 1;
          }
        }

        else
        {
          v6 = 0;
          v7 = 1;
        }

        v19 = 0;
      }
    }

    else
    {
      v19 = 0;
      v6 = 0;
      v7 = 0;
    }
  }

  else
  {
    v18 = 0;
    v16 = 0;
    v19 = 0;
    v6 = 0;
    v7 = 1;
  }

  if (v19)
  {
LABEL_30:
    v26 = [MEMORY[0x1E696AC08] defaultManager];
    v27 = [v26 fileExistsAtPath:v19];

    if (v27)
    {
      v28 = [MEMORY[0x1E695DFF8] fileURLWithPath:v19 isDirectory:0];
      v29 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVURL:v28 timeZoneLookup:0];
      v30 = v29;
      if (v29)
      {
        v31 = [v29 isPlayable];
        v7 = v31;
        if (a3)
        {
          if ((v31 & 1) == 0)
          {
            v32 = [v30 videoCodecName];

            v7 = 0;
            v6 = v32;
          }
        }
      }
    }
  }

LABEL_36:

  objc_autoreleasePoolPop(v8);
  if (a3 && !v7)
  {
    v33 = v6;
    goto LABEL_39;
  }

LABEL_40:

  return v7;
}

- (NSURL)assetURL
{
  v3 = [(PLManagedAsset *)self fileExtension];
  v4 = [(PLManagedAsset *)self assetURLWithExtension:v3];

  return v4;
}

- (id)assetURLForSidecarFile:(id)a3
{
  v4 = a3;
  v5 = v4;
  if (v4)
  {
    v6 = MEMORY[0x1E6982C40];
    v7 = [v4 uniformTypeIdentifier];
    v8 = [v6 typeWithIdentifier:v7];
    v9 = [v8 preferredFilenameExtension];

    v10 = MEMORY[0x1E695DFF8];
    v11 = MEMORY[0x1E696AEC0];
    v12 = [(PLManagedAsset *)self uuid];
    v13 = [v5 index];
    v14 = [v11 stringWithFormat:@"%@://%@/%@.%@?%@=%@&%@=%@", @"assets-library", @"asset", @"asset", v9, @"id", v12, @"sci", v13];
    v15 = [v10 URLWithString:v14];
  }

  else
  {
    v16 = MEMORY[0x1E695DFF8];
    v17 = MEMORY[0x1E696AEC0];
    v9 = [(PLManagedAsset *)self fileExtension];
    v12 = [(PLManagedAsset *)self uuid];
    v13 = [v17 stringWithFormat:@"%@://%@/%@.%@?%@=%@", @"assets-library", @"asset", @"asset", v9, @"id", v12];
    v15 = [v16 URLWithString:v13];
  }

  return v15;
}

- (id)assetURLWithExtension:(id)a3
{
  v22 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v5 = [(PLManagedAsset *)self sidecars];
  v6 = [v5 countByEnumeratingWithState:&v17 objects:v21 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v18;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v18 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v17 + 1) + 8 * i);
        v11 = [v10 originalFilename];
        v12 = [v11 pathExtension];
        v13 = [v12 compare:v4 options:1];

        if (!v13)
        {
          v14 = [(PLManagedAsset *)self assetURLForSidecarFile:v10];
          goto LABEL_11;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v17 objects:v21 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  v5 = [(PLManagedAsset *)self uuid];
  v14 = [PLManagedAsset assetsLibraryURLWithUUID:v5 extension:v4];
LABEL_11:
  v15 = v14;

  return v15;
}

- (NSString)textBadgeString
{
  v3 = objc_autoreleasePoolPush();
  v4 = [(PLManagedAsset *)self allFileExtensions];
  if ([v4 count] == 1 && (-[PLManagedAsset isPhoto](self, "isPhoto") || -[PLManagedAsset isVideo](self, "isVideo") || -[PLManagedAsset isAudio](self, "isAudio") || -[PLManagedAsset kind](self, "kind") == 3))
  {

    objc_autoreleasePoolPop(v3);
    v5 = 0;
  }

  else
  {
    v6 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(v4, "count")}];
    v28 = 0;
    v29 = &v28;
    v30 = 0x2020000000;
    v31 = 0;
    v24 = 0;
    v25 = &v24;
    v26 = 0x2020000000;
    v27 = 0;
    v20 = 0;
    v21 = &v20;
    v22 = 0x2020000000;
    v23 = 0;
    v16 = 0;
    v17 = &v16;
    v18 = 0x2020000000;
    v19 = 0;
    v10[0] = MEMORY[0x1E69E9820];
    v10[1] = 3221225472;
    v10[2] = __33__PLManagedAsset_textBadgeString__block_invoke;
    v10[3] = &unk_1E7567A60;
    v12 = &v28;
    v7 = v6;
    v11 = v7;
    v13 = &v24;
    v14 = &v20;
    v15 = &v16;
    [v4 enumerateObjectsUsingBlock:v10];
    if ([v7 count] == 2 && *(v29 + 24) == 1 && (v25[3] & 1) != 0)
    {
      v5 = @"RAW+JPG";
    }

    else if ([v7 count] == 2 && *(v21 + 24) == 1 && (v17[3] & 1) != 0)
    {
      v5 = 0;
    }

    else
    {
      v8 = [v7 componentsJoinedByString:@"+"];
      v5 = [v8 uppercaseString];
    }

    _Block_object_dispose(&v16, 8);
    _Block_object_dispose(&v20, 8);
    _Block_object_dispose(&v24, 8);
    _Block_object_dispose(&v28, 8);

    objc_autoreleasePoolPop(v3);
  }

  return v5;
}

void __33__PLManagedAsset_textBadgeString__block_invoke(void *a1, void *a2)
{
  v3 = MEMORY[0x1E6982C40];
  v4 = a2;
  v8 = [v3 typeWithFilenameExtension:v4];
  if ([v8 conformsToType:*MEMORY[0x1E6982F88]])
  {
    *(*(a1[5] + 8) + 24) = 1;
    v5 = a1[4];
    v6 = @"RAW";
  }

  else if ([v8 conformsToType:*MEMORY[0x1E6982E58]])
  {
    *(*(a1[6] + 8) + 24) = 1;
    v5 = a1[4];
    v6 = @"JPG";
  }

  else if ([v8 conformsToType:*MEMORY[0x1E6982F28]])
  {
    *(*(a1[7] + 8) + 24) = 1;
    v5 = a1[4];
    v6 = @"PNG";
  }

  else
  {
    v5 = a1[4];
    v6 = v4;
  }

  [v5 addObject:v6];
  v7 = [(__CFString *)v4 caseInsensitiveCompare:*MEMORY[0x1E69C0E20]];

  if (!v7)
  {
    *(*(a1[8] + 8) + 24) = 1;
  }
}

- (id)pasteBoardRepresentation
{
  v3 = [MEMORY[0x1E695DF90] dictionary];
  v4 = [(PLManagedAsset *)self objectID];
  if (v4)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v5 = [v4 URIRepresentation];
      v6 = [v5 absoluteString];
    }

    else
    {
      v6 = 0;
    }

    v7 = [v6 dataUsingEncoding:4];
    [v3 setObject:v7 forKey:@"com.apple.mobileslideshow.asset-object-id-uri"];
  }

  v12 = 0;
  v8 = [(PLManagedAsset *)self largestAvailableDataRepresentationAndType:&v12];
  v9 = v12;
  if (v9)
  {
    v10 = v8 == 0;
  }

  else
  {
    v10 = 1;
  }

  if (!v10)
  {
    [v3 setObject:v8 forKey:v9];
  }

  return v3;
}

- (id)largestAvailableDataRepresentationAndType:(id *)a3
{
  v5 = 0;
  [(PLManagedAsset *)self _getLargestAvailableDataRepresentation:&v5 type:a3];
  v3 = v5;

  return v3;
}

- (void)_getLargestAvailableDataRepresentation:(id *)a3 type:(id *)a4
{
  if (-[PLManagedAsset isPhoto](self, "isPhoto") && ([0 pathExtension], v7 = objc_claimAutoreleasedReturnValue(), v8 = +[PLPhotoLibrary isRawImageFileExtension:](PLPhotoLibrary, "isRawImageFileExtension:", v7), v7, v8))
  {
    v19 = 0;
    v9 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:self format:0 allowMetadataSnapshot:0 forceLarge:1 outFilePath:&v19 outImageType:0];
    v10 = v19;
  }

  else
  {
    v10 = 0;
  }

  if ([(PLManagedAsset *)self isVideo])
  {
    v11 = [(PLManagedAsset *)self pathForVideoFile];

    v10 = v11;
  }

  if (!v10)
  {
    v12 = [(PLManagedAsset *)self pathForOriginalFile];
    if (v12)
    {
      v10 = v12;
    }

    else
    {
      v18 = 0;
      v13 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:self format:0 allowMetadataSnapshot:0 forceLarge:1 outFilePath:&v18 outImageType:0];
      v10 = v18;
      if (!v10)
      {
        v14 = 0;
        goto LABEL_16;
      }
    }
  }

  if (a3)
  {
    v14 = [objc_alloc(MEMORY[0x1E695DEF0]) initWithContentsOfFile:v10 options:1 error:0];
    *a3 = v14;
    if (!a4)
    {
      goto LABEL_16;
    }

    goto LABEL_15;
  }

  v14 = 0;
  if (a4)
  {
LABEL_15:
    v15 = MEMORY[0x1E6982C40];
    v16 = [v10 pathExtension];
    v17 = [v15 typeWithFilenameExtension:v16];
    *a4 = [v17 identifier];
  }

LABEL_16:
}

- (id)imageWithFormat:(unsigned __int16)a3
{
  v3 = [PLImageLoadingUtilities newSynchronousImageForAsset:self withFormat:a3 allowPlaceholder:1 outImageProperties:0 outDeliveredPlaceholder:0];

  return v3;
}

- (id)pathForOriginalVideoComplementDiagnosticFile
{
  v3 = [(PLManagedAsset *)self pathForDiagnosticFile];
  v4 = [v3 stringByDeletingPathExtension];
  v5 = [(PLManagedAsset *)self pathForVideoComplementFile];
  v6 = [v5 pathExtension];
  v7 = [v4 stringByAppendingPathExtension:v6];

  return v7;
}

- (id)pathForCameraSpatialOverCaptureMetadataDiagnosticFile
{
  v2 = [(PLManagedAsset *)self pathForDiagnosticFile];
  v3 = [v2 stringByDeletingPathExtension];
  v4 = [v3 stringByAppendingPathExtension:*MEMORY[0x1E69C00F0]];
  v5 = [v4 stringByAppendingPathExtension:*MEMORY[0x1E69C00C0]];

  return v5;
}

- (id)pathForCameraMetadataDiagnosticFile
{
  v2 = [(PLManagedAsset *)self pathForDiagnosticFile];
  v3 = [v2 stringByDeletingPathExtension];
  v4 = [v3 stringByAppendingPathExtension:*MEMORY[0x1E69C00C0]];

  return v4;
}

- (id)pathForReframeDiagnosticFile
{
  v2 = [(PLManagedAsset *)self pathForReframeDiagnosticDirectory];
  v3 = [v2 stringByAppendingPathComponent:*MEMORY[0x1E69C00E8]];
  v4 = [v3 stringByAppendingPathExtension:*MEMORY[0x1E69C00C8]];

  return v4;
}

- (id)pathForReframeDiagnosticDirectory
{
  v3 = [(PLManagedAsset *)self mainFileURL];
  v4 = [v3 lastPathComponent];
  v5 = [v4 stringByDeletingPathExtension];

  v6 = [(PLManagedObject *)self photoLibrary];
  v7 = [v6 pathManager];
  v8 = [v7 privateDirectoryWithSubType:8 createIfNeeded:0 error:0];

  v9 = [v8 stringByAppendingPathComponent:v5];

  return v9;
}

- (id)pathForSpatialOverCaptureDiagnosticFile
{
  v3 = [(PLManagedAsset *)self pathForSpatialOverCaptureContentFile];
  v4 = [v3 lastPathComponent];

  v5 = objc_opt_class();
  v6 = [(PLManagedObject *)self photoLibrary];
  v7 = [v5 diagnosticFilePathForLibrary:v6 mainFilename:v4 createIfNeeded:0];

  return v7;
}

- (id)pathForDiagnosticFile
{
  v3 = [(PLManagedAsset *)self mainFileURL];
  v4 = [v3 lastPathComponent];

  v5 = objc_opt_class();
  v6 = [(PLManagedObject *)self photoLibrary];
  v7 = [v5 diagnosticFilePathForLibrary:v6 mainFilename:v4 createIfNeeded:0];

  return v7;
}

- (NSString)pathForLegacySlalomRegionsArchive
{
  if ([(PLManagedAsset *)self isDefaultAdjustedSlomo])
  {
    v3 = [(PLManagedAsset *)self pathForOriginalFile];
    v4 = [v3 stringByDeletingPathExtension];
    v5 = [v4 stringByAppendingPathExtension:@"SLM"];
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (BOOL)isDefaultAdjustedSlomo
{
  v3 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [v3 unmanagedAdjustment];

  v5 = [v4 adjustmentFormatIdentifier];
  v6 = [v5 isEqualToString:@"com.apple.video.slomo"];

  v7 = [v4 adjustmentFormatVersion];
  v8 = v7;
  if (v6)
  {
    if ([v7 isEqualToString:@"1.1"])
    {
      LOBYTE(v6) = 1;
    }

    else
    {
      LOBYTE(v6) = [v8 isEqualToString:@"1.0"];
    }
  }

  v9 = [(PLManagedAsset *)self isVideo];

  return v9 & v6;
}

- (BOOL)isMogul
{
  v3 = [(PLManagedAsset *)self isVideo];
  if (v3)
  {
    LOBYTE(v3) = [(PLManagedAsset *)self kindSubtype]== 101;
  }

  return v3;
}

- (NSString)pathForXMPFile
{
  v3 = [(PLManagedObject *)self pathManager];
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v4 = objc_alloc(MEMORY[0x1E69BF298]);
    v5 = [(PLManagedAsset *)self uuid];
    v6 = [(PLManagedAsset *)self bundleScope];
    v7 = [MEMORY[0x1E69C08F0] supplementalResourceXMPType];
    v8 = [v7 identifier];
    v9 = [v4 initWithAssetUuid:v5 bundleScope:v6 uti:v8 resourceVersion:0 resourceType:5];

    v10 = [v3 readOnlyUrlWithIdentifier:v9];
    v11 = [v10 path];
  }

  else
  {
    v9 = [*MEMORY[0x1E69C0E20] uppercaseString];
    [v9 UTF8String];
    v10 = [(PLManagedAsset *)self filename];
    v12 = [(PLManagedAsset *)self directory];
    v13 = PLDCIMURLForResourcePropertiesAndPathManager();
    v11 = [v13 path];
  }

  return v11;
}

- (NSString)pathForPrebakedPortraitScrubberThumbnails
{
  if ([(PLManagedAsset *)self isVideo])
  {
    v3 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"THP"];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (NSString)pathForPrebakedLandscapeScrubberThumbnails
{
  if ([(PLManagedAsset *)self isVideo])
  {
    v3 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"THL"];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (unsigned)expectedDeferredProcessingNeededOnAssetCreation
{
  v3 = [(PLManagedAsset *)self deferredProcessingNeeded];
  if (!v3)
  {
    if ([(PLManagedAsset *)self kind])
    {
      LOWORD(v3) = 0;
    }

    else
    {
      v4 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FBF4A8];
      v5 = [PLResourceRecipe recipeFromID:65737];
      if ([v4 containsObject:v5])
      {
        LOWORD(v3) = 4;
      }

      else
      {
        LOWORD(v3) = 0;
      }
    }
  }

  return v3;
}

- (BOOL)renderableAdjustmentDictionary:(id *)a3 error:(id *)a4
{
  v6 = MEMORY[0x1E695DEF0];
  v7 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v25 = 0;
  v8 = [v6 dataWithContentsOfFile:v7 options:0 error:&v25];
  v9 = v25;

  if (v8)
  {
    v24 = 0;
    v10 = [MEMORY[0x1E696AE40] propertyListWithData:v8 options:0 format:0 error:&v24];
    v11 = v24;

    v9 = v11;
  }

  else
  {
    v10 = 0;
  }

  v12 = [v10 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
  v13 = [v10 objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
  v14 = [v10 objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
  v15 = v14;
  if (v12)
  {
    v16 = v13 == 0;
  }

  else
  {
    v16 = 1;
  }

  v17 = v16 || v14 == 0;
  if (v17 || ([MEMORY[0x1E69C0910] isRecognizedSlowMotionFormatWithIdentifier:v14 version:v13] & 1) != 0)
  {
    v18 = 0;
    if (!a4)
    {
      goto LABEL_14;
    }

    goto LABEL_13;
  }

  v23 = v9;
  v18 = [PLPhotoEditPersistenceManager validateAdjustmentData:v12 formatIdentifier:v15 formatVersion:v13 error:&v23];
  v22 = v23;

  v9 = v22;
  if (a4)
  {
LABEL_13:
    v19 = v9;
    *a4 = v9;
  }

LABEL_14:
  if (a3)
  {
    v20 = v10;
    *a3 = v10;
  }

  return v18;
}

- (id)_generateDeferredAdjustmentWithImageConversionClient:(id)a3 videoConversionClient:(id)a4 reason:(id)a5 retryNumber:(unint64_t)a6 allowCancellationByService:(BOOL)a7 clientBundleID:(id)a8 completion:(id)a9
{
  v10 = a7;
  v135[3] = *MEMORY[0x1E69E9840];
  v80 = a3;
  v81 = a4;
  v90 = a5;
  v83 = a8;
  v91 = a9;
  v85 = [(PLManagedAsset *)self deferredProcessingHash];
  v14 = MEMORY[0x1E696AEC0];
  v15 = [(PLManagedAsset *)self uuid];
  v92 = [v14 stringWithFormat:@"uuid: %@, initial hash: %tu", v15, v85];

  v16 = PLPhotoEditGetLog();
  v17 = os_signpost_id_generate(v16);
  v18 = v16;
  v19 = v18;
  spid = v17;
  if (v17 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v18))
  {
    v20 = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    *&buf[4] = v20;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v19, OS_SIGNPOST_INTERVAL_BEGIN, v17, "generateDeferredAdjustment", "uuid: %{public}@", buf, 0xCu);
  }

  v82 = v19;

  v21 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    *buf = 138543362;
    *&buf[4] = v92;
    _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_INFO, "[%{public}@] Generating deferred adjustment", buf, 0xCu);
  }

  v127 = 0;
  v128 = 0;
  v22 = [(PLManagedAsset *)self renderableAdjustmentDictionary:&v128 error:&v127];
  v23 = v128;
  v89 = v127;
  v88 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
  v87 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
  v86 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
  if (!v22)
  {
    v26 = v89;
    if (v89)
    {
      v132 = *MEMORY[0x1E696AA08];
      v133 = v89;
      v27 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v133 forKeys:&v132 count:1];
      v26 = v89;
      v28 = v27;
    }

    else
    {
      v28 = 0;
    }

    v29 = v26 == 0;
    v84 = v28;
    v30 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:47016 userInfo:?];
    v31 = PLPhotoEditGetLog();
    v32 = os_log_type_enabled(v31, OS_LOG_TYPE_ERROR);
    if (v29)
    {
      if (v32)
      {
        v70 = @"no";
        *buf = 138544386;
        *&buf[4] = v92;
        if (!v88)
        {
          v70 = @"yes";
        }

        *&buf[12] = 2114;
        *&buf[14] = v70;
        *&buf[22] = 2114;
        v130 = v86;
        *v131 = 2114;
        *&v131[2] = v87;
        *&v131[10] = 2112;
        *&v131[12] = v30;
        v33 = "[%{public}@] Unknown error, missing adjustmentDataBlob: %{public}@, formatIdentifier: %{public}@, formatVersion: %{public}@, for async edit: %@";
        v34 = v31;
        v35 = 52;
        goto LABEL_31;
      }
    }

    else if (v32)
    {
      *buf = 138543618;
      *&buf[4] = v92;
      *&buf[12] = 2112;
      *&buf[14] = v30;
      v33 = "[%{public}@] Unable to use adjustment data for async edit: %@";
      v34 = v31;
      v35 = 22;
LABEL_31:
      _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_ERROR, v33, buf, v35);
    }

    v71 = [(PLManagedObject *)self photoLibrary];
    v96[0] = MEMORY[0x1E69E9820];
    v96[1] = 3221225472;
    v96[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1273;
    v96[3] = &unk_1E75781E8;
    v96[4] = self;
    v93[0] = MEMORY[0x1E69E9820];
    v93[1] = 3221225472;
    v93[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2_1274;
    v93[3] = &unk_1E7577C08;
    v94 = v30;
    v95 = v91;
    v57 = v30;
    [v71 performTransaction:v96 completionHandler:v93];

    v68 = 0;
    goto LABEL_36;
  }

  v24 = [v23 objectForKeyedSubscript:*MEMORY[0x1E69BF368]];
  v84 = v24;
  if (v24)
  {
    v25 = [v24 integerValue];
  }

  else
  {
    v25 = 0;
  }

  v36 = [MEMORY[0x1E695DF90] dictionary];
  [v36 setObject:v90 forKeyedSubscript:*MEMORY[0x1E69AE980]];
  if (v10)
  {
    v37 = 3;
  }

  else
  {
    v37 = 4;
  }

  v38 = [MEMORY[0x1E696AD98] numberWithInteger:v37];
  [v36 setObject:v38 forKeyedSubscript:*MEMORY[0x1E69AE950]];

  v39 = *MEMORY[0x1E69AE8D0];
  v134[0] = *MEMORY[0x1E69AE8C8];
  v134[1] = v39;
  v135[0] = v88;
  v135[1] = v86;
  v134[2] = *MEMORY[0x1E69AE8D8];
  v135[2] = v87;
  v40 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v135 forKeys:v134 count:3];
  [v36 setObject:v40 forKeyedSubscript:*MEMORY[0x1E69AE918]];

  v79 = objc_opt_new();
  v41 = objc_opt_new();
  [(PLManagedAsset *)self _setupMediaConversionSourceURLCollection:v79 destinationURLCollection:v41 baseVersion:v25];
  v42 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v42, OS_LOG_TYPE_DEBUG))
  {
    v43 = [v79 urlCount];
    v44 = [v41 urlCount];
    *buf = 138543874;
    *&buf[4] = v92;
    *&buf[12] = 2048;
    *&buf[14] = v43;
    *&buf[22] = 2048;
    v130 = v44;
    _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment with number of source URLs: %ld destination URLs: %ld", buf, 0x20u);
  }

  v45 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
  {
    v46 = [v79 resourceURLForRole:*MEMORY[0x1E69AE8B8]];
    *buf = 138543618;
    *&buf[4] = v92;
    *&buf[12] = 2112;
    *&buf[14] = v46;
    _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEBUG, "[%{public}@] Main source URL: %@", buf, 0x16u);
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke;
  aBlock[3] = &unk_1E7576FF8;
  v47 = v91;
  v126 = v47;
  v78 = v41;
  v125 = v78;
  v48 = _Block_copy(aBlock);
  v49 = [(PLManagedAsset *)self objectID];
  v50 = [(PLManagedObject *)self photoLibrary];
  v51 = [v50 pathManager];
  v52 = [v51 capabilities];

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v130 = __Block_byref_object_copy__14821;
  *v131 = __Block_byref_object_dispose__14822;
  *&v131[8] = [MEMORY[0x1E695DF00] now];
  v53 = [(PLManagedObject *)self photoLibrary];
  v54 = [v53 shortLivedLibraryCopyByAppendingName:"-[PLManagedAsset _generateDeferredAdjustmentWithImageConversionClient:videoConversionClient:reason:retryNumber:allowCancellationByService:clientBundleID:completion:]"];

  v123[0] = 0;
  v123[1] = v123;
  v123[2] = 0x2020000000;
  [MEMORY[0x1E695DF00] timeIntervalSinceReferenceDate];
  v123[3] = v55;
  v106[0] = MEMORY[0x1E69E9820];
  v106[1] = 3221225472;
  v106[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2;
  v106[3] = &unk_1E75679E8;
  v107 = v19;
  v121 = spid;
  v56 = v54;
  v108 = v56;
  v109 = v92;
  v74 = v49;
  v110 = v74;
  spida = v52;
  v111 = spida;
  v119 = buf;
  v57 = v36;
  v112 = v57;
  v120 = v123;
  v113 = v83;
  v122 = a6;
  v58 = v80;
  v114 = v58;
  v59 = v81;
  v115 = v59;
  v116 = v90;
  v117 = v47;
  v60 = v48;
  v118 = v60;
  v61 = _Block_copy(v106);
  v62 = [(PLManagedAsset *)self isPhoto];
  v63 = *MEMORY[0x1E69AE8B8];
  if (v62)
  {
    v64 = [v78 resourceURLForRole:v63];
    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v65 = [v78 resourceURLForRole:*MEMORY[0x1E69AE8C0]];
    }

    else
    {
      v65 = 0;
    }

    [v57 setObject:&unk_1F0FBB308 forKeyedSubscript:*MEMORY[0x1E69AE990]];
    v72 = [MEMORY[0x1E69C06C0] standardPolicy];
    [v57 setObject:v72 forKeyedSubscript:*MEMORY[0x1E69AE968]];

    [v57 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*MEMORY[0x1E69AE920]];
    v101[0] = MEMORY[0x1E69E9820];
    v101[1] = 3221225472;
    v101[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1264;
    v101[3] = &unk_1E7567A10;
    v104 = v61;
    v67 = v64;
    v102 = v67;
    v69 = v65;
    v103 = v69;
    v105 = v85;
    [v58 convertImageAtSourceURLCollection:v79 toDestinationURLCollection:v78 options:v57 completionHandler:v101];

    v68 = 0;
  }

  else
  {
    v66 = [v78 resourceURLForRole:v63];
    v97[0] = MEMORY[0x1E69E9820];
    v97[1] = 3221225472;
    v97[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2_1266;
    v97[3] = &unk_1E7567A38;
    v99 = v61;
    v67 = v66;
    v98 = v67;
    v100 = v85;
    v68 = [v59 convertVideoAtSourceURLCollection:v79 toDestinationURLCollection:v78 options:v57 completionHandler:v97];

    v69 = v99;
  }

  _Block_object_dispose(v123, 8);
  _Block_object_dispose(buf, 8);

LABEL_36:

  return v68;
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_2(uint64_t a1, int a2, void *a3, void *a4, uint64_t a5, uint64_t a6, void *a7, void *a8)
{
  v168[1] = *MEMORY[0x1E69E9840];
  v13 = a3;
  v14 = a4;
  v88 = a7;
  v90 = a8;
  v15 = *(a1 + 32);
  v16 = v15;
  v17 = *(a1 + 144);
  if (v17 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v15))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v16, OS_SIGNPOST_INTERVAL_END, v17, "generateDeferredAdjustment", "", buf, 2u);
  }

  v144 = 0;
  v145 = &v144;
  v146 = 0x2020000000;
  v147 = 0;
  v140 = 0;
  v141 = &v140;
  v142 = 0x2020000000;
  v143 = 0;
  *buf = 0;
  v135 = buf;
  v136 = 0x3032000000;
  v137 = __Block_byref_object_copy__14821;
  v138 = __Block_byref_object_dispose__14822;
  v139 = 0;
  if (a6 == 1)
  {
    goto LABEL_13;
  }

  if (PAMediaConversionIsCancellationError())
  {
    v145[3] = 1;
    v18 = MEMORY[0x1E696ABC0];
    v167 = *MEMORY[0x1E696AA08];
    v168[0] = v90;
    v19 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v168 forKeys:&v167 count:1];
    v20 = [v18 errorWithDomain:*MEMORY[0x1E69BFF48] code:47002 userInfo:v19];
LABEL_9:
    v23 = *(v135 + 5);
    *(v135 + 5) = v20;
    goto LABEL_11;
  }

  v21 = MEMORY[0x19EAEE3C0](v90);
  v145[3] = 2;
  if (v21)
  {
    v22 = MEMORY[0x1E696ABC0];
    v165 = *MEMORY[0x1E696AA08];
    v166 = v90;
    v19 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v166 forKeys:&v165 count:1];
    v20 = [v22 errorWithDomain:*MEMORY[0x1E69BFF48] code:47021 userInfo:v19];
    goto LABEL_9;
  }

  v19 = [MEMORY[0x1E696AEC0] stringWithFormat:@"media conversion failed with status: %ld", a6];
  v24 = MEMORY[0x1E696ABC0];
  v25 = *MEMORY[0x1E696AA08];
  v163[0] = *MEMORY[0x1E696A278];
  v163[1] = v25;
  v164[0] = v19;
  v164[1] = v90;
  v23 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v164 forKeys:v163 count:2];
  v26 = [v24 errorWithDomain:*MEMORY[0x1E69BFF48] code:47007 userInfo:v23];
  v27 = *(v135 + 5);
  *(v135 + 5) = v26;

LABEL_11:
  if (v145[3])
  {
    v28 = 0;
    goto LABEL_27;
  }

LABEL_13:
  if (a2)
  {
    v29 = v13;
  }

  else
  {
    v29 = v14;
  }

  v30 = v29;
  v31 = objc_alloc(MEMORY[0x1E69C0718]);
  v32 = [*(a1 + 40) libraryBundle];
  v33 = [v32 timeZoneLookup];
  v28 = [v31 initWithMediaURL:v30 options:12 timeZoneLookup:v33 shouldCache:0];

  if (!v28)
  {
    v145[3] = 3;
    v34 = MEMORY[0x1E696AEC0];
    v35 = [v30 path];
    v36 = [v34 stringWithFormat:@"unable to load metadata from file at path: %@", v35];

    v37 = MEMORY[0x1E696ABC0];
    v161 = *MEMORY[0x1E696A278];
    v162 = v36;
    v38 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v162 forKeys:&v161 count:1];
    v39 = [v37 errorWithDomain:*MEMORY[0x1E69BFF48] code:47007 userInfo:v38];
    v40 = *(v135 + 5);
    *(v135 + 5) = v39;
  }

  if (!v145[3] && a2)
  {
    v41 = [v28 contentType];
    if (v41)
    {
      v42 = v41;
      if ([v41 conformsToType:*MEMORY[0x1E6982E58]] & 1) != 0 || (objc_msgSend(v42, "conformsToType:", *MEMORY[0x1E6982E00]))
      {
        v43 = v42;
LABEL_26:

        goto LABEL_27;
      }

      v44 = [v42 conformsToType:*MEMORY[0x1E6982E10]];

      if (v44)
      {
        goto LABEL_27;
      }
    }

    v145[3] = 3;
    v45 = MEMORY[0x1E696AEC0];
    v46 = [v28 contentType];
    v47 = [v46 identifier];
    v43 = [v45 stringWithFormat:@"rendered image type (%@) is not primary format", v47];

    v48 = MEMORY[0x1E696ABC0];
    v159 = *MEMORY[0x1E696A278];
    v160 = v43;
    v42 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v160 forKeys:&v159 count:1];
    v49 = [v48 errorWithDomain:*MEMORY[0x1E69BFF48] code:47007 userInfo:v42];
    v50 = *(v135 + 5);
    *(v135 + 5) = v49;

    goto LABEL_26;
  }

LABEL_27:
  v51 = [*(a1 + 40) managedObjectContext];
  v130 = 0;
  v131 = &v130;
  v132 = 0x2020000000;
  v133 = 0;
  v52 = v145[3];
  if (!v52)
  {
    v53 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
    {
      v54 = *(a1 + 48);
      LODWORD(v156) = 138543362;
      *(&v156 + 4) = v54;
      _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_DEBUG, "[%{public}@] Media conversion success for deferred adjustment", &v156, 0xCu);
    }

    v55 = *(a1 + 40);
    v115[0] = MEMORY[0x1E69E9820];
    v115[1] = 3221225472;
    v115[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1223;
    v115[3] = &unk_1E7567998;
    v116 = v51;
    v56 = *(a1 + 56);
    v124 = &v144;
    v57 = *(a1 + 48);
    v125 = &v130;
    v129 = a5;
    v58 = *(a1 + 40);
    v59 = *(a1 + 64);
    *&v60 = v58;
    *(&v60 + 1) = v59;
    *&v61 = v56;
    *(&v61 + 1) = v57;
    v117 = v61;
    v118 = v60;
    v119 = v13;
    v120 = v14;
    v126 = buf;
    v127 = *(a1 + 128);
    v62 = *(a1 + 72);
    v63 = *(a1 + 136);
    v121 = v62;
    v128 = v63;
    v122 = v90;
    v123 = *(a1 + 80);
    [v55 performBlockAndWait:v115];

    v52 = v145[3];
  }

  *&v156 = 0;
  *(&v156 + 1) = &v156;
  v157 = 0x2020000000;
  v158 = 0;
  if (v52 <= 4)
  {
    if (v52 > 1)
    {
      if ((v52 - 2) >= 2)
      {
        if (v52 != 4)
        {
          goto LABEL_56;
        }

        v64 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v64, OS_LOG_TYPE_DEBUG))
        {
          v65 = *(a1 + 48);
          *v150 = 138543362;
          v151 = v65;
          _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished but asset has been deleted, dropping renders", v150, 0xCu);
        }

        goto LABEL_55;
      }

      goto LABEL_40;
    }

    if (v52)
    {
      if (v52 == 1)
      {
        v72 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
        {
          v73 = *(a1 + 48);
          *v150 = 138543874;
          v151 = v73;
          v152 = 2048;
          v153 = a6;
          v154 = 2112;
          v155 = v90;
          _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_INFO, "[%{public}@] Media conversion cancelled adjustment, status: %ld, error: %@", v150, 0x20u);
        }

        v110[0] = MEMORY[0x1E69E9820];
        v110[1] = 3221225472;
        v110[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1245;
        v110[3] = &unk_1E75778C0;
        v111 = v51;
        v112 = *(a1 + 56);
        v74 = *(a1 + 48);
        v75 = *(a1 + 128);
        v113 = v74;
        v114 = v75;
        [v111 performBlockAndWait:v110];
      }

      goto LABEL_56;
    }

    goto LABEL_53;
  }

  if (v52 > 6)
  {
    if ((v52 - 7) < 2)
    {
LABEL_40:
      v66 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
      {
        v67 = *(a1 + 48);
        v68 = *(v135 + 5);
        *v150 = 138543618;
        v151 = v67;
        v152 = 2112;
        v153 = v68;
        _os_log_impl(&dword_19BF1F000, v66, OS_LOG_TYPE_ERROR, "[%{public}@] Failed to generate deferred adjustment with error: %@", v150, 0x16u);
      }

      v69 = *(a1 + 40);
      v91[0] = MEMORY[0x1E69E9820];
      v91[1] = 3221225472;
      v91[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1250;
      v91[3] = &unk_1E7576B70;
      v92 = v51;
      v93 = *(a1 + 56);
      v70 = *(a1 + 48);
      v71 = *(a1 + 128);
      v94 = v70;
      v95 = v71;
      v96 = a5;
      [v69 performBlockAndWait:v91];

      goto LABEL_56;
    }

    if (v52 != 9)
    {
      goto LABEL_56;
    }

LABEL_53:
    v64 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v64, OS_LOG_TYPE_DEBUG))
    {
      v78 = *(a1 + 48);
      *v150 = 138543362;
      v151 = v78;
      _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment succeeded", v150, 0xCu);
    }

LABEL_55:

    *(v141 + 24) = 1;
    goto LABEL_56;
  }

  if (v52 != 5)
  {
    v64 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v64, OS_LOG_TYPE_DEBUG))
    {
      v76 = *(a1 + 48);
      v77 = v131[3];
      *v150 = 138543618;
      v151 = v76;
      v152 = 2048;
      v153 = v77;
      _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished with stale request (new hash = %tu) but deferred processing state no longer needs adjustment, dropping renders and not restarting", v150, 0x16u);
    }

    goto LABEL_55;
  }

  if (*(a1 + 152) > 2uLL)
  {
    v81 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v81, OS_LOG_TYPE_ERROR))
    {
      v82 = *(a1 + 48);
      *v150 = 138543362;
      v151 = v82;
      _os_log_impl(&dword_19BF1F000, v81, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment reached max stale retry count, bailing out", v150, 0xCu);
    }

    v83 = MEMORY[0x1E696ABC0];
    v148 = *MEMORY[0x1E696A578];
    v149 = @"Generate deferred adjustment reached max stale retry count, bailing out";
    v84 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v149 forKeys:&v148 count:1];
    v85 = [v83 errorWithDomain:*MEMORY[0x1E69BFF48] code:46512 userInfo:v84];
    v86 = *(v135 + 5);
    *(v135 + 5) = v85;
  }

  else
  {
    v97[0] = MEMORY[0x1E69E9820];
    v97[1] = 3221225472;
    v97[2] = __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1246;
    v97[3] = &unk_1E75679C0;
    v98 = v51;
    v99 = *(a1 + 56);
    v106 = &v156;
    v100 = *(a1 + 48);
    v107 = &v130;
    v101 = *(a1 + 88);
    v102 = *(a1 + 96);
    v79 = *(a1 + 104);
    v80 = *(a1 + 152);
    v103 = v79;
    v109 = v80;
    v104 = *(a1 + 80);
    v105 = *(a1 + 112);
    v108 = &v140;
    [v98 performBlockAndWait:v97];
  }

LABEL_56:
  if ((*(*(&v156 + 1) + 24) & 1) == 0)
  {
    (*(*(a1 + 120) + 16))();
  }

  _Block_object_dispose(&v156, 8);
  _Block_object_dispose(&v130, 8);

  _Block_object_dispose(buf, 8);
  _Block_object_dispose(&v140, 8);
  _Block_object_dispose(&v144, 8);
}

uint64_t __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1273(uint64_t a1)
{
  if ([*(a1 + 32) deferredProcessingNeeded] == 2 || (result = objc_msgSend(*(a1 + 32), "deferredProcessingNeeded"), result == 9))
  {
    v3 = *(a1 + 32);

    return [v3 setDeferredProcessingNeeded:0];
  }

  return result;
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1223(uint64_t a1)
{
  v65 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v58 = 0;
  v4 = [v2 existingObjectWithID:v3 error:&v58];
  v5 = v58;
  if (!*(*(*(a1 + 112) + 8) + 24))
  {
    if (v4)
    {
      if (![v4 isDeleted])
      {
        goto LABEL_9;
      }
    }

    else
    {
      v6 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        v8 = *(a1 + 40);
        v7 = *(a1 + 48);
        *buf = 138543874;
        v60 = v7;
        v61 = 2112;
        v62 = v8;
        v63 = 2112;
        v64 = v5;
        _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "[%{public}@] Asset with object ID %@ not found: %@", buf, 0x20u);
      }
    }

    *(*(*(a1 + 112) + 8) + 24) = 4;
  }

LABEL_9:
  if (!*(*(*(a1 + 112) + 8) + 24))
  {
    v9 = [v4 additionalAttributes];
    [v9 setDeferredProcessingCandidateOptions:0];

    if (!*(*(*(a1 + 112) + 8) + 24))
    {
      *(*(*(a1 + 120) + 8) + 24) = [v4 deferredProcessingHash];
      if (*(a1 + 152) != *(*(*(a1 + 120) + 8) + 24))
      {
        v10 = [v4 deferredProcessingNeeded];
        v11 = 5;
        if (v10 != 2)
        {
          v11 = 6;
        }

        *(*(*(a1 + 112) + 8) + 24) = v11;
      }
    }
  }

  if (*(*(*(a1 + 112) + 8) + 24) || ![v4 isVideo])
  {
    v16 = 0;
  }

  else
  {
    v12 = [v4 persistedResourcesMatching:&__block_literal_global_1226];
    v13 = [v12 anyObject];

    if (v13)
    {
      v14 = [*(a1 + 56) pathManager];
      v15 = [MEMORY[0x1E69BF178] defaultFileExtensionForAssetType:0];
      v16 = [v14 temporaryRenderContentURLForInternalRendersWithExtension:v15];

      v17 = MEMORY[0x1E695DFF8];
      v18 = [v4 pathForTransientVideoPosterFramePreview];
      v19 = [v17 fileURLWithPath:v18];

      v20 = *(a1 + 64);
      v57 = 0;
      v21 = [MEMORY[0x1E69BF238] ingestItemAtURL:v19 toURL:v16 type:3 options:6 capabilities:v20 error:&v57];
      v22 = v57;
      if ((v21 & 1) == 0)
      {
        v23 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
        {
          v24 = *(a1 + 48);
          *buf = 138543874;
          v60 = v24;
          v61 = 2112;
          v62 = v19;
          v63 = 2112;
          v64 = v22;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_ERROR, "[%{public}@] Nonfatal - failed to ingest video poster to temporary URL from existing URL: %@, error: %@", buf, 0x20u);
        }

        v16 = 0;
      }
    }

    else
    {
      v16 = 0;
    }
  }

  v25 = *(a1 + 112);
  if (!*(*(v25 + 8) + 24))
  {
    v26 = *(a1 + 72);
    v27 = *(a1 + 80);
    v28 = *(*(a1 + 128) + 8);
    obj = *(v28 + 40);
    v29 = [v4 updateDeferredAdjustmentWithFullSizeRenderImageURL:v26 videoURL:v27 videoPosterURL:v16 error:&obj];
    objc_storeStrong((v28 + 40), obj);
    v25 = *(a1 + 112);
    if ((v29 & 1) == 0)
    {
      *(*(v25 + 8) + 24) = 7;
      v25 = *(a1 + 112);
    }
  }

  if (*(*(v25 + 8) + 24))
  {
    goto LABEL_28;
  }

  if ([v4 isPhoto])
  {
    v31 = &__block_literal_global_1229;
  }

  else
  {
    if (![v4 isVideo])
    {
LABEL_28:
      v30 = 0;
      goto LABEL_34;
    }

    v31 = &__block_literal_global_1232;
  }

  v32 = [v4 persistedResourcesMatching:v31];
  v30 = [v32 anyObject];

LABEL_34:
  if ([*(a1 + 32) hasChanges])
  {
    v33 = *(a1 + 32);
    if (*(*(*(a1 + 112) + 8) + 24))
    {
      [v33 rollback];
    }

    else
    {
      v34 = *(*(a1 + 128) + 8);
      v55 = *(v34 + 40);
      v35 = [v33 save:&v55];
      objc_storeStrong((v34 + 40), v55);
      if ((v35 & 1) == 0)
      {
        v36 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          v37 = *(a1 + 48);
          v38 = *(*(*(a1 + 128) + 8) + 40);
          *buf = 138543618;
          v60 = v37;
          v61 = 2112;
          v62 = v38;
          _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment save failed %@", buf, 0x16u);
        }

        *(*(*(a1 + 112) + 8) + 24) = 8;
      }
    }
  }

  v39 = *(*(a1 + 112) + 8);
  v40 = *(v39 + 24);
  if (!v40)
  {
    *(v39 + 24) = 9;
    v40 = *(*(*(a1 + 112) + 8) + 24);
  }

  if (v40 == 9)
  {
    v41 = 1;
  }

  else
  {
    v41 = 3;
  }

  PLSendDeferredProcessingAnalytics(v4, v30, *(*(*(a1 + 136) + 8) + 40), v41);
  v42 = [*(a1 + 88) objectForKeyedSubscript:*MEMORY[0x1E69AE950]];
  [v42 integerValue];
  IsBackground = PAMediaConversionJobPriorityIsBackground();

  if (IsBackground)
  {
    v44 = @"BG";
  }

  else
  {
    v44 = @"IN";
  }

  v45 = @"Tail";
  if (!IsBackground)
  {
    v45 = @"Head";
  }

  v46 = MEMORY[0x1E695DF00];
  v47 = v45;
  v48 = v44;
  [v46 timeIntervalSinceReferenceDate];
  v50 = v49 - *(*(*(a1 + 144) + 8) + 24);
  [MEMORY[0x1E695DF00] timeIntervalSinceReferenceDate];
  v52 = v51;
  v53 = [v4 addedDate];
  [v53 timeIntervalSinceReferenceDate];
  PLBuildAndSendFinalizationAnalytics(v4, *(a1 + 96), 1, v48, v47, *(a1 + 104), v50, v52 - v54);
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1245(void *a1)
{
  v16 = *MEMORY[0x1E69E9840];
  v2 = a1[4];
  v3 = a1[5];
  v9 = 0;
  v4 = [v2 existingObjectWithID:v3 error:&v9];
  v5 = v9;
  if (v4)
  {
    PLSendDeferredProcessingAnalytics(v4, 0, *(*(a1[7] + 8) + 40), 2);
  }

  else
  {
    v6 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = a1[5];
      v7 = a1[6];
      *buf = 138543874;
      v11 = v7;
      v12 = 2112;
      v13 = v8;
      v14 = 2112;
      v15 = v5;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "[%{public}@] Asset with object ID %@ not found: %@", buf, 0x20u);
    }
  }
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1246(uint64_t a1)
{
  v15 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) existingObjectWithID:*(a1 + 40) error:0];
  v3 = v2;
  if (v2 && ([v2 isDeleted] & 1) == 0)
  {
    *(*(*(a1 + 96) + 8) + 24) = 1;
    v7 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      v8 = *(a1 + 48);
      v9 = *(*(*(a1 + 104) + 8) + 24);
      *buf = 138543618;
      v12 = v8;
      v13 = 2048;
      v14 = v9;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished but edit is stale with new hash: %tu, restarting", buf, 0x16u);
    }

    v10 = [v3 _generateDeferredAdjustmentWithImageConversionClient:*(a1 + 56) videoConversionClient:*(a1 + 64) reason:*(a1 + 72) retryNumber:*(a1 + 120) + 1 allowCancellationByService:0 clientBundleID:*(a1 + 80) completion:*(a1 + 88)];
  }

  else
  {
    v4 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_DEBUG))
    {
      v5 = *(a1 + 48);
      v6 = *(*(*(a1 + 104) + 8) + 24);
      *buf = 138543618;
      v12 = v5;
      v13 = 2048;
      v14 = v6;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEBUG, "[%{public}@] Deferred adjustment finished with stale request (new hash = %tu) but asset was deleted, dropping renders and not restarting", buf, 0x16u);
    }

    *(*(*(a1 + 112) + 8) + 24) = 1;
  }
}

void __165__PLManagedAsset__generateDeferredAdjustmentWithImageConversionClient_videoConversionClient_reason_retryNumber_allowCancellationByService_clientBundleID_completion___block_invoke_1250(uint64_t a1)
{
  v36 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v29 = 0;
  v4 = [v2 existingObjectWithID:v3 error:&v29];
  v5 = v29;
  if (v4)
  {
    v6 = [v4 isDeleted];
    v7 = [v4 deferredProcessingHash];
    if ((v6 & 1) == 0)
    {
      v8 = 1;
      if (*(a1 + 64) != v7)
      {
LABEL_15:
        v16 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v17 = *(a1 + 48);
          if (v6)
          {
            v18 = 0;
            v19 = @"asset deleted";
          }

          else if (v8)
          {
            v18 = 0;
            v19 = @"stale";
          }

          else
          {
            v20 = MEMORY[0x1E696AEC0];
            v21 = [v4 deferredProcessingNeeded];
            v22 = v21 > 0xA ? 0 : off_1E7567B18[v21];
            v6 = v22;
            v19 = [v20 stringWithFormat:@"cannot overwrite deferred processing state: %@", v6];
            v18 = 1;
          }

          *buf = 138543618;
          v31 = v17;
          v32 = 2114;
          v33 = v19;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment failed, skipping repair for reason: %{public}@", buf, 0x16u);
          if (v18)
          {
          }
        }

LABEL_27:
        if ([*(a1 + 32) hasChanges])
        {
          v23 = *(a1 + 32);
          v28 = 0;
          v24 = [v23 save:&v28];
          v25 = v28;
          if ((v24 & 1) == 0)
          {
            v26 = PLPhotoEditGetLog();
            if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
            {
              v27 = *(a1 + 48);
              *buf = 138543618;
              v31 = v27;
              v32 = 2112;
              v33 = v25;
              _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment save failed %@", buf, 0x16u);
            }
          }
        }

        PLSendDeferredProcessingAnalytics(v4, 0, *(*(*(a1 + 56) + 8) + 40), 3);
        goto LABEL_34;
      }

      v12 = [v4 deferredProcessingNeeded];
      if (v12 <= 9 && ((1 << v12) & 0x315) != 0)
      {
        v14 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
        {
          v15 = *(a1 + 48);
          *buf = 138543362;
          v31 = v15;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment failed, marking asset for repair adjustment failure", buf, 0xCu);
        }

        [v4 setDeferredProcessingNeeded:9];
        goto LABEL_27;
      }
    }

    v8 = 0;
    goto LABEL_15;
  }

  v9 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
  {
    v11 = *(a1 + 40);
    v10 = *(a1 + 48);
    *buf = 138543874;
    v31 = v10;
    v32 = 2112;
    v33 = v11;
    v34 = 2112;
    v35 = v5;
    _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "[%{public}@] Deferred adjustment failed, skipping repair, asset with object ID %@ not found: %@", buf, 0x20u);
  }

LABEL_34:
}

- (void)_setupMediaConversionSourceURLCollection:(id)a3 destinationURLCollection:(id)a4 baseVersion:(int64_t)a5
{
  v30 = a3;
  v8 = a4;
  v9 = [(PLManagedAsset *)self _sourceURLForAsyncEditWithBaseVersion:a5];
  v10 = *MEMORY[0x1E69AE8B8];
  [v30 setResourceURL:v9 forRole:*MEMORY[0x1E69AE8B8]];
  if ([(PLManagedAsset *)self isPhoto])
  {
    v11 = [(PLManagedAsset *)self fileTypeForFullsizeRenderImage];
    v12 = MEMORY[0x1E69C08F0];
    v13 = [MEMORY[0x1E6982C40] typeWithIdentifier:v11];
    v14 = [v12 preferredOrFallbackFilenameExtensionForType:v13];

    v15 = [(PLManagedObject *)self pathManager];
    v16 = [v15 temporaryRenderContentURLForInternalRendersWithExtension:v14];

    [v8 setResourceURL:v16 forRole:v10 deleteOnDeallocation:1];
    if ([(PLManagedAsset *)self _shouldSetupVideoComplementForAsyncEditWithBaseVersion:a5])
    {
      v29 = v8;
      if (a5)
      {
        [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
      }

      else
      {
        [(PLManagedAsset *)self pathForVideoComplementFile];
      }
      v28 = ;
      v19 = [MEMORY[0x1E695DFF8] fileURLWithPath:v28 isDirectory:0];
      v20 = *MEMORY[0x1E69AE8C0];
      [v30 setResourceURL:v19 forRole:*MEMORY[0x1E69AE8C0]];
      v21 = [(PLManagedObject *)self pathManager];
      v22 = [MEMORY[0x1E69BF178] defaultFileExtensionForAssetType:1];
      v23 = [v21 temporaryRenderContentURLForInternalRendersWithExtension:v22];

      v8 = v29;
      [v29 setResourceURL:v23 forRole:v20 deleteOnDeallocation:1];
    }

    goto LABEL_10;
  }

  if ([(PLManagedAsset *)self isVideo])
  {
    v17 = [(PLManagedObject *)self pathManager];
    v18 = [MEMORY[0x1E69BF178] defaultFileExtensionForAssetType:1];
    v11 = [v17 temporaryRenderContentURLForInternalRendersWithExtension:v18];

    [v8 setResourceURL:v11 forRole:v10 deleteOnDeallocation:1];
LABEL_10:
  }

  v24 = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
  if (v24)
  {
    v25 = [MEMORY[0x1E696AC08] defaultManager];
    v26 = [v25 fileExistsAtPath:v24];

    if (v26)
    {
      v27 = [MEMORY[0x1E695DFF8] fileURLWithPath:v24];
      [v30 setResourceURL:v27 forRole:*MEMORY[0x1E69AE8B0]];
    }
  }
}

- (unint64_t)deferredProcessingHash
{
  v3 = [(PLManagedAsset *)self adjustmentTimestamp];
  v4 = [v3 hash];
  v5 = [MEMORY[0x1E696AD98] numberWithUnsignedShort:{-[PLManagedAsset deferredProcessingNeeded](self, "deferredProcessingNeeded")}];
  v6 = [v5 hash];

  return v6 ^ v4;
}

- (BOOL)_shouldSetupVideoComplementForAsyncEditWithBaseVersion:(int64_t)a3
{
  v5 = [(PLManagedAsset *)self isPhotoIris];
  v6 = v5;
  if (a3 && v5)
  {
    v6 = [(PLManagedAsset *)self canPlayPhotoIris];
  }

  if (a3 == 1 && v6)
  {
    v7 = [(PLManagedAsset *)self modernResources];
    v8 = [v7 objectsPassingTest:&__block_literal_global_1207];
    LOBYTE(v6) = [v8 count] != 0;
  }

  return v6;
}

BOOL __73__PLManagedAsset__shouldSetupVideoComplementForAsyncEditWithBaseVersion___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 version] == 1 && objc_msgSend(v2, "resourceType") == 3;

  return v3;
}

- (id)_sourceURLForAsyncEditWithBaseVersion:(int64_t)a3
{
  if (!a3)
  {
    if ([(PLManagedAsset *)self isRAWPlusJPEGWithRAWOnTop])
    {
      [(PLManagedAsset *)self urlForSideCarImageFile];
    }

    else
    {
      [(PLManagedAsset *)self mainFileURL];
    }
    v7 = ;
    goto LABEL_12;
  }

  if ([(PLManagedAsset *)self isPhoto])
  {
    v4 = MEMORY[0x1E695DFF8];
    v5 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
LABEL_8:
    v6 = v5;
    v7 = [v4 fileURLWithPath:v5 isDirectory:0];

    goto LABEL_12;
  }

  if ([(PLManagedAsset *)self isVideo])
  {
    v4 = MEMORY[0x1E695DFF8];
    v5 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    goto LABEL_8;
  }

  v7 = 0;
LABEL_12:

  return v7;
}

- (void)synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:(id)a3 withCompletionHandler:(id)a4
{
  v7 = a3;
  v8 = a4;
  v9 = objc_autoreleasePoolPush();
  if ((PLIsAssetsd() & 1) == 0)
  {
    v14 = [MEMORY[0x1E696AAA8] currentHandler];
    [v14 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:10773 description:@"synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath is only safe from inside of assetsd!"];
  }

  v10 = objc_alloc_init(MEMORY[0x1E696AC08]);
  v11 = [(PLManagedAsset *)self pathForOriginalFile];
  v12 = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
  if (!v7)
  {
    v7 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  }

  if (([v10 fileExistsAtPath:v7] & 1) == 0 && objc_msgSend(v10, "fileExistsAtPath:", v11) && objc_msgSend(v10, "fileExistsAtPath:", v12))
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke;
    v15[3] = &unk_1E7567970;
    v15[4] = self;
    v16 = v11;
    v17 = v7;
    v18 = v10;
    v19 = v12;
    v20 = v8;
    [(PLManagedAsset *)self synchronouslyFetchAdjustmentBlobWithCompletionHandler:v15];
  }

  else
  {
    v13 = [PLResourceInstaller onDemand_installAdjustedFullSizeRenderResourceAtFilePath:v7 forAsset:self];
    if (v8)
    {
      (*(v8 + 2))(v8, v7);
    }
  }

  objc_autoreleasePoolPop(v9);
}

void __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke(uint64_t a1, void *a2, uint64_t a3, void *a4, void *a5, uint64_t a6, uint64_t a7, void *a8, void *a9)
{
  v13 = a2;
  v14 = a4;
  v15 = a5;
  v16 = a8;
  v17 = a9;
  v18 = [v14 isEqualToString:@"com.apple.mobileiphoto"];
  if (v18)
  {
    LOBYTE(v18) = [v15 isEqualToString:@"2"];
  }

  if (!v13 || (v18 & 1) != 0)
  {
    [*(a1 + 56) copyItemAtPath:*(a1 + 64) toPath:*(a1 + 48) error:0];
    v27 = *(a1 + 72);
    if (v27)
    {
      (*(v27 + 16))(v27, *(a1 + 48));
    }
  }

  else
  {
    v28 = v17;
    v29 = v16;
    timeout = dispatch_time(0, 60000000000);
    v31 = [*(a1 + 32) originalOrientation];
    v44 = 0;
    v45 = &v44;
    v46 = 0x2020000000;
    v47 = 0;
    v39 = 0;
    v40 = &v39;
    v41 = 0x3010000000;
    v42 = &unk_19C721442;
    v19 = MEMORY[0x1E695F060];
    v43 = *MEMORY[0x1E695F060];
    v20 = dispatch_group_create();
    dispatch_group_enter(v20);
    v22 = *(a1 + 32);
    v21 = *(a1 + 40);
    v32[0] = MEMORY[0x1E69E9820];
    v32[1] = 3221225472;
    v32[2] = __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke_2;
    v32[3] = &unk_1E7567948;
    v37 = &v44;
    v38 = &v39;
    v23 = *(a1 + 48);
    v33 = *(a1 + 56);
    v34 = *(a1 + 64);
    v35 = *(a1 + 48);
    v24 = v20;
    v36 = v24;
    [v22 _asyncGenerateRenderImageFileWithSize:v14 formatIdentifier:v15 formatVersion:v13 adjustmentDataBlob:v21 originalImageFilePath:v31 originalImageEXIFOrientation:v23 renderedImageFilePath:*v19 completionHandler:{v19[1], v32}];
    dispatch_group_wait(v24, timeout);
    if (*(v45 + 24) == 1)
    {
      [*(a1 + 32) setWidth:v40[4]];
      [*(a1 + 32) setHeight:v40[5]];
      v25 = [PLResourceInstaller onDemand_installAdjustedFullSizeRenderResourceAtFilePath:*(a1 + 48) forAsset:*(a1 + 32)];
    }

    v26 = *(a1 + 72);
    if (v26)
    {
      (*(v26 + 16))(v26, *(a1 + 48));
    }

    _Block_object_dispose(&v39, 8);
    _Block_object_dispose(&v44, 8);
    v17 = v28;
    v16 = v29;
  }
}

void __98__PLManagedAsset_synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath_withCompletionHandler___block_invoke_2(uint64_t a1, uint64_t a2, double a3, double a4)
{
  if (a2)
  {
    *(*(*(a1 + 64) + 8) + 24) = 1;
    v5 = *(*(a1 + 72) + 8);
    *(v5 + 32) = a3;
    *(v5 + 40) = a4;
  }

  else
  {
    [*(a1 + 32) copyItemAtPath:*(a1 + 40) toPath:*(a1 + 48) error:0];
  }

  v6 = *(a1 + 56);

  dispatch_group_leave(v6);
}

- (void)_asyncGenerateRenderImageFileWithSize:(CGSize)a3 formatIdentifier:(id)a4 formatVersion:(id)a5 adjustmentDataBlob:(id)a6 originalImageFilePath:(id)a7 originalImageEXIFOrientation:(int64_t)a8 renderedImageFilePath:(id)a9 completionHandler:(id)a10
{
  v49 = *MEMORY[0x1E69E9840];
  v42 = a7;
  v41 = a9;
  v40 = a10;
  v17 = a6;
  v18 = a5;
  v19 = a4;
  if ((PLIsAssetsd() & 1) == 0)
  {
    v38 = [MEMORY[0x1E696AAA8] currentHandler];
    [v38 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:10742 description:@"_asyncGenerateRenderImageFileWithSize is only safe from inside of assetsd!"];
  }

  v20 = objc_alloc_init(PLPhotoEditPersistenceManager);
  [(PLManagedAsset *)self photoIrisVideoDuration];
  v21 = [PLPhotoEditImportProperties importPropertiesWithEXIFOrientation:a8 duration:CMTimeGetSeconds(&time)];
  v22 = MEMORY[0x1E696AEC0];
  v23 = objc_opt_class();
  v24 = [(PLManagedAsset *)self uuid];
  v25 = [(PLManagedAsset *)self pathForOriginalFile];
  v26 = [v22 stringWithFormat:@"<%@:%p uuid=%@, path=%@>", v23, self, v24, v25];

  v47 = 0;
  v27 = [(PLPhotoEditPersistenceManager *)v20 loadPhotoEditData:v17 formatIdentifier:v19 formatVersion:v18 importProperties:v21 error:&v47];

  v28 = v47;
  if (v27)
  {
    v29 = v42;
    v30 = [MEMORY[0x1E695DFF8] fileURLWithPath:v42 isDirectory:0];
    v31 = [[PLPhotoEditSource alloc] initWithURL:v30 type:0 image:0 useEmbeddedPreview:0];
    v39 = v28;
    v32 = v21;
    v33 = v20;
    v34 = [[PLPhotoEditRenderer alloc] initWithEditSource:v31];
    [(PLPhotoEditRenderer *)v34 setCompositionController:v27];
    v43[0] = MEMORY[0x1E69E9820];
    v43[1] = 3221225472;
    v43[2] = __197__PLManagedAsset__asyncGenerateRenderImageFileWithSize_formatIdentifier_formatVersion_adjustmentDataBlob_originalImageFilePath_originalImageEXIFOrientation_renderedImageFilePath_completionHandler___block_invoke;
    v43[3] = &unk_1E7567920;
    v35 = v41;
    v44 = v41;
    v45 = v26;
    v36 = v40;
    v46 = v40;
    [(PLPhotoEditRenderer *)v34 generateJPEGImageDataWithCompressionQuality:0 livePhotoPairingIdentifier:v43 completionHandler:0.899999976];

    v20 = v33;
    v21 = v32;
    v28 = v39;
  }

  else
  {
    v37 = PLBackendGetLog();
    v35 = v41;
    v29 = v42;
    if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
    {
      LODWORD(time.value) = 138412546;
      *(&time.value + 4) = v26;
      LOWORD(time.flags) = 2112;
      *(&time.flags + 2) = v28;
      _os_log_impl(&dword_19BF1F000, v37, OS_LOG_TYPE_ERROR, "Could not upgrade substandard render for %@ ([PLPhotoEditPersistenceManager loadPhotoEditData:] failed. Error: %@)", &time, 0x16u);
    }

    v36 = v40;
    (*(v40 + 2))(v40, 0, *MEMORY[0x1E695F060], *(MEMORY[0x1E695F060] + 8));
  }
}

uint64_t __197__PLManagedAsset__asyncGenerateRenderImageFileWithSize_formatIdentifier_formatVersion_adjustmentDataBlob_originalImageFilePath_originalImageEXIFOrientation_renderedImageFilePath_completionHandler___block_invoke(void *a1, void *a2, double a3, double a4, double a5, double a6)
{
  v28 = *MEMORY[0x1E69E9840];
  v9 = [a2 writeToFile:a1[4] options:1073741825 error:0];
  v10 = PLBackendGetLog();
  v11 = v10;
  if (v9)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v12 = a1[5];
      v20 = 138412802;
      v21 = v12;
      v22 = 1024;
      v23 = a5;
      v24 = 1024;
      v25 = a6;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEBUG, "Upgraded substandard render for %@ to %dx%d", &v20, 0x18u);
    }

    v13.n128_f64[0] = a5;
    v14.n128_f64[0] = a6;
    return (*(a1[6] + 16))(v13, v14);
  }

  else
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v17 = a1[4];
      v16 = a1[5];
      v20 = 138413058;
      v21 = v16;
      v22 = 1024;
      v23 = a5;
      v24 = 1024;
      v25 = a6;
      v26 = 2112;
      v27 = v17;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "Could not upgrade substandard render for %@ to %dx%d, failed saving to %@", &v20, 0x22u);
    }

    v18.n128_u64[0] = *MEMORY[0x1E695F060];
    v19.n128_u64[0] = *(MEMORY[0x1E695F060] + 8);
    return (*(a1[6] + 16))(v18, v19);
  }
}

- (void)generateLargeThumbnailFileIfNecessary
{
  v13[1] = *MEMORY[0x1E69E9840];
  v3 = objc_autoreleasePoolPush();
  v4 = objc_alloc(MEMORY[0x1E695DEF0]);
  v5 = [(PLManagedAsset *)self pathForOriginalFile];
  v6 = [v4 initWithContentsOfFile:v5 options:8 error:0];

  if ([(__CFData *)v6 length])
  {
    v7 = [(PLManagedAsset *)self uniformTypeIdentifier];
    if (v7)
    {
      v12 = *MEMORY[0x1E696E118];
      v8 = [(PLManagedAsset *)self uniformTypeIdentifier];
      v13[0] = v8;
      v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v13 forKeys:&v12 count:1];
    }

    else
    {
      v9 = 0;
    }

    v10 = CGImageSourceCreateWithData(v6, v9);
    LOBYTE(v11) = 0;
    [(PLManagedAsset *)self generateThumbnailsWithImageSource:v10 imageData:v6 metadata:0 allowMediumPreview:0 forceSRGBConversion:0 forFinalCameraImage:0 outSmallThumbnailData:0 isPreviewSource:v11];
    if (v10)
    {
      CFRelease(v10);
    }
  }

  objc_autoreleasePoolPop(v3);
}

- (NSString)pathForLargeDisplayableImageFile
{
  v5 = 0;
  v2 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:self format:0 allowMetadataSnapshot:0 forceLarge:0 outFilePath:&v5 outImageType:0];
  v3 = v5;

  return v3;
}

- (NSString)pathForVideoFile
{
  if ([(PLManagedAsset *)self isVideo])
  {
    v3 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
    v4 = objc_opt_new();
    v5 = [v4 fileExistsAtPath:v3 isDirectory:0];

    if ((v5 & 1) == 0)
    {
      if ([(PLManagedAsset *)self hasNonSlomoAdjustments])
      {
        v6 = 0;
      }

      else
      {
        v6 = [(PLManagedAsset *)self pathForOriginalFile];
      }

      v3 = v6;
    }
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (NSString)pathForVideoPreviewFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedLargeThumbnailFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedLargeThumbnailFile];
  }
  v3 = ;

  return v3;
}

- (NSString)pathForTrimmedVideoFile
{
  v2 = [(PLManagedAsset *)self pathForVideoFile];
  v3 = v2;
  if (v2)
  {
    v4 = [v2 stringByDeletingPathExtension];
    v5 = [v4 stringByAppendingPathExtension:@"TRIM.MOV"];
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)fileURLForFullsizeRenderImage
{
  v2 = MEMORY[0x1E695DFF8];
  v3 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  v4 = [v2 fileURLWithPath:v3 isDirectory:0];

  return v4;
}

- (id)fileURLForMetadataWithExtension:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self directory];
  if (v5)
  {
    v6 = [(PLManagedObject *)self pathManager];
    v7 = [(PLManagedAsset *)self filename];
    v8 = [v6 URLForMetadataWithExtension:v4 forMediaInMainDirectory:v5 withFilename:v7];
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (id)pathForMetadataWithExtension:(id)a3
{
  v3 = [(PLManagedAsset *)self fileURLForMetadataWithExtension:a3];
  v4 = [v3 path];

  return v4;
}

- (NSString)pathForMetadataDirectory
{
  v3 = [(PLManagedAsset *)self directory];
  if (v3)
  {
    v4 = [(PLManagedAsset *)self shouldUseUBFPathManager];
    v5 = MEMORY[0x1E695DFF8];
    v6 = [(PLManagedObject *)self pathManager];
    v7 = v6;
    if (v4)
    {
      v8 = [v6 photoDirectoryWithType:10];
      v9 = [v8 stringByAppendingPathComponent:v3];
      v10 = [v5 fileURLWithPath:v9 isDirectory:1];
    }

    else
    {
      v8 = [v6 photoMetadataDirectoryForMediaInMainDirectory:v3];
      v10 = [v5 fileURLWithPath:v8 isDirectory:1];
    }
  }

  else
  {
    v10 = 0;
  }

  v11 = [v10 path];

  return v11;
}

- (NSString)fileExtension
{
  v2 = [(PLManagedAsset *)self filename];
  v3 = [v2 pathExtension];

  return v3;
}

- (NSArray)allUniformTypeIdentifiers
{
  v3 = MEMORY[0x1E695DF70];
  v4 = [(PLManagedAsset *)self sidecars];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(v4, "count") + 1}];

  v6 = [(PLManagedAsset *)self uniformTypeIdentifier];
  if (v6)
  {
    v7 = [(PLManagedAsset *)self uniformTypeIdentifier];
    [v5 addObject:v7];
  }

  else
  {
    [v5 addObject:&stru_1F0F06D80];
  }

  v8 = [(PLManagedAsset *)self sidecars];
  v9 = [v8 count];

  if (v9)
  {
    v10 = [(PLManagedAsset *)self sortedSidecarFiles];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __43__PLManagedAsset_allUniformTypeIdentifiers__block_invoke;
    v12[3] = &unk_1E7577F08;
    v13 = v5;
    [v10 enumerateObjectsUsingBlock:v12];
  }

  return v5;
}

void __43__PLManagedAsset_allUniformTypeIdentifiers__block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 uniformTypeIdentifier];
  v5 = v3;
  if (v3)
  {
    v4 = v3;
  }

  else
  {
    v4 = &stru_1F0F06D80;
  }

  [*(a1 + 32) addObject:v4];
}

- (id)allFileExtensions
{
  v3 = MEMORY[0x1E695DF70];
  v4 = [(PLManagedAsset *)self sidecars];
  v5 = [v3 arrayWithCapacity:{objc_msgSend(v4, "count") + 1}];

  v6 = [(PLManagedAsset *)self pathForOriginalFile];
  v7 = [v6 pathExtension];

  if ([v7 length])
  {
    [v5 addObject:v7];
  }

  v8 = [(PLManagedAsset *)self sidecars];
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __35__PLManagedAsset_allFileExtensions__block_invoke;
  v11[3] = &unk_1E75678F8;
  v9 = v5;
  v12 = v9;
  [v8 enumerateObjectsUsingBlock:v11];

  return v9;
}

void __35__PLManagedAsset_allFileExtensions__block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 filename];
  v4 = [v3 pathExtension];

  [*(a1 + 32) addObject:v4];
}

- (void)getFileURL:(id *)a3 originalFilename:(id *)a4 uti:(id *)a5 fileSize:(unint64_t *)a6 forSidecarMatchingUTI:(id)a7 requireExactMatch:(BOOL)a8
{
  v16 = [MEMORY[0x1E69C08F0] typeWithIdentifier:a7];
  v13 = [PLManagedAsset sidecarFileMatchingContentType:"sidecarFileMatchingContentType:requireExactMatch:requireSort:" requireExactMatch:? requireSort:?];
  v14 = v13;
  if (a3)
  {
    *a3 = [v13 fileURL];
  }

  if (a6)
  {
    v15 = [v14 compressedSize];
    *a6 = [v15 unsignedLongLongValue];
  }

  if (a4)
  {
    *a4 = [v14 originalFilename];
  }

  if (a5)
  {
    *a5 = [v14 uniformTypeIdentifier];
  }
}

- (NSString)pathForOriginalFile
{
  v2 = [(PLManagedAsset *)self mainFileURL];
  v3 = [v2 path];

  return v3;
}

- (NSURL)persistedFileSystemAttributesFileURL
{
  if ([(PLManagedAsset *)self hasDeferredProcessingPreviewFile]&& ![(PLManagedAsset *)self hasOriginalFile])
  {
    v3 = [(PLManagedAsset *)self fileURLForCurrentDeferredProcessingPreviewFile];
  }

  else
  {
    v3 = [(PLManagedAsset *)self mainFileURL];
  }

  return v3;
}

- (NSURL)mainFileURL
{
  if (!-[PLManagedAsset isReferencedAsset](self, "isReferencedAsset") || (-[PLManagedAsset masterResourceForCPLType:](self, "masterResourceForCPLType:", 1), v3 = objc_claimAutoreleasedReturnValue(), [v3 fileSystemBookmark], v4 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v4, "fileSystemURL"), v5 = objc_claimAutoreleasedReturnValue(), v4, v3, !v5))
  {
    v5 = [(PLManagedAsset *)self directory];

    if (v5)
    {
      v6 = MEMORY[0x1E695DFF8];
      v7 = [(PLManagedObject *)self pathManager];
      v8 = [(PLManagedAsset *)self directory];
      v9 = [(PLManagedAsset *)self filename];
      v10 = [v7 assetMainFilePathWithDirectory:v8 filename:v9 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
      v5 = [v6 fileURLWithPath:v10 isDirectory:0];
    }
  }

  return v5;
}

- (NSString)pathForComputeSyncMediaAnalysisPayloadFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:3 resourceType:14 recipeID:327691 originalFilename:0 customSuffix:0];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForComputeDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"ComputeSyncMediaAnalysisPayload.dat"];
  }

  return v10;
}

- (NSString)pathForComputeSyncWrapperFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:3 resourceType:14 recipeID:327689 originalFilename:0 customSuffix:0];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForComputeDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"ComputeSyncWrapper.dat"];
  }

  return v10;
}

- (id)pathForAdjustedSmallVideoFile
{
  v3 = [(PLManagedAsset *)self shouldUseUBFPathManager];
  v4 = [(PLManagedAsset *)self isPhotoIris];
  if (v3)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!v4)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    v9 = [(PLManagedAsset *)self uuid];
    v10 = [(PLManagedAsset *)self bundleScope];
    v11 = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131277;
    }

    else
    {
      v12 = 131081;
    }

    v13 = [v8 initWithAssetUuid:v9 bundleScope:v10 uti:v11 resourceVersion:2 recipeID:v12];

    v14 = [(PLManagedObject *)self pathManager];
    v15 = [v14 readOnlyUrlWithIdentifier:v13];
    v16 = [v15 path];
  }

  else
  {
    v17 = @"small.MP4";
    if (v4)
    {
      v17 = @"small.MOV";
    }

    v18 = v17;
    v19 = [(PLManagedAsset *)self filename];
    v20 = [v19 stringByDeletingPathExtension];
    v13 = [v20 stringByAppendingPathExtension:v18];

    v14 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v16 = [v14 stringByAppendingPathComponent:v13];
  }

  return v16;
}

- (id)pathForNonAdjustedSmallVideoFile
{
  v3 = [(PLManagedAsset *)self shouldUseUBFPathManager];
  v4 = [(PLManagedAsset *)self isPhotoIris];
  if (v3)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!v4)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    v9 = [(PLManagedAsset *)self uuid];
    v10 = [(PLManagedAsset *)self bundleScope];
    v11 = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131277;
    }

    else
    {
      v12 = 131081;
    }

    v13 = [v8 initWithAssetUuid:v9 bundleScope:v10 uti:v11 resourceVersion:0 recipeID:v12];

    v14 = [(PLManagedObject *)self pathManager];
    v15 = [v14 readOnlyUrlWithIdentifier:v13];
    v16 = [v15 path];
  }

  else
  {
    if (v4)
    {
      v17 = @"small.MOV";
    }

    else
    {
      v17 = @"small.MP4";
    }

    v16 = [(PLManagedAsset *)self pathForMetadataWithExtension:v17];
  }

  return v16;
}

- (id)pathForAdjustedLargeVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:131077];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v11 = [(PLManagedAsset *)self filename];
    v12 = [v11 stringByDeletingPathExtension];
    v7 = [v12 stringByAppendingPathExtension:@"large.MOV"];

    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v8 stringByAppendingPathComponent:v7];
  }

  return v10;
}

- (id)pathForAdjustedMediumHDRVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:131475];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v11 = [(PLManagedAsset *)self filename];
    v12 = [v11 stringByDeletingPathExtension];
    v7 = [v12 stringByAppendingPathExtension:@"medium-hdr.MOV"];

    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v8 stringByAppendingPathComponent:v7];
  }

  return v10;
}

- (id)pathForAdjustedMediumVideoFile
{
  v3 = [(PLManagedAsset *)self shouldUseUBFPathManager];
  v4 = [(PLManagedAsset *)self isPhotoIris];
  if (v3)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!v4)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    v9 = [(PLManagedAsset *)self uuid];
    v10 = [(PLManagedAsset *)self bundleScope];
    v11 = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131275;
    }

    else
    {
      v12 = 131079;
    }

    v13 = [v8 initWithAssetUuid:v9 bundleScope:v10 uti:v11 resourceVersion:2 recipeID:v12];

    v14 = [(PLManagedObject *)self pathManager];
    v15 = [v14 readOnlyUrlWithIdentifier:v13];
    v16 = [v15 path];
  }

  else
  {
    v17 = @"medium.MP4";
    if (v4)
    {
      v17 = @"medium.MOV";
    }

    v18 = v17;
    v19 = [(PLManagedAsset *)self filename];
    v20 = [v19 stringByDeletingPathExtension];
    v13 = [v20 stringByAppendingPathExtension:v18];

    v14 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v16 = [v14 stringByAppendingPathComponent:v13];
  }

  return v16;
}

- (id)pathForNonAdjustedLargeVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 recipeID:131077];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v10 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"large.MOV"];
  }

  return v10;
}

- (id)pathForNonAdjustedMediumHDRVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 recipeID:131475];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v10 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"medium-hdr.MOV"];
  }

  return v10;
}

- (id)pathForNonAdjustedMediumVideoFile
{
  v3 = [(PLManagedAsset *)self shouldUseUBFPathManager];
  v4 = [(PLManagedAsset *)self isPhotoIris];
  if (v3)
  {
    v5 = MEMORY[0x1E6982F80];
    if (!v4)
    {
      v5 = MEMORY[0x1E6982EC8];
    }

    v6 = MEMORY[0x1E69BF298];
    v7 = *v5;
    v8 = [v6 alloc];
    v9 = [(PLManagedAsset *)self uuid];
    v10 = [(PLManagedAsset *)self bundleScope];
    v11 = [v7 identifier];

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = 131275;
    }

    else
    {
      v12 = 131079;
    }

    v13 = [v8 initWithAssetUuid:v9 bundleScope:v10 uti:v11 resourceVersion:0 recipeID:v12];

    v14 = [(PLManagedObject *)self pathManager];
    v15 = [v14 readOnlyUrlWithIdentifier:v13];
    v16 = [v15 path];
  }

  else
  {
    if (v4)
    {
      v17 = @"medium.MOV";
    }

    else
    {
      v17 = @"medium.MP4";
    }

    v16 = [(PLManagedAsset *)self pathForMetadataWithExtension:v17];
  }

  return v16;
}

- (id)fileURLForAdjustedMediumThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:65743];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
  }

  else
  {
    v10 = [(PLManagedAsset *)self filename];
    v11 = [v10 stringByDeletingPathExtension];
    v12 = [objc_opt_class() extensionForMediumThumbnailFile];
    v7 = [v11 stringByAppendingPathExtension:v12];

    v13 = MEMORY[0x1E695DFF8];
    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v14 = [v8 stringByAppendingPathComponent:v7];
    v9 = [v13 fileURLWithPath:v14 isDirectory:0];
  }

  return v9;
}

- (id)fileURLForNonAdjustedMediumThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 recipeID:65743];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
  }

  else
  {
    v7 = [objc_opt_class() extensionForMediumThumbnailFile];
    v9 = [(PLManagedAsset *)self fileURLForMetadataWithExtension:v7];
  }

  return v9;
}

- (id)pathForMediumVideoFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedMediumVideoFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedMediumVideoFile];
  }
  v3 = ;

  return v3;
}

- (id)fileURLForMediumThumbnailFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self fileURLForAdjustedMediumThumbnailFile];
  }

  else
  {
    [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForAdjustedMediumThumbnailFile
{
  v2 = [(PLManagedAsset *)self fileURLForAdjustedMediumThumbnailFile];
  v3 = [v2 path];

  return v3;
}

- (id)pathForNonAdjustedMediumThumbnailFile
{
  v2 = [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  v3 = [v2 path];

  return v3;
}

- (NSString)pathForMediumThumbnailFile
{
  v2 = [(PLManagedAsset *)self fileURLForMediumThumbnailFile];
  v3 = [v2 path];

  return v3;
}

- (id)fileURLForDeferredVideoComplement
{
  v2 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  if (v2)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:v2 isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForCurrentDeferredProcessingPreviewFile
{
  v2 = [(PLManagedAsset *)self pathForDeferredProcessingPreviewFile];
  if (v2)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:v2 isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForAsyncAdjustedRenderPreviewImage
{
  v2 = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
  if (v2)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:v2 isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForFullsizeRenderVideo
{
  v2 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
  if (v2)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:v2 isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForOriginalVideoComplement
{
  v2 = [(PLManagedAsset *)self pathForVideoComplementFile];
  if (v2)
  {
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:v2 isDirectory:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (id)fileURLForAdjustedLargeThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:65741];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
  }

  else
  {
    v10 = [(PLManagedAsset *)self filename];
    v11 = [v10 stringByDeletingPathExtension];
    v12 = [objc_opt_class() extensionForLargeThumbnailFile];
    v7 = [v11 stringByAppendingPathExtension:v12];

    v13 = MEMORY[0x1E695DFF8];
    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v14 = [v8 stringByAppendingPathComponent:v7];
    v9 = [v13 fileURLWithPath:v14 isDirectory:0];
  }

  return v9;
}

- (id)fileURLForNonAdjustedLargeThumbnailFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 recipeID:65741];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
  }

  else
  {
    v7 = [objc_opt_class() extensionForLargeThumbnailFile];
    v9 = [(PLManagedAsset *)self fileURLForMetadataWithExtension:v7];
  }

  return v9;
}

- (NSURL)fileURLForLargeThumbnailFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self fileURLForAdjustedLargeThumbnailFile];
  }

  else
  {
    [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForAlchemistImage
{
  v3 = objc_opt_class();
  v4 = [(PLManagedAsset *)self uuid];
  v5 = [(PLManagedAsset *)self bundleScope];
  v6 = [(PLManagedAsset *)self directory];
  v7 = [(PLManagedAsset *)self filename];
  v8 = [(PLManagedObject *)self pathManager];
  v9 = [v3 pathForAlchemistImageWithUUID:v4 bundleScope:v5 directory:v6 filename:v7 pathManager:v8];

  return v9;
}

- (id)pathForAlchemistV2ResourceFileWithRecipeID:(unsigned int)a3
{
  v3 = *&a3;
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v6 = objc_alloc(MEMORY[0x1E69BF298]);
    v7 = [(PLManagedAsset *)self uuid];
    v8 = [(PLManagedAsset *)self bundleScope];
    v9 = [*MEMORY[0x1E6983148] identifier];
    v10 = [v6 initWithAssetUuid:v7 bundleScope:v8 uti:v9 resourceVersion:3 resourceType:14 recipeID:v3 originalFilename:0 customSuffix:0];

    v11 = [(PLManagedObject *)self pathManager];
    v12 = [v11 readOnlyUrlWithIdentifier:v10];
    v13 = [v12 path];

LABEL_14:
    goto LABEL_16;
  }

  if (v3 > 327698)
  {
    if (v3 == 327699)
    {
      v14 = PLResourceAlchemistV2Widget1x2Filename();
    }

    else
    {
      if (v3 != 327701)
      {
        goto LABEL_15;
      }

      v14 = PLResourceAlchemistV2WallpaperFilename();
    }
  }

  else if (v3 == 327695)
  {
    v14 = PLResourceAlchemistV2OneUpFilename();
  }

  else
  {
    if (v3 != 327697)
    {
      goto LABEL_15;
    }

    v14 = PLResourceAlchemistV2Widget1x1Filename();
  }

  v10 = v14;
  if (v14)
  {
    v11 = [(PLManagedAsset *)self pathForComputeDirectory];
    v13 = [v11 stringByAppendingPathComponent:v10];
    goto LABEL_14;
  }

LABEL_15:
  v10 = [MEMORY[0x1E696AAA8] currentHandler];
  [v10 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:10262 description:{@"Invalid parameter not satisfying: %@", @"filename"}];
  v13 = 0;
LABEL_16:

  return v13;
}

- (id)pathForGenerativePlaygroundFaceResourcesFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:3 resourceType:14 recipeID:327693 originalFilename:0 customSuffix:0];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForComputeDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"GenerativePlaygroundFaceResources.dat"];
  }

  return v10;
}

- (id)pathForWallpaperComputeResourcesFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:3 resourceType:14 recipeID:327687 originalFilename:0 customSuffix:0];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForComputeDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"WallpaperComputeResources.dat"];
  }

  return v10;
}

- (id)pathForAdjustedLargeThumbnailFile
{
  v2 = [(PLManagedAsset *)self fileURLForAdjustedLargeThumbnailFile];
  v3 = [v2 path];

  return v3;
}

- (id)pathForNonAdjustedLargeThumbnailFile
{
  v2 = [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  v3 = [v2 path];

  return v3;
}

- (NSString)pathForLargeThumbnailFile
{
  v2 = [(PLManagedAsset *)self fileURLForLargeThumbnailFile];
  v3 = [v2 path];

  return v3;
}

- (id)pathForAdjustedLargeSizeImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:65739];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v11 = [(PLManagedAsset *)self filename];
    v12 = [v11 stringByDeletingPathExtension];
    v7 = [v12 stringByAppendingPathExtension:@"large.JPG"];

    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v8 stringByAppendingPathComponent:v7];
  }

  return v10;
}

- (id)pathForNonAdjustedLargeSizeImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 recipeID:65739];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v10 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"large.JPG"];
  }

  return v10;
}

- (id)pathForLargeSizeImageFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedLargeSizeImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForAsyncAdjustedRenderPreviewImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:65941];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"AsyncRenderPreview.JPG"];
  }

  return v10;
}

- (id)pathForNonAdjustedFullsizeImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 recipeID:65737];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v10 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"full.JPG"];
  }

  return v10;
}

- (id)pathForFullsizeImageFile
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    [(PLManagedAsset *)self pathForAdjustedFullsizeImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
  }
  v3 = ;

  return v3;
}

- (id)pathForVideoComplementSpatialOverCaptureContentFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 resourceType:11];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v11 = [(PLManagedAsset *)self pathForVideoComplementFile];
    v7 = [v11 pathExtension];
    v8 = [v11 stringByDeletingPathExtension];
    v9 = [v8 stringByAppendingString:*MEMORY[0x1E69BFFB0]];
    v10 = [v9 stringByAppendingPathExtension:v7];
  }

  return v10;
}

- (id)pathForSpatialOverCaptureContentFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = MEMORY[0x1E69BF298];
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self originalUniformTypeIdentifier];
    LODWORD(v3) = [v3 isValidFileIdentifierParametersForUUID:v4 utiString:v5 originalFilename:0];

    v6 = 0;
    if (!v3)
    {
      goto LABEL_6;
    }

    v7 = objc_alloc(MEMORY[0x1E69BF298]);
    v8 = [(PLManagedAsset *)self uuid];
    v9 = [(PLManagedAsset *)self bundleScope];
    v10 = [(PLManagedAsset *)self originalUniformTypeIdentifier];
    v11 = [v7 initWithAssetUuid:v8 bundleScope:v9 uti:v10 resourceVersion:0 resourceType:10];

    v12 = [(PLManagedObject *)self pathManager];
    v13 = [v12 readOnlyUrlWithIdentifier:v11];
    v6 = [v13 path];
  }

  else
  {
    v14 = [(PLManagedAsset *)self pathForOriginalFile];
    v11 = [v14 pathExtension];
    v12 = [v14 stringByDeletingPathExtension];
    v13 = [v12 stringByAppendingString:*MEMORY[0x1E69BFFB0]];
    v6 = [v13 stringByAppendingPathExtension:v11];
  }

LABEL_6:

  return v6;
}

- (id)pathForDeferredProcessingPreviewFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = &stru_1F0F06D80;
  }

  else
  {
    v4 = [(PLManagedAsset *)self pathForOriginalFile];
    v5 = [v4 pathExtension];
    v6 = [(PLManagedAsset *)self deferredProcessingNeeded];
    v7 = MEMORY[0x1E69BFF98];
    if (v6 != 10)
    {
      v7 = MEMORY[0x1E69BFCF0];
    }

    v8 = *v7;
    v9 = [v4 stringByDeletingPathExtension];
    v10 = [v9 stringByAppendingString:v8];
    v3 = [v10 stringByAppendingPathExtension:v5];
  }

  return v3;
}

- (id)pathForDeferredVideoComplementFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = 0;
  }

  else
  {
    v4 = [(PLManagedAsset *)self pathForVideoComplementFile];
    v5 = [v4 pathExtension];
    v6 = *MEMORY[0x1E69BFE88];
    v7 = [v4 stringByDeletingPathExtension];
    v8 = [v7 stringByAppendingString:v6];
    v3 = [v8 stringByAppendingPathExtension:v5];
  }

  return v3;
}

- (id)pathForVideoComplementFile
{
  if (![(PLManagedAsset *)self shouldUseUBFPathManager]|| [(PLManagedAsset *)self isCloudSharedAsset])
  {
    v3 = [(PLManagedAsset *)self pathForOriginalFile];
    v4 = [v3 stringByDeletingPathExtension];
    v5 = [v4 stringByAppendingPathExtension:@"MOV"];
LABEL_4:

    goto LABEL_5;
  }

  if (!-[PLManagedAsset isReferencedAsset](self, "isReferencedAsset") || (-[PLManagedAsset masterResourceForCPLType:](self, "masterResourceForCPLType:", 18), v7 = objc_claimAutoreleasedReturnValue(), [v7 fileSystemBookmark], v8 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "fileSystemURL"), v9 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v9, "path"), v5 = objc_claimAutoreleasedReturnValue(), v9, v8, v7, !v5))
  {
    v10 = objc_alloc(MEMORY[0x1E69BF298]);
    v11 = [(PLManagedAsset *)self uuid];
    v12 = [(PLManagedAsset *)self bundleScope];
    v13 = [*MEMORY[0x1E6982F80] identifier];
    v4 = [v10 initWithAssetUuid:v11 bundleScope:v12 uti:v13 resourceVersion:0 resourceType:3];

    v3 = [(PLManagedObject *)self pathManager];
    v14 = [v3 readOnlyUrlWithIdentifier:v4];
    v5 = [v14 path];

    goto LABEL_4;
  }

LABEL_5:

  return v5;
}

- (id)pathForAdjustedMediaMetadataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:327683];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v11 = [(PLManagedAsset *)self filename];
    v12 = [v11 stringByDeletingPathExtension];
    v7 = [v12 stringByAppendingPathExtension:@"media.dat"];

    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v8 stringByAppendingPathComponent:v7];
  }

  return v10;
}

- (id)pathForVideoMetadataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 resourceType:13];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    [v9 path];
  }

  else
  {
    v10 = *MEMORY[0x1E69C0020];
    v9 = [(PLManagedAsset *)self pathForMetadataWithExtension:*MEMORY[0x1E69C0020]];
    v7 = [v9 stringByDeletingPathExtension];
    v8 = [v7 stringByAppendingString:*MEMORY[0x1E69C0028]];
    [v8 stringByAppendingPathExtension:v10];
  }
  v11 = ;

  return v11;
}

- (id)pathForMediaMetadataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:0 recipeID:327683];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v10 = [(PLManagedAsset *)self pathForMetadataWithExtension:@"media.dat"];
  }

  return v10;
}

- (id)pathForCameraMetadataFile
{
  v3 = [(PLManagedObject *)self photoLibrary];
  v4 = [v3 pathManager];
  v5 = [v4 privateDirectoryWithSubType:9 createIfNeeded:1 error:0];

  v6 = [(PLManagedAsset *)self originalFilename];
  v7 = [v6 stringByDeletingPathExtension];
  v8 = [v7 stringByAppendingPathExtension:*MEMORY[0x1E69C00C0]];

  v9 = [v5 stringByAppendingPathComponent:v8];

  return v9;
}

- (id)pathForAdjustmentSecondaryDataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 resourceType:7];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"AdjustmentsSecondary.data"];
  }

  return v10;
}

- (id)pathForAdjustmentDataFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982D60] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:0];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"Adjustments.data"];
  }

  return v10;
}

- (id)pathForOriginalAdjustmentFile
{
  v3 = [(PLManagedObject *)self pathManager];
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v4 = objc_alloc(MEMORY[0x1E69BF298]);
    v5 = [(PLManagedAsset *)self uuid];
    v6 = [(PLManagedAsset *)self bundleScope];
    v7 = [MEMORY[0x1E69C08F0] supplementalResourceAAEType];
    v8 = [v7 identifier];
    v9 = [v4 initWithAssetUuid:v5 bundleScope:v6 uti:v8 resourceVersion:0 resourceType:5];

    v10 = [v3 readOnlyUrlWithIdentifier:v9];
    v11 = [v10 path];
  }

  else
  {
    v9 = [*MEMORY[0x1E69C0E18] uppercaseString];
    [v9 UTF8String];
    v10 = [(PLManagedAsset *)self filename];
    v12 = [(PLManagedAsset *)self directory];
    v13 = PLDCIMURLForResourcePropertiesAndPathManager();
    v11 = [v13 path];
  }

  return v11;
}

- (id)pathForAdjustmentFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F68] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:0];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"Adjustments.plist"];
  }

  return v10;
}

- (id)pathForPenultimateFullsizeRenderVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:1 recipeID:0];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"PenultimateFullSizeRender.mov"];
  }

  return v10;
}

- (id)pathForPenultimateFullsizeRenderImageFileWithUTI:(id)a3
{
  v4 = a3;
  if (!v4)
  {
    v4 = [*MEMORY[0x1E6982E58] identifier];
  }

  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v5 = objc_alloc(MEMORY[0x1E69BF298]);
    v6 = [(PLManagedAsset *)self uuid];
    v7 = [v5 initWithAssetUuid:v6 bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:v4 recipeID:{1, 0}];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    [v9 path];
  }

  else
  {
    v10 = [objc_opt_class() preferredFileExtensionForType:v4];
    v7 = [v10 lowercaseString];

    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v9 = [v8 stringByAppendingPathComponent:@"PenultimateFullSizeRender"];
    [v9 stringByAppendingPathExtension:v7];
  }
  v11 = ;

  return v11;
}

- (id)pathForPenultimateFullsizeRenderImageFile
{
  v3 = [(PLManagedAsset *)self penultimateImageResource];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 uniformTypeIdentifier];
    v6 = [v5 identifier];
  }

  else
  {
    v6 = [*MEMORY[0x1E6982E58] identifier];
  }

  v7 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFileWithUTI:v6];

  return v7;
}

- (id)pathForFullsizeRenderVideoFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982F80] identifier];
    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v7 = 131272;
    }

    else
    {
      v7 = 0x20000;
    }

    v8 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:v7];

    v9 = [(PLManagedObject *)self pathManager];
    v10 = [v9 readOnlyUrlWithIdentifier:v8];
    v11 = [v10 path];
  }

  else
  {
    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v11 = [v8 stringByAppendingPathComponent:@"FullSizeRender.mov"];
  }

  return v11;
}

- (id)pathForLocalVideoKeyFrame
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:3 recipeID:65749];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self thumbnailIdentifier];

    if (v7)
    {
      v11 = objc_alloc(MEMORY[0x1E696AF20]);
      v12 = [(PLManagedAsset *)self thumbnailIdentifier];
      v13 = [v11 initWithString:v12];

      v7 = [v13 path];
    }

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 photoDirectoryWithType:31 createIfNeeded:1 error:0];
    v14 = [v9 stringByAppendingPathComponent:v7];
    v10 = [v14 stringByAppendingPathComponent:@"LocalVideoKeyFrame.jpg"];
  }

  return v10;
}

- (id)pathForTransientVideoPosterFramePreview
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:65948];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"VideoPosterFramePreview.jpg"];
  }

  return v10;
}

- (id)pathForBestAvailableFullsizeRenderImageFileOutIsSubstandard:(BOOL *)a3
{
  v5 = [MEMORY[0x1E69BF238] fileManager];
  v6 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  if (![v5 fileExistsAtPath:v6])
  {
    goto LABEL_24;
  }

  v7 = v6;
  v8 = v7;
  if (a3)
  {
    *a3 = 0;
  }

  v9 = v7;
  if (!v7)
  {
LABEL_24:
    v10 = [*MEMORY[0x1E6982E00] identifier];
    v8 = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:v10];

    if (![v5 fileExistsAtPath:v8])
    {
      goto LABEL_9;
    }

    v11 = v8;
    v8 = v11;
    if (a3)
    {
      *a3 = 0;
    }

    v9 = v11;
    if (!v11)
    {
LABEL_9:
      v12 = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];

      if (![v5 fileExistsAtPath:v12])
      {
        goto LABEL_14;
      }

      v13 = v12;
      v8 = v13;
      if (a3)
      {
        *a3 = 1;
      }

      v9 = v13;
      if (!v13)
      {
        v12 = 0;
LABEL_14:
        v9 = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];

        if ([v5 fileExistsAtPath:v9])
        {
          v14 = v9;
          v8 = v14;
          if (a3)
          {
            *a3 = 1;
          }

          v9 = v14;
        }

        else
        {
          v8 = 0;
        }
      }
    }
  }

  return v8;
}

- (id)pathForSubstandardFullsizeRenderImageFile
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v3 = objc_alloc(MEMORY[0x1E69BF298]);
    v4 = [(PLManagedAsset *)self uuid];
    v5 = [(PLManagedAsset *)self bundleScope];
    v6 = [*MEMORY[0x1E6982E58] identifier];
    v7 = [v3 initWithAssetUuid:v4 bundleScope:v5 uti:v6 resourceVersion:2 recipeID:65937];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    v10 = [v9 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v10 = [v7 stringByAppendingPathComponent:@"SubstandardFullSizeRender.jpg"];
  }

  return v10;
}

- (id)pathForFullsizeRenderImageFileWithUTI:(id)a3
{
  v4 = a3;
  if (!v4)
  {
    v4 = [*MEMORY[0x1E6982E58] identifier];
  }

  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v5 = objc_alloc(MEMORY[0x1E69BF298]);
    v6 = [(PLManagedAsset *)self uuid];
    v7 = [v5 initWithAssetUuid:v6 bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:v4 recipeID:{2, 65938}];

    v8 = [(PLManagedObject *)self pathManager];
    v9 = [v8 readOnlyUrlWithIdentifier:v7];
    [v9 path];
  }

  else
  {
    v10 = [objc_opt_class() preferredFileExtensionForType:v4];
    v7 = [v10 lowercaseString];

    v8 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
    v9 = [v8 stringByAppendingPathComponent:@"FullSizeRender"];
    [v9 stringByAppendingPathExtension:v7];
  }
  v11 = ;

  return v11;
}

- (id)fileTypeForFullsizeRenderImage
{
  if ([(PLManagedAsset *)self isPhoto]&& ([(PLManagedAsset *)self uniformTypeIdentifier], (v3 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v4 = v3;
    v5 = [(PLManagedAsset *)self uniformTypeIdentifier];
  }

  else
  {
    v5 = [*MEMORY[0x1E6982E58] identifier];
  }

  if ([objc_opt_class() isPrimaryImageFormatForUTI:v5])
  {
    v6 = [*MEMORY[0x1E6982E10] identifier];
    v7 = [v5 isEqualToString:v6];

    if ((v7 & 1) == 0)
    {
      goto LABEL_12;
    }

    v8 = MEMORY[0x1E6982E00];
  }

  else
  {
    v9 = [(PLManagedAsset *)self isRAW];
    v8 = MEMORY[0x1E6982E58];
    if (!v9 && [(PLManagedAsset *)self hdrType]== 11)
    {
      v8 = MEMORY[0x1E6982E00];
    }
  }

  v10 = [*v8 identifier];

  v5 = v10;
LABEL_12:

  return v5;
}

- (id)pathForFullsizeRenderImageFile
{
  v3 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_1085];
  v4 = [v3 fileURL];
  v5 = v4;
  if (v4)
  {
    v6 = [v4 path];
  }

  else
  {
    v7 = [(PLManagedAsset *)self fileTypeForFullsizeRenderImage];
    v6 = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:v7];
  }

  return v6;
}

BOOL __48__PLManagedAsset_pathForFullsizeRenderImageFile__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 recipeID] == 65938 && objc_msgSend(v2, "version") == 2;

  return v3;
}

- (BOOL)_migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat
{
  v3 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v4 = objc_alloc(MEMORY[0x1E69C0910]);
  v5 = [MEMORY[0x1E695DFF8] fileURLWithPath:v3 isDirectory:0];
  v6 = [v4 initWithURL:v5];

  v7 = 0;
  if ([v6 isRecognizedFormat])
  {
    v8 = objc_alloc(MEMORY[0x1E69C0910]);
    if (v6)
    {
      [v6 slowMotionTimeRange];
    }

    else
    {
      memset(v21, 0, sizeof(v21));
    }

    [v6 slowMotionRate];
    v9 = [v8 initWithSlowMotionTimeRange:v21 rate:?];
    v10 = [v9 adjustmentFormatIdentifier];
    v11 = [v6 adjustmentFormatIdentifier];
    if ([v10 isEqualToString:v11])
    {
      v12 = [v9 adjustmentFormatVersion];
      v13 = [v6 adjustmentFormatVersion];
      if ([v12 isEqualToString:v13])
      {
        v14 = [v9 adjustmentData];
        v15 = [v6 adjustmentData];
        v20 = [v14 isEqualToData:v15];

        if (v20)
        {
          v7 = 0;
LABEL_14:

          goto LABEL_15;
        }

LABEL_11:
        v16 = [v9 adjustmentTimestamp];

        if (!v16)
        {
          v17 = [(PLManagedAsset *)self dateCreated];
          [v9 setAdjustmentTimestamp:v17];
        }

        v18 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForSLMAdjustmentsWithMainFileMetadata:0];
        [(PLManagedAsset *)self setAdjustments:v9 options:v18];

        v7 = 1;
        goto LABEL_14;
      }
    }

    goto LABEL_11;
  }

LABEL_15:

  return v7;
}

- (BOOL)_migrateLegacySLMAdjustments
{
  v23 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self pathForLegacySlalomRegionsArchive];
  v4 = [MEMORY[0x1E696AC08] defaultManager];
  v5 = [v4 fileExistsAtPath:v3];

  if (v5)
  {
    v6 = objc_alloc(MEMORY[0x1E69C0910]);
    v7 = [MEMORY[0x1E695DFF8] fileURLWithPath:v3 isDirectory:0];
    v8 = [v6 initWithURL:v7];

    v9 = v8 != 0;
    if (v8)
    {
      v10 = [v8 adjustmentTimestamp];

      if (!v10)
      {
        v11 = [(PLManagedAsset *)self dateCreated];
        [v8 setAdjustmentTimestamp:v11];
      }

      v12 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForSLMAdjustmentsWithMainFileMetadata:0];
      [(PLManagedAsset *)self setAdjustments:v8 options:v12];
    }

    v13 = [MEMORY[0x1E696AC08] defaultManager];
    v18 = 0;
    v14 = [v13 removeItemAtPath:v3 error:&v18];
    v15 = v18;

    if (!v14 || v15)
    {
      v16 = PLMigrationGetLog();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v20 = v3;
        v21 = 2112;
        v22 = v15;
        _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "_migrateLegacySLMAdjustments failed to remove %@: %@", buf, 0x16u);
      }
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)migrateLegacyVideoAdjustments
{
  if ([(PLManagedAsset *)self kind]!= 1)
  {
    return 0;
  }

  if ([(PLManagedAsset *)self kindSubtype]!= 101)
  {
    return 0;
  }

  [MEMORY[0x1E69BF328] maskForMigrateLegacyVideoAdjustmentsExclusions];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    return 0;
  }

  v5 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v6 = [MEMORY[0x1E696AC08] defaultManager];
  v7 = [v6 fileExistsAtPath:v5];

  if (v7)
  {
    v8 = [(PLManagedAsset *)self _migrateKeyedArchiverAdjustmentsToPropertyListSerializationFormat];
  }

  else
  {
    v8 = [(PLManagedAsset *)self _migrateLegacySLMAdjustments];
  }

  v3 = v8;

  return v3;
}

- (BOOL)_setDefaultCinematicAdjustementsWithMainFileMetadata:(id)a3
{
  v4 = a3;
  v5 = +[PLCompositionHelper newIdentityCompositionController];
  v6 = [v5 adjustmentConstants];
  [v5 setMediaType:2];
  v7 = [v6 PIPortraitVideoAdjustmentKey];
  [v5 modifyAdjustmentWithKey:v7 modificationBlock:&__block_literal_global_1082];

  v8 = [PLPhotoEditExportProperties exportPropertiesWithImageWidth:[(PLManagedAsset *)self originalWidth] imageHeight:[(PLManagedAsset *)self originalHeight] exifOrientation:0];
  v9 = objc_alloc_init(PLPhotoEditPersistenceManager);
  v17 = 0;
  v18 = 0;
  v10 = [(PLPhotoEditPersistenceManager *)v9 dataFromCompositionController:v5 outFormatIdentifier:&v18 outFormatVersion:&v17 exportProperties:v8];
  v11 = v18;
  v12 = v17;
  v13 = objc_alloc(MEMORY[0x1E69C0660]);
  v14 = [v13 initWithFormatIdentifier:v11 formatVersion:v12 data:v10 baseVersion:0 editorBundleID:*MEMORY[0x1E69C0E58] renderTypes:128];

  if (v14)
  {
    v15 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForCinematicCaptureIngestWithMainFileMetadata:v4];
    [(PLManagedAsset *)self setAdjustments:v14 options:v15];
  }

  return v14 != 0;
}

- (BOOL)_setDefaultSlowMotionAdjustmentsWithMainFileMetadata:(id)a3
{
  v31 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if ([v4 isSyndicationOriginated])
  {
    if (v4)
    {
      [v4 duration];
      v5 = HIDWORD(v26);
      v6 = v27;
    }

    else
    {
      v6 = 0;
      v5 = 0;
      v26 = 0uLL;
      *&v27 = 0;
    }

    v29 = v26;
    v30 = DWORD2(v26);
    v7 = [v4 nominalFrameRate];
    [v7 floatValue];
    v11 = v10;
  }

  else
  {
    v7 = [(PLManagedAsset *)self mainFileURL];
    v8 = [MEMORY[0x1E6988168] assetWithURL:v7];
    v9 = v8;
    if (v8)
    {
      [v8 duration];
      v5 = HIDWORD(v26);
      v6 = v27;
    }

    else
    {
      v6 = 0;
      v5 = 0;
      v26 = 0uLL;
      *&v27 = 0;
    }

    v29 = v26;
    v30 = DWORD2(v26);
    v12 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:v9];
    v13 = [v12 firstObject];
    [v13 nominalFrameRate];
    v11 = v14;
  }

  if (v5)
  {
    v27 = 0u;
    v28 = 0u;
    v26 = 0u;
    *&v23 = v29;
    *(&v23 + 1) = __PAIR64__(v5, v30);
    *&v24 = v6;
    [MEMORY[0x1E69C0910] defaultSlowMotionTimeRangeForDuration:&v23];
    LODWORD(v16) = v11;
    [MEMORY[0x1E69C0910] defaultSlowMotionRateForNominalFrameRate:v16];
    v18 = v17;
    v19 = objc_alloc(MEMORY[0x1E69C0910]);
    v23 = v26;
    v24 = v27;
    v25 = v28;
    v20 = [v19 initWithSlowMotionTimeRange:&v23 rate:{COERCE_DOUBLE(__PAIR64__(DWORD1(v28), v18))}];
    v15 = v20 != 0;
    if (v20)
    {
      v21 = [PLAssetAdjustmentOptions assetAdjustmentOptionsForSLMAdjustmentsWithMainFileMetadata:v4];
      [(PLManagedAsset *)self setAdjustments:v20 options:v21];
    }
  }

  else
  {
    v15 = 0;
  }

  return v15;
}

- (BOOL)setDefaultAdjustmentsIfNecessaryWithMainFileMetadata:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v6 = [MEMORY[0x1E696AC08] defaultManager];
  v7 = [v6 fileExistsAtPath:v5];

  if (v7)
  {
    goto LABEL_8;
  }

  if ([(PLManagedAsset *)self kindSubtype]!= 101 || ![(PLManagedAsset *)self _setDefaultSlowMotionAdjustmentsWithMainFileMetadata:v4])
  {
    if ([v4 isCinematicVideo])
    {
      v9 = [v4 cinematicVideoIntent];

      if (v9)
      {
        v8 = [(PLManagedAsset *)self _setDefaultCinematicAdjustementsWithMainFileMetadata:v4];
        goto LABEL_9;
      }
    }

LABEL_8:
    v8 = 0;
    goto LABEL_9;
  }

  v8 = 1;
LABEL_9:

  return v8;
}

- (BOOL)setCurrentAdjustmentAsOriginalAdjustment
{
  v15 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v4 = [MEMORY[0x1E69BF238] fileManager];
  if ([v4 fileExistsAtPath:v3])
  {
    v5 = [(PLManagedAsset *)self pathForOriginalAdjustmentFile];
    v12 = 0;
    v6 = [v4 copyItemAtPath:v3 toPath:v5 error:&v12];
    v7 = v12;
    if (v6)
    {
      v8 = [PLResourceInstaller onDemand_installOriginalAdjustmentResourceIfPresentForAsset:self];
      v9 = v8 != 0;
    }

    else
    {
      v8 = PLBackendGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v14 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Error copying adjustment to original adjustment with error: %@", buf, 0xCu);
      }

      v9 = 0;
    }
  }

  else
  {
    v5 = PLBackendGetLog();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      v10 = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      v14 = v10;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_ERROR, "Tried to set original adjustment for an asset without an adjustment: %{public}@", buf, 0xCu);
    }

    v9 = 0;
  }

  return v9;
}

- (void)synchronouslyFetchAdjustmentDataWithCompletionHandler:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = [(PLManagedAsset *)self additionalAttributes];
    v6 = [v5 unmanagedAdjustment];

    if (v6 && [(PLManagedAsset *)self hasAdjustments])
    {
      v7 = [v6 adjustmentFormatIdentifier];
      v8 = [v6 adjustmentFormatVersion];
      v9 = [(PLManagedAsset *)self additionalAttributes];
      v22 = [v9 editorBundleID];

      v10 = [v6 adjustmentBaseImageFormat];
      v11 = [v10 integerValue];

      v12 = [(PLManagedAsset *)self pathForAdjustmentFile];
      v20 = [v6 adjustmentTimestamp];
      v21 = v12;
      if ([(PLManagedAsset *)self shouldUseUBFPathManager])
      {
        v13 = [v12 stringByDeletingPathExtension];
        [v13 stringByAppendingPathExtension:@"in_flight"];
      }

      else
      {
        v13 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
        [v13 stringByAppendingPathComponent:@"in_flight"];
      }
      v14 = ;

      v19 = [v6 adjustmentRenderTypes];
    }

    else
    {
      v19 = 0;
      v20 = 0;
      v21 = 0;
      v14 = 0;
      v11 = 0;
      v22 = 0;
      v8 = 0;
      v7 = 0;
    }

    v15 = objc_alloc_init(MEMORY[0x1E696AC08]);
    v16 = objc_opt_class();
    objc_sync_enter(v16);
    v17 = [v15 fileExistsAtPath:v14 isDirectory:0];
    objc_sync_exit(v16);

    if (v17)
    {
      v18 = PLBackendGetLog();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "pathForMarkerFileExists. resetting adjustment", buf, 2u);
      }

      [v15 removeItemAtPath:v14 error:0];
      [(PLManagedAsset *)self revertToOriginal];
      v11 = 0;
      v8 = 0;
      v7 = 0;
    }

    (*(v4 + 2))(v4, v7, v8, v22, v11, v21, v19, v20, 0);
  }
}

- (void)_cleanupPenultimateResources
{
  v29 = *MEMORY[0x1E69E9840];
  v3 = PLBackendGetLog();
  if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "Cleaning up penultimate resources", buf, 2u);
  }

  v4 = [MEMORY[0x1E696AC08] defaultManager];
  v5 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
  if ([v4 fileExistsAtPath:v5])
  {
    v24 = 0;
    v6 = [v4 removeItemAtPath:v5 error:&v24];
    v7 = v24;
    v8 = PLBackendGetLog();
    v9 = v8;
    if (v6)
    {
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v26 = v5;
        v10 = "Removed pathForPenultimateFullsizeRenderImageFile %@";
        v11 = v9;
        v12 = OS_LOG_TYPE_INFO;
        v13 = 12;
LABEL_9:
        _os_log_impl(&dword_19BF1F000, v11, v12, v10, buf, v13);
      }
    }

    else if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v26 = v5;
      v27 = 2112;
      v28 = v7;
      v10 = "Failed to remove pathForPenultimateFullsizeRenderImageFile %@: %@";
      v11 = v9;
      v12 = OS_LOG_TYPE_ERROR;
      v13 = 22;
      goto LABEL_9;
    }
  }

  [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:15];
  v14 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
  if ([v4 fileExistsAtPath:v14])
  {
    v23 = 0;
    v15 = [v4 removeItemAtPath:v14 error:&v23];
    v16 = v23;
    v17 = PLBackendGetLog();
    v18 = v17;
    if (v15)
    {
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v26 = v14;
        v19 = "Removed pathForPenultimateFullsizeRenderVideoFile %@";
        v20 = v18;
        v21 = OS_LOG_TYPE_INFO;
        v22 = 12;
LABEL_17:
        _os_log_impl(&dword_19BF1F000, v20, v21, v19, buf, v22);
      }
    }

    else if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v26 = v14;
      v27 = 2112;
      v28 = v16;
      v19 = "Failed to remove pathForPenultimateFullsizeRenderVideoFile %@: %@";
      v20 = v18;
      v21 = OS_LOG_TYPE_ERROR;
      v22 = 22;
      goto LABEL_17;
    }
  }

  [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:20];
  [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:25];
}

- (BOOL)updateDeferredAdjustmentWithFullSizeRenderImageURL:(id)a3 videoURL:(id)a4 videoPosterURL:(id)a5 error:(id *)a6
{
  v52 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a5;
  if (v9 && [(PLManagedAsset *)self isPhoto])
  {
    v12 = v9;
    v13 = [v12 pathExtension];
    v14 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:v13 assetType:0];

    v15 = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:v14];
    v16 = [MEMORY[0x1E695DFF8] fileURLWithPath:v15 isDirectory:0];

    v17 = 0;
  }

  else if (v10 && [(PLManagedAsset *)self isVideo])
  {
    v12 = v10;
    v16 = [(PLManagedAsset *)self fileURLForFullsizeRenderVideo];
    v17 = [(PLManagedAsset *)self fileURLForFullsizeRenderImage];
  }

  else
  {
    v17 = 0;
    v16 = 0;
    v12 = 0;
  }

  v42 = v10;
  if ([(PLManagedAsset *)self isPhotoIris])
  {
    v18 = v10;
  }

  else
  {
    v18 = 0;
  }

  v43 = v18;
  v19 = MEMORY[0x1E695DF90];
  v20 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v21 = [v19 dictionaryWithContentsOfFile:v20];

  v22 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
  {
    *buf = 138412546;
    v49 = v12;
    v50 = 2112;
    v51 = v16;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Update deferred adjustment ingesting rendered media at source URL: %@ to destination URL: %@", buf, 0x16u);
  }

  if ([v16 isEqual:v12])
  {
    v23 = 0;
  }

  else
  {
    v23 = 3;
  }

  v24 = objc_alloc_init(PLMutableAssetAdjustmentOptions);
  [(PLMutableAssetAdjustmentOptions *)v24 setRenderedContentURL:v12];
  [(PLMutableAssetAdjustmentOptions *)v24 setRenderedVideoComplementContentURL:v43];
  v41 = v11;
  [(PLMutableAssetAdjustmentOptions *)v24 setRenderedVideoPosterContentURL:v11];
  [(PLMutableAssetAdjustmentOptions *)v24 setFileIngestionType:v23];
  [(PLMutableAssetAdjustmentOptions *)v24 setShouldUpdateAttributes:1];
  v47 = 0;
  v25 = [(PLManagedAsset *)self _ingestAndApplyMetadataChangesFromAdjustments:0 updateAdjustmentDictionary:v21 options:v24 fullSizeRenderURL:v16 videoPosterRenderURL:v17 isRevertToOriginal:0 error:&v47];
  v26 = v47;
  v27 = v26;
  if (v25)
  {
    [(PLManagedAsset *)self _writeOutAdjustmentsToFile:v21];
    v40 = v9;
    if ([(PLManagedAsset *)self deferredProcessingNeeded]== 2 || [(PLManagedAsset *)self deferredProcessingNeeded]== 9)
    {
      v28 = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
      if (v28)
      {
        v46 = 0;
        v29 = [MEMORY[0x1E69BF238] removeItemAtPath:v28 error:&v46];
        v30 = v46;
        if ((v29 & 1) == 0)
        {
          v38 = v30;
          v31 = PLBackendGetLog();
          if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            v49 = v28;
            v50 = 2112;
            v51 = v38;
            _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "Couldn't remove async render preview image %@ with error: %@", buf, 0x16u);
          }

          v30 = v38;
        }
      }

      [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
    }

    if (v17 && (v32 = CGImageSourceCreateWithURL(v17, 0)) != 0)
    {
      v44 = 0;
      v45 = 0;
      [PLManagedAsset createThumbnailImage:&v45 previewImage:&v44 withToBeReleasedImageSource:v32];
      v33 = v45;
      v34 = v44;
    }

    else
    {
      v34 = 0;
      v33 = 0;
    }

    LOWORD(v37) = 0;
    [(PLManagedAsset *)self _updateDerivativesAndThumbnails:1 withPreviewImage:v34 thumbnailImage:v33 metadata:0 didRevertToOriginal:0 updateInternalResources:1 isSubstandardRender:v37 isDeferred:?];

    v9 = v40;
  }

  else if (a6)
  {
    v35 = v26;
    *a6 = v27;
  }

  return v25;
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 withMetadata:(id)a4
{
  if ([a4 isSpatialMedia])
  {
    v5 = 4096;
  }

  else
  {
    v5 = 0;
  }

  return v5 | a3 & 0xFFFFEFFF;
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 forSpatialTypeOfAVAsset:(id)a4
{
  v6 = a4;
  if ([(PLManagedAsset *)self spatialType])
  {
    v7 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVAsset:v6 timeZoneLookup:0];
    if ([v7 isSpatialMedia])
    {
      v8 = 4096;
    }

    else
    {
      v8 = 0;
    }

    a3 = v8 | a3 & 0xFFFFEFFF;
  }

  return a3;
}

- (BOOL)_ingestAndApplyMetadataChangesFromAdjustments:(id)a3 updateAdjustmentDictionary:(id)a4 options:(id)a5 fullSizeRenderURL:(id)a6 videoPosterRenderURL:(id)a7 isRevertToOriginal:(BOOL)a8 error:(id *)a9
{
  v127 = a8;
  v165 = *MEMORY[0x1E69E9840];
  v129 = a3;
  v130 = a4;
  v14 = a5;
  v15 = a6;
  v132 = a7;
  v131 = [MEMORY[0x1E69BF238] fileManager];
  v16 = objc_initWeak(location, self);

  v17 = objc_alloc(MEMORY[0x1E69BF270]);
  v139[0] = MEMORY[0x1E69E9820];
  v139[1] = 3221225472;
  v139[2] = __163__PLManagedAsset__ingestAndApplyMetadataChangesFromAdjustments_updateAdjustmentDictionary_options_fullSizeRenderURL_videoPosterRenderURL_isRevertToOriginal_error___block_invoke;
  v139[3] = &unk_1E7573318;
  objc_copyWeak(&v141, location);
  v18 = v15;
  v140 = v18;
  v126 = [v17 initWithBlock:v139];

  objc_destroyWeak(&v141);
  objc_destroyWeak(location);
  v19 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
  {
    v20 = [(PLManagedAsset *)self uuid];
    v21 = [v14 renderedContentURL];
    v22 = [v14 renderedVideoComplementContentURL];
    v23 = [v14 renderedVideoPosterContentURL];
    v24 = [v14 fileIngestionType];
    v25 = [v14 isSubstandardRender];
    v26 = @"NO";
    *location = 138545410;
    *&location[4] = v20;
    v149 = 2112;
    if (v25)
    {
      v27 = @"YES";
    }

    else
    {
      v27 = @"NO";
    }

    v150 = v21;
    if (v127)
    {
      v26 = @"YES";
    }

    v151 = 2112;
    v152 = v18;
    v153 = 2112;
    v154 = v22;
    v155 = 2112;
    v156 = v23;
    v157 = 2112;
    v158 = v132;
    v159 = 2048;
    v160 = v24;
    v161 = 2112;
    v162 = v27;
    v163 = 2112;
    v164 = v26;
    _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_INFO, "Ingest and apply metadata changes for asset %{public}@ from renderedContentURL %@ fullSizeRenderURL %@ renderedVideoComplementContentURL %@ videoPosterContentURL %@ videoPosterRenderURL %@ ingestionType %ld isSubstandardRender %@ isRevertToOriginal %@", location, 0x5Cu);
  }

  v28 = [(PLManagedAsset *)self additionalAttributes];
  [v28 setAdjustedStableHash:0];

  [(PLManagedAsset *)self revalidateFaceAreaPoints];
  v29 = [v14 renderedContentURL];
  if (v18)
  {
    v30 = v29 == 0;
  }

  else
  {
    v30 = 1;
  }

  v31 = !v30;

  if (v31)
  {
    v32 = [(PLManagedObject *)self pathManager];
    v33 = [v32 capabilities];

    v34 = [v18 path];
    v35 = [v34 stringByDeletingLastPathComponent];
    v138 = 0;
    v36 = [v131 createDirectoryAtPath:v35 withIntermediateDirectories:1 attributes:0 error:&v138];
    v37 = v138;

    if ((v36 & 1) == 0)
    {
      v50 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
      {
        *location = 138412546;
        *&location[4] = v18;
        v149 = 2112;
        v150 = v37;
        _os_log_impl(&dword_19BF1F000, v50, OS_LOG_TYPE_ERROR, "Failed to create directory for %@: %@", location, 0x16u);
      }

      v51 = MEMORY[0x1E696ABC0];
      v52 = *MEMORY[0x1E696A278];
      v146[0] = *MEMORY[0x1E696AA08];
      v146[1] = v52;
      v147[0] = v37;
      v147[1] = @"Failed to create directory for full size render";
      v41 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v147 forKeys:v146 count:2];
      v53 = [v51 errorWithDomain:*MEMORY[0x1E69BFF48] code:47011 userInfo:v41];
      goto LABEL_32;
    }

    v38 = MEMORY[0x1E69BF238];
    v39 = [v14 renderedContentURL];
    v137 = 0;
    v40 = [v38 ingestItemAtURL:v39 toURL:v18 type:objc_msgSend(v14 options:"fileIngestionType") capabilities:6 error:{v33, &v137}];
    v41 = v137;

    if ((v40 & 1) == 0 && ([v14 isSubstandardRender] & 1) == 0)
    {
      v58 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        v59 = [v14 renderedContentURL];
        *location = 138412546;
        *&location[4] = v59;
        v149 = 2112;
        v150 = v41;
        _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_ERROR, "Failed to ingest %@: %@", location, 0x16u);
      }

      v60 = MEMORY[0x1E696ABC0];
      v61 = *MEMORY[0x1E696A278];
      v144[0] = *MEMORY[0x1E696AA08];
      v144[1] = v61;
      v145[0] = v41;
      v145[1] = @"Failed to ingest full size render";
      v62 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v145 forKeys:v144 count:2];
      v53 = [v60 errorWithDomain:*MEMORY[0x1E69BFF48] code:47011 userInfo:v62];

      goto LABEL_32;
    }

    if (!-[PLManagedAsset isVideo](self, "isVideo") || (([v14 renderedVideoPosterContentURL], v42 = objc_claimAutoreleasedReturnValue(), v132) ? (v43 = v42 == 0) : (v43 = 1), v43 ? (v44 = 0) : (v44 = 1), v42, !v44))
    {
LABEL_44:
      v64 = [v14 adjustmentSecondaryDataURL];
      v65 = v64 == 0;

      if (v65)
      {
        goto LABEL_47;
      }

      v66 = MEMORY[0x1E695DFF8];
      v67 = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
      v68 = [v66 fileURLWithPath:v67 isDirectory:0];

      v69 = MEMORY[0x1E69BF238];
      v70 = [v14 adjustmentSecondaryDataURL];
      v135 = 0;
      v71 = [v69 ingestItemAtURL:v70 toURL:v68 type:objc_msgSend(v14 options:"fileIngestionType") capabilities:6 error:{v33, &v135}];
      v41 = v135;

      if (v71)
      {

LABEL_47:
        if (![(PLManagedAsset *)self isPhotoIris])
        {
LABEL_80:

          goto LABEL_81;
        }

        v124 = [(PLManagedAsset *)self videoCpVisibilityState];
        v72 = MEMORY[0x1E695DFF8];
        v73 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        v125 = [v72 fileURLWithPath:v73 isDirectory:0];

        v74 = [v14 renderedVideoComplementContentURL];

        if (v74)
        {
          v75 = MEMORY[0x1E69BF238];
          v76 = [v14 renderedVideoComplementContentURL];
          v134 = 0;
          v77 = [v75 ingestItemAtURL:v76 toURL:v125 type:objc_msgSend(v14 options:"fileIngestionType") capabilities:6 error:{v33, &v134}];
          v78 = v134;

          if (v77)
          {

            if ([v14 shouldUpdateAttributes])
            {
              if ([(PLManagedAsset *)self depthType]!= 1 || ([(PLManagedAsset *)self videoCpVisibilityState]& 1) == 0)
              {
                LOWORD(v124) = v124 | 8;
              }

              v79 = [MEMORY[0x1E6987E28] assetWithURL:v125];
              [(PLManagedAsset *)self _updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:v79];
              v80 = [(PLManagedAsset *)self additionalAttributes];
              v123 = [v80 unmanagedAdjustment];

              v81 = [v123 adjustmentRenderTypes];
              v82 = [(PLManagedAsset *)self playbackVariationFromAVAsset:v79 isLivePhotoVideoComplement:1];
              v83 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v81 withPlaybackVariation:v82];
              if ([(PLManagedAsset *)self playbackVariation]!= v82)
              {
                [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v82];
              }

              if (v81 != v83)
              {
                [v123 setAdjustmentRenderTypes:v83];
              }

              goto LABEL_77;
            }

            goto LABEL_79;
          }

          if ((PLIsErrorFileNotFound() & 1) == 0)
          {
            v90 = PLPhotoEditGetLog();
            if (os_log_type_enabled(v90, OS_LOG_TYPE_ERROR))
            {
              v91 = [v14 renderedVideoComplementContentURL];
              *location = 138412546;
              *&location[4] = v91;
              v149 = 2112;
              v150 = v78;
              _os_log_impl(&dword_19BF1F000, v90, OS_LOG_TYPE_ERROR, "Nonfatal - Error ingesting video complement %@: %@", location, 0x16u);
            }
          }

          v89 = [v14 shouldUpdateAttributes];
        }

        else
        {
          v89 = [v14 shouldUpdateAttributes];
        }

        if (v89)
        {
          if ([v14 fileIngestionType] || !v124)
          {
            if ((v124 & 2) == 0)
            {
              v93 = v124 & 0xFFF6 | 1;
LABEL_78:
              v94 = v93;
              [(PLManagedAsset *)self setVideoCpVisibilityState:v93];
              v95 = objc_opt_class();
              v96 = [(PLManagedAsset *)self videoCpDurationValue];
              v97 = [(PLManagedAsset *)self isCloudSharedAsset];
              v98 = [v125 path];
              v99 = [v95 isPhotoIrisPlaceholderWithPhotoIris:1 videoCpDuration:v96 isCloudShared:v97 videoCpFilePath:v98];

              -[PLManagedAsset updatePlaybackStyleWithLivePhotoPlayability:](self, "updatePlaybackStyleWithLivePhotoPlayability:", [objc_opt_class() canPlayPhotoIrisWithPhotoIris:1 photoIrisPlaceholder:v99 hasAdjustments:1 videoCpVisibilityState:v94]);
              goto LABEL_79;
            }

            [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:0];
          }

          else
          {
            v92 = PLMigrationGetLog();
            if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
            {
              *location = 67109120;
              *&location[4] = v124;
              _os_log_impl(&dword_19BF1F000, v92, OS_LOG_TYPE_INFO, "The video complement is missing, and we are perserving existing PLVideoComplementVisibilityState on rebuild: %hu", location, 8u);
            }
          }

LABEL_77:
          v93 = v124;
          goto LABEL_78;
        }

LABEL_79:

        goto LABEL_80;
      }

      v84 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v84, OS_LOG_TYPE_ERROR))
      {
        v85 = [v14 adjustmentSecondaryDataURL];
        *location = 138412546;
        *&location[4] = v85;
        v149 = 2112;
        v150 = v41;
        _os_log_impl(&dword_19BF1F000, v84, OS_LOG_TYPE_ERROR, "Failed to ingest adjustment secondary data %@: %@", location, 0x16u);
      }

      v86 = MEMORY[0x1E696ABC0];
      v87 = *MEMORY[0x1E696A278];
      v142[0] = *MEMORY[0x1E696AA08];
      v142[1] = v87;
      v143[0] = v41;
      v143[1] = @"Failed to ingest adjustment secondary data";
      v88 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v143 forKeys:v142 count:2];
      v53 = [v86 errorWithDomain:*MEMORY[0x1E69BFF48] code:47011 userInfo:v88];

LABEL_32:
      goto LABEL_33;
    }

    v45 = MEMORY[0x1E69BF238];
    v46 = [v14 renderedVideoPosterContentURL];
    v136 = 0;
    v47 = [v45 ingestItemAtURL:v46 toURL:v132 type:objc_msgSend(v14 options:"fileIngestionType") capabilities:6 error:{v33, &v136}];
    v48 = v136;

    if (v47)
    {
      v49 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_DEBUG))
      {
        *location = 138412290;
        *&location[4] = v132;
        _os_log_impl(&dword_19BF1F000, v49, OS_LOG_TYPE_DEBUG, "Ingested video poster to %@", location, 0xCu);
      }
    }

    else
    {
      if (PLIsErrorFileNotFound())
      {
LABEL_43:

        goto LABEL_44;
      }

      v49 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_ERROR))
      {
        v63 = [v14 renderedVideoPosterContentURL];
        *location = 138412546;
        *&location[4] = v63;
        v149 = 2112;
        v150 = v48;
        _os_log_impl(&dword_19BF1F000, v49, OS_LOG_TYPE_ERROR, "Nonfatal - error ingesting video poster %@: %@", location, 0x16u);
      }
    }

    goto LABEL_43;
  }

LABEL_81:
  if ([v14 shouldUpdateAttributes])
  {
    v100 = [(PLManagedAsset *)self mainFileURL];
    v101 = [v14 mainFileMetadata];
    v133 = 0;
    v102 = [(PLManagedAsset *)self updateAttributesFromMainFileURL:v100 mainFileMetadata:v101 fullSizeRenderURL:v18 error:&v133];
    v53 = v133;

    if (!v102 || v127)
    {
      if (v102)
      {
        v103 = 1;
        goto LABEL_105;
      }

LABEL_33:
      v54 = v53;
      v55 = v54;
      if (a9)
      {
        v56 = v54;
        v57 = 0;
        *a9 = v55;
      }

      else
      {
        v57 = 0;
      }

      goto LABEL_114;
    }
  }

  else
  {
    v53 = 0;
    v103 = 1;
    if (v127)
    {
      goto LABEL_105;
    }
  }

  if ([v14 shouldUpdateAttributes])
  {
    v104 = [(PLManagedAsset *)self additionalAttributes];
    v105 = [v104 unmanagedAdjustment];

    if (!v105)
    {
LABEL_103:

      goto LABEL_104;
    }

    v128 = [v105 adjustmentRenderTypes];
    v106 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:[(PLManagedAsset *)self updateAdjustmentRenderTypes:v128 withDepthType:[(PLManagedAsset *)self depthType]] withAdjustmentState:[(PLManagedAsset *)self cameraProcessingAdjustmentState]];
    v107 = [v130 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
    v108 = [v130 objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
    v109 = [v130 objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
    v110 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v106 withAdjustmentData:v107 formatIdentifier:v108 formatVersion:v109];

    if (v18)
    {
      if ([(PLManagedAsset *)self isVideo])
      {
        v111 = [MEMORY[0x1E6987E28] assetWithURL:v18];
        if (v111)
        {
          v112 = [(PLManagedAsset *)self playbackVariationFromAVAsset:v111 isLivePhotoVideoComplement:0];
          v113 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v110 withPlaybackVariation:v112];
          if ([(PLManagedAsset *)self playbackVariation]!= v112)
          {
            [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v112];
          }

          v110 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v113 forSpatialTypeOfAVAsset:v111];
        }

        else
        {
          v115 = PLPhotoEditGetLog();
          if (os_log_type_enabled(v115, OS_LOG_TYPE_ERROR))
          {
            *location = 138412290;
            *&location[4] = v18;
            _os_log_impl(&dword_19BF1F000, v115, OS_LOG_TYPE_ERROR, "Unable to create AVAssest from %@", location, 0xCu);
          }

          v111 = 0;
        }
      }

      else
      {
        if (![(PLManagedAsset *)self isPhoto])
        {
          goto LABEL_101;
        }

        v114 = [v126 objectValue];
        v110 = [(PLManagedAsset *)self updateAdjustmentRenderTypes:v110 withMetadata:v114];

        v111 = [v126 objectValue];
        [(PLManagedAsset *)self setSpatialTypeFromMetadata:v111];
      }
    }

LABEL_101:
    if (v128 != v110)
    {
      [v105 setAdjustmentRenderTypes:v110];
    }

    goto LABEL_103;
  }

LABEL_104:
  v116 = [(PLManagedAsset *)self additionalAttributes];
  v117 = [v116 unmanagedAdjustment];

  [(PLManagedAsset *)self _updateAdjustmentFromAssetAdjustment:v129 unmanagedAdjustment:v117 fullSizeRenderURL:v18 options:v14];
  v103 = 0;
LABEL_105:
  if (-[PLManagedAsset isPhoto](self, "isPhoto") && [v14 shouldUpdateAttributes])
  {
    v118 = [v14 mainFileMetadata];
    [(PLManagedAsset *)self updatePanoramosityWithMetadata:v118];
  }

  if ((v103 & 1) != 0 || ![v14 fileIngestionType])
  {
    v57 = 1;
    v55 = v53;
  }

  else
  {
    v119 = [(PLManagedAsset *)self additionalAttributes];
    v120 = [v119 unmanagedAdjustment];

    if ([v120 adjustmentRenderTypes])
    {
      v121 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(v120, "adjustmentRenderTypes")}];
      [v130 setObject:v121 forKey:*MEMORY[0x1E69BF390]];
    }

    [(PLManagedAsset *)self _writeOutAdjustmentsToFile:v130];

    v55 = v53;
    v57 = 1;
  }

LABEL_114:

  return v57;
}

id __163__PLManagedAsset__ingestAndApplyMetadataChangesFromAdjustments_updateAdjustmentDictionary_options_fullSizeRenderURL_videoPosterRenderURL_isRevertToOriginal_error___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  if (WeakRetained)
  {
    v3 = [objc_alloc(MEMORY[0x1E69C0718]) initWithImageURL:*(a1 + 32) contentType:0 options:13 timeZoneLookup:0 cacheImageSource:1 cacheImageData:0];
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (void)_updateDerivativesAndThumbnails:(BOOL)a3 withPreviewImage:(id)a4 thumbnailImage:(id)a5 metadata:(id)a6 didRevertToOriginal:(BOOL)a7 updateInternalResources:(BOOL)a8 isSubstandardRender:(BOOL)a9 isDeferred:(BOOL)a10
{
  v81 = a8;
  v10 = a7;
  v13 = a3;
  v14 = a9;
  v108 = *MEMORY[0x1E69E9840];
  v15 = a4;
  v16 = a5;
  v17 = a6;
  if (v13)
  {
    v18 = [(PLManagedObject *)self photoLibrary];
    v19 = [v18 libraryServicesManager];
    v20 = [v19 modelMigrator];
    v21 = [v20 isPostProcessingLightweightMigration];

    if ((v21 & 1) == 0)
    {
      v73 = v17;
      v75 = v16;
      v79 = v15;
      v77 = v10;
      if (!v10)
      {
        v22 = [MEMORY[0x1E69BF238] fileManager];
        v23 = objc_alloc_init(MEMORY[0x1E695DFA8]);
        v24 = [(PLManagedAsset *)self pathForLargeThumbnailFile];
        [v23 pl_addObjectIfNotNil:v24];

        v25 = [(PLManagedAsset *)self pathForMediumThumbnailFile];
        [v23 pl_addObjectIfNotNil:v25];

        v26 = [(PLManagedAsset *)self pathForLargeSizeImageFile];
        [v23 pl_addObjectIfNotNil:v26];

        v27 = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
        [v23 pl_addObjectIfNotNil:v27];

        v97 = 0u;
        v98 = 0u;
        v95 = 0u;
        v96 = 0u;
        v28 = v23;
        v29 = [v28 countByEnumeratingWithState:&v95 objects:v107 count:16];
        if (v29)
        {
          v30 = v29;
          v31 = *v96;
          do
          {
            for (i = 0; i != v30; ++i)
            {
              if (*v96 != v31)
              {
                objc_enumerationMutation(v28);
              }

              v33 = *(*(&v95 + 1) + 8 * i);
              if ([v22 fileExistsAtPath:v33])
              {
                v34 = PLBackendGetLog();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_INFO))
                {
                  v35 = [(PLManagedAsset *)self uuid];
                  *buf = 138412546;
                  v100 = v33;
                  v101 = 2114;
                  v102 = v35;
                  _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_INFO, "Removing %@ for asset %{public}@", buf, 0x16u);
                }

                v94 = 0;
                v36 = [v22 removeItemAtPath:v33 error:&v94];
                v37 = v94;
                if ((v36 & 1) == 0)
                {
                  v38 = PLBackendGetLog();
                  if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 138412546;
                    v100 = v33;
                    v101 = 2112;
                    v102 = v37;
                    _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_ERROR, "Failed to remove %@: %@", buf, 0x16u);
                  }
                }
              }
            }

            v30 = [v28 countByEnumeratingWithState:&v95 objects:v107 count:16];
          }

          while (v30);
        }
      }

      [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:3];
      [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:4];
      v39 = [(PLManagedAsset *)self modernResources];
      v40 = [v39 objectsPassingTest:&__block_literal_global_1062];

      v92 = 0u;
      v93 = 0u;
      v90 = 0u;
      v91 = 0u;
      v41 = v40;
      v42 = [v41 countByEnumeratingWithState:&v90 objects:v106 count:16];
      if (v42)
      {
        v43 = v42;
        v44 = *v91;
        do
        {
          for (j = 0; j != v43; ++j)
          {
            if (*v91 != v44)
            {
              objc_enumerationMutation(v41);
            }

            v46 = *(*(&v90 + 1) + 8 * j);
            if ([v46 isLocallyAvailable])
            {
              v47 = PLBackendGetLog();
              if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
              {
                v48 = [v46 recipeID];
                v49 = [(PLManagedAsset *)self uuid];
                *buf = 134349314;
                v100 = v48;
                v101 = 2114;
                v102 = v49;
                _os_log_impl(&dword_19BF1F000, v47, OS_LOG_TYPE_INFO, "Marking resource with recipe ID %{public}lu as locally unavailable for asset %{public}@", buf, 0x16u);
              }
            }

            [v46 markAsNotLocallyAvailable];
          }

          v43 = [v41 countByEnumeratingWithState:&v90 objects:v106 count:16];
        }

        while (v43);
      }

      v15 = v79;
      v17 = v73;
      v16 = v75;
      if (![(PLManagedAsset *)self isPlaceholderAsset])
      {
        BYTE2(v72) = 0;
        LOWORD(v72) = 256;
        [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:v79 fromImageSource:v75 imageData:0 metadata:0 forceSRGBConversion:v73 forFinalCameraImage:0 saveCameraPreviewWellImage:v72 reduceProcessingForIngest:?];
      }

      v10 = v77;
      v14 = a9;
    }
  }

  if (v14 && a10 && !v10)
  {
    v74 = v17;
    v76 = v16;
    v78 = v10;
    v80 = v15;
    v88 = 0u;
    v89 = 0u;
    v86 = 0u;
    v87 = 0u;
    v50 = [(PLManagedAsset *)self modernResources];
    v51 = [v50 countByEnumeratingWithState:&v86 objects:v105 count:16];
    if (v51)
    {
      v52 = v51;
      v53 = *v87;
      v54 = 0x1E69BF000uLL;
      v82 = *v87;
      do
      {
        for (k = 0; k != v52; ++k)
        {
          if (*v87 != v53)
          {
            objc_enumerationMutation(v50);
          }

          v56 = *(*(&v86 + 1) + 8 * k);
          if ([v56 isLocallyAvailable] && objc_msgSend(v56, "isAdjustedFullSizeRenderResource"))
          {
            v57 = PLPhotoEditGetLog();
            if (os_log_type_enabled(v57, OS_LOG_TYPE_INFO))
            {
              v58 = [v56 fileURL];
              v59 = [v56 fileURL];
              v60 = [v59 lastPathComponent];
              [(PLManagedAsset *)self uuid];
              v61 = v50;
              v63 = v62 = v54;
              *buf = 138412802;
              v100 = v58;
              v101 = 2114;
              v102 = v60;
              v103 = 2114;
              v104 = v63;
              _os_log_impl(&dword_19BF1F000, v57, OS_LOG_TYPE_INFO, "Removing stale render at path %@ (filename: %{public}@) for asset %{public}@ due to deferred rendering", buf, 0x20u);

              v54 = v62;
              v50 = v61;
              v53 = v82;
            }

            v64 = *(v54 + 568);
            v65 = [v56 fileURL];
            v85 = 0;
            LOBYTE(v64) = [v64 removeItemAtURL:v65 error:&v85];
            v66 = v85;

            if ((v64 & 1) == 0)
            {
              v67 = PLPhotoEditGetLog();
              if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
              {
                v68 = [v56 fileURL];
                *buf = 138543618;
                v100 = v68;
                v101 = 2112;
                v102 = v66;
                _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "Failed to remove %{public}@: %@", buf, 0x16u);
              }
            }

            [v56 markAsNotLocallyAvailable];
          }
        }

        v52 = [v50 countByEnumeratingWithState:&v86 objects:v105 count:16];
      }

      while (v52);
    }

    v15 = v80;
    v10 = v78;
    v17 = v74;
    v16 = v76;
  }

  if (v81)
  {
    [(PLManagedAsset *)self deleteAdjustedResources];
    v84 = 0;
    v69 = [PLResourceInstaller installInternalResourcesForExistingAsset:self assumeNoExistingResources:0 referencedResourceURLs:0 error:&v84];
    v70 = v84;
    if (!v69)
    {
      v71 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v71, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v100 = v70;
        _os_log_impl(&dword_19BF1F000, v71, OS_LOG_TYPE_ERROR, "Unable to install resources after adjustment change: %@", buf, 0xCu);
      }
    }

    if (v10)
    {
      [(PLManagedAsset *)self reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker];
    }
  }
}

uint64_t __166__PLManagedAsset__updateDerivativesAndThumbnails_withPreviewImage_thumbnailImage_metadata_didRevertToOriginal_updateInternalResources_isSubstandardRender_isDeferred___block_invoke(uint64_t a1, void *a2)
{
  v2 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(a2, "recipeID")}];
  v3 = [&unk_1F0FBF490 containsObject:v2];

  return v3;
}

- (void)removeComputeResourceWithRecipeID:(unsigned int)a3 atPath:(id)a4
{
  v18 = *MEMORY[0x1E69E9840];
  v6 = a4;
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __59__PLManagedAsset_removeComputeResourceWithRecipeID_atPath___block_invoke;
  v14[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  v15 = a3;
  v7 = [(PLManagedAsset *)self persistedResourcesMatching:v14];
  v8 = [v7 anyObject];

  if (v8)
  {
    [v8 deleteResource];
  }

  v9 = [MEMORY[0x1E696AC08] defaultManager];
  v13 = 0;
  v10 = [v9 removeItemAtPath:v6 error:&v13];
  v11 = v13;

  if ((v10 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
  {
    v12 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v17 = v6;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Error removing file at path: '%@'", buf, 0xCu);
    }
  }
}

BOOL __59__PLManagedAsset_removeComputeResourceWithRecipeID_atPath___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 recipeID] == *(a1 + 32) && objc_msgSend(v3, "resourceType") == 14;

  return v4;
}

- (void)_removeComputeResourcesOnEdit
{
  v18 = *MEMORY[0x1E69E9840];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v3 = [&unk_1F0FBF478 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v14;
    do
    {
      v6 = 0;
      do
      {
        if (*v14 != v5)
        {
          objc_enumerationMutation(&unk_1F0FBF478);
        }

        v7 = [*(*(&v13 + 1) + 8 * v6) unsignedIntValue];
        if ((v7 - 327687) <= 0xE)
        {
          if (((1 << (v7 - 7)) & 0x5500) != 0)
          {
            v8 = v7;
            v9 = [(PLManagedAsset *)self pathForAlchemistV2ResourceFileWithRecipeID:v7];
            v10 = self;
            v11 = v8;
LABEL_9:
            [(PLManagedAsset *)v10 removeComputeResourceWithRecipeID:v11 atPath:v9];

            goto LABEL_10;
          }

          if (v7 == 327687)
          {
            v9 = [(PLManagedAsset *)self pathForWallpaperComputeResourcesFile];
            v10 = self;
            v11 = 327687;
            goto LABEL_9;
          }

          if (v7 == 327693)
          {
            v9 = [(PLManagedAsset *)self pathForGenerativePlaygroundFaceResourcesFile];
            v11 = 327693;
            v10 = self;
            goto LABEL_9;
          }
        }

LABEL_10:
        ++v6;
      }

      while (v4 != v6);
      v12 = [&unk_1F0FBF478 countByEnumeratingWithState:&v13 objects:v17 count:16];
      v4 = v12;
    }

    while (v12);
  }
}

- (void)setAdjustments:(id)a3 options:(id)a4
{
  v199 = *MEMORY[0x1E69E9840];
  v168 = a3;
  v169 = a4;
  v170 = self;
  if ([(PLManagedAsset *)self isVideo]|| [(PLManagedAsset *)self isPhoto])
  {
    oslog = [v168 adjustmentFormatIdentifier];
    v166 = [v168 adjustmentFormatVersion];
    v6 = [v169 fileIngestionType];
    if (![(PLManagedAsset *)self hasAdjustments]&& !oslog)
    {
LABEL_190:

      goto LABEL_191;
    }

    v7 = v6 == 0;
    v165 = [v168 adjustmentTimestamp];
    if (!v165)
    {
      v165 = [MEMORY[0x1E695DF00] date];
      [v168 setAdjustmentTimestamp:v165];
      v7 = 0;
    }

    obj = objc_opt_class();
    objc_sync_enter(obj);
    v161 = [MEMORY[0x1E69BF238] fileManager];
    v186 = 0;
    v187 = &v186;
    v188 = 0x2020000000;
    v189 = 0;
    v158 = [MEMORY[0x1E69BF320] UUIDString];
    v8 = PLImageManagerGetLog();
    spid = os_signpost_id_generate(v8);
    v9 = v8;

    v10 = v9;
    v11 = v10;
    if (spid - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v10))
    {
      *buf = 138543362;
      *&buf[4] = v158;
      _os_signpost_emit_with_name_impl(&dword_19BF1F000, v11, OS_SIGNPOST_INTERVAL_BEGIN, spid, "AssetSetAdjustments", "adjustmentUuid = %{public}@", buf, 0xCu);
    }

    v155 = v11;
    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v196 = __Block_byref_object_copy__14821;
    v197 = __Block_byref_object_dispose__14822;
    v198 = 0;
    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      v12 = objc_alloc(MEMORY[0x1E69BF298]);
      v13 = [(PLManagedAsset *)self uuid];
      v14 = [(PLManagedAsset *)self bundleScope];
      v15 = [*MEMORY[0x1E6982F68] identifier];
      v16 = [v12 initWithAssetUuid:v13 bundleScope:v14 uti:v15 resourceVersion:2 resourceType:31];

      v17 = [(PLManagedObject *)self pathManager];
      v182[0] = MEMORY[0x1E69E9820];
      v182[1] = 3221225472;
      v182[2] = __41__PLManagedAsset_setAdjustments_options___block_invoke;
      v182[3] = &unk_1E75678B0;
      v184 = buf;
      v185 = &v186;
      v183 = v161;
      [v17 obtainAccessAndWaitWithFileWithIdentifier:v16 mode:2 toURLWithHandler:v182];

      v156 = 0;
      v18 = v183;
    }

    else
    {
      v20 = [(PLManagedAsset *)self pathForAdjustmentDirectory];
      v21 = [(__CFString *)v20 stringByAppendingPathComponent:@"in_flight"];
      v156 = v20;
      v22 = *(*&buf[8] + 40);
      *(*&buf[8] + 40) = v21;

      if (v7)
      {
        goto LABEL_21;
      }

      v181 = 0;
      v23 = [v161 createDirectoryAtPath:v20 withIntermediateDirectories:1 attributes:0 error:&v181];
      v16 = v181;
      if ((v23 & 1) == 0)
      {
        v24 = PLBackendGetLog();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          *v191 = 138412546;
          v192 = v156;
          v193 = 2112;
          v194 = v16;
          _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Failed to create directory at %@: %@", v191, 0x16u);
        }
      }

      v25 = *(*&buf[8] + 40);
      v18 = [MEMORY[0x1E695DEF0] data];
      v26 = [v161 createFileAtPath:v25 contents:v18 attributes:0];
      *(v187 + 24) = v26;
    }

LABEL_21:
    v164 = [MEMORY[0x1E695DF90] dictionary];
    v27 = objc_opt_class();
    v28 = [v169 renderedContentURL];
    v29 = [v28 pathExtension];
    v159 = [v27 uniformTypeIdentifierFromPathExtension:v29 assetType:{-[PLManagedAsset kind](self, "kind")}];

    v163 = [(PLManagedAsset *)self pathForFullsizeRenderImageFileWithUTI:v159];
    if (oslog)
    {
      v30 = v166 == 0;
    }

    else
    {
      v30 = 1;
    }

    v31 = !v30;
    v162 = v31;
    if (!v30)
    {
      if ([v169 isDeferred])
      {
        v32 = [(PLManagedAsset *)self deferredProcessingNeeded];
        if (v32 <= 9 && ((1 << v32) & 0x315) != 0 && ![(PLManagedAsset *)self isPhotoIrisPlaceholder])
        {
          [(PLManagedAsset *)self setDeferredProcessingNeeded:2];
          v33 = [(PLManagedObject *)self photoLibrary];
          v34 = [v33 libraryServicesManager];
          v35 = [v34 backgroundJobService];
          v36 = [(PLManagedObject *)self photoLibrary];
          v37 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
          [v35 signalBackgroundProcessingNeededOnLibrary:v36 workerTypes:v37];
        }
      }

      else if ([(PLManagedAsset *)self deferredProcessingNeeded]== 2 || [(PLManagedAsset *)self deferredProcessingNeeded]== 9)
      {
        [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
      }

      v49 = [(PLManagedAsset *)self additionalAttributes];
      v50 = [v49 unmanagedAdjustment];

      if (!v50)
      {
        v51 = [(PLManagedAsset *)self managedObjectContext];
        v50 = [(PLManagedObject *)PLUnmanagedAdjustment insertInManagedObjectContext:v51];

        v52 = [(PLManagedAsset *)self additionalAttributes];
        [v52 setUnmanagedAdjustment:v50];
      }

      [(__CFString *)v50 setUuid:v158];
      if ([v169 isSubstandardRender])
      {
        if ([v169 isDeferred])
        {
          [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
        }

        else
        {
          [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
        }
        v53 = ;

        v74 = PLBackendGetLog();
        if (os_log_type_enabled(v74, OS_LOG_TYPE_INFO))
        {
          v75 = [v169 isDeferred];
          v76 = @"NO";
          if (v75)
          {
            v76 = @"YES";
          }

          *v191 = 138412546;
          v192 = v53;
          v193 = 2112;
          v194 = v76;
          _os_log_impl(&dword_19BF1F000, v74, OS_LOG_TYPE_INFO, "Updating destinationPathForRenderedImageContent to substandardRender path: %@ deferred: %@", v191, 0x16u);
        }
      }

      else
      {
        v53 = v163;
      }

      v77 = +[PLManagedAsset adjustmentBaseVersionFromPFAdjustmentsBaseVersion:](PLManagedAsset, "adjustmentBaseVersionFromPFAdjustmentsBaseVersion:", [v168 adjustmentBaseVersion]);
      v78 = [v169 renderedContentURL];
      v79 = v78 == 0;

      if (!v79 && !v7)
      {
        v80 = [v169 penultimateRenderedJPEGData];
        v81 = [v169 penultimateRenderedVideoContentURL];
        v82 = [v169 penultimateRenderedVideoComplementContentURL];
        v77 = -[PLManagedAsset _prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:penultimateRenderedJPEGData:penultimateRenderedVideoContentURL:penultimateRenderedVideoComplementContentURL:fileIngestionType:](self, "_prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:penultimateRenderedJPEGData:penultimateRenderedVideoContentURL:penultimateRenderedVideoComplementContentURL:fileIngestionType:", v77, v80, v81, v82, [v169 fileIngestionType]);
      }

      v83 = [v168 editorBundleID];
      v84 = v83;
      v85 = &stru_1F0F06D80;
      if (v83)
      {
        v85 = v83;
      }

      v86 = v85;

      if (!v7)
      {
        [v164 setObject:oslog forKey:*MEMORY[0x1E69BF380]];
        [v164 setObject:v166 forKey:*MEMORY[0x1E69BF388]];
        v87 = [MEMORY[0x1E696AD98] numberWithInteger:v77];
        [v164 setObject:v87 forKey:*MEMORY[0x1E69BF368]];

        [v164 setObject:v86 forKey:*MEMORY[0x1E69BF378]];
        [v164 setObject:v165 forKey:*MEMORY[0x1E69BF398]];
        v88 = [v168 adjustmentData];
        if (v88)
        {
          [v164 setObject:v88 forKey:*MEMORY[0x1E69BF370]];
        }
      }

      [(PLManagedAsset *)self setEditorBundleID:v86];
      v89 = [v168 adjustmentRenderTypes];
      [(PLManagedAsset *)self setAssetAdjustmentsStateFromAdjustmentRenderType:v89];
      [(__CFString *)v50 setAdjustmentRenderTypes:v89];
      [(__CFString *)v50 setAdjustmentFormatIdentifier:oslog];
      [(__CFString *)v50 setAdjustmentFormatVersion:v166];
      v90 = [MEMORY[0x1E696AD98] numberWithInteger:v77];
      [(__CFString *)v50 setAdjustmentBaseImageFormat:v90];

      [(__CFString *)v50 setAdjustmentTimestamp:v165];
      v91 = SBSCopyLocalizedApplicationNameForDisplayIdentifier();
      [(__CFString *)v50 setEditorLocalizedName:v91];
      v92 = PLBackendGetLog();
      if (os_log_type_enabled(v92, OS_LOG_TYPE_INFO))
      {
        v93 = [(PLManagedAsset *)v170 uuid];
        *v191 = 138412546;
        v192 = v50;
        v193 = 2114;
        v194 = v93;
        _os_log_impl(&dword_19BF1F000, v92, OS_LOG_TYPE_INFO, "Setting unmanaged adjustment %@ to asset %{public}@", v191, 0x16u);
      }

      if ([(PLManagedAsset *)v170 isPhoto])
      {
        v94 = [v169 penultimateRenderedJPEGData];
        if (v94)
        {
          v95 = [v169 penultimateRenderedJPEGData];
          v96 = v95;
        }

        else
        {
          v100 = MEMORY[0x1E695DEF0];
          v95 = [(PLManagedAsset *)v170 pathForPenultimateFullsizeRenderImageFile];
          v96 = [v100 dataWithContentsOfFile:v95];
        }

        v101 = objc_opt_class();
        v99 = [v168 adjustmentData];
        v102 = [v101 cloudAdjustmentFingerprintWithAdjustmentDataBlob:v99 formatIdentifier:oslog formatVersion:v166 editorBundleID:v86 baseVersion:v77 baseImageData:v96];
      }

      else
      {
        v97 = [v169 penultimateRenderedVideoContentURL];
        if (v97)
        {
          v98 = [v169 penultimateRenderedVideoContentURL];
          v99 = v98;
        }

        else
        {
          v103 = MEMORY[0x1E695DFF8];
          v98 = [(PLManagedAsset *)v170 pathForPenultimateFullsizeRenderVideoFile];
          v99 = [v103 fileURLWithPath:v98];
        }

        v104 = [(__CFString *)v99 path];
        v105 = [v161 fileExistsAtPath:v104];

        if (v105)
        {
          v106 = [MEMORY[0x1E6994AE0] nonPrivateFingerprintScheme];
          v180 = 0;
          v96 = [v106 fingerPrintForFileAtURL:v99 error:&v180];
          v107 = v180;

          if (!v96)
          {
            v108 = PLBackendGetLog();
            if (os_log_type_enabled(v108, OS_LOG_TYPE_ERROR))
            {
              *v191 = 138412546;
              v192 = v99;
              v193 = 2112;
              v194 = v107;
              _os_log_impl(&dword_19BF1F000, v108, OS_LOG_TYPE_ERROR, "Failed to calculate base fingerprint for penultimate video at url: %@, error: %@", v191, 0x16u);
            }
          }
        }

        else
        {
          v96 = 0;
        }

        v109 = objc_opt_class();
        v110 = [v168 adjustmentData];
        v102 = [v109 cloudAdjustmentFingerprintWithAdjustmentDataBlob:v110 formatIdentifier:oslog formatVersion:v166 editorBundleID:v86 baseVersion:v77 baseFingerprint:v96];
      }

      v111 = PLBackendGetLog();
      if (os_log_type_enabled(v111, OS_LOG_TYPE_INFO))
      {
        *v191 = 138412290;
        v192 = v102;
        _os_log_impl(&dword_19BF1F000, v111, OS_LOG_TYPE_INFO, "Calculating cloud adjustment fingerprint at set time: %@", v191, 0xCu);
      }

      [(__CFString *)v50 setOtherAdjustmentsFingerprint:v102];
      v163 = v53;
      goto LABEL_126;
    }

    if ([v169 isDeferred])
    {
      v38 = PLBackendGetLog();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        v39 = [(PLManagedAsset *)self uuid];
        *v191 = 138543362;
        v192 = v39;
        _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_ERROR, "Unsupported adjustment, revert and deferred are incompatible for asset %{public}@", v191, 0xCu);
      }
    }

    [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
    [(PLManagedAsset *)self deleteAdjustedResources];
    if (v7)
    {
LABEL_69:
      [(PLManagedAsset *)v170 setEditorBundleID:0];
      [(PLManagedAsset *)v170 setAdjustmentsState:0];
      v61 = [(PLManagedAsset *)v170 additionalAttributes];
      v50 = [v61 unmanagedAdjustment];

      v62 = PLBackendGetLog();
      if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
      {
        v63 = [(PLManagedAsset *)v170 uuid];
        *v191 = 138412546;
        v192 = v50;
        v193 = 2114;
        v194 = v63;
        _os_log_impl(&dword_19BF1F000, v62, OS_LOG_TYPE_INFO, "Reverting unmanaged adjustment %@ for asset %{public}@", v191, 0x16u);
      }

      v64 = PLPhotosStatusGetLog();
      if (os_log_type_enabled(v64, OS_LOG_TYPE_DEFAULT))
      {
        v65 = [(PLManagedAsset *)v170 uuid];
        *v191 = 138412546;
        v192 = v50;
        v193 = 2114;
        v194 = v65;
        _os_log_impl(&dword_19BF1F000, v64, OS_LOG_TYPE_DEFAULT, "Reverting unmanaged adjustment %@ for asset %{public}@", v191, 0x16u);
      }

      v66 = PLPhotosStatusGetLog();
      if (os_log_type_enabled(v66, OS_LOG_TYPE_DEFAULT))
      {
        v67 = [MEMORY[0x1E696AF00] callStackSymbols];
        *v191 = 138412290;
        v192 = v67;
        _os_log_impl(&dword_19BF1F000, v66, OS_LOG_TYPE_DEFAULT, "%@", v191, 0xCu);
      }

      if (v50)
      {
        [(__CFString *)v50 setAdjustmentFormatIdentifier:0];
        [(__CFString *)v50 setAdjustmentFormatVersion:0];
        [(__CFString *)v50 setAdjustmentTimestamp:v165];
        [(__CFString *)v50 setAdjustmentRenderTypes:0];
        [(__CFString *)v50 setOtherAdjustmentsFingerprint:0];
        [(__CFString *)v50 setAdjustmentBaseImageFormat:&unk_1F0FBB248];
      }

      if (-[PLManagedAsset isPhotoIris](v170, "isPhotoIris") && [v169 shouldUpdateAttributes])
      {
        if ([(PLManagedAsset *)v170 playbackStyle]!= 3)
        {
          [(PLManagedAsset *)v170 setPlaybackStyle:3];
        }

        v68 = [(PLManagedAsset *)v170 pathForVideoComplementFile];
        v69 = MEMORY[0x1E6987E28];
        v70 = [MEMORY[0x1E695DFF8] fileURLWithPath:v68];
        v71 = [v69 assetWithURL:v70];

        if (v71)
        {
          v72 = PLBackendGetLog();
          if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
          {
            v73 = [(PLManagedAsset *)v170 uuid];
            *v191 = 138543618;
            v192 = v73;
            v193 = 2112;
            v194 = v68;
            _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_INFO, "Updating Live Photo properties for asset %{public}@ from %@", v191, 0x16u);
          }

          [(PLManagedAsset *)v170 _updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:v71];
          [(PLManagedAsset *)v170 updatePlaybackVariationAndLoopingStyleFromAVAsset:v71];
        }

        else
        {
          v112 = PLBackendGetLog();
          if (os_log_type_enabled(v112, OS_LOG_TYPE_ERROR))
          {
            v113 = [(PLManagedAsset *)v170 uuid];
            *v191 = 138412546;
            v192 = v68;
            v193 = 2114;
            v194 = v113;
            _os_log_impl(&dword_19BF1F000, v112, OS_LOG_TYPE_ERROR, "Failed to create avAsset from %@ to update Live Photo properties for asset %{public}@", v191, 0x16u);
          }
        }
      }

      if (![(PLManagedAsset *)v170 isPhoto])
      {
LABEL_127:

        if (-[PLManagedAsset isPhoto](v170, "isPhoto") || [v169 isDeferred])
        {
          v114 = 0;
          if (v163 && oslog && v166)
          {
            v114 = [MEMORY[0x1E695DFF8] fileURLWithPath:v163 isDirectory:0];
          }

          if ([(PLManagedAsset *)v170 isVideo])
          {
            v115 = [v169 renderedVideoPosterContentURL];
            v116 = v115 == 0;

            if (!v116)
            {
              v117 = MEMORY[0x1E695DFF8];
              v118 = [(PLManagedAsset *)v170 pathForTransientVideoPosterFramePreview];
              v119 = [v117 fileURLWithPath:v118];

              goto LABEL_141;
            }
          }
        }

        else
        {
          v120 = [v169 renderedContentURL];
          if (v120)
          {
            v121 = [(PLManagedAsset *)v170 isVideo];

            if (v121)
            {
              v114 = [(PLManagedAsset *)v170 fileURLForFullsizeRenderVideo];
              v119 = [(PLManagedAsset *)v170 fileURLForFullsizeRenderImage];
              goto LABEL_141;
            }
          }

          v114 = 0;
        }

        v119 = 0;
LABEL_141:
        [(PLManagedAsset *)v170 _ingestAndApplyMetadataChangesFromAdjustments:v168 updateAdjustmentDictionary:v164 options:v169 fullSizeRenderURL:v114 videoPosterRenderURL:v119 isRevertToOriginal:v162 ^ 1u error:0];
        v122 = v155;
        v123 = v122;
        if (spid - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v122))
        {
          *v191 = 0;
          _os_signpost_emit_with_name_impl(&dword_19BF1F000, v123, OS_SIGNPOST_INTERVAL_END, spid, "AssetSetAdjustments", "", v191, 2u);
        }

        v124 = [MEMORY[0x1E695DF00] date];
        [(PLManagedAsset *)v170 setModificationDate:v124];

        if ([v169 shouldOverwriteFullSizeRenderSize])
        {
          [v169 fullSizeRenderSize];
          [(PLManagedAsset *)v170 setWidth:v125];
          [v169 fullSizeRenderSize];
          [(PLManagedAsset *)v170 setHeight:v126];
          if ([(PLManagedAsset *)v170 isPhoto])
          {
            v127 = [v169 mainFileMetadata];
            [(PLManagedAsset *)v170 updatePanoramosityWithMetadata:v127];
          }
        }

        if (-[PLManagedAsset isVideo](v170, "isVideo") && (([v169 isSubstandardRender] & 1) != 0 || objc_msgSend(v169, "isDeferred")))
        {
          [v169 fullSizeRenderDuration];
          if (((v128 & 0x7FFFFFFFFFFFFFFFuLL) - 0x10000000000000) >> 53 <= 0x3FE)
          {
            [v169 fullSizeRenderDuration];
            [(PLManagedAsset *)v170 setDuration:?];
          }
        }

        if ((v162 & 1) == 0 && [(PLManagedAsset *)v170 kindSubtype]== 101)
        {
          v129 = [v169 mainFileMetadata];
          [(PLManagedAsset *)v170 setDefaultAdjustmentsIfNecessaryWithMainFileMetadata:v129];
        }

        if (*(v187 + 24) == 1)
        {
          [v161 removeItemAtPath:*(*&buf[8] + 40) error:0];
        }

        _Block_object_dispose(buf, 8);
        _Block_object_dispose(&v186, 8);

        objc_sync_exit(obj);
        if (-[PLManagedAsset isVideo](v170, "isVideo") && (([v169 isDeferred] & 1) != 0 || objc_msgSend(v169, "shouldUpdateAttributes")))
        {
          [(PLManagedAsset *)v170 pruneLocalVideoKeyFrameImage];
        }

        [(PLManagedAsset *)v170 _removeComputeResourcesOnEdit];
        if (![v169 isDeferred] || (objc_msgSend(v169, "isSubstandardRender") & 1) != 0 || objc_msgSend(v169, "shouldGenerateThumbnails"))
        {
          if ([(PLManagedAsset *)v170 isVideo])
          {
            if ([v169 isDeferred])
            {
              v130 = MEMORY[0x1E695DFF8];
              v131 = [(PLManagedAsset *)v170 pathForTransientVideoPosterFramePreview];
              v132 = [v130 fileURLWithPath:v131];
            }

            else
            {
              v131 = [(PLManagedAsset *)v170 fileURLForFullsizeRenderImage];
              v132 = v131;
            }

            v135 = v132;
            v136 = v135;
            if (!v135)
            {
              v137 = PLPhotoEditGetLog();
              if (os_log_type_enabled(v137, OS_LOG_TYPE_DEBUG))
              {
                *buf = 0;
                _os_log_impl(&dword_19BF1F000, v137, OS_LOG_TYPE_DEBUG, "No custom video poster provided, default to standard preview image", buf, 2u);
              }

              v138 = MEMORY[0x1E695DFF8];
              v139 = [(PLManagedAsset *)v170 pathForAsyncAdjustedRenderPreviewImageFile];
              v136 = [v138 fileURLWithPath:v139];
            }

            v133 = CGImageSourceCreateWithURL(v136, 0);
            if (v133)
            {
              v140 = PLPhotoEditGetLog();
              if (os_log_type_enabled(v140, OS_LOG_TYPE_INFO))
              {
                v141 = [(PLManagedAsset *)v170 uuid];
                *buf = 138412546;
                *&buf[4] = v136;
                *&buf[12] = 2114;
                *&buf[14] = v141;
                _os_log_impl(&dword_19BF1F000, v140, OS_LOG_TYPE_INFO, "Creating thumbnail image from %@ for video asset %{public}@", buf, 0x16u);
              }

              v171 = 0;
              v172 = 0;
              [PLManagedAsset createThumbnailImage:&v172 previewImage:&v171 withToBeReleasedImageSource:v133];
              v134 = v172;
              v133 = v171;
            }

            else
            {
              v134 = 0;
            }
          }

          else
          {
            v133 = 0;
            v134 = 0;
          }

          v142 = PLImageManagerGetLog();
          v143 = os_signpost_id_generate(v142);
          v144 = v142;

          v145 = v144;
          v146 = v145;
          if (v143 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v145))
          {
            *buf = 0;
            _os_signpost_emit_with_name_impl(&dword_19BF1F000, v146, OS_SIGNPOST_INTERVAL_BEGIN, v143, "UpdateDerivativeAndThumbnailAdjustments", "Begin potential updates on derivatives and thumbnails after setting adjustments.", buf, 2u);
          }

          v147 = v146;
          v148 = [v169 shouldGenerateThumbnails];
          v149 = [v169 mainFileMetadata];
          if ([v169 shouldUpdateAttributes])
          {
            v150 = 1;
          }

          else
          {
            v150 = [v169 isDeferred];
          }

          v151 = [v169 isSubstandardRender];
          BYTE1(v154) = [v169 isDeferred];
          LOBYTE(v154) = v151;
          [(PLManagedAsset *)v170 _updateDerivativesAndThumbnails:v148 withPreviewImage:v133 thumbnailImage:v134 metadata:v149 didRevertToOriginal:v162 ^ 1u updateInternalResources:v150 isSubstandardRender:v154 isDeferred:?];

          v152 = v147;
          v153 = v152;
          if (v143 - 1 < 0xFFFFFFFFFFFFFFFELL && os_signpost_enabled(v152))
          {
            *buf = 0;
            _os_signpost_emit_with_name_impl(&dword_19BF1F000, v153, OS_SIGNPOST_INTERVAL_END, v143, "UpdateDerivativeAndThumbnailAdjustments", "", buf, 2u);
          }
        }

        goto LABEL_190;
      }

      v86 = [(PLManagedAsset *)v170 metadataFromMediaPropertiesOrOriginalResource];
      [(PLManagedAsset *)v170 setDepthTypeFromMetadata:v86];
      [(PLManagedAsset *)v170 setSpatialTypeFromMetadata:v86];
      [(PLManagedAsset *)v170 updateImageExtendedGenerativeAttributesFromMetadata:v86];
      [(PLManagedAsset *)v170 setCurrentSleetCastFromMetadata:v86];
LABEL_126:

      goto LABEL_127;
    }

    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      v178 = 0u;
      v179 = 0u;
      v176 = 0u;
      v177 = 0u;
      v40 = [(PLManagedAsset *)self adjustedFileURLs];
      v41 = 0;
      v42 = [v40 countByEnumeratingWithState:&v176 objects:v190 count:16];
      if (v42)
      {
        v43 = *v177;
        do
        {
          for (i = 0; i != v42; ++i)
          {
            if (*v177 != v43)
            {
              objc_enumerationMutation(v40);
            }

            v45 = *(*(&v176 + 1) + 8 * i);
            v175 = v41;
            v46 = [MEMORY[0x1E69BF238] removeItemAtURL:v45 error:&v175];
            v47 = v175;

            v41 = v47;
            if ((v46 & 1) == 0)
            {
              v48 = PLBackendGetLog();
              if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
              {
                *v191 = 138412546;
                v192 = v45;
                v193 = 2112;
                v194 = v41;
                _os_log_impl(&dword_19BF1F000, v48, OS_LOG_TYPE_ERROR, "Failed to remove adjusted resource %@: %@", v191, 0x16u);
              }
            }
          }

          v42 = [v40 countByEnumeratingWithState:&v176 objects:v190 count:16];
        }

        while (v42);
      }
    }

    else
    {
      v174 = 0;
      v54 = [MEMORY[0x1E69BF238] removeItemAtPath:v156 error:&v174];
      v41 = v174;
      if (v54)
      {
LABEL_64:
        v55 = [(PLManagedObject *)v170 pathManager];
        v56 = [(PLManagedAsset *)v170 uuid];
        v57 = [v55 URLForPartialVideoDirectoryWithAssetUUID:v56];

        v173 = v41;
        LOBYTE(v56) = [MEMORY[0x1E69BF238] removeItemAtURL:v57 error:&v173];
        v58 = v173;

        if ((v56 & 1) == 0)
        {
          v59 = PLBackendGetLog();
          if (os_log_type_enabled(v59, OS_LOG_TYPE_ERROR))
          {
            v60 = [(PLManagedAsset *)v170 uuid];
            *v191 = 138543618;
            v192 = v60;
            v193 = 2112;
            v194 = v58;
            _os_log_impl(&dword_19BF1F000, v59, OS_LOG_TYPE_ERROR, "Failed to remove partial video directory for assetUUID %{public}@: %@", v191, 0x16u);
          }
        }

        goto LABEL_69;
      }

      v40 = PLBackendGetLog();
      if (os_log_type_enabled(v40, OS_LOG_TYPE_ERROR))
      {
        *v191 = 138412546;
        v192 = v156;
        v193 = 2112;
        v194 = v41;
        _os_log_impl(&dword_19BF1F000, v40, OS_LOG_TYPE_ERROR, "Failed to remove adjustment directory %@: %@", v191, 0x16u);
      }
    }

    goto LABEL_64;
  }

  oslog = PLPhotoEditGetLog();
  if (os_log_type_enabled(oslog, OS_LOG_TYPE_ERROR))
  {
    v19 = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    *&buf[4] = v19;
    _os_log_impl(&dword_19BF1F000, oslog, OS_LOG_TYPE_ERROR, "setAdjustments for non-photo non-video asset %{public}@ is invalid", buf, 0xCu);
  }

LABEL_191:
}

void __41__PLManagedAsset_setAdjustments_options___block_invoke(void *a1, void *a2, void *a3)
{
  v17 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (a2)
  {
    v6 = [a2 path];
    v7 = [v6 stringByDeletingPathExtension];
    v8 = [v7 stringByAppendingPathExtension:@"in_flight"];
    v9 = *(a1[5] + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;

    v11 = a1[4];
    v12 = *(*(a1[5] + 8) + 40);
    v13 = [MEMORY[0x1E695DEF0] data];
    *(*(a1[6] + 8) + 24) = [v11 createFileAtPath:v12 contents:v13 attributes:0];
  }

  else
  {
    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = 138412290;
      v16 = v5;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Failed to obtain the adjustment marker path. Error: %@", &v15, 0xCu);
    }
  }
}

- (void)_writeOutAdjustmentsToFile:(id)a3
{
  v27 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v18 = 0;
  v5 = [MEMORY[0x1E696AE40] dataWithPropertyList:v4 format:100 options:0 error:&v18];
  v6 = v18;
  if (!v5 || (-[PLManagedAsset pathForAdjustmentFile](self, "pathForAdjustmentFile"), v7 = objc_claimAutoreleasedReturnValue(), v17 = v6, v8 = [v5 writeToFile:v7 options:1073741825 error:&v17], v9 = v17, v6, v7, v6 = v9, (v8 & 1) == 0))
  {
    v10 = *MEMORY[0x1E69BF370];
    v11 = [v4 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
    v12 = v11;
    if (v11)
    {
      v13 = [MEMORY[0x1E696AEC0] stringWithFormat:@"<%lu bytes>", objc_msgSend(v11, "length")];
      [v4 setObject:v13 forKeyedSubscript:v10];
    }

    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = [(PLManagedAsset *)self pathForAdjustmentFile];
      v16 = @"write failed";
      *buf = 138413058;
      v20 = v15;
      if (!v5)
      {
        v16 = @"unable to encode dictionary as data";
      }

      v21 = 2112;
      v22 = v4;
      v23 = 2112;
      v24 = v16;
      v25 = 2112;
      v26 = v6;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Failed to create adjustment file %@ from adjustment dictionary %@ (%@): %@", buf, 0x2Au);
    }
  }
}

- (void)updateAdjustmentFileWithAdjustmentRenderTypes:(unsigned int)a3
{
  v3 = *&a3;
  v18 = *MEMORY[0x1E69E9840];
  v5 = objc_alloc(MEMORY[0x1E695DEF0]);
  v6 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v7 = [v5 initWithContentsOfFile:v6];

  if (v7)
  {
    v13 = 0;
    v8 = [MEMORY[0x1E696AE40] propertyListWithData:v7 options:0 format:0 error:&v13];
    v9 = v13;
    if (v8)
    {
      v10 = [v8 mutableCopy];
      v11 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v3];
      [v10 setObject:v11 forKey:*MEMORY[0x1E69BF390]];

      [(PLManagedAsset *)self _writeOutAdjustmentsToFile:v10];
    }

    else
    {
      v10 = PLBackendGetLog();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v12 = [(PLManagedAsset *)self pathForAdjustmentFile];
        *buf = 138412546;
        v15 = v12;
        v16 = 2112;
        v17 = v9;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "Failed to read adjustment file %@, %@", buf, 0x16u);
      }
    }
  }
}

- (unsigned)_calculateRenderTypeAdditionalFlagCheckAndUpdateIfNeededUnmanagedAdjustment:(id)a3 options:(id)a4 hasAdjustments:(BOOL)a5
{
  v5 = a5;
  v8 = a3;
  v9 = a4;
  if ([(PLManagedAsset *)self isPhoto])
  {
    if ([v9 skipCheckSleetCastAdjustment])
    {
      v10 = 4;
    }

    else
    {
      v10 = 6;
    }

    if (!v5)
    {
      goto LABEL_14;
    }
  }

  else
  {
    v10 = 0;
    if (!v5)
    {
      goto LABEL_14;
    }
  }

  if ([v9 shouldCheckForLegacyCameraAutoAdjustment] && (objc_msgSend(v9, "skipCheckCameraAutoAdjustment") & 1) == 0)
  {
    if ([(PLManagedAsset *)self _isCameraAutoAdjustmentChecksNeededAndUpdateAsset])
    {
      v10 |= 1u;
    }

    else if (([v8 adjustmentRenderTypes] & 0x4000) == 0)
    {
      [v8 setAdjustmentRenderTypes:{objc_msgSend(v8, "adjustmentRenderTypes") | 0x4000}];
    }
  }

LABEL_14:

  return v10;
}

- (void)_processRenderTypeUpdateForGenerativeEditsWithUnmanagedAdjustment:(id)a3 fullSizeRenderURL:(id)a4 hasAdjustments:(BOOL)a5
{
  if (a5)
  {
    v6 = [(PLManagedAsset *)self fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:a4];
    [(PLManagedAsset *)self updateImageExtendedGenerativeAttributesFromMetadata:v6];
  }
}

- (void)_processRenderTypeUpdateForSleetCastWithUnmanagedAdjustment:(id)a3 fullSizeRenderURL:(id)a4 settingPayload:(id)a5 hasAdjustments:(BOOL)a6
{
  v6 = a6;
  v14 = a3;
  v10 = a4;
  v11 = a5;
  if (v6 && ([v14 adjustmentRenderTypes] & 0x8000) != 0)
  {
    v13 = [v11 objectForKeyedSubscript:*MEMORY[0x1E69C0960]];
    -[PLManagedAsset setCurrentSleetCast:](self, "setCurrentSleetCast:", [v13 shortValue]);
  }

  else
  {
    v12 = [(PLManagedAsset *)self fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:v10];
    if (v12)
    {
      v13 = v12;
      [(PLManagedAsset *)self setCurrentSleetCastFromMetadata:v12];
    }

    else
    {
      if ([(PLManagedAsset *)self currentSleetCast])
      {
        [(PLManagedAsset *)self setCurrentSleetCast:0];
      }

      v13 = 0;
    }
  }
}

- (void)_processRenderTypeUpdateForCameraAutoWithUnmanagedAdjustment:(id)a3 options:(id)a4 hasAdjustments:(BOOL)a5 updateRenderFlagsResult:(BOOL)a6
{
  v6 = a6;
  v7 = a5;
  v12 = a3;
  v10 = a4;
  v11 = v10;
  if (v7 && ([v10 skipCheckCameraAutoAdjustment] & 1) == 0)
  {
    if (v6)
    {
      -[PLManagedAsset setAssetAdjustmentsStateFromAdjustmentRenderType:](self, "setAssetAdjustmentsStateFromAdjustmentRenderType:", [v12 adjustmentRenderTypes]);
    }

    else if (([v11 shouldCheckForLegacyCameraAutoAdjustment] & 1) == 0 && (objc_msgSend(v12, "adjustmentRenderTypes") & 0x4000) == 0)
    {
      [v12 setAdjustmentRenderTypes:{objc_msgSend(v12, "adjustmentRenderTypes") | 0x4000}];
    }
  }
}

- (void)_updateAdjustmentFromAssetAdjustment:(id)a3 unmanagedAdjustment:(id)a4 fullSizeRenderURL:(id)a5 options:(id)a6
{
  v16 = a4;
  v10 = a5;
  v11 = a6;
  v12 = a3;
  v13 = [(PLManagedAsset *)self _calculateRenderTypeAdditionalFlagCheckAndUpdateIfNeededUnmanagedAdjustment:v16 options:v11 hasAdjustments:a3 != 0];
  v14 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v15 = [v16 updateRenderTypeFlagsForAssetAdjustments:v12 checkFlag:v13 settingPayload:v14];

  [(PLManagedAsset *)self _processRenderTypeUpdateForCameraAutoWithUnmanagedAdjustment:v16 options:v11 hasAdjustments:a3 != 0 updateRenderFlagsResult:v15];
  if ((v13 & 2) != 0)
  {
    [(PLManagedAsset *)self _processRenderTypeUpdateForSleetCastWithUnmanagedAdjustment:v16 fullSizeRenderURL:v10 settingPayload:v14 hasAdjustments:a3 != 0];
  }

  if ((v13 & 4) != 0)
  {
    [(PLManagedAsset *)self _processRenderTypeUpdateForGenerativeEditsWithUnmanagedAdjustment:v16 fullSizeRenderURL:v10 hasAdjustments:a3 != 0];
  }
}

- (BOOL)_isCameraAutoAdjustmentChecksNeededAndUpdateAsset
{
  if ([(PLManagedAsset *)self adjustmentsState]== 3)
  {
    return 0;
  }

  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 unmanagedAdjustment];

  if (!v5)
  {
    if ([(PLManagedAsset *)self adjustmentsState])
    {
      [(PLManagedAsset *)self setAdjustmentsState:0];
    }

    return 0;
  }

  v6 = [v5 adjustmentFormatVersion];
  v3 = [v6 compare:*MEMORY[0x1E69C0E60] options:64] < 0 || -[PLManagedAsset adjustmentsState](self, "adjustmentsState") == 1;

  return v3;
}

- (void)setAssetAdjustmentsStateFromAdjustmentRenderType:(unsigned int)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self adjustmentsState];
  if ((v3 & 0x2000) != 0)
  {
    if (v5 == 3)
    {
      return;
    }

    v6 = 3;
  }

  else
  {
    if (v5 == 2)
    {
      return;
    }

    v6 = 2;
  }

  [(PLManagedAsset *)self setAdjustmentsState:v6];
}

- (void)updateAssetPropertiesFromAdjustmentFile
{
  v3 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v9 = v3;
  if (v3)
  {
    v4 = [MEMORY[0x1E695DFF8] fileURLWithPath:v3 isDirectory:0];
    v5 = [objc_alloc(MEMORY[0x1E69C0660]) initWithURL:v4];
  }

  else
  {
    v5 = 0;
  }

  v6 = objc_alloc_init(PLMutableAssetAdjustmentOptions);
  [(PLMutableAssetAdjustmentOptions *)v6 setSkipCheckCameraAutoAdjustment:1];
  if ([(PLManagedAsset *)self currentSleetCast])
  {
    [(PLMutableAssetAdjustmentOptions *)v6 setSkipCheckSleetCastAdjustment:1];
  }

  v7 = [(PLManagedAsset *)self additionalAttributes];
  v8 = [v7 unmanagedAdjustment];

  [(PLManagedAsset *)self _updateAdjustmentFromAssetAdjustment:v5 unmanagedAdjustment:v8 fullSizeRenderURL:0 options:v6];
}

- (void)updateAssetAdjustmentsStateIfNeededFromAdjustmentFile
{
  if ([(PLManagedAsset *)self _isCameraAutoAdjustmentChecksNeededAndUpdateAsset])
  {
    v7 = [(PLManagedAsset *)self pathForAdjustmentFile];
    v3 = [MEMORY[0x1E695DFF8] fileURLWithPath:? isDirectory:?];
    v4 = [objc_alloc(MEMORY[0x1E69C0660]) initWithURL:v3];
    v5 = [(PLManagedAsset *)self additionalAttributes];
    v6 = [v5 unmanagedAdjustment];

    if ([v6 updateRenderTypeFlagsForAssetAdjustments:v4 checkFlag:1 settingPayload:0])
    {
      -[PLManagedAsset setAssetAdjustmentsStateFromAdjustmentRenderType:](self, "setAssetAdjustmentsStateFromAdjustmentRenderType:", [v6 adjustmentRenderTypes]);
      -[PLManagedAsset updateAdjustmentFileWithAdjustmentRenderTypes:](self, "updateAdjustmentFileWithAdjustmentRenderTypes:", [v6 adjustmentRenderTypes]);
    }

    else if ([(PLManagedAsset *)self adjustmentsState]<= 1)
    {
      -[PLManagedAsset setAssetAdjustmentsStateFromAdjustmentRenderType:](self, "setAssetAdjustmentsStateFromAdjustmentRenderType:", [v6 adjustmentRenderTypes]);
    }
  }
}

- (int64_t)_prepareFileSystemResourcesForAdjustmentsWithCurrentAdjustmentBaseVersion:(int64_t)a3 penultimateRenderedJPEGData:(id)a4 penultimateRenderedVideoContentURL:(id)a5 penultimateRenderedVideoComplementContentURL:(id)a6 fileIngestionType:(int64_t)a7
{
  v101 = *MEMORY[0x1E69E9840];
  v11 = a4;
  v12 = a5;
  v13 = a6;
  context = objc_autoreleasePoolPush();
  v79 = [MEMORY[0x1E69BF238] fileManager];
  if ([(PLManagedAsset *)self isPhoto])
  {
    [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
  }
  v80 = ;
  if ([(PLManagedAsset *)self isPhoto])
  {
    [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
  }

  else
  {
    [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
  }
  v78 = ;
  v14 = [(PLManagedAsset *)self isVideo];
  if (a3 != 2)
  {
    if (a3 != 1)
    {
      goto LABEL_22;
    }

    v15 = v14 ? v12 : v11;
    if (([v79 fileExistsAtPath:v78] & 1) != 0 || v15)
    {
      goto LABEL_22;
    }

    v16 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = PLAdjustmentBaseVersionDescription();
      v18 = PLAdjustmentBaseVersionDescription();
      *buf = 138412802;
      v88 = v17;
      v89 = 2112;
      v90 = v78;
      v91 = 2112;
      v92 = v18;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "[RM] Base version is %@ but no file exists at %@, defaulting to %@", buf, 0x20u);
    }
  }

  if ([v79 fileExistsAtPath:v80])
  {
    a3 = 2;
  }

  else
  {
    v19 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
    {
      v20 = PLAdjustmentBaseVersionDescription();
      v21 = PLAdjustmentBaseVersionDescription();
      *buf = 138412802;
      v88 = v20;
      v89 = 2112;
      v90 = v80;
      v91 = 2112;
      v92 = v21;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_DEFAULT, "[RM] Base version is %@ but no file exists at %@, defaulting to %@", buf, 0x20u);
    }

    a3 = 0;
  }

LABEL_22:
  v22 = [(PLManagedObject *)self pathManager];
  v23 = [v22 capabilities];

  v24 = PLPhotoEditGetLog();
  v25 = v13;
  if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
  {
    v26 = [(PLManagedAsset *)self uuid];
    if ([(PLManagedAsset *)self isPhoto])
    {
      if ([(PLManagedAsset *)self isPhotoIris])
      {
        v27 = @"live photo";
      }

      else
      {
        v27 = @"photo";
      }
    }

    else
    {
      v27 = @"video";
    }

    v28 = PLAdjustmentBaseVersionDescription();
    v29 = v28;
    *buf = 138544898;
    v30 = @"YES";
    v88 = v26;
    if (!v11)
    {
      v30 = @"NO";
    }

    v89 = 2112;
    v90 = v27;
    v91 = 2112;
    v92 = v28;
    v93 = 2112;
    v94 = v80;
    v95 = 2112;
    v96 = v30;
    v97 = 2112;
    v98 = v12;
    v99 = 2112;
    v25 = v13;
    v100 = v13;
    _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_DEFAULT, "[RM] Preparing resources for adjustment for asset %{public}@ (%@) with base version %@ fullSizeRenderFile: %@ penultimate data: %@ penultimateRenderedVideoContentURL: %@ penultimateRenderedVideoComplementContentURL: %@", buf, 0x48u);
  }

  if (![(PLManagedAsset *)self isPhoto])
  {
    v41 = MEMORY[0x1E695DFF8];
    v42 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    v43 = [v41 fileURLWithPath:v42 isDirectory:0];

    if (!v12)
    {
      if ((a3 | 2) == 2 && ([(PLManagedAsset *)self _cleanupPenultimateResources], a3 == 2))
      {
        v65 = MEMORY[0x1E69BF238];
        v66 = [MEMORY[0x1E695DFF8] fileURLWithPath:v80 isDirectory:0];
        v81 = 0;
        LOBYTE(v65) = [v65 ingestItemAtURL:v66 toURL:v43 type:3 options:2 capabilities:v23 error:&v81];
        v33 = v81;

        if ((v65 & 1) == 0)
        {
          v67 = PLPhotoEditGetLog();
          if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412802;
            v88 = v80;
            v89 = 2112;
            v90 = v43;
            v91 = 2112;
            v92 = v33;
            _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "Failed to ingest pathForFullsizeRenderFile %@ to %@: %@", buf, 0x20u);
          }
        }

        [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:16];
        a3 = 1;
      }

      else
      {
        v33 = 0;
      }

      goto LABEL_71;
    }

    v82 = 0;
    v44 = [MEMORY[0x1E69BF238] ingestItemAtURL:v12 toURL:v43 type:a7 options:6 capabilities:v23 error:&v82];
    v33 = v82;
    if (v44)
    {
LABEL_71:

LABEL_72:
      goto LABEL_73;
    }

    v45 = PLPhotoEditGetLog();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412802;
      v88 = v12;
      v89 = 2112;
      v90 = v43;
      v91 = 2112;
      v92 = v33;
      _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_ERROR, "Failed to ingest penultimateRenderedVideoContentURL %@ to %@: %@", buf, 0x20u);
    }

LABEL_69:

    goto LABEL_71;
  }

  if (v11)
  {
    v31 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
    v86 = 0;
    v32 = [(__CFString *)v11 writeToFile:v31 options:1073741825 error:&v86];
    v33 = v86;

    v34 = PLPhotoEditGetLog();
    v35 = v34;
    if (v32)
    {
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_DEFAULT))
      {
        goto LABEL_63;
      }

      v36 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
      *buf = 138412290;
      v88 = v36;
      v37 = "Written penultimateFullsizeRenderImage to %@";
      v38 = v35;
      v39 = OS_LOG_TYPE_DEFAULT;
      v40 = 12;
    }

    else
    {
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_63;
      }

      v36 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
      *buf = 138412546;
      v88 = v36;
      v89 = 2112;
      v90 = v33;
      v37 = "Failed to write penultimateFullsizeRenderImage %@: %@";
      v38 = v35;
      v39 = OS_LOG_TYPE_ERROR;
      v40 = 22;
    }

    _os_log_impl(&dword_19BF1F000, v38, v39, v37, buf, v40);

LABEL_63:
    v68 = [(PLManagedAsset *)self isPhotoIris];
    if (!v25 || !v68)
    {
      goto LABEL_72;
    }

    v69 = MEMORY[0x1E695DFF8];
    v70 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    v43 = [v69 fileURLWithPath:v70 isDirectory:0];

    v85 = 0;
    LOBYTE(v70) = [MEMORY[0x1E69BF238] ingestItemAtURL:v25 toURL:v43 type:a7 options:6 capabilities:v23 error:&v85];
    v45 = v85;
    if ((v70 & 1) == 0)
    {
      v71 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v71, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v88 = v25;
        v89 = 2112;
        v90 = v43;
        v91 = 2112;
        v92 = v45;
        _os_log_impl(&dword_19BF1F000, v71, OS_LOG_TYPE_ERROR, "Failed to ingest penultimateRenderedVideoComplementContentURL %@ to penultimateRenderedVideoComplementURL %@: %@", buf, 0x20u);
      }
    }

    goto LABEL_69;
  }

  if ((a3 | 2) == 2)
  {
    [(PLManagedAsset *)self _cleanupPenultimateResources];
    if (a3 == 2)
    {
      v46 = [(__CFString *)v80 pathExtension];
      v43 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:v46 assetType:0];

      v47 = MEMORY[0x1E695DFF8];
      v48 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFileWithUTI:v43];
      v49 = [v47 fileURLWithPath:v48 isDirectory:0];

      v50 = MEMORY[0x1E69BF238];
      v51 = v49;
      v52 = [MEMORY[0x1E695DFF8] fileURLWithPath:v80 isDirectory:0];
      v84 = 0;
      v75 = v51;
      LOBYTE(v50) = [v50 ingestItemAtURL:v52 toURL:v51 type:3 options:2 capabilities:v23 error:&v84];
      v33 = v84;

      if ((v50 & 1) == 0)
      {
        v53 = PLPhotoEditGetLog();
        if (os_log_type_enabled(v53, OS_LOG_TYPE_DEFAULT))
        {
          v54 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
          *buf = 138412802;
          v88 = v80;
          v89 = 2112;
          v90 = v54;
          v91 = 2112;
          v92 = v33;
          _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_DEFAULT, "Failed to ingest pathForFullsizeRenderFile %@ to pathForPenultimateFullsizeRenderImageFile %@: %@", buf, 0x20u);
        }
      }

      [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:2];
      v55 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
      if ([v79 fileExistsAtPath:v55])
      {
        v56 = MEMORY[0x1E69BF238];
        v74 = v55;
        v57 = [MEMORY[0x1E695DFF8] fileURLWithPath:v55 isDirectory:0];
        v58 = MEMORY[0x1E695DFF8];
        v73 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
        v59 = [v58 fileURLWithPath:v73 isDirectory:0];
        v83 = 0;
        v60 = v56;
        v61 = v57;
        LOBYTE(v57) = [v60 ingestItemAtURL:v57 toURL:v59 type:3 options:2 capabilities:v23 error:&v83];
        v62 = v83;

        if ((v57 & 1) == 0)
        {
          v63 = PLPhotoEditGetLog();
          if (os_log_type_enabled(v63, OS_LOG_TYPE_DEFAULT))
          {
            v64 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
            *buf = 138412802;
            v88 = v74;
            v89 = 2112;
            v90 = v64;
            v91 = 2112;
            v92 = v62;
            _os_log_impl(&dword_19BF1F000, v63, OS_LOG_TYPE_DEFAULT, "Failed to ingest pathForFullsizeRenderVideoFile %@ to pathForPenultimateFullsizeRenderVideoFile %@: %@", buf, 0x20u);
          }
        }

        [(PLManagedAsset *)self markAsUnavailableCloudResourceOfType:16];

        v55 = v74;
      }

      a3 = 1;
      v11 = 0;
      goto LABEL_71;
    }
  }

LABEL_73:

  objc_autoreleasePoolPop(context);
  return a3;
}

- (void)revertToOriginal
{
  v8 = *MEMORY[0x1E69E9840];
  v3 = PLBackendGetLog();
  if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
  {
    v4 = [(PLManagedAsset *)self uuid];
    v6 = 138543362;
    v7 = v4;
    _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "Reverting to original for asset %{public}@", &v6, 0xCu);
  }

  v5 = +[PLAssetAdjustmentOptions assetAdjustmentOptionsForRevertingToOriginal];
  [(PLManagedAsset *)self setAdjustments:0 options:v5];
}

- (id)_availableCloudResourcesForPhotosRequireUnadjusted:(BOOL)a3 allowPenultimate:(BOOL)a4
{
  v19 = a4;
  v4 = a3;
  v27 = *MEMORY[0x1E69E9840];
  if (_availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__onceToken != -1)
  {
    dispatch_once(&_availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__onceToken, &__block_literal_global_990);
  }

  v6 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v7 = _availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__photoTypes;
  v8 = [v7 countByEnumeratingWithState:&v22 objects:v26 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v23;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v23 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v22 + 1) + 8 * i);
        v13 = [v12 integerValue];
        if (v4)
        {
          v21 = 0;
          v14 = [(PLManagedAsset *)self _isMasterResourceAvailableForResourceType:v13 outResource:&v21];
          v15 = v21;
          if (v14)
          {
            goto LABEL_16;
          }
        }

        else
        {
          v20 = 0;
          v16 = [(PLManagedAsset *)self _isAdjustedResourceAvailableForResourceType:v13 outResource:&v20];
          v15 = v20;
          if (v16 && ([v12 integerValue] != 15 || v19))
          {
LABEL_16:
            [v6 addObject:v15];
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v22 objects:v26 count:16];
    }

    while (v9);
  }

  return v6;
}

void __86__PLManagedAsset__availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate___block_invoke()
{
  v0 = _availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__photoTypes;
  _availableCloudResourcesForPhotosRequireUnadjusted_allowPenultimate__photoTypes = &unk_1F0FBF460;
}

- (BOOL)_isResourceAvailableForResourceType:(unint64_t)a3 outResource:(id *)a4
{
  if ([PLManagedAsset _isAdjustedResourceAvailableForResourceType:"_isAdjustedResourceAvailableForResourceType:outResource:" outResource:?])
  {
    return 1;
  }

  return [(PLManagedAsset *)self _isMasterResourceAvailableForResourceType:a3 outResource:a4];
}

- (BOOL)_isAdjustedResourceAvailableForResourceType:(unint64_t)a3 outResource:(id *)a4
{
  v5 = [(PLManagedAsset *)self assetResourceForCPLType:a3];
  if (a4)
  {
    v5 = v5;
    *a4 = v5;
  }

  v6 = v5 != 0;

  return v6;
}

- (BOOL)_isMasterResourceAvailableForResourceType:(unint64_t)a3 outResource:(id *)a4
{
  v7 = [(PLManagedAsset *)self master];
  if (!v7)
  {
    v8 = 0;
    if (!a4)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v8 = [(PLManagedAsset *)self masterResourceForCPLType:a3];
  if (a4)
  {
LABEL_3:
    v9 = v8;
    *a4 = v8;
  }

LABEL_4:

  return v8 != 0;
}

- (BOOL)shouldUseNonAdjustedVideo
{
  v6 = 0;
  v7 = &v6;
  v8 = 0x2020000000;
  v9 = ![(PLManagedAsset *)self hasAdjustments];
  if ((v7[3] & 1) == 0 && [(PLManagedAsset *)self isDefaultAdjustedSlomo])
  {
    v5[0] = MEMORY[0x1E69E9820];
    v5[1] = 3221225472;
    v5[2] = __43__PLManagedAsset_shouldUseNonAdjustedVideo__block_invoke;
    v5[3] = &unk_1E75714E0;
    v5[4] = &v6;
    [(PLManagedAsset *)self synchronouslyFetchAdjustmentDataWithCompletionHandler:v5];
  }

  if ((v7[3] & 1) == 0 && [(PLManagedAsset *)self isPhotoIris]&& [(PLManagedAsset *)self hasAdjustments]&& [(PLManagedAsset *)self videoCpVisibilityState]== 2 && ![(PLManagedAsset *)self deferredProcessingNeeded])
  {
    *(v7 + 24) = 1;
  }

  v3 = *(v7 + 24);
  _Block_object_dispose(&v6, 8);
  return v3;
}

uint64_t __43__PLManagedAsset_shouldUseNonAdjustedVideo__block_invoke(uint64_t a1, uint64_t a2, uint64_t a3)
{
  result = [MEMORY[0x1E69C0910] isRecognizedSlowMotionFormatWithIdentifier:a2 version:a3];
  *(*(*(a1 + 32) + 8) + 24) = result;
  return result;
}

- (id)unadjustedDerivativeImageURLs
{
  v43 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E695DFA8] set];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke;
  aBlock[3] = &unk_1E7567860;
  v4 = v3;
  v36 = v4;
  v5 = _Block_copy(aBlock);
  v6 = [(PLManagedAsset *)self masterThumbnailFileURLIfLocal];
  [v4 pl_addObjectIfNotNil:v6];

  v7 = [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  [v4 pl_addObjectIfNotNil:v7];

  v8 = [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  [v4 pl_addObjectIfNotNil:v8];

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  v9 = [(PLManagedAsset *)self contextualVideoThumbnailURLs];
  v10 = [v9 countByEnumeratingWithState:&v31 objects:v41 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v32;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v32 != v12)
        {
          objc_enumerationMutation(v9);
        }

        [v4 addObject:*(*(&v31 + 1) + 8 * i)];
      }

      v11 = [v9 countByEnumeratingWithState:&v31 objects:v41 count:16];
    }

    while (v11);
  }

  v14 = [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
  v5[2](v5, v14, 0);

  v15 = [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
  v5[2](v5, v15, 0);

  v26[0] = MEMORY[0x1E69E9820];
  v26[1] = 3221225472;
  v27 = __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke_2;
  v28 = &unk_1E7567888;
  v25 = v5;
  v29 = self;
  v30 = v25;
  v16 = v26;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  v17 = [&unk_1F0FBF550 countByEnumeratingWithState:&v37 objects:v42 count:16];
  if (v17)
  {
    v18 = v17;
    v19 = *v38;
    do
    {
      for (j = 0; j != v18; ++j)
      {
        if (*v38 != v19)
        {
          objc_enumerationMutation(&unk_1F0FBF550);
        }

        v21 = [*(*(&v37 + 1) + 8 * j) unsignedIntValue];
        if ((v21 - 327695) <= 6 && ((1 << (v21 - 15)) & 0x55) != 0)
        {
          v27(v16, v21);
        }
      }

      v18 = [&unk_1F0FBF550 countByEnumeratingWithState:&v37 objects:v42 count:16];
    }

    while (v18);
  }

  v23 = v4;
  return v4;
}

void __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v7 = a2;
  if ([v7 length])
  {
    v5 = *(a1 + 32);
    v6 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7 isDirectory:a3];
    [v5 pl_addObjectIfNotNil:v6];
  }
}

void __47__PLManagedAsset_unadjustedDerivativeImageURLs__block_invoke_2(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) pathForAlchemistV2ResourceFileWithRecipeID:a2];
  (*(v2 + 16))(v2, v3, 0);
}

- (id)adjustedFileURLs
{
  v54 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E695DFA8] set];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __34__PLManagedAsset_adjustedFileURLs__block_invoke;
  aBlock[3] = &unk_1E7567860;
  v4 = v3;
  v47 = v4;
  v5 = _Block_copy(aBlock);
  v6 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
  v5[2](v5, v6, 0);

  v7 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
  v5[2](v5, v7, 0);

  v8 = [(PLManagedAsset *)self pathForSubstandardFullsizeRenderImageFile];
  v5[2](v5, v8, 0);

  v9 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
  v5[2](v5, v9, 0);

  v10 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
  v5[2](v5, v10, 0);

  v11 = [(PLManagedAsset *)self pathForAdjustmentFile];
  v5[2](v5, v11, 0);

  v12 = [(PLManagedAsset *)self pathForAdjustmentDataFile];
  v5[2](v5, v12, 0);

  v13 = [(PLManagedAsset *)self pathForAdjustedLargeSizeImageFile];
  v5[2](v5, v13, 0);

  v14 = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
  v5[2](v5, v14, 0);

  v15 = [(PLManagedAsset *)self fileURLForAdjustedLargeThumbnailFile];
  [v4 pl_addObjectIfNotNil:v15];

  v16 = [(PLManagedAsset *)self fileURLForAdjustedMediumThumbnailFile];
  [v4 pl_addObjectIfNotNil:v16];

  v17 = [(PLManagedAsset *)self pathForAdjustedLargeVideoFile];
  v5[2](v5, v17, 0);

  v18 = [(PLManagedAsset *)self pathForAdjustedMediumVideoFile];
  v5[2](v5, v18, 0);

  v19 = [(PLManagedAsset *)self pathForAdjustedMediumHDRVideoFile];
  v5[2](v5, v19, 0);

  v20 = [(PLManagedAsset *)self pathForAdjustedSmallVideoFile];
  v5[2](v5, v20, 0);

  v21 = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
  v5[2](v5, v21, 0);

  v44 = 0u;
  v45 = 0u;
  v42 = 0u;
  v43 = 0u;
  v22 = [(PLManagedAsset *)self contextualVideoThumbnailURLs];
  v23 = [v22 countByEnumeratingWithState:&v42 objects:v52 count:16];
  if (v23)
  {
    v24 = v23;
    v25 = *v43;
    do
    {
      for (i = 0; i != v24; ++i)
      {
        if (*v43 != v25)
        {
          objc_enumerationMutation(v22);
        }

        [v4 addObject:*(*(&v42 + 1) + 8 * i)];
      }

      v24 = [v22 countByEnumeratingWithState:&v42 objects:v52 count:16];
    }

    while (v24);
  }

  v37[0] = MEMORY[0x1E69E9820];
  v37[1] = 3221225472;
  v38 = __34__PLManagedAsset_adjustedFileURLs__block_invoke_2;
  v39 = &unk_1E7567888;
  v36 = v5;
  v40 = self;
  v41 = v36;
  v27 = v37;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v51 = 0u;
  v28 = [&unk_1F0FBF550 countByEnumeratingWithState:&v48 objects:v53 count:16];
  if (v28)
  {
    v29 = v28;
    v30 = *v49;
    do
    {
      for (j = 0; j != v29; ++j)
      {
        if (*v49 != v30)
        {
          objc_enumerationMutation(&unk_1F0FBF550);
        }

        v32 = [*(*(&v48 + 1) + 8 * j) unsignedIntValue];
        if ((v32 - 327695) <= 6 && ((1 << (v32 - 15)) & 0x55) != 0)
        {
          v38(v27, v32);
        }
      }

      v29 = [&unk_1F0FBF550 countByEnumeratingWithState:&v48 objects:v53 count:16];
    }

    while (v29);
  }

  v34 = v4;
  return v4;
}

void __34__PLManagedAsset_adjustedFileURLs__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v7 = a2;
  if ([v7 length])
  {
    v5 = *(a1 + 32);
    v6 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7 isDirectory:a3];
    [v5 pl_addObjectIfNotNil:v6];
  }
}

void __34__PLManagedAsset_adjustedFileURLs__block_invoke_2(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) pathForAlchemistV2ResourceFileWithRecipeID:a2];
  (*(v2 + 16))(v2, v3, 0);
}

- (NSSet)allFileURLs
{
  v109 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self sidecars];
  v4 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(v3, "count") + 1}];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __29__PLManagedAsset_allFileURLs__block_invoke;
  aBlock[3] = &unk_1E7567860;
  v5 = v4;
  v98 = v5;
  v6 = _Block_copy(aBlock);
  if (![(PLManagedAsset *)self isReferencedAsset])
  {
    v7 = [(PLManagedAsset *)self filename];
    v8 = [v7 length];

    if (v8)
    {
      v9 = [(PLManagedAsset *)self pathForOriginalFile];
      v6[2](v6, v9, 0);
    }

    v95 = 0u;
    v96 = 0u;
    v93 = 0u;
    v94 = 0u;
    v10 = v3;
    v11 = [v10 countByEnumeratingWithState:&v93 objects:v104 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v94;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v94 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = [*(*(&v93 + 1) + 8 * i) fileURL];
          if (v15)
          {
            [(NSSet *)v5 addObject:v15];
          }
        }

        v12 = [v10 countByEnumeratingWithState:&v93 objects:v104 count:16];
      }

      while (v12);
    }

    v16 = [(PLManagedAsset *)self pathForVideoComplementFile];
    v6[2](v6, v16, 0);

    v17 = [(PLManagedAsset *)self pathForSpatialOverCaptureContentFile];
    v6[2](v6, v17, 0);

    v18 = [(PLManagedAsset *)self pathForVideoComplementSpatialOverCaptureContentFile];
    v6[2](v6, v18, 0);

    v19 = [(PLManagedAsset *)self pathForOriginalAdjustmentFile];
    v6[2](v6, v19, 0);
  }

  v20 = [(PLManagedAsset *)self fileURLForNonAdjustedMediumThumbnailFile];
  [(NSSet *)v5 pl_addObjectIfNotNil:v20];

  v21 = [(PLManagedAsset *)self fileURLForNonAdjustedLargeThumbnailFile];
  [(NSSet *)v5 pl_addObjectIfNotNil:v21];

  v22 = [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
  v6[2](v6, v22, 0);

  v23 = [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
  v6[2](v6, v23, 0);

  if ([(PLManagedAsset *)self isCloudSharedAsset])
  {
    v24 = 3;
    do
    {
      v25 = [(PLManagedAsset *)self cloudSharedAssetPathForPlaceholderKind:v24];
      v26 = v24;
      v6[2](v6, v25, 0);

      ++v24;
    }

    while (v26 < 0xA);
  }

  v27 = [(PLManagedAsset *)self pathForNonAdjustedMediumVideoFile];
  v6[2](v6, v27, 0);

  v28 = [(PLManagedAsset *)self pathForNonAdjustedMediumHDRVideoFile];
  v6[2](v6, v28, 0);

  v29 = [(PLManagedAsset *)self pathForNonAdjustedSmallVideoFile];
  v6[2](v6, v29, 0);

  v30 = [(PLManagedAsset *)self fileURLForThumbnailFile];
  [(NSSet *)v5 pl_addObjectIfNotNil:v30];

  v31 = [(PLManagedAsset *)self pathForMutationsDirectory];
  v83 = v31;
  if (v31)
  {
    v32 = v31;
    v33 = [(PLManagedObject *)self pathManager];
    v34 = [v33 photoDirectoryWithType:9];
    v35 = [v34 hasPrefix:v32];

    if (v35)
    {
      v36 = PLBackendGetLog();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
      {
        v37 = [(PLManagedAsset *)self uuid];
        *buf = 138543618;
        v106 = v37;
        v107 = 2112;
        v108 = v83;
        _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "Asset %{public}@ has incorrect mutation directory %@, skip removing the directory.", buf, 0x16u);
      }
    }

    else
    {
      v36 = [MEMORY[0x1E695DFF8] fileURLWithPath:v32 isDirectory:1];
      [(NSSet *)v5 pl_addObjectIfNotNil:v36];
    }
  }

  v82 = v3;
  if ([(PLManagedAsset *)self shouldUseUBFPathManager]&& [(PLManagedAsset *)self hasAdjustments])
  {
    v38 = [(PLManagedAsset *)self adjustedFileURLs];
    [(NSSet *)v5 unionSet:v38];
  }

  v39 = [(PLManagedAsset *)self pathForLegacySlalomRegionsArchive];
  v6[2](v6, v39, 0);

  v40 = [(PLManagedAsset *)self pathForDiagnosticFile];
  v6[2](v6, v40, 0);

  v41 = [(PLManagedAsset *)self pathForDeferredProcessingPreviewFile];
  v6[2](v6, v41, 0);

  v42 = [(PLManagedAsset *)self pathForCameraMetadataFile];
  v6[2](v6, v42, 0);

  v43 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  v6[2](v6, v43, 0);

  v44 = [(PLManagedAsset *)self pathForSpatialOverCaptureDiagnosticFile];
  v6[2](v6, v44, 0);

  v45 = [(PLManagedAsset *)self pathForReframeDiagnosticDirectory];
  v6[2](v6, v45, 1);

  v46 = [(PLManagedAsset *)self pathForCameraMetadataDiagnosticFile];
  v6[2](v6, v46, 0);

  v47 = [(PLManagedAsset *)self pathForCameraSpatialOverCaptureMetadataDiagnosticFile];
  v6[2](v6, v47, 0);

  v48 = [(PLManagedAsset *)self pathForOriginalVideoComplementDiagnosticFile];
  v6[2](v6, v48, 0);

  v49 = [(PLManagedObject *)self pathManager];
  v50 = [v49 isDCIM];

  if (v50 && [(PLManagedAsset *)self isFinderSyncedAsset])
  {
    v51 = [(PLManagedObject *)self pathManager];
    v52 = [v51 iTunesSyncedFaceDataDirectory];
    v53 = [(PLManagedAsset *)self uuid];
    v54 = [v52 stringByAppendingPathComponent:v53];
    v55 = [v54 stringByAppendingPathExtension:@"plist"];

    v6[2](v6, v55, 0);
  }

  v56 = [(PLManagedAsset *)self pathForLocalVideoKeyFrame];
  v6[2](v6, v56, 0);

  v57 = [(PLManagedObject *)self pathManager];
  v58 = [(PLManagedAsset *)self uuid];
  v59 = [v57 URLForPartialVideoDirectoryWithAssetUUID:v58];
  v60 = [v59 path];
  v6[2](v6, v60, 1);

  v61 = [(PLManagedAsset *)self pathForWallpaperComputeResourcesFile];
  v6[2](v6, v61, 0);

  v62 = [(PLManagedAsset *)self pathForComputeSyncWrapperFile];
  v6[2](v6, v62, 0);

  v63 = [(PLManagedAsset *)self pathForComputeSyncMediaAnalysisPayloadFile];
  v6[2](v6, v63, 0);

  v64 = [(PLManagedAsset *)self pathForGenerativePlaygroundFaceResourcesFile];
  v6[2](v6, v64, 0);

  v65 = [(PLManagedObject *)self pathManager];
  LODWORD(v58) = [v65 isDCIM];

  if (v58)
  {
    v66 = [(PLManagedAsset *)self pathForComputeDirectory];
    v6[2](v6, v66, 1);
  }

  v91 = 0u;
  v92 = 0u;
  v89 = 0u;
  v90 = 0u;
  v67 = [(PLManagedAsset *)self contextualVideoThumbnailURLs];
  v68 = [v67 countByEnumeratingWithState:&v89 objects:v103 count:16];
  if (v68)
  {
    v69 = v68;
    v70 = *v90;
    do
    {
      for (j = 0; j != v69; ++j)
      {
        if (*v90 != v70)
        {
          objc_enumerationMutation(v67);
        }

        [(NSSet *)v5 addObject:*(*(&v89 + 1) + 8 * j)];
      }

      v69 = [v67 countByEnumeratingWithState:&v89 objects:v103 count:16];
    }

    while (v69);
  }

  v84[0] = MEMORY[0x1E69E9820];
  v84[1] = 3221225472;
  v85 = __29__PLManagedAsset_allFileURLs__block_invoke_986;
  v86 = &unk_1E7567888;
  v81 = v6;
  v87 = self;
  v88 = v81;
  v72 = v84;
  v99 = 0u;
  v100 = 0u;
  v101 = 0u;
  v102 = 0u;
  v73 = [&unk_1F0FBF550 countByEnumeratingWithState:&v99 objects:buf count:16];
  if (v73)
  {
    v74 = v73;
    v75 = *v100;
    do
    {
      for (k = 0; k != v74; ++k)
      {
        if (*v100 != v75)
        {
          objc_enumerationMutation(&unk_1F0FBF550);
        }

        v77 = [*(*(&v99 + 1) + 8 * k) unsignedIntValue];
        if ((v77 - 327695) <= 6 && ((1 << (v77 - 15)) & 0x55) != 0)
        {
          v85(v72, v77);
        }
      }

      v74 = [&unk_1F0FBF550 countByEnumeratingWithState:&v99 objects:buf count:16];
    }

    while (v74);
  }

  v79 = v5;
  return v5;
}

void __29__PLManagedAsset_allFileURLs__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v7 = a2;
  if ([v7 length])
  {
    v5 = *(a1 + 32);
    v6 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7 isDirectory:a3];
    [v5 pl_addObjectIfNotNil:v6];
  }
}

void __29__PLManagedAsset_allFileURLs__block_invoke_986(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 40);
  v3 = [*(a1 + 32) pathForAlchemistV2ResourceFileWithRecipeID:a2];
  (*(v2 + 16))(v2, v3, 0);
}

- (NSSet)filePathsWithoutThumbs
{
  v20 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self sidecars];
  v4 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(v3, "count") + 1}];
  v5 = [(PLManagedAsset *)self pathForOriginalFile];
  if (v5)
  {
    [v4 addObject:v5];
  }

  v17 = 0u;
  v18 = 0u;
  v15 = 0u;
  v16 = 0u;
  v6 = v3;
  v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v16;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v16 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = [*(*(&v15 + 1) + 8 * i) fileURL];
        v12 = v11;
        if (v11)
        {
          v13 = [v11 path];
          [v4 addObject:v13];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v8);
  }

  return v4;
}

- (NSString)pathForComputeDirectory
{
  v3 = [(PLManagedAsset *)self directory];
  v4 = [(PLManagedAsset *)self filename];
  v5 = [(PLManagedObject *)self pathManager];
  v6 = [v5 assetPathForComputeDirectoryWithDirectory:v3 filename:v4];

  return v6;
}

- (NSString)pathForAdjustmentDirectory
{
  v2 = [(PLManagedAsset *)self pathForMutationsDirectory];
  v3 = [PLManagedAsset pathForAdjustmentDirectoryWithMutationsDirectory:v2];

  return v3;
}

- (id)pathForMutationsDirectory
{
  v3 = [(PLManagedAsset *)self directory];
  v4 = [(PLManagedAsset *)self filename];
  v5 = [(PLManagedObject *)self pathManager];
  v6 = [v5 assetPathForMutationsDirectoryWithDirectory:v3 filename:v4];

  return v6;
}

- (BOOL)shouldUseUBFPathManager
{
  v2 = self;
  v3 = [(PLManagedObject *)self pathManager];
  LOBYTE(v2) = [v3 shouldUseFileIdentifierForBundleScope:{-[PLManagedAsset bundleScope](v2, "bundleScope")}];

  return v2;
}

- (BOOL)isSavedPhotosAsset
{
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    return 1;
  }

  pl_dispatch_once();
  v4 = [(PLManagedAsset *)self mainFileURL];
  v5 = [v4 path];

  if (v5)
  {
    v3 = [isSavedPhotosAsset_savedPhotosDirectoryRegEx numberOfMatchesInString:v5 options:0 range:{0, objc_msgSend(v5, "length")}] == 1;
  }

  else
  {
    v3 = 1;
  }

  return v3;
}

void __36__PLManagedAsset_isSavedPhotosAsset__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E696AE70]) initWithPattern:@"[1-9][0-9][0-9]APPLE" options:0 error:0];
  v1 = isSavedPhotosAsset_savedPhotosDirectoryRegEx;
  isSavedPhotosAsset_savedPhotosDirectoryRegEx = v0;
}

- (BOOL)couldBeStoredInDCIM
{
  [MEMORY[0x1E69BF328] maskForCouldBeStoredInDCIM];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (id)originalVideoComplementUniformTypeIdentifier
{
  if (![(PLManagedAsset *)self isPhotoIris])
  {
    v16 = [MEMORY[0x1E696AAA8] currentHandler];
    [v16 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:8045 description:{@"Requires a live photo asset but type/subtype are %d/%d", -[PLManagedAsset kind](self, "kind"), -[PLManagedAsset kindSubtype](self, "kindSubtype")}];
  }

  v4 = [(PLManagedObject *)self photoLibrary];
  v5 = [v4 isCloudPhotoLibraryEnabled];

  if (v5)
  {
    v17 = 0;
    v6 = [(PLManagedAsset *)self _isResourceAvailableForResourceType:18 outResource:&v17];
    v7 = v17;
    v8 = v7;
    v9 = 0;
    if (v6)
    {
      v10 = [v7 uniformTypeIdentifier];
      v9 = [v10 identifier];
    }
  }

  else
  {
    v11 = MEMORY[0x1E69C08F0];
    v12 = [(PLManagedAsset *)self pathForVideoComplementFile];
    v13 = [v12 pathExtension];
    v14 = [v11 typeWithFilenameExtension:v13];
    v9 = [v14 identifier];
  }

  return v9;
}

- (id)originalUniformTypeIdentifier
{
  v16[1] = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self master];

  if (v3)
  {
    v4 = [(PLManagedAsset *)self master];
    v5 = [v4 uniformTypeIdentifier];

    goto LABEL_9;
  }

  if (![(PLManagedAsset *)self hasAdjustments])
  {
    v5 = [(PLManagedAsset *)self uniformTypeIdentifier];
LABEL_9:
    v7 = 0;
    if (v5)
    {
      goto LABEL_13;
    }

    goto LABEL_10;
  }

  if ([(PLManagedAsset *)self kind])
  {
    goto LABEL_11;
  }

  v6 = [(PLManagedAsset *)self pathForOriginalFile];
  if (!v6)
  {
    goto LABEL_11;
  }

  v7 = v6;
  v15 = *MEMORY[0x1E696E0A8];
  v16[0] = MEMORY[0x1E695E110];
  v8 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v16 forKeys:&v15 count:1];
  v9 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7 isDirectory:0];
  v10 = CGImageSourceCreateWithURL(v9, v8);

  if (v10)
  {
    v5 = CGImageSourceGetType(v10);
    CFRelease(v10);
  }

  else
  {
    v5 = 0;
  }

  if (v5)
  {
    goto LABEL_13;
  }

LABEL_10:
  if (!v7)
  {
LABEL_11:
    v7 = [(PLManagedAsset *)self pathForOriginalFile];
  }

  v11 = MEMORY[0x1E69C08F0];
  v12 = [v7 pathExtension];
  v13 = [v11 typeWithFilenameExtension:v12];
  v5 = [v13 identifier];

LABEL_13:

  return v5;
}

- (void)updateAssetKindFromUniformTypeIdentifier
{
  v3 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [PLManagedAsset assetTypeFromUniformTypeIdentifier:v3];

  [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:v4];
}

- (void)updateAssetKindAndPlaybackStyleIfNeededWithKind:(signed __int16)a3
{
  v3 = a3;
  if ([(PLManagedAsset *)self kind]!= a3)
  {
    [(PLManagedAsset *)self setKind:v3];
    if (![(PLManagedAsset *)self playbackVariation])
    {
      v5 = [objc_opt_class() defaultPlaybackStyleFromAssetType:v3 subtype:0 playbackVariation:{-[PLManagedAsset playbackVariation](self, "playbackVariation")}];

      [(PLManagedAsset *)self setPlaybackStyle:v5];
    }
  }
}

- (id)nonDynamicOriginalUTI
{
  v3 = [(PLManagedAsset *)self mainFileURL];
  v4 = [v3 path];
  v5 = [v4 pathExtension];

  if ([PLManagedAsset isKnownFileExtension:v5])
  {
    v6 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:v5 assetType:[(PLManagedAsset *)self kind]];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)setUniformTypeIdentifierFromOriginalFile
{
  v3 = [(PLManagedAsset *)self nonDynamicOriginalUTI];
  [(PLManagedAsset *)self setUniformTypeIdentifier:v3];
}

- (void)setUniformTypeIdentifierFromPathExtension:(id)a3
{
  v4 = a3;
  v5 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:v4 assetType:[(PLManagedAsset *)self kind]];

  [(PLManagedAsset *)self setUniformTypeIdentifier:v5];
}

- (BOOL)isScreenRecording
{
  if ([(PLManagedAsset *)self kindSubtype]== 103)
  {
    return 1;
  }

  if ([(PLManagedAsset *)self kind]!= 1)
  {
    return 0;
  }

  v4 = [(PLManagedAsset *)self originalFilename];
  v5 = [PLManagedAsset isScreenRecordingFileName:v4];

  return v5;
}

- (BOOL)_isPartOfAvalancheWithKind:(unsigned __int16)a3
{
  v3 = a3;
  if ([(PLManagedAsset *)self avalancheKind]== a3)
  {
    if (v3 == 2)
    {
      v5 = [(PLManagedAsset *)self avalancheUUID];
      v7 = v5 == 0;
    }

    else
    {
      if (v3 != 1)
      {
        if (v3)
        {
          return 1;
        }

        v5 = [(PLManagedAsset *)self avalancheUUID];
        v6 = v5 == 0;
        goto LABEL_13;
      }

      v5 = [(PLManagedAsset *)self avalancheUUID];
      if (!v5)
      {
        v6 = 0;
LABEL_13:

        return v6;
      }

      v7 = [(PLManagedAsset *)self avalanchePickType]== 0;
    }

    v6 = !v7;
    goto LABEL_13;
  }

  return 0;
}

- (BOOL)isOriginalRAW
{
  v3 = [(PLManagedAsset *)self originalFilename];
  v4 = [v3 pathExtension];

  v5 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:v4 assetType:[(PLManagedAsset *)self kind]];
  v6 = [MEMORY[0x1E69C08F0] typeWithIdentifier:v5];
  v7 = [v6 conformsToType:*MEMORY[0x1E6982F88]];

  return v7;
}

- (BOOL)isRAW
{
  v2 = MEMORY[0x1E69C08F0];
  v3 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [v2 typeWithIdentifier:v3];
  v5 = [v4 conformsToType:*MEMORY[0x1E6982F88]];

  return v5;
}

- (BOOL)isPrimaryImageFormat
{
  v3 = objc_opt_class();
  v4 = [(PLManagedAsset *)self uniformTypeIdentifier];
  LOBYTE(v3) = [v3 isPrimaryImageFormatForUTI:v4];

  return v3;
}

- (BOOL)isHEIF
{
  v2 = MEMORY[0x1E69C08F0];
  v3 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [v2 typeWithIdentifier:v3];
  v5 = [v4 conformsToType:*MEMORY[0x1E6983138]];

  return v5;
}

- (BOOL)isJPEG
{
  v2 = MEMORY[0x1E69C08F0];
  v3 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v4 = [v2 typeWithIdentifier:v3];
  v5 = [v4 isEqual:*MEMORY[0x1E6982E58]];

  return v5;
}

- (void)reportSharedAssetIncrementalChange:(id)a3
{
  v5 = a3;
  if ([v5 collectionChangeType])
  {
    v17 = [MEMORY[0x1E696AAA8] currentHandler];
    [v17 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:7723 description:@"only supports private/shared transitions against the shared state or suggested-by-photos state for an asset being updated (not inserted or deleted)"];
  }

  v6 = [(PLManagedAsset *)self moment];
  [v6 reportSharedAssetContainerIncrementalChange:v5 forAllAssetsCountKey:@"assetsCount"];

  v7 = [objc_alloc(MEMORY[0x1E695DFA8]) initWithCapacity:6];
  v18 = MEMORY[0x1E69E9820];
  v19 = 3221225472;
  v20 = __53__PLManagedAsset_reportSharedAssetIncrementalChange___block_invoke;
  v21 = &unk_1E7567838;
  v22 = v5;
  v23 = v7;
  v8 = v7;
  v9 = v5;
  v10 = _Block_copy(&v18);
  v11 = [(PLManagedAsset *)self highlightBeingAssets:v18];
  v10[2](v10, v11, @"assetsCount");

  v12 = [(PLManagedAsset *)self highlightBeingSummaryAssets];
  v10[2](v10, v12, @"summaryCount");

  v13 = [(PLManagedAsset *)self highlightBeingExtendedAssets];
  v10[2](v10, v13, @"extendedCount");

  v14 = [(PLManagedAsset *)self dayGroupHighlightBeingAssets];
  v10[2](v10, v14, @"dayGroupAssetsCount");

  v15 = [(PLManagedAsset *)self dayGroupHighlightBeingSummaryAssets];
  v10[2](v10, v15, @"dayGroupSummaryAssetsCount");

  v16 = [(PLManagedAsset *)self dayGroupHighlightBeingExtendedAssets];
  v10[2](v10, v16, @"dayGroupExtendedAssetsCount");
}

void __53__PLManagedAsset_reportSharedAssetIncrementalChange___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v8 = a2;
  v5 = a3;
  v6 = *(a1 + 32);
  if (v8)
  {
    if ([*(a1 + 32) hasSuggestionChanges])
    {
      if ([*(a1 + 40) containsObject:v8])
      {
        v7 = [*(a1 + 32) copy];

        [v7 setSuggestionStateChange:0];
        v6 = v7;
      }

      else
      {
        [*(a1 + 40) addObject:v8];
      }
    }

    [v8 reportSharedAssetContainerIncrementalChange:v6 forAllAssetsCountKey:v5];
  }
}

- (void)removeLibraryScopeAndContributors
{
  [(PLManagedAsset *)self setLibraryScope:0];

  [(PLManagedAsset *)self setLibraryScopeContributors:0];
}

- (void)setLibraryScope:(id)a3 withContributors:(id)a4
{
  v6 = a4;
  [(PLManagedAsset *)self setLibraryScope:a3];
  [(PLManagedAsset *)self setLibraryScopeContributors:v6];
}

- (void)setLibraryScopeWithCurrentUserAsContributor:(id)a3
{
  v6 = a3;
  v4 = [v6 currentUserParticipant];
  if (v4)
  {
    v5 = [MEMORY[0x1E695DFD8] setWithObject:v4];
    [(PLManagedAsset *)self setLibraryScope:v6 withContributors:v5];
  }

  else
  {
    [(PLManagedAsset *)self setLibraryScope:v6 withContributors:0];
  }
}

- (void)setCollectionShare:(id)a3 withContributor:(id)a4
{
  v6 = a4;
  [(PLManagedAsset *)self setCollectionShare:a3];
  [(PLManagedAsset *)self setCollectionShareContributor:v6];
}

- (void)setCollectionShareWithCurrentUserAsContributor:(id)a3
{
  v4 = a3;
  v5 = [v4 currentUserParticipant];
  [(PLManagedAsset *)self setCollectionShare:v4 withContributor:v5];
}

- (void)setCollectionShareContributor:(id)a3
{
  v12 = a3;
  if (v12)
  {
    v4 = [(PLManagedAsset *)self collectionShareAssetContributor];

    if (!v4)
    {
      v5 = [(PLManagedAsset *)self managedObjectContext];
      v6 = [(PLManagedObject *)PLAssetContributor insertInManagedObjectContext:v5];

      [(PLManagedAsset *)self setCollectionShareAssetContributor:v6];
    }

    v7 = [(PLManagedAsset *)self collectionShareAssetContributor];
    [v7 setParticipant:v12];
    goto LABEL_5;
  }

  if ((MEMORY[0x19EAEE520]() & 1) == 0 && ([(PLManagedAsset *)self cloudIsMyAsset]& 1) == 0)
  {
    v7 = [MEMORY[0x1E696AEC0] stringWithFormat:@"TTR: Inconsistent Shared Albums participant state"];
    v8 = MEMORY[0x1E696AEC0];
    v9 = [(PLManagedAsset *)self uuid];
    v10 = [MEMORY[0x1E696AF00] callStackSymbols];
    v11 = [v8 stringWithFormat:@"Your Shared Albums have experienced an unexpected state, please file a Radar against Photos to help us diagnose the issue. \n\nAsset UUID: %@ \n\nCalled by stack: %@", v9, v10];

    [PLDiagnostics fileRadarUserNotificationWithHeader:@"Inconsistent Shared Albums participant state detected" message:@"Your Shared Albums have experienced an unexpected state radarTitle:please file a Radar against Photos to help us diagnose the issue" radarDescription:v7, v11];
LABEL_5:
  }
}

- (PLShareParticipant)collectionShareContributor
{
  v2 = [(PLManagedAsset *)self collectionShareAssetContributor];
  v3 = [v2 participant];

  return v3;
}

- (void)setLibraryScopeContributors:(id)a3
{
  v37 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self managedObjectContext];
  v26 = v4;
  v6 = [v4 mutableCopy];
  v25 = self;
  v7 = [(PLManagedAsset *)self libraryScopeAssetContributors];
  v8 = [v7 mutableCopy];

  v33 = 0u;
  v34 = 0u;
  v31 = 0u;
  v32 = 0u;
  v9 = [v8 copy];
  v10 = [v9 countByEnumeratingWithState:&v31 objects:v36 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v32;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v32 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v31 + 1) + 8 * i);
        v15 = [v14 participant];
        v16 = [v6 containsObject:v15];

        if (v16)
        {
          v17 = [v14 participant];
          [v6 removeObject:v17];
        }

        else
        {
          [v5 deleteObject:v14];
          [v8 removeObject:v14];
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v31 objects:v36 count:16];
    }

    while (v11);
  }

  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  v18 = v6;
  v19 = [v18 countByEnumeratingWithState:&v27 objects:v35 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v28;
    do
    {
      for (j = 0; j != v20; ++j)
      {
        if (*v28 != v21)
        {
          objc_enumerationMutation(v18);
        }

        v23 = *(*(&v27 + 1) + 8 * j);
        v24 = [(PLManagedObject *)PLAssetContributor insertInManagedObjectContext:v5];
        [v24 setParticipant:v23];
        [v8 addObject:v24];
      }

      v20 = [v18 countByEnumeratingWithState:&v27 objects:v35 count:16];
    }

    while (v20);
  }

  [(PLManagedAsset *)v25 setLibraryScopeAssetContributors:v8];
}

- (NSSet)libraryScopeContributors
{
  v16 = *MEMORY[0x1E69E9840];
  v2 = [(PLManagedAsset *)self libraryScopeAssetContributors];
  v3 = [objc_alloc(MEMORY[0x1E695DFA8]) initWithCapacity:{objc_msgSend(v2, "count")}];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v4 = v2;
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v12;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = [*(*(&v11 + 1) + 8 * i) participant];
        [v3 addObject:v9];
      }

      v6 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  return v3;
}

- (BOOL)hasNonSlomoAdjustments
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v3 = MEMORY[0x1E69C0910];
    v4 = [(PLManagedAsset *)self additionalAttributes];
    v5 = [v4 unmanagedAdjustment];
    v6 = [v5 adjustmentFormatIdentifier];
    v7 = [(PLManagedAsset *)self additionalAttributes];
    v8 = [v7 unmanagedAdjustment];
    v9 = [v8 adjustmentFormatVersion];
    v10 = [v3 isRecognizedSlowMotionFormatWithIdentifier:v6 version:v9] ^ 1;
  }

  else
  {
    LOBYTE(v10) = 0;
  }

  return v10;
}

- (BOOL)hasUnrenderedAsyncAdjustments
{
  v3 = [(PLManagedAsset *)self deferredProcessingNeeded];
  result = 1;
  if (v3 <= 8)
  {
    if (v3 == 1)
    {
      if ([(PLManagedAsset *)self hasAdjustments])
      {
        return 1;
      }
    }

    else if (v3 == 2)
    {
      return result;
    }

    return 0;
  }

  if (v3 == 9)
  {
    return result;
  }

  if (v3 != 10)
  {
    return 0;
  }

  return [(PLManagedAsset *)self hasAdjustments];
}

- (BOOL)hasJustBeenHidden
{
  v2 = [(PLManagedAsset *)self changedValues];
  v3 = [v2 objectForKeyedSubscript:@"visibilityState"];

  if (v3)
  {
    v4 = [v3 shortValue] != 0;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (BOOL)hasJustBeenShown
{
  v2 = [(PLManagedAsset *)self changedValues];
  v3 = [v2 objectForKeyedSubscript:@"visibilityState"];

  if (v3)
  {
    v4 = [v3 shortValue] == 0;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)_updatePackedBadgeAttributesIfNeeded:(int)a3
{
  v3 = *&a3;
  if ([(PLManagedAsset *)self packedBadgeAttributes]!= a3)
  {

    [(PLManagedAsset *)self setPackedBadgeAttributes:v3];
  }
}

- (void)setDetectedScreenshotBadgeAttribute:(BOOL)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self packedBadgeAttributes];
  if (v3)
  {
    v6 = 1024;
  }

  else
  {
    v6 = 0;
  }

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v5 & 0xFFFFFBFF | v6];
}

- (void)setSensitivityAnalysisState:(unsigned __int8)a3
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFC7F | ((a3 & 7) << 7);

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setSpatialAudioControlBadgeAttribute:(unsigned __int8)a3
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFBF | ((a3 & 1) << 6);

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setPlaybackControlBadgeAttribute:(unsigned __int8)a3
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFDF | (32 * (a3 & 1u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setEditableDepthBadgeAttribute:(unsigned __int8)a3
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFEF | (16 * (a3 & 1u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setProResBadgeAttribute:(unsigned __int8)a3
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFF7 | (8 * (a3 & 1u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setKeywordBadgeAttribute:(unsigned __int8)a3
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFFE | a3 & 1;

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)recalculateRAWBadgeAttribute
{
  if ([(PLManagedAsset *)self isRAWPlusJPEG])
  {
    v3 = [(PLManagedAsset *)self additionalAttributes];
    v4 = [v3 originalResourceChoice];
    v5 = [v4 unsignedIntegerValue];

    v6 = 0x2020102u >> (8 * v5);
    if (v5 >= 4)
    {
      LOBYTE(v6) = 0;
    }
  }

  else if ([(PLManagedAsset *)self isRAWOnly])
  {
    LOBYTE(v6) = 3;
  }

  else
  {
    LOBYTE(v6) = 0;
  }

  [(PLManagedAsset *)self setRAWBadgeAttribute:v6];
}

- (void)setRAWBadgeAttribute:(unsigned __int8)a3
{
  v4 = [(PLManagedAsset *)self packedBadgeAttributes]& 0xFFFFFFF9 | (2 * (a3 & 3u));

  [(PLManagedAsset *)self _updatePackedBadgeAttributesIfNeeded:v4];
}

- (void)setIsSmartStyleableWithMetadata:(id)a3
{
  v4 = a3;
  v5 = [v4 smartStyleIsReversible];
  v6 = [v5 BOOLValue];

  v7 = [v4 smartStyleExpectingReversibility];
  v8 = [v7 BOOLValue];

  v9 = [(PLManagedAsset *)self importedByBundleIdentifier];
  v10 = [v9 isEqualToString:*MEMORY[0x1E69BF420]];

  if (v6)
  {
    v11 = [(PLManagedAsset *)self extendedAttributes];
    v12 = [v11 sleetCast];
    v13 = ([v12 intValue] < 1) | v10;

    if ((v13 & 1) == 0)
    {
      if (![v4 containsCustomStylesMetadataBlob])
      {
        v15 = PLPhotoKitIngestGetLog();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
        {
          *v17 = 0;
          _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEFAULT, "Missing smart style custom metadata.", v17, 2u);
        }

        goto LABEL_11;
      }

      goto LABEL_9;
    }
  }

  if ((v8 & v10) != 1 || [(PLManagedAsset *)self deferredProcessingNeeded]!= 1)
  {
    if ((v6 & v10) != 1)
    {
      goto LABEL_12;
    }

LABEL_9:
    v14 = [(PLManagedAsset *)self additionalAttributes];
    v15 = v14;
    v16 = 1;
    goto LABEL_10;
  }

  v14 = [(PLManagedAsset *)self additionalAttributes];
  v15 = v14;
  v16 = 2;
LABEL_10:
  [v14 setSleetIsReversible:v16];
LABEL_11:

LABEL_12:
}

- (BOOL)isTimelapsePlaceholder
{
  if ([(PLManagedAsset *)self kindSubtype]== 102 && ([(PLManagedAsset *)self duration], v3 == 0.0))
  {
    v4 = [(PLManagedAsset *)self pathForOriginalFile];
    v5 = [MEMORY[0x1E696AC08] defaultManager];
    v6 = [v5 fileExistsAtPath:v4] ^ 1;
  }

  else
  {
    LOBYTE(v6) = 0;
  }

  return v6;
}

- (BOOL)isIncludedInCloudFeeds
{
  [MEMORY[0x1E69BF328] maskForCloudSharedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isIncludedInMoments
{
  [MEMORY[0x1E69BF328] maskForAssetsIncludedInMoments];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)canPerformEditOperation:(unint64_t)a3
{
  v22 = 0;
  v23 = &v22;
  v24 = 0x2020000000;
  v25 = 0;
  if (a3 == 102)
  {
    [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders];
    [(PLManagedAsset *)self savedAssetType];
    v7 = PLValidatedSavedAssetTypeApplies();
    *(v23 + 24) = v7;
    if (v7)
    {
      if (![(PLManagedAsset *)self hasLibraryScope])
      {
        v6 = [objc_opt_class() _isLibraryScopeExiting:self] ^ 1;
        v8 = v23;
        goto LABEL_13;
      }

LABEL_9:
      v8 = v23;
      v6 = 1;
LABEL_13:
      *(v8 + 24) = v6;
      goto LABEL_14;
    }

LABEL_11:
    v6 = 0;
    goto LABEL_14;
  }

  if (a3 != 103)
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke;
    aBlock[3] = &unk_1E7576208;
    aBlock[4] = self;
    aBlock[5] = &v22;
    aBlock[6] = a3;
    v9 = _Block_copy(aBlock);
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_2;
    v20[3] = &unk_1E7577EA0;
    v20[4] = &v22;
    v10 = _Block_copy(v20);
    v19[0] = MEMORY[0x1E69E9820];
    v19[1] = 3221225472;
    v19[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_3;
    v19[3] = &unk_1E7567810;
    v19[4] = &v22;
    v19[5] = a3;
    v11 = _Block_copy(v19);
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_4;
    v18[3] = &unk_1E7576208;
    v18[5] = &v22;
    v18[6] = a3;
    v18[4] = self;
    v12 = _Block_copy(v18);
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __42__PLManagedAsset_canPerformEditOperation___block_invoke_5;
    v17[3] = &unk_1E7567810;
    v17[4] = &v22;
    v17[5] = a3;
    v13 = _Block_copy(v17);
    [MEMORY[0x1E69BF328] executeBlockForSavedAssetType:-[PLManagedAsset savedAssetType](self unknown:"savedAssetType") photoBooth:v9 photoStream:v9 camera:v11 cloudShared:v9 cameraConnectionKit:v12 cloudPhotoLibrary:v9 wallpaper_UNUSED:v9 momentShared:v10 placeholder:v9 referenced:v13 alternate:v9 guest:v9 companionSynced:v11 recovered:v9 legacyImport:v11 collectionShare:v10 unrecognized:{v9, v10}];
    v6 = *(v23 + 24);

    goto LABEL_14;
  }

  [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders];
  [(PLManagedAsset *)self savedAssetType];
  v5 = PLValidatedSavedAssetTypeApplies();
  *(v23 + 24) = v5;
  if (!v5)
  {
    goto LABEL_11;
  }

  if (![(PLManagedAsset *)self hasLibraryScope])
  {
    goto LABEL_9;
  }

  if ([objc_opt_class() _isLibraryScopeExiting:self])
  {
    v6 = 0;
    *(v23 + 24) = 0;
  }

  else
  {
    v15 = [objc_opt_class() predicateToIncludeOnlyContentContributedByCurrentUser];
    v16 = [v15 evaluateWithObject:self];
    *(v23 + 24) = v16;

    v6 = *(v23 + 24);
  }

LABEL_14:
  _Block_object_dispose(&v22, 8);
  return v6 & 1;
}

uint64_t __42__PLManagedAsset_canPerformEditOperation___block_invoke(uint64_t result)
{
  v1 = result;
  if (*(result + 48) == 101 && (result = [*(result + 32) hasLibraryScope], result))
  {
    result = [objc_opt_class() _isLibraryScopeExiting:*(v1 + 32)];
    if (result)
    {
      v2 = 0;
    }

    else
    {
      result = [*(v1 + 32) shareState];
      v2 = result == 1;
    }

    *(*(*(v1 + 40) + 8) + 24) = v2;
  }

  else
  {
    *(*(*(v1 + 40) + 8) + 24) = 1;
  }

  return result;
}

void __42__PLManagedAsset_canPerformEditOperation___block_invoke_4(uint64_t a1)
{
  if (*(a1 + 48) == 1)
  {
    if (([*(a1 + 32) cloudIsMyAsset] & 1) == 0)
    {
      v2 = [*(a1 + 32) cloudShareAlbum];
      if (![v2 isOwnedCloudSharedAlbum])
      {
        v4 = [*(a1 + 32) collectionShare];
        v3 = [v4 isCurrentUserOwner];

        goto LABEL_7;
      }
    }

    v3 = 1;
LABEL_7:
    *(*(*(a1 + 40) + 8) + 24) = v3;
  }
}

- (BOOL)_hasScreenshotDimensions
{
  pl_dispatch_once();
  [(PLManagedAsset *)self originalWidth];
  [(PLManagedAsset *)self originalHeight];
  v3 = DCIM_NSValueFromCGSize();
  v4 = DCIM_NSValueFromCGSize();
  if ([_hasScreenshotDimensions_screenDimensions containsObject:v3])
  {
    v5 = 1;
  }

  else
  {
    v5 = [_hasScreenshotDimensions_screenDimensions containsObject:v4];
  }

  return v5;
}

void __42__PLManagedAsset__hasScreenshotDimensions__block_invoke()
{
  v6 = [MEMORY[0x1E695DF70] arrayWithCapacity:20];
  v0 = 1;
  while (2)
  {
    switch(v0)
    {
      case 1:
      case 2:
      case 3:
      case 4:
      case 5:
      case 6:
      case 7:
      case 8:
      case 9:
      case 11:
      case 12:
      case 13:
      case 14:
      case 15:
      case 16:
      case 17:
      case 18:
      case 19:
        goto LABEL_4;
      case 10:
        v1 = DCIM_NSValueFromCGSize();
        [v6 addObject:v1];

LABEL_4:
        v2 = DCIM_NSValueFromCGSize();
        [v6 addObject:v2];

        goto LABEL_5;
      case 20:
        v3 = DCIM_NSValueFromCGSize();
        [v6 addObject:v3];

        goto LABEL_8;
      default:
LABEL_5:
        if (++v0 != 21)
        {
          continue;
        }

LABEL_8:
        v4 = [objc_alloc(MEMORY[0x1E695DFD8]) initWithArray:v6];
        v5 = _hasScreenshotDimensions_screenDimensions;
        _hasScreenshotDimensions_screenDimensions = v4;

        return;
    }
  }
}

- (BOOL)hasScreenshotMetadata
{
  v2 = [(PLManagedAsset *)self imageProperties];
  if (v2)
  {
    objc_opt_class();
    v3 = [v2 objectForKey:*MEMORY[0x1E696D9B0]];
    if (objc_opt_isKindOfClass())
    {
      v4 = v3;
    }

    else
    {
      v4 = 0;
    }

    v5 = v4;

    if (v5)
    {
      objc_opt_class();
      v6 = [v5 objectForKey:*MEMORY[0x1E696DB40]];
      if (objc_opt_isKindOfClass())
      {
        v7 = v6;
      }

      else
      {
        v7 = 0;
      }

      v8 = v7;

      v9 = [v8 isEqualToString:@"Screenshot"];
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)_hasPanoramaDimensions
{
  v3 = [(PLManagedAsset *)self height];
  if (v3)
  {
    v4 = v3;
    v5 = [(PLManagedAsset *)self width];
    v6 = v5 / v4;
    if (v6 > 2.0 || v6 < 0.5)
    {
      if (v5 <= v4)
      {
        v8 = v4;
      }

      else
      {
        v8 = v5;
      }

      if (v5 >= v4)
      {
        v9 = v4;
      }

      else
      {
        v9 = v5;
      }

      LOBYTE(v3) = v9 > 800 && v8 < 30000;
    }

    else
    {
      LOBYTE(v3) = 0;
    }
  }

  return v3;
}

- (BOOL)isPanorama
{
  v3 = [(PLManagedAsset *)self isPhoto];
  if (v3)
  {
    LOBYTE(v3) = [(PLManagedAsset *)self kindSubtype]== 1;
  }

  return v3;
}

- (BOOL)isColorAware
{
  if ([(PLManagedAsset *)self isPhoto])
  {
    return 1;
  }

  return [(PLManagedAsset *)self isPhotoIris];
}

- (BOOL)hasVideoComponent
{
  v3 = [(PLManagedAsset *)self isVideo];
  v4 = [(PLManagedAsset *)self kindSubtype];
  return (v4 - 100) < 5 || v4 == 2 || v3;
}

- (BOOL)isHDVideo
{
  v3 = [(PLManagedAsset *)self isVideo];
  if (v3)
  {
    v4 = [(PLManagedAsset *)self width];
    v5 = [(PLManagedAsset *)self height];
    LOBYTE(v3) = v4 >= 720 && v5 > 1279 || v4 > 1279 && v5 > 719;
  }

  return v3;
}

- (BOOL)isStreamedVideo
{
  v3 = [(PLManagedAsset *)self isVideo];
  if (v3)
  {
    LOBYTE(v3) = [(PLManagedAsset *)self kindSubtype]== 100;
  }

  return v3;
}

- (PLCloudSharedAlbumProtocol)cloudShareAlbum
{
  v16 = *MEMORY[0x1E69E9840];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v2 = [(PLManagedAsset *)self albums];
  v3 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = 0;
    v6 = *v12;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v12 != v6)
        {
          objc_enumerationMutation(v2);
        }

        v8 = *(*(&v11 + 1) + 8 * i);
        if ([v8 isCloudSharedAlbum])
        {
          v9 = v8;

          v5 = v9;
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v4);
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (BOOL)isCloudPhotoLibraryAsset
{
  [MEMORY[0x1E69BF328] maskForCloudPhotoLibraryAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isVisibleForSocialGroupKeyAssetFetch
{
  if (([(PLManagedAsset *)self hidden]& 1) != 0 || [(PLManagedAsset *)self trashedState]|| ![(PLManagedAsset *)self avalanchePickTypeIsVisible])
  {
    v3 = 0;
  }

  else
  {
    [MEMORY[0x1E69BF328] maskForSocialGroupKeyAssetFetch];
    [(PLManagedAsset *)self savedAssetType];
    v3 = PLValidatedSavedAssetTypeApplies();
  }

  v4 = [(PLManagedObject *)self photoLibrary];
  v5 = [v4 isCloudPhotoLibraryEnabled];

  if (v5)
  {
    if (!v3)
    {
      return 0;
    }

    return ![(PLManagedAsset *)self isPhotoStreamPhoto];
  }

  if (v3)
  {
    [(PLManagedAsset *)self setVisibilityState:0];
    return ![(PLManagedAsset *)self isPhotoStreamPhoto];
  }

  return 0;
}

- (BOOL)isReferencedAsset
{
  [MEMORY[0x1E69BF328] maskForReferencedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isCameraConnectionKitAsset
{
  [MEMORY[0x1E69BF328] maskForCameraConnectionKitAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isCPLSharingScopeAsset
{
  [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLSharingScopes];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isCloudSharedAsset
{
  [MEMORY[0x1E69BF328] maskForCloudSharedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isFinderSyncedAsset
{
  [MEMORY[0x1E69BF328] maskForFinderSyncedAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isPlaceholderAsset
{
  [MEMORY[0x1E69BF328] maskForPlaceholderAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (BOOL)isPhotoStreamPhoto
{
  [MEMORY[0x1E69BF328] maskForPhotoStreamAsset];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (CLLocationCoordinate2D)gpsCoordinate
{
  v2 = [(PLManagedAsset *)self location];
  v3 = v2;
  v5 = *MEMORY[0x1E6985CC0];
  v4 = *(MEMORY[0x1E6985CC0] + 8);
  if (v2)
  {
    [v2 coordinate];
    v7 = v6;
    v9 = v8;
    if ([PLLocationUtils canUseCoordinate:?])
    {
      v4 = v9;
      v5 = v7;
    }
  }

  v10 = v5;
  v11 = v4;
  result.longitude = v11;
  result.latitude = v10;
  return result;
}

- (id)managedAssetForPhotoLibrary:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedObject *)self photoLibrary];

  if (v5 == v4)
  {
    v6 = self;
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)setImageSize:(CGSize)a3
{
  height = a3.height;
  [(PLManagedAsset *)self setWidth:vcvtpd_s64_f64(a3.width)];
  v5 = vcvtpd_s64_f64(height);

  [(PLManagedAsset *)self setHeight:v5];
}

- (CGSize)imageSize
{
  v3 = [(PLManagedAsset *)self width];
  v4 = [(PLManagedAsset *)self height];
  v5 = v3;
  result.height = v4;
  result.width = v5;
  return result;
}

- (unsigned)shareState
{
  v3 = [(PLManagedAsset *)self libraryScope];

  if (!v3)
  {
    return 0;
  }

  v4 = [objc_opt_class() predicateToIncludeOnlyContentContributedByCurrentUser];
  v5 = [v4 evaluateWithObject:self];

  if (v5)
  {
    return 1;
  }

  else
  {
    return 2;
  }
}

- (id)imageDataForThumbGenerationAndIfNeededRAWUTI:(id *)a3 isPreviewSource:(BOOL *)a4
{
  v35 = *MEMORY[0x1E69E9840];
  v7 = [MEMORY[0x1E696AC08] defaultManager];
  if ([(PLManagedAsset *)self hasUnrenderedAsyncAdjustments])
  {
    v8 = [(PLManagedAsset *)self pathForAsyncAdjustedRenderPreviewImageFile];
    v9 = [v7 fileExistsAtPath:v8];
    v10 = v9;
    if (v9)
    {
      v11 = v8;
    }

    else
    {
      v11 = 0;
    }
  }

  else
  {
    v10 = 0;
    v11 = 0;
  }

  v12 = [(PLManagedAsset *)self isPhoto];
  if (!v11 && v12)
  {
    if ([(PLManagedAsset *)self hasAdjustments])
    {
      v11 = [(PLManagedAsset *)self pathForBestAvailableFullsizeRenderImageFileOutIsSubstandard:0];
      v13 = PLThumbnailsGetLog();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
      {
        v14 = [(PLManagedAsset *)self uuid];
        *buf = 138412546;
        v32 = v11;
        v33 = 2114;
        v34 = v14;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEBUG, "Best available file for thumbnail generation is %@ for uuid %{public}@", buf, 0x16u);
      }
    }

    else
    {
      v13 = [(PLManagedAsset *)self pathForLargeThumbnailFile];
      if ([v7 fileExistsAtPath:v13])
      {
        v13 = v13;
        v11 = v13;
      }

      else
      {
        v15 = [(PLManagedAsset *)self pathForFullsizeImageFile];
        if ([v7 fileExistsAtPath:v15])
        {
          v11 = v15;
        }

        else
        {
          v16 = [(PLManagedAsset *)self pathForOriginalFile];
          if ([v7 fileExistsAtPath:v16])
          {
            v30 = v16;
            v11 = v16;
            v17 = [v11 pathExtension];
            v18 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:v17 assetType:[(PLManagedAsset *)self kind]];

            v19 = v18;
            if (v18)
            {
              [MEMORY[0x1E6982C40] typeWithIdentifier:v18];
              v20 = v29 = v18;
              v21 = [v20 conformsToType:*MEMORY[0x1E6982F88]];

              v19 = v29;
              if (v21)
              {
                if (a3)
                {
                  v22 = v29;
                  *a3 = v29;
                }

                v23 = PLBackendGetLog();
                if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
                {
                  *buf = 138412546;
                  v32 = v11;
                  v33 = 2112;
                  v34 = v15;
                  _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_DEFAULT, "Rebuilding thumbs from RAW file (%@) because fullsize image is missing (%@). This might cause assetsd to jetsam.", buf, 0x16u);
                }
              }
            }

            v16 = v30;
          }

          else
          {
            v11 = 0;
          }
        }
      }
    }
  }

  if (!v11)
  {
    if (!-[PLManagedAsset isVideo](self, "isVideo") && ([v7 fileExistsAtPath:0] & 1) != 0)
    {
      v11 = 0;
      goto LABEL_48;
    }

    v11 = [(PLManagedAsset *)self pathForLargeThumbnailFile];
    if (([v7 fileExistsAtPath:v11] & 1) == 0)
    {
      v24 = [(PLManagedAsset *)self pathForMediumThumbnailFile];

      if (([v7 fileExistsAtPath:v24] & 1) != 0 || (!-[PLManagedAsset isPhoto](self, "isPhoto") || -[PLManagedAsset hasAdjustments](self, "hasAdjustments")) && (!-[PLManagedAsset isVideo](self, "isVideo") || -[PLManagedAsset hasAdjustments](self, "hasAdjustments") && !-[PLManagedAsset isDefaultAdjustedSlomo](self, "isDefaultAdjustedSlomo")))
      {
        v11 = v24;
      }

      else
      {
        v11 = [(PLManagedAsset *)self pathForOriginalFile];
      }
    }

    if (!v11)
    {
      goto LABEL_48;
    }
  }

  if (![v7 fileExistsAtPath:v11])
  {
LABEL_48:
    v27 = 0;
    if (!a4)
    {
      goto LABEL_50;
    }

    goto LABEL_49;
  }

  v25 = PLThumbnailsGetLog();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
  {
    v26 = [(PLManagedAsset *)self uuid];
    *buf = 138543618;
    v32 = v26;
    v33 = 2112;
    v34 = v11;
    _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Rebuilding thumbnail for %{public}@ with %@", buf, 0x16u);
  }

  v27 = [MEMORY[0x1E695DEF0] dataWithContentsOfFile:v11 options:1 error:0];
  if (a4)
  {
LABEL_49:
    *a4 = v10;
  }

LABEL_50:

  return v27;
}

- (void)setFaceRegionsFromImageMetadata:(CGImageMetadata *)a3
{
  if (a3)
  {
    v5 = PLGetFaceRegionsFromImageMetadata(a3);
    v4 = PLManagedAssetEncodeFaceRegions(v5);
    [(PLManagedAsset *)self setFaceRegions:v4];
  }
}

- (void)setFaceRegionsFromCGImageProperties:(id)a3
{
  v5 = PLGetFaceRegionsFromCGImageProperties(a3);
  v4 = PLManagedAssetEncodeFaceRegions(v5);
  [(PLManagedAsset *)self setFaceRegions:v4];
}

- (BOOL)setVideoInfoFromFileAtURL:(id)a3 mainFileMetadata:(id)a4 fullSizeRenderURL:(id)a5 overwriteOriginalProperties:(BOOL)a6
{
  v6 = a6;
  v37 = *MEMORY[0x1E69E9840];
  v11 = a3;
  v12 = a4;
  v13 = a5;
  if (v11 | v12)
  {
    v34 = 0;
    v14 = [(PLManagedAsset *)self _effectiveMetadataForMainFileURL:v11 mainFileMetadata:v12 fullSizeRenderURL:v13 shouldCache:0 error:&v34];
    v15 = v34;
    v16 = v14 != 0;
    if (v14)
    {
      v17 = objc_autoreleasePoolPush();
      [(PLManagedAsset *)self updateVideoAttributesFromMetadata:v14 overwriteOriginalProperties:v6];
      if (v6)
      {
        if (v13)
        {
          v32 = [MEMORY[0x1E696AAA8] currentHandler];
          [v32 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:6740 description:@"Overwriting original properties should only happen when fullSizeRenderURL is nil"];
        }

        [v14 orientedPixelSize];
        v19 = v18;
        [(PLManagedAsset *)self setOriginalWidth:v20];
        [(PLManagedAsset *)self setOriginalHeight:v19];
        v21 = [v14 gpsLocation];
        if (v21 && (v22 = v21, [v14 gpsLocation], v23 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v23, "coordinate"), v24 = +[PLLocationUtils canUseCoordinate:](PLLocationUtils, "canUseCoordinate:"), v23, v22, v24))
        {
          v25 = [v14 gpsLocation];
          [(PLManagedAsset *)self setLocation:v25];
        }

        else
        {
          [(PLManagedAsset *)self setLocation:0];
        }

        v27 = [v14 originatingAssetIdentifier];
        if (v27)
        {
          v28 = [(PLManagedAsset *)self additionalAttributes];
          [v28 setOriginatingAssetIdentifier:v27];
        }

        if (PLPlatformExtendedAttributesSupported() && ![(PLManagedAsset *)self isCloudSharedAsset])
        {
          [(PLManagedAsset *)self updateVideoExtendedAttributesFromMetadata:v14];
        }

        v29 = [v14 author];
        v30 = [v29 isEqual:@"ReplayKitRecording"];

        if (v30)
        {
          [(PLManagedAsset *)self setKindSubtype:103];
        }

        v17 = v33;
      }

      objc_autoreleasePoolPop(v17);
    }

    else
    {
      v26 = PLBackendGetLog();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v36 = v15;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Unable to load metadata with error: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    v16 = 0;
  }

  return v16;
}

- (id)_effectiveMetadataForMainFileURL:(id)a3 mainFileMetadata:(id)a4 fullSizeRenderURL:(id)a5 shouldCache:(BOOL)a6 error:(id *)a7
{
  v8 = a6;
  v52 = *MEMORY[0x1E69E9840];
  v13 = a3;
  v14 = a4;
  v15 = a5;
  if ([v14 isSyndicationOriginated])
  {
    v16 = v14;
    v17 = 0;
  }

  else
  {
    if (v15)
    {
      v18 = 0;
    }

    else
    {
      v18 = v14;
    }

    v19 = v18;
    v16 = v19;
    if (v19)
    {
      v20 = [v19 fileURL];

      if (v20)
      {
        v21 = 0;
        v16 = v14;
        goto LABEL_24;
      }
    }

    aSelector = a2;
    v45 = a7;
    if (v15)
    {
      v22 = v15;
    }

    else
    {
      v22 = v13;
    }

    v23 = v22;
    if (v23)
    {
      v24 = v23;
      v25 = objc_alloc(MEMORY[0x1E69C0718]);
      v26 = [(PLManagedObject *)self photoLibrary];
      v27 = [v26 libraryBundle];
      v28 = [v27 timeZoneLookup];
      v29 = v25;
      v23 = v24;
      v30 = [v29 initWithMediaURL:v24 options:12 timeZoneLookup:v28 shouldCache:v8];

      v16 = v30;
    }

    if (v16)
    {
      v17 = 0;
    }

    else
    {
      v31 = PLMigrationGetLog();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
      {
        v32 = NSStringFromSelector(aSelector);
        v33 = [v23 path];
        *buf = 138412546;
        v49 = v32;
        v50 = 2112;
        v51 = v33;
        _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "%@ Unable to get file metadata for '%@', skip updating asset attributes", buf, 0x16u);
      }

      aSelectora = MEMORY[0x1E696ABC0];
      v34 = *MEMORY[0x1E69BFF48];
      v46 = *MEMORY[0x1E696A278];
      v35 = MEMORY[0x1E696AEC0];
      v36 = [v23 path];
      v37 = [v35 stringWithFormat:@"Unable to load file metadata from path %@", v36];
      v47 = v37;
      [MEMORY[0x1E695DF20] dictionaryWithObjects:&v47 forKeys:&v46 count:1];
      v39 = v38 = v23;
      v17 = [aSelectora errorWithDomain:v34 code:47020 userInfo:v39];

      v23 = v38;
    }

    a7 = v45;
  }

  v40 = v17;
  v21 = v40;
  if (!v16)
  {
    if (a7)
    {
      v41 = v40;
      v16 = 0;
      *a7 = v21;
    }

    else
    {
      v16 = 0;
    }
  }

LABEL_24:

  return v16;
}

- (id)_metadataFromMediaProperties:(id)a3 uniformTypeIdentifier:(id)a4 block:(id)a5
{
  v33 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  objc_opt_class();
  v11 = [(PLManagedAsset *)self managedObjectContext];
  if (objc_opt_isKindOfClass())
  {
    v12 = v11;
  }

  else
  {
    v12 = 0;
  }

  v13 = v12;

  v14 = [v13 pl_libraryBundle];

  v15 = [v14 timeZoneLookup];

  if (!v8)
  {
    goto LABEL_16;
  }

  v16 = [(PLManagedAsset *)self kind];
  if ((v16 - 1) < 2)
  {
    v19 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVProxyData:v8 timeZoneLookup:v15];
    if (!v19)
    {
      goto LABEL_16;
    }

    goto LABEL_11;
  }

  if (v16 == 3)
  {
    v22 = PLBackendGetLog();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      v31 = 67109120;
      LODWORD(v32) = [(PLManagedAsset *)self kind];
      _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Unexpected asset kind: %d", &v31, 8u);
    }

LABEL_16:
    if (!v10)
    {
LABEL_30:
      v20 = PLBackendGetLog();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
      {
        v29 = [(PLManagedAsset *)self uuid];
        v31 = 138543362;
        v32 = v29;
        _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Failed to obtain media metadata for asset: %{public}@", &v31, 0xCu);
      }

      v19 = 0;
      goto LABEL_33;
    }

    v20 = v10[2](v10);
    v23 = [(PLManagedAsset *)self kind];
    if ((v23 - 1) >= 2)
    {
      if (v23 == 3)
      {
        v27 = PLBackendGetLog();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
        {
          v28 = [(PLManagedAsset *)self kind];
          v31 = 67109120;
          LODWORD(v32) = v28;
          _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_ERROR, "Unexpected asset kind: %d", &v31, 8u);
        }
      }

      else if (!v23)
      {
        v24 = [objc_alloc(MEMORY[0x1E69C0718]) initWithImageURL:v20 contentType:0 options:12 timeZoneLookup:v15 cacheImageSource:1 cacheImageData:0];
        goto LABEL_22;
      }

LABEL_29:

      goto LABEL_30;
    }

    v24 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVURL:v20 options:12 timeZoneLookup:v15];
LABEL_22:
    v19 = v24;
    if (v24)
    {
      v25 = PLBackendGetLog();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
      {
        v26 = [(PLManagedAsset *)self uuid];
        v31 = 138543362;
        v32 = v26;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Metadata obtained from file url for asset: %{public}@", &v31, 0xCu);
      }

      goto LABEL_33;
    }

    goto LABEL_29;
  }

  if (v16)
  {
    goto LABEL_16;
  }

  v17 = objc_alloc(MEMORY[0x1E69C0718]);
  v18 = [MEMORY[0x1E69C08F0] typeWithIdentifier:v9];
  v19 = [v17 initWithImageSourceProxyOrEncodedImagePropertyData:v8 contentType:v18 timeZoneLookup:v15];

  if (!v19)
  {
    goto LABEL_16;
  }

LABEL_11:
  v20 = PLBackendGetLog();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
  {
    v21 = [(PLManagedAsset *)self uuid];
    v31 = 138543362;
    v32 = v21;
    _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Metadata obtained from mediaMetadata data for asset: %{public}@", &v31, 0xCu);
  }

LABEL_33:

  return v19;
}

- (id)fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:(id)a3
{
  v4 = a3;
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v5 = [(PLManagedAsset *)self uniformTypeIdentifier];
    v12 = MEMORY[0x1E69E9820];
    v13 = 3221225472;
    v14 = __93__PLManagedAsset_fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL___block_invoke;
    v15 = &unk_1E75677C0;
    v16 = v4;
    v17 = self;
    v6 = [(PLManagedAsset *)self _metadataFromMediaProperties:0 uniformTypeIdentifier:v5 block:&v12];

    if (!v6)
    {
      v7 = [(PLManagedAsset *)self additionalAttributes:v12];
      v8 = [v7 mediaMetadata];
      v9 = [v8 data];

      v10 = [(PLManagedAsset *)self uniformTypeIdentifier];
      v6 = [(PLManagedAsset *)self _metadataFromMediaProperties:v9 uniformTypeIdentifier:v10 block:0];
    }
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

id __93__PLManagedAsset_fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) pathForAdjustedFullsizeImageFile];
  v4 = v3;
  if (v2)
  {
    v5 = 1;
  }

  else
  {
    v5 = v3 == 0;
  }

  if (!v5)
  {
    v2 = [MEMORY[0x1E695DFF8] fileURLWithPath:v3 isDirectory:0];
  }

  return v2;
}

- (id)metadataFromMediaPropertiesOrOriginalResource
{
  v3 = [(PLManagedAsset *)self master];
  v4 = [v3 mediaMetadata];
  v5 = [v4 data];

  v6 = [(PLManagedAsset *)self master];
  v7 = [v6 uniformTypeIdentifier];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __63__PLManagedAsset_metadataFromMediaPropertiesOrOriginalResource__block_invoke;
  v10[3] = &unk_1E7567798;
  v10[4] = self;
  v8 = [(PLManagedAsset *)self _metadataFromMediaProperties:v5 uniformTypeIdentifier:v7 block:v10];

  return v8;
}

- (void)updateVideoAttributesFromMetadata:(id)a3 overwriteOriginalProperties:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  if (v6)
  {
    v23 = v6;
    v7 = [v6 durationTimeInterval];
    [v7 doubleValue];
    v9 = v8;

    [(PLManagedAsset *)self duration];
    if (vabdd_f64(v10, v9) > 0.00000011920929)
    {
      [(PLManagedAsset *)self setDuration:v9];
    }

    [v23 orientedPixelSize];
    v12 = v11;
    v14 = v13;
    if (v11 != [(PLManagedAsset *)self width])
    {
      [(PLManagedAsset *)self setWidth:v12];
    }

    if (v14 != [(PLManagedAsset *)self height])
    {
      [(PLManagedAsset *)self setHeight:v14];
    }

    v15 = [(PLManagedAsset *)self highFrameRateState];
    if ([v23 isSloMo])
    {
      if (v4)
      {
        v16 = v15 | 3;
        [(PLManagedAsset *)self setKindSubtype:101];
      }

      else
      {
        v16 = v15 | 2;
      }
    }

    else if (v15)
    {
      v16 = v15 & 0xFFFD;
    }

    else
    {
      v16 = v15;
    }

    if ([(PLManagedAsset *)self highFrameRateState]!= v16)
    {
      [(PLManagedAsset *)self setHighFrameRateState:v16];
    }

    [(PLManagedAsset *)self setPlaybackControlBadgeAttributeFromMetadata:v23];
    if (-[PLManagedAsset kindSubtype](self, "kindSubtype") != 102 && [v23 isTimelapse])
    {
      [(PLManagedAsset *)self setKindSubtype:102];
    }

    if (-[PLManagedAsset kindSubtype](self, "kindSubtype") != 104 && [v23 isActionCam])
    {
      [(PLManagedAsset *)self setKindSubtype:104];
    }

    v17 = [v23 playbackVariation];
    -[PLManagedAsset updatePlaybackVariationAndLoopingStyleFromVariation:](self, "updatePlaybackVariationAndLoopingStyleFromVariation:", [v17 unsignedIntegerValue]);

    [(PLManagedAsset *)self updateSmartStyleVideoCastFromMetadata:v23];
    v18 = [v23 montageString];
    if (v18)
    {
      v19 = [(PLManagedAsset *)self additionalAttributes];
      [v19 setMontage:v18];
    }

    v20 = [(PLManagedAsset *)self mediaGroupUUID];
    v21 = [v20 length];

    if (!v21)
    {
      v22 = [v23 livePhotoPairingIdentifier];
      if (v22)
      {
        [(PLManagedAsset *)self setMediaGroupUUID:v22];
      }
    }

    [(PLManagedAsset *)self setTimeExifTimestampStringFromMetadata:v23];
    [(PLManagedAsset *)self setSpatialTypeFromMetadata:v23];
    if ([v23 isHDR])
    {
      [(PLManagedAsset *)self _setHDRTypeFromMetadata:v23];
    }

    if ([v23 isCinematicVideo])
    {
      [(PLManagedAsset *)self setDepthTypeFromMetadata:v23];
    }

    [(PLManagedAsset *)self setSpatialAudioControlBadgeAttributeFromMetadata:v23];
    if ([v23 isProRes])
    {
      [(PLManagedAsset *)self setIsMagicCarpet:1];
      [(PLManagedAsset *)self setProResBadgeAttribute:1];
    }

    [(PLManagedAsset *)self setCameraCaptureDeviceFromMetadata:v23];

    v6 = v23;
  }
}

- (void)updateAudioExtendedAttributesFromMetadata:(id)a3
{
  v31 = a3;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (v31)
  {
    v5 = [v31 durationTimeInterval];
    [v5 doubleValue];
    v7 = v6;

    v8 = [v4 duration];
    [v8 doubleValue];
    v10 = vabdd_f64(v9, v7);

    if (v10 > 2.22044605e-16)
    {
      v11 = [MEMORY[0x1E696AD98] numberWithDouble:v7];
      [v4 setDuration:v11];
    }

    v12 = [v31 audioSampleRate];
    [v12 doubleValue];
    v14 = v13;

    v15 = [v4 sampleRate];
    [v15 doubleValue];
    v17 = vabdd_f64(v16, v14);

    if (v17 > 2.22044605e-16)
    {
      v18 = [MEMORY[0x1E696AD98] numberWithDouble:v14];
      [v4 setSampleRate:v18];
    }

    v19 = [v31 audioTrackFormat];
    v20 = [v19 unsignedIntegerValue];

    v21 = [v4 trackFormat];
    v22 = [v21 unsignedIntegerValue];

    if (v22 != v20)
    {
      v23 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v20];
      [v4 setTrackFormat:v23];
    }

    v24 = [v31 audioDataRate];
    [v24 doubleValue];
    v26 = v25;

    v27 = [v4 bitrate];
    [v27 doubleValue];
    v29 = vabdd_f64(v28, v26);

    if (v29 > 2.22044605e-16)
    {
      v30 = [MEMORY[0x1E696AD98] numberWithDouble:v14];
      [v4 setBitrate:v30];
    }
  }
}

- (void)updateVideoExtendedAttributesFromMetadata:(id)a3
{
  v21 = a3;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (v21)
  {
    [(PLManagedAsset *)self _updateCoreExtendedAttributes:v4 fromMetadata:v21];
    v5 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(v21, "orientation")}];
    [v4 setOrientation:v5];

    v6 = [v21 durationTimeInterval];
    if (v6)
    {
      v7 = [v4 duration];
      [v7 doubleValue];
      v9 = v8;
      [v6 doubleValue];
      v11 = vabdd_f64(v9, v10);

      if (v11 > 2.22044605e-16)
      {
        [v4 setDuration:v6];
      }
    }

    v12 = [v21 nominalFrameRate];
    if (v12)
    {
      v13 = [v4 fps];
      [v13 doubleValue];
      v15 = v14;
      [v12 doubleValue];
      v17 = vabdd_f64(v15, v16);

      if (v17 > 2.22044605e-16)
      {
        [v4 setFps:v12];
      }
    }

    v18 = [v21 firstVideoTrackCodecString];
    v19 = [v4 codec];
    v20 = [v18 isEqualToString:v19];

    if ((v20 & 1) == 0)
    {
      [v4 setCodec:v18];
    }
  }
}

- (BOOL)setImageInfoFromImageMetadata:(id)a3 overwriteOriginalProperties:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = [v6 cgImageProperties];
    [(PLManagedAsset *)self _setSizeAndOrientationFromMetadata:v6];
    v9 = [v6 cgImageMetadata];
    if (v9)
    {
      [(PLManagedAsset *)self setFaceRegionsFromImageMetadata:v9];
      [(PLManagedAsset *)self revalidateFaceAreaPoints];
    }

    v10 = [v6 contentType];
    v11 = [v10 identifier];
    [(PLManagedAsset *)self setUniformTypeIdentifier:v11];

    if (v4)
    {
      [(PLManagedAsset *)self _setOriginalSizeAndOrientationFromMetadata:v6];
      if (v8)
      {
        [(PLManagedAsset *)self setThumbnailDataFromImageProperties:v8];
      }

      v12 = [v6 gpsLocation];
      [(PLManagedAsset *)self setLocation:v12];

      [(PLManagedAsset *)self _setSavedAssetTypeFromMetadata:v6];
      [(PLManagedAsset *)self setKeywordsFromImageProperties:v8];
      [(PLManagedAsset *)self _setPhotoIrisPropertiesFromMetadata:v6];
      [(PLManagedAsset *)self updateKindSubtypeIfScreenshotWithMetadata:v6];
      [(PLManagedAsset *)self updatePanoramosityWithMetadata:v6];
      if (![(PLManagedAsset *)self isCloudSharedAsset])
      {
        [(PLManagedAsset *)self setImageInfoFromOriginalImageMetadata:v6];
      }

      v13 = MEMORY[0x1E69BF2A0];
      v14 = [(PLManagedAsset *)self pl_photoLibrary];
      v15 = [v14 pathManager];
      v16 = [v15 libraryURL];
      v17 = [v13 wellKnownPhotoLibraryIdentifierForURL:v16];

      if (v17 != 3)
      {
        [(PLManagedAsset *)self _setBurstUuidFromMetadata:v6];
      }

      v18 = [v6 originatingAssetIdentifier];
      if (v18)
      {
        v19 = [(PLManagedAsset *)self additionalAttributes];
        [v19 setOriginatingAssetIdentifier:v18];
      }
    }

    else
    {
      [(PLManagedAsset *)self setDepthTypeFromMetadata:v6];
      [(PLManagedAsset *)self _setHDRGainFromMetadata:v6];
    }

    objc_autoreleasePoolPop(v7);
  }

  return v6 != 0;
}

- (void)_setBurstUuidFromMetadata:(id)a3
{
  v5 = a3;
  v4 = [(PLManagedAsset *)self avalancheUUID];
  if (v4)
  {
LABEL_2:

    goto LABEL_3;
  }

  [MEMORY[0x1E69BF328] maskForAvalancheSupportedAssets];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    v4 = [v5 burstUuid];
    if (v4)
    {
      [(PLManagedAsset *)self setAvalancheUUID:v4];
      [(PLManagedAsset *)self setAvalanchePickType:1];
      [(PLManagedAsset *)self setAvalancheKind:1];
      if (+[PLAvalanche shouldOnlyShowAvalanchePicks])
      {
        [(PLManagedAsset *)self setVisibilityState:2];
      }
    }

    goto LABEL_2;
  }

LABEL_3:
}

- (void)setImageInfoFromOriginalImageMetadata:(id)a3
{
  v4 = a3;
  if (v4)
  {
    [(PLManagedAsset *)self setCameraCaptureDeviceFromMetadata:v4];
    [(PLManagedAsset *)self _setHDRTypeFromMetadata:v4];
    [(PLManagedAsset *)self _setColorSpaceNameFromMetadata:v4];
    [(PLManagedAsset *)self setDepthTypeFromMetadata:v4];
    [(PLManagedAsset *)self setEditableDepthBadgeAttributeFromMetadata:v4];
    [(PLManagedAsset *)self setSpatialTypeFromMetadata:v4];
    [(PLManagedAsset *)self updatePlaybackVariationAndStyleFromOriginalMetadata:v4];
    [(PLManagedAsset *)self _setHDRGainFromMetadata:v4];
    [(PLManagedAsset *)self _setSOCGroupIdentifierFromMetadata:v4];
    [(PLManagedAsset *)self setTimeExifTimestampStringFromMetadata:v4];
    [(PLManagedAsset *)self setCurrentSleetCastFromMetadata:v4];
    if (PLPlatformExtendedAttributesSupported())
    {
      [(PLManagedAsset *)self updateImageExtendedAttributesFromMetadata:v4];
    }
  }
}

- (id)evaluateWhiteBalanceValueWithOriginalExifProperties:(id)a3
{
  v3 = a3;
  v4 = [v3 objectForKey:*MEMORY[0x1E696DB50]];
  v5 = v4;
  if (v4)
  {
    if (([v4 isEqualToNumber:&unk_1F0FBB0B0] & 1) == 0)
    {
      v6 = [v3 objectForKey:*MEMORY[0x1E696DA68]];

      v5 = v6;
      if (!v6)
      {
        v7 = [v3 objectForKey:*MEMORY[0x1E696D440]];
        v8 = v7;
        if (v7 && (v9 = [v7 integerValue], v9 <= 0x15))
        {
          v5 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:evaluateWhiteBalanceValueWithOriginalExifProperties__canonWhiteBalance[v9]];
        }

        else
        {
          v5 = 0;
        }
      }
    }
  }

  return v5;
}

- (void)updateImageExtendedGenerativeAttributesFromMetadata:(id)a3
{
  v7 = a3;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (v7)
  {
    v5 = [v7 generativeAIImageType];
    [v4 setGenerativeAIType:v5];

    v6 = [v7 credit];
    [v4 setCredit:v6];
  }

  else
  {
    [v4 setGenerativeAIType:0];
    [v4 setCredit:0];
  }
}

- (void)updateImageExtendedAttributesFromMetadata:(id)a3
{
  v26 = a3;
  v4 = [(PLManagedAsset *)self extendedAttributesCreateIfNeeded:1];
  if (v26)
  {
    [(PLManagedAsset *)self _updateCoreExtendedAttributes:v4 fromMetadata:v26];
    v5 = [v26 fNumber];
    [v4 setAperture:v5];

    v6 = [v26 exposureBias];
    [v4 setExposureBias:v6];

    v7 = [MEMORY[0x1E696AD98] numberWithBool:{objc_msgSend(v26, "flashFired")}];
    [v4 setFlashFired:v7];

    v8 = [v26 focalLength];
    [v4 setFocalLength:v8];

    v9 = [v26 focalLengthIn35mm];
    [v4 setFocalLengthIn35mm:v9];

    v10 = [v26 iso];
    [v4 setIso:v10];

    v11 = [v26 lensModel];
    [v4 setLensModel:v11];

    v12 = [v26 meteringMode];
    [v4 setMeteringMode:v12];

    v13 = [v26 exposureTime];
    [v4 setShutterSpeed:v13];

    v14 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(v26, "orientation")}];
    [v4 setOrientation:v14];

    v15 = [v26 semanticStyleToneBias];
    [v4 setSlushSceneBias:v15];

    v16 = [v26 semanticStyleWarmthBias];
    [v4 setSlushWarmthBias:v16];

    v17 = [v26 semanticStyleRenderingVersion];
    [v4 setSlushVersion:v17];

    v18 = [v26 semanticStylePreset];
    [v4 setSlushPreset:v18];

    v19 = [MEMORY[0x1E696AD98] numberWithShort:{objc_msgSend(v26, "smartStyleCast")}];
    [v4 setSleetCast:v19];

    v20 = [v26 smartStyleToneBias];
    [v4 setSleetToneBias:v20];

    v21 = [v26 smartStyleColorBias];
    [v4 setSleetColorBias:v21];

    v22 = [v26 smartStyleIntensity];
    [v4 setSleetIntensity:v22];

    v23 = [v26 smartStyleRenderingVersion];
    [v4 setSleetRenderingVersion:v23];

    [(PLManagedAsset *)self setIsSmartStyleableWithMetadata:v26];
    v24 = [v26 digitalZoomRatio];
    [v4 setDigitalZoomRatio:v24];

    [(PLManagedAsset *)self updateImageExtendedGenerativeAttributesFromMetadata:v26];
    v25 = [v26 whiteBalance];
    if (v25)
    {
      [v4 setWhiteBalance:v25];
    }
  }
}

- (void)_updateCoreExtendedAttributes:(id)a3 fromMetadata:(id)a4
{
  v30 = a3;
  v6 = a4;
  if (!v30 || !v6)
  {
    goto LABEL_21;
  }

  v7 = [v6 creationDateSource];
  v8 = [(PLManagedAsset *)self additionalAttributes];
  [v8 setDateCreatedSource:v7];

  v9 = [v6 creationDateSource];
  if ((v9 - 1) < 3)
  {
    v10 = [v6 utcCreationDate];

    if (!v10)
    {
      [(PLManagedAsset *)self _updateCoreDateExtendedAttributes:v30 fromMetadata:0];
      v14 = [(PLManagedAsset *)self additionalAttributes];
      [v14 setDateCreatedSource:0];

      goto LABEL_10;
    }

    v11 = self;
    v12 = v30;
    v13 = v6;
    goto LABEL_8;
  }

  if (!v9)
  {
    v11 = self;
    v12 = v30;
    v13 = 0;
LABEL_8:
    [(PLManagedAsset *)v11 _updateCoreDateExtendedAttributes:v12 fromMetadata:v13];
  }

LABEL_10:
  v15 = [v6 cameraMake];
  v16 = [v30 cameraMake];
  v17 = [v15 isEqualToString:v16];

  if ((v17 & 1) == 0)
  {
    [v30 setCameraMake:v15];
  }

  v18 = [v6 cameraModel];
  v19 = [v30 cameraModel];
  v20 = [v18 isEqualToString:v19];

  if ((v20 & 1) == 0)
  {
    [v30 setCameraModel:v18];
  }

  v21 = [v6 lensModel];
  if (v21)
  {
    [v30 setLensModel:v21];
  }

  v22 = [v6 focalLengthIn35mm];
  if (v22)
  {
    [v30 setFocalLengthIn35mm:v22];
  }

  v23 = [v6 gpsLocation];
  v24 = v23;
  if (v23)
  {
    v25 = MEMORY[0x1E696AD98];
    [v23 coordinate];
    v26 = [v25 numberWithDouble:?];
    [v30 setLatitude:v26];

    v27 = MEMORY[0x1E696AD98];
    [v24 coordinate];
    v29 = [v27 numberWithDouble:v28];
    [v30 setLongitude:v29];
  }

LABEL_21:
}

- (void)_updateCoreDateExtendedAttributes:(id)a3 fromMetadata:(id)a4
{
  v5 = a4;
  v6 = a3;
  v7 = [v5 utcCreationDate];
  [v6 setDateCreated:v7];

  v8 = [v5 timeZoneName];
  [v6 setTimezoneName:v8];

  v9 = [v5 timeZoneOffset];

  [v6 setTimezoneOffset:v9];
}

- (BOOL)updateExtendedAttributesWithMetadata:(id)a3 error:(id *)a4
{
  v36[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  if (!PLPlatformExtendedAttributesSupported())
  {
    v16 = 1;
    goto LABEL_20;
  }

  if ([(PLManagedAsset *)self kind]== 3)
  {
    v7 = MEMORY[0x1E696AEC0];
    v8 = [(PLManagedAsset *)self uuid];
    v9 = [v7 stringWithFormat:@"Unsupported asset kind for asset: %@", v8];

    v10 = MEMORY[0x1E696ABC0];
    v11 = *MEMORY[0x1E69BFF48];
    v29 = *MEMORY[0x1E696A578];
    v30 = v9;
    v12 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v30 forKeys:&v29 count:1];
    v13 = [v10 errorWithDomain:v11 code:46309 userInfo:v12];

    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543362;
      v34 = v9;
LABEL_15:
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "%{public}@", buf, 0xCu);
    }
  }

  else
  {
    if (v6)
    {
      v13 = 0;
      v15 = [(PLManagedAsset *)self kind];
      v16 = 1;
      if (v15 > 1)
      {
        if (v15 != 2)
        {
          if (v15 != 3)
          {
            goto LABEL_17;
          }

          v22 = MEMORY[0x1E696AEC0];
          v23 = [(PLManagedAsset *)self uuid];
          v9 = [v22 stringWithFormat:@"Unsupported asset kind for asset: %@", v23];

          v24 = MEMORY[0x1E696ABC0];
          v25 = *MEMORY[0x1E69BFF48];
          v35 = *MEMORY[0x1E696A578];
          v36[0] = v9;
          v26 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v36 forKeys:&v35 count:1];
          v13 = [v24 errorWithDomain:v25 code:46309 userInfo:v26];

          v14 = PLBackendGetLog();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
          {
            *buf = 138543362;
            v34 = v9;
            goto LABEL_15;
          }

          goto LABEL_16;
        }

        [(PLManagedAsset *)self updateAudioExtendedAttributesFromMetadata:v6];
      }

      else if (v15)
      {
        [(PLManagedAsset *)self updateVideoExtendedAttributesFromMetadata:v6];
      }

      else
      {
        [(PLManagedAsset *)self updateImageExtendedAttributesFromMetadata:v6];
      }

      v13 = 0;
      if (!a4)
      {
        goto LABEL_19;
      }

      goto LABEL_18;
    }

    v17 = MEMORY[0x1E696AEC0];
    v18 = [(PLManagedAsset *)self uuid];
    v9 = [v17 stringWithFormat:@"Missing metadata for asset %@. File not on disk", v18];

    v19 = MEMORY[0x1E696ABC0];
    v20 = *MEMORY[0x1E69BFF48];
    v31 = *MEMORY[0x1E696A578];
    v32 = v9;
    v21 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v32 forKeys:&v31 count:1];
    v13 = [v19 errorWithDomain:v20 code:41004 userInfo:v21];

    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543362;
      v34 = v9;
      goto LABEL_15;
    }
  }

LABEL_16:

  v16 = 0;
LABEL_17:
  if (a4)
  {
LABEL_18:
    v27 = v13;
    *a4 = v13;
  }

LABEL_19:

LABEL_20:
  return v16;
}

- (BOOL)updateExtendedAttributesWithError:(id *)a3
{
  v5 = [(PLManagedAsset *)self metadataFromMediaPropertiesOrOriginalResource];
  LOBYTE(a3) = [(PLManagedAsset *)self updateExtendedAttributesWithMetadata:v5 error:a3];

  return a3;
}

- (id)extendedAttributesCreateIfNeeded:(BOOL)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self extendedAttributes];
  if (!v5 && v3)
  {
    if (PLPlatformExtendedAttributesSupported())
    {
      v6 = [(PLManagedAsset *)self managedObjectContext];
      v7 = +[PLExtendedAttributes entityName];
      v5 = PLSafeInsertNewObjectForEntityForNameInManagedObjectContext(v7, v6, 0);

      if (v5)
      {
        [(PLManagedAsset *)self setExtendedAttributes:v5];
      }
    }

    else
    {
      v5 = 0;
    }
  }

  return v5;
}

- (void)setCurrentSleetCastFromMetadata:(id)a3
{
  v4 = [a3 smartStyleCast];

  [(PLManagedAsset *)self setCurrentSleetCast:v4];
}

- (void)updateSmartStyleVideoCastFromMetadata:(id)a3
{
  v4 = [a3 smartStyleVideoCastValue];

  [(PLManagedAsset *)self setCurrentSleetCast:v4];
}

- (BOOL)updatePlaybackVariationAndLoopingStyleFromAVAsset:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self playbackVariationFromAVAsset:v4 isLivePhotoVideoComplement:[(PLManagedAsset *)self isPhotoIris]];

  return [(PLManagedAsset *)self updatePlaybackVariationAndLoopingStyleFromVariation:v5];
}

- (BOOL)updatePlaybackVariationAndLoopingStyleFromVariation:(unsigned __int16)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self playbackVariation];
  v6 = [(PLManagedAsset *)self playbackStyle];
  [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v3];
  return v5 != [(PLManagedAsset *)self playbackVariation]|| v6 != [(PLManagedAsset *)self playbackStyle];
}

- (unsigned)playbackVariationFromAVAsset:(id)a3 isLivePhotoVideoComplement:(BOOL)a4
{
  v17 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVAsset:v4 timeZoneLookup:0];
  v6 = [v5 playbackVariation];
  v7 = [v6 unsignedIntegerValue];

  if (v7 >= 4)
  {
    v8 = PLBackendGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v9 = [v5 playbackVariation];
      v13 = 138412546;
      v14 = v9;
      v15 = 2112;
      v16 = v4;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Unrecognized variation identifier %@ in %@", &v13, 0x16u);
    }
  }

  v10 = [v5 playbackVariation];
  v11 = [v10 unsignedIntegerValue];

  return v11;
}

- (BOOL)updatePlaybackVariationAndStyleFromOriginalMetadata:(id)a3
{
  v13 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = v5;
  if (!v5)
  {
    v8 = PLBackendGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = NSStringFromSelector(a2);
      v11 = 138412290;
      v12 = v9;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "%@: nil metadata", &v11, 0xCu);
    }

    goto LABEL_12;
  }

  if (![v5 isAnimatedImage])
  {
    if (-[PLManagedAsset isPhotoIris](self, "isPhotoIris") && [v6 isLongExposure] && -[PLManagedAsset playbackVariation](self, "playbackVariation") != 3)
    {
      [(PLManagedAsset *)self setPlaybackVariation:3];
      goto LABEL_5;
    }

LABEL_12:
    v7 = 0;
    goto LABEL_13;
  }

  if ([(PLManagedAsset *)self playbackStyle]== 2)
  {
    goto LABEL_12;
  }

  [(PLManagedAsset *)self setPlaybackStyle:2];
LABEL_5:
  v7 = 1;
LABEL_13:

  return v7;
}

- (void)updatePlaybackStyleWithLivePhotoPlayability:(BOOL)a3
{
  if (a3)
  {
    if ([objc_opt_class() _isLoopingVideoPlaybackVariation:{-[PLManagedAsset playbackVariation](self, "playbackVariation")}])
    {
      v4 = 5;
    }

    else
    {
      v4 = 3;
    }
  }

  else
  {
    v4 = 1;
  }

  if (v4 != [(PLManagedAsset *)self playbackStyle])
  {

    [(PLManagedAsset *)self setPlaybackStyle:v4];
  }
}

- (void)_setColorSpaceNameFromMetadata:(id)a3
{
  v4 = [a3 defaultProfileName];
  [(PLManagedAsset *)self setOriginalColorSpace:v4];
}

- (void)_setSOCGroupIdentifierFromMetadata:(id)a3
{
  v4 = a3;
  v6 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 spatialOverCaptureIdentifier];

  [v6 setSpatialOverCaptureGroupIdentifier:v5];
}

- (void)_setPhotoIrisPropertiesFromMetadata:(id)a3
{
  v7 = a3;
  v4 = [v7 livePhotoPairingIdentifier];
  v5 = [v4 length];

  if (v5)
  {
    v6 = [v7 livePhotoPairingIdentifier];
    [(PLManagedAsset *)self setMediaGroupUUID:v6];
  }
}

- (void)setKeywordsFromImageProperties:(id)a3
{
  v4 = [a3 objectForKey:*MEMORY[0x1E696DD90]];
  if (v4)
  {
    v9 = v4;
    v5 = [v4 objectForKey:*MEMORY[0x1E696DDD0]];
    v6 = [MEMORY[0x1E695DFA8] setWithArray:v5];
    v7 = [(PLManagedObject *)self photoLibrary];
    v8 = [v7 keywordManager];
    [v8 setKeywords:v6 forAsset:self];

    v4 = v9;
  }
}

- (void)_setSavedAssetTypeFromMetadata:(id)a3
{
  v4 = a3;
  if (!-[PLManagedAsset savedAssetType](self, "savedAssetType") && [v4 isPhotoBooth])
  {
    -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForPhotoBoothAsset]);
  }
}

- (void)_setOriginalSizeAndOrientationFromMetadata:(id)a3
{
  v7 = a3;
  if ([v7 isSyndicationOriginated])
  {
    -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [v7 orientation]);
    [v7 exifPixelSize];
    [(PLManagedAsset *)self setOriginalWidth:v4];
    [v7 exifPixelSize];
    [(PLManagedAsset *)self setOriginalHeight:v5];
  }

  else
  {
    v6 = [v7 cgImageProperties];
    [(PLManagedAsset *)self setOriginalSizeAndOrientationFromImageProperties:v6];
  }
}

- (void)setOriginalSizeAndOrientationFromImageProperties:(id)a3
{
  PFGetDimensionsFromImageProperties();
  v4 = 0;
  v5 = 0;
  v6 = 0;
  if (![(PLManagedAsset *)self originalOrientation])
  {
    -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [v4 shortValue]);
  }

  -[PLManagedAsset setOriginalWidth:](self, "setOriginalWidth:", [v5 longLongValue]);
  -[PLManagedAsset setOriginalHeight:](self, "setOriginalHeight:", [v6 longLongValue]);
}

- (void)_setHDRGainFromMetadata:(id)a3
{
  v6 = [a3 hdrGain];
  v4 = [(PLManagedAsset *)self hdrGain];
  IsEqual = PLNumberIsEqual(v4, v6);

  if (!IsEqual)
  {
    [(PLManagedAsset *)self setHdrGain:v6];
  }
}

- (void)setSpatialAudioControlBadgeAttributeFromMetadata:(id)a3
{
  if ([a3 hasSpatialAudio])
  {

    [(PLManagedAsset *)self setSpatialAudioControlBadgeAttribute:1];
  }
}

- (void)setPlaybackControlBadgeAttributeFromMetadata:(id)a3
{
  v4 = [a3 nominalFrameRate];
  [v4 doubleValue];
  v6 = v5;

  if (v6 >= 45.0)
  {

    [(PLManagedAsset *)self setPlaybackControlBadgeAttribute:1];
  }
}

- (void)setEditableDepthBadgeAttributeFromMetadata:(id)a3
{
  if ([a3 hasDepthDataAndIsNotRenderedSDOF])
  {

    [(PLManagedAsset *)self setEditableDepthBadgeAttribute:1];
  }
}

- (void)setDepthTypeFromMetadata:(id)a3
{
  v6 = a3;
  if ([v6 isPortrait])
  {
    v4 = 1;
  }

  else if ([v6 isMovie] && (objc_msgSend(v6, "isCinematicVideo") & 1) != 0)
  {
    v4 = 2;
  }

  else
  {
    v5 = [v6 customRendered];
    if (v5 > 9u)
    {
      v4 = 0;
    }

    else
    {
      v4 = word_19C60B864[v5 & 0xF];
    }
  }

  if (v4 != [(PLManagedAsset *)self depthType])
  {
    [(PLManagedAsset *)self setDepthType:v4];
  }
}

- (void)_setSizeAndOrientationFromMetadata:(id)a3
{
  v7 = a3;
  if ([v7 isSyndicationOriginated])
  {
    -[PLManagedAsset setOrientation:](self, "setOrientation:", [v7 orientation]);
    [v7 orientedPixelSize];
    [(PLManagedAsset *)self setWidth:v4];
    [v7 orientedPixelSize];
    [(PLManagedAsset *)self setHeight:v5];
  }

  else
  {
    v6 = [v7 cgImageProperties];
    [(PLManagedAsset *)self setSizeAndOrientationFromImageProperties:v6];
  }
}

- (void)setSizeAndOrientationFromImageProperties:(id)a3
{
  PFGetDimensionsFromImageProperties();
  v4 = 0;
  v5 = 0;
  v6 = 0;
  -[PLManagedAsset setOrientation:](self, "setOrientation:", [v4 shortValue]);
  [(PLManagedAsset *)self orientation];
  v7 = PLExifOrientationSwapsWidthAndHeight();
  v8 = v7 == 0;
  if (v7)
  {
    v9 = v6;
  }

  else
  {
    v9 = v5;
  }

  if (v8)
  {
    v10 = v6;
  }

  else
  {
    v10 = v5;
  }

  -[PLManagedAsset setWidth:](self, "setWidth:", [v9 longLongValue]);
  -[PLManagedAsset setHeight:](self, "setHeight:", [v10 longLongValue]);
}

- (BOOL)setTimeExifTimestampStringFromMetadata:(id)a3
{
  v4 = [a3 creationDateString];
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v6 = [v5 exifTimestampString];

  if (v4 | v6 && ([v6 isEqualToString:v4] & 1) == 0)
  {
    v8 = [(PLManagedAsset *)self additionalAttributes];
    [v8 setExifTimestampString:v4];

    v7 = 1;
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)setCameraCaptureDeviceFromMetadata:(id)a3
{
  v4 = a3;
  v5 = [v4 isFrontFacingCamera];
  v6 = [v4 isFrontAndRearComposition];

  if (v6)
  {
    v7 = 2;
  }

  else
  {
    v7 = v5;
  }

  v8 = [(PLManagedAsset *)self additionalAttributes];
  v9 = [v8 cameraCaptureDevice];

  if (v9 != v7)
  {
    v10 = [(PLManagedAsset *)self additionalAttributes];
    [v10 setCameraCaptureDevice:v7];
  }

  return v9 != v7;
}

- (void)setSpatialTypeFromMetadata:(id)a3
{
  v5 = a3;
  if ([v5 isSpatialMedia])
  {
    if ([v5 isAlchemist])
    {
      v4 = 2;
    }

    else
    {
      v4 = 1;
    }
  }

  else
  {
    v4 = 0;
  }

  [(PLManagedAsset *)self setSpatialType:v4];
}

- (BOOL)_setHDRTypeFromMetadata:(id)a3
{
  v4 = a3;
  if ([v4 hasHDRGainMap] & 1) != 0 || (objc_msgSend(v4, "hasISOGainMap"))
  {
    v5 = 10;
  }

  else if (![v4 customRendered] || (v5 = objc_msgSend(v4, "customRendered"), (v5 - 2) >= 3u))
  {
    if ([v4 isMovie] && (objc_msgSend(v4, "isHDR") & 1) != 0)
    {
      v5 = 5;
    }

    else if (([v4 isMovie] & 1) == 0 && ((objc_msgSend(v4, "isHDR_TS22028") & 1) != 0 || objc_msgSend(v4, "isHDR_ExtendedRange")))
    {
      v5 = 11;
    }

    else
    {
      v5 = 0;
    }
  }

  v6 = [(PLManagedAsset *)self hdrType];
  if (v5 != v6)
  {
    [(PLManagedAsset *)self setHdrType:v5];
  }

  return v5 != v6;
}

- (id)formattedCameraModel
{
  v2 = [(PLManagedAsset *)self extendedAttributes];
  v3 = [v2 formattedCameraModel];

  return v3;
}

- (id)cameraModel
{
  v2 = [(PLManagedAsset *)self extendedAttributes];
  v3 = [v2 cameraModel];

  return v3;
}

- (id)lensModel
{
  v3 = objc_autoreleasePoolPush();
  if ([(PLManagedAsset *)self isPhoto])
  {
    v4 = [(PLManagedAsset *)self imageProperties];
    v5 = v4;
    if (v4)
    {
      v6 = [v4 objectForKey:*MEMORY[0x1E696D9B0]];
      v7 = v6;
      if (v6)
      {
        v8 = [v6 objectForKey:*MEMORY[0x1E696DA58]];
      }

      else
      {
        v8 = 0;
      }
    }

    else
    {
      v8 = 0;
    }
  }

  else
  {
    v8 = 0;
  }

  objc_autoreleasePoolPop(v3);

  return v8;
}

- (id)cameraMake
{
  v3 = objc_autoreleasePoolPush();
  if (![(PLManagedAsset *)self isPhoto])
  {
    if (![(PLManagedAsset *)self isVideo])
    {
      v8 = 0;
      goto LABEL_13;
    }

    v5 = [(PLManagedAsset *)self avAssetProxyForOriginalAllowReadFromFile:1];
    v7 = [v5 metadata];
    if (v7)
    {
      v9 = [MEMORY[0x1E6987FE0] metadataItemsFromArray:v7 withKey:*MEMORY[0x1E69878E0] keySpace:*MEMORY[0x1E6987850]];
      v10 = [v9 firstObject];
      v8 = [v10 stringValue];

      goto LABEL_10;
    }

LABEL_9:
    v8 = 0;
    goto LABEL_10;
  }

  v4 = [(PLManagedAsset *)self imageProperties];
  v5 = v4;
  if (!v4)
  {
    v8 = 0;
    goto LABEL_12;
  }

  v6 = [v4 objectForKey:*MEMORY[0x1E696DF28]];
  v7 = v6;
  if (!v6)
  {
    goto LABEL_9;
  }

  v8 = [v6 objectForKey:*MEMORY[0x1E696DF48]];
LABEL_10:

LABEL_12:
LABEL_13:
  objc_autoreleasePoolPop(v3);

  return v8;
}

- (id)_avAssetProxyForFullSize:(BOOL)a3 allowReadFromFile:(BOOL)a4
{
  v4 = a4;
  if (![(PLManagedAsset *)self isVideo])
  {
    v7 = 0;
    goto LABEL_22;
  }

  if (a3)
  {
    [(PLManagedAsset *)self additionalAttributes];
  }

  else
  {
    [(PLManagedAsset *)self master];
  }
  v8 = ;
  v9 = [v8 mediaMetadata];

  v10 = [v9 data];
  if (!v10)
  {
    v7 = 0;
    goto LABEL_12;
  }

  v11 = [MEMORY[0x1E696AE40] propertyListWithData:v10 options:0 format:0 error:0];
  if (v11)
  {
    v7 = [MEMORY[0x1E6987E28] assetProxyWithPropertyList:v11];
  }

  else
  {
    v7 = 0;
  }

  if (!v7)
  {
LABEL_12:
    if (v4)
    {
      if (a3)
      {
        [(PLManagedAsset *)self fileURLForFullsizeRenderVideo];
      }

      else
      {
        [(PLManagedAsset *)self mainFileURL];
      }
      v12 = ;
      if (v12 && ([MEMORY[0x1E696AC08] defaultManager], v13 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v12, "path"), v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v13, "fileExistsAtPath:isDirectory:", v14, 0), v14, v13, v15))
      {
        v7 = [MEMORY[0x1E6987E28] assetWithURL:v12];
      }

      else
      {
        v7 = 0;
      }
    }
  }

LABEL_22:

  return v7;
}

- (id)imageProperties
{
  objc_opt_class();
  v3 = [(PLManagedAsset *)self master];
  v4 = [v3 mediaMetadata];
  v5 = [v4 valueForKey:@"data"];
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  if (!v7 || ((objc_opt_class(), [MEMORY[0x1E696AE40] propertyListWithData:v7 options:0 format:0 error:0], v8 = objc_claimAutoreleasedReturnValue(), (objc_opt_isKindOfClass() & 1) == 0) ? (v9 = 0) : (v9 = v8), v10 = v9, v8, !v10))
  {
    v11 = [(PLManagedAsset *)self mainFileURL];
    if (v11 && ([MEMORY[0x1E696AC08] defaultManager], v12 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v11, "path"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v12, "fileExistsAtPath:isDirectory:", v13, 0), v13, v12, v14) && (v15 = CGImageSourceCreateWithURL(v11, 0)) != 0)
    {
      v16 = v15;
      objc_opt_class();
      v17 = [objc_opt_class() newImagePropertiesFromImageSource:v16];
      if (objc_opt_isKindOfClass())
      {
        v18 = v17;
      }

      else
      {
        v18 = 0;
      }

      v8 = v18;

      CFRelease(v16);
    }

    else
    {
      v8 = 0;
    }
  }

  return v8;
}

- (void)setMetadataFromCustomRenderedValue:(int64_t)a3
{
  v4 = a3;
  v5 = [PLManagedAsset imageHDRTypeFromCustomRenderedValue:v4];
  if (v5)
  {
    [(PLManagedAsset *)self setHdrType:v5];
  }

  v6 = [PLManagedAsset imageDepthTypeFromCustomRenderedValue:v4];
  if (v6)
  {

    [(PLManagedAsset *)self setDepthType:v6];
  }
}

- (void)updateWithCustomAssetProperties:(id)a3
{
  v33 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v25 = [v4 objectForKeyedSubscript:@"dateCreated"];
  if (v25)
  {
    [(PLManagedAsset *)self setDateCreated:?];
    [(PLManagedAsset *)self didSetCustomDateCreated];
  }

  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v27 objects:v32 count:16];
  if (v6)
  {
    v8 = *v28;
    *&v7 = 138543618;
    v24 = v7;
    do
    {
      v9 = 0;
      do
      {
        if (*v28 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v27 + 1) + 8 * v9);
        if (([v10 isEqualToString:{@"dateCreated", v24}] & 1) == 0 && (objc_msgSend(v10, "isEqualToString:", @"trashedReason") & 1) == 0)
        {
          if ([v10 isEqualToString:@"trashedState"])
          {
            v11 = [v5 objectForKeyedSubscript:v10];
            v12 = [v11 BOOLValue];

            if (([(PLManagedAsset *)self canMoveToTrash]& v12) == 1)
            {
              v13 = [v5 objectForKeyedSubscript:@"trashedReason"];
              v14 = v13;
              if (v13)
              {
                v15 = [v13 unsignedShortValue];
              }

              else
              {
                v15 = 0;
              }

              [(PLManagedAsset *)self trashWithReason:v15];
            }
          }

          else if ([v10 isEqualToString:@"photoIrisVideoDuration"])
          {
            memset(&v31, 0, sizeof(v31));
            v16 = [v5 objectForKeyedSubscript:v10];
            CMTimeMakeFromDictionary(&v31, v16);

            v26 = v31;
            [(PLManagedAsset *)self setPhotoIrisVideoDuration:&v26];
          }

          else if ([v10 isEqualToString:@"photoIrisStillDisplayTime"])
          {
            memset(&v31, 0, sizeof(v31));
            v17 = [v5 objectForKeyedSubscript:v10];
            CMTimeMakeFromDictionary(&v31, v17);

            v26 = v31;
            [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&v26];
          }

          else if ([v10 isEqualToString:@"location"])
          {
            v18 = [v5 objectForKeyedSubscript:v10];
            v19 = [(PLManagedAsset *)self dateCreated];
            v20 = [PLManagedAsset newLocationFromLocationData:v18 timestampIfMissing:v19];

            [v20 coordinate];
            if ([PLLocationUtils canUseCoordinate:?])
            {
              [(PLManagedAsset *)self setLocation:v20];
              [(PLManagedAsset *)self didSetCustomLocation];
            }
          }

          else if ([v10 isEqualToString:@"hdrType"])
          {
            v21 = [v5 objectForKeyedSubscript:v10];
            -[PLManagedAsset setHdrType:](self, "setHdrType:", [v21 unsignedIntegerValue]);
          }

          else
          {
            v22 = [v5 objectForKeyedSubscript:v10];
            [(PLManagedAsset *)self setValue:v22 forKeyPath:v10];
          }
        }

        ++v9;
      }

      while (v6 != v9);
      v23 = [v5 countByEnumeratingWithState:&v27 objects:v32 count:16];
      v6 = v23;
    }

    while (v23);
  }
}

- (void)setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:(id)a3 originalFilename:(id)a4
{
  v24 = a3;
  v6 = a4;
  v7 = [(PLManagedAsset *)self directory];
  if ([v7 length])
  {
    v8 = [(PLManagedAsset *)self filename];
    v9 = [v8 length];

    if (v9)
    {
      goto LABEL_10;
    }
  }

  else
  {
  }

  v10 = objc_alloc(MEMORY[0x1E69BF298]);
  v11 = [(PLManagedAsset *)self uuid];
  v12 = [v10 initWithAssetUuid:v11 bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:v24 resourceType:0 recipeID:31 originalFilename:0 customSuffix:{v6, 0}];

  v13 = [(PLManagedObject *)self pathManager];
  v14 = [v13 readOnlyUrlWithIdentifier:v12];

  v15 = [(PLManagedAsset *)self directory];
  v16 = [v15 length];

  if (!v16)
  {
    v17 = [(PLManagedObject *)self pathManager];
    v18 = [v14 path];
    v19 = [v18 stringByDeletingLastPathComponent];
    v20 = [v17 assetAbbreviatedMetadataDirectoryForDirectory:v19 type:4 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];

    [(PLManagedAsset *)self setDirectory:v20];
  }

  v21 = [(PLManagedAsset *)self filename];
  v22 = [v21 length];

  if (!v22)
  {
    v23 = [v14 lastPathComponent];
    [(PLManagedAsset *)self setFilename:v23];
  }

LABEL_10:
}

- (BOOL)setAttributesFromMainFileURL:(id)a3 mainFileMetadata:(id)a4 savedAssetType:(signed __int16)a5 bundleScope:(unsigned __int16)a6 isPlaceholder:(BOOL)a7 placeholderFileURL:(id)a8 imageSource:(CGImageSource *)a9 imageData:(id *)a10
{
  v12 = a6;
  v13 = a5;
  v89 = *MEMORY[0x1E69E9840];
  v17 = a3;
  v18 = a4;
  v82 = a8;
  if (!(v17 | v18))
  {
    v18 = 0;
    v17 = 0;
    goto LABEL_43;
  }

  if (!a7 && ([v18 isSyndicationOriginated] & 1) == 0)
  {
    v84 = 0;
    v19 = [(PLManagedAsset *)self _effectiveMetadataForMainFileURL:v17 mainFileMetadata:v18 fullSizeRenderURL:0 shouldCache:1 error:&v84];
    v20 = v84;

    if (v19)
    {
      v21 = [v19 fileURL];

      v18 = v19;
      v17 = v21;
      goto LABEL_6;
    }

    v63 = PLBackendGetLog();
    if (os_log_type_enabled(v63, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v86 = v20;
      _os_log_impl(&dword_19BF1F000, v63, OS_LOG_TYPE_ERROR, "Unable to load metadata with error: %@", buf, 0xCu);
    }

    v18 = 0;
LABEL_43:
    v64 = 0;
    v53 = v82;
    goto LABEL_58;
  }

LABEL_6:
  context = objc_autoreleasePoolPush();
  v22 = 32;
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    [MEMORY[0x1E69BF328] maskForCloudSharedAsset];
    if (PLValidatedSavedAssetTypeApplies())
    {
      v22 = 23;
    }

    else
    {
      v22 = 32;
    }
  }

  aSelector = a2;
  if (v17)
  {
    v23 = [(PLManagedObject *)self pathManager];
    v24 = [v17 path];
    v25 = [v24 stringByDeletingLastPathComponent];
    v26 = [v23 assetAbbreviatedMetadataDirectoryForDirectory:v25 type:v22 bundleScope:v12];

    v27 = v26;
  }

  else
  {
    v27 = 0;
  }

  v28 = a9;
  v29 = [v17 lastPathComponent];
  v81 = v27;
  [(PLManagedAsset *)self setDirectory:v27];
  [(PLManagedAsset *)self setFilename:v29];
  [(PLManagedAsset *)self setOriginalFilename:v29];
  if (a7)
  {
    v30 = [v17 pathExtension];
    [(PLManagedAsset *)self setUniformTypeIdentifierFromPathExtension:v30];

    v31 = [(PLManagedAsset *)self dateCreated];

    if (v31)
    {
      goto LABEL_29;
    }

    v78 = a9;
    v32 = [(PLManagedAsset *)self modificationDate];
    [(PLManagedAsset *)self setDateCreated:v32];
  }

  else
  {
    v78 = a9;
    v33 = [v18 fileSystemProperties];
    v34 = [v33 objectForKeyedSubscript:*MEMORY[0x1E696A350]];
    if (v34)
    {
      [(PLManagedAsset *)self setModificationDate:v34];
    }

    else
    {
      v35 = [MEMORY[0x1E695DF00] date];
      [(PLManagedAsset *)self setModificationDate:v35];
    }

    v36 = [v18 contentType];
    v37 = [v36 identifier];
    [(PLManagedAsset *)self setUniformTypeIdentifier:v37];

    v38 = [v18 title];
    [(PLManagedAsset *)self setTitle:v38];

    v39 = [v18 captionAbstract];
    [(PLManagedAsset *)self setLongDescription:v39];

    v40 = [v18 artworkContentDescription];
    [(PLManagedAsset *)self setAccessibilityDescription:v40];

    v32 = [(PLManagedAsset *)self additionalAttributes];
    v41 = [(PLManagedAsset *)self dateCreated];

    if (!v41)
    {
      v42 = [v18 utcCreationDate];
      [(PLManagedAsset *)self setDateCreated:v42];

      [v32 setDateCreatedSource:{objc_msgSend(v18, "creationDateSource")}];
    }

    [(PLManagedAsset *)self setTimeExifTimestampStringFromMetadata:v18];
    v43 = [v32 timeZoneName];

    if (!v43)
    {
      v44 = [v18 timeZoneName];
      [v32 setTimeZoneName:v44];
    }

    v45 = [v32 timeZoneOffset];

    if (!v45)
    {
      v46 = [v18 timeZoneOffset];
      [v32 setTimeZoneOffset:v46];
    }

    v47 = [v18 fileSize];
    if (v47)
    {
      [(PLManagedAsset *)self setOriginalFilesize:v47];
    }

    v48 = [v18 spatialOverCaptureIdentifier];
    v49 = [(PLManagedAsset *)self additionalAttributes];
    [v49 setSpatialOverCaptureGroupIdentifier:v48];
  }

  v28 = v78;
LABEL_29:
  [(PLManagedAsset *)self updateAssetKindFromUniformTypeIdentifier];
  v50 = [(PLManagedAsset *)self dateCreated];
  [v50 timeIntervalSinceReferenceDate];
  [(PLManagedAsset *)self setSortToken:?];

  [(PLManagedAsset *)self setSavedAssetType:v13];
  [(PLManagedAsset *)self setBundleScope:v12];
  v51 = [(PLManagedAsset *)self kind];
  if (v51)
  {
    v52 = v81;
    v53 = v82;
    if (v51 == 1 && !a7)
    {
      [(PLManagedAsset *)self setVideoInfoFromFileAtURL:v17 mainFileMetadata:v18 fullSizeRenderURL:0 overwriteOriginalProperties:1];
    }

    goto LABEL_52;
  }

  v52 = v81;
  v53 = v82;
  if (!a7)
  {
    [(PLManagedAsset *)self setImageInfoFromImageMetadata:v18 overwriteOriginalProperties:1];
    goto LABEL_52;
  }

  if (!v82)
  {
    goto LABEL_52;
  }

  v83 = 0;
  v54 = [MEMORY[0x1E69C08F0] typeForURL:v82 error:&v83];
  v55 = v83;
  if (!v54)
  {
    v79 = v28;
    v61 = PLBackendGetLog();
    if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
    {
      v65 = NSStringFromSelector(aSelector);
      v66 = [v82 path];
      *buf = 138412546;
      v86 = v65;
      v87 = 2112;
      v88 = v66;
      _os_log_impl(&dword_19BF1F000, v61, OS_LOG_TYPE_ERROR, "%@ Couldn't get uti for '%@'.", buf, 0x16u);

      v52 = v81;
    }

    goto LABEL_50;
  }

  if ([v54 conformsToType:*MEMORY[0x1E6982E30]])
  {
    v75 = v55;
    v76 = v54;
    v79 = v28;
    v73 = objc_alloc(MEMORY[0x1E69C0718]);
    v56 = MEMORY[0x1E695DFF8];
    v74 = [v82 path];
    v57 = [v56 fileURLWithPath:v74];
    v58 = [(PLManagedObject *)self photoLibrary];
    v59 = [v58 libraryBundle];
    v60 = [v59 timeZoneLookup];
    v61 = [v73 initWithImageURL:v57 contentType:0 options:12 timeZoneLookup:v60 cacheImageSource:1 cacheImageData:0];

    if (v61)
    {
      v62 = [v61 utcCreationDate];
      [(PLManagedAsset *)self setDateCreated:v62];

      [(PLManagedAsset *)self setImageInfoFromImageMetadata:v61 overwriteOriginalProperties:1];
      v53 = v82;
    }

    else
    {
      v67 = PLBackendGetLog();
      v53 = v82;
      if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
      {
        v68 = NSStringFromSelector(aSelector);
        v69 = [v82 path];
        *buf = 138412546;
        v86 = v68;
        v87 = 2112;
        v88 = v69;
        _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "%@ Unable to read metadata from '%@'", buf, 0x16u);
      }

      v61 = 0;
    }

    v52 = v81;
    v55 = v75;
    v54 = v76;
LABEL_50:

    v28 = v79;
  }

LABEL_52:
  objc_autoreleasePoolPop(context);
  v70 = [v18 imageSource];
  if (v28 && v70)
  {
    v71 = CFRetain([v18 imageSource]);
    *v28 = CFAutorelease(v71);
  }

  if (a10)
  {
    *a10 = [v18 imageData];
  }

  v64 = 1;
LABEL_58:

  return v64;
}

- (BOOL)updateAttributesFromMainFileURL:(id)a3 mainFileMetadata:(id)a4 fullSizeRenderURL:(id)a5 error:(id *)a6
{
  v29 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v26 = 0;
  v13 = [(PLManagedAsset *)self _effectiveMetadataForMainFileURL:v10 mainFileMetadata:v11 fullSizeRenderURL:v12 shouldCache:0 error:&v26];
  v14 = v26;
  if (v13)
  {
    v15 = objc_autoreleasePoolPush();
    v16 = [(PLManagedObject *)self photoLibrary];
    v17 = [v16 isCloudPhotoLibraryEnabled];

    if (v17 && ![(PLManagedAsset *)self hasAdjustments])
    {
      v25 = [(PLManagedAsset *)self master];
      v18 = v25;
      if (!v25)
      {
        [(PLManagedAsset *)self setUniformTypeIdentifierFromOriginalFile];
        goto LABEL_6;
      }

      v19 = [v25 uniformTypeIdentifier];
    }

    else
    {
      v18 = [v13 contentType];
      v19 = [v18 identifier];
    }

    v20 = v19;
    [(PLManagedAsset *)self setUniformTypeIdentifier:v19];

LABEL_6:
    [(PLManagedAsset *)self updateAssetKindFromUniformTypeIdentifier];
    v21 = [(PLManagedAsset *)self kind];
    if (v21)
    {
      if (v21 == 1)
      {
        [(PLManagedAsset *)self setVideoInfoFromFileAtURL:v10 mainFileMetadata:v11 fullSizeRenderURL:v12 overwriteOriginalProperties:0];
      }
    }

    else
    {
      [(PLManagedAsset *)self setImageInfoFromImageMetadata:v13 overwriteOriginalProperties:0];
    }

    objc_autoreleasePoolPop(v15);
    goto LABEL_15;
  }

  v22 = PLBackendGetLog();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v28 = v14;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Unable to load metadata with error: %@", buf, 0xCu);
  }

  if (a6)
  {
    v23 = v14;
    *a6 = v14;
  }

LABEL_15:

  return v13 != 0;
}

- (id)addLegacyFaceWithRelativeRect:(CGRect)a3 identifier:(signed __int16)a4 albumUUID:(id)a5
{
  v5 = a4;
  height = a3.size.height;
  width = a3.size.width;
  y = a3.origin.y;
  x = a3.origin.x;
  v11 = a5;
  v12 = [(PLManagedAsset *)self managedObjectContext];
  v13 = [(PLManagedObject *)PLManagedLegacyFace insertInManagedObjectContext:v12];

  [v13 setRelativeRect:{x, y, width, height}];
  [v13 setIdentifier:v5];
  [v13 setAlbumUUID:v11];

  [v13 setAsset:self];

  return v13;
}

- (id)legacyFaceWithIdentifier:(signed __int16)a3
{
  v3 = a3;
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = [(PLManagedAsset *)self legacyFaces];
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 identifier] == v3)
        {
          v10 = v9;
          goto LABEL_11;
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_11:

  return v10;
}

- (void)setLocationFromPersistedAttributes:(id)a3
{
  v4 = [a3 dataForKey:*MEMORY[0x1E69BFD48]];
  if (v4)
  {
    v7 = v4;
    v5 = [(PLManagedAsset *)self dateCreated];
    v6 = [PLManagedAsset newLocationFromLocationData:v7 timestampIfMissing:v5];

    if (v6)
    {
      [v6 coordinate];
      if ([PLLocationUtils canUseCoordinate:?])
      {
        [(PLManagedAsset *)self setLocation:v6];
      }
    }

    v4 = v7;
  }
}

- (void)synchronizeWithPersistedFileSystemAttributes
{
  v167 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self isValidTypeForPersistence])
  {
    v3 = objc_autoreleasePoolPush();
    v4 = [(PLManagedAsset *)self persistedFileSystemAttributesFileURL];
    if (!v4)
    {
LABEL_206:

      objc_autoreleasePoolPop(v3);
      return;
    }

    v5 = [MEMORY[0x1E69BF230] persistedAttributesForFileAtURL:v4];
    v6 = *MEMORY[0x1E69BFE68];
    v7 = [v5 UUIDStringForKey:*MEMORY[0x1E69BFE68]];
    v148 = v7;
    if (v7)
    {
      [(PLManagedAsset *)self setUuid:v7];
      v8 = 0;
    }

    else
    {
      v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      v9 = [(PLManagedAsset *)self uuid];
      [v8 setUUIDString:v9 forKey:v6];
    }

    v165 = 0;
    v10 = *MEMORY[0x1E69BFE18];
    if ([v5 getUInt16:&v165 forKey:*MEMORY[0x1E69BFE18]])
    {
      [MEMORY[0x1E69BF328] maskForIsValidForBackup];
      if (PLValidatedSavedAssetTypeApplies())
      {
        [(PLManagedAsset *)self setSavedAssetType:v165];
      }
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      [v8 setUInt16:-[PLManagedAsset savedAssetType](self forKey:{"savedAssetType"), v10}];
    }

    v11 = *MEMORY[0x1E69BFD90];
    v12 = [v5 stringForKey:*MEMORY[0x1E69BFD90]];
    v147 = v12;
    if (v12)
    {
      [(PLManagedAsset *)self setImportedByBundleIdentifier:v12];
    }

    else
    {
      v13 = [(PLManagedAsset *)self importedByBundleIdentifier];

      if (v13)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v14 = [(PLManagedAsset *)self importedByBundleIdentifier];
        [v8 setString:v14 forKey:v11];
      }
    }

    v15 = *MEMORY[0x1E69BFD98];
    v16 = [v5 stringForKey:*MEMORY[0x1E69BFD98]];
    v146 = v16;
    if (v16)
    {
      [(PLManagedAsset *)self setImportedByDisplayName:v16];
    }

    else
    {
      v17 = [(PLManagedAsset *)self importedByDisplayName];

      if (v17)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v18 = [(PLManagedAsset *)self importedByDisplayName];
        [v8 setString:v18 forKey:v15];
      }
    }

    v19 = *MEMORY[0x1E69BFDF0];
    v20 = [v5 UUIDStringForKey:*MEMORY[0x1E69BFDF0]];
    v145 = v20;
    if (v20)
    {
      [(PLManagedAsset *)self setOriginalAssetsUUID:v20];
    }

    else
    {
      v21 = [(PLManagedAsset *)self originalAssetsUUID];

      if (v21)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v22 = [(PLManagedAsset *)self originalAssetsUUID];
        [v8 setUUIDString:v22 forKey:v19];
      }
    }

    v23 = *MEMORY[0x1E69BFD20];
    v24 = [v5 UUIDStringForKey:*MEMORY[0x1E69BFD20]];
    v144 = v24;
    if (v24)
    {
      [(PLManagedAsset *)self setAvalancheUUID:v24];
    }

    else
    {
      v25 = [(PLManagedAsset *)self avalancheUUID];

      if (v25)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v26 = [(PLManagedAsset *)self avalancheUUID];
        [v8 setUUIDString:v26 forKey:v23];
      }
    }

    v164 = 0;
    v27 = *MEMORY[0x1E69BFD18];
    if ([v5 getUInt16:&v164 forKey:*MEMORY[0x1E69BFD18]])
    {
      v28 = [(PLManagedAsset *)self avalancheUUID];

      if (v28)
      {
        [(PLManagedAsset *)self setAvalanchePickType:v164];
        v29 = self;
        v30 = 1;
      }

      else
      {
        [(PLManagedAsset *)self setAvalanchePickType:0];
        v29 = self;
        v30 = 0;
      }

      [(PLManagedAsset *)v29 setAvalancheKind:v30];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      v31 = [(PLManagedAsset *)self avalancheKind];
      if (v31 >= 2)
      {
        if (v31 != 2)
        {
          goto LABEL_48;
        }

        v33 = v8;
        v32 = 0;
      }

      else
      {
        v32 = [(PLManagedAsset *)self avalanchePickType];
        v33 = v8;
      }

      [v33 setUInt16:v32 forKey:v27];
    }

LABEL_48:
    v163 = 0;
    v34 = *MEMORY[0x1E69BFD88];
    if ([v5 getUInt16:&v163 forKey:*MEMORY[0x1E69BFD88]])
    {
      [(PLManagedAsset *)self setHidden:v163 != 0];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      [v8 setUInt16:-[PLManagedAsset hidden](self forKey:{"hidden"), v34}];
    }

    v162 = 0;
    v35 = *MEMORY[0x1E69BFD80];
    if ([v5 getUInt16:&v162 forKey:*MEMORY[0x1E69BFD80]])
    {
      [(PLManagedAsset *)self setFavorite:v162 != 0];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      [v8 setUInt16:-[PLManagedAsset favorite](self forKey:{"favorite"), v35}];
    }

    v161 = 0;
    v36 = *MEMORY[0x1E69BFE20];
    if ([v5 getUInt16:&v161 forKey:*MEMORY[0x1E69BFE20]])
    {
      v37 = [(PLManagedAsset *)self additionalAttributes];
      [v37 setSceneAnalysisIsFromPreview:v161 != 0];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      v37 = [(PLManagedAsset *)self additionalAttributes];
      [v8 setUInt16:objc_msgSend(v37 forKey:{"sceneAnalysisIsFromPreview"), v36}];
    }

    v160 = 0;
    v38 = *MEMORY[0x1E69BFE78];
    if ([v5 getUInt16:&v160 forKey:*MEMORY[0x1E69BFE78]])
    {
      v39 = [(PLManagedAsset *)self additionalAttributes];
      [v39 setViewPresentation:v160];
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      v8 = v8;

      v39 = [(PLManagedAsset *)self additionalAttributes];
      [v8 setUInt16:objc_msgSend(v39 forKey:{"viewPresentation"), v38}];
    }

    v159 = 0;
    v40 = *MEMORY[0x1E69BFE58];
    if ([v5 getUInt16:&v159 forKey:*MEMORY[0x1E69BFE58]])
    {
      if ([(PLManagedAsset *)self canMoveToTrash]&& v159)
      {
        buf[0] = 0;
        [v5 getUInt16:buf forKey:*MEMORY[0x1E69BFE60]];
        [(PLManagedAsset *)self trashWithReason:buf[0]];
      }
    }

    else
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      [v8 setUInt16:-[PLManagedAsset isInTrash](self forKey:{"isInTrash"), v40}];
      v41 = [(PLManagedAsset *)self trashedReason];
      [v8 setUInt16:v41 forKey:*MEMORY[0x1E69BFE60]];
    }

    v158 = 0;
    v42 = *MEMORY[0x1E69BFD60];
    if ([v5 getUInt16:&v158 forKey:*MEMORY[0x1E69BFD60]])
    {
      if (v158 >= 2u)
      {
        [(PLManagedAsset *)self setDeferredProcessingNeeded:?];
        v43 = [(PLManagedObject *)self photoLibrary];
        v44 = v43;
        if (v43)
        {
          v45 = [v43 libraryServicesManager];
          v46 = [v45 backgroundJobService];
          v47 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
          [v46 signalBackgroundProcessingNeededOnLibrary:v44 workerTypes:v47];
        }
      }
    }

    else if ([(PLManagedAsset *)self deferredProcessingNeeded])
    {
      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      [v8 setUInt16:-[PLManagedAsset deferredProcessingNeeded](self forKey:{"deferredProcessingNeeded"), v42}];
    }

    v48 = *MEMORY[0x1E69BFE08];
    v49 = [v5 stringForKey:*MEMORY[0x1E69BFE08]];
    if (v49)
    {
      [(PLManagedAsset *)self setDisableFileSystemPersistency:1];
      [(PLManagedAsset *)self setPublicGlobalUUID:v49];
      [(PLManagedAsset *)self setDisableFileSystemPersistency:0];
    }

    else
    {
      v50 = [(PLManagedAsset *)self publicGlobalUUID];

      if (v50)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v51 = [(PLManagedAsset *)self publicGlobalUUID];
        [v8 setString:v51 forKey:v48];
      }
    }

    v52 = *MEMORY[0x1E69BFE50];
    v53 = [v5 stringForKey:*MEMORY[0x1E69BFE50]];
    if (v53)
    {
      [(PLManagedAsset *)self setTitle:v53];
    }

    else
    {
      v54 = [(PLManagedAsset *)self title];

      if (v54)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v55 = [(PLManagedAsset *)self title];
        [v8 setString:v55 forKey:v52];
      }
    }

    v56 = *MEMORY[0x1E69BFD00];
    v57 = [v5 stringForKey:*MEMORY[0x1E69BFD00]];
    v141 = v57;
    if (v53)
    {
      [(PLManagedAsset *)self setAccessibilityDescription:v57];
    }

    else
    {
      v58 = [(PLManagedAsset *)self accessibilityDescription];

      if (v58)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v59 = [(PLManagedAsset *)self accessibilityDescription];
        [v8 setString:v59 forKey:v56];
      }
    }

    v143 = v49;
    v149 = [MEMORY[0x1E695DFE8] localTimeZone];
    v60 = *MEMORY[0x1E69BFE40];
    v61 = [v5 stringForKey:*MEMORY[0x1E69BFE40]];
    v62 = [(PLManagedAsset *)self additionalAttributes];
    v63 = v62;
    v140 = v61;
    if (v61)
    {
      [v62 setTimeZoneName:v61];
    }

    else
    {
      v64 = [v62 timeZoneName];

      if (v64)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v63 = [(PLManagedAsset *)self additionalAttributes];
        v65 = [v63 timeZoneName];
        [v8 setString:v65 forKey:v60];
      }

      else
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v63 = [v149 name];
        [v8 setString:v63 forKey:v60];
      }
    }

    v157 = 0;
    v66 = *MEMORY[0x1E69BFE48];
    v67 = [v5 getInt32:&v157 forKey:*MEMORY[0x1E69BFE48]];
    v68 = [(PLManagedAsset *)self additionalAttributes];
    v69 = v68;
    if (v67)
    {
      v70 = [MEMORY[0x1E696AD98] numberWithUnsignedLong:v157];
      [v69 setTimeZoneOffset:v70];
    }

    else
    {
      v71 = [v68 timeZoneOffset];

      if (v71)
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v69 = [(PLManagedAsset *)self additionalAttributes];
        v72 = [v69 timeZoneOffset];
        [v8 setInt32:objc_msgSend(v72 forKey:{"longValue"), v66}];
      }

      else
      {
        if (!v8)
        {
          v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
        }

        v69 = [(PLManagedAsset *)self dateCreated];
        [v8 setInt32:objc_msgSend(v149 forKey:{"secondsFromGMTForDate:", v69), v66}];
      }
    }

    v73 = *MEMORY[0x1E69BFD70];
    v74 = [v5 stringForKey:*MEMORY[0x1E69BFD70]];
    v75 = [(PLManagedAsset *)self additionalAttributes];
    v76 = v75;
    v139 = v74;
    if (v74)
    {
      [v75 setLongDescription:v74];
    }

    else
    {
      v77 = [v75 longDescription];

      if (!v77)
      {
LABEL_127:
        v79 = *MEMORY[0x1E69BFD08];
        v80 = [v5 dataForKey:*MEMORY[0x1E69BFD08]];
        if (v80 && ([MEMORY[0x1E696AE40] propertyListWithData:v80 options:0 format:0 error:0], v81 = objc_claimAutoreleasedReturnValue(), v81, v81))
        {
          [(PLManagedAsset *)self setAddedDate:v81];
        }

        else
        {
          v82 = [(PLManagedAsset *)self addedDate];

          if (!v82)
          {
            goto LABEL_135;
          }

          if (!v8)
          {
            v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
          }

          v81 = [(PLManagedAsset *)self addedDateData];
          [v8 setData:v81 forKey:v79];
        }

LABEL_135:
        v83 = *MEMORY[0x1E69BFDF8];
        v84 = [v5 stringForKey:*MEMORY[0x1E69BFDF8]];
        v137 = v84;
        v138 = v80;
        if (v84)
        {
          [(PLManagedAsset *)self setOriginalFilename:v84];
        }

        else
        {
          v85 = [(PLManagedAsset *)self originalFilename];

          if (v85)
          {
            if (!v8)
            {
              v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
            }

            v86 = [(PLManagedAsset *)self originalFilename];
            [v8 setString:v86 forKey:v83];
          }
        }

        v87 = *MEMORY[0x1E69BFDE0];
        v88 = [v5 stringForKey:*MEMORY[0x1E69BFDE0]];
        if (v88)
        {
          v89 = v88;
          v90 = [(PLManagedAsset *)self _mediaGroupUUIDFromPersistence:v88];

          [(PLManagedAsset *)self setMediaGroupUUID:v90];
        }

        else
        {
          v91 = [(PLManagedAsset *)self _mediaGroupUUIDForPersistence];
          if (!v91)
          {
LABEL_148:
            v92 = *MEMORY[0x1E69BFD78];
            v93 = [v5 dataForKey:*MEMORY[0x1E69BFD78]];
            v136 = v93;
            if (v93)
            {
              [(PLManagedAsset *)self _setVideoComplementData:v93];
            }

            else if ([(PLManagedAsset *)self _hasVideoComplementData])
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
              }

              v8 = v8;

              v94 = [(PLManagedAsset *)self videoComplementData];
              [v8 setData:v94 forKey:v92];
            }

            v156 = 0;
            v95 = *MEMORY[0x1E69BFE70];
            if ([v5 getUInt16:&v156 forKey:*MEMORY[0x1E69BFE70]])
            {
              [(PLManagedAsset *)self setVideoCpVisibilityState:v156];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
              }

              v8 = v8;

              [v8 setUInt16:-[PLManagedAsset videoCpVisibilityState](self forKey:{"videoCpVisibilityState"), v95}];
            }

            v96 = *MEMORY[0x1E69BFE00];
            v97 = [v5 dataForKey:*MEMORY[0x1E69BFE00]];
            v135 = v97;
            if (v97)
            {
              [(PLManagedAsset *)self setPlaceAnnotationData:v97];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
              }

              v8 = v8;

              v98 = [(PLManagedAsset *)self placeAnnotationData];
              [v8 setData:v98 forKey:v96];
            }

            v155 = 0;
            v99 = *MEMORY[0x1E69BFDA0];
            if ([v5 getUInt16:&v155 forKey:*MEMORY[0x1E69BFDA0]])
            {
              if (v155)
              {
                [(PLManagedAsset *)self setImportedBy:?];
              }

              else if ([(PLManagedAsset *)self importedBy])
              {
                if (!v8)
                {
                  v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
                }

                v8 = v8;

                [v8 setUInt16:-[PLManagedAsset importedBy](self forKey:{"importedBy"), v99}];
              }
            }

            v154 = 0;
            v100 = *MEMORY[0x1E69BFD38];
            if ([v5 getUInt16:&v154 forKey:*MEMORY[0x1E69BFD38]])
            {
              [(PLManagedAsset *)self setCurrentSleetCast:v154];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
              }

              v8 = v8;

              [v8 setUInt16:-[PLManagedAsset currentSleetCast](self forKey:{"currentSleetCast"), v100}];
            }

            v101 = *MEMORY[0x1E69BFE28];
            v102 = [v5 stringForKey:*MEMORY[0x1E69BFE28]];
            v134 = v102;
            v150 = v4;
            if (v102)
            {
              v103 = v102;
              v104 = [(PLManagedAsset *)self additionalAttributes];
              [v104 setSpatialOverCaptureGroupIdentifier:v103];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
              }

              v8 = v8;

              v104 = [(PLManagedAsset *)self additionalAttributes];
              v105 = [v104 spatialOverCaptureGroupIdentifier];
              [v8 setString:v105 forKey:v101];
            }

            v106 = *MEMORY[0x1E69BFE38];
            v107 = [v5 stringForKey:*MEMORY[0x1E69BFE38]];
            v132 = v107;
            if (v107)
            {
              v108 = v107;
              v109 = v3;
              v110 = [(PLManagedAsset *)self additionalAttributes];
              [v110 setSyndicationIdentifier:v108];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
              }

              v109 = v3;
              v8 = v8;

              v110 = [(PLManagedAsset *)self additionalAttributes];
              v111 = [v110 syndicationIdentifier];
              [v8 setString:v111 forKey:v106];
            }

            v112 = *MEMORY[0x1E69BFDD0];
            v113 = [v5 dataForKey:*MEMORY[0x1E69BFDD0]];
            v114 = MEMORY[0x1E696ACD0];
            v115 = MEMORY[0x1E695DFD8];
            v116 = objc_opt_class();
            v117 = [v115 setWithObjects:{v116, objc_opt_class(), 0}];
            v153 = 0;
            v133 = v113;
            v118 = [v114 unarchivedObjectOfClasses:v117 fromData:v113 error:&v153];
            v119 = v153;

            v142 = v53;
            if ([v118 count])
            {
              v120 = [(PLManagedAsset *)self additionalAttributes];
              [v120 setLibraryScopeAssetContributorsToUpdate:v118];
              v3 = v109;
            }

            else
            {
              v3 = v109;
              if (v119)
              {
                v120 = PLBackendGetLog();
                if (os_log_type_enabled(v120, OS_LOG_TYPE_ERROR))
                {
                  *buf = 138412290;
                  *&buf[2] = v119;
                  _os_log_impl(&dword_19BF1F000, v120, OS_LOG_TYPE_ERROR, "libraryScopeAssetContributorsToUpdate unarchiving failed: %@", buf, 0xCu);
                }
              }

              else
              {
                if (!v8)
                {
                  v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v150];
                }

                v8 = v8;

                v128 = MEMORY[0x1E696ACC8];
                v129 = [(PLManagedAsset *)self additionalAttributes];
                v130 = [v129 libraryScopeAssetContributorsToUpdate];
                v152 = 0;
                v120 = [v128 archivedDataWithRootObject:v130 requiringSecureCoding:1 error:&v152];
                v119 = v152;

                if (v119)
                {
                  v131 = PLBackendGetLog();
                  v3 = v109;
                  if (os_log_type_enabled(v131, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 138412290;
                    *&buf[2] = v119;
                    _os_log_impl(&dword_19BF1F000, v131, OS_LOG_TYPE_ERROR, "libraryScopeAssetContributorsToUpdate archiving failed: %@", buf, 0xCu);
                  }
                }

                else
                {
                  [v8 setData:v120 forKey:v112];
                  v3 = v109;
                }
              }
            }

            v151 = 0;
            v121 = *MEMORY[0x1E69BFE30];
            if ([v5 getUInt16:&v151 forKey:*MEMORY[0x1E69BFE30]])
            {
              v122 = [(PLManagedAsset *)self additionalAttributes];
              [v122 setSyndicationHistory:v151];
              v123 = 0x1E696A000;
            }

            else
            {
              v123 = 0x1E696A000uLL;
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v150];
              }

              v8 = v8;

              v122 = [(PLManagedAsset *)self additionalAttributes];
              [v8 setUInt16:objc_msgSend(v122 forKey:{"syndicationHistory"), v121}];
            }

            v124 = [v5 dataForKey:*MEMORY[0x1E69BFD40]];
            if (v124)
            {
              v125 = [*(v123 + 3648) propertyListWithData:v124 options:0 format:0 error:0];

              if (v125)
              {
                [(PLManagedAsset *)self setDateCreated:v125];
              }
            }

            v126 = [v5 stringForKey:*MEMORY[0x1E69BFD28]];
            if (v126)
            {
              [(PLManagedAsset *)self setCloudAssetGUID:v126];
            }

            *buf = 0;
            v127 = *MEMORY[0x1E69BFDD8];
            if ([v5 getUInt64:buf forKey:*MEMORY[0x1E69BFDD8]])
            {
              [(PLManagedAsset *)self setLibraryScopeShareState:*buf];
            }

            else
            {
              if (!v8)
              {
                v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v150];
              }

              v8 = v8;

              [v8 setUInt64:-[PLManagedAsset libraryScopeShareState](self forKey:{"libraryScopeShareState"), v127}];
            }

            [(PLManagedAsset *)self setLocationFromPersistedAttributes:v5];
            if (v8)
            {
              [v8 persist];
            }

            v4 = v150;
            goto LABEL_206;
          }

          v90 = v91;
          if (!v8)
          {
            v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
          }

          v8 = v8;

          [v8 setString:v90 forKey:v87];
        }

        goto LABEL_148;
      }

      if (!v8)
      {
        v8 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v4];
      }

      v76 = [(PLManagedAsset *)self additionalAttributes];
      v78 = [v76 longDescription];
      [v8 setString:v78 forKey:v73];
    }

    goto LABEL_127;
  }
}

- (void)persistMetadataToFileURL:(id)a3
{
  v57 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (!v5)
  {
    v53 = [MEMORY[0x1E696AAA8] currentHandler];
    [v53 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:4563 description:{@"Invalid parameter not satisfying: %@", @"url"}];
  }

  v6 = objc_autoreleasePoolPush();
  v7 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v5];
  v8 = [(PLManagedAsset *)self uuid];
  [v7 setUUIDString:v8 forKey:*MEMORY[0x1E69BFE68]];

  v9 = [(PLManagedAsset *)self savedAssetType];
  [v7 setUInt16:v9 forKey:*MEMORY[0x1E69BFE18]];
  v10 = [(PLManagedObject *)self photoLibrary];
  v11 = [v10 managedObjectContextStoreUUID];
  [v7 setString:v11 forKey:*MEMORY[0x1E69BFD58]];

  v12 = [(PLManagedAsset *)self avalancheKind];
  if (v12 >= 2)
  {
    if (v12 != 2)
    {
      goto LABEL_8;
    }

    v14 = 0;
  }

  else
  {
    v13 = [(PLManagedAsset *)self avalancheUUID];
    [v7 setUUIDString:v13 forKey:*MEMORY[0x1E69BFD20]];

    v14 = [(PLManagedAsset *)self avalanchePickType];
  }

  [v7 setUInt16:v14 forKey:*MEMORY[0x1E69BFD18]];
LABEL_8:
  v15 = [(PLManagedAsset *)self hidden];
  [v7 setUInt16:v15 forKey:*MEMORY[0x1E69BFD88]];
  v16 = [(PLManagedAsset *)self favorite];
  [v7 setUInt16:v16 forKey:*MEMORY[0x1E69BFD80]];
  v17 = [(PLManagedAsset *)self isInTrash];
  [v7 setUInt16:v17 forKey:*MEMORY[0x1E69BFE58]];
  v18 = [(PLManagedAsset *)self trashedReason];
  [v7 setUInt16:v18 forKey:*MEMORY[0x1E69BFE60]];
  v19 = [(PLManagedAsset *)self deferredProcessingNeeded];
  [v7 setUInt16:v19 forKey:*MEMORY[0x1E69BFD60]];
  v20 = [(PLManagedAsset *)self dateCreatedData];
  [v7 setData:v20 forKey:*MEMORY[0x1E69BFD40]];

  v21 = [(PLManagedAsset *)self locationData];
  [v7 setData:v21 forKey:*MEMORY[0x1E69BFD48]];

  v22 = [(PLManagedAsset *)self addedDateData];
  [v7 setData:v22 forKey:*MEMORY[0x1E69BFD08]];

  [MEMORY[0x1E69BF328] maskForIsValidForFileSystemPersistence];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    v23 = [(PLManagedAsset *)self cloudAssetGUID];
    [v7 setString:v23 forKey:*MEMORY[0x1E69BFD28]];
  }

  v24 = [(PLManagedAsset *)self videoComplementData];
  [v7 setData:v24 forKey:*MEMORY[0x1E69BFD78]];

  v25 = [(PLManagedAsset *)self videoCpVisibilityState];
  [v7 setUInt16:v25 forKey:*MEMORY[0x1E69BFE70]];
  v26 = [(PLManagedAsset *)self libraryScopeShareState];
  [v7 setUInt64:v26 forKey:*MEMORY[0x1E69BFDD8]];
  v27 = [(PLManagedAsset *)self currentSleetCast];
  [v7 setUInt16:v27 forKey:*MEMORY[0x1E69BFD38]];
  v28 = [(PLManagedAsset *)self additionalAttributes];
  v29 = [v28 importedByBundleIdentifier];
  [v7 setString:v29 forKey:*MEMORY[0x1E69BFD90]];

  v30 = [v28 importedByDisplayName];
  [v7 setString:v30 forKey:*MEMORY[0x1E69BFD98]];

  v31 = [v28 originalAssetsUUID];
  [v7 setUUIDString:v31 forKey:*MEMORY[0x1E69BFDF0]];

  v32 = [v28 publicGlobalUUID];
  [v7 setString:v32 forKey:*MEMORY[0x1E69BFE08]];

  v33 = [v28 title];
  [v7 setString:v33 forKey:*MEMORY[0x1E69BFE50]];

  v34 = [v28 accessibilityDescription];
  [v7 setString:v34 forKey:*MEMORY[0x1E69BFD00]];

  v35 = [v28 timeZoneName];
  [v7 setString:v35 forKey:*MEMORY[0x1E69BFE40]];

  v36 = [v28 timeZoneOffset];
  v37 = [v36 intValue];
  [v7 setInt32:v37 forKey:*MEMORY[0x1E69BFE48]];

  v38 = [v28 longDescription];
  [v7 setString:v38 forKey:*MEMORY[0x1E69BFD70]];

  v39 = [v28 originalFilename];
  [v7 setString:v39 forKey:*MEMORY[0x1E69BFDF8]];

  v40 = [v28 placeAnnotationData];
  [v7 setData:v40 forKey:*MEMORY[0x1E69BFE00]];

  if ([v28 importedBy])
  {
    v41 = [v28 importedBy];
    [v7 setUInt16:v41 forKey:*MEMORY[0x1E69BFDA0]];
  }

  v42 = [(PLManagedAsset *)self _mediaGroupUUIDForPersistence];
  [v7 setString:v42 forKey:*MEMORY[0x1E69BFDE0]];
  v43 = [v28 spatialOverCaptureGroupIdentifier];
  [v7 setString:v43 forKey:*MEMORY[0x1E69BFE28]];

  v44 = [v28 syndicationIdentifier];
  [v7 setString:v44 forKey:*MEMORY[0x1E69BFE38]];

  v45 = [v28 syndicationHistory];
  [v7 setUInt16:v45 forKey:*MEMORY[0x1E69BFE30]];
  v46 = [v28 sceneAnalysisIsFromPreview];
  [v7 setUInt16:v46 forKey:*MEMORY[0x1E69BFE20]];
  v47 = [v28 viewPresentation];
  [v7 setUInt16:v47 forKey:*MEMORY[0x1E69BFE78]];
  v48 = MEMORY[0x1E696ACC8];
  v49 = [v28 libraryScopeAssetContributorsToUpdate];
  v54 = 0;
  v50 = [v48 archivedDataWithRootObject:v49 requiringSecureCoding:1 error:&v54];
  v51 = v54;

  if (v51)
  {
    v52 = PLBackendGetLog();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v56 = v51;
      _os_log_impl(&dword_19BF1F000, v52, OS_LOG_TYPE_ERROR, "libraryScopeAssetContributorsToUpdate archiving failed: %@", buf, 0xCu);
    }
  }

  else
  {
    [v7 setData:v50 forKey:*MEMORY[0x1E69BFDD0]];
  }

  [v7 persist];

  objc_autoreleasePoolPop(v6);
}

- (void)persistMetadataToFilesystem
{
  if (PLIsAssetsd() && [(PLManagedAsset *)self isValidTypeForPersistence])
  {
    v3 = [(PLManagedAsset *)self persistedFileSystemAttributesFileURL];
    if (v3)
    {
      v4 = v3;
      [(PLManagedAsset *)self persistMetadataToFileURL:v3];
      v3 = v4;
    }
  }
}

- (id)_mediaGroupUUIDForPersistence
{
  v3 = [(PLManagedAsset *)self mediaGroupUUID];
  if (v3 && [(PLManagedAsset *)self isVideo])
  {
    v4 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@%@", @"failed-", v3];

    v3 = v4;
  }

  return v3;
}

- (id)addedDateData
{
  v2 = MEMORY[0x1E696AE40];
  v3 = [(PLManagedAsset *)self addedDate];
  v4 = [v2 dataWithPropertyList:v3 format:200 options:0 error:0];

  return v4;
}

- (id)dateCreatedData
{
  v2 = MEMORY[0x1E696AE40];
  v3 = [(PLManagedAsset *)self dateCreated];
  v4 = [v2 dataWithPropertyList:v3 format:200 options:0 error:0];

  return v4;
}

- (BOOL)hasLegacyRequiredResourcesLocallyAvailable
{
  v3 = [(PLManagedObject *)self photoLibrary];
  v4 = [v3 isCloudPhotoLibraryEnabled];

  if (!v4)
  {
    return 1;
  }

  return [(PLManagedAsset *)self checkAllResourcesRequiredForCPLDisableWithReachableBlock:0];
}

- (BOOL)hasOriginalFile
{
  v3 = [MEMORY[0x1E696AC08] defaultManager];
  v4 = [(PLManagedAsset *)self pathForOriginalFile];
  v5 = [v3 fileExistsAtPath:v4 isDirectory:0];

  return v5;
}

- (BOOL)isValidTypeForPersistence
{
  [MEMORY[0x1E69BF328] maskForIsValidForFileSystemPersistence];
  [(PLManagedAsset *)self savedAssetType];
  v3 = PLValidatedSavedAssetTypeApplies();
  if (v3)
  {
    v3 = [MEMORY[0x1E69BF2A0] bundleScopeShouldBePersistedForRebuild:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
    if (v3)
    {
      if ([(PLManagedAsset *)self hasOriginalFile])
      {
        LOBYTE(v3) = 1;
      }

      else
      {

        LOBYTE(v3) = [(PLManagedAsset *)self hasDeferredProcessingPreviewFile];
      }
    }
  }

  return v3;
}

- (NSString)uuidDescription
{
  v3 = MEMORY[0x1E696AEC0];
  v4 = [(PLManagedAsset *)self objectID];
  v5 = [v4 pl_shortURI];
  v6 = [(PLManagedAsset *)self uuid];
  v7 = [v3 stringWithFormat:@"<%@ %@>", v5, v6];

  return v7;
}

- (id)loggingDescription
{
  v3 = [MEMORY[0x1E696AD60] string];
  v4 = objc_autoreleasePoolPush();
  v5 = [(PLManagedAsset *)self uuidDescription];
  [v3 appendFormat:@"%@ ", v5];

  v6 = [MEMORY[0x1E695DF70] array];
  v7 = [(PLManagedAsset *)self _kindDescription];
  if (v7)
  {
    [v6 addObject:v7];
  }

  v8 = [(PLManagedAsset *)self _savedAssetTypeDescription];

  if (v8)
  {
    v9 = [(PLManagedAsset *)self _savedAssetTypeDescription];
    [v6 addObject:v9];
  }

  v10 = MEMORY[0x1E696AEC0];
  v11 = [(PLManagedAsset *)self dateCreated];
  v12 = [v10 stringWithFormat:@"created:%@", v11];
  [v6 addObject:v12];

  v13 = MEMORY[0x1E696AEC0];
  v14 = [(PLManagedAsset *)self addedDate];
  v15 = [v13 stringWithFormat:@"added:%@", v14];
  [v6 addObject:v15];

  if ([v6 count])
  {
    objc_msgSend(v3, "appendString:", @" (");
    v16 = [v6 componentsJoinedByString:{@", "}];
    [v3 appendString:v16];

    [v3 appendString:@""]);
  }

  objc_autoreleasePoolPop(v4);

  return v3;
}

- (id)_compactDebugDescription
{
  v3 = objc_autoreleasePoolPush();
  v4 = [(PLManagedAsset *)self objectID];
  v5 = [v4 URIRepresentation];
  v6 = [v5 path];
  v7 = [v6 pathComponents];

  if ([v7 count] >= 2)
  {
    v8 = [v7 subarrayWithRange:{objc_msgSend(v7, "count") - 2, 2}];

    v7 = v8;
  }

  v9 = [MEMORY[0x1E696AEC0] pathWithComponents:v7];
  v10 = MEMORY[0x1E696AEC0];
  v11 = [(PLManagedAsset *)self uuid];
  v12 = [v10 stringWithFormat:@"%@ [%@]", v11, v9];

  objc_autoreleasePoolPop(v3);

  return v12;
}

- (id)_kindDescription
{
  v2 = [(PLManagedAsset *)self kind];
  if (v2 > 2)
  {
    return @"unknown";
  }

  else
  {
    return qword_1E7567BD0[v2];
  }
}

- (id)_savedAssetTypeDescription
{
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeDescription();
}

- (id)_hdrTypeDescription
{
  v2 = [(PLManagedAsset *)self hdrType];
  if (v2 > 0xB)
  {
    return @"HDR";
  }

  else
  {
    return off_1E7567B70[v2];
  }
}

- (void)unregisterForChanges
{
  if (self->_isRegisteredForChanges)
  {
    self->_isRegisteredForChanges = 0;
    v4 = +[PLChangeNotificationCenter defaultCenter];
    [(PLManagedAsset *)self removeObserver:v4 forKeyPath:@"cloudComments" context:&PLChangeNotificationCenterKVOContext];
    [(PLManagedAsset *)self removeObserver:v4 forKeyPath:@"likeComments" context:&PLChangeNotificationCenterKVOContext];
  }
}

- (void)registerForChanges
{
  if ([(PLManagedObject *)self isRegisteredWithUserInterfaceContext]&& [(PLManagedAsset *)self isCloudSharedAsset]&& !self->_isRegisteredForChanges)
  {
    self->_isRegisteredForChanges = 1;
    v3 = +[PLChangeNotificationCenter defaultCenter];
    [(PLManagedAsset *)self addObserver:v3 forKeyPath:@"cloudComments" options:8 context:&PLChangeNotificationCenterKVOContext];
    [(PLManagedAsset *)self addObserver:v3 forKeyPath:@"likeComments" options:8 context:&PLChangeNotificationCenterKVOContext];
  }
}

- (BOOL)_isValidUTI:(id)a3 forService:(id)a4
{
  v6 = a3;
  v7 = a4;
  if (-[PLManagedAsset isPhoto](self, "isPhoto") && ![v7 caseInsensitiveCompare:@"MMS"])
  {
    v10 = [MEMORY[0x1E69C08F0] typeWithIdentifier:v6];
    if ([v10 isEqual:*MEMORY[0x1E6982E58]] & 1) != 0 || (objc_msgSend(v10, "isEqual:", *MEMORY[0x1E6982F28]))
    {
      v8 = 1;
    }

    else
    {
      v8 = [v10 isEqual:*MEMORY[0x1E6982DE8]];
    }
  }

  else
  {
    v8 = 1;
  }

  return v8;
}

- (id)pathToOriginalVideoFile
{
  v15 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self isStreamedVideo]&& ([(PLManagedAsset *)self originalAssetsUUID], v3 = objc_claimAutoreleasedReturnValue(), v3, v3))
  {
    v4 = [(PLManagedObject *)self photoLibrary];
    v5 = [(PLManagedAsset *)self originalAssetsUUID];
    v6 = [v4 assetWithUUID:v5];

    if (v6 && (-[PLManagedAsset duration](self, "duration"), v8 = v7, [v6 duration], v8 == v9))
    {
      v10 = [v6 pathForVideoFile];
      v11 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
      {
        v13 = 138412290;
        v14 = v10;
        _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEBUG, "pathToOriginalVideoFile %@", &v13, 0xCu);
      }
    }

    else
    {
      v10 = 0;
    }
  }

  else
  {
    v10 = 0;
  }

  return v10;
}

- (NSURL)cachedNonPersistedVideoPlaybackURL
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = self->cachedNonPersistedVideoPlaybackURL;
  v4 = [(PLManagedAsset *)self cachedNonPersistedVideoPlaybackURLExpiration];
  if (v3)
  {
    v5 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = [MEMORY[0x1E695DF00] date];
      [v6 timeIntervalSinceDate:v4];
      v12 = 138412546;
      v13 = v4;
      v14 = 2048;
      v15 = v7;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "cachedNonPersistedVideoPlaybackURLExpiration %@ %lf", &v12, 0x16u);
    }

    v8 = [MEMORY[0x1E695DF00] date];
    v9 = [v4 compare:v8];

    if (v9 != 1)
    {
      v10 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v12 = 138412290;
        v13 = v4;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEFAULT, "cachedNonPersistedVideoPlaybackURL expired on %@", &v12, 0xCu);
      }

      v3 = 0;
    }
  }

  return v3;
}

- (void)_coordinatesFromDoubles:(double)a3 faceMaxX:(double)a4 faceMinY:(double)a5 faceMaxY:(double)a6 minX:(double *)a7 maxX:(double *)a8 minY:(double *)a9 maxY:(double *)a10
{
  if (*a7 < a3 && *a7 > -1.0)
  {
    a3 = *a7;
  }

  *a7 = a3;
  v11 = *a9;
  if (*a9 >= a5 || v11 <= -1.0)
  {
    v11 = a5;
  }

  *a9 = v11;
  if (*a8 >= a4)
  {
    v13 = *a8;
  }

  else
  {
    v13 = a4;
  }

  if (*a8 <= -1.0)
  {
    v14 = a4;
  }

  else
  {
    v14 = v13;
  }

  *a8 = v14;
  if (*a10 >= a6)
  {
    v15 = *a10;
  }

  else
  {
    v15 = a6;
  }

  if (*a10 <= -1.0)
  {
    v16 = a6;
  }

  else
  {
    v16 = v15;
  }

  *a10 = v16;
}

- (void)revalidateFaceAreaPoints
{
  v49 = *MEMORY[0x1E69E9840];
  *&v46 = -1.0;
  *&v47 = -1.0;
  *&v44 = -1.0;
  *&v45 = -1.0;
  v3 = [(PLManagedAsset *)self detectedFaces];
  v4 = [v3 count];

  if (v4)
  {
    v42 = 0u;
    v43 = 0u;
    v40 = 0u;
    v41 = 0u;
    v5 = [(PLManagedAsset *)self detectedFaces];
    v6 = [v5 countByEnumeratingWithState:&v40 objects:v48 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v41;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v41 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = *(*(&v40 + 1) + 8 * i);
          if (([v10 isTorsoOnly] & 1) == 0)
          {
            [v10 centerX];
            v12 = v11;
            [v10 centerY];
            v14 = v13;
            [v10 size];
            v16 = v15 * 0.5;
            v17 = fmax(v12 - v15 * 0.5, 0.0);
            v18 = v12 + v16;
            if (v12 + v16 > 1.0)
            {
              v18 = 1.0;
            }

            v19 = fmax(v14 - v16, 0.0);
            v20 = v14 + v16;
            if (v20 > 1.0)
            {
              v20 = 1.0;
            }

            [(PLManagedAsset *)self _coordinatesFromDoubles:&v47 faceMaxX:&v45 faceMinY:&v46 faceMaxY:&v44 minX:v17 maxX:v18 minY:v19 maxY:v20];
          }
        }

        v7 = [v5 countByEnumeratingWithState:&v40 objects:v48 count:16];
      }

      while (v7);
    }

LABEL_20:

    v36 = *&v46;
    v35 = *&v47;
    v38 = *&v44;
    v37 = *&v45;
    goto LABEL_21;
  }

  v21 = [(PLManagedAsset *)self faceRegions];

  if (v21)
  {
    v22 = [(PLManagedAsset *)self faceRegions];
    v5 = PLManagedAssetDecodeFaceRegions(v22);

    if ([v5 count])
    {
      v23 = 0;
      do
      {
        v24 = [v5 objectAtIndexedSubscript:v23];
        v25 = MEMORY[0x19EAED7C0]();
        v27 = v26;
        v29 = v28;
        v31 = v30;

        v50.origin.x = v25;
        v50.origin.y = v27;
        v50.size.width = v29;
        v50.size.height = v31;
        MinX = CGRectGetMinX(v50);
        v51.origin.x = v25;
        v51.origin.y = v27;
        v51.size.width = v29;
        v51.size.height = v31;
        MaxX = CGRectGetMaxX(v51);
        v52.origin.x = v25;
        v52.origin.y = v27;
        v52.size.width = v29;
        v52.size.height = v31;
        MinY = CGRectGetMinY(v52);
        v53.origin.x = v25;
        v53.origin.y = v27;
        v53.size.width = v29;
        v53.size.height = v31;
        [(PLManagedAsset *)self _coordinatesFromDoubles:&v47 faceMaxX:&v45 faceMinY:&v46 faceMaxY:&v44 minX:MinX maxX:MaxX minY:MinY maxY:CGRectGetMaxY(v53)];
        ++v23;
      }

      while ([v5 count] > v23);
    }

    goto LABEL_20;
  }

  v38 = -1.0;
  v36 = -1.0;
  v37 = -1.0;
  v35 = -1.0;
LABEL_21:
  v39 = [(PLManagedAsset *)self _combineFaceAreaPointValuesToInt64WithMinX:v35 maxX:v37 minY:v36 maxY:v38];
  if ([(PLManagedAsset *)self faceAreaPoints]!= v39)
  {
    [(PLManagedAsset *)self setFaceAreaPoints:v39];
  }
}

- (void)setLibraryScope:(id)a3
{
  v4 = a3;
  v8 = 0;
  v9 = &v8;
  v10 = 0x2020000000;
  v11 = 0;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __34__PLManagedAsset_setLibraryScope___block_invoke;
  v7[3] = &unk_1E7567770;
  v7[4] = &v8;
  [(PLManagedObject *)self pl_safeSetValue:v4 forKey:@"libraryScope" valueDidChangeHandler:v7];
  if (*(v9 + 24) == 1)
  {
    v5 = [PLLibraryScope participationStateFromLibraryScope:v4];
    v6 = [MEMORY[0x1E696AD98] numberWithShort:v5];
    [(PLManagedObject *)self pl_safeSetValue:v6 forKey:@"activeLibraryScopeParticipationState" valueDidChangeHandler:0];
  }

  _Block_object_dispose(&v8, 8);
}

- (void)setAvalanchePickType:(int)a3
{
  v4 = [MEMORY[0x1E696AD98] numberWithInt:*&a3];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v4 forKey:@"avalanchePickType"];
}

- (void)setSavedAssetType:(signed __int16)a3
{
  v3 = a3;
  v6 = [(PLManagedAsset *)self savedAssetType];
  if (v6 != v3 && v6 == [MEMORY[0x1E69BF328] savedAssetTypeForPromoteToGuestAsset])
  {
    v7 = [(PLManagedObject *)self photoLibrary];
    v8 = [v7 libraryServicesManager];
    v9 = [v8 wellKnownPhotoLibraryIdentifier];

    if (v9 != 3)
    {
      v10 = [MEMORY[0x1E696AAA8] currentHandler];
      [v10 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:4131 description:{@"Invalid parameter not satisfying: %@", @"self.photoLibrary.libraryServicesManager.wellKnownPhotoLibraryIdentifier == PLWellKnownPhotoLibraryIdentifierSyndication"}];
    }
  }

  v11 = [MEMORY[0x1E696AD98] numberWithShort:v3];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v11 forKey:@"savedAssetType"];
}

- (void)setTrashedState:(signed __int16)a3
{
  v4 = [MEMORY[0x1E696AD98] numberWithShort:a3];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v4 forKey:@"trashedState"];
}

- (void)setHidden:(BOOL)a3
{
  v4 = [MEMORY[0x1E696AD98] numberWithBool:a3];
  [(PLManagedAsset *)self _setAllowedForAnalysisDependentValue:v4 forKey:@"hidden"];
}

- (void)_setAllowedForAnalysisDependentValue:(id)a3 forKey:(id)a4
{
  v7 = a3;
  v8 = a4;
  if (!v8)
  {
    v9 = [MEMORY[0x1E696AAA8] currentHandler];
    [v9 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:4106 description:{@"Invalid parameter not satisfying: %@", @"key"}];
  }

  objc_initWeak(&location, self);
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __62__PLManagedAsset__setAllowedForAnalysisDependentValue_forKey___block_invoke;
  v10[3] = &unk_1E7567748;
  objc_copyWeak(&v11, &location);
  [(PLManagedObject *)self pl_safeSetValue:v7 forKey:v8 valueDidChangeHandler:v10];
  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);
}

void __62__PLManagedAsset__setAllowedForAnalysisDependentValue_forKey___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained calculateAllowedForAnalysis];
  v2 = [WeakRetained additionalAttributes];
  v3 = [v2 allowedForAnalysis];

  if (v1 != v3)
  {
    v4 = [WeakRetained additionalAttributes];
    [v4 setAllowedForAnalysis:v1];
  }
}

- (void)setUuid:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __26__PLManagedAsset_setUuid___block_invoke;
  v6[3] = &unk_1E7568790;
  objc_copyWeak(&v8, &location);
  v5 = v4;
  v7 = v5;
  [(PLManagedObject *)self pl_safeSetValue:v5 forKey:@"uuid" valueDidChangeHandler:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __26__PLManagedAsset_setUuid___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x1E69E9840];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained analysisStates];

  v4 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v9;
    do
    {
      v7 = 0;
      do
      {
        if (*v9 != v6)
        {
          objc_enumerationMutation(v3);
        }

        [*(*(&v8 + 1) + 8 * v7++) setAssetUUID:*(a1 + 32)];
      }

      while (v5 != v7);
      v5 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v5);
  }
}

- (void)_dateCreatedDidChange:(id)a3
{
  v21 = *MEMORY[0x1E69E9840];
  v4 = a3;
  [v4 timeIntervalSinceReferenceDate];
  v6 = v5;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v7 = [(PLManagedAsset *)self analysisStates];
  v8 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v17;
    do
    {
      v11 = 0;
      do
      {
        if (*v17 != v10)
        {
          objc_enumerationMutation(v7);
        }

        [*(*(&v16 + 1) + 8 * v11++) setSortToken:v6];
      }

      while (v9 != v11);
      v9 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v9);
  }

  v12 = [(PLManagedAsset *)self mediaAnalysisAttributesInsertingIfNecessary];
  [v12 setAssetDateCreated:v4];
  v13 = [(PLManagedAsset *)self additionalAttributes];
  [v13 setInferredTimeZoneOffset:0];

  cachedDateCreated = self->_cachedDateCreated;
  self->_cachedDateCreated = 0;

  cachedLocalDateCreated = self->_cachedLocalDateCreated;
  self->_cachedLocalDateCreated = 0;
}

- (void)setDateCreated:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __33__PLManagedAsset_setDateCreated___block_invoke;
  v6[3] = &unk_1E7568790;
  objc_copyWeak(&v8, &location);
  v5 = v4;
  v7 = v5;
  [(PLManagedObject *)self pl_safeSetValue:v5 forKey:@"dateCreated" valueDidChangeHandler:v6];

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

void __33__PLManagedAsset_setDateCreated___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained _dateCreatedDidChange:*(a1 + 32)];
}

- (void)setMoment:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedObject *)self photoLibrary];
  v6 = [(PLManagedAsset *)self hasLibraryScope];
  v7 = [v5 libraryServicesManager];
  v8 = [v7 databaseContext];
  v9 = [v8 momentLibrary];
  if (v5 == v9)
  {
    v10 = 1;
  }

  else
  {
    v10 = MEMORY[0x19EAEE520]();
  }

  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __28__PLManagedAsset_setMoment___block_invoke;
  v12[3] = &unk_1E7567720;
  v14 = v10;
  v15 = v6;
  v12[4] = self;
  v13 = v4;
  v11 = v4;
  [(PLManagedObject *)self pl_safeSetValue:v11 forKey:@"moment" valueDidChangeHandler:v12];
}

void __28__PLManagedAsset_setMoment___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 48) == 1)
  {
    v8 = v3;
    v4 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
    [(PLSharedAssetsContainerIncrementalChange *)v4 setCollectionChangeType:1];
    v5 = *(a1 + 49) ? 1 : 2;
    [(PLSharedAssetsContainerIncrementalChange *)v4 setSharingChange:v5];
    [(PLSharedAssetsContainerIncrementalChange *)v4 setSuggestionStateChange:0];
    -[PLSharedAssetsContainerIncrementalChange setMediaType:](v4, "setMediaType:", [*(a1 + 32) kind] != 0);
    [*(a1 + 40) reportSharedAssetContainerIncrementalChange:v4 forAllAssetsCountKey:@"assetsCount"];

    v3 = v8;
    if (*(a1 + 48))
    {
      v6 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
      [(PLSharedAssetsContainerIncrementalChange *)v6 setCollectionChangeType:2];
      if (*(a1 + 49))
      {
        v7 = 1;
      }

      else
      {
        v7 = 2;
      }

      [(PLSharedAssetsContainerIncrementalChange *)v6 setSharingChange:v7];
      [(PLSharedAssetsContainerIncrementalChange *)v6 setSuggestionStateChange:0];
      -[PLSharedAssetsContainerIncrementalChange setMediaType:](v6, "setMediaType:", [*(a1 + 32) kind] != 0);
      [v8 reportSharedAssetContainerIncrementalChange:v6 forAllAssetsCountKey:@"assetsCount"];

      v3 = v8;
    }
  }
}

- (void)setOriginalAsset:(id)a3
{
  v4 = [a3 uuid];
  [(PLManagedAsset *)self setOriginalAssetsUUID:v4];
}

- (PLManagedAsset)originalAsset
{
  v3 = [(PLManagedAsset *)self originalAssetsUUID];
  v4 = [(PLManagedObject *)self photoLibrary];
  v5 = [PLManagedAsset assetWithUUID:v3 inLibrary:v4];

  return v5;
}

- (CGSize)originalImageSize
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalWidth];
  [v3 doubleValue];
  v5 = v4;
  v6 = [v2 originalHeight];
  [v6 doubleValue];
  v8 = v7;

  v9 = v5;
  v10 = v8;
  result.height = v10;
  result.width = v9;
  return result;
}

- (BOOL)isOriginalSRGB
{
  v3 = [(PLManagedAsset *)self originalColorSpace];

  if (!v3)
  {
    return 1;
  }

  v4 = [(PLManagedAsset *)self originalColorSpace];
  v5 = [v4 isEqualToString:@"sRGB IEC61966-2.1"];

  return v5;
}

- (int64_t)originalImageOrientation
{
  [(PLManagedAsset *)self originalOrientation];

  return PLImageOrientationFromExifOrientation();
}

- (void)didSave
{
  self->_setCustomCreationDate = 0;
  self->_setCustomLocation = 0;
  v2.receiver = self;
  v2.super_class = PLManagedAsset;
  [(PLManagedObject *)&v2 didSave];
}

- (id)duplicateAlbum
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedObject *)self photoLibrary];
  v4 = [v3 libraryServicesManager];

  if (v4)
  {
    v5 = [PLDuplicateProcessor isDuplicateProcessorEnabledForLibraryServicesManager:v4];
  }

  else
  {
    v5 = 1;
  }

  v6 = [(PLManagedAsset *)self albums];

  v7 = 0;
  if (v6 && v5)
  {
    v15 = 0u;
    v16 = 0u;
    v13 = 0u;
    v14 = 0u;
    v8 = [(PLManagedAsset *)self albums];
    v7 = [v8 countByEnumeratingWithState:&v13 objects:v17 count:16];
    if (v7)
    {
      v9 = *v14;
      while (2)
      {
        for (i = 0; i != v7; i = i + 1)
        {
          if (*v14 != v9)
          {
            objc_enumerationMutation(v8);
          }

          v11 = *(*(&v13 + 1) + 8 * i);
          if ([v11 isDuplicateAlbum])
          {
            v7 = v11;
            goto LABEL_16;
          }
        }

        v7 = [v8 countByEnumeratingWithState:&v13 objects:v17 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }

LABEL_16:
  }

  return v7;
}

- (void)removeFromDuplicateAlbum
{
  v3 = [(PLManagedAsset *)self duplicateAlbum];
  if (v3)
  {
    v5 = v3;
    [(PLManagedAsset *)self setDuplicateAssetVisibilityState:0];
    v4 = [v5 mutableAssets];
    [v4 removeObject:self];

    v3 = v5;
  }
}

- (void)_resetAllMediaProcessingVersionsIncludingVideo:(BOOL)a3
{
  v3 = a3;
  for (i = 0; i != 8; ++i)
  {
    v6 = qword_19C60B768[i];
    if (v6 > 0x14)
    {
      continue;
    }

    if (((1 << v6) & 0x19140C) != 0)
    {
      v7 = 1;
LABEL_5:
      PLResetMediaProcessingStateOnAsset(v6, self, v7);
      continue;
    }

    if (v6 == 1)
    {
      if (v3)
      {
        v7 = 75841;
        goto LABEL_5;
      }
    }

    else if (v6 == 17)
    {
      v7 = 5121;
      goto LABEL_5;
    }
  }
}

- (void)_resetMediaAnalysisStateOnEditIncludingVideo:(BOOL)a3
{
  v3 = a3;
  [(PLManagedAsset *)self _clearOverallAestheticScore];
  [(PLManagedAsset *)self _deleteComputedAttributes];
  [(PLManagedAsset *)self _clearPreferredCropRect];
  [(PLManagedAsset *)self _clearAcceptableCropRect];
  [(PLManagedAsset *)self removeAllStillFrameSceneClassifications];
  [(PLManagedAsset *)self _reloadWidgetTimelineIfNeeded];
  [(PLManagedAsset *)self removeFromDuplicateAlbum];
  [(PLManagedAsset *)self _clearStickerConfidenceAttributes];
  [(PLManagedAsset *)self _resetAllMediaProcessingVersionsIncludingVideo:v3];
  if (v3)
  {
    [(PLManagedAsset *)self removeAllTemporalSceneClassifications];

    [(PLManagedAsset *)self deleteContextualVideoThumbnailFilesWithError:0];
  }
}

- (void)_duplicateProcessingChanges:(id)a3
{
  v22 = a3;
  v4 = [(PLManagedObject *)self photoLibrary];
  v5 = [v4 libraryServicesManager];
  v6 = [PLDuplicateProcessor isDuplicateProcessorEnabledForLibraryServicesManager:v5];

  if (v6)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = [v22 objectForKeyedSubscript:@"hidden"];

    v9 = [v22 objectForKeyedSubscript:@"trashedState"];

    v10 = [v22 objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

    if (v8)
    {
      if (([(PLManagedAsset *)self hidden]& 1) != 0)
      {
        goto LABEL_8;
      }

      if (!v9)
      {
        goto LABEL_10;
      }
    }

    else if (!v9)
    {
LABEL_11:
      if (v10)
      {
        [(PLManagedAsset *)self removeFromDuplicateAlbum];
LABEL_15:
        v11 = 1;
        goto LABEL_19;
      }

      if ([PLDuplicateAsset isDuplicateAssetSortChangedObject:self])
      {
        v12 = [(PLManagedAsset *)self duplicateAlbum];
        [v12 sortAssets];
      }

LABEL_18:
      v11 = 0;
LABEL_19:
      v13 = [v22 objectForKeyedSubscript:@"kindSubtype"];

      if (v13)
      {
        v14 = [(PLManagedAsset *)self kindSubtype];
        v13 = 4 * (v14 != 10);
        v15 = 4 * (v14 == 10);
        v11 = 1;
      }

      else
      {
        v15 = 0;
      }

      v16 = [v22 objectForKeyedSubscript:@"kind"];

      if (v16)
      {
        if ([(PLManagedAsset *)self kind]== 1 || [(PLManagedAsset *)self kind]== 2)
        {
          v15 = v15 | 2;
        }

        else
        {
          v13 = v13 | 2;
        }

        v11 = 1;
      }

      v17 = [v22 objectForKeyedSubscript:@"playbackStyle"];

      if (v17)
      {
        v18 = [(PLManagedAsset *)self playbackStyle];
        if (v18 == 2)
        {
          v13 = v13;
        }

        else
        {
          v13 = v13 | 8;
        }

        if (v18 == 2)
        {
          v15 = v15 | 8;
        }

        else
        {
          v15 = v15;
        }
      }

      else if (!v11)
      {
LABEL_39:
        objc_autoreleasePoolPop(v7);
        goto LABEL_40;
      }

      if (v15 | v13)
      {
        v19 = [(PLManagedAsset *)self additionalAttributes];
        [v19 addDuplicateDetectorPerceptualProcessingStates:v15 removeProcessingStates:v13];
      }

      v20 = [(PLManagedAsset *)self uuid];
      v21 = [(PLManagedObject *)self photoLibrary];
      [PLDuplicateProcessor signalDuplicateBackgroundJobItemForAssetUUID:v20 requiresMetadataProcessing:1 library:v21];

      goto LABEL_39;
    }

    if (![(PLManagedAsset *)self isInTrash])
    {
LABEL_10:
      if (([(PLManagedAsset *)self hidden]& 1) == 0 && ![(PLManagedAsset *)self isInTrash]&& !v10)
      {
        goto LABEL_15;
      }

      goto LABEL_11;
    }

LABEL_8:
    if (!v10)
    {
      [(PLManagedAsset *)self removeFromDuplicateAlbum];
      goto LABEL_18;
    }

    goto LABEL_10;
  }

LABEL_40:
}

- (void)_recordAssetPersonEdgeAndSocialGroupContainmentUpdateIfNeededWithChangedValues:(id)a3 inContext:(id)a4
{
  v11 = a3;
  v6 = a4;
  v7 = [v11 objectForKey:@"hidden"];
  if (v7 || ([v11 objectForKey:@"trashedState"], (v7 = objc_claimAutoreleasedReturnValue()) != 0))
  {

LABEL_4:
    v8 = [v6 delayedSaveActions];
    [v8 recordAssetPersonEdgeUpdateNeededForAsset:self];

    v9 = [v6 delayedSaveActions];
    [v9 recordSocialGroupContainmentUpdateNeededForAsset:self];

    goto LABEL_5;
  }

  v10 = [v11 objectForKey:@"visibilityState"];

  if (v10)
  {
    goto LABEL_4;
  }

LABEL_5:
}

- (void)willSave
{
  v198[1] = *MEMORY[0x1E69E9840];
  v192.receiver = self;
  v192.super_class = PLManagedAsset;
  [(PLManagedObject *)&v192 willSave];
  if ([(PLManagedAsset *)self isDeleted]&& ((PLIsAssetsd() & 1) != 0 || MEMORY[0x19EAEE520]()))
  {
    v3 = [(PLManagedAsset *)self managedObjectContext];
    [PLGraphNode cleanupDanglingNodeReferencesToDeletedActorsInContext:v3];
  }

  v4 = [(PLManagedAsset *)self managedObjectContext];
  v5 = [v4 userInfo];
  v6 = [v5 objectForKeyedSubscript:@"updatingAssetPersonEdgesKey"];

  v7 = [(PLManagedAsset *)self changedValues];
  if ([v7 count] || !v6)
  {
  }

  else
  {
    v8 = [v6 BOOLValue];

    if (v8)
    {
      goto LABEL_214;
    }
  }

  v9 = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v190 = v6;
    v10 = [v9 userInfo];
    v11 = [PLClientServerTransaction transactionFromUserInfo:v10];

    if (v11)
    {
      [v11 pushChangeScopesBatch];
    }

    v189 = v11;
    v12 = [(PLManagedAsset *)self changedValues];
    v13 = [(PLManagedAsset *)self isSyncableChange];
    v14 = [v12 objectForKeyedSubscript:@"modificationDate"];

    if (!v14 && v13)
    {
      v15 = [MEMORY[0x1E695DF00] date];
      [(PLManagedAsset *)self setModificationDate:v15];
    }

    if (([(PLManagedAsset *)self isDeleted]& 1) != 0)
    {
      goto LABEL_105;
    }

    v16 = [v12 objectForKeyedSubscript:@"libraryScope"];
    if (v16)
    {
      v17 = v16;
      v18 = [v12 objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

      if (!v18)
      {
        v19 = PLBackendGetLog();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_FAULT))
        {
          *buf = 0;
          _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_FAULT, "[PLManagedAsset willSave] detected a change with changedValues[libraryScope] but no corresponding change to activeLibraryScopeParticipationState.", buf, 2u);
        }

        v20 = [(PLManagedAsset *)self libraryScope];
        v21 = [PLLibraryScope participationStateFromLibraryScope:v20];

        v22 = [MEMORY[0x1E696AD98] numberWithShort:v21];
        [(PLManagedObject *)self pl_safeSetValue:v22 forKey:@"activeLibraryScopeParticipationState" valueDidChangeHandler:0];
      }
    }

    if ([(PLManagedAsset *)self isPhoto])
    {
      if ([(PLManagedAsset *)self isInserted]&& [(PLManagedAsset *)self isCloudSharedAsset]&& [(PLManagedAsset *)self visibilityState]!= 2)
      {
        [(PLManagedAsset *)self setVisibilityState:2];
      }

      v23 = [v12 objectForKeyedSubscript:@"avalanchePickType"];
      if (v23)
      {
        v186 = 1;
      }

      else
      {
        v24 = [v12 objectForKeyedSubscript:@"avalancheUUID"];
        v186 = v24 != 0;
      }
    }

    else
    {
      v186 = 0;
    }

    v25 = [v12 objectForKeyedSubscript:@"dateCreated"];
    if (v25)
    {
      v26 = v25;
      v27 = [v12 objectForKeyedSubscript:@"sortToken"];

      if (!v27)
      {
        v28 = [(PLManagedAsset *)self dateCreated];
        [v28 timeIntervalSinceReferenceDate];
        v30 = v29;

        [(PLManagedAsset *)self sortToken];
        if (vabdd_f64(v31, v30) > 2.22044605e-16)
        {
          [(PLManagedAsset *)self setSortToken:v30];
        }
      }
    }

    v32 = [v12 objectForKeyedSubscript:@"hidden"];

    v33 = [v12 objectForKeyedSubscript:@"favorite"];

    v34 = [v12 objectForKeyedSubscript:@"trashedState"];

    v183 = [v12 objectForKeyedSubscript:@"deferredProcessingNeeded"];

    v35 = [v12 objectForKeyedSubscript:@"addedDate"];

    if ([(PLManagedAsset *)self isCloudSharedAsset])
    {
      v185 = 0;
    }

    else
    {
      v36 = [v12 objectForKeyedSubscript:@"cloudAssetGUID"];
      v185 = v36 != 0;
    }

    v37 = [v12 objectForKeyedSubscript:@"mediaGroupUUID"];

    v38 = [v12 objectForKeyedSubscript:@"videoCpDurationValue"];
    if (v38)
    {
      v184 = 1;
    }

    else
    {
      v39 = v35;
      v40 = v37;
      v41 = [v12 objectForKeyedSubscript:@"additionalAttributes.videoCpDurationTimescale"];
      if (v41)
      {
        v184 = 1;
      }

      else
      {
        v42 = [v12 objectForKeyedSubscript:@"additionalAttributes.videoCpDisplayValue"];
        if (v42)
        {
          v184 = 1;
        }

        else
        {
          v43 = [v12 objectForKeyedSubscript:@"additionalAttributes.videoCpDisplayTimescale"];
          v184 = v43 != 0;

          v42 = 0;
        }
      }

      v37 = v40;
      v35 = v39;
    }

    v44 = [v12 objectForKeyedSubscript:@"videoCpVisibilityState"];

    v182 = [v12 objectForKeyedSubscript:@"libraryScopeShareState"];

    v45 = [v12 objectForKeyedSubscript:@"trashedReason"];

    [(PLManagedAsset *)self _recordAssetPersonEdgeAndSocialGroupContainmentUpdateIfNeededWithChangedValues:v12 inContext:v9];
    if (v32)
    {
      v46 = 1;
    }

    else
    {
      v46 = v186;
    }

    if ((v46 & 1) == 0 && !v33 && !v34 && !self->_setCustomCreationDate && !self->_setCustomLocation && v35 == 0 && !v185 && v37 == 0 && !v184 && !v44 && !v183 && !v182 && !v45)
    {
LABEL_97:
      [(PLManagedAsset *)self _duplicateProcessingChanges:v12];
      if (([(PLManagedAsset *)self isInserted]& 1) == 0)
      {
        v66 = [v12 objectForKeyedSubscript:@"complete"];
        if (v66 || ([v12 objectForKeyedSubscript:@"deferredProcessingNeeded"], (v66 = objc_claimAutoreleasedReturnValue()) != 0))
        {
        }

        else
        {
          v101 = [v12 objectForKeyedSubscript:@"adjustmentTimestamp"];

          if (!v101)
          {
            goto LABEL_105;
          }
        }
      }

      v67 = [(PLManagedAsset *)self uuid];
      if (v67)
      {
        v68 = v67;
        v69 = [(PLManagedObject *)self photoLibrary];
        v70 = [v69 libraryServicesManager];
        v71 = [v70 isCloudPhotoLibraryEnabled];

        if ((v71 & 1) == 0)
        {
          v72 = [(PLManagedObject *)self photoLibrary];
          v73 = [(PLManagedAsset *)self uuid];
          v74 = [v72 addBackgroundJobWorkItemIfNeededWithIdentifier:v73 jobType:8 jobFlags:0];

          if (v74)
          {
            v75 = [(PLManagedObject *)self photoLibrary];
            v76 = [v75 libraryServicesManager];
            v77 = [v76 backgroundJobService];
            v78 = [(PLManagedObject *)self photoLibrary];
            v79 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:8];
            [v77 signalBackgroundProcessingNeededOnLibrary:v78 workerTypes:v79];
          }
        }
      }

LABEL_105:
      if (([(PLManagedAsset *)self isInserted]& 1) != 0 || [(PLManagedAsset *)self isDeleted])
      {
        v80 = [v9 delayedSaveActions];
        [v80 recordBackgroundUploadEvent];
      }

      v81 = [v12 objectForKeyedSubscript:@"savedAssetType"];

      if (v81)
      {
        v198[0] = @"savedAssetType";
        v82 = [MEMORY[0x1E695DEC8] arrayWithObjects:v198 count:1];
        v83 = [(PLManagedAsset *)self committedValuesForKeys:v82];

        v84 = [v83 objectForKeyedSubscript:@"savedAssetType"];
        v85 = [v84 shortValue];

        v86 = [v12 objectForKeyedSubscript:@"savedAssetType"];
        v87 = [v86 shortValue];

        if (([MEMORY[0x1E69BF328] allowSavedAssetTypeMutationFrom:v85 to:v87] & 1) == 0)
        {
          v88 = [(PLManagedObject *)self photoLibrary];
          v89 = [v88 isUnitTesting];

          if ((v89 & 1) == 0)
          {
            v90 = PLBackendGetLog();
            if (os_log_type_enabled(v90, OS_LOG_TYPE_FAULT))
            {
              v91 = [(PLManagedAsset *)self uuid];
              *buf = 138543874;
              v195 = v91;
              v196 = 1024;
              *v197 = v85;
              *&v197[4] = 1024;
              *&v197[6] = v87;
              _os_log_impl(&dword_19BF1F000, v90, OS_LOG_TYPE_FAULT, "Attempting to modify the saved asset type is not permitted for asset %{public}@. From: %d to: %d", buf, 0x18u);
            }
          }
        }
      }

      v92 = [v12 objectForKeyedSubscript:@"videoKeyFrameValue"];

      if (v92)
      {
        [(PLManagedAsset *)self resetKeyFaceOnVideoKeyFrameChange];
        v93 = [v12 objectForKeyedSubscript:@"modificationDate"];

        if (!v93)
        {
          v94 = [MEMORY[0x1E695DF00] date];
          [(PLManagedAsset *)self setModificationDate:v94];
        }

        if ([(PLManagedAsset *)self isVideo]&& ![(PLManagedAsset *)self isCloudSharedAsset])
        {
          [(PLManagedAsset *)self videoKeyFrameTime];
          if ((v191 & 0x1D) == 1)
          {
            v95 = [(PLManagedAsset *)self localVideoKeyFrameResource];

            if (v95)
            {
              v96 = PLBackendGetLog();
              if (os_log_type_enabled(v96, OS_LOG_TYPE_DEBUG))
              {
                v97 = [(PLManagedAsset *)self uuid];
                *buf = 138543362;
                v195 = v97;
                _os_log_impl(&dword_19BF1F000, v96, OS_LOG_TYPE_DEBUG, "Pruning local video key frame due to media analysis key frame time change change for asset: %{public}@", buf, 0xCu);
              }

              [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
            }

            else
            {
              v102 = [PLResourceInstaller onDemand_installLocalVideoKeyFrameForAsset:self];
            }
          }

          else
          {
            v98 = PLBackendGetLog();
            if (os_log_type_enabled(v98, OS_LOG_TYPE_DEBUG))
            {
              v99 = [(PLManagedAsset *)self uuid];
              *buf = 138543362;
              v195 = v99;
              _os_log_impl(&dword_19BF1F000, v98, OS_LOG_TYPE_DEBUG, "Pruning and deleting local key frame resource due to media analysis key frame time invalidated for asset: %{public}@", buf, 0xCu);
            }

            [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
            v100 = [(PLManagedAsset *)self localVideoKeyFrameResource];
            [v100 deleteResource];
          }
        }

        [(PLManagedAsset *)self _resetMediaAnalysisStateOnEditIncludingVideo:0];
      }

      if ([(PLManagedAsset *)self _hasBecomeNonVisibleToMemoriesAndPersonsAndSuggestions:v12]&& ![(PLManagedAsset *)self isCloudSharedAsset]&& ![(PLManagedAsset *)self isPlaceholderAsset])
      {
        [(PLManagedAsset *)self fixupMemoriesWithMissingKeyAsset];
        [(PLManagedAsset *)self removeAssetFromRelatedSuggestionsAndFixupSuggestions];
      }

      v103 = [v12 objectForKeyedSubscript:@"favorite"];
      if (v103)
      {
      }

      else
      {
        v104 = [v12 objectForKeyedSubscript:@"albums"];

        if (!v104)
        {
          goto LABEL_141;
        }
      }

      [(PLManagedAsset *)self removeAssetFromUserAlbumSuggestionIfNeededWithChangedValues:v12];
      v105 = [v12 objectForKeyedSubscript:@"albums"];

      if (v105)
      {
        [(PLManagedAsset *)self _updateAlbumAssociationIfNeededWithChangedValues:v12];
      }

LABEL_141:
      v106 = [v12 objectForKeyedSubscript:@"trashedState"];
      if (v106 || ([v12 objectForKeyedSubscript:@"hidden"], (v106 = objc_claimAutoreleasedReturnValue()) != 0))
      {
      }

      else
      {
        v169 = [v12 objectForKeyedSubscript:@"dateCreated"];

        if (!v169)
        {
LABEL_145:
          v109 = [v12 objectForKeyedSubscript:@"detectedFaces"];

          if (v109)
          {
            [(PLManagedAsset *)self revalidateFaceAreaPoints];
          }

          v110 = [v12 objectForKeyedSubscript:@"trashedState"];
          if (v110)
          {
            v111 = v110;
            v112 = [(PLManagedAsset *)self trashedState];

            if (v112 == 2)
            {
              v113 = [v9 delayedSaveActions];
              [v113 recordAssetForDuetDelete:self];
            }
          }

          v114 = [v12 objectForKey:@"modernResources"];
          v115 = [v12 objectForKeyedSubscript:@"deferredProcessingNeeded"];

          v116 = v115 | v114;
          v117 = [v12 objectForKeyedSubscript:@"additionalAttributes.originalResourceChoice"];

          v118 = (v117 | v114) != 0;
          if (v116)
          {
            [(PLManagedAsset *)self recalculateImageRequestHints];
          }

          if (v118)
          {
            [(PLManagedAsset *)self recalculateRAWBadgeAttribute];
          }

          v119 = [v12 objectForKeyedSubscript:@"adjustmentTimestamp"];

          if (v119)
          {
            [(PLManagedAsset *)self _resetMediaAnalysisStateOnEditIncludingVideo:1];
            v120 = [(PLManagedAsset *)self additionalAttributes];
            v121 = [v120 hasDuplicateMatchingData];

            if (v121)
            {
              v122 = [(PLManagedAsset *)self additionalAttributes];
              [v122 setDuplicateMatchingData:0 duplicateMatchingAlternateData:0 processingSucceeded:1];
            }

            if (![(PLManagedAsset *)self isValidForPerceptualProcessing])
            {
              v123 = [(PLManagedAsset *)self uuid];
              v124 = [(PLManagedObject *)self photoLibrary];
              [PLDuplicateProcessor signalDuplicateBackgroundJobItemForAssetUUID:v123 requiresMetadataProcessing:1 library:v124];
            }
          }

          if (([(PLManagedAsset *)self isDeleted]& 1) == 0)
          {
            v125 = [(PLManagedAsset *)self mediaAnalysisAttributes];

            if (!v125)
            {
              v126 = PLBackendGetLog();
              if (os_log_type_enabled(v126, OS_LOG_TYPE_FAULT))
              {
                v127 = [(NSManagedObject *)self pl_shortDescription];
                *buf = 138412290;
                v195 = v127;
                _os_log_impl(&dword_19BF1F000, v126, OS_LOG_TYPE_FAULT, "mediaAnalysisAttributes is unexpectedly nil: %@", buf, 0xCu);
              }
            }
          }

          v128 = [v12 objectForKeyedSubscript:@"mediaAnalysisAttributes"];

          if (v128)
          {
            v129 = PLBackendGetLog();
            if (os_log_type_enabled(v129, OS_LOG_TYPE_DEBUG))
            {
              *buf = 0;
              _os_log_impl(&dword_19BF1F000, v129, OS_LOG_TYPE_DEBUG, "Pruning local video key frame due to media analysis attributes relationship change", buf, 2u);
            }

            [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
          }

          [(PLManagedAsset *)self ensurePlaybackStyleConsistencyWithKindSubtype:v12];
          v130 = [(PLManagedObject *)self photoLibrary];
          v131 = [v130 libraryServicesManager];

          if ([v131 wellKnownPhotoLibraryIdentifier] == 3 && (-[PLManagedAsset isDeleted](self, "isDeleted") & 1) == 0)
          {
            v132 = v114;
            v193[0] = @"savedAssetType";
            v193[1] = @"syndicationState";
            v133 = [MEMORY[0x1E695DEC8] arrayWithObjects:v193 count:2];
            v134 = [(PLManagedAsset *)self committedValuesForKeys:v133];

            v135 = objc_opt_class();
            v136 = [v134 objectForKeyedSubscript:@"savedAssetType"];
            v137 = [v136 integerValue];
            v138 = [v134 objectForKeyedSubscript:@"syndicationState"];
            LODWORD(v135) = [v135 shouldSyncAssetToSPLWithSavedAssetType:v137 syndicationState:{objc_msgSend(v138, "integerValue")}];

            if (v135 != [(PLManagedAsset *)self shouldSyncToSPL])
            {
              v139 = [(PLManagedObject *)self photoLibrary];
              v140 = [(PLManagedAsset *)self uuid];
              v141 = [v139 addBackgroundJobWorkItemIfNeededWithIdentifier:v140 jobType:0 jobFlags:1];

              if (v141)
              {
                v142 = PLSyndicationGetLog();
                if (os_log_type_enabled(v142, OS_LOG_TYPE_DEBUG))
                {
                  v143 = [(PLManagedAsset *)self uuid];
                  v144 = [(PLManagedAsset *)self shouldSyncToSPL];
                  v145 = @"should not";
                  if (v144)
                  {
                    v145 = @"should";
                  }

                  *buf = 138412546;
                  v195 = v143;
                  v196 = 2112;
                  *v197 = v145;
                  _os_log_impl(&dword_19BF1F000, v142, OS_LOG_TYPE_DEBUG, "GuestAssetSync: property changes to asset: %@ indicate %@ sync to SPL, triggering update", buf, 0x16u);
                }

                v146 = [v131 backgroundJobService];
                v147 = [(PLManagedObject *)self photoLibrary];
                v148 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:0];
                [v146 signalBackgroundProcessingNeededOnLibrary:v147 workerTypes:v148];
              }
            }

            v114 = v132;
          }

          if ([(PLManagedAsset *)self shouldPurgeSyndicationResourcesWithChangedValues:v12])
          {
            [(PLManagedAsset *)self purgeSyndicationResourcesAfterMediaAnalysisProcessing];
          }

          if (PLPlatformMomentsSupported())
          {
            v149 = [v9 delayedSaveActions];
            [v149 recordAssetForMomentUpdate:self];
          }

          if (PLPlatformCloudFeedSupported())
          {
            v150 = [v9 delayedSaveActions];
            [v150 recordAssetForCloudFeedUpdate:self];
          }

          if (([(PLManagedAsset *)self isDeleted]& 1) == 0)
          {
            [PLDelayedSearchIndexUpdates recordAssetIfNeeded:self];
          }

          [v9 recordAvalancheUUIDForUpdate:self];
          v151 = [(PLManagedObject *)self photoLibrary];
          v152 = [v151 libraryServicesManager];
          v153 = [v152 modelMigrator];
          if ([v153 isPostProcessingLightweightMigration])
          {
          }

          else
          {
            v154 = v9;
            v155 = v131;
            v156 = v114;
            v157 = [(PLManagedObject *)self photoLibrary];
            v158 = [v157 thumbnailManager];
            if (([v158 isRebuildingThumbnails] & 1) != 0 || !PLCameraPreviewWellSupportedOnCurrentDevice())
            {

              v114 = v156;
              v131 = v155;
              v9 = v154;
            }

            else
            {
              v188 = [(PLManagedAsset *)self isInserted];

              v114 = v156;
              v131 = v155;
              v9 = v154;
              if (v188 & 1) != 0 || ([v154 userInfo], v159 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v159, "objectForKeyedSubscript:", @"com.apple.photos.PLCameraPreviewWellNeedsUpdate"), v160 = objc_claimAutoreleasedReturnValue(), v161 = objc_msgSend(v160, "BOOLValue"), v160, v159, (v161) || (-[PLManagedObject photoLibrary](self, "photoLibrary"), v162 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v162, "libraryServicesManager"), v163 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v163, "cameraPreviewWellManager"), v164 = objc_claimAutoreleasedReturnValue(), v165 = objc_msgSend(v164, "shouldReconsiderCameraPreviewWellImageForUpdatedAsset:thumbnailWasGenerated:", self, 0), v164, v163, v162, !v165))
              {
LABEL_196:
                if (_os_feature_enabled_impl())
                {
                  if (([(PLManagedAsset *)self isDeleted]& 1) == 0)
                  {
                    if (PLPlatformMomentsSupported())
                    {
                      v166 = [(PLManagedAsset *)self highlightBeingExtendedAssets];
                      if (v166)
                      {
                        v167 = v166;
                        v168 = [v12 objectForKeyedSubscript:@"dateCreated"];
                        if (v168)
                        {

                          goto LABEL_205;
                        }

                        v170 = [v12 objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

                        if (v170)
                        {
LABEL_205:
                          v171 = [(PLManagedAsset *)self highlightBeingExtendedAssets];
                          v172 = [v171 kind];

                          if (!v172)
                          {
                            v173 = [(PLManagedAsset *)self highlightBeingExtendedAssets];
                            [v173 recalculateCollageAssets];
                          }
                        }
                      }
                    }
                  }
                }

                v174 = [v12 objectForKeyedSubscript:@"activeLibraryScopeParticipationState"];

                if (v174)
                {
                  v175 = [(PLManagedObject *)self photoLibrary];
                  v176 = [(PLManagedAsset *)self uuid];
                  v177 = [v175 addBackgroundJobWorkItemIfNeededWithIdentifier:v176 jobType:9 jobFlags:1];

                  if (v177)
                  {
                    v178 = [(PLManagedObject *)self photoLibrary];
                    v179 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:9];
                    [v178 signalBackgroundProcessingNeededForWorkerTypes:v179];
                  }
                }

                if (v189)
                {
                  [v189 popChangeScopesBatch];
                }

                v6 = v190;
                goto LABEL_213;
              }

              v151 = [v9 userInfo];
              [v151 setObject:MEMORY[0x1E695E118] forKeyedSubscript:@"com.apple.photos.PLCameraPreviewWellNeedsUpdate"];
            }
          }

          goto LABEL_196;
        }
      }

      v107 = [v9 delayedSaveActions];
      [v107 recordAssetForAlbumCountsDateRangeAndKeyAssetsUpdate:self];

      v108 = [v9 delayedSaveActions];
      [v108 recordAssetForImportSessionCountsAndDateRangeUpdate:self];

      goto LABEL_145;
    }

    v181 = v45;
    v47 = [(PLManagedAsset *)self persistedFileSystemAttributesFileURL];
    if (!v47 || ![(PLManagedAsset *)self isValidTypeForPersistence])
    {
LABEL_96:

      goto LABEL_97;
    }

    v180 = v37;
    v48 = [MEMORY[0x1E69BF230] filesystemPersistenceBatchItemForFileAtURL:v47];
    if (v186)
    {
      v49 = [(PLManagedAsset *)self avalancheKind];
      if (v49 < 2)
      {
        v187 = [(PLManagedAsset *)self avalancheUUID];
        [v48 setUUIDString:v187 forKey:*MEMORY[0x1E69BFD20]];

        v50 = [(PLManagedAsset *)self avalanchePickType];
LABEL_68:
        [v48 setUInt16:v50 forKey:*MEMORY[0x1E69BFD18]];
        goto LABEL_69;
      }

      if (v49 == 2)
      {
        v50 = 0;
        goto LABEL_68;
      }
    }

LABEL_69:
    if (v32)
    {
      v51 = [(PLManagedAsset *)self hidden];
      [v48 setUInt16:v51 forKey:*MEMORY[0x1E69BFD88]];
    }

    if (v33)
    {
      v52 = [(PLManagedAsset *)self favorite];
      [v48 setUInt16:v52 forKey:*MEMORY[0x1E69BFD80]];
    }

    if (v34)
    {
      v53 = [(PLManagedAsset *)self isInTrash];
      [v48 setUInt16:v53 forKey:*MEMORY[0x1E69BFE58]];
    }

    if (v183)
    {
      v54 = [(PLManagedAsset *)self deferredProcessingNeeded];
      [v48 setUInt16:v54 forKey:*MEMORY[0x1E69BFD60]];
    }

    if (self->_setCustomCreationDate)
    {
      [(PLManagedAsset *)self dateCreatedData];
      v56 = v55 = v35;
      [v48 setData:v56 forKey:*MEMORY[0x1E69BFD40]];

      v35 = v55;
    }

    if (self->_setCustomLocation)
    {
      [(PLManagedAsset *)self locationData];
      v58 = v57 = v35;
      [v48 setData:v58 forKey:*MEMORY[0x1E69BFD48]];

      v35 = v57;
    }

    if (v35)
    {
      v59 = [(PLManagedAsset *)self addedDateData];
      [v48 setData:v59 forKey:*MEMORY[0x1E69BFD08]];
    }

    if (v185)
    {
      v60 = [(PLManagedAsset *)self cloudAssetGUID];
      [v48 setString:v60 forKey:*MEMORY[0x1E69BFD28]];
    }

    if (v180)
    {
      v61 = [(PLManagedAsset *)self _mediaGroupUUIDForPersistence];
      [v48 setString:v61 forKey:*MEMORY[0x1E69BFDE0]];
    }

    if (v184)
    {
      v62 = [(PLManagedAsset *)self videoComplementData];
      [v48 setData:v62 forKey:*MEMORY[0x1E69BFD78]];
    }

    if (v44)
    {
      v63 = [(PLManagedAsset *)self videoCpVisibilityState];
      [v48 setUInt16:v63 forKey:*MEMORY[0x1E69BFE70]];
    }

    if (v182)
    {
      v64 = [(PLManagedAsset *)self libraryScopeShareState];
      [v48 setUInt64:v64 forKey:*MEMORY[0x1E69BFDD8]];
    }

    if (v181)
    {
      v65 = [(PLManagedAsset *)self trashedReason];
      [v48 setUInt16:v65 forKey:*MEMORY[0x1E69BFE60]];
    }

    [v48 persist];

    goto LABEL_96;
  }

LABEL_213:

LABEL_214:
}

- (void)recalculateIsRecentlySaved
{
  v3 = [MEMORY[0x1E696AD98] numberWithShort:{-[PLManagedAsset importedBy](self, "importedBy")}];
  v4 = [&unk_1F0FBF448 containsObject:v3];

  v5 = [(PLManagedAsset *)self importedByBundleIdentifier];
  v6 = [v5 isEqualToString:@"com.apple.camera.CameraMessagesApp"];

  v7 = [MEMORY[0x1E696AD98] numberWithBool:((v6 | v4) & 1) == 0];
  [(PLManagedObject *)self pl_safeSetValue:v7 forKey:@"isRecentlySaved" valueDidChangeHandler:0];
}

- (void)recalculateIsDetectedScreenshot
{
  v21 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self kind]&& [(PLManagedAsset *)self kind]!= 1)
  {
    v15 = 0;
LABEL_28:
    v17 = [MEMORY[0x1E696AD98] numberWithBool:v15];
    [(PLManagedObject *)self pl_safeSetValue:v17 forKey:@"isDetectedScreenshot" valueDidChangeHandler:0];

    [(PLManagedAsset *)self setDetectedScreenshotBadgeAttribute:v15];
    return;
  }

  if (![(PLManagedAsset *)self kind])
  {
    if ([(PLManagedAsset *)self kindSubtype]!= 10)
    {
      goto LABEL_6;
    }

    goto LABEL_17;
  }

  if ([(PLManagedAsset *)self kind]== 1 && [(PLManagedAsset *)self kindSubtype]== 103)
  {
LABEL_17:
    v15 = 1;
    goto LABEL_28;
  }

LABEL_6:
  v3 = [(PLManagedObject *)self photoLibrary];
  v18 = [v3 libraryServicesManager];

  v4 = v18;
  if (!v18 || (v5 = [v18 isSearchIndexingEnabled], v4 = v18, v5))
  {
    v6 = [v4 searchIndexingEngine];
    v7 = [v6 configuration];
    v8 = [v7 sceneTaxonomyProvider];

    if (v18 && !v8)
    {
      v9 = PLBackendGetLog();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_FAULT))
      {
        v10 = [v18 searchIndexingEngine];
        *buf = 138543362;
        v20 = v10;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_FAULT, "configuration.sceneTaxonomyProvider nil on searchIndexingEngine: %{public}@", buf, 0xCu);
      }
    }

    v11 = [PLUtilityAsset utilityAssetFromManagedAsset:self usingPool:0];
    v12 = [v8 searchIndexSceneTaxonomyForSceneAnalysisVersion:{objc_msgSend(v11, "sceneAnalysisVersion")}];
    v13 = objc_alloc(MEMORY[0x1E69C1A38]);
    if (v12)
    {
      v14 = [v13 initWithSceneTaxonomy:v12];
    }

    else
    {
      v14 = [v13 initWithSceneAnalysisVersion:{objc_msgSend(v11, "sceneAnalysisVersion")}];
    }

    v16 = v14;
    v15 = 0;
    if (v11 && v14)
    {
      if (objc_opt_class())
      {
        v15 = [MEMORY[0x1E69C1AC0] screenshotInferredInAsset:v11 usingSceneModel:v16];
      }

      else
      {
        v15 = 0;
      }
    }

    goto LABEL_28;
  }
}

- (BOOL)_checkForAndAddFrameDropRecoveryForPhotoKitIngest
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    return 0;
  }

  v4 = [(PLManagedAsset *)self importedBy]!= 1 && [(PLManagedAsset *)self importedBy]!= 2;
  v5 = [objc_alloc(MEMORY[0x1E695E000]) initWithSuiteName:@"com.apple.mobileslideshow"];
  v6 = [v5 BOOLForKey:@"PLFrameDropRecoveryEnableOnOlderDevices"];
  v3 = ((PLPlatformIsFrameDropRecoverySupported() & 1) != 0 || v6) && [(PLManagedAsset *)self videoDeferredProcessingNeeded]== 0 && !v4;

  return v3;
}

- (void)ensurePlaybackStyleConsistencyWithKindSubtype:(id)a3
{
  v14[1] = *MEMORY[0x1E69E9840];
  v4 = [a3 objectForKeyedSubscript:@"kindSubtype"];

  if (v4)
  {
    v14[0] = @"kindSubtype";
    v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v14 count:1];
    v6 = [(PLManagedAsset *)self committedValuesForKeys:v5];

    v7 = [v6 objectForKey:@"kindSubtype"];
    v8 = [v7 shortValue];

    if ([(PLManagedAsset *)self kindSubtype]|| v8 != 2)
    {
      goto LABEL_12;
    }

    [(PLManagedObject *)self pl_safeSetValue:&unk_1F0FBB0C8 forKey:@"playbackStyle" valueDidChangeHandler:0];
    if (-[PLManagedAsset sensitivityAnalysisState](self, "sensitivityAnalysisState") == 2 && (-[PLManagedAsset collectionShareContributor](self, "collectionShareContributor"), (v9 = objc_claimAutoreleasedReturnValue()) != 0) && (v10 = v9, -[PLManagedAsset collectionShareContributor](self, "collectionShareContributor"), v11 = objc_claimAutoreleasedReturnValue(), v12 = [v11 isCurrentUser], v11, v10, (v12 & 1) != 0) || -[PLManagedAsset sensitivityAnalysisState](self, "sensitivityAnalysisState") == 3)
    {
      v13 = 1;
    }

    else
    {
      if ([(PLManagedAsset *)self sensitivityAnalysisState]!= 2)
      {
LABEL_12:

        return;
      }

      [(PLManagedAsset *)self setCompactSCSensitivityAnalysis:0];
      v13 = 0;
    }

    [(PLManagedAsset *)self setSensitivityAnalysisState:v13];
    goto LABEL_12;
  }
}

- (void)_reloadWidgetTimelineIfNeeded
{
  v41 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    v4 = [(PLManagedAsset *)self suggestionsBeingKeyAssets];
    v5 = [v4 copy];

    v6 = [v5 countByEnumeratingWithState:&v33 objects:v40 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v34;
LABEL_4:
      v9 = 0;
      while (1)
      {
        if (*v34 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v33 + 1) + 8 * v9);
        if ([v10 featuredState] == 1)
        {
          break;
        }

        if (v7 == ++v9)
        {
          v7 = [v5 countByEnumeratingWithState:&v33 objects:v40 count:16];
          if (v7)
          {
            goto LABEL_4;
          }

          goto LABEL_10;
        }
      }

      v12 = [v10 type];
      v11 = v12 != 6;
      if (v12 == 6)
      {
        v14 = [v3 delayedSaveActions];
        v16 = [v10 uuid];
        [v14 recordWallpaperSuggestionReloadForUUID:v16];
        goto LABEL_16;
      }

      v13 = [v10 type];
      v14 = PLBackendGetLog();
      v15 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
      if (v13 == 7)
      {
        if (!v15)
        {
LABEL_17:

          goto LABEL_18;
        }

        v16 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v39 = v16;
        _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_INFO, "Recording Album widget timeline invalidation due to asset with featured suggestion being adjusted %{public}@", buf, 0xCu);
LABEL_16:

        goto LABEL_17;
      }

      if (v15)
      {
        v27 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v39 = v27;
        _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_INFO, "Recording ForYou widget timeline invalidation due to asset with featured suggestion being adjusted %{public}@", buf, 0xCu);
      }

      v26 = 0;
    }

    else
    {
LABEL_10:
      v11 = 0;
LABEL_18:

      v31 = 0u;
      v32 = 0u;
      v29 = 0u;
      v30 = 0u;
      v17 = [(PLManagedAsset *)self memoriesBeingKeyAsset];
      v18 = [v17 copy];

      v19 = [v18 countByEnumeratingWithState:&v29 objects:v37 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v30;
LABEL_20:
        v22 = 0;
        while (1)
        {
          if (*v30 != v21)
          {
            objc_enumerationMutation(v18);
          }

          if ([*(*(&v29 + 1) + 8 * v22) featuredState] == 1)
          {
            break;
          }

          if (v20 == ++v22)
          {
            v20 = [v18 countByEnumeratingWithState:&v29 objects:v37 count:16];
            if (v20)
            {
              goto LABEL_20;
            }

            goto LABEL_26;
          }
        }

        v23 = PLBackendGetLog();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          v24 = [(PLManagedAsset *)self uuid];
          *buf = 138543362;
          v39 = v24;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_INFO, "Recording ForYou widget timeline invalidation due to key asset with featured memory being adjusted %{public}@", buf, 0xCu);
        }

        v25 = [v3 delayedSaveActions];
        [v25 recordWidgetTimelineReloadNeededForType:0];

        if (!v11)
        {
          goto LABEL_36;
        }
      }

      else
      {
LABEL_26:

        if (!v11)
        {
          goto LABEL_36;
        }
      }

      v26 = 1;
    }

    v28 = [v3 delayedSaveActions];
    [v28 recordWidgetTimelineReloadNeededForType:v26];
  }

LABEL_36:
}

- (void)_clearStickerConfidenceAttributes
{
  v3 = [(PLManagedAsset *)self mediaAnalysisAttributes];
  [v3 pl_safeSetValue:&unk_1F0FBB0B0 forKey:@"visualSearchStickerConfidenceVersion" valueDidChangeHandler:0];
  [(PLManagedObject *)self pl_safeSetValue:&unk_1F0FC0880 forKey:@"stickerConfidenceScore" valueDidChangeHandler:0];
}

- (void)_clearOverallAestheticScore
{
  [(PLManagedAsset *)self overallAestheticScore];
  if (*&v3 != 0.5)
  {
    LODWORD(v3) = 0.5;

    [(PLManagedAsset *)self setOverallAestheticScore:v3];
  }
}

- (void)_clearAcceptableCropRect
{
  if ([(PLManagedAsset *)self packedAcceptableCropRect])
  {

    [(PLManagedAsset *)self setPackedAcceptableCropRect:0];
  }
}

- (void)_clearPreferredCropRect
{
  if ([(PLManagedAsset *)self packedPreferredCropRect])
  {

    [(PLManagedAsset *)self setPackedPreferredCropRect:0];
  }
}

- (void)_deleteComputedAttributes
{
  v5 = [(PLManagedAsset *)self managedObjectContext];
  v3 = [(PLManagedAsset *)self computedAttributes];

  if (v3)
  {
    v4 = [(PLManagedAsset *)self computedAttributes];
    [v5 deleteObject:v4];
  }
}

- (void)_updateAlbumAssociationIfNeeded
{
  v12 = *MEMORY[0x1E69E9840];
  v7 = 0u;
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v3 = [(PLManagedAsset *)self albums];
  v4 = [v3 countByEnumeratingWithState:&v7 objects:v11 count:16];
  if (v4)
  {
    v5 = *v8;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v8 != v5)
        {
          objc_enumerationMutation(v3);
        }

        if ([*(*(&v7 + 1) + 8 * i) supportsAssetAssociativity])
        {
          v4 = 1;
          goto LABEL_11;
        }
      }

      v4 = [v3 countByEnumeratingWithState:&v7 objects:v11 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  if ([(PLManagedAsset *)self albumAssociativity]!= v4)
  {
    [(PLManagedAsset *)self setAlbumAssociativity:v4];
  }
}

- (void)_updateAlbumAssociationIfNeededWithChangedValues:(id)a3
{
  v4 = [a3 objectForKeyedSubscript:@"albumAssociativity"];

  if (!v4)
  {

    [(PLManagedAsset *)self _updateAlbumAssociationIfNeeded];
  }
}

- (void)removeAssetFromUserAlbumSuggestionIfNeededWithChangedValues:(id)a3
{
  v38[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [v4 objectForKeyedSubscript:@"favorite"];
    if (v6)
    {
      v7 = v6;
      v8 = [(PLManagedAsset *)self favorite];

      if ((v8 & 1) == 0)
      {
        v9 = [v5 delayedSaveActions];
        v10 = [(PLManagedAsset *)self objectID];
        [v9 recordAssetIDForWidgetFavoriteAlbumRemoval:v10];

        v11 = [v5 delayedSaveActions];
        v12 = [(PLManagedAsset *)self objectID];
        [v11 recordAssetIDForWallpaperFavoriteAlbumRemoval:v12];
      }
    }

    v13 = [v4 objectForKeyedSubscript:@"albums"];

    if (v13)
    {
      v38[0] = @"albums";
      v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v38 count:1];
      v15 = [(PLManagedAsset *)self committedValuesForKeys:v14];

      v16 = [v15 objectForKey:@"albums"];
      v17 = [(PLManagedAsset *)self albums];
      v18 = [v16 mutableCopy];
      [v18 minusSet:v17];
      if ([v18 count])
      {
        v30 = v17;
        v31 = v16;
        v32 = v15;
        v35 = 0u;
        v36 = 0u;
        v33 = 0u;
        v34 = 0u;
        v29 = v18;
        v19 = v18;
        v20 = [v19 countByEnumeratingWithState:&v33 objects:v37 count:16];
        if (v20)
        {
          v21 = v20;
          v22 = *v34;
          do
          {
            for (i = 0; i != v21; ++i)
            {
              if (*v34 != v22)
              {
                objc_enumerationMutation(v19);
              }

              v24 = *(*(&v33 + 1) + 8 * i);
              if (([v24 isDeleted] & 1) == 0)
              {
                v25 = [v5 delayedSaveActions];
                v26 = [(PLManagedAsset *)self objectID];
                [v25 recordAssetID:v26 forWidgetUserAlbumRemoval:v24];

                v27 = [v5 delayedSaveActions];
                v28 = [(PLManagedAsset *)self objectID];
                [v27 recordAssetID:v28 forWallpaperUserAlbumRemoval:v24];
              }
            }

            v21 = [v19 countByEnumeratingWithState:&v33 objects:v37 count:16];
          }

          while (v21);
        }

        v16 = v31;
        v15 = v32;
        v18 = v29;
        v17 = v30;
      }
    }
  }
}

- (void)_removeKeyAssetFromSuggestions:(id)a3
{
  v31 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_31;
  }

  v26 = 0u;
  v27 = 0u;
  v24 = 0u;
  v25 = 0u;
  v6 = [v4 copy];
  v7 = [v6 countByEnumeratingWithState:&v24 objects:v30 count:16];
  if (!v7)
  {
    goto LABEL_30;
  }

  v8 = v7;
  v22 = v4;
  v23 = 0;
  v9 = *v25;
  do
  {
    for (i = 0; i != v8; ++i)
    {
      if (*v25 != v9)
      {
        objc_enumerationMutation(v6);
      }

      v11 = *(*(&v24 + 1) + 8 * i);
      [v11 replaceKeyAsset:self];
      if ([v11 isEmpty])
      {
        v12 = PLBackendGetLog();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v29 = v11;
          _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_INFO, "Deleting suggestion %@ due to it containing no more assets", buf, 0xCu);
        }

        [v5 deleteObject:v11];
      }

      else
      {
        v13 = [v5 photoLibrary];
        [v11 updateCachedCounts:v13];
      }

      if ([v11 featuredState] == 1)
      {
        if ([v11 type] == 6)
        {
          v14 = [v5 delayedSaveActions];
          v15 = [v11 uuid];
          [v14 recordWallpaperSuggestionReloadForUUID:v15];
        }

        else
        {
          v16 = [v11 type];
          v14 = PLBackendGetLog();
          v17 = os_log_type_enabled(v14, OS_LOG_TYPE_INFO);
          if (v16 == 7)
          {
            if (!v17)
            {
              BYTE4(v23) = 1;
              goto LABEL_23;
            }

            v18 = [v11 uuid];
            *buf = 138543362;
            v29 = v18;
            BYTE4(v23) = 1;
            v19 = v14;
            v20 = "Recording Album widget timeline invalidation due to featured suggestion's %{public}@ key asset being removed";
          }

          else
          {
            if (!v17)
            {
              LOBYTE(v23) = 1;
              goto LABEL_23;
            }

            v18 = [v11 uuid];
            *buf = 138543362;
            v29 = v18;
            LOBYTE(v23) = 1;
            v19 = v14;
            v20 = "Recording ForYou widget timeline invalidation due to featured suggestion's %{public}@ key asset being removed";
          }

          _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_INFO, v20, buf, 0xCu);
        }

LABEL_23:

        continue;
      }
    }

    v8 = [v6 countByEnumeratingWithState:&v24 objects:v30 count:16];
  }

  while (v8);

  if (v23)
  {
    v21 = [v5 delayedSaveActions];
    [v21 recordWidgetTimelineReloadNeededForType:0];
  }

  v4 = v22;
  if ((v23 & 0x100000000) != 0)
  {
    v6 = [v5 delayedSaveActions];
    [v6 recordWidgetTimelineReloadNeededForType:1];
LABEL_30:
  }

LABEL_31:
}

- (void)removeAssetFromRelatedSuggestionsAndFixupSuggestions
{
  v19 = *MEMORY[0x1E69E9840];
  v3 = objc_autoreleasePoolPush();
  v4 = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v16 = 0u;
    v17 = 0u;
    v14 = 0u;
    v15 = 0u;
    v5 = [(PLManagedAsset *)self suggestionsBeingRepresentativeAssets];
    v6 = [v5 copy];

    v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v15;
      do
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v15 != v9)
          {
            objc_enumerationMutation(v6);
          }

          v11 = *(*(&v14 + 1) + 8 * i);
          [v11 removeRepresentativeAsset:self];
          v12 = [v4 photoLibrary];
          [v11 updateCachedCounts:v12];
        }

        v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
      }

      while (v8);
    }

    v13 = [(PLManagedAsset *)self suggestionsBeingKeyAssets];
    [(PLManagedAsset *)self _removeKeyAssetFromSuggestions:v13];
  }

  objc_autoreleasePoolPop(v3);
}

- (void)resetKeyFaceOnVideoKeyFrameChange
{
  v22 = *MEMORY[0x1E69E9840];
  context = objc_autoreleasePoolPush();
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v3 = [(PLManagedAsset *)self detectedFaces];
  v4 = [v3 countByEnumeratingWithState:&v13 objects:v21 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v14;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = [*(*(&v13 + 1) + 8 * i) personBeingKeyFace];
        if (v8)
        {
          v9 = PLBackendGetLog();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
          {
            v10 = [(PLManagedAsset *)self uuid];
            v11 = [v8 personUUID];
            *buf = 138543618;
            v18 = v10;
            v19 = 2114;
            v20 = v11;
            _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Video key frame change on asset %{public}@: Resetting key face for person %{public}@", buf, 0x16u);
          }

          [v8 setKeyFace:0 pickSource:0];
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v13 objects:v21 count:16];
    }

    while (v5);
  }

  objc_autoreleasePoolPop(context);
}

- (void)fixupMemoriesWithMissingKeyAsset
{
  v39 = *MEMORY[0x1E69E9840];
  v3 = objc_autoreleasePoolPush();
  v4 = [(PLManagedAsset *)self managedObjectContext];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) != 0 && ![v4 resetCloudLibraryMode])
  {
    v25 = v3;
    v5 = [MEMORY[0x1E695DFA8] set];
    v6 = [MEMORY[0x1E695DF70] array];
    v7 = [MEMORY[0x1E695DF70] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v24 = self;
    v8 = [(PLManagedAsset *)self memoriesBeingKeyAsset];
    v9 = [v8 countByEnumeratingWithState:&v28 objects:v38 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(v8);
          }

          v13 = *(*(&v28 + 1) + 8 * i);
          v14 = [v13 calculateKeyAsset];
          if (v14)
          {
            [v6 addObject:v13];
            v15 = v7;
            v16 = v14;
          }

          else
          {
            v15 = v5;
            v16 = v13;
          }

          [v15 addObject:v16];
        }

        v10 = [v8 countByEnumeratingWithState:&v28 objects:v38 count:16];
      }

      while (v10);
    }

    if ([v6 count])
    {
      v17 = 0;
      do
      {
        v18 = [v6 objectAtIndexedSubscript:v17];
        v19 = [v7 objectAtIndexedSubscript:v17];
        v20 = PLBackendGetLog();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          *buf = 138412802;
          v33 = v18;
          v34 = 2112;
          v35 = v24;
          v36 = 2112;
          v37 = v19;
          _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_INFO, "Updating keyAsset for memory %@ from %@ to %@", buf, 0x20u);
        }

        [v18 setKeyAsset:v19];
        if ([v18 featuredState] == 1)
        {
          v21 = [v4 delayedSaveActions];
          [v21 recordWidgetTimelineReloadNeededForType:0];

          v22 = PLBackendGetLog();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            v23 = [v18 uuid];
            *buf = 138543362;
            v33 = v23;
            _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Recording ForYou widget timeline invalidation due to memory %{public}@ keyAsset update", buf, 0xCu);
          }
        }

        ++v17;
      }

      while ([v6 count] > v17);
    }

    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __50__PLManagedAsset_fixupMemoriesWithMissingKeyAsset__block_invoke;
    v26[3] = &unk_1E756B088;
    v27 = v4;
    [v5 enumerateObjectsUsingBlock:v26];

    v3 = v25;
  }

  objc_autoreleasePoolPop(v3);
}

void __50__PLManagedAsset_fixupMemoriesWithMissingKeyAsset__block_invoke(uint64_t a1, void *a2)
{
  v7 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = PLBackendGetLog();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v5 = 138412290;
    v6 = v3;
    _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_INFO, "Deleting memory %@ due to no key asset found", &v5, 0xCu);
  }

  [*(a1 + 32) deleteObject:v3];
}

- (BOOL)_hasBecomeNonVisibleToMemoriesAndPersonsAndSuggestions:(id)a3
{
  v4 = a3;
  if (-[PLManagedAsset isDeleted](self, "isDeleted") & 1) != 0 || ([v4 objectForKeyedSubscript:@"trashedState"], v5 = objc_claimAutoreleasedReturnValue(), v5, v5) && (objc_msgSend(v4, "objectForKey:", @"trashedState"), v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(v6, "intValue"), v6, v7) || (objc_msgSend(v4, "objectForKeyedSubscript:", @"hidden"), v8 = objc_claimAutoreleasedReturnValue(), v8, v8) && (objc_msgSend(v4, "objectForKey:", @"hidden"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v9, "BOOLValue"), v9, (v10))
  {
    LOBYTE(v11) = 1;
  }

  else
  {
    v13 = [v4 objectForKeyedSubscript:@"avalanchePickType"];

    if (v13)
    {
      v14 = [v4 objectForKey:@"avalanchePickType"];
      v11 = !-[PLManagedAsset _isVisibleAvalanchePickType:](self, "_isVisibleAvalanchePickType:", [v14 intValue]);
    }

    else
    {
      LOBYTE(v11) = 0;
    }
  }

  return v11;
}

- (void)_updateOriginalResourceChoice
{
  v16 = [(PLManagedAsset *)self additionalAttributes];
  if ([(PLManagedAsset *)self isPhoto]&& [(PLManagedAsset *)self hasAdjustments])
  {
    v3 = [v16 unmanagedAdjustment];
    v4 = v3;
    if (v3 && ([v3 adjustmentBaseImageFormat], v5 = objc_claimAutoreleasedReturnValue(), v6 = objc_msgSend(v5, "integerValue"), v5, v6))
    {
      v7 = 0;
    }

    else
    {
      v8 = [(PLManagedAsset *)self mainFileURL];
      v9 = [v8 pathExtension];
      v10 = [PLManagedAsset uniformTypeIdentifierFromPathExtension:v9 assetType:[(PLManagedAsset *)self kind]];

      if (v10)
      {
        v11 = [MEMORY[0x1E6982C40] typeWithIdentifier:v10];
        v12 = [v11 conformsToType:*MEMORY[0x1E6982F88]];

        if (v12)
        {
          v7 = 3;
        }

        else
        {
          v7 = 0;
        }
      }

      else
      {
        v7 = 0;
      }
    }
  }

  else
  {
    v7 = 0;
  }

  v13 = [v16 originalResourceChoice];
  v14 = [v13 unsignedIntegerValue];

  if (v7 != v14)
  {
    v15 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v7];
    [v16 setOriginalResourceChoice:v15];
  }
}

- (void)reevaluateCameraProcessingAdjustmentState
{
  v4 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_573];
  if (v4)
  {
    v3 = [(PLManagedAsset *)self cameraProcessingAdjustmentState]| 1;
  }

  else
  {
    v3 = 0;
  }

  [(PLManagedAsset *)self setCameraProcessingAdjustmentState:v3];
}

BOOL __59__PLManagedAsset_reevaluateCameraProcessingAdjustmentState__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 version])
  {
    v3 = 0;
  }

  else
  {
    v3 = [v2 resourceType] == 10 || objc_msgSend(v2, "resourceType") == 11;
  }

  return v3;
}

- (BOOL)setTrashedState:(signed __int16)a3 forResourceType:(unint64_t)a4
{
  v5 = a3;
  v21 = *MEMORY[0x1E69E9840];
  v7 = [(PLManagedAsset *)self masterResourceForCPLType:a4];
  v8 = v7;
  if (v7 && [v7 supportsTrashedState])
  {
    v9 = PLBackendGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = [(PLManagedAsset *)self uuid];
      v11 = [v8 objectID];
      v12 = [MEMORY[0x1E6994B90] descriptionForResourceType:a4];
      v19 = 67109890;
      *v20 = v5;
      *&v20[4] = 2114;
      *&v20[6] = v10;
      *&v20[14] = 2112;
      *&v20[16] = v11;
      *&v20[24] = 2112;
      *&v20[26] = v12;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_INFO, "Setting resource trashedState to %i for asset %{public}@, resource %@, cplType %@", &v19, 0x26u);
    }

    [v8 applyTrashedState:v5];
    v13 = 1;
  }

  else
  {
    v14 = PLBackendGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v15 = [(PLManagedAsset *)self uuid];
      if (v8)
      {
        v16 = [v8 objectID];
      }

      else
      {
        v16 = @"<no master resource for cplType>";
      }

      v17 = [MEMORY[0x1E6994B90] descriptionForResourceType:a4];
      v19 = 138543874;
      *v20 = v15;
      *&v20[8] = 2112;
      *&v20[10] = v16;
      *&v20[18] = 2112;
      *&v20[20] = v17;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Resource does not support trashedState %{public}@, resource %@, cplType %@", &v19, 0x20u);
      if (v8)
      {
      }
    }

    v13 = 0;
  }

  return v13;
}

- (void)expungeTrashedSpatialOverCaptureResources
{
  v13 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self persistedResourcesMatching:&__block_literal_global_568];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v9;
    do
    {
      v7 = 0;
      do
      {
        if (*v9 != v6)
        {
          objc_enumerationMutation(v3);
        }

        -[PLManagedAsset setTrashedState:forResourceType:](self, "setTrashedState:forResourceType:", 2, [*(*(&v8 + 1) + 8 * v7++) cplType]);
      }

      while (v5 != v7);
      v5 = [v3 countByEnumeratingWithState:&v8 objects:v12 count:16];
    }

    while (v5);
  }
}

BOOL __59__PLManagedAsset_expungeTrashedSpatialOverCaptureResources__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 version] && (objc_msgSend(v2, "resourceType") == 10 || objc_msgSend(v2, "resourceType") == 11) && objc_msgSend(v2, "trashedState") != 0;

  return v3;
}

- (BOOL)setTrashedStateOnSpatialOverCaptureResources:(signed __int16)a3
{
  v3 = a3;
  v13 = *MEMORY[0x1E69E9840];
  if (setTrashedStateOnSpatialOverCaptureResources__onceToken != -1)
  {
    dispatch_once(&setTrashedStateOnSpatialOverCaptureResources__onceToken, &__block_literal_global_565);
  }

  if (v3 == 1 && (setTrashedStateOnSpatialOverCaptureResources__ignoreSOCSetTrashedStateChange & 1) != 0)
  {
    v5 = PLBackendGetLog();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = [(PLManagedAsset *)self uuid];
      v9 = 138412546;
      v10 = @"PLIgnoreSOCPrune";
      v11 = 2114;
      v12 = v6;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_INFO, "ignoring setTrashedState for SOC resources: %@ = YES for asset %{public}@", &v9, 0x16u);
    }

    return 0;
  }

  else
  {
    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v8 = [(PLManagedAsset *)self setTrashedState:v3 forResourceType:24];
    }

    else
    {
      v8 = 1;
    }

    return [(PLManagedAsset *)self setTrashedState:v3 forResourceType:23]&& v8;
  }
}

void __63__PLManagedAsset_setTrashedStateOnSpatialOverCaptureResources___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  setTrashedStateOnSpatialOverCaptureResources__ignoreSOCSetTrashedStateChange = [v0 BOOLForKey:@"PLIgnoreSOCPrune"];
}

- (BOOL)isSyncableChange
{
  v22 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self savedAssetTypeIsSupportedForUpload])
  {
    v3 = [(PLManagedAsset *)self changedValues];
    v17 = 0u;
    v18 = 0u;
    v19 = 0u;
    v20 = 0u;
    v4 = +[PLManagedAsset listOfSyncedProperties];
    v5 = [v4 countByEnumeratingWithState:&v17 objects:v21 count:16];
    if (v5)
    {
      v6 = *v18;
      while (2)
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v18 != v6)
          {
            objc_enumerationMutation(v4);
          }

          v8 = [v3 objectForKey:*(*(&v17 + 1) + 8 * i)];

          if (v8)
          {
            LOBYTE(v5) = 1;
            goto LABEL_13;
          }
        }

        v5 = [v4 countByEnumeratingWithState:&v17 objects:v21 count:16];
        if (v5)
        {
          continue;
        }

        break;
      }
    }

LABEL_13:

    v10 = [v3 objectForKey:@"cloudLocalState"];
    v11 = v10;
    if (v10)
    {
      if ([v10 intValue])
      {
        v12 = v5;
      }

      else
      {
        v12 = 1;
      }

      if (v12)
      {
        goto LABEL_23;
      }
    }

    else if (v5)
    {
      goto LABEL_23;
    }

    v13 = [v3 objectForKey:@"savedAssetType"];
    if (!v13 || (v14 = v13, v15 = [(PLManagedAsset *)self cloudLocalState], v14, v15))
    {
      v9 = 0;
LABEL_26:

      return v9;
    }

LABEL_23:
    if ([(PLManagedAsset *)self isPlaceholderAsset])
    {
      v9 = [PLManagedAsset validShareForPlaceholderAsset:self];
    }

    else
    {
      v9 = 1;
    }

    goto LABEL_26;
  }

  return 0;
}

- (BOOL)_updateKindSubtypeIfScreenshotWithCheckTask:(id)a3
{
  v5 = a3;
  if (!v5)
  {
    v8 = [MEMORY[0x1E696AAA8] currentHandler];
    [v8 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2805 description:{@"Invalid parameter not satisfying: %@", @"checkTask"}];
  }

  if ([(PLManagedAsset *)self isPhotoIris]|| ![(PLManagedAsset *)self isPhoto]|| [(PLManagedAsset *)self kindSubtype]== 10 || !v5[2](v5))
  {
    v6 = 0;
  }

  else
  {
    [(PLManagedAsset *)self setKindSubtype:10];
    v6 = 1;
  }

  return v6;
}

- (BOOL)updateKindSubtypeIfScreenshotWithMetadata:(id)a3
{
  v5 = a3;
  if (!v5)
  {
    v9 = [MEMORY[0x1E696AAA8] currentHandler];
    [v9 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2787 description:{@"Invalid parameter not satisfying: %@", @"metadata"}];
  }

  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __60__PLManagedAsset_updateKindSubtypeIfScreenshotWithMetadata___block_invoke;
  v10[3] = &unk_1E7570878;
  v10[4] = self;
  v11 = v5;
  v6 = v5;
  v7 = [(PLManagedAsset *)self _updateKindSubtypeIfScreenshotWithCheckTask:v10];

  return v7;
}

uint64_t __60__PLManagedAsset_updateKindSubtypeIfScreenshotWithMetadata___block_invoke(uint64_t a1)
{
  v2 = objc_opt_class();
  v3 = [*(a1 + 40) contentType];
  v4 = [v2 _isScreenshotWithType:v3 hasScreenshotDimensions:objc_msgSend(*(a1 + 32) hasScreenshotMetadata:{"_hasScreenshotDimensions"), objc_msgSend(*(a1 + 32), "_hasScreenshotMetadataWithMetadata:", *(a1 + 40))}];

  return v4;
}

- (BOOL)updateKindSubtypeIfScreenshot
{
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __47__PLManagedAsset_updateKindSubtypeIfScreenshot__block_invoke;
  v3[3] = &unk_1E7573368;
  v3[4] = self;
  return [(PLManagedAsset *)self _updateKindSubtypeIfScreenshotWithCheckTask:v3];
}

uint64_t __47__PLManagedAsset_updateKindSubtypeIfScreenshot__block_invoke(uint64_t a1)
{
  v2 = objc_opt_class();
  v3 = MEMORY[0x1E69C08F0];
  v4 = [*(a1 + 32) uniformTypeIdentifier];
  v5 = [v3 typeWithIdentifier:v4];
  v6 = [v2 _isScreenshotWithType:v5 hasScreenshotDimensions:objc_msgSend(*(a1 + 32) hasScreenshotMetadata:{"_hasScreenshotDimensions"), objc_msgSend(*(a1 + 32), "hasScreenshotMetadata")}];

  return v6;
}

- (void)updatePanoramosityWithMetadata:(id)a3
{
  v6 = a3;
  if (![(PLManagedAsset *)self isPhotoIris]&& [(PLManagedAsset *)self kindSubtype]!= 10 && [(PLManagedAsset *)self isPhoto])
  {
    if (!v6)
    {
      v6 = [(PLManagedAsset *)self metadataFromMediaPropertiesOrOriginalResource];
    }

    if (!-[PLManagedAsset _hasPanoramaDimensions](self, "_hasPanoramaDimensions") || ([v6 isScreenshot] & 1) != 0 || (v5 = -[PLManagedAsset height](self, "height"), v5 > -[PLManagedAsset width](self, "width")) && !objc_msgSend(v6, "isPanorama"))
    {
      if ([(PLManagedAsset *)self kindSubtype]!= 1)
      {
        goto LABEL_11;
      }

      v4 = 0;
      goto LABEL_10;
    }

    if ([(PLManagedAsset *)self kindSubtype]!= 1)
    {
      v4 = 1;
LABEL_10:
      [(PLManagedAsset *)self setKindSubtype:v4];
    }
  }

LABEL_11:
}

- (BOOL)validateForUpdate:(id *)a3
{
  v16 = *MEMORY[0x1E69E9840];
  v5 = [PLManagedAsset correctedOrientation:[(PLManagedAsset *)self orientation]];
  if (v5 != [(PLManagedAsset *)self orientation])
  {
    [(PLManagedAsset *)self setOrientation:v5];
  }

  v13.receiver = self;
  v13.super_class = PLManagedAsset;
  v6 = [(PLManagedAsset *)&v13 validateForUpdate:a3];
  if (v6)
  {
    v7 = [(PLManagedAsset *)self changedValues];
    v8 = [v7 objectForKeyedSubscript:@"libraryScope"];
    if (v8)
    {
    }

    else
    {
      v9 = [v7 objectForKeyedSubscript:@"libraryScopeShareState"];

      if (!v9)
      {
LABEL_12:

        return v6;
      }
    }

    if ([(PLManagedAsset *)self hasLibraryScope]&& [(PLManagedAsset *)self isSuggestedForSharingByPhotos])
    {
      v10 = PLBackendGetLog();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEFAULT))
      {
        v11 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v15 = v11;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEFAULT, "Correcting libraryScopeShareState on asset %{public}@, for failing rule: a shared asset should not be marked as suggested for sharing.", buf, 0xCu);
      }

      PLLibraryScopeAssetRemoveSuggestedByClientType(self);
    }

    goto LABEL_12;
  }

  return v6;
}

- (BOOL)validateForInsert:(id *)a3
{
  v5 = [PLManagedAsset correctedOrientation:[(PLManagedAsset *)self orientation]];
  if (v5 != [(PLManagedAsset *)self orientation])
  {
    [(PLManagedAsset *)self setOrientation:v5];
  }

  v6 = [(PLManagedAsset *)self collectionShareContributor];
  if (v6)
  {
    v7 = v6;
    v8 = [(PLManagedAsset *)self collectionShareContributor];
    if ([v8 isCurrentUser])
    {
      v9 = [(PLManagedAsset *)self sensitivityAnalysisState];

      if (!v9)
      {
        [(PLManagedAsset *)self setSensitivityAnalysisState:4];
      }
    }

    else
    {
    }
  }

  v11.receiver = self;
  v11.super_class = PLManagedAsset;
  return [(PLManagedAsset *)&v11 validateForInsert:a3];
}

- (void)applyTrashedState:(signed __int16)a3 withTrashedReason:(unsigned __int16)a4 expungeReasonFromClient:(id)a5
{
  v5 = a4;
  v6 = a3;
  v23 = *MEMORY[0x1E69E9840];
  v9 = a5;
  if (![(PLManagedAsset *)self canMoveToTrash])
  {
    v18 = [MEMORY[0x1E696AAA8] currentHandler];
    [v18 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2655 description:@"expect trashable asset"];
  }

  if (v6 == 2)
  {
    if ([(PLManagedAsset *)self trashedState]!= 1 && [(PLManagedAsset *)self trashedState])
    {
      goto LABEL_25;
    }

    v14 = objc_alloc_init(MEMORY[0x1E696AD60]);
    if ([(PLManagedAsset *)self trashedState]== 1)
    {
      v17 = @"User deleted asset in trashedState.";
    }

    else
    {
      v17 = @"User deleted asset in non-trashedState";
    }

    [v14 appendString:v17];
    if (v9)
    {
      [v14 appendFormat:@" Client expunge reason: %@", v9];
    }

    [(PLManagedAsset *)self setTrashedState:2];
    v15 = [PLAssetTransactionReason transactionReason:v14];
    [(PLManagedAsset *)self deleteWithReason:v15];
    goto LABEL_23;
  }

  if (v6 == 1)
  {
    if ([(PLManagedAsset *)self trashedState])
    {
      goto LABEL_25;
    }

    [(PLManagedAsset *)self setTrashedState:1];
    v11 = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setTrashedDate:v11];

    [(PLManagedAsset *)self setTrashedReason:v5];
    if ([(PLManagedAsset *)self hasLibraryScope]&& ([(PLManagedAsset *)self libraryScopeShareState]& 0x800000) != 0)
    {
      v12 = [(PLManagedAsset *)self libraryScope];
      v13 = [v12 currentUserParticipant];
      [(PLManagedAsset *)self setTrashedByParticipant:v13];
    }

    v14 = PLPhotosStatusGetLog();
    if (!os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
LABEL_24:

      goto LABEL_25;
    }

    v15 = [(PLManagedAsset *)self uuid];
    v16 = [(PLManagedAsset *)self dateCreated];
    *buf = 138543618;
    v20 = v15;
    v21 = 2114;
    v22 = v16;
    _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Asset %{public}@ (created on %{public}@) was trashed.", buf, 0x16u);

LABEL_23:
    goto LABEL_24;
  }

  if (!v6 && [(PLManagedAsset *)self trashedState]== 1)
  {
    [(PLManagedAsset *)self setTrashedState:0];
    [(PLManagedAsset *)self setTrashedDate:0];
    [(PLManagedAsset *)self setTrashedReason:0];
    v10 = [(PLManagedAsset *)self trashedByParticipant];

    if (v10)
    {
      [(PLManagedAsset *)self setTrashedByParticipant:0];
    }
  }

LABEL_25:
}

- (void)deleteFromDatabaseOnlyWithReason:(id)a3
{
  v6 = a3;
  if ((PLIsAssetsd() & 1) == 0)
  {
    v5 = [MEMORY[0x1E696AAA8] currentHandler];
    [v5 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2601 description:@"deleteFromDatabaseOnly is only safe from inside of assetsd!"];
  }

  self->_didPrepareForDeletion = 1;
  [(PLManagedAsset *)self deleteWithReason:v6];
}

- (void)deleteFromDatabaseOnly
{
  if ((PLIsAssetsd() & 1) == 0)
  {
    v4 = [MEMORY[0x1E696AAA8] currentHandler];
    [v4 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2592 description:@"deleteFromDatabaseOnly is only safe from inside of assetsd!"];
  }

  self->_didPrepareForDeletion = 1;
  v5 = [PLAssetTransactionReason transactionReason:@"Deleting from database only"];
  [(PLManagedAsset *)self deleteWithReason:v5];
}

- (void)delete
{
  v25 = *MEMORY[0x1E69E9840];
  if (!self->_deleteReasonExists)
  {
    v14 = [MEMORY[0x1E696AAA8] currentHandler];
    [v14 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2578 description:@"Asset deletion must specify a reason.  Please use deleteWithReason:"];
  }

  v3 = [(PLManagedAsset *)self isCameraConnectionKitAsset];
  v4 = PLPhotosStatusGetLog();
  v5 = os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);
  if (v3)
  {
    if (v5)
    {
      v6 = [(PLManagedAsset *)self directory];
      v7 = [(PLManagedAsset *)self filename];
      v8 = [(PLManagedAsset *)self objectID];
      v9 = [(PLManagedAsset *)self uuid];
      v10 = [(PLManagedAsset *)self dateCreated];
      v15 = 138544386;
      v16 = v6;
      v17 = 2112;
      v18 = v7;
      v19 = 2114;
      v20 = v8;
      v21 = 2114;
      v22 = v9;
      v23 = 2114;
      v24 = v10;
      v11 = "Deleting %{public}@/%@ [%{public}@ %{public}@] (created on %{public}@)";
LABEL_8:
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEFAULT, v11, &v15, 0x34u);
    }
  }

  else if (v5)
  {
    v6 = [(PLManagedAsset *)self directory];
    v7 = [(PLManagedAsset *)self filename];
    v8 = [(PLManagedAsset *)self objectID];
    v9 = [(PLManagedAsset *)self uuid];
    v10 = [(PLManagedAsset *)self dateCreated];
    v15 = 138544386;
    v16 = v6;
    v17 = 2114;
    v18 = v7;
    v19 = 2114;
    v20 = v8;
    v21 = 2114;
    v22 = v9;
    v23 = 2114;
    v24 = v10;
    v11 = "Deleting %{public}@/%{public}@ [%{public}@ %{public}@] (created on %{public}@)";
    goto LABEL_8;
  }

  v12 = [(PLManagedAsset *)self managedObjectContext];
  [v12 deleteObject:self];

  self->_deleteReasonExists = 0;
}

- (void)deleteWithReason:(id)a3
{
  v10 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = PLPhotosStatusGetLog();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = [v4 reason];
    v8 = 138543362;
    v9 = v6;
    _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "Delete reason: %{public}@", &v8, 0xCu);
  }

  v7 = [v4 reason];
  [(PLManagedAsset *)self setDeleteReason:v7];

  self->_deleteReasonExists = 1;
  [(PLManagedAsset *)self delete];
}

- (BOOL)isDeletableFromAssetsLibrary
{
  v3 = [(PLManagedAsset *)self canPerformEditOperation:1];
  if (v3)
  {
    if ([(PLManagedAsset *)self isCloudSharedAsset])
    {
      LOBYTE(v3) = 0;
    }

    else
    {
      LOBYTE(v3) = ![(PLManagedAsset *)self isPhotoStreamPhoto];
    }
  }

  return v3;
}

- (BOOL)isEditableFromAssetsLibrary
{
  v3 = [(PLManagedAsset *)self canPerformEditOperation:2];
  if (v3)
  {
    if (([(PLManagedAsset *)self isDeleted]& 1) != 0 || [(PLManagedAsset *)self isCloudSharedAsset])
    {
      LOBYTE(v3) = 0;
    }

    else
    {
      LOBYTE(v3) = ![(PLManagedAsset *)self isPhotoStreamPhoto];
    }
  }

  return v3;
}

- (id)decodedFaceRegions
{
  v2 = [(PLManagedAsset *)self faceRegions];
  v3 = PLManagedAssetDecodeFaceRegions(v2);

  return v3;
}

- (void)_loadReverseGeoIfNeeded
{
  if (!self->_didLoadReverseGeo)
  {
    v3 = [(PLManagedAsset *)self locationInfo];
    if (v3)
    {
      v8 = v3;
      v4 = [(PLManagedAsset *)self location];

      v3 = v8;
      if (v4)
      {
        self->_isLocatedAtHome = [v8 isHome];
        v5 = [v8 localizedDescription];
        v6 = [v5 copy];
        reverseGeoDescription = self->_reverseGeoDescription;
        self->_reverseGeoDescription = v6;

        v3 = v8;
      }
    }

    self->_didLoadReverseGeo = 1;
  }
}

- (id)reverseGeoDescription
{
  [(PLManagedAsset *)self _loadReverseGeoIfNeeded];
  reverseGeoDescription = self->_reverseGeoDescription;

  return reverseGeoDescription;
}

- (id)avalanchePickDescription
{
  v2 = [(PLManagedAsset *)self avalanchePickType];
  v3 = [MEMORY[0x1E696AD60] string];
  v4 = v3;
  if (!v2)
  {
    v5 = @" PLAvalancheTypeNotInBurst";
LABEL_14:
    [v4 appendString:v5];
    goto LABEL_15;
  }

  if (v2)
  {
    [v3 appendString:@" PLAvalancheTypeUnknown"];
    if ((v2 & 2) == 0)
    {
LABEL_4:
      if ((v2 & 4) == 0)
      {
        goto LABEL_5;
      }

      goto LABEL_11;
    }
  }

  else if ((v2 & 2) == 0)
  {
    goto LABEL_4;
  }

  [v4 appendString:@" PLAvalancheTypeNotPicked"];
  if ((v2 & 4) == 0)
  {
LABEL_5:
    if ((v2 & 8) == 0)
    {
      goto LABEL_6;
    }

LABEL_12:
    [v4 appendString:@" PLAvalancheTypeUserFavorite"];
    if ((v2 & 0x10) == 0)
    {
      goto LABEL_15;
    }

    goto LABEL_13;
  }

LABEL_11:
  [v4 appendString:@" PLAvalancheTypeAutoPicked"];
  if ((v2 & 8) != 0)
  {
    goto LABEL_12;
  }

LABEL_6:
  if ((v2 & 0x10) != 0)
  {
LABEL_13:
    v5 = @" PLAvalancheTypeStack";
    goto LABEL_14;
  }

LABEL_15:

  return v4;
}

- (BOOL)isAvalanchePhoto
{
  v3 = [(PLManagedAsset *)self avalanchePickType];
  if (v3)
  {

    LOBYTE(v3) = [(PLManagedAsset *)self isPartOfBurst];
  }

  return v3;
}

- (BOOL)isAvalancheStackPhoto
{
  if (([(PLManagedAsset *)self avalanchePickType]& 0x10) == 0)
  {
    return 0;
  }

  return [(PLManagedAsset *)self isPartOfBurst];
}

- (BOOL)avalanchePickTypeIsVisible
{
  v3 = [(PLManagedAsset *)self avalanchePickType];

  return [(PLManagedAsset *)self _isVisibleAvalanchePickType:v3];
}

- (void)setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:(unsigned __int16)a3
{
  v3 = a3;
  if ([(PLManagedAsset *)self playbackVariation]!= a3)
  {
    [(PLManagedAsset *)self setPlaybackVariation:v3];
    v5 = [(PLManagedAsset *)self playbackStyle];
    if ([objc_opt_class() _isLoopingVideoPlaybackVariation:v3])
    {
      v6 = 5;
    }

    else
    {
      if (v5 != 5)
      {
        return;
      }

      if ([(PLManagedAsset *)self isPhotoIris])
      {
        v6 = 3;
      }

      else
      {
        v6 = 4;
      }
    }

    if (v5 != v6)
    {

      [(PLManagedAsset *)self setPlaybackStyle:v6];
    }
  }
}

- (unsigned)_playbackVariationWithAdjustmentRenderTypes:(unsigned int)a3
{
  if ((a3 & 8) != 0)
  {
    LOWORD(v3) = 2;
  }

  else
  {
    v3 = ((a3 << 29) >> 31) & 3;
  }

  if (a3)
  {
    return 1;
  }

  else
  {
    return v3;
  }
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 withPlaybackVariation:(unsigned __int16)a4
{
  if ((a4 - 1) > 2)
  {
    v4 = 0;
  }

  else
  {
    v4 = dword_19C60B858[(a4 - 1)];
  }

  return v4 | a3 & 0xFFFFFFF2;
}

- (unsigned)updateAdjustmentRenderTypes:(unsigned int)a3 withDepthType:(signed __int16)a4
{
  v4 = (a4 == 2) << 7;
  if (a4 == 1)
  {
    v4 = 2;
  }

  return v4 | a3 & 0xFFFFFF7D;
}

- (void)setCameraProcessingAdjustmentStateFromAdjustmentRenderTypes:(unsigned int)a3
{
  v4 = (a3 >> 2) & 0xC | [(PLManagedAsset *)self cameraProcessingAdjustmentState]& 0xFFFFFFF3;

  [(PLManagedAsset *)self setCameraProcessingAdjustmentState:v4];
}

- (void)setDepthTypeFromAdjustmentRenderTypes:(unsigned int)a3
{
  if ((a3 & 2) != 0)
  {
    v3 = 1;
LABEL_5:
    [(PLManagedAsset *)self setDepthType:v3];
    return;
  }

  if ((a3 & 0x80) != 0)
  {
    v3 = 2;
    goto LABEL_5;
  }
}

- (void)setPlaybackVariationAndLoopingStyleFromAdjustmentRenderTypes:(unsigned int)a3
{
  v4 = [(PLManagedAsset *)self _playbackVariationWithAdjustmentRenderTypes:*&a3];

  [(PLManagedAsset *)self setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v4];
}

- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)a3 mainFileMetadata:(id)a4 videoURL:(id)a5 spatialOverCaptureURL:(id)a6 videoDuration:(id *)a7 stillDisplayTime:(id *)a8 options:(unint64_t)a9
{
  v58 = *MEMORY[0x1E69E9840];
  v50 = a3;
  v51 = a4;
  v16 = a5;
  v17 = a6;
  if (![(PLManagedAsset *)self isPhoto])
  {
    v48 = [MEMORY[0x1E696AAA8] currentHandler];
    [v48 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:2254 description:{@"expect photo when changing to photoIris but type is %d", -[PLManagedAsset kind](self, "kind")}];
  }

  v18 = [(PLManagedAsset *)self isPhoto];
  v19 = [(PLManagedAsset *)self _checkForAndAddFrameDropRecoveryForPhotoKitIngest];
  v20 = [v16 path];
  v21 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  v22 = [v20 isEqualToString:v21];

  if (!v18)
  {
    v25 = 0;
    v26 = 0;
    v24 = 0;
    goto LABEL_45;
  }

  v23 = v22 | v19;
  v49 = v22 | v19;
  if ((a9 & 2) != 0)
  {
    v24 = [v16 path];
  }

  else
  {
    if (([v51 isSyndicationOriginated] & 1) == 0)
    {
      v28 = [v16 path];
      if (v23)
      {
        [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
      }

      else
      {
        [(PLManagedAsset *)self pathForVideoComplementFile];
      }
      v24 = ;
      v27 = [(PLManagedAsset *)self _linkVideoFileFromSourcePath:v28 toDestinationPath:v24];

      if (!v17)
      {
        goto LABEL_18;
      }

      goto LABEL_15;
    }

    v24 = 0;
  }

  v27 = 1;
  if (!v17)
  {
    goto LABEL_18;
  }

LABEL_15:
  if (v27)
  {
    v26 = [v17 path];
    if ((a9 & 2) != 0)
    {
      [v17 path];
    }

    else
    {
      [(PLManagedAsset *)self pathForVideoComplementSpatialOverCaptureContentFile];
    }
    v45 = ;
    v46 = [(PLManagedAsset *)self _linkVideoFileFromSourcePath:v26 toDestinationPath:v45];

    if (v46)
    {
      goto LABEL_19;
    }

LABEL_44:
    v25 = 0;
    goto LABEL_45;
  }

LABEL_18:
  v26 = 0;
  if (!v27)
  {
    goto LABEL_44;
  }

LABEL_19:
  [(PLManagedAsset *)self setKindSubtype:2];
  v29 = [(PLManagedAsset *)self master];

  if (v29)
  {
    v30 = PLBackendGetLog();
    if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
    {
      v31 = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      *&buf[4] = v31;
      _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_INFO, "Mark the master to be not pushed, we just detect the video complement %{public}@", buf, 0xCu);
    }

    v32 = [(PLManagedAsset *)self master];
    [v32 setCloudLocalState:0];
  }

  *buf = *&a7->var0;
  var3 = a7->var3;
  v54 = *&a8->var0;
  v55 = a8->var3;
  [(PLManagedAsset *)self updatePhotoIrisMetadataWithMediaGroupUUID:v50 videoDuration:buf stillDisplayTime:&v54];
  if (([v51 isSyndicationOriginated] & 1) == 0)
  {
    [MEMORY[0x1E69BF230] persistString:0 forKey:*MEMORY[0x1E69BFDE0] fileURL:v16];
  }

  if ([(PLManagedAsset *)self canPlayPhotoIris])
  {
    [(PLManagedAsset *)self setPlaybackStyle:3];
    [(PLManagedAsset *)self updatePlaybackVariationAndStyleFromOriginalMetadata:v51];
  }

  if (v26)
  {
    [(PLManagedAsset *)self setCameraProcessingAdjustmentState:[(PLManagedAsset *)self cameraProcessingAdjustmentState]| 1];
  }

  if (v19)
  {
    [(PLManagedAsset *)self setVideoDeferredProcessingNeeded:1];
    v33 = [(PLManagedObject *)self photoLibrary];
    v34 = [v33 libraryServicesManager];
    v35 = [v34 backgroundJobService];
    v36 = [(PLManagedObject *)self photoLibrary];
    v37 = [PLBackgroundJobWorkerTypes typesMaskForVideoDeferredProcessingNeeded:[(PLManagedAsset *)self videoDeferredProcessingNeeded]];
    [v35 signalBackgroundProcessingNeededOnLibrary:v36 workerTypes:v37];
  }

  v25 = 1;
  if (![(PLManagedAsset *)self isCloudSharedAsset]&& v24)
  {
    v38 = [(PLManagedObject *)self photoLibrary];
    v39 = [v38 libraryID];
    v40 = PLDataStoreForClassIDAndLibraryID(0, v39);

    v41 = [(PLManagedAsset *)self managedObjectContext];
    v42 = [PLResourceInstaller validatedExternalResourceForLocalVideoIfPresentAtPath:v24 context:v41];

    if (v42)
    {
      [v42 setVersion:0];
      [v42 setResourceType:3];
      if (v49)
      {
        [v42 setRecipeID:131279];
      }

      v53 = 0;
      [v40 storeExternalResource:v42 forAsset:self options:0 error:0 resultingResource:&v53];
    }

    if (v26)
    {
      v43 = [(PLManagedAsset *)self managedObjectContext];
      v44 = [PLResourceInstaller validatedExternalResourceForLocalVideoIfPresentAtPath:v26 context:v43];

      if (v44)
      {
        [v44 setVersion:0];
        [v44 setResourceType:11];
        v52 = 0;
        [v40 storeExternalResource:v44 forAsset:self options:0 error:0 resultingResource:&v52];
      }
    }

    v25 = 1;
  }

LABEL_45:

  return v25;
}

- (BOOL)becomePhotoIrisWithMediaGroupUUID:(id)a3 mainFileMetadata:(id)a4 videoURL:(id)a5 videoDuration:(id *)a6 stillDisplayTime:(id *)a7 options:(unint64_t)a8
{
  v10 = *a6;
  v9 = *a7;
  return [(PLManagedAsset *)self becomePhotoIrisWithMediaGroupUUID:a3 mainFileMetadata:a4 videoURL:a5 spatialOverCaptureURL:0 videoDuration:&v10 stillDisplayTime:&v9 options:a8];
}

- (BOOL)_linkVideoFileFromSourcePath:(id)a3 toDestinationPath:(id)a4
{
  v28[1] = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = [MEMORY[0x1E696AC08] defaultManager];
  if ([v5 isEqualToString:v6] && (objc_msgSend(v7, "fileExistsAtPath:", v6) & 1) != 0)
  {
    v8 = 1;
  }

  else
  {
    v27 = *MEMORY[0x1E696A3A0];
    v28[0] = *MEMORY[0x1E696A388];
    v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v28 forKeys:&v27 count:1];
    v20 = 0;
    v10 = [v7 setAttributes:v9 ofItemAtPath:v5 error:&v20];
    v11 = v20;

    if ((v10 & 1) == 0)
    {
      v12 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v22 = v5;
        v23 = 2112;
        v24 = v11;
        _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Unable to assign data protection to %@: %@", buf, 0x16u);
      }
    }

    v13 = MEMORY[0x1E69BF238];
    v14 = [MEMORY[0x1E695DFF8] fileURLWithPath:v5 isDirectory:0];
    v15 = [MEMORY[0x1E695DFF8] fileURLWithPath:v6 isDirectory:0];
    v19 = 0;
    v8 = [v13 copyItemAtURL:v14 toURL:v15 error:&v19];
    v16 = v19;

    if ((v8 & 1) == 0)
    {
      v17 = PLBackendGetLog();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v22 = v5;
        v23 = 2112;
        v24 = v6;
        v25 = 2112;
        v26 = v16;
        _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "failed to copy video file from %@ to %@: %@", buf, 0x20u);
      }
    }
  }

  return v8;
}

- (void)updatePhotoIrisVisibilityStateWithVitalityScore:(id)a3
{
  v12 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = v4;
  if (v4)
  {
    [v4 floatValue];
    if (v6 < 0.5)
    {
      v7 = PLBackendGetLog();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v10 = 138543362;
        v11 = v5;
        _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_INFO, "Setting VC visibility state to hidden with vitalityScore:%{public}@", &v10, 0xCu);
      }

      [(PLManagedAsset *)self setVideoCpVisibilityState:[(PLManagedAsset *)self videoCpVisibilityState]| 5];
    }
  }

  else
  {
    v8 = PLBackendGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v9 = [(PLManagedAsset *)self uuid];
      v10 = 138543362;
      v11 = v9;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Vitality thresholding was requested for asset %{public}@ but vitality score was nil", &v10, 0xCu);
    }
  }
}

- (void)updatePhotoIrisMetadataWithMediaGroupUUID:(id)a3 videoDuration:(id *)a4 stillDisplayTime:(id *)a5
{
  v8 = a3;
  v9 = [(PLManagedAsset *)self mediaGroupUUID];
  v10 = [v9 isEqualToString:v8];

  if ((v10 & 1) == 0)
  {
    [(PLManagedAsset *)self setMediaGroupUUID:v8];
  }

  v11 = *&a4->var0;
  var3 = a4->var3;
  [(PLManagedAsset *)self setPhotoIrisVideoDuration:&v11];
  v11 = *&a5->var0;
  var3 = a5->var3;
  [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&v11];
}

- (void)_updatePhotoIrisTemporalMetadataFromVideoComplementAVAsset:(id)a3
{
  v24 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = PFVideoComplementMetadataForVideoAVAssetPreloadingValues();
  v6 = v5;
  memset(&v21[1], 0, sizeof(CMTime));
  v7 = MEMORY[0x1E6960C70];
  if (!v5)
  {
    memset(v21, 0, 24);
    goto LABEL_8;
  }

  [v5 videoDuration];
  memset(v21, 0, 24);
  [v6 imageDisplayTime];
  if (v21[1].value)
  {
    goto LABEL_18;
  }

  if ((v21[0].flags & 1) == 0)
  {
LABEL_8:
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && (v10 = v4, [v10 URL], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(MEMORY[0x1E696AC08], "defaultManager"), v12 = objc_claimAutoreleasedReturnValue(), v10, -[NSObject path](v11, "path"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v12, "fileExistsAtPath:", v13), v13, v12, v11))
    {
      v15 = PLPhotoEditGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_FAULT))
      {
        v16 = [(PLManagedAsset *)self uuid];
        v17 = @"does not";
        LODWORD(buf.value) = 138543874;
        *(&buf.value + 4) = v16;
        LOWORD(buf.flags) = 2112;
        if (v14)
        {
          v17 = @"does";
        }

        *(&buf.flags + 2) = v17;
        HIWORD(buf.epoch) = 2112;
        v23 = v11;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_FAULT, "asset %{public}@ photo iris still display time is invalid and duration is 0, rejecting times, backing video file %@ exist at url: %@", &buf, 0x20u);
      }
    }

    else
    {
      v11 = PLPhotoEditGetLog();
      if (!os_log_type_enabled(v11, OS_LOG_TYPE_FAULT))
      {
LABEL_17:

        v21[1] = *v7;
        goto LABEL_18;
      }

      v15 = [(PLManagedAsset *)self uuid];
      LODWORD(buf.value) = 138543618;
      *(&buf.value + 4) = v15;
      LOWORD(buf.flags) = 2112;
      *(&buf.flags + 2) = v4;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_FAULT, "asset %{public}@ photo iris still display time is invalid and duration is 0, rejecting times, likely failed to read temporal metadata from avasset: %@", &buf, 0x16u);
    }

    goto LABEL_17;
  }

  v8 = PLPhotoEditGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
  {
    v9 = [(PLManagedAsset *)self uuid];
    LODWORD(buf.value) = 138543618;
    *(&buf.value + 4) = v9;
    LOWORD(buf.flags) = 2112;
    *(&buf.flags + 2) = v4;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "asset %{public}@ photo iris duration is 0, video will likely be unplayable, avasset: %@", &buf, 0x16u);
  }

LABEL_18:
  buf = v21[0];
  v19 = *&v7->value;
  *&time2.value = *&v7->value;
  epoch = v7->epoch;
  time2.epoch = epoch;
  if (CMTimeCompare(&buf, &time2))
  {
    buf = v21[0];
    [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&buf];
  }

  buf = v21[1];
  *&time2.value = v19;
  time2.epoch = epoch;
  if (CMTimeCompare(&buf, &time2))
  {
    buf = v21[1];
    [(PLManagedAsset *)self setPhotoIrisVideoDuration:&buf];
  }
}

- (id)photoIrisSidecarIgnoringSubtype:(BOOL)a3
{
  if (a3 || [(PLManagedAsset *)self isPhotoIris])
  {
    v4 = [(PLManagedAsset *)self sidecarFileMatchingContentType:*MEMORY[0x1E6982EE8] requireExactMatch:0 requireSort:1];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)_setVideoComplementData:(id)a3
{
  v8 = *MEMORY[0x1E6960C70];
  v9 = *(MEMORY[0x1E6960C70] + 16);
  v6 = v8;
  v7 = v9;
  [PLAdditionalAssetAttributes fromExtraDurationData:a3 getStillDisplayTime:&v8 videoDuration:&v6];
  v4 = v6;
  v5 = v7;
  [(PLManagedAsset *)self setPhotoIrisVideoDuration:&v4];
  v4 = v8;
  v5 = v9;
  [(PLManagedAsset *)self setPhotoIrisStillDisplayTime:&v4];
}

- (id)videoComplementData
{
  if ([(PLManagedAsset *)self _hasVideoComplementData])
  {
    v3 = [(PLManagedAsset *)self additionalAttributes];
    memset(&v9, 0, sizeof(v9));
    CMTimeMake(&v9, [v3 videoCpDisplayValue], objc_msgSend(v3, "videoCpDisplayTimescale"));
    memset(&v8, 0, sizeof(v8));
    CMTimeMake(&v8, -[PLManagedAsset videoCpDurationValue](self, "videoCpDurationValue"), [v3 videoCpDurationTimescale]);
    v7 = v9;
    v6 = v8;
    v4 = [PLAdditionalAssetAttributes newExtraDurationDataFromStillDisplayTime:&v7 videoDuration:&v6];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (BOOL)_hasVideoComplementData
{
  v3 = [(PLManagedAsset *)self additionalAttributes];
  v4 = -[PLManagedAsset videoCpDurationValue](self, "videoCpDurationValue") || [v3 videoCpDurationTimescale] || objc_msgSend(v3, "videoCpDisplayValue") || objc_msgSend(v3, "videoCpDisplayTimescale") != 0;

  return v4;
}

- (void)setPhotoIrisVideoDuration:(id *)a3
{
  [(PLManagedAsset *)self photoIrisVideoDuration];
  v6 = *a3;
  if (CMTimeCompare(&v6, &time2))
  {
    v5 = [(PLManagedAsset *)self additionalAttributes];
    [(PLManagedAsset *)self setVideoCpDurationValue:a3->var0];
    [v5 setVideoCpDurationTimescale:a3->var1];
  }
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisVideoDuration
{
  v5 = [(PLManagedAsset *)self videoCpDurationValue];
  v6 = [(PLManagedAsset *)self additionalAttributes];
  v7 = [v6 videoCpDurationTimescale];

  retstr->var0 = 0;
  *&retstr->var1 = 0;
  retstr->var3 = 0;

  return CMTimeMake(retstr, v5, v7);
}

- (void)setPhotoIrisStillDisplayTime:(id *)a3
{
  [(PLManagedAsset *)self photoIrisStillDisplayTime];
  v6 = *a3;
  if (CMTimeCompare(&v6, &time2))
  {
    v5 = [(PLManagedAsset *)self additionalAttributes];
    [v5 setVideoCpDisplayValue:a3->var0];
    [v5 setVideoCpDisplayTimescale:a3->var1];
  }
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)photoIrisStillDisplayTime
{
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v6 = [v5 videoCpDisplayValue];

  v7 = [(PLManagedAsset *)self additionalAttributes];
  v8 = [v7 videoCpDisplayTimescale];

  retstr->var0 = 0;
  *&retstr->var1 = 0;
  retstr->var3 = 0;

  return CMTimeMake(retstr, v6, v8);
}

- (BOOL)hasAdjustedVideoComplement
{
  v3 = [(PLManagedAsset *)self isPhotoIris];
  if (v3)
  {
    v3 = [(PLManagedAsset *)self hasAdjustments];
    if (v3)
    {
      return ([(PLManagedAsset *)self videoCpVisibilityState]>> 3) & 1;
    }
  }

  return v3;
}

- (BOOL)canPlayPhotoIris
{
  v3 = [(PLManagedAsset *)self isPhotoIris];
  v4 = [(PLManagedAsset *)self isPhotoIrisPlaceholder];
  v5 = [(PLManagedAsset *)self hasAdjustments];
  v6 = [(PLManagedAsset *)self videoCpVisibilityState];
  v7 = objc_opt_class();

  return [v7 canPlayPhotoIrisWithPhotoIris:v3 photoIrisPlaceholder:v4 hasAdjustments:v5 videoCpVisibilityState:v6];
}

- (BOOL)isPhotoIrisPlaceholder
{
  v2 = self;
  v3 = [(PLManagedAsset *)self isPhotoIris];
  v4 = [(PLManagedAsset *)v2 videoCpDurationValue];
  v5 = [(PLManagedAsset *)v2 isCloudSharedAsset];
  v6 = [(PLManagedAsset *)v2 pathForVideoComplementFile];
  LOBYTE(v2) = [objc_opt_class() isPhotoIrisPlaceholderWithPhotoIris:v3 videoCpDuration:v4 isCloudShared:v5 videoCpFilePath:v6];

  return v2;
}

- (BOOL)isPhotoIris
{
  v3 = [(PLManagedAsset *)self isPhoto];
  if (v3)
  {
    LOBYTE(v3) = [(PLManagedAsset *)self kindSubtype]== 2;
  }

  return v3;
}

- (void)setLocation:(id)a3
{
  v16 = a3;
  [(PLManagedAsset *)self willChangeValueForKey:@"location"];
  [(PLManagedAsset *)self setCachedLocation:v16];
  [(PLManagedAsset *)self didChangeValueForKey:@"location"];
  v4 = [PLManagedAsset newLocationDataFromLocation:v16];
  [(PLManagedAsset *)self setLocationData:v4];
  if (v4)
  {
    [v16 coordinate];
    [(PLManagedAsset *)self setLatitude:?];
    [v16 coordinate];
    [(PLManagedAsset *)self setLongitude:v5];
    [v16 horizontalAccuracy];
    v7 = v6;
    v8 = [(PLManagedAsset *)self additionalAttributes];
    v9 = -1.0;
    if (v7 != 0.0)
    {
      [v16 horizontalAccuracy];
    }

    [v8 setGpsHorizontalAccuracy:v9];

    [v16 coordinate];
    v10 = [PLLocationUtils canUseCoordinate:?];
    v11 = [(PLManagedAsset *)self additionalAttributes];
    v12 = v11;
    if (v10)
    {
      v13 = [MEMORY[0x1E696AD98] numberWithInt:{objc_msgSend(v16, "pl_locationHash")}];
      [v12 setLocationHash:v13];
    }

    else
    {
      [v11 setLocationHash:0];
    }
  }

  else
  {
    v14 = MEMORY[0x1E6985CC0];
    [(PLManagedAsset *)self setLatitude:*MEMORY[0x1E6985CC0]];
    [(PLManagedAsset *)self setLongitude:*(v14 + 8)];
    v15 = [(PLManagedAsset *)self additionalAttributes];
    [v15 setLocationHash:0];

    v12 = [(PLManagedAsset *)self additionalAttributes];
    [v12 setGpsHorizontalAccuracy:-1.0];
  }

  [(PLManagedAsset *)self setReverseLocationDataIsValid:v4 == 0];
  [(PLManagedAsset *)self setShiftedLocationIsValid:0];
}

- (CLLocation)location
{
  [(PLManagedAsset *)self willAccessValueForKey:@"location"];
  v3 = [(PLManagedAsset *)self cachedLocation];
  [(PLManagedAsset *)self didAccessValueForKey:@"location"];
  if (!v3)
  {
    v4 = [(PLManagedAsset *)self locationData];
    v5 = [(PLManagedAsset *)self dateCreated];
    v3 = [PLManagedAsset newLocationFromLocationData:v4 timestampIfMissing:v5];
    if (v3)
    {
      [(PLManagedAsset *)self willChangeValueForKey:@"location"];
      [(PLManagedAsset *)self setCachedLocation:v3];
      [(PLManagedAsset *)self didChangeValueForKey:@"location"];
    }
  }

  return v3;
}

- (BOOL)isLocatedAtCoordinates:(CLLocationCoordinate2D)a3
{
  longitude = a3.longitude;
  latitude = a3.latitude;
  v5 = [(PLManagedAsset *)self location];
  v6 = v5;
  if (v5)
  {
    [v5 coordinate];
    v8 = v7;
    v10 = v9;
  }

  else
  {
    v8 = *MEMORY[0x1E6985CC0];
    v10 = *(MEMORY[0x1E6985CC0] + 8);
  }

  if ([PLLocationUtils canUseCoordinate:latitude, longitude])
  {
    v11 = vabdd_f64(latitude, v8) < 2.22044605e-16;
    LOBYTE(v12) = vabdd_f64(longitude, v10) < 2.22044605e-16 && v11;
  }

  else
  {
    v12 = ![PLLocationUtils canUseCoordinate:v8, v10];
  }

  return v12;
}

- (BOOL)isSemanticEnhanceProcessingCandidate
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = ([v2 deferredProcessingCandidateOptions] >> 3) & 1;

  return v3;
}

- (BOOL)isLocalVideoKeyFrameValid
{
  if ([(PLManagedAsset *)self hasAdjustments]|| [(PLManagedAsset *)self bundleScope]== 3)
  {
    return 0;
  }

  [MEMORY[0x1E69BF328] maskForGuestAsset];
  [(PLManagedAsset *)self savedAssetType];
  return PLValidatedSavedAssetTypeApplies() ^ 1;
}

- (BOOL)resetVideoKeyFrameTime
{
  v3 = [(PLManagedAsset *)self videoKeyFrameValue];
  v4 = v3 != 0;
  if (v3)
  {
    [(PLManagedAsset *)self setVideoKeyFrameValue:0];
  }

  if ([(PLManagedAsset *)self videoKeyFrameTimeScale])
  {
    [(PLManagedAsset *)self setVideoKeyFrameTimeScale:0];
    return 1;
  }

  return v4;
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)videoKeyFrameTime
{
  v5 = [(PLManagedAsset *)self videoKeyFrameValue];
  v6 = [(PLManagedAsset *)self videoKeyFrameTimeScale];

  return CMTimeMake(retstr, v5, v6);
}

- (void)setVideoKeyFrameTime:(id *)a3
{
  [(PLManagedAsset *)self setVideoKeyFrameValue:a3->var0];
  var1 = a3->var1;

  [(PLManagedAsset *)self setVideoKeyFrameTimeScale:var1];
}

- (void)prepareForDeletion
{
  v46 = *MEMORY[0x1E69E9840];
  v41.receiver = self;
  v41.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v41 prepareForDeletion];
  v3 = [(PLManagedAsset *)self managedObjectContext];
  if ((PLIsAssetsd() & 1) != 0 || MEMORY[0x19EAEE520]())
  {
    [PLGraphNode registerDeletedNodeActorForDanglingNodeCleanup:self];
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [PLDelayedSearchIndexUpdates recordAssetIfNeeded:self];
    if (([v3 mergingChanges] & 1) == 0)
    {
      v4 = [(PLManagedObject *)self photoLibrary];
      v5 = [v4 isCloudPhotoLibraryEnabled];

      if (v5)
      {
        v6 = [(PLManagedAsset *)self master];
        v7 = v6;
        if (v6)
        {
          if (([v6 isDeleted] & 1) == 0)
          {
            v8 = [(PLManagedAsset *)self uuid];
            v9 = [v7 hasResourcesOtherThanForAssetUuid:v8];

            if ((v9 & 1) == 0)
            {
              v10 = PLBackendGetLog();
              if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
              {
                v11 = [v7 pl_shortDescription];
                *buf = 138543362;
                v43 = v11;
                _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_INFO, "Deleting master %{public}@, last resource was removed since we deleted the asset", buf, 0xCu);
              }

              [v3 deleteObject:v7];
            }
          }
        }
      }

      if (PLPlatformMomentsSupported())
      {
        v12 = [v3 delayedSaveActions];
        [v12 recordAssetForMomentUpdate:self];
      }

      [v3 recordAvalancheUUIDForUpdate:self];
      if (!self->_didPrepareForDeletion)
      {
        self->_didPrepareForDeletion = 1;
        if ([(PLManagedAsset *)self savedAssetTypeIsSupportedForUpload])
        {
          [MEMORY[0x1E69BF328] maskForMomentSharedAsset];
          [(PLManagedAsset *)self savedAssetType];
          if (PLValidatedSavedAssetTypeApplies())
          {
            v13 = PLBackendGetLog();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              v14 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              v43 = v14;
              v15 = "Not propagating asset delete to cloud as asset is a MomentShared asset is set: %@";
LABEL_23:
              _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_INFO, v15, buf, 0xCu);
            }
          }

          else
          {
            if ([(PLManagedAsset *)self isPlaceholderAsset])
            {
              v13 = PLBackendGetLog();
              if (!os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
              {
                goto LABEL_24;
              }

              v14 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              v43 = v14;
              v15 = "Not propagating asset delete to cloud as asset is a placeholder asset is set: %@";
              goto LABEL_23;
            }

            if (![(PLManagedAsset *)self isLocalOnlyDelete])
            {
              v37 = [(PLManagedAsset *)self uuid];
              if (v37)
              {
              }

              else
              {
                v38 = [(PLManagedAsset *)self cloudAssetGUID];

                if (!v38)
                {
                  v13 = PLBackendGetLog();
                  if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
                  {
                    *buf = 138412290;
                    v43 = self;
                    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_INFO, "Not propagating asset delete to cloud as its uuid & cloudAssetGUID cannot be fetched: %@", buf, 0xCu);
                  }

                  goto LABEL_24;
                }
              }

              v39 = [(PLManagedAsset *)self scopedIdentifier];
              v40 = [v39 stringRepresentation];
              [(PLManagedAsset *)self setCloudAssetGUID:v40];

              [v3 recordCloudDeletionForObject:self];
              goto LABEL_25;
            }

            v13 = PLBackendGetLog();
            if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
            {
              v14 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              v43 = v14;
              v15 = "Not propagating asset delete to cloud as isLocalOnlyDelete is set: %@";
              goto LABEL_23;
            }
          }
        }

        else
        {
          v13 = PLBackendGetLog();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            v14 = [(PLManagedAsset *)self uuid];
            *buf = 138412290;
            v43 = v14;
            v15 = "Not propagating asset delete to cloud as saved asset type is not supported for upload: %@";
            goto LABEL_23;
          }
        }

LABEL_24:

LABEL_25:
        if (PLIsAssetsd() && ([(PLManagedAsset *)self hasOutstandingDeferredCaptureProcessing]|| [(PLManagedAsset *)self hasUnrenderedAsyncAdjustments]))
        {
          [(PLManagedAsset *)self requestDeletionOfDeferredPhotoProcessingIntermediates];
        }

        v16 = [PLFilesystemDeletionInfo deletionInfoWithAsset:self];
        if (v16)
        {
          if (!PLIsAssetsd())
          {
            v33 = PLBackendGetLog();
            if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
            {
              v34 = [(PLManagedAsset *)self uuid];
              v35 = [(PLManagedAsset *)self mainFileURL];
              v36 = [v35 path];
              *buf = 138543618;
              v43 = v34;
              v44 = 2112;
              v45 = v36;
              _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_INFO, "Registering file system deletion info for assetsd to process %{public}@ %@", buf, 0x16u);
            }

            [v3 registerFilesystemDeletionInfo:v16];
            goto LABEL_47;
          }

          v17 = objc_opt_new();
          [v17 addFilesystemDeletionInfo:v16];
          v18 = [(PLManagedObject *)self photoLibrary];
          [v17 deleteAllRemainingFilesAndThumbnailsWithPhotoLibrary:v18];

          v19 = [(PLManagedObject *)self photoLibrary];
          v20 = [v19 libraryServicesManager];

          if ([(PLManagedAsset *)v20 wellKnownPhotoLibraryIdentifier]== 3)
          {
            v21 = PLSyndicationGetLog();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
            {
              v22 = [(PLManagedAsset *)self uuid];
              *buf = 138412290;
              v43 = v22;
              _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEBUG, "GuestAssetSync: preparing to delete syndication asset: %@, triggering update", buf, 0xCu);
            }

            v23 = [(PLManagedObject *)self photoLibrary];
            v24 = [(PLManagedAsset *)self uuid];
            v25 = [v23 addBackgroundJobWorkItemIfNeededWithIdentifier:v24 jobType:0 jobFlags:2];

            if (v25)
            {
              v26 = [(PLManagedAsset *)v20 backgroundJobService];
              v27 = [(PLManagedObject *)self photoLibrary];
              v28 = [PLBackgroundJobWorkerTypes workerTypesMaskForBackgroundJobType:0];
              [v26 signalBackgroundProcessingNeededOnLibrary:v27 workerTypes:v28];
            }
          }

          if ([(PLManagedAsset *)v20 wellKnownPhotoLibraryIdentifier]== 1)
          {
            [MEMORY[0x1E69BF328] maskForGuestAsset];
            [(PLManagedAsset *)self savedAssetType];
            if ((PLValidatedSavedAssetTypeApplies() & 1) == 0)
            {
              v29 = [(PLManagedAsset *)self additionalAttributes];
              v30 = [v29 syndicationIdentifier];

              if (v30)
              {
                [(PLManagedAsset *)self updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:0];
              }
            }
          }
        }

        else
        {
          v17 = PLBackendGetLog();
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
LABEL_43:

LABEL_47:
            goto LABEL_48;
          }

          v20 = [(PLManagedAsset *)self uuid];
          v31 = [(PLManagedAsset *)self mainFileURL];
          v32 = [v31 path];
          *buf = 138543618;
          v43 = v20;
          v44 = 2112;
          v45 = v32;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_INFO, "No file system deletion info for %{public}@ %@", buf, 0x16u);
        }

        goto LABEL_43;
      }
    }
  }

LABEL_48:
}

- (void)setImportSessionAlbumWithImportSessionID:(id)a3
{
  v23 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self managedObjectContext];
  if (v4)
  {
    v6 = [(PLManagedAsset *)self importSession];
    v7 = [v6 importSessionID];
    v8 = [v7 isEqualToString:v4];

    if (v8)
    {
LABEL_18:

      goto LABEL_19;
    }

    v9 = [v5 userInfo];
    v10 = [v9 objectForKeyedSubscript:@"importSessionObjectIDCache"];

    if (!v10)
    {
      v10 = [MEMORY[0x1E695DF90] dictionary];
      v11 = [v5 userInfo];
      [v11 setObject:v10 forKeyedSubscript:@"importSessionObjectIDCache"];
    }

    v12 = [v10 objectForKeyedSubscript:v4];
    if (v12 && ([v5 objectRegisteredForID:v12], (v13 = objc_claimAutoreleasedReturnValue()) != 0) || (+[PLImportSession albumWithImportSessionID:inManagedObjectContext:](PLImportSession, "albumWithImportSessionID:inManagedObjectContext:", v4, v5), (v13 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v14 = v13;
      v15 = PLBackendGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = [(PLManagedAsset *)self uuid];
        *v21 = 138412546;
        *&v21[4] = v4;
        *&v21[12] = 2112;
        *&v21[14] = v16;
        v17 = "Found importSessionAlbum (%@) for asset uuid %@";
LABEL_12:
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_INFO, v17, v21, 0x16u);
      }
    }

    else
    {
      v14 = [PLImportSession insertNewImportSessionAlbumWithImportSessionID:v4 inManagedObjectContext:v5];
      v15 = PLBackendGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v16 = [(PLManagedAsset *)self uuid];
        *v21 = 138412546;
        *&v21[4] = v4;
        *&v21[12] = 2112;
        *&v21[14] = v16;
        v17 = "Created importSessionAlbum (%@) for asset uuid %@";
        goto LABEL_12;
      }
    }

    if (v6)
    {
      v18 = PLBackendGetLog();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
      {
        v19 = [(PLManagedAsset *)self uuid];
        *v21 = 138412802;
        *&v21[4] = v6;
        *&v21[12] = 2112;
        *&v21[14] = v4;
        *&v21[22] = 2112;
        v22 = v19;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEFAULT, "Changed importSessionAlbum (%@) to (%@) for asset uuid %@", v21, 0x20u);
      }
    }

    [(PLManagedAsset *)self setImportSession:v14, *v21, *&v21[16]];
    [v14 updateImportDatesFromAddedAsset:self];
    v20 = [v14 objectID];
    [v10 setObject:v20 forKeyedSubscript:v4];

    goto LABEL_18;
  }

LABEL_19:
}

- (PLRevGeoLocationInfo)locationInfo
{
  v2 = [(PLManagedAsset *)self reverseLocationData];
  v3 = [PLRevGeoLocationInfo infoFromPlistData:v2];

  return v3;
}

- (PLRevGeoPlaceAnnotation)placeAnnotation
{
  v14 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self placeAnnotationData];
  if (v3)
  {
    v9 = 0;
    v4 = [MEMORY[0x1E696ACD0] unarchivedObjectOfClass:objc_opt_class() fromData:v3 error:&v9];
    v5 = v9;
    if (!v4)
    {
      v6 = PLBackendGetLog();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        v7 = [(PLManagedAsset *)self uuid];
        *buf = 138543618;
        v11 = v7;
        v12 = 2114;
        v13 = v5;
        _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "Failed to read placeAnnotation from asset with ID %{public}@, error:%{public}@", buf, 0x16u);
      }
    }
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_sizeOfVideoPreviewForAVAsset:(id)a3
{
  v28 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v5 = 2;
  }

  else
  {
    v5 = 0;
  }

  v24[0] = MEMORY[0x1E69E9820];
  v24[1] = 3221225472;
  v24[2] = __48__PLManagedAsset__sizeOfVideoPreviewForAVAsset___block_invoke;
  v24[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  v25 = v5;
  v6 = [(PLManagedAsset *)self firstPersistedResourceMatching:v24];
  v7 = v6;
  v8 = *MEMORY[0x1E695F060];
  v9 = *(MEMORY[0x1E695F060] + 8);
  if (v6)
  {
    v10 = [v6 orientedWidth];
    v11 = [v7 orientedHeight];
  }

  else
  {
    [PLManagedAsset dimensionsForAVAsset:v4];
    if (v12 <= 0.0 || (v14 = v13, v13 <= 0.0))
    {
      v19 = PLThumbnailsGetLog();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        v20 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v27 = v20;
        _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Asset %{public}@ attempting to size preview image for video with 0 dimensions", buf, 0xCu);
      }

      v11 = v9;
      v10 = v8;
    }

    else
    {
      v10 = v12;
      [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:4];
      PFScaleFactorForMaximumPixelCount();
      v16 = v15 < 1.0;
      v17 = v10 * v15;
      v18 = v14 * v15;
      if (v16)
      {
        v11 = v18;
      }

      else
      {
        v11 = v14;
      }

      if (v16)
      {
        v10 = v17;
      }
    }
  }

  if (v10 == v8 && v11 == v9)
  {
    v22 = 0;
  }

  else
  {
    v22 = DCIM_NSValueFromCGSize();
  }

  return v22;
}

BOOL __48__PLManagedAsset__sizeOfVideoPreviewForAVAsset___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 recipeID] == 65741 && objc_msgSend(v3, "version") == *(a1 + 32);

  return v4;
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 metadata:(id)a7 forceSRGBConversion:(BOOL)a8 forFinalCameraImage:(BOOL)a9 saveCameraPreviewWellImage:(BOOL)a10 reduceProcessingForIngest:(BOOL)a11
{
  v94[1] = *MEMORY[0x1E69E9840];
  v15 = a3;
  v16 = a4;
  v17 = a6;
  v77 = a7;
  context = objc_autoreleasePoolPush();
  if (!(v15 | v16) && [(PLManagedAsset *)self resetVideoKeyFrameTimeAndDeleteKeyFrameResource])
  {
    v18 = PLThumbnailsGetLog();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      v19 = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      v88 = v19;
      _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_INFO, "Reset media analysis key frame due to generating thumbs for asset %{public}@", buf, 0xCu);
    }
  }

  v20 = PLThumbnailsGetLog();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
  {
    v21 = [(PLManagedAsset *)self uuid];
    *buf = 138412290;
    v88 = v21;
    _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "[RM]: generating and updating thumbnails for asset %@", buf, 0xCu);
  }

  v22 = [(PLManagedObject *)self photoLibrary];
  v23 = [v22 thumbnailManager];

  v24 = [(PLManagedAsset *)self effectiveThumbnailIndex];
  if (![(PLManagedAsset *)self hasAllThumbs])
  {
    v25 = [(PLManagedObject *)self photoLibrary];
    v24 = [PLThumbnailIndexes nextAvailableThumbnailIndexInLibrary:v25];
  }

  [(PLManagedAsset *)self setEffectiveThumbnailIndex:v24];
  v26 = PLThumbnailsGetLog();
  v73 = v23;
  if (os_log_type_enabled(v26, OS_LOG_TYPE_DEBUG))
  {
    [(PLManagedAsset *)self uuid];
    v28 = v27 = v17;
    *buf = 138412546;
    v88 = v28;
    v89 = 2048;
    v90 = v24;
    _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_DEBUG, "[RM]: setting effective thumbnail index for %@ at index %lu", buf, 0x16u);

    v17 = v27;
    v23 = v73;
  }

  v70 = v16;
  if (![(PLManagedAsset *)self isVideo])
  {
    goto LABEL_16;
  }

  v29 = [(PLManagedObject *)self photoLibrary];
  if ([v29 isCloudPhotoLibraryEnabled])
  {
    v30 = [(PLManagedAsset *)self isCloudSharedAsset];

    if (v30 || [(PLManagedAsset *)self hasLargerThanThumbResourceLocal])
    {
LABEL_16:
      v31 = 0;
      goto LABEL_19;
    }

    v29 = [(PLManagedAsset *)self pathForVideoFile];
    if (v29)
    {
      v48 = [MEMORY[0x1E696AC08] defaultManager];
      v49 = v17;
      v50 = [v48 fileExistsAtPath:v29 isDirectory:0];

      v31 = v50 ^ 1;
      v17 = v49;
      v23 = v73;
    }

    else
    {
      v31 = 1;
    }
  }

  else
  {
    v31 = 0;
  }

LABEL_19:
  v86 = 0;
  if ((![(PLManagedAsset *)self isVideo]|| ![(PLManagedAsset *)self isBundleScopeSyndication]) && ![(PLManagedAsset *)self isPhoto]&& (([(PLManagedAsset *)self isStreamedVideo]| v31) & 1) == 0 && ![(PLManagedAsset *)self hasUnrenderedAsyncAdjustments])
  {
    if (![(PLManagedAsset *)self isVideo])
    {
      v41 = v70;
      goto LABEL_54;
    }

    if (v15 && v70)
    {
      v40 = 0;
      v41 = v70;
    }

    else
    {
      v61 = v17;
      v62 = [(PLManagedAsset *)self pathForVideoFile];
      v82 = v70;
      v83 = v15;
      v81[0] = MEMORY[0x1E69E9820];
      v81[1] = 3221225472;
      v81[2] = __205__PLManagedAsset_generateAndUpdateThumbnailsWithPreviewImage_thumbnailImage_fromImageSource_imageData_metadata_forceSRGBConversion_forFinalCameraImage_saveCameraPreviewWellImage_reduceProcessingForIngest___block_invoke;
      v81[3] = &unk_1E75676F8;
      v81[4] = self;
      PLPreviewImageAndDurationForVideoAtPathWithPreferredTime(0, v62, &v83, &v82, v81);
      v63 = v83;

      v41 = v82;
      if (v63)
      {
        v40 = 0;
        v15 = v63;
        v17 = v61;
      }

      else
      {
        v64 = [(PLManagedAsset *)self imageDataForThumbGenerationAndIfNeededRAWUTI:0 isPreviewSource:0];
        v40 = v64;
        if (v64)
        {
          v65 = v64;
          v15 = DCIM_newPLImageWithData();
        }

        else
        {
          v15 = 0;
        }

        v17 = v61;
      }
    }

    v66 = [(PLManagedAsset *)self pathForVideoPreviewFile];
    PLWriteImageWithEmbeddedThumbnailToPath(v15, v41, v66);

    v39 = [(PLManagedAsset *)self fileURLForThumbnailFile];
    [PLManagedAsset createTHMFileWithPreviewImage:v15 thumbnailImage:v41 fileURLForThumbnailFile:v39];
    v23 = v73;
    goto LABEL_43;
  }

  v32 = a5;
  if (!a5)
  {
    if (v17)
    {
      v33 = 0;
      v34 = 0;
    }

    else
    {
      v85 = 0;
      v17 = [(PLManagedAsset *)self imageDataForThumbGenerationAndIfNeededRAWUTI:&v85 isPreviewSource:&v86];
      v37 = v85;
      v34 = v37;
      if (!v17)
      {
        v36 = 0;
LABEL_36:

        v32 = v36;
        goto LABEL_37;
      }

      if (v37)
      {
        v93 = *MEMORY[0x1E696E118];
        v94[0] = v37;
        v33 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v94 forKeys:&v93 count:1];
      }

      else
      {
        v33 = 0;
      }
    }

    v35 = CGImageSourceCreateWithData(v17, v33);
    if (v35)
    {
      v36 = v35;
      CFAutorelease(v35);
    }

    else
    {
      v36 = 0;
      v75 = v17;
      v38 = PLThumbnailsGetLog();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_ERROR))
      {
        v68 = [(__CFData *)v75 length];
        v69 = [(PLManagedAsset *)self _compactDebugDescription];
        *buf = 134218498;
        v88 = v75;
        v23 = v73;
        v89 = 2048;
        v90 = v68;
        v91 = 2114;
        v92 = v69;
        _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_ERROR, "Unable to generate image source from data %p (length %lu) for asset %{public}@", buf, 0x20u);
      }

      v17 = v75;
    }

    goto LABEL_36;
  }

LABEL_37:
  a5 = v32;
  if (v15 || a11)
  {
    LOBYTE(v67) = v86;
    [PLManagedAsset generateThumbnailsWithImageSource:"generateThumbnailsWithImageSource:imageData:metadata:allowMediumPreview:forceSRGBConversion:forFinalCameraImage:outSmallThumbnailData:isPreviewSource:" imageData:0 metadata:v67 allowMediumPreview:? forceSRGBConversion:? forFinalCameraImage:? outSmallThumbnailData:? isPreviewSource:?];
    v39 = 0;
    if (!v31)
    {
      goto LABEL_40;
    }
  }

  else
  {
    v84 = 0;
    LOBYTE(v67) = v86;
    [PLManagedAsset generateThumbnailsWithImageSource:"generateThumbnailsWithImageSource:imageData:metadata:allowMediumPreview:forceSRGBConversion:forFinalCameraImage:outSmallThumbnailData:isPreviewSource:" imageData:&v84 metadata:v67 allowMediumPreview:? forceSRGBConversion:? forFinalCameraImage:? outSmallThumbnailData:? isPreviewSource:?];
    v39 = v84;
    v15 = DCIM_newPLImageWithData();
    if (!v31)
    {
LABEL_40:
      v40 = v39;
      v41 = v70;
      goto LABEL_43;
    }
  }

  [(PLManagedAsset *)self fileURLForThumbnailFile];
  v43 = v42 = v17;
  v41 = v70;
  [PLManagedAsset createTHMFileWithPreviewImage:v15 thumbnailImage:v70 fileURLForThumbnailFile:v43];

  v17 = v42;
  v23 = v73;
  v40 = v39;
LABEL_43:

  if (v40)
  {
    v44 = [PLImageContainer alloc];
    v45 = 0;
LABEL_45:
    v46 = [*MEMORY[0x1E6982E58] identifier];
    v47 = [(PLImageContainer *)v44 initWithPLImage:v15 backingData:v40 uniformTypeIdentifier:v46 auxiliaryImageRecords:v45];

    goto LABEL_61;
  }

LABEL_54:
  v40 = DCIM_storedJPEGDataFromImage();
  v45 = [MEMORY[0x1E69C0708] auxiliaryImageRecordsToPreserveForDerivativesFromPrimaryImageInImageSource:a5];
  if (v15 | v40)
  {
    v44 = [PLImageContainer alloc];
    if (v40)
    {
      goto LABEL_45;
    }
  }

  else
  {
    v51 = PLThumbnailsGetLog();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
    {
      v52 = [(PLManagedAsset *)self _compactDebugDescription];
      *buf = 138543362;
      v88 = v52;
      _os_log_impl(&dword_19BF1F000, v51, OS_LOG_TYPE_ERROR, "Missing preview image and data to set as thumbnail for asset %{public}@", buf, 0xCu);
    }

    v44 = [PLImageContainer alloc];
  }

  v47 = [(PLImageContainer *)v44 initWithPLImage:v15 backingData:0 uniformTypeIdentifier:0 auxiliaryImageRecords:v45];
  v40 = 0;
LABEL_61:
  [v23 setThumbnailsForAsset:self withImage:v47];
  if (a10)
  {
    v53 = [(PLManagedObject *)self photoLibrary];
    v54 = [v53 libraryServicesManager];
    if (![v54 isSystemPhotoLibrary] || !PLCameraPreviewWellSupportedOnCurrentDevice())
    {
LABEL_75:

      goto LABEL_76;
    }

    [(PLManagedObject *)self photoLibrary];
    v55 = v76 = v17;
    [v55 thumbnailManager];
    v56 = v41;
    v58 = v57 = v15;
    v71 = [v58 isRebuildingThumbnails];

    v15 = v57;
    v41 = v56;
    v23 = v73;

    v17 = v76;
    if ((v71 & 1) == 0)
    {
      v53 = [(PLManagedObject *)self photoLibrary];
      v59 = [v53 libraryServicesManager];
      v54 = [v59 cameraPreviewWellManager];

      if ([v54 shouldReconsiderCameraPreviewWellImageForUpdatedAsset:self thumbnailWasGenerated:1])
      {
        v60 = [v53 managedObjectContext];
        if ([v53 pendingTransactions])
        {
          v78[0] = MEMORY[0x1E69E9820];
          v78[1] = 3221225472;
          v78[2] = __205__PLManagedAsset_generateAndUpdateThumbnailsWithPreviewImage_thumbnailImage_fromImageSource_imageData_metadata_forceSRGBConversion_forFinalCameraImage_saveCameraPreviewWellImage_reduceProcessingForIngest___block_invoke_431;
          v78[3] = &unk_1E7578848;
          v79 = v54;
          v80 = v60;
          [v53 addCompletionHandlerToCurrentTransaction:v78];
        }

        else
        {
          [v54 refreshPreviewWellImageWithContext:v60 avoidNotificationIfLinkIsAlreadySet:0];
        }

        v23 = v73;
      }

      else
      {
        v23 = v73;
      }

      goto LABEL_75;
    }
  }

LABEL_76:

  objc_autoreleasePoolPop(context);
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 metadata:(id)a7 forceSRGBConversion:(BOOL)a8 saveCameraPreviewWellImage:(BOOL)a9
{
  BYTE2(v9) = 0;
  BYTE1(v9) = a9;
  LOBYTE(v9) = 0;
  [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:a3 fromImageSource:a4 imageData:a5 metadata:a6 forceSRGBConversion:a7 forFinalCameraImage:a8 saveCameraPreviewWellImage:v9 reduceProcessingForIngest:?];
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 forceSRGBConversion:(BOOL)a7 reduceProcessingForIngest:(BOOL)a8
{
  BYTE2(v8) = a8;
  LOWORD(v8) = 256;
  [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:a3 fromImageSource:a4 imageData:a5 metadata:a6 forceSRGBConversion:0 forFinalCameraImage:a7 saveCameraPreviewWellImage:v8 reduceProcessingForIngest:?];
}

- (void)generateAndUpdateThumbnailsWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fromImageSource:(CGImageSource *)a5 imageData:(id)a6 forceSRGBConversion:(BOOL)a7
{
  BYTE2(v7) = 0;
  LOWORD(v7) = 256;
  [PLManagedAsset generateAndUpdateThumbnailsWithPreviewImage:"generateAndUpdateThumbnailsWithPreviewImage:thumbnailImage:fromImageSource:imageData:metadata:forceSRGBConversion:forFinalCameraImage:saveCameraPreviewWellImage:reduceProcessingForIngest:" thumbnailImage:a3 fromImageSource:a4 imageData:a5 metadata:a6 forceSRGBConversion:0 forFinalCameraImage:a7 saveCameraPreviewWellImage:v7 reduceProcessingForIngest:?];
}

- (void)setThumbnailDataFromImageProperties:(id)a3
{
  v12 = [a3 objectForKey:*MEMORY[0x1E696D9B0]];
  v4 = [v12 objectForKey:*MEMORY[0x1E696E060]];
  v5 = [v12 objectForKey:*MEMORY[0x1E696E068]];
  v6 = [(PLManagedAsset *)self additionalAttributes];
  [v6 setEmbeddedThumbnailOffset:v4];

  v7 = [(PLManagedAsset *)self additionalAttributes];
  [v7 setEmbeddedThumbnailLength:v5];

  v8 = [v12 objectForKey:@"JPEGInterchangeFormatWidth"];
  v9 = [v12 objectForKey:@"JPEGInterchangeFormatHeight"];
  v10 = [(PLManagedAsset *)self additionalAttributes];
  [v10 setEmbeddedThumbnailWidth:v8];

  v11 = [(PLManagedAsset *)self additionalAttributes];
  [v11 setEmbeddedThumbnailHeight:v9];
}

- (id)thumbnailIdentifier
{
  v3 = [(PLManagedAsset *)self uuid];
  v4 = [(PLManagedAsset *)self directory];
  v5 = [(PLManagedAsset *)self filename];
  v6 = [(PLManagedAsset *)self bundleScope];
  v7 = [(PLManagedObject *)self pathManager];
  v8 = [PLThumbnailManager thumbnailIdentifierWithAssetUUID:v3 directory:v4 filename:v5 bundleScope:v6 pathManager:v7];

  return v8;
}

- (BOOL)hasMasterThumb
{
  v3 = objc_opt_class();
  v4 = [(PLManagedAsset *)self thumbnailIndex];

  return [v3 hasMasterThumbWithThumbnailIndex:v4];
}

- (BOOL)hasAllThumbs
{
  v3 = objc_opt_class();
  v4 = [(PLManagedAsset *)self thumbnailIndex];

  return [v3 hasAllThumbsWithThumbnailIndex:v4];
}

- (void)setEffectiveThumbnailIndex:(unint64_t)a3
{
  v5 = [(PLManagedAsset *)self thumbnailIndex];
  if (a3 > 0x989680)
  {
    a3 = 0xFFFFFFFFLL;
  }

  else
  {
    a3 = a3;
  }

  [(PLManagedAsset *)self setThumbnailIndex:a3];
  if ((a3 & 0x80000000) != 0 || v5 != -2)
  {

    [(PLManagedAsset *)self recalculateImageRequestHints];
  }

  else
  {

    [(PLManagedAsset *)self insertTableThumbImageRequestHints];
  }
}

- (unint64_t)effectiveThumbnailIndex
{
  LODWORD(result) = [(PLManagedAsset *)self thumbnailIndex];
  if ((result & 0x80000000) != 0)
  {
    return 0x7FFFFFFFFFFFFFFFLL;
  }

  else
  {
    return result;
  }
}

- (unint64_t)syndicationProcessingVersion
{
  v2 = [(PLManagedAsset *)self mediaAnalysisAttributes];
  v3 = [v2 syndicationProcessingVersion];

  return v3;
}

- (unsigned)syndicationProcessingValue
{
  v2 = [(PLManagedAsset *)self mediaAnalysisAttributes];
  v3 = [v2 syndicationProcessingValue];

  return v3;
}

- (id)mediaAnalysisAttributesInsertingIfNecessary
{
  v10 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self mediaAnalysisAttributes];
  if (!v3)
  {
    v4 = PLBackendGetLog();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_FAULT))
    {
      v5 = [(PLManagedAsset *)self uuidDescription];
      v8 = 138412290;
      v9 = v5;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_FAULT, "mediaAnalysisAttributes is unexpectedly nil for asset: %@", &v8, 0xCu);
    }

    v6 = [(PLManagedAsset *)self managedObjectContext];
    v3 = [(PLManagedObject *)PLMediaAnalysisAssetAttributes insertInManagedObjectContext:v6];

    [(PLManagedAsset *)self setMediaAnalysisAttributes:v3];
  }

  return v3;
}

- (unsigned)syndicationHistory
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 syndicationHistory];

  return v3;
}

- (void)setImportedByBundleIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setImportedByBundleIdentifier:v4];
}

- (NSString)importedByBundleIdentifier
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 importedByBundleIdentifier];

  return v3;
}

- (void)setShiftedLocationIsValid:(BOOL)a3
{
  v3 = a3;
  v4 = [(PLManagedAsset *)self additionalAttributes];
  [v4 setShiftedLocationIsValid:v3];
}

- (BOOL)shiftedLocationIsValid
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 shiftedLocationIsValid];

  return v3;
}

- (void)setShiftedLocation:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setShiftedLocation:v4];
}

- (CLLocation)shiftedLocation
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 shiftedLocation];

  return v3;
}

- (void)setImportedBy:(signed __int16)a3
{
  v3 = a3;
  v4 = [(PLManagedAsset *)self additionalAttributes];
  [v4 setImportedBy:v3];
}

- (signed)importedBy
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 importedBy];

  return v3;
}

- (void)setPlaceAnnotationData:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setPlaceAnnotationData:v4];
}

- (NSData)placeAnnotationData
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 placeAnnotationData];

  return v3;
}

- (void)setReverseLocationDataIsValid:(BOOL)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithBool:v3];
  [v5 setReverseLocationDataIsValid:v4];
}

- (BOOL)reverseLocationDataIsValid
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 reverseLocationDataIsValid];
  v4 = [v3 BOOLValue];

  return v4;
}

- (void)setReverseLocationData:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setReverseLocationData:v4];
}

- (NSData)reverseLocationData
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 reverseLocationData];

  return v3;
}

- (void)_handleHighlightRelationshipChangeForKey:(id)a3 forAssetCountKey:(id)a4 newValue:(id)a5
{
  v9 = a3;
  v10 = a4;
  v11 = a5;
  if (v9)
  {
    if (v10)
    {
      goto LABEL_3;
    }
  }

  else
  {
    v23 = [MEMORY[0x1E696AAA8] currentHandler];
    [v23 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:1181 description:{@"Invalid parameter not satisfying: %@", @"key"}];

    if (v10)
    {
      goto LABEL_3;
    }
  }

  v24 = [MEMORY[0x1E696AAA8] currentHandler];
  [v24 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:1182 description:{@"Invalid parameter not satisfying: %@", @"countKey"}];

LABEL_3:
  v12 = [(PLManagedObject *)self photoLibrary];
  v13 = [(PLManagedAsset *)self hasLibraryScope];
  v14 = [(PLManagedAsset *)self libraryScopeShareState];
  v15 = 1;
  if (v14 > 65537)
  {
    if (v14 != 65538 && v14 != 65552)
    {
      goto LABEL_9;
    }
  }

  else if (v14 != 2 && v14 != 16)
  {
LABEL_9:
    v15 = 0;
  }

  v16 = [v12 libraryServicesManager];
  v17 = [v16 databaseContext];
  v18 = [v17 momentLibrary];
  v19 = v12 == v18;

  v25[0] = MEMORY[0x1E69E9820];
  v25[1] = 3221225472;
  v25[2] = __85__PLManagedAsset__handleHighlightRelationshipChangeForKey_forAssetCountKey_newValue___block_invoke;
  v25[3] = &unk_1E75676D0;
  v30 = v19;
  v31 = v13;
  v32 = v15;
  v26 = v9;
  v27 = self;
  v28 = v11;
  v29 = v10;
  v20 = v10;
  v21 = v11;
  v22 = v9;
  [(PLManagedObject *)self pl_safeSetValue:v21 forKey:v22 valueDidChangeHandler:v25];
}

void __85__PLManagedAsset__handleHighlightRelationshipChangeForKey_forAssetCountKey_newValue___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (*(a1 + 64) == 1)
  {
    v10 = v3;
    v4 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
    [(PLSharedAssetsContainerIncrementalChange *)v4 setCollectionChangeType:1];
    if (*(a1 + 65))
    {
      v5 = 1;
    }

    else
    {
      v5 = 2;
    }

    [(PLSharedAssetsContainerIncrementalChange *)v4 setSharingChange:v5];
    if ([*(a1 + 32) isEqual:@"highlightBeingAssets"])
    {
      if (*(a1 + 66))
      {
        v6 = 1;
      }

      else
      {
        v6 = 2;
      }

      [(PLSharedAssetsContainerIncrementalChange *)v4 setSuggestionStateChange:v6];
    }

    -[PLSharedAssetsContainerIncrementalChange setMediaType:](v4, "setMediaType:", [*(a1 + 40) kind] != 0);
    [*(a1 + 48) reportSharedAssetContainerIncrementalChange:v4 forAllAssetsCountKey:*(a1 + 56)];

    v3 = v10;
    if (*(a1 + 64))
    {
      v7 = objc_alloc_init(PLSharedAssetsContainerIncrementalChange);
      [(PLSharedAssetsContainerIncrementalChange *)v7 setCollectionChangeType:2];
      if (*(a1 + 65))
      {
        v8 = 1;
      }

      else
      {
        v8 = 2;
      }

      [(PLSharedAssetsContainerIncrementalChange *)v7 setSharingChange:v8];
      if ([*(a1 + 32) isEqual:@"highlightBeingAssets"])
      {
        if (*(a1 + 66))
        {
          v9 = 1;
        }

        else
        {
          v9 = 2;
        }

        [(PLSharedAssetsContainerIncrementalChange *)v7 setSuggestionStateChange:v9];
      }

      -[PLSharedAssetsContainerIncrementalChange setMediaType:](v7, "setMediaType:", [*(a1 + 40) kind] != 0);
      [v10 reportSharedAssetContainerIncrementalChange:v7 forAllAssetsCountKey:*(a1 + 56)];

      v3 = v10;
    }
  }
}

- (BOOL)isSuggestedForSharingByPhotos
{
  v2 = [(PLManagedAsset *)self libraryScopeShareState];
  result = 1;
  if (v2 > 65537)
  {
    if (v2 != 65538 && v2 != 65552)
    {
      return 0;
    }
  }

  else if (v2 != 2 && v2 != 16)
  {
    return 0;
  }

  return result;
}

- (BOOL)hasLibraryScope
{
  v2 = [(PLManagedAsset *)self objectIDsForRelationshipNamed:@"libraryScope"];
  v3 = [v2 count] != 0;

  return v3;
}

- (NSString)originalFilename
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalFilename];

  return v3;
}

- (BOOL)isWalrusEnabled
{
  if ((MEMORY[0x19EAEE520]() & 1) == 0)
  {
    v5 = [MEMORY[0x1E696AAA8] currentHandler];
    [v5 handleFailureInMethod:a2 object:self file:@"PLManagedAsset.m" lineNumber:1160 description:{@"Invalid parameter not satisfying: %@", @"PLIsXcTest()"}];
  }

  return 0;
}

- (id)libraryID
{
  v2 = [(PLManagedObject *)self photoLibrary];
  v3 = [v2 libraryID];

  return v3;
}

- (PLManagedAssetID)assetID
{
  assetID = self->_assetID;
  if (!assetID)
  {
    v4 = [[PLManagedAssetID alloc] initWithManagedAsset:self];
    v5 = self->_assetID;
    self->_assetID = v4;

    assetID = self->_assetID;
  }

  return assetID;
}

- (CGSize)unorientedSize
{
  v3 = [(PLManagedAsset *)self width];
  v4 = [(PLManagedAsset *)self height];
  v5 = [(PLManagedAsset *)self orientation];
  if (v5 == 8 || v5 == 6)
  {
    v6 = v4;
    v7 = v3;
    v8 = 1;
LABEL_4:
    v9 = v6;
    goto LABEL_5;
  }

  v10 = v5 - 5;
  v8 = v10 < 4;
  v6 = v4;
  v7 = v3;
  v9 = v3;
  if (v10 <= 3)
  {
    goto LABEL_4;
  }

LABEL_5:
  if (v8)
  {
    v6 = v7;
  }

  result.height = v6;
  result.width = v9;
  return result;
}

- (void)setHeight:(int64_t)a3
{
  [(PLManagedAsset *)self willChangeValueForKey:@"height"];
  self->_height = a3;

  [(PLManagedAsset *)self didChangeValueForKey:@"height"];
}

- (int64_t)height
{
  [(PLManagedAsset *)self willAccessValueForKey:@"height"];
  height = self->_height;
  [(PLManagedAsset *)self didAccessValueForKey:@"height"];
  return height;
}

- (void)setWidth:(int64_t)a3
{
  [(PLManagedAsset *)self willChangeValueForKey:@"width"];
  self->_width = a3;

  [(PLManagedAsset *)self didChangeValueForKey:@"width"];
}

- (int64_t)width
{
  [(PLManagedAsset *)self willAccessValueForKey:@"width"];
  width = self->_width;
  [(PLManagedAsset *)self didAccessValueForKey:@"width"];
  return width;
}

- (NSSet)allDetectedFaces
{
  v3 = [(PLManagedAsset *)self detectedFaces];
  v4 = [v3 mutableCopy];

  v5 = [(PLManagedAsset *)self temporalDetectedFaces];
  [v4 unionSet:v5];

  v6 = [v4 copy];

  return v6;
}

- (void)didTurnIntoFault
{
  reverseGeoDescription = self->_reverseGeoDescription;
  self->_reverseGeoDescription = 0;

  self->_isLocatedAtHome = 0;
  self->_didLoadReverseGeo = 0;
  v4.receiver = self;
  v4.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v4 didTurnIntoFault];
}

- (void)willTurnIntoFault
{
  [(PLManagedAsset *)self unregisterForChanges];
  v3.receiver = self;
  v3.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v3 willTurnIntoFault];
}

- (void)awakeFromFetch
{
  v3.receiver = self;
  v3.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v3 awakeFromFetch];
  [(PLManagedAsset *)self registerForChanges];
}

- (void)awakeFromInsert
{
  v8.receiver = self;
  v8.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v8 awakeFromInsert];
  v3 = [MEMORY[0x1E69BF320] UUIDString];
  [(PLManagedAsset *)self setUuid:v3];

  [(PLManagedAsset *)self setKind:3];
  [(PLManagedAsset *)self setPlaybackStyle:0];
  [(PLManagedAsset *)self setHdrType:0];
  -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForAwakeFromInsert]);
  [(PLManagedAsset *)self setTrashedState:0];
  v4 = [MEMORY[0x1E695DF00] date];
  [(PLManagedAsset *)self setAddedDate:v4];

  v5 = [(PLManagedAsset *)self managedObjectContext];
  v6 = [(PLManagedObject *)PLAdditionalAssetAttributes insertInManagedObjectContext:v5];
  if (v6)
  {
    [(PLManagedAsset *)self setAdditionalAttributes:v6];
    v7 = [(PLManagedObject *)PLMediaAnalysisAssetAttributes insertInManagedObjectContext:v5];
    if (v7)
    {
      [(PLManagedAsset *)self setMediaAnalysisAttributes:v7];
      [(PLManagedAsset *)self registerForChanges];
      [(PLManagedAsset *)self setComplete:1];
    }
  }
}

- (void)dealloc
{
  [(PLManagedAsset *)self unregisterForChanges];
  reverseGeoDescription = self->_reverseGeoDescription;
  self->_reverseGeoDescription = 0;

  v4.receiver = self;
  v4.super_class = PLManagedAsset;
  [(PLManagedAsset *)&v4 dealloc];
}

+ (id)attributeValidationRules
{
  v84[2] = *MEMORY[0x1E69E9840];
  v2 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v71 = [MEMORY[0x1E695DF00] date];
  v3 = _PLPropertyValidationRuleMake(5, @"addedDate", 0, 0, v71, 0);
  [v2 setObject:v3 forKeyedSubscript:@"addedDate"];

  v4 = _PLPropertyValidationRuleMake(3, @"adjustmentsState", &unk_1F0FBB308, 0, 0, 0);
  v5 = _PLPropertyValidationRuleMake(9, @"adjustmentTimestamp", 0, 0, 0, 0);
  v6 = v4;
  v70 = v4;
  v7 = [v4 reverseRule];
  v84[0] = v7;
  v84[1] = v5;
  v69 = v5;
  v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v84 count:2];
  v68 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v8];

  v83[0] = v6;
  v9 = [v5 reverseRule];
  v83[1] = v9;
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v83 count:2];
  v67 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v10];

  v82[0] = v68;
  v82[1] = v67;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v82 count:2];
  v12 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v11];
  [v2 setObject:v12 forKeyedSubscript:@"adjustmentTimestamp"];

  v13 = _PLPropertyValidationRuleMake(3, @"complete", MEMORY[0x1E695E118], 0, 0, 0);
  [v2 setObject:v13 forKeyedSubscript:@"complete"];

  v14 = _PLPropertyValidationRuleMake(5, @"dateCreated", 0, 0, v71, 0);
  [v2 setObject:v14 forKeyedSubscript:@"dateCreated"];

  v15 = _PLPropertyValidationRuleMake(2, @"directory", 0, 0, 0, 0);
  [v2 setObject:v15 forKeyedSubscript:@"directory"];

  v16 = _PLPropertyValidationRuleMake(2, @"filename", 0, 0, 0, 0);
  [v2 setObject:v16 forKeyedSubscript:@"filename"];

  v17 = _PLPropertyValidationRuleMake(6, @"kind", 0, 0, 0, &unk_1F0FBF4C0);
  v66 = _PLPropertyValidationRuleMake(4, @"height", &unk_1F0FBB0B0, 0, 0, 0);
  v65 = _PLPropertyValidationRuleMake(4, @"width", &unk_1F0FBB0B0, 0, 0, 0);
  v81[0] = v17;
  v81[1] = v66;
  v18 = v17;
  v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:v81 count:2];
  v64 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v19];

  v80[0] = v18;
  v80[1] = v65;
  v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v80 count:2];
  v62 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v20];

  v79[0] = v64;
  v21 = v18;
  v63 = v18;
  v22 = [v18 reverseRule];
  v79[1] = v22;
  v23 = [MEMORY[0x1E695DEC8] arrayWithObjects:v79 count:2];
  v24 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v23];
  [v2 setObject:v24 forKeyedSubscript:@"height"];

  v78[0] = v62;
  v25 = [v21 reverseRule];
  v78[1] = v25;
  v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:v78 count:2];
  v27 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v26];
  [v2 setObject:v27 forKeyedSubscript:@"width"];

  v28 = _PLPropertyValidationRuleMake(6, @"kind", 0, 0, 0, &unk_1F0FBF4D8);
  [v2 setObject:v28 forKeyedSubscript:@"kind"];

  v29 = _PLPropertyValidationRuleMake(6, @"kindSubtype", 0, 0, 0, &unk_1F0FBF4F0);
  [v2 setObject:v29 forKeyedSubscript:@"kindSubtype"];

  v30 = _PLPropertyValidationRuleMake(12, @"lastSharedDate", 0, 0, v71, 0);
  [v2 setObject:v30 forKeyedSubscript:@"lastSharedDate"];

  v31 = _PLPropertyValidationRuleMake(12, @"modificationDate", 0, 0, v71, 0);
  [v2 setObject:v31 forKeyedSubscript:@"modificationDate"];

  v32 = _PLPropertyValidationRuleMake(5, @"orientation", 0, &unk_1F0FBB308, &unk_1F0FBB398, 0);
  [v2 setObject:v32 forKeyedSubscript:@"orientation"];

  v33 = _PLPropertyValidationRuleMake(6, @"playbackStyle", 0, 0, 0, &unk_1F0FBF508);
  [v2 setObject:v33 forKeyedSubscript:@"playbackStyle"];

  v34 = _PLPropertyValidationRuleMake(6, @"playbackVariation", 0, 0, 0, &unk_1F0FBF520);
  [v2 setObject:v34 forKeyedSubscript:@"playbackVariation"];

  v61 = [MEMORY[0x1E69BF328] predicateArrayArgumentForMask:{objc_msgSend(MEMORY[0x1E69BF328], "maskForValidSavedAssetTypesDuringMacMigration")}];
  v35 = _PLPropertyValidationRuleMake(6, @"savedAssetType", 0, 0, 0, v61);
  [v2 setObject:v35 forKeyedSubscript:@"savedAssetType"];

  v36 = _PLPropertyValidationRuleMake(3, @"trashedState", &unk_1F0FBB110, 0, 0, 0);
  v37 = _PLPropertyValidationRuleMake(9, @"trashedDate", 0, 0, 0, 0);
  v77[0] = v36;
  v77[1] = v37;
  v60 = v36;
  v38 = [MEMORY[0x1E695DEC8] arrayWithObjects:v77 count:2];
  v59 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v38];

  v39 = [v36 reverseRule];
  v76[0] = v39;
  v40 = [v37 reverseRule];
  v76[1] = v40;
  v41 = [MEMORY[0x1E695DEC8] arrayWithObjects:v76 count:2];
  v58 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v41];

  v75[0] = v59;
  v75[1] = v58;
  v42 = [MEMORY[0x1E695DEC8] arrayWithObjects:v75 count:2];
  v43 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v42];
  [v2 setObject:v43 forKeyedSubscript:@"trashedDate"];

  v44 = _PLPropertyValidationRuleMake(6, @"trashedState", 0, 0, 0, &unk_1F0FBF538);
  [v2 setObject:v44 forKeyedSubscript:@"trashedState"];

  v45 = _PLPropertyValidationRuleMake(2, @"uniformTypeIdentifier", 0, 0, 0, 0);
  [v2 setObject:v45 forKeyedSubscript:@"uniformTypeIdentifier"];

  v46 = _PLPropertyValidationRuleMake(2, @"uuid", 0, 0, 0, 0);
  [v2 setObject:v46 forKeyedSubscript:@"uuid"];

  v47 = _PLPropertyValidationRuleMake(3, @"kindSubtype", &unk_1F0FBB0E0, 0, 0, 0);
  v48 = _PLPropertyValidationRuleMake(3, @"videoCpDurationValue", &unk_1F0FBB0B0, 0, 0, 0);
  v74[0] = v47;
  v49 = [v48 reverseRule];
  v74[1] = v49;
  v50 = [MEMORY[0x1E695DEC8] arrayWithObjects:v74 count:2];
  v51 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v50];

  v52 = [v47 reverseRule];
  v73[0] = v52;
  v73[1] = v48;
  v53 = [MEMORY[0x1E695DEC8] arrayWithObjects:v73 count:2];
  v54 = [PLCompoundPropertyValidationRule andCompoundPropertyValidationRuleWithRules:v53];

  v72[0] = v51;
  v72[1] = v54;
  v55 = [MEMORY[0x1E695DEC8] arrayWithObjects:v72 count:2];
  v56 = [PLCompoundPropertyValidationRule orCompoundPropertyValidationRuleWithRules:v55];
  [v2 setObject:v56 forKeyedSubscript:@"videoCpDurationValue"];

  return v2;
}

+ (void)batchFetchAssetsByFaceUUIDWithFaceUUIDs:(id)a3 library:(id)a4 completion:(id)a5
{
  v9 = a3;
  v10 = a4;
  v11 = a5;
  if (!v11)
  {
    v15 = [MEMORY[0x1E696AAA8] currentHandler];
    [v15 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:12130 description:@"Completion handler is mandatory"];
  }

  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke;
  v16[3] = &unk_1E7576F38;
  v17 = v10;
  v18 = v9;
  v19 = v11;
  v12 = v11;
  v13 = v9;
  v14 = v10;
  [v14 performBlockAndWait:v16];
}

void __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke(uint64_t a1)
{
  v14[1] = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) managedObjectContext];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", @"uuid", *(a1 + 40)];
  v4 = MEMORY[0x1E695D5E0];
  v5 = +[PLDetectedFace entityName];
  v6 = [v4 fetchRequestWithEntityName:v5];

  v14[0] = @"assetForFace";
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v14 count:1];
  [v6 setRelationshipKeyPathsForPrefetching:v7];

  [v6 setPredicate:v3];
  v8 = [MEMORY[0x1E695DF90] dictionary];
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke_2;
  v12[3] = &unk_1E75770B8;
  v9 = v8;
  v13 = v9;
  v10 = [v2 enumerateObjectsFromFetchRequest:v6 count:0 usingDefaultBatchSizeWithBlock:v12];
  if (v10)
  {
    (*(*(a1 + 48) + 16))();
  }

  else
  {
    v11 = [objc_alloc(MEMORY[0x1E695DF20]) initWithDictionary:v9];
    (*(*(a1 + 48) + 16))();
  }
}

void __77__PLManagedAsset_batchFetchAssetsByFaceUUIDWithFaceUUIDs_library_completion___block_invoke_2(uint64_t a1, void *a2)
{
  v5 = a2;
  v3 = [v5 associatedAssetForFaceOrTorso:1 orTemporal:1];
  if (v3)
  {
    v4 = [v5 uuid];
    [*(a1 + 32) setObject:v3 forKey:v4];
  }
}

+ (id)uuidFromAssetURL:(id)a3 fileExtension:(id *)a4 sidecarIndex:(id *)a5
{
  v46 = *MEMORY[0x1E69E9840];
  v7 = a3;
  v8 = objc_autoreleasePoolPush();
  v9 = [v7 scheme];
  if ([v9 isEqualToString:@"assets-library"])
  {
    v10 = [v7 host];
    v11 = [v10 isEqualToString:@"asset"];

    if (!v11)
    {
      goto LABEL_26;
    }

    v9 = [v7 query];
    if ([v9 length] >= 0x65)
    {

      objc_autoreleasePoolPop(v8);
      v29 = 0;
      goto LABEL_32;
    }

    v12 = [v9 componentsSeparatedByString:@"&"];
    v41 = 0u;
    v42 = 0u;
    v43 = 0u;
    v44 = 0u;
    v13 = [v12 countByEnumeratingWithState:&v41 objects:v45 count:16];
    if (v13)
    {
      v14 = v13;
      v33 = v9;
      v34 = v8;
      v35 = a4;
      v36 = a5;
      v37 = v7;
      v38 = v12;
      v39 = 0;
      v15 = 0;
      v16 = 0;
      v17 = *v42;
      while (1)
      {
        v18 = 0;
        do
        {
          if (*v42 != v17)
          {
            objc_enumerationMutation(v12);
          }

          v19 = [*(*(&v41 + 1) + 8 * v18) componentsSeparatedByString:{@"=", v33}];
          if ([v19 count] >= 2)
          {
            v20 = [v19 objectAtIndex:0];
            v21 = [v19 objectAtIndex:1];
            if ([v20 isEqualToString:@"id"])
            {
              v22 = v16;
              v16 = v21;
              goto LABEL_14;
            }

            if ([v20 isEqualToString:@"ext"])
            {
              v22 = v15;
              v15 = v21;
              goto LABEL_14;
            }

            if ([v20 isEqualToString:@"sci"])
            {
              v22 = [MEMORY[0x1E696AE88] scannerWithString:v21];
              v40 = 0;
              if ([v22 scanInt:&v40])
              {
                [MEMORY[0x1E696AD98] numberWithInt:v40];
                v23 = v16;
                v25 = v24 = v15;

                v39 = v25;
                v15 = v24;
                v16 = v23;
                v12 = v38;
              }

LABEL_14:
            }
          }

          ++v18;
        }

        while (v14 != v18);
        v26 = [v12 countByEnumeratingWithState:&v41 objects:v45 count:16];
        v14 = v26;
        if (!v26)
        {
          v27 = v15;

          a5 = v36;
          v7 = v37;
          v8 = v34;
          a4 = v35;
          v28 = v39;
          goto LABEL_27;
        }
      }
    }
  }

LABEL_26:
  v28 = 0;
  v27 = 0;
  v16 = 0;
LABEL_27:
  objc_autoreleasePoolPop(v8);
  if (a4)
  {
    v30 = v27;
    *a4 = v27;
  }

  if (a5)
  {
    v31 = v28;
    *a5 = v28;
  }

  v29 = v16;

LABEL_32:

  return v29;
}

+ (id)fileURLFromAssetURL:(id)a3 photoLibrary:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = objc_autoreleasePoolPush();
  v14 = 0;
  v9 = [a1 photoFromAssetURL:v6 photoLibrary:v7 sidecar:&v14];
  v10 = v14;
  v11 = v10;
  if (v10)
  {
    [v10 fileURL];
  }

  else
  {
    [v9 mainFileURL];
  }
  v12 = ;

  objc_autoreleasePoolPop(v8);

  return v12;
}

+ (id)photoFromAssetURL:(id)a3 photoLibrary:(id)a4 sidecar:(id *)a5
{
  v24 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = objc_autoreleasePoolPush();
  v11 = [v8 scheme];
  if (([v11 isEqualToString:@"assets-library"] & 1) == 0)
  {

    goto LABEL_11;
  }

  v12 = [v8 host];
  v13 = [v12 isEqualToString:@"asset"];

  if (!v13)
  {
LABEL_11:
    objc_autoreleasePoolPop(v10);
    v17 = 0;
    goto LABEL_12;
  }

  v20 = 0;
  v21 = 0;
  v14 = [a1 uuidFromAssetURL:v8 fileExtension:&v21 sidecarIndex:&v20];
  v15 = v21;
  v16 = v20;
  if (![v14 length] || (objc_msgSend(objc_opt_class(), "assetWithUUID:inLibrary:", v14, v9), (v17 = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v18 = PLBackendGetLog();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543362;
      v23 = v14;
      _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Could not find asset with UUID %{public}@", buf, 0xCu);
    }

    v17 = 0;
  }

  objc_autoreleasePoolPop(v10);
  if (a5)
  {
    *a5 = 0;
  }

LABEL_12:

  return v17;
}

+ (id)assetsLibraryURLWithUUID:(id)a3 extension:(id)a4
{
  v4 = MEMORY[0x1E695DFF8];
  v5 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@://%@/%@.%@?%@=%@&%@=%@", @"assets-library", @"asset", @"asset", a4, @"id", a3, @"ext", a4];
  v6 = [v4 URLWithString:v5];

  return v6;
}

+ (id)preferredFileExtensionForType:(id)a3
{
  v3 = [MEMORY[0x1E69C08F0] typeWithIdentifier:a3];
  v4 = v3;
  if (!v3)
  {
    v6 = PLBackendGetLog();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      *v10 = 0;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "Empty utiType. Default to JPG extension.", v10, 2u);
    }

LABEL_7:
    v5 = @"JPG";
    goto LABEL_17;
  }

  if ([v3 isEqual:*MEMORY[0x1E6983008]])
  {
    v5 = @"TIF";
    goto LABEL_17;
  }

  if ([v4 isEqual:*MEMORY[0x1E6982F28]])
  {
    v5 = @"PNG";
    goto LABEL_17;
  }

  if (([v4 isEqual:*MEMORY[0x1E6982DE8]] & 1) == 0)
  {
    if (([v4 isEqual:*MEMORY[0x1E6982E58]] & 1) == 0)
    {
      v7 = [MEMORY[0x1E69C08F0] preferredOrFallbackFilenameExtensionForType:v4];
      v8 = [v7 uppercaseString];

      if (v8)
      {
        v5 = v8;
      }

      else
      {
        v5 = @"JPG";
      }

      goto LABEL_17;
    }

    goto LABEL_7;
  }

  v5 = @"GIF";
LABEL_17:

  return v5;
}

+ (BOOL)isKnownFileExtension:(id)a3
{
  v3 = [a3 uppercaseString];
  if ([v3 isEqualToString:@"TIF"] & 1) != 0 || (objc_msgSend(v3, "isEqualToString:", @"PNG") & 1) != 0 || (objc_msgSend(v3, "isEqualToString:", @"GIF") & 1) != 0 || (objc_msgSend(v3, "isEqualToString:", @"JPG"))
  {
    LOBYTE(v4) = 1;
  }

  else
  {
    v6 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:v3];
    v7 = v6;
    if (v6)
    {
      v4 = [v6 isDynamic] ^ 1;
    }

    else
    {
      LOBYTE(v4) = 0;
    }
  }

  return v4;
}

+ (BOOL)isValidFileURLForImport:(id)a3
{
  v3 = a3;
  v4 = [v3 lastPathComponent];
  v5 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@.%@", *MEMORY[0x1E69C0028], *MEMORY[0x1E69C0020]];
  v6 = [v4 hasSuffix:v5];

  if (v6)
  {
    v7 = 0;
  }

  else
  {
    v8 = [v3 pathExtension];
    v7 = [PLManagedAsset isValidFileExtensionForImport:v8];
  }

  return v7;
}

+ (BOOL)isValidFileExtensionForImport:(id)a3
{
  v3 = a3;
  v4 = ([v3 isEqualToString:@"DBG"] & 1) == 0 && !objc_msgSend(v3, "isEqualToString:", @"SLM");

  return v4;
}

+ (id)diagnosticFilePathForLibrary:(id)a3 mainFilename:(id)a4 createIfNeeded:(BOOL)a5
{
  v5 = a5;
  v7 = a4;
  v8 = [a3 pathManager];
  v9 = [v8 privateDirectoryWithSubType:8 createIfNeeded:v5 error:0];

  v10 = [v7 stringByDeletingPathExtension];

  v11 = [v10 stringByAppendingPathExtension:@"DBG"];

  v12 = [v9 stringByAppendingPathComponent:v11];

  return v12;
}

+ (id)pathForAlchemistImageWithUUID:(id)a3 bundleScope:(unsigned __int16)a4 directory:(id)a5 filename:(id)a6 pathManager:(id)a7
{
  v10 = a4;
  v11 = a3;
  v12 = a5;
  v13 = a6;
  v14 = a7;
  if ([v14 shouldUseFileIdentifierForBundleScope:v10])
  {
    v15 = objc_alloc(MEMORY[0x1E69BF298]);
    v16 = [*MEMORY[0x1E6982E00] identifier];
    v17 = [v15 initWithAssetUuid:v11 bundleScope:v10 uti:v16 resourceVersion:3 resourceType:15 recipeID:66137 originalFilename:0 customSuffix:0];

    v18 = [v14 readOnlyUrlWithIdentifier:v17];
    v19 = [v18 path];
  }

  else
  {
    v17 = [v14 assetPathForComputeDirectoryWithDirectory:v12 filename:v13];
    v19 = [v17 stringByAppendingPathComponent:@"Alchemist.heic"];
  }

  return v19;
}

+ (id)pathForAdjustmentDataFileWithPathManager:(id)a3 bundleScope:(unsigned __int16)a4 uuid:(id)a5 directory:(id)a6 filename:(id)a7
{
  v10 = a4;
  v11 = a3;
  v12 = a5;
  v13 = a6;
  v14 = a7;
  if ([v11 shouldUseFileIdentifierForBundleScope:v10])
  {
    v15 = objc_alloc(MEMORY[0x1E69BF298]);
    v16 = [*MEMORY[0x1E6982D60] identifier];
    v17 = [v15 initWithAssetUuid:v12 bundleScope:0 uti:v16 resourceVersion:2 recipeID:0];

    v18 = [v11 readOnlyUrlWithIdentifier:v17];
    [v18 path];
  }

  else
  {
    v17 = [v11 assetPathForMutationsDirectoryWithDirectory:v13 filename:v14];
    v18 = [PLManagedAsset pathForAdjustmentDirectoryWithMutationsDirectory:v17];
    [v18 stringByAppendingPathComponent:@"Adjustments.data"];
  }
  v19 = ;

  return v19;
}

+ (id)pathForAdjustmentFileWithPathManager:(id)a3 bundleScope:(unsigned __int16)a4 uuid:(id)a5 directory:(id)a6 filename:(id)a7
{
  v10 = a4;
  v11 = a3;
  v12 = a5;
  v13 = a6;
  v14 = a7;
  if ([v11 shouldUseFileIdentifierForBundleScope:v10])
  {
    v15 = objc_alloc(MEMORY[0x1E69BF298]);
    v16 = [*MEMORY[0x1E6982F68] identifier];
    v17 = [v15 initWithAssetUuid:v12 bundleScope:0 uti:v16 resourceVersion:2 recipeID:0];

    v18 = [v11 readOnlyUrlWithIdentifier:v17];
    [v18 path];
  }

  else
  {
    v17 = [v11 assetPathForMutationsDirectoryWithDirectory:v13 filename:v14];
    v18 = [PLManagedAsset pathForAdjustmentDirectoryWithMutationsDirectory:v17];
    [v18 stringByAppendingPathComponent:@"Adjustments.plist"];
  }
  v19 = ;

  return v19;
}

+ (id)pathForMutationsDirectoryWithDirectory:(id)a3 filename:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = objc_autoreleasePoolPush();
  v8 = [MEMORY[0x1E69BF2A0] systemLibraryPathManager];
  v9 = [v8 assetAbbreviatedMetadataDirectoryForDirectory:v5 type:32 bundleScope:0];
  v10 = [v6 stringByDeletingPathExtension];
  if (v9 && ([v9 length] ? (v11 = v10 == 0) : (v11 = 1), !v11 && objc_msgSend(v10, "length")))
  {
    v12 = [v8 photoDirectoryWithType:9];
    v13 = v12;
    if (v12)
    {
      v14 = [v12 stringByAppendingPathComponent:v9];

      v13 = [v14 stringByAppendingPathComponent:v10];
    }
  }

  else
  {
    v13 = 0;
  }

  objc_autoreleasePoolPop(v7);

  return v13;
}

+ (signed)assetTypeFromUniformTypeIdentifier:(id)a3
{
  v3 = [MEMORY[0x1E69C08F0] typeWithIdentifier:a3];
  if ([v3 conformsToType:*MEMORY[0x1E6982EE8]])
  {
    v4 = 1;
  }

  else if ([v3 conformsToType:*MEMORY[0x1E6982E30]] & 1) != 0 || (objc_msgSend(v3, "conformsToType:", *MEMORY[0x1E6982F10]))
  {
    v4 = 0;
  }

  else if ([v3 conformsToType:*MEMORY[0x1E6982CD0]])
  {
    v4 = 2;
  }

  else
  {
    v4 = 3;
  }

  return v4;
}

+ (id)uniformTypeIdentifierFromPathExtension:(id)a3 assetType:(signed __int16)a4
{
  v4 = [a1 uniformTypeFromPathExtension:a3 assetType:a4];
  v5 = [v4 identifier];

  return v5;
}

+ (id)uniformTypeFromPathExtension:(id)a3 assetType:(signed __int16)a4
{
  v4 = a4;
  v5 = a3;
  if (v4 > 2)
  {
    v6 = MEMORY[0x1E6982D50];
  }

  else
  {
    v6 = qword_1E7567BE8[v4];
  }

  v7 = *v6;
  v8 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:v5 conformingToType:v7];
  if ([v8 isDynamic])
  {
    v9 = [MEMORY[0x1E6982C40] typeWithFilenameExtension:v5];

    v8 = v9;
  }

  return v8;
}

+ (BOOL)isScreenRecordingFileName:(id)a3
{
  v3 = a3;
  v4 = ([v3 hasPrefix:@"RPReplay"] & 1) != 0 || objc_msgSend(v3, "hasPrefix:", @"ScreenRecording");

  return v4;
}

+ (BOOL)isPrimaryImageFormatForUTI:(id)a3
{
  if (!a3)
  {
    return 0;
  }

  v3 = [MEMORY[0x1E6982C40] typeWithIdentifier:?];
  v4 = v3;
  if (v3)
  {
    if ([v3 conformsToType:*MEMORY[0x1E6982E58]] & 1) != 0 || (objc_msgSend(v4, "conformsToType:", *MEMORY[0x1E6982E00]))
    {
      v5 = 1;
    }

    else
    {
      v5 = [v4 conformsToType:*MEMORY[0x1E6982E10]];
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

+ (unsigned)defaultPlaybackStyleFromAssetType:(signed __int16)a3 subtype:(signed __int16)a4 playbackVariation:(unsigned __int16)a5
{
  v5 = 0x3000500050003uLL >> (16 * a5);
  if (a5 >= 4u)
  {
    LOWORD(v5) = 0;
  }

  if (a4 == 2)
  {
    v6 = v5;
  }

  else
  {
    v6 = 1;
  }

  if (a3)
  {
    v6 = 0;
  }

  if (a3 == 1)
  {
    v7 = 4;
  }

  else
  {
    v7 = v6;
  }

  if (a3 == 2)
  {
    return 4;
  }

  else
  {
    return v7;
  }
}

+ (id)allHDRValues
{
  if (allHDRValues_onceToken != -1)
  {
    dispatch_once(&allHDRValues_onceToken, &__block_literal_global_961);
  }

  v3 = allHDRValues_hdrValues;

  return v3;
}

void __30__PLManagedAsset_allHDRValues__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E695DFD8]) initWithObjects:{&unk_1F0FBB0E0, &unk_1F0FBB128, &unk_1F0FBB140, &unk_1F0FBB158, &unk_1F0FBB170, 0}];
  v1 = allHDRValues_hdrValues;
  allHDRValues_hdrValues = v0;
}

+ (signed)imageHDRTypeFromCustomRenderedValue:(signed __int16)a3
{
  v3 = a3;
  if (a3 - 2 >= 3)
  {
    return 0;
  }

  return v3;
}

+ (signed)imageDepthTypeFromCustomRenderedValue:(signed __int16)a3
{
  if (a3 > 9)
  {
    return 0;
  }

  else
  {
    return word_19C60B864[a3];
  }
}

+ (BOOL)guaranteedFlashOffForAssetAtURL:(id)a3
{
  v3 = CGImageSourceCreateWithURL(a3, 0);
  if (!v3)
  {
    return 0;
  }

  v4 = v3;
  v5 = PLImageSourceCopyPropertiesAtIndexDecodingRawIfNecessary(v3, 0, 0);
  v6 = [(__CFDictionary *)v5 objectForKey:*MEMORY[0x1E696D9B0]];
  v7 = [v6 objectForKey:*MEMORY[0x1E696D9F0]];
  v8 = v7;
  if (v7)
  {
    v9 = ([v7 integerValue] & 1) == 0;
  }

  else
  {
    v9 = 0;
  }

  CFRelease(v4);

  return v9;
}

+ (BOOL)_isLibraryScopeExiting:(id)a3
{
  v3 = a3;
  v13 = 0;
  v14 = &v13;
  v15 = 0x2020000000;
  v16 = 0;
  v4 = [v3 libraryScope];
  v5 = v4;
  if (v4)
  {
    v6 = [v4 exitState] != 0;
    *(v14 + 24) = v6;
  }

  else
  {
    v7 = [v3 photoLibrary];
    v10[0] = MEMORY[0x1E69E9820];
    v10[1] = 3221225472;
    v10[2] = __41__PLManagedAsset__isLibraryScopeExiting___block_invoke;
    v10[3] = &unk_1E7578910;
    v8 = v7;
    v11 = v8;
    v12 = &v13;
    [v8 performBlockAndWait:v10];

    v6 = *(v14 + 24);
  }

  _Block_object_dispose(&v13, 8);
  return v6 & 1;
}

void __41__PLManagedAsset__isLibraryScopeExiting___block_invoke(uint64_t a1)
{
  v15 = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLLibraryScope entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"exitState", 0];
  [v4 setPredicate:v5];

  [v4 setResultType:4];
  v6 = [*(a1 + 32) managedObjectContext];
  v10 = 0;
  v7 = [v6 countForFetchRequest:v4 error:&v10];
  v8 = v10;

  if (v7 == 1)
  {
    *(*(*(a1 + 40) + 8) + 24) = 1;
  }

  else if (v7 == 0x7FFFFFFFFFFFFFFFLL)
  {
    v9 = PLPhotoKitGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      *buf = 136315394;
      v12 = "+[PLManagedAsset _isLibraryScopeExiting:]_block_invoke";
      v13 = 2112;
      v14 = v8;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "Failed to fetch exit library scope for %s: %@", buf, 0x16u);
    }
  }
}

+ (BOOL)isHFRVideoAVAsset:(id)a3
{
  v3 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:a3];
  if ([v3 count])
  {
    v4 = [v3 objectAtIndex:0];
    [v4 nominalFrameRate];
    v6 = v5 >= 105.0;
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

+ (CGSize)dimensionsForAVAsset:(id)a3
{
  width = *MEMORY[0x1E695F060];
  height = *(MEMORY[0x1E695F060] + 8);
  if (a3)
  {
    v5 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:a3];
    if ([v5 count])
    {
      v6 = [v5 objectAtIndex:0];
      [v6 naturalSize];
      v8 = v7;
      v10 = v9;
      if (v6)
      {
        [v6 preferredTransform];
      }

      v14.size.width = v10 * 0.0 + 0.0 * v8;
      v14.size.height = v14.size.width;
      v14.origin.x = 0.0;
      v14.origin.y = 0.0;
      v15 = CGRectStandardize(v14);
      width = v15.size.width;
      height = v15.size.height;
    }
  }

  v11 = width;
  v12 = height;
  result.height = v12;
  result.width = v11;
  return result;
}

+ (CGSize)dimensionsForVideoAtURL:(id)a3
{
  v3 = [MEMORY[0x1E6987E28] assetWithURL:a3];
  [PLManagedAsset dimensionsForAVAsset:v3];
  v5 = v4;
  v7 = v6;

  v8 = v5;
  v9 = v7;
  result.height = v9;
  result.width = v8;
  return result;
}

+ (CGSize)sizeOfImageAtURL:(id)a3 outOrientation:(signed __int16 *)a4
{
  v36 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = *MEMORY[0x1E695F060];
  v8 = *(MEMORY[0x1E695F060] + 8);
  v29 = 0;
  v9 = [objc_alloc(MEMORY[0x1E695DEF0]) initWithContentsOfURL:v6 options:1 error:&v29];
  v10 = v29;
  if ([v9 length])
  {
    v11 = v10 == 0;
  }

  else
  {
    v11 = 0;
  }

  if (!v11)
  {
    v12 = PLBackendGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v33 = v6;
      v34 = 2112;
      v35 = v10;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Unable to read imageData from file '%@'. Error: %@", buf, 0x16u);
    }

    goto LABEL_26;
  }

  v28 = a4;
  context = objc_autoreleasePoolPush();
  v13 = MEMORY[0x1E69C08F0];
  v14 = [v6 pathExtension];
  v15 = [v13 typeWithIdentifier:v14];

  if (v15)
  {
    v30 = *MEMORY[0x1E696E118];
    v16 = [v15 identifier];
    v31 = v16;
    v17 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v31 forKeys:&v30 count:1];
  }

  else
  {
    v17 = 0;
  }

  v18 = CGImageSourceCreateWithData(v9, v17);
  if (!v18)
  {

    v21 = 0;
    v22 = 0;
    v23 = 0;
LABEL_19:
    v24 = PLBackendGetLog();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v33 = v6;
      _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Failed to get size of image at %@", buf, 0xCu);
    }

    goto LABEL_22;
  }

  v19 = v18;
  v20 = [a1 newImagePropertiesFromImageSource:v18];
  if (v20)
  {
    PFGetDimensionsFromImageProperties();
    v21 = 0;
    v22 = 0;
    v23 = 0;
  }

  else
  {
    v23 = 0;
    v22 = 0;
    v21 = 0;
  }

  CFRelease(v19);

  if (!v22 || !v23)
  {
    goto LABEL_19;
  }

  v7 = [v22 longLongValue];
  v8 = [v23 longLongValue];
LABEL_22:
  if (v28 && v21)
  {
    *v28 = [v21 shortValue];
  }

  objc_autoreleasePoolPop(context);
LABEL_26:

  v25 = v7;
  v26 = v8;
  result.height = v26;
  result.width = v25;
  return result;
}

+ (id)_ptpCalendar
{
  pl_dispatch_once();
  v2 = _ptpCalendar__myCalendar;

  return v2;
}

void __30__PLManagedAsset__ptpCalendar__block_invoke()
{
  v0 = objc_alloc(MEMORY[0x1E695DEE8]);
  v1 = [v0 initWithCalendarIdentifier:*MEMORY[0x1E695D850]];
  v2 = _ptpCalendar__myCalendar;
  _ptpCalendar__myCalendar = v1;
}

+ (void)ptpResetEventAndFilenameMapping
{
  v2 = +[PLManagedAsset _ptpEventInfoIsolationQueue];
  pl_dispatch_sync();
}

void __49__PLManagedAsset_ptpResetEventAndFilenameMapping__block_invoke()
{
  v0 = +[PLManagedAsset eventInfoForPTP];
  [v0 removeAllObjects];
}

+ (void)ptpSetAssetIDForEventAndFilenameKey:(id)a3 value:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = +[PLManagedAsset _ptpEventInfoIsolationQueue];
  v10 = v5;
  v11 = v6;
  v8 = v6;
  v9 = v5;
  pl_dispatch_sync();
}

void __60__PLManagedAsset_ptpSetAssetIDForEventAndFilenameKey_value___block_invoke(uint64_t a1)
{
  v2 = +[PLManagedAsset eventInfoForPTP];
  v3 = [v2 objectForKey:*(a1 + 32)];

  if (!v3)
  {
    v4 = +[PLManagedAsset eventInfoForPTP];
    [v4 setValue:*(a1 + 40) forKey:*(a1 + 32)];
  }
}

+ (id)ptpAssetIDForEventAndFilenameKey:(id)a3
{
  v3 = a3;
  v8 = 0;
  v9 = &v8;
  v10 = 0x3032000000;
  v11 = __Block_byref_object_copy__14821;
  v12 = __Block_byref_object_dispose__14822;
  v13 = 0;
  v4 = +[PLManagedAsset _ptpEventInfoIsolationQueue];
  v7 = v3;
  pl_dispatch_sync();

  v5 = v9[5];
  _Block_object_dispose(&v8, 8);

  return v5;
}

void __51__PLManagedAsset_ptpAssetIDForEventAndFilenameKey___block_invoke(uint64_t a1)
{
  v5 = +[PLManagedAsset eventInfoForPTP];
  v2 = [v5 objectForKey:*(a1 + 32)];
  v3 = *(*(a1 + 40) + 8);
  v4 = *(v3 + 40);
  *(v3 + 40) = v2;
}

+ (id)_ptpEventInfoIsolationQueue
{
  pl_dispatch_once();
  v2 = _ptpEventInfoIsolationQueue_ptpQueue;

  return v2;
}

void __45__PLManagedAsset__ptpEventInfoIsolationQueue__block_invoke()
{
  v0 = dispatch_queue_create("com.apple.assetsd.ptpeventinfoisolationqueue", 0);
  v1 = _ptpEventInfoIsolationQueue_ptpQueue;
  _ptpEventInfoIsolationQueue_ptpQueue = v0;
}

+ (id)eventInfoForPTP
{
  pl_dispatch_once();
  v2 = eventInfoForPTP_eventInfo;

  return v2;
}

void __33__PLManagedAsset_eventInfoForPTP__block_invoke()
{
  v0 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v1 = eventInfoForPTP_eventInfo;
  eventInfoForPTP_eventInfo = v0;
}

+ (id)newImagePropertiesFromImageSource:(CGImageSource *)a3
{
  v3 = [MEMORY[0x1E69C0708] imagePropertiesFromImageSource:a3];
  v4 = v3;
  v5 = MEMORY[0x1E695E0F8];
  if (v3)
  {
    v5 = v3;
  }

  v6 = v5;

  return v6;
}

+ (PLManagedAsset)assetWithObjectID:(id)a3 inManagedObjectContext:(id)a4
{
  v19 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v14 = 0;
    v8 = [v6 existingObjectWithID:v5 error:&v14];
    v9 = v14;
    if (v9)
    {
      v10 = v9;
      v11 = PLBackendGetLog();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        *buf = 138543618;
        v16 = v5;
        v17 = 2112;
        v18 = v10;
        _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "Failed to fetch asset %{public}@: %@.", buf, 0x16u);
      }

      objc_autoreleasePoolPop(v7);
      v12 = 0;
    }

    else
    {
      objc_autoreleasePoolPop(v7);
      v12 = v8;
    }
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

+ (PLManagedAsset)assetWithUUID:(id)a3 inManagedObjectContext:(id)a4
{
  v5 = a3;
  v6 = a4;
  if (v5)
  {
    v7 = objc_autoreleasePoolPush();
    v8 = MEMORY[0x1E695D5E0];
    v9 = +[PLManagedAsset entityName];
    v10 = [v8 fetchRequestWithEntityName:v9];

    v11 = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid == %@", v5];
    [v10 setPredicate:v11];
    [v10 setFetchLimit:1];
    v15 = 0;
    v12 = [v6 executeFetchRequest:v10 error:&v15];
    if ([v12 count])
    {
      v13 = [v12 objectAtIndex:0];
    }

    else
    {
      v13 = 0;
    }

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

+ (id)assetsWithValidatedSavedAssetTypeMask:(unsigned int)a3 inManagedObjectContext:(id)a4
{
  v4 = *&a3;
  v5 = a4;
  v6 = objc_autoreleasePoolPush();
  v7 = objc_alloc_init(MEMORY[0x1E695D5E0]);
  v8 = [objc_opt_class() entityInManagedObjectContext:v5];
  [v7 setEntity:v8];

  v9 = [MEMORY[0x1E69BF328] predicateForIncludeMask:v4 useIndex:1];
  [v7 setPredicate:v9];
  v12 = 0;
  v10 = [v5 executeFetchRequest:v7 error:&v12];

  objc_autoreleasePoolPop(v6);

  return v10;
}

+ (unint64_t)countUsedAssetsWithKind:(signed __int16)a3 excludeTrashed:(BOOL)a4 excludeInvisible:(BOOL)a5 excludeCloudShared:(BOOL)a6 excludePhotoStream:(BOOL)a7 inManagedObjectContext:(id)a8
{
  v8 = a7;
  v9 = a6;
  v10 = a5;
  v11 = a4;
  v12 = a3;
  v54[1] = *MEMORY[0x1E69E9840];
  v13 = a8;
  v14 = objc_autoreleasePoolPush();
  v15 = objc_alloc_init(MEMORY[0x1E695D5E0]);
  v16 = +[PLManagedAsset entityName];
  v17 = PLSafeEntityForNameInManagedObjectContext(v16, v13, 0);

  if (v17)
  {
    v48 = v8;
    v49 = v9;
    v50 = v14;
    [v15 setEntity:v17];
    v18 = [MEMORY[0x1E695DF70] array];
    v19 = MEMORY[0x1E696ABC8];
    v20 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"complete"];
    v54[0] = v20;
    v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v54 count:1];
    v22 = [v19 expressionForFunction:@"noindex:" arguments:v21];

    v23 = [MEMORY[0x1E696ABC8] expressionForConstantValue:&unk_1F0FBB0B0];
    v24 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v22 rightExpression:v23 modifier:0 type:5 options:0];
    [v18 addObject:v24];

    v25 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"kind"];
    v26 = MEMORY[0x1E696ABC8];
    v27 = [MEMORY[0x1E696AD98] numberWithShort:v12];
    v28 = [v26 expressionForConstantValue:v27];

    v29 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v25 rightExpression:v28 modifier:0 type:4 options:0];
    [v18 addObject:v29];

    if (v11)
    {
      v30 = MEMORY[0x1E696ABC8];
      v31 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"trashedState"];
      v53 = v31;
      v32 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v53 count:1];
      v33 = [v30 expressionForFunction:@"noindex:" arguments:v32];

      v34 = [MEMORY[0x1E696ABC8] expressionForConstantValue:&unk_1F0FBB0B0];
      v35 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v33 rightExpression:v34 modifier:0 type:4 options:0];
      [v18 addObject:v35];
    }

    if (v10)
    {
      v36 = MEMORY[0x1E696ABC8];
      v37 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"visibilityState"];
      v52 = v37;
      v38 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v52 count:1];
      v39 = [v36 expressionForFunction:@"noindex:" arguments:v38];

      v40 = [MEMORY[0x1E696ABC8] expressionForConstantValue:&unk_1F0FBB110];
      v41 = [MEMORY[0x1E696AB18] predicateWithLeftExpression:v39 rightExpression:v40 modifier:0 type:4 options:0];
      [v18 addObject:v41];
    }

    BYTE2(v47) = 0;
    LOWORD(v47) = 256;
    v42 = [MEMORY[0x1E69BF328] validatedSavedAssetTypeMaskUnknown:0 photoBooth:0 photoStream:v48 camera:0 cloudShared:v49 cameraConnectionKit:0 cloudPhotoLibrary:0x10001010000 wallpaper_UNUSED:v47 momentShared:? placeholder:? referenced:? alternate:? guest:? companionSynced:? recovered:? collectionShare:? legacyImport:?];
    v43 = [MEMORY[0x1E69BF328] predicateForExcludeMask:v42 useIndex:0];
    [v18 addObject:v43];

    v44 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v18];
    [v15 setPredicate:v44];
    v51 = 0;
    v45 = [v13 countForFetchRequest:v15 error:&v51];

    v14 = v50;
  }

  else
  {
    v45 = 0;
  }

  objc_autoreleasePoolPop(v14);
  return v45;
}

+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)a3 urgency:(int64_t)a4 sizeOption:(unint64_t)a5
{
  v43[1] = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = [v8 managedObjectContext];
  if (a5)
  {
    v10 = objc_alloc_init(MEMORY[0x1E695DFA8]);
    if (a5)
    {
      v11 = +[PLInternalResource nonOriginalCPLResourceTypes];
      [v10 addObjectsFromArray:v11];
    }

    if ((a5 & 2) != 0)
    {
      v12 = +[PLInternalResource originalCPLResourceTypesForMaster];
      [v10 addObjectsFromArray:v12];

      v13 = +[PLInternalResource originalCPLResourceTypesForAsset];
      [v10 addObjectsFromArray:v13];
    }

    v14 = MEMORY[0x1E695D5E0];
    v15 = +[PLInternalResource entityName];
    v16 = [v14 fetchRequestWithEntityName:v15];

    [v16 setResultType:2];
    v17 = [PLInternalResource purgeablePushedPredicateForCPLResourceTypes:v10 urgency:a4];
    [v16 setPredicate:v17];

    v18 = objc_alloc_init(MEMORY[0x1E695D5C8]);
    [v18 setName:@"totalFileSize"];
    v19 = [MEMORY[0x1E696ABC8] expressionWithFormat:@"sum:(dataLength)"];
    [v18 setExpression:v19];

    [v18 setExpressionResultType:300];
    v43[0] = v18;
    v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v43 count:1];
    [v16 setPropertiesToFetch:v20];

    v38 = 0;
    v21 = [v9 executeFetchRequest:v16 error:&v38];
    v22 = v38;
    if (v21)
    {
      if ([v21 count] == 1)
      {
        v23 = [v21 objectAtIndexedSubscript:0];
        v24 = [v23 objectForKeyedSubscript:@"totalFileSize"];
        v25 = [v24 longLongValue];

        if (v25 >= 1)
        {
          v37 = -1;
          if (PLIsAssetsd())
          {
            v26 = [v8 libraryServicesManager];
            v27 = [v26 cloudPhotoLibraryManager];

            v28 = [v27 sizeOfResourcesToUploadByCPL:0];
            v37 = v28;
          }

          else
          {
            v31 = [v8 assetsdClient];
            v32 = [v31 libraryInternalClient];
            v36 = v22;
            [v32 synchronouslyGetSizeOfResourcesToUploadByCPL:&v37 error:&v36];
            v35 = v36;

            v28 = v37;
            v22 = v35;
          }

          if (v25 >= v28)
          {
            v25 -= v28;
          }

          else
          {
            v25 = 0;
          }

          v33 = PLBackendGetLog();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 134218240;
            v40 = v25;
            v41 = 2048;
            v42 = v37;
            _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_DEFAULT, "totalPurgeableSizeOnDiskInLibrary pushedSize=%lld sizeOfResourcesToUpload=%lld", buf, 0x16u);
          }
        }

        goto LABEL_23;
      }
    }

    else
    {
      v29 = PLBackendGetLog();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        v30 = NSStringFromSelector(a2);
        *buf = 138412546;
        v40 = v30;
        v41 = 2112;
        v42 = v22;
        _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "%@ failed to calculate size %@", buf, 0x16u);
      }
    }

    v25 = 0;
LABEL_23:

    goto LABEL_24;
  }

  v25 = 0;
LABEL_24:

  return v25;
}

+ (int64_t)totalPurgeableSizeOnDiskInLibrary:(id)a3 urgency:(int64_t)a4
{
  v6 = a3;
  if ([v6 isCloudPhotoLibraryEnabled])
  {
    v7 = [v6 libraryBundle];
    v8 = [PLCPLSettings settingsWithLibraryBundle:v7];

    if ([v8 isKeepOriginalsEnabled])
    {
      v9 = 1;
    }

    else
    {
      v9 = 3;
    }
  }

  else
  {
    v9 = 0;
  }

  v10 = [a1 totalPurgeableSizeOnDiskInLibrary:v6 urgency:a4 sizeOption:v9];

  return v10;
}

+ (id)_createAssetModelToInsert:(id)a3 uuid:(id)a4 replacementUUID:(id)a5
{
  v20 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a5;
  v12 = v11;
  if (v10 && v11)
  {
    if ([v10 isEqualToString:v11])
    {
      v13 = [MEMORY[0x1E696AAA8] currentHandler];
      [v13 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:5107 description:{@"Invalid parameter not satisfying: %@", @"![uuid isEqualToString:replacementUUID]"}];
    }
  }

  else if (!v11)
  {
    goto LABEL_10;
  }

  v14 = [a1 assetWithUUID:v12 inLibrary:v9];
  if (v14)
  {
    goto LABEL_12;
  }

  v15 = PLBackendGetLog();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v19 = v12;
    _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Could find photo with UUID %@. This will cause duplicates.", buf, 0xCu);
  }

LABEL_10:
  v16 = [v9 managedObjectContext];
  v14 = [(PLManagedObject *)PLManagedAsset insertInManagedObjectContext:v16];

  if (v10)
  {
    [v14 setUuid:v10];
  }

LABEL_12:

  return v14;
}

+ (id)_insertAssetIntoPhotoLibrary:(id)a3 mainFileURL:(id)a4 mainFileMetadata:(id)a5 savedAssetType:(signed __int16)a6 bundleScope:(unsigned __int16)a7 uuid:(id)a8 replacementUUID:(id)a9 imageSource:(CGImageSource *)a10 imageData:(id *)a11 isPlaceholder:(BOOL)a12 deleteFileOnFailure:(BOOL)a13
{
  v14 = a7;
  v36 = a6;
  v39 = *MEMORY[0x1E69E9840];
  v18 = a3;
  v19 = a4;
  v20 = a5;
  v21 = a8;
  v22 = a9;
  v23 = [v18 pathManager];
  v24 = [v23 shouldUseFileIdentifierForBundleScope:v14];

  if (v19)
  {
    if (v24)
    {
      [MEMORY[0x1E69BF328] maskForReferencedAsset];
      if ((PLValidatedSavedAssetTypeApplies() & 1) == 0)
      {
        if (!v21)
        {
          v33 = [MEMORY[0x1E696AAA8] currentHandler];
          [v33 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:5078 description:{@"Invalid parameter not satisfying: %@", @"uuid"}];
        }

        v25 = [v19 path];
        v26 = [v25 containsString:v21];

        if ((v26 & 1) == 0)
        {
          v34 = [MEMORY[0x1E696AAA8] currentHandler];
          [v34 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:5080 description:{@"Invalid parameter not satisfying: %@", @"[mainFileURL.path containsString:uuid]"}];
        }
      }
    }
  }

  v27 = [a1 _createAssetModelToInsert:v18 uuid:v21 replacementUUID:v22];
  v28 = v27;
  if (!a12 && ([v27 setAttributesFromMainFileURL:v19 mainFileMetadata:v20 savedAssetType:v36 bundleScope:v14 isPlaceholder:0 placeholderFileURL:0 imageSource:a10 imageData:a11] & 1) == 0)
  {
    v29 = PLMigrationGetLog();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      v30 = [v19 path];
      *buf = 138412290;
      v38 = v30;
      _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "Failed to set attributes for asset at path %@", buf, 0xCu);
    }

    if (a13)
    {
      v31 = [PLAssetTransactionReason transactionReason:@"[_insertAssetIntoPhotoLibrary:mainFileURL:savedAssetType:replacementUUID:imageSource:imageData:sPlaceholder:deleteFileOnFailure:] We failed to set the asset's attributes, so we are now deleting the non-placeholder asset that was replaced."];
      [v28 deleteWithReason:v31];
    }

    else
    {
      v31 = [PLAssetTransactionReason transactionReason:@"[_insertAssetIntoPhotoLibrary:mainFileURL:savedAssetType:replacementUUID:imageSource:imageData:sPlaceholder:deleteFileOnFailure:] We failed to set the asset's attributes, so we are now deleting the non-placeholder asset that was replaced from the database only because deleteMainFileOnFailure was NO."];
      [v28 deleteFromDatabaseOnlyWithReason:v31];
    }

    v28 = 0;
  }

  return v28;
}

+ (id)fetchPredicateForLegacyRequiredResourcesLocallyAvailable:(BOOL)a3 photoLibrary:(id)a4
{
  v5 = a4;
  v6 = v5;
  if (a3 || [v5 isCloudPhotoLibraryEnabled])
  {
    v7 = +[PLManagedAsset predicateForAssetsWithCompleteResourcesOnAsset];
  }

  else
  {
    v7 = [MEMORY[0x1E696AE18] predicateWithValue:1];
  }

  v8 = v7;

  return v8;
}

+ (id)cloudMasterMediaMetadataForAssetObjectID:(id)a3 managedObjectContext:(id)a4 error:(id *)a5
{
  v20 = *MEMORY[0x1E69E9840];
  v7 = a4;
  v8 = a3;
  v9 = [objc_opt_class() fetchRequest];
  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudMaster.assets CONTAINS %@", v8];

  [v9 setPredicate:v10];
  v17 = 0;
  v11 = [v7 executeFetchRequest:v9 error:&v17];

  v12 = v17;
  if (v11)
  {
    v13 = [v11 firstObject];
    v14 = [v13 valueForKey:@"data"];
  }

  else
  {
    v13 = PLBackendGetLog();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v12;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Fetch for media metadata failed: %@", buf, 0xCu);
    }

    v14 = 0;
  }

  if (a5)
  {
    v15 = v12;
    *a5 = v12;
  }

  return v14;
}

+ (void)updateAllAlbumAssociationIfNeededWithLibrary:(id)a3
{
  v25[1] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E695D5E0];
  v4 = a3;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v25[0] = @"albums";
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:1];
  [v6 setRelationshipKeyPathsForPrefetching:v7];

  v8 = [v4 managedObjectContext];

  v9 = [PLEnumerateAndSaveController alloc];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __63__PLManagedAsset_updateAllAlbumAssociationIfNeededWithLibrary___block_invoke;
  v21[3] = &unk_1E7575B30;
  v10 = v8;
  v22 = v10;
  v11 = [(PLEnumerateAndSaveController *)v9 initWithName:@"library asset album associativity" fetchRequest:v6 context:v10 options:4 generateContextBlock:v21 didFetchObjectIDsBlock:0 processResultBlock:&__block_literal_global_593];
  v20 = 0;
  v12 = [(PLEnumerateAndSaveController *)v11 processObjectsWithError:&v20];
  v13 = v20;
  v14 = PLBackendGetLog();
  v15 = v14;
  if (v12)
  {
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      v16 = "Completed asset album associativity recovery";
      v17 = v15;
      v18 = OS_LOG_TYPE_INFO;
      v19 = 2;
LABEL_6:
      _os_log_impl(&dword_19BF1F000, v17, v18, v16, buf, v19);
    }
  }

  else if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v24 = v13;
    v16 = "Failed to perform asset album associativity recovery. Error: %@";
    v17 = v15;
    v18 = OS_LOG_TYPE_ERROR;
    v19 = 12;
    goto LABEL_6;
  }
}

+ (BOOL)validShareForPlaceholderAsset:(id)a3
{
  v3 = a3;
  if ([v3 isPlaceholderAsset] && (objc_msgSend(v3, "shareRelationship"), v4 = objc_claimAutoreleasedReturnValue(), v4, v4))
  {
    v5 = [v3 shareRelationship];
    v6 = [v5 shareURL];
    v7 = v6 != 0;
  }

  else
  {
    v7 = 1;
  }

  return v7;
}

+ (BOOL)_isScreenshotWithType:(id)a3 hasScreenshotDimensions:(BOOL)a4 hasScreenshotMetadata:(BOOL)a5
{
  v5 = a5;
  v7 = a3;
  if ([v7 conformsToType:*MEMORY[0x1E6982F28]])
  {
    LOBYTE(v5) = a4 | v5;
  }

  else if (([v7 conformsToType:*MEMORY[0x1E6982E58]] & 1) == 0)
  {
    v5 &= [v7 conformsToType:*MEMORY[0x1E6982E00]];
  }

  return v5;
}

+ (signed)correctedOrientation:(signed __int16)a3
{
  v3 = a3;
  if (a3 - 9 < 0xFFFFFFF8)
  {
    return 1;
  }

  return v3;
}

+ (void)deleteOldPlaceholderAssetsInManagedObjectContext:(id)a3
{
  v32 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = objc_autoreleasePoolPush();
  v5 = [MEMORY[0x1E695DF00] date];
  v6 = objc_opt_new();
  [v6 setDay:-7];
  v7 = [MEMORY[0x1E695DEE8] calendarWithIdentifier:*MEMORY[0x1E695D850]];
  v8 = [v7 dateByAddingComponents:v6 toDate:v5 options:0];

  v9 = PLBackendGetLog();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
  {
    *buf = 138543362;
    v31 = v8;
    _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_INFO, "Deleting old placeholder assets older than %{public}@", buf, 0xCu);
  }

  v10 = MEMORY[0x1E695D5E0];
  v11 = +[PLManagedAsset entityName];
  v12 = [v10 fetchRequestWithEntityName:v11];

  v13 = MEMORY[0x1E696AB28];
  v14 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForPlaceholderAsset"), 1}];
  v29[0] = v14;
  v15 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K < %@", @"addedDate", v8];
  v29[1] = v15;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v29 count:2];
  v17 = [v13 andPredicateWithSubpredicates:v16];
  [v12 setPredicate:v17];

  v18 = [objc_alloc(MEMORY[0x1E695D538]) initWithFetchRequest:v12];
  [v18 setResultType:2];
  v28 = 0;
  v19 = [v3 executeRequest:v18 error:&v28];
  v20 = v28;
  v21 = PLBackendGetLog();
  v22 = v21;
  if (v19)
  {
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      [v19 result];
      v27 = v5;
      v23 = v3;
      v25 = v24 = v4;
      v26 = [v25 unsignedLongValue];
      *buf = 134217984;
      v31 = v26;
      _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Deleted %lu placeholder assets", buf, 0xCu);

      v4 = v24;
      v3 = v23;
      v5 = v27;
    }
  }

  else if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v31 = v20;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Failed to delete old placeholder assets %@", buf, 0xCu);
  }

  objc_autoreleasePoolPop(v4);
}

+ (BOOL)isVideoComplementVisibilityStatePlayable:(unsigned __int16)a3 hasAdjustments:(BOOL)a4
{
  v4 = (a3 >> 3) & 1;
  if ((a3 & 9) == 0)
  {
    v4 = !a4 | ((a3 & 2) >> 1);
  }

  if ((a3 & 4) != 0)
  {
    LOBYTE(v4) = a3 ^ 1;
  }

  return v4 & 1;
}

+ (id)videoComplementVisibilityStatePlayablePredicate
{
  v13[2] = *MEMORY[0x1E69E9840];
  v2 = [MEMORY[0x1E695DF70] arrayWithCapacity:4];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(videoCpVisibilityState & %i) != 0 AND (videoCpVisibilityState & %i) == 0", 4, 1];
  [v2 addObject:v3];
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(videoCpVisibilityState & %i) != 0 AND (videoCpVisibilityState & %i) == 0", 8, 4];
  [v2 addObject:v4];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(videoCpVisibilityState & %i) != 0 AND (videoCpVisibilityState & %i) == 0 AND (videoCpVisibilityState & %i) == 0 AND (videoCpVisibilityState & %i) == 0", 2, 1, 8, 4];
  [v2 addObject:v5];
  v6 = MEMORY[0x1E696AB28];
  v7 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %i", @"videoCpVisibilityState", 0];
  v13[0] = v7;
  v8 = [PLManagedAsset predicateForUnadjustedAssetsWithKeyPathToAsset:0];
  v13[1] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:2];
  v10 = [v6 andPredicateWithSubpredicates:v9];

  [v2 addObject:v10];
  v11 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v2];

  return v11;
}

+ (BOOL)canPlayPhotoIrisWithPhotoIris:(BOOL)a3 photoIrisPlaceholder:(BOOL)a4 hasAdjustments:(BOOL)a5 videoCpVisibilityState:(unsigned __int16)a6
{
  if (!a3 || a4)
  {
    return 0;
  }

  else
  {
    return [a1 isVideoComplementVisibilityStatePlayable:a6 hasAdjustments:a5];
  }
}

+ (BOOL)isPhotoIrisPlaceholderWithPhotoIris:(BOOL)a3 videoCpDuration:(int64_t)a4 isCloudShared:(BOOL)a5 videoCpFilePath:(id)a6
{
  v8 = a3;
  v9 = a6;
  v10 = v9;
  LOBYTE(v11) = 0;
  if (!a4 && !a5 && v8)
  {
    if (v9)
    {
      v12 = [MEMORY[0x1E696AC08] defaultManager];
      v11 = [v12 fileExistsAtPath:v10] ^ 1;
    }

    else
    {
      LOBYTE(v11) = 1;
    }
  }

  return v11;
}

+ (id)predicateToExcludeVideosWithVideoKeyFrameSetWithKeyPathToAsset:(id)a3
{
  v5 = a3;
  if (!v5)
  {
    v8 = [MEMORY[0x1E696AAA8] currentHandler];
    [v8 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:1876 description:{@"Invalid parameter not satisfying: %@", @"keyPathToAsset"}];
  }

  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K.%K != %d || (%K.%K == %d && %K.%K == %d)", v5, @"kind", 1, v5, @"videoKeyFrameValue", 0, v5, @"videoKeyFrameTimeScale", 0];

  return v6;
}

+ (void)clearImportSessionObjectIDCacheOnManagedObjectContext:(id)a3
{
  v5 = a3;
  if ([v5 isValidForSelector:a2 error:0])
  {
    v4 = [v5 userInfo];
    [v4 removeObjectForKey:@"importSessionObjectIDCache"];
  }
}

+ (id)_importAlbumIsolationQueue
{
  pl_dispatch_once();
  v2 = _importAlbumIsolationQueue_importAlbumQueue;

  return v2;
}

void __44__PLManagedAsset__importAlbumIsolationQueue__block_invoke()
{
  v0 = dispatch_queue_create("com.apple.assetsd.importalbumisolationqueue", 0);
  v1 = _importAlbumIsolationQueue_importAlbumQueue;
  _importAlbumIsolationQueue_importAlbumQueue = v0;
}

+ (BOOL)invalidateReverseLocationDataOnAllAssetsInManagedObjectContext:(id)a3 error:(id *)a4
{
  v25[1] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D560];
  v6 = a3;
  v7 = [v5 alloc];
  v8 = +[PLAdditionalAssetAttributes entityName];
  v9 = [v7 initWithEntityName:v8];

  v24 = @"reverseLocationDataIsValid";
  v25[0] = MEMORY[0x1E695E110];
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v25 forKeys:&v24 count:1];
  [v9 setPropertiesToUpdate:v10];

  [v9 setResultType:0];
  v21 = 0;
  v11 = [v6 executeRequest:v9 error:&v21];

  v12 = v21;
  v13 = v12;
  if (v11)
  {
    v14 = PLMomentsGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      v15 = "Location data invalidated for all assets";
      v16 = v14;
      v17 = OS_LOG_TYPE_DEFAULT;
      v18 = 2;
LABEL_8:
      _os_log_impl(&dword_19BF1F000, v16, v17, v15, buf, v18);
    }
  }

  else
  {
    if (a4)
    {
      v19 = v12;
      *a4 = v13;
    }

    v14 = PLMomentsGetLog();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v23 = v13;
      v15 = "Failed to batch-invalidate location data for all assets: %@";
      v16 = v14;
      v17 = OS_LOG_TYPE_ERROR;
      v18 = 12;
      goto LABEL_8;
    }
  }

  return v11 != 0;
}

+ (void)createTHMFileWithPreviewImage:(id)a3 thumbnailImage:(id)a4 fileURLForThumbnailFile:(id)a5
{
  v7 = MEMORY[0x1E69BF248];
  v8 = a5;
  v9 = a4;
  v10 = a3;
  v11 = [v7 defaultFormatChooser];
  v23 = [v11 indexSheetUnbakedFormat];

  [v23 size];
  v13 = v12;
  v15 = v14;
  DCIM_sizeFromPLImage();
  if (v13 >= v15)
  {
    v18 = v13;
  }

  else
  {
    v18 = v15;
  }

  if (v16 >= v17)
  {
    v16 = v17;
  }

  if (v18 >= v16)
  {
    v19 = v10;
  }

  else
  {
    v19 = v9;
  }

  v20 = v19;
  DCIM_sizeFromPLImage();
  PLSquareCropRectForSize();
  v21 = PLCreateCroppedImageFromImage();

  v22 = DCIM_newJPEGRepresentationWithPLImage();
  [v22 writeToURL:v8 atomically:0];
}

+ (BOOL)hasMasterThumbWithThumbnailIndex:(int64_t)a3
{
  if (a3 == -2)
  {
    return 1;
  }

  else
  {
    return [a1 hasAllThumbsWithThumbnailIndex:?];
  }
}

+ (id)predicateForAssetsIncompletelyProcessedForSensitivity
{
  v17[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == 0", @"compactSCSensitivityAnalysis", 0];
  v17[0] = v3;
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"kind", 1];
  v15[0] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"kindSubtype", 2];
  v15[1] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:2];
  v8 = [v4 orPredicateWithSubpredicates:v7];
  v16[0] = v8;
  v9 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K & %d) == 0", @"packedBadgeAttributes", 256];
  v16[1] = v9;
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v16 count:2];
  v11 = [v4 andPredicateWithSubpredicates:v10];
  v17[1] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:2];
  v13 = [v2 orPredicateWithSubpredicates:v12];

  return v13;
}

+ (id)predicateForStyleableAssets
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > %d", @"currentSleetCast", 0];
  v8[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > 0", @"additionalAttributes.sleetIsReversible"];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 andPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)predicateForAdjustedAssetsWithKeyPathToAsset:(id)a3
{
  if (a3)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K.%K != %i", a3, @"adjustmentsState", 0];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %i", @"adjustmentsState", 0, v5];
  }
  v3 = ;

  return v3;
}

+ (id)predicateForUnadjustedAssetsWithKeyPathToAsset:(id)a3
{
  if (a3)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K.%K == %i", a3, @"adjustmentsState", 0];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %i", @"adjustmentsState", 0, v5];
  }
  v3 = ;

  return v3;
}

+ (id)predicateForAssetSubtype:(signed __int16)a3
{
  v3 = a3;
  if (!a3)
  {
    v7 = [MEMORY[0x1E696AAA8] currentHandler];
    [v7 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:836 description:{@"Invalid parameter not satisfying: %@", @"subtype != PLAssetSubtypeNone"}];
  }

  return [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K != %d) AND (%K == %d)", @"kindSubtype", 0, @"kindSubtype", v3];
}

+ (id)predicateForBurstStackAssets
{
  v10[4] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"avalancheKind", 1];
  v10[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K >= %d", @"avalanchePickType", 16];
  v10[1] = v4;
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K <= %d", @"avalanchePickType", 0x7FFFFFFFLL];
  v10[2] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K & %i) == %i", @"avalanchePickType", 16, 16];
  v10[3] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:4];
  v8 = [v2 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateForAvalancheKindAssetsWithKind:(unsigned __int16)a3
{
  v9[2] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"avalancheUUID"];
  v9[0] = v4;
  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAvalancheSupportedAssets"), 0}];
  v9[1] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:2];
  v7 = [v3 andPredicateWithSubpredicates:v6];

  return v7;
}

+ (id)_predicateForAvalancheKindAssetsWithUUID:(id)a3 kind:(unsigned __int16)a4
{
  v4 = a4;
  v12[2] = *MEMORY[0x1E69E9840];
  v6 = MEMORY[0x1E696AB28];
  v7 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"avalancheUUID", a3];
  v12[0] = v7;
  v8 = [a1 predicateForAvalancheKindAssetsWithKind:v4];
  v12[1] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:2];
  v10 = [v6 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (NSPredicate)predicateToIncludeSharedLibrarySharingSuggestionsAssets
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSharedLibraryExclusions"), 0}];
  v8[0] = v3;
  v4 = PLManagedAssetPredicateToFetchAssetsSuggestedForSharing();
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 andPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)predicateToIncludeSharedLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)a3
{
  v3 = a3;
  v12[3] = *MEMORY[0x1E69E9840];
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSharedLibraryExclusions"), 0}];
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"visibilityState", 0, v5];
  v12[1] = v6;
  if (v3)
  {
    v7 = @"%K == %d";
  }

  else
  {
    v7 = @"noindex:(%K) == %d";
  }

  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:v7, @"activeLibraryScopeParticipationState", 1];
  v12[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:3];
  v10 = [v4 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateToIncludePrivateLibraryAssetsAllowingIndexingOnParticipationState:(BOOL)a3
{
  v3 = a3;
  v12[3] = *MEMORY[0x1E69E9840];
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSharedLibraryExclusions"), 0}];
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"visibilityState", 0, v5];
  v12[1] = v6;
  if (v3)
  {
    v7 = @"%K == %d";
  }

  else
  {
    v7 = @"noindex:(%K) == %d";
  }

  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:v7, @"activeLibraryScopeParticipationState", 0];
  v12[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:3];
  v10 = [v4 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateForReframedAssets
{
  pl_dispatch_once();
  v2 = predicateForReframedAssets_predicate;

  return v2;
}

void __44__PLManagedAsset_predicateForReframedAssets__block_invoke()
{
  v6 = [MEMORY[0x1E695DF70] array];
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 4];
  [v6 addObject:v0];

  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 5];
  [v6 addObject:v1];

  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 13];
  [v6 addObject:v2];

  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 12];
  [v6 addObject:v3];

  v4 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v6];
  v5 = predicateForReframedAssets_predicate;
  predicateForReframedAssets_predicate = v4;
}

+ (id)predicateForSpatialOverCaptureAssets
{
  pl_dispatch_once();
  v2 = predicateForSpatialOverCaptureAssets_predicate;

  return v2;
}

void __54__PLManagedAsset_predicateForSpatialOverCaptureAssets__block_invoke()
{
  v6 = [MEMORY[0x1E695DF70] array];
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 1];
  [v6 addObject:v0];

  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 5];
  [v6 addObject:v1];

  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 13];
  [v6 addObject:v2];

  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"cameraProcessingAdjustmentState", 9];
  [v6 addObject:v3];

  v4 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v6];
  v5 = predicateForSpatialOverCaptureAssets_predicate;
  predicateForSpatialOverCaptureAssets_predicate = v4;
}

+ (id)predicateForAssetSharingFilter:(signed __int16)a3 noindex:(BOOL)a4
{
  v4 = a3 == 1;
  if (a4)
  {
    v5 = @"noindex:(%K) == %d";
  }

  else
  {
    v5 = @"%K == %d";
  }

  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:v5, @"activeLibraryScopeParticipationState", v4];

  return v6;
}

+ (id)predicateToIncludeBothPrivateAssetsAndSharedContentContributedByCurrentUser
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = +[PLManagedAsset predicateToIncludeOnlyContentContributedByCurrentUser];
  v8[0] = v3;
  v4 = [PLManagedAsset predicateForAssetSharingFilter:0];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 orPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToFaceVersion:(id)a3
{
  v10[2] = *MEMORY[0x1E69E9840];
  if (a3)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K >= %d", @"additionalAttributes.faceAnalysisVersion", objc_msgSend(a3, "intValue")];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > %d", @"additionalAttributes.faceAnalysisVersion", 0];
  }
  v4 = ;
  v5 = MEMORY[0x1E696AB28];
  v6 = [a1 predicateToIncludeOnlyAllowedForAnalysisAssets];
  v10[0] = v6;
  v10[1] = v4;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:2];
  v8 = [v5 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestFaceVersion
{
  v3 = +[PLMediaAnalysisServiceRequestAdapter currentFaceVersion];
  v4 = [a1 predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToFaceVersion:v3];

  return v4;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToSceneVersion:(id)a3
{
  v10[2] = *MEMORY[0x1E69E9840];
  if (a3)
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K >= %d", @"additionalAttributes.sceneAnalysisVersion", objc_msgSend(a3, "intValue")];
  }

  else
  {
    [MEMORY[0x1E696AE18] predicateWithFormat:@"%K > %d", @"additionalAttributes.sceneAnalysisVersion", 0];
  }
  v4 = ;
  v5 = MEMORY[0x1E696AB28];
  v6 = [a1 predicateToIncludeOnlyAllowedForAnalysisAssets];
  v10[0] = v6;
  v10[1] = v4;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:2];
  v8 = [v5 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToLatestSceneVersion
{
  v3 = +[PLMediaAnalysisServiceRequestAdapter currentSceneVersion];
  v4 = [a1 predicateToIncludeOnlyAllowedForAnalysisAndProcessedAssetsToSceneVersion:v3];

  return v4;
}

+ (id)predicateToExcludeNonVisibleStackedAssets
{
  v13[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d", @"avalancheKind", 2];
  v13[0] = v3;
  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"avalancheKind", 2];
  v12[0] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"avalanchePickType", 20];
  v12[1] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:2];
  v8 = [v4 andPredicateWithSubpredicates:v7];
  v13[1] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:2];
  v10 = [v2 orPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateToIncludeDuplicateAssetVisibilityStateMostRelevant
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"duplicateAssetVisibilityState", 0];
  v8[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"duplicateAssetVisibilityState", 2];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 orPredicateWithSubpredicates:v5];

  return v6;
}

+ (id)_predicateForDepthType:(signed __int16)a3
{
  v3 = a3;
  v13[2] = *MEMORY[0x1E69E9840];
  if (!a3)
  {
    v12 = [MEMORY[0x1E696AAA8] currentHandler];
    [v12 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:580 description:{@"Invalid parameter not satisfying: %@", @"depthType != PLDepthTypeNone"}];
  }

  v4 = MEMORY[0x1E696AB28];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K != %d)", @"depthType", 0];
  v13[0] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K == %d)", @"depthType", v3];
  v13[1] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:2];
  v8 = [v4 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateToLimitToCaptureSessionIdentifier:(id)a3
{
  v5 = a3;
  if (!v5)
  {
    v8 = [MEMORY[0x1E696AAA8] currentHandler];
    [v8 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset.m" lineNumber:550 description:{@"Invalid parameter not satisfying: %@", @"captureSessionIdentifier != nil"}];
  }

  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"captureSessionIdentifier", v5];

  return v6;
}

+ (id)predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath:(id)a3
{
  v11[1] = *MEMORY[0x1E69E9840];
  v3 = a3;
  pl_dispatch_once();
  v10 = @"thumbnailIndex";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath__pl_once_object_16;
  v6 = [v4 expressionForKeyPath:v3];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __91__PLManagedAsset_predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:($thumbnailIndex) == %d OR noindex:($thumbnailIndex) >= %d", 4294967294, 0];
  v0 = [v2 copy];
  v1 = predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath__pl_once_object_16;
  predicateToExcludeAssetsMissingMasterThumbnailsWithThumbnailIndexKeyPath__pl_once_object_16 = v0;
}

+ (id)predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath:(id)a3
{
  v11[1] = *MEMORY[0x1E69E9840];
  v3 = a3;
  pl_dispatch_once();
  v10 = @"avalanchePickType";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath__pl_once_object_15;
  v6 = [v4 expressionForKeyPath:v3];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __86__PLManagedAsset_predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(noindex:($avalanchePickType) = %d) OR (noindex:($avalanchePickType) >= %d AND (((noindex:($avalanchePickType) & %i) == %i) OR ((noindex:($avalanchePickType) & %i) == %i)))", 0, 8, 8, 8, 16, 16];
  v0 = [v2 copy];
  v1 = predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath__pl_once_object_15;
  predicateToExcludeNonvisibleBurstAssetsWithAvalanchePickTypeKeyPath__pl_once_object_15 = v0;
}

+ (id)predicateToExcludeRestrictedLockedAssets
{
  pl_dispatch_once();
  v2 = predicateToExcludeRestrictedLockedAssets_pl_once_object_13;

  return v2;
}

void __58__PLManagedAsset_predicateToExcludeRestrictedLockedAssets__block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d AND noindex:(%K) == NO", @"trashedState", 0, @"hidden"];
  v0 = [v2 copy];
  v1 = predicateToExcludeRestrictedLockedAssets_pl_once_object_13;
  predicateToExcludeRestrictedLockedAssets_pl_once_object_13 = v0;
}

+ (id)predicateToExcludeHiddenAssetsWithHiddenKeyPath:(id)a3
{
  v11[1] = *MEMORY[0x1E69E9840];
  v3 = a3;
  pl_dispatch_once();
  v10 = @"hidden";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeHiddenAssetsWithHiddenKeyPath__pl_once_object_12;
  v6 = [v4 expressionForKeyPath:v3];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __66__PLManagedAsset_predicateToExcludeHiddenAssetsWithHiddenKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:($hidden) == NO"];
  v0 = [v2 copy];
  v1 = predicateToExcludeHiddenAssetsWithHiddenKeyPath__pl_once_object_12;
  predicateToExcludeHiddenAssetsWithHiddenKeyPath__pl_once_object_12 = v0;
}

+ (id)predicateToExcludeTrashedAssetsWithTrashedStateKeyPath:(id)a3
{
  v11[1] = *MEMORY[0x1E69E9840];
  v3 = a3;
  pl_dispatch_once();
  v10 = @"trashedState";
  v4 = MEMORY[0x1E696ABC8];
  v5 = predicateToExcludeTrashedAssetsWithTrashedStateKeyPath__pl_once_object_11;
  v6 = [v4 expressionForKeyPath:v3];

  v11[0] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:&v10 count:1];
  v8 = [v5 predicateWithSubstitutionVariables:v7];

  return v8;
}

void __73__PLManagedAsset_predicateToExcludeTrashedAssetsWithTrashedStateKeyPath___block_invoke()
{
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:($trashedState) == %d", 0];
  v0 = [v2 copy];
  v1 = predicateToExcludeTrashedAssetsWithTrashedStateKeyPath__pl_once_object_11;
  predicateToExcludeTrashedAssetsWithTrashedStateKeyPath__pl_once_object_11 = v0;
}

+ (id)videoAssetsForMediaGroupUUID:(id)a3 moc:(id)a4
{
  v20[1] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D5E0];
  v6 = a4;
  v7 = a3;
  v8 = +[PLManagedAsset entityName];
  v9 = [v5 fetchRequestWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"mediaGroupUUID = %@ AND noindex:(kind) = %d", v7, 1];

  [v9 setPredicate:v10];
  v11 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"addedDate" ascending:0];
  v20[0] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
  [v9 setSortDescriptors:v12];

  v17 = 0;
  v13 = [v6 executeFetchRequest:v9 error:&v17];

  v14 = v17;
  if (!v13)
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v14;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "%@", buf, 0xCu);
    }
  }

  return v13;
}

+ (id)imageAssetsForMediaGroupUUID:(id)a3 moc:(id)a4
{
  v20[1] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D5E0];
  v6 = a4;
  v7 = a3;
  v8 = +[PLManagedAsset entityName];
  v9 = [v5 fetchRequestWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@ AND noindex:(%K) = %d", @"mediaGroupUUID", v7, @"kind", 0];

  [v9 setPredicate:v10];
  v11 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"addedDate" ascending:0];
  v20[0] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
  [v9 setSortDescriptors:v12];

  v17 = 0;
  v13 = [v6 executeFetchRequest:v9 error:&v17];

  v14 = v17;
  if (!v13)
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v14;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "%@", buf, 0xCu);
    }
  }

  return v13;
}

+ (id)assetsWithGroupingUUID:(id)a3 inManagedObjectContext:(id)a4
{
  v18 = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D5E0];
  v6 = a4;
  v7 = a3;
  v8 = +[PLManagedAsset entityName];
  v9 = [v5 fetchRequestWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"groupingUUID == %@", v7];

  [v9 setPredicate:v10];
  v15 = 0;
  v11 = [v6 executeFetchRequest:v9 error:&v15];

  v12 = v15;
  if (!v11)
  {
    v13 = PLBackendGetLog();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v17 = v12;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Fetch for grouped assets failed with error %@", buf, 0xCu);
    }
  }

  return v11;
}

+ (id)assetUUIDsByObjectIDs:(id)a3 withFilterPredicate:(id)a4 context:(id)a5 error:(id *)a6
{
  v44[2] = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a5;
  v12 = MEMORY[0x1E695D5E0];
  v13 = +[PLManagedAsset entityName];
  v14 = [v12 fetchRequestWithEntityName:v13];

  v15 = [MEMORY[0x1E696AE18] predicateWithFormat:@"self IN %@", v9];
  v16 = v15;
  if (v10)
  {
    v17 = MEMORY[0x1E696AB28];
    v44[0] = v15;
    v44[1] = v10;
    v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v44 count:2];
    v19 = [v17 andPredicateWithSubpredicates:v18];

    v16 = v19;
  }

  [v14 setPredicate:v16];
  v43[0] = @"objectID";
  v43[1] = @"uuid";
  v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v43 count:2];
  [v14 setPropertiesToFetch:v20];
  [v14 setResultType:2];
  v37 = 0;
  v38 = &v37;
  v39 = 0x3032000000;
  v40 = __Block_byref_object_copy__14821;
  v41 = __Block_byref_object_dispose__14822;
  v42 = 0;
  v31 = 0;
  v32 = &v31;
  v33 = 0x3032000000;
  v34 = __Block_byref_object_copy__14821;
  v35 = __Block_byref_object_dispose__14822;
  v36 = 0;
  v26[0] = MEMORY[0x1E69E9820];
  v26[1] = 3221225472;
  v26[2] = __74__PLManagedAsset_assetUUIDsByObjectIDs_withFilterPredicate_context_error___block_invoke;
  v26[3] = &unk_1E7578898;
  v21 = v11;
  v27 = v21;
  v22 = v14;
  v28 = v22;
  v29 = &v31;
  v30 = &v37;
  [v21 performBlockAndWait:v26];
  v23 = v38[5];
  if (a6 && !v23)
  {
    *a6 = v32[5];
    v23 = v38[5];
  }

  v24 = v23;

  _Block_object_dispose(&v31, 8);
  _Block_object_dispose(&v37, 8);

  return v24;
}

void __74__PLManagedAsset_assetUUIDsByObjectIDs_withFilterPredicate_context_error___block_invoke(void *a1)
{
  v29[1] = *MEMORY[0x1E69E9840];
  v2 = a1[4];
  v3 = a1[5];
  v26[0] = 0;
  v4 = [v2 executeFetchRequest:v3 error:v26];
  v5 = v26[0];
  v21 = v5;
  if (v4)
  {
    v6 = [MEMORY[0x1E695DF90] dictionary];
    v7 = *(a1[7] + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;

    v24 = 0u;
    v25 = 0u;
    v22 = 0u;
    v23 = 0u;
    v9 = v4;
    v10 = [v9 countByEnumeratingWithState:&v22 objects:v27 count:16];
    if (v10)
    {
      v11 = *v23;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v23 != v11)
          {
            objc_enumerationMutation(v9);
          }

          v13 = *(*(&v22 + 1) + 8 * i);
          v14 = [v13 objectForKeyedSubscript:@"uuid"];
          v15 = [v13 objectForKeyedSubscript:@"objectID"];
          [*(*(a1[7] + 8) + 40) setObject:v14 forKey:v15];
        }

        v10 = [v9 countByEnumeratingWithState:&v22 objects:v27 count:16];
      }

      while (v10);
    }
  }

  else
  {
    v16 = MEMORY[0x1E696ABC0];
    v28 = *MEMORY[0x1E696A278];
    v9 = [v5 debugDescription];
    v29[0] = v9;
    v17 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v29 forKeys:&v28 count:1];
    v18 = [v16 errorWithDomain:*MEMORY[0x1E69BFF48] code:46301 userInfo:v17];
    v19 = *(a1[6] + 8);
    v20 = *(v19 + 40);
    *(v19 + 40) = v18;
  }
}

+ (id)assetsWithObjectIDs:(id)a3 inLibrary:(id)a4
{
  v5 = a3;
  v6 = a4;
  if ([v5 count])
  {
    v7 = objc_autoreleasePoolPush();
    v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"self IN %@", v5];
    v9 = MEMORY[0x1E695D5E0];
    v10 = +[PLManagedAsset entityName];
    v11 = [v9 fetchRequestWithEntityName:v10];

    [v11 setIncludesPendingChanges:0];
    [v11 setPredicate:v8];
    if ([v5 count] >= 0x65)
    {
      [v11 setFetchBatchSize:100];
    }

    v12 = [v6 managedObjectContext];
    v15 = 0;
    v13 = [v12 executeFetchRequest:v11 error:&v15];

    objc_autoreleasePoolPop(v7);
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

+ (PLManagedAsset)assetWithObjectID:(id)a3 inLibrary:(id)a4
{
  v6 = a3;
  v7 = [a4 managedObjectContext];
  v8 = [a1 assetWithObjectID:v6 inManagedObjectContext:v7];

  return v8;
}

+ (unint64_t)countForAssetsWithUUIDs:(id)a3 uuidKeyPath:(id)a4 includePendingChanges:(BOOL)a5 inManagedObjectContext:(id)a6 error:(id *)a7
{
  v9 = a5;
  v11 = a3;
  v12 = a4;
  v13 = a6;
  if ([v11 count])
  {
    v14 = objc_autoreleasePoolPush();
    v15 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", v12, v11];
    v16 = MEMORY[0x1E695D5E0];
    v17 = +[PLManagedAsset entityName];
    v18 = [v16 fetchRequestWithEntityName:v17];

    [v18 setIncludesPendingChanges:v9];
    [v18 setPredicate:v15];
    v23 = 0;
    v19 = [v13 countForFetchRequest:v18 error:&v23];
    v20 = v23;

    objc_autoreleasePoolPop(v14);
    if (a7 && v19 == 0x7FFFFFFFFFFFFFFFLL)
    {
      v21 = v20;
      *a7 = v20;
      v19 = 0x7FFFFFFFFFFFFFFFLL;
    }
  }

  else
  {
    v19 = 0;
    v20 = 0;
  }

  return v19;
}

+ (id)assetsWithUUIDs:(id)a3 options:(unint64_t)a4 inManagedObjectContext:(id)a5
{
  v6 = a4;
  v7 = a3;
  v8 = a5;
  if ([v7 count])
  {
    v9 = objc_autoreleasePoolPush();
    v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid IN %@", v7];
    v11 = MEMORY[0x1E695D5E0];
    v12 = +[PLManagedAsset entityName];
    v13 = [v11 fetchRequestWithEntityName:v12];

    [v13 setIncludesPendingChanges:v6 & 1];
    if ((v6 & 2) != 0)
    {
      v14 = [MEMORY[0x1E695DEC8] arrayWithObject:@"uuid"];
      [v13 setPropertiesToFetch:v14];
    }

    [v13 setPredicate:v10];
    v17 = 0;
    v15 = [v8 executeFetchRequest:v13 error:&v17];

    objc_autoreleasePoolPop(v9);
  }

  else
  {
    v15 = 0;
  }

  return v15;
}

+ (id)assetsWithUUIDs:(id)a3 options:(unint64_t)a4 inLibrary:(id)a5
{
  v8 = a3;
  v9 = [a5 managedObjectContext];
  v10 = [a1 assetsWithUUIDs:v8 options:a4 inManagedObjectContext:v9];

  return v10;
}

+ (PLManagedAsset)assetWithUUID:(id)a3 inLibrary:(id)a4
{
  v6 = a3;
  v7 = [a4 managedObjectContext];
  v8 = [a1 assetWithUUID:v6 inManagedObjectContext:v7];

  return v8;
}

+ (BOOL)hasRequiredExtendedAttributesForMainFileURL:(id)a3
{
  v4 = a3;
  v5 = objc_autoreleasePoolPush();
  v6 = [MEMORY[0x1E69BF230] persistedAttributesForFileAtURL:v4];
  LOBYTE(a1) = [a1 hasRequiredExtendedAttributesForPersistanceAttributes:v6];

  objc_autoreleasePoolPop(v5);
  return a1;
}

+ (BOOL)hasRequiredExtendedAttributesForPersistanceAttributes:(id)a3
{
  v3 = [a3 UUIDStringForKey:*MEMORY[0x1E69BFE68]];
  v4 = [v3 length] != 0;

  return v4;
}

- (id)_imagePropertiesFromMetadata:(id)a3
{
  v4 = a3;
  v5 = [v4 cgImageProperties];

  if (v5)
  {
    v6 = [v4 cgImageProperties];
  }

  else
  {
    if ([(PLManagedAsset *)self isBundleScopeSyndication])
    {
      v7 = 0;
      goto LABEL_7;
    }

    v6 = [(PLManagedAsset *)self imageProperties];
  }

  v7 = v6;
LABEL_7:

  return v7;
}

- (id)generatePortraitAdjustment:(id *)a3
{
  v32[3] = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self depthType]== 1 && ![(PLManagedAsset *)self hasAdjustments])
  {
    v25 = 0;
    v26 = &v25;
    v27 = 0x3032000000;
    v28 = __Block_byref_object_copy__14821;
    v29 = __Block_byref_object_dispose__14822;
    v30 = 0;
    v23[0] = 0;
    v23[1] = v23;
    v23[2] = 0x3032000000;
    v23[3] = __Block_byref_object_copy__14821;
    v23[4] = __Block_byref_object_dispose__14822;
    v24 = 0;
    v5 = *MEMORY[0x1E69AE948];
    v32[0] = MEMORY[0x1E695E118];
    v6 = *MEMORY[0x1E69AE900];
    v31[0] = v5;
    v31[1] = v6;
    v7 = [(PLManagedAsset *)self uniformTypeIdentifier];
    v32[1] = v7;
    v31[2] = *MEMORY[0x1E69AE970];
    v8 = [MEMORY[0x1E696AD98] numberWithShort:{-[PLManagedAsset originalOrientation](self, "originalOrientation")}];
    v32[2] = v8;
    v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v32 forKeys:v31 count:3];

    v10 = dispatch_block_create(DISPATCH_BLOCK_INHERIT_QOS_CLASS, &__block_literal_global_2819);
    v11 = [(PLManagedObject *)self photoLibrary];
    v12 = [v11 imageConversionServiceClient];

    v13 = [(PLManagedAsset *)self mainFileURL];
    v16 = MEMORY[0x1E69E9820];
    v17 = 3221225472;
    v18 = __66__PLManagedAsset_ThumbnailGeneration__generatePortraitAdjustment___block_invoke_2;
    v19 = &unk_1E7567AD8;
    v21 = &v25;
    v22 = v23;
    v14 = v10;
    v20 = v14;
    [v12 convertImageAtSourceURL:v13 options:v9 completionHandler:&v16];

    dispatch_block_wait(v14, 0xFFFFFFFFFFFFFFFFLL);
    v4 = [v26[5] objectForKeyedSubscript:{*MEMORY[0x1E69AE8F0], v16, v17, v18, v19}];

    _Block_object_dispose(v23, 8);
    _Block_object_dispose(&v25, 8);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

void __66__PLManagedAsset_ThumbnailGeneration__generatePortraitAdjustment___block_invoke_2(void *a1, uint64_t a2, void *a3, void *a4)
{
  v6 = a3;
  v7 = a4;
  v8 = *(a1[5] + 8);
  v9 = *(v8 + 40);
  *(v8 + 40) = v6;
  v13 = v6;

  v10 = *(a1[6] + 8);
  v11 = *(v10 + 40);
  *(v10 + 40) = v7;
  v12 = v7;

  (*(a1[4] + 16))();
}

- (void)generateThumbnailsWithImageSource:(CGImageSource *)a3 imageData:(id)a4 metadata:(id)a5 allowMediumPreview:(BOOL)a6 forceSRGBConversion:(BOOL)a7 forFinalCameraImage:(BOOL)a8 outSmallThumbnailData:(id *)a9 isPreviewSource:(BOOL)a10
{
  v92 = a8;
  v10 = a7;
  v135[1] = *MEMORY[0x1E69E9840];
  v100 = a4;
  v99 = a5;
  isrc = a3;
  if (!a3)
  {
    v17 = 0;
    goto LABEL_85;
  }

  context = objc_autoreleasePoolPush();
  [(PLManagedAsset *)self orientation];
  if (PLExifOrientationSwapsWidthAndHeight())
  {
    v15 = [(PLManagedAsset *)self height];
    v16 = [(PLManagedAsset *)self width];
  }

  else
  {
    v15 = [(PLManagedAsset *)self width];
    v16 = [(PLManagedAsset *)self height];
  }

  v18 = v16;
  v19 = v15;
  [(PLManagedAsset *)self imageSize];
  v21 = v20;
  v23 = v22;
  v126 = 0.0;
  v127 = 0.0;
  v124 = 0.0;
  v125 = 0.0;
  [objc_opt_class() computePreCropThumbnailSize:&v126 andPostCropSize:&v124 forOrientedOriginalSize:1 andCroppedSize:v15 isLargeThumbnail:{v18, v20, v22}];
  v122 = 0.0;
  v123 = 0.0;
  v121[0] = 0;
  v121[1] = 0;
  [objc_opt_class() computePreCropThumbnailSize:&v122 andPostCropSize:v121 forOrientedOriginalSize:0 andCroppedSize:v15 isLargeThumbnail:{v18, v21, v23}];
  if (v122 >= v123)
  {
    v24 = v122;
  }

  else
  {
    v24 = v123;
  }

  v25 = [(PLManagedAsset *)self embeddedThumbnailWidth];
  v26 = [(PLManagedAsset *)self embeddedThumbnailHeight];
  if (v25 <= v26)
  {
    v27 = v26;
  }

  else
  {
    v27 = v25;
  }

  v91 = v27;
  v28 = [(PLManagedAsset *)self fileURLForLargeThumbnailFile];
  v117 = 0;
  v118 = &v117;
  v119 = 0x2020000000;
  v120 = 0;
  v113 = 0;
  v114 = &v113;
  v115 = 0x2020000000;
  v116 = 0;
  if (v19 >= v18)
  {
    v18 = v19;
  }

  if (v124 >= v125)
  {
    v29 = v124;
  }

  else
  {
    v29 = v125;
  }

  v30 = MEMORY[0x1E69C08F0];
  v31 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v94 = [v30 typeWithIdentifier:v31];

  if ([(PLManagedAsset *)self isPhoto])
  {
    v32 = [v94 conformsToType:*MEMORY[0x1E6982F88]];
    v33 = v10;
  }

  else
  {
    v33 = v10;
    v32 = 0;
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __189__PLManagedAsset_ThumbnailGeneration__generateThumbnailsWithImageSource_imageData_metadata_allowMediumPreview_forceSRGBConversion_forFinalCameraImage_outSmallThumbnailData_isPreviewSource___block_invoke;
  aBlock[3] = &unk_1E7567AB0;
  aBlock[4] = self;
  v106 = &v117;
  url = v28;
  v104 = url;
  v108 = v18;
  v109 = v29;
  v110 = v32;
  v111 = a10;
  v112 = a6;
  v105 = v100;
  v107 = &v113;
  v96 = _Block_copy(aBlock);
  v34 = v33;
  v35 = v96[2]();
  if (v35)
  {
    v36 = [(__CFURL *)url URLByDeletingLastPathComponent];
    v102 = 0;
    v37 = [v36 getResourceValue:&v102 forKey:*MEMORY[0x1E695DB20] error:0];
    v38 = v102;
    if ((v37 & 1) == 0)
    {
      v39 = [MEMORY[0x1E696AC08] defaultManager];
      v101 = 0;
      v40 = [v39 createDirectoryAtURL:v36 withIntermediateDirectories:1 attributes:0 error:&v101];
      v41 = v101;

      if ((v40 & 1) == 0)
      {
        v42 = PLThumbnailsGetLog();
        if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
        {
          v43 = [v36 path];
          *buf = 138412546;
          v129 = v43;
          v130 = 2112;
          v131 = v41;
          _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Unable to create directory '%@': %@", buf, 0x16u);
        }

LABEL_40:

        goto LABEL_41;
      }

      goto LABEL_41;
    }

    goto LABEL_42;
  }

  if (a9)
  {
    if (*(v118 + 24) == 1)
    {
      if ((v114[3] & 1) == 0)
      {
        v44 = url;
        goto LABEL_31;
      }

LABEL_30:
      v44 = [(PLManagedAsset *)self fileURLForMediumThumbnailFile];
LABEL_31:
      v36 = v44;
      if (!v44)
      {
LABEL_43:

        goto LABEL_44;
      }

      v38 = [MEMORY[0x1E695DEF0] dataWithContentsOfURL:v44 options:1 error:0];
      if ([(__CFData *)v38 length])
      {
        v45 = [(PLManagedAsset *)self uniformTypeIdentifier];
        if (v45)
        {
          v134 = *MEMORY[0x1E696E118];
          v46 = [(PLManagedAsset *)self uniformTypeIdentifier];
          v135[0] = v46;
          v41 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v135 forKeys:&v134 count:1];
        }

        else
        {
          v41 = 0;
        }

        v47 = CGImageSourceCreateWithData(v38, v41);
        CFAutorelease(v47);
        if (!v47)
        {
          v42 = PLThumbnailsGetLog();
          if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
          {
            v48 = [(__CFData *)v38 length];
            v49 = [(PLManagedAsset *)self _compactDebugDescription];
            *buf = 134218242;
            v129 = v48;
            v130 = 2114;
            v131 = v49;
            _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Unable to generate image source from data (length %lu) for asset %{public}@", buf, 0x16u);
          }

          goto LABEL_40;
        }

        isrc = v47;
LABEL_41:
      }

LABEL_42:

      goto LABEL_43;
    }

    if (v114[3])
    {
      goto LABEL_30;
    }
  }

LABEL_44:
  v50 = PLThumbnailsGetLog();
  v95 = [(PLManagedAsset *)self _imagePropertiesFromMetadata:v99];
  v51 = MEMORY[0x1E6982E58];
  if (v35)
  {
    v52 = PLThumbnailsGetLog();
    if (os_log_type_enabled(v52, OS_LOG_TYPE_INFO))
    {
      v53 = [(PLManagedAsset *)self _compactDebugDescription];
      *buf = 138543362;
      v129 = v53;
      _os_log_impl(&dword_19BF1F000, v52, OS_LOG_TYPE_INFO, "Unable to generate thumbnails via hardware decoder, falling back to software for %{public}@", buf, 0xCu);
    }

    v54 = [*v51 identifier];
    v55 = CGImageDestinationCreateWithURL(url, v54, 1uLL, 0);

    if (v55)
    {
      v56 = objc_alloc(MEMORY[0x1E69C06B0]);
      v57 = MetadataForPreviewJPGFromOriginalMetadata(v95);
      v58 = [v56 initWithOptions:v57];

      v59 = os_signpost_id_generate(v50);
      v60 = v50;
      v61 = v60;
      spid = v59;
      v62 = v59 - 1;
      if (v59 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v60))
      {
        v63 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v129 = v63;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v61, OS_SIGNPOST_INTERVAL_BEGIN, spid, "generateThumbnailsWithImageSource_SW_Lg1", "uuid: %{public}@", buf, 0xCu);
      }

      v64 = v126;
      if (v126 < v127)
      {
        v64 = v127;
      }

      [v58 setMaximumLongSideLength:v64];
      [v58 setIncludeHDRGainMaps:1];
      if (v34)
      {
        [v58 setColorBehavior:2];
      }

      PrimaryImageIndex = CGImageSourceGetPrimaryImageIndex(isrc);
      v66 = [v58 options];
      CGImageDestinationAddImageFromSource(v55, isrc, PrimaryImageIndex, v66);

      if (!CGImageDestinationFinalize(v55))
      {
        v67 = PLThumbnailsGetLog();
        if (os_log_type_enabled(v67, OS_LOG_TYPE_ERROR))
        {
          v68 = [(PLManagedAsset *)self _compactDebugDescription];
          v69 = [v58 options];
          *buf = 138543874;
          v129 = v68;
          v130 = 2114;
          v131 = isrc;
          v132 = 2114;
          v133 = v69;
          _os_log_impl(&dword_19BF1F000, v67, OS_LOG_TYPE_ERROR, "Failed to generate large thumbnail for %{public}@ from image source %{public}@ with options %{public}@", buf, 0x20u);

          v51 = MEMORY[0x1E6982E58];
        }
      }

      CFRelease(v55);
      v70 = v61;
      v71 = v70;
      if (v62 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v70))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v71, OS_SIGNPOST_INTERVAL_END, spid, "generateThumbnailsWithImageSource_SW_Lg1", "", buf, 2u);
      }
    }
  }

  if (a9)
  {
    v17 = objc_alloc_init(MEMORY[0x1E695DF88]);
    v72 = [*v51 identifier];
    v73 = CGImageDestinationCreateWithData(v17, v72, 1uLL, 0);

    if (v73)
    {
      v74 = objc_alloc(MEMORY[0x1E69C06B0]);
      v75 = MetadataForPreviewJPGFromOriginalMetadata(v95);
      v76 = [v74 initWithOptions:v75];

      v77 = v91;
      if (v24 > v91)
      {
        v77 = v24;
      }

      [v76 setMaximumLongSideLength:v77];
      [v76 setColorBehavior:3];
      [v76 setIncludeHDRGainMaps:1];
      if (v34)
      {
        [v76 setColorBehavior:2];
      }

      if (v92)
      {
        [v76 setObject:&unk_1F0FBB0B0 forKeyedSubscript:*MEMORY[0x1E696E110]];
      }

      v78 = os_signpost_id_generate(v50);
      v79 = v50;
      v80 = v79;
      if (v78 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v79))
      {
        v81 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v129 = v81;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v80, OS_SIGNPOST_INTERVAL_BEGIN, v78, "generateThumbnailsWithImageSource_SW_Sm2", "uuid: %{public}@", buf, 0xCu);
      }

      v82 = CGImageSourceGetPrimaryImageIndex(isrc);
      v83 = [v76 options];
      CGImageDestinationAddImageFromSource(v73, isrc, v82, v83);

      if (!CGImageDestinationFinalize(v73))
      {
        v84 = PLThumbnailsGetLog();
        if (os_log_type_enabled(v84, OS_LOG_TYPE_ERROR))
        {
          v85 = [(PLManagedAsset *)self _compactDebugDescription];
          v86 = [v76 options];
          *buf = 138543874;
          v129 = v85;
          v130 = 2114;
          v131 = isrc;
          v132 = 2114;
          v133 = v86;
          _os_log_impl(&dword_19BF1F000, v84, OS_LOG_TYPE_ERROR, "Failed to generate small thumbnail for %{public}@ from image source %{public}@ with options %{public}@", buf, 0x20u);
        }

        v17 = 0;
      }

      CFRelease(v73);
      v87 = v80;
      v88 = v87;
      if (v78 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v87))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19BF1F000, v88, OS_SIGNPOST_INTERVAL_END, v78, "generateThumbnailsWithImageSource_SW_Sm2", "", buf, 2u);
      }
    }
  }

  else
  {
    v17 = 0;
  }

  _Block_object_dispose(&v113, 8);
  _Block_object_dispose(&v117, 8);

  objc_autoreleasePoolPop(context);
  if (a9)
  {
    v89 = v17;
    *a9 = v17;
  }

LABEL_85:
}

uint64_t __189__PLManagedAsset_ThumbnailGeneration__generateThumbnailsWithImageSource_imageData_metadata_allowMediumPreview_forceSRGBConversion_forFinalCameraImage_outSmallThumbnailData_isPreviewSource___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) photoLibrary];
  if (([v2 isCloudPhotoLibraryEnabled] & 1) == 0)
  {
    v3 = [*(a1 + 32) isCPLSharingScopeAsset];

    if (v3)
    {
      return 0;
    }

    v5 = *(a1 + 40);
    v21 = 0;
    v6 = *MEMORY[0x1E695DB20];
    v7 = [v5 getResourceValue:&v21 forKey:*MEMORY[0x1E695DB20] error:0];
    v8 = v21;
    *(*(*(a1 + 56) + 8) + 24) = v7;
    v9 = *(a1 + 72);
    v10 = *(a1 + 80);
    v11 = [*(a1 + 32) width];
    v12 = [*(a1 + 32) height];
    v13 = [*(a1 + 32) isSavedPhotosAsset];
    if ((*(a1 + 48) || (*(*(*(a1 + 56) + 8) + 24) & 1) == 0) && ((*(a1 + 88) & 1) != 0 || ((v9 / v10 > 1.22474487) & ~v13) != 0 || v12 * v11 >= 25000000))
    {
      v14 = *(a1 + 89);
      if ((v14 & 1) == 0)
      {
        if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && *(a1 + 90) == 1)
        {
          v15 = [*(a1 + 32) fileURLForMediumThumbnailFile];
          v20 = 0;
          v16 = [v15 getResourceValue:&v20 forKey:v6 error:0];
          v17 = v20;

          *(*(*(a1 + 64) + 8) + 24) = v16;
          v18 = *(*(*(a1 + 64) + 8) + 24) | v14;

          if (v18)
          {
            v4 = 0;
            v8 = v17;
LABEL_18:

            return v4;
          }

          v8 = v17;
        }

        v4 = [*(a1 + 32) avalanchePickTypeIsVisible];
        goto LABEL_18;
      }
    }

    v4 = 0;
    goto LABEL_18;
  }

  return 0;
}

- (void)copyAuxiliaryImagesFromImageSource:(CGImageSource *)a3 toDestination:(CGImageDestination *)a4 fromImageAtIndex:(unint64_t)a5 imageProperties:(id)a6 applyingOrientation:(signed __int16)a7 scalingToLongSideLength:(int64_t)a8
{
  v9 = a7;
  v13 = MEMORY[0x1E69C0708];
  v14 = a6;
  v15 = [v13 auxiliaryImagesToPreserveForDerivativesFromImageSource:a3 imageIndex:a5];
  v16 = [v14 objectForKeyedSubscript:*MEMORY[0x1E696DED8]];
  v17 = [v16 integerValue];

  v18 = [v14 objectForKeyedSubscript:*MEMORY[0x1E696DEC8]];

  v19 = [v18 integerValue];
  if (v17 <= v19)
  {
    v20 = v19;
  }

  else
  {
    v20 = v17;
  }

  v21 = [MEMORY[0x1E69C0708] transformAuxiliaryImages:v15 scaleFactor:v9 applyingOrientation:a8 / v20];
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __165__PLManagedAsset_ThumbnailGeneration__copyAuxiliaryImagesFromImageSource_toDestination_fromImageAtIndex_imageProperties_applyingOrientation_scalingToLongSideLength___block_invoke;
  v22[3] = &__block_descriptor_40_e39_v32__0__NSString_8__NSDictionary_16_B24l;
  v22[4] = a4;
  [v21 enumerateKeysAndObjectsUsingBlock:v22];
}

- (int64_t)cameraProcessingAdjustmentTrashedState
{
  v15 = *MEMORY[0x1E69E9840];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v2 = [(PLManagedAsset *)self modernResources];
  v3 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v11;
    v6 = 1;
LABEL_3:
    v7 = 0;
    while (1)
    {
      if (*v11 != v5)
      {
        objc_enumerationMutation(v2);
      }

      v8 = *(*(&v10 + 1) + 8 * v7);
      if ([v8 supportsTrashedState])
      {
        if ([v8 isTrashedOrExpunged])
        {
          break;
        }
      }

      if (v4 == ++v7)
      {
        v4 = [v2 countByEnumeratingWithState:&v10 objects:v14 count:16];
        if (v4)
        {
          goto LABEL_3;
        }

        goto LABEL_10;
      }
    }
  }

  else
  {
LABEL_10:
    v6 = 0;
  }

  return v6;
}

- (CGSize)videoComplementSpatialOverCaptureSize
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v2 = [(PLManagedAsset *)self modernResources];
  v3 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v13;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v13 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v12 + 1) + 8 * i);
        if ([v7 resourceType] == 11)
        {
          v8 = [v7 unorientedWidth];
          v9 = [v7 unorientedHeight];

          goto LABEL_11;
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  v8 = *MEMORY[0x1E695F060];
  v9 = *(MEMORY[0x1E695F060] + 8);
LABEL_11:
  v10 = v8;
  v11 = v9;
  result.height = v11;
  result.width = v10;
  return result;
}

- (CGSize)spatialOverCaptureSize
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v2 = [(PLManagedAsset *)self modernResources];
  v3 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v13;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v13 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v7 = *(*(&v12 + 1) + 8 * i);
        if ([v7 resourceType] == 10)
        {
          v8 = [v7 unorientedWidth];
          v9 = [v7 unorientedHeight];

          goto LABEL_11;
        }
      }

      v4 = [v2 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  v8 = *MEMORY[0x1E695F060];
  v9 = *(MEMORY[0x1E695F060] + 8);
LABEL_11:
  v10 = v8;
  v11 = v9;
  result.height = v11;
  result.width = v10;
  return result;
}

- (unint64_t)ptpCloudMasterOriginalFileSize
{
  v2 = [(PLManagedAsset *)self masterResourceForCPLType:1];
  v3 = [v2 dataLength];

  return v3;
}

- (NSData)faceRegions
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 faceRegions];

  return v3;
}

- (void)setFaceRegions:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setFaceRegions:v4];
}

- (void)setAccessibilityDescription:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setAccessibilityDescription:v4];
}

- (NSString)accessibilityDescription
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 accessibilityDescription];

  return v3;
}

- (void)setTitle:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setTitle:v4];
}

- (NSString)title
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 title];

  return v3;
}

- (void)setLongDescription:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setLongDescription:v4];
}

- (NSString)longDescription
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 longDescription];

  return v3;
}

- (void)setLocationHash:(int)a3
{
  v3 = *&a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithInt:v3];
  [v5 setLocationHash:v4];
}

- (int)locationHash
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 locationHash];
  v4 = [v3 intValue];

  return v4;
}

- (void)setEmbeddedThumbnailHeight:(signed __int16)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:v3];
  [v5 setEmbeddedThumbnailHeight:v4];
}

- (signed)embeddedThumbnailHeight
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 embeddedThumbnailHeight];
  v4 = [v3 shortValue];

  return v4;
}

- (void)setEmbeddedThumbnailWidth:(signed __int16)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:v3];
  [v5 setEmbeddedThumbnailWidth:v4];
}

- (signed)embeddedThumbnailWidth
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 embeddedThumbnailWidth];
  v4 = [v3 shortValue];

  return v4;
}

- (void)setEmbeddedThumbnailLength:(int)a3
{
  v3 = *&a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithInt:v3];
  [v5 setEmbeddedThumbnailLength:v4];
}

- (int)embeddedThumbnailLength
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 embeddedThumbnailLength];
  v4 = [v3 intValue];

  return v4;
}

- (void)setEmbeddedThumbnailOffset:(int)a3
{
  v3 = *&a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithInt:v3];
  [v5 setEmbeddedThumbnailOffset:v4];
}

- (int)embeddedThumbnailOffset
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 embeddedThumbnailOffset];
  v4 = [v3 intValue];

  return v4;
}

- (NSData)embeddedThumbnailData
{
  v3 = objc_autoreleasePoolPush();
  v4 = [(PLManagedAsset *)self embeddedThumbnailOffset];
  v5 = [(PLManagedAsset *)self embeddedThumbnailLength];
  if (v5 && (v6 = v5, v7 = MEMORY[0x1E696AC00], -[PLManagedAsset mainFileURL](self, "mainFileURL"), v8 = objc_claimAutoreleasedReturnValue(), v12 = 0, [v7 fileHandleForReadingFromURL:v8 error:&v12], v9 = objc_claimAutoreleasedReturnValue(), v8, v9))
  {
    [v9 seekToFileOffset:v4];
    v10 = [v9 readDataOfLength:v6];
    [v9 closeFile];
    if ([v10 length] != v6)
    {

      v10 = 0;
    }

    objc_autoreleasePoolPop(v3);
  }

  else
  {
    objc_autoreleasePoolPop(v3);
    v10 = 0;
  }

  return v10;
}

- (void)setOriginalFilesize:(unint64_t)a3
{
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithUnsignedLongLong:a3];
  [v5 setOriginalFilesize:v4];
}

- (unint64_t)originalFilesize
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalFilesize];
  v4 = [v3 unsignedLongLongValue];

  return v4;
}

- (void)setOriginalOrientation:(signed __int16)a3
{
  v4 = [PLManagedAsset correctedOrientation:a3];
  v6 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [MEMORY[0x1E696AD98] numberWithShort:v4];
  [v6 setOriginalOrientation:v5];
}

- (signed)originalOrientation
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalOrientation];
  v4 = [v3 shortValue];

  return v4;
}

- (void)setOriginalFilename:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setOriginalFilename:v4];
}

- (void)setPublicGlobalUUID:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setPublicGlobalUUID:v4];
}

- (NSString)publicGlobalUUID
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 publicGlobalUUID];

  return v3;
}

- (void)setOriginalHash:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setOriginalHash:v4];
}

- (NSData)originalHash
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalHash];

  return v3;
}

- (void)setOriginalWidth:(int64_t)a3
{
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithLongLong:a3];
  [v5 setOriginalWidth:v4];
}

- (int64_t)originalWidth
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalWidth];
  v4 = [v3 longLongValue];

  return v4;
}

- (void)setOriginalHeight:(int64_t)a3
{
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithLongLong:a3];
  [v5 setOriginalHeight:v4];
}

- (int64_t)originalHeight
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalHeight];
  v4 = [v3 longLongValue];

  return v4;
}

- (void)setOriginalAssetsUUID:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setOriginalAssetsUUID:v4];
}

- (NSString)originalAssetsUUID
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalAssetsUUID];

  return v3;
}

- (void)setEditorBundleID:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setEditorBundleID:v4];
}

- (NSString)editorBundleID
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 editorBundleID];

  return v3;
}

- (void)setImportedByDisplayName:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setImportedByDisplayName:v4];
}

- (NSString)importedByDisplayName
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 importedByDisplayName];

  return v3;
}

+ (void)computePreCropThumbnailSize:(CGSize *)a3 andPostCropSize:(CGSize *)a4 forOrientedOriginalSize:(CGSize)a5 andCroppedSize:(CGSize)a6 isLargeThumbnail:(BOOL)a7
{
  v7 = a7;
  height = a6.height;
  width = a6.width;
  v10 = a5.height;
  v11 = a5.width;
  if (PLMaxIOSurfaceDimension_onceToken != -1)
  {
    dispatch_once(&PLMaxIOSurfaceDimension_onceToken, &__block_literal_global_13720);
  }

  v14 = PLMaxIOSurfaceDimension_maxDimension;
  v15 = [MEMORY[0x1E69BF248] defaultFormatChooser];
  v16 = v15;
  if (v7)
  {
    v17 = [v15 fullScreenFormatForCurrentDevice];

    v18 = MEMORY[0x19EAEEA40]([v17 fullSizeDesiredLongSide], objc_msgSend(v17, "fullSizeMinShortSide"), objc_msgSend(v17, "fullSizeMaxLongSide"), 2, width, height);
    v20 = v19;
    v16 = v17;
  }

  else
  {
    v21 = [v15 masterThumbnailFormat];
    [v21 scaledSizeForSourceSize:1 capLength:{width, height}];
    v18 = v22;
    v20 = v23;
  }

  v24 = ceil(v11 * (v18 / width));
  v25 = ceil(v10 * (v18 / width));
  v26 = v14;
  if (v24 > v14 || v25 > v26)
  {
    if (v24 > v26)
    {
      v24 = v14;
      v25 = v10 * v26 / v11;
    }

    if (v25 > v26)
    {
      v25 = v14;
      v24 = v11 * v26 / v10;
    }

    v28 = v18 != (width * v24 / v11);
    if (v20 != (height * v25 / v10))
    {
      v28 = 1;
    }

    if (v28)
    {
      v20 = (height * v25 / v10);
      v18 = (width * v24 / v11);
    }
  }

  if (v24 >= 2.0)
  {
    v24 = ((v24 + (v24 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (v25 >= 2.0)
  {
    v25 = ((v25 + (v25 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (v18 >= 2.0)
  {
    v18 = ((v18 + (v18 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (v20 >= 2.0)
  {
    v20 = ((v20 + (v20 >> 63)) & 0xFFFFFFFFFFFFFFFELL);
  }

  if (a4)
  {
    a4->width = v18;
    a4->height = v20;
  }

  if (a3)
  {
    a3->width = v24;
    a3->height = v25;
  }
}

+ (void)createThumbnailImage:(id *)a3 previewImage:(id *)a4 withToBeReleasedImageSource:(CGImageSource *)a5
{
  options = objc_alloc_init(MEMORY[0x1E695DF90]);
  v8 = MEMORY[0x1E695E118];
  [(__CFDictionary *)options setObject:MEMORY[0x1E695E118] forKeyedSubscript:*MEMORY[0x1E696E000]];
  [(__CFDictionary *)options setObject:v8 forKeyedSubscript:*MEMORY[0x1E696DFE8]];
  v9 = MEMORY[0x1E696AD98];
  v10 = [MEMORY[0x1E69BF248] defaultFormatChooser];
  v11 = [v10 masterThumbnailFormat];
  [v11 dimension];
  v12 = [v9 numberWithDouble:?];
  v13 = *MEMORY[0x1E696E100];
  [(__CFDictionary *)options setObject:v12 forKeyedSubscript:*MEMORY[0x1E696E100]];

  ThumbnailAtIndex = CGImageSourceCreateThumbnailAtIndex(a5, 0, options);
  v15 = DCIM_newPLImageWithCGImage();
  CGImageRelease(ThumbnailAtIndex);
  [(__CFDictionary *)options setObject:&unk_1F0FBB428 forKeyedSubscript:v13];
  v16 = CGImageSourceCreateThumbnailAtIndex(a5, 0, options);
  v17 = DCIM_newPLImageWithCGImage();
  CGImageRelease(v16);
  CFRelease(a5);
  if (a3)
  {
    v18 = v15;
    *a3 = v15;
  }

  if (a4)
  {
    v19 = v17;
    *a4 = v17;
  }
}

+ (id)_newPathAndDateDictionariesByAssetUUIDFromFetchResults:(id)a3 photoLibrary:(id)a4
{
  v41 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v27 = a4;
  v28 = [objc_alloc(MEMORY[0x1E695DF90]) initWithCapacity:{objc_msgSend(v5, "count")}];
  v6 = [v27 pathManager];
  v29 = [v6 photoDirectoryWithType:1];

  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  obj = v5;
  v7 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = @"filename";
    v10 = *v33;
    do
    {
      v11 = 0;
      v30 = v8;
      do
      {
        if (*v33 != v10)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v32 + 1) + 8 * v11);
        v13 = [v12 objectForKey:@"directory"];
        v14 = [v12 objectForKey:v9];
        if ([v13 length] && objc_msgSend(v14, "length"))
        {
          v15 = v9;
          v16 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@/%@", v13, v14];
          v17 = [v29 stringByAppendingPathComponent:v16];

          v18 = [v12 objectForKey:@"uuid"];
          if ([v18 length])
          {
            v19 = [v12 objectForKey:@"dateCreated"];
            v20 = v19;
            if (v19)
            {
              v38[0] = @"date";
              v38[1] = @"path";
              v39[0] = v19;
              v39[1] = v17;
              v21 = MEMORY[0x1E695DF20];
              v22 = v39;
              v23 = v38;
              v24 = 2;
            }

            else
            {
              v36 = @"path";
              v37 = v17;
              v21 = MEMORY[0x1E695DF20];
              v22 = &v37;
              v23 = &v36;
              v24 = 1;
            }

            v25 = [v21 dictionaryWithObjects:v22 forKeys:v23 count:v24];
            [v28 setObject:v25 forKey:v18];
          }

          v9 = v15;
          v8 = v30;
        }

        ++v11;
      }

      while (v8 != v11);
      v8 = [obj countByEnumeratingWithState:&v32 objects:v40 count:16];
    }

    while (v8);
  }

  return v28;
}

+ (id)pathAndDateDictionariesForAllIncompleteAssetsInManagedObjectContext:(id)a3
{
  v33[4] = *MEMORY[0x1E69E9840];
  v4 = a3;
  context = objc_autoreleasePoolPush();
  v5 = objc_alloc_init(MEMORY[0x1E695D5E0]);
  v6 = [objc_opt_class() entityInManagedObjectContext:v4];
  [v5 setEntity:v6];
  [v5 setResultType:2];
  v33[0] = @"uuid";
  v33[1] = @"directory";
  v33[2] = @"filename";
  v33[3] = @"dateCreated";
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v33 count:4];
  [v5 setPropertiesToFetch:v7];

  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"complete == 0"];
  v9 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForPLSyncClientIncompleteAssetExclusions"), 1}];
  v10 = MEMORY[0x1E696AB28];
  v32[0] = v8;
  v32[1] = v9;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v32 count:2];
  v12 = v10;
  v13 = v4;
  v14 = [v12 andPredicateWithSubpredicates:v11];

  [v5 setPredicate:v14];
  v27 = 0;
  v15 = [v13 executeFetchRequest:v5 error:&v27];
  v16 = v27;
  if (!v15)
  {
    v24 = v13;
    v17 = PLBackendGetLog();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = NSStringFromSelector(a2);
      *buf = 138412546;
      v29 = v18;
      v30 = 2112;
      v31 = v16;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "%@ failed to fetch incomplete assets %@", buf, 0x16u);
    }

    v13 = v24;
  }

  v19 = [v13 photoLibrary];
  v20 = [a1 _newPathAndDateDictionariesByAssetUUIDFromFetchResults:v15 photoLibrary:v19];
  v21 = v13;
  v22 = v20;

  objc_autoreleasePoolPop(context);

  return v22;
}

- (void)simulateQuarantineOriginalImageResourceOnPush:(id)a3
{
  v33 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if ([(PLManagedAsset *)self isPhoto])
  {
    v5 = objc_autoreleasePoolPush();
    v6 = [v4 identity];
    v7 = [v6 fileURL];

    v8 = MEMORY[0x1E69C08F0];
    v9 = [v4 identity];
    v10 = [v9 fileUTI];
    v11 = [v8 typeWithIdentifier:v10];

    v12 = *MEMORY[0x1E6982E58];
    if (([v11 conformsToType:*MEMORY[0x1E6982E58]] & 1) == 0 && !objc_msgSend(v11, "conformsToType:", *MEMORY[0x1E6982F28]))
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_20:

        objc_autoreleasePoolPop(v5);
        goto LABEL_21;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        *buf = 136315650;
        v28 = "[PLManagedAsset(CPLSimulateQuarantine) simulateQuarantineOriginalImageResourceOnPush:]";
        v29 = 2112;
        v30 = v11;
        v31 = 2112;
        v32 = v7;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "%s: unsupported uti: %@ for url: %@", buf, 0x20u);
      }

LABEL_19:

      goto LABEL_20;
    }

    v13 = [MEMORY[0x1E695F648] filterWithName:@"CISepiaTone"];
    [v13 setValue:&unk_1F0FC03E8 forKey:*MEMORY[0x1E695FAB8]];
    v14 = [MEMORY[0x1E695F658] imageWithContentsOfURL:v7];
    [v13 setValue:v14 forKey:*MEMORY[0x1E695FAB0]];
    v15 = [v13 outputImage];
    v16 = [MEMORY[0x1E695F620] context];
    v24 = v5;
    if ([v11 conformsToType:v12])
    {
      v17 = [v14 colorSpace];
      v26 = 0;
      v18 = [v16 writeJPEGRepresentationOfImage:v15 toURL:v7 colorSpace:v17 options:MEMORY[0x1E695E0F8] error:&v26];
      v19 = v26;
      if (v18)
      {
LABEL_18:

        v5 = v24;
        goto LABEL_19;
      }
    }

    else if ([v11 conformsToType:*MEMORY[0x1E6982F28]])
    {
      v20 = CGColorSpaceCreateWithName(*MEMORY[0x1E695F1C0]);
      v21 = *MEMORY[0x1E695F920];
      v25 = 0;
      v22 = [v16 writePNGRepresentationOfImage:v15 toURL:v7 format:v21 colorSpace:v20 options:MEMORY[0x1E695E0F8] error:&v25];
      v19 = v25;
      CFRelease(v20);
      if (v22)
      {
        goto LABEL_18;
      }
    }

    else
    {
      v19 = 0;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v23 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
      {
        *buf = 136315394;
        v28 = "[PLManagedAsset(CPLSimulateQuarantine) simulateQuarantineOriginalImageResourceOnPush:]";
        v29 = 2112;
        v30 = v7;
        _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_ERROR, "%s: failed to write output: %@", buf, 0x16u);
      }
    }

    goto LABEL_18;
  }

LABEL_21:
}

- (BOOL)shouldSimulateQuarantineOriginalImageResourceOnPush
{
  if (shouldSimulateQuarantineOriginalImageResourceOnPush_onceToken != -1)
  {
    dispatch_once(&shouldSimulateQuarantineOriginalImageResourceOnPush_onceToken, &__block_literal_global_16666);
  }

  return shouldSimulateQuarantineOriginalImageResourceOnPush_simulateQuarantine;
}

void __92__PLManagedAsset_CPLSimulateQuarantine__shouldSimulateQuarantineOriginalImageResourceOnPush__block_invoke()
{
  if (MEMORY[0x19EAEE230]())
  {
    v0 = [MEMORY[0x1E695E000] standardUserDefaults];
    shouldSimulateQuarantineOriginalImageResourceOnPush_simulateQuarantine = [v0 BOOLForKey:@"PLSimulateQuarantineMasterImageOnPush"];
  }
}

- (BOOL)cleanUpMetadataPath
{
  v15 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E696AC08] defaultManager];
  v4 = [(PLManagedAsset *)self pathForCameraMetadataFile];
  v10 = 0;
  v5 = [v3 removeItemAtPath:v4 error:&v10];
  v6 = v10;

  if ((v5 & 1) == 0)
  {
    v7 = PLBackendGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = [(PLManagedAsset *)self pathForCameraMetadataFile];
      *buf = 138412546;
      v12 = v8;
      v13 = 2112;
      v14 = v6;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "[SemDev] Unable to remove MDATA file at path %@: %@", buf, 0x16u);
    }
  }

  return 1;
}

- (BOOL)promoteSemanticEnhancePreviewToFinalImage:(id *)a3
{
  v20 = *MEMORY[0x1E69E9840];
  v17 = 0;
  v5 = [(PLManagedAsset *)self promoteDeferredPreviewToFinalImageWithOutError:&v17];
  v6 = v17;
  if (!v5)
  {
    v7 = PLDeferredProcessingGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v6;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "[SemDev] Error promoting deferred preview to final image: %@", buf, 0xCu);
    }
  }

  [(PLManagedAsset *)self cleanUpMetadataPath];
  [(PLManagedAsset *)self setDeferredProcessingNeeded:0];
  v8 = [(PLManagedAsset *)self additionalAttributes];
  [v8 setDeferredProcessingCandidateOptions:0];

  if ([(PLManagedAsset *)self hasAdjustments])
  {
    if (![(PLManagedAsset *)self isPhotoIrisPlaceholder])
    {
      [(PLManagedAsset *)self setDeferredProcessingNeeded:2];
      v9 = [(PLManagedObject *)self photoLibrary];
      v11 = [v9 libraryServicesManager];
      v12 = [v11 backgroundJobService];
      v13 = [(PLManagedObject *)self photoLibrary];
      v14 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
      [v12 signalBackgroundProcessingNeededOnLibrary:v13 workerTypes:v14];

LABEL_11:
      goto LABEL_12;
    }

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v9 = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        v10 = [(PLManagedAsset *)self uuid];
        *buf = 138543362;
        v19 = v10;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Promoted semantic enhance preview to final image for adjusted live photo (%{public}@) which is still a placeholder, skipping deferred adjustment", buf, 0xCu);
      }

      goto LABEL_11;
    }
  }

LABEL_12:
  if (a3 && v6)
  {
    v15 = v6;
    *a3 = v6;
  }

  return v6 == 0;
}

- (BOOL)installFinalVideoComplementAndRemoveDeferredFilesWithOutError:(id *)a3
{
  v23 = *MEMORY[0x1E69E9840];
  v5 = [MEMORY[0x1E696AC08] defaultManager];
  v6 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
  v18 = 0;
  v7 = [v5 removeItemAtPath:v6 error:&v18];
  v8 = v18;
  if (v7)
  {
  }

  else
  {
    v9 = PLIsErrorFileNotFound();

    if ((v9 & 1) == 0)
    {
      v13 = PLBackendGetLog();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
        *buf = 138412546;
        v20 = v14;
        v21 = 2112;
        v22 = v8;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to remove item at path %@: %@", buf, 0x16u);
      }

      goto LABEL_11;
    }
  }

  v17 = v8;
  v10 = [(PLManagedAsset *)self _updateAndStoreFinalVideoComplementResourceWithOutError:&v17];
  v11 = v17;

  if (v10)
  {
    [(PLManagedAsset *)self deleteResourcesWithRecipeID:131279 andVersion:0];
    v12 = 1;
    goto LABEL_15;
  }

  v13 = PLBackendGetLog();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v20 = v11;
    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to update and store video complement resource with error: %@", buf, 0xCu);
  }

  v8 = v11;
LABEL_11:

  if (a3)
  {
    v15 = v8;
    v12 = 0;
    *a3 = v8;
  }

  else
  {
    v12 = 0;
  }

  v11 = v8;
LABEL_15:

  return v12;
}

- (BOOL)promoteProxyToFinalVideoComplementWithOutError:(id *)a3
{
  v31 = *MEMORY[0x1E69E9840];
  v5 = [MEMORY[0x1E696AC08] defaultManager];
  v6 = MEMORY[0x1E69BF238];
  v7 = [(PLManagedAsset *)self fileURLForDeferredVideoComplement];
  v8 = [(PLManagedAsset *)self fileURLForOriginalVideoComplement];
  v26 = 0;
  v9 = [v6 copyItemAtURL:v7 toURL:v8 error:&v26];
  v10 = v26;
  if (v9 & 1) != 0 || ([MEMORY[0x1E69BF238] isFileExistsError:v10])
  {
    goto LABEL_3;
  }

  v18 = PLIsErrorFileNotFound();

  if ((v18 & 1) == 0)
  {
    v7 = PLBackendGetLog();
    if (!os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      goto LABEL_4;
    }

    v8 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
    *buf = 138412546;
    v28 = v8;
    v29 = 2112;
    v30 = v10;
    _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "[FDR] Error copying video complement proxy file %@, error: %@", buf, 0x16u);
LABEL_3:

LABEL_4:
  }

  v25 = v10;
  v11 = [(PLManagedAsset *)self _updateAndStoreFinalVideoComplementResourceWithOutError:&v25];
  v12 = v25;

  if (v11)
  {
    v13 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
    v24 = v12;
    v14 = [v5 removeItemAtPath:v13 error:&v24];
    v15 = v24;

    if (v14)
    {

LABEL_14:
      [(PLManagedAsset *)self deleteResourcesWithRecipeID:131279 andVersion:0];
      v20 = 1;
      goto LABEL_22;
    }

    v19 = PLIsErrorFileNotFound();

    if (v19)
    {
      goto LABEL_14;
    }

    v16 = PLBackendGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v21 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];
      *buf = 138412546;
      v28 = v21;
      v29 = 2112;
      v30 = v15;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Failed to remove item at path %@: %@", buf, 0x16u);
    }

    v12 = v15;
  }

  else
  {
    v16 = PLBackendGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = [(PLManagedAsset *)self uuid];
      *buf = 138543618;
      v28 = v17;
      v29 = 2112;
      v30 = v12;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Failed to install resources for asset %{public}@: %@", buf, 0x16u);
    }
  }

  if (a3)
  {
    v22 = v12;
    v20 = 0;
    *a3 = v12;
  }

  else
  {
    v20 = 0;
  }

  v15 = v12;
LABEL_22:

  return v20;
}

- (BOOL)_updateAndStoreFinalVideoComplementResourceWithOutError:(id *)a3
{
  v5 = [(PLManagedAsset *)self pathForVideoComplementFile];
  v6 = [(PLManagedAsset *)self managedObjectContext];
  v7 = [PLResourceInstaller validatedExternalResourceForLocalVideoIfPresentAtPath:v5 context:v6];

  if (!v7)
  {
    LOBYTE(v11) = 0;
    if (!a3)
    {
      goto LABEL_6;
    }

    goto LABEL_5;
  }

  [v7 setRecipeID:0];
  [v7 setResourceType:3];
  [v7 setVersion:0];
  v8 = [(PLManagedAsset *)self assetID];
  v9 = [v8 libraryID];
  v10 = PLDataStoreForClassIDAndLibraryID(0, v9);

  v15 = 0;
  v16 = 0;
  v11 = [v10 storeExternalResource:v7 forAsset:self options:0 error:&v16 resultingResource:&v15];
  v12 = v16;
  v13 = v15;
  if (v11)
  {
    [(PLManagedAsset *)self deleteResourcesWithRecipeID:131280 andVersion:0];
  }

  if (a3)
  {
LABEL_5:
    *a3 = 0;
  }

LABEL_6:

  return v11;
}

- (BOOL)transitionToDeferredProcessingNeededAdjustmentWithOriginalWidth:(unint64_t)a3 originalHeight:(unint64_t)a4 shouldSignalBackgroundProcessingNeeded:(BOOL)a5 reason:(id)a6
{
  v6 = a5;
  v26 = *MEMORY[0x1E69E9840];
  v10 = a6;
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v11 = [(PLManagedAsset *)self isPhotoIrisPlaceholder];
    if (!v11)
    {
      [(PLManagedAsset *)self setHeight:a4];
      [(PLManagedAsset *)self setWidth:a3];
      [(PLManagedAsset *)self setDeferredProcessingNeeded:2];
      v15 = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG))
      {
        v16 = [(PLManagedAsset *)self uuid];
        v22 = 138543618;
        v23 = v10;
        v24 = 2114;
        v25 = v16;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEBUG, "%{public}@ finished, transitioning asset (%{public}@) to deferred processing needed adjustment", &v22, 0x16u);
      }

      if (!v6)
      {
        v14 = 1;
        goto LABEL_13;
      }

      v12 = [(PLManagedObject *)self photoLibrary];
      v17 = [v12 libraryServicesManager];
      v18 = [v17 backgroundJobService];
      v19 = [(PLManagedObject *)self photoLibrary];
      v20 = [PLBackgroundJobWorkerTypes typesMaskForDeferredProcessingNeeded:[(PLManagedAsset *)self deferredProcessingNeeded]];
      [v18 signalBackgroundProcessingNeededOnLibrary:v19 workerTypes:v20];

      goto LABEL_11;
    }

    if ([(PLManagedAsset *)self isPhotoIris])
    {
      v12 = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEFAULT))
      {
        v13 = [(PLManagedAsset *)self uuid];
        v22 = 138543618;
        v23 = v10;
        v24 = 2114;
        v25 = v13;
        _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEFAULT, "%{public}@, but adjusted live photo (%{public}@) is still a placeholder, skipping deferred adjustment", &v22, 0x16u);
      }

LABEL_11:
      v14 = !v11;

      goto LABEL_13;
    }
  }

  v14 = 0;
LABEL_13:

  return v14;
}

- (BOOL)promoteDeferredPreviewToFinalImageWithOutError:(id *)a3
{
  v27 = *MEMORY[0x1E69E9840];
  v5 = [MEMORY[0x1E696AC08] defaultManager];
  v19 = 0;
  v20 = &v19;
  v21 = 0x3032000000;
  v22 = __Block_byref_object_copy__17653;
  v23 = __Block_byref_object_dispose__17654;
  v24 = 0;
  v15 = 0;
  v16 = &v15;
  v17 = 0x2020000000;
  v18 = 0;
  v6 = [(PLManagedObject *)self photoLibrary];
  if (v6)
  {
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __90__PLManagedAsset_DeferredPhotoProcessing__promoteDeferredPreviewToFinalImageWithOutError___block_invoke;
    v11[3] = &unk_1E7578898;
    v11[4] = self;
    v12 = v5;
    v13 = &v19;
    v14 = &v15;
    [v6 performTransactionAndWait:v11];
  }

  else
  {
    v7 = PLBackendGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      v8 = [(PLManagedAsset *)self objectID];
      *buf = 138543362;
      v26 = v8;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "photolibrary was nil for asset: %{public}@", buf, 0xCu);
    }
  }

  v9 = *(v16 + 24);
  if (a3 && (v16[3] & 1) == 0)
  {
    *a3 = v20[5];
    v9 = *(v16 + 24);
  }

  _Block_object_dispose(&v15, 8);
  _Block_object_dispose(&v19, 8);

  return v9 & 1;
}

void __90__PLManagedAsset_DeferredPhotoProcessing__promoteDeferredPreviewToFinalImageWithOutError___block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) mainFileURL];
  v3 = [*(a1 + 32) height];
  v4 = [*(a1 + 32) width];
  v5 = *(a1 + 40);
  v6 = [*(a1 + 32) fileURLForCurrentDeferredProcessingPreviewFile];
  v7 = *(*(a1 + 48) + 8);
  obj = *(v7 + 40);
  LODWORD(v5) = [v5 copyItemAtURL:v6 toURL:v2 error:&obj];
  objc_storeStrong((v7 + 40), obj);

  if (v5)
  {
    v8 = *(a1 + 32);
    v9 = *(*(a1 + 48) + 8);
    v19 = *(v9 + 40);
    v10 = [v8 installFinalImageAndRemoveDeferredFilesWithFinalImageURL:v2 previewImage:0 thumbnailImage:0 outError:&v19];
    objc_storeStrong((v9 + 40), v19);
    if (v10)
    {
      [*(a1 + 32) setSpatialType:0];
      v11 = [*(a1 + 32) additionalAttributes];
      [v11 setSleetIsReversible:0];

      *(*(*(a1 + 56) + 8) + 24) = 1;
    }

    else if (*(*(*(a1 + 48) + 8) + 40) && [MEMORY[0x1E69BF238] isFileExistsError:?])
    {
      *(*(*(a1 + 56) + 8) + 24) = 1;
      v17 = PLDeferredProcessingGetLog();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
      {
        v18 = [*(a1 + 32) mainFileURL];
        *buf = 138412290;
        v22 = v18;
        _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Asset has already been finalized into slot, skipping promoting final image: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    v12 = PLDeferredProcessingGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v13 = [*(a1 + 32) fileURLForCurrentDeferredProcessingPreviewFile];
      v14 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138412802;
      v22 = v13;
      v23 = 2112;
      v24 = v2;
      v25 = 2112;
      v26 = v14;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Failed to copy deferred preview: %@ into original slot: %@ with error: %@", buf, 0x20u);
    }

    [*(a1 + 32) requestDeletionOfDeferredPhotoProcessingIntermediates];
  }

  if (([*(a1 + 32) transitionToDeferredProcessingNeededAdjustmentWithOriginalWidth:v4 originalHeight:v3 shouldSignalBackgroundProcessingNeeded:0 reason:@"Promoted deferred preview to final image"] & 1) == 0 && objc_msgSend(*(a1 + 32), "deferredProcessingNeeded") != 7)
  {
    [*(a1 + 32) setDeferredProcessingNeeded:0];
  }

  v15 = [*(a1 + 32) additionalAttributes];
  v16 = [v15 deferredProcessingCandidateOptions];

  if ((v16 & 8) != 0)
  {
    *(*(*(a1 + 56) + 8) + 24) = [*(a1 + 32) cleanUpMetadataPath];
  }
}

- (BOOL)_updateAndStoreFinalPhotoResourceForResourceType:(unsigned int)a3 version:(unsigned int)a4 error:(id *)a5
{
  v6 = *&a4;
  v7 = *&a3;
  v33 = *MEMORY[0x1E69E9840];
  v9 = [(PLManagedAsset *)self mainFileURL];
  v10 = [v9 path];
  v11 = [(PLManagedAsset *)self width];
  v12 = [(PLManagedAsset *)self height];
  LOWORD(v28) = [(PLManagedAsset *)self kind];
  v13 = [PLResourceInstaller generateValidatedExternalImageResourceOfType:v7 forFilePath:v10 requireFileToBePresent:1 version:v6 basedOnFullSizeWidth:v11 andHeight:v12 recipe:0 assetKind:v28 error:0];

  if (v13)
  {
    v16 = [(PLManagedAsset *)self assetID];
    v14 = [v16 libraryID];
    v15 = PLDataStoreForClassIDAndLibraryID(0, v14);

    v29 = 0;
    v30 = 0;
    LODWORD(v16) = [v15 storeExternalResource:v13 forAsset:self options:0 error:&v30 resultingResource:&v29];
    v17 = v30;
    v18 = v29;
    if (v16)
    {
      [(PLManagedAsset *)self recalculateImageRequestHints];
      v19 = 0;
    }

    else
    {
      v23 = [MEMORY[0x1E695DF90] dictionary];
      [v17 code];
      v24 = NSStringFromPLErrorCode();
      [v23 setObject:v24 forKeyedSubscript:*MEMORY[0x1E696A278]];

      v25 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v6];
      [v23 setObject:v25 forKeyedSubscript:@"version"];

      [v23 setObject:v17 forKeyedSubscript:*MEMORY[0x1E696AA08]];
      v19 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:objc_msgSend(v17 userInfo:{"code"), v23}];
    }
  }

  else
  {
    v20 = PLBackendGetLog();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v21 = [(PLManagedAsset *)self uuid];
      *buf = 138412290;
      v32 = v21;
      _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_ERROR, "Failed to install deferred photo processing resources for asset %@", buf, 0xCu);
    }

    v15 = [MEMORY[0x1E695DF90] dictionary];
    v16 = NSStringFromPLErrorCode();
    [v15 setObject:v16 forKeyedSubscript:*MEMORY[0x1E696A278]];

    v22 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v6];
    [v15 setObject:v22 forKeyedSubscript:@"version"];

    v19 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:47010 userInfo:v15];
    LOBYTE(v16) = 0;
  }

  if (a5)
  {
    v26 = v19;
    *a5 = v19;
  }

  return v16;
}

- (BOOL)installFinalImageAndRemoveDeferredFilesWithFinalImageURL:(id)a3 previewImage:(id)a4 thumbnailImage:(id)a5 outError:(id *)a6
{
  v35 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a5;
  v12 = a4;
  v13 = PLBackendGetLog();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
  {
    v14 = [(PLManagedAsset *)self uuid];
    *buf = 138412546;
    v30 = v10;
    v31 = 2112;
    v32 = v14;
    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEBUG, "Installing final image and removing deferred files for url %@, uuid %@", buf, 0x16u);
  }

  v15 = [(PLManagedObject *)self photoLibrary];
  v16 = [(PLManagedAsset *)self savedAssetType];
  v17 = [(PLManagedAsset *)self uuid];
  LOBYTE(v27) = 1;
  LOBYTE(v26) = 0;
  v18 = [v15 addDCIMEntryAtFileURL:v10 mainFileMetadata:0 previewImage:v12 thumbnailImage:v11 savedAssetType:v16 replacementUUID:v17 publicGlobalUUID:0 extendedInfo:0 withUUID:0 isPlaceholder:v26 placeholderFileURL:0 forFinalCameraImage:v27];

  if (v18)
  {
    v28 = 0;
    v19 = [objc_opt_class() installResourcesForAssetAndRemoveDeferredProcessingPreviewFile:v18 error:&v28];
    v20 = v28;
    if (v19)
    {
      v21 = 1;
      goto LABEL_12;
    }
  }

  else
  {
    v20 = 0;
  }

  v22 = PLDeferredProcessingGetLog();
  if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
  {
    v23 = [(PLManagedAsset *)self uuid];
    *buf = 138543874;
    v30 = v23;
    v31 = 2112;
    v32 = v10;
    v33 = 2112;
    v34 = v20;
    _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Failed to install resources for asset %{public}@, at path %@, error: %@", buf, 0x20u);
  }

  if (a6)
  {
    v24 = v20;
    v21 = 0;
    *a6 = v20;
  }

  else
  {
    v21 = 0;
  }

LABEL_12:

  return v21;
}

- (void)requestDeletionOfDeferredPhotoProcessingIntermediates
{
  v11 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(PLCaptureDeferredPhotoProcessor);
  if (!v3)
  {
    v6 = PLBackendGetLog();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v8 = [(PLManagedAsset *)self uuid];
      v9 = 138543362;
      v10 = v8;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "Couldn't get a shared finalizer, unable to request intermediate deletions for asset: %{public}@", &v9, 0xCu);
    }

    goto LABEL_6;
  }

  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 deferredPhotoIdentifier];

  if (v5)
  {
    v6 = [(PLManagedAsset *)self additionalAttributes];
    v7 = [v6 deferredPhotoIdentifier];
    [(PLManagedAsset *)self _deleteDeferredIntermediatesForDeferredPhotoIdentifier:v7 withFinalizer:v3];

LABEL_6:
  }
}

- (void)_deleteDeferredIntermediatesForDeferredPhotoIdentifier:(id)a3 withFinalizer:(id)a4
{
  v20 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [objc_alloc(MEMORY[0x1E6987088]) initWithDeferredPhotoIdentifier:v6];
  v9 = PLBackendGetLog();
  v10 = v9;
  if (!v7 || !v8)
  {
    v13 = os_log_type_enabled(v9, OS_LOG_TYPE_ERROR);
    if (v7)
    {
      if (v13)
      {
        v14 = [(PLManagedAsset *)self uuid];
        v16 = 138412546;
        v17 = v14;
        v18 = 2112;
        v19 = v6;
        v15 = "Requested deletion of intermediates for asset: %@, deferredUUID: %@ but that deferredUUID is not recognized";
LABEL_11:
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, v15, &v16, 0x16u);
      }
    }

    else if (v13)
    {
      v14 = [(PLManagedAsset *)self uuid];
      v16 = 138412546;
      v17 = v14;
      v18 = 2112;
      v19 = v6;
      v15 = "Requested deletion of intermediates for asset: %@, deferredUUID: %@ but the shared finalizer was nil";
      goto LABEL_11;
    }

    goto LABEL_13;
  }

  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
  {
    v11 = [(PLManagedAsset *)self uuid];
    v12 = [v8 deferredPhotoIdentifier];
    v16 = 138412546;
    v17 = v11;
    v18 = 2112;
    v19 = v12;
    _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEFAULT, "Requesting deletion of intermediates for asset: %@, deferredUUID: %@", &v16, 0x16u);
  }

  [v7 deletePersistentStorageForPhotoProxy:v8];
LABEL_13:
}

+ (BOOL)installResourcesForAssetAndRemoveDeferredProcessingPreviewFile:(id)a3 error:(id *)a4
{
  v29 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = [MEMORY[0x1E696AC08] defaultManager];
  v7 = [v5 pathForDeferredProcessingPreviewFile];
  v8 = PLBackendGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    v9 = [v5 uuid];
    *buf = 138412546;
    v24 = v7;
    v25 = 2114;
    v26 = v9;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Deleting deferred preview at path: %@ for asset %{public}@", buf, 0x16u);
  }

  v22 = 0;
  v10 = [v6 removeItemAtPath:v7 error:&v22];
  v11 = v22;
  if (v10 & 1) != 0 || (PLIsErrorFileNotFound())
  {
    v21 = v11;
    v12 = [v5 _updateAndStoreFinalPhotoResourceForResourceType:0 version:0 error:&v21];
    v13 = v21;

    if (v12)
    {
      [v5 deleteResourcesWithRecipeID:65943 andVersion:0];
      [v5 deleteResourcesWithRecipeID:65951 andVersion:0];
      v14 = 1;
      goto LABEL_16;
    }

    v15 = PLDeferredProcessingGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v16 = [v5 uuid];
      *buf = 138543618;
      v24 = v16;
      v25 = 2112;
      v26 = v13;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Error updating and storing final resource for asset %{public}@ with error %@", buf, 0x16u);
    }

    v11 = v13;
  }

  else
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v17 = [MEMORY[0x1E69BF220] descriptionWithPath:v7];
      v18 = [v5 uuid];
      *buf = 138412802;
      v24 = v17;
      v25 = 2114;
      v26 = v18;
      v27 = 2112;
      v28 = v11;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Unable to delete deferred preview file: %@ for asset: %{public}@, with error: %@", buf, 0x20u);
    }
  }

  if (a4)
  {
    v19 = v11;
    v14 = 0;
    *a4 = v11;
  }

  else
  {
    v14 = 0;
  }

  v13 = v11;
LABEL_16:

  return v14;
}

- (BOOL)isEligibleForSearchIndexing
{
  if (([(PLManagedAsset *)self isDeleted]& 1) != 0)
  {
    return 0;
  }

  v4 = objc_opt_class();
  v5 = [(PLManagedObject *)self photoLibrary];
  v6 = [v4 isEligibleForSearchIndexingPredicateForLibraryIdentifier:{+[PLSpotlightDonationUtilities wellKnownPhotoLibraryIdentifierFromPLPhotoLibrary:](PLSpotlightDonationUtilities, "wellKnownPhotoLibraryIdentifierFromPLPhotoLibrary:", v5)}];
  v7 = [v6 evaluateWithObject:self];

  return v7;
}

+ (id)fetchAssetsWithUUIDs:(id)a3 managedObjectContext:(id)a4 error:(id *)a5
{
  v18[5] = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = MEMORY[0x1E695D5E0];
  v10 = a4;
  v11 = +[PLManagedAsset entityName];
  v12 = [v9 fetchRequestWithEntityName:v11];

  [v12 setIncludesPendingChanges:0];
  v13 = [a1 propertiesToFetch];
  [v12 setPropertiesToFetch:v13];

  v18[0] = @"additionalAttributes";
  v18[1] = @"additionalAttributes.keywords";
  v18[2] = @"additionalAttributes.assetDescription";
  v18[3] = @"additionalAttributes.sceneClassifications";
  v18[4] = @"additionalAttributes.personReferences.person";
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v18 count:5];
  [v12 setRelationshipKeyPathsForPrefetching:v14];

  if ([v8 count] >= 0x65)
  {
    [v12 setFetchBatchSize:100];
  }

  v15 = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid IN %@", v8];
  [v12 setPredicate:v15];

  [v12 setFetchLimit:{objc_msgSend(v8, "count")}];
  v16 = [v10 executeFetchRequest:v12 error:a5];

  return v16;
}

+ (id)fetchAssetsWithUUIDs:(id)a3 managedObjectContext:(id)a4
{
  v6 = a3;
  v7 = MEMORY[0x1E695D5E0];
  v8 = a4;
  v9 = +[PLManagedAsset entityName];
  v10 = [v7 fetchRequestWithEntityName:v9];

  [v10 setIncludesPendingChanges:0];
  v11 = [a1 propertiesToFetch];
  [v10 setPropertiesToFetch:v11];

  v12 = [a1 relationshipKeyPathsToPrefetch];
  [v10 setRelationshipKeyPathsForPrefetching:v12];

  if ([v6 count] >= 0x65)
  {
    [v10 setFetchBatchSize:100];
  }

  v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"uuid IN %@", v6];
  [v10 setPredicate:v13];

  [v10 setFetchLimit:{objc_msgSend(v6, "count")}];
  v18 = 0;
  v14 = [v8 executeFetchRequest:v10 error:&v18];

  v15 = v18;
  if (v14)
  {
    [MEMORY[0x1E69BF2D0] successWithResult:v14];
  }

  else
  {
    [MEMORY[0x1E69BF2D0] failureWithError:v15];
  }
  v16 = ;

  return v16;
}

+ (id)relationshipKeyPathsToPrefetch
{
  v4[8] = *MEMORY[0x1E69E9840];
  v4[0] = @"additionalAttributes";
  v4[1] = @"additionalAttributes.keywords";
  v4[2] = @"additionalAttributes.assetDescription";
  v4[3] = @"extendedAttributes";
  v4[4] = @"mediaAnalysisAttributes.characterRecognitionAttributes";
  v4[5] = @"mediaAnalysisAttributes.visualSearchAttributes";
  v4[6] = @"dayGroupHighlightBeingAssets";
  v4[7] = @"moment";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:8];

  return v2;
}

+ (id)propertiesToFetch
{
  v4[1] = *MEMORY[0x1E69E9840];
  v4[0] = @"uuid";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:1];

  return v2;
}

+ (id)isEligibleForSearchIndexingPredicateForLibraryIdentifier:(int64_t)a3
{
  v11[2] = *MEMORY[0x1E69E9840];
  pl_dispatch_once();
  if (a3 == 3)
  {
    v4 = MEMORY[0x1E696AE18];
    v5 = [MEMORY[0x1E695DF00] distantPast];
    v6 = [v4 predicateWithFormat:@"noindex:(%K) != %@", @"dateCreated", v5];

    v7 = MEMORY[0x1E696AB28];
    v11[0] = isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276;
    v11[1] = v6;
    v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:2];
    v9 = [v7 andPredicateWithSubpredicates:v8];
  }

  else
  {
    v9 = isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276;
  }

  return v9;
}

void __91__PLManagedAsset_SearchIndexing__isEligibleForSearchIndexingPredicateForLibraryIdentifier___block_invoke()
{
  v8[4] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"visibilityState", 0];
  v8[0] = v1;
  v2 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSearchIndexExclusions"), 0}];
  v8[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == NO", @"hidden"];
  v8[2] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"trashedState", 0];
  v8[3] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:4];
  v6 = [v0 andPredicateWithSubpredicates:v5];
  v7 = isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276;
  isEligibleForSearchIndexingPredicateForLibraryIdentifier__predicate_42276 = v6;
}

- (id)duplicateSortPropertyNamesSkip
{
  v4[1] = *MEMORY[0x1E69E9840];
  v4[0] = @"duplicateAssetVisibilityState";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:1];

  return v2;
}

- (id)duplicateSortPropertyNames
{
  v4[6] = *MEMORY[0x1E69E9840];
  v4[0] = @"favorite";
  v4[1] = @"latitude";
  v4[2] = @"longitude";
  v4[3] = @"dateCreated";
  v4[4] = @"playbackStyle";
  v4[5] = @"libraryScopeShareState";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:6];

  return v2;
}

+ (int64_t)pfAdjustmentsBaseVersionFromAdjustmentBaseVersion:(int64_t)a3
{
  if (a3 == 1)
  {
    return 1;
  }

  else
  {
    return 2 * (a3 == 2);
  }
}

+ (int64_t)adjustmentBaseVersionFromPFAdjustmentsBaseVersion:(int64_t)a3
{
  if (a3 == 1)
  {
    return 1;
  }

  else
  {
    return 2 * (a3 == 2);
  }
}

- (BOOL)unQuarantineIfPossible
{
  v40 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self master];
  v4 = [v3 cloudLocalState];

  if (v4 != 4)
  {
    return 0;
  }

  v35 = 0u;
  v36 = 0u;
  v33 = 0u;
  v34 = 0u;
  v5 = [(PLManagedAsset *)self master];
  v6 = [v5 assets];

  v7 = [v6 countByEnumeratingWithState:&v33 objects:v39 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v34;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v34 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v33 + 1) + 8 * i);
        if ([v11 cloudLocalState] != 4)
        {
          v23 = 0;
          goto LABEL_31;
        }

        v31 = 0u;
        v32 = 0u;
        v29 = 0u;
        v30 = 0u;
        v12 = [v11 modernResources];
        v13 = [v12 countByEnumeratingWithState:&v29 objects:v38 count:16];
        if (v13)
        {
          v14 = v13;
          v15 = *v30;
          while (2)
          {
            for (j = 0; j != v14; ++j)
            {
              if (*v30 != v15)
              {
                objc_enumerationMutation(v12);
              }

              v17 = *(*(&v29 + 1) + 8 * j);
              if ([v17 isCPLResource] && (objc_msgSend(v17, "isDerivative") & 1) == 0 && !objc_msgSend(v17, "isLocallyAvailable"))
              {
                v23 = 0;
                goto LABEL_30;
              }
            }

            v14 = [v12 countByEnumeratingWithState:&v29 objects:v38 count:16];
            if (v14)
            {
              continue;
            }

            break;
          }
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v33 objects:v39 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  [(PLManagedAsset *)self setCloudLocalState:0];
  [(PLManagedAsset *)self setUploadAttempts:0];
  [(PLManagedAsset *)self setLastUploadAttemptDate:0];
  v27 = 0u;
  v28 = 0u;
  v25 = 0u;
  v26 = 0u;
  v18 = [(PLManagedAsset *)self modernResources];
  v19 = [v18 countByEnumeratingWithState:&v25 objects:v37 count:16];
  if (v19)
  {
    v20 = v19;
    v21 = *v26;
    do
    {
      for (k = 0; k != v20; ++k)
      {
        if (*v26 != v21)
        {
          objc_enumerationMutation(v18);
        }

        [*(*(&v25 + 1) + 8 * k) setCloudLocalState:0];
      }

      v20 = [v18 countByEnumeratingWithState:&v25 objects:v37 count:16];
    }

    while (v20);
  }

  [(PLManagedAsset *)self setOriginalHash:0];
  v6 = [(PLManagedAsset *)self managedObjectContext];
  v12 = [(PLManagedAsset *)self master];
  [v6 deleteObject:v12];
  v23 = 1;
LABEL_30:

LABEL_31:
  return v23;
}

- (id)photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:(id)a3
{
  v30 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (!v5)
  {
    v21 = [MEMORY[0x1E696AAA8] currentHandler];
    [v21 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4553 description:@"Identifier must not be nil"];
  }

  v6 = [(PLManagedAsset *)self collectionShare];

  if (v6)
  {
    v22 = [MEMORY[0x1E696AAA8] currentHandler];
    [v22 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4554 description:{@"CollectionShare assets should not be calling %s", "-[PLManagedAsset(CPL) photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:]"}];
  }

  v7 = [(PLManagedAsset *)self momentShare];
  v8 = v7;
  if (v7)
  {
    v9 = [v7 uuid];
    v10 = [(PLManagedAsset *)self managedObjectContext];
    v11 = [v10 pathManager];

    if (!v11)
    {
      v11 = [MEMORY[0x1E69BF2A0] systemLibraryPathManager];
    }

    v12 = [v11 privateDirectoryWithSubType:7];
    v13 = [v12 stringByAppendingPathComponent:v9];
  }

  else
  {
    v14 = [v5 hash];
    v9 = [MEMORY[0x1E696AEC0] stringWithFormat:@"group%u", v14 % 0x1F4];
    v15 = [(PLManagedAsset *)self managedObjectContext];
    v16 = [v15 pathManager];
    v11 = [v16 photoDirectoryWithType:30];

    v13 = [v11 stringByAppendingPathComponent:v9];
  }

  v23 = 0;
  v17 = [MEMORY[0x1E69BF238] createDirectoryAtPath:v13 error:&v23];
  v18 = v23;
  if ((v17 & 1) == 0)
  {
    v19 = PLBackendGetLog();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      *buf = 136315650;
      v25 = "[PLManagedAsset(CPL) photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:]";
      v26 = 2112;
      v27 = v13;
      v28 = 2112;
      v29 = v18;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "%s: failed to create directory: %@ with error: %@", buf, 0x20u);
    }
  }

  return v13;
}

- (BOOL)faceDetectionComplete
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 faceAnalysisVersion];
  v4 = +[PLMediaAnalysisServiceRequestAdapter currentFaceVersion];
  LOBYTE(v3) = [v4 intValue] == v3;

  return v3;
}

- (id)syncDescription
{
  v6[4] = *MEMORY[0x1E69E9840];
  v6[0] = @"cloudAssetGUID";
  v6[1] = @"uuid";
  v6[2] = @"master";
  v6[3] = @"detectedFaces";
  v3 = [MEMORY[0x1E695DEC8] arrayWithObjects:v6 count:4];
  v4 = [(NSManagedObject *)self truncatedDescriptionWithPropertyKeys:v3];

  return v4;
}

- (NSString)syncedAdjustmentFingerprint
{
  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v3 = [(PLManagedAsset *)self additionalAttributes];
    v4 = [v3 unmanagedAdjustment];
    v5 = [v4 otherAdjustmentsFingerprint];

    if (!v5)
    {
      v5 = [(PLManagedAsset *)self _calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources];
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)originalStableHashCacheIfNecessaryAndAdjustedStableHash:(id *)a3 fullsizeRenderImageIfNecessary:(BOOL)a4 enableSaveIfNecessary:(BOOL)a5 error:(id *)a6
{
  v55 = a5;
  v53 = a4;
  v79 = *MEMORY[0x1E69E9840];
  v7 = [(PLManagedAsset *)self additionalAttributes];
  v8 = [v7 originalStableHash];
  v9 = v8;
  if (v8)
  {
    v10 = 0;
    v11 = v8;
    goto LABEL_3;
  }

  v18 = [(PLManagedAsset *)self master];
  v17 = v18;
  v10 = v18 != 0;
  if (!v18)
  {
    goto LABEL_28;
  }

  v19 = [v18 scopedIdentifier];
  v11 = [v19 identifier];

  if (!v11)
  {
    goto LABEL_28;
  }

  if (([MEMORY[0x1E6994AE0] isStableHash:v11] & 1) == 0)
  {

LABEL_28:
    v72 = 0;
    v28 = [(PLManagedAsset *)self _canComputeMasterIdentifierOrStableHashWithError:?];
    v16 = v72;
    if (!v28 || (-[PLManagedAsset mainFileURL](self, "mainFileURL"), (v29 = objc_claimAutoreleasedReturnValue()) == 0) || ([MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash], v30 = objc_claimAutoreleasedReturnValue(), v71 = v16, objc_msgSend(v30, "fingerPrintForFileAtURL:error:", v29, &v71), v11 = objc_claimAutoreleasedReturnValue(), v20 = v71, v16, v30, v29, v16 = v20, !v11))
    {
      if (a6)
      {
        v31 = v16;
        v11 = 0;
        *a6 = v16;
      }

      else
      {
        v11 = 0;
      }

      goto LABEL_35;
    }

    goto LABEL_31;
  }

  v20 = 0;
LABEL_31:
  [v7 setOriginalStableHash:v11];

LABEL_3:
  v12 = ![(PLManagedAsset *)self hasAdjustments];
  if (!a3)
  {
    LOBYTE(v12) = 1;
  }

  if ((v12 & 1) != 0 || ([v7 adjustedStableHash], v13 = objc_claimAutoreleasedReturnValue(), (*a3 = v13) != 0))
  {
LABEL_7:
    if (!v9 && v55)
    {
      goto LABEL_9;
    }

    goto LABEL_37;
  }

  if (!v10)
  {
    goto LABEL_46;
  }

  v52 = [(PLManagedAsset *)self allAssetCPLResources];
  v21 = [(PLManagedAsset *)self bestResourceTypeForAdjustedStableHash];
  if (v21)
  {
    v69 = 0u;
    v70 = 0u;
    v68 = 0u;
    v67 = 0u;
    v22 = v52;
    v23 = [v22 countByEnumeratingWithState:&v67 objects:v78 count:16];
    if (v23)
    {
      v24 = *v68;
      while (2)
      {
        for (i = 0; i != v23; ++i)
        {
          if (*v68 != v24)
          {
            objc_enumerationMutation(v22);
          }

          v26 = *(*(&v67 + 1) + 8 * i);
          if ([v26 cplType] == v21)
          {
            v27 = v26;
            goto LABEL_41;
          }
        }

        v23 = [v22 countByEnumeratingWithState:&v67 objects:v78 count:16];
        if (v23)
        {
          continue;
        }

        break;
      }
    }

    v27 = 0;
LABEL_41:

    v33 = [v27 stableHash];
    v34 = v33;
    if (v33)
    {
      v35 = v33;
      *a3 = v34;
    }

    else
    {
      v36 = [v27 fingerprint];
      *a3 = v36;
    }
  }

  if (!*a3)
  {
LABEL_46:
    if (![(PLManagedAsset *)self isPhoto])
    {
      if (![(PLManagedAsset *)self isDefaultAdjustedSlomo])
      {
        v37 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        if (v37)
        {
          v38 = [objc_alloc(MEMORY[0x1E695DFF8]) initFileURLWithPath:v37 isDirectory:0];
          v39 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
          v58 = 0;
          v40 = [v39 fingerPrintForFileAtURL:v38 error:&v58];
          v41 = v58;
          v42 = v40;
          *a3 = v40;
        }

        else
        {
          v41 = 0;
        }

        if (!*a3 && a6)
        {
          v51 = v41;
          *a6 = v41;
        }
      }

LABEL_63:
      if (!*a3)
      {
        goto LABEL_7;
      }

      goto LABEL_64;
    }

    *&buf = 0;
    *(&buf + 1) = &buf;
    v74 = 0x3032000000;
    v75 = __Block_byref_object_copy__51017;
    v76 = __Block_byref_object_dispose__51018;
    v77 = 0;
    v61 = 0;
    v62 = &v61;
    v63 = 0x3032000000;
    v64 = __Block_byref_object_copy__51017;
    v65 = __Block_byref_object_dispose__51018;
    v66 = 0;
    if (v53)
    {
      v60[0] = MEMORY[0x1E69E9820];
      v60[1] = 3221225472;
      v60[2] = __138__PLManagedAsset_CPL__originalStableHashCacheIfNecessaryAndAdjustedStableHash_fullsizeRenderImageIfNecessary_enableSaveIfNecessary_error___block_invoke;
      v60[3] = &unk_1E756D898;
      v60[4] = &buf;
      v60[5] = &v61;
      [(PLManagedAsset *)self synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:0 withCompletionHandler:v60];
    }

    else
    {
      v43 = [(PLManagedAsset *)self pathForFullsizeImageFile];
      v44 = [objc_alloc(MEMORY[0x1E695DFF8]) initFileURLWithPath:v43 isDirectory:0];
      v45 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
      v46 = (v62 + 5);
      obj = v62[5];
      v47 = [v45 fingerPrintForFileAtURL:v44 error:&obj];
      objc_storeStrong(v46, obj);
      v48 = *(*(&buf + 1) + 40);
      *(*(&buf + 1) + 40) = v47;
    }

    v49 = *(*(&buf + 1) + 40);
    v50 = a3;
    if (!v49)
    {
      if (!a6)
      {
LABEL_57:
        _Block_object_dispose(&v61, 8);

        _Block_object_dispose(&buf, 8);
        goto LABEL_63;
      }

      v49 = v62[5];
      v50 = a6;
    }

    *v50 = v49;
    goto LABEL_57;
  }

LABEL_64:
  [v7 setAdjustedStableHash:?];
  if (v55)
  {
LABEL_9:
    v14 = [(PLManagedAsset *)self managedObjectContext];
    v57 = 0;
    v15 = [v14 save:&v57];
    v16 = v57;

    if (v15)
    {
LABEL_36:

      goto LABEL_37;
    }

    v17 = PLBackendGetLog();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      LODWORD(buf) = 138412290;
      *(&buf + 4) = v16;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "Error trying to save cached stableHashes: %@", &buf, 0xCu);
    }

LABEL_35:

    goto LABEL_36;
  }

LABEL_37:

  return v11;
}

- (uint64_t)_canComputeMasterIdentifierOrStableHashWithError:(uint64_t)result
{
  v10[1] = *MEMORY[0x1E69E9840];
  if (result)
  {
    v3 = result;
    if ([result complete])
    {
      if (([v3 isTimelapsePlaceholder] & 1) == 0 && !objc_msgSend(v3, "isPhotoIrisPlaceholder"))
      {
        return 1;
      }

      v4 = @"Asset is a placeholder";
    }

    else
    {
      v4 = @"Asset is not complete";
    }

    v5 = MEMORY[0x1E696ABC0];
    v6 = *MEMORY[0x1E69BFF48];
    v9 = *MEMORY[0x1E696A278];
    v10[0] = v4;
    v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v10 forKeys:&v9 count:1];
    v8 = [v5 errorWithDomain:v6 code:45701 userInfo:v7];
    if (a2)
    {
      v8 = v8;
      *a2 = v8;
    }

    return 0;
  }

  return result;
}

void __138__PLManagedAsset_CPL__originalStableHashCacheIfNecessaryAndAdjustedStableHash_fullsizeRenderImageIfNecessary_enableSaveIfNecessary_error___block_invoke(uint64_t a1, void *a2)
{
  if (a2)
  {
    v3 = MEMORY[0x1E695DFF8];
    v4 = a2;
    v5 = [[v3 alloc] initFileURLWithPath:v4 isDirectory:0];

    v6 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
    v7 = *(*(a1 + 40) + 8);
    obj = *(v7 + 40);
    v8 = [v6 fingerPrintForFileAtURL:v5 error:&obj];
    objc_storeStrong((v7 + 40), obj);
    v9 = *(*(a1 + 32) + 8);
    v10 = *(v9 + 40);
    *(v9 + 40) = v8;
  }
}

- (id)masterIdentifierCacheIfNecessaryAndOriginalStableHash:(id *)a3 error:(id *)a4
{
  v39 = *MEMORY[0x1E69E9840];
  v8 = [(PLManagedAsset *)self master];
  v9 = v8;
  if (!v8)
  {
    v16 = [(PLManagedAsset *)self fingerprintContext];
    v11 = [v16 fingerprintSchemeForNewMasterAsset];
    *buf = v11;

    v36 = 0;
    LOBYTE(v16) = [(PLManagedAsset *)self _canComputeMasterIdentifierOrStableHashWithError:?];
    v14 = v36;
    if (v16)
    {
      v17 = [(PLManagedAsset *)self mainFileURL];
      if (v17)
      {
        v18 = v17;
        v34 = v14;
        v35 = 0;
        v11 = [(PLManagedAsset *)self _computeNewMasterIdentifierAndStableHash:buf fingerprintScheme:v17 forMasterFileURL:&v34 error:?];
        v19 = v34;

        v20 = v35;
        if (v11)
        {
          if (!v35)
          {
            v32 = [MEMORY[0x1E696AAA8] currentHandler];
            [v32 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4332 description:{@"Got a master identifier without an original stableHash for %@", self}];
          }

          v21 = [(PLManagedAsset *)self additionalAttributes];
          [v21 setOriginalStableHash:v20];

          v22 = v20;
          *a3 = v20;

          goto LABEL_16;
        }

        v14 = v19;
        if (a4)
        {
          goto LABEL_24;
        }

        goto LABEL_26;
      }
    }

    goto LABEL_23;
  }

  v10 = [v8 scopedIdentifier];
  v11 = [v10 identifier];

  if (!v11)
  {
    v14 = [MEMORY[0x1E6994AB0] unknownError];
    if (a4)
    {
LABEL_24:
      v30 = v14;
      v11 = 0;
      *a4 = v14;
LABEL_27:
      v19 = v14;
      goto LABEL_28;
    }

LABEL_26:
    v11 = 0;
    goto LABEL_27;
  }

  v12 = [(PLManagedAsset *)self additionalAttributes];
  v13 = [v12 originalStableHash];

  if (v13)
  {
    v14 = 0;
    v15 = v13;
    goto LABEL_15;
  }

  v37 = 0;
  v15 = [(PLManagedAsset *)self _findMissingOriginalStableHashFromMaster:v9 error:&v37];
  v14 = v37;
  if (!v15)
  {
LABEL_23:

    if (a4)
    {
      goto LABEL_24;
    }

    goto LABEL_26;
  }

  v23 = [(PLManagedAsset *)self additionalAttributes];
  [v23 setOriginalStableHash:v15];

LABEL_15:
  v24 = [(PLManagedAsset *)self additionalAttributes];
  *a3 = [v24 originalStableHash];

  v19 = v14;
  if (!v13)
  {
LABEL_16:
    v25 = [(PLManagedAsset *)self managedObjectContext];
    v33 = 0;
    v26 = [v25 save:&v33];
    v27 = v33;

    if ((v26 & 1) == 0)
    {
      v28 = PLBackendGetLog();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        *&buf[4] = v27;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Error trying to save cached stableHash: %@", buf, 0xCu);
      }
    }
  }

  if (!*a3)
  {
    v29 = [MEMORY[0x1E696AAA8] currentHandler];
    [v29 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:4349 description:{@"Produced a master identifier without a stableHash for %@", self}];
  }

LABEL_28:

  return v11;
}

- (id)_computeNewMasterIdentifierAndStableHash:(id *)a3 fingerprintScheme:(void *)a4 forMasterFileURL:(void *)a5 error:
{
  v9 = a4;
  if (a1)
  {
    v10 = [a1 fingerprintContext];
    v11 = [v10 fingerprintSchemeForNewMasterAsset];

    v22 = 0;
    v12 = [v11 fingerPrintForFileAtURL:v9 error:&v22];
    v13 = v22;
    v14 = v13;
    if (v12)
    {
      if ([v11 isForStableHash])
      {
        v15 = v12;
        v16 = v14;
LABEL_8:
        objc_storeStrong(a3, v11);
        objc_storeStrong(a2, v15);
        goto LABEL_11;
      }

      v18 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
      v21 = v14;
      v15 = [v18 fingerPrintForFileAtURL:v9 error:&v21];
      v16 = v21;

      if (v15)
      {
        goto LABEL_8;
      }

      if (!a5)
      {
LABEL_10:
        v15 = 0;
        v12 = 0;
        goto LABEL_11;
      }
    }

    else
    {
      v16 = v13;
      if (!a5)
      {
        goto LABEL_10;
      }
    }

    v17 = v16;
    v15 = 0;
    v12 = 0;
    *a5 = v16;
LABEL_11:
    v19 = v12;

    goto LABEL_12;
  }

  v19 = 0;
LABEL_12:

  return v19;
}

- (id)_findMissingOriginalStableHashFromMaster:(id)a3 error:(id *)a4
{
  v35 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = [v6 scopedIdentifier];
  v8 = [v7 identifier];

  v9 = [v6 fingerprintScheme];
  if ([v9 isForStableHash] && v8)
  {
    v10 = v8;
  }

  else
  {
    v33 = 0;
    v11 = [v6 stableHashFromOriginalResourceError:&v33];
    v12 = v33;
    v13 = v12;
    if (!v11)
    {
      v27 = self;
      v28 = v12;
      v26 = a4;
      v31 = 0u;
      v32 = 0u;
      v29 = 0u;
      v30 = 0u;
      v14 = [v6 assets];
      v15 = [v14 countByEnumeratingWithState:&v29 objects:v34 count:16];
      if (v15)
      {
        v16 = v15;
        v17 = *v30;
        while (2)
        {
          for (i = 0; i != v16; ++i)
          {
            if (*v30 != v17)
            {
              objc_enumerationMutation(v14);
            }

            v19 = *(*(&v29 + 1) + 8 * i);
            v20 = objc_autoreleasePoolPush();
            v21 = [v19 additionalAttributes];
            v11 = [v21 originalStableHash];

            objc_autoreleasePoolPop(v20);
            if (v11)
            {

              goto LABEL_17;
            }
          }

          v16 = [v14 countByEnumeratingWithState:&v29 objects:v34 count:16];
          if (v16)
          {
            continue;
          }

          break;
        }
      }

      v22 = [(PLManagedAsset *)v27 additionalAttributes];
      v23 = [v22 originalHash];

      v11 = [v23 base64EncodedStringWithOptions:0];

      if (v11)
      {
LABEL_17:
        v13 = v28;
      }

      else
      {
        v13 = v28;
        if (v26)
        {
          v24 = v28;
          v11 = 0;
          *v26 = v28;
        }

        else
        {
          v11 = 0;
        }
      }
    }

    v10 = v11;
  }

  return v10;
}

- (unint64_t)bestResourceTypeForAdjustedStableHash
{
  if ([(PLManagedAsset *)self isPhoto])
  {
    return 2;
  }

  if ([(PLManagedAsset *)self isDefaultAdjustedSlomo])
  {
    return 0;
  }

  return 16;
}

- (id)descriptionForResources
{
  v26[1] = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E696AD60] string];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dataStoreSubtype" ascending:1];
  v26[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:1];

  v6 = [(PLManagedAsset *)self modernResources];
  v7 = [v6 allObjects];
  v8 = [v7 sortedArrayUsingDescriptors:v5];

  if ([v8 count])
  {
    v20 = v5;
    [v3 appendFormat:@"%lu resources\n", objc_msgSend(v8, "count")];
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v19 = v8;
    v9 = v8;
    v10 = [v9 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v22;
      do
      {
        for (i = 0; i != v11; ++i)
        {
          if (*v22 != v12)
          {
            objc_enumerationMutation(v9);
          }

          v14 = *(*(&v21 + 1) + 8 * i);
          [v3 appendFormat:@"\t%@\n", v14];
          if ([v14 isLocallyAvailable])
          {
            v15 = [v14 fileURL];
            v16 = [v15 path];

            v17 = [PLCacheDeleteSupport purgeableStateDescriptionForFile:v16];
            [v3 appendFormat:@"Purgeable: %@\n", v17];
          }
        }

        v11 = [v9 countByEnumeratingWithState:&v21 objects:v25 count:16];
      }

      while (v11);
    }

    v5 = v20;
    v8 = v19;
  }

  return v3;
}

- (BOOL)supportsCloudUpload
{
  if (([(PLManagedAsset *)self isDeleted]& 1) != 0)
  {
    goto LABEL_15;
  }

  v3 = [objc_opt_class() _syncablePredicate];
  v4 = [v3 evaluateWithObject:self];

  if (!v4)
  {
    goto LABEL_15;
  }

  v5 = [objc_opt_class() predicateForSupportedAssetTypesForUpload];
  v6 = [v5 evaluateWithObject:self];

  if (!v6)
  {
    goto LABEL_15;
  }

  if ([(PLManagedAsset *)self isPartOfBurst])
  {
    if ([(PLManagedAsset *)self avalanchePickType]== 1)
    {
      goto LABEL_15;
    }
  }

  else if ([(PLManagedAsset *)self isTimelapsePlaceholder]|| [(PLManagedAsset *)self isPhotoIrisPlaceholder])
  {
    goto LABEL_15;
  }

  if (![(PLManagedAsset *)self isPlaceholderAsset])
  {
    goto LABEL_21;
  }

  v7 = [(PLManagedObject *)self photoLibrary];
  v8 = [PLManagedAsset shouldPerformServerCopyOnPlaceholderAsset:self photoLibrary:v7];

  if (!v8)
  {
LABEL_15:
    LOBYTE(v9) = 0;
    return v9;
  }

  v9 = [PLManagedAsset validShareForPlaceholderAsset:self];
  if (v9)
  {
LABEL_21:
    if ([(PLManagedAsset *)self isCPLSharingScopeAsset]&& ([(PLManagedAsset *)self shareRelationship], v10 = objc_claimAutoreleasedReturnValue(), v10, v10))
    {
      v11 = [(PLManagedAsset *)self shareRelationship];
      v12 = [v11 status];

      LOBYTE(v9) = v12 != 3;
    }

    else
    {
      LOBYTE(v9) = 1;
    }
  }

  return v9;
}

- (id)adjustedPathForCPLResourceType:(unint64_t)a3
{
  v13 = *MEMORY[0x1E69E9840];
  if (a3 <= 6)
  {
    if (a3 > 3)
    {
      if (a3 == 4)
      {
        v5 = [(PLManagedAsset *)self pathForAdjustedLargeThumbnailFile];
      }

      else
      {
        if (a3 == 5)
        {
          [(PLManagedAsset *)self pathForAdjustedMediumThumbnailFile];
        }

        else
        {
          [(PLManagedAsset *)self pathForAdjustedMediumVideoFile];
        }
        v5 = ;
      }

      goto LABEL_31;
    }

    if (a3 == 2)
    {
      v5 = [(PLManagedAsset *)self pathForAdjustedFullsizeImageFile];
      goto LABEL_31;
    }

    if (a3 == 3)
    {
      v5 = [(PLManagedAsset *)self pathForAdjustedLargeSizeImageFile];
      goto LABEL_31;
    }
  }

  else if (a3 > 20)
  {
    switch(a3)
    {
      case 0x15uLL:
        v5 = [(PLManagedAsset *)self pathForAdjustedLargeVideoFile];
        goto LABEL_31;
      case 0x1BuLL:
        v5 = [(PLManagedAsset *)self pathForAdjustedMediaMetadataFile];
        goto LABEL_31;
      case 0x1CuLL:
        v5 = [(PLManagedAsset *)self pathForAdjustedMediumHDRVideoFile];
        goto LABEL_31;
    }
  }

  else
  {
    switch(a3)
    {
      case 7uLL:
        v5 = [(PLManagedAsset *)self pathForAdjustedSmallVideoFile];
        goto LABEL_31;
      case 0xDuLL:
        v5 = [(PLManagedAsset *)self pathForAdjustmentDataFile];
        goto LABEL_31;
      case 0x13uLL:
        v5 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        goto LABEL_31;
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v6 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v7 = [MEMORY[0x1E6994B90] descriptionForResourceType:a3];
      v9 = 138412546;
      v10 = v7;
      v11 = 2112;
      v12 = self;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_DEBUG, "Unsupported resource type %@ for asset %@", &v9, 0x16u);
    }
  }

  v5 = 0;
LABEL_31:

  return v5;
}

- (id)nonAdjustedPathForCPLResourceType:(unint64_t)a3
{
  v13 = *MEMORY[0x1E69E9840];
  if (a3 <= 6)
  {
    if (a3 > 3)
    {
      if (a3 == 4)
      {
        v5 = [(PLManagedAsset *)self pathForNonAdjustedLargeThumbnailFile];
      }

      else
      {
        if (a3 == 5)
        {
          [(PLManagedAsset *)self pathForNonAdjustedMediumThumbnailFile];
        }

        else
        {
          [(PLManagedAsset *)self pathForNonAdjustedMediumVideoFile];
        }
        v5 = ;
      }

      goto LABEL_31;
    }

    if (a3 == 2)
    {
      v5 = [(PLManagedAsset *)self pathForNonAdjustedFullsizeImageFile];
      goto LABEL_31;
    }

    if (a3 == 3)
    {
      v5 = [(PLManagedAsset *)self pathForNonAdjustedLargeSizeImageFile];
      goto LABEL_31;
    }
  }

  else if (a3 > 20)
  {
    switch(a3)
    {
      case 0x15uLL:
        v5 = [(PLManagedAsset *)self pathForNonAdjustedLargeVideoFile];
        goto LABEL_31;
      case 0x1AuLL:
        v5 = [(PLManagedAsset *)self pathForVideoMetadataFile];
        goto LABEL_31;
      case 0x1CuLL:
        v5 = [(PLManagedAsset *)self pathForNonAdjustedMediumHDRVideoFile];
        goto LABEL_31;
    }
  }

  else
  {
    switch(a3)
    {
      case 7uLL:
        v5 = [(PLManagedAsset *)self pathForNonAdjustedSmallVideoFile];
        goto LABEL_31;
      case 0xAuLL:
        v5 = [(PLManagedAsset *)self pathForMediaMetadataFile];
        goto LABEL_31;
      case 0x12uLL:
        v5 = [(PLManagedAsset *)self pathForVideoComplementFile];
        goto LABEL_31;
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v6 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
    {
      v7 = [MEMORY[0x1E6994B90] descriptionForResourceType:a3];
      v9 = 138412546;
      v10 = v7;
      v11 = 2112;
      v12 = self;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_DEBUG, "Unsupported resource type %@ for asset %@", &v9, 0x16u);
    }
  }

  v5 = 0;
LABEL_31:

  return v5;
}

- (id)pathForCPLResourceType:(unint64_t)a3 adjusted:(BOOL)a4
{
  v4 = a4;
  if (a3 > 16)
  {
    if (a3 > 22)
    {
      if (a3 == 23)
      {
        v7 = [(PLManagedAsset *)self pathForSpatialOverCaptureContentFile];
        goto LABEL_29;
      }

      if (a3 == 24)
      {
        v7 = [(PLManagedAsset *)self pathForVideoComplementSpatialOverCaptureContentFile];
        goto LABEL_29;
      }

      if (a3 != 25)
      {
        goto LABEL_30;
      }
    }

    else
    {
      if (a3 == 17)
      {
        v8 = &__block_literal_global_597_51048;
        goto LABEL_25;
      }

      if (a3 != 20)
      {
        if (a3 != 22)
        {
          goto LABEL_30;
        }

        v8 = &__block_literal_global_601;
        goto LABEL_25;
      }
    }

    v7 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
    goto LABEL_29;
  }

  if (a3 > 13)
  {
    if (a3 == 14)
    {
      v7 = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
    }

    else
    {
      if (a3 == 15)
      {
        [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
      }

      else
      {
        [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
      }
      v7 = ;
    }
  }

  else
  {
    if (a3 != 1)
    {
      if (a3 != 8)
      {
        if (a3 == 9)
        {
          v7 = [(PLManagedAsset *)self pathForXMPFile];
          goto LABEL_29;
        }

LABEL_30:
        if (v4)
        {
          [(PLManagedAsset *)self adjustedPathForCPLResourceType:a3];
        }

        else
        {
          [(PLManagedAsset *)self nonAdjustedPathForCPLResourceType:a3];
        }
        v10 = ;
        goto LABEL_34;
      }

      v8 = &__block_literal_global_599;
LABEL_25:
      v9 = [(PLManagedAsset *)self firstPersistedResourceMatching:v8];
      v10 = [(PLManagedAsset *)self _pathForSidecarResource:v9];

      if (!v10)
      {
        goto LABEL_30;
      }

      goto LABEL_34;
    }

    v7 = [(PLManagedAsset *)self pathForOriginalFile];
  }

LABEL_29:
  v10 = v7;
  if (!v7)
  {
    goto LABEL_30;
  }

LABEL_34:

  return v10;
}

- (id)_pathForSidecarResource:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedObject *)self pathManager];
  if (![v5 isUBF])
  {
    v11 = [v4 sidecarRepresentation];
    v12 = [v11 fileURL];
    goto LABEL_5;
  }

  if (v4)
  {
    v6 = objc_alloc(MEMORY[0x1E69BF298]);
    v7 = [(PLManagedAsset *)self uuid];
    v8 = [(PLManagedAsset *)self bundleScope];
    v9 = [v4 uniformTypeIdentifier];
    v10 = [v9 identifier];
    v11 = [v6 initWithAssetUuid:v7 bundleScope:v8 uti:v10 resourceVersion:0 resourceType:{objc_msgSend(v4, "resourceType")}];

    v12 = [v5 readOnlyUrlWithIdentifier:v11];
LABEL_5:
    v13 = v12;
    v14 = [v12 path];

    goto LABEL_6;
  }

  v14 = 0;
LABEL_6:

  return v14;
}

- (BOOL)savedAssetTypeIsSupportedForUpload
{
  [MEMORY[0x1E69BF328] maskForAssetsEligibleForCloudKitTransport];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (void)postProcessResourceDependentPropertyChangesFromAssetChange:(id)a3 inLibrary:(id)a4
{
  v16 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if ([v5 hasChangeType:2])
  {
    v6 = [v5 videoComplementVisibilityState];
    if ((v6 & 8) != 0)
    {
      v7 = [(PLManagedAsset *)self assetResourceForCPLType:19];
      if (v7)
      {
      }

      else if ([(PLManagedAsset *)self hasAdjustments]|| ([(PLManagedAsset *)self masterResourceForCPLType:18], v11 = objc_claimAutoreleasedReturnValue(), v11, !v11))
      {
        [(PLManagedAsset *)self setVideoCpVisibilityState:v6 & 0xFFF7];
        goto LABEL_14;
      }
    }
  }

  if (![v5 hasChangeType:8])
  {
    goto LABEL_18;
  }

  v8 = [(PLManagedAsset *)self videoCpVisibilityState];
  if (![(PLManagedAsset *)self isPhotoIris])
  {
    goto LABEL_18;
  }

  if (![(PLManagedAsset *)self hasAdjustments])
  {
    goto LABEL_18;
  }

  if ((v8 & 8) != 0)
  {
    goto LABEL_18;
  }

  v9 = [(PLManagedAsset *)self assetResourceForCPLType:19];
  if (!v9)
  {
    goto LABEL_18;
  }

  v10 = v9;
  [(PLManagedAsset *)self setVideoCpVisibilityState:v8 | 8u];

LABEL_14:
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v12 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = [(PLManagedAsset *)self uuid];
      v14 = 138412290;
      v15 = v13;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Updated full editing support for asset %@", &v14, 0xCu);
    }
  }

LABEL_18:
  if ([(PLManagedAsset *)self isPhotoIris])
  {
    [(PLManagedAsset *)self updatePlaybackStyleWithLivePhotoPlayability:[(PLManagedAsset *)self canPlayPhotoIris]];
  }
}

- (void)removeLocalFileForResource:(id)a3 allowDCIMPath:(BOOL)a4
{
  v27 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = [MEMORY[0x1E696AC08] defaultManager];
  v8 = [(PLManagedAsset *)self managedObjectContext];
  v9 = [v8 pathManager];
  v10 = [v9 photoDirectoryWithType:4];

  v11 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v12 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      v24 = v6;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Removing local resource file for %@", buf, 0xCu);
    }
  }

  v13 = [v6 cplFileURL];
  v14 = [v13 path];

  if (!a4 && ([v14 hasPrefix:v10] & 1) != 0 || !objc_msgSend(v7, "fileExistsAtPath:", v14))
  {
    if (*v11)
    {
      v16 = 0;
      goto LABEL_21;
    }

    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 138412290;
      v24 = v6;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Skip removing local resource file for %@", buf, 0xCu);
    }

    v16 = 0;
    goto LABEL_20;
  }

  v22 = 0;
  v15 = [v7 removeItemAtPath:v14 error:&v22];
  v16 = v22;
  if (v15)
  {
    if ((*v11 & 1) == 0)
    {
      v17 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412290;
        v24 = v6;
        v18 = "Removed local resource file for %@";
        v19 = v17;
        v20 = OS_LOG_TYPE_DEBUG;
        v21 = 12;
LABEL_19:
        _os_log_impl(&dword_19BF1F000, v19, v20, v18, buf, v21);
        goto LABEL_20;
      }

      goto LABEL_20;
    }
  }

  else if ((*v11 & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v24 = v6;
      v25 = 2112;
      v26 = v16;
      v18 = "Can't remove local resource file for %@. Error: %@";
      v19 = v17;
      v20 = OS_LOG_TYPE_ERROR;
      v21 = 22;
      goto LABEL_19;
    }

LABEL_20:
  }

LABEL_21:
}

- (void)_removeAdjustmentDataResources
{
  v21 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v3 = [(PLManagedAsset *)self allAssetCPLResources];
  v4 = [v3 countByEnumeratingWithState:&v14 objects:v20 count:16];
  if (v4)
  {
    v6 = v4;
    v7 = *v15;
    v8 = MEMORY[0x1E6994D48];
    *&v5 = 138412290;
    v13 = v5;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(v3);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        if ([v10 cplType] == 13)
        {
          if ((*v8 & 1) == 0)
          {
            v11 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
            {
              *buf = v13;
              v19 = v10;
              _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Deleting the CPLResourceTypeAdjustmentData: %@", buf, 0xCu);
            }
          }

          [(PLManagedAsset *)self removeLocalFileForResource:v10];
          v12 = [(PLManagedAsset *)self managedObjectContext];
          [v12 deleteObject:v10];
        }
      }

      v6 = [v3 countByEnumeratingWithState:&v14 objects:v20 count:16];
    }

    while (v6);
  }
}

- (BOOL)_isResourceType:(unint64_t)a3 inResources:(id)a4
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v5 = a4;
  v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v13;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v5);
        }

        if ([*(*(&v12 + 1) + 8 * i) resourceType] == a3)
        {
          v10 = 1;
          goto LABEL_11;
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_11:

  return v10;
}

- (void)markAsUnavailableCloudResourceOfType:(unint64_t)a3
{
  v3 = [(PLManagedAsset *)self assetResourceForCPLType:a3];
  [v3 markAsNotLocallyAvailable];
}

- (void)applyFacesFromAssetChange:(id)a3 inSyncContext:(id)a4
{
  v6 = a4;
  v9 = a3;
  v7 = [v6 photoLibrary];
  v8 = [v7 managedObjectContext];
  [PLCPLFaceRebuildSupport rebuildDeferredFacesForAsset:self inManagedObjectContext:v8];

  [PLCPLFacePullSupport applyFacesChangesFromAssetChange:v9 toAsset:self inSyncContext:v6];
}

- (void)applySharingPropertiesFromAssetChange:(id)a3 inLibrary:(id)a4
{
  v36 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [v6 sharingScopeIdentifier];
  if (!v8)
  {
    if ([(PLManagedAsset *)self hasLibraryScope])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v14 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
        {
          v15 = [(PLManagedAsset *)self libraryScope];
          v30 = 138412546;
          v31 = v15;
          v32 = 2112;
          v33 = v6;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEBUG, "Clearing library scope %@ for asset change %@", &v30, 0x16u);
        }
      }

      [(PLManagedAsset *)self removeLibraryScopeAndContributors];
LABEL_41:
      v16 = [v6 updateSharingContributorUserIdentifiers];
      v21 = [v16 count];
      v22 = [(PLManagedAsset *)self additionalAttributes];
      v23 = [v22 libraryScopeAssetContributorsToUpdate];
      v24 = v23;
      if (v21)
      {
        v25 = [MEMORY[0x1E695DFD8] setWithArray:v16];
        v26 = [v24 isEqualToSet:v25];

        if (v26)
        {
          v27 = [MEMORY[0x1E695DFD8] setWithArray:v16];
          v28 = [(PLManagedAsset *)self additionalAttributes];
          [v28 setLibraryScopeAssetContributorsToUpdate:v27];

LABEL_46:
        }
      }

      else
      {
        v29 = [v23 count];

        if (v29)
        {
          v27 = [(PLManagedAsset *)self additionalAttributes];
          [v27 setLibraryScopeAssetContributorsToUpdate:0];
          goto LABEL_46;
        }
      }

LABEL_47:

      goto LABEL_48;
    }

    if (*MEMORY[0x1E6994D48])
    {
      goto LABEL_41;
    }

    v10 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
    {
      v30 = 138412290;
      v31 = v6;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEBUG, "Does not need to clear library scope for asset change %@", &v30, 0xCu);
    }

LABEL_40:

    goto LABEL_41;
  }

  v9 = [v7 managedObjectContext];
  v10 = [(PLShare *)PLLibraryScope shareWithScopeIdentifier:v8 includeTrashed:1 inManagedObjectContext:v9];

  if (v10)
  {
    v11 = [v6 sharingContributorUserIdentifiers];
    if ([v11 count])
    {
      v12 = [PLShareParticipant participantsWithUserIdentifiers:v11 inScope:v10 inPhotoLibrary:v7];
      if (![v12 count]&& (*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v13 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
        {
          v30 = 138412546;
          v31 = v11;
          v32 = 2112;
          v33 = v6;
          _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to fetch a local library scope contributors for sharing contributor user identifier %@ of asset change %@", &v30, 0x16u);
        }
      }
    }

    else
    {
      v12 = 0;
    }

    if ([v12 count])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v17 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
        {
          v30 = 138412802;
          v31 = v10;
          v32 = 2112;
          v33 = v12;
          v34 = 2112;
          v35 = v6;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEBUG, "Setting library scope %@ and originator %@ for asset change %@", &v30, 0x20u);
        }
      }

      v18 = [MEMORY[0x1E695DFD8] setWithArray:v12];
      [(PLManagedAsset *)self setLibraryScope:v10 withContributors:v18];
    }

    else if ([v11 count])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v19 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
        {
          v30 = 138412546;
          v31 = v10;
          v32 = 2112;
          v33 = v6;
          _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_DEBUG, "Setting library scope %@ with no originators for asset change %@", &v30, 0x16u);
        }
      }

      [(PLManagedAsset *)self setLibraryScope:v10 withContributors:0];
    }

    else
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v20 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
        {
          v30 = 138412546;
          v31 = v8;
          v32 = 2112;
          v33 = v6;
          _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Setting library scope %@ and originator as current user for asset change %@", &v30, 0x16u);
        }
      }

      [(PLManagedAsset *)self setLibraryScopeWithCurrentUserAsContributor:v10];
    }

    PLLibraryScopeAssetSetAddToSharedZoneState(1, self);

    goto LABEL_40;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v16 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v30 = 138412546;
      v31 = v8;
      v32 = 2112;
      v33 = v6;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Failed to fetch a local library scope for sharing scope identifier %@ of asset change %@", &v30, 0x16u);
    }

    goto LABEL_47;
  }

LABEL_48:
}

- (void)applyPropertiesFromAssetChange:(id)a3 inLibrary:(id)a4
{
  v156 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v144 = a4;
  v7 = [(PLManagedAsset *)self isFavorite];
  if (v7 != [v6 isFavorite])
  {
    -[PLManagedAsset setFavorite:](self, "setFavorite:", [v6 isFavorite]);
  }

  v8 = [(PLManagedAsset *)self additionalAttributes];
  v9 = [v6 scopedIdentifier];
  v10 = [v9 identifier];

  if (!v10 && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      LODWORD(buf.value) = 138412290;
      *(&buf.value + 4) = v6;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "No identifier for assetChange %@", &buf, 0xCu);
    }
  }

  v12 = [v6 timeZoneName];
  v13 = [v8 timeZoneName];
  v14 = [v13 isEqualToString:v12];

  if ((v14 & 1) == 0)
  {
    [v8 setTimeZoneName:v12];
  }

  v15 = [v6 timeZoneOffset];
  v137 = v12;
  if (v15)
  {
    v16 = [v8 timeZoneOffset];

    if (v16 != v15)
    {
      [v8 setTimeZoneOffset:v15];
LABEL_14:
      [objc_opt_class() fixMissingOriginalTimezoneIfNeededForAsset:self];
      goto LABEL_15;
    }
  }

  if ((v14 & 1) == 0)
  {
    goto LABEL_14;
  }

LABEL_15:
  v136 = v15;
  if (v10)
  {
    v17 = [(PLManagedAsset *)self cloudAssetGUID];
    if (!v17 || (v18 = v17, -[PLManagedAsset cloudAssetGUID](self, "cloudAssetGUID"), v19 = objc_claimAutoreleasedReturnValue(), v20 = [v19 isEqualToString:v10], v19, v18, (v20 & 1) == 0))
    {
      [(PLManagedAsset *)self setCloudAssetGUID:v10];
    }
  }

  v138 = v10;
  v21 = [v6 recordModificationDate];
  if (v21)
  {
    v22 = v21;
    v23 = [(PLManagedAsset *)self modificationDate];
    if (v23)
    {
      v24 = v23;
      v25 = [(PLManagedAsset *)self modificationDate];
      v26 = [v6 recordModificationDate];
      v27 = [v25 isEqualToDate:v26];

      if (v27)
      {
        goto LABEL_25;
      }
    }

    else
    {
    }

    v28 = [v6 recordModificationDate];
    [(PLManagedAsset *)self setModificationDate:v28];
  }

LABEL_25:
  v29 = [v6 lastSharedDate];
  if (!v29)
  {
    goto LABEL_31;
  }

  v30 = v29;
  v31 = [(PLManagedAsset *)self lastSharedDate];
  if (!v31)
  {

    goto LABEL_30;
  }

  v32 = v31;
  v33 = [(PLManagedAsset *)self lastSharedDate];
  v34 = [v6 lastSharedDate];
  v35 = [v33 compare:v34];

  if (v35 == 1)
  {
LABEL_30:
    v36 = [v6 lastSharedDate];
    [(PLManagedAsset *)self setLastSharedDate:v36];
  }

LABEL_31:
  v37 = [v6 assetDate];
  v38 = [(PLManagedAsset *)self dateCreated];

  if (v37)
  {
    if (!v38)
    {
LABEL_35:
      [(PLManagedAsset *)self setDateCreated:v37];
      goto LABEL_38;
    }

    v39 = [(PLManagedAsset *)self dateCreated];
    v40 = [v39 isEqualToDate:v37];

    if ((v40 & 1) == 0)
    {
      [(PLManagedAsset *)self didSetCustomDateCreated];
      goto LABEL_35;
    }
  }

  else if (!v38)
  {
    v41 = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setDateCreated:v41];
  }

LABEL_38:
  v135 = v37;
  v42 = [v6 addedDate];
  if (v42)
  {
    v43 = [(PLManagedAsset *)self addedDate];
    v44 = [v43 isEqualToDate:v42];

    if ((v44 & 1) == 0)
    {
      [(PLManagedAsset *)self setAddedDate:v42];
    }
  }

  v134 = v42;
  v45 = [(PLManagedAsset *)self location];
  v46 = [v6 location];
  v47 = [(PLManagedAsset *)self _location:v45 isEqualToLocationForUpdating:v46];

  if (!v47)
  {
    v48 = [v6 location];
    [(PLManagedAsset *)self setLocation:v48];
  }

  v49 = objc_opt_class();
  v50 = [v6 placeAnnotation];
  v51 = [v49 _dataFromCPLPlaceAnnotation:v50];

  v52 = [v8 placeAnnotationData];
  if (v51 != v52 && ([v51 isEqualToData:v52] & 1) == 0)
  {
    [v8 setPlaceAnnotationData:v51];
  }

  v132 = v52;
  v133 = v51;
  v53 = [v6 keywords];

  if (v53)
  {
    v54 = [PLKeywordManager keywordsForAsset:self];
    v55 = MEMORY[0x1E695DFD8];
    v56 = [v6 keywords];
    v57 = [v55 setWithArray:v56];

    if (([v54 isEqualToSet:v57] & 1) == 0)
    {
      v58 = [v144 keywordManager];
      [v58 setKeywords:v57 forAsset:self];
    }
  }

  v59 = [v6 isHidden];
  if (v59 != [(PLManagedAsset *)self hidden])
  {
    -[PLManagedAsset setHidden:](self, "setHidden:", [v6 isHidden]);
  }

  v60 = [(PLManagedAsset *)self longDescription];
  if (!v60 || (v61 = v60, -[PLManagedAsset longDescription](self, "longDescription"), v62 = objc_claimAutoreleasedReturnValue(), [v6 extendedDescription], v63 = objc_claimAutoreleasedReturnValue(), v64 = objc_msgSend(v62, "isEqualToString:", v63), v63, v62, v61, (v64 & 1) == 0))
  {
    v65 = [v6 extendedDescription];
    [(PLManagedAsset *)self setLongDescription:v65];
  }

  v139 = v8;
  v66 = [(PLManagedAsset *)self accessibilityDescription];
  if (!v66 || (v67 = v66, -[PLManagedAsset accessibilityDescription](self, "accessibilityDescription"), v68 = objc_claimAutoreleasedReturnValue(), [v6 accessibilityDescription], v69 = objc_claimAutoreleasedReturnValue(), v70 = objc_msgSend(v68, "isEqualToString:", v69), v69, v68, v67, (v70 & 1) == 0))
  {
    v71 = [v6 accessibilityDescription];
    [(PLManagedAsset *)self setAccessibilityDescription:v71];
  }

  v72 = [(PLManagedAsset *)self title];
  if (!v72 || (v73 = v72, -[PLManagedAsset title](self, "title"), v74 = objc_claimAutoreleasedReturnValue(), [v6 caption], v75 = objc_claimAutoreleasedReturnValue(), v76 = objc_msgSend(v74, "isEqualToString:", v75), v75, v74, v73, (v76 & 1) == 0))
  {
    v77 = [v6 caption];
    [(PLManagedAsset *)self setTitle:v77];
  }

  [(PLManagedAsset *)self _updateAvalanchePropertiesFromAssetChange:v6];
  -[PLManagedAsset _updateAssetSubtypeFromCPLAssetSubtype:](self, "_updateAssetSubtypeFromCPLAssetSubtype:", [v6 assetSubtype]);
  [(PLManagedAsset *)self updateKindSubtypeIfScreenshot];
  v141 = self;
  [(PLManagedAsset *)self updatePanoramosityWithMetadata:0];
  v140 = v6;
  v78 = [v6 people];
  v79 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(v78, "count")}];
  v148 = 0u;
  v149 = 0u;
  v150 = 0u;
  v151 = 0u;
  obj = v78;
  v80 = [obj countByEnumeratingWithState:&v148 objects:v155 count:16];
  if (v80)
  {
    v81 = v80;
    v82 = *v149;
    do
    {
      for (i = 0; i != v81; ++i)
      {
        if (*v149 != v82)
        {
          objc_enumerationMutation(obj);
        }

        v84 = *(*(&v148 + 1) + 8 * i);
        v85 = [v84 personIdentifier];
        if (v85)
        {
          v86 = [v84 extraProperties];
          v87 = [MEMORY[0x1E696AE40] dataWithPropertyList:v86 format:200 options:0 error:0];
          v88 = [PLPersonReference insertIntoPhotoLibrary:v144 personUUID:v85 personData:v87];
          [v79 addObject:v88];
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_72;
          }

          v86 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v86, OS_LOG_TYPE_ERROR))
          {
            LODWORD(buf.value) = 138412290;
            *(&buf.value + 4) = v84;
            _os_log_impl(&dword_19BF1F000, v86, OS_LOG_TYPE_ERROR, "Found a person reference %@ without personUUID, skipping update", &buf, 0xCu);
          }
        }

LABEL_72:
      }

      v81 = [obj countByEnumeratingWithState:&v148 objects:v155 count:16];
    }

    while (v81);
  }

  [v139 setPersonReferences:v79];
  v89 = [v140 playCount];
  if (v89 >= 1)
  {
    [v139 setPlayCount:v89];
  }

  v90 = [v140 shareCount];
  if (v90)
  {
    [v139 setShareCount:v90];
  }

  v91 = [v140 viewCount];
  if (v91 >= 1)
  {
    [v139 setViewCount:v91];
  }

  if ([MEMORY[0x1E6994A80] serverSupportsLastViewedDate])
  {
    v92 = [v140 lastViewedDate];
    if (v92)
    {
      v93 = v92;
      v94 = [v139 lastViewedDate];
      if (v94)
      {
        v95 = v94;
        v96 = [v139 lastViewedDate];
        v97 = [v140 lastViewedDate];
        v98 = [v96 compare:v97];

        if (v98 != 1)
        {
          goto LABEL_87;
        }
      }

      else
      {
      }

      v99 = [v140 lastViewedDate];
      [v139 setLastViewedDate:v99];
    }
  }

LABEL_87:
  v100 = [(PLManagedAsset *)v141 collectionShare];
  if (v100)
  {
    v101 = v100;
    v102 = [v140 contributorUserIdentifier];

    if (v102)
    {
      v103 = [v140 contributorUserIdentifier];
      v154 = v103;
      v104 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v154 count:1];
      v105 = [(PLManagedAsset *)v141 collectionShare];
      v106 = [PLShareParticipant participantsWithUserIdentifiers:v104 inScope:v105 inPhotoLibrary:v144];

      if ([v106 count])
      {
        v107 = [(PLManagedAsset *)v141 collectionShare];
        v108 = [v106 firstObject];
        [(PLManagedAsset *)v141 setCollectionShare:v107 withContributor:v108];
      }
    }
  }

  v109 = [v140 syndicationIdentifier];
  if (v109)
  {
    v110 = [v139 syndicationIdentifier];
    v111 = [v110 isEqualToString:v109];

    if ((v111 & 1) == 0)
    {
      if (([v139 setSyndicationIdentifier:v109], !-[PLManagedAsset isPlaceholderAsset](v141, "isPlaceholderAsset")) && !-[PLManagedAsset isCPLSharingScopeAsset](v141, "isCPLSharingScopeAsset") || -[PLManagedAsset isPlaceholderAsset](v141, "isPlaceholderAsset") && (-[PLManagedAsset shareRelationship](v141, "shareRelationship"), v112 = objc_claimAutoreleasedReturnValue(), v112, !v112))
      {
        v113 = [(PLManagedAsset *)v141 additionalAttributes];
        v114 = [v113 syndicationIdentifier];
        if (v114)
        {
          v115 = v114;
          v116 = [(PLManagedAsset *)v141 syndicationState];

          if ((v116 & 2) == 0)
          {
            [(PLManagedAsset *)v141 syndicatedAssetDidSaveToUserLibrary];
          }
        }

        else
        {
        }
      }
    }
  }

  if ((_os_feature_enabled_impl() & 1) == 0)
  {
    PLLibraryScopeAssetSetLocalSharingStateValueFromSyncableShareStateValue([v140 sharedLibrarySharingState], v141);
  }

  -[PLManagedAsset _updateViewPresentationFromCPLAssetViewPresentation:](v141, "_updateViewPresentationFromCPLAssetViewPresentation:", [v140 viewPresentation]);
  v117 = [v140 inExpunged];
  if (v117)
  {
    v142 = 0;
    v131 = 0;
    v118 = 2;
  }

  else
  {
    v119 = [v140 inTrash];
    v142 = v119 == 0;
    v131 = v119 != 0;
    v118 = v119 != 0;
  }

  v120 = [(PLManagedAsset *)v141 trashedState];
  -[PLManagedAsset applyTrashedState:withTrashedReason:expungeReasonFromClient:](v141, "applyTrashedState:withTrashedReason:expungeReasonFromClient:", v118, [v140 trashedReason], 0);
  v121 = [v140 dateDeleted];
  [(PLManagedAsset *)v141 setTrashedDate:v121];

  if ([MEMORY[0x1E6994A80] serverSupportsDeletedByUserIdentifier])
  {
    v122 = [v140 deletedByUserIdentifier];
    if (v122)
    {
      v123 = v122;
      v124 = _os_feature_enabled_impl();

      if ((v124 & 1) == 0)
      {
        v130 = [v140 deletedByUserIdentifier];
        v153 = v130;
        v125 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v153 count:1];
        v126 = [(PLManagedAsset *)v141 libraryScope];
        v127 = [PLShareParticipant participantsWithUserIdentifiers:v125 inScope:v126 inPhotoLibrary:v144];

        if ([v127 count])
        {
          v128 = [v127 firstObject];
          [(PLManagedAsset *)v141 setTrashedByParticipant:v128];
        }
      }
    }
  }

  if (v109 && v120 != v118)
  {
    if (v142)
    {
      [(PLManagedAsset *)v141 restoreSyndicatedAsset];
    }

    else if ((v117 | v131) == 1)
    {
      [(PLManagedAsset *)v141 rejectSyndicatedAsset];
    }
  }

  memset(&buf, 0, sizeof(buf));
  CMTimeMake(&buf, [v140 videoComplementDurationValue], objc_msgSend(v140, "videoComplementDurationTimescale"));
  memset(&v147, 0, sizeof(v147));
  CMTimeMake(&v147, [v140 videoComplementImageDisplayValue], objc_msgSend(v140, "videoComplementImageDisplayTimescale"));
  v129 = [v140 mediaGroupIdentifier];
  v146 = buf;
  v145 = v147;
  [(PLManagedAsset *)v141 updatePhotoIrisMetadataWithMediaGroupUUID:v129 videoDuration:&v146 stillDisplayTime:&v145];

  -[PLManagedAsset setVideoCpVisibilityState:](v141, "setVideoCpVisibilityState:", [v140 videoComplementVisibilityState]);
}

- (BOOL)_location:(id)a3 isEqualToLocationForUpdating:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = v6;
  if (v5 == v6)
  {
    v28 = 1;
  }

  else if ((v5 == 0) == (v6 != 0))
  {
    v28 = 0;
  }

  else
  {
    v8 = [v5 timestamp];
    v9 = [v7 timestamp];
    [v5 coordinate];
    v11 = v10;
    [v7 coordinate];
    if (v11 == v12 && ([v5 coordinate], v14 = v13, objc_msgSend(v7, "coordinate"), v14 == v15) && (objc_msgSend(v5, "altitude"), v17 = v16, objc_msgSend(v7, "altitude"), v17 == v18) && (objc_msgSend(v5, "horizontalAccuracy"), v20 = v19, objc_msgSend(v7, "horizontalAccuracy"), v20 == v21) && (objc_msgSend(v5, "verticalAccuracy"), v23 = v22, objc_msgSend(v7, "verticalAccuracy"), v23 == v24) && (objc_msgSend(v5, "course"), v26 = v25, objc_msgSend(v7, "course"), v26 == v27))
    {
      if (v8 | v9)
      {
        v28 = 0;
        if (v8 && v9)
        {
          v28 = [v8 isEqual:v9];
        }
      }

      else
      {
        v28 = 1;
      }
    }

    else
    {
      v28 = 0;
    }
  }

  return v28;
}

- (void)setVideoInfoOnMasterFromAVAsset:(id)a3
{
  v17 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self master];

  if (v5)
  {
    v6 = [v4 plVideoCodecName];
    v7 = [(PLManagedAsset *)self master];
    [v7 setCodecName:v6];

    v8 = [MEMORY[0x1E69C0708] tracksWithMediaType:*MEMORY[0x1E6987608] forAsset:v4];
    if ([v8 count])
    {
      v9 = [v8 objectAtIndex:0];
      v10 = [(PLManagedAsset *)self master];
      [v9 nominalFrameRate];
      LODWORD(v12) = llroundf(v11);
      [v10 setVideoFrameRate:v12];
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_8:

        goto LABEL_9;
      }

      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        v13 = [(PLManagedAsset *)self master];
        v14 = [v13 scopedIdentifier];
        v15 = 138543362;
        v16 = v14;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "setVideoInfoFromAVAsset: videoTrack doesn't have a track of type AVMediaTypeVideo for %{public}@", &v15, 0xCu);
      }
    }

    goto LABEL_8;
  }

LABEL_9:
}

- (void)_applyPropertiesFromCloudMaster:(id)a3
{
  v65 = *MEMORY[0x1E69E9840];
  v4 = a3;
  [(PLManagedAsset *)self setMaster:v4];
  v5 = [v4 creationDate];
  v6 = [(PLManagedAsset *)self dateCreated];

  if (v5)
  {
    if (!v6)
    {
      [(PLManagedAsset *)self setDateCreated:v5];
    }
  }

  else if (!v6)
  {
    v7 = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setDateCreated:v7];
  }

  v8 = [v4 uniformTypeIdentifier];
  if ([v8 length])
  {
    if (!v8)
    {
      goto LABEL_32;
    }
  }

  else
  {
    v9 = MEMORY[0x1E6994D48];
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v62 = v4;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "Missing UTI from cloudMaster %@, attempting to get it from resources", buf, 0xCu);
      }
    }

    v11 = [v4 rm_cloudResourcesForResourceType:1];
    v12 = [v11 firstObject];

    if (v12)
    {
      v13 = [v12 uniformTypeIdentifier];
      v14 = [v13 identifier];

      if (v14)
      {
        if ((*v9 & 1) == 0)
        {
          v15 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            v62 = v4;
            v63 = 2112;
            v64 = v14;
            _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Setting UTI for cloudMaster %@ to %@", buf, 0x16u);
          }
        }

        [v4 setUniformTypeIdentifier:v14];
      }

      else
      {
        if ((*v9 & 1) == 0)
        {
          v17 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412290;
            v62 = v12;
            _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "Missing UTI from original resource %@", buf, 0xCu);
          }
        }

        v14 = 0;
      }
    }

    else
    {
      if ((*v9 & 1) == 0)
      {
        v16 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v62 = v4;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Missing original resource from %@", buf, 0xCu);
        }
      }

      v14 = v8;
    }

    v8 = v14;
    if (!v14)
    {
      goto LABEL_32;
    }
  }

  v18 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v19 = [v18 isEqualToString:v8];

  if (v19)
  {
LABEL_32:
    v20 = [(PLManagedAsset *)self uniformTypeIdentifier];

    v8 = v20;
    goto LABEL_34;
  }

  [(PLManagedAsset *)self setUniformTypeIdentifier:v8];
  [(PLManagedAsset *)self updateAssetKindFromUniformTypeIdentifier];
LABEL_34:
  if ([(PLManagedAsset *)self kind]== 3)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_DEFAULT))
      {
        v22 = [(PLManagedAsset *)self cloudAssetGUID];
        *buf = 138412546;
        v62 = v22;
        v63 = 2112;
        v64 = v8;
        _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEFAULT, "Unknown kind for asset %@ with UTI %@, attempting to promote from cloud master", buf, 0x16u);
      }
    }

    [(PLManagedAsset *)self attemptPromoteFromUnknownKindUsingCloudMaster];
  }

  v23 = [v4 originalFilename];
  if (v23)
  {
    v24 = v23;
    v25 = [v4 originalFilename];
    v26 = [(PLManagedAsset *)self originalFilename];
    v27 = [v25 isEqualToString:v26];

    if ((v27 & 1) == 0)
    {
      v28 = [v4 originalFilename];
      [(PLManagedAsset *)self setOriginalFilename:v28];
    }
  }

  v29 = [(PLManagedAsset *)self originalOrientation];
  if (v29 != [v4 originalOrientation])
  {
    -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [v4 originalOrientation]);
  }

  v30 = [(PLManagedAsset *)self cloudAssetGUID];
  if ([(PLManagedAsset *)self shouldUseUBFPathManager])
  {
    v31 = [(PLManagedAsset *)self originalFilename];
    [(PLManagedAsset *)self setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:v8 originalFilename:v31];
LABEL_57:

    goto LABEL_58;
  }

  v32 = [(PLManagedAsset *)self directory];

  if (!v32)
  {
    v33 = [(PLManagedAsset *)self photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:v30];
    v34 = [(PLManagedObject *)self pathManager];
    v35 = [v34 assetAbbreviatedMetadataDirectoryForDirectory:v33 type:32 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
    [(PLManagedAsset *)self setDirectory:v35];
  }

  v36 = [(PLManagedAsset *)self filename];

  if (!v36)
  {
    v37 = [(PLManagedAsset *)self originalFilename];
    v38 = [v37 pathExtension];
    v39 = [v38 uppercaseString];

    if ([v39 rangeOfString:&stru_1F0F2DA60] != 0x7FFFFFFFFFFFFFFFLL)
    {
      v40 = [&stru_1F0F06D80 copy];

      v39 = v40;
    }

    if ([v39 length] && !+[PLManagedAsset isKnownFileExtension:](PLManagedAsset, "isKnownFileExtension:", v39))
    {
      v41 = v39;
    }

    else
    {
      v41 = [PLManagedAsset preferredFileExtensionForType:v8];
    }

    v31 = v41;
    v42 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@.%@", v30, v41];
    [(PLManagedAsset *)self setFilename:v42];

    goto LABEL_57;
  }

LABEL_58:
  v43 = [v4 rm_cloudResourcesForResourceType:18];
  v44 = [v43 count];

  if (v44)
  {
    [(PLManagedAsset *)self setKindSubtype:2];
  }

  v45 = [v4 rm_cloudResourcesForResourceType:23];
  v46 = [v45 count];

  if (v46)
  {
    [(PLManagedAsset *)self setCameraProcessingAdjustmentState:[(PLManagedAsset *)self cameraProcessingAdjustmentState]| 1];
  }

  v47 = [(PLManagedAsset *)self additionalAttributes];
  [v47 setImportedBy:{objc_msgSend(v4, "importedBy")}];

  v48 = [(PLManagedAsset *)self additionalAttributes];
  v49 = [v4 importedByBundleIdentifier];
  [v48 setImportedByBundleIdentifier:v49];

  v50 = [(PLManagedAsset *)self additionalAttributes];
  v51 = [v4 importedByDisplayName];
  [v50 setImportedByDisplayName:v51];

  [objc_opt_class() processMediaMetadataForAsset:self withCloudMaster:v4];
  [objc_opt_class() fixMissingOriginalDateCreatedIfNeededForAsset:self withCloudMaster:v4];
  v52 = [v4 fingerprintScheme];
  LOBYTE(v51) = [v52 isForStableHash];

  if (v51)
  {
    v53 = [v4 scopedIdentifier];
    v54 = [v53 identifier];

    if (!v54)
    {
      goto LABEL_74;
    }
  }

  else
  {
    v60 = 0;
    v54 = [v4 stableHashFromOriginalResourceError:&v60];
    v55 = v60;
    v56 = v55;
    if (!v54)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v57 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v57, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412546;
          v62 = v4;
          v63 = 2112;
          v64 = v56;
          _os_log_impl(&dword_19BF1F000, v57, OS_LOG_TYPE_ERROR, "Failed to find master stable hash in original resource in %@: %@", buf, 0x16u);
        }
      }

      v54 = 0;
      goto LABEL_73;
    }
  }

  v56 = [(PLManagedAsset *)self additionalAttributes];
  [v56 setOriginalStableHash:v54];
LABEL_73:

LABEL_74:
  v58 = [(PLManagedAsset *)self additionalAttributes];
  v59 = [v4 originatingAssetIdentifier];
  [v58 setOriginatingAssetIdentifier:v59];
}

- (id)localResourcePathForMasterResourceWithCPLType:(unint64_t)a3 andUTI:(id)a4
{
  v6 = a4;
  if (a3 <= 0x16 && ((1 << a3) & 0x420100) != 0)
  {
    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      v7 = [(PLManagedObject *)self pathManager];
      v8 = [PLResourceInstaller resourceTypeFromCPLType:a3 assetType:[(PLManagedAsset *)self kind]];
      v9 = objc_alloc(MEMORY[0x1E69BF298]);
      v10 = [(PLManagedAsset *)self uuid];
      v11 = [v9 initWithAssetUuid:v10 bundleScope:-[PLManagedAsset bundleScope](self uti:"bundleScope") resourceVersion:v6 resourceType:{0, v8}];

      v12 = [v7 readOnlyUrlWithIdentifier:v11];
      [v12 path];
    }

    else
    {
      v7 = [PLManagedAsset preferredFileExtensionForType:v6];
      v11 = [(PLManagedAsset *)self pathForOriginalFile];
      v12 = [v11 stringByDeletingPathExtension];
      [v12 stringByAppendingPathExtension:v7];
    }
    v13 = ;
  }

  else
  {
    v13 = [(PLManagedAsset *)self pathForCPLResourceType:a3 adjusted:0];
  }

  return v13;
}

- (id)localResourcePathForMasterResource:(id)a3
{
  v4 = a3;
  v5 = [v4 cplType];
  v6 = [v4 uniformTypeIdentifier];

  v7 = [v6 identifier];
  v8 = [(PLManagedAsset *)self localResourcePathForMasterResourceWithCPLType:v5 andUTI:v7];

  return v8;
}

- (CGSize)_targetSizeForInputSize:(CGSize)a3 maxPixelSize:(unint64_t)a4
{
  v4 = 1.0;
  if (a3.height * a3.width > a4)
  {
    v4 = sqrt(a4 / (a3.height * a3.width));
  }

  v5 = a3.width * v4;
  v6 = roundf(v5);
  v7 = a3.height * v4;
  v8 = roundf(v7);
  result.height = v8;
  result.width = v6;
  return result;
}

- (id)_cplRelationsForAssetInLibrary:(id)a3 orderKeyManager:(id)a4
{
  v42 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v32 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v30 = v6;
  v8 = [v6 managedObjectContext];
  v29 = v7;
  v9 = [v7 albumsAndOrderValuesForAsset:self inManagedObjectContext:v8];
  if ([v9 count] >= 2)
  {
    v11 = 0;
    *&v10 = 138412546;
    v27 = v10;
    v28 = self;
    v31 = v8;
    while (1)
    {
      v12 = [v9 objectAtIndex:{v11, v27}];
      v13 = [v8 existingObjectWithID:v12 error:0];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        break;
      }

LABEL_21:

      v24 = [v9 count];
      v25 = v11 + 3;
      v11 += 2;
      if (v25 >= v24)
      {
        goto LABEL_26;
      }
    }

    v14 = v13;
    if (([v14 isCameraAlbum] & 1) == 0)
    {
      v15 = [v14 cloudGUID];

      if (v15)
      {
        if ([v14 kindValue] == 2 || objc_msgSend(v14, "kindValue") == 4000 || objc_msgSend(v14, "isProjectAlbumSupportingCloudUpload"))
        {
          v16 = objc_alloc_init(MEMORY[0x1E6994AA8]);
          v17 = [v9 objectAtIndex:v11 + 1];
          v18 = [v14 cloudGUID];
          [v16 setContainerIdentifier:v18];

          v33 = v17;
          [v16 setPosition:[(PLManagedAsset *)v17 integerValue]];
          v19 = [v14 customKeyAsset];
          LODWORD(v17) = [v19 isEqual:self];

          if (v17)
          {
            [v16 setKeyAsset:1];
          }

          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v20 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
            {
              v21 = [(PLManagedAsset *)self cloudAssetGUID];
              if ([v16 isKeyAsset])
              {
                v22 = @"(keyAsset)";
              }

              else
              {
                v22 = &stru_1F0F06D80;
              }

              v23 = [v14 cloudGUID];
              *buf = 138413058;
              v35 = v21;
              v36 = 2112;
              v37 = v33;
              v38 = 2112;
              v39 = v22;
              self = v28;
              v40 = 2112;
              v41 = v23;
              _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEBUG, "Sending asset %@ with position: %@ %@ album: %@", buf, 0x2Au);
            }
          }

          [v32 addObject:v16];

          v8 = v31;
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_20;
          }

          v16 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            *buf = v27;
            v35 = v14;
            v36 = 2112;
            v37 = self;
            _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Trying to send non-user created album/folder relation, or album type is unsupported for relation change. album: %@, asset: %@", buf, 0x16u);
          }
        }
      }
    }

LABEL_20:

    goto LABEL_21;
  }

LABEL_26:

  return v32;
}

- (void)_updateViewPresentationForCPLAssetChange:(id)a3
{
  v12 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v6 = [v5 cloudViewPresentation];

  if (v6 >= 2)
  {
    if (v6 == 1000)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v8 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
        {
          v9 = [(PLManagedAsset *)self uuid];
          v10 = 138543362;
          v11 = v9;
          _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "A non-sync view presentation was set to cloudViewPresentation. Defaulting to Natural. Asset: %{public}@", &v10, 0xCu);
        }
      }

      v6 = 0;
    }
  }

  else
  {
    v7 = [(PLManagedAsset *)self additionalAttributes];
    v6 = -[PLManagedAsset _cplViewPresentationFromPLViewPresentation:](self, "_cplViewPresentationFromPLViewPresentation:", [v7 viewPresentation]);
  }

  [v4 setViewPresentation:v6];
}

- (void)_updateViewPresentationFromCPLAssetViewPresentation:(signed __int16)a3
{
  v3 = a3;
  v17 = *MEMORY[0x1E69E9840];
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setCloudViewPresentation:v3];

  if (v3 == 1000)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        v9 = [(PLManagedAsset *)self uuid];
        v15 = 138543362;
        v16 = v9;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Trying to set a non-sync view presentation on download - defaulting to natural. Asset: %{public}@", &v15, 0xCu);
      }
    }

    v7 = 0;
    v6 = 1;
  }

  else
  {
    v6 = v3 != 1;
    v7 = v3 == 1;
  }

  v10 = [(PLManagedAsset *)self additionalAttributes];
  v11 = [v10 viewPresentation];

  if (v11 != v7)
  {
    v12 = !v6;
    if (v11 < 2)
    {
      v12 = 1;
    }

    if (v12)
    {
      v13 = [(PLManagedAsset *)self additionalAttributes];
      [v13 setViewPresentation:v7];
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
        return;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        v14 = [(PLManagedAsset *)self uuid];
        v15 = 138543362;
        v16 = v14;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "Skip overwriting non-sync view presentation. Asset: %{public}@", &v15, 0xCu);
      }
    }
  }
}

- (void)_updateAssetSubtypeForCPLAssetChange:(id)a3
{
  v9 = a3;
  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 cloudKindSubtype];
  if (v5 - 100 >= 4 && v5 > 3u)
  {
    if (v5)
    {
      goto LABEL_10;
    }
  }

  else if ([(PLManagedAsset *)self cplAssetSubtypeFromPLAssetSubtype:[(PLManagedAsset *)self kindSubtype]])
  {
    goto LABEL_10;
  }

  v7 = [(PLManagedAsset *)self spatialType];
  v8 = [(PLManagedAsset *)self isVideo];
  if (!v7 && v8)
  {
    [v4 cameraCaptureDevice];
  }

LABEL_10:
  [v9 setAssetSubtype:?];
}

- (unint64_t)cplAssetSubtypeFromPLAssetSubtype:(signed __int16)a3
{
  if (a3 <= 100)
  {
    v6 = 1;
    v7 = 2;
    v8 = 3;
    if (a3 != 10)
    {
      v8 = 0;
    }

    if (a3 != 2)
    {
      v7 = v8;
    }

    v9 = a3 == 1;
  }

  else
  {
    if (a3 <= 102)
    {
      if (a3 != 101)
      {
        return 101;
      }

      if (([(PLManagedAsset *)self highFrameRateState:v3]& 2) != 0)
      {
        return 100;
      }

      return 0;
    }

    v6 = 102;
    v7 = 103;
    if (a3 != 104)
    {
      v7 = 0;
    }

    v9 = a3 == 103;
  }

  if (v9)
  {
    return v6;
  }

  else
  {
    return v7;
  }
}

- (void)_updateAssetSubtypeFromCPLAssetSubtype:(unint64_t)a3
{
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setCloudKindSubtype:a3];

  v6 = [(PLManagedAsset *)self highFrameRateState];
  if (a3 > 99)
  {
    if (a3 == 103)
    {
      v13 = 104;
    }

    else
    {
      v13 = 0;
    }

    if (a3 == 102)
    {
      v14 = 103;
    }

    else
    {
      v14 = v13;
    }

    v15 = (2 * (v6 & 1)) | v6;
    if (a3 == 101)
    {
      v16 = 102;
    }

    else
    {
      v16 = 0;
    }

    if (a3 == 100)
    {
      v17 = 101;
    }

    else
    {
      v15 = v6;
      v17 = v16;
    }

    if (a3 <= 101)
    {
      v11 = v15;
    }

    else
    {
      v11 = v6;
    }

    if (a3 <= 101)
    {
      v12 = v17;
    }

    else
    {
      v12 = v14;
    }
  }

  else
  {
    if (a3 == 3)
    {
      v7 = 10;
    }

    else
    {
      v7 = 0;
    }

    if (a3 == 2)
    {
      v8 = 2;
    }

    else
    {
      v8 = v7;
    }

    v9 = v6 & 0xFFFD;
    if ((v6 & 1) == 0)
    {
      v9 = v6;
    }

    v10 = (v6 << 31 >> 31) & 0x65;
    if (a3)
    {
      v9 = v6;
      v10 = a3 == 1;
    }

    if (a3 <= 1)
    {
      v11 = v9;
    }

    else
    {
      v11 = v6;
    }

    if (a3 <= 1)
    {
      v12 = v10;
    }

    else
    {
      v12 = v8;
    }
  }

  if ([(PLManagedAsset *)self kindSubtype]!= v12)
  {
    [(PLManagedAsset *)self setKindSubtype:v12];
  }

  if ([(PLManagedAsset *)self highFrameRateState]!= v11)
  {

    [(PLManagedAsset *)self setHighFrameRateState:v11];
  }
}

- (void)_updateAvalanchePropertiesFromAssetChange:(id)a3
{
  v23 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = [(PLManagedAsset *)self additionalAttributes];
  v7 = [v5 burstFlags];
  [v6 setCloudAvalanchePickType:v7];
  v8 = [(PLManagedAsset *)self _avalancheTypeFromCplBurstFlags:v7];
  if ([(PLManagedAsset *)self avalanchePickType]!= v8)
  {
    [(PLManagedAsset *)self setAvalanchePickType:v8];
    if (+[PLAvalanche shouldOnlyShowAvalanchePicks]&& ![(PLManagedAsset *)self avalanchePickTypeIsVisible])
    {
      [(PLManagedAsset *)self setVisibilityState:2];
      [(PLManagedAsset *)self setAlbums:0];
    }

    else if ([(PLManagedAsset *)self avalanchePickTypeIsVisible]&& [(PLManagedAsset *)self visibilityState])
    {
      [(PLManagedAsset *)self setVisibilityState:0];
    }
  }

  v9 = [v5 burstIdentifier];
  v10 = [(PLManagedAsset *)self avalancheUUID];
  v11 = [v10 isEqualToString:v9];

  if ((v11 & 1) == 0)
  {
    [(PLManagedAsset *)self setAvalancheUUID:v9];
    if (v9)
    {
      [(PLManagedAsset *)self setAvalancheKind:1];
    }

    else if ([(PLManagedAsset *)self avalanchePickType])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v12 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
        {
          v13 = NSStringFromSelector(a2);
          v14 = [(PLManagedAsset *)self uuid];
          v15 = 138413058;
          v16 = v13;
          v17 = 2112;
          v18 = v14;
          v19 = 2112;
          v20 = v5;
          v21 = 1024;
          v22 = [(PLManagedAsset *)self avalanchePickType];
          _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "%@: No burst identifier for asset %@ from assetChange %@ with pick type %d", &v15, 0x26u);
        }
      }

      [(PLManagedAsset *)self setAvalanchePickType:0];
      [(PLManagedAsset *)self setAvalancheKind:0];
      [(PLManagedAsset *)self setVisibilityState:0];
    }
  }
}

- (void)_updateBurstFlagsForCPLAssetChange:(id)a3 photoLibrary:(id)a4
{
  v9 = a3;
  if ([(PLManagedAsset *)self avalancheKind]== 1)
  {
    v5 = [(PLManagedAsset *)self avalancheUUID];

    if (v5)
    {
      v6 = [(PLManagedAsset *)self additionalAttributes];
      v7 = [v6 cloudAvalanchePickType];

      [v9 setBurstFlags:{-[PLManagedAsset cplBurstFlagsFromPLAvalancheType:](self, "cplBurstFlagsFromPLAvalancheType:", -[PLManagedAsset avalanchePickType](self, "avalanchePickType")) | (v7 & 0xFFFFFFC0)}];
      v8 = [(PLManagedAsset *)self avalancheUUID];
      [v9 setBurstIdentifier:v8];
    }
  }
}

- (id)cplAssetChangeWithMasterScopedIdentifier:(id)a3 withChangeType:(unint64_t)a4 shouldGenerateDerivatives:(BOOL)a5 orderKeyManager:(id)a6 computeSyncUploadEnabled:(BOOL)a7 inLibrary:(id)a8
{
  v9 = a7;
  v11 = a5;
  v29 = *MEMORY[0x1E69E9840];
  v14 = a3;
  v15 = a6;
  v16 = a8;
  v17 = [(PLManagedAsset *)self collectionShare];
  if (!v17 || (v18 = v17, v19 = _os_feature_enabled_impl(), v18, (v19 & 1) != 0))
  {
    v20 = [(PLManagedAsset *)self scopedIdentifier];
    v21 = [MEMORY[0x1E6994A80] newChangeWithScopedIdentifier:v20 changeType:a4];
    if ([v21 hasChangeType:2])
    {
      [(PLManagedAsset *)self _applyPropertiesChangeToCPLAssetChange:v21 withMasterScopedIdentifier:v14 computeSyncUploadEnabled:v9 inLibrary:v16];
    }

    if ((_os_feature_enabled_impl() & 1) == 0 && [v21 hasChangeType:64])
    {
      [(PLManagedAsset *)self _applySharingChangeToCPLAssetChange:v21 inLibrary:v16];
    }

    if ([v21 hasChangeType:32])
    {
      [(PLManagedAsset *)self _applyFaceChangeToCPLAssetChange:v21 inLibrary:v16];
    }

    if ([v21 hasChangeType:8])
    {
      [(PLManagedAsset *)self _applyResourceChangeToCPLAsset:v21 forChangeType:a4 shouldGenerateDerivatives:v11 inLibrary:v16];
    }

    if ([v21 hasChangeType:16])
    {
      v22 = [(PLManagedAsset *)self _cplRelationsForAssetInLibrary:v16 orderKeyManager:v15];
      [v21 setContainerRelations:v22];
    }

    v23 = [(PLManagedAsset *)self modificationDate];
    [v21 setRecordModificationDate:v23];

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v24 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_DEBUG))
      {
        v27 = 138412290;
        v28 = v21;
        _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_DEBUG, "CPLAssetChange %@", &v27, 0xCu);
      }
    }

LABEL_22:

    goto LABEL_23;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v20 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      v25 = [(PLManagedAsset *)self scopedIdentifier];
      v27 = 138412290;
      v28 = v25;
      _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_ERROR, "Not generating CPLAssetChange for CollectionShare asset as FF is disabled %@", &v27, 0xCu);
    }

    v21 = 0;
    goto LABEL_22;
  }

  v21 = 0;
LABEL_23:

  return v21;
}

- (id)cplFullRecord
{
  v21 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self master];
  v4 = v3;
  if (v3)
  {
    v5 = [(PLManagedAsset *)v3 scopedIdentifier];
    if (v5)
    {
      v6 = [(PLManagedObject *)self photoLibrary];
      v7 = [v6 libraryServicesManager];
      v8 = [v7 databaseContext];

      v9 = [PLRelationshipOrderKeyManager alloc];
      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __36__PLManagedAsset_CPL__cplFullRecord__block_invoke;
      v17[3] = &unk_1E7574C88;
      v18 = v8;
      v10 = v8;
      v11 = [(PLRelationshipOrderKeyManager *)v9 initWithGenerateContextBlock:v17];
      v12 = [(PLManagedObject *)self photoLibrary];
      v13 = [PLManagedAsset isComputeSyncEnabledForDirection:0 library:v12];

      v14 = [(PLManagedObject *)self photoLibrary];
      v15 = [(PLManagedAsset *)self cplAssetChangeWithMasterScopedIdentifier:v5 withChangeType:0 shouldGenerateDerivatives:1 orderKeyManager:v11 computeSyncUploadEnabled:v13 inLibrary:v14];

LABEL_12:
      goto LABEL_13;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v20 = v4;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "No masterScopedIdentifier found in master %@.", buf, 0xCu);
      }

      v15 = 0;
      goto LABEL_12;
    }

    v5 = 0;
LABEL_7:
    v15 = 0;
LABEL_13:

    goto LABEL_14;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v5 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v20 = self;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_ERROR, "Can't find master for asset %@.", buf, 0xCu);
    }

    goto LABEL_7;
  }

  v15 = 0;
LABEL_14:

  return v15;
}

id __36__PLManagedAsset_CPL__cplFullRecord__block_invoke(uint64_t a1, uint64_t a2)
{
  v9 = *MEMORY[0x1E69E9840];
  v4 = PLBackendGetLog();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    v7 = 136315138;
    v8 = "[PLManagedAsset(CPL) cplFullRecord]_block_invoke";
    _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_INFO, "Generating PLRelationshipOrderKeyManager context on-demand for: %s...", &v7, 0xCu);
  }

  v5 = [objc_msgSend(*(a1 + 32) newShortLivedLibraryForOrderKeyManagerWithName:{a2), "managedObjectContext"}];

  return v5;
}

- (id)_generateVideoResourcesFromURL:(id)a3 withScopedIdentifier:(id)a4 forMaster:(BOOL)a5
{
  v5 = a5;
  v80[3] = *MEMORY[0x1E69E9840];
  v8 = a3;
  v62 = a4;
  v9 = [MEMORY[0x1E695DF70] arrayWithCapacity:3];
  if ((PLIsEDUMode() & 1) == 0)
  {
    v10 = [(PLManagedAsset *)self fingerprintScheme];
    v11 = v10;
    if (v10)
    {
      v12 = v10;
    }

    else
    {
      v12 = [MEMORY[0x1E6994AE0] invalidFingerprintScheme];
    }

    v61 = v12;

    v13 = [(PLManagedAsset *)self isPhotoIris];
    v14 = MEMORY[0x1E695DF70];
    v80[0] = &unk_1F0FBCCA0;
    v80[1] = &unk_1F0FBCC10;
    v80[2] = &unk_1F0FBCC28;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v80 count:3];
    v16 = [v14 arrayWithArray:v15];

    v17 = [MEMORY[0x1E6987E28] assetWithURL:v8];
    v56 = [objc_alloc(MEMORY[0x1E69C0718]) initWithAVAsset:v17 timeZoneLookup:0];
    v60 = v13;
    if (!v13 && [v56 isHDR])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          [v8 lastPathComponent];
          v20 = v19 = v17;
          *buf = 138412290;
          v72 = v20;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEFAULT, "Video resource %@ is HDR, requesting additional HDR medium derivative", buf, 0xCu);

          v17 = v19;
        }
      }

      [v16 addObject:&unk_1F0FBCCD0];
    }

    v69 = 0u;
    v70 = 0u;
    v67 = 0u;
    v68 = 0u;
    obj = v16;
    v21 = [obj countByEnumeratingWithState:&v67 objects:v79 count:16];
    if (v21)
    {
      v23 = v21;
      v24 = 0x1E6994000uLL;
      v64 = *v68;
      *&v22 = 138413058;
      v52 = v22;
      v54 = v9;
      v55 = v8;
      v59 = v5;
      v57 = v17;
      v58 = self;
      do
      {
        v25 = 0;
        do
        {
          if (*v68 != v64)
          {
            objc_enumerationMutation(obj);
          }

          v26 = [*(*(&v67 + 1) + 8 * v25) unsignedIntegerValue];
          if ([*(v24 + 3424) shouldGenerateVideoDerivativeForAVAsset:v17 forResourceType:v26 adjusted:!v5])
          {
            v27 = [(PLManagedAsset *)self _createVideoResourceFromVideoURL:v8 withResourceType:v26 scopedIdentifier:v62 applyVideoAdjustments:1 forMaster:v5 forPhotoIris:v60 fingerprintScheme:v61];
            if (v27)
            {
              v28 = v27;
              v29 = [MEMORY[0x1E696AC08] defaultManager];
              v30 = [v8 path];
              v31 = [v29 attributesOfItemAtPath:v30 error:0];
              v32 = [v31 fileSize];

              v33 = [v28 identity];
              if ([v33 fileSize] < v32 || objc_msgSend(v56, "firstVideoTrackCodec") != 1635148593)
              {
                goto LABEL_41;
              }

              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v34 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v34, OS_LOG_TYPE_DEFAULT))
                {
                  v35 = [v33 fileSize];
                  v36 = [MEMORY[0x1E6994B90] descriptionForResourceType:v26];
                  *buf = 134218498;
                  v72 = v35;
                  v9 = v54;
                  v73 = 2048;
                  v74 = v32;
                  v75 = 2112;
                  v76 = v36;
                  _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_DEFAULT, "Generated derivative size %llu is larger than input size %llu for %@, will attempt to use the input resource instead.", buf, 0x20u);
                }
              }

              v37 = [v33 fileURL];
              v66 = 0;
              v38 = [v29 removeItemAtURL:v37 error:&v66];
              v39 = v66;
              v40 = v39;
              if (v38)
              {
                v65 = v39;
                v41 = [v29 copyItemAtURL:v55 toURL:v37 error:&v65];
                v53 = v65;

                if (v41)
                {
                  [v37 removeAllCachedResourceValues];
                  v42 = [v37 path];
                  v43 = [v33 fileUTI];
                  v44 = objc_opt_class();
                  v45 = [(PLManagedAsset *)v58 _createCPLResourceFromResourcePath:v42 withResourceType:v26 uniformTypeIdentifier:v43 scopedIdentifier:v62 recordClass:v44 fingerprintScheme:v61];

                  v28 = v45;
                  v8 = v55;
                  goto LABEL_38;
                }

                if ((*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  v42 = __CPLAssetsdOSLogDomain();
                  v8 = v55;
                  if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
                  {
                    v49 = [MEMORY[0x1E6994B90] descriptionForResourceType:v26];
                    *buf = v52;
                    v72 = v49;
                    v73 = 2112;
                    v74 = v55;
                    v75 = 2112;
                    v76 = v37;
                    v77 = 2112;
                    v48 = v53;
                    v78 = v53;
                    _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Failed to copy the input video to be use for %@ from %@ to %@, fallback and use the generated video. Error: %@", buf, 0x2Au);
                  }

                  else
                  {
LABEL_38:
                    v48 = v53;
                  }

LABEL_39:

                  v40 = v48;
                  v9 = v54;
LABEL_40:

LABEL_41:
                  self = v58;
                  [v9 addObject:v28];

                  v5 = v59;
                  v17 = v57;
LABEL_42:
                  v24 = 0x1E6994000;
                  goto LABEL_43;
                }

                v40 = v53;
              }

              else if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v42 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
                {
                  v47 = [MEMORY[0x1E6994B90] descriptionForResourceType:v26];
                  *buf = 138412802;
                  v72 = v47;
                  v73 = 2112;
                  v74 = v37;
                  v75 = 2112;
                  v76 = v40;
                  _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Failed to delete the oversized generated video derivative for %@ from %@, fallback and use the generated video. Error: %@", buf, 0x20u);
                }

                v48 = v40;
                v8 = v55;
                goto LABEL_39;
              }

              v8 = v55;
              goto LABEL_40;
            }

            if (*MEMORY[0x1E6994D48])
            {
              goto LABEL_44;
            }

            v28 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
            {
              v46 = [MEMORY[0x1E6994B90] descriptionForResourceType:v26];
              *buf = 138412546;
              v72 = v46;
              v73 = 2112;
              v74 = v8;
              _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Failed to generate video derivative for %@ from %@.", buf, 0x16u);

              goto LABEL_42;
            }

LABEL_43:
          }

LABEL_44:
          ++v25;
        }

        while (v23 != v25);
        v50 = [obj countByEnumeratingWithState:&v67 objects:v79 count:16];
        v23 = v50;
      }

      while (v50);
    }
  }

  return v9;
}

- (id)_createVideoResourceFromVideoURL:(uint64_t)a3 withResourceType:(void *)a4 scopedIdentifier:(int)a5 applyVideoAdjustments:(int)a6 forMaster:(int)a7 forPhotoIris:(void *)a8 fingerprintScheme:
{
  v80 = *MEMORY[0x1E69E9840];
  v57 = a2;
  v54 = a4;
  v55 = a8;
  if (a1)
  {
    if (PLIsEDUMode())
    {
      v50 = [MEMORY[0x1E696AAA8] currentHandler];
      [v50 handleFailureInMethod:sel__createVideoResourceFromVideoURL_withResourceType_scopedIdentifier_applyVideoAdjustments_forMaster_forPhotoIris_fingerprintScheme_ object:a1 file:@"PLManagedAsset+CPL.m" lineNumber:977 description:@"Should not be generating video derivatives in EDU mode"];
    }

    v72 = 0;
    v73 = &v72;
    v74 = 0x3032000000;
    v75 = __Block_byref_object_copy__51017;
    v76 = __Block_byref_object_dispose__51018;
    v77 = 0;
    if (a3 <= 20)
    {
      if (a3 == 6)
      {
        v15 = *MEMORY[0x1E69872F8];
        v16 = MEMORY[0x1E6987300];
LABEL_19:
        v20 = *v16;
        v56 = v15;
        if (a7)
        {
          v21 = v15;
        }

        else
        {
          v21 = *v16;
        }

        v22 = v21;
        if ((a7 & 1) == 0)
        {
          v19 = MEMORY[0x1E69874B8];
          v56 = v20;
          goto LABEL_27;
        }

        goto LABEL_26;
      }

      if (a3 == 7)
      {
        v15 = *MEMORY[0x1E69872F0];
        v16 = MEMORY[0x1E69872E8];
        goto LABEL_19;
      }

LABEL_11:
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        if (__CPLCloudPhotoServicesOSLogDomain_onceToken != -1)
        {
          dispatch_once(&__CPLCloudPhotoServicesOSLogDomain_onceToken, &__block_literal_global_913);
        }

        v18 = __CPLCloudPhotoServicesOSLogDomain_result;
        if (os_log_type_enabled(__CPLCloudPhotoServicesOSLogDomain_result, OS_LOG_TYPE_ERROR))
        {
          *buf = 134217984;
          *&buf[4] = a3;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Unhandled CPL resource type: %ld, Unable to set preset for video derivatives.", buf, 0xCu);
        }
      }

      v56 = 0;
      if ((a7 & 1) == 0)
      {
        v19 = MEMORY[0x1E69874B8];
LABEL_27:
        v23 = *v19;
        v24 = [MEMORY[0x1E696AC08] defaultManager];
        v25 = [a1 pathForCPLResourceType:a3 adjusted:a6 ^ 1u];
        [v25 stringByDeletingLastPathComponent];
        v52 = v71 = 0;
        v26 = [v24 createDirectoryIfNeededAtPath:? error:?];
        v53 = 0;
        if ((v26 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v27 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412290;
            *&buf[4] = v53;
            _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_ERROR, "Unable to create directory for video resource: %@", buf, 0xCu);
          }
        }

        v28 = [v24 fileExistsAtPath:v25];
        if (v28)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v29 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
            {
              *buf = 138412290;
              *&buf[4] = v25;
              _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_DEFAULT, "Derivative already exists at %@, removing", buf, 0xCu);
            }
          }

          [v24 removeItemAtPath:v25 error:0];
        }

        else if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v30 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
          {
            *buf = 138412290;
            *&buf[4] = v25;
            _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_DEBUG, "Derivative at %@ will be removed after sending to CPL", buf, 0xCu);
          }
        }

        v31 = [MEMORY[0x1E695DFF8] fileURLWithPath:v25 isDirectory:0];
        v32 = v31;
        if (a5)
        {
          v33 = [PLSlalomUtilities synchronouslyFetchVideoAdjustmentsFromManagedAsset:a1];
          v34 = v32;
        }

        else
        {
          v34 = v31;
          v33 = 0;
        }

        v35 = v23;
        v36 = [MEMORY[0x1E6988168] assetWithURL:v57];
        v37 = [objc_alloc(MEMORY[0x1E69C08F8]) initWithVideoAsset:v36 videoAdjustments:v33];
        v51 = v36;
        v38 = v33;
        v39 = v28 ^ 1;
        v40 = dispatch_semaphore_create(0);
        v60[0] = MEMORY[0x1E69E9820];
        v60[1] = 3221225472;
        v60[2] = __153__PLManagedAsset_CPL___createVideoResourceFromVideoURL_withResourceType_scopedIdentifier_applyVideoAdjustments_forMaster_forPhotoIris_fingerprintScheme___block_invoke;
        v60[3] = &unk_1E756D688;
        v69 = a3;
        v61 = v57;
        v41 = v34;
        v62 = v41;
        v42 = v24;
        v63 = v42;
        v64 = v55;
        v43 = v35;
        v65 = v43;
        v68 = &v72;
        v66 = v54;
        v70 = v39;
        v44 = v40;
        v67 = v44;
        *buf = *MEMORY[0x1E6960CC0];
        v79 = *(MEMORY[0x1E6960CC0] + 16);
        v58 = *buf;
        v59 = v79;
        [PLVideoTranscoder transcodeVideoWithObjectBuilder:v37 outputURL:v41 startTime:buf endTime:&v58 presetName:v56 outputFileType:v43 metadata:0 completionHandler:v60];
        dispatch_semaphore_wait(v44, 0xFFFFFFFFFFFFFFFFLL);
        v45 = v73[5];
        if (v45)
        {
          if (*MEMORY[0x1E6994D48])
          {
LABEL_53:
            a1 = v45;

            _Block_object_dispose(&v72, 8);
            goto LABEL_54;
          }

          v46 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_DEBUG))
          {
            v47 = v73[5];
            *buf = 138412290;
            *&buf[4] = v47;
            _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_DEBUG, "Generated video resource %@", buf, 0xCu);
          }
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            v45 = 0;
            goto LABEL_53;
          }

          v46 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
          {
            v48 = [a1 scopedIdentifier];
            *buf = 138412290;
            *&buf[4] = v48;
            _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_ERROR, "Failed to create video resource for %@", buf, 0xCu);
          }
        }

        v45 = v73[5];
        goto LABEL_53;
      }

LABEL_26:
      v19 = MEMORY[0x1E69874C0];
      goto LABEL_27;
    }

    if (a3 == 21)
    {
      v17 = MEMORY[0x1E6987310];
    }

    else
    {
      if (a3 != 28)
      {
        goto LABEL_11;
      }

      v17 = MEMORY[0x1E6987308];
    }

    v56 = *v17;
    goto LABEL_26;
  }

LABEL_54:

  return a1;
}

- (id)_createCPLResourceFromResourcePath:(uint64_t)a3 withResourceType:(void *)a4 uniformTypeIdentifier:(void *)a5 scopedIdentifier:(void *)a6 recordClass:(void *)a7 fingerprintScheme:
{
  v63 = *MEMORY[0x1E69E9840];
  v13 = a2;
  v14 = a4;
  v15 = a7;
  v51 = v15;
  v52 = v14;
  if (a1)
  {
    v16 = v15;
    v17 = MEMORY[0x1E695DFF8];
    v18 = a5;
    v19 = [[v17 alloc] initFileURLWithPath:v13 isDirectory:0];
    v20 = [objc_alloc(MEMORY[0x1E6994B98]) initWithFileURL:v19];
    [v20 setAvailable:1];
    v21 = [objc_alloc(MEMORY[0x1E6994B90]) initWithResourceIdentity:v20 itemScopedIdentifier:v18 resourceType:a3];

    [v20 setFileUTI:v14];
    if (a3 == 1)
    {
      v22 = [a1 originalWidth];
      v23 = [a1 originalHeight];
    }

    else
    {
      v22 = *MEMORY[0x1E695F060];
      v23 = *(MEMORY[0x1E695F060] + 8);
    }

    v24 = MEMORY[0x1E6994D48];
    v49 = a6;
    if (!v14 || v22 != 0.0 && v23 != 0.0)
    {
      v25 = v13;
      v26 = MEMORY[0x1E6994D48];
      goto LABEL_20;
    }

    v27 = [MEMORY[0x1E6982C40] typeWithIdentifier:v14];
    if ([v27 conformsToType:*MEMORY[0x1E6982E30]])
    {
      [PLManagedAsset sizeOfImageAtURL:v19 outOrientation:0];
      v22 = v28;
      v23 = v29;
      if (*v24)
      {
LABEL_19:
        v25 = v13;
        v26 = v24;

LABEL_20:
        [v20 setImageDimensions:{v22, v23}];
        v56 = 0;
        v34 = *MEMORY[0x1E695DB50];
        v55 = 0;
        v35 = [v19 getResourceValue:&v56 forKey:v34 error:&v55];
        v36 = v56;
        v37 = v55;
        v50 = v21;
        if (v35)
        {
          [v20 setFileSize:{objc_msgSend(v36, "unsignedIntegerValue")}];
          if (!v19)
          {
LABEL_30:
            v42 = 0;
            v39 = 0;
            goto LABEL_31;
          }

          v54 = v37;
          [v16 fingerPrintForFileAtURL:v19 error:&v54];
          v39 = v38 = v16;
          v40 = v54;

          if (!v39)
          {
            v42 = 0;
            v37 = v40;
            goto LABEL_31;
          }

          if (([v38 isForStableHash] & 1) != 0 || !objc_msgSend(v49, "requiresStableHashForResourceType:", a3))
          {
            v42 = 0;
            v37 = v40;
            if (!v40)
            {
LABEL_41:
              v47 = *v26;
              v13 = v25;
              if ((v47 & 1) == 0)
              {
                v48 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v48, OS_LOG_TYPE_DEBUG))
                {
                  *buf = 138412802;
                  v58 = *&v39;
                  v59 = 2112;
                  v60 = *&v42;
                  v61 = 2112;
                  v62 = v25;
                  _os_log_impl(&dword_19BF1F000, v48, OS_LOG_TYPE_DEBUG, "Setting finger print %@ and stableHash %@ to %@", buf, 0x20u);
                }
              }

              [v20 setFingerPrint:v39];
              [v20 setStableHash:v42];
              v37 = 0;
              v45 = v50;
LABEL_36:

              goto LABEL_37;
            }

LABEL_31:
            v43 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Failed to generate finger print or stable hash for %@. Error: %@", v25, v37];
            if ((*v26 & 1) == 0)
            {
              v44 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
              {
                *buf = 138412546;
                v58 = *&v25;
                v59 = 2112;
                v60 = *&v37;
                _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Failed to generate finger print or stable hash for %@. Error: %@", buf, 0x16u);
              }
            }

            PLSimulateCrash();

            v45 = v50;
            v13 = v25;
            goto LABEL_36;
          }

          v41 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
          v53 = v40;
          v42 = [v41 fingerPrintForFileAtURL:v19 error:&v53];
          v37 = v53;

          if (v42)
          {
            if (!v37)
            {
              goto LABEL_41;
            }

            goto LABEL_31;
          }
        }

        else
        {
          v39 = v19;
          v19 = 0;
        }

        goto LABEL_30;
      }

      v30 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
LABEL_18:

        goto LABEL_19;
      }

      *buf = 134218498;
      v58 = v22;
      v59 = 2048;
      v60 = v23;
      v61 = 2112;
      v62 = v13;
      v31 = "Read image size %lf.%lf from resource file %@.";
    }

    else
    {
      if (![v27 conformsToType:*MEMORY[0x1E6982EE8]])
      {
        goto LABEL_19;
      }

      [PLManagedAsset dimensionsForVideoAtURL:v19];
      v22 = v32;
      v23 = v33;
      if (*v24)
      {
        goto LABEL_19;
      }

      v30 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
      {
        goto LABEL_18;
      }

      *buf = 134218498;
      v58 = v22;
      v59 = 2048;
      v60 = v23;
      v61 = 2112;
      v62 = v13;
      v31 = "Read video size %lf.%lf from resource file %@.";
    }

    _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_DEBUG, v31, buf, 0x20u);
    goto LABEL_18;
  }

  v45 = 0;
LABEL_37:

  return v45;
}

void __153__PLManagedAsset_CPL___createVideoResourceFromVideoURL_withResourceType_scopedIdentifier_applyVideoAdjustments_forMaster_forPhotoIris_fingerprintScheme___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v41 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (!v6)
  {
    v12 = *(a1 + 48);
    v13 = [*(a1 + 40) path];
    LOBYTE(v12) = [v12 fileExistsAtPath:v13];

    if ((v12 & 1) == 0)
    {
      if (*MEMORY[0x1E6994D48])
      {
        v7 = 0;
        goto LABEL_27;
      }

      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v20 = [MEMORY[0x1E6994B90] descriptionForResourceType:*(a1 + 96)];
        v21 = *(a1 + 32);
        v22 = *(a1 + 40);
        *buf = 138412802;
        v34 = v20;
        v35 = 2112;
        v36 = v21;
        v37 = 2112;
        v38 = v22;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "failed to write video derivative type %@ for %@ to %@.", buf, 0x20u);
      }

      v7 = 0;
      goto LABEL_26;
    }

    v8 = [objc_alloc(MEMORY[0x1E6994B98]) initWithFileURL:*(a1 + 40)];
    v14 = *(a1 + 56);
    v15 = *(a1 + 40);
    v32 = 0;
    v9 = [v14 fingerPrintForFileAtURL:v15 error:&v32];
    v16 = v32;
    v17 = v16;
    if (!v9 || v16)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v23 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
        {
          v24 = *(a1 + 40);
          *buf = 138412546;
          v34 = v24;
          v35 = 2112;
          v36 = v17;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_ERROR, "Failed to create finger print for %@. Error: %@", buf, 0x16u);
        }
      }
    }

    else
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
        {
          v19 = *(a1 + 40);
          *buf = 138412546;
          v34 = v9;
          v35 = 2112;
          v36 = v19;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEBUG, "Setting finger print %@ to %@", buf, 0x16u);
        }
      }

      [v8 setFingerPrint:v9];
    }

    [v8 setFileUTI:*(a1 + 64)];
    v25 = *(a1 + 48);
    v26 = [*(a1 + 40) path];
    v31 = v17;
    v27 = [v25 attributesOfItemAtPath:v26 error:&v31];
    v7 = v31;

    if (!v7 && v27)
    {
      -[NSObject setFileSize:](v8, "setFileSize:", [v27 fileSize]);
    }

    [PLManagedAsset dimensionsForVideoAtURL:*(a1 + 40)];
    [v8 setImageDimensions:?];
    [v8 setAvailable:1];
    v28 = [objc_alloc(MEMORY[0x1E6994B90]) initWithResourceIdentity:v8 itemScopedIdentifier:*(a1 + 72) resourceType:*(a1 + 96)];
    v29 = *(*(a1 + 88) + 8);
    v30 = *(v29 + 40);
    *(v29 + 40) = v28;

    [*(*(*(a1 + 88) + 8) + 40) setDeleteAfterUpload:*(a1 + 104)];
    goto LABEL_25;
  }

  v7 = v6;
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v8 = __CPLAssetsdOSLogDomain();
    if (!os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
LABEL_26:

      goto LABEL_27;
    }

    v9 = [MEMORY[0x1E6994B90] descriptionForResourceType:*(a1 + 96)];
    v10 = *(a1 + 32);
    v11 = *(a1 + 40);
    *buf = 138413058;
    v34 = v9;
    v35 = 2112;
    v36 = v10;
    v37 = 2112;
    v38 = v11;
    v39 = 2112;
    v40 = v7;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "could not generate video derivative type %@ for %@ error %@, to write to %@", buf, 0x2Au);
LABEL_25:

    goto LABEL_26;
  }

LABEL_27:
  dispatch_semaphore_signal(*(a1 + 80));
}

- (id)_generatePosterFrameResourcesFromVideoURL:(id)a3 withScopedIdentifier:(id)a4 forMaster:(BOOL)a5 fingerprintScheme:(id)a6
{
  v7 = a5;
  v21 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v12 = a6;
  v13 = [MEMORY[0x1E695DF70] arrayWithCapacity:2];
  v14 = [(PLManagedAsset *)self _generatePosterFrameForVideoAtURL:v10 withResourceType:4 scopedIdentifier:v11 forMaster:v7 fingerprintScheme:v12];
  if (v14)
  {
    [v13 addObject:v14];
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v19 = 138412290;
      v20 = v10;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Failed to generate medium poster image for %@", &v19, 0xCu);
    }
  }

  v16 = [(PLManagedAsset *)self _generatePosterFrameForVideoAtURL:v10 withResourceType:5 scopedIdentifier:v11 forMaster:v7 fingerprintScheme:v12];
  if (v16)
  {
    [v13 addObject:v16];
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v19 = 138412290;
      v20 = v10;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "Failed to generate thumbnail poster image for %@", &v19, 0xCu);
    }
  }

  return v13;
}

- (id)_generatePosterFrameForVideoAtURL:(uint64_t)a3 withResourceType:(void *)a4 scopedIdentifier:(int)a5 forMaster:(void *)a6 fingerprintScheme:
{
  v58 = *MEMORY[0x1E69E9840];
  v11 = a2;
  v48 = a4;
  v47 = a6;
  if (a1)
  {
    v12 = [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:a3];
    [a1 imageSize];
    v15 = v14;
    v16 = v13;
    v17 = MEMORY[0x1E6994D48];
    if (v14 == 0.0 || v13 == 0.0)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
        {
          *buf = 134218498;
          v51 = v15;
          v52 = 2048;
          v53 = v16;
          v54 = 2112;
          v55 = v11;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Original size (width: %f height: %f) is invalid. Getting the size from the video file %@ directly", buf, 0x20u);
        }
      }

      [PLManagedAsset dimensionsForVideoAtURL:v11];
      v15 = v19;
      v16 = v20;
    }

    [a1 _targetSizeForInputSize:v12 maxPixelSize:{v15, v16}];
    v22 = v21;
    v24 = v23;
    v25 = [MEMORY[0x1E696AC08] defaultManager];
    v26 = [a1 pathForCPLResourceType:a3 adjusted:a5 ^ 1u];
    [(__CFString *)v26 stringByDeletingLastPathComponent];
    v46 = v49[1] = 0;
    v27 = [v25 createDirectoryIfNeededAtPath:? error:?];
    v28 = 0;
    if ((v27 & 1) == 0 && (*v17 & 1) == 0)
    {
      v29 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v51 = *&v28;
        _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "Unable to create directory for video posterframe image: %@", buf, 0xCu);
      }
    }

    v30 = [v25 fileExistsAtPath:v26];
    if (v30)
    {
      if ((*v17 & 1) == 0)
      {
        v31 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_DEBUG))
        {
          *buf = 138412290;
          v51 = *&v26;
          _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_DEBUG, "Poster frame exists at %@, removing", buf, 0xCu);
        }
      }

      [v25 removeItemAtPath:v26 error:0];
    }

    else if ((*v17 & 1) == 0)
    {
      v32 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412290;
        v51 = *&v26;
        _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_DEBUG, "Poster frame at %@ will be removed after sending to CPL", buf, 0xCu);
      }
    }

    v49[0] = v28;
    v33 = v11;
    v34 = [PLVideoTranscoder generatePosterFrameForVideoAtURL:v11 maxSize:v49 error:v22, v24];
    v35 = v49[0];

    if (!v35 && v34)
    {
      v36 = DCIM_CGImageRefFromPLImage();
      writeCGImageToPath(v36, v26, 0);
    }

    if ([v25 fileExistsAtPath:v26])
    {
      v37 = [*MEMORY[0x1E6982E58] identifier];
      v38 = objc_opt_class();
      v39 = a1;
      v40 = a3;
      v42 = v47;
      v41 = v48;
      v43 = [(PLManagedAsset *)v39 _createCPLResourceFromResourcePath:v26 withResourceType:v40 uniformTypeIdentifier:v37 scopedIdentifier:v48 recordClass:v38 fingerprintScheme:v47];

      [v43 setDeleteAfterUpload:v30 ^ 1u];
    }

    else if (*v17)
    {
      v43 = 0;
      v42 = v47;
      v41 = v48;
    }

    else
    {
      v44 = __CPLAssetsdOSLogDomain();
      v42 = v47;
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        *buf = 138413058;
        v51 = *&a1;
        v52 = 2112;
        v53 = *&v33;
        v54 = 2112;
        v55 = v26;
        v56 = 2112;
        v57 = v35;
        _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Failed to write poster image for %@. Original file path: %@ Derivative path: %@ Error: %@", buf, 0x2Au);
      }

      v43 = 0;
      v41 = v48;
    }
  }

  else
  {
    v33 = v11;
    v43 = 0;
    v42 = v47;
    v41 = v48;
  }

  return v43;
}

- (id)_createJPEGResourcesFromFullSizePath:(id)a3 withScopedIdentifier:(id)a4 forMaster:(BOOL)a5 forResourceTypes:(id)a6 fingerprintScheme:(id)a7
{
  v78 = a5;
  v113 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v86 = a4;
  v75 = a6;
  v84 = a7;
  v81 = [MEMORY[0x1E695DF70] arrayWithCapacity:3];
  if (v10)
  {
    v11 = [MEMORY[0x1E696AC08] defaultManager];
    v12 = [v11 fileExistsAtPath:v10];

    if (v12)
    {
      v13 = [MEMORY[0x1E695DFF8] fileURLWithPath:v10 isDirectory:0];
      [PLManagedAsset sizeOfImageAtURL:v13 outOrientation:0];
      v15 = v14;
      v17 = v16;

      [MEMORY[0x1E6994B90] derivativeGenerationThreshold];
      v19 = v18;
      v93 = 0u;
      v94 = 0u;
      v95 = 0u;
      v96 = 0u;
      obj = v75;
      v90 = [obj countByEnumeratingWithState:&v93 objects:v98 count:16];
      if (!v90)
      {
        goto LABEL_88;
      }

      v87 = *v94;
      v20 = (v15 * v17);
      v76 = *MEMORY[0x1E6982E58];
      v77 = v10;
      while (1)
      {
        v21 = 0;
        do
        {
          if (*v94 != v87)
          {
            objc_enumerationMutation(obj);
          }

          v22 = [*(*(&v93 + 1) + 8 * v21) unsignedIntegerValue];
          v23 = [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:v22];
          if (v22 == 5 || (v19 * v23) <= v20)
          {
            v91 = v10;
            v88 = v86;
            v89 = v84;
            if (!self)
            {
              v57 = 0;
              goto LABEL_54;
            }

            v24 = [MEMORY[0x1E696AC08] defaultManager];
            v25 = v91;
            if (([v24 fileExistsAtPath:v25] & 1) == 0)
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v26 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
                {
                  v27 = [(PLManagedAsset *)self mainFileURL];
                  *buf = 138412546;
                  *&buf[4] = v10;
                  *&buf[12] = 2112;
                  *&buf[14] = v27;
                  _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Input file to resize does not exist at %@, use main file %@ instead", buf, 0x16u);
                }
              }

              v28 = [(PLManagedAsset *)self mainFileURL];
              v29 = [v28 path];

              v25 = v29;
              if (!v29)
              {
                goto LABEL_40;
              }
            }

            if ([v24 fileExistsAtPath:v25])
            {
              [(PLManagedAsset *)self imageSize];
              v32 = v31;
              v33 = v30;
              if (v31 == 0.0 && v30 == 0.0)
              {
                if ((*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  v34 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 134218498;
                    *&buf[4] = v32;
                    *&buf[12] = 2048;
                    *&buf[14] = v33;
                    *&buf[22] = 2112;
                    v112 = v25;
                    _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_ERROR, "Original size (width: %f height: %f) is invalid. Getting the size from the image file %@ directly", buf, 0x20u);
                  }
                }

                v35 = [MEMORY[0x1E695DFF8] fileURLWithPath:v25 isDirectory:0];
                [PLManagedAsset sizeOfImageAtURL:v35 outOrientation:0];
                v32 = v36;
                v33 = v37;
              }

              v38 = [(PLManagedAsset *)self pathForCPLResourceType:v22 adjusted:!v78];
              if (v38)
              {
                v82 = [MEMORY[0x1E6994B90] maxPixelSizeForResourceType:v22];
                [(PLManagedAsset *)self _targetSizeForInputSize:v82 maxPixelSize:v32, v33];
                v40 = v39;
                v42 = v41;
                v83 = [v38 stringByDeletingLastPathComponent];
                v97 = 0;
                v43 = [v24 createDirectoryIfNeededAtPath:v83 error:&v97];
                v79 = v97;
                if ((v43 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  v44 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
                  {
                    *buf = 138412290;
                    *&buf[4] = v79;
                    _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Unable to create directory for image resource: %@", buf, 0xCu);
                  }
                }

                v80 = [v24 fileExistsAtPath:v38];
                if (v80)
                {
                  *v99 = 1;
                  v45 = [MEMORY[0x1E695DFF8] fileURLWithPath:v38 isDirectory:0];
                  [PLManagedAsset sizeOfImageAtURL:v45 outOrientation:v99];
                  v47 = v46;
                  v49 = v48;

                  if (*v99 == 1 && v40 == v47 && v42 == v49)
                  {
                    if ((*MEMORY[0x1E6994D48] & 1) == 0)
                    {
                      v50 = __CPLAssetsdOSLogDomain();
                      if (os_log_type_enabled(v50, OS_LOG_TYPE_DEBUG))
                      {
                        *buf = 138412290;
                        *&buf[4] = v38;
                        _os_log_impl(&dword_19BF1F000, v50, OS_LOG_TYPE_DEBUG, "Derivative already exists at %@, using it", buf, 0xCu);
                      }
                    }

                    v51 = 0;
                    *buf = 0;
                    *&buf[8] = buf;
                    *&buf[16] = 0x2020000000;
                    LOBYTE(v112) = 0;
LABEL_74:
                    if ([v24 fileExistsAtPath:v38])
                    {
                      v70 = [v76 identifier];
                      v71 = objc_opt_class();
                      v57 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v38 withResourceType:v22 uniformTypeIdentifier:v70 scopedIdentifier:v88 recordClass:v71 fingerprintScheme:v89];

                      [v57 setDeleteAfterUpload:v51];
                      goto LABEL_81;
                    }

LABEL_76:
                    if ((*MEMORY[0x1E6994D48] & 1) == 0)
                    {
                      v72 = __CPLAssetsdOSLogDomain();
                      if (os_log_type_enabled(v72, OS_LOG_TYPE_ERROR))
                      {
                        *v99 = 138412802;
                        v100 = self;
                        v101 = 2112;
                        v102 = v25;
                        v103 = 2112;
                        v104 = v38;
                        _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_ERROR, "Failed to generate derivative for %@. Original file path: %@ Derivative path: %@", v99, 0x20u);
                      }
                    }

                    v57 = 0;
LABEL_81:
                    _Block_object_dispose(buf, 8);

                    v55 = *MEMORY[0x1E6994D48];
                    if (v57)
                    {
                      if ((*MEMORY[0x1E6994D48] & 1) == 0)
                      {
                        v56 = __CPLAssetsdOSLogDomain();
                        if (os_log_type_enabled(v56, OS_LOG_TYPE_DEBUG))
                        {
                          *buf = 138412290;
                          *&buf[4] = v57;
                          _os_log_impl(&dword_19BF1F000, v56, OS_LOG_TYPE_DEBUG, "Generated image resource %@", buf, 0xCu);
                        }

                        goto LABEL_52;
                      }

                      goto LABEL_53;
                    }

LABEL_48:
                    if ((v55 & 1) == 0)
                    {
                      v56 = __CPLAssetsdOSLogDomain();
                      if (os_log_type_enabled(v56, OS_LOG_TYPE_ERROR))
                      {
                        *buf = 138412290;
                        *&buf[4] = v86;
                        _os_log_impl(&dword_19BF1F000, v56, OS_LOG_TYPE_ERROR, "Failed to create image resource for %@", buf, 0xCu);
                      }

                      v57 = 0;
LABEL_52:

LABEL_53:
LABEL_54:

                      if (v57)
                      {
                        [v81 addObject:v57];
                      }

                      else if ((*MEMORY[0x1E6994D48] & 1) == 0)
                      {
                        v58 = __CPLAssetsdOSLogDomain();
                        if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
                        {
                          v59 = [MEMORY[0x1E6994B90] descriptionForResourceType:v22];
                          *v105 = 138412802;
                          *&v105[4] = v59;
                          *&v105[12] = 2112;
                          *&v105[14] = v10;
                          *&v105[22] = 2112;
                          v106 = v86;
                          _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_ERROR, "Failed to generate image resource type %@ from fullsize image %@ for asset %@.", v105, 0x20u);
                        }
                      }

                      goto LABEL_61;
                    }

LABEL_85:
                    v57 = 0;
                    goto LABEL_53;
                  }

                  if ((*MEMORY[0x1E6994D48] & 1) == 0)
                  {
                    v61 = __CPLAssetsdOSLogDomain();
                    if (os_log_type_enabled(v61, OS_LOG_TYPE_DEBUG))
                    {
                      *buf = 138412290;
                      *&buf[4] = v38;
                      _os_log_impl(&dword_19BF1F000, v61, OS_LOG_TYPE_DEBUG, "Derivative exists at %@, but size doesn't match, removing", buf, 0xCu);
                    }
                  }

                  [v24 removeItemAtPath:v38 error:0];
                }

                else if ((*MEMORY[0x1E6994D48] & 1) == 0)
                {
                  v60 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v60, OS_LOG_TYPE_DEBUG))
                  {
                    *buf = 138412290;
                    *&buf[4] = v38;
                    _os_log_impl(&dword_19BF1F000, v60, OS_LOG_TYPE_DEBUG, "Derivative at %@ will be removed after sending to CPL", buf, 0xCu);
                  }
                }

                *buf = 0;
                *&buf[8] = buf;
                *&buf[16] = 0x2020000000;
                LOBYTE(v112) = 0;
                v62 = dispatch_semaphore_create(0);
                v63 = MEMORY[0x1E696AEC0];
                v64 = [MEMORY[0x1E6994B90] descriptionForResourceType:v22];
                v65 = [v63 stringWithFormat:@"Managed asset image generation for resource type %@", v64];

                v66 = MEMORY[0x1E6994D60];
                v67 = [MEMORY[0x1E695DFF8] fileURLWithPath:v25 isDirectory:0];
                v68 = [MEMORY[0x1E695DFF8] fileURLWithPath:v38 isDirectory:0];
                *v105 = MEMORY[0x1E69E9820];
                *&v105[8] = 3221225472;
                *&v105[16] = __125__PLManagedAsset_CPL___createImageResourceForResourceType_withPreviewImagePath_scopedIdentifier_forMaster_fingerprintScheme___block_invoke;
                v106 = &unk_1E7571B80;
                v107 = v25;
                v108 = v38;
                v110 = buf;
                v69 = v62;
                v109 = v69;
                [v66 resizeImageAtURL:v67 destinationURL:v68 maximumPixelCount:v82 bakeInOrientation:1 colorOutput:0 reason:v65 completionHandler:v105];

                v10 = v77;
                dispatch_semaphore_wait(v69, 0xFFFFFFFFFFFFFFFFLL);

                if (*(*&buf[8] + 24) == 1)
                {
                  v51 = v80 ^ 1u;
                  goto LABEL_74;
                }

                goto LABEL_76;
              }

              if (*MEMORY[0x1E6994D48])
              {
                goto LABEL_85;
              }

              v52 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
              {
                *buf = 134218242;
                *&buf[4] = v22;
                *&buf[12] = 2112;
                *&buf[14] = self;
                v53 = v52;
                v54 = "No destination path found to write the derivative of type %lu for %@";
LABEL_46:
                _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_ERROR, v54, buf, 0x16u);
              }
            }

            else
            {
LABEL_40:
              if (*MEMORY[0x1E6994D48])
              {
                goto LABEL_85;
              }

              v52 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v52, OS_LOG_TYPE_ERROR))
              {
                *buf = 138412546;
                *&buf[4] = v25;
                *&buf[12] = 2112;
                *&buf[14] = v86;
                v53 = v52;
                v54 = "Failed to find image to resize at %@. Skipping derivative generation for %@";
                goto LABEL_46;
              }
            }

            v55 = *MEMORY[0x1E6994D48];
            goto LABEL_48;
          }

LABEL_61:
          ++v21;
        }

        while (v90 != v21);
        v73 = [obj countByEnumeratingWithState:&v93 objects:v98 count:16];
        v90 = v73;
        if (!v73)
        {
LABEL_88:

          break;
        }
      }
    }
  }

  return v81;
}

void __125__PLManagedAsset_CPL___createImageResourceForResourceType_withPreviewImagePath_scopedIdentifier_forMaster_fingerprintScheme___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v19 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (v6)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v7 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        v8 = *(a1 + 32);
        v9 = *(a1 + 40);
        v13 = 138412802;
        v14 = v8;
        v15 = 2112;
        v16 = v9;
        v17 = 2112;
        v18 = v6;
        _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "Failed to resize image at %@ to %@: %@", &v13, 0x20u);
      }
    }
  }

  else
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_DEBUG))
      {
        v11 = *(a1 + 32);
        v12 = *(a1 + 40);
        v13 = 138412546;
        v14 = v11;
        v15 = 2112;
        v16 = v12;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_DEBUG, "Resized %@ to %@", &v13, 0x16u);
      }
    }

    *(*(*(a1 + 56) + 8) + 24) = 1;
  }

  dispatch_semaphore_signal(*(a1 + 48));
}

- (void)_debugPrintAdjustmentState
{
  v19 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E696AC08] defaultManager];
  v4 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v5 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
    {
      v6 = [(PLManagedAsset *)self additionalAttributes];
      v7 = [v6 unmanagedAdjustment];
      v8 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
      v9 = [v3 fileExistsAtPath:v8];
      v10 = @"missing";
      if (v9)
      {
        v10 = @"exists";
      }

      v15 = 138412546;
      v16 = v7;
      v17 = 2112;
      v18 = v10;
      _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "UnmanagedAdjustment: %@ \nFull size render %@", &v15, 0x16u);
    }
  }

  v11 = [(PLManagedAsset *)self pathForAdjustmentFile];
  if ([v3 fileExistsAtPath:v11])
  {
    v12 = [MEMORY[0x1E695DEF0] dataWithContentsOfFile:v11];
    if (v12)
    {
      v13 = [MEMORY[0x1E696AE40] propertyListWithData:v12 options:0 format:0 error:0];
      if ((*v4 & 1) == 0)
      {
        v14 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          v15 = 138412290;
          v16 = v13;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Adjustment dictionary: %@", &v15, 0xCu);
        }
      }
    }

    else
    {
      if (*v4)
      {
LABEL_17:

        goto LABEL_18;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v15 = 138412290;
        v16 = v11;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Failed to load adjustment data from %@", &v15, 0xCu);
      }
    }

    goto LABEL_17;
  }

LABEL_18:
}

- (void)_applyResourceChangeToCPLAsset:(id)a3 forChangeType:(unint64_t)a4 shouldGenerateDerivatives:(BOOL)a5 inLibrary:(id)a6
{
  v7 = a5;
  v8 = a4;
  v114 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a6;
  v12 = MEMORY[0x1E695DF70];
  v13 = [(PLManagedAsset *)self allAssetCPLResources];
  v14 = [v12 arrayWithCapacity:{objc_msgSend(v13, "count")}];

  if (![(PLManagedAsset *)self isPlaceholderAsset])
  {
    v27 = [(PLManagedAsset *)self fingerprintScheme];
    v28 = v27;
    if (v27)
    {
      v29 = v27;
    }

    else
    {
      v29 = [MEMORY[0x1E6994AE0] invalidFingerprintScheme];
    }

    v83 = v29;

    v30 = [(PLManagedAsset *)self hasAdjustedCPLThumbResource];
    v31 = [(PLManagedAsset *)self additionalAttributes];
    v32 = [v31 sourceAssetForDuplicationCPLScopedIdentifier];

    if (v32)
    {
      v81 = v10;
      v33 = self;
      [(PLManagedAsset *)self allAssetCPLResources];
      v103 = 0u;
      v104 = 0u;
      v105 = 0u;
      obj = v106 = 0u;
      v34 = [obj countByEnumeratingWithState:&v103 objects:v113 count:16];
      if (v34)
      {
        v35 = v34;
        v36 = *v104;
        do
        {
          for (i = 0; i != v35; ++i)
          {
            if (*v104 != v36)
            {
              objc_enumerationMutation(obj);
            }

            v38 = *(*(&v103 + 1) + 8 * i);
            v39 = [v38 cplResourceIncludeFile:0];
            v40 = v39;
            if (v39)
            {
              [v39 setCanGenerateDerivative:0];
              v41 = [v40 identity];
              [v41 setFileURL:0];

              [v40 setSourceResourceType:{objc_msgSend(v38, "cplType")}];
              [v14 addObject:v40];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v42 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v42, OS_LOG_TYPE_ERROR))
              {
                v43 = [(PLManagedAsset *)v33 scopedIdentifier];
                *buf = 138412546;
                v110 = v38;
                v111 = 2112;
                v112 = v43;
                _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, "Dedupe merge resource copy: Unable to create CPLResource from %@ with itemIdentifier %@", buf, 0x16u);
              }
            }
          }

          v35 = [obj countByEnumeratingWithState:&v103 objects:v113 count:16];
        }

        while (v35);
      }

      if ([v14 count])
      {
        v44 = [(PLManagedAsset *)v33 additionalAttributes];
        v45 = [v44 sourceAssetForDuplicationCPLScopedIdentifier];
        v10 = v81;
        [v81 setResourceCopyFromScopedIdentifier:v45];

        v46 = 0;
      }

      else
      {
        v46 = 0;
        v10 = v81;
      }

LABEL_74:
      v51 = v83;
LABEL_75:

      v94[0] = MEMORY[0x1E69E9820];
      v94[1] = 3221225472;
      v94[2] = __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke;
      v94[3] = &unk_1E756D768;
      v98 = v46 & 1;
      v26 = &v95;
      v94[4] = v33;
      v95 = v51;
      v96 = v14;
      v97 = v10;
      v18 = v51;
      [(PLManagedAsset *)v33 synchronouslyFetchAdjustmentBlobWithCompletionHandler:v94];

      self = v33;
LABEL_76:

      goto LABEL_77;
    }

    if ((v8 & 8) != 0 || !v30)
    {
      v51 = v83;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v52 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v52, OS_LOG_TYPE_DEBUG))
        {
          v53 = [v10 scopedIdentifier];
          *buf = 138412290;
          v110 = v53;
          _os_log_impl(&dword_19BF1F000, v52, OS_LOG_TYPE_DEBUG, "Generating derivatives for assetChange with identifier %@", buf, 0xCu);
        }
      }

      obj = [(PLManagedAsset *)self createResourcesForAssetInPhotoLibrary:v11 shouldGenerateDerivatives:v7];
      [v14 addObjectsFromArray:?];
      v33 = self;
      v46 = 0;
      goto LABEL_75;
    }

    obj = [MEMORY[0x1E696AC08] defaultManager];
    if ([(PLManagedAsset *)self isPhoto])
    {
      v48 = [(PLManagedAsset *)self fileURLForFullsizeRenderImage];
    }

    else
    {
      if (![(PLManagedAsset *)self isVideo])
      {
        goto LABEL_51;
      }

      v48 = [(PLManagedAsset *)self fileURLForFullsizeRenderVideo];
      if ([(PLManagedAsset *)self isDefaultAdjustedSlomo])
      {
        v54 = [v48 path];
        v55 = [obj fileExistsAtPath:v54];

        if ((v55 & 1) == 0)
        {
          v56 = [(PLManagedAsset *)self mainFileURL];

          v48 = v56;
        }
      }
    }

    if (v48)
    {
      v49 = [v48 path];
      v50 = [obj fileExistsAtPath:v49];

LABEL_52:
      v85 = v50;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v57 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v57, OS_LOG_TYPE_DEFAULT))
        {
          v58 = [(PLManagedAsset *)self resources];
          v59 = v58;
          v60 = @"NO";
          if (v50)
          {
            v60 = @"YES";
          }

          *buf = 138412546;
          v110 = v58;
          v111 = 2112;
          v112 = v60;
          _os_log_impl(&dword_19BF1F000, v57, OS_LOG_TYPE_DEFAULT, "Reusing existing cloud resources %@. canGenerateDerivative: %@", buf, 0x16u);
        }
      }

      v80 = v11;
      v82 = v10;
      v84 = self;
      [(PLManagedAsset *)self allAssetCPLResources];
      v99 = 0u;
      v100 = 0u;
      v101 = 0u;
      v86 = v102 = 0u;
      v61 = [v86 countByEnumeratingWithState:&v99 objects:v108 count:16];
      v62 = v50;
      if (v61)
      {
        v63 = v61;
        v46 = 0;
        v64 = *v100;
        do
        {
          for (j = 0; j != v63; ++j)
          {
            if (*v100 != v64)
            {
              objc_enumerationMutation(v86);
            }

            v66 = *(*(&v99 + 1) + 8 * j);
            v67 = [v66 cplType] == 13;
            v68 = [v66 cplResourceIncludeFile:0];
            v69 = v68;
            if (v68)
            {
              [v68 setCanGenerateDerivative:v62];
              [v14 addObject:v69];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v70 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v70, OS_LOG_TYPE_ERROR))
              {
                v71 = [(PLManagedAsset *)v84 scopedIdentifier];
                *buf = 138412546;
                v110 = v66;
                v111 = 2112;
                v112 = v71;
                _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_ERROR, "Unable to create CPLResource from %@ with itemIdentifier %@", buf, 0x16u);

                v62 = v85;
              }
            }

            v46 |= v67;
          }

          v63 = [v86 countByEnumeratingWithState:&v99 objects:v108 count:16];
        }

        while (v63);
      }

      else
      {
        v46 = 0;
      }

      v11 = v80;
      v10 = v82;
      v33 = v84;
      goto LABEL_74;
    }

LABEL_51:
    v50 = 0;
    goto LABEL_52;
  }

  if ([(PLManagedAsset *)self isPlaceholderAsset])
  {
    v15 = [(PLManagedAsset *)self additionalAttributes];
    v16 = [v15 sourceAssetForDuplicationCPLScopedIdentifier];
    [v10 setResourceCopyFromScopedIdentifier:v16];

    if ([(PLManagedAsset *)self hasAdjustments])
    {
      v17 = self;
      v18 = [(PLManagedAsset *)self allAssetCPLResources];
      v90 = 0u;
      v91 = 0u;
      v92 = 0u;
      v93 = 0u;
      v19 = [v18 countByEnumeratingWithState:&v90 objects:v107 count:16];
      if (v19)
      {
        v20 = v19;
        v21 = *v91;
        do
        {
          for (k = 0; k != v20; ++k)
          {
            if (*v91 != v21)
            {
              objc_enumerationMutation(v18);
            }

            v23 = *(*(&v90 + 1) + 8 * k);
            v24 = [v23 cplResourceIncludeFile:0];
            if (v24)
            {
              [v24 setSourceResourceType:{objc_msgSend(v23, "cplType")}];
              v25 = [v24 identity];
              [v25 setFileURL:0];

              [v24 setCanGenerateDerivative:0];
              [v14 addObject:v24];
            }
          }

          v20 = [v18 countByEnumeratingWithState:&v90 objects:v107 count:16];
        }

        while (v20);
      }

      v88[0] = MEMORY[0x1E69E9820];
      v88[1] = 3221225472;
      v88[2] = __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke_258;
      v88[3] = &unk_1E756D790;
      self = v17;
      v88[4] = v17;
      v26 = &v89;
      v89 = v10;
      [(PLManagedAsset *)v17 synchronouslyFetchAdjustmentBlobWithCompletionHandler:v88];
      goto LABEL_76;
    }
  }

LABEL_77:
  [v10 setResources:v14];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v72 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v72, OS_LOG_TYPE_DEBUG))
    {
      v73 = [(PLManagedAsset *)self orientation];
      *buf = 67109120;
      LODWORD(v110) = v73;
      _os_log_impl(&dword_19BF1F000, v72, OS_LOG_TYPE_DEBUG, "Setting orientation %d to assetChange", buf, 8u);
    }
  }

  [v10 setOrientation:{-[PLManagedAsset orientation](self, "orientation")}];
  [(PLManagedAsset *)self duration];
  [v10 setDuration:llround(v74 * 1000.0)];
  [v10 setOriginalChoice:{-[PLManagedAsset originalResourceChoice](self, "originalResourceChoice")}];
  v75 = [(PLManagedAsset *)self additionalAttributes];
  v76 = [v75 mediaMetadataType];
  [v10 setAdjustedMediaMetaDataType:v76];

  v77 = [(PLManagedAsset *)self additionalAttributes];
  v78 = [v77 mediaMetadataData];

  v79 = [v78 length];
  if (v79 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
  {
    [v10 setAdjustedMediaMetaData:v78];
  }
}

void __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke(uint64_t a1, void *a2, int a3, void *a4, void *a5, uint64_t a6, unsigned int a7, void *a8)
{
  v64 = *MEMORY[0x1E69E9840];
  v15 = a2;
  v16 = a4;
  v17 = a5;
  v18 = a8;
  if (!v15)
  {
    [*(a1 + 56) setAdjustments:0];
    goto LABEL_41;
  }

  v19 = objc_alloc_init(MEMORY[0x1E6994A70]);
  [v19 setAdjustmentType:v16];
  [v19 setAdjustmentCompoundVersion:v17];
  [v19 setAdjustmentTimestamp:v18];
  [v19 setAdjustmentSourceType:a6 == 1];
  v20 = [*(a1 + 32) editorBundleID];
  [v19 setAdjustmentCreatorCode:v20];

  v55 = a3;
  if (a3)
  {
    v54 = a7;
    if (*(a1 + 64) == 1)
    {
      [*(a1 + 32) _removeAdjustmentDataResources];
    }

    v21 = [*(a1 + 32) pathForAdjustmentDataFile];
    v57 = 0;
    v22 = [(__CFString *)v21 stringByDeletingLastPathComponent];
    v23 = MEMORY[0x1E69BF238];
    v24 = [MEMORY[0x1E696AC08] defaultManager];
    LODWORD(v23) = [v23 createDirectoryAtPath:v22 error:&v57 usingFileManager:v24];

    v25 = v57;
    v26 = v25;
    if (v23)
    {
      v56 = v25;
      v27 = [v15 writeToFile:v21 options:1 error:&v56];
      v53 = v56;

      if (v27)
      {
        v28 = [*(a1 + 32) scopedIdentifier];
        v29 = *(a1 + 32);
        v30 = [*MEMORY[0x1E6982D60] identifier];
        v31 = objc_opt_class();
        v32 = v29;
        v33 = v28;
        v34 = [(PLManagedAsset *)v32 _createCPLResourceFromResourcePath:v21 withResourceType:13 uniformTypeIdentifier:v30 scopedIdentifier:v28 recordClass:v31 fingerprintScheme:*(a1 + 40)];

        if (v34)
        {
          v35 = [*(a1 + 32) storedResourceForCPLResource:v34 asset:*(a1 + 32) adjusted:1];
          [*(a1 + 48) addObject:v34];
          v36 = v33;
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v37 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT))
            {
              *buf = 138412290;
              v59 = v34;
              v38 = "Recreated the CPLResourceTypeAdjustmentData: %@";
              v39 = v37;
              v40 = OS_LOG_TYPE_DEFAULT;
LABEL_23:
              _os_log_impl(&dword_19BF1F000, v39, v40, v38, buf, 0xCu);
              goto LABEL_24;
            }

            goto LABEL_24;
          }
        }

        else
        {
          v36 = v33;
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v37 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              v59 = v36;
              v38 = "Unable to create CPL resource for adjustment data for asset %@";
              v39 = v37;
              v40 = OS_LOG_TYPE_ERROR;
              goto LABEL_23;
            }

LABEL_24:
          }
        }

        v26 = v53;
        goto LABEL_26;
      }

      if (*MEMORY[0x1E6994D48])
      {
        v26 = v53;
        goto LABEL_27;
      }

      v34 = __CPLAssetsdOSLogDomain();
      v26 = v53;
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_26;
      }

      *buf = 138412802;
      v59 = v15;
      v60 = 2112;
      v61 = v21;
      v62 = 2112;
      v63 = v53;
      v41 = "Failed to save adjustment data %@ to %@. Error: %@";
      v42 = v34;
      v43 = 32;
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_27:

        a7 = v54;
        goto LABEL_28;
      }

      v34 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
      {
LABEL_26:

        goto LABEL_27;
      }

      *buf = 138412546;
      v59 = v21;
      v60 = 2112;
      v61 = v26;
      v41 = "Failed to create intermediate directory for %@. Error: %@";
      v42 = v34;
      v43 = 22;
    }

    _os_log_impl(&dword_19BF1F000, v42, OS_LOG_TYPE_ERROR, v41, buf, v43);
    goto LABEL_26;
  }

  [v19 setSimpleAdjustmentData:v15];
LABEL_28:
  v44 = [*(a1 + 32) additionalAttributes];
  v45 = [v44 unmanagedAdjustment];
  v46 = [v45 otherAdjustmentsFingerprint];

  if (!v46)
  {
    v46 = [*(a1 + 32) _calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources];
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v47 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_DEFAULT))
      {
        v48 = @"NO";
        if (v55)
        {
          v48 = @"YES";
        }

        *buf = 138412546;
        v59 = v46;
        v60 = 2112;
        v61 = v48;
        _os_log_impl(&dword_19BF1F000, v47, OS_LOG_TYPE_DEFAULT, "Calculating cloud adjustment fingerprint at push time: %@  (large? %@)", buf, 0x16u);
      }
    }

    v49 = [*(a1 + 32) additionalAttributes];
    v50 = [v49 unmanagedAdjustment];
    [v50 setOtherAdjustmentsFingerprint:v46];
  }

  [v19 setOtherAdjustmentsFingerprint:v46];
  [v19 setAdjustmentRenderTypes:a7];
  [*(a1 + 56) setAdjustments:v19];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v51 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_DEFAULT))
    {
      v52 = [v19 adjustmentSimpleDescription];
      *buf = 138412290;
      v59 = v52;
      _os_log_impl(&dword_19BF1F000, v51, OS_LOG_TYPE_DEFAULT, "CPLAdjustments: %@", buf, 0xCu);
    }
  }

LABEL_41:
}

void __104__PLManagedAsset_CPL___applyResourceChangeToCPLAsset_forChangeType_shouldGenerateDerivatives_inLibrary___block_invoke_258(uint64_t a1, void *a2, uint64_t a3, void *a4, void *a5, uint64_t a6, unsigned int a7, void *a8)
{
  v20 = a2;
  v14 = a4;
  v15 = MEMORY[0x1E6994A70];
  v16 = a8;
  v17 = a5;
  v18 = objc_alloc_init(v15);
  if (v20)
  {
    [v18 setSimpleAdjustmentData:v20];
  }

  [v18 setAdjustmentType:v14];
  [v18 setAdjustmentCompoundVersion:v17];

  [v18 setAdjustmentSourceType:a6 == 1];
  v19 = [*(a1 + 32) editorBundleID];
  [v18 setAdjustmentCreatorCode:v19];

  [v18 setAdjustmentRenderTypes:a7];
  [v18 setAdjustmentTimestamp:v16];

  [*(a1 + 40) setAdjustments:v18];
}

- (id)_calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources
{
  v5 = 0;
  v6 = &v5;
  v7 = 0x3032000000;
  v8 = __Block_byref_object_copy__51017;
  v9 = __Block_byref_object_dispose__51018;
  v10 = 0;
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __93__PLManagedAsset_CPL___calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources__block_invoke;
  v4[3] = &unk_1E756D740;
  v4[4] = self;
  v4[5] = &v5;
  [(PLManagedAsset *)self synchronouslyFetchAdjustmentBlobWithCompletionHandler:v4];
  v2 = v6[5];
  _Block_object_dispose(&v5, 8);

  return v2;
}

void __93__PLManagedAsset_CPL___calculateCloudAdjustmentFingerprintFromAdjustmentPListAndCPLResources__block_invoke(uint64_t a1, void *a2, int a3, void *a4, void *a5, uint64_t a6)
{
  v11 = a2;
  v12 = a4;
  v13 = a5;
  if (v11)
  {
    v14 = [*(a1 + 32) assetResourceForCPLType:15];
    v15 = [*(a1 + 32) assetResourceForCPLType:13];
    v16 = [v14 fingerprint];
    v17 = [v15 fingerprint];
    if (!a3 || v15)
    {
      v28 = objc_opt_class();
      v29 = a6;
      v19 = a3 == 0;
      if (a3)
      {
        v20 = 0;
      }

      else
      {
        v20 = v11;
      }

      v21 = v12;
      if (v19)
      {
        v22 = 0;
      }

      else
      {
        v22 = v17;
      }

      [*(a1 + 32) editorBundleID];
      v23 = v30 = v14;
      v24 = v22;
      v12 = v21;
      v25 = [v28 _cloudAdjustmentFingerprintWithAdjustmentDataBlob:v20 largeAdjustmentBlobFingerpint:v24 formatIdentifier:v21 formatVersion:v13 editorBundleID:v23 baseVersion:v29 baseImageData:0 baseImageFingerprint:v16];
      v26 = *(*(a1 + 40) + 8);
      v27 = *(v26 + 40);
      *(v26 + 40) = v25;

      v14 = v30;
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v18 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Attempting to calculate adjustment fingerprint from cloud resources which are missing", buf, 2u);
      }
    }
  }
}

- (void)synchronouslyFetchAdjustmentBlobWithCompletionHandler:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self hasAdjustments];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __77__PLManagedAsset_CPL__synchronouslyFetchAdjustmentBlobWithCompletionHandler___block_invoke;
  v7[3] = &unk_1E756D718;
  v9 = v5;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  [(PLManagedAsset *)self synchronouslyFetchAdjustmentDataWithCompletionHandler:v7];
}

void __77__PLManagedAsset_CPL__synchronouslyFetchAdjustmentBlobWithCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4, uint64_t a5, void *a6, unsigned int a7, void *a8, void *a9)
{
  v39 = *MEMORY[0x1E69E9840];
  v13 = a2;
  v14 = a3;
  v15 = a8;
  v16 = a9;
  v17 = MEMORY[0x1E695DEF0];
  v18 = a6;
  v19 = [[v17 alloc] initWithContentsOfFile:v18];

  if (v19)
  {
    if ((*(a1 + 48) & 1) == 0)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v20 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
        {
          v21 = *(a1 + 32);
          *buf = 138412290;
          v38 = v21;
          _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_ERROR, "Asset %@ has adjustment data but no adjustment.", buf, 0xCu);
        }
      }

      [*(a1 + 32) _debugPrintAdjustmentState];
    }

    v22 = [MEMORY[0x1E696AE40] propertyListWithData:v19 options:0 format:0 error:0];
    v23 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF370]];
    if (v23)
    {
      if (v13)
      {
        goto LABEL_10;
      }
    }

    else
    {
      v31 = [*(a1 + 32) assetResourceForCPLType:13];
      v32 = v31;
      if (v31)
      {
        v23 = [v31 fileURL];

        if (v23)
        {
          v33 = objc_alloc(MEMORY[0x1E695DEF0]);
          v34 = [v32 fileURL];
          v23 = [v33 initWithContentsOfURL:v34];
        }
      }

      else
      {
        v23 = 0;
      }

      if (v13)
      {
LABEL_10:
        if (v14)
        {
          goto LABEL_11;
        }

        goto LABEL_33;
      }
    }

    v13 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF380]];
    if (v14)
    {
LABEL_11:
      if (v15)
      {
LABEL_12:
        v24 = [v23 length];
        v25 = v24 > [MEMORY[0x1E6994B60] maxInlineDataSize];

        goto LABEL_24;
      }

LABEL_34:
      v15 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF398]];
      goto LABEL_12;
    }

LABEL_33:
    v14 = [v22 objectForKeyedSubscript:*MEMORY[0x1E69BF388]];
    if (v15)
    {
      goto LABEL_12;
    }

    goto LABEL_34;
  }

  v26 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v27 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_DEBUG, "AdjustmentsData path does not exist", buf, 2u);
    }
  }

  if (*(a1 + 48) == 1)
  {
    if ((*v26 & 1) == 0)
    {
      v28 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = *(a1 + 32);
        *buf = 138412290;
        v38 = v29;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Asset %@ has adjustment but no adjustmentsData.", buf, 0xCu);
      }
    }

    [*(a1 + 32) _debugPrintAdjustmentState];
  }

  v25 = 0;
  v23 = 0;
LABEL_24:
  v30 = *(a1 + 40);
  if (v30)
  {
    (*(v30 + 16))(v30, v23, v25, v13, v14, a5, a7, v15, v16);
  }
}

- (id)createResourcesForAssetInPhotoLibrary:(id)a3 shouldGenerateDerivatives:(BOOL)a4
{
  v129 = a4;
  v153 = *MEMORY[0x1E69E9840];
  v135 = a3;
  v136 = [MEMORY[0x1E695DF70] arrayWithCapacity:5];
  v5 = [(PLManagedAsset *)self hasAdjustments];
  v134 = [(PLManagedAsset *)self scopedIdentifier];
  v6 = [MEMORY[0x1E696AC08] defaultManager];
  if (v5)
  {
    v7 = [(PLManagedAsset *)self fingerprintScheme];
    v8 = v7;
    if (v7)
    {
      v9 = v7;
    }

    else
    {
      v9 = [MEMORY[0x1E6994AE0] invalidFingerprintScheme];
    }

    v12 = v9;

    v13 = [(PLManagedAsset *)self managedObjectContext];
    v14 = [v13 pathManager];
    v142 = 0;
    v125 = [v14 photoDirectoryWithType:14 leafType:2 createIfNeeded:1 error:&v142];
    v132 = v142;

    if (v132 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        *&buf[4] = v132;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Unable to create directory for asset: %@", buf, 0xCu);
      }
    }

    v133 = [(PLManagedAsset *)self pathForAdjustmentSecondaryDataFile];
    if ([v6 fileExistsAtPath:v133])
    {
      v16 = [*MEMORY[0x1E6982D60] identifier];
      v17 = objc_opt_class();
      v18 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v133 withResourceType:14 uniformTypeIdentifier:v16 scopedIdentifier:v134 recordClass:v17 fingerprintScheme:v12];

      if (v18)
      {
        [v136 addObject:v18];
      }
    }

    v130 = [(PLManagedAsset *)self uniformTypeIdentifier];
    v19 = [(PLManagedAsset *)self penultimateImageResource];
    v131 = v19;
    if (v19)
    {
      v20 = [v19 uniformTypeIdentifier];
      v126 = [v20 identifier];
    }

    else
    {
      v126 = v130;
    }

    if ([(PLManagedAsset *)self isPhoto])
    {
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x3032000000;
      v150 = __Block_byref_object_copy__51017;
      v151 = __Block_byref_object_dispose__51018;
      v152 = 0;
      v127 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
      v21 = [(PLManagedAsset *)self isPartOfBurst];
      if (v127)
      {
        v22 = v21;
      }

      else
      {
        v22 = 0;
      }

      if (v22 && ([v6 fileExistsAtPath:?] & 1) == 0)
      {
        v47 = MEMORY[0x1E696AEC0];
        v48 = [(PLManagedAsset *)v134 identifier];
        v49 = [v48 stringByReplacingOccurrencesOfString:@"/" withString:@"_"];
        v50 = [v47 stringWithFormat:@"%@_render.JPG", v49];
        v51 = [v125 stringByAppendingPathComponent:v50];

        v23 = 1;
        v127 = v51;
      }

      else
      {
        v23 = 0;
      }

      v141[0] = MEMORY[0x1E69E9820];
      v141[1] = 3221225472;
      v141[2] = __87__PLManagedAsset_CPL__createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives___block_invoke;
      v141[3] = &unk_1E756D6D0;
      v141[4] = buf;
      [(PLManagedAsset *)self synchronouslyGenerateFullsizeRenderImageIfNecessaryAtPath:v127 withCompletionHandler:v141];
      if (!*(*&buf[8] + 40) || ![v6 fileExistsAtPath:?])
      {
        if (*MEMORY[0x1E6994D48])
        {
LABEL_85:
          v78 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderImageFile];
          if ([v6 fileExistsAtPath:v78])
          {
            v79 = objc_opt_class();
            v80 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v78 withResourceType:15 uniformTypeIdentifier:v126 scopedIdentifier:v134 recordClass:v79 fingerprintScheme:v12];
            if (v80)
            {
              [v136 addObject:v80];
            }
          }

          if ([(PLManagedAsset *)self isPhotoIris])
          {
            v81 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
            if ([v6 fileExistsAtPath:v81])
            {
              v82 = [v81 pathExtension];
              v83 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:v82 conformingToType:*MEMORY[0x1E6982EE8]];
              v84 = v83;
              v85 = *MEMORY[0x1E6982F80];
              if (v83)
              {
                v85 = v83;
              }

              v86 = v85;

              v87 = [v86 identifier];
              v88 = objc_opt_class();
              v89 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v81 withResourceType:19 uniformTypeIdentifier:v87 scopedIdentifier:v134 recordClass:v88 fingerprintScheme:v12];

              if (v89)
              {
                [v136 addObject:v89];
              }

              if (v129)
              {
                v90 = [MEMORY[0x1E695DFF8] fileURLWithPath:v81 isDirectory:0];
                v91 = [(PLManagedAsset *)self _generateVideoResourcesFromURL:v90 withScopedIdentifier:v134 forMaster:0];

                [v136 addObjectsFromArray:v91];
              }
            }

            v92 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
            if ([v6 fileExistsAtPath:v92])
            {
              v93 = [v92 pathExtension];
              v94 = [MEMORY[0x1E69C08F0] typeWithFilenameExtension:v93 conformingToType:*MEMORY[0x1E6982EE8]];
              v95 = v94;
              v96 = *MEMORY[0x1E6982F80];
              if (v94)
              {
                v96 = v94;
              }

              v97 = v96;

              v98 = [v97 identifier];
              v99 = objc_opt_class();
              v100 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v92 withResourceType:20 uniformTypeIdentifier:v98 scopedIdentifier:v134 recordClass:v99 fingerprintScheme:v12];

              if (v100)
              {
                [v136 addObject:v100];
              }
            }
          }

          _Block_object_dispose(buf, 8);
          goto LABEL_140;
        }

        v55 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v55, OS_LOG_TYPE_ERROR))
        {
          v67 = *(*&buf[8] + 40);
          *v143 = 138412546;
          v144 = v67;
          v145 = 2112;
          v146 = self;
          _os_log_impl(&dword_19BF1F000, v55, OS_LOG_TYPE_ERROR, "Unable to find a full size render image at %@ to generate asset resources for asset %@", v143, 0x16u);
        }

LABEL_84:

        goto LABEL_85;
      }

      v52 = *(*&buf[8] + 40);
      v53 = objc_opt_class();
      v54 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v52 withResourceType:2 uniformTypeIdentifier:v130 scopedIdentifier:v134 recordClass:v53 fingerprintScheme:v12];
      v55 = v54;
      if (!v54)
      {
LABEL_82:
        if (v129)
        {
          v77 = [(PLManagedAsset *)self _createJPEGResourcesFromFullSizePath:*(*&buf[8] + 40) withScopedIdentifier:v134 forMaster:0 fingerprintScheme:v12];
          [v136 addObjectsFromArray:v77];
        }

        goto LABEL_84;
      }

      [v54 setDeleteAfterUpload:v23];
      [v136 addObject:v55];
      v56 = [MEMORY[0x1E695DFF8] fileURLWithPath:*(*&buf[8] + 40)];
      v57 = [(PLManagedAsset *)self imageMediaMetadataForURL:v56];

      if (!v57)
      {
LABEL_81:

        goto LABEL_82;
      }

      v58 = [(PLManagedAsset *)v57 length];
      if (v58 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
      {
LABEL_80:
        v75 = [(PLManagedAsset *)self additionalAttributes];
        [v75 setMediaMetadataData:v57];

        v76 = [(PLManagedAsset *)self additionalAttributes];
        [v76 setMediaMetadataType:@"CGImageProperties"];

        goto LABEL_81;
      }

      v59 = [(PLManagedAsset *)self pathForAdjustedMediaMetadataFile];
      v140 = 0;
      v60 = _PLEnsureIntermediateDirectoriesExistForFilePath(v59, &v140);
      v61 = v140;
      v62 = v61;
      if (!v60)
      {
        if (*MEMORY[0x1E6994D48])
        {
          v66 = 0;
          v124 = v61;
          goto LABEL_79;
        }

        v68 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
        {
          *v143 = 138412546;
          v144 = v59;
          v145 = 2112;
          v146 = v62;
          _os_log_impl(&dword_19BF1F000, v68, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", v143, 0x16u);
        }

        v124 = v62;
        goto LABEL_77;
      }

      v139 = v61;
      v63 = [(PLManagedAsset *)v57 writeToFile:v59 options:1 error:&v139];
      v124 = v139;

      if (v63)
      {
        v64 = [*MEMORY[0x1E6982D60] identifier];
        v65 = objc_opt_class();
        v66 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v59 withResourceType:27 uniformTypeIdentifier:v64 scopedIdentifier:v134 recordClass:v65 fingerprintScheme:v12];

        if (v66)
        {
          [v66 setDeleteAfterUpload:1];
          [v136 addObject:v66];
LABEL_79:

          goto LABEL_80;
        }

        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v68 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
          {
            *v143 = 138412290;
            v144 = v134;
            v69 = "Unable to create CPL resource for image properties data for asset %@";
            v70 = v68;
            v71 = 12;
            goto LABEL_76;
          }

          goto LABEL_77;
        }
      }

      else if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v68 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v68, OS_LOG_TYPE_ERROR))
        {
          *v143 = 138412802;
          v144 = v57;
          v145 = 2112;
          v146 = v59;
          v147 = 2112;
          v148 = v124;
          v69 = "Failed to save image properties data %@ to %@. Error: %@";
          v70 = v68;
          v71 = 32;
LABEL_76:
          _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_ERROR, v69, v143, v71);
        }

LABEL_77:
      }

      v66 = 0;
      goto LABEL_79;
    }

    if (![(PLManagedAsset *)self isVideo])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v45 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
          v46 = [(PLManagedAsset *)self kind];
          *buf = 67109120;
          *&buf[4] = v46;
          _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEFAULT, "Unsupported asset type %d", buf, 8u);
        }
      }

      goto LABEL_140;
    }

    v123 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
    if ([v6 fileExistsAtPath:v123])
    {
      v24 = [*MEMORY[0x1E6982E58] identifier];
      v25 = [MEMORY[0x1E695DFF8] fileURLWithPath:v123];
      v26 = CGImageSourceCreateWithURL(v25, 0);

      if (v26)
      {
        v27 = CGImageSourceGetType(v26);

        CFRelease(v26);
        v24 = v27;
      }

      v28 = objc_opt_class();
      v29 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v123 withResourceType:2 uniformTypeIdentifier:v24 scopedIdentifier:v134 recordClass:v28 fingerprintScheme:v12];
      if (v29)
      {
        [v136 addObject:v29];
      }
    }

    v128 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
    v30 = [v6 fileExistsAtPath:v128];
    v31 = v30;
    if (!v30)
    {
LABEL_115:
      v103 = [(PLManagedAsset *)self pathForPenultimateFullsizeRenderVideoFile];
      if ([v6 fileExistsAtPath:v103])
      {
        v104 = objc_opt_class();
        v105 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v103 withResourceType:25 uniformTypeIdentifier:v130 scopedIdentifier:v134 recordClass:v104 fingerprintScheme:v12];
        if (v105)
        {
          [v136 addObject:v105];
        }
      }

      if (v31)
      {
        [MEMORY[0x1E695DFF8] fileURLWithPath:v128 isDirectory:0];
      }

      else
      {
        [(PLManagedAsset *)self mainFileURL];
      }
      v106 = ;
      v107 = v106;
      if (!v106)
      {
        goto LABEL_139;
      }

      v108 = [v106 path];
      v109 = [v6 fileExistsAtPath:v108];

      if (!v109)
      {
        goto LABEL_139;
      }

      if (v129)
      {
        v110 = [(PLManagedAsset *)self _generatePosterFrameResourcesFromVideoURL:v107 withScopedIdentifier:v134 forMaster:0 fingerprintScheme:v12];
        [v136 addObjectsFromArray:v110];
        v111 = [(PLManagedAsset *)self _generateVideoResourcesFromURL:v107 withScopedIdentifier:v134 forMaster:0];
        [v136 addObjectsFromArray:v111];
      }

      else
      {
        if (![(PLManagedAsset *)self isDefaultAdjustedSlomo])
        {
LABEL_139:

LABEL_140:
          goto LABEL_141;
        }

        v112 = [v107 path];
        v113 = objc_opt_class();
        v110 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v112 withResourceType:1000 uniformTypeIdentifier:v130 scopedIdentifier:v134 recordClass:v113 fingerprintScheme:v12];

        if (v110)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v114 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v114, OS_LOG_TYPE_DEFAULT))
            {
              *buf = 138412290;
              *&buf[4] = v110;
              _os_log_impl(&dword_19BF1F000, v114, OS_LOG_TYPE_DEFAULT, "Adding adjustment original resource %@", buf, 0xCu);
            }
          }

          [v136 addObject:v110];
        }

        else
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v115 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v115, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              *&buf[4] = self;
              _os_log_impl(&dword_19BF1F000, v115, OS_LOG_TYPE_ERROR, "Failed to create adjustment original resource for %@", buf, 0xCu);
            }
          }

          v110 = 0;
        }
      }

      goto LABEL_139;
    }

    v32 = objc_opt_class();
    v33 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v128 withResourceType:16 uniformTypeIdentifier:v130 scopedIdentifier:v134 recordClass:v32 fingerprintScheme:v12];
    if (!v33)
    {
LABEL_114:

      goto LABEL_115;
    }

    [v136 addObject:v33];
    v34 = MEMORY[0x1E6988168];
    v35 = [MEMORY[0x1E695DFF8] fileURLWithPath:v128];
    v122 = [v34 URLAssetWithURL:v35 options:0];

    if (!v122)
    {
LABEL_113:

      goto LABEL_114;
    }

    context = objc_autoreleasePoolPush();
    v120 = [v122 propertyListForProxy];
    v121 = [MEMORY[0x1E696AE40] dataWithPropertyList:v120 format:200 options:0 error:0];
    v36 = [v121 length];
    if (v36 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
LABEL_112:
      v101 = [(PLManagedAsset *)self additionalAttributes];
      [v101 setMediaMetadataData:v121];

      v102 = [(PLManagedAsset *)self additionalAttributes];
      [v102 setMediaMetadataType:@"AVAssetProxy"];

      objc_autoreleasePoolPop(context);
      goto LABEL_113;
    }

    v37 = [(PLManagedAsset *)self pathForAdjustedMediaMetadataFile];
    v138 = 0;
    v38 = _PLEnsureIntermediateDirectoriesExistForFilePath(v37, &v138);
    v39 = v138;
    v40 = v39;
    if (!v38)
    {
      if (*MEMORY[0x1E6994D48])
      {
        v118 = v39;
        goto LABEL_111;
      }

      v44 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        *&buf[4] = v37;
        *&buf[12] = 2112;
        *&buf[14] = v40;
        _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", buf, 0x16u);
      }

      v118 = v40;
      goto LABEL_110;
    }

    v137 = v39;
    v41 = [v121 writeToFile:v37 options:1 error:&v137];
    v118 = v137;

    if (v41)
    {
      v42 = [*MEMORY[0x1E6982D60] identifier];
      v43 = objc_opt_class();
      v44 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v37 withResourceType:27 uniformTypeIdentifier:v42 scopedIdentifier:v134 recordClass:v43 fingerprintScheme:v12];

      if (v44)
      {
        [v44 setDeleteAfterUpload:1];
        [v136 addObject:v44];
LABEL_110:

        goto LABEL_111;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v44 = __CPLAssetsdOSLogDomain();
        if (!os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_110;
        }

        *buf = 138412290;
        *&buf[4] = v134;
        v72 = "Unable to create CPL resource for video properties data for asset %@";
        v73 = v44;
        v74 = 12;
        goto LABEL_109;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v44 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_110;
      }

      *buf = 138412802;
      *&buf[4] = v121;
      *&buf[12] = 2112;
      *&buf[14] = v37;
      *&buf[22] = 2112;
      v150 = v118;
      v72 = "Failed to save video properties data %@ to %@. Error: %@";
      v73 = v44;
      v74 = 32;
LABEL_109:
      _os_log_impl(&dword_19BF1F000, v73, OS_LOG_TYPE_ERROR, v72, buf, v74);
      goto LABEL_110;
    }

LABEL_111:

    goto LABEL_112;
  }

  v10 = [(PLManagedAsset *)self additionalAttributes];
  [v10 setMediaMetadataType:0];

  v11 = [(PLManagedAsset *)self additionalAttributes];
  [v11 setMediaMetadata:0];

  if (*MEMORY[0x1E6994D48])
  {
    goto LABEL_142;
  }

  v12 = __CPLAssetsdOSLogDomain();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
  {
    *buf = 138412290;
    *&buf[4] = self;
    _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Clear out resources for %@", buf, 0xCu);
  }

LABEL_141:

LABEL_142:
  if (createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_onceToken != -1)
  {
    dispatch_once(&createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_onceToken, &__block_literal_global_216);
  }

  v116 = [v136 filteredArrayUsingPredicate:createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_filterPredicate];
  [(PLManagedAsset *)self rm_createAssetResourcesForCPLResources:v116 inLibrary:v135];

  return v136;
}

void __87__PLManagedAsset_CPL__createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives___block_invoke_214()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithBlock:&__block_literal_global_219_51210];
  v1 = createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_filterPredicate;
  createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives__s_filterPredicate = v0;
}

BOOL __87__PLManagedAsset_CPL__createResourcesForAssetInPhotoLibrary_shouldGenerateDerivatives___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = [a2 resourceType];

  return [PLResourceInstaller isValidCPLResourceTypeForPersistence:v2];
}

- (id)imageMediaMetadataForURL:(id)a3
{
  v21 = *MEMORY[0x1E69E9840];
  v4 = a3;
  objc_opt_class();
  v5 = [(PLManagedAsset *)self managedObjectContext];
  if (objc_opt_isKindOfClass())
  {
    v6 = v5;
  }

  else
  {
    v6 = 0;
  }

  v7 = v6;

  v8 = MEMORY[0x1E69C08F0];
  v9 = [(PLManagedAsset *)self uniformTypeIdentifier];
  v10 = [v8 typeWithIdentifier:v9];

  v11 = objc_alloc(MEMORY[0x1E69C0718]);
  v12 = [v7 pl_libraryBundle];
  v13 = [v12 timeZoneLookup];
  v14 = [v11 initWithImageURL:v4 contentType:v10 options:13 timeZoneLookup:v13 cacheImageSource:1 cacheImageData:0];

  v15 = [v14 imageSourceProxyData];
  if (!v15 && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v16 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      v17 = [(NSManagedObject *)self pl_shortDescription];
      v19 = 138412290;
      v20 = v17;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Failed to get image source proxy data for asset %@", &v19, 0xCu);
    }
  }

  return v15;
}

- (BOOL)shouldIncludeInCPLCounts
{
  [MEMORY[0x1E69BF328] maskForIncludeInCPLCounts];
  [(PLManagedAsset *)self savedAssetType];

  return PLValidatedSavedAssetTypeApplies();
}

- (id)bestAvailableAdjustedResource
{
  v19 = *MEMORY[0x1E69E9840];
  if (bestAvailableAdjustedResource_onceToken != -1)
  {
    dispatch_once(&bestAvailableAdjustedResource_onceToken, &__block_literal_global_148);
  }

  if ([(PLManagedAsset *)self isPhoto])
  {
    v3 = [(PLManagedAsset *)self isLoopingVideo];
    v4 = &bestAvailableAdjustedResource_photoResourceTypePriority;
    if (v3)
    {
      v4 = &bestAvailableAdjustedResource_loopingPhotoResourceTypePriority;
    }
  }

  else
  {
    if (![(PLManagedAsset *)self isVideo])
    {
LABEL_19:
      v6 = 0;
      v12 = 0;
      goto LABEL_22;
    }

    v4 = &bestAvailableAdjustedResource_videoResourceTypePriority;
  }

  v5 = *v4;
  if (!v5)
  {
    goto LABEL_19;
  }

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v6 = v5;
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = -[PLManagedAsset assetResourceForCPLType:](self, "assetResourceForCPLType:", [*(*(&v14 + 1) + 8 * i) intValue]);
        if (v11)
        {
          v12 = v11;
          goto LABEL_21;
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  v12 = 0;
LABEL_21:

LABEL_22:

  return v12;
}

void __52__PLManagedAsset_CPL__bestAvailableAdjustedResource__block_invoke()
{
  v0 = bestAvailableAdjustedResource_photoResourceTypePriority;
  bestAvailableAdjustedResource_photoResourceTypePriority = &unk_1F0FBFBF8;

  v1 = bestAvailableAdjustedResource_loopingPhotoResourceTypePriority;
  bestAvailableAdjustedResource_loopingPhotoResourceTypePriority = &unk_1F0FBFC10;

  v2 = [MEMORY[0x1E69C0700] currentDeviceIsEligibleForHDRPlayback];
  v3 = &unk_1F0FBFC40;
  v4 = bestAvailableAdjustedResource_videoResourceTypePriority;
  if (v2)
  {
    v3 = &unk_1F0FBFC28;
  }

  bestAvailableAdjustedResource_videoResourceTypePriority = v3;
}

- (void)invalidateThumbnailIfNeededAfterMasterResourceChangeInLibrary:(id)a3
{
  v16 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (![(PLManagedAsset *)self hasAdjustments])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v5 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
      {
        v6 = [(PLManagedAsset *)self uuid];
        v7 = [(PLManagedAsset *)self cloudAssetGUID];
        v12 = 138412546;
        v13 = v6;
        v14 = 2112;
        v15 = v7;
        _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "Detecting a master resource change on an unadjusted asset, invalidate the thumbnail for this asset with uuid: %@ guid: %@", &v12, 0x16u);
      }
    }

    v8 = [v4 thumbnailManager];
    v9 = [(PLManagedAsset *)self thumbnailIdentifier];
    v10 = [(PLManagedAsset *)self effectiveThumbnailIndex];
    v11 = [(PLManagedAsset *)self uuid];
    [v8 deleteThumbnailsWithIdentifier:v9 orIndex:v10 uuid:v11];

    [(PLManagedAsset *)self setEffectiveThumbnailIndex:0x7FFFFFFFFFFFFFFFLL];
  }
}

- (void)_applySharingChangeToCPLAssetChange:(id)a3 inLibrary:(id)a4
{
  v28 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = [(PLManagedAsset *)self libraryScopeShareState];
  if ((v6 & 0x800000) != 0 && [(PLManagedAsset *)self hasLibraryScope])
  {
    v7 = [(PLManagedAsset *)self libraryScope];
    v8 = [v7 scopeIdentifier];
    [v5 setSharingScopeIdentifier:v8];

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        v10 = [(PLManagedAsset *)self libraryScope];
        v11 = [v10 scopeIdentifier];
        v24 = 138543618;
        v25 = v11;
        v26 = 2114;
        v27 = v5;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Setting libraryScopeIdentifier %{public}@ on CPLAssetChange %{public}@", &v24, 0x16u);
      }
    }
  }

  else
  {
    [v5 setSharingScopeIdentifier:0];
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v12 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
      {
        v24 = 138543362;
        v25 = v5;
        _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "Setting nil libraryScopeIdentifier on CPLAssetChange %{public}@", &v24, 0xCu);
      }
    }

    if ((v6 & 0x800000) == 0)
    {
      goto LABEL_14;
    }
  }

  v13 = [(PLManagedAsset *)self libraryScopeContributors];
  v14 = [v13 count];

  if (v14)
  {
    v15 = [(PLManagedAsset *)self libraryScopeContributors];
    v16 = [v15 _pl_map:&__block_literal_global_131_51227];
    v17 = [v16 allObjects];
    [v5 setSharingContributorUserIdentifiers:v17];

    goto LABEL_15;
  }

LABEL_14:
  [v5 setSharingContributorUserIdentifiers:0];
LABEL_15:
  v18 = [(PLManagedAsset *)self additionalAttributes];
  v19 = [v18 libraryScopeAssetContributorsToUpdate];
  v20 = [v19 count];

  if (v20)
  {
    v21 = [(PLManagedAsset *)self additionalAttributes];
    v22 = [v21 libraryScopeAssetContributorsToUpdate];
    v23 = [v22 allObjects];
    [v5 setUpdateSharingContributorUserIdentifiers:v23];
  }
}

- (void)_applyPropertiesChangeToCPLAssetChange:(id)a3 withMasterScopedIdentifier:(id)a4 computeSyncUploadEnabled:(BOOL)a5 inLibrary:(id)a6
{
  v7 = a5;
  v79 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a6;
  v12 = [a4 identifier];
  [v10 setMasterIdentifier:v12];

  [v10 setFavorite:{-[PLManagedAsset isFavorite](self, "isFavorite")}];
  [(PLManagedAsset *)self _updateBurstFlagsForCPLAssetChange:v10 photoLibrary:v11];
  v13 = [(PLManagedAsset *)self lastSharedDate];
  [v10 setLastSharedDate:v13];

  v14 = [(PLManagedAsset *)self addedDate];
  [v10 setAddedDate:v14];

  v15 = [(PLManagedAsset *)self dateCreated];

  if (!v15)
  {
    v16 = [MEMORY[0x1E695DF00] date];
    [(PLManagedAsset *)self setDateCreated:v16];
  }

  v17 = [(PLManagedAsset *)self dateCreated];
  [v10 setAssetDate:v17];

  v18 = [(PLManagedAsset *)self additionalAttributes];
  v19 = [v18 timeZoneName];
  if (v19)
  {
    [v10 setTimeZoneName:v19];
  }

  v20 = [v18 timeZoneOffset];
  if (v20)
  {
    [v10 setTimeZoneOffset:v20];
  }

  v21 = [(PLManagedAsset *)self location];
  [v10 setLocation:v21];

  v22 = objc_opt_class();
  v23 = [v18 placeAnnotationData];
  v24 = [v22 _placeAnnotationFromAnnotationData:v23];

  [v10 setPlaceAnnotation:v24];
  v25 = [PLKeywordManager keywordsForAsset:self];
  v26 = [v25 allObjects];
  v27 = [v26 sortedArrayWithOptions:1 usingComparator:&__block_literal_global_51230];
  v65 = v26;
  [v10 setKeywords:v26];
  [v10 setHidden:{-[PLManagedAsset hidden](self, "hidden")}];
  v28 = [(PLManagedAsset *)self title];
  [v10 setCaption:v28];

  v29 = [(PLManagedAsset *)self longDescription];
  [v10 setExtendedDescription:v29];

  v30 = [(PLManagedAsset *)self accessibilityDescription];
  [v10 setAccessibilityDescription:v30];

  [(PLManagedAsset *)self _updateAssetSubtypeForCPLAssetChange:v10];
  [v10 setAssetHDRType:{+[PLManagedAsset CPLAssetHDRTypeFromPLAssetHDRType:](PLManagedAsset, "CPLAssetHDRTypeFromPLAssetHDRType:", -[PLManagedAsset hdrType](self, "hdrType"))}];
  if ([(PLManagedAsset *)self isPhoto])
  {
    [v10 setCustomRenderedValue:{-[PLManagedAsset hdrType](self, "hdrType")}];
  }

  v31 = [(PLManagedAsset *)self trashedState];
  v72 = v11;
  v71 = v7;
  v68 = v20;
  v69 = v19;
  v66 = v25;
  v67 = v24;
  v32 = v31 == 2 || [(PLManagedAsset *)self trashedState]== 1;
  [v10 setInTrash:v32];
  [v10 setInExpunged:v31 == 2];
  v33 = [(PLManagedAsset *)self trashedDate];
  [v10 setDateDeleted:v33];

  v73 = v10;
  [v10 setTrashedReason:{-[PLManagedAsset trashedReason](self, "trashedReason")}];
  v70 = v18;
  v34 = [v18 personReferences];
  v35 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(v34, "count")}];
  v74 = 0u;
  v75 = 0u;
  v76 = 0u;
  v77 = 0u;
  v36 = v34;
  v37 = [v36 countByEnumeratingWithState:&v74 objects:v78 count:16];
  if (v37)
  {
    v38 = v37;
    v39 = *v75;
    do
    {
      for (i = 0; i != v38; ++i)
      {
        if (*v75 != v39)
        {
          objc_enumerationMutation(v36);
        }

        v41 = *(*(&v74 + 1) + 8 * i);
        v42 = objc_alloc_init(MEMORY[0x1E6994B40]);
        v43 = [v41 personUUID];
        [v42 setPersonIdentifier:v43];

        v44 = [v41 personData];
        if (v44)
        {
          v45 = [MEMORY[0x1E696AE40] propertyListWithData:v44 options:0 format:0 error:0];
          [v42 setExtraProperties:v45];
        }

        [v35 addObject:v42];
      }

      v38 = [v36 countByEnumeratingWithState:&v74 objects:v78 count:16];
    }

    while (v38);
  }

  [v73 setPeople:v35];
  [v73 setPlayCount:{objc_msgSend(v70, "playCount")}];
  [v73 setShareCount:{objc_msgSend(v70, "shareCount")}];
  [v73 setViewCount:{objc_msgSend(v70, "viewCount")}];
  if ([MEMORY[0x1E6994A80] serverSupportsLastViewedDate])
  {
    v46 = [v70 lastViewedDate];
    [v73 setLastViewedDate:v46];
  }

  v47 = [(PLManagedAsset *)self mediaGroupUUID];
  [v73 setMediaGroupIdentifier:v47];
  [(PLManagedAsset *)self photoIrisVideoDuration];
  [(PLManagedAsset *)self photoIrisStillDisplayTime];
  [v73 setVideoComplementDurationValue:0];
  [v73 setVideoComplementDurationTimescale:0];
  [v73 setVideoComplementImageDisplayValue:0];
  [v73 setVideoComplementImageDisplayTimescale:0];
  [v73 setVideoComplementVisibilityState:{-[PLManagedAsset videoCpVisibilityState](self, "videoCpVisibilityState")}];
  v48 = [v70 syndicationIdentifier];
  [v73 setSyndicationIdentifier:v48];

  v49 = [(PLManagedAsset *)self collectionShare];
  if (v49)
  {
    v50 = v49;
    v51 = [(PLManagedAsset *)self collectionShareContributor];

    if (v51)
    {
      v52 = [(PLManagedAsset *)self collectionShareContributor];
      v53 = [v52 userIdentifier];
      [v73 setContributorUserIdentifier:v53];
    }
  }

  [(PLManagedAsset *)self _updateViewPresentationForCPLAssetChange:v73];
  if ((_os_feature_enabled_impl() & 1) == 0)
  {
    [v73 setSharedLibrarySharingState:{PLLibraryScopeAssetGetSyncableSharingStateValueFromLocalShareStateValue(-[PLManagedAsset libraryScopeShareState](self, "libraryScopeShareState"))}];
    if ([MEMORY[0x1E6994A80] serverSupportsDeletedByUserIdentifier])
    {
      v54 = [(PLManagedAsset *)self trashedByParticipant];
      v55 = [v54 userIdentifier];

      if (v55)
      {
        v56 = [(PLManagedAsset *)self trashedByParticipant];
        v57 = [v56 userIdentifier];
        [v73 setDeletedByUserIdentifier:v57];
      }
    }
  }

  if (v71)
  {
    v58 = [(PLManagedAsset *)self computeSyncAttributes];

    if (v58)
    {
      v59 = [(PLManagedAsset *)self computeSyncAttributes];
      v60 = [v59 cloudComputeStateVersion];
      [v73 setComputeStateVersion:v60];

      v61 = [(PLManagedAsset *)self computeSyncAttributes];
      v62 = [v61 cloudComputeStateAdjustmentFingerprint];
      [v73 setComputeStateAdjustmentFingerprint:v62];

      v63 = [(PLManagedAsset *)self computeSyncAttributes];
      v64 = [v63 cloudComputeStateLastUpdatedDate];
      [v73 setComputeStateLastUpdatedDate:v64];
    }
  }
}

- (id)fingerprintScheme
{
  v2 = [(PLManagedAsset *)self master];
  v3 = [v2 fingerprintScheme];

  return v3;
}

- (id)fingerprintContext
{
  v2 = [(PLManagedObject *)self photoLibrary];
  v3 = [v2 fingerprintContext];
  v4 = v3;
  if (v3)
  {
    v5 = v3;
  }

  else
  {
    v5 = [MEMORY[0x1E6994AD8] sharedContext];
  }

  v6 = v5;

  return v6;
}

- (id)scopedIdentifier
{
  v2 = self;
  v18 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self cloudAssetGUID];
  if (v3)
  {
    goto LABEL_4;
  }

  v4 = [(PLManagedAsset *)v2 uuid];
  if (v4)
  {
    v3 = v4;
    [(PLManagedAsset *)v2 setCloudAssetGUID:v4];
LABEL_4:
    v5 = [(PLManagedAsset *)v2 scopeIdentifier];
    v2 = [objc_alloc(MEMORY[0x1E6994BB8]) initWithScopeIdentifier:v5 identifier:v3];

    goto LABEL_5;
  }

  if (v2)
  {
    v7 = MEMORY[0x1E696AEC0];
    v8 = [(PLManagedAsset *)v2 objectID];
    v9 = [(PLManagedAsset *)v2 isDeleted];
    v10 = @"NO";
    if (v9)
    {
      v10 = @"YES";
    }

    v11 = v10;
    v12 = [(PLManagedAsset *)v2 syncDescription];
    v13 = [MEMORY[0x1E696AF00] callStackSymbols];
    v14 = [v7 stringWithFormat:@"Found asset with nil scope identifier %@ (isDeleted=%@) %@.\n\nSee rdar://problem/40112514\n\nBacktrace:\n%@", v8, v11, v12, v13];

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138543362;
        v17 = v14;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "%{public}@", buf, 0xCu);
      }
    }

    [PLDiagnostics fileRadarUserNotificationWithHeader:@"Unexpected Photo Library state" message:@"Please file a Radar against Photos" radarTitle:@"TTR: asset with nil scope identifier" radarDescription:v14];

    v2 = 0;
  }

LABEL_5:

  return v2;
}

- (id)scopeIdentifier
{
  v3 = [(PLManagedAsset *)self shareRelationship];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 scopeIdentifier];
  }

  else
  {
    v6 = [(PLManagedObject *)self photoLibrary];
    v5 = [v6 mainScopeIdentifier];
  }

  return v5;
}

- (id)cplMasterChangeInLibrary:(id)a3 shouldGenerateDerivatives:(BOOL)a4
{
  v4 = a4;
  v47 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v8 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      v44 = self;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEBUG, "CPLMasterChange for %@", buf, 0xCu);
    }
  }

  v9 = [(PLManagedAsset *)self master];
  if (v9 || ([(PLManagedAsset *)self createMasterIfNecessaryInLibrary:v6], [(PLManagedAsset *)self master], (v9 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v10 = v9;
    v40 = v4;
    v11 = [(PLManagedAsset *)self masterResourceForCPLType:1];
    v41 = [(PLManagedAsset *)self masterResourceForCPLType:18];
    v12 = [(PLManagedAsset *)self masterResourceForCPLType:5];
    v13 = [(PLManagedAsset *)self masterResourceForCPLType:17];
    v14 = [(PLManagedAsset *)self masterResourceForCPLType:23];
    v15 = [(PLManagedAsset *)self masterResourceForCPLType:24];
    v16 = v14 && ![v14 cloudLocalState] || v15 && !objc_msgSend(v15, "cloudLocalState");
    v42 = v13;
    if (!v11)
    {
      if (*v7)
      {
        v31 = 0;
        goto LABEL_57;
      }

      v19 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        [(PLManagedAsset *)self uuid];
        v20 = v12;
        v22 = v21 = v6;
        *buf = 138412546;
        v44 = v10;
        v45 = 2112;
        v46 = v22;
        _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Can't find original resource in master %@ for asset %@", buf, 0x16u);

        v6 = v21;
        v12 = v20;
      }

      goto LABEL_55;
    }

    v17 = [v11 isLocallyAvailable];
    v39 = v12;
    if (v12)
    {
      v18 = [v12 cloudLocalState] == 0;
    }

    else
    {
      v18 = 1;
    }

    v23 = v17 & v18;
    if (!-[PLManagedAsset isPhotoIris](self, "isPhotoIris") || v41 && [v41 cloudLocalState] || (objc_msgSend(MEMORY[0x1E696AC08], "defaultManager"), v24 = objc_claimAutoreleasedReturnValue(), -[PLManagedAsset pathForVideoComplementFile](self, "pathForVideoComplementFile"), v38 = v6, v25 = objc_claimAutoreleasedReturnValue(), v26 = objc_msgSend(v24, "fileExistsAtPath:", v25), v25, v6 = v38, v24, !v26))
    {
      if (!v42 || [v42 cloudLocalState] || !objc_msgSend(v42, "isLocallyAvailable"))
      {
LABEL_35:
        if (v23)
        {
          v19 = [(PLManagedAsset *)self createResourcesForMaster:v10 shouldGenerateDerivatives:v40 inPhotoLibrary:v6];
          v12 = v39;
          if ([v19 count])
          {
            v31 = [(PLManagedAsset *)v10 cplMasterPropertyChangeForAsset:self];
            [(PLManagedAsset *)v31 setResources:v19];
            v7 = MEMORY[0x1E6994D48];
LABEL_56:

LABEL_57:
            goto LABEL_58;
          }

          v7 = MEMORY[0x1E6994D48];
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v35 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              v44 = 0;
              _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_ERROR, "Unable to generate any resources for masterChange %@. Skipping upload", buf, 0xCu);
            }
          }

LABEL_55:
          v31 = 0;
          goto LABEL_56;
        }

        v31 = [(PLManagedAsset *)v10 cplMasterPropertyChangeForAsset:self];
        v19 = [(PLManagedAsset *)self rm_cplMasterResourcesFromCloudMaster:v10 addOriginalResourceMode:v16];
        [(PLManagedAsset *)v31 setResources:v19];
        v32 = [(PLManagedAsset *)self isPlaceholderAsset];
        v7 = MEMORY[0x1E6994D48];
        v12 = v39;
        if (v32)
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_56;
          }

          v33 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412546;
            v44 = v31;
            v45 = 2112;
            v46 = v10;
            v34 = "Created CPLMaster %@ from placeholder master %@ for server side copy";
LABEL_49:
            _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_DEFAULT, v34, buf, 0x16u);
          }
        }

        else
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_56;
          }

          v33 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412546;
            v44 = v31;
            v45 = 2112;
            v46 = v10;
            v34 = "Created optimistic CPLMaster %@ from %@, assuming reset sync";
            goto LABEL_49;
          }
        }

        goto LABEL_56;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v27 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
        {
          [(PLManagedAsset *)self uuid];
          v30 = v29 = v6;
          *buf = 138412290;
          v44 = v30;
          _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_DEFAULT, "Asset %@ now has original alternate resource, will include it now", buf, 0xCu);

          v6 = v29;
        }

        goto LABEL_33;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v27 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v27, OS_LOG_TYPE_DEFAULT))
      {
        v28 = [(PLManagedAsset *)self uuid];
        *buf = 138412290;
        v44 = v28;
        _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_DEFAULT, "Asset %@ now has video complement resource, will include it now", buf, 0xCu);

        v6 = v38;
      }

LABEL_33:
    }

    v16 = 1;
    goto LABEL_35;
  }

  if (*v7)
  {
    v31 = 0;
    v10 = 0;
    goto LABEL_62;
  }

  v11 = __CPLAssetsdOSLogDomain();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
  {
    *buf = 138412290;
    v44 = self;
    _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "Asset %@ doesn't have a master.", buf, 0xCu);
  }

  v10 = 0;
  v31 = 0;
LABEL_58:

  if ((*v7 & 1) == 0)
  {
    v36 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v36, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      v44 = v31;
      _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_DEBUG, "CPLMasterChange %@", buf, 0xCu);
    }
  }

LABEL_62:

  return v31;
}

- (id)createResourcesForMaster:(id)a3 shouldGenerateDerivatives:(BOOL)a4 inPhotoLibrary:(id)a5
{
  v6 = a4;
  v184 = *MEMORY[0x1E69E9840];
  v140 = a3;
  v138 = a5;
  v141 = [MEMORY[0x1E695DF70] arrayWithCapacity:5];
  v139 = [(PLManagedAsset *)self rm_cplMasterResourceForResourceType:1];
  if (!v139)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        *&buf[4] = v140;
        _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_ERROR, "Unable to find original resource from master %@", buf, 0xCu);
      }
    }

    goto LABEL_168;
  }

  [v141 addObject:v139];
  v7 = self;
  if (![(PLManagedAsset *)self isPhoto])
  {
    if (![(PLManagedAsset *)self isVideo])
    {
      goto LABEL_167;
    }

    v151 = v140;
    log = v141;
    if (!self)
    {
LABEL_165:

      goto LABEL_166;
    }

    v150 = [(PLManagedAsset *)self mainFileURL];
    obj = [MEMORY[0x1E696AC08] defaultManager];
    v146 = [v151 scopedIdentifier];
    v158 = [v151 fingerprintScheme];
    if (v150)
    {
      v22 = [v150 path];
      v23 = [obj fileExistsAtPath:v22];

      if (v23)
      {
        if (v6)
        {
          v24 = [(PLManagedAsset *)self _generatePosterFrameResourcesFromVideoURL:v150 withScopedIdentifier:v146 forMaster:1 fingerprintScheme:v158];
          [log addObjectsFromArray:v24];
          if (![(PLManagedAsset *)self isDefaultAdjustedSlomo])
          {
            v25 = [(PLManagedAsset *)self _generateVideoResourcesFromURL:v150 withScopedIdentifier:v146 forMaster:1];
            [log addObjectsFromArray:v25];
          }
        }
      }
    }

    [(PLManagedAsset *)self allMasterCPLResources];
    v175 = 0u;
    v176 = 0u;
    v26 = memset(v174, 0, sizeof(v174));
    v27 = [v26 countByEnumeratingWithState:v174 objects:buf count:16];
    if (v27)
    {
      v28 = **&v174[16];
      do
      {
        for (i = 0; i != v27; ++i)
        {
          if (**&v174[16] != v28)
          {
            objc_enumerationMutation(v26);
          }

          v30 = *(*&v174[8] + 8 * i);
          v31 = [v30 cplType];
          if ((v31 & 0xFFFFFFFFFFFFFFFELL) == 0x16)
          {
            v32 = objc_opt_class();
            v33 = [v30 fileURL];
            *&v164 = 0;
            LOBYTE(v32) = [(PLManagedAsset *)self setFingerprintAndStableHashOnInternalResource:v30 recordClass:v32 resourceType:v31 resourceFileURL:v33 fingerprintScheme:v158 error:&v164];
            v34 = v164;

            if ((v32 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v35 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
              {
                v36 = [v30 fileURL];
                v37 = [v36 path];
                v38 = [(PLManagedAsset *)self scopedIdentifier];
                *v177 = 138412802;
                *&v177[4] = v37;
                *&v177[12] = 2112;
                *&v177[14] = v38;
                *&v177[22] = 2112;
                *&v177[24] = v34;
                _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_ERROR, "Failed to generate fingerprint for path %@ uuid %@. Error: %@", v177, 0x20u);
              }
            }

            v39 = [v30 cplResourceIncludeFile:1];
            if (v39)
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v40 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v40, OS_LOG_TYPE_DEBUG))
                {
                  *v177 = 138412290;
                  *&v177[4] = v39;
                  _os_log_impl(&dword_19BF1F000, v40, OS_LOG_TYPE_DEBUG, "Created original adjustment master resource %@", v177, 0xCu);
                }
              }

              [log addObject:v39];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v41 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
              {
                v42 = [(PLManagedAsset *)self scopedIdentifier];
                *v177 = 138412290;
                *&v177[4] = v42;
                _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_ERROR, "Unable to create original adjustment CPLResource with itemIdentifier %@", v177, 0xCu);
              }
            }
          }
        }

        v27 = [v26 countByEnumeratingWithState:v174 objects:buf count:16];
      }

      while (v27);
    }

    v43 = [MEMORY[0x1E6988168] URLAssetWithURL:v150 options:0];
    if (!v43)
    {
LABEL_164:

      goto LABEL_165;
    }

    v44 = objc_autoreleasePoolPush();
    v45 = [v43 propertyListForProxy];
    v46 = [MEMORY[0x1E696AE40] dataWithPropertyList:v45 format:200 options:0 error:0];
    v47 = [v46 length];
    if (v47 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
LABEL_163:
      v130 = [v151 mediaMetadata];
      [v130 setValue:v46 forKey:@"data"];

      [v151 setMediaMetadataType:@"AVAssetProxy"];
      objc_autoreleasePoolPop(v44);
      goto LABEL_164;
    }

    v48 = [(PLManagedAsset *)self pathForMediaMetadataFile];
    v169[0] = 0;
    v49 = [v48 stringByDeletingLastPathComponent];
    v50 = MEMORY[0x1E69BF238];
    v51 = [MEMORY[0x1E696AC08] defaultManager];
    LODWORD(v50) = [v50 createDirectoryAtPath:v49 error:v169 usingFileManager:v51];

    v52 = v169[0];
    v53 = v52;
    if (!v50)
    {
      if (*MEMORY[0x1E6994D48])
      {
        v55 = v52;
        goto LABEL_162;
      }

      v58 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        *v177 = 138412546;
        *&v177[4] = v48;
        *&v177[12] = 2112;
        *&v177[14] = v53;
        _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", v177, 0x16u);
      }

      v55 = v53;
      goto LABEL_161;
    }

    v173 = v52;
    v54 = [v46 writeToFile:v48 options:1 error:&v173];
    v55 = v173;

    if (v54)
    {
      v56 = [*MEMORY[0x1E6982D60] identifier];
      v57 = objc_opt_class();
      v58 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v48 withResourceType:10 uniformTypeIdentifier:v56 scopedIdentifier:v146 recordClass:v57 fingerprintScheme:v158];

      if (v58)
      {
        [v58 setDeleteAfterUpload:1];
        [log addObject:v58];
LABEL_161:

        goto LABEL_162;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v58 = __CPLAssetsdOSLogDomain();
        if (!os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
        {
          goto LABEL_161;
        }

        *v177 = 138412290;
        *&v177[4] = v146;
        v126 = "Unable to create CPL resource for video properties data for asset %@";
        v127 = v58;
        v128 = 12;
        goto LABEL_160;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v58 = __CPLAssetsdOSLogDomain();
      if (!os_log_type_enabled(v58, OS_LOG_TYPE_ERROR))
      {
        goto LABEL_161;
      }

      *v177 = 138412802;
      *&v177[4] = v46;
      *&v177[12] = 2112;
      *&v177[14] = v48;
      *&v177[22] = 2112;
      *&v177[24] = v55;
      v126 = "Failed to save video properties data %@ to %@. Error: %@";
      v127 = v58;
      v128 = 32;
LABEL_160:
      _os_log_impl(&dword_19BF1F000, v127, OS_LOG_TYPE_ERROR, v126, v177, v128);
      goto LABEL_161;
    }

LABEL_162:

    goto LABEL_163;
  }

  v143 = v140;
  v136 = v139;
  v145 = v141;
  v132 = v138;
  if (!self)
  {
    goto LABEL_156;
  }

  v133 = [v143 scopedIdentifier];
  v135 = [(PLManagedAsset *)self mainFileURL];
  v137 = [v136 identity];
  v8 = [v137 fileUTI];
  [v137 imageDimensions];
  [v143 setFullSizeJPEGSource:{+[PLCloudMaster fullSizeJPEGSourceForUTI:andImageDimensions:](PLCloudMaster, "fullSizeJPEGSourceForUTI:andImageDimensions:", v8)}];

  v149 = [v143 fingerprintScheme];
  v134 = [MEMORY[0x1E696AC08] defaultManager];
  if (!v6)
  {
    goto LABEL_82;
  }

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x3032000000;
  v181 = __Block_byref_object_copy__51017;
  v182 = __Block_byref_object_dispose__51018;
  v183 = 0;
  v9 = [v135 path];
  v10 = [MEMORY[0x1E695DF70] arrayWithArray:&unk_1F0FBFBC8];
  v11 = dispatch_semaphore_create(0);
  v12 = MEMORY[0x1E6994D60];
  v13 = MEMORY[0x1E695DFF8];
  v14 = NSTemporaryDirectory();
  v15 = [v13 fileURLWithPath:v14];
  v169[0] = MEMORY[0x1E69E9820];
  v169[1] = 3221225472;
  v169[2] = __136__PLManagedAsset_CPL___createPhotoResourcesForMaster_withOriginalResource_intoMasterResources_shouldGenerateDerivatives_inPhotoLibrary___block_invoke;
  v169[3] = &unk_1E756D660;
  v170 = v136;
  v172 = buf;
  v16 = v11;
  v171 = v16;
  [v12 generateFullSizeJPEGIfNecessaryFromInputResource:v170 destinationDirectory:v15 fingerprintScheme:v149 completionHandler:v169];

  dispatch_semaphore_wait(v16, 0xFFFFFFFFFFFFFFFFLL);
  v17 = *(*&buf[8] + 40);
  if (v17)
  {
    v18 = [v17 resourceType];
    v19 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v18];
    [v10 removeObject:v19];

    if (v18 == 4)
    {
      v20 = &unk_1F0FBCBC8;
    }

    else
    {
      if (v18 != 5)
      {
LABEL_54:
        v59 = [(PLManagedAsset *)self pathForCPLResourceType:v18 adjusted:0, v132];
        if (([v134 fileExistsAtPath:v59] & 1) == 0)
        {
          loga = [v59 stringByDeletingLastPathComponent];
          if (([v134 fileExistsAtPath:loga] & 1) == 0)
          {
            v173 = 0;
            v60 = [MEMORY[0x1E69BF238] createDirectoryAtPath:loga error:&v173 usingFileManager:v134];
            v61 = v173;
            if ((v60 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v62 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v62, OS_LOG_TYPE_ERROR))
              {
                *v174 = 138412546;
                *&v174[4] = v59;
                *&v174[12] = 2112;
                *&v174[14] = v61;
                _os_log_impl(&dword_19BF1F000, v62, OS_LOG_TYPE_ERROR, "Unable to create parent directory of fullsize derivative %@.Error: %@", v174, 0x16u);
              }
            }
          }

          v63 = [*(*&buf[8] + 40) identity];
          v159 = [v63 fileURL];

          v64 = [v132 pathManager];
          v65 = [v64 capabilities];

          v66 = MEMORY[0x1E69BF238];
          v67 = [MEMORY[0x1E695DFF8] fileURLWithPath:v59 isDirectory:0];
          v168 = 0;
          v68 = [v66 secureMoveItemAtURL:v159 toURL:v67 capabilities:v65 error:&v168];
          v69 = v168;

          if ((v68 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v70 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v70, OS_LOG_TYPE_ERROR))
            {
              *v174 = 138412802;
              *&v174[4] = v159;
              *&v174[12] = 2112;
              *&v174[14] = v59;
              *&v174[22] = 2112;
              *&v174[24] = v69;
              _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_ERROR, "Failed to secure move fullsize derivative from %@ to %@.Error: %@", v174, 0x20u);
            }
          }
        }

        if ([v134 fileExistsAtPath:v59])
        {
          v71 = [*MEMORY[0x1E6982E58] identifier];
          v72 = objc_opt_class();
          v73 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v59 withResourceType:v18 uniformTypeIdentifier:v71 scopedIdentifier:v133 recordClass:v72 fingerprintScheme:v149];

          if (v73)
          {
            [v73 setDeleteAfterUpload:1];
            [v145 addObject:v73];
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v74 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v74, OS_LOG_TYPE_ERROR))
            {
              *v174 = 138412290;
              *&v174[4] = v59;
              _os_log_impl(&dword_19BF1F000, v74, OS_LOG_TYPE_ERROR, "Unable to create CPL resource from %@", v174, 0xCu);
            }
          }
        }

        goto LABEL_81;
      }

      [v10 removeObject:&unk_1F0FBCBC8];
      v20 = &unk_1F0FBCBE0;
    }

    [v10 removeObject:{v20, v132}];
    goto LABEL_54;
  }

  v59 = v9;
LABEL_81:
  v75 = [(PLManagedAsset *)self _createJPEGResourcesFromFullSizePath:v59 withScopedIdentifier:v133 forMaster:1 forResourceTypes:v10 fingerprintScheme:v149, v132];
  [v145 addObjectsFromArray:v75];

  _Block_object_dispose(buf, 8);
LABEL_82:
  obja = [(PLManagedAsset *)self allMasterCPLResources];
  v166 = 0u;
  v167 = 0u;
  v164 = 0u;
  v165 = 0u;
  v153 = [obja countByEnumeratingWithState:&v164 objects:v174 count:16];
  if (!v153)
  {
    goto LABEL_128;
  }

  v142 = !v6;
  v152 = *v165;
  do
  {
    v160 = 0;
    do
    {
      if (*v165 != v152)
      {
        objc_enumerationMutation(obja);
      }

      v76 = *(*(&v164 + 1) + 8 * v160);
      v77 = [v76 cplType];
      v78 = v77;
      if (v77 <= 0x18)
      {
        if (((1 << v77) & 0x1860104) != 0 || v77 == 22 && ([v76 uniformTypeIdentifier], v100 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v100, "identifier"), v101 = objc_claimAutoreleasedReturnValue(), objc_msgSend(MEMORY[0x1E69C08F0], "supplementalResourceAAEType"), v102 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v102, "identifier"), v103 = objc_claimAutoreleasedReturnValue(), v104 = objc_msgSend(v101, "isEqualToString:", v103), v103, v102, v101, v100, v104))
        {
          v79 = objc_opt_class();
          v80 = [v76 cplFileURL];
          v163 = 0;
          v81 = [(PLManagedAsset *)self setFingerprintAndStableHashOnInternalResource:v76 recordClass:v79 resourceType:v78 resourceFileURL:v80 fingerprintScheme:v149 error:&v163];
          v154 = v163;

          if (v81)
          {
            goto LABEL_95;
          }

          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v82 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_ERROR))
            {
              v83 = [v76 fileURL];
              v84 = [v83 path];
              v85 = [(PLManagedAsset *)self scopedIdentifier];
              *buf = 138412802;
              *&buf[4] = v84;
              *&buf[12] = 2112;
              *&buf[14] = v85;
              *&buf[22] = 2112;
              v181 = v154;
              _os_log_impl(&dword_19BF1F000, v82, OS_LOG_TYPE_ERROR, "Failed to generate fingerprint for path %@ uuid %@. Error: %@", buf, 0x20u);
            }
          }

          if ([v76 isCPLOriginalResourceAssetHasAdjustments:0])
          {
LABEL_95:
            logb = [v76 cplResourceIncludeFile:1];
            if (logb)
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v86 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v86, OS_LOG_TYPE_DEBUG))
                {
                  *buf = 138412290;
                  *&buf[4] = logb;
                  _os_log_impl(&dword_19BF1F000, v86, OS_LOG_TYPE_DEBUG, "Created master resource %@", buf, 0xCu);
                }
              }

              [v76 setRemoteAvailability:1];
              [v145 addObject:logb];
              if ([v76 cplType] == 18 && ((PLIsEDUMode() | v142) & 1) == 0)
              {
                v144 = v143;
                v87 = [MEMORY[0x1E695DF70] array];
                v88 = [(PLManagedAsset *)self photoIrisSidecarIgnoringSubtype:0];
                v89 = [v144 scopedIdentifier];
                v90 = [v144 fingerprintScheme];
                v178 = 0u;
                v179 = 0u;
                memset(v177, 0, sizeof(v177));
                v91 = [&unk_1F0FBFBE0 countByEnumeratingWithState:v177 objects:buf count:16];
                if (v91)
                {
                  v92 = **&v177[16];
                  do
                  {
                    for (j = 0; j != v91; ++j)
                    {
                      if (**&v177[16] != v92)
                      {
                        objc_enumerationMutation(&unk_1F0FBFBE0);
                      }

                      v94 = [*(*&v177[8] + 8 * j) unsignedIntegerValue];
                      v95 = [v88 fileURL];
                      v96 = [(PLManagedAsset *)self _createVideoResourceFromVideoURL:v95 withResourceType:v94 scopedIdentifier:v89 applyVideoAdjustments:0 forMaster:1 forPhotoIris:1 fingerprintScheme:v90];

                      if (v96)
                      {
                        [v87 addObject:v96];
                      }
                    }

                    v91 = [&unk_1F0FBFBE0 countByEnumeratingWithState:v177 objects:buf count:16];
                  }

                  while (v91);
                }

                [v145 addObjectsFromArray:v87];
                goto LABEL_115;
              }

              goto LABEL_119;
            }

            if (*MEMORY[0x1E6994D48])
            {
            }

            else
            {
              v87 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v87, OS_LOG_TYPE_ERROR))
              {
                v97 = [(PLManagedAsset *)self scopedIdentifier];
                *buf = 138412546;
                *&buf[4] = v76;
                *&buf[12] = 2112;
                *&buf[14] = v97;
                _os_log_impl(&dword_19BF1F000, v87, OS_LOG_TYPE_ERROR, "Unable to create CPLResource from %@ with itemIdentifier %@", buf, 0x16u);
              }

LABEL_115:

LABEL_119:
            }
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            logb = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(logb, OS_LOG_TYPE_ERROR))
            {
              v98 = [MEMORY[0x1E6994B90] shortDescriptionForResourceType:{objc_msgSend(v76, "cplType")}];
              v99 = [v143 scopedIdentifier];
              *buf = 138543618;
              *&buf[4] = v98;
              *&buf[12] = 2112;
              *&buf[14] = v99;
              _os_log_impl(&dword_19BF1F000, logb, OS_LOG_TYPE_ERROR, "Not adding resource of type: %{public}@ to master change identifier %@", buf, 0x16u);
            }

            goto LABEL_119;
          }
        }
      }

      ++v160;
    }

    while (v160 != v153);
    v105 = [obja countByEnumeratingWithState:&v164 objects:v174 count:16];
    v153 = v105;
  }

  while (v105);
LABEL_128:
  v106 = [(PLManagedAsset *)self imageMediaMetadataForURL:v135];
  v107 = v106;
  if (v106)
  {
    v108 = [v106 length];
    if (v108 > [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
      v109 = MEMORY[0x1E6994D48];
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v110 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v110, OS_LOG_TYPE_DEFAULT))
        {
          v111 = [(NSManagedObject *)self pl_shortDescription];
          *buf = 138412290;
          *&buf[4] = v111;
          _os_log_impl(&dword_19BF1F000, v110, OS_LOG_TYPE_DEFAULT, "Creating overflow image properties resource for asset %@", buf, 0xCu);
        }
      }

      v112 = [(PLManagedAsset *)self pathForMediaMetadataFile];
      *v177 = 0;
      v113 = [v112 stringByDeletingLastPathComponent];
      v114 = MEMORY[0x1E69BF238];
      v115 = [MEMORY[0x1E696AC08] defaultManager];
      LODWORD(v114) = [v114 createDirectoryAtPath:v113 error:v177 usingFileManager:v115];

      v116 = *v177;
      v117 = v116;
      if (v114)
      {
        v162 = v116;
        v118 = [v107 writeToFile:v112 options:1 error:&v162];
        v119 = v162;

        if (v118)
        {
          v120 = [*MEMORY[0x1E6982D60] identifier];
          v121 = objc_opt_class();
          v122 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v112 withResourceType:10 uniformTypeIdentifier:v120 scopedIdentifier:v133 recordClass:v121 fingerprintScheme:v149];

          if (v122)
          {
            [v122 setDeleteAfterUpload:1];
            [v145 addObject:v122];
            goto LABEL_152;
          }

          if ((*v109 & 1) == 0)
          {
            v122 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v122, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              *&buf[4] = v133;
              v123 = "Unable to create CPL resource for image properties data for asset %@";
              v124 = v122;
              v125 = 12;
LABEL_151:
              _os_log_impl(&dword_19BF1F000, v124, OS_LOG_TYPE_ERROR, v123, buf, v125);
            }

            goto LABEL_152;
          }
        }

        else if ((*v109 & 1) == 0)
        {
          v122 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v122, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412802;
            *&buf[4] = v107;
            *&buf[12] = 2112;
            *&buf[14] = v112;
            *&buf[22] = 2112;
            v181 = v119;
            v123 = "Failed to save image properties data %@ to %@. Error: %@";
            v124 = v122;
            v125 = 32;
            goto LABEL_151;
          }

LABEL_152:
        }
      }

      else
      {
        if ((*v109 & 1) == 0)
        {
          v122 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v122, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            *&buf[4] = v112;
            *&buf[12] = 2112;
            *&buf[14] = v117;
            _os_log_impl(&dword_19BF1F000, v122, OS_LOG_TYPE_ERROR, "Failed to create intermediate directory for %@. Error: %@", buf, 0x16u);
          }

          v119 = v117;
          goto LABEL_152;
        }

        v119 = v116;
      }
    }

    v129 = [v143 mediaMetadata];
    [v129 setValue:v107 forKey:@"data"];

    [v143 setMediaMetadataType:@"CGImageProperties"];
  }

LABEL_156:
LABEL_166:
  v7 = self;
LABEL_167:
  [(PLManagedAsset *)v7 rm_createMasterResourcesForCPLResources:v141 master:v140 inLibrary:v138, v132];
LABEL_168:

  return v141;
}

void __136__PLManagedAsset_CPL___createPhotoResourcesForMaster_withOriginalResource_intoMasterResources_shouldGenerateDerivatives_inPhotoLibrary___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v14 = *MEMORY[0x1E69E9840];
  v6 = a2;
  v7 = a3;
  if (v7)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v9 = *(a1 + 32);
        v10 = 138412546;
        v11 = v9;
        v12 = 2112;
        v13 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Failed to generate full size JPEG from %@: %@", &v10, 0x16u);
      }
    }
  }

  else
  {
    objc_storeStrong((*(*(a1 + 48) + 8) + 40), a2);
  }

  dispatch_semaphore_signal(*(a1 + 40));
}

- (BOOL)setFingerprintAndStableHashOnInternalResource:(id)a3 recordClass:(Class)a4 resourceType:(unint64_t)a5 resourceFileURL:(id)a6 fingerprintScheme:(id)a7 error:(id *)a8
{
  v13 = a3;
  v14 = a6;
  v15 = a7;
  v16 = [v13 fingerprint];
  if (!v16 || ![v15 isValidFingerprint:v16])
  {

    v27 = 0;
    v19 = [v15 fingerPrintForFileAtURL:v14 error:&v27];
    v20 = v27;
    v16 = 0;
    v21 = v20;
    if (!v19)
    {
      goto LABEL_15;
    }

    goto LABEL_8;
  }

  if (([v15 isForStableHash] & 1) == 0)
  {
    if ([(objc_class *)a4 requiresStableHashForResourceType:a5])
    {
      v17 = [v13 stableHash];

      if (!v17)
      {
        v16 = v16;
        v20 = 0;
        v19 = v16;
LABEL_8:
        if (([v15 isForStableHash] & 1) != 0 || !-[objc_class requiresStableHashForResourceType:](a4, "requiresStableHashForResourceType:", a5))
        {
          v23 = 0;
          goto LABEL_13;
        }

        v22 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
        v26 = v20;
        v23 = [v22 fingerPrintForFileAtURL:v14 error:&v26];
        v21 = v26;

        if (v23)
        {
          v20 = v21;
LABEL_13:
          [v13 setFingerprint:v19];
          [v13 setStableHash:v23];

          v18 = 1;
          v21 = v20;
LABEL_18:

          goto LABEL_19;
        }

LABEL_15:
        if (a8)
        {
          v24 = v21;
          v18 = 0;
          *a8 = v21;
        }

        else
        {
          v18 = 0;
        }

        goto LABEL_18;
      }
    }
  }

  v18 = 1;
LABEL_19:

  return v18;
}

- (void)setupPropertiesOnNewCloudMaster:(id)a3 withPlaceholderSourceAsset:(id)a4 uniformTypeIdentifier:(id)a5
{
  v23 = a3;
  v8 = a4;
  v9 = a5;
  if (v8)
  {
    v10 = v8;
  }

  else
  {
    v10 = self;
  }

  v11 = v10;
  v12 = [(PLManagedAsset *)v11 dateCreated];
  [v23 setCreationDate:v12];

  v13 = [(PLManagedAsset *)v11 addedDate];
  [v23 setImportDate:v13];

  if (v9)
  {
    [v23 setUniformTypeIdentifier:v9];
  }

  [v23 setOriginalOrientation:{-[PLManagedAsset originalOrientation](v11, "originalOrientation")}];
  v14 = [(PLManagedAsset *)v11 originalFilename];

  if (v14)
  {
    v15 = [(PLManagedAsset *)v11 originalFilename];
    [v23 setOriginalFilename:v15];
  }

  v16 = [(PLManagedAsset *)v11 additionalAttributes];
  v17 = [v16 originatingAssetIdentifier];
  [v23 setOriginatingAssetIdentifier:v17];

  v18 = [(PLManagedAsset *)self additionalAttributes];
  [v23 setImportedBy:{objc_msgSend(v18, "importedBy")}];

  v19 = [(PLManagedAsset *)self additionalAttributes];
  v20 = [v19 importedByBundleIdentifier];
  [v23 setImportedByBundleIdentifier:v20];

  v21 = [(PLManagedAsset *)self additionalAttributes];
  v22 = [v21 importedByDisplayName];
  [v23 setImportedByDisplayName:v22];
}

- (void)setupPropertiesOnExistingMaster:(id)a3
{
  v29 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self managedObjectContext];
  [(PLManagedAsset *)self rm_createNewResourcesIn:v4 inManagedObjectContext:v5];

  [(PLManagedAsset *)self setMaster:v4];
  v6 = [v4 originalFilename];
  if (v6)
  {
    v7 = v6;
    v8 = [(PLManagedAsset *)self originalFilename];
    v9 = [v4 originalFilename];
    v10 = [v8 isEqualToString:v9];

    if ((v10 & 1) == 0)
    {
      v11 = [v4 originalFilename];
      [(PLManagedAsset *)self setOriginalFilename:v11];
    }
  }

  v12 = [(PLManagedAsset *)self importedByBundleIdentifier];
  if (v12)
  {
    v13 = v12;
    v14 = [v4 importedByBundleIdentifier];
    v15 = [(PLManagedAsset *)self importedByBundleIdentifier];
    v16 = [v14 isEqualToString:v15];

    if ((v16 & 1) == 0)
    {
      v17 = [(PLManagedAsset *)self importedByBundleIdentifier];
      [v4 updateImportedByBundleIdentifier:v17];
    }
  }

  v18 = [(PLManagedAsset *)self importedByDisplayName];
  if (v18)
  {
    v19 = v18;
    v20 = [v4 importedByDisplayName];
    v21 = [(PLManagedAsset *)self importedByDisplayName];
    v22 = [v20 isEqualToString:v21];

    if ((v22 & 1) == 0)
    {
      v23 = [(PLManagedAsset *)self importedByDisplayName];
      [v4 updateImportedByDisplayName:v23];
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v24 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_DEFAULT))
    {
      v25 = 138412546;
      v26 = v4;
      v27 = 2112;
      v28 = self;
      _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_DEFAULT, "Found an existing cloud master %@ for %@", &v25, 0x16u);
    }
  }
}

- (void)createMasterIfNecessaryInLibrary:(id)a3
{
  v35 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = [(PLManagedAsset *)self master];
  if (!v6 && ![(PLManagedAsset *)self isTimelapsePlaceholder]&& [(PLManagedAsset *)self complete]&& ![(PLManagedAsset *)self isPhotoIrisPlaceholder]&& ![(PLManagedAsset *)self isPlaceholderAsset])
  {
    v9 = [(PLManagedAsset *)self mainFileURL];
    if ([(PLManagedAsset *)self hasAdjustments])
    {
      [(PLManagedAsset *)self nonDynamicOriginalUTI];
    }

    else
    {
      [(PLManagedAsset *)self uniformTypeIdentifier];
    }
    v10 = ;
    v29 = 0;
    v30 = 0;
    v28 = 0;
    v11 = [(PLManagedAsset *)self _computeNewMasterIdentifierAndStableHash:&v30 fingerprintScheme:v9 forMasterFileURL:&v28 error:?];
    v7 = v28;
    if (v11)
    {
      v12 = v29;
      if (!v29)
      {
        v26 = [MEMORY[0x1E696AAA8] currentHandler];
        [v26 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+CPL.m" lineNumber:261 description:{@"originalStableHash for %@ should have been computed", self}];
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v13 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
        {
          *buf = 138412290;
          v32 = v11;
          _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEBUG, "Master asset finger print %@", buf, 0xCu);
        }
      }

      v27 = v9;
      v14 = v10;
      v15 = [(PLManagedAsset *)self shareRelationship];
      v16 = [(PLManagedAsset *)self managedObjectContext];
      v6 = [PLCloudMaster cloudMasterWithGUID:v11 inShare:v15 prefetchResources:0 inManagedObjectContext:v16];

      if (v6)
      {
        [(PLManagedAsset *)self setupPropertiesOnExistingMaster:v6];
        v9 = v27;
      }

      else
      {
        v18 = [(PLManagedAsset *)self shareRelationship];
        v6 = [PLCloudMaster insertIntoPhotoLibrary:v5 withCloudMasterGUID:v11 inShare:v18];

        [(PLManagedAsset *)self setupPropertiesOnNewCloudMaster:v6 withPlaceholderSourceAsset:0 uniformTypeIdentifier:v10];
        [(PLManagedAsset *)self setMaster:v6];
        v19 = [(PLManagedAsset *)v27 path];
        v20 = [v6 scopedIdentifier];
        v21 = objc_opt_class();
        v22 = [(PLManagedAsset *)self _createCPLResourceFromResourcePath:v19 withResourceType:1 uniformTypeIdentifier:v14 scopedIdentifier:v20 recordClass:v21 fingerprintScheme:v30];

        if (v22)
        {
          v23 = [(PLManagedAsset *)self storedResourceForCPLResource:v22 asset:self adjusted:0];
          v10 = v14;
          v9 = v27;
          if ([(PLManagedAsset *)self shouldSimulateQuarantineOriginalImageResourceOnPush])
          {
            [(PLManagedAsset *)self simulateQuarantineOriginalImageResourceOnPush:v22];
          }
        }

        else
        {
          v10 = v14;
          v9 = v27;
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v24 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              v32 = self;
              _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "CreateMaster: Can't create CPLResource for originalResource for asset %@", buf, 0xCu);
            }
          }

          [(PLManagedAsset *)self setCloudLocalState:2];
        }
      }

      v25 = [(PLManagedAsset *)self additionalAttributes];
      [v25 setOriginalStableHash:v12];
    }

    else
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v17 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412546;
          v32 = v9;
          v33 = 2112;
          v34 = v7;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "CreateMaster: Failed to generate finger print for %@. Error: %@", buf, 0x16u);
        }
      }

      [(PLManagedAsset *)self setCloudLocalState:2];
      v6 = 0;
      v12 = v29;
    }

    goto LABEL_9;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v7 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = [(PLManagedAsset *)self uuid];
      *buf = 138412290;
      v32 = v8;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_DEFAULT, "Skipping creating master for asset: %@", buf, 0xCu);
    }

LABEL_9:
  }
}

- (id)existingCloudMasterNeedsRepush:(BOOL *)a3
{
  v44 = *MEMORY[0x1E69E9840];
  v5 = [(PLManagedAsset *)self master];
  if (v5)
  {
    v6 = v5;
    v7 = 0;
    if (!a3)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v39 = 0;
  v9 = [(PLManagedAsset *)self mainFileURL];
  v37 = 0;
  v38 = 0;
  v10 = [(PLManagedAsset *)self _computeNewMasterIdentifierAndStableHash:&v38 fingerprintScheme:v9 forMasterFileURL:&v37 error:?];
  v11 = v37;
  v12 = v11;
  if (!v10 || v11)
  {
    v6 = 0;
    v7 = 0;
    v27 = v39;
  }

  else
  {
    v13 = [(PLManagedAsset *)self shareRelationship];
    v14 = [(PLManagedAsset *)self managedObjectContext];
    v6 = [PLCloudMaster cloudMasterWithGUID:v10 inShare:v13 prefetchResources:0 inManagedObjectContext:v14];

    if (v6)
    {
      v15 = [(PLManagedAsset *)self managedObjectContext];
      [(PLManagedAsset *)self rm_createNewResourcesIn:v6 inManagedObjectContext:v15];

      [(PLManagedAsset *)self setMaster:v6];
      v16 = [v6 originalFilename];
      if (v16)
      {
        v17 = v16;
        v18 = [(PLManagedAsset *)self originalFilename];
        v19 = [v6 originalFilename];
        v20 = [v18 isEqualToString:v19];

        if ((v20 & 1) == 0)
        {
          v21 = [v6 originalFilename];
          [(PLManagedAsset *)self setOriginalFilename:v21];
        }
      }

      v22 = [(PLManagedAsset *)self importedByBundleIdentifier];
      if (v22 && (v23 = v22, [v6 importedByBundleIdentifier], v24 = objc_claimAutoreleasedReturnValue(), -[PLManagedAsset importedByBundleIdentifier](self, "importedByBundleIdentifier"), v25 = objc_claimAutoreleasedReturnValue(), v26 = objc_msgSend(v24, "isEqualToString:", v25), v25, v24, v23, (v26 & 1) == 0))
      {
        v28 = [(PLManagedAsset *)self importedByBundleIdentifier];
        [v6 updateImportedByBundleIdentifier:v28];

        v7 = 1;
      }

      else
      {
        v7 = 0;
      }

      v29 = [(PLManagedAsset *)self importedByDisplayName];
      if (v29)
      {
        v30 = v29;
        v31 = [v6 importedByDisplayName];
        v32 = [(PLManagedAsset *)self importedByDisplayName];
        v33 = [v31 isEqualToString:v32];

        if ((v33 & 1) == 0)
        {
          v34 = [(PLManagedAsset *)self importedByDisplayName];
          [v6 updateImportedByDisplayName:v34];

          v7 = 1;
        }
      }

      if (*MEMORY[0x1E6994D48])
      {
        v12 = 0;
      }

      else
      {
        v35 = __CPLAssetsdOSLogDomain();
        v12 = 0;
        if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412546;
          v41 = v6;
          v42 = 2112;
          v43 = self;
          _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_DEFAULT, "Found an existing cloud master %@ for %@", buf, 0x16u);
        }
      }
    }

    else
    {
      v7 = 0;
    }

    v36 = [(PLManagedAsset *)self additionalAttributes];
    v27 = v39;
    [v36 setOriginalStableHash:v39];
  }

  if (a3)
  {
LABEL_3:
    *a3 = v7;
  }

LABEL_4:

  return v6;
}

- (void)incrementUploadAttempts
{
  v3 = ([(PLManagedAsset *)self uploadAttempts]+ 1);

  [(PLManagedAsset *)self setUploadAttempts:v3];
}

- (void)setUploadAttempts:(signed __int16)a3
{
  v3 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:v3];
  [v5 setUploadAttempts:v4];
}

- (signed)uploadAttempts
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 uploadAttempts];
  v4 = [v3 shortValue];

  return v4;
}

- (void)setLastUploadAttemptDate:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setLastUploadAttemptDate:v4];
}

- (id)lastUploadAttemptDate
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 lastUploadAttemptDate];

  return v3;
}

- (void)setOriginalResourceChoice:(unint64_t)a3
{
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:a3];
  [v5 setOriginalResourceChoice:v4];
}

- (unint64_t)originalResourceChoice
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 originalResourceChoice];
  v4 = [v3 shortValue];

  return v4;
}

+ (id)_placeAnnotationFromAnnotationData:(id)a3
{
  if (a3)
  {
    v3 = [MEMORY[0x1E696AE40] propertyListWithData:a3 options:0 format:0 error:0];
    if (v3)
    {
      v4 = objc_alloc_init(MEMORY[0x1E6994B48]);
      v5 = [v3 objectForKey:@"level"];
      [v4 setPlaceLevel:v5];

      v6 = [v3 objectForKey:@"name"];
      [v4 setPlaceName:v6];
    }

    else
    {
      v4 = 0;
    }
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

+ (id)_dataFromCPLPlaceAnnotation:(id)a3
{
  v3 = a3;
  if (v3)
  {
    v4 = [MEMORY[0x1E695DF90] dictionary];
    v5 = [v3 placeName];

    if (v5)
    {
      v6 = [v3 placeName];
      [v4 setObject:v6 forKey:@"name"];
    }

    v7 = [v3 placeLevel];

    if (v7)
    {
      v8 = [v3 placeLevel];
      [v4 setObject:v8 forKey:@"level"];
    }

    v9 = [MEMORY[0x1E696AE40] dataWithPropertyList:v4 format:200 options:0 error:0];
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

+ (id)quarantinedAssetsInLibrary:(id)a3
{
  v3 = MEMORY[0x1E695D5E0];
  v4 = a3;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v7 = [PLManagedAsset predicateForUploadableAssetsWithCloudLocalState:4];
  [v6 setPredicate:v7];

  v8 = [v4 managedObjectContext];

  v11 = 0;
  v9 = [v8 executeFetchRequest:v6 error:&v11];

  return v9;
}

+ (id)failedToPushAssetInLibrary:(id)a3
{
  v3 = MEMORY[0x1E695D5E0];
  v4 = a3;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v7 = [PLManagedAsset predicateForUploadableAssetsWithCloudLocalState:2];
  [v6 setPredicate:v7];

  v8 = [v4 managedObjectContext];

  v11 = 0;
  v9 = [v8 executeFetchRequest:v6 error:&v11];

  return v9;
}

+ (id)toUploadAssetsInLibrary:(id)a3
{
  v3 = MEMORY[0x1E695D5E0];
  v4 = a3;
  v5 = +[PLManagedAsset entityName];
  v6 = [v3 fetchRequestWithEntityName:v5];

  v7 = [PLManagedAsset predicateForUploadableAssetsWithMasterCloudLocalStateNotEqualTo:3];
  [v6 setPredicate:v7];

  v8 = [v4 managedObjectContext];

  v11 = 0;
  v9 = [v8 executeFetchRequest:v6 error:&v11];

  return v9;
}

+ (void)resetAssetsCloudStateInLibrary:(id)a3
{
  v33 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = objc_autoreleasePoolPush();
  v5 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v6 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_DEFAULT, "Resetting cloudLocalState of assets", buf, 2u);
    }
  }

  v7 = objc_alloc(MEMORY[0x1E695D560]);
  v8 = +[PLManagedAsset entityName];
  v9 = [v7 initWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(cloudLocalState != %d)", 0];
  [v9 setPredicate:v10];
  [v9 setResultType:2];
  [v9 setPropertiesToUpdate:&unk_1F0FC0758];
  v11 = [v3 managedObjectContext];
  v28 = 0;
  v12 = [v11 executeRequest:v9 error:&v28];
  v13 = v28;

  if (v13)
  {
    if (*v5)
    {
      goto LABEL_13;
    }

    v14 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v32 = v13;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_ERROR, "Failed to batch  assets: %@", buf, 0xCu);
    }
  }

  else
  {
    if (*v5)
    {
      goto LABEL_13;
    }

    v14 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
    {
      v15 = [v12 result];
      *buf = 138412290;
      v32 = v15;
      _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Batch updated %@ assets", buf, 0xCu);
    }
  }

LABEL_13:
  objc_autoreleasePoolPop(v4);
  v16 = objc_autoreleasePoolPush();
  if ((*v5 & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Resetting uploadAttempts of assets", buf, 2u);
    }
  }

  v18 = [objc_alloc(MEMORY[0x1E695D560]) initWithEntityName:@"AdditionalAssetAttributes"];
  v19 = [MEMORY[0x1E696AE18] predicateWithFormat:@"lastUploadAttemptDate != nil OR uploadAttempts > 0"];
  [v18 setPredicate:v19];
  [v18 setResultType:2];
  v29[0] = @"uploadAttempts";
  v29[1] = @"lastUploadAttemptDate";
  v30[0] = &unk_1F0FBCD18;
  v20 = [MEMORY[0x1E695DFB0] null];
  v30[1] = v20;
  v21 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v30 forKeys:v29 count:2];
  [v18 setPropertiesToUpdate:v21];

  v22 = [v3 managedObjectContext];
  v27 = 0;
  v23 = [v22 executeRequest:v18 error:&v27];
  v24 = v27;

  if (v24)
  {
    if ((*v5 & 1) == 0)
    {
      v25 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v32 = v24;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "Failed to batch assets: %@", buf, 0xCu);
      }

LABEL_24:
    }
  }

  else if ((*v5 & 1) == 0)
  {
    v25 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEFAULT))
    {
      v26 = [v23 result];
      *buf = 138412290;
      v32 = v26;
      _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEFAULT, "Batch updated %@ assets", buf, 0xCu);
    }

    goto LABEL_24;
  }

  objc_autoreleasePoolPop(v16);
}

+ (id)assetsToRetryInLibrary:(id)a3 limit:(unint64_t)a4
{
  v41[2] = *MEMORY[0x1E69E9840];
  v35 = a3;
  v33 = [v35 managedObjectContext];
  context = objc_autoreleasePoolPush();
  v4 = MEMORY[0x1E695D5E0];
  v5 = +[PLManagedAsset entityName];
  v6 = [v4 fetchRequestWithEntityName:v5];

  v7 = [MEMORY[0x1E695DF00] date];
  v31 = [v7 dateByAddingTimeInterval:-86400.0];

  v29 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND additionalAttributes.lastUploadAttemptDate != nil AND additionalAttributes.lastUploadAttemptDate < %@ AND additionalAttributes.uploadAttempts > 1", 0, v31];
  v8 = MEMORY[0x1E696AB28];
  v9 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil", @"momentShare"];
  v41[0] = v9;
  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"momentShare.shareURL"];
  v41[1] = v10;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v41 count:2];
  v12 = [v8 orPredicateWithSubpredicates:v11];

  v13 = MEMORY[0x1E696AB28];
  v14 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil", @"collectionShare"];
  v40[0] = v14;
  v15 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"collectionShare.shareURL"];
  v40[1] = v15;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v40 count:2];
  v17 = [v13 orPredicateWithSubpredicates:v16];

  v18 = MEMORY[0x1E696AB28];
  v39[0] = v29;
  v19 = +[PLManagedAsset _syncablePredicate];
  v39[1] = v19;
  v20 = [a1 predicateForSupportedAssetTypesForUpload];
  v39[2] = v20;
  v39[3] = v12;
  v39[4] = v17;
  v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v39 count:5];
  v22 = [v18 andPredicateWithSubpredicates:v21];

  v23 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:0];
  v38[0] = v23;
  v24 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"additionalAttributes.uploadAttempts" ascending:1];
  v38[1] = v24;
  v25 = [MEMORY[0x1E695DEC8] arrayWithObjects:v38 count:2];
  [v6 setSortDescriptors:v25];

  v37 = @"additionalAttributes";
  v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v37 count:1];
  [v6 setRelationshipKeyPathsForPrefetching:v26];

  [v6 setPredicate:v22];
  [v6 setFetchLimit:vcvtpd_u64_f64((a4 >> 1) + 0.5)];
  v36 = 0;
  v27 = [v33 executeFetchRequest:v6 error:&v36];

  objc_autoreleasePoolPop(context);

  return v27;
}

+ (id)_notPushedAssetsToUploadInitiallyInManagedObjectContext:(id)a3 withSavedAssetTypePredicate:(id)a4 shouldSort:(BOOL)a5 limit:(unint64_t)a6
{
  v6 = a5;
  v30[4] = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  context = objc_autoreleasePoolPush();
  v11 = MEMORY[0x1E695D5E0];
  v12 = +[PLManagedAsset entityName];
  v13 = [v11 fetchRequestWithEntityName:v12];

  v14 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND additionalAttributes.uploadAttempts <= 1", 0];
  v15 = [a1 _predicateForTrashedAssetsToExcludeInInitialUpload];
  v16 = MEMORY[0x1E696AB28];
  v30[0] = v10;
  v30[1] = v14;
  v17 = +[PLManagedAsset _syncablePredicate];
  v30[2] = v17;
  v30[3] = v15;
  v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:4];
  v19 = [v16 andPredicateWithSubpredicates:v18];

  if (v6)
  {
    v20 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:0];
    v29 = v20;
    v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v29 count:1];
    [v13 setSortDescriptors:v21];
  }

  v28 = @"additionalAttributes";
  v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v28 count:1];
  [v13 setRelationshipKeyPathsForPrefetching:v22];

  [v13 setPredicate:v19];
  [v13 setFetchLimit:vcvtpd_u64_f64((a6 >> 1) + 0.5)];
  v27 = 0;
  v23 = [v9 executeFetchRequest:v13 error:&v27];

  objc_autoreleasePoolPop(context);

  return v23;
}

+ (id)assetsToUploadInitiallyInManagedObjectContext:(id)a3 limit:(unint64_t)a4
{
  v45[2] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = [a1 predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  v8 = [a1 _notPushedAssetsToUploadInitiallyInManagedObjectContext:v6 withSavedAssetTypePredicate:v7 shouldSort:1 limit:a4];
  if (![v8 count])
  {
    v37 = v7;
    v38 = a4;
    v9 = MEMORY[0x1E696AB28];
    v31 = MEMORY[0x1E696AB28];
    v35 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForMomentSharedAsset"), 1}];
    v44[0] = v35;
    v33 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"momentShare.shareURL"];
    v44[1] = v33;
    v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v44 count:2];
    v11 = [v9 andPredicateWithSubpredicates:v10];
    v45[0] = v11;
    v39 = v6;
    v12 = MEMORY[0x1E696AB28];
    v13 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForCollectionShareAsset"), 1}];
    v43[0] = v13;
    v14 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"collectionShare.shareURL"];
    v43[1] = v14;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v43 count:2];
    v16 = [v12 andPredicateWithSubpredicates:v15];
    v45[1] = v16;
    v17 = [MEMORY[0x1E695DEC8] arrayWithObjects:v45 count:2];
    v18 = [v31 orPredicateWithSubpredicates:v17];

    v6 = v39;
    v19 = [a1 _notPushedAssetsToUploadInitiallyInManagedObjectContext:v39 withSavedAssetTypePredicate:v18 shouldSort:0 limit:v38];

    if (![v19 count])
    {
      v32 = MEMORY[0x1E696AB28];
      v36 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForPlaceholderAsset"), 1}];
      v42[0] = v36;
      v20 = MEMORY[0x1E696AB28];
      v34 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil && %K == nil", @"momentShare", @"collectionShare"];
      v40[0] = v34;
      v30 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil || %K != nil", @"momentShare.shareURL", @"collectionShare.shareURL"];
      v40[1] = v30;
      v21 = [MEMORY[0x1E695DEC8] arrayWithObjects:v40 count:2];
      v22 = [v20 orPredicateWithSubpredicates:v21];
      v41[0] = v22;
      v23 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"master"];
      v41[1] = v23;
      v24 = [MEMORY[0x1E695DEC8] arrayWithObjects:v41 count:2];
      v25 = [v20 andPredicateWithSubpredicates:v24];
      v42[1] = v25;
      v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:v42 count:2];
      v27 = [v32 andPredicateWithSubpredicates:v26];

      v6 = v39;
      v28 = [a1 _notPushedAssetsToUploadInitiallyInManagedObjectContext:v39 withSavedAssetTypePredicate:v27 shouldSort:0 limit:v38];

      v19 = v28;
    }

    v8 = v19;
    v7 = v37;
  }

  return v8;
}

+ (id)_predicateForTrashedAssetsToExcludeInInitialUpload
{
  if (_predicateForTrashedAssetsToExcludeInInitialUpload_onceToken != -1)
  {
    dispatch_once(&_predicateForTrashedAssetsToExcludeInInitialUpload_onceToken, &__block_literal_global_544_51359);
  }

  v3 = _predicateForTrashedAssetsToExcludeInInitialUpload_normalOrNeverPushedAssetPredicate;

  return v3;
}

void __73__PLManagedAsset_CPL___predicateForTrashedAssetsToExcludeInInitialUpload__block_invoke()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d OR %K == nil", @"trashedState", 0, @"cloudAssetGUID"];
  v1 = _predicateForTrashedAssetsToExcludeInInitialUpload_normalOrNeverPushedAssetPredicate;
  _predicateForTrashedAssetsToExcludeInInitialUpload_normalOrNeverPushedAssetPredicate = v0;
}

+ (id)predicateForUnpushedDeferredAssets
{
  if (predicateForUnpushedDeferredAssets_onceToken != -1)
  {
    dispatch_once(&predicateForUnpushedDeferredAssets_onceToken, &__block_literal_global_533);
  }

  v3 = predicateForUnpushedDeferredAssets_predicate;

  return v3;
}

void __57__PLManagedAsset_CPL__predicateForUnpushedDeferredAssets__block_invoke()
{
  v9[5] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"cloudLocalState", 0];
  v9[0] = v1;
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != 0", @"complete"];
  v9[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d OR noindex:(%K) != %d", @"deferredProcessingNeeded", 0, @"videoDeferredProcessingNeeded", 0];
  v9[2] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) < %llu", @"additionalAttributes.cloudRecoveryState", 0x80000000];
  v9[3] = v4;
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"trashedState", 0];
  v9[4] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:5];
  v7 = [v0 andPredicateWithSubpredicates:v6];
  v8 = predicateForUnpushedDeferredAssets_predicate;
  predicateForUnpushedDeferredAssets_predicate = v7;
}

+ (id)_syncablePredicate
{
  if (_syncablePredicate_onceToken_51394 != -1)
  {
    dispatch_once(&_syncablePredicate_onceToken_51394, &__block_literal_global_525);
  }

  v3 = _syncablePredicate_predicate;

  return v3;
}

void __41__PLManagedAsset_CPL___syncablePredicate__block_invoke()
{
  v7[3] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != 0", @"complete"];
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"deferredProcessingNeeded", 0, v1];
  v7[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) == %d", @"videoDeferredProcessingNeeded", 0];
  v7[2] = v3;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v7 count:3];
  v5 = [v0 andPredicateWithSubpredicates:v4];
  v6 = _syncablePredicate_predicate;
  _syncablePredicate_predicate = v5;
}

+ (unint64_t)countOfNotUploadedAssetsInPhotoLibrary:(id)a3 forAssetType:(signed __int16)a4 error:(id *)a5
{
  v7 = a3;
  v24 = 0;
  v25 = &v24;
  v26 = 0x2020000000;
  v27 = 0;
  v18 = 0;
  v19 = &v18;
  v20 = 0x3032000000;
  v21 = __Block_byref_object_copy__51017;
  v22 = __Block_byref_object_dispose__51018;
  v23 = 0;
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __81__PLManagedAsset_CPL__countOfNotUploadedAssetsInPhotoLibrary_forAssetType_error___block_invoke;
  v13[3] = &unk_1E756D870;
  v17 = a4;
  v15 = &v24;
  v8 = v7;
  v14 = v8;
  v16 = &v18;
  [v8 performBlockAndWait:v13];
  v9 = v25[3];
  v10 = v19[5];
  if (v9 == 0x7FFFFFFFFFFFFFFFLL && a5)
  {
    v10 = v10;
    *a5 = v10;
  }

  v11 = v25[3];
  _Block_object_dispose(&v18, 8);

  _Block_object_dispose(&v24, 8);
  return v11;
}

void __81__PLManagedAsset_CPL__countOfNotUploadedAssetsInPhotoLibrary_forAssetType_error___block_invoke(uint64_t a1)
{
  v27[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = +[PLManagedAsset predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  if (*(a1 + 56))
  {
    v6 = @"%K == %d";
  }

  else
  {
    v6 = @"noindex:(%K) == %d";
  }

  v7 = [MEMORY[0x1E696AE18] predicateWithFormat:v6, @"kind", *(a1 + 56)];
  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == nil", @"master"];
  v9 = [MEMORY[0x1E696AE18] predicateWithFormat:@"master.cloudLocalState != %d", 3];
  v10 = MEMORY[0x1E696AB28];
  v27[0] = v8;
  v27[1] = v9;
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v27 count:2];
  v12 = [v10 orPredicateWithSubpredicates:v11];

  v13 = MEMORY[0x1E696AB28];
  v26[0] = v5;
  v26[1] = v7;
  v26[2] = v12;
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:3];
  v15 = [v13 andPredicateWithSubpredicates:v14];
  [v4 setPredicate:v15];

  v16 = [*(a1 + 32) managedObjectContext];
  v17 = *(*(a1 + 48) + 8);
  obj = *(v17 + 40);
  v18 = [v16 countForFetchRequest:v4 error:&obj];
  objc_storeStrong((v17 + 40), obj);
  *(*(*(a1 + 40) + 8) + 24) = v18;

  if (*(*(*(a1 + 40) + 8) + 24) == 0x7FFFFFFFFFFFFFFFLL && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v19 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = *(*(*(a1 + 48) + 8) + 40);
      *buf = 138412546;
      v23 = v4;
      v24 = 2112;
      v25 = v20;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Error on fetch: %@, error: %@", buf, 0x16u);
    }
  }
}

+ (unint64_t)iCPLAssetCountInPhotoLibrary:(id)a3
{
  v3 = a3;
  v10 = 0;
  v11 = &v10;
  v12 = 0x2020000000;
  v13 = 0x7FFFFFFFFFFFFFFFLL;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __52__PLManagedAsset_CPL__iCPLAssetCountInPhotoLibrary___block_invoke;
  v7[3] = &unk_1E7578910;
  v4 = v3;
  v8 = v4;
  v9 = &v10;
  [v4 performBlockAndWait:v7];
  v5 = v11[3];

  _Block_object_dispose(&v10, 8);
  return v5;
}

void __52__PLManagedAsset_CPL__iCPLAssetCountInPhotoLibrary___block_invoke(uint64_t a1)
{
  v13 = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders"), 0}];
  [v4 setPredicate:v5];

  [v4 setResultType:4];
  v6 = [*(a1 + 32) managedObjectContext];
  v10 = 0;
  v7 = [v6 countForFetchRequest:v4 error:&v10];
  v8 = v10;

  if (v7 == 0x7FFFFFFFFFFFFFFFLL)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v12 = v8;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "Failed to fetch asset count. Error: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    *(*(*(a1 + 40) + 8) + 24) = v7;
  }
}

+ (unint64_t)countOfDeferredAssetsToSyncInPhotoLibrary:(id)a3 outAssetList:(id)a4
{
  v6 = a3;
  v7 = a4;
  v15 = 0;
  v16 = &v15;
  v17 = 0x2020000000;
  v18 = 0;
  if (v7)
  {
    v10[0] = MEMORY[0x1E69E9820];
    v10[1] = 3221225472;
    v10[2] = __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke;
    v10[3] = &unk_1E7576680;
    v14 = a1;
    v11 = v6;
    v13 = &v15;
    v12 = v7;
    [v11 performBlockAndWait:v10];

    v8 = v16[3];
  }

  else
  {
    v8 = 0;
  }

  _Block_object_dispose(&v15, 8);

  return v8;
}

void __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke(uint64_t a1)
{
  v25[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [*(a1 + 56) predicateForUnpushedDeferredAssets];
  v6 = MEMORY[0x1E696AB28];
  v25[0] = v5;
  v7 = +[PLManagedAsset predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  v25[1] = v7;
  v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:2];
  v9 = [v6 andPredicateWithSubpredicates:v8];

  [v4 setPredicate:v9];
  v24 = @"uuid";
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v24 count:1];
  [v4 setPropertiesToFetch:v10];

  [v4 setResultType:2];
  v11 = [*(a1 + 32) managedObjectContext];
  v21 = 0;
  v12 = [v11 executeFetchRequest:v4 error:&v21];
  v13 = v21;
  if (v12)
  {
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke_2;
    v16[3] = &unk_1E756D848;
    v14 = *(a1 + 48);
    v17 = @"uuid";
    v20 = v14;
    v18 = *(a1 + 32);
    v19 = *(a1 + 40);
    [v12 enumerateObjectsUsingBlock:v16];

    v15 = v17;
LABEL_6:

    goto LABEL_7;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v23 = v13;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Could not fetch the UUID of deferred assets: %@", buf, 0xCu);
    }

    goto LABEL_6;
  }

LABEL_7:
}

void __78__PLManagedAsset_CPL__countOfDeferredAssetsToSyncInPhotoLibrary_outAssetList___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 objectForKeyedSubscript:*(a1 + 32)];
  if (v3)
  {
    ++*(*(*(a1 + 56) + 8) + 24);
    v7 = v3;
    v4 = objc_alloc(MEMORY[0x1E6994BB8]);
    v5 = [*(a1 + 40) mainScopeIdentifier];
    v6 = [v4 initWithScopeIdentifier:v5 identifier:v7];

    [*(a1 + 48) addObject:v6];
    v3 = v7;
  }
}

+ (unint64_t)totalSizeOfUnpushedOriginalsInPhotoLibrary:(id)a3 outMasterList:(id)a4 isInitialUpload:(BOOL)a5
{
  v8 = a3;
  v9 = a4;
  if (v9)
  {
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke;
    v11[3] = &unk_1E7576118;
    v15 = a5;
    v14 = a1;
    v12 = v8;
    v13 = v9;
    [v12 performBlockAndWait:v11];
  }

  return 0;
}

void __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke(uint64_t a1)
{
  v23[1] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND complete != 0 AND master != nil AND master.placeholderState != %d AND master.cloudMasterGUID != nil AND master.cloudMasterGUID != ''", 0, 1];
  v6 = +[PLManagedAsset predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders];
  v7 = [objc_alloc(MEMORY[0x1E695DF70]) initWithObjects:{v5, v6, 0}];
  if (*(a1 + 56) == 1)
  {
    v8 = [*(a1 + 48) _predicateForTrashedAssetsToExcludeInInitialUpload];
    [v7 addObject:v8];
  }

  v9 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v7];
  [v4 setPredicate:v9];
  v10 = objc_alloc_init(MEMORY[0x1E695D5C8]);
  [v10 setName:@"cloudMasterGUID"];
  v11 = [MEMORY[0x1E696ABC8] expressionForKeyPath:@"master.cloudMasterGUID"];
  [v10 setExpression:v11];

  [v10 setExpressionResultType:700];
  v23[0] = v10;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v23 count:1];
  [v4 setPropertiesToFetch:v12];

  [v4 setResultType:2];
  v13 = [*(a1 + 32) managedObjectContext];
  v20 = 0;
  v14 = [v13 executeFetchRequest:v4 error:&v20];
  v15 = v20;
  if (v14)
  {
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke_2;
    v17[3] = &unk_1E756D820;
    v18 = *(a1 + 32);
    v19 = *(a1 + 40);
    [v14 enumerateObjectsUsingBlock:v17];

    v16 = v18;
LABEL_8:

    goto LABEL_9;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v16 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v22 = v15;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Could not fetch total size of unpushed original assets: %@", buf, 0xCu);
    }

    goto LABEL_8;
  }

LABEL_9:
}

void __96__PLManagedAsset_CPL__totalSizeOfUnpushedOriginalsInPhotoLibrary_outMasterList_isInitialUpload___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = [a2 objectForKey:@"cloudMasterGUID"];
  if (v3)
  {
    v7 = v3;
    v4 = objc_alloc(MEMORY[0x1E6994BB8]);
    v5 = [*(a1 + 32) mainScopeIdentifier];
    v6 = [v4 initWithScopeIdentifier:v5 identifier:v7];

    [*(a1 + 40) addObject:v6];
    v3 = v7;
  }
}

+ (id)predicateForAssetsToCheckForDeletionOnCPLDisable
{
  v9[2] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 1}];
  v9[0] = v4;
  v5 = [a1 _syncablePredicate];
  v9[1] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:2];
  v7 = [v3 andPredicateWithSubpredicates:v6];

  return v7;
}

+ (id)predicateForUploadableAssetsWithoutCloudLocalState:(signed __int16)a3
{
  v12[3] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = MEMORY[0x1E696AE18];
  v5 = [MEMORY[0x1E696AD98] numberWithShort:a3];
  v6 = [v4 predicateWithFormat:@"noindex:(%K) != %@", @"cloudLocalState", v5];
  v12[0] = v6;
  v7 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 0}];
  v12[1] = v7;
  v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"trashedState", 2];
  v12[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:3];
  v10 = [v3 andPredicateWithSubpredicates:v9];

  return v10;
}

+ (id)predicateForUploadableAssetsWithCloudLocalStates:(id)a3
{
  v10[3] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [a1 _predicateForCloudLocalStates:a3];
  v10[0] = v4;
  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 0}];
  v10[1] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"noindex:(%K) != %d", @"trashedState", 2];
  v10[2] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:3];
  v8 = [v3 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)_predicateForCloudLocalStates:(id)a3
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [MEMORY[0x1E695DF70] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = v3;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"cloudLocalState", *(*(&v13 + 1) + 8 * i), v13];
        [v4 addObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v4];

  return v11;
}

+ (id)predicateForUploadableAssetsWithCloudLocalState:(signed __int16)a3
{
  v8[1] = *MEMORY[0x1E69E9840];
  v4 = [MEMORY[0x1E696AD98] numberWithShort:a3];
  v8[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:1];
  v6 = [a1 predicateForUploadableAssetsWithCloudLocalStates:v5];

  return v6;
}

+ (id)predicateForUploadableAssetsWithMasterCloudLocalStateNotEqualTo:(signed __int16)a3
{
  v10[3] = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E696AB28];
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d && %K != %d", @"master.cloudLocalState", a3, @"master.cloudLocalState", 4];
  v10[0] = v4;
  v5 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForAssetsEligibleForCloudKitTransport"), 1}];
  v10[1] = v5;
  v6 = [MEMORY[0x1E696AE18] predicateWithFormat:@"$K != %d", @"trashedState", 2];
  v10[2] = v6;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:3];
  v8 = [v3 andPredicateWithSubpredicates:v7];

  return v8;
}

+ (id)predicateForSupportedAssetTypesForUploadWithoutCloudKitSharingScopesAndPlaceholders
{
  v2 = MEMORY[0x1E69BF328];
  v3 = [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders];

  return [v2 predicateForIncludeMask:v3 useIndex:0];
}

+ (id)predicateForSupportedAssetTypesForUpload
{
  v2 = MEMORY[0x1E69BF328];
  v3 = [MEMORY[0x1E69BF328] maskForAssetsEligibleForCloudKitTransport];

  return [v2 predicateForIncludeMask:v3 useIndex:0];
}

+ (id)objectsWithScopedIdentifiers:(id)a3 forEntityName:(id)a4 prefetchResources:(BOOL)a5 relationshipKeyPathsForPrefetching:(id)a6 inLibrary:(id)a7
{
  v52 = a5;
  v69[2] = *MEMORY[0x1E69E9840];
  v12 = a3;
  v13 = a4;
  v54 = a6;
  v55 = a7;
  if (v12 && ![v12 count])
  {
    v35 = MEMORY[0x1E695E0F0];
  }

  else
  {
    v14 = +[PLCloudMaster entityName];
    v15 = [v13 isEqualToString:v14];

    if ((v15 & 1) == 0)
    {
      v16 = +[PLManagedAsset entityName];
      v17 = [v13 isEqualToString:v16];

      if ((v17 & 1) == 0)
      {
        v18 = [MEMORY[0x1E696AAA8] currentHandler];
        [v18 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+CPL.m" lineNumber:3485 description:@"Entity name must be either Asset or CloudMaster."];
      }
    }

    if (v12)
    {
      context = objc_autoreleasePoolPush();
      v51 = [v55 managedObjectContext];
      v53 = [v12 _pl_filter:&__block_literal_global_414];

      v19 = MEMORY[0x1E696AEB0];
      v20 = NSStringFromSelector(sel_scopeIdentifier);
      v21 = [v19 sortDescriptorWithKey:v20 ascending:1];
      v69[0] = v21;
      v22 = MEMORY[0x1E696AEB0];
      v23 = NSStringFromSelector(sel_identifier);
      v24 = [v22 sortDescriptorWithKey:v23 ascending:1];
      v69[1] = v24;
      v25 = [MEMORY[0x1E695DEC8] arrayWithObjects:v69 count:2];
      v26 = [v53 sortedArrayUsingDescriptors:v25];

      v27 = [MEMORY[0x1E695DF70] array];
      v28 = [MEMORY[0x1E695DF70] array];
      v64[0] = 0;
      v64[1] = v64;
      v64[2] = 0x3032000000;
      v64[3] = __Block_byref_object_copy__51017;
      v64[4] = __Block_byref_object_dispose__51018;
      v65 = 0;
      v57[0] = MEMORY[0x1E69E9820];
      v57[1] = 3221225472;
      v57[2] = __129__PLManagedAsset_CPL__objectsWithScopedIdentifiers_forEntityName_prefetchResources_relationshipKeyPathsForPrefetching_inLibrary___block_invoke_2;
      v57[3] = &unk_1E756D7F8;
      v62 = v64;
      v29 = v26;
      v58 = v29;
      v48 = v27;
      v59 = v48;
      v60 = v55;
      v63 = v15;
      v30 = v28;
      v61 = v30;
      [v29 enumerateObjectsUsingBlock:v57];
      v31 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v30];
      v32 = v31;
      if (v15)
      {
        v33 = v31;
        v34 = MEMORY[0x1E695D5E0];
        +[PLCloudMaster entityName];
      }

      else
      {
        v36 = MEMORY[0x1E696AB28];
        v68[0] = v31;
        v37 = [a1 predicateForSupportedAssetTypesForUpload];
        v68[1] = v37;
        v38 = [MEMORY[0x1E695DEC8] arrayWithObjects:v68 count:2];
        v33 = [v36 andPredicateWithSubpredicates:v38];

        v34 = MEMORY[0x1E695D5E0];
        +[PLManagedAsset entityName];
      }
      v39 = ;
      v40 = [v34 fetchRequestWithEntityName:v39];

      [v40 setPredicate:v33];
      [v40 setFetchLimit:{objc_msgSend(v53, "count")}];
      if ([v53 count] >= 0x65)
      {
        [v40 setFetchBatchSize:100];
      }

      v41 = [MEMORY[0x1E695DFA8] setWithArray:v54];
      v42 = v41;
      if (v52)
      {
        if (v15)
        {
          v43 = @"assets.modernResources";
        }

        else
        {
          [v41 addObject:@"modernResources"];
          v43 = @"master";
        }

        [v42 addObject:v43];
      }

      v44 = [v42 allObjects];
      [v40 setRelationshipKeyPathsForPrefetching:v44];

      v56 = 0;
      v35 = [v51 executeFetchRequest:v40 error:&v56];
      v45 = v56;
      if (!v35 && (*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v46 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v67 = v45;
          _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_ERROR, "Could not fetch objects by scoped identifier: %@", buf, 0xCu);
        }
      }

      _Block_object_dispose(v64, 8);
      objc_autoreleasePoolPop(context);
      v12 = v53;
    }

    else
    {
      v35 = 0;
    }
  }

  return v35;
}

void __129__PLManagedAsset_CPL__objectsWithScopedIdentifiers_forEntityName_prefetchResources_relationshipKeyPathsForPrefetching_inLibrary___block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = [v5 scopeIdentifier];
  v32 = [v5 identifier];

  v7 = *(*(*(a1 + 64) + 8) + 40);
  if (v7)
  {
    v8 = [v7 isEqualToString:v6] ^ 1;
  }

  else
  {
    v8 = 0;
  }

  v9 = [*(a1 + 32) count] - 1;
  if ((v8 & 1) != 0 || v9 == a3)
  {
    if (v9 == a3)
    {
      [*(a1 + 40) addObject:v32];
    }

    v10 = v6;
    if (v8)
    {
      v10 = *(*(*(a1 + 64) + 8) + 40);
    }

    v11 = v10;
    v12 = [*(a1 + 48) mainScopeIdentifier];
    v13 = [v11 isEqualToString:v12];

    if (v13)
    {
      v14 = *(a1 + 72);
      v15 = MEMORY[0x1E696AE18];
      v16 = [*(a1 + 40) copy];
      v17 = v16;
      if (v14 == 1)
      {
        [v15 predicateWithFormat:@"cloudMasterGUID IN %@ AND noindex:(%K) == NULL AND noindex:(%K) == NULL", v16, @"momentShare", @"collectionShare", v31];
      }

      else
      {
        [v15 predicateWithFormat:@"%K IN %@ AND noindex:(%K) == NULL AND noindex:(%K) == NULL", @"cloudAssetGUID", v16, @"momentShare", @"collectionShare"];
      }

      goto LABEL_25;
    }

    v18 = [PLMomentShare scopeIdentifierPrefixInLibrary:*(a1 + 48)];
    v19 = [v11 hasPrefix:v18];

    if (v19)
    {
      v20 = *(a1 + 72);
      v21 = MEMORY[0x1E696AE18];
      v17 = [*(a1 + 40) copy];
      if (v20 == 1)
      {
        v30 = v11;
        v22 = @"momentShare.scopeIdentifier";
LABEL_20:
        [v21 predicateWithFormat:@"cloudMasterGUID IN %@ AND %K == %@", v17, v22, v30, v31];
        v27 = LABEL_25:;

        goto LABEL_26;
      }

      v26 = @"momentShare.scopeIdentifier";
    }

    else
    {
      v23 = [PLCollectionShare scopeIdentifierPrefixInLibrary:*(a1 + 48)];
      v24 = [v11 hasPrefix:v23];

      if (!v24)
      {
        v27 = [MEMORY[0x1E696AE18] predicateWithValue:0];
LABEL_26:
        [*(a1 + 56) addObject:v27];
        [*(a1 + 40) removeAllObjects];

        goto LABEL_27;
      }

      v25 = *(a1 + 72);
      v21 = MEMORY[0x1E696AE18];
      v17 = [*(a1 + 40) copy];
      if (v25 == 1)
      {
        v30 = v11;
        v22 = @"collectionShare.scopeIdentifier";
        goto LABEL_20;
      }

      v26 = @"collectionShare.scopeIdentifier";
    }

    [v21 predicateWithFormat:@"%K IN %@ AND %K == %@", @"cloudAssetGUID", v17, v26, v11];
    goto LABEL_25;
  }

LABEL_27:
  [*(a1 + 40) addObject:v32];
  v28 = *(*(a1 + 64) + 8);
  v29 = *(v28 + 40);
  *(v28 + 40) = v6;
}

uint64_t __129__PLManagedAsset_CPL__objectsWithScopedIdentifiers_forEntityName_prefetchResources_relationshipKeyPathsForPrefetching_inLibrary___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

+ (id)assetsWithScopedIdentifiers:(id)a3 prefetchResources:(BOOL)a4 relationshipKeyPathsForPrefetching:(id)a5 inLibrary:(id)a6
{
  v7 = a4;
  v10 = a6;
  v11 = a5;
  v12 = a3;
  v13 = +[PLManagedAsset entityName];
  v14 = [a1 objectsWithScopedIdentifiers:v12 forEntityName:v13 prefetchResources:v7 relationshipKeyPathsForPrefetching:v11 inLibrary:v10];

  return v14;
}

+ (PLManagedAsset)assetWithScopedIdentifier:(id)a3 inLibrary:(id)a4 prefetchResources:(BOOL)a5
{
  v5 = a5;
  v16 = *MEMORY[0x1E69E9840];
  v15 = a3;
  v8 = MEMORY[0x1E695DEC8];
  v9 = a4;
  v10 = a3;
  v11 = [v8 arrayWithObjects:&v15 count:1];

  v12 = [a1 assetsWithScopedIdentifiers:v11 prefetchResources:v5 relationshipKeyPathsForPrefetching:0 inLibrary:{v9, v15, v16}];

  v13 = [v12 firstObject];

  return v13;
}

+ (id)assetsByScopedIdentifiers:(id)a3 relationshipKeyPathsForPrefetching:(id)a4 inLibrary:(id)a5
{
  v5 = [a1 assetsWithScopedIdentifiers:a3 prefetchResources:0 relationshipKeyPathsForPrefetching:a4 inLibrary:a5];
  v6 = [v5 _pl_indexBy:&__block_literal_global_408_51479];

  return v6;
}

+ (id)assetsByCloudAssetUUID:(id)a3 inLibrary:(id)a4
{
  v24 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [MEMORY[0x1E695DF90] dictionaryWithCapacity:{objc_msgSend(v6, "count")}];
  context = objc_autoreleasePoolPush();
  v9 = [MEMORY[0x1E6994BB8] scopedIdentifiersFromArrayOfUnknownIdentifiers:v6];
  v10 = [a1 assetsWithScopedIdentifiers:v9 prefetchResources:0 relationshipKeyPathsForPrefetching:0 inLibrary:v7];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v11 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v11)
  {
    v12 = v11;
    v13 = *v20;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v20 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v19 + 1) + 8 * i);
        v16 = [v15 cloudAssetGUID];
        [v8 setObject:v15 forKey:v16];
      }

      v12 = [v10 countByEnumeratingWithState:&v19 objects:v23 count:16];
    }

    while (v12);
  }

  objc_autoreleasePoolPop(context);

  return v8;
}

+ (void)markMomentShareAndCollectionShareAssetsAsCopied:(id)a3
{
  v92 = *MEMORY[0x1E69E9840];
  v3 = a3;
  if ([v3 count])
  {
    v4 = [v3 firstObject];
    v64 = [v4 photoLibrary];

    v68 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(v3, "count")}];
    v65 = [MEMORY[0x1E695DF90] dictionary];
    v69 = [MEMORY[0x1E695DF90] dictionary];
    v81 = 0u;
    v82 = 0u;
    v83 = 0u;
    v84 = 0u;
    v63 = v3;
    obj = v3;
    v5 = [obj countByEnumeratingWithState:&v81 objects:v91 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v82;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v82 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v9 = *(*(&v81 + 1) + 8 * i);
          v10 = objc_autoreleasePoolPush();
          v80 = 0;
          v11 = [v9 originalStableHashCacheIfNecessaryAndAdjustedStableHash:&v80 fullsizeRenderImageIfNecessary:0 enableSaveIfNecessary:1 error:0];
          v12 = v80;
          if (v11)
          {
            if (v12)
            {
              v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@", @"adjustedStableHash", v12];
              v14 = v69;
              v15 = v9;
              v16 = v12;
            }

            else
            {
              v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@", @"originalStableHash", v11];
              v14 = v65;
              v15 = v9;
              v16 = v11;
            }

            [v14 setObject:v15 forKeyedSubscript:v16];
            v17 = [v9 isCPLSharingScopeAsset];
            v18 = MEMORY[0x1E69BF328];
            if (v17)
            {
              v19 = [MEMORY[0x1E69BF328] maskForUserLibrary];
            }

            else
            {
              v19 = [MEMORY[0x1E69BF328] maskForAssetsEligibleForCPLSharingScopes];
            }

            v20 = [v18 predicateForIncludeMask:v19 useIndex:0 keyPathPrefix:@"asset"];
            v21 = MEMORY[0x1E696AB28];
            v90[0] = v13;
            v90[1] = v20;
            v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v90 count:2];
            v23 = [v21 andPredicateWithSubpredicates:v22];

            [v68 addObject:v23];
          }

          objc_autoreleasePoolPop(v10);
        }

        v6 = [obj countByEnumeratingWithState:&v81 objects:v91 count:16];
      }

      while (v6);
    }

    v24 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v68];
    v25 = MEMORY[0x1E695D5E0];
    v26 = +[PLAdditionalAssetAttributes entityName];
    v27 = [v25 fetchRequestWithEntityName:v26];

    [v27 setPredicate:v24];
    v89 = @"asset";
    v28 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v89 count:1];
    [v27 setRelationshipKeyPathsForPrefetching:v28];

    v29 = [v64 managedObjectContext];
    v79 = 0;
    v30 = [v29 executeFetchRequest:v27 error:&v79];
    v31 = v79;

    if (v30)
    {
      v59 = v31;
      v61 = v27;
      v62 = v24;
      obja = [MEMORY[0x1E695DFA8] set];
      v75 = 0u;
      v76 = 0u;
      v77 = 0u;
      v78 = 0u;
      v60 = v30;
      v32 = v30;
      v33 = [v32 countByEnumeratingWithState:&v75 objects:v86 count:16];
      if (!v33)
      {
        goto LABEL_35;
      }

      v34 = v33;
      v35 = *v76;
      while (1)
      {
        for (j = 0; j != v34; ++j)
        {
          if (*v76 != v35)
          {
            objc_enumerationMutation(v32);
          }

          v37 = [*(*(&v75 + 1) + 8 * j) asset];
          v74 = 0;
          v38 = [v37 originalStableHashCacheIfNecessaryAndAdjustedStableHash:&v74 fullsizeRenderImageIfNecessary:0 enableSaveIfNecessary:1 error:0];
          v39 = v74;
          if (v39)
          {
            v40 = v69;
            v41 = v39;
          }

          else
          {
            v40 = v65;
            v41 = v38;
          }

          v42 = [v40 objectForKeyedSubscript:v41];
          v43 = v42;
          if (v42)
          {
            if ([v42 isCPLSharingScopeAsset] && (objc_msgSend(v43, "shareRelationship"), v44 = objc_claimAutoreleasedReturnValue(), v45 = objc_msgSend(v44, "status"), v44, v45 != 1))
            {
              v48 = obja;
              v49 = v43;
            }

            else
            {
              v46 = [v37 shareRelationship];
              v47 = [v46 status];

              if (v47 == 1)
              {
                goto LABEL_33;
              }

              v48 = obja;
              v49 = v37;
            }

            [v48 addObject:v49];
          }

LABEL_33:
        }

        v34 = [v32 countByEnumeratingWithState:&v75 objects:v86 count:16];
        if (!v34)
        {
LABEL_35:

          v72 = 0u;
          v73 = 0u;
          v70 = 0u;
          v71 = 0u;
          v50 = obja;
          v51 = [v50 countByEnumeratingWithState:&v70 objects:v85 count:16];
          if (v51)
          {
            v52 = v51;
            v53 = *v71;
            v54 = MEMORY[0x1E6994D48];
            do
            {
              for (k = 0; k != v52; ++k)
              {
                if (*v71 != v53)
                {
                  objc_enumerationMutation(v50);
                }

                v56 = *(*(&v70 + 1) + 8 * k);
                v57 = [v56 additionalAttributes];
                [v57 setDestinationAssetCopyState:2];

                if ((*v54 & 1) == 0)
                {
                  v58 = __CPLAssetsdOSLogDomain();
                  if (os_log_type_enabled(v58, OS_LOG_TYPE_DEBUG))
                  {
                    *buf = 67109378;
                    *v88 = 2;
                    *&v88[4] = 2112;
                    *&v88[6] = v56;
                    _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_DEBUG, "Setting destinationAssetCopyState %d for asset %@", buf, 0x12u);
                  }
                }
              }

              v52 = [v50 countByEnumeratingWithState:&v70 objects:v85 count:16];
            }

            while (v52);
          }

          v27 = v61;
          v24 = v62;
          v31 = v59;
          v30 = v60;
          goto LABEL_50;
        }
      }
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v50 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v50, OS_LOG_TYPE_ERROR))
      {
        *buf = 138543618;
        *v88 = v24;
        *&v88[8] = 2112;
        *&v88[10] = v31;
        _os_log_impl(&dword_19BF1F000, v50, OS_LOG_TYPE_ERROR, "Failed to fetch assets with same fingerprint with predicate: %{public}@, error: %@", buf, 0x16u);
      }

LABEL_50:
    }

    v3 = v63;
  }
}

+ (id)listOfSharingRelationshipsRelevantForUpload
{
  pl_dispatch_once();
  v2 = listOfSharingRelationshipsRelevantForUpload_result;

  return v2;
}

void __66__PLManagedAsset_CPL__listOfSharingRelationshipsRelevantForUpload__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E695DEC8]) initWithObjects:{@"libraryScope", @"libraryScopeAssetContributors", 0}];
  v1 = listOfSharingRelationshipsRelevantForUpload_result;
  listOfSharingRelationshipsRelevantForUpload_result = v0;
}

+ (id)listOfSharingAttributesRelevantForUpload
{
  pl_dispatch_once();
  v2 = listOfSharingAttributesRelevantForUpload_result;

  return v2;
}

void __63__PLManagedAsset_CPL__listOfSharingAttributesRelevantForUpload__block_invoke()
{
  v0 = [objc_alloc(MEMORY[0x1E695DEC8]) initWithObjects:{@"libraryScopeShareState", 0}];
  v1 = listOfSharingAttributesRelevantForUpload_result;
  listOfSharingAttributesRelevantForUpload_result = v0;
}

+ (id)listOfSyncedProperties
{
  pl_dispatch_once();
  v2 = listOfSyncedProperties_result_51506;

  return v2;
}

void __45__PLManagedAsset_CPL__listOfSyncedProperties__block_invoke(uint64_t a1)
{
  v6 = [objc_alloc(MEMORY[0x1E695DF70]) initWithObjects:{@"favorite", @"lastSharedDate", @"addedDate", @"dateCreated", @"locationData", 0x1F0F09000, @"title", @"visibilityState", @"avalancheUUID", @"avalanchePickType", @"kindSubtype", @"hdrType", @"trashedState", @"trashedDate", @"mediaGroupUUID", @"videoCpDurationValue", @"videoCpVisibilityState", @"sortToken", @"adjustmentsState", @"orientation", @"duration", @"deferredProcessingNeeded", @"cameraProcessingAdjustmentState", @"videoDeferredProcessingNeeded", @"savedAssetType", 0}];
  if ((_os_feature_enabled_impl() & 1) == 0)
  {
    [v6 addObject:@"trashedByParticipant"];
    v2 = [*(a1 + 32) listOfSharingAttributesRelevantForUpload];
    [v6 addObjectsFromArray:v2];

    v3 = [*(a1 + 32) listOfSharingRelationshipsRelevantForUpload];
    [v6 addObjectsFromArray:v3];
  }

  v4 = [v6 copy];
  v5 = listOfSyncedProperties_result_51506;
  listOfSyncedProperties_result_51506 = v4;
}

+ (void)fixMissingOriginalTimezoneIfNeededForAsset:(id)a3
{
  v20 = *MEMORY[0x1E69E9840];
  v3 = a3;
  if (PLPlatformExtendedAttributesSupported())
  {
    v4 = [v3 extendedAttributesCreateIfNeeded:1];
    v5 = [v4 dateCreated];
    v6 = [v4 timezoneOffset];
    if (v6)
    {

LABEL_12:
      goto LABEL_13;
    }

    v7 = [v4 timezoneName];

    if (v7)
    {
      goto LABEL_12;
    }

    v8 = [v3 additionalAttributes];
    v9 = [v8 timeZoneName];
    if (v9)
    {
    }

    else
    {
      v10 = [v3 additionalAttributes];
      v11 = [v10 timeZoneOffset];

      if (!v11)
      {
        if (!v5)
        {
          if (*MEMORY[0x1E6994D48])
          {
            goto LABEL_12;
          }

          v14 = __CPLAssetsdOSLogDomain();
          if (!os_log_type_enabled(v14, OS_LOG_TYPE_DEBUG))
          {
            goto LABEL_11;
          }

          v16 = [v3 uuid];
          v18 = 138543362;
          v19 = v16;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEBUG, "Unable to set original timezone for asset: %{public}@", &v18, 0xCu);
LABEL_10:

LABEL_11:
          goto LABEL_12;
        }

        v14 = [MEMORY[0x1E695DFE8] localTimeZone];
        v17 = [v14 name];
        [v4 setTimezoneName:v17];

        v15 = [MEMORY[0x1E696AD98] numberWithInteger:{-[NSObject secondsFromGMTForDate:](v14, "secondsFromGMTForDate:", v5)}];
LABEL_9:
        v16 = v15;
        [v4 setTimezoneOffset:v15];
        goto LABEL_10;
      }
    }

    v12 = [v3 additionalAttributes];
    v13 = [v12 timeZoneName];
    [v4 setTimezoneName:v13];

    v14 = [v3 additionalAttributes];
    v15 = [v14 timeZoneOffset];
    goto LABEL_9;
  }

LABEL_13:
}

+ (void)fixMissingOriginalDateCreatedIfNeededForAsset:(id)a3 withCloudMaster:(id)a4
{
  v10 = a3;
  v5 = a4;
  if (PLPlatformExtendedAttributesSupported())
  {
    v6 = [v10 extendedAttributesCreateIfNeeded:1];
    v7 = [v6 dateCreated];

    if (!v7)
    {
      v8 = [v5 creationDate];
      if (v8)
      {
        [v6 setDateCreated:v8];
        v9 = [v10 additionalAttributes];
        [v9 setDateCreatedSource:3];
      }
    }
  }
}

+ (void)processMediaMetadataForAsset:(id)a3 withCloudMaster:(id)a4
{
  v47 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = [v6 mediaMetadata];
  v8 = [v7 valueForKey:@"data"];

  if (v8)
  {
    v42 = 0;
    v9 = [MEMORY[0x1E696AE40] propertyListWithData:v8 options:0 format:0 error:&v42];
    v10 = v42;
    if (v9)
    {
      objc_opt_class();
      v11 = [v5 managedObjectContext];
      if (objc_opt_isKindOfClass())
      {
        v12 = v11;
      }

      else
      {
        v12 = 0;
      }

      v13 = v12;

      v14 = [v5 kind];
      if (v14 <= 1)
      {
        if (v14)
        {
          v15 = [MEMORY[0x1E6987E28] assetProxyWithPropertyList:v9];
          if (v15)
          {
            v39 = v10;
            [v5 setVideoInfoOnMasterFromAVAsset:v15];
            v16 = objc_alloc(MEMORY[0x1E69C0718]);
            v17 = [v13 pl_libraryBundle];
            v18 = [v17 timeZoneLookup];
            v19 = [v16 initWithAVAsset:v15 timeZoneLookup:v18];

            [v5 updateVideoAttributesFromMetadata:v19 overwriteOriginalProperties:1];
            if ([v5 cameraProcessingAdjustmentState])
            {
              v20 = [v19 spatialOverCaptureIdentifier];
              if (v20)
              {
                v21 = [v5 additionalAttributes];
                [v21 setSpatialOverCaptureGroupIdentifier:v20];
              }
            }

            if (PLPlatformExtendedAttributesSupported())
            {
              [v5 updateVideoExtendedAttributesFromMetadata:v19];
            }

            v10 = v39;
          }

          else
          {
            if ([v5 isCPLSharingScopeAsset])
            {
              if ((*MEMORY[0x1E6994D48] & 1) == 0)
              {
                v33 = __CPLAssetsdOSLogDomain();
                if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
                {
                  v34 = [v5 cloudAssetGUID];
                  *buf = 138412290;
                  v44 = v34;
                  _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_ERROR, "Shared video asset with invalid mediaProperties detected, clearing mediaMetadata on CMM master with GUID %@", buf, 0xCu);
                }
              }

              v35 = [v6 mediaMetadata];
              [v35 setValue:0 forKey:@"data"];
            }

            else if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v36 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
              {
                v37 = [v5 cloudAssetGUID];
                *buf = 138412290;
                v44 = v37;
                _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "Video asset with invalid mediaProperties detected with GUID %@", buf, 0xCu);
              }
            }

            v19 = 0;
          }

LABEL_40:

          goto LABEL_41;
        }

        v22 = objc_alloc(MEMORY[0x1E69C0718]);
        v23 = MEMORY[0x1E69C08F0];
        [v5 uniformTypeIdentifier];
        v24 = v40 = v10;
        v25 = [v23 typeWithIdentifier:v24];
        v26 = [v13 pl_libraryBundle];
        v27 = [v26 timeZoneLookup];
        v19 = [v22 initWithImageSourceProxyOrEncodedImagePropertyData:v8 contentType:v25 timeZoneLookup:v27];

        v10 = v40;
        [v5 setImageInfoFromOriginalImageMetadata:v19];
LABEL_41:

        goto LABEL_42;
      }

      if (v14 == 2)
      {
        if (PLPlatformExtendedAttributesSupported())
        {
          v19 = [MEMORY[0x1E6987E28] assetProxyWithPropertyList:v9];
          if (v19)
          {
            v28 = objc_alloc(MEMORY[0x1E69C0718]);
            [v13 pl_libraryBundle];
            v29 = v41 = v10;
            v30 = [v29 timeZoneLookup];
            v15 = [v28 initWithAVAsset:v19 timeZoneLookup:v30];

            v10 = v41;
            [v5 updateAudioExtendedAttributesFromMetadata:v15];
          }

          else
          {
            if (*MEMORY[0x1E6994D48])
            {
              v19 = 0;
              goto LABEL_41;
            }

            v15 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
            {
              v38 = [v5 cloudAssetGUID];
              *buf = 138412290;
              v44 = v38;
              _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Audio asset with invalid mediaProperties detected with GUID %@", buf, 0xCu);
            }
          }

          goto LABEL_40;
        }
      }

      else if (v14 != 3)
      {
        goto LABEL_42;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v19 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          v31 = [v5 cloudAssetGUID];
          v32 = [v5 kind];
          *buf = 138412546;
          v44 = v31;
          v45 = 1024;
          LODWORD(v46) = v32;
          _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Media properties on unexpected asset kind with GUID %@, kind %d", buf, 0x12u);
        }

        goto LABEL_41;
      }
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_43:

        goto LABEL_44;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v19 = [v5 cloudAssetGUID];
        *buf = 138543618;
        v44 = v19;
        v45 = 2112;
        v46 = v10;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Media metadata for asset asset %{public}@ failed to decode: error: %@", buf, 0x16u);
        goto LABEL_41;
      }
    }

LABEL_42:

    goto LABEL_43;
  }

LABEL_44:
}

+ (void)processAdjustedMediaMetadataForAsset:(id)a3
{
  v4 = a3;
  if (![v4 kind])
  {
    v3 = [v4 fullSizeResourceMetadataFromMediaPropertiesOrFullSizeResourceOrOptionalURL:0];
    if (v3)
    {
      [v4 setSpatialTypeFromMetadata:v3];
    }
  }

  [v4 updateAssetPropertiesFromAdjustmentFile];
}

+ (void)fixupCloudPhotoLibraryAsset:(id)a3 withCloudMaster:(id)a4 inLibrary:(id)a5
{
  v13 = a3;
  v9 = a4;
  v10 = a5;
  if (!v9)
  {
    v12 = [MEMORY[0x1E696AAA8] currentHandler];
    [v12 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+CPL.m" lineNumber:2612 description:{@"Invalid parameter not satisfying: %@", @"cloudMaster"}];
  }

  if ([v9 cloudLocalState] != 3)
  {
    [v9 setCloudLocalState:3];
  }

  if ([v13 cloudLocalState] != 1)
  {
    [v13 setCloudLocalState:1];
  }

  [v13 _applyPropertiesFromCloudMaster:v9];
  v11 = [v10 managedObjectContext];
  [v13 rm_createMasterResourcesIn:v9 inManagedObjectContext:v11];
}

+ (id)createCloudPhotoLibraryAssetWithAssetRecord:(id)a3 withCloudMaster:(id)a4 inLibrary:(id)a5
{
  v48 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a5;
  v12 = MEMORY[0x1E6994D48];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v13 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      *buf = 138412290;
      v47 = v9;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEBUG, "Creating asset with CPLAssetChange %@", buf, 0xCu);
    }
  }

  v14 = [v9 scopedIdentifier];
  v44 = 0;
  v15 = [PLShare getShareIfNecessary:&v44 forCPLRecordWithClass:objc_opt_class() scopedIdentifier:v14 inLibrary:v11];
  v16 = v44;
  v17 = 0;
  if (!v15)
  {
    goto LABEL_28;
  }

  LOWORD(v42) = 257;
  v17 = +[PLManagedAsset insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:](PLManagedAsset, "insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:", v11, 0, 0, [MEMORY[0x1E69BF328] savedAssetTypeForCloudPhotoLibraryAsset], 0, 0, 0, 0, 0, v42);
  v43 = [v14 identifier];
  [v17 setCloudAssetGUID:?];
  v18 = [objc_opt_class() subclassKind];
  if (v18 <= 1)
  {
    if (v18)
    {
      [v17 setMomentShare:v16];
      [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForMomentSharedAsset")}];
      [v17 setBundleScope:1];
      v19 = [v17 additionalAttributes];
      [v19 setShareType:1];

      v20 = [v17 additionalAttributes];
      v21 = [v16 owner];
      [v21 userIdentifier];
      v23 = v22 = v12;
      [v20 setShareOriginator:v23];

      v12 = v22;
    }

    else
    {
      [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForCloudPhotoLibraryAsset")}];
    }

    goto LABEL_17;
  }

  if (v18 == 2)
  {
    [MEMORY[0x1E696AAA8] currentHandler];
    v34 = v33 = v12;
    [v34 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+CPL.m" lineNumber:2595 description:{@"Asset cannot have library scope scopes %@", v9}];

    v12 = v33;
    goto LABEL_17;
  }

  if (v18 != 3)
  {
LABEL_17:
    [v17 setCloudLocalState:1];
    if (v10)
    {
      v35 = objc_autoreleasePoolPush();
      [v17 _applyPropertiesFromCloudMaster:v10];
      v36 = [v11 managedObjectContext];
      [v17 rm_createMasterResourcesIn:v10 inManagedObjectContext:v36];

      objc_autoreleasePoolPop(v35);
    }

    else if ((*v12 & 1) == 0)
    {
      v37 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v47 = v17;
        _os_log_impl(&dword_19BF1F000, v37, OS_LOG_TYPE_ERROR, "Unable to find matching cloud master for %@", buf, 0xCu);
      }
    }

    if ((*v12 & 1) == 0)
    {
      v38 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v38, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412290;
        v47 = v17;
        _os_log_impl(&dword_19BF1F000, v38, OS_LOG_TYPE_DEBUG, "Created asset %@", buf, 0xCu);
      }
    }

LABEL_28:
    v17 = v17;
    v39 = v17;
    goto LABEL_29;
  }

  v24 = [v9 contributorUserIdentifier];

  if (v24)
  {
    v25 = [v9 contributorUserIdentifier];
    v45 = v25;
    v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v45 count:1];
    v27 = [PLShareParticipant participantsWithUserIdentifiers:v26 inScope:v16 inPhotoLibrary:v11];

    if ([v27 count])
    {
      v28 = [v27 firstObject];
      [v17 setCollectionShare:v16 withContributor:v28];
    }

    [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForCollectionShareAsset")}];
    [v17 setBundleScope:5];
    v29 = [v17 additionalAttributes];
    [v29 setShareType:3];

    v30 = [v17 additionalAttributes];
    v31 = [v16 owner];
    v32 = [v31 userIdentifier];
    [v30 setShareOriginator:v32];

    v12 = MEMORY[0x1E6994D48];
    goto LABEL_17;
  }

  v41 = [MEMORY[0x1E696AAA8] currentHandler];
  [v41 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+CPL.m" lineNumber:2583 description:{@"Attempting to insert a collection share asset from CPL without contributor info %@", v9}];

  v39 = 0;
LABEL_29:

  return v39;
}

+ (id)_cloudAdjustmentFingerprintWithAdjustmentDataBlob:(id)a3 largeAdjustmentBlobFingerpint:(id)a4 formatIdentifier:(id)a5 formatVersion:(id)a6 editorBundleID:(id)a7 baseVersion:(int64_t)a8 baseImageData:(id)a9 baseImageFingerprint:(id)a10
{
  v32 = *MEMORY[0x1E69E9840];
  v15 = a3;
  v16 = a4;
  v17 = a5;
  v18 = a6;
  v19 = a7;
  v29 = a9;
  v20 = a10;
  v21 = objc_alloc_init(MEMORY[0x1E69C0658]);
  [v21 setAdjustmentType:v17];
  [v21 setAdjustmentCompoundVersion:v18];
  [v21 setAdjustmentCreatorCode:v19];
  v22 = a8 == 1;
  [v21 setAdjustmentSourceType:v22];
  if (v16)
  {
    [v21 setLargeAdjustmentDataFingerprint:v16];
  }

  else
  {
    v23 = [v15 length];
    if (v23 <= [MEMORY[0x1E6994B60] maxInlineDataSize])
    {
      [v21 setSimpleAdjustmentData:v15];
    }

    else
    {
      [v21 setLargeAdjustmentData:v15];
    }
  }

  if (v20)
  {
    [v21 setBaseImageFingerprint:v20];
  }

  else
  {
    [v21 setBaseImage:v29];
  }

  v24 = [PLDescriptionBuilder prettyMultiLineDescriptionBuilderWithObject:v21 indent:0];
  [v24 appendName:@"formatIdentifier" object:v17];
  [v24 appendName:@"formatVersion" object:v18];
  [v24 appendName:@"editorBundleID" object:v19];
  [v24 appendName:@"sourceType" integerValue:v22];
  if (v16)
  {
    [v24 appendName:@"largeAdjustmentBlobFingerprint" object:v16];
    if (v20)
    {
LABEL_11:
      [v24 appendName:@"baseImageFingerprint" object:v20];
      goto LABEL_14;
    }
  }

  else
  {
    [v24 appendName:@"adjustmentBlobLength" unsignedIntegerValue:{objc_msgSend(v15, "length")}];
    if (v20)
    {
      goto LABEL_11;
    }
  }

  [v24 appendName:@"baseImageDataLength" unsignedIntegerValue:{objc_msgSend(v29, "length")}];
LABEL_14:
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v25 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
    {
      v26 = [v24 build];
      *buf = 138412290;
      v31 = v26;
      _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Calculating cloud adjustment fingerprint with the following parts: %@", buf, 0xCu);
    }
  }

  v27 = [MEMORY[0x1E69C0660] fingerprintWithAssetAdjustmentFingerprintData:v21];

  return v27;
}

+ (id)_predicateForAssetsWithNotCompleteResourcesOnResource
{
  pl_dispatch_once();
  v2 = _predicateForAssetsWithNotCompleteResourcesOnResource_predicate;

  return v2;
}

void __76__PLManagedAsset_CPL___predicateForAssetsWithNotCompleteResourcesOnResource__block_invoke()
{
  v27[2] = *MEMORY[0x1E69E9840];
  v0 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v23 = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset.master == NULL"];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset.master != NULL"];
  v2 = MEMORY[0x1E696AE18];
  v3 = +[PLInternalResource originalCPLResourceTypesForMaster];
  v4 = [v2 predicateWithFormat:@"dataStoreClassID == %d AND dataStoreSubtype IN %@ AND version == %d AND localAvailability <= %d", 0, v3, 0, 0xFFFFFFFFLL];

  v5 = MEMORY[0x1E696AB28];
  v27[0] = v1;
  v27[1] = v4;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v27 count:2];
  v7 = [v5 andPredicateWithSubpredicates:v6];

  v8 = MEMORY[0x1E696AB28];
  v26[0] = v23;
  v26[1] = v7;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:2];
  v10 = [v8 orPredicateWithSubpredicates:v9];
  [v0 addObject:v10];

  v11 = [PLManagedAsset predicateForAdjustedAssetsWithKeyPathToAsset:@"asset"];
  v12 = MEMORY[0x1E696AE18];
  v13 = +[PLInternalResource originalCPLResourceTypesForAsset];
  v14 = [v12 predicateWithFormat:@"dataStoreClassID == %d AND dataStoreSubtype IN %@ AND version IN %@ AND localAvailability <= %d", 0, v13, &unk_1F0FBFC58, 0xFFFFFFFFLL];

  v15 = MEMORY[0x1E696AB28];
  v25[0] = v11;
  v25[1] = v14;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:2];
  v17 = [v15 andPredicateWithSubpredicates:v16];

  v18 = MEMORY[0x1E696AB28];
  v24 = v17;
  v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v24 count:1];
  v20 = [v18 orPredicateWithSubpredicates:v19];
  [v0 addObject:v20];

  v21 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v0];
  v22 = _predicateForAssetsWithNotCompleteResourcesOnResource_predicate;
  _predicateForAssetsWithNotCompleteResourcesOnResource_predicate = v21;
}

+ (id)predicateForAssetsWithCompleteResourcesOnAsset
{
  pl_dispatch_once();
  v2 = predicateForAssetsWithCompleteResourcesOnAsset_predicate;

  return v2;
}

void __69__PLManagedAsset_CPL__predicateForAssetsWithCompleteResourcesOnAsset__block_invoke()
{
  v24[2] = *MEMORY[0x1E69E9840];
  v0 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v19 = [MEMORY[0x1E696AE18] predicateWithFormat:@"master == NULL"];
  v20 = [MEMORY[0x1E696AE18] predicateWithFormat:@"master != NULL"];
  v1 = +[PLInternalResource predicateForAllOriginalResourcesLocallyAvailable];
  v2 = MEMORY[0x1E696AB28];
  v24[0] = v20;
  v24[1] = v1;
  v3 = [MEMORY[0x1E695DEC8] arrayWithObjects:v24 count:2];
  v4 = [v2 andPredicateWithSubpredicates:v3];

  v5 = MEMORY[0x1E696AB28];
  v23[0] = v19;
  v23[1] = v4;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v23 count:2];
  v7 = [v5 orPredicateWithSubpredicates:v6];
  [v0 addObject:v7];

  v8 = [PLManagedAsset predicateForUnadjustedAssetsWithKeyPathToAsset:0];
  v9 = [PLManagedAsset predicateForAdjustedAssetsWithKeyPathToAsset:0];
  v10 = +[PLInternalResource predicateForAllFullSizeResourcesLocallyAvailable];
  v11 = MEMORY[0x1E696AB28];
  v22[0] = v9;
  v22[1] = v10;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v22 count:2];
  v13 = [v11 andPredicateWithSubpredicates:v12];

  v14 = MEMORY[0x1E696AB28];
  v21[0] = v8;
  v21[1] = v13;
  v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v21 count:2];
  v16 = [v14 orPredicateWithSubpredicates:v15];
  [v0 addObject:v16];

  v17 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v0];
  v18 = predicateForAssetsWithCompleteResourcesOnAsset_predicate;
  predicateForAssetsWithCompleteResourcesOnAsset_predicate = v17;
}

+ (void)countOfAssetsWithRequiredResourcesNotLocallyAvailableInLibrary:(id)a3 outCount:(unint64_t *)a4 photoCount:(unint64_t *)a5 videoCount:(unint64_t *)a6
{
  v22[2] = *MEMORY[0x1E69E9840];
  v10 = MEMORY[0x1E69BF328];
  v11 = a3;
  v12 = [v10 predicateForIncludeMask:objc_msgSend(v10 useIndex:"maskForAssetsEligibleForCPLTransportWithoutSharedScopesAndPlaceholders") keyPathPrefix:{0, @"asset"}];
  v13 = +[PLManagedAsset _predicateForAssetsWithNotCompleteResourcesOnResource];
  v14 = MEMORY[0x1E696AB28];
  v22[0] = v12;
  v22[1] = v13;
  v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v22 count:2];
  v16 = [v14 andPredicateWithSubpredicates:v15];

  v17 = [v11 managedObjectContext];

  v18 = [a1 _countOfAssetsByKindWithResourcePredicate:v16 inContext:v17];

  if (v18)
  {
    v19 = [a1 _sumOfCountsInCountedSet:v18];
    v20 = [v18 countForObject:&unk_1F0FBCC40];
    v21 = [v18 countForObject:&unk_1F0FBCC58];
    if (!a4)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v21 = 0;
  v20 = 0;
  v19 = 0;
  if (a4)
  {
LABEL_3:
    *a4 = v19;
  }

LABEL_4:
  if (a5)
  {
    *a5 = v20;
  }

  if (a6)
  {
    *a6 = v21;
  }
}

+ (id)_countOfAssetsByKindWithResourcePredicate:(id)a3 inContext:(id)a4
{
  v35[1] = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = MEMORY[0x1E695D5E0];
  v8 = +[PLInternalResource entityName];
  v9 = [v7 fetchRequestWithEntityName:v8];

  v35[0] = @"asset";
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v35 count:1];
  [v9 setRelationshipKeyPathsForPrefetching:v10];

  [v9 setPredicate:v5];
  v34[0] = @"asset";
  v34[1] = @"asset.kind";
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v34 count:2];
  [v9 setPropertiesToGroupBy:v11];

  v33 = @"asset.kind";
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v33 count:1];
  [v9 setPropertiesToFetch:v12];

  [v9 setResultType:2];
  v29 = 0;
  v13 = [v6 executeFetchRequest:v9 error:&v29];
  v14 = v29;
  if (v13)
  {
    v15 = [objc_alloc(MEMORY[0x1E696AB50]) initWithCapacity:4];
    v25 = 0u;
    v26 = 0u;
    v27 = 0u;
    v28 = 0u;
    v16 = v13;
    v17 = [v16 countByEnumeratingWithState:&v25 objects:v32 count:16];
    if (v17)
    {
      v18 = v17;
      v23 = v6;
      v24 = v5;
      v19 = *v26;
      do
      {
        for (i = 0; i != v18; ++i)
        {
          if (*v26 != v19)
          {
            objc_enumerationMutation(v16);
          }

          v21 = [*(*(&v25 + 1) + 8 * i) objectForKeyedSubscript:{@"asset.kind", v23, v24, v25}];
          [v15 addObject:v21];
        }

        v18 = [v16 countByEnumeratingWithState:&v25 objects:v32 count:16];
      }

      while (v18);
      v6 = v23;
      v5 = v24;
    }
  }

  else
  {
    v16 = PLBackendGetLog();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v31 = v14;
      _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "failed to count assets by kind: %@", buf, 0xCu);
    }

    v15 = 0;
  }

  return v15;
}

+ (unint64_t)_sumOfCountsInCountedSet:(id)a3
{
  v15 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = 0;
    v7 = *v11;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(v3);
        }

        v6 += [v3 countForObject:*(*(&v10 + 1) + 8 * i)];
      }

      v5 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v5);
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

+ (unint64_t)CPLAssetHDRTypeFromPLAssetHDRType:(signed __int16)a3
{
  if ((a3 - 2) < 3)
  {
    return (a3 - 2) + 1;
  }

  else
  {
    return 0;
  }
}

+ (void)createMastersInLibrary:(id)a3
{
  v4 = a3;
  v5 = [v4 managedObjectContext];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke;
  v8[3] = &unk_1E75782F8;
  v10 = v4;
  v11 = a1;
  v9 = v5;
  v6 = v4;
  v7 = v5;
  [v6 performTransactionAndWait:v8];
}

void __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke(id *a1)
{
  v26[3] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E695D5E0];
  v3 = +[PLManagedAsset entityName];
  v4 = [v2 fetchRequestWithEntityName:v3];

  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"cloudLocalState == %d AND master == nil", 0];
  v6 = MEMORY[0x1E696AB28];
  v26[0] = v5;
  v7 = [a1[6] predicateForSupportedAssetTypesForUpload];
  v26[1] = v7;
  v8 = [a1[6] _syncablePredicate];
  v26[2] = v8;
  v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v26 count:3];
  v10 = [v6 andPredicateWithSubpredicates:v9];

  v25 = @"master";
  v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v25 count:1];
  [v4 setRelationshipKeyPathsForPrefetching:v11];

  v12 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:0];
  v24[0] = v12;
  v13 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"additionalAttributes.uploadAttempts" ascending:1];
  v24[1] = v13;
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v24 count:2];
  [v4 setSortDescriptors:v14];

  [v4 setPredicate:v10];
  v21 = 0;
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke_2;
  v18[3] = &unk_1E75781C0;
  v15 = a1[4];
  v19 = a1[5];
  v20 = a1[4];
  v16 = [v15 enumerateObjectsFromFetchRequest:v4 count:&v21 usingDefaultBatchSizeWithBlock:v18];
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 134217984;
      v23 = v21;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "cloudMaster creation done: %li", buf, 0xCu);
    }
  }
}

void __46__PLManagedAsset_CPL__createMastersInLibrary___block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v12 = *MEMORY[0x1E69E9840];
  [a2 createMasterIfNecessaryInLibrary:*(a1 + 32)];
  if (__ROR8__(0x8F5C28F5C28F5C29 * a3, 2) <= 0x28F5C28F5C28F5CuLL && [*(a1 + 40) hasChanges])
  {
    v5 = *(a1 + 40);
    v9 = 0;
    v6 = [v5 save:&v9];
    v7 = v9;
    if ((v6 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v11 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "failed to save after creating master for some assets %@", buf, 0xCu);
      }
    }
  }
}

- (void)removeSidecar:(id)a3
{
  v3 = a3;
  v4 = [v3 asset];
  [v4 deleteResourceForSidecarRepresentation:v3];
}

- (id)fileURLForHypotheticalSidecarFileWithFilename:(id)a3
{
  v16 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self pathForOriginalFile];
  v6 = v5;
  if (v5)
  {
    v7 = [v5 lastPathComponent];
    v8 = [v4 isEqualToString:v7];

    if ((v8 & 1) == 0)
    {
      v9 = [v6 stringByDeletingLastPathComponent];
      v10 = [v9 stringByAppendingPathComponent:v4];
      v11 = [MEMORY[0x1E695DFF8] fileURLWithPath:v10 isDirectory:0];

      goto LABEL_8;
    }
  }

  else
  {
    v12 = PLBackendGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      v14 = 138412290;
      v15 = self;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Unable to get original file path for %@", &v14, 0xCu);
    }
  }

  v11 = 0;
LABEL_8:

  return v11;
}

- (id)urlForSideCarImageFile
{
  v2 = [(PLManagedAsset *)self sidecarFileMatchingContentType:*MEMORY[0x1E6982E30] requireExactMatch:0 requireSort:1];
  v3 = [v2 fileURL];

  return v3;
}

- (BOOL)addSidecarFileAtIndex:(unint64_t)a3 sidecarURL:(id)a4 withFilename:(id)a5 compressedSize:(id)a6 captureDate:(id)a7 modificationDate:(id)a8 uniformTypeIdentifier:(id)a9 imageOrientation:(unsigned int)a10 pathManager:(id)a11
{
  v49 = *MEMORY[0x1E69E9840];
  v17 = a4;
  v18 = a5;
  v19 = a6;
  v20 = a7;
  v21 = a8;
  v22 = a9;
  v23 = a11;
  if (v23)
  {
    if (v18)
    {
      goto LABEL_3;
    }
  }

  else
  {
    v34 = [MEMORY[0x1E696AAA8] currentHandler];
    [v34 handleFailureInMethod:a2 object:self file:@"PLInternalResource+SidecarAdoption.m" lineNumber:245 description:{@"Invalid parameter not satisfying: %@", @"pathManager"}];

    if (v18)
    {
LABEL_3:
      if (v19)
      {
        goto LABEL_4;
      }

LABEL_17:
      v44 = 0;
      v35 = [v17 getResourceValue:&v44 forKey:*MEMORY[0x1E695DB50] error:0];
      v36 = v44;
      v37 = v36;
      if (v35)
      {
        v19 = v36;
      }

      if (v18)
      {
        goto LABEL_5;
      }

LABEL_20:
      v26 = 0;
      goto LABEL_21;
    }
  }

  v18 = [v17 lastPathComponent];
  if (!v19)
  {
    goto LABEL_17;
  }

LABEL_4:
  if (!v18)
  {
    goto LABEL_20;
  }

LABEL_5:
  v24 = [(PLManagedAsset *)self filename];
  v25 = [v18 isEqualToString:v24];

  v26 = 0;
  if (v17 && (v25 & 1) == 0 && v19)
  {
    v40 = v20;
    v27 = [(PLManagedAsset *)self pathForVideoComplementFile];
    v28 = [v27 lastPathComponent];
    v29 = [v18 isEqual:v28];

    if (v29)
    {
      v26 = 0;
      v20 = v40;
    }

    else
    {
      [MEMORY[0x1E696AD98] numberWithUnsignedInteger:a3];
      v30 = v42 = v21;
      v31 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:a10];
      v43 = 0;
      v26 = [PLResourceInstaller installSupplementalResourceForExistingFileAtURL:v17 ptpTrashedState:0 index:v30 forAsset:self imageOrientation:v31 resultingResource:0 error:&v43];
      v32 = v43;

      v20 = v40;
      v21 = v42;
      if (!v26)
      {
        v39 = v32;
        v33 = PLBackendGetLog();
        if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412546;
          v46 = v39;
          v47 = 2112;
          v48 = self;
          _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_ERROR, "Error: %@, while storing supplemental resource for asset: %@", buf, 0x16u);
        }

        v32 = v39;
      }
    }
  }

LABEL_21:

  return v26;
}

- (id)sidecarFileMatchingContentType:(id)a3 requireExactMatch:(BOOL)a4 requireSort:(BOOL)a5
{
  v25 = *MEMORY[0x1E69E9840];
  v8 = a3;
  if (a5)
  {
    [(PLManagedAsset *)self sortedSidecarFiles];
  }

  else
  {
    [(PLManagedAsset *)self sidecars];
  }

  v22 = 0u;
  v23 = 0u;
  v20 = 0u;
  v9 = v21 = 0u;
  v10 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v21;
    while (2)
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v21 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v20 + 1) + 8 * i);
        v15 = MEMORY[0x1E69C08F0];
        v16 = [v14 uniformTypeIdentifier];
        v17 = [v15 typeWithIdentifier:v16];

        if (v8 && v17)
        {
          if (a4)
          {
            if ([v17 isEqual:v8])
            {
              goto LABEL_18;
            }
          }

          else if ([v17 conformsToType:v8])
          {
LABEL_18:
            v18 = v14;

            goto LABEL_19;
          }
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v20 objects:v24 count:16];
      if (v11)
      {
        continue;
      }

      break;
    }
  }

  v18 = 0;
LABEL_19:

  return v18;
}

- (id)sidecarWithResourceObjectID:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self modernResources];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __63__PLManagedAsset_SidecarAdoption__sidecarWithResourceObjectID___block_invoke;
  v10[3] = &unk_1E7577AB0;
  v11 = v4;
  v6 = v4;
  v7 = [v5 _pl_firstObjectPassingTest:v10];

  v8 = [v7 sidecarRepresentation];

  return v8;
}

uint64_t __63__PLManagedAsset_SidecarAdoption__sidecarWithResourceObjectID___block_invoke(uint64_t a1, void *a2)
{
  v3 = [a2 objectID];
  v4 = [v3 isEqual:*(a1 + 32)];

  return v4;
}

- (NSArray)sortedSidecarFiles
{
  if (sortedSidecarFiles_s_onceToken != -1)
  {
    dispatch_once(&sortedSidecarFiles_s_onceToken, &__block_literal_global_53101);
  }

  v3 = [(PLManagedAsset *)self sidecars];
  v4 = [v3 sortedArrayUsingDescriptors:sortedSidecarFiles_s_descriptors];

  return v4;
}

void __53__PLManagedAsset_SidecarAdoption__sortedSidecarFiles__block_invoke()
{
  v3[1] = *MEMORY[0x1E69E9840];
  v0 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"index" ascending:1];
  v3[0] = v0;
  v1 = [MEMORY[0x1E695DEC8] arrayWithObjects:v3 count:1];
  v2 = sortedSidecarFiles_s_descriptors;
  sortedSidecarFiles_s_descriptors = v1;
}

- (id)sidecars
{
  v17 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = [(PLManagedAsset *)self modernResources];
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 canRepresentAsSidecar])
        {
          v10 = [v9 sidecarRepresentation];
          [v3 addObject:v10];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v6);
  }

  return v3;
}

- (BOOL)installSparseFullStageComputeSyncResourceIfNeeded
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self computeSyncAttributes];
  v4 = [v3 cloudComputeStateVersion];
  v5 = [v3 cloudComputeStateAdjustmentFingerprint];
  v6 = [(PLManagedAsset *)self _shouldIngestComputeSyncFromCloudWithCloudVersion:v4 cloudAdjustmentFingerprint:v5 currentMajorVersion:1];

  if (v6)
  {
    v13 = 0;
    v7 = [(PLManagedAsset *)self _installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:1 error:&v13];
    v8 = v13;

    v9 = v7 != 0;
    if (!v7 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v10 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        v11 = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138412546;
        v15 = v8;
        v16 = 2114;
        v17 = v11;
        _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "[CCSS][Migration] Failed to install empty compute sync resource %@ for asset %{public}@", buf, 0x16u);
      }
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)applyComputeSyncPayloadWithComputeStateRecord:(id)a3 originatedFromPrefetch:(BOOL)a4 error:(id *)a5
{
  v6 = a4;
  v32 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = [v8 fileURL];

  if (!v9)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138543362;
        v29 = v22;
        v23 = "[CCSS] Nil fileURL from compute state record to asset %{public}@";
LABEL_16:
        _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_ERROR, v23, buf, 0xCu);
      }

LABEL_17:
    }

LABEL_18:
    v16 = 0;
LABEL_19:
    v24 = v16;
    v19 = v24;
    if (a5)
    {
      v25 = v24;
      v20 = 0;
      *a5 = v19;
    }

    else
    {
      v20 = 0;
    }

    goto LABEL_22;
  }

  v10 = MEMORY[0x1E695DEF0];
  v11 = [v8 fileURL];
  v12 = [v11 path];
  v13 = [v10 dataWithContentsOfFile:v12];

  if (!v13)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v21 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        v22 = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138543362;
        v29 = v22;
        v23 = "[CCSS] Nil data read from compute state record to asset %{public}@";
        goto LABEL_16;
      }

      goto LABEL_17;
    }

    goto LABEL_18;
  }

  v14 = objc_opt_new();
  v27 = 0;
  v15 = [v14 applyComputeSyncWrapperData:v13 toAsset:self error:&v27];
  v16 = v27;

  if (!v15)
  {
    goto LABEL_19;
  }

  if (![PLComputeSyncAttributes updateLocalComputeSyncAttributesForAsset:self cloudRecordComputeState:v8 originatedFromPrefetch:v6]&& (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v17 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      v18 = [(PLManagedAsset *)self scopedIdentifier];
      *buf = 138412546;
      v29 = v8;
      v30 = 2114;
      v31 = v18;
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "[CCSS] Failed to extract version from cloudVersion: %@, asset: %{public}@", buf, 0x16u);
    }
  }

  v19 = v16;
  v20 = 1;
LABEL_22:

  return v20;
}

- (void)updateComputeSyncResourceAfterDownloadWithResource:(id)a3 onDemandDownload:(BOOL)a4
{
  v4 = a4;
  v33 = *MEMORY[0x1E69E9840];
  v7 = a3;
  if (!v7)
  {
    v23 = [MEMORY[0x1E696AAA8] currentHandler];
    [v23 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+ComputeSync.m" lineNumber:383 description:{@"Invalid parameter not satisfying: %@", @"computeSyncResource"}];
  }

  v8 = [(PLManagedAsset *)self pathForComputeSyncWrapperFile];
  v9 = [(PLManagedAsset *)self scopedIdentifier];
  [v7 markAsLocallyAvailableWithFilePath:v8];
  v10 = [MEMORY[0x1E696AC08] defaultManager];
  v26 = 0;
  v11 = [v10 attributesOfItemAtPath:v8 error:&v26];
  v12 = v26;

  if (v11)
  {
    [v7 setDataLength:{objc_msgSend(v11, "fileSize")}];
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v13 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412802;
      v28 = v8;
      v29 = 2114;
      v30 = v9;
      v31 = 2112;
      v32 = v12;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "[CCSS] Unable to extract attributes for file %@ asset %{public}@: %@", buf, 0x20u);
    }
  }

  v14 = [v7 fileURL];
  if (v14 && (-[PLManagedObject pathManager](self, "pathManager"), v15 = objc_claimAutoreleasedReturnValue(), [v15 capabilities], v16 = objc_claimAutoreleasedReturnValue(), v17 = objc_msgSend(v16, "isCentralizedCacheDeleteCapable"), v16, v15, v17))
  {
    v24 = v12;
    v25 = 0;
    v18 = [PLCacheDeleteSupport markPurgeableForFileAtURL:v14 withUrgency:v4 outInode:&v25 error:&v24];
    v19 = v24;

    if (v18)
    {
      if (!v25)
      {
        v22 = PLResourceCachingGetLog();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v28 = v14;
          _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_ERROR, "Unexpected inode value of 0 for %@", buf, 0xCu);
        }

        v21 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Unexpected inode value of 0 for %@", v14];
        PLSimulateCrash();
        goto LABEL_24;
      }

      v20 = [v7 fileID];
      if (v20 != v25)
      {
        [v7 setFileID:?];
      }

      if (v4)
      {
        v21 = [MEMORY[0x1E695DF00] date];
        [v7 setCloudLastOnDemandDownloadDate:v21];
LABEL_24:
      }
    }

    else if (PLIsErrorEqualToCode())
    {
      [v7 markAsNotLocallyAvailable];
    }
  }

  else
  {
    v19 = v12;
  }
}

- (BOOL)copyComputeSyncResourceFromCPLFilePath:(id)a3 error:(id *)a4
{
  v28 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = [(PLManagedAsset *)self pathForComputeSyncWrapperFile];
  v8 = MEMORY[0x1E69BF238];
  v9 = [MEMORY[0x1E695DFF8] fileURLWithPath:v6];
  v10 = [MEMORY[0x1E695DFF8] fileURLWithPath:v7];
  v11 = [(PLManagedObject *)self pathManager];
  v12 = [v11 capabilities];
  v19 = 0;
  v13 = [v8 ingestItemAtURL:v9 toURL:v10 type:1 options:14 capabilities:v12 error:&v19];
  v14 = v19;

  if ((v13 & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        v16 = [(PLManagedAsset *)self scopedIdentifier];
        *buf = 138413058;
        v21 = v6;
        v22 = 2112;
        v23 = v7;
        v24 = 2112;
        v25 = v14;
        v26 = 2114;
        v27 = v16;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Failed to copy from file %@ to file %@ with error: %@ %{public}@", buf, 0x2Au);
      }
    }

    if (a4)
    {
      v17 = v14;
      *a4 = v14;
    }
  }

  return v13;
}

- (id)_installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:(BOOL)a3 error:(id *)a4
{
  v5 = a3;
  v22 = *MEMORY[0x1E69E9840];
  v7 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_110_56511];
  if (v7)
  {
    v8 = v7;
    v9 = 0;
    goto LABEL_4;
  }

  v10 = [PLResourceRecipe recipeFromID:327689];
  v17 = 0;
  v8 = [PLResourceInstaller onDemand_installEmptyComputeResourceWithRecipe:v10 forAsset:self error:&v17];
  v9 = v17;

  if (v8)
  {
LABEL_4:
    if (v5 && [v8 isLocallyAvailable])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v11 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          v12 = [(PLManagedAsset *)self scopedIdentifier];
          v13 = [v8 singleLineDescription];
          *buf = 138543618;
          v19 = v12;
          v20 = 2112;
          v21 = v13;
          _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "[CCSS] Removing existing ComputeSync local file on asset %{public}@ since we've chosen to install another one from the cloud: %@", buf, 0x16u);
        }
      }

      [(PLManagedAsset *)self removeLocalFileForResource:v8 allowDCIMPath:1];
      [v8 markAsNotLocallyAvailable];
    }

    [v8 resetPrefetchState];
    [v8 setRemoteAvailability:1];
    goto LABEL_12;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v19 = v9;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Failed to install empty compute sync resource with error: %@", buf, 0xCu);
    }
  }

  if (a4)
  {
    v16 = v9;
    v8 = 0;
    *a4 = v9;
  }

  else
  {
    v8 = 0;
  }

LABEL_12:

  return v8;
}

- (BOOL)_shouldIngestComputeSyncFromCloudWithCloudVersion:(id)a3 cloudAdjustmentFingerprint:(id)a4 currentMajorVersion:(unint64_t)a5
{
  v35 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = MEMORY[0x1E696AD60];
  v11 = [(PLManagedAsset *)self scopedIdentifier];
  v12 = [v10 stringWithFormat:@"[CCSS] Consumption policy for %@ with cloudVersion %@ and cloudAdjustmentFingerprint %@", v11, v8, v9];

  if (_shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__onceToken != -1)
  {
    dispatch_once(&_shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__onceToken, &__block_literal_global_69);
  }

  if (_shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__ignoreShouldIngestChecks != 1)
  {
    v15 = [(PLManagedAsset *)self additionalAttributes];
    v16 = [v15 adjustedStableHash];
    if ([v16 length])
    {
    }

    else
    {
      v17 = [v9 length];

      if (!v17)
      {
        goto LABEL_12;
      }
    }

    v18 = [(PLManagedAsset *)self additionalAttributes];
    v19 = [v18 adjustedStableHash];
    v20 = [v9 isEqualToString:v19];

    if ((v20 & 1) == 0)
    {
      v25 = [(PLManagedAsset *)self additionalAttributes];
      v26 = [v25 adjustedStableHash];
      [v12 appendFormat:@", cloudAdjustmentFingerprint does not match local adjustedStableHash %@. Overall decision: NO", v26];

      if (*MEMORY[0x1E6994D48])
      {
        v14 = 0;
        goto LABEL_41;
      }

      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 138412290;
        v32 = v12;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "%@", buf, 0xCu);
      }

      v14 = 0;
      goto LABEL_40;
    }

LABEL_12:
    v13 = [objc_alloc(MEMORY[0x1E6994B78]) initWithString:v8];
    if (![v13 majorVersion])
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v27 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_ERROR))
        {
          v28 = [(PLManagedAsset *)self scopedIdentifier];
          *buf = 138412546;
          v32 = v13;
          v33 = 2112;
          v34 = v28;
          _os_log_impl(&dword_19BF1F000, v27, OS_LOG_TYPE_ERROR, "[CCSS] Failed to extract non-zero MajorVersion from cloudVersion: %@, asset: %@", buf, 0x16u);
        }
      }

      goto LABEL_35;
    }

    v21 = [v13 majorVersion];
    v22 = [v13 stage];
    v23 = [(PLManagedAsset *)self computeSyncAttributes];
    v24 = [v23 localAnalysisStage];

    if (v21 == a5)
    {
      [v12 appendFormat:@", CloudVersion == Runtime(%d), VersionDecision: YES", 2];
      if (v22 == v24)
      {
        [v12 appendFormat:@", CloudAssetStage == Local(%zu), StageDecision: NO", v22];
LABEL_35:
        v14 = 0;
        goto LABEL_36;
      }

      if (v22 <= v24)
      {
        [v12 appendFormat:@", CloudAssetStage < Local(%zu), StageDecision: NO", v24];
        goto LABEL_35;
      }

      if (v22 >= 0x3B7)
      {
        [v12 appendFormat:@", CloudAssetStage > PLManagedAssetComputeSyncHighestAllowedStage Local(%zu), StageDecision: NO", v24];
        goto LABEL_35;
      }
    }

    else
    {
      if (v21 > a5)
      {
        [v12 appendFormat:@", CloudVersion > Runtime(%d), VersionDecision: NO", 2];
        goto LABEL_35;
      }

      [v12 appendFormat:@", CloudVersion < Runtime(%d), VersionDecision: YES", 2];
      v14 = 0;
      if (v24 || v22 <= v24)
      {
LABEL_36:
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v29 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v29, OS_LOG_TYPE_DEBUG))
          {
            *buf = 138412290;
            v32 = v12;
            _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_DEBUG, "%@", buf, 0xCu);
          }
        }

        goto LABEL_40;
      }

      v24 = 0;
    }

    [v12 appendFormat:@", CloudAssetStage > Local(%zu), StageDecision: YES", v24];
    [v12 appendFormat:@", Overall decision: %@", @"YES"];
    v14 = 1;
    goto LABEL_36;
  }

  [v12 appendString:@", Ignoring actual policy since PLCCSSIgnoreShouldIngestChecks is set. Overall decision override: YES"];
  if (*MEMORY[0x1E6994D48])
  {
    v14 = 1;
    goto LABEL_41;
  }

  v13 = __CPLAssetsdOSLogDomain();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
  {
    *buf = 138412290;
    v32 = v12;
    _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "%@", buf, 0xCu);
  }

  v14 = 1;
LABEL_40:

LABEL_41:
  return v14;
}

void __128__PLManagedAsset_ComputeSync___shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  _shouldIngestComputeSyncFromCloudWithCloudVersion_cloudAdjustmentFingerprint_currentMajorVersion__ignoreShouldIngestChecks = [v0 BOOLForKey:@"PLCCSSIgnoreShouldIngestChecks"];
}

- (BOOL)_shouldInstallComputeSyncResourceFromCloudWithCPLAssetChange:(id)a3
{
  v4 = a3;
  v5 = [v4 computeStateVersion];
  v6 = [v4 computeStateAdjustmentFingerprint];

  if ([v5 length])
  {
    v7 = [(PLManagedAsset *)self _shouldIngestComputeSyncFromCloudWithCloudVersion:v5 cloudAdjustmentFingerprint:v6 currentMajorVersion:2];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)shouldDownloadComputeSyncPayload
{
  v13 = *MEMORY[0x1E69E9840];
  if (shouldDownloadComputeSyncPayload_onceToken != -1)
  {
    dispatch_once(&shouldDownloadComputeSyncPayload_onceToken, &__block_literal_global_59);
  }

  if (shouldDownloadComputeSyncPayload_disallowComputeSyncPayloadDownload == 1)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v3 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_DEFAULT))
      {
        v4 = [(PLManagedAsset *)self scopedIdentifier];
        v11 = 138412290;
        v12 = v4;
        _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_DEFAULT, "[CCSS] Returning NO for shouldDownloadComputeSyncPayload as PLCCSSDisallowComputeSyncPayloadDownload is set. Asset: %@", &v11, 0xCu);
      }
    }

    return 0;
  }

  else
  {
    v6 = [(PLManagedAsset *)self computeSyncAttributes];
    v7 = [v6 cloudComputeStateVersion];

    v8 = [(PLManagedAsset *)self computeSyncAttributes];
    v9 = [v8 cloudComputeStateAdjustmentFingerprint];

    if ([v7 length])
    {
      v5 = [(PLManagedAsset *)self _shouldIngestComputeSyncFromCloudWithCloudVersion:v7 cloudAdjustmentFingerprint:v9 currentMajorVersion:2];
    }

    else
    {
      v5 = 0;
    }
  }

  return v5;
}

void __63__PLManagedAsset_ComputeSync__shouldDownloadComputeSyncPayload__block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  shouldDownloadComputeSyncPayload_disallowComputeSyncPayloadDownload = [v0 BOOLForKey:@"PLCCSSDisallowComputeSyncPayloadDownload"];
}

- (void)applyComputeSyncPropertiesFromAssetChange:(id)a3 inLibrary:(id)a4 didInstallComputeSyncResource:(BOOL *)a5 computeSyncDownloadEnabled:(BOOL)a6
{
  v6 = a6;
  v21 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = [v9 computeStateVersion];
  v11 = [v9 computeStateAdjustmentFingerprint];
  v12 = [v9 computeStateLastUpdatedDate];
  [PLComputeSyncAttributes updateCloudComputeSyncAttributesForAsset:self cloudVersion:v10 cloudAdjustmentFingerprint:v11 cloudLastUpdatedDate:v12];

  if (v6 && [(PLManagedAsset *)self _shouldInstallComputeSyncResourceFromCloudWithCPLAssetChange:v9])
  {
    v16 = 0;
    v13 = [(PLManagedAsset *)self _installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:1 error:&v16];
    v14 = v16;

    if (v13)
    {
      if (a5)
      {
        *a5 = 1;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v18 = v14;
        v19 = 2112;
        v20 = v9;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Failed to install empty compute sync resource %@ from asset change %@", buf, 0x16u);
      }
    }
  }
}

- (id)_currentComputeStateVersion
{
  v3 = MEMORY[0x1E696AEC0];
  v4 = [(PLManagedAsset *)self computeSyncAttributes];
  v5 = [v4 localAnalysisMajorVersion];
  v6 = [(PLManagedAsset *)self computeSyncAttributes];
  v7 = [v3 stringWithFormat:@"%i.%i", v5, objc_msgSend(v6, "localAnalysisStage")];

  return v7;
}

- (BOOL)shouldPushComputeSync
{
  v14 = objc_opt_class();
  v15 = [(PLManagedAsset *)self computeSyncAttributes];
  v3 = [v15 localAnalysisMajorVersion];
  v4 = [(PLManagedAsset *)self computeSyncAttributes];
  v5 = [v4 localAnalysisStage];
  v6 = [(PLManagedAsset *)self computeSyncAttributes];
  v7 = [v6 cloudComputeStateVersion];
  v8 = [(PLManagedAsset *)self additionalAttributes];
  v9 = [v8 adjustedStableHash];
  v10 = [(PLManagedAsset *)self computeSyncAttributes];
  v11 = [v10 cloudComputeStateAdjustmentFingerprint];
  v12 = [(PLManagedAsset *)self scopedIdentifier];
  LOBYTE(v3) = [v14 _shouldPushComputeSyncWithLocalMajorVersion:v3 localAnalaysisStage:v5 cloudComputeStateVersionStr:v7 localAdjustmentFingerprint:v9 cloudAdjustmentFingerprint:v11 scopedIdentifier:v12];

  return v3;
}

- (BOOL)installComputeSyncResourceAfterAttachtoCPLWithError:(id *)a3
{
  v7 = 0;
  v4 = [(PLManagedAsset *)self _installOrUpdateExistingComputeSyncResourceToIndicateRemoteAvailabilityShouldRemoveLocalFile:0 error:&v7];
  v5 = v7;
  if (v4)
  {
    [(PLManagedAsset *)self updateComputeSyncResourceAfterDownloadWithResource:v4 onDemandDownload:0];
    [v4 setCloudPrefetchCount:10];
  }

  return 1;
}

- (void)deleteComputeSyncResourceIfExists
{
  v11 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_56566];
  if (v3)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v4 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
      {
        v5 = [(PLManagedAsset *)self scopedIdentifier];
        v6 = [v3 singleLineDescription];
        v7 = 138543618;
        v8 = v5;
        v9 = 2112;
        v10 = v6;
        _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEFAULT, "[CCSS] Removing existing ComputeSync resource on asset %{public}@: %@", &v7, 0x16u);
      }
    }

    [(PLManagedAsset *)self removeLocalFileForResource:v3 allowDCIMPath:1];
    [v3 deleteResource];
  }
}

+ (BOOL)markUnavailableComputeSyncResourcesWithManagedObjectContext:(id)a3 error:(id *)a4
{
  v25[2] = *MEMORY[0x1E69E9840];
  v5 = MEMORY[0x1E695D560];
  v6 = a3;
  v7 = [v5 alloc];
  v8 = +[PLInternalResource entityName];
  v9 = [v7 initWithEntityName:v8];

  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"recipeID", 327689];
  [v9 setPredicate:v10];

  [v9 setResultType:2];
  v24[0] = @"localAvailability";
  v24[1] = @"dataStoreKeyData";
  v25[0] = &unk_1F0FBCEB0;
  v11 = [MEMORY[0x1E695DFB0] null];
  v25[1] = v11;
  v12 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v25 forKeys:v24 count:2];
  [v9 setPropertiesToUpdate:v12];

  v21 = 0;
  v13 = [v6 executeRequest:v9 error:&v21];

  v14 = v21;
  if (v13)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        v16 = [v13 result];
        *buf = 138412290;
        v23 = v16;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEFAULT, "Marked unavailable %@ compute sync resources", buf, 0xCu);
      }
    }

    v17 = v14;
    if (a4)
    {
      *a4 = v17;
    }
  }

  else
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v18 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v23 = v14;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "Failed to mark unavailble compute sync resources: %@", buf, 0xCu);
      }
    }

    v19 = v14;
  }

  return v13 != 0;
}

+ (BOOL)_checkComputeSyncUploadPolicyWithCPLConfiguration:(id)a3 library:(id)a4 debugMode:(BOOL)a5 debugLog:(id)a6
{
  v7 = a5;
  v40 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a6;
  v12 = MEMORY[0x1E69BF188];
  v13 = [v10 pathManager];
  v14 = [v13 libraryURL];
  v15 = [v12 appPrivateDataForLibraryURL:v14];

  v16 = [v15 valueForKey:@"ComputeSyncUploadPolicy.cachedResult"];
  if (_checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__onceToken != -1)
  {
    dispatch_once(&_checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__onceToken, &__block_literal_global_198_56586);
  }

  if (_checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__skipComputeSyncUploadPolicyChecks != 1)
  {
    if (!v16)
    {
      goto LABEL_12;
    }

    if ([v16 BOOLValue])
    {
      if (!v7)
      {
        goto LABEL_5;
      }

      [v11 appendFormat:@"%@: %@ %@\n", @"Policy: Cached result", @"YES", &stru_1F0F06D80];
    }

    else
    {
      [v11 appendFormat:@"%@: %@ %@\n", @"Policy: Cached result", @"NO", @"policyCachedResult is NO"];
    }

    if (([v16 BOOLValue] & 1) == 0)
    {
      v18 = [v15 valueForKey:@"ComputeSyncUploadPolicy.lastCheckedDate"];
      v19 = v18;
      if (v18)
      {
        [v18 timeIntervalSinceNow];
        v21 = fabs(v20);
        if (v21 < 86400.0 && !v7)
        {

          goto LABEL_43;
        }

        v17 = v21 < 86400.0;
        if (v21 < 86400.0)
        {
          v22 = @"NO";
        }

        else
        {
          v22 = @"YES";
        }

        [v11 appendFormat:@"%@: %@ %@\n", @"Policy: Last checked date", v22, v19];
      }

      else
      {
        v17 = 0;
      }
    }

    else
    {
LABEL_12:
      v17 = 0;
    }

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __108__PLManagedAsset_ComputeSync___checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog___block_invoke_2;
    aBlock[3] = &unk_1E756E378;
    v37 = v7;
    v36 = v15;
    v23 = _Block_copy(aBlock);
    v24 = [v9 valueForKey:@"feature.computesync.policy.minassetcount"];
    v25 = [v24 unsignedIntegerValue];

    if (!v25)
    {
      v25 = 10000;
    }

    v26 = [PLManagedAsset iCPLAssetCountInPhotoLibrary:v10];
    if (v26 >= v25)
    {
      v30 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Threshold: %tu, Count: %tu", v25, v26];
      v31 = v30;
      if (v30)
      {
        v32 = v30;
      }

      else
      {
        v32 = &stru_1F0F06D80;
      }

      [v11 appendFormat:@"%@: %@ %@\n", @"Policy: Asset threshold", @"YES", v32];

      if (!v17)
      {
        v33 = 1;
        v23[2](v23, 1);
        goto LABEL_41;
      }
    }

    else
    {
      v23[2](v23, 0);
      v27 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Threshold: %tu, Count: %tu", v25, v26];
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v28 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v39 = v27;
          _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_DEFAULT, "[CCSS] Upload policy check: Caching NO due to asset count threshold. %@", buf, 0xCu);
        }
      }

      if (!v7)
      {

LABEL_42:
        goto LABEL_43;
      }

      v29 = &stru_1F0F06D80;
      if (v27)
      {
        v29 = v27;
      }

      [v11 appendFormat:@"%@: %@ %@\n", @"Policy: Asset threshold", @"NO", v29];
    }

    v33 = 0;
LABEL_41:
    LOBYTE(v7) = v33 | v7 ^ 1;
    goto LABEL_42;
  }

  [v11 appendFormat:@"%@: %@ %@\n", @"Policy: Override policy checks (PLCCSSSkipUploadPolicyChecks)", @"YES", &stru_1F0F06D80];
LABEL_5:
  LOBYTE(v7) = 1;
LABEL_43:

  return v7;
}

void __108__PLManagedAsset_ComputeSync___checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog___block_invoke_2(uint64_t a1, uint64_t a2)
{
  v18 = *MEMORY[0x1E69E9840];
  if ((*(a1 + 40) & 1) == 0)
  {
    v4 = *(a1 + 32);
    v5 = [MEMORY[0x1E695DF00] now];
    v15 = 0;
    v6 = [v4 setValue:v5 forKey:@"ComputeSyncUploadPolicy.lastCheckedDate" error:&v15];
    v7 = v15;

    v8 = MEMORY[0x1E6994D48];
    if ((v6 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v17 = v7;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_ERROR, "[CCSS] Policy: Failed to persist date to app private data: %@", buf, 0xCu);
      }
    }

    v10 = *(a1 + 32);
    v11 = [MEMORY[0x1E696AD98] numberWithBool:a2];
    v14 = v7;
    LOBYTE(v10) = [v10 setValue:v11 forKey:@"ComputeSyncUploadPolicy.cachedResult" error:&v14];
    v12 = v14;

    if ((v10 & 1) == 0 && (*v8 & 1) == 0)
    {
      v13 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v17 = v12;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "[CCSS] Policy: Failed to persist number to app private data: %@", buf, 0xCu);
      }
    }
  }
}

void __108__PLManagedAsset_ComputeSync___checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  _checkComputeSyncUploadPolicyWithCPLConfiguration_library_debugMode_debugLog__skipComputeSyncUploadPolicyChecks = [v0 BOOLForKey:@"PLCCSSSkipUploadPolicyChecks"];
}

+ (BOOL)isComputeSyncEnabledForDirection:(int64_t)a3 library:(id)a4 debugMode:(BOOL)a5 debugLog:(id *)a6
{
  v7 = a5;
  v65 = *MEMORY[0x1E69E9840];
  v10 = a4;
  v11 = objc_alloc(MEMORY[0x1E696AD60]);
  v12 = a3 != 0;
  v13 = @"upload";
  if (a3)
  {
    v13 = @"download";
  }

  v14 = [v11 initWithFormat:@"Compute Sync enabled check for direction: %@", v13];
  if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__onceToken == -1)
  {
    if (a3)
    {
      goto LABEL_5;
    }

LABEL_15:
    if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSUpload == 1)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v18 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEBUG))
        {
          *buf = 0;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEBUG, "[CCSS] Upload disabled using PLCCSSDisableComputeSyncUpload default", buf, 2u);
        }
      }

      if ((v7 & 1) == 0)
      {
LABEL_58:
        LOBYTE(v7) = 0;
        goto LABEL_86;
      }

      v16 = @"PLCCSSDisableComputeSyncUpload set";
LABEL_22:
      [v14 appendFormat:@"%@: %@ %@\n", @"UserDefault", @"NO", v16];
      v17 = 1;
      goto LABEL_24;
    }

LABEL_23:
    v12 = 0;
    v17 = 0;
    goto LABEL_24;
  }

  dispatch_once(&isComputeSyncEnabledForDirection_library_debugMode_debugLog__onceToken, &__block_literal_global_141_56625);
  if (!a3)
  {
    goto LABEL_15;
  }

LABEL_5:
  if (a3 != 1)
  {
    goto LABEL_23;
  }

  if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSDownload == 1)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEBUG, "[CCSS] Download disabled using PLCCSSDisableComputeSyncDownload default", buf, 2u);
      }
    }

    if (!v7)
    {
      goto LABEL_86;
    }

    v16 = @"PLCCSSDisableComputeSyncDownload set";
    goto LABEL_22;
  }

  v17 = 0;
  v12 = 1;
LABEL_24:
  if (PLPlatformComputeSyncSupported())
  {
    v58 = v17;
    v19 = v7;
    v56 = a1;
    v20 = @"YES";
LABEL_32:
    [v14 appendFormat:@"%@: %@ %@\n", @"Platform supported", v20, &stru_1F0F06D80];
    v22 = [v10 libraryServicesManager];
    v23 = [v22 isSystemPhotoLibrary];

    v24 = @"YES";
    if (v23)
    {
      goto LABEL_39;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v25 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "[CCSS] Compute sync is only supporrted on the System Photo Library; disabling compute sync", buf, 2u);
      }
    }

    if (v19)
    {
      v58 = 1;
      v24 = @"NO";
LABEL_39:
      v57 = a6;
      [v14 appendFormat:@"%@: %@ %@\n", @"Is SPL", v24, &stru_1F0F06D80];
      if (v12)
      {
        [v14 appendFormat:@"%@: %@ %@\n", @"Download allowed", @"YES", @"reason: Not DawnBurstG"];
      }

      v26 = v10;
      v27 = [v10 libraryServicesManager];
      v28 = [v27 cloudPhotoLibraryManager];
      v29 = [v28 cplConfiguration];

      v30 = [v27 cloudPhotoLibraryManager];
      v31 = [v30 cplStatus];
      v32 = [v31 isKeychainCDPEnabled];

      v33 = @"YES";
      v7 = v19;
      if ((v32 & 1) == 0)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v34 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v34, OS_LOG_TYPE_DEBUG))
          {
            *buf = 0;
            _os_log_impl(&dword_19BF1F000, v34, OS_LOG_TYPE_DEBUG, "[CCSS] Device keychain CDP is disabled; disabling compute sync", buf, 2u);
          }
        }

        if (!v19)
        {
          v42 = v29;
          v10 = v26;
          goto LABEL_85;
        }

        v58 = 1;
        v33 = @"NO";
      }

      [v14 appendFormat:@"%@: %@ %@\n", @"Device CDP", v33, &stru_1F0F06D80];
      v35 = @"feature.version.computesync.upload";
      v36 = @"upload";
      if (a3)
      {
        v36 = 0;
        v35 = 0;
      }

      if (a3 == 1)
      {
        v37 = @"download";
      }

      else
      {
        v37 = v36;
      }

      if (a3 == 1)
      {
        v38 = @"feature.version.computesync.download";
      }

      else
      {
        v38 = v35;
      }

      v55 = v29;
      v39 = [v29 valueForKey:v38];
      v40 = [v39 unsignedIntValue];

      if (isComputeSyncEnabledForDirection_library_debugMode_debugLog__skipServerFFChecks == 1)
      {
        [v14 appendFormat:@"%@: %@ %@\n", @"Force enabling compute sync & skipping server FF check (PLCCSSSkipServerFFCheck): ", @"YES", &stru_1F0F06D80];
        v41 = v57;
        v42 = v29;
        v10 = v26;
      }

      else
      {
        v43 = v40;
        v10 = v26;
        if (v40 >= 3)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v44 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v44, OS_LOG_TYPE_DEBUG))
            {
              *buf = 134218498;
              v60 = 2;
              v61 = 2048;
              v62 = v43;
              v63 = 2114;
              v64 = v37;
              _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_DEBUG, "[CCSS] Client release version is %zd and server minimum release version is %zd. Disabled compute sync %{public}@ since client release version is less than server minimum release version", buf, 0x20u);
            }
          }

          v45 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Client version is %zd, server version is %zd", 2, v43];
          v46 = v45;
          v41 = v57;
          if (!v19)
          {

            v42 = v55;
            goto LABEL_85;
          }

          if (v45)
          {
            v47 = v45;
          }

          else
          {
            v47 = &stru_1F0F06D80;
          }

          [v14 appendFormat:@"%@: %@ %@\n", @"Server FF", @"NO", v47];

          v48 = 1;
          v42 = v55;
          if (!a3)
          {
            goto LABEL_76;
          }

          goto LABEL_81;
        }

        v49 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Client version is %zd, server version is %zd", 2, v40];
        v50 = v49;
        if (v49)
        {
          v51 = v49;
        }

        else
        {
          v51 = &stru_1F0F06D80;
        }

        [v14 appendFormat:@"%@: %@ %@\n", @"Server FF", @"YES", v51];

        v41 = v57;
        v42 = v55;
      }

      v48 = v58;
      if (!a3)
      {
LABEL_76:
        v52 = [v56 _checkComputeSyncUploadPolicyWithCPLConfiguration:v42 library:v10 debugMode:v7 debugLog:v14];
        if ((v52 & 1) != 0 || v7)
        {
          v48 |= v52 ^ 1;
          v53 = @"NO";
          if (v52)
          {
            v53 = @"YES";
          }

          [v14 appendFormat:@"%@: %@ %@\n", @"Policy: Overall", v53, &stru_1F0F06D80];
          goto LABEL_81;
        }

LABEL_85:

        goto LABEL_86;
      }

LABEL_81:
      if (v41 && v7)
      {
        *v41 = [v14 copy];
      }

      LOBYTE(v7) = v48 & v7 ^ 1;
      goto LABEL_85;
    }

    goto LABEL_58;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v21 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_DEBUG))
    {
      *buf = 0;
      _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEBUG, "[CCSS] Compute sync is currently unsupported on watchOS; disabling compute sync", buf, 2u);
    }
  }

  if (v7)
  {
    v19 = v7;
    v56 = a1;
    v58 = 1;
    v20 = @"NO";
    goto LABEL_32;
  }

LABEL_86:

  return v7;
}

void __91__PLManagedAsset_ComputeSync__isComputeSyncEnabledForDirection_library_debugMode_debugLog___block_invoke()
{
  v0 = [MEMORY[0x1E695E000] standardUserDefaults];
  isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSUpload = [v0 BOOLForKey:@"PLCCSSDisableComputeSyncUpload"];

  v1 = [MEMORY[0x1E695E000] standardUserDefaults];
  isComputeSyncEnabledForDirection_library_debugMode_debugLog__disableCCSSDownload = [v1 BOOLForKey:@"PLCCSSDisableComputeSyncDownload"];

  v2 = [MEMORY[0x1E695E000] standardUserDefaults];
  isComputeSyncEnabledForDirection_library_debugMode_debugLog__skipServerFFChecks = [v2 BOOLForKey:@"PLCCSSSkipServerFFCheck"];
}

+ (BOOL)_shouldPushComputeSyncWithLocalMajorVersion:(signed __int16)a3 localAnalaysisStage:(signed __int16)a4 cloudComputeStateVersionStr:(id)a5 localAdjustmentFingerprint:(id)a6 cloudAdjustmentFingerprint:(id)a7 scopedIdentifier:(id)a8
{
  v11 = a4;
  v12 = a3;
  v38 = *MEMORY[0x1E69E9840];
  v13 = a6;
  v14 = a7;
  v15 = a8;
  if (a5)
  {
    v16 = MEMORY[0x1E6994B78];
    v17 = a5;
    v18 = [[v16 alloc] initWithString:v17];

    v19 = [objc_alloc(MEMORY[0x1E6994B78]) initWithMajorVersion:v12 stage:v11];
    v20 = [v19 compare:v18];
    if (v20 == -1)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v22 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_DEBUG))
        {
          v28 = 138543874;
          v29 = v15;
          v30 = 2112;
          v31 = v18;
          v32 = 2112;
          v33 = v19;
          v23 = "[CCSS] Not pushing compute sync payload for %{public}@. Cloud version %@ is higher than local version %@";
          v24 = v22;
          v25 = OS_LOG_TYPE_DEBUG;
          v26 = 32;
LABEL_16:
          _os_log_impl(&dword_19BF1F000, v24, v25, v23, &v28, v26);
        }

LABEL_17:
      }
    }

    else
    {
      if (v20)
      {
LABEL_7:
        v21 = 1;
LABEL_19:

        goto LABEL_20;
      }

      if (v13 && v14)
      {
        if (([v13 isEqual:v14] & 1) == 0)
        {
          goto LABEL_7;
        }
      }

      else if (v13 | v14)
      {
        goto LABEL_7;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v22 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT))
        {
          v28 = 138544386;
          v29 = v15;
          v30 = 2112;
          v31 = v19;
          v32 = 2112;
          v33 = v13;
          v34 = 2112;
          v35 = v18;
          v36 = 2112;
          v37 = v14;
          v23 = "[CCSS] Not pushing compute sync payload for %{public}@. Versions match and adjustment fingerprints match, Local: %@ %@, Cloud: %@ %@";
          v24 = v22;
          v25 = OS_LOG_TYPE_DEFAULT;
          v26 = 52;
          goto LABEL_16;
        }

        goto LABEL_17;
      }
    }

    v21 = 0;
    goto LABEL_19;
  }

  v21 = v11 > 0;
LABEL_20:

  return v21;
}

+ (id)generateFullComputeStateRecordForRecord:(id)a3 payloadHelper:(id)a4 destinationDirectoryURL:(id)a5 inPhotoLibrary:(id)a6
{
  v63 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a5;
  v12 = a6;
  v13 = [v9 itemScopedIdentifier];

  if (v13)
  {
    v14 = [v9 itemScopedIdentifier];
    v15 = [PLManagedAsset assetWithScopedIdentifier:v14 inLibrary:v12 prefetchResources:1];

    if (v15)
    {
      v16 = [v15 computeSyncAttributes];
      if (!v16)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v24 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            v30 = [v9 itemScopedIdentifier];
            *buf = 138543618;
            v56 = v30;
            v57 = 2112;
            v58 = v9;
            _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Asset %{public}@ doesn't have a compute sync attributes relationship %@", buf, 0x16u);
          }

          goto LABEL_26;
        }

        v16 = 0;
        goto LABEL_18;
      }

      v17 = [v9 version];
      v18 = [v15 _currentComputeStateVersion];
      v19 = [v17 isEqualToString:v18];

      if ((v19 & 1) == 0)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v24 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
          {
            v31 = [v9 itemScopedIdentifier];
            v25 = [v15 _currentComputeStateVersion];
            v32 = [v9 version];
            *buf = 138544130;
            v56 = v31;
            v57 = 2114;
            v58 = v25;
            v59 = 2114;
            v60 = v32;
            v61 = 2112;
            v62 = v9;
            _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Asset %{public}@ version %{public}@ doesn't match compute state record version %{public}@ %@", buf, 0x2Au);

            goto LABEL_25;
          }

LABEL_26:
          v28 = 0;
LABEL_27:

          goto LABEL_28;
        }

LABEL_18:
        v28 = 0;
LABEL_28:

        goto LABEL_29;
      }

      v20 = [v9 adjustmentFingerprint];
      v21 = [v15 additionalAttributes];
      v22 = [v21 adjustedStableHash];

      if (v20 && v22)
      {
        v23 = [v20 isEqual:v22];

        if ((v23 & 1) == 0)
        {
          goto LABEL_8;
        }
      }

      else
      {

        if (v20 | v22)
        {
LABEL_8:
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v24 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
            {
              v25 = [v9 itemScopedIdentifier];
              v51 = [v15 additionalAttributes];
              v26 = [v51 adjustedStableHash];
              v27 = [v9 adjustmentFingerprint];
              *buf = 138544130;
              v56 = v25;
              v57 = 2114;
              v58 = v26;
              v59 = 2114;
              v60 = v27;
              v61 = 2112;
              v62 = v9;
              _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Asset %{public}@ adjustmentFingerprint %{public}@ doesn't match compute state record adjustmentFingerprint %{public}@ %@", buf, 0x2Au);

LABEL_25:
              goto LABEL_26;
            }

            goto LABEL_26;
          }

          goto LABEL_18;
        }
      }

      v34 = [v15 computeSyncAttributes];
      v24 = [v10 computeSyncWrapperURLForAsset:v15 analysisStage:{objc_msgSend(v34, "localAnalysisStage")}];

      if (!v24)
      {
        if (*MEMORY[0x1E6994D48])
        {
          v24 = 0;
          goto LABEL_26;
        }

        v46 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
        {
          v47 = [v15 scopedIdentifier];
          *buf = 138543618;
          v56 = v47;
          v57 = 2112;
          v58 = v9;
          _os_log_impl(&dword_19BF1F000, v46, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Nil compute sync payload URL generated for asset %{public}@ %@", buf, 0x16u);
        }

        v28 = 0;
LABEL_52:

        goto LABEL_27;
      }

      v54 = 0;
      v35 = [v15 installComputeSyncResourceAfterAttachtoCPLWithError:&v54];
      v50 = v54;
      if ((v35 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v36 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          v37 = [v15 scopedIdentifier];
          *buf = 138412546;
          v56 = v37;
          v57 = 2112;
          v58 = v50;
          _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[CCSS] Failed to install resource for asset %@ after compute state record upload: %@", buf, 0x16u);
        }
      }

      v38 = MEMORY[0x1E696AEC0];
      v39 = [MEMORY[0x1E696AFB0] UUID];
      v40 = [v39 UUIDString];
      v41 = [v38 stringWithFormat:@"%@.dat", v40];
      v52 = [v11 URLByAppendingPathComponent:v41];

      v42 = MEMORY[0x1E69BF238];
      v43 = [v12 pathManager];
      v44 = [v43 capabilities];
      v53 = 0;
      LOBYTE(v42) = [v42 ingestItemAtURL:v24 toURL:v52 type:1 options:10 capabilities:v44 error:&v53];
      v49 = v53;

      if (v42)
      {
        v45 = v52;
        v28 = [v9 copyAddingFileURL:v52];
      }

      else
      {
        v45 = v52;
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v48 = __CPLAssetsdOSLogDomain();
          v46 = v50;
          if (os_log_type_enabled(v48, OS_LOG_TYPE_ERROR))
          {
            *buf = 138543874;
            v56 = v24;
            v57 = 2114;
            v58 = v52;
            v59 = 2112;
            v60 = v9;
            _os_log_impl(&dword_19BF1F000, v48, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Unable to copy payload from URL %{public}@ to %{public}@ %@", buf, 0x20u);
          }

          v28 = 0;
          goto LABEL_51;
        }

        v28 = 0;
      }

      v46 = v50;
LABEL_51:

      goto LABEL_52;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v16 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        v29 = [v9 itemScopedIdentifier];
        *buf = 138543618;
        v56 = v29;
        v57 = 2112;
        v58 = v9;
        _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Unable to fetch asset with scopedIdentifier %{public}@ for compute state record %@", buf, 0x16u);
      }

      goto LABEL_18;
    }

    v15 = 0;
LABEL_14:
    v28 = 0;
LABEL_29:

    goto LABEL_30;
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v15 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v56 = v9;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[CCSS] Skip generation: Nil item scoped identifier in compute state record: %@", buf, 0xCu);
    }

    goto LABEL_14;
  }

  v28 = 0;
LABEL_30:

  return v28;
}

+ (id)createSparseComputeStateRecordsForAssets:(id)a3 inPhotoLibrary:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v17 = 0;
  v18 = &v17;
  v19 = 0x3032000000;
  v20 = __Block_byref_object_copy__56697;
  v21 = __Block_byref_object_dispose__56698;
  v22 = [objc_alloc(MEMORY[0x1E695DF70]) initWithCapacity:{objc_msgSend(v7, "count")}];
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __87__PLManagedAsset_ComputeSync__createSparseComputeStateRecordsForAssets_inPhotoLibrary___block_invoke;
  v13[3] = &unk_1E7578820;
  v8 = v5;
  v14 = v8;
  v9 = v6;
  v15 = v9;
  v16 = &v17;
  [v9 performBlockAndWait:v13];
  if ([v18[5] count])
  {
    v10 = v18[5];
  }

  else
  {
    v10 = 0;
  }

  v11 = v10;

  _Block_object_dispose(&v17, 8);

  return v11;
}

void __87__PLManagedAsset_ComputeSync__createSparseComputeStateRecordsForAssets_inPhotoLibrary___block_invoke(uint64_t a1)
{
  v27 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 32);
  v3 = +[(PLManagedObjectJournalEntryPayload *)PLAssetComputeSyncJournalEntryPayload];
  v21 = a1;
  v4 = [PLManagedAsset assetsWithScopedIdentifiers:v2 prefetchResources:0 relationshipKeyPathsForPrefetching:v3 inLibrary:*(a1 + 40)];

  v24 = 0u;
  v25 = 0u;
  v22 = 0u;
  v23 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v22 objects:v26 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v23;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v23 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v22 + 1) + 8 * i);
        if ([v10 shouldPushComputeSync])
        {
          v11 = [v10 analysisStateModificationDate];
          v12 = v11;
          if (v11)
          {
            v13 = v11;
          }

          else
          {
            v13 = [MEMORY[0x1E695DF00] date];
          }

          v14 = v13;

          v15 = objc_alloc(MEMORY[0x1E6994B68]);
          v16 = [v10 scopedIdentifier];
          v17 = [v10 _currentComputeStateVersion];
          v18 = [v10 additionalAttributes];
          v19 = [v18 adjustedStableHash];
          v20 = [v15 initWithItemScopedIdentifier:v16 version:v17 fileURL:0 adjustmentFingerprint:v19 lastUpdatedDate:v14];

          [*(*(*(v21 + 48) + 8) + 40) addObject:v20];
        }
      }

      v7 = [v5 countByEnumeratingWithState:&v22 objects:v26 count:16];
    }

    while (v7);
  }
}

- (BOOL)sceneAnalysisWasPerformedOnLatestAdjustment
{
  v3 = [(PLManagedAsset *)self additionalAttributes];
  if ([v3 sceneAnalysisVersion])
  {
    v4 = [(PLManagedAsset *)self dateForComparingAdjustmentVersions];
    v5 = [(PLManagedAsset *)self additionalAttributes];
    v6 = [v5 sceneAnalysisTimestamp];
    v7 = [v4 isEqualToDate:v6];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)removeAllTemporalSceneClassifications
{
  v17 = *MEMORY[0x1E69E9840];
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 temporalSceneClassifications];
  v4 = [v3 copy];

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        v11 = [v10 managedObjectContext];
        [v11 deleteObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }
}

- (void)removeAllStillFrameSceneClassifications
{
  v17 = *MEMORY[0x1E69E9840];
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 sceneClassifications];
  v4 = [v3 copy];

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  v5 = v4;
  v6 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        v11 = [v10 managedObjectContext];
        [v11 deleteObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v7);
  }
}

- (void)removeTemporalSceneClassificationsOfType:(int64_t)a3
{
  v19 = *MEMORY[0x1E69E9840];
  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 temporalSceneClassifications];
  v6 = [v5 copy];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        if ([v12 classificationType] == a3)
        {
          v13 = [v12 managedObjectContext];
          [v13 deleteObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }
}

- (void)removeSceneClassificationsOfType:(int64_t)a3
{
  v19 = *MEMORY[0x1E69E9840];
  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 sceneClassifications];
  v6 = [v5 copy];

  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v15;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v15 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v14 + 1) + 8 * i);
        if ([v12 classificationType] == a3)
        {
          v13 = [v12 managedObjectContext];
          [v13 deleteObject:v12];
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v9);
  }
}

- (BOOL)calculateAllowedForAnalysis
{
  [MEMORY[0x1E69BF328] maskForAllowedForAnalysis];
  [(PLManagedAsset *)self savedAssetType];
  if (PLValidatedSavedAssetTypeApplies())
  {
    v3 = [(PLManagedAsset *)self additionalAttributes];
    v4 = [v3 montage];
    if (v4)
    {
      v5 = 0;
    }

    else
    {
      v6 = [(PLManagedAsset *)self extendedAttributes];
      v7 = [v6 generativeAIType];
      v5 = [v7 intValue] != 1;
    }
  }

  else
  {
    v5 = 0;
  }

  v8 = ([(PLManagedAsset *)self hidden]& 1) == 0 && ![(PLManagedAsset *)self trashedState]&& [(PLManagedAsset *)self avalanchePickTypeIsVisible];
  return v5 && v8;
}

- (NSDate)dateForComparingAdjustmentVersions
{
  v3 = [(PLManagedAsset *)self adjustmentTimestamp];
  v4 = v3;
  if (v3)
  {
    v5 = v3;
  }

  else
  {
    v5 = [(PLManagedAsset *)self dateCreated];
  }

  v6 = v5;

  return v6;
}

- (id)analysisStateForWorkerType:(signed __int16)a3
{
  v3 = a3;
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = [(PLManagedAsset *)self analysisStates];
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 workerType] == v3)
        {
          v10 = v9;
          goto LABEL_11;
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_11:

  return v10;
}

- (BOOL)_analysisStateWasChangedForWorkerType:(signed __int16)a3
{
  v3 = [(PLManagedAsset *)self analysisStateForWorkerType:a3];
  v4 = [v3 changedValues];
  v5 = [v4 count] != 0;

  return v5;
}

- (void)setUserCloudSharedLiked:(BOOL)a3
{
  v3 = a3;
  v26 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self userCloudSharedLiked]!= a3)
  {
    if (v3)
    {
      v5 = [(PLManagedObject *)self photoLibrary];
      v6 = [PLCloudSharedComment insertNewCommentIntoAsset:self commentDate:0 withText:0 isLike:1 isMyComment:1 inLibrary:v5];
      v23[0] = MEMORY[0x1E69E9820];
      v23[1] = 3221225472;
      v23[2] = __62__PLManagedAsset_PLCloudSharedAsset__setUserCloudSharedLiked___block_invoke;
      v23[3] = &unk_1E7578848;
      v23[4] = self;
      v24 = v6;
      v7 = v6;
      [v5 addCompletionHandlerToCurrentTransaction:v23];
    }

    else
    {
      v21 = 0u;
      v22 = 0u;
      v19 = 0u;
      v20 = 0u;
      v8 = [(PLManagedAsset *)self likeComments];
      v5 = [v8 countByEnumeratingWithState:&v19 objects:v25 count:16];
      if (v5)
      {
        v9 = *v20;
        while (2)
        {
          for (i = 0; i != v5; i = i + 1)
          {
            if (*v20 != v9)
            {
              objc_enumerationMutation(v8);
            }

            v11 = *(*(&v19 + 1) + 8 * i);
            v12 = [v11 isMyComment];
            v13 = [v12 BOOLValue];

            if (v13)
            {
              v5 = v11;
              goto LABEL_14;
            }
          }

          v5 = [v8 countByEnumeratingWithState:&v19 objects:v25 count:16];
          if (v5)
          {
            continue;
          }

          break;
        }
      }

LABEL_14:

      v14 = [(PLManagedAsset *)self collectionShare];
      v15 = [v14 collectionShareKind];
      v16 = [(PLManagedObject *)self photoLibrary];
      v7 = [PLCollectionShare syncBackendForKind:v15 photoLibrary:v16];

      if (v7)
      {
        v17 = [v5 cloudGUID];

        if (v17)
        {
          v18 = [v5 cloudGUID];
          [v7 deleteCommentWithGUIDFromServer:v18];
        }
      }

      [(PLManagedAsset *)self deleteComment:v5];
    }
  }
}

void __62__PLManagedAsset_PLCloudSharedAsset__setUserCloudSharedLiked___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionShare];
  v3 = [v2 collectionShareKind];
  v4 = [*(a1 + 32) photoLibrary];
  v6 = [PLCollectionShare syncBackendForKind:v3 photoLibrary:v4];

  v5 = v6;
  if (v6)
  {
    [v6 publishCloudSharedCommentToServer:*(a1 + 40)];
    v5 = v6;
  }
}

- (void)userReadAllCloudSharedComments
{
  v3 = [(PLManagedAsset *)self orderedCloudComments];
  v4 = [v3 lastObject];
  v12 = [v4 commentDate];

  v5 = [(PLManagedAsset *)self orderedLikeComments];
  v6 = [v5 lastObject];
  v7 = [v6 commentDate];

  v8 = v12 != 0;
  if (v12 && v7)
  {
    v8 = [v12 compare:v7] == 1;
  }

  if (v8)
  {
    v9 = v12;
  }

  else
  {
    v9 = v7;
  }

  v10 = v9;
  v11 = [(PLManagedAsset *)self cloudAssetGUID];
  [PLPhotoSharingHelper markCommentsForAssetCollectionWithGUID:v11 asViewedWithLastViewedDate:v10];
}

- (NSOrderedSet)orderedLikeComments
{
  v9[1] = *MEMORY[0x1E69E9840];
  [(PLManagedAsset *)self willAccessValueForKey:@"likeComments"];
  v3 = [(PLManagedAsset *)self likeComments];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"commentDate" ascending:1];
  v9[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
  v6 = [v3 sortedArrayUsingDescriptors:v5];

  [(PLManagedAsset *)self didAccessValueForKey:@"likeComments"];
  v7 = [MEMORY[0x1E695DFB8] orderedSetWithArray:v6];

  return v7;
}

- (NSOrderedSet)orderedCloudComments
{
  v9[1] = *MEMORY[0x1E69E9840];
  [(PLManagedAsset *)self willAccessValueForKey:@"cloudComments"];
  v3 = [(PLManagedAsset *)self cloudComments];
  v4 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"commentDate" ascending:1];
  v9[0] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
  v6 = [v3 sortedArrayUsingDescriptors:v5];

  [(PLManagedAsset *)self didAccessValueForKey:@"cloudComments"];
  v7 = [MEMORY[0x1E695DFB8] orderedSetWithArray:v6];

  return v7;
}

- (unint64_t)_countForCommentRelationshipNamed:(id)a3 inverseRelationshipName:(id)a4
{
  v7 = a3;
  v8 = a4;
  v9 = v8;
  if (!v7)
  {
    v17 = [MEMORY[0x1E696AAA8] currentHandler];
    [v17 handleFailureInMethod:a2 object:self file:@"PLCloudSharedAsset.m" lineNumber:393 description:{@"Invalid parameter not satisfying: %@", @"assetRelationshipName"}];

    if (v9)
    {
      goto LABEL_3;
    }

LABEL_9:
    v18 = [MEMORY[0x1E696AAA8] currentHandler];
    [v18 handleFailureInMethod:a2 object:self file:@"PLCloudSharedAsset.m" lineNumber:394 description:{@"Invalid parameter not satisfying: %@", @"inverseRelationshipName"}];

    goto LABEL_3;
  }

  if (!v8)
  {
    goto LABEL_9;
  }

LABEL_3:
  if (([(PLManagedAsset *)self isFault]& 1) != 0 || ([(PLManagedAsset *)self hasFaultForRelationshipNamed:v7]& 1) != 0)
  {
    v10 = MEMORY[0x1E695D5E0];
    v11 = +[PLCloudSharedComment entityName];
    v12 = [v10 fetchRequestWithEntityName:v11];

    v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %@", v9, self];
    [v12 setPredicate:v13];

    v14 = [(PLManagedAsset *)self managedObjectContext];
    v15 = [v14 countForFetchRequest:v12 error:0];
  }

  else
  {
    v12 = [(PLManagedAsset *)self valueForKey:v7];
    v15 = [v12 count];
  }

  return v15;
}

- (BOOL)userCloudSharedLiked
{
  v14 = *MEMORY[0x1E69E9840];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v2 = [(PLManagedAsset *)self likeComments];
  v3 = [v2 countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v3)
  {
    v4 = *v10;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v10 != v4)
        {
          objc_enumerationMutation(v2);
        }

        v6 = [*(*(&v9 + 1) + 8 * i) isMyComment];
        v7 = [v6 BOOLValue];

        if (v7)
        {
          LOBYTE(v3) = 1;
          goto LABEL_11;
        }
      }

      v3 = [v2 countByEnumeratingWithState:&v9 objects:v13 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v3;
}

- (void)userDeleteCloudSharedComment:(id)a3
{
  v10 = a3;
  v4 = [(PLManagedAsset *)self collectionShare];
  v5 = [v4 collectionShareKind];
  v6 = [(PLManagedObject *)self photoLibrary];
  v7 = [PLCollectionShare syncBackendForKind:v5 photoLibrary:v6];

  if (v7)
  {
    v8 = [v10 cloudGUID];

    if (v8)
    {
      v9 = [v10 cloudGUID];
      [v7 deleteCommentWithGUIDFromServer:v9];
    }
  }

  [(PLManagedAsset *)self deleteComment:v10];
}

- (id)userAddCloudSharedCommentWithText:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedObject *)self photoLibrary];
  v6 = [PLCloudSharedComment insertNewCommentIntoAsset:self commentDate:0 withText:v4 isLike:0 isMyComment:1 inLibrary:v5];

  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __72__PLManagedAsset_PLCloudSharedAsset__userAddCloudSharedCommentWithText___block_invoke;
  v11[3] = &unk_1E7578848;
  v11[4] = self;
  v7 = v6;
  v12 = v7;
  [v5 addCompletionHandlerToCurrentTransaction:v11];
  v8 = v12;
  v9 = v7;

  return v7;
}

void __72__PLManagedAsset_PLCloudSharedAsset__userAddCloudSharedCommentWithText___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionShare];
  v3 = [v2 collectionShareKind];
  v4 = [*(a1 + 32) photoLibrary];
  v6 = [PLCollectionShare syncBackendForKind:v3 photoLibrary:v4];

  v5 = v6;
  if (v6)
  {
    [v6 publishCloudSharedCommentToServer:*(a1 + 40)];
    v5 = v6;
  }
}

- (BOOL)cloudHasSameOwnerAsAsset:(id)a3
{
  if (!a3)
  {
    return 0;
  }

  v4 = a3;
  v5 = [(PLManagedAsset *)self collectionShareContributor];
  v6 = [v4 collectionShareContributor];

  LOBYTE(v4) = [v5 isEqual:v6];
  return v4;
}

- (int)cloudCommentsStatusForOwnedAsset:(BOOL)a3
{
  v4 = [(PLManagedAsset *)self totalCommentsCount];
  if (v4)
  {
    if ([(PLManagedAsset *)self cloudHasUnseenComments])
    {
      LODWORD(v4) = 2;
    }

    else
    {
      LODWORD(v4) = 1;
    }
  }

  return v4;
}

- (void)deleteComment:(id)a3
{
  v61 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = v4;
  if (v4)
  {
    v6 = [v4 isLike];
    v7 = [v6 BOOLValue];

    if (v7)
    {
      [v5 setLikedAsset:0];
    }

    else
    {
      [v5 setCommentedAsset:0];
    }

    v8 = [v5 isMyComment];
    v9 = [v8 BOOLValue];

    [(PLManagedAsset *)self cloudHasCommentsByMe];
    if (v9)
    {
      v55 = 0u;
      v56 = 0u;
      v53 = 0u;
      v54 = 0u;
      v10 = [(PLManagedAsset *)self cloudComments];
      v11 = [v10 countByEnumeratingWithState:&v53 objects:v60 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v54;
LABEL_8:
        v14 = 0;
        while (1)
        {
          if (*v54 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v53 + 1) + 8 * v14);
          if (v15 != v5)
          {
            v16 = [v15 isMyComment];
            v17 = [v16 BOOLValue];

            if (v17)
            {
              goto LABEL_47;
            }
          }

          if (v12 == ++v14)
          {
            v12 = [v10 countByEnumeratingWithState:&v53 objects:v60 count:16];
            if (v12)
            {
              goto LABEL_8;
            }

            break;
          }
        }
      }

      v51 = 0u;
      v52 = 0u;
      v49 = 0u;
      v50 = 0u;
      v10 = [(PLManagedAsset *)self likeComments];
      v18 = [v10 countByEnumeratingWithState:&v49 objects:v59 count:16];
      if (v18)
      {
        v19 = v18;
        v20 = *v50;
LABEL_17:
        v21 = 0;
        while (1)
        {
          if (*v50 != v20)
          {
            objc_enumerationMutation(v10);
          }

          v22 = *(*(&v49 + 1) + 8 * v21);
          if (v22 != v5)
          {
            v23 = [v22 isMyComment];
            v24 = [v23 BOOLValue];

            if (v24)
            {
              break;
            }
          }

          if (v19 == ++v21)
          {
            v19 = [v10 countByEnumeratingWithState:&v49 objects:v59 count:16];
            if (v19)
            {
              goto LABEL_17;
            }

            goto LABEL_24;
          }
        }

LABEL_47:

        [(PLManagedAsset *)self cloudHasCommentsConversation];
        goto LABEL_49;
      }

LABEL_24:

      [(PLManagedAsset *)self setCloudHasCommentsByMe:0];
      if (([(PLManagedAsset *)self cloudHasCommentsConversation]& 1) == 0)
      {
        goto LABEL_49;
      }

      goto LABEL_46;
    }

    if (![(PLManagedAsset *)self cloudHasCommentsConversation])
    {
LABEL_49:
      v40 = [v5 managedObjectContext];
      [v40 deleteObject:v5];

      goto LABEL_50;
    }

    v47 = 0u;
    v48 = 0u;
    v45 = 0u;
    v46 = 0u;
    v25 = [(PLManagedAsset *)self cloudComments];
    v26 = [v25 countByEnumeratingWithState:&v45 objects:v58 count:16];
    if (v26)
    {
      v27 = v26;
      v28 = *v46;
LABEL_29:
      v29 = 0;
      while (1)
      {
        if (*v46 != v28)
        {
          objc_enumerationMutation(v25);
        }

        v30 = *(*(&v45 + 1) + 8 * v29);
        if (v30 != v5)
        {
          v31 = [v30 isMyComment];
          v32 = [v31 BOOLValue];

          if (!v32)
          {
            break;
          }
        }

        if (v27 == ++v29)
        {
          v27 = [v25 countByEnumeratingWithState:&v45 objects:v58 count:16];
          if (v27)
          {
            goto LABEL_29;
          }

          goto LABEL_36;
        }
      }
    }

    else
    {
LABEL_36:

      v43 = 0u;
      v44 = 0u;
      v41 = 0u;
      v42 = 0u;
      v25 = [(PLManagedAsset *)self likeComments];
      v33 = [v25 countByEnumeratingWithState:&v41 objects:v57 count:16];
      if (!v33)
      {
LABEL_45:

LABEL_46:
        [(PLManagedAsset *)self setCloudHasCommentsConversation:0];
        goto LABEL_49;
      }

      v34 = v33;
      v35 = *v42;
LABEL_38:
      v36 = 0;
      while (1)
      {
        if (*v42 != v35)
        {
          objc_enumerationMutation(v25);
        }

        v37 = *(*(&v41 + 1) + 8 * v36);
        if (v37 != v5)
        {
          v38 = [v37 isMyComment];
          v39 = [v38 BOOLValue];

          if (!v39)
          {
            break;
          }
        }

        if (v34 == ++v36)
        {
          v34 = [v25 countByEnumeratingWithState:&v41 objects:v57 count:16];
          if (v34)
          {
            goto LABEL_38;
          }

          goto LABEL_45;
        }
      }
    }

    goto LABEL_49;
  }

LABEL_50:
}

- (void)addComment:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v12 = v4;
    v5 = [v4 isMyComment];
    v6 = [v5 BOOLValue];

    v7 = [(PLManagedAsset *)self cloudHasCommentsByMe];
    if (([(PLManagedAsset *)self cloudHasCommentsConversation]& 1) != 0)
    {
      goto LABEL_10;
    }

    if (v7)
    {
      if (v6)
      {
        goto LABEL_12;
      }
    }

    else
    {
      if (!v6)
      {
LABEL_12:
        v8 = [v12 isLike];
        v9 = [v8 BOOLValue];

        if (v9)
        {
          v10 = @"likeComments";
        }

        else
        {
          v10 = @"cloudComments";
        }

        v11 = [(PLManagedAsset *)self mutableSetValueForKey:v10];
        [v11 addObject:v12];

        v4 = v12;
        goto LABEL_16;
      }

      if (![(PLManagedAsset *)self cloudCommentsCount]&& ![(PLManagedAsset *)self likeCommentsCount])
      {
LABEL_10:
        if (!(v7 & 1 | ((v6 & 1) == 0)))
        {
          [(PLManagedAsset *)self setCloudHasCommentsByMe:1];
        }

        goto LABEL_12;
      }
    }

    [(PLManagedAsset *)self setCloudHasCommentsConversation:1];
    goto LABEL_10;
  }

LABEL_16:
}

- (id)cloudSharedAssetPathForPlaceholderKind:(signed __int16)a3
{
  v3 = a3;
  [(PLManagedAsset *)self isCloudSharedAsset];
  v5 = [(PLManagedAsset *)self pathForOriginalFile];
  if (v3 > 7)
  {
    switch(v3)
    {
      case 8:
        v6 = @"MOV";
        break;
      case 9:
        v6 = @"medium.MP4";
        break;
      case 10:
        v6 = @"small.MP4";
        break;
      default:
        goto LABEL_16;
    }
  }

  else
  {
    switch(v3)
    {
      case 3:
        v6 = @"thumb.JPG";
        break;
      case 4:
        v7 = MEMORY[0x1E69C08F0];
        v8 = [(PLManagedAsset *)self uniformTypeIdentifier];
        v9 = [v7 typeWithIdentifier:v8];
        v10 = [v9 isEqual:*MEMORY[0x1E6982DE8]];

        if ((v10 & 1) == 0)
        {
          goto LABEL_16;
        }

        v6 = @"GIF";
        break;
      case 7:
        v6 = @"poster.JPG";
        break;
      default:
        goto LABEL_16;
    }
  }

  v11 = [(PLManagedAsset *)self _cloudSharedPathWithExtension:v6];

  v5 = v11;
LABEL_16:

  return v5;
}

- (id)_cloudSharedPathWithExtension:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self pathForOriginalFile];
  v6 = [v5 stringByDeletingPathExtension];
  v7 = [v6 stringByAppendingPathExtension:v4];

  return v7;
}

- (NSString)cloudOwnerDisplayName
{
  v3 = [(PLManagedAsset *)self cloudOwnerFirstName];
  v4 = [(PLManagedAsset *)self cloudOwnerLastName];
  v5 = [(PLManagedAsset *)self cloudOwnerFullName];
  v6 = [PLCloudSharedAlbum cloudOwnerDisplayNameWithFirstName:v3 lastName:v4 fullName:v5 emailKey:0 includingEmail:0 allowsEmail:0 emailAddressManager:0];

  return v6;
}

- (NSString)cloudOwnerFullName
{
  v2 = [(PLManagedAsset *)self collectionShareContributor];
  v3 = [v2 fullName];

  return v3;
}

- (NSString)cloudOwnerLastName
{
  v2 = [(PLManagedAsset *)self collectionShareContributor];
  v3 = [v2 nameComponents];
  v4 = [v3 familyName];

  return v4;
}

- (NSString)cloudOwnerFirstName
{
  v2 = [(PLManagedAsset *)self collectionShareContributor];
  v3 = [v2 nameComponents];
  v4 = [v3 givenName];

  return v4;
}

- (NSString)cloudOwnerEmail
{
  v2 = [(PLManagedAsset *)self collectionShareContributor];
  v3 = [v2 emailAddress];

  return v3;
}

+ (id)lightweightReimportFileNameWithGUID:(id)a3 type:(id)a4
{
  v4 = a3;
  if (a3)
  {
    if (a4)
    {
      v5 = a4;
    }

    else
    {
      v5 = @"JPG";
    }

    v6 = a4;
    v4 = [v4 stringByAppendingPathExtension:v5];
  }

  return v4;
}

+ (void)markAssetAsRecentlyUsed:(id)a3
{
  v5 = a3;
  v6 = [v5 cloudAssetGUID];
  if (v6)
  {
    v7 = [v5 pathManager];
    v8 = [v5 pathManager];

    if (!v8)
    {
      v10 = [MEMORY[0x1E696AAA8] currentHandler];
      [v10 handleFailureInMethod:a2 object:a1 file:@"PLCloudSharedAsset.m" lineNumber:541 description:{@"Invalid parameter not satisfying: %@", @"asset.pathManager"}];
    }

    pl_dispatch_once();
    v11 = v6;
    v9 = v7;
    pl_dispatch_async();
  }
}

void __62__PLManagedAsset_PLCloudSharedAsset__markAssetAsRecentlyUsed___block_invoke_129(uint64_t a1)
{
  v35 = *MEMORY[0x1E69E9840];
  v2 = PLPhotoSharingGetLog();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_DEFAULT))
  {
    v3 = *(a1 + 32);
    *buf = 138412290;
    v30 = v3;
    _os_log_impl(&dword_19BF1F000, v2, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) markAssetAsRecentlyUsed %@", buf, 0xCu);
  }

  v4 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
  if (!markAssetAsRecentlyUsed__recentlyUsedGUIDS)
  {
    v5 = [objc_opt_class() persistedRecentlyUsedGUIDSWithPathManager:*(a1 + 40)];
    v6 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
    markAssetAsRecentlyUsed__recentlyUsedGUIDS = v5;

    v7 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
    {
      v8 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS count];
      *buf = 134217984;
      v30 = v8;
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) loaded recently used list with %lu entries", buf, 0xCu);
    }

    v4 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
    if (!markAssetAsRecentlyUsed__recentlyUsedGUIDS)
    {
      v9 = objc_alloc(MEMORY[0x1E695DFA0]);
      v10 = [v9 initWithCapacity:markAssetAsRecentlyUsed__maxListSize];
      v11 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
      markAssetAsRecentlyUsed__recentlyUsedGUIDS = v10;

      v4 = markAssetAsRecentlyUsed__recentlyUsedGUIDS;
    }
  }

  if ([v4 containsObject:*(a1 + 32)])
  {
    [markAssetAsRecentlyUsed__recentlyUsedGUIDS removeObject:*(a1 + 32)];
  }

  [markAssetAsRecentlyUsed__recentlyUsedGUIDS addObject:*(a1 + 32)];
  ++markAssetAsRecentlyUsed__changesSinceLastSave;
  v12 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS count];
  if (v12 >= markAssetAsRecentlyUsed__maxListSize)
  {
    [markAssetAsRecentlyUsed__recentlyUsedGUIDS removeObjectsInRange:{0, v12 - markAssetAsRecentlyUsed__maxListSize}];
    v12 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS count];
  }

  if (markAssetAsRecentlyUsed__changesSinceLastSave > markAssetAsRecentlyUsed__maxChangesBetweenSaves)
  {
    v13 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      *buf = 134218496;
      v30 = v12;
      v31 = 2048;
      v32 = markAssetAsRecentlyUsed__changesSinceLastSave;
      v33 = 2048;
      v34 = markAssetAsRecentlyUsed__maxChangesBetweenSaves;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) will save recently used list with size %lu changes since last save %lu maxChangesBetweenSaves %lu", buf, 0x20u);
    }

    v14 = [MEMORY[0x1E696AC08] defaultManager];
    v15 = [objc_opt_class() recentlyUsedGUIDsPathWithPathManager:*(a1 + 40)];
    v28 = 0;
    v16 = [v14 removeItemAtPath:v15 error:&v28];
    v17 = v28;
    if ((v16 & 1) == 0 && [v14 fileExistsAtPath:v15])
    {
      v18 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v30 = v17;
        _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR deleting recently used list :%@", buf, 0xCu);
      }
    }

    v19 = MEMORY[0x1E696AE40];
    v20 = [markAssetAsRecentlyUsed__recentlyUsedGUIDS array];
    v27 = 0;
    v21 = [v19 dataWithPropertyList:v20 format:200 options:0 error:&v27];
    v22 = v27;

    if (v21)
    {
      v26 = v22;
      v23 = [v21 writeToFile:v15 options:1073741825 error:&v26];
      v24 = v26;

      if (v23)
      {
LABEL_28:
        markAssetAsRecentlyUsed__changesSinceLastSave = 0;

        return;
      }

      v25 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v30 = v24;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR failed to write recently used list: %@", buf, 0xCu);
      }

      v22 = v24;
    }

    else
    {
      v25 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v30 = v22;
        _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR failed to serialize recently used list: %@", buf, 0xCu);
      }
    }

    v24 = v22;
    goto LABEL_28;
  }
}

void __62__PLManagedAsset_PLCloudSharedAsset__markAssetAsRecentlyUsed___block_invoke()
{
  v14 = *MEMORY[0x1E69E9840];
  v0 = dispatch_queue_create("com.apple.PLCloudSharedAssetSaveJob.recentlyUsedAssetsQueue", 0);
  v1 = markAssetAsRecentlyUsed__recentlyUsedAssetsQueue;
  markAssetAsRecentlyUsed__recentlyUsedAssetsQueue = v0;

  CFPreferencesAppSynchronize(@"com.apple.mobileslideshow");
  keyExistsAndHasValidFormat = 0;
  AppIntegerValue = CFPreferencesGetAppIntegerValue(@"sharingRecentlyUsedListMax", @"com.apple.mobileslideshow", &keyExistsAndHasValidFormat);
  if (AppIntegerValue)
  {
    v3 = keyExistsAndHasValidFormat == 0;
  }

  else
  {
    v3 = 1;
  }

  v4 = 200;
  if (!v3)
  {
    v4 = AppIntegerValue;
  }

  markAssetAsRecentlyUsed__maxListSize = v4;
  v5 = CFPreferencesGetAppIntegerValue(@"sharingRecentlyUsedMaxChangesBetweenSaves", @"com.apple.mobileslideshow", &keyExistsAndHasValidFormat);
  if (v5)
  {
    v6 = keyExistsAndHasValidFormat == 0;
  }

  else
  {
    v6 = 1;
  }

  v7 = 10;
  if (!v6)
  {
    v7 = v5;
  }

  markAssetAsRecentlyUsed__maxChangesBetweenSaves = v7;
  v8 = PLPhotoSharingGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    *buf = 134218240;
    v11 = markAssetAsRecentlyUsed__maxListSize;
    v12 = 2048;
    v13 = markAssetAsRecentlyUsed__maxChangesBetweenSaves;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "(sharing-space-management) maxListSize %lu maxChangesBetweenSaves %lu", buf, 0x16u);
  }
}

+ (id)persistedRecentlyUsedGUIDSWithPathManager:(id)a3
{
  v12 = *MEMORY[0x1E69E9840];
  v3 = MEMORY[0x1E695DEF0];
  v4 = [a1 recentlyUsedGUIDsPathWithPathManager:a3];
  v5 = [v3 dataWithContentsOfFile:v4];

  if (v5)
  {
    v6 = [MEMORY[0x1E696AE40] propertyListWithData:v5 options:0 format:0 error:0];
    if (v6)
    {
      v7 = [objc_alloc(MEMORY[0x1E695DFA0]) initWithArray:v6];
    }

    else
    {
      v8 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        v10 = 138412290;
        v11 = 0;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "(sharing-space-management) ERROR failed to de-serialize recently used list: %@", &v10, 0xCu);
      }

      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

+ (id)fetchRequestForSortedCloudSharedAssetsWithPlaceholderKindsRequiringThumbnails:(BOOL)a3 additionalPredicate:(id)a4 ascending:(BOOL)a5
{
  v5 = a5;
  v6 = a3;
  v7 = a4;
  v8 = MEMORY[0x1E695D5E0];
  v9 = +[PLManagedAsset entityName];
  v10 = [v8 fetchRequestWithEntityName:v9];

  v11 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v12 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForCloudSharedAsset"), 1}];
  [v11 addObject:v12];

  if (v6)
  {
    v13 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"thumbnailIndex", 0xFFFFFFFFLL];
    [v11 addObject:v13];
  }

  if (v7)
  {
    [v11 addObject:v7];
  }

  v14 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v11];
  [v10 setPredicate:v14];
  v15 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"cloudServerPublishDate" ascending:v5];
  v16 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"cloudBatchPublishDate" ascending:v5];
  v17 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"dateCreated" ascending:v5];
  v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:{v15, v16, v17, 0}];
  [v10 setSortDescriptors:v18];

  [v10 setFetchBatchSize:100];

  return v10;
}

+ (id)cloudSharedAssetsWithGUIDs:(id)a3 inLibrary:(id)a4
{
  v20[2] = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = objc_autoreleasePoolPush();
  v8 = [v6 managedObjectContext];
  v9 = MEMORY[0x1E696AB28];
  v10 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", @"cloudAssetGUID", v5];
  v20[0] = v10;
  v11 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForCloudSharedAsset"), 1}];
  v20[1] = v11;
  v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:2];
  v13 = [v9 andPredicateWithSubpredicates:v12];

  v14 = MEMORY[0x1E695D5E0];
  v15 = +[PLManagedAsset entityName];
  v16 = [v14 fetchRequestWithEntityName:v15];

  if ([v5 count] >= 0x65)
  {
    [v16 setFetchBatchSize:100];
  }

  [v16 setPredicate:v13];
  v19 = 0;
  v17 = [v8 executeFetchRequest:v16 error:&v19];

  objc_autoreleasePoolPop(v7);

  return v17;
}

+ (id)allCloudSharedAssetsInLibrary:(id)a3
{
  v4 = [a3 managedObjectContext];
  v5 = [a1 assetsWithValidatedSavedAssetTypeMask:objc_msgSend(MEMORY[0x1E69BF328] inManagedObjectContext:{"maskForCloudSharedAsset"), v4}];

  return v5;
}

- (id)payloadForChangedKeys:(id)a3
{
  v4 = a3;
  if ([(PLManagedAsset *)self isValidForJournalPersistence])
  {
    v5 = [(PLManagedObjectJournalEntryPayload *)[PLAssetJournalEntryPayload alloc] initWithManagedObject:self changedKeys:v4];
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)payloadIDForTombstone:(id)a3
{
  v3 = [a3 objectForKeyedSubscript:@"uuid"];
  v4 = [PLJournalEntryPayloadIDFactory payloadIDWithUUIDString:v3];

  return v4;
}

- (id)payloadID
{
  v2 = [(PLManagedAsset *)self uuid];
  v3 = [PLJournalEntryPayloadIDFactory payloadIDWithUUIDString:v2];

  return v3;
}

- (BOOL)isValidForJournalPersistence
{
  v2 = MEMORY[0x1E69BF2A0];
  v3 = [(PLManagedAsset *)self bundleScope];

  return [v2 bundleScopeShouldBePersistedForRebuild:v3];
}

- (BOOL)_setupPlaceholderAdjustmentPropertiesFromSourceAsset:(id)a3 bakeInAdjustmentsFromSourceAsset:(BOOL)a4 library:(id)a5
{
  v32 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a5;
  if ([v8 hasAdjustments])
  {
    v10 = MEMORY[0x1E6994D48];
    if (a4)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v11 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
        {
          v12 = [v8 uuid];
          v13 = [(PLManagedAsset *)self uuid];
          *buf = 138412546;
          v27 = v12;
          v28 = 2112;
          v29 = v13;
          _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Baking in adjustments from sourceAsset: %@ into placeholderAsset: %@", buf, 0x16u);
        }
      }

      -[PLManagedAsset setOriginalHeight:](self, "setOriginalHeight:", [v8 height]);
      -[PLManagedAsset setOriginalWidth:](self, "setOriginalWidth:", [v8 width]);
      -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [v8 orientation]);
      [(PLManagedAsset *)self setVideoCpVisibilityState:0];
      goto LABEL_8;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v15 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
      {
        v16 = [v8 uuid];
        v17 = [(PLManagedAsset *)self uuid];
        *buf = 138412546;
        v27 = v16;
        v28 = 2112;
        v29 = v17;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_DEFAULT, "Copying adjustments from sourceAsset: %@ to placeholderAsset: %@", buf, 0x16u);
      }
    }

    v25 = 0;
    v18 = [PLUnmanagedAdjustment copyUnmanagedAdjustmentFromSourceAsset:v8 forPlaceholderAsset:self inLibrary:v9 error:&v25];
    v19 = v25;
    v14 = v19 == 0;
    if (v19)
    {
      if (*v10)
      {
LABEL_19:

        goto LABEL_20;
      }

      v20 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v27 = v8;
        v28 = 2112;
        v29 = self;
        v30 = 2112;
        v31 = v19;
        _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_ERROR, "Failed to copy unmanaged adjustmnent from sourceAsset: %@ to placeholderAsset: %@, %@", buf, 0x20u);
      }
    }

    else
    {
      -[PLManagedAsset setAdjustmentsState:](self, "setAdjustmentsState:", [v8 adjustmentsState]);
      v21 = [(PLManagedAsset *)self additionalAttributes];
      v22 = [v8 additionalAttributes];
      v23 = [v22 adjustedStableHash];
      [v21 setAdjustedStableHash:v23];

      v20 = [(PLManagedAsset *)self additionalAttributes];
      [v20 setUnmanagedAdjustment:v18];
    }

    goto LABEL_19;
  }

LABEL_8:
  v14 = 1;
LABEL_20:

  return v14;
}

- (BOOL)setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:(id)a3 placeholderAssetUUID:(id)a4 bundleScope:(unsigned __int16)a5 share:(id)a6 importSessionID:(id)a7 bakeInAdjustmentsFromSourceAsset:(BOOL)a8 flattenLivePhoto:(BOOL)a9 copyTitleDescriptionAndKeywords:(BOOL)a10 copyCameraProcessingAdjustmentResources:(BOOL)a11 library:(id)a12
{
  v95 = a8;
  v14 = a5;
  v101 = *MEMORY[0x1E69E9840];
  v18 = a3;
  v19 = a4;
  v20 = a6;
  v94 = a7;
  v93 = a12;
  v96 = v20;
  v21 = [objc_opt_class() subclassKind];
  [(PLManagedAsset *)self setUuid:v19];
  v92 = v19;
  [(PLManagedAsset *)self setCloudAssetGUID:v19];
  v22 = [v18 dateCreated];
  [(PLManagedAsset *)self setDateCreated:v22];

  v23 = [v18 uniformTypeIdentifier];
  [(PLManagedAsset *)self setUniformTypeIdentifier:v23];

  -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForPlaceholder]);
  [(PLManagedAsset *)self setBundleScope:v14];
  -[PLManagedAsset setHeight:](self, "setHeight:", [v18 height]);
  -[PLManagedAsset setWidth:](self, "setWidth:", [v18 width]);
  -[PLManagedAsset setOriginalHeight:](self, "setOriginalHeight:", [v18 originalHeight]);
  -[PLManagedAsset setOriginalWidth:](self, "setOriginalWidth:", [v18 originalWidth]);
  -[PLManagedAsset setKind:](self, "setKind:", [v18 kind]);
  -[PLManagedAsset setKindSubtype:](self, "setKindSubtype:", [v18 kindSubtype]);
  -[PLManagedAsset setPlaybackStyle:](self, "setPlaybackStyle:", [v18 playbackStyle]);
  -[PLManagedAsset setPlaybackVariation:](self, "setPlaybackVariation:", [v18 playbackVariation]);
  -[PLManagedAsset setVideoCpDurationValue:](self, "setVideoCpDurationValue:", [v18 videoCpDurationValue]);
  -[PLManagedAsset setVideoCpVisibilityState:](self, "setVideoCpVisibilityState:", [v18 videoCpVisibilityState]);
  -[PLManagedAsset setOrientation:](self, "setOrientation:", [v18 orientation]);
  -[PLManagedAsset setOriginalOrientation:](self, "setOriginalOrientation:", [v18 originalOrientation]);
  [v18 duration];
  [(PLManagedAsset *)self setDuration:?];
  -[PLManagedAsset setHdrType:](self, "setHdrType:", [v18 hdrType]);
  v24 = [v18 mediaGroupUUID];
  [(PLManagedAsset *)self setMediaGroupUUID:v24];

  v25 = [v18 location];
  [(PLManagedAsset *)self setLocation:v25];

  v26 = [v18 reverseLocationData];
  [(PLManagedAsset *)self setReverseLocationData:v26];

  -[PLManagedAsset setPackedPreferredCropRect:](self, "setPackedPreferredCropRect:", [v18 packedPreferredCropRect]);
  -[PLManagedAsset setPackedAcceptableCropRect:](self, "setPackedAcceptableCropRect:", [v18 packedAcceptableCropRect]);
  -[PLManagedAsset setHighFrameRateState:](self, "setHighFrameRateState:", [v18 highFrameRateState]);
  v27 = [(PLManagedAsset *)self additionalAttributes];
  v28 = [v18 scopedIdentifier];
  [v27 setSourceAssetForDuplicationCPLScopedIdentifier:v28];

  if (v21 == 1)
  {
    [(PLManagedAsset *)self setMomentShare:v20];
  }

  else if (v21 == 3)
  {
    [(PLManagedAsset *)self setCollectionShareWithCurrentUserAsContributor:v20];
  }

  else if (v21 == 2)
  {
    v29 = [MEMORY[0x1E696AAA8] currentHandler];
    [v29 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Share.m" lineNumber:394 description:{@"%s called with invalid subclass kind", "-[PLManagedAsset(Share) setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:placeholderAssetUUID:bundleScope:share:importSessionID:bakeInAdjustmentsFromSourceAsset:flattenLivePhoto:copyTitleDescriptionAndKeywords:copyCameraProcessingAdjustmentResources:library:]"}];
  }

  if (a11)
  {
    -[PLManagedAsset setCameraProcessingAdjustmentState:](self, "setCameraProcessingAdjustmentState:", [v18 cameraProcessingAdjustmentState]);
    v30 = [(PLManagedAsset *)self additionalAttributes];
    v31 = [v18 additionalAttributes];
    v32 = [v31 spatialOverCaptureGroupIdentifier];
    [v30 setSpatialOverCaptureGroupIdentifier:v32];
  }

  v33 = [(PLManagedAsset *)self additionalAttributes];
  v34 = [v18 additionalAttributes];
  [v33 setVideoCpDisplayTimescale:{objc_msgSend(v34, "videoCpDisplayTimescale")}];
  [v33 setVideoCpDisplayValue:{objc_msgSend(v34, "videoCpDisplayValue")}];
  [v33 setVideoCpDurationTimescale:{objc_msgSend(v34, "videoCpDurationTimescale")}];
  v35 = [v34 originalFilename];
  [v33 setOriginalFilename:v35];

  v36 = [v34 originalFilesize];
  [v33 setOriginalFilesize:v36];

  v37 = [v34 timeZoneOffset];
  [v33 setTimeZoneOffset:v37];

  v38 = [v34 timeZoneName];
  [v33 setTimeZoneName:v38];

  if (a10)
  {
    v39 = [v34 title];
    [v33 setTitle:v39];

    v40 = [v34 accessibilityDescription];
    [v33 setAccessibilityDescription:v40];

    v41 = [v34 longDescription];
    [v33 setLongDescription:v41];

    v42 = [PLKeywordManager keywordsForAsset:v18];
    if ([v42 count])
    {
      v43 = [PLKeywordManager alloc];
      v44 = [(PLManagedObject *)self pathManager];
      v45 = [(PLKeywordManager *)v43 initWithPathManager:v44];

      [(PLKeywordManager *)v45 setKeywords:v42 forAsset:self];
    }
  }

  v46 = [v18 momentShare];

  if (v46)
  {
    [v33 setImportedBy:7];
    [v33 setShareType:1];
    v47 = [v18 momentShare];
  }

  else
  {
    v48 = [v18 collectionShare];

    if (!v48)
    {
      goto LABEL_18;
    }

    [v33 setImportedBy:15];
    [v33 setShareType:3];
    v47 = [v18 collectionShare];
  }

  v49 = v47;
  v50 = [v47 owner];
  v51 = [v50 userIdentifier];
  [v33 setShareOriginator:v51];

  v52 = [v18 additionalAttributes];
  v53 = [v52 syndicationIdentifier];
  [v33 setSyndicationIdentifier:v53];

LABEL_18:
  v54 = a9;
  v55 = [(PLManagedObject *)self photoLibrary];
  v56 = [v55 isCloudPhotoLibraryEnabled];

  if (v56)
  {
    v57 = v93;
    if ([(PLManagedAsset *)self shouldUseUBFPathManager])
    {
      v58 = [(PLManagedAsset *)self _setupPlaceholderAdjustmentPropertiesFromSourceAsset:v18 bakeInAdjustmentsFromSourceAsset:v95 library:v93];
      [(PLManagedAsset *)self setFilename:0];
      [(PLManagedAsset *)self setDirectory:0];
      v59 = [(PLManagedAsset *)self originalUniformTypeIdentifier];
      v60 = [(PLManagedAsset *)self originalFilename];
      [(PLManagedAsset *)self setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:v59 originalFilename:v60];

      v61 = v94;
      if (!a9)
      {
        goto LABEL_33;
      }
    }

    else
    {
      if (v21 == 1)
      {
        v62 = [v93 pathManager];
        v63 = [v62 privateDirectoryWithSubType:7];
        v64 = [v96 uuid];
        v65 = [v63 stringByAppendingPathComponent:v64];

        v66 = [v93 libraryServicesManager];
        v67 = [v66 imageWriter];
        v68 = [v18 fileExtension];
        v69 = v65;
        v70 = [v67 pathForNewAssetWithDirectoryPath:v65 fileName:v92 extension:v68];

        v91 = v70;
        v71 = [MEMORY[0x1E695DFF8] fileURLWithPath:v70 isDirectory:0];
        v72 = [(PLManagedObject *)self pathManager];
        v73 = [v71 path];
        v74 = [v73 stringByDeletingLastPathComponent];
        v75 = [v72 assetAbbreviatedMetadataDirectoryForDirectory:v74 type:32 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];

        v76 = v69;
        v57 = v93;

        v77 = [v71 lastPathComponent];
        [(PLManagedAsset *)self setDirectory:v75];
        [(PLManagedAsset *)self setFilename:v77];
      }

      else
      {
        v76 = [(PLManagedAsset *)self photoDataCPLResourceDestinationDirectoryCreateIfNeededWithIdentifier:v19];
        v78 = [v18 pathForOriginalFile];
        v79 = [v78 pathExtension];
        v80 = [v79 uppercaseString];

        v91 = v80;
        v71 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@.%@", v92, v80];
        v81 = [(PLManagedObject *)self pathManager];
        v82 = [v81 assetAbbreviatedMetadataDirectoryForDirectory:v76 type:32 bundleScope:{-[PLManagedAsset bundleScope](self, "bundleScope")}];
        [(PLManagedAsset *)self setDirectory:v82];

        [(PLManagedAsset *)self setFilename:v71];
      }

      v58 = [(PLManagedAsset *)self _setupPlaceholderAdjustmentPropertiesFromSourceAsset:v18 bakeInAdjustmentsFromSourceAsset:v95 library:v57];
      v61 = v94;
      v54 = a9;
      if (!a9)
      {
        goto LABEL_33;
      }
    }
  }

  else
  {
    v58 = 1;
    v57 = v93;
    v61 = v94;
    if (!a9)
    {
      goto LABEL_33;
    }
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v83 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v83, OS_LOG_TYPE_DEFAULT))
    {
      v84 = [v18 uuid];
      v85 = [(PLManagedAsset *)self uuid];
      *buf = 138412546;
      v98 = v84;
      v99 = 2112;
      v100 = v85;
      _os_log_impl(&dword_19BF1F000, v83, OS_LOG_TYPE_DEFAULT, "Flattening live photo from sourceAsset: %@ to placeholderAsset: %@", buf, 0x16u);

      v61 = v94;
    }
  }

  [(PLManagedAsset *)self setPlaybackStyle:1];
LABEL_33:
  if (v95 && [v18 isLoopingVideo])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v86 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v86, OS_LOG_TYPE_DEFAULT))
      {
        v87 = [(PLManagedAsset *)self uuid];
        v88 = [v18 uuid];
        *buf = 138412546;
        v98 = v87;
        v99 = 2112;
        v100 = v88;
        _os_log_impl(&dword_19BF1F000, v86, OS_LOG_TYPE_DEFAULT, "Resetting kind, kindSubtype and VideoCP state on baked-in placeholder asset %@ as source asset is looping video %@", buf, 0x16u);

        v61 = v94;
      }
    }

    [(PLManagedAsset *)self setKind:1];
  }

  else if (!v54)
  {
    goto LABEL_42;
  }

  [(PLManagedAsset *)self setKindSubtype:0];
  [(PLManagedAsset *)self setVideoCpDurationValue:0];
  [(PLManagedAsset *)self setVideoCpVisibilityState:0];
  v89 = [(PLManagedAsset *)self additionalAttributes];
  [v89 setVideoCpDisplayTimescale:0];
  [v89 setVideoCpDisplayValue:0];
  [v89 setVideoCpDurationTimescale:0];

LABEL_42:
  if (v61)
  {
    [(PLManagedAsset *)self setImportSessionAlbumWithImportSessionID:v61];
  }

  return v58;
}

- (unint64_t)masterResourceTypeForAdjustedAssetResourceType:(unint64_t)a3 flattenLivePhoto:(BOOL)a4
{
  if (a4)
  {
    if (a3 - 2 >= 4)
    {
      return 0;
    }

    else
    {
      return qword_19C60FF78[a3 - 2];
    }
  }

  if (a3 > 0x1C)
  {
    goto LABEL_14;
  }

  if (((1 << a3) & 0x102201F8) != 0)
  {
    return a3;
  }

  if (a3 == 16)
  {
    return [(PLManagedAsset *)self isVideo];
  }

  if (a3 != 19)
  {
LABEL_14:
    if (a3 != 2)
    {
      return 0;
    }

    if ([(PLManagedAsset *)self isLoopingVideo])
    {
      return 2;
    }

    return [(PLManagedAsset *)self isPhoto];
  }

  if ([(PLManagedAsset *)self isLoopingVideo])
  {
    return 1;
  }

  else
  {
    return 18;
  }
}

- (id)sortPlaceholderCloudResourcesByOrderOfCloudReReference:(id)a3
{
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __80__PLManagedAsset_Share__sortPlaceholderCloudResourcesByOrderOfCloudReReference___block_invoke;
  v5[3] = &unk_1E75753D0;
  v6 = &unk_1F0FC0180;
  v3 = [a3 sortedArrayUsingComparator:v5];

  return v3;
}

uint64_t __80__PLManagedAsset_Share__sortPlaceholderCloudResourcesByOrderOfCloudReReference___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a3;
  v6 = [a2 cplType];
  v7 = [v5 cplType];

  v8 = MEMORY[0x1E696AD98];
  v9 = *(a1 + 32);
  v10 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v6];
  v11 = [v8 numberWithUnsignedInteger:{objc_msgSend(v9, "indexOfObject:", v10)}];

  v12 = MEMORY[0x1E696AD98];
  v13 = *(a1 + 32);
  v14 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v7];
  v15 = [v12 numberWithUnsignedInteger:{objc_msgSend(v13, "indexOfObject:", v14)}];

  v16 = [v11 compare:v15];
  return v16;
}

- (id)filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources:(id)a3
{
  v3 = MEMORY[0x1E696AE18];
  v4 = a3;
  v5 = [v3 predicateWithBlock:&__block_literal_global_97_103348];
  v6 = [v4 filteredArrayUsingPredicate:v5];

  return v6;
}

BOOL __96__PLManagedAsset_Share__filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 cplType] != 23 && objc_msgSend(v2, "cplType") != 24;

  return v3;
}

- (id)fetchSourceAssetForDuplicationIfExists
{
  v3 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [v3 sourceAssetForDuplicationCPLScopedIdentifier];

  if (v4)
  {
    v5 = [(PLManagedObject *)self photoLibrary];
    v6 = [PLManagedAsset assetWithScopedIdentifier:v4 inLibrary:v5 prefetchResources:0];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)setDestinationAssetCopyStateOnSourceAsset:(signed __int16)a3
{
  v3 = a3;
  v4 = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if (v4)
  {
    v6 = v4;
    v5 = [v4 additionalAttributes];
    [v5 setDestinationAssetCopyState:v3];

    v4 = v6;
  }
}

- (void)fixupPlaceholderAssetWithSavedAssetType:(signed __int16)a3
{
  [(PLManagedAsset *)self setSavedAssetType:a3];
  v8 = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if (v8)
  {
    v4 = [v8 additionalAttributes];
    [v4 setDestinationAssetCopyState:2];
  }

  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setSourceAssetForDuplicationCPLScopedIdentifier:0];

  v6 = objc_opt_class();
  v7 = [(PLManagedAsset *)self master];
  [v6 processMediaMetadataForAsset:self withCloudMaster:v7];
}

- (id)shareRelationship
{
  v3 = [(PLManagedAsset *)self momentShare];

  if (v3)
  {
    v4 = [(PLManagedAsset *)self momentShare];
  }

  else
  {
    v5 = [(PLManagedAsset *)self collectionShare];

    if (v5)
    {
      v4 = [(PLManagedAsset *)self collectionShare];
    }

    else
    {
      v4 = 0;
    }
  }

  return v4;
}

- (BOOL)placeholder_shouldAllowServerCopy
{
  if (PLCloudPhotoLibraryMultiLibarySyncingEnabled_onceToken != -1)
  {
    dispatch_once(&PLCloudPhotoLibraryMultiLibarySyncingEnabled_onceToken, &__block_literal_global_60348);
  }

  return (PLCloudPhotoLibraryMultiLibarySyncingEnabled_multiLibrarySyncingEnabled & 1) == 0;
}

- (BOOL)placeholder_shouldFlattenLivePhoto
{
  v3 = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if ([v3 isPhotoIris])
  {
    v4 = ![(PLManagedAsset *)self isPhotoIris];
  }

  else
  {
    LOBYTE(v4) = 0;
  }

  return [(PLManagedAsset *)self playbackStyle]== 1 && v4;
}

- (BOOL)placeholder_shouldBakeInAdjustments
{
  v3 = [(PLManagedAsset *)self fetchSourceAssetForDuplicationIfExists];
  if ([v3 hasAdjustments])
  {
    v4 = ![(PLManagedAsset *)self hasAdjustments];
  }

  else
  {
    LOBYTE(v4) = 0;
  }

  return v4;
}

+ (id)_videoComplementURLForSharingFromAsset:(id)a3
{
  v23 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = PLPhotoSharingGetLog();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT))
  {
    v5 = [v3 uuid];
    *buf = 138412290;
    v20 = v5;
    _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_DEFAULT, "Determining video complement path to use. UUID: %@", buf, 0xCu);
  }

  v18 = 0;
  v6 = [v3 isPlayableVideo:&v18];
  v7 = v18;
  if (v6)
  {
    v8 = [v3 hasAdjustedVideoComplement];
    v9 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      if (v8)
      {
        v10 = @"adjusted";
      }

      else
      {
        v10 = @"original";
      }

      v11 = [v3 uuid];
      *buf = 138412546;
      v20 = v10;
      v21 = 2112;
      v22 = v11;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Using the %@ original video component. UUID: %@", buf, 0x16u);
    }

    if (v8)
    {
      [v3 pathForFullsizeRenderVideoFile];
    }

    else
    {
      [v3 pathForVideoComplementFile];
    }
    v12 = ;
  }

  else
  {
    v13 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
    {
      v14 = [v3 uuid];
      *buf = 138412546;
      v20 = v7;
      v21 = 2112;
      v22 = v14;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "Falling back to medium, since the original video component is unsupported. Codec: %@, UUID: %@", buf, 0x16u);
    }

    v12 = [v3 pathForMediumVideoFile];
  }

  v15 = v12;
  v16 = [MEMORY[0x1E695DFF8] fileURLWithPath:v12 isDirectory:0];

  return v16;
}

+ (void)_createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs:(id)a3 withBatchCommentText:(id)a4 adjustmentBakeInOptionsDictionary:(id)a5 collectionShare:(id)a6 library:(id)a7 completionHandler:(id)a8
{
  v13 = a3;
  v14 = a4;
  v15 = a5;
  v16 = a6;
  v17 = a7;
  v18 = a8;
  v19 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(v13, "count")}];
  v20 = [v17 pathManager];
  v21 = [v20 capabilities];

  v47 = 0;
  v48 = &v47;
  v49 = 0x3032000000;
  v50 = __Block_byref_object_copy__103360;
  v51 = __Block_byref_object_dispose__103361;
  v52 = 0;
  v41 = 0;
  v42 = &v41;
  v43 = 0x3032000000;
  v44 = __Block_byref_object_copy__103360;
  v45 = __Block_byref_object_dispose__103361;
  v46 = 0;
  v30[0] = MEMORY[0x1E69E9820];
  v30[1] = 3221225472;
  v30[2] = __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke;
  v30[3] = &unk_1E75754A0;
  v22 = v17;
  v31 = v22;
  v38 = &v41;
  v23 = v16;
  v32 = v23;
  v24 = v13;
  v33 = v24;
  v25 = v14;
  v34 = v25;
  v26 = v15;
  v35 = v26;
  v40 = a1;
  v27 = v21;
  v36 = v27;
  v28 = v19;
  v37 = v28;
  v39 = &v47;
  [v22 performTransactionAndWait:v30];
  v18[2](v18, v28, v48[5], v42[5]);

  _Block_object_dispose(&v41, 8);
  _Block_object_dispose(&v47, 8);
}

void __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke(uint64_t a1)
{
  v168[1] = *MEMORY[0x1E69E9840];
  v111 = +[PLPhotoSharingHelper sharingPersonID];
  if ([*(a1 + 32) isUnitTesting])
  {

    v111 = @"UnitTestID";
  }

  else if (!v111)
  {
    v101 = MEMORY[0x1E696ABC0];
    v167 = *MEMORY[0x1E696A278];
    v168[0] = @"sharingPersonID is nil";
    v111 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v168 forKeys:&v167 count:1];
    v102 = [v101 errorWithDomain:@"com.apple.photolibraryservices" code:5 userInfo:v111];
    v103 = *(*(a1 + 88) + 8);
    obj = *(v103 + 40);
    *(v103 + 40) = v102;
    goto LABEL_89;
  }

  if (*(a1 + 40))
  {
    v1 = [PLManagedAsset assetsWithUUIDs:*(a1 + 48) options:1 inLibrary:*(a1 + 32)];
    v2 = [v1 count];
    if (v2 != [*(a1 + 48) count])
    {
      v3 = PLPhotoSharingGetLog();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_ERROR))
      {
        v4 = [v1 count];
        v5 = [*(a1 + 48) count];
        *buf = 134218240;
        *&buf[4] = v4;
        *&buf[12] = 2048;
        *&buf[14] = v5;
        _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_ERROR, "ERROR: Only found %lu originalAssets, expected %lu", buf, 0x16u);
      }
    }

    v124 = [MEMORY[0x1E695DF90] dictionaryWithCapacity:{objc_msgSend(v1, "count")}];
    v151 = 0u;
    v152 = 0u;
    v149 = 0u;
    v150 = 0u;
    obj = v1;
    v6 = [obj countByEnumeratingWithState:&v149 objects:v164 count:16];
    if (v6)
    {
      v7 = *v150;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v150 != v7)
          {
            objc_enumerationMutation(obj);
          }

          v9 = *(*(&v149 + 1) + 8 * i);
          v10 = [v9 uuid];
          [v124 setObject:v9 forKey:v10];
        }

        v6 = [obj countByEnumeratingWithState:&v149 objects:v164 count:16];
      }

      while (v6);
    }

    v107 = [MEMORY[0x1E69BF320] UUIDString];
    v108 = [MEMORY[0x1E695DF00] date];
    v106 = [*(a1 + 56) length];
    v11 = [MEMORY[0x1E695DFA8] setWithCapacity:{objc_msgSend(*(a1 + 64), "count")}];
    v12 = *(a1 + 64);
    v147[0] = MEMORY[0x1E69E9820];
    v147[1] = 3221225472;
    v147[2] = __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_199;
    v147[3] = &unk_1E7575450;
    v110 = v11;
    v148 = v110;
    [v12 enumerateKeysAndObjectsUsingBlock:v147];
    v13 = *(a1 + 48);
    v143 = 0u;
    v144 = 0u;
    v145 = 0u;
    v146 = 0u;
    v116 = v13;
    v120 = [v116 countByEnumeratingWithState:&v143 objects:v163 count:16];
    if (v120)
    {
      v119 = *v144;
      v115 = *MEMORY[0x1E696A278];
      v109 = *MEMORY[0x1E696AA08];
      v105 = *MEMORY[0x1E6987348];
      v104 = *MEMORY[0x1E69874B8];
      do
      {
        for (j = 0; j != v120; ++j)
        {
          if (*v144 != v119)
          {
            objc_enumerationMutation(v116);
          }

          v15 = *(*(&v143 + 1) + 8 * j);
          v16 = [v124 objectForKey:v15];
          if (v16)
          {
            context = objc_autoreleasePoolPush();
            v17 = [v16 isVideo];
            v118 = [v16 playbackVariation];
            v18 = [v16 isLoopingVideo];
            if (v18)
            {
              v19 = PLPhotoSharingGetLog();
              if (os_log_type_enabled(v19, OS_LOG_TYPE_DEFAULT))
              {
                *buf = 134217984;
                *&buf[4] = v118;
                _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_DEFAULT, "Sharing looping video with playback variation %ld", buf, 0xCu);
              }

              if (v17)
              {
                v125 = [v16 pathForVideoFile];
                v20 = PLPhotoSharingGetLog();
                if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
                {
                  *buf = 138412290;
                  *&buf[4] = v125;
                  v21 = v20;
                  v22 = "Original is a looping video, use the original file %@";
                  goto LABEL_41;
                }

LABEL_42:

                if (!v125)
                {
                  v128 = [MEMORY[0x1E696AEC0] stringWithFormat:@"No local file path on disk to support sharing asset %@", v15];
                  v26 = MEMORY[0x1E696ABC0];
                  v161 = v115;
                  v162 = v128;
                  v27 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v162 forKeys:&v161 count:1];
                  v28 = [v26 errorWithDomain:@"com.apple.photolibraryservices" code:7 userInfo:v27];
                  v127 = 0;
                  v29 = *(*(a1 + 88) + 8);
                  v30 = *(v29 + 40);
                  *(v29 + 40) = v28;
LABEL_83:

                  objc_autoreleasePoolPop(context);
                  goto LABEL_84;
                }

                v127 = [MEMORY[0x1E695DFF8] fileURLWithPath:v125 isDirectory:0];
                if ([v16 canPlayPhotoIris] && (objc_msgSend(v16, "uuid"), v24 = objc_claimAutoreleasedReturnValue(), v25 = objc_msgSend(v110, "containsObject:", v24), v24, ((v18 | v25) & 1) == 0))
                {
                  v128 = [*(a1 + 104) _videoComplementURLForSharingFromAsset:v16];
                }

                else
                {
                  v128 = 0;
                }

                v31 = [MEMORY[0x1E696AFB0] UUID];
                v27 = [v31 UUIDString];

                v121 = [v127 pathExtension];
                v32 = [*(a1 + 40) scopeIdentifier];
                v33 = [*(a1 + 32) pathManager];
                v126 = [PLCloudSharedAssetSaveJob nextDCIMSaveFileURLForCloudPersonID:v111 cloudAlbumGUID:v32 pathManager:v33 fileExtension:v121 assetUUID:v27];

                if (v128)
                {
                  v34 = [v126 URLByDeletingLastPathComponent];
                  v35 = [v126 lastPathComponent];
                  v36 = [v35 stringByDeletingPathExtension];

                  v37 = [v128 pathExtension];
                  v38 = [v37 uppercaseString];
                  v39 = [v36 stringByAppendingPathExtension:v38];

                  v40 = [v34 URLByAppendingPathComponent:v39];

                  if (!v17)
                  {
                    goto LABEL_58;
                  }
                }

                else
                {
                  v40 = 0;
                  if (!v17)
                  {
                    goto LABEL_58;
                  }
                }

                if ([v16 isDefaultAdjustedSlomo] && objc_msgSend(v16, "isPlayableVideo:", 0))
                {
                  v41 = PLPhotoSharingGetLog();
                  if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
                  {
                    *buf = 138412290;
                    *&buf[4] = v126;
                    _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_DEFAULT, "Original is a slow-mo, flatten the video to %@", buf, 0xCu);
                  }

                  v113 = v40;
                  v42 = v105;
                  v43 = dispatch_semaphore_create(0);
                  *buf = 0;
                  *&buf[8] = buf;
                  *&buf[16] = 0x2020000000;
                  LOBYTE(v160) = 0;
                  v44 = [PLSlalomUtilities videoAVObjectBuilderForManagedAsset:v16 applyVideoAdjustments:1];
                  v136[0] = MEMORY[0x1E69E9820];
                  v136[1] = 3221225472;
                  v136[2] = __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_209;
                  v136[3] = &unk_1E7575478;
                  v137 = v127;
                  v45 = v126;
                  v46 = *(a1 + 88);
                  v138 = v45;
                  v140 = v46;
                  v141 = buf;
                  v47 = v43;
                  v139 = v47;
                  v134 = *MEMORY[0x1E6960CC0];
                  v135 = *(MEMORY[0x1E6960CC0] + 16);
                  v132 = v134;
                  v133 = v135;
                  [PLVideoTranscoder transcodeVideoWithObjectBuilder:v44 outputURL:v45 startTime:&v134 endTime:&v132 presetName:v42 outputFileType:v104 metadata:0 completionHandler:v136];
                  dispatch_semaphore_wait(v47, 0xFFFFFFFFFFFFFFFFLL);
                  LOBYTE(v43) = *(*&buf[8] + 24);

                  v40 = v113;
                  _Block_object_dispose(buf, 8);

                  if (v43)
                  {
LABEL_82:

                    v30 = v121;
                    goto LABEL_83;
                  }
                }

                else
                {
LABEL_58:
                  v131 = 0;
                  v48 = [MEMORY[0x1E69BF238] copyItemAtURL:v127 toURL:v126 error:&v131];
                  v49 = v131;
                  v50 = v49;
                  if ((v48 & 1) == 0)
                  {
                    v63 = MEMORY[0x1E696AEC0];
                    v64 = [v127 path];
                    v65 = [v126 path];
                    v66 = [v63 stringWithFormat:@"Unable to copy %@ to %@: %@", v64, v65, v50];

                    v67 = MEMORY[0x1E696ABC0];
                    v157[0] = v115;
                    v157[1] = v109;
                    v158[0] = v66;
                    v158[1] = v50;
                    v68 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v158 forKeys:v157 count:2];
                    v69 = [v67 errorWithDomain:@"com.apple.photolibraryservices" code:9 userInfo:v68];
                    v70 = *(*(a1 + 88) + 8);
                    v71 = *(v70 + 40);
                    *(v70 + 40) = v69;

                    goto LABEL_82;
                  }
                }

                *&v132 = 0;
                v51 = *(a1 + 32);
                v52 = [MEMORY[0x1E69BF328] savedAssetTypeForCloudSharedAsset];
                v130 = 0;
                v53 = [PLManagedAsset insertAssetIntoPhotoLibrary:v51 mainFileURL:v126 savedAssetType:v52 bundleScope:2 uuid:v27 replacementUUID:0 imageSource:&v132 imageData:&v130];
                v114 = v130;
                v54 = [PLPhotoSharingHelper photoSharingOriginalFilenameForAsset:v16];
                [v53 setOriginalFilename:v54];

                if (v53)
                {
                  if ([v53 isVideo])
                  {
                    v129 = 0;
                    v55 = [v53 isPlayableVideo:&v129];
                    v56 = v129;
                    v112 = v56;
                    if ((v55 & 1) == 0)
                    {
                      v57 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Can't play new asset for file at %@, with codec: %@", v126, v56];
                      v58 = MEMORY[0x1E696ABC0];
                      v153 = v115;
                      v154 = v57;
                      v59 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v154 forKeys:&v153 count:1];
                      v60 = [v58 errorWithDomain:@"com.apple.photolibraryservices" code:10 userInfo:v59];
                      v61 = *(*(a1 + 88) + 8);
                      v62 = *(v61 + 40);
                      *(v61 + 40) = v60;

LABEL_81:
                      goto LABEL_82;
                    }
                  }

                  else
                  {
                    v112 = 0;
                  }

                  [v53 setVisibilityState:2];
                  v76 = PLPhotoSharingGetLog();
                  if (os_log_type_enabled(v76, OS_LOG_TYPE_DEFAULT))
                  {
                    *buf = 138412290;
                    *&buf[4] = v15;
                    _os_log_impl(&dword_19BF1F000, v76, OS_LOG_TYPE_DEFAULT, "Generating new thumbnails for asset with UUID %@", buf, 0xCu);
                  }

                  [v53 generateAndUpdateThumbnailsWithPreviewImage:0 thumbnailImage:0 fromImageSource:v132 imageData:v114 forceSRGBConversion:1];
                  v57 = [MEMORY[0x1E69BF320] UUIDString];
                  v77 = [v16 additionalAttributes];
                  v78 = [v77 originalFilename];
                  v79 = [v53 additionalAttributes];
                  [v79 setOriginalFilename:v78];

                  [v53 setCloudAssetGUID:v57];
                  [v53 setCloudBatchID:v107];
                  [v53 setCloudBatchPublishDate:v108];
                  [v53 setCloudIsMyAsset:1];
                  [v53 setCloudIsDeletable:1];
                  v80 = [v16 dateCreated];
                  [v53 setDateCreated:v80];

                  [v53 setPlaybackVariationAndLoopingPlaybackStyleWithPlaybackVariation:v118];
                  if (v17)
                  {
                    v81 = [v16 uuid];
                    [v53 setOriginalAssetsUUID:v81];

                    v82 = PLPhotoSharingGetLog();
                    if (os_log_type_enabled(v82, OS_LOG_TYPE_DEFAULT))
                    {
                      v83 = [v53 originalAssetsUUID];
                      *buf = 138412290;
                      *&buf[4] = v83;
                      _os_log_impl(&dword_19BF1F000, v82, OS_LOG_TYPE_DEFAULT, "Saved original video uuid %@ for later playback", buf, 0xCu);
                    }
                  }

                  if (v128)
                  {
                    v84 = [v16 mediaGroupUUID];
                    [v16 photoIrisVideoDuration];
                    [v16 photoIrisStillDisplayTime];
                    [v53 becomePhotoIrisWithMediaGroupUUID:v84 mainFileMetadata:0 videoURL:v128 videoDuration:buf stillDisplayTime:&v134 options:0];
                  }

                  [v53 setCollectionShareWithCurrentUserAsContributor:*(a1 + 40)];
                  v85 = PLPhotoSharingGetLog();
                  if (os_log_type_enabled(v85, OS_LOG_TYPE_DEFAULT))
                  {
                    v86 = [v126 path];
                    *buf = 138412802;
                    *&buf[4] = v127;
                    *&buf[12] = 2112;
                    *&buf[14] = v86;
                    *&buf[22] = 2112;
                    v160 = v57;
                    _os_log_impl(&dword_19BF1F000, v85, OS_LOG_TYPE_DEFAULT, "Created copy of original asset at %@ to %@ and assigned it new cloudAssetGUID %@", buf, 0x20u);
                  }

                  [*(a1 + 80) addObject:v53];
                  if (v106 && !*(*(*(a1 + 96) + 8) + 40))
                  {
                    v87 = [PLCloudSharedComment insertNewCommentIntoAsset:v53 commentDate:0 withText:*(a1 + 56) isLike:0 isMyComment:1 inLibrary:*(a1 + 32)];
                    v88 = *(*(a1 + 96) + 8);
                    v89 = *(v88 + 40);
                    *(v88 + 40) = v87;

                    v90 = *(*(*(a1 + 96) + 8) + 40);
                    v91 = [MEMORY[0x1E696AD98] numberWithBool:1];
                    [v90 setIsCaption:v91];

                    v92 = *(*(*(a1 + 96) + 8) + 40);
                    v93 = [MEMORY[0x1E696AD98] numberWithBool:1];
                    [v92 setIsBatchComment:v93];
                  }

                  [PLResourceInstaller installInternalResourcesForExistingAsset:v53 assumeNoExistingResources:1 referencedResourceURLs:0 error:0];
                  goto LABEL_81;
                }

                v112 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Couldn't insert new asset for file at %@", v126];
                v72 = MEMORY[0x1E696ABC0];
                v155 = v115;
                v156 = v112;
                v57 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v156 forKeys:&v155 count:1];
                v73 = [v72 errorWithDomain:@"com.apple.photolibraryservices" code:10 userInfo:v57];
                v74 = *(*(a1 + 88) + 8);
                v75 = *(v74 + 40);
                *(v74 + 40) = v73;

                goto LABEL_81;
              }

              v125 = [v16 pathForFullsizeRenderVideoFile];
              v20 = PLPhotoSharingGetLog();
              if (!os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                goto LABEL_42;
              }

              *buf = 138412290;
              *&buf[4] = v125;
              v21 = v20;
              v22 = "Original is a regular photo, use the full size render video file %@";
            }

            else if (v17)
            {
              if ([v16 isPlayableVideo:0])
              {
                if ([v16 isCloudSharedAsset])
                {
                  [v16 cloudSharedAssetPathForPlaceholderKind:9];
                }

                else
                {
                  [v16 pathForVideoFile];
                }
                v125 = ;
              }

              else
              {
                v125 = [v16 pathForMediumVideoFile];
              }

              v20 = PLPhotoSharingGetLog();
              if (!os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                goto LABEL_42;
              }

              *buf = 138412290;
              *&buf[4] = v125;
              v21 = v20;
              v22 = "Original is a video, use the video file %@";
            }

            else
            {
              v142 = 0;
              v23 = [PLResourceChooser fileReservationForLargeDisplayableImageFileForAsset:v16 format:0 allowMetadataSnapshot:0 forceLarge:1 outFilePath:&v142 outImageType:0];
              v125 = v142;
              v20 = PLPhotoSharingGetLog();
              if (!os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                goto LABEL_42;
              }

              *buf = 138412290;
              *&buf[4] = v125;
              v21 = v20;
              v22 = "Original is not a video, use the large displayable image file %@";
            }

LABEL_41:
            _os_log_impl(&dword_19BF1F000, v21, OS_LOG_TYPE_DEFAULT, v22, buf, 0xCu);
            goto LABEL_42;
          }

LABEL_84:
        }

        v120 = [v116 countByEnumeratingWithState:&v143 objects:v163 count:16];
      }

      while (v120);
    }

    [*(a1 + 40) setLastModifiedDate:v108];
    [*(a1 + 40) recomputeCachedValues];
  }

  else
  {
    v94 = MEMORY[0x1E696AEC0];
    v95 = [0 scopeIdentifier];
    obj = [v94 stringWithFormat:@"Couldn't find SharedStream Collection Share with scopeIdentifier %@ to publish assets from", v95];

    v96 = MEMORY[0x1E696ABC0];
    v165 = *MEMORY[0x1E696A278];
    v166 = obj;
    v97 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v166 forKeys:&v165 count:1];
    v98 = [v96 errorWithDomain:@"com.apple.photolibraryservices" code:6 userInfo:v97];
    v99 = *(*(a1 + 88) + 8);
    v100 = *(v99 + 40);
    *(v99 + 40) = v98;
  }

LABEL_89:
}

void __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_199(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  if ([a3 flattenLivePhotoToStillIfNeeded])
  {
    [*(a1 + 32) addObject:v5];
  }
}

void __185__PLManagedAsset_Share___createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs_withBatchCommentText_adjustmentBakeInOptionsDictionary_collectionShare_library_completionHandler___block_invoke_209(uint64_t a1, uint64_t a2, void *a3)
{
  v22[2] = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (v4)
  {
    v5 = MEMORY[0x1E696AEC0];
    v6 = [*(a1 + 32) path];
    v7 = [*(a1 + 40) path];
    v8 = [v5 stringWithFormat:@"Could not generate trimmed video for %@ to %@ error %@", v6, v7, v4];

    v9 = MEMORY[0x1E696ABC0];
    v10 = *MEMORY[0x1E696AA08];
    v21[0] = *MEMORY[0x1E696A278];
    v21[1] = v10;
    v22[0] = v8;
    v22[1] = v4;
    v11 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v22 forKeys:v21 count:2];
    v12 = [v9 errorWithDomain:@"com.apple.photolibraryservices" code:8 userInfo:v11];
    v13 = *(*(a1 + 56) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = v12;

    *(*(*(a1 + 64) + 8) + 24) = 1;
  }

  else
  {
    v8 = PLPhotoSharingGetLog();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
    {
      v15 = [*(a1 + 32) path];
      v16 = [*(a1 + 40) path];
      *buf = 138412546;
      v18 = v15;
      v19 = 2112;
      v20 = v16;
      _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "generated trimmed video of %@ to %@ ", buf, 0x16u);
    }
  }

  dispatch_semaphore_signal(*(a1 + 48));
}

+ (BOOL)attemptToRecreateMasterAndAssetResourcesForPlaceholderAssetRepush:(id)a3 sourceAsset:(id)a4 library:(id)a5
{
  v7 = a3;
  v8 = a4;
  v9 = a5;
  v10 = [v7 placeholder_shouldBakeInAdjustments];
  v11 = [v7 placeholder_shouldFlattenLivePhoto];
  if ([PLManagedAsset createMasterForPlaceholderAsset:v7 withSourceAsset:v8 shouldBakeInAdjustments:v10 shouldFlattenLivePhoto:v11 placeholderResourceURLToSourceResourceURLMap:0 photoLibrary:v9])
  {
    v12 = [PLManagedAsset createAssetResourcesForPlaceholderAsset:v7 withSourceAsset:v8 shouldBakeInAdjustments:v10 shouldFlattenLivePhoto:v11 placeholderResourceURLToSourceResourceURLMap:0 photoLibrary:v9];
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

+ (BOOL)cloneResourceFileFromURL:(id)a3 toURL:(id)a4 forDestinationResource:(id)a5 forDestinationAsset:(id)a6 fileManager:(id)a7 error:(id *)a8
{
  v49[1] = *MEMORY[0x1E69E9840];
  v13 = a3;
  v14 = a4;
  v15 = a5;
  v16 = a6;
  v17 = a7;
  v18 = [v14 path];
  v19 = [v18 stringByDeletingLastPathComponent];
  v41 = 0;
  v20 = [v17 createDirectoryAtPath:v19 withIntermediateDirectories:1 attributes:0 error:&v41];
  v21 = v41;

  if (!v20)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v26 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        v27 = [v16 scopedIdentifier];
        *buf = 138412802;
        v43 = v14;
        v44 = 2112;
        v45 = v13;
        v46 = 2112;
        v47 = v27;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Failed to create directory for resource at %@ from %@. Asset: %@", buf, 0x20u);
      }
    }

    if (a8)
    {
      goto LABEL_22;
    }

    goto LABEL_10;
  }

  v40 = v21;
  v22 = [v17 copyItemAtURL:v13 toURL:v14 error:&v40];
  v23 = v40;

  if (!v22)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v28 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        v29 = [v16 scopedIdentifier];
        *buf = 138412802;
        v43 = v14;
        v44 = 2112;
        v45 = v13;
        v46 = 2112;
        v47 = v29;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "Failed to clone resource at %@ from %@. Asset: %@", buf, 0x20u);
      }
    }

    if (!a8)
    {
      v25 = 0;
      goto LABEL_24;
    }

    v21 = v23;
    goto LABEL_22;
  }

  v24 = [v14 path];
  [v15 markAsLocallyAvailableWithFilePath:v24];

  if (([v15 copyPurgeabilityFromFileURL:v13] & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v30 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        v31 = [v16 scopedIdentifier];
        *buf = 138412546;
        v43 = v14;
        v44 = 2112;
        v45 = v31;
        _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_ERROR, "Failed to update purgeability of resource at %@. Asset: %@", buf, 0x16u);
      }
    }

    v38 = MEMORY[0x1E696ABC0];
    v32 = *MEMORY[0x1E69BFF48];
    v48 = *MEMORY[0x1E696A578];
    v33 = MEMORY[0x1E696AEC0];
    v39 = [v16 scopedIdentifier];
    v34 = [v33 stringWithFormat:@"Failed to update purgeability of resource at %@. Asset: %@", v14, v39];
    v49[0] = v34;
    v35 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v49 forKeys:&v48 count:1];
    v21 = [v38 errorWithDomain:v32 code:47011 userInfo:v35];

    if (a8)
    {
LABEL_22:
      v36 = v21;
      v25 = 0;
      *a8 = v21;
      goto LABEL_23;
    }

LABEL_10:
    v25 = 0;
LABEL_23:
    v23 = v21;
    goto LABEL_24;
  }

  v25 = 1;
LABEL_24:

  return v25;
}

+ (void)_cloneResourcesForSharePlaceholderAsset:(id)a3 withPlaceholderResourceURLToSourceResourceURLMap:(id)a4 fileManager:(id)a5 photoLibrary:(id)a6
{
  v31 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v25 = a5;
  v11 = [v9 allMasterCPLResources];
  v12 = v9;
  v13 = [v9 allAssetCPLResources];
  v14 = [v11 setByAddingObjectsFromSet:v13];

  v28 = 0u;
  v29 = 0u;
  v26 = 0u;
  v27 = 0u;
  v15 = v14;
  v16 = [v15 countByEnumeratingWithState:&v26 objects:v30 count:16];
  if (v16)
  {
    v17 = v16;
    v18 = *v27;
    do
    {
      for (i = 0; i != v17; ++i)
      {
        if (*v27 != v18)
        {
          objc_enumerationMutation(v15);
        }

        v20 = *(*(&v26 + 1) + 8 * i);
        v21 = [v20 cplFileURL];
        v22 = [v10 objectForKeyedSubscript:v21];
        v23 = v22;
        if (v21)
        {
          v24 = v22 == 0;
        }

        else
        {
          v24 = 1;
        }

        if (!v24)
        {
          [a1 cloneResourceFileFromURL:v22 toURL:v21 forDestinationResource:v20 forDestinationAsset:v12 fileManager:v25 error:0];
        }
      }

      v17 = [v15 countByEnumeratingWithState:&v26 objects:v30 count:16];
    }

    while (v17);
  }

  [v12 generateAndUpdateThumbnailsWithPreviewImage:0 thumbnailImage:0 fromImageSource:0 imageData:0 forceSRGBConversion:0];
}

+ (BOOL)createAssetResourcesForPlaceholderAsset:(id)a3 withSourceAsset:(id)a4 shouldBakeInAdjustments:(BOOL)a5 shouldFlattenLivePhoto:(BOOL)a6 placeholderResourceURLToSourceResourceURLMap:(id)a7 photoLibrary:(id)a8
{
  v46 = *MEMORY[0x1E69E9840];
  v11 = a3;
  v34 = a7;
  if (a5)
  {
    goto LABEL_30;
  }

  v12 = [a4 allAssetCPLResources];
  if (![v12 count])
  {
    goto LABEL_29;
  }

  v13 = [MEMORY[0x1E695DFA8] set];
  v33 = v12;
  v14 = [v12 allObjects];
  v15 = [v11 sortPlaceholderCloudResourcesByOrderOfCloudReReference:v14];

  v39 = 0u;
  v40 = 0u;
  v37 = 0u;
  v38 = 0u;
  obj = v15;
  v16 = [obj countByEnumeratingWithState:&v37 objects:v45 count:16];
  if (!v16)
  {
    goto LABEL_28;
  }

  v17 = v16;
  v18 = *v38;
  do
  {
    for (i = 0; i != v17; ++i)
    {
      if (*v38 != v18)
      {
        objc_enumerationMutation(obj);
      }

      v20 = *(*(&v37 + 1) + 8 * i);
      v21 = [v20 fingerprint];
      v22 = [v13 containsObject:v21];

      if (v22)
      {
        if (*MEMORY[0x1E6994D48])
        {
          continue;
        }

        v23 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412546;
          v42 = v20;
          v43 = 2112;
          v44 = a1;
          _os_log_impl(&dword_19BF1F000, v23, OS_LOG_TYPE_DEFAULT, "Skipping asset resource from re-referencing since it has the same fingerprint as another resource on this asset. Skipped resource: %@, asset: %@", buf, 0x16u);
        }
      }

      else
      {
        v24 = [v11 pathForCPLResourceType:objc_msgSend(v20 adjusted:{"cplType"), objc_msgSend(v11, "hasAdjustments")}];
        v23 = v24;
        if (v24 && [v24 length])
        {
          v25 = [v20 validatedExternalResourceRepresentationUsingFileURL:0];
          [v25 setSidecarIndex:0];
          v26 = [v11 storedResourceForExternalResource:v25 asset:v11];
          [v26 resetPrefetchState];
          v27 = [v26 fingerprint];
          [v13 addObject:v27];

          v28 = [v20 fileURL];
          v29 = [v26 cplFileURL];
          v30 = v29;
          if (v34 && v28 && v29)
          {
            [v34 setObject:v28 forKeyedSubscript:v29];
          }
        }

        else
        {
          v25 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Skipping asset resource from re-referencing since it has an invalid filePath. Skipped resource: %@, asset: %@", v20, a1];
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v31 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
            {
              *buf = 138412290;
              v42 = v25;
              _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "%@", buf, 0xCu);
            }
          }

          PLSimulateCrash();
        }
      }
    }

    v17 = [obj countByEnumeratingWithState:&v37 objects:v45 count:16];
  }

  while (v17);
LABEL_28:

  v12 = v33;
LABEL_29:

LABEL_30:
  return 1;
}

+ (BOOL)createMasterForPlaceholderAsset:(id)a3 withSourceAsset:(id)a4 shouldBakeInAdjustments:(BOOL)a5 shouldFlattenLivePhoto:(BOOL)a6 placeholderResourceURLToSourceResourceURLMap:(id)a7 photoLibrary:(id)a8
{
  v144 = a6;
  v10 = a5;
  v160 = *MEMORY[0x1E69E9840];
  v14 = a3;
  v15 = a4;
  v16 = a7;
  v17 = a8;
  v18 = [v15 master];

  if (v18)
  {
    if ([v15 hasAdjustments])
    {
      [v15 nonDynamicOriginalUTI];
    }

    else
    {
      [v15 uniformTypeIdentifier];
    }
    v139 = ;
    v142 = v14;
    if (!v10)
    {
      v151 = 0;
      v152 = 0;
      v27 = [v15 masterIdentifierCacheIfNecessaryAndOriginalStableHash:&v152 error:&v151];
      v138 = v152;
      v28 = v151;
      v140 = v27;
      if (!v27)
      {
        v19 = v139;
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v35 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
          {
            v36 = [v14 scopedIdentifier];
            *buf = 138412546;
            v155 = v36;
            v156 = 2112;
            v157 = v28;
            _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_ERROR, "Failed to retrieve source asset fingerprint for placeholder asset %@, error: %@", buf, 0x16u);

            v19 = v139;
          }
        }

        v22 = 0;
        v33 = v138;
        goto LABEL_109;
      }

      v29 = v10;
      v30 = v17;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v31 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
        {
          v32 = [v14 scopedIdentifier];
          *buf = 138412546;
          v155 = v32;
          v156 = 2112;
          v157 = v140;
          _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_DEFAULT, "Not baking in adjustments during master creation for asset: %@, using fingerprint: %@", buf, 0x16u);
        }
      }

      v137 = v16;

      if (v138)
      {
        v17 = v30;
        v10 = v29;
        goto LABEL_42;
      }

      v24 = [MEMORY[0x1E696AAA8] currentHandler];
      [v24 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+Share.m" lineNumber:894 description:{@"Failed to produce a stableHash for %@ from %@", v14, v15}];
      v138 = 0;
      v17 = v30;
      v10 = v29;
LABEL_41:

LABEL_42:
      v55 = [v14 shareRelationship];
      v56 = [v17 managedObjectContext];
      v57 = [PLCloudMaster cloudMasterWithGUID:v140 inShare:v55 prefetchResources:0 inManagedObjectContext:v56];

      if (v57)
      {
        [v14 setupPropertiesOnExistingMaster:v57];
        v16 = v137;
        v58 = v138;
        v19 = v139;
        v59 = v57;
LABEL_108:

        v22 = 1;
        v33 = v140;
LABEL_109:

        goto LABEL_110;
      }

      v60 = [v14 shareRelationship];
      v61 = [PLCloudMaster insertIntoPhotoLibrary:v17 withCloudMasterGUID:v140 inShare:v60];

      [v14 setupPropertiesOnNewCloudMaster:v61 withPlaceholderSourceAsset:v15 uniformTypeIdentifier:v139];
      [v61 setPlaceholderState:1];
      v133 = v61;
      [v14 setMaster:v61];
      if (v10)
      {
        [v15 allAssetCPLResources];
      }

      else
      {
        [v15 allMasterCPLResources];
      }
      v62 = ;
      v63 = [v62 allObjects];

      LODWORD(v62) = [v15 cameraProcessingAdjustmentState];
      v64 = v137;
      v134 = v15;
      v136 = v17;
      if (v62 != [v14 cameraProcessingAdjustmentState])
      {
        v65 = [v14 filterCameraProcessingAdjustmentResourcesFromPlaceholderCloudResources:v63];

        v63 = v65;
      }

      v132 = v63;
      [v14 sortPlaceholderCloudResourcesByOrderOfCloudReReference:v63];
      v145 = 0u;
      v146 = 0u;
      v147 = 0u;
      obj = v148 = 0u;
      v66 = [obj countByEnumeratingWithState:&v145 objects:v153 count:16];
      if (!v66)
      {
LABEL_94:
        v92 = v64;
        [v14 reevaluateCameraProcessingAdjustmentState];
        if (v10)
        {
          v93 = [v14 kind];
          v15 = v134;
          v59 = v133;
          if (v93 == [v134 kind])
          {
            v94 = [v134 additionalAttributes];
            v95 = [v94 mediaMetadataType];
            [v133 setMediaMetadataType:v95];

            v96 = [v134 additionalAttributes];
            v97 = [v96 mediaMetadataData];

            if (v97)
            {
              v98 = [v133 mediaMetadata];
              [v98 setValue:v97 forKey:@"data"];
            }
          }

          v99 = [v14 masterResourceForCPLType:1];
          v100 = [v99 uniformTypeIdentifier];
          v101 = [v100 identifier];
          [v133 setUniformTypeIdentifier:v101];

          v102 = [v99 uniformTypeIdentifier];
          v103 = [v102 identifier];
          [v14 setUniformTypeIdentifier:v103];

          v104 = [v99 uniformTypeIdentifier];
          v105 = [v104 identifier];
          v106 = [PLManagedAsset preferredFileExtensionForType:v105];

          if (v106)
          {
            v107 = [v133 originalFilename];
            v108 = [v107 stringByDeletingPathExtension];
            v109 = [v108 stringByAppendingPathExtension:v106];
            [v133 setOriginalFilename:v109];

            v110 = [v14 filename];
            v111 = [v110 stringByDeletingPathExtension];
            v112 = [v111 stringByAppendingPathExtension:v106];
            [v14 setFilename:v112];
          }

          v113 = [v14 additionalAttributes];
          v114 = [v14 filename];
          [v113 setOriginalFilename:v114];

          [v133 setOriginalOrientation:{objc_msgSend(v14, "originalOrientation")}];
          v115 = [v134 scopedIdentifier];
          [v133 setSourceMasterForDuplicationCPLScopedIdentifier:v115];
        }

        else
        {
          v15 = v134;
          v116 = [v134 master];
          v117 = [v116 mediaMetadataType];
          v59 = v133;
          [v133 setMediaMetadataType:v117];

          v118 = [v134 master];
          v119 = [v118 mediaMetadata];
          v99 = [v119 valueForKey:@"data"];

          if (v99)
          {
            v120 = [v133 mediaMetadata];
            [v120 setValue:v99 forKey:@"data"];
          }

          v121 = [v14 additionalAttributes];
          v122 = [v134 additionalAttributes];
          v123 = [v122 mediaMetadataType];
          [v121 setMediaMetadataType:v123];

          v124 = [v134 additionalAttributes];
          v106 = [v124 mediaMetadataData];

          if (v106)
          {
            v125 = [v14 additionalAttributes];
            [v125 setMediaMetadataData:v106];
          }

          v115 = [v134 master];
          v126 = [v115 scopedIdentifier];
          [v133 setSourceMasterForDuplicationCPLScopedIdentifier:v126];
        }

        v127 = [v14 additionalAttributes];
        v58 = v138;
        [v127 setOriginalStableHash:v138];

        v16 = v92;
        v17 = v136;
        v19 = v139;
        goto LABEL_108;
      }

      v67 = v66;
      v68 = *v146;
      v141 = *MEMORY[0x1E6982EC8];
LABEL_51:
      v69 = 0;
      while (1)
      {
        if (*v146 != v68)
        {
          objc_enumerationMutation(obj);
        }

        v70 = *(*(&v145 + 1) + 8 * v69);
        v71 = [v70 cplType];
        v72 = [v70 fingerprint];

        if (v72)
        {
          v73 = v71 > 0x1B || ((1 << v71) & 0xC404400) == 0;
          if (v73 && (![v70 unorientedHeight] || !objc_msgSend(v70, "unorientedWidth")))
          {
            if (*MEMORY[0x1E6994D48])
            {
              goto LABEL_83;
            }

            v75 = __CPLAssetsdOSLogDomain();
            if (!os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
            {
              goto LABEL_82;
            }

            v76 = [v14 scopedIdentifier];
            *buf = 138412546;
            v155 = v70;
            v156 = 2112;
            v157 = v76;
            v77 = v75;
            v78 = OS_LOG_TYPE_ERROR;
            v79 = "Skipping resource from re-referencing since its height or width is nil. Resource is in a really bad state. Skipped resource: %@, asset: %@";
            goto LABEL_67;
          }

          if (!v10)
          {
            if (v144)
            {
              v74 = [PLManagedAsset resourceTypeForUnadjustedFlattenedLivePhotoAssetResourceType:v71];
              if (!v74)
              {
                if (*MEMORY[0x1E6994D48])
                {
                  goto LABEL_83;
                }

                v75 = __CPLAssetsdOSLogDomain();
                if (!os_log_type_enabled(v75, OS_LOG_TYPE_DEFAULT))
                {
                  goto LABEL_82;
                }

                v76 = [v14 scopedIdentifier];
                *buf = 138412546;
                v155 = v70;
                v156 = 2112;
                v157 = v76;
                v77 = v75;
                v78 = OS_LOG_TYPE_DEFAULT;
                v79 = "Skipping resource from re-referencing since we're flattening a live photo and we don't want this resource for flattening. Skipped resource: %@, asset: %@";
                goto LABEL_67;
              }

LABEL_70:
              v71 = v74;
            }

            v75 = [v70 validatedExternalResourceRepresentationUsingFileURL:0];
            [v75 setVersion:0];
            [v75 setCplType:v71];
            -[NSObject setSourceCplType:](v75, "setSourceCplType:", [v70 cplType]);
            [v75 setSidecarIndex:0];
            if (v10)
            {
              v80 = v14;
              v81 = v10;
              v82 = v64;
              if ([v80 isLoopingVideo])
              {
                if (v71 != 1)
                {
                  v83 = [v70 uniformTypeIdentifier];
                  v84 = [v83 conformsToMovie];

                  if (v84)
                  {
                    v85 = [v141 identifier];
                    v86 = [PLUniformTypeIdentifier utiWithIdentifier:v85];
                    [v75 setUniformTypeIdentifier:v86];
                  }
                }
              }

              -[NSObject setRecipeID:](v75, "setRecipeID:", +[PLResourceInstaller recipeIDFromCPLResourceType:assetType:fromAdjustedSet:](PLResourceInstaller, "recipeIDFromCPLResourceType:assetType:fromAdjustedSet:", v71, [v142 kind], 0));
              v64 = v82;
              v10 = v81;
              v14 = v142;
            }

            v87 = [v14 storedResourceForExternalResource:v75 asset:v14];
            [v87 resetPrefetchState];
            v88 = [v70 fileURL];
            v89 = [v87 cplFileURL];
            v90 = v89;
            if (v64 && v88 && v89)
            {
              [v64 setObject:v88 forKeyedSubscript:v89];
            }

            goto LABEL_82;
          }

          v74 = [v14 masterResourceTypeForAdjustedAssetResourceType:v71 flattenLivePhoto:v144];
          if (v74)
          {
            goto LABEL_70;
          }

          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v75 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v75, OS_LOG_TYPE_DEFAULT))
            {
              v76 = [v14 scopedIdentifier];
              *buf = 138412546;
              v155 = v70;
              v156 = 2112;
              v157 = v76;
              v77 = v75;
              v78 = OS_LOG_TYPE_DEFAULT;
              v79 = "Skipping resource from re-referencing since it's a asset resource we don't want in a master when baking-in adjustments. Skipped resource: %@, asset: %@";
              goto LABEL_67;
            }

LABEL_82:
          }
        }

        else if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v75 = __CPLAssetsdOSLogDomain();
          if (!os_log_type_enabled(v75, OS_LOG_TYPE_ERROR))
          {
            goto LABEL_82;
          }

          v76 = [v14 scopedIdentifier];
          *buf = 138412546;
          v155 = v70;
          v156 = 2112;
          v157 = v76;
          v77 = v75;
          v78 = OS_LOG_TYPE_ERROR;
          v79 = "Skipping resource from re-referencing since its fingerprint is nil. Resource is in a really bad state. Skipped resource: %@, asset: %@";
LABEL_67:
          _os_log_impl(&dword_19BF1F000, v77, v78, v79, buf, 0x16u);

          goto LABEL_82;
        }

LABEL_83:
        if (v67 == ++v69)
        {
          v91 = [obj countByEnumeratingWithState:&v145 objects:v153 count:16];
          v67 = v91;
          if (!v91)
          {
            goto LABEL_94;
          }

          goto LABEL_51;
        }
      }
    }

    v23 = [v15 bestAvailableAdjustedResource];
    if (v23)
    {
      v24 = v23;
      v25 = [v23 fingerprint];
      if (v25)
      {
        v140 = v25;
        v137 = v16;
        v26 = 0;
      }

      else
      {
        v37 = v10;
        v38 = v17;
        v39 = [v15 fingerprintContext];
        v40 = [v39 fingerprintSchemeForNewMasterAsset];
        v41 = [v24 fileURL];
        v150 = 0;
        v42 = [v40 fingerPrintForFileAtURL:v41 error:&v150];
        v43 = v150;

        v140 = v42;
        if (!v42)
        {
          if (*MEMORY[0x1E6994D48])
          {
            v140 = 0;
            v17 = v38;
            v14 = v142;
            goto LABEL_121;
          }

          v129 = __CPLAssetsdOSLogDomain();
          v14 = v142;
          if (os_log_type_enabled(v129, OS_LOG_TYPE_ERROR))
          {
            v130 = [v142 scopedIdentifier];
            *buf = 138412546;
            v155 = v130;
            v156 = 2112;
            v157 = v43;
            _os_log_impl(&dword_19BF1F000, v129, OS_LOG_TYPE_ERROR, "Baking in adjustments during master creation but failed to find a source primary adjusted resource fingerprint for asset: %@ - %@", buf, 0x16u);
          }

          v140 = 0;
          v17 = v38;
LABEL_120:

LABEL_121:
          v22 = 0;
          v19 = v139;
          v33 = v140;
          goto LABEL_109;
        }

        v137 = v16;
        v26 = v43;
        v17 = v38;
        v10 = v37;
        v14 = v142;
      }

      v44 = MEMORY[0x1E6994D48];
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v45 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
          v46 = [v14 scopedIdentifier];
          v47 = v10;
          v48 = v17;
          v49 = [MEMORY[0x1E6994B90] descriptionForResourceType:{objc_msgSend(v24, "cplType")}];
          *buf = 138412802;
          v155 = v46;
          v156 = 2112;
          v157 = v49;
          v158 = 2112;
          v159 = v140;
          _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEFAULT, "Baking in adjustments during master creation for asset: %@, using source's primary adjusted resource with type: %@ fingerprint: %@", buf, 0x20u);

          v17 = v48;
          v10 = v47;
          v14 = v142;
        }
      }

      v50 = [v24 stableHash];
      if (v50)
      {
        goto LABEL_40;
      }

      if ([MEMORY[0x1E6994AE0] isStableHash:v140])
      {
        v50 = v140;
LABEL_40:
        v138 = v50;

        goto LABEL_41;
      }

      v51 = v10;
      v135 = v17;
      v52 = [MEMORY[0x1E6994AE0] fingerprintSchemeForStableHash];
      v53 = [v24 fileURL];
      v149 = v26;
      v54 = [v52 fingerPrintForFileAtURL:v53 error:&v149];
      v43 = v149;

      if (v54)
      {
        v50 = v54;
        v26 = v43;
        v17 = v135;
        v10 = v51;
        v14 = v142;
        goto LABEL_40;
      }

      v14 = v142;
      if (*v44)
      {
        v17 = v135;
        v16 = v137;
        goto LABEL_121;
      }

      v129 = __CPLAssetsdOSLogDomain();
      v16 = v137;
      if (os_log_type_enabled(v129, OS_LOG_TYPE_ERROR))
      {
        v131 = [v142 scopedIdentifier];
        *buf = 138412546;
        v155 = v131;
        v156 = 2112;
        v157 = v43;
        _os_log_impl(&dword_19BF1F000, v129, OS_LOG_TYPE_ERROR, "Baking in adjustments during master creation but failed to find a source primary adjusted resource stable hash for asset: %@ - %@", buf, 0x16u);
      }

      v17 = v135;
      goto LABEL_120;
    }

    v19 = v139;
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v33 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
      {
        v34 = [v14 scopedIdentifier];
        *buf = 138412290;
        v155 = v34;
        _os_log_impl(&dword_19BF1F000, v33, OS_LOG_TYPE_ERROR, "Baking in adjustments during master creation but failed to find a source primary adjusted resource for asset: %@", buf, 0xCu);
      }

      v22 = 0;
      goto LABEL_109;
    }
  }

  else
  {
    if (*MEMORY[0x1E6994D48])
    {
      v22 = 0;
      goto LABEL_111;
    }

    v19 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      v20 = [v15 uuid];
      v21 = [v14 uuid];
      *buf = 138412802;
      v155 = v20;
      v156 = 2112;
      v157 = v21;
      v158 = 2080;
      v159 = "+[PLManagedAsset(Share) createMasterForPlaceholderAsset:withSourceAsset:shouldBakeInAdjustments:shouldFlattenLivePhoto:placeholderResourceURLToSourceResourceURLMap:photoLibrary:]";
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Source asset %@ for placeholder asset %@ does not have a master. Bailing out of %s", buf, 0x20u);
    }
  }

  v22 = 0;
LABEL_110:

LABEL_111:
  return v22;
}

+ (BOOL)createShareAssetsForShare:(id)a3 batchedSourceAssetsToCopy:(id)a4 creationRequestSourceAssetsToShareAssetsMap:(id)a5 curatedSourceAssets:(id)a6 adjustmentBakeInOptionsDictionary:(id)a7 metadataCopyOptionsDictionary:(id)a8 keySourceAssetIdentifier:(id)a9 commentText:(id)a10 clientConnection:(id)a11 library:(id)a12 error:(id *)a13
{
  v148[1] = *MEMORY[0x1E69E9840];
  v18 = a3;
  v96 = a4;
  v93 = a5;
  v94 = a6;
  v102 = a7;
  v101 = a8;
  v98 = a9;
  v92 = a10;
  v90 = a11;
  v115 = a12;
  v131 = 0;
  v132 = &v131;
  v133 = 0x3032000000;
  v134 = __Block_byref_object_copy__103360;
  v135 = __Block_byref_object_dispose__103361;
  v136 = 0;
  v103 = v18;
  v114 = [objc_opt_class() subclassKind];
  v97 = objc_alloc_init(MEMORY[0x1E696AC08]);
  if (v114 == 3)
  {
    v19 = v18;
    if ([v19 collectionShareKind] == 2)
    {
      v20 = [v96 array];
      v126 = MEMORY[0x1E69E9820];
      v127 = 3221225472;
      v128 = __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke;
      v129 = &unk_1E7575420;
      v130[0] = v19;
      v130[1] = &v131;
      v99 = v130[0];
      [a1 _createSharedStreamCollectionShareAssetsWithOriginalAssetUUIDs:v20 withBatchCommentText:v92 adjustmentBakeInOptionsDictionary:v102 collectionShare:? library:? completionHandler:?];

      v21 = v130;
      v22 = v132[5] == 0;
      goto LABEL_74;
    }
  }

  v23 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v123[0] = MEMORY[0x1E69E9820];
  v123[1] = 3221225472;
  v123[2] = __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke_2;
  v123[3] = &unk_1E7578238;
  v100 = v94;
  v124 = v100;
  v99 = v23;
  v125 = v99;
  [v93 enumerateKeysAndObjectsUsingBlock:v123];
  v91 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@ AND (noindex:(%K) == NULL OR noindex:(%K) == NULL)", @"uuid", v96, @"momentShare", @"collectionShare"];
  v24 = MEMORY[0x1E695D5E0];
  v25 = +[PLManagedAsset entityName];
  v95 = [v24 fetchRequestWithEntityName:v25];

  [v95 setPredicate:v91];
  [v95 setFetchLimit:{objc_msgSend(v96, "count")}];
  v148[0] = @"additionalAttributes";
  v26 = [MEMORY[0x1E695DEC8] arrayWithObjects:v148 count:1];
  [v95 setRelationshipKeyPathsForPrefetching:v26];

  if ([v96 count] >= 0x65)
  {
    [v95 setFetchBatchSize:100];
  }

  v27 = [v96 count];
  v22 = v27 == 0;
  if (!v27)
  {
    if (*MEMORY[0x1E6994D48])
    {
      v30 = 0;
      v88 = 0;
      v22 = 1;
      goto LABEL_20;
    }

    v31 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_DEFAULT))
    {
      LOWORD(buf) = 0;
      _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_DEFAULT, "Zero batchedSourceAssetsToCopy: passed in", &buf, 2u);
    }

    v88 = 0;
    goto LABEL_19;
  }

  v28 = [v115 managedObjectContext];
  v122 = 0;
  v29 = [v28 executeFetchRequest:v95 error:&v122];
  v88 = v122;

  if (!v29)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v32 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        buf = 138412290;
        v140 = v88;
        _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_ERROR, "Failed to fetch assets to copy: %@", &buf, 0xCu);
      }
    }

    v33 = MEMORY[0x1E696ABC0];
    v146 = *MEMORY[0x1E696A578];
    v31 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Failed to fetch assets to copy: %@", v88];
    v147 = v31;
    v34 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v147 forKeys:&v146 count:1];
    v35 = [v33 errorWithDomain:*MEMORY[0x1E69BFF48] code:-1000001 userInfo:v34];
    v36 = v132[5];
    v132[5] = v35;

LABEL_19:
    v30 = 0;
    goto LABEL_20;
  }

  v22 = 1;
  v30 = v29;
LABEL_20:
  v89 = v30;
  if (![v30 count])
  {
    goto LABEL_64;
  }

  v120 = 0u;
  v121 = 0u;
  v118 = 0u;
  v119 = 0u;
  obj = v89;
  v37 = [obj countByEnumeratingWithState:&v118 objects:v145 count:16];
  if (!v37)
  {
    goto LABEL_63;
  }

  v111 = *v119;
  v107 = *MEMORY[0x1E69BFF48];
  v108 = *MEMORY[0x1E696A578];
  do
  {
    v38 = 0;
    v112 = v37;
    do
    {
      if (*v119 != v111)
      {
        objc_enumerationMutation(obj);
      }

      v39 = *(*(&v118 + 1) + 8 * v38);
      context = objc_autoreleasePoolPush();
      if (v114 <= 1u)
      {
        if (v114)
        {
          v40 = v114 == 1;
          goto LABEL_34;
        }

LABEL_33:
        v41 = [MEMORY[0x1E696AAA8] currentHandler];
        [v41 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+Share.m" lineNumber:713 description:{@"%s called with invalid subclass kind", "+[PLManagedAsset(Share) createShareAssetsForShare:batchedSourceAssetsToCopy:creationRequestSourceAssetsToShareAssetsMap:curatedSourceAssets:adjustmentBakeInOptionsDictionary:metadataCopyOptionsDictionary:keySourceAssetIdentifier:commentText:clientConnection:library:error:]"}];

        v40 = 0;
        goto LABEL_34;
      }

      if (v114 == 2)
      {
        goto LABEL_33;
      }

      if (v114 == 3)
      {
        v40 = 5;
      }

      else
      {
        v40 = 0;
      }

LABEL_34:
      v42 = [v39 uuid];
      LOWORD(v87) = 257;
      v43 = +[PLManagedAsset insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:](PLManagedAsset, "insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:", v115, 0, 0, [MEMORY[0x1E69BF328] savedAssetTypeForPlaceholder], v40, 0, 0, 0, 0, v87);
      v44 = [v43 uuid];
      if (!v43)
      {
        v57 = MEMORY[0x1E696ABC0];
        v143 = v108;
        v58 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Failed to create placeholder asset"];
        v144 = v58;
        v59 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v144 forKeys:&v143 count:1];
        v60 = [v57 errorWithDomain:v107 code:-1000001 userInfo:v59];
        v61 = v132[5];
        v132[5] = v60;

LABEL_43:
        v22 = 0;
        goto LABEL_61;
      }

      if (!v22)
      {
        goto LABEL_43;
      }

      v117 = 0;
      v45 = [v102 objectForKeyedSubscript:v42];
      v46 = [a1 shouldBakeInAdjustmentsAndFlattenLivePhoto:&v117 forSourceAsset:v39 adjustmentBakeInOptions:v45];
      v106 = v45;
      if ([v45 flattenLivePhotoToStillIfNeeded])
      {
        v117 = 1;
        v46 |= [v39 hasAdjustments];
      }

      v113 = [v101 objectForKeyedSubscript:v42];
      v47 = [v113 shouldCopyTitleDescriptionAndKeywords];
      BYTE2(v86) = [v113 shouldCopySpatialOverCaptureResources];
      BYTE1(v86) = v47;
      LOBYTE(v86) = v117;
      v48 = [v43 setupPlaceholderAssetWithRequiredPropertiesFromSourceAsset:v39 placeholderAssetUUID:v44 bundleScope:v40 share:v103 importSessionID:0 bakeInAdjustmentsFromSourceAsset:v46 & 1 flattenLivePhoto:v86 copyTitleDescriptionAndKeywords:v115 copyCameraProcessingAdjustmentResources:? library:?];
      v49 = v48;
      if (v114 == 1)
      {
        if (v48)
        {
          v50 = [v39 uuid];
          v51 = [v50 isEqualToString:v98];

          if (v51)
          {
            v52 = v103;
            v53 = objc_alloc(MEMORY[0x1E6994B28]);
            v54 = [v52 previewData];
            v55 = [v53 initWithData:v54];

            [v55 setKeyAssetIdentifier:v44];
            v56 = [v55 data];
            [v52 setPreviewData:v56];
          }

LABEL_45:
          if ([v100 containsObject:v42])
          {
            [v99 addObject:v44];
          }
        }
      }

      else if (v48)
      {
        goto LABEL_45;
      }

      v109 = objc_alloc_init(MEMORY[0x1E695DF90]);
      if (v49 && [a1 createMasterForPlaceholderAsset:v43 withSourceAsset:v39 shouldBakeInAdjustments:v46 & 1 shouldFlattenLivePhoto:v117 placeholderResourceURLToSourceResourceURLMap:v109 photoLibrary:v115] && objc_msgSend(a1, "createAssetResourcesForPlaceholderAsset:withSourceAsset:shouldBakeInAdjustments:shouldFlattenLivePhoto:placeholderResourceURLToSourceResourceURLMap:photoLibrary:", v43, v39, v46 & 1, v117, v109, v115))
      {
        [a1 _cloneResourcesForSharePlaceholderAsset:v43 withPlaceholderResourceURLToSourceResourceURLMap:v109 fileManager:v97 photoLibrary:v115];
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v62 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v62, OS_LOG_TYPE_DEFAULT))
          {
            v63 = [v43 scopedIdentifier];
            v64 = [v39 scopedIdentifier];
            buf = 138412546;
            v140 = v63;
            v141 = 2112;
            v142 = v64;
            _os_log_impl(&dword_19BF1F000, v62, OS_LOG_TYPE_DEFAULT, "Preparing share asset %@ for server copy from source asset %@", &buf, 0x16u);
          }
        }

        v65 = [v39 additionalAttributes];
        v22 = 1;
        [v65 setDestinationAssetCopyState:1];
      }

      else
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v66 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v66, OS_LOG_TYPE_ERROR))
          {
            v67 = [v43 scopedIdentifier];
            v68 = [v39 scopedIdentifier];
            buf = 138412546;
            v140 = v67;
            v141 = 2112;
            v142 = v68;
            _os_log_impl(&dword_19BF1F000, v66, OS_LOG_TYPE_ERROR, "Failed to prepare share asset %@ for server copy from source asset %@", &buf, 0x16u);
          }
        }

        v69 = MEMORY[0x1E696ABC0];
        v137 = v108;
        v70 = MEMORY[0x1E696AEC0];
        v71 = [v43 scopedIdentifier];
        v72 = [v39 scopedIdentifier];
        v73 = [v70 stringWithFormat:@"Failed to prepare share asset %@ for server copy from source asset %@", v71, v72];
        v138 = v73;
        v74 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v138 forKeys:&v137 count:1];
        v75 = [v69 errorWithDomain:v107 code:-1000001 userInfo:v74];
        v76 = v132[5];
        v132[5] = v75;

        v65 = [v39 additionalAttributes];
        [v65 setDestinationAssetCopyState:0xFFFFFFFFLL];
        v22 = 0;
      }

LABEL_61:
      objc_autoreleasePoolPop(context);
      ++v38;
    }

    while (v112 != v38);
    v37 = [obj countByEnumeratingWithState:&v118 objects:v145 count:16];
  }

  while (v37);
LABEL_63:

LABEL_64:
  [v103 recomputeCachedValues];
  if (v114 == 1)
  {
    v77 = v103;
    if ([v99 count])
    {
      v78 = objc_alloc(MEMORY[0x1E6994B28]);
      v79 = [v77 previewData];
      v80 = [v78 initWithData:v79];

      v81 = [v99 allObjects];
      v82 = [v81 mutableCopy];
      [v80 setCuratedAssetIdentifiers:v82];

      v83 = [v80 data];
      [v77 setPreviewData:v83];
    }
  }

  if (a13)
  {
    v84 = v22;
  }

  else
  {
    v84 = 1;
  }

  if ((v84 & 1) == 0)
  {
    *a13 = v132[5];
  }

  v21 = &v124;
LABEL_74:

  _Block_object_dispose(&v131, 8);
  return v22;
}

void __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke(uint64_t a1, uint64_t a2, uint64_t a3, void *a4)
{
  v7 = a4;
  [*(a1 + 32) publishAssets:a2 withComment:a3];
  v8 = *(*(a1 + 40) + 8);
  v9 = *(v8 + 40);
  *(v8 + 40) = v7;
}

void __273__PLManagedAsset_Share__createShareAssetsForShare_batchedSourceAssetsToCopy_creationRequestSourceAssetsToShareAssetsMap_curatedSourceAssets_adjustmentBakeInOptionsDictionary_metadataCopyOptionsDictionary_keySourceAssetIdentifier_commentText_clientConnection_library_error___block_invoke_2(uint64_t a1, uint64_t a2, void *a3)
{
  v5 = a3;
  if ([*(a1 + 32) containsObject:a2])
  {
    [*(a1 + 40) addObject:v5];
  }
}

+ (BOOL)shouldBakeInAdjustmentsAndFlattenLivePhoto:(BOOL *)a3 forSourceAsset:(id)a4 adjustmentBakeInOptions:(id)a5
{
  v24 = *MEMORY[0x1E69E9840];
  v7 = a4;
  v8 = a5;
  if ([v7 hasAdjustments])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v9 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
      {
        v10 = [v7 scopedIdentifier];
        *buf = 138412546;
        *&buf[4] = v10;
        *&buf[12] = 2112;
        *&buf[14] = v8;
        _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Determining whether to bake in adjustments in source asset: %@, with adjustment bake-in options: %@", buf, 0x16u);
      }
    }

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x2020000000;
    v23 = 0;
    v18 = 0;
    v19 = &v18;
    v20 = 0x2020000000;
    v21 = 0;
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __107__PLManagedAsset_Share__shouldBakeInAdjustmentsAndFlattenLivePhoto_forSourceAsset_adjustmentBakeInOptions___block_invoke;
    v13[3] = &unk_1E75753F8;
    v14 = v7;
    v15 = v8;
    v16 = &v18;
    v17 = buf;
    [v14 synchronouslyFetchAdjustmentBlobWithCompletionHandler:v13];
    if (a3)
    {
      *a3 = *(v19 + 24);
    }

    v11 = *(*&buf[8] + 24);

    _Block_object_dispose(&v18, 8);
    _Block_object_dispose(buf, 8);
  }

  else
  {
    v11 = 0;
  }

  return v11 & 1;
}

void __107__PLManagedAsset_Share__shouldBakeInAdjustmentsAndFlattenLivePhoto_forSourceAsset_adjustmentBakeInOptions___block_invoke(uint64_t a1, void *a2, uint64_t a3, void *a4, void *a5, uint64_t a6, uint64_t a7, void *a8, void *a9)
{
  v118 = *MEMORY[0x1E69E9840];
  v13 = a2;
  v88 = a4;
  v86 = a5;
  v85 = a8;
  v84 = a9;
  if (v13)
  {
    v14 = objc_alloc_init(PLPhotoEditPersistenceManager);
    v15 = [(PLPhotoEditPersistenceManager *)v14 debugDescriptionForAdjustmentData:v13];
  }

  else
  {
    v15 = 0;
  }

  if ([*(a1 + 32) isPhotoIris] && objc_msgSend(*(a1 + 40), "shouldBakeInIfLivePhotoPlaybackDisabled") && (objc_msgSend(*(a1 + 32), "canPlayPhotoIris") & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v16 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
      {
        v17 = [*(a1 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v17;
        _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments and flatten because Live Photo playback is disabled in source asset: %@", buf, 0xCu);
      }
    }

    *(*(*(a1 + 48) + 8) + 24) = 1;
    *(*(*(a1 + 56) + 8) + 24) = 1;
  }

  v90 = a1;
  v87 = v15;
  if ((*(*(*(a1 + 48) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfLivePhotoMuted])
  {
    v109 = 0u;
    v110 = 0u;
    v107 = 0u;
    v108 = 0u;
    v18 = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
    v19 = [v18 countByEnumeratingWithState:&v107 objects:v115 count:16];
    if (v19)
    {
      v20 = v19;
      v21 = *v108;
      v22 = *MEMORY[0x1E69C0E30];
      v23 = *MEMORY[0x1E69C0E50];
      while (2)
      {
        for (i = 0; i != v20; ++i)
        {
          if (*v108 != v21)
          {
            objc_enumerationMutation(v18);
          }

          v25 = *(*(&v107 + 1) + 8 * i);
          v26 = [v25 objectForKeyedSubscript:v22];
          v27 = [v25 objectForKeyedSubscript:@"enabled"];
          if ([v26 isEqualToString:v23] && objc_msgSend(v27, "BOOLValue"))
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v28 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v28, OS_LOG_TYPE_DEFAULT))
              {
                v29 = [*(a1 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v29;
                _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because Live Photo is muted in source asset: %@", buf, 0xCu);
              }
            }

            *(*(*(a1 + 56) + 8) + 24) = 1;

            goto LABEL_29;
          }
        }

        v20 = [v18 countByEnumeratingWithState:&v107 objects:v115 count:16];
        if (v20)
        {
          continue;
        }

        break;
      }
    }

LABEL_29:

    v15 = v87;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfAdjustedByThirdParty] && (objc_msgSend(v88, "isEqualToString:", *MEMORY[0x1E69C0E58]) & 1) == 0 && (objc_msgSend(v88, "isEqualToString:", *MEMORY[0x1E69C0E98]) & 1) == 0 && (objc_msgSend(v88, "isEqualToString:", *MEMORY[0x1E69C0E90]) & 1) == 0 && (IPAAdjustmentsComeFromSupportedApp() & 1) == 0)
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v30 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_DEFAULT))
      {
        v31 = [*(a1 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v31;
        _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because third-party edits are applied in source asset: %@", buf, 0xCu);
      }
    }

    *(*(*(a1 + 56) + 8) + 24) = 1;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) != 0 || ![*(a1 + 40) shouldBakeInIfCropped])
  {
    goto LABEL_70;
  }

  v105 = 0u;
  v106 = 0u;
  v103 = 0u;
  v104 = 0u;
  obj = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
  v32 = [obj countByEnumeratingWithState:&v103 objects:v114 count:16];
  if (!v32)
  {
    goto LABEL_69;
  }

  v33 = v32;
  v34 = *v104;
  v35 = *MEMORY[0x1E69C0E30];
  v36 = *MEMORY[0x1E69C0E68];
  v82 = *MEMORY[0x1E69C0EC0];
  v83 = *MEMORY[0x1E69C0E40];
  v81 = v13;
  while (2)
  {
    for (j = 0; j != v33; ++j)
    {
      if (*v104 != v34)
      {
        objc_enumerationMutation(obj);
      }

      v38 = *(*(&v103 + 1) + 8 * j);
      v39 = [v38 objectForKeyedSubscript:{v35, v81}];
      v40 = [v38 objectForKeyedSubscript:@"enabled"];
      if ([v39 isEqualToString:v36] && (!v40 || objc_msgSend(v40, "BOOLValue")))
      {
        a1 = v90;
        if (*MEMORY[0x1E6994D48])
        {
LABEL_68:
          *(*(*(a1 + 56) + 8) + 24) = 1;

          v13 = v81;
          v15 = v87;
          goto LABEL_69;
        }

        v45 = __CPLAssetsdOSLogDomain();
        if (!os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
LABEL_67:

          goto LABEL_68;
        }

        v46 = [*(v90 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v46;
        v47 = "Will bake in adjustments because of cropping edits in source asset: %@";
LABEL_66:
        _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEFAULT, v47, buf, 0xCu);

        goto LABEL_67;
      }

      if ([v39 isEqualToString:v36])
      {
        v41 = v34;
        v42 = [v38 objectForKeyedSubscript:v83];
        v43 = [v42 objectForKeyedSubscript:v82];
        if (![v43 BOOLValue])
        {
          v44 = [v39 isEqualToString:@"VideoReframe"];

          v34 = v41;
          if (v44)
          {
            goto LABEL_63;
          }

          goto LABEL_56;
        }

LABEL_63:
        if (*MEMORY[0x1E6994D48])
        {
          a1 = v90;
          goto LABEL_68;
        }

        v45 = __CPLAssetsdOSLogDomain();
        a1 = v90;
        if (!os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT))
        {
          goto LABEL_67;
        }

        v46 = [*(v90 + 32) scopedIdentifier];
        *buf = 138412290;
        v117 = v46;
        v47 = "Will bake in adjustments because of reframe edits in source asset: %@";
        goto LABEL_66;
      }

      if ([v39 isEqualToString:@"VideoReframe"])
      {
        goto LABEL_63;
      }

LABEL_56:
    }

    v33 = [obj countByEnumeratingWithState:&v103 objects:v114 count:16];
    v13 = v81;
    a1 = v90;
    v15 = v87;
    if (v33)
    {
      continue;
    }

    break;
  }

LABEL_69:

LABEL_70:
  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfTimelineTrimmed])
  {
    v101 = 0u;
    v102 = 0u;
    v99 = 0u;
    v100 = 0u;
    v48 = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
    v49 = [v48 countByEnumeratingWithState:&v99 objects:v113 count:16];
    if (v49)
    {
      v50 = v49;
      v51 = *v100;
      v52 = *MEMORY[0x1E69C0E30];
      v53 = *MEMORY[0x1E69C0EA8];
      while (2)
      {
        for (k = 0; k != v50; ++k)
        {
          if (*v100 != v51)
          {
            objc_enumerationMutation(v48);
          }

          v55 = *(*(&v99 + 1) + 8 * k);
          v56 = [v55 objectForKeyedSubscript:v52];
          v57 = [v55 objectForKeyedSubscript:@"enabled"];
          if ([v56 isEqualToString:v53] && (!v57 || objc_msgSend(v57, "BOOLValue")))
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v58 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v58, OS_LOG_TYPE_DEFAULT))
              {
                v59 = [*(v90 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v59;
                _os_log_impl(&dword_19BF1F000, v58, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because of timeline trimming edits in source asset: %@", buf, 0xCu);
              }
            }

            *(*(*(v90 + 56) + 8) + 24) = 1;

            goto LABEL_88;
          }
        }

        v50 = [v48 countByEnumeratingWithState:&v99 objects:v113 count:16];
        if (v50)
        {
          continue;
        }

        break;
      }
    }

LABEL_88:

    a1 = v90;
    v15 = v87;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfPortraitDepthEffectEnabled])
  {
    v97 = 0u;
    v98 = 0u;
    v95 = 0u;
    v96 = 0u;
    v60 = [v15 objectForKeyedSubscript:*MEMORY[0x1E69C0E48]];
    v61 = [v60 countByEnumeratingWithState:&v95 objects:v112 count:16];
    if (v61)
    {
      v62 = v61;
      v63 = *v96;
      v64 = *MEMORY[0x1E69C0E30];
      v65 = *MEMORY[0x1E69C0E70];
      while (2)
      {
        for (m = 0; m != v62; ++m)
        {
          if (*v96 != v63)
          {
            objc_enumerationMutation(v60);
          }

          v67 = *(*(&v95 + 1) + 8 * m);
          v68 = [v67 objectForKeyedSubscript:v64];
          v69 = [v67 objectForKeyedSubscript:@"enabled"];
          if ([v68 isEqualToString:v65] && (!v69 || objc_msgSend(v69, "BOOLValue")))
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v70 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v70, OS_LOG_TYPE_DEFAULT))
              {
                v71 = [*(v90 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v71;
                _os_log_impl(&dword_19BF1F000, v70, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because of portrait depth effect in source asset: %@", buf, 0xCu);
              }
            }

            *(*(*(v90 + 56) + 8) + 24) = 1;

            goto LABEL_107;
          }
        }

        v62 = [v60 countByEnumeratingWithState:&v95 objects:v112 count:16];
        if (v62)
        {
          continue;
        }

        break;
      }
    }

LABEL_107:

    a1 = v90;
    v15 = v87;
  }

  if ((*(*(*(a1 + 56) + 8) + 24) & 1) == 0 && [*(a1 + 40) shouldBakeInIfContainsPenultimateResources])
  {
    v93 = 0u;
    v94 = 0u;
    v91 = 0u;
    v92 = 0u;
    v72 = [*(a1 + 32) modernResources];
    v73 = [v72 countByEnumeratingWithState:&v91 objects:v111 count:16];
    if (v73)
    {
      v74 = v73;
      v75 = *v92;
      v76 = MEMORY[0x1E6994D48];
      do
      {
        for (n = 0; n != v74; ++n)
        {
          if (*v92 != v75)
          {
            objc_enumerationMutation(v72);
          }

          v78 = *(*(&v91 + 1) + 8 * n);
          if ([v78 version] == 1 && (objc_msgSend(v78, "isDerivative") & 1) == 0)
          {
            if ((*v76 & 1) == 0)
            {
              v79 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v79, OS_LOG_TYPE_DEFAULT))
              {
                v80 = [*(a1 + 32) scopedIdentifier];
                *buf = 138412290;
                v117 = v80;
                _os_log_impl(&dword_19BF1F000, v79, OS_LOG_TYPE_DEFAULT, "Will bake in adjustments because penultimate resources exist in source asset: %@", buf, 0xCu);

                a1 = v90;
              }
            }

            *(*(*(a1 + 56) + 8) + 24) = 1;
          }
        }

        v74 = [v72 countByEnumeratingWithState:&v91 objects:v111 count:16];
      }

      while (v74);
    }

    v15 = v87;
  }
}

+ (unint64_t)resourceTypeForUnadjustedFlattenedLivePhotoAssetResourceType:(unint64_t)a3
{
  result = a3;
  if ((a3 + 1 > 0x1C || ((1 << (a3 + 1)) & 0x1185FE7F) == 0) && a3 - 1000 >= 2)
  {
    return 0;
  }

  return result;
}

+ (BOOL)shouldPerformServerCopyWithSourceAsset:(id)a3 copyingFromShare:(BOOL)a4 photoLibrary:(id)a5
{
  v6 = a4;
  v7 = a3;
  v8 = a5;
  if ([v8 isCloudPhotoLibraryEnabled] && objc_msgSend(v7, "placeholder_shouldAllowServerCopy"))
  {
    if (v6)
    {
      v9 = [v7 master];
      v10 = [v9 mediaMetadata];
      v11 = [v10 valueForKey:@"data"];

      if (v11)
      {
        v12 = [v8 pathManager];
        v13 = CPLStatusFromPathManager(v12);
        v14 = [v13 exitDeleteTime];
        if (v14)
        {
        }

        else if (([v13 isExceedingQuota] & 1) == 0)
        {
          v15 = 1;
          goto LABEL_12;
        }

        v15 = 0;
LABEL_12:

        goto LABEL_13;
      }

      v15 = 0;
    }

    else
    {
      v16 = [v7 allMasterCPLResources];
      v17 = [v7 allAssetCPLResources];
      v11 = [v16 setByAddingObjectsFromSet:v17];

      v18 = [v11 allObjects];
      LOBYTE(v17) = [v18 _pl_any:&__block_literal_global_103470];

      v19 = [v7 allAssetCPLResources];
      v20 = [v19 allObjects];
      v21 = [v20 _pl_any:&__block_literal_global_93];

      v22 = [v7 master];
      LOBYTE(v19) = v22 == 0;

      v15 = ((v19 | v21 | v17) & 1) - 1;
    }

LABEL_13:

    goto LABEL_14;
  }

  v15 = 0;
LABEL_14:

  return v15 & 1;
}

BOOL __94__PLManagedAsset_Share__shouldPerformServerCopyWithSourceAsset_copyingFromShare_photoLibrary___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 cloudLocalState] == 1)
  {
    v3 = [v2 fingerprint];
    v4 = v3 == 0;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

+ (BOOL)shouldPerformServerCopyOnPlaceholderAsset:(id)a3 photoLibrary:(id)a4
{
  v6 = a4;
  v7 = [a3 fetchSourceAssetForDuplicationIfExists];
  v8 = [v7 shareRelationship];

  LOBYTE(a1) = [a1 shouldPerformServerCopyWithSourceAsset:v7 copyingFromShare:v8 != 0 photoLibrary:v6];
  return a1;
}

- (void)setWasGuestAsset:(BOOL)a3
{
  v3 = a3;
  v14 = *MEMORY[0x1E69E9840];
  v5 = [(PLManagedAsset *)self additionalAttributes];
  v6 = [v5 syndicationHistory];
  if (v3)
  {
    v7 = 1;
  }

  else
  {
    v7 = 2;
  }

  if (v7 != v6)
  {
    if (v6 == 1)
    {
      v8 = PLSyndicationGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = [(PLManagedAsset *)self uuid];
        v12 = 138543362;
        v13 = v9;
        v10 = "GuestAssetSync: leaving asset %{public}@ marked as wasGuestAsset";
LABEL_13:
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_INFO, v10, &v12, 0xCu);
      }
    }

    else
    {
      [v5 setSyndicationHistory:v7];
      v8 = PLSyndicationGetLog();
      v11 = os_log_type_enabled(v8, OS_LOG_TYPE_INFO);
      if (v3)
      {
        if (v11)
        {
          v9 = [(PLManagedAsset *)self uuid];
          v12 = 138543362;
          v13 = v9;
          v10 = "GuestAssetSync: marked asset %{public}@ as wasGuestAsset";
          goto LABEL_13;
        }
      }

      else if (v11)
      {
        v9 = [(PLManagedAsset *)self uuid];
        v12 = 138543362;
        v13 = v9;
        v10 = "GuestAssetSync: marked asset %{public}@ as wasNotGuestAsset";
        goto LABEL_13;
      }
    }
  }
}

- (void)purgeSyndicationResourcesOriginalsOnly:(BOOL)a3
{
  v3 = a3;
  v48 = *MEMORY[0x1E69E9840];
  v34 = objc_alloc_init(MEMORY[0x1E696AC08]);
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v5 = [(PLManagedAsset *)self modernResources];
  v6 = [v5 countByEnumeratingWithState:&v39 objects:v47 count:16];
  if (v6)
  {
    v8 = v6;
    v9 = *v40;
    v36 = *MEMORY[0x1E69BFF00];
    *&v7 = 138412546;
    v33 = v7;
    v35 = v3;
    do
    {
      v10 = 0;
      do
      {
        if (*v40 != v9)
        {
          objc_enumerationMutation(v5);
        }

        v11 = *(*(&v39 + 1) + 8 * v10);
        if ([v11 dataStoreClassID] == 3)
        {
          if ([v11 isLocallyAvailable])
          {
            if (v3 && ([v11 isOriginalResource] & 1) == 0)
            {
              v16 = PLSyndicationGetLog();
              if (!os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
              {
                goto LABEL_23;
              }

              v24 = [(PLManagedAsset *)self uuid];
              *buf = 138543618;
              v44 = v24;
              v45 = 2112;
              v46 = v11;
              v25 = v16;
              v26 = OS_LOG_TYPE_INFO;
              v27 = "Skipping purge of syndication asset %{public}@ resource that is not an original %@";
              goto LABEL_22;
            }

            v12 = [(PLManagedAsset *)self additionalAttributes];
            v13 = [v12 importedByBundleIdentifier];
            v14 = [v13 isEqualToString:v36];

            if (!v14)
            {
              goto LABEL_24;
            }

            v15 = [v11 fileURL];
            v16 = v15;
            if (v15)
            {
              v17 = [v15 path];
              v38 = 0;
              v18 = [PLCacheDeleteSupport isPurgeableFile:v17 outIsPhotoType:0 outUrgencyLevel:0 error:&v38];
              v19 = v38;

              if (v18)
              {
                v20 = PLSyndicationGetLog();
                if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
                {
                  v21 = [(PLManagedAsset *)self uuid];
                  *buf = 138543618;
                  v44 = v21;
                  v45 = 2112;
                  v46 = v11;
                  _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_INFO, "Purge syndication asset %{public}@ resource %@", buf, 0x16u);
                }

                v37 = 0;
                v22 = [v34 removeItemAtURL:v16 error:&v37];
                v23 = v37;
                if (v22 || PLIsErrorFileNotFound())
                {
                  [v11 markAsNotLocallyAvailableAfterPurge];
                }

                else
                {
                  v30 = PLSyndicationGetLog();
                  if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
                  {
                    v31 = [MEMORY[0x1E69BF220] descriptionWithFileURL:v16];
                    *buf = v33;
                    v44 = v31;
                    v45 = 2112;
                    v46 = v23;
                    _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_ERROR, "purgeSyndicationResources: removeItemAtURL:%@ failed: %@", buf, 0x16u);
                  }
                }

                v3 = v35;
              }

              else
              {
                if (PLIsErrorFileNotFound())
                {
                  [v11 markAsNotLocallyAvailableAfterPurge];
                }

                else
                {
                  v28 = PLSyndicationGetLog();
                  if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
                  {
                    v29 = [MEMORY[0x1E69BF220] descriptionWithFileURL:v16];
                    *buf = v33;
                    v44 = v29;
                    v45 = 2112;
                    v46 = v19;
                    _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_INFO, "File is not purgeable at %@ error %@", buf, 0x16u);
                  }
                }

                v3 = v35;
              }
            }
          }

          else
          {
            v16 = PLSyndicationGetLog();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              v24 = [(PLManagedAsset *)self uuid];
              *buf = 138543618;
              v44 = v24;
              v45 = 2112;
              v46 = v11;
              v25 = v16;
              v26 = OS_LOG_TYPE_INFO;
              v27 = "Skipping purge of syndication asset %{public}@ resource that is already not locally available %@";
              goto LABEL_22;
            }
          }
        }

        else
        {
          v16 = PLSyndicationGetLog();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
          {
            v24 = [(PLManagedAsset *)self uuid];
            *buf = 138543618;
            v44 = v24;
            v45 = 2112;
            v46 = v11;
            v25 = v16;
            v26 = OS_LOG_TYPE_ERROR;
            v27 = "Skipping non-syndication resource found during asset %{public}@ purgeSyndicationResources %@";
LABEL_22:
            _os_log_impl(&dword_19BF1F000, v25, v26, v27, buf, 0x16u);
          }
        }

LABEL_23:

LABEL_24:
        ++v10;
      }

      while (v8 != v10);
      v32 = [v5 countByEnumeratingWithState:&v39 objects:v47 count:16];
      v8 = v32;
    }

    while (v32);
  }
}

- (BOOL)fullAnalysisComplete
{
  v2 = [(PLManagedAsset *)self mediaAnalysisAttributes];
  v3 = [v2 mediaAnalysisVersion];
  v4 = +[PLMediaAnalysisServiceRequestAdapter currentMediaAnalysisVersion];
  LOBYTE(v3) = v3 == [v4 intValue];

  return v3;
}

- (BOOL)_tuAnalysisComplete
{
  v2 = [(PLManagedAsset *)self mediaAnalysisAttributes];
  v3 = [v2 textUnderstandingVersion];
  v4 = +[PLMediaAnalysisServiceRequestAdapter currentTUAlgorithmVersion];
  LOBYTE(v3) = [v4 intValue] == v3;

  return v3;
}

- (BOOL)isReadyForPurgeSyndicationResources
{
  v3 = [(PLManagedObject *)self photoLibrary];
  v4 = [v3 libraryServicesManager];

  v5 = [v4 wellKnownPhotoLibraryIdentifier] == 3 && -[PLManagedAsset faceDetectionComplete](self, "faceDetectionComplete") && -[PLManagedAsset _tuAnalysisComplete](self, "_tuAnalysisComplete") && -[PLManagedAsset fullAnalysisComplete](self, "fullAnalysisComplete");
  return v5;
}

- (BOOL)shouldPurgeSyndicationResourcesWithChangedValues:(id)a3
{
  v4 = [a3 objectForKeyedSubscript:@"faceAdjustmentVersion"];

  if (!v4)
  {
    return 0;
  }

  return [(PLManagedAsset *)self isReadyForPurgeSyndicationResources];
}

- (void)setConversationAlbumWithConversationID:(id)a3
{
  v36 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self managedObjectContext];
  if (v4)
  {
    v6 = [(PLManagedAsset *)self conversation];
    v7 = [v6 importSessionID];
    v8 = [v7 isEqualToString:v4];

    if (v8)
    {
      goto LABEL_27;
    }

    v9 = [v5 userInfo];
    v10 = [v9 objectForKeyedSubscript:@"conversationObjectIDCache"];

    if (!v10)
    {
      v10 = [MEMORY[0x1E695DF90] dictionary];
      v11 = [v5 userInfo];
      [v11 setObject:v10 forKeyedSubscript:@"conversationObjectIDCache"];
    }

    v12 = [v10 objectForKeyedSubscript:v4];
    if (v12 && ([v5 objectRegisteredForID:v12], (v13 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v14 = v13;
    }

    else
    {
      v16 = [(PLManagedObject *)self photoLibrary];
      v14 = [PLConversation albumWithConversationID:v4 inLibrary:v16];

      if (!v14)
      {
        v14 = [PLConversation insertNewConversationAlbumWithConversationID:v4 inManagedObjectContext:v5];
        v17 = PLSyndicationGetLog();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          [v14 uuid];
          v19 = v18 = v12;
          v20 = [(PLManagedAsset *)self uuid];
          *buf = 138543618;
          v31 = v19;
          v32 = 2112;
          v33 = v20;
          v21 = "Created conversationAlbum (%{public}@) for asset uuid %@";
          goto LABEL_15;
        }

LABEL_16:

        if (v6)
        {
          v22 = PLSyndicationGetLog();
          if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
          {
            [v6 uuid];
            v23 = v29 = v12;
            v24 = [v14 uuid];
            v25 = [(PLManagedAsset *)self uuid];
            *buf = 138543874;
            v31 = v23;
            v32 = 2114;
            v33 = v24;
            v34 = 2112;
            v35 = v25;
            _os_log_impl(&dword_19BF1F000, v22, OS_LOG_TYPE_INFO, "Changed conversationAlbum (%{public}@) to (%{public}@) for asset uuid %@", buf, 0x20u);

            v12 = v29;
          }
        }

        [(PLManagedAsset *)self setConversation:v14];
        [v14 updateConversationDatesFromAddedAsset:self];
        v26 = [v14 objectID];
        [v10 setObject:v26 forKeyedSubscript:v4];

        v27 = [(PLManagedAsset *)self syndicationState];
        v28 = [v14 syndicate];
        if (v28 == 1)
        {
          v27 &= ~4u;
        }

        else if (!v28)
        {
          v27 |= 4u;
        }

        if ([(PLManagedAsset *)self syndicationState]!= v27)
        {
          [(PLManagedAsset *)self setSyndicationState:v27];
        }

        goto LABEL_27;
      }
    }

    v17 = PLSyndicationGetLog();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      [v14 uuid];
      v19 = v18 = v12;
      v20 = [(PLManagedAsset *)self uuid];
      *buf = 138543618;
      v31 = v19;
      v32 = 2112;
      v33 = v20;
      v21 = "Found conversationAlbum (%{public}@) for asset uuid %@";
LABEL_15:
      _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_INFO, v21, buf, 0x16u);

      v12 = v18;
      goto LABEL_16;
    }

    goto LABEL_16;
  }

  v6 = PLSyndicationGetLog();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    v15 = [(PLManagedAsset *)self uuid];
    *buf = 138412290;
    v31 = v15;
    _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_ERROR, "Unable to create conversationAlbum with nil conversationID for asset uuid %@", buf, 0xCu);
  }

LABEL_27:
}

- (void)_updateIMCoreSyndicationForIdentifier:(id)a3 hide:(BOOL)a4
{
  v5 = a3;
  if (_updateIMCoreSyndicationForIdentifier_hide__onceToken != -1)
  {
    dispatch_once(&_updateIMCoreSyndicationForIdentifier_hide__onceToken, &__block_literal_global_173_104044);
  }

  v6 = _updateIMCoreSyndicationForIdentifier_hide__queue;
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __74__PLManagedAsset_Syndication___updateIMCoreSyndicationForIdentifier_hide___block_invoke_2;
  v8[3] = &unk_1E7576F80;
  v10 = a4;
  v9 = v5;
  v7 = v5;
  dispatch_async(v6, v8);
}

void __74__PLManagedAsset_Syndication___updateIMCoreSyndicationForIdentifier_hide___block_invoke_2(uint64_t a1)
{
  v14 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 40);
  v3 = PLSyndicationGetLog();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_INFO);
  if (v2 != 1)
  {
    if (v4)
    {
      v10 = *(a1 + 32);
      *buf = 138543362;
      v13 = v10;
      _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "calling IMCore to un-hide %{public}@ from syndication", buf, 0xCu);
    }

    if (IMCoreLibraryCore() && getIMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc())
    {
      v6 = *(a1 + 32);
      IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc = getIMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc();
      if (!IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc)
      {
        v8 = [MEMORY[0x1E696AAA8] currentHandler];
        v9 = [MEMORY[0x1E696AEC0] stringWithUTF8String:"void softlink_IMSPIUnhideSyndicationForAttachmentGUID(NSString *__strong)"];
        [v8 handleFailureInFunction:v9 file:@"PLManagedAsset+Syndication.m" lineNumber:73 description:{@"%s", dlerror()}];
LABEL_21:

        __break(1u);
      }

      goto LABEL_13;
    }

    v6 = PLSyndicationGetLog();
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_19;
    }

    *buf = 0;
    v11 = "IMCore SPI for un-hiding attachment is not available";
LABEL_18:
    _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_INFO, v11, buf, 2u);
    goto LABEL_19;
  }

  if (v4)
  {
    v5 = *(a1 + 32);
    *buf = 138543362;
    v13 = v5;
    _os_log_impl(&dword_19BF1F000, v3, OS_LOG_TYPE_INFO, "rejectSyndicatedAsset: calling IMCore to remove %{public}@ from syndication", buf, 0xCu);
  }

  if (!IMCoreLibraryCore() || !getIMSPIRemoveAttachmentGUIDFromSyndicationSymbolLoc())
  {
    v6 = PLSyndicationGetLog();
    if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      goto LABEL_19;
    }

    *buf = 0;
    v11 = "IMCore SPI for removing attachment is not available";
    goto LABEL_18;
  }

  v6 = *(a1 + 32);
  IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc = getIMSPIRemoveAttachmentGUIDFromSyndicationSymbolLoc();
  if (!IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc)
  {
    v8 = [MEMORY[0x1E696AAA8] currentHandler];
    v9 = [MEMORY[0x1E696AEC0] stringWithUTF8String:"void softlink_IMSPIRemoveAttachmentGUIDFromSyndication(NSString *__strong)"];
    [v8 handleFailureInFunction:v9 file:@"PLManagedAsset+Syndication.m" lineNumber:72 description:{@"%s", dlerror()}];
    goto LABEL_21;
  }

LABEL_13:
  IMSPIUnhideSyndicationForAttachmentGUIDSymbolLoc(v6);
LABEL_19:
}

void __74__PLManagedAsset_Syndication___updateIMCoreSyndicationForIdentifier_hide___block_invoke()
{
  v0 = dispatch_queue_create("updateIMCoreSyndicationForIdentifier", 0);
  v1 = _updateIMCoreSyndicationForIdentifier_hide__queue;
  _updateIMCoreSyndicationForIdentifier_hide__queue = v0;
}

- (void)_updateSyndicationState:(unsigned __int16)a3 enabled:(BOOL)a4 logPrefix:(id)a5
{
  v5 = a4;
  v6 = a3;
  v29 = *MEMORY[0x1E69E9840];
  v8 = a5;
  v9 = [(PLManagedAsset *)self syndicationState];
  if (v5)
  {
    v10 = v9 | v6;
  }

  else
  {
    v10 = v9 & ~v6;
  }

  v11 = PLSyndicationGetLog();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v10 == v9)
  {
    if (v12)
    {
      v13 = [(PLManagedAsset *)self uuid];
      v14 = [(PLManagedAsset *)self additionalAttributes];
      v15 = [v14 syndicationIdentifier];
      v16 = PLManagedAssetSyndicationStateDescription(v9);
      v21 = 138544130;
      v22 = v8;
      v23 = 2114;
      v24 = v13;
      v25 = 2114;
      v26 = v15;
      v27 = 2114;
      v28 = v16;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "%{public}@ %{public}@ / %{public}@ syndicationState unchanged %{public}@", &v21, 0x2Au);
    }
  }

  else
  {
    if (v12)
    {
      v17 = [(PLManagedAsset *)self uuid];
      v18 = [(PLManagedAsset *)self additionalAttributes];
      v19 = [v18 syndicationIdentifier];
      v20 = PLManagedAssetSyndicationStateDescription(v10);
      v21 = 138544130;
      v22 = v8;
      v23 = 2114;
      v24 = v17;
      v25 = 2114;
      v26 = v19;
      v27 = 2114;
      v28 = v20;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "%{public}@ %{public}@ / %{public}@ set syndicationState to %{public}@", &v21, 0x2Au);
    }

    [(PLManagedAsset *)self setSyndicationState:v10];
  }
}

- (void)unsaveSyndicatedAsset
{
  v3 = NSStringFromSelector(a2);
  [(PLManagedAsset *)self _updateSyndicationState:10 enabled:0 logPrefix:v3];

  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 syndicationIdentifier];

  [(PLManagedAsset *)self _updateIMCoreSyndicationForIdentifier:v5 hide:0];
}

- (void)restoreSyndicatedAsset
{
  v3 = NSStringFromSelector(a2);
  [(PLManagedAsset *)self _updateSyndicationState:8 enabled:0 logPrefix:v3];

  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 syndicationIdentifier];

  [(PLManagedAsset *)self _updateIMCoreSyndicationForIdentifier:v5 hide:0];
}

- (void)rejectSyndicatedAsset
{
  v26 = *MEMORY[0x1E69E9840];
  v3 = NSStringFromSelector(a2);
  [(PLManagedAsset *)self _updateSyndicationState:8 enabled:1 logPrefix:v3];

  v4 = [(PLManagedAsset *)self additionalAttributes];
  v5 = [v4 syndicationIdentifier];

  v6 = PLSyndicationGetLog();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v7 = [(PLManagedAsset *)self uuid];
    *buf = 136315650;
    v21 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]";
    v22 = 2114;
    v23 = v7;
    v24 = 2114;
    v25 = v5;
    _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_INFO, "%s %{public}@ / %{public}@", buf, 0x20u);
  }

  [(PLManagedAsset *)self _updateIMCoreSyndicationForIdentifier:v5 hide:1];
  v18 = 0;
  v8 = [PLLibraryServicesManager runningLibraryServicesManagerForWellKnownPhotoLibraryIdentifier:1 error:&v18];
  v9 = v18;
  v10 = PLSyndicationGetLog();
  v11 = v10;
  if (v8)
  {
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v12 = [(PLManagedAsset *)self importedByBundleIdentifier];
      *buf = 136315650;
      v21 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]";
      v22 = 2114;
      v23 = v5;
      v24 = 2114;
      v25 = v12;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "%s calling SPL syndicationDeleteManager to delete %{public}@ for bundleID %{public}@", buf, 0x20u);
    }

    v13 = [v8 syndicationDeleteManager];
    v14 = [(PLManagedAsset *)self importedByBundleIdentifier];
    v19 = v5;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v19 count:1];
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __52__PLManagedAsset_Syndication__rejectSyndicatedAsset__block_invoke;
    v16[3] = &unk_1E75781E8;
    v17 = v5;
    [v13 processDeletesForBundleID:v14 identifiers:v15 completion:v16];

    v11 = v17;
  }

  else if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
  {
    *buf = 136315650;
    v21 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]";
    v22 = 2114;
    v23 = v5;
    v24 = 2112;
    v25 = v9;
    _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_ERROR, "%s failed attempting to delete %{public}@ from SPL, error %@", buf, 0x20u);
  }
}

void __52__PLManagedAsset_Syndication__rejectSyndicatedAsset__block_invoke(uint64_t a1)
{
  v8 = *MEMORY[0x1E69E9840];
  v2 = PLSyndicationGetLog();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    v3 = *(a1 + 32);
    v4 = 136315394;
    v5 = "[PLManagedAsset(Syndication) rejectSyndicatedAsset]_block_invoke";
    v6 = 2114;
    v7 = v3;
    _os_log_impl(&dword_19BF1F000, v2, OS_LOG_TYPE_INFO, "%s done deleting %{public}@ from SPL", &v4, 0x16u);
  }
}

- (void)_updateDestinationAssetCopyStateOnCMMAsset
{
  v27[2] = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [v3 syndicationIdentifier];

  v5 = [(PLManagedObject *)self photoLibrary];
  v6 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForMomentSharedAsset"), 1}];
  v7 = MEMORY[0x1E696AB28];
  v26 = v4;
  v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v26 count:1];
  v9 = [PLManagedAsset predicateForSyndicatedAssetIdentifiers:v8 includeRejected:1];
  v27[0] = v9;
  v27[1] = v6;
  v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v27 count:2];
  v11 = [v7 andPredicateWithSubpredicates:v10];

  v12 = MEMORY[0x1E695D5E0];
  v13 = +[PLManagedAsset entityName];
  v14 = [v12 fetchRequestWithEntityName:v13];

  [v14 setPredicate:v11];
  [v14 setFetchLimit:1];
  v15 = [v5 managedObjectContext];
  v21 = 0;
  v16 = [v15 executeFetchRequest:v14 error:&v21];
  v17 = v21;

  if (v16)
  {
    v18 = [v16 firstObject];
    v19 = v18;
    if (v18)
    {
      v20 = [v18 additionalAttributes];
      [v20 setDestinationAssetCopyState:2];
    }
  }

  else
  {
    v19 = PLSyndicationGetLog();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      *buf = 138543618;
      v23 = v4;
      v24 = 2112;
      v25 = v17;
      _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Fetching syndication CMM asset for %{public}@ failed: %@", buf, 0x16u);
    }
  }
}

- (void)updateSyndicationStateWithSavedToLibrary:(BOOL)a3
{
  v3 = a3;
  v24 = *MEMORY[0x1E69E9840];
  v5 = [(PLManagedAsset *)self syndicationState];
  v6 = v5 & 0xFFFFFFFD;
  if (v3)
  {
    v7 = 2;
  }

  else
  {
    v7 = 0;
  }

  v8 = v6 | v7;
  if ((v6 | v7) != v5)
  {
    v9 = v5;
    v10 = PLSyndicationGetLog();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = [(PLManagedAsset *)self uuid];
      v12 = [(PLManagedAsset *)self additionalAttributes];
      v13 = [v12 syndicationIdentifier];
      v14 = PLManagedAssetSyndicationStateDescription(v9);
      v15 = PLManagedAssetSyndicationStateDescription(v8);
      v16 = 138544130;
      v17 = v11;
      v18 = 2114;
      v19 = v13;
      v20 = 2114;
      v21 = v14;
      v22 = 2114;
      v23 = v15;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_INFO, "Updating syndication state on asset %{public}@ / %{public}@ from %{public}@ to %{public}@", &v16, 0x2Au);
    }

    [(PLManagedAsset *)self setSyndicationState:v8];
  }
}

- (void)updateSyndicationStateWithSyndicationProcessingValue:(unsigned __int16)a3
{
  if ((a3 & 0x1000) != 0)
  {
    [(PLManagedAsset *)self updateSyndicationStateWithSavedToLibrary:1];
  }
}

- (void)updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:(BOOL)a3
{
  v5 = objc_opt_class();
  v6 = [(PLManagedAsset *)self additionalAttributes];
  v7 = [v6 syndicationIdentifier];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __91__PLManagedAsset_Syndication__updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary___block_invoke;
  v8[3] = &__block_descriptor_33_e24_v16__0__PLManagedAsset_8l;
  v9 = a3;
  [v5 performTransactionOnSyndicationLibraryWithSyndicationIdentifier:v7 block:v8];
}

- (BOOL)shouldSyncToSPL
{
  v3 = objc_opt_class();
  v4 = [(PLManagedAsset *)self savedAssetType];
  v5 = [(PLManagedAsset *)self syndicationState];

  return [v3 shouldSyncAssetToSPLWithSavedAssetType:v4 syndicationState:v5];
}

- (void)_preserveRelationshipsOfDeletedGuestAsset:(id)a3
{
  v4 = a3;
  v5 = [v4 entity];
  v6 = [v5 relationshipsByName];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __73__PLManagedAsset_Syndication___preserveRelationshipsOfDeletedGuestAsset___block_invoke;
  v8[3] = &unk_1E75754F0;
  v9 = v4;
  v10 = self;
  v7 = v4;
  [v6 enumerateKeysAndObjectsUsingBlock:v8];
}

void __73__PLManagedAsset_Syndication___preserveRelationshipsOfDeletedGuestAsset___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v31 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (([v5 hasPrefix:@"memoriesBeing"] & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"suggestionsBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"dayGroupHighlightBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"highlightBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"monthHighlightBeing") & 1) != 0 || (objc_msgSend(v5, "hasPrefix:", @"yearHighlightBeing") & 1) != 0 || objc_msgSend(v5, "isEqualToString:", @"moment"))
  {
    v7 = [v6 isToMany];
    v8 = *(a1 + 32);
    v9 = [v6 name];
    v10 = [v8 valueForKey:v9];

    if (v7)
    {
      if ([v10 count])
      {
        v11 = [v10 copy];
        v12 = PLSyndicationGetLog();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = [v6 name];
          v14 = [*(a1 + 32) uuid];
          v15 = [*(a1 + 40) uuid];
          v25 = 138543874;
          v26 = v13;
          v27 = 2114;
          v28 = v14;
          v29 = 2114;
          v30 = v15;
          _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_INFO, "Preserve relationships: copying %{public}@ from %{public}@ to %{public}@", &v25, 0x20u);
        }

        v16 = *(a1 + 40);
        v17 = [v6 name];
        [v16 setValue:v11 forKey:v17];

        goto LABEL_21;
      }

      v11 = PLSyndicationGetLog();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        goto LABEL_20;
      }
    }

    else
    {
      v11 = PLSyndicationGetLog();
      v18 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
      if (v10)
      {
        if (v18)
        {
          v19 = [v6 name];
          v20 = [*(a1 + 32) uuid];
          v21 = [*(a1 + 40) uuid];
          v25 = 138543874;
          v26 = v19;
          v27 = 2114;
          v28 = v20;
          v29 = 2114;
          v30 = v21;
          _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "Preserve relationships: setting %{public}@ from %{public}@ to %{public}@", &v25, 0x20u);
        }

        v22 = *(a1 + 40);
        v11 = [v6 name];
        [v22 setValue:v10 forKey:v11];
        goto LABEL_21;
      }

      if (v18)
      {
LABEL_20:
        v23 = [*(a1 + 32) uuid];
        v24 = [v6 name];
        v25 = 138543618;
        v26 = v23;
        v27 = 2114;
        v28 = v24;
        _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_INFO, "Preserve relationships: guest asset %{public}@ has no %{public}@", &v25, 0x16u);
      }
    }

LABEL_21:
  }
}

- (void)syndicatedAssetDidSaveToUserLibrary
{
  v49 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedObject *)self photoLibrary];
  v4 = [v3 libraryServicesManager];
  v5 = [v4 isSystemPhotoLibrary];

  v6 = [(PLManagedAsset *)self additionalAttributes];
  v7 = [v6 syndicationIdentifier];

  v8 = PLSyndicationGetLog();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
  {
    [(PLManagedAsset *)self uuid];
    v10 = v9 = v3;
    v11 = @"other";
    *buf = 138543874;
    v44 = v10;
    v45 = 2114;
    if (v5)
    {
      v11 = @"SPL";
    }

    v46 = v7;
    v47 = 2114;
    v48 = v11;
    _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "Syndicated asset %{public}@ / %{public}@ did save to user library (%{public}@)", buf, 0x20u);

    v3 = v9;
  }

  v38 = v5;

  v12 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForGuestAsset"), 1}];
  v13 = MEMORY[0x1E696AB28];
  v39 = v7;
  v41 = v7;
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v41 count:1];
  v15 = [PLManagedAsset predicateForSyndicatedAssetIdentifiers:v14 includeRejected:1];
  v42[0] = v15;
  v42[1] = v12;
  v37 = v12;
  v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v42 count:2];
  v17 = [v13 andPredicateWithSubpredicates:v16];

  v18 = MEMORY[0x1E695D5E0];
  v19 = +[PLManagedAsset entityName];
  v20 = [v18 fetchRequestWithEntityName:v19];

  [v20 setPredicate:v17];
  [v20 setFetchLimit:1];
  v21 = [v3 managedObjectContext];
  v40 = 0;
  v22 = [v21 executeFetchRequest:v20 error:&v40];
  v23 = v40;

  v24 = [v22 firstObject];
  if (v24)
  {
    v25 = PLSyndicationGetLog();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v26 = [v24 uuid];
      v27 = [v24 additionalAttributes];
      [v27 syndicationIdentifier];
      v36 = v17;
      v28 = v23;
      v30 = v29 = v3;
      *buf = 138543618;
      v44 = v26;
      v45 = 2114;
      v46 = v30;
      _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_INFO, "Found existing guest asset %{public}@ with syndication identifier %{public}@", buf, 0x16u);

      v3 = v29;
      v23 = v28;
      v17 = v36;
    }

    [(PLManagedAsset *)self _preserveRelationshipsOfDeletedGuestAsset:v24];
    v31 = MEMORY[0x1E696AEC0];
    v32 = [v24 uuid];
    v33 = [(PLManagedAsset *)self uuid];
    v34 = [v31 stringWithFormat:@"Deleting guest asset (uuid: %@) because we just ingested it as a full asset (uuid: %@)", v32, v33];

    v35 = [PLAssetTransactionReason transactionReason:v34];
    [v24 deleteWithReason:v35];

    [(PLManagedAsset *)self setWasGuestAsset:1];
  }

  else
  {
    [(PLManagedAsset *)self setWasGuestAsset:0];
  }

  if (v38)
  {
    [(PLManagedAsset *)self updateMatchingAssetFromSyndicationLibraryWithSavedToLibrary:1];
  }

  [(PLManagedAsset *)self _updateDestinationAssetCopyStateOnCMMAsset];
}

- (BOOL)eligibleForGuestAssetPromotion
{
  [(PLManagedAsset *)self curationScore];
  if (v3 < 0.5)
  {
    return 0;
  }

  v5 = [(PLManagedAsset *)self mediaAnalysisAttributes];
  v4 = ([v5 syndicationProcessingValue] & 0x7EF0) != 0;

  return v4;
}

- (BOOL)resetGuestAssetPromotion:(id *)a3
{
  v25 = *MEMORY[0x1E69E9840];
  v5 = [(PLManagedObject *)self photoLibrary];
  v6 = [v5 libraryBundle];
  v7 = [v6 libraryServicesManager];
  v8 = [v7 wellKnownPhotoLibraryIdentifier];

  [MEMORY[0x1E69BF328] maskForAllowedToResetGuestAssetPromotion];
  [(PLManagedAsset *)self savedAssetType];
  v9 = PLValidatedSavedAssetTypeApplies();
  if (v8 == 3)
  {
    v10 = v9;
  }

  else
  {
    v10 = 0;
  }

  v11 = PLSyndicationGetLog();
  v12 = v11;
  if (v10)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v13 = [(PLManagedAsset *)self uuid];
      v19 = 138543362;
      v20 = v13;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_INFO, "resetting guest asset promotion for asset %{public}@", &v19, 0xCu);
    }

    -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForInsertIntoSyndicationLibrary]);
  }

  else
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      v14 = [(PLManagedAsset *)self uuid];
      [(PLManagedAsset *)self savedAssetType];
      v15 = PLValidatedSavedAssetTypeDescription();
      v16 = PLStringFromWellKnownPhotoLibraryIdentifier();
      v19 = 138543874;
      v20 = v14;
      v21 = 2114;
      v22 = v15;
      v23 = 2114;
      v24 = v16;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "reset guest asset promotion is forbidden for asset %{public}@ %{public}@ in %{public}@", &v19, 0x20u);
    }

    v17 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:41005 userInfo:0];
    if (a3)
    {
      v17 = v17;
      *a3 = v17;
    }
  }

  return v10;
}

- (BOOL)promoteToGuestAsset:(id *)a3
{
  v27 = *MEMORY[0x1E69E9840];
  if (([(PLManagedAsset *)self syndicationState]& 1) != 0)
  {
    v10 = PLSyndicationGetLog();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      v11 = [(PLManagedAsset *)self uuid];
      *buf = 138543362;
      v24 = v11;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "promotion to guest asset %{public}@ is forbidden for self shared asset", buf, 0xCu);
    }

    v12 = MEMORY[0x1E696ABC0];
    v13 = *MEMORY[0x1E69BFF48];
    v21 = *MEMORY[0x1E696A278];
    v14 = MEMORY[0x1E696AEC0];
    v15 = [(PLManagedAsset *)self uuidDescription];
    v16 = [v14 stringWithFormat:@"self-shared asset %@ cannot be promoted to guest", v15];
    v22 = v16;
    v17 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v22 forKeys:&v21 count:1];
    v18 = [v12 errorWithDomain:v13 code:41005 userInfo:v17];
    if (a3)
    {
      v18 = v18;
      *a3 = v18;
    }

    return 0;
  }

  [MEMORY[0x1E69BF328] maskForAllowedToPromoteToGuestAsset];
  [(PLManagedAsset *)self savedAssetType];
  v5 = PLValidatedSavedAssetTypeApplies();
  v6 = PLSyndicationGetLog();
  v7 = v6;
  if (!v5)
  {
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      v19 = [(PLManagedAsset *)self uuid];
      *buf = 138543618;
      v24 = v19;
      v25 = 1024;
      v26 = [(PLManagedAsset *)self savedAssetType];
      _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_ERROR, "promotion to guest asset %{public}@ is forbidden for savedAssetType %hd", buf, 0x12u);
    }

    v20 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:41005 userInfo:0];
    if (a3)
    {
      v20 = v20;
      *a3 = v20;
    }

    return 0;
  }

  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    v8 = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    v24 = v8;
    _os_log_impl(&dword_19BF1F000, v7, OS_LOG_TYPE_INFO, "promoting asset %{public}@ to guest", buf, 0xCu);
  }

  -[PLManagedAsset setSavedAssetType:](self, "setSavedAssetType:", [MEMORY[0x1E69BF328] savedAssetTypeForPromoteToGuestAsset]);
  return 1;
}

- (BOOL)syndicationOriginalResourcesAreLocal
{
  v3 = [(PLManagedAsset *)self syndicationOriginalResource];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 resourceType];
    v6 = [v4 version];
    v7 = [v4 recipeID];
    v8 = [v4 uniformTypeIdentifier];
    v9 = [v8 identifier];
    v10 = [(PLManagedAsset *)self syndicationResourceURLForResourceType:v5 version:v6 recipeID:v7 utiString:v9 error:0];

    v14 = 0;
    if (v10)
    {
      v11 = [MEMORY[0x1E696AC08] defaultManager];
      v12 = [v10 path];
      v13 = [v11 fileExistsAtPath:v12];

      if (v13)
      {
        v14 = 1;
      }
    }
  }

  else
  {
    v14 = 0;
  }

  if ([(PLManagedAsset *)self isPhotoIris])
  {
    v15 = 0;
    if (!v14)
    {
      return v14;
    }
  }

  else
  {
    v16 = [(PLManagedAsset *)self filename];
    v15 = v16 != 0;

    if (!v14)
    {
      return v14;
    }
  }

  if (!v15)
  {
    v17 = [(PLManagedAsset *)self syndicationOriginalVideoComplementResource];
    v18 = v17;
    if (v17)
    {
      v19 = [v17 resourceType];
      v20 = [v18 version];
      v21 = [v18 recipeID];
      v22 = [v18 uniformTypeIdentifier];
      v23 = [v22 identifier];
      v24 = [(PLManagedAsset *)self syndicationResourceURLForResourceType:v19 version:v20 recipeID:v21 utiString:v23 error:0];

      if (!v24 || ([MEMORY[0x1E696AC08] defaultManager], v25 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v24, "path"), v26 = objc_claimAutoreleasedReturnValue(), v27 = objc_msgSend(v25, "fileExistsAtPath:", v26), v26, v25, (v27 & 1) == 0))
      {
        LOBYTE(v14) = 0;
      }
    }

    else
    {
      LOBYTE(v14) = 0;
    }
  }

  return v14;
}

BOOL __73__PLManagedAsset_Syndication__syndicationOriginalVideoComplementResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 resourceType] == 3 && !objc_msgSend(v2, "version") && (objc_msgSend(v2, "recipeID") & 1) == 0;

  return v3;
}

- (id)syndicationOriginalResource
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self kind];
  if (v3 >= 3)
  {
    v4 = 31;
  }

  else
  {
    v4 = v3;
  }

  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __58__PLManagedAsset_Syndication__syndicationOriginalResource__block_invoke;
  v12[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  v13 = v4;
  v5 = [(PLManagedAsset *)self firstPersistedResourceMatching:v12];
  if (!v5)
  {
    v5 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_104115];
    if (v5)
    {
      v6 = PLSyndicationGetLog();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_FAULT))
      {
        v7 = [(PLManagedAsset *)self syndicationDescription];
        v8 = [v5 resourceType];
        if (v8 > 0x1F)
        {
          v9 = @"invalid";
        }

        else
        {
          v9 = off_1E75663B0[v8];
        }

        v10 = v9;
        *buf = 138543618;
        v15 = v7;
        v16 = 2114;
        v17 = v10;
        _os_log_impl(&dword_19BF1F000, v6, OS_LOG_TYPE_FAULT, "Syndication asset (%{public}@) has possibly inconsistent original resource with type: %{public}@", buf, 0x16u);
      }
    }
  }

  return v5;
}

BOOL __58__PLManagedAsset_Syndication__syndicationOriginalResource__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = *(a1 + 32);
  v5 = v3;
  v6 = [v5 resourceType] == v4 && !objc_msgSend(v5, "version") && (objc_msgSend(v5, "recipeID") & 1) == 0;

  return v6;
}

- (id)syndicationResourceURLForResourceType:(unsigned int)a3 version:(unsigned int)a4 recipeID:(unsigned int)a5 utiString:(id)a6 error:(id *)a7
{
  v8 = *&a5;
  v9 = *&a4;
  v10 = *&a3;
  v31[1] = *MEMORY[0x1E69E9840];
  v12 = a6;
  v13 = MEMORY[0x1E69BF298];
  v14 = [(PLManagedAsset *)self uuid];
  v15 = [(PLManagedAsset *)self originalFilename];
  LODWORD(v13) = [v13 isValidFileIdentifierParametersForUUID:v14 utiString:v12 originalFilename:v15];

  if (v13)
  {
    v16 = [(PLManagedObject *)self pathManager];
    v17 = [(PLManagedAsset *)self syndicationFileIdentifierForResourceType:v10 version:v9 recipeID:v8 utiString:v12];
    v18 = [v16 readOnlyUrlWithIdentifier:v17];

    if (v18)
    {
      goto LABEL_8;
    }

    v19 = MEMORY[0x1E696ABC0];
    v20 = *MEMORY[0x1E69BFF48];
    v30 = *MEMORY[0x1E696A578];
    v31[0] = @"Failed to create url from identifier";
    v21 = MEMORY[0x1E695DF20];
    v22 = v31;
    v23 = &v30;
  }

  else
  {
    v19 = MEMORY[0x1E696ABC0];
    v20 = *MEMORY[0x1E69BFF48];
    v28 = *MEMORY[0x1E696A578];
    v29 = @"Invalid file identifier parameters";
    v21 = MEMORY[0x1E695DF20];
    v22 = &v29;
    v23 = &v28;
  }

  v24 = [v21 dictionaryWithObjects:v22 forKeys:v23 count:1];
  v25 = [v19 errorWithDomain:v20 code:46801 userInfo:v24];

  if (a7)
  {
    v26 = v25;
    *a7 = v25;
  }

  v18 = 0;
LABEL_8:

  return v18;
}

- (id)syndicationFileIdentifierForResourceType:(unsigned int)a3 version:(unsigned int)a4 recipeID:(unsigned int)a5 utiString:(id)a6
{
  v6 = *&a5;
  v7 = *&a4;
  v8 = *&a3;
  v11 = a6;
  if (v8 == 16)
  {
    v17 = [MEMORY[0x1E696AAA8] currentHandler];
    [v17 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:531 description:{@"Invalid parameter not satisfying: %@", @"resourceType != PLResourceTypeContextualVideoThumbnail"}];
  }

  v12 = objc_alloc(MEMORY[0x1E69BF298]);
  v13 = [(PLManagedAsset *)self uuid];
  v14 = [(PLManagedAsset *)self originalFilename];
  v15 = [v12 initWithAssetUuid:v13 bundleScope:3 uti:v11 resourceVersion:v7 resourceType:v8 recipeID:v6 originalFilename:v14 customSuffix:0];

  return v15;
}

- (id)syndicationDescription
{
  v3 = +[PLDescriptionBuilder plainDescriptionBuilder];
  v4 = [(PLManagedAsset *)self uuid];
  [v3 appendName:@"uuid" object:v4];

  v5 = [(PLManagedAsset *)self additionalAttributes];
  v6 = [v5 syndicationIdentifier];
  [v3 appendName:@"syndicationIdentifier" object:v6];

  [v3 appendName:@"kind" unsignedIntegerValue:{-[PLManagedAsset kind](self, "kind")}];
  v7 = [(PLManagedAsset *)self uniformTypeIdentifier];
  [v3 appendName:@"uti" object:v7];

  v8 = [(PLManagedAsset *)self additionalAttributes];
  v9 = [v8 importedByBundleIdentifier];
  [v3 appendName:@"importedBy" object:v9];

  v10 = [(PLManagedAsset *)self syndicationResourcesDescription];
  [v3 appendName:@"resources" object:v10];

  v11 = [v3 build];

  return v11;
}

- (id)syndicationResourcesDescription
{
  v23 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E696AD60]);
  v18 = 0u;
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  obj = [(PLManagedAsset *)self modernResources];
  v4 = [obj countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v19;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v19 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v18 + 1) + 8 * i);
        v9 = +[PLDescriptionBuilder plainDescriptionBuilder];
        v10 = [v8 resourceType];
        v11 = @"invalid";
        if (v10 <= 0x1F)
        {
          v11 = off_1E75663B0[v10];
        }

        v12 = v11;
        [v9 appendName:@"type" object:v12];

        v13 = [v8 dataStore];
        v14 = [v13 descriptionForSubtype:{objc_msgSend(v8, "dataStoreSubtype")}];
        [v9 appendName:@"dataStoreSubtype" object:v14];

        v15 = [v9 build];
        [v3 appendFormat:@"<%@>", v15];
      }

      v5 = [obj countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v5);
  }

  return v3;
}

- (BOOL)becomeSyndicationLivePhotoWithVideoComplementContentType:(id)a3
{
  v4 = [PLResourceInstaller onDemand_installOriginalVideoComplementForSyndicationAsset:self contentType:a3];
  if (v4)
  {
    [(PLManagedAsset *)self setKindSubtype:2];
  }

  return v4 != 0;
}

- (void)setSyndicationFilenameAndDirectoryWithOriginalFilename:(id)a3
{
  v9 = a3;
  if (!v9)
  {
    v8 = [MEMORY[0x1E696AAA8] currentHandler];
    [v8 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:489 description:{@"Invalid parameter not satisfying: %@", @"originalFilename"}];
  }

  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setOriginalFilename:v9];

  v6 = [(PLManagedAsset *)self uniformTypeIdentifier];

  if (v6)
  {
    v7 = [(PLManagedAsset *)self uniformTypeIdentifier];
    [(PLManagedAsset *)self setUBFFilenameAndDirectoryWithOriginalUniformTypeIdentifier:v7 originalFilename:v9];
  }
}

- (void)setSyndicationLivePhotoAttributesFromMainFileURL:(id)a3 mainFileMetadata:(id)a4 videoComplementFileURL:(id)a5 videoComplementMetadata:(id)a6
{
  v11 = a3;
  v12 = a4;
  v13 = a5;
  v14 = a6;
  if (v11)
  {
    if (v13)
    {
      goto LABEL_3;
    }
  }

  else
  {
    v26 = [MEMORY[0x1E696AAA8] currentHandler];
    [v26 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:457 description:{@"Invalid parameter not satisfying: %@", @"fileURL"}];

    if (v13)
    {
      goto LABEL_3;
    }
  }

  v27 = [MEMORY[0x1E696AAA8] currentHandler];
  [v27 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+Syndication.m" lineNumber:458 description:{@"Invalid parameter not satisfying: %@", @"videoComplementFileURL"}];

LABEL_3:
  if (![v14 isSyndicationOriginated])
  {
    v17 = objc_alloc(MEMORY[0x1E69C0918]);
    v18 = [v13 path];
    v19 = [v11 path];
    v16 = [v17 initWithPathToVideo:v18 pathToImage:v19];

    v20 = [v16 pairingIdentifier];
    v21 = v20;
    v34 = 0uLL;
    v35 = 0;
    if (v16)
    {
      [v16 imageDisplayTime];
      v32 = 0uLL;
      v33 = 0;
      [v16 originalVideoDuration];
      if (!v21)
      {
        goto LABEL_19;
      }
    }

    else
    {
      v32 = 0uLL;
      v33 = 0;
      if (!v20)
      {
LABEL_19:

        goto LABEL_20;
      }
    }

    if (BYTE12(v32))
    {
      v30 = v32;
      v31 = v33;
      v28 = v34;
      v29 = v35;
      [(PLManagedAsset *)self becomePhotoIrisWithMediaGroupUUID:v21 mainFileMetadata:v12 videoURL:v13 videoDuration:&v30 stillDisplayTime:&v28 options:0];
    }

    goto LABEL_19;
  }

  v15 = [v14 livePhotoPairingIdentifier];
  v16 = v15;
  v34 = 0uLL;
  v35 = 0;
  if (v14)
  {
    [v14 stillImageDisplayTime];
    v32 = 0uLL;
    v33 = 0;
    [v14 duration];
    if (!v16)
    {
      goto LABEL_20;
    }
  }

  else
  {
    v32 = 0uLL;
    v33 = 0;
    if (!v15)
    {
      goto LABEL_20;
    }
  }

  if (BYTE12(v34) & 1) != 0 && (BYTE12(v32))
  {
    [(PLManagedAsset *)self setKindSubtype:2];
    v30 = v32;
    v31 = v33;
    v28 = v34;
    v29 = v35;
    [(PLManagedAsset *)self updatePhotoIrisMetadataWithMediaGroupUUID:v16 videoDuration:&v30 stillDisplayTime:&v28];
    if ([(PLManagedAsset *)self canPlayPhotoIris])
    {
      [(PLManagedAsset *)self setPlaybackStyle:3];
      [(PLManagedAsset *)self updatePlaybackVariationAndStyleFromOriginalMetadata:v12];
    }

    v22 = [(PLManagedAsset *)self syndicationOriginalVideoComplementResource];
    [v14 exifPixelSize];
    [v22 setUnorientedWidth:v23];
    [v14 exifPixelSize];
    [v22 setUnorientedHeight:v24];
    v25 = [v14 firstVideoTrackCodecString];
    [v22 setCodecFourCharCodeName:v25];

    [v22 setLocalAvailability:1];
    [v22 setDataLength:{objc_msgSend(v14, "fileSize")}];
  }

LABEL_20:
}

- (void)setSyndicationAttributesFromMainFileURL:(id)a3 metadata:(id)a4
{
  v19 = *MEMORY[0x1E69E9840];
  v6 = a4;
  v7 = a3;
  [(PLManagedAsset *)self setDateCreated:0];
  v8 = [(PLManagedAsset *)self additionalAttributes];
  v9 = [v8 originalFilename];

  v10 = [(PLManagedAsset *)self directory];
  v11 = [(PLManagedAsset *)self filename];
  [(PLManagedAsset *)self setAttributesFromMainFileURL:v7 mainFileMetadata:v6 savedAssetType:[(PLManagedAsset *)self savedAssetType] bundleScope:3 isPlaceholder:0 placeholderFileURL:0 imageSource:0 imageData:0];

  v12 = [(PLManagedAsset *)self additionalAttributes];
  [v12 setOriginalFilename:v9];

  [(PLManagedAsset *)self setDirectory:v10];
  [(PLManagedAsset *)self setFilename:v11];
  v13 = [(PLManagedAsset *)self dateCreated];

  if (!v13)
  {
    v14 = [(PLManagedAsset *)self addedDate];
    [(PLManagedAsset *)self setDateCreated:v14];

    v15 = PLSyndicationGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v16 = [(PLManagedAsset *)self addedDate];
      *buf = 138412290;
      v18 = v16;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_INFO, "dateCreated is nil, falling back to addedDate %@", buf, 0xCu);
    }
  }

  [(PLManagedAsset *)self persistMetadataToFilesystem];
}

- (void)_updateModificationDateForSyndication
{
  v3 = [MEMORY[0x1E695DF00] now];
  [(PLManagedAsset *)self setModificationDate:v3];
}

- (void)_fixDistantPastContentCreationDateWithItem:(id)a3
{
  v29 = *MEMORY[0x1E69E9840];
  v4 = [a3 attributeSet];
  v5 = [v4 contentCreationDate];

  if (v5)
  {
    v6 = [(PLManagedAsset *)self addedDate];
    v7 = [v5 isEqualToDate:v6];

    if ((v7 & 1) == 0)
    {
      v8 = PLSyndicationGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEFAULT))
      {
        v9 = [(PLManagedAsset *)self uuid];
        v10 = [(PLManagedAsset *)self additionalAttributes];
        v11 = [v10 syndicationIdentifier];
        v12 = [(PLManagedAsset *)self addedDate];
        v21 = 138544130;
        v22 = v9;
        v23 = 2114;
        v24 = v11;
        v25 = 2114;
        v26 = v12;
        v27 = 2114;
        v28 = v5;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEFAULT, "[sync] asset (%{public}@ / %{public}@) addedDate (%{public}@ does not match Spotlight content creation date: %{public}@, repairing date", &v21, 0x2Au);
      }

      [(PLManagedAsset *)self setAddedDate:v5];
      v13 = [(PLManagedAsset *)self dateCreated];
      v14 = [MEMORY[0x1E695DF00] distantPast];
      if ([v13 isEqualToDate:v14])
      {
        v15 = [(PLManagedAsset *)self dateCreated];
        v16 = [v5 isEqualToDate:v15];

        if ((v16 & 1) == 0)
        {
          v17 = PLSyndicationGetLog();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
          {
            v18 = [(PLManagedAsset *)self uuid];
            v19 = [(PLManagedAsset *)self additionalAttributes];
            v20 = [v19 syndicationIdentifier];
            v21 = 138543618;
            v22 = v18;
            v23 = 2114;
            v24 = v20;
            _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "[sync] asset (%{public}@ / %{public}@) dateCreated is distantPast, repairing date", &v21, 0x16u);
          }

          [(PLManagedAsset *)self setDateCreated:v5];
        }
      }

      else
      {
      }

      [(PLManagedAsset *)self _updateModificationDateForSyndication];
    }
  }
}

- (void)_updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:(id)a3
{
  v8 = a3;
  v4 = [MEMORY[0x1E695DF00] now];
  v5 = [(PLManagedAsset *)self confirmedSpotlightSyncDate];

  if (!v5)
  {
    goto LABEL_6;
  }

  if (!v8)
  {
    goto LABEL_7;
  }

  v6 = [(PLManagedAsset *)self confirmedSpotlightSyncDate];
  if ([v6 compare:v8] != -1)
  {

    goto LABEL_7;
  }

  v7 = [v8 compare:v4];

  if (v7 == -1)
  {
LABEL_6:
    [(PLManagedAsset *)self setConfirmedSpotlightSyncDate:v4];
  }

LABEL_7:
}

- (void)_setSyndicationStateFromContentsOfSearchableItem:(id)a3
{
  v19 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self syndicationState];
  v6 = v5 & 0xFFF6 | PLSearchableItemMessageIsFromMe(v4);
  if (PLSearchableItemMessagesIsSyndicatableMedia(v4))
  {
    v7 = 0;
  }

  else
  {
    v7 = 8;
  }

  v8 = v6 | v7;
  if (v5 != v8)
  {
    v9 = PLSyndicationGetLog();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
    {
      v10 = [v4 uniqueIdentifier];
      v11 = PLManagedAssetSyndicationStateDescription(v5);
      v12 = PLManagedAssetSyndicationStateDescription(v8);
      v13 = 138543874;
      v14 = v10;
      v15 = 2114;
      v16 = v11;
      v17 = 2114;
      v18 = v12;
      _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "[sync] setting syndication state from spotlight item %{public}@, %{public}@ -> %{public}@", &v13, 0x20u);
    }

    [(PLManagedAsset *)self setSyndicationState:v8];
    [(PLManagedAsset *)self _updateModificationDateForSyndication];
  }
}

- (void)_populateSyndicationAssetWithAssetType:(signed __int16)a3 subtype:(signed __int16)a4 contentType:(id)a5 videoComplementContentType:(id)a6 originalFilename:(id)a7
{
  v9 = a4;
  v10 = a3;
  v26 = *MEMORY[0x1E69E9840];
  v12 = a6;
  v13 = a7;
  v14 = a5;
  [(PLManagedAsset *)self updateAssetKindAndPlaybackStyleIfNeededWithKind:v10];
  v15 = [v14 identifier];

  [(PLManagedAsset *)self setUniformTypeIdentifier:v15];
  if (v13)
  {
    [(PLManagedAsset *)self setSyndicationFilenameAndDirectoryWithOriginalFilename:v13];
  }

  v16 = [PLResourceInstaller onDemand_installOriginalResourceForSyndicationAsset:self];
  if (v9 == 2)
  {
    if (![(PLManagedAsset *)self becomeSyndicationLivePhotoWithVideoComplementContentType:v12])
    {
      v17 = PLSyndicationGetLog();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        v18 = [(PLManagedAsset *)self uuid];
        v19 = [v12 identifier];
        v22 = 138543618;
        v23 = v18;
        v24 = 2114;
        v25 = v19;
        _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "[sync] failed to promote asset to live photo: %{public}@, content type: %{public}@", &v22, 0x16u);
      }
    }
  }

  else
  {
    [(PLManagedAsset *)self setKindSubtype:v9];
  }

  v20 = [PLResourceRecipe recipeFromID:65741];
  v21 = [PLResourceInstaller onDemand_installPrimaryImageResourceWithRecipe:v20 version:0 forAsset:self requireFileToBePresent:0];
  [v21 setDataStoreClassID:3];
  [v21 setDataStoreSubtype:4];
  [v21 setLocalAvailability:4294934528];
  [v21 setSyndicationLocalAvailabilityWithAvailable:0 additionalFlags:2];
}

- (void)setConfirmedSpotlightSyncDate:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self additionalAttributes];
  [v5 setLastUploadAttemptDate:v4];
}

- (NSDate)confirmedSpotlightSyncDate
{
  v2 = [(PLManagedAsset *)self additionalAttributes];
  v3 = [v2 lastUploadAttemptDate];

  return v3;
}

+ (void)performTransactionOnSyndicationLibraryWithSyndicationIdentifier:(id)a3 block:(id)a4
{
  v19 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v16 = 0;
  v8 = PLCreateShortLivedWellKnownPhotoLibrary(3, "+[PLManagedAsset(Syndication) performTransactionOnSyndicationLibraryWithSyndicationIdentifier:block:]", &v16);
  v9 = v16;
  if (v8)
  {
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __101__PLManagedAsset_Syndication__performTransactionOnSyndicationLibraryWithSyndicationIdentifier_block___block_invoke;
    v11[3] = &unk_1E7576078;
    v15 = a1;
    v12 = v6;
    v13 = v8;
    v14 = v7;
    [v13 performTransaction:v11];

    v10 = v12;
  }

  else
  {
    v10 = PLSyndicationGetLog();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412290;
      v18 = v9;
      _os_log_impl(&dword_19BF1F000, v10, OS_LOG_TYPE_ERROR, "matchingAssetFromSyndicationLibrary: Unable to open syndication photo library: %@", buf, 0xCu);
    }
  }
}

void __101__PLManagedAsset_Syndication__performTransactionOnSyndicationLibraryWithSyndicationIdentifier_block___block_invoke(uint64_t a1)
{
  v12 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 56) assetWithSyndicationIdentifier:*(a1 + 32) inLibrary:*(a1 + 40)];
  v3 = PLSyndicationGetLog();
  v4 = v3;
  if (v2)
  {
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v5 = [v2 uuid];
      v6 = *(a1 + 32);
      v8 = 138543618;
      v9 = v5;
      v10 = 2114;
      v11 = v6;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_INFO, "found matching asset %{public}@ in syndication library for %{public}@", &v8, 0x16u);
    }

    (*(*(a1 + 48) + 16))();
  }

  else
  {
    if (os_log_type_enabled(v3, OS_LOG_TYPE_ERROR))
    {
      v7 = *(a1 + 32);
      v8 = 138543362;
      v9 = v7;
      _os_log_impl(&dword_19BF1F000, v4, OS_LOG_TYPE_ERROR, "unable to find matching asset in syndication library for %{public}@", &v8, 0xCu);
    }
  }
}

+ (id)predicateForShouldSyncToSPL
{
  v8[2] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E696AB28];
  v3 = [MEMORY[0x1E69BF328] predicateForIncludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForGuestAsset"), 0}];
  v8[0] = v3;
  v4 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %d", @"syndicationState", 0];
  v8[1] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:2];
  v6 = [v2 andPredicateWithSubpredicates:v5];

  return v6;
}

+ (BOOL)shouldSyncAssetToSPLWithSavedAssetType:(signed __int16)a3 syndicationState:(unsigned __int16)a4
{
  v4 = a4;
  [MEMORY[0x1E69BF328] maskForGuestAsset];
  result = PLValidatedSavedAssetTypeApplies();
  if (v4)
  {
    return 0;
  }

  return result;
}

+ (id)createOrUpdateObjectFromSearchableItem:(id)a3 library:(id)a4 fullIndexSyncStartDate:(id)a5 createIfNeeded:(BOOL)a6 didCreate:(BOOL *)a7 isSyndicatable:(BOOL *)a8 error:(id *)a9
{
  v10 = a6;
  v91 = *MEMORY[0x1E69E9840];
  v13 = a3;
  v14 = a4;
  v15 = a5;
  v82 = 0;
  v16 = [v13 attributeSet];
  v17 = [v16 contentURL];

  IsHidden = PLSearchableItemMessagesIsHidden(v13);
  v19 = PLSearchableItemMessagesIsSyndicatableMedia(v13) & (IsHidden ^ 1);
  v20 = PLSyndicationGetLog();
  if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
  {
    v21 = [v13 uniqueIdentifier];
    v22 = @"not syndicatable";
    *buf = 138543874;
    v84 = v21;
    if (v19)
    {
      v22 = @"syndicatable";
    }

    v85 = 2114;
    v86 = v22;
    v87 = 2112;
    v88 = v17;
    _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEFAULT, "[sync] considering spotlight item with ID: %{public}@ (%{public}@) for syndication asset with content URL: %@", buf, 0x20u);
  }

  if (v19)
  {
    v80 = 0;
    v81 = 0;
    v23 = PLAssetTypeForSearchableItem(v13, &v81, &v80);
    v76 = v81;
    v24 = v80;
    if (v23 < 2)
    {
      v79 = v24;
      v25 = [PLManagedAsset _syndicationAssetForSearchableItem:v13 inLibrary:v14 createIfNeeded:v10 didCreate:&v82 error:&v79];
      v74 = v79;

      v75 = v15;
      if (!v82)
      {
        [v25 _fixDistantPastContentCreationDateWithItem:v13];
        v43 = [v13 attributeSet];
        v53 = [v43 photosDonationState];
        if ([v53 integerValue])
        {

          v42 = v76;
        }

        else
        {
          v54 = [v25 isEligibleForSearchIndexing];

          v42 = v76;
          if (!v54)
          {
LABEL_38:
            [v25 _setSyndicationStateFromContentsOfSearchableItem:v13];
            v15 = v75;
            [v25 _updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:v75];
            v24 = v74;
            goto LABEL_39;
          }

          v55 = PLSyndicationGetLog();
          if (os_log_type_enabled(v55, OS_LOG_TYPE_DEFAULT))
          {
            v56 = [v13 uniqueIdentifier];
            v57 = [v25 uuid];
            *buf = 138543618;
            v84 = v56;
            v85 = 2114;
            v86 = v57;
            _os_log_impl(&dword_19BF1F000, v55, OS_LOG_TYPE_DEFAULT, "[sync] Spotlight record (id: %{public}@) matches existing asset in library but photos donation is missing, scheduling asset (%{public}@) for indexing", buf, 0x16u);
          }

          v43 = [v25 uuid];
          v58 = [PLBackgroundJobWorkItem addSearchIndexWorkItemIfNeededWithIdentifier:v43 flags:14 inLibrary:v14];
        }

LABEL_37:

        goto LABEL_38;
      }

      v26 = PLSyndicationGetLog();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_DEFAULT))
      {
        [v25 uuid];
        v27 = v72 = v17;
        v28 = [v25 additionalAttributes];
        v29 = [v28 syndicationIdentifier];
        *buf = 138543618;
        v84 = v27;
        v85 = 2114;
        v86 = v29;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_DEFAULT, "[sync] created asset with uuid: %{public}@, syndication ID: %{public}@", buf, 0x16u);

        v17 = v72;
      }

      v70 = a7;

      v30 = PLSearchableItemMessagesChatUniqueIdentifier(v13);
      if (v30)
      {
        [v25 setConversationAlbumWithConversationID:v30];
      }

      v71 = v30;
      v31 = PLSearchableItemMessagesLivePhotoVideoURL(v13);
      v32 = [v13 bundleID];
      v33 = [v32 isEqualToString:*MEMORY[0x1E69BFF00]];

      v34 = 0;
      v35 = 0;
      v73 = v31;
      if (v33 && v31)
      {
        if (v23)
        {
          v36 = PLSyndicationGetLog();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            v37 = [v25 uuid];
            v38 = [v13 bundleID];
            v68 = [v25 additionalAttributes];
            v39 = [v68 syndicationIdentifier];
            *buf = 138543874;
            v84 = v37;
            v85 = 2114;
            v86 = v38;
            v87 = 2114;
            v88 = v39;
            _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[sync] ignoring video complement key for non-image asset: %{public}@, bundle ID: %{public}@, syndication ID: %{public}@", buf, 0x20u);
          }

          v35 = 0;
        }

        else
        {
          v61 = MEMORY[0x1E6982C40];
          v62 = [v31 pathExtension];
          v35 = [v61 typeWithFilenameExtension:v62 conformingToType:*MEMORY[0x1E6982EE8]];

          if (v35 && ![v35 isDynamic])
          {
            v34 = 2;
            goto LABEL_19;
          }

          v36 = PLSyndicationGetLog();
          if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
          {
            v69 = [v73 pathExtension];
            v65 = [v25 uuid];
            v66 = [v13 bundleID];
            v67 = [v25 additionalAttributes];
            v63 = [v67 syndicationIdentifier];
            *buf = 138544130;
            v84 = v69;
            v85 = 2114;
            v86 = v65;
            v87 = 2114;
            v88 = v66;
            v89 = 2114;
            v90 = v63;
            v64 = v63;
            _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "[sync] unexpected video complement uti for file extension: %{public}@, storing as image only, asset: %{public}@, bundle ID: %{public}@, syndication ID: %{public}@", buf, 0x2Au);
          }
        }

        v34 = 0;
      }

LABEL_19:
      v40 = [v17 lastPathComponent];
      v41 = v23;
      v42 = v76;
      [v25 _populateSyndicationAssetWithAssetType:v41 subtype:v34 contentType:v76 videoComplementContentType:v35 originalFilename:v40];

      a7 = v70;
      v43 = v71;
      goto LABEL_37;
    }

    if (v23 == 2)
    {
      v46 = PLSyndicationGetLog();
      v42 = v76;
      if (os_log_type_enabled(v46, OS_LOG_TYPE_DEBUG))
      {
        [v13 uniqueIdentifier];
        v48 = v47 = v15;
        *buf = 138543362;
        v84 = v48;
        v49 = "[sync] skipping audio spotlight item with ID: %{public}@";
        v50 = v46;
        v51 = OS_LOG_TYPE_DEBUG;
        v52 = 12;
LABEL_31:
        _os_log_impl(&dword_19BF1F000, v50, v51, v49, buf, v52);

        v15 = v47;
      }
    }

    else
    {
      v46 = PLSyndicationGetLog();
      v42 = v76;
      if (os_log_type_enabled(v46, OS_LOG_TYPE_ERROR))
      {
        [v13 uniqueIdentifier];
        v48 = v47 = v15;
        *buf = 138543618;
        v84 = v48;
        v85 = 2112;
        v86 = v24;
        v49 = "[sync] unable to sync spotlight item (unknown asset type) with ID: %{public}@, error: %@";
        v50 = v46;
        v51 = OS_LOG_TYPE_ERROR;
        v52 = 22;
        goto LABEL_31;
      }
    }

    v25 = 0;
LABEL_39:

    goto LABEL_40;
  }

  v78 = 0;
  v25 = [PLManagedAsset _syndicationAssetForSearchableItem:v13 inLibrary:v14 createIfNeeded:0 didCreate:0 error:&v78];
  v24 = v78;
  if (v25)
  {
    if (IsHidden)
    {
      [v14 managedObjectContext];
      v45 = v44 = v15;
      [v45 deleteObject:v25];

      v15 = v44;
    }

    else
    {
      [v25 _setSyndicationStateFromContentsOfSearchableItem:v13];
      [v25 _updateConfirmedSpotlightSyncDateIfNeededForFullIndexSyncStartDate:v15];
    }
  }

LABEL_40:
  if (a7)
  {
    *a7 = v82;
  }

  if (a8)
  {
    *a8 = v19;
  }

  if (a9)
  {
    v59 = v24;
    *a9 = v24;
  }

  return v25;
}

+ (id)predicateForSyndicatedAssetIdentifiersSuffix:(id)a3
{
  v21 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [MEMORY[0x1E695DF70] array];
  v5 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"additionalAttributes.syndicationIdentifier"];
  [v4 addObject:v5];

  v6 = [MEMORY[0x1E695DF70] array];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v7 = v3;
  v8 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v17;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v17 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K ENDSWITH %@", @"additionalAttributes.syndicationIdentifier", *(*(&v16 + 1) + 8 * i), v16];
        [v6 addObject:v12];
      }

      v9 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v9);
  }

  v13 = [MEMORY[0x1E696AB28] orPredicateWithSubpredicates:v6];
  [v4 addObject:v13];
  v14 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v4];

  return v14;
}

+ (id)predicateForSyndicatedAssetIdentifiers:(id)a3 includeRejected:(BOOL)a4
{
  v18[2] = *MEMORY[0x1E69E9840];
  v6 = a3;
  if (v6)
  {
    v7 = MEMORY[0x1E696AB28];
    v8 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"additionalAttributes.syndicationIdentifier"];
    v18[0] = v8;
    v9 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K IN %@", @"additionalAttributes.syndicationIdentifier", v6];
    v18[1] = v9;
    v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v18 count:2];
    v11 = [v7 andPredicateWithSubpredicates:v10];

    if (a4)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  v11 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != nil", @"additionalAttributes.syndicationIdentifier"];
  if (!a4)
  {
LABEL_3:
    v12 = MEMORY[0x1E696AB28];
    v17[0] = v11;
    v13 = [a1 filterPredicateToExcludeNoSyndicationAssets];
    v17[1] = v13;
    v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:2];
    v15 = [v12 andPredicateWithSubpredicates:v14];

    v11 = v15;
  }

LABEL_4:

  return v11;
}

+ (PLManagedAsset)assetWithSyndicationIdentifier:(id)a3 inLibrary:(id)a4
{
  v30[2] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if (v6)
  {
    v8 = objc_autoreleasePoolPush();
    v9 = MEMORY[0x1E695D5E0];
    v10 = +[PLManagedAsset entityName];
    v11 = [v9 fetchRequestWithEntityName:v10];

    v12 = MEMORY[0x1E696AB28];
    v29 = v6;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v29 count:1];
    v14 = [a1 predicateForSyndicatedAssetIdentifiers:v13 includeRejected:1];
    v30[0] = v14;
    v15 = [MEMORY[0x1E69BF328] predicateForExcludeMask:objc_msgSend(MEMORY[0x1E69BF328] useIndex:{"maskForSyndicationIdentifierFetchExclusions"), 0}];
    v30[1] = v15;
    v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:2];
    v17 = [v12 andPredicateWithSubpredicates:v16];

    [v11 setPredicate:v17];
    v18 = [v7 managedObjectContext];
    v26 = 0;
    v19 = [v18 executeFetchRequest:v11 error:&v26];
    v20 = v26;

    v21 = [v19 count];
    if (v21)
    {
      v22 = v21;
      v23 = [v19 objectAtIndex:0];
      if (v22 != 1)
      {
        v24 = PLSyndicationGetLog();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          *buf = 138543362;
          v28 = v6;
          _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Found more than one asset with syndication identifier %{public}@", buf, 0xCu);
        }
      }
    }

    else
    {
      v23 = 0;
    }

    objc_autoreleasePoolPop(v8);
  }

  else
  {
    v23 = 0;
  }

  return v23;
}

+ (id)_syndicationAssetForSearchableItem:(id)a3 inLibrary:(id)a4 createIfNeeded:(BOOL)a5 didCreate:(BOOL *)a6 error:(id *)a7
{
  v34 = a5;
  v39[2] = *MEMORY[0x1E69E9840];
  v9 = a4;
  v10 = a3;
  v11 = [v10 uniqueIdentifier];
  v12 = [v10 attributeSet];
  v13 = [v12 bundleID];

  v14 = [v10 attributeSet];

  v36 = [v14 contentCreationDate];

  v15 = MEMORY[0x1E695D5E0];
  v16 = +[PLManagedAsset entityName];
  v17 = [v15 fetchRequestWithEntityName:v16];

  v18 = MEMORY[0x1E696AB28];
  v38 = v11;
  v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v38 count:1];
  v20 = [a1 predicateForSyndicatedAssetIdentifiers:v19 includeRejected:1];
  v39[0] = v20;
  v21 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"additionalAttributes.importedByBundleIdentifier", v13];
  v39[1] = v21;
  v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v39 count:2];
  v23 = [v18 andPredicateWithSubpredicates:v22];
  [v17 setPredicate:v23];

  v24 = [v9 managedObjectContext];
  v37 = 0;
  v25 = [v24 executeFetchRequest:v17 error:&v37];
  v26 = v37;

  v27 = [v25 firstObject];
  if (!v27 && v34)
  {
    v28 = [MEMORY[0x1E696AFB0] UUID];
    v29 = [v28 UUIDString];

    v30 = [a1 _insertSyndicationAssetIntoPhotoLibrary:v9 uuid:v29 syndicationIdentifier:v11 bundleID:v13 addedDate:v36];
    v27 = v30;
    if (a6 && v30)
    {
      *a6 = 1;
    }
  }

  if (a7)
  {
    v31 = v26;
    *a7 = v26;
  }

  return v27;
}

+ (id)_insertSyndicationAssetIntoPhotoLibrary:(id)a3 uuid:(id)a4 syndicationIdentifier:(id)a5 bundleID:(id)a6 addedDate:(id)a7
{
  v11 = MEMORY[0x1E69BF328];
  v12 = a7;
  v13 = a6;
  v14 = a5;
  v15 = a4;
  v16 = a3;
  LOWORD(v22) = 1;
  v17 = +[PLManagedAsset insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:](PLManagedAsset, "insertAssetIntoPhotoLibrary:mainFileURL:mainFileMetadata:savedAssetType:bundleScope:uuid:replacementUUID:imageSource:imageData:isPlaceholder:deleteFileOnFailure:", v16, 0, 0, [v11 savedAssetTypeForInsertIntoSyndicationLibrary], 3, v15, 0, 0, 0, v22);

  v18 = [v17 additionalAttributes];
  [v18 setSyndicationIdentifier:v14];

  [v17 setBundleScope:3];
  [v17 setSavedAssetType:{objc_msgSend(MEMORY[0x1E69BF328], "savedAssetTypeForInsertIntoSyndicationLibrary")}];
  [v17 setImportedBy:12];
  v19 = [v17 additionalAttributes];
  [v19 setImportedByBundleIdentifier:v13];

  [v17 setAddedDate:v12];
  v20 = [MEMORY[0x1E695DF00] distantPast];
  [v17 setDateCreated:v20];

  return v17;
}

- (BOOL)anyInternalResourceIsLocal
{
  v12 = *MEMORY[0x1E69E9840];
  v7 = 0u;
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v2 = [(PLManagedAsset *)self modernResources];
  v3 = [v2 countByEnumeratingWithState:&v7 objects:v11 count:16];
  if (v3)
  {
    v4 = *v8;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v8 != v4)
        {
          objc_enumerationMutation(v2);
        }

        if ([*(*(&v7 + 1) + 8 * i) isLocallyAvailable])
        {
          LOBYTE(v3) = 1;
          goto LABEL_11;
        }
      }

      v3 = [v2 countByEnumeratingWithState:&v7 objects:v11 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v3;
}

- (id)allRequiredResourcesForCPLDisable
{
  v3 = [(PLManagedAsset *)self hasAdjustments];
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __59__PLManagedAsset_RM_CPL__allRequiredResourcesForCPLDisable__block_invoke;
  v6[3] = &__block_descriptor_33_e28_B16__0__PLInternalResource_8l;
  v7 = v3;
  v4 = [(PLManagedAsset *)self persistedResourcesMatching:v6];

  return v4;
}

- (BOOL)checkAllResourcesRequiredForCPLDisableWithReachableBlock:(id)a3
{
  v38 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self allRequiredResourcesForCPLDisable];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v6 = [v5 countByEnumeratingWithState:&v31 objects:v37 count:16];
  if (!v6)
  {
    v9 = 0;
    goto LABEL_31;
  }

  v8 = v6;
  v9 = 0;
  v10 = *v32;
  v29 = 1;
  *&v7 = 67109378;
  v27 = v7;
  v28 = v4;
  do
  {
    for (i = 0; i != v8; ++i)
    {
      if (*v32 != v10)
      {
        objc_enumerationMutation(v5);
      }

      v12 = *(*(&v31 + 1) + 8 * i);
      v13 = [v12 cplFileURL];
      v14 = v13;
      if (v13)
      {
        v30 = 0;
        v15 = [v13 checkResourceIsReachableAndReturnError:&v30];
        v16 = v30;
        if (v15)
        {
          if (v4)
          {
            v4[2](v4, v14, v12);
          }

          goto LABEL_25;
        }

        if (PLIsErrorFileNotFound())
        {
          if ([v12 cloudLocalState] == 3)
          {
            v29 = 0;
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v19 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
            {
              v20 = v5;
              v21 = v9;
              v22 = [v12 cloudLocalState];
              v23 = [v12 objectID];
              *buf = v27;
              *v36 = v22;
              v9 = v21;
              v5 = v20;
              v4 = v28;
              *&v36[4] = 2114;
              *&v36[6] = v23;
              _os_log_impl(&dword_19BF1F000, v19, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: unreachable resource with cloudLocalState %d, skipping: %{public}@", buf, 0x12u);
            }
          }

          ++v9;
          goto LABEL_25;
        }

        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v17 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
          {
            v18 = [v12 objectID];
            *buf = 138543618;
            *v36 = v18;
            *&v36[8] = 2112;
            *&v36[10] = v16;
            _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: failed for resource: %{public}@, error: %@", buf, 0x16u);
          }

          goto LABEL_19;
        }
      }

      else
      {
        if (*MEMORY[0x1E6994D48])
        {
          goto LABEL_26;
        }

        v16 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
        {
          v17 = [v12 objectID];
          *buf = 138543362;
          *v36 = v17;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: nil fileURL for CPL original resource: %{public}@", buf, 0xCu);
LABEL_19:
        }
      }

LABEL_25:

LABEL_26:
    }

    v8 = [v5 countByEnumeratingWithState:&v31 objects:v37 count:16];
  }

  while (v8);
  if ((v29 & 1) == 0)
  {
    goto LABEL_36;
  }

LABEL_31:
  if (v9 == [v5 count])
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v24 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v24, OS_LOG_TYPE_ERROR, "Check resource availability for iCPL disable: all original resources unavailable, returning NO", buf, 2u);
      }
    }

LABEL_36:
    v25 = 0;
  }

  else
  {
    v25 = 1;
  }

  return v25;
}

- (void)updateSpatialTypeFromAdjustmentRenderTypes:(unsigned int)a3 hasAdjustment:(BOOL)a4 adjustedMediaMetadata:(id)a5
{
  v5 = a4;
  v6 = a3;
  v12 = a5;
  if ([(PLManagedAsset *)self isPhoto])
  {
    if (v5)
    {
      if ((v6 & 0x1000) == 0)
      {
        v8 = self;
        v9 = 0;
LABEL_11:
        [(PLManagedAsset *)v8 setSpatialType:v9];
        goto LABEL_12;
      }

      if (!v12)
      {
        v8 = self;
        v9 = 1;
        goto LABEL_11;
      }

      v10 = [objc_alloc(MEMORY[0x1E69C0718]) initWithImageSourceProxyOrEncodedImagePropertyData:v12 contentType:0 timeZoneLookup:0];
    }

    else
    {
      if (![(PLManagedAsset *)self hasAdjustments])
      {
        goto LABEL_12;
      }

      v10 = [(PLManagedAsset *)self metadataFromMediaPropertiesOrOriginalResource];
    }

    v11 = v10;
    [(PLManagedAsset *)self setSpatialTypeFromMetadata:v10];
  }

LABEL_12:
}

- (id)rm_applyResourcesFromAssetChange:(id)a3 inLibrary:(id)a4
{
  v172 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v136 = a4;
  v138 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v7 = [(PLManagedAsset *)self deferredProcessingNeeded];
  if (v7 <= 0xA && ((0x5F6u >> v7) & 1) != 0)
  {
    if ([(PLManagedAsset *)self hasAdjustments])
    {
      v8 = [(PLManagedAsset *)self adjustmentTimestamp];
      v9 = [v6 recordModificationDate];
      v10 = [v8 compare:v9];

      if (v10 == 1)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v11 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
          {
            v12 = [(PLManagedAsset *)self deferredProcessingNeeded];
            if (v12 > 0xA)
            {
              v13 = 0;
            }

            else
            {
              v13 = off_1E7567B18[v12];
            }

            v132 = v13;
            v133 = [(PLManagedAsset *)self adjustmentTimestamp];
            v134 = [v6 recordModificationDate];
            *buf = 138413058;
            *v167 = v6;
            *&v167[8] = 2112;
            *&v167[10] = v132;
            v168 = 2112;
            v169 = v133;
            v170 = 2112;
            v171 = v134;
            _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Skipping resources change for record %@ because deferred processing is %@, asset adj time %@, record modification time %@", buf, 0x2Au);
          }
        }

        v62 = [v138 copy];
        goto LABEL_184;
      }
    }
  }

  v161 = 0u;
  v162 = 0u;
  v159 = 0u;
  v160 = 0u;
  v14 = [(PLManagedAsset *)self allAssetCPLResources];
  v15 = [v14 countByEnumeratingWithState:&v159 objects:v165 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v160;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v160 != v17)
        {
          objc_enumerationMutation(v14);
        }

        v19 = *(*(&v159 + 1) + 8 * i);
        v20 = [v19 cplType];
        v21 = [v6 resources];
        if (![(PLManagedAsset *)self _isResourceType:v20 inResources:v21])
        {

LABEL_18:
          [(PLManagedAsset *)self removeLocalFileForResource:v19];
          [v19 deleteResource];
          continue;
        }

        v22 = +[PLResourceInstaller isValidCPLResourceTypeForPersistence:](PLResourceInstaller, "isValidCPLResourceTypeForPersistence:", [v19 cplType]);

        if (!v22)
        {
          goto LABEL_18;
        }
      }

      v16 = [v14 countByEnumeratingWithState:&v159 objects:v165 count:16];
    }

    while (v16);
  }

  v139 = [(PLManagedAsset *)self bestResourceTypeForAdjustedStableHash];
  v155 = 0u;
  v156 = 0u;
  v157 = 0u;
  v158 = 0u;
  obj = [v6 resources];
  v145 = v6;
  v150 = self;
  v148 = [obj countByEnumeratingWithState:&v155 objects:v164 count:16];
  if (!v148)
  {
    v141 = 0;
    goto LABEL_53;
  }

  v141 = 0;
  v146 = *v156;
  do
  {
    for (j = 0; j != v148; ++j)
    {
      if (*v156 != v146)
      {
        objc_enumerationMutation(obj);
      }

      v24 = *(*(&v155 + 1) + 8 * j);
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v25 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
        {
          *buf = 138412290;
          *v167 = v24;
          _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_DEBUG, "Asset resource: %@", buf, 0xCu);
        }
      }

      v26 = [v24 resourceType];
      v27 = [(PLManagedAsset *)self assetResourceForCPLType:v26];
      if (v27)
      {
        v28 = self;
        v29 = [v24 identity];
        v30 = [v29 fingerPrint];
        v31 = [v24 identity];
        v32 = [v31 stableHash];
        v33 = [(PLManagedAsset *)v28 fingerprintContext];
        v34 = [v27 isEquivalentToFingerprint:v30 andStableHash:v32 fingerprintContext:v33] ^ 1;

        v6 = v145;
      }

      else
      {
        v34 = 0;
      }

      if (!+[PLResourceInstaller isValidCPLResourceTypeForPersistence:](PLResourceInstaller, "isValidCPLResourceTypeForPersistence:", [v27 cplType]))
      {
        v35 = 0;
        self = v150;
LABEL_48:

        goto LABEL_49;
      }

      self = v150;
      v35 = [(PLManagedAsset *)v150 storedResourceForCPLResource:v24 asset:v150 adjusted:1];

      if (v35)
      {
        if ([v35 isLocallyAvailable])
        {
          if (v34)
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v36 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v36, OS_LOG_TYPE_DEFAULT))
              {
                v37 = [v35 singleLineDescription];
                *buf = 138412546;
                *v167 = v37;
                *&v167[8] = 2112;
                *&v167[10] = v24;
                _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_DEFAULT, "Removing local resource %@ that does not match cloud resource %@", buf, 0x16u);
              }
            }

            [(PLManagedAsset *)v150 removeLocalFileForResource:v35];
            [v35 markAsNotLocallyAvailable];
          }

          else
          {
            [v138 addObject:v35];
          }
        }

        if ([v35 cloudLocalState] != 3)
        {
          [v35 setCloudLocalState:3];
        }

        if (v26 == v139)
        {
          [v24 stableHash];
          v141 = v27 = v141;
          goto LABEL_48;
        }
      }

LABEL_49:
    }

    v148 = [obj countByEnumeratingWithState:&v155 objects:v164 count:16];
  }

  while (v148);
LABEL_53:

  [(PLManagedAsset *)self persistedResourcesWithRecipeID:65937 andVersion:2];
  v151 = 0u;
  v152 = 0u;
  v153 = 0u;
  v38 = v154 = 0u;
  v39 = [v38 countByEnumeratingWithState:&v151 objects:v163 count:16];
  if (v39)
  {
    v40 = v39;
    v41 = *v152;
    do
    {
      for (k = 0; k != v40; ++k)
      {
        if (*v152 != v41)
        {
          objc_enumerationMutation(v38);
        }

        v43 = *(*(&v151 + 1) + 8 * k);
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v44 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v44, OS_LOG_TYPE_DEFAULT))
          {
            *buf = 138412290;
            *v167 = v43;
            _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_DEFAULT, "Removing substandard resource %@", buf, 0xCu);
          }
        }

        [(PLManagedAsset *)v150 removeLocalFileForResource:v43];
        [v43 deleteResource];
      }

      v40 = [v38 countByEnumeratingWithState:&v151 objects:v163 count:16];
    }

    while (v40);
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v45 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v45, OS_LOG_TYPE_DEBUG))
    {
      v46 = [(PLManagedAsset *)v150 orientation];
      v47 = [v6 orientation];
      *buf = 67109376;
      *v167 = v46;
      *&v167[4] = 2048;
      *&v167[6] = v47;
      _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_DEBUG, "Current orientation: %d. AssetChange orientation: %ld", buf, 0x12u);
    }
  }

  v48 = [(PLManagedAsset *)v150 orientation];
  if ([v6 orientation] != v48)
  {
    -[PLManagedAsset setOrientation:](v150, "setOrientation:", [v6 orientation]);
  }

  [(PLManagedAsset *)v150 duration];
  v50 = (v49 * 1000.0);
  v51 = [v6 duration];
  if (v51 != v50)
  {
    v52 = v51;
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v53 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v53, OS_LOG_TYPE_DEBUG))
      {
        *buf = 134218240;
        *v167 = v50;
        *&v167[8] = 2048;
        *&v167[10] = v52;
        _os_log_impl(&dword_19BF1F000, v53, OS_LOG_TYPE_DEBUG, "Current duration: %ld. AssetChange duration: %ld", buf, 0x16u);
      }
    }

    [(PLManagedAsset *)v150 setDuration:v52 / 1000.0];
  }

  v54 = [v6 originalChoice];
  if (v54 != [(PLManagedAsset *)v150 originalResourceChoice])
  {
    [(PLManagedAsset *)v150 setOriginalResourceChoice:v54];
  }

  v55 = [v6 adjustedMediaMetaDataType];
  v56 = [v6 adjustedMediaMetaData];
  v57 = [(PLManagedAsset *)v150 additionalAttributes];
  [v57 setMediaMetadataType:v55];

  v58 = [(PLManagedAsset *)v150 additionalAttributes];
  [v58 setMediaMetadataData:v56];

  v59 = [(PLManagedAsset *)v150 additionalAttributes];
  v60 = [v59 adjustedStableHash];

  v61 = v141;
  if (v141 && [v141 isEqualToString:v60])
  {
    v62 = v138;
    goto LABEL_183;
  }

  v63 = [v6 adjustments];
  v64 = v63;
  if (v63)
  {
    v65 = [v63 adjustmentType];

    if (v65)
    {
      v149 = [v64 simpleAdjustmentData];

      v147 = [v64 adjustmentCompoundVersion];

      v142 = [v64 adjustmentCreatorCode];

      obja = [v64 adjustmentTimestamp];

      v66 = -[PLManagedAsset _plAdjustmentBaseVersionFromCPLAdjustmentSourceType:](v150, "_plAdjustmentBaseVersionFromCPLAdjustmentSourceType:", [v64 adjustmentSourceType]);
      v67 = [v64 adjustmentRenderTypes];
      v68 = 1;
      [(PLManagedAsset *)v150 updateSpatialTypeFromAdjustmentRenderTypes:v67 hasAdjustment:1 adjustedMediaMetadata:v56];
      if (*MEMORY[0x1E6994D48])
      {
        goto LABEL_95;
      }

      goto LABEL_86;
    }
  }

  [(PLManagedAsset *)v150 updateSpatialTypeFromAdjustmentRenderTypes:0 hasAdjustment:0 adjustedMediaMetadata:v56];
  v67 = 0;
  obja = 0;
  v68 = 0;
  v65 = 0;
  v149 = 0;
  v142 = 0;
  v66 = 0;
  v147 = @"0";
  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
LABEL_86:
    v69 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v69, OS_LOG_TYPE_DEBUG))
    {
      v70 = @"NO";
      if (v68)
      {
        v70 = @"YES";
      }

      *buf = 138412290;
      *v167 = v70;
      _os_log_impl(&dword_19BF1F000, v69, OS_LOG_TYPE_DEBUG, "has adjustment: %@", buf, 0xCu);
    }

    if (v68)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v71 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v71, OS_LOG_TYPE_DEFAULT))
        {
          v72 = [(PLManagedAsset *)v150 uuid];
          *buf = 138543874;
          *v167 = v65;
          *&v167[8] = 2114;
          *&v167[10] = v147;
          v168 = 2114;
          v169 = v72;
          _os_log_impl(&dword_19BF1F000, v71, OS_LOG_TYPE_DEFAULT, "Setting adjustment type: %{public}@ version: %{public}@ to asset %{public}@", buf, 0x20u);
        }
      }

LABEL_95:
      if (!v149)
      {
        v73 = [(PLManagedAsset *)v150 assetResourceForCPLType:13];
        v74 = [v73 cplFileURL];
        if (v74 && [v73 isLocallyAvailable])
        {
          v149 = [objc_alloc(MEMORY[0x1E695DEF0]) initWithContentsOfURL:v74];
        }

        else
        {
          v149 = 0;
        }
      }
    }
  }

  v75 = objc_alloc(MEMORY[0x1E69C0660]);
  v76 = [PLManagedAsset pfAdjustmentsBaseVersionFromAdjustmentBaseVersion:v66];
  v137 = v65;
  v77 = v142;
  v78 = [v75 initWithFormatIdentifier:v65 formatVersion:v147 data:v149 baseVersion:v76 editorBundleID:v142 renderTypes:v67];
  v79 = +[PLAssetAdjustmentOptions assetAdjustmentOptionsForApplyingResourcesFromCPL];
  v80 = v150;
  v135 = v78;
  [(PLManagedAsset *)v150 setAdjustments:v78 options:v79];

  v81 = [(PLManagedAsset *)v150 additionalAttributes];
  v82 = [v81 unmanagedAdjustment];

  v140 = v82;
  if (v82)
  {
    if (obja)
    {
      [v82 setAdjustmentTimestamp:?];
    }

    v80 = v150;
    if ([(PLManagedAsset *)v150 isVideo]|| [(PLManagedAsset *)v150 isPhotoIris])
    {
      [(PLManagedAsset *)v150 setPlaybackVariationAndLoopingStyleFromAdjustmentRenderTypes:v67];
    }

    if ([(PLManagedAsset *)v150 isPhoto])
    {
      [(PLManagedAsset *)v150 setDepthTypeFromAdjustmentRenderTypes:v67];
    }

    [(PLManagedAsset *)v150 setCameraProcessingAdjustmentStateFromAdjustmentRenderTypes:v67];
  }

  if ([(PLManagedAsset *)v80 hasAdjustments])
  {
    v83 = [(PLManagedAsset *)v80 additionalAttributes];
    v84 = [v83 mediaMetadata];

    if (!v84)
    {
      v85 = [(PLManagedAsset *)v80 additionalAttributes];
      [v85 setMediaMetadataData:v56];
    }
  }

  v86 = [(PLManagedAsset *)v80 additionalAttributes];
  [v86 setAdjustedStableHash:v141];

  v87 = [v145 recordModificationDate];
  [(PLManagedAsset *)v80 setModificationDate:v87];

  if ([(PLManagedAsset *)v80 hasNonSlomoAdjustments])
  {
    if ([(PLManagedAsset *)v80 isVideo])
    {
      v88 = 16;
      goto LABEL_116;
    }

    v107 = [(PLManagedAsset *)v80 assetResourceForCPLType:2];
    if (v107 || ([(PLManagedAsset *)v80 assetResourceForCPLType:4], (v107 = objc_claimAutoreleasedReturnValue()) != 0))
    {
      v90 = v107;
      v61 = v141;
LABEL_140:
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v108 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v108, OS_LOG_TYPE_DEBUG))
        {
          v109 = [v90 singleLineDescription];
          *buf = 138412290;
          *v167 = v109;
          _os_log_impl(&dword_19BF1F000, v108, OS_LOG_TYPE_DEBUG, "Updating asset width/height from resource %@", buf, 0xCu);
        }
      }

      v110 = [v90 unorientedWidth];
      if (v110 < 1)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v120 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v120, OS_LOG_TYPE_ERROR))
          {
            [v90 singleLineDescription];
            v121 = v60;
            v123 = v122 = v55;
            *buf = 134218242;
            *v167 = v110;
            *&v167[8] = 2112;
            *&v167[10] = v123;
            _os_log_impl(&dword_19BF1F000, v120, OS_LOG_TYPE_ERROR, "Invalid width %lld from resource %@", buf, 0x16u);

            v55 = v122;
            v60 = v121;
            v77 = v142;
          }
        }

        v124 = [v90 unorientedHeight];
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v125 = v124;
          v126 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v126, OS_LOG_TYPE_ERROR))
          {
            [v90 singleLineDescription];
            v127 = v60;
            v129 = v128 = v55;
            *buf = 134218242;
            *v167 = v125;
            *&v167[8] = 2112;
            *&v167[10] = v129;
            _os_log_impl(&dword_19BF1F000, v126, OS_LOG_TYPE_ERROR, "Invalid height %lld from resource %@", buf, 0x16u);

            v55 = v128;
            v60 = v127;
            v77 = v142;
          }
        }
      }

      else
      {
        v111 = v150;
        if ([(PLManagedAsset *)v150 width]!= v110)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v112 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v112, OS_LOG_TYPE_DEBUG))
            {
              v113 = [(PLManagedAsset *)v150 width];
              *buf = 134218240;
              *v167 = v113;
              *&v167[8] = 2048;
              *&v167[10] = v110;
              _os_log_impl(&dword_19BF1F000, v112, OS_LOG_TYPE_DEBUG, "Setting asset width from %lld to %lld", buf, 0x16u);
            }
          }

          v111 = v150;
          [(PLManagedAsset *)v150 setWidth:v110];
        }

        v114 = [v90 unorientedHeight];
        if ([(PLManagedAsset *)v111 height]!= v114)
        {
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v115 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v115, OS_LOG_TYPE_DEBUG))
            {
              v116 = [(PLManagedAsset *)v150 height];
              *buf = 134218240;
              *v167 = v116;
              *&v167[8] = 2048;
              *&v167[10] = v114;
              _os_log_impl(&dword_19BF1F000, v115, OS_LOG_TYPE_DEBUG, "Setting asset height from %lld to %lld", buf, 0x16u);
            }
          }

          [(PLManagedAsset *)v150 setHeight:v114];
        }
      }

      v130 = [v90 uniformTypeIdentifier];
      v99 = [v130 identifier];

      if (v99)
      {
        if ((*MEMORY[0x1E6994D48] & 1) == 0)
        {
          v100 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v100, OS_LOG_TYPE_DEFAULT))
          {
            [v90 singleLineDescription];
            v101 = v60;
            v103 = v102 = v55;
            *buf = 138412546;
            *v167 = v99;
            *&v167[8] = 2112;
            *&v167[10] = v103;
            v104 = "Setting uti to %@ from %@ due to adjustment";
            v105 = v100;
            v106 = OS_LOG_TYPE_DEFAULT;
LABEL_172:
            _os_log_impl(&dword_19BF1F000, v105, v106, v104, buf, 0x16u);

            v55 = v102;
            v60 = v101;
            v77 = v142;
          }

          goto LABEL_173;
        }

        goto LABEL_174;
      }

      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v117 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v117, OS_LOG_TYPE_ERROR))
        {
          v118 = [v90 singleLineDescription];
          *buf = 138412290;
          *v167 = v118;
          v119 = "Resource %@ is missing uti";
LABEL_178:
          _os_log_impl(&dword_19BF1F000, v117, OS_LOG_TYPE_ERROR, v119, buf, 0xCu);

          v61 = v141;
        }

        goto LABEL_179;
      }

      goto LABEL_180;
    }

    v88 = 5;
LABEL_116:
    v61 = v141;
    v89 = [(PLManagedAsset *)v150 assetResourceForCPLType:v88];
    if (v89)
    {
      v90 = v89;
      goto LABEL_140;
    }

    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v90 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v90, OS_LOG_TYPE_ERROR))
      {
        *buf = 0;
        _os_log_impl(&dword_19BF1F000, v90, OS_LOG_TYPE_ERROR, "Did not find derivative resource to update asset size with, asset dimensions may be incorrect", buf, 2u);
      }

      goto LABEL_181;
    }
  }

  else
  {
    v61 = v141;
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v91 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v91, OS_LOG_TYPE_DEBUG))
      {
        v92 = [(PLManagedAsset *)v150 _compactDebugDescription];
        *buf = 138412290;
        *v167 = v92;
        _os_log_impl(&dword_19BF1F000, v91, OS_LOG_TYPE_DEBUG, "Setting original size for asset %@", buf, 0xCu);
      }
    }

    v93 = [(PLManagedAsset *)v150 originalWidth];
    v94 = [(PLManagedAsset *)v150 originalHeight];
    if (v93 >= 1 && v94 >= 1)
    {
      v95 = v94;
      v96 = [(PLManagedAsset *)v150 originalOrientation]- 5;
      if (v96 >= 4)
      {
        v97 = v93;
      }

      else
      {
        v97 = v95;
      }

      if (v96 < 4)
      {
        v95 = v93;
      }

      if (v97 != [(PLManagedAsset *)v150 width])
      {
        [(PLManagedAsset *)v150 setWidth:v97];
      }

      if (v95 != [(PLManagedAsset *)v150 height])
      {
        [(PLManagedAsset *)v150 setHeight:v95];
      }
    }

    v90 = [(PLManagedAsset *)v150 masterResourceForCPLType:1];
    v98 = [v90 uniformTypeIdentifier];
    v99 = [v98 identifier];

    if (v99)
    {
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v100 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v100, OS_LOG_TYPE_DEBUG))
        {
          [v90 singleLineDescription];
          v101 = v60;
          v103 = v102 = v55;
          *buf = 138412546;
          *v167 = v99;
          *&v167[8] = 2112;
          *&v167[10] = v103;
          v104 = "Setting uti to %@ from %@";
          v105 = v100;
          v106 = OS_LOG_TYPE_DEBUG;
          goto LABEL_172;
        }

LABEL_173:
      }

LABEL_174:
      [(PLManagedAsset *)v150 setUniformTypeIdentifier:v99];
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v117 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v117, OS_LOG_TYPE_ERROR))
      {
        v118 = [v90 singleLineDescription];
        *buf = 138412290;
        *v167 = v118;
        v119 = "Original resource %@ is missing uti";
        goto LABEL_178;
      }

LABEL_179:
    }

LABEL_180:

LABEL_181:
  }

  v62 = [v138 copy];

  v6 = v145;
LABEL_183:

LABEL_184:

  return v62;
}

- (void)rm_createAssetResourcesForCPLResources:(id)a3 inLibrary:(id)a4
{
  v42 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v26 = a4;
  v28 = self;
  v7 = [(PLManagedAsset *)self bestResourceTypeForAdjustedStableHash];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  obj = v6;
  v8 = [obj countByEnumeratingWithState:&v31 objects:v41 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = 0;
    v11 = MEMORY[0x1E6994D48];
    v30 = *v32;
    v12 = v28;
    while (1)
    {
      v13 = 0;
      v27 = v9;
      do
      {
        if (*v32 != v30)
        {
          objc_enumerationMutation(obj);
        }

        v14 = *(*(&v31 + 1) + 8 * v13);
        v15 = [v14 resourceType];
        v16 = [(PLManagedAsset *)v12 assetResourceForCPLType:v15];
        if (v16)
        {
          if (*v11)
          {
            goto LABEL_15;
          }

          v17 = __CPLAssetsdOSLogDomain();
          if (!os_log_type_enabled(v17, OS_LOG_TYPE_DEFAULT))
          {
            goto LABEL_14;
          }

          [v16 singleLineDescription];
          v18 = v11;
          v19 = v10;
          v21 = v20 = v7;
          v22 = [(PLManagedAsset *)v12 cloudAssetGUID];
          *buf = 138412802;
          v36 = v14;
          v37 = 2112;
          v38 = v21;
          v39 = 2112;
          v40 = v22;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEFAULT, "Applying properties from CPLResource %@ to local cloudResource %@ for asset %@", buf, 0x20u);

          v7 = v20;
          v10 = v19;
          v11 = v18;
          v9 = v27;
          goto LABEL_13;
        }

        if (*v11)
        {
          goto LABEL_15;
        }

        v17 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
        {
          v22 = [(PLManagedAsset *)v12 cloudAssetGUID];
          *buf = 138412546;
          v36 = 0;
          v37 = 2112;
          v38 = v22;
          _os_log_impl(&dword_19BF1F000, v17, OS_LOG_TYPE_DEBUG, "Created new cloudResource %@ for asset %@", buf, 0x16u);
LABEL_13:

          v12 = v28;
        }

LABEL_14:

LABEL_15:
        v23 = [(PLManagedAsset *)v12 storedResourceForCPLResource:v14 asset:v12 adjusted:1];
        if (v15 == v7)
        {
          v24 = [v14 stableHash];

          v10 = v24;
        }

        ++v13;
      }

      while (v9 != v13);
      v9 = [obj countByEnumeratingWithState:&v31 objects:v41 count:16];
      if (!v9)
      {
        goto LABEL_21;
      }
    }
  }

  v10 = 0;
  v12 = self;
LABEL_21:

  v25 = [(PLManagedAsset *)v12 additionalAttributes];
  [v25 setAdjustedStableHash:v10];
}

- (id)rm_cplExpungeableMasterResourceStates
{
  v18 = *MEMORY[0x1E69E9840];
  v2 = [(PLManagedAsset *)self allMasterCPLResources];
  v3 = [MEMORY[0x1E695DF70] array];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = v2;
  v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v14;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v14 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v13 + 1) + 8 * i);
        if ([v9 supportsTrashedState])
        {
          v10 = [v9 expungeableResourceStateRepresentation];
          [v3 addObject:v10];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v6);
  }

  v11 = [v3 copy];

  return v11;
}

- (id)rm_cplMasterResourcesFromCloudMaster:(id)a3 addOriginalResourceMode:(BOOL)a4
{
  v4 = a4;
  v55 = *MEMORY[0x1E69E9840];
  v40 = a3;
  v6 = [MEMORY[0x1E696AC08] defaultManager];
  v41 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v7 = [(PLManagedAsset *)self mainFileURL];
  v39 = self;
  v8 = [(PLManagedAsset *)self master];
  LODWORD(self) = [v8 placeholderState];

  v42 = self;
  v33 = v7;
  v35 = v6;
  if (self == 1)
  {
    v9 = 0;
  }

  else
  {
    v10 = [v7 path];
    v9 = [v6 fileExistsAtPath:v10];
  }

  if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v11 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      v12 = @"NO";
      if (v9)
      {
        v12 = @"YES";
      }

      *buf = 138412290;
      v49 = v12;
      _os_log_impl(&dword_19BF1F000, v11, OS_LOG_TYPE_DEFAULT, "Reusing existing cloud resources, canGenerateDerivative: %@", buf, 0xCu);
    }
  }

  v38 = [v40 fingerprintScheme];
  v44 = 0u;
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v13 = [(PLManagedAsset *)v39 modernResources];
  v14 = [v13 countByEnumeratingWithState:&v44 objects:v54 count:16];
  if (v14)
  {
    v15 = v14;
    v16 = *v45;
    do
    {
      v17 = 0;
      v18 = v41;
      do
      {
        if (*v45 != v16)
        {
          objc_enumerationMutation(v13);
        }

        v19 = *(*(&v44 + 1) + 8 * v17);
        if ([(__CFString *)v19 isCPLMasterResource])
        {
          if (v4 && ![(__CFString *)v19 cloudLocalState]&& [(__CFString *)v19 isCPLOriginalResource]&& [(__CFString *)v19 isLocallyAvailable])
          {
            if ((*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v20 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
              {
                *buf = 138412290;
                v49 = v19;
                _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEFAULT, "addOriginalResourceMode, including file for cplResource: %@", buf, 0xCu);
              }
            }

            v21 = objc_opt_class();
            v22 = [(__CFString *)v19 cplType];
            v23 = [(__CFString *)v19 fileURL];
            v43 = 0;
            LOBYTE(v21) = [(PLManagedAsset *)v39 setFingerprintAndStableHashOnInternalResource:v19 recordClass:v21 resourceType:v22 resourceFileURL:v23 fingerprintScheme:v38 error:&v43];
            v24 = v43;

            v18 = v41;
            if ((v21 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
            {
              v25 = __CPLAssetsdOSLogDomain();
              if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
              {
                v37 = [(__CFString *)v19 fileURL];
                v26 = [v37 path];
                v36 = [(PLManagedAsset *)v39 scopedIdentifier];
                *buf = 138412802;
                v49 = v26;
                v50 = 2112;
                v51 = v36;
                v52 = 2112;
                v53 = v24;
                _os_log_impl(&dword_19BF1F000, v25, OS_LOG_TYPE_ERROR, "Failed to generate fingerprint for path %@ uuid %@. Error: %@", buf, 0x20u);

                v18 = v41;
              }
            }

            v27 = 1;
          }

          else
          {
            v27 = 0;
          }

          v28 = [(__CFString *)v19 cplResourceIncludeFile:v27];
          v29 = v28;
          if (v28)
          {
            if (v27)
            {
              [v28 setCanGenerateDerivative:v9];
              [(__CFString *)v19 setRemoteAvailability:1];
            }

            else
            {
              [v28 setCanGenerateDerivative:!v4 & v9];
            }

            if (v42 == 1)
            {
              [v29 setSourceResourceType:{-[__CFString cloudSourceType](v19, "cloudSourceType")}];
            }

            [v18 addObject:v29];
          }

          else if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v30 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
            {
              v31 = [v40 scopedIdentifier];
              *buf = 138412546;
              v49 = v19;
              v50 = 2112;
              v51 = v31;
              _os_log_impl(&dword_19BF1F000, v30, OS_LOG_TYPE_ERROR, "Unable to create CPLResource from %@ with scopedIdentifier %@", buf, 0x16u);

              v18 = v41;
            }
          }
        }

        ++v17;
      }

      while (v15 != v17);
      v15 = [v13 countByEnumeratingWithState:&v44 objects:v54 count:16];
    }

    while (v15);
  }

  return v41;
}

- (id)rm_cplMasterResourceForResourceType:(unint64_t)a3
{
  v15 = *MEMORY[0x1E69E9840];
  v5 = [(PLManagedAsset *)self masterResourceForCPLType:?];
  v6 = v5;
  if (v5)
  {
    v7 = [v5 cplResourceIncludeFile:1];
  }

  else
  {
    if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v8 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
      {
        v9 = [MEMORY[0x1E6994B90] descriptionForResourceType:a3];
        v11 = 138412546;
        v12 = v9;
        v13 = 2112;
        v14 = self;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_DEBUG, "Unable to find master resource %@ in asset %@", &v11, 0x16u);
      }
    }

    v7 = 0;
  }

  return v7;
}

- (id)rm_cplResourceForResourceType:(unint64_t)a3
{
  v5 = [(PLManagedAsset *)self assetResourceForCPLType:?];
  v6 = v5;
  if (v5)
  {
    [v5 cplResourceIncludeFile:1];
  }

  else
  {
    [(PLManagedAsset *)self rm_cplMasterResourceForResourceType:a3];
  }
  v7 = ;

  return v7;
}

- (void)_rm_insertResource:(id)a3 forOtherDuplicatedAssetInMaster:(id)a4 inPhotoLibrary:(id)a5
{
  v36 = *MEMORY[0x1E69E9840];
  v7 = a3;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  v28 = 0u;
  v24 = a4;
  obj = [v24 assets];
  v8 = [obj countByEnumeratingWithState:&v25 objects:v35 count:16];
  if (v8)
  {
    v10 = v8;
    v11 = *v26;
    *&v9 = 138412802;
    v22 = v9;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v26 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v25 + 1) + 8 * i);
        v14 = [v13 uuid];
        v15 = [(PLManagedAsset *)self uuid];
        v16 = [v14 isEqualToString:v15];

        if ((v16 & 1) == 0)
        {
          v17 = [v13 _rm_localResourceURLForResource:v7];
          v18 = [v7 validatedExternalResourceRepresentationUsingFileURL:v17];
          [PLManagedAsset _rm_copyResourceFileFrom:v7 to:v18 forCloudMaster:v24 andAsset:v13];
          v19 = [(PLManagedAsset *)self storedResourceForExternalResource:v18 asset:v13];
          if ((*MEMORY[0x1E6994D48] & 1) == 0)
          {
            v20 = __CPLAssetsdOSLogDomain();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_DEFAULT))
            {
              v21 = [v13 uuid];
              *buf = v22;
              v30 = v19;
              v31 = 2112;
              v32 = v24;
              v33 = 2112;
              v34 = v21;
              _os_log_impl(&dword_19BF1F000, v20, OS_LOG_TYPE_DEFAULT, "Creating new internalResource %@ for master %@ (asset: %@)", buf, 0x20u);
            }
          }
        }
      }

      v10 = [obj countByEnumeratingWithState:&v25 objects:v35 count:16];
    }

    while (v10);
  }
}

- (id)_rm_localResourceURLForResource:(id)a3
{
  v3 = [(PLManagedAsset *)self localResourcePathForMasterResource:a3];
  if (v3)
  {
    v4 = [MEMORY[0x1E695DFF8] fileURLWithPath:v3 isDirectory:0];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)rm_createMasterResourcesForCPLResources:(id)a3 master:(id)a4 inLibrary:(id)a5
{
  v46 = *MEMORY[0x1E69E9840];
  v7 = a3;
  v8 = a4;
  v29 = a5;
  v40 = 0u;
  v41 = 0u;
  v42 = 0u;
  v43 = 0u;
  obj = v7;
  v9 = [obj countByEnumeratingWithState:&v40 objects:v45 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v41;
    v30 = *v41;
    v31 = v8;
    do
    {
      v12 = 0;
      v32 = v10;
      do
      {
        if (*v41 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v40 + 1) + 8 * v12);
        v14 = objc_autoreleasePoolPush();
        v15 = [v8 rm_assetAttachedResourcesForResourceType:{objc_msgSend(v13, "resourceType")}];
        if ([v15 count])
        {
          v38 = 0u;
          v39 = 0u;
          v36 = 0u;
          v37 = 0u;
          v16 = v15;
          v17 = [v16 countByEnumeratingWithState:&v36 objects:v44 count:16];
          if (v17)
          {
            v18 = v17;
            v19 = *v37;
            do
            {
              for (i = 0; i != v18; ++i)
              {
                if (*v37 != v19)
                {
                  objc_enumerationMutation(v16);
                }

                v21 = *(*(&v36 + 1) + 8 * i);
                v22 = [v21 asset];

                if (v22)
                {
                  v23 = [v21 asset];
                  v24 = [v21 asset];
                  v25 = [v23 storedResourceForCPLResource:v13 asset:v24 adjusted:0];
                }
              }

              v18 = [v16 countByEnumeratingWithState:&v36 objects:v44 count:16];
            }

            while (v18);
            v11 = v30;
            v8 = v31;
            v10 = v32;
          }
        }

        else
        {
          v16 = [(PLManagedAsset *)self storedResourceForCPLResource:v13 asset:self adjusted:0];
          [(PLManagedAsset *)self _rm_insertResource:v16 forOtherDuplicatedAssetInMaster:v8 inPhotoLibrary:v29];
        }

        objc_autoreleasePoolPop(v14);
        ++v12;
      }

      while (v12 != v10);
      v10 = [obj countByEnumeratingWithState:&v40 objects:v45 count:16];
    }

    while (v10);
  }

  v26 = [v8 rm_assetUUIDToAssetAttachedResources];
  v34[0] = MEMORY[0x1E69E9820];
  v34[1] = 3221225472;
  v34[2] = __83__PLManagedAsset_RM_CPL__rm_createMasterResourcesForCPLResources_master_inLibrary___block_invoke;
  v34[3] = &unk_1E7576760;
  v35 = v29;
  v27 = v29;
  [v26 enumerateKeysAndObjectsUsingBlock:v34];
}

void __83__PLManagedAsset_RM_CPL__rm_createMasterResourcesForCPLResources_master_inLibrary___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v21 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 indexOfObjectPassingTest:&__block_literal_global_108441];
  if (v5 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v6 = [v4 objectAtIndexedSubscript:v5];
    [v6 setRemoteAvailability:1];
    v7 = [v4 indexOfObjectPassingTest:&__block_literal_global_51_108442];
    if (v7 != 0x7FFFFFFFFFFFFFFFLL)
    {
      v8 = [v4 objectAtIndexedSubscript:v7];
      v9 = [v8 fileURL];
      v10 = MEMORY[0x1E6994D48];
      if (v9)
      {
        v11 = [MEMORY[0x1E696AC08] defaultManager];
        v16 = 0;
        [v11 removeItemAtURL:v9 error:&v16];
        v12 = v16;

        if ((*v10 & 1) == 0)
        {
          v13 = __CPLAssetsdOSLogDomain();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412546;
            v18 = v9;
            v19 = 2112;
            v20 = v12;
            _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Removing %@ error: %@", buf, 0x16u);
          }
        }
      }

      if ((*v10 & 1) == 0)
      {
        v14 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v14, OS_LOG_TYPE_DEFAULT))
        {
          *buf = 138412290;
          v18 = v8;
          _os_log_impl(&dword_19BF1F000, v14, OS_LOG_TYPE_DEFAULT, "Deleting %@", buf, 0xCu);
        }
      }

      v15 = [*(a1 + 32) managedObjectContext];
      [v15 deleteObject:v8];
    }
  }
}

- (void)rm_createMasterResourcesIn:(id)a3 inManagedObjectContext:(id)a4
{
  v18 = *MEMORY[0x1E69E9840];
  v6 = a3;
  [(PLManagedAsset *)self rm_createNewResourcesIn:v6 inManagedObjectContext:a4];
  v7 = [(PLManagedAsset *)self masterResourceForCPLType:1];
  v8 = v7;
  if (v7)
  {
    v9 = [v7 unorientedWidth];
    v10 = [v8 unorientedHeight];
    [(PLManagedAsset *)self setOriginalWidth:v9];
    [(PLManagedAsset *)self setOriginalHeight:v10];
    if (![(PLManagedAsset *)self hasAdjustments]|| ![(PLManagedAsset *)self width]&& ![(PLManagedAsset *)self height])
    {
      v11 = [(PLManagedAsset *)self originalOrientation]- 5;
      if (v11 >= 4)
      {
        v12 = v9;
      }

      else
      {
        v12 = v10;
      }

      if (v11 >= 4)
      {
        v9 = v10;
      }

      if (v12 != [(PLManagedAsset *)self width])
      {
        [(PLManagedAsset *)self setWidth:v12];
      }

      if (v9 != [(PLManagedAsset *)self height])
      {
        [(PLManagedAsset *)self setHeight:v9];
      }
    }

    -[PLManagedAsset setOriginalFilesize:](self, "setOriginalFilesize:", [v8 dataLength]);
  }

  else if ((*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v13 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      v14 = 138412546;
      v15 = v6;
      v16 = 2112;
      v17 = self;
      _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "Unable to find original resource in cloudMaster %@ for asset %@", &v14, 0x16u);
    }
  }
}

- (BOOL)rm_createNewResourcesIn:(id)a3 inManagedObjectContext:(id)a4
{
  v73 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [v6 modernResources];
  v9 = [v8 copy];

  if (![v9 count])
  {
    v19 = [(PLManagedAsset *)self uuid];
    v25 = [v6 rm_assetUUIDToAssetAttachedResources];
    if (![v25 count])
    {
      if (*MEMORY[0x1E6994D48])
      {
        v24 = 0;
        goto LABEL_43;
      }

      v28 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v67 = v6;
        v68 = 2112;
        v69 = self;
        _os_log_impl(&dword_19BF1F000, v28, OS_LOG_TYPE_ERROR, "No resources at all for cloudMaster %@, unable to create master resources for asset %@", buf, 0x16u);
      }

      v24 = 0;
LABEL_42:

LABEL_43:
      goto LABEL_44;
    }

    v26 = objc_alloc(MEMORY[0x1E695DFA8]);
    v27 = [v25 allKeys];
    v28 = [v26 initWithArray:v27];

    [v28 removeObject:v19];
    v29 = [v28 anyObject];
    v30 = [v25 objectForKey:v29];
    v31 = [v30 count];
    v24 = v31 != 0;
    v52 = v30;
    if (v31)
    {
      v49 = v29;
      v50 = v28;
      v51 = v9;
      v32 = v6;
      v33 = [v25 objectForKeyedSubscript:v19];
      v34 = [v33 count];
      v35 = [v30 count];

      if (v34 < v35)
      {
        v56 = 0u;
        v57 = 0u;
        v54 = 0u;
        v55 = 0u;
        obj = v30;
        v36 = [obj countByEnumeratingWithState:&v54 objects:v70 count:16];
        if (v36)
        {
          v37 = v36;
          v47 = v24;
          v48 = v25;
          v38 = *v55;
          do
          {
            for (i = 0; i != v37; ++i)
            {
              if (*v55 != v38)
              {
                objc_enumerationMutation(obj);
              }

              v40 = *(*(&v54 + 1) + 8 * i);
              v41 = [(PLManagedAsset *)self _rm_localResourceURLForResource:v40];
              v42 = [v40 validatedExternalResourceRepresentationUsingFileURL:v41];
              [PLManagedAsset _rm_copyResourceFileFrom:v40 to:v42 forCloudMaster:v32 andAsset:self];
              v43 = [(PLManagedAsset *)self storedResourceForExternalResource:v42 asset:self];
            }

            v37 = [obj countByEnumeratingWithState:&v54 objects:v70 count:16];
          }

          while (v37);
          v6 = v32;
          v28 = v50;
          v9 = v51;
          v25 = v48;
          v24 = v47;
        }

        else
        {
          v6 = v32;
          v28 = v50;
          v9 = v51;
        }

        v29 = v49;
        v44 = obj;
LABEL_40:

        goto LABEL_41;
      }

      v6 = v32;
      v28 = v50;
      v9 = v51;
      v29 = v49;
      if ((*MEMORY[0x1E6994D48] & 1) == 0)
      {
        v44 = __CPLAssetsdOSLogDomain();
        if (os_log_type_enabled(v44, OS_LOG_TYPE_DEFAULT))
        {
          v45 = [(PLManagedAsset *)self uuid];
          *buf = 138412290;
          v67 = v45;
          _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_DEFAULT, "Already have master resources for asset %@", buf, 0xCu);
        }

        goto LABEL_40;
      }
    }

    else if ((*MEMORY[0x1E6994D48] & 1) == 0)
    {
      v44 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v67 = v6;
        v68 = 2112;
        v69 = self;
        _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "No resources on other assets for cloudMaster %@, unable to create master resources for asset %@", buf, 0x16u);
      }

      goto LABEL_40;
    }

LABEL_41:

    goto LABEL_42;
  }

  v64 = 0u;
  v65 = 0u;
  v62 = 0u;
  v63 = 0u;
  v10 = v9;
  v11 = [v10 countByEnumeratingWithState:&v62 objects:v72 count:16];
  if (v11)
  {
    v12 = v11;
    v13 = *v63;
    do
    {
      for (j = 0; j != v12; ++j)
      {
        if (*v63 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v62 + 1) + 8 * j);
        v16 = [(PLManagedAsset *)self _rm_localResourceURLForResource:v15];
        v17 = [v15 validatedExternalResourceRepresentationUsingFileURL:v16];
        v18 = [(PLManagedAsset *)self storedResourceForExternalResource:v17 asset:self];
      }

      v12 = [v10 countByEnumeratingWithState:&v62 objects:v72 count:16];
    }

    while (v12);
  }

  v60 = 0u;
  v61 = 0u;
  v58 = 0u;
  v59 = 0u;
  v19 = v10;
  v20 = [v19 countByEnumeratingWithState:&v58 objects:v71 count:16];
  if (v20)
  {
    v21 = v20;
    v22 = *v59;
    do
    {
      for (k = 0; k != v21; ++k)
      {
        if (*v59 != v22)
        {
          objc_enumerationMutation(v19);
        }

        [v7 deleteObject:*(*(&v58 + 1) + 8 * k)];
      }

      v21 = [v19 countByEnumeratingWithState:&v58 objects:v71 count:16];
    }

    while (v21);
  }

  v24 = 1;
LABEL_44:

  return v24;
}

- (id)storedResourceForExternalResource:(id)a3 asset:(id)a4
{
  v20 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = [v6 assetID];
  v8 = [v7 libraryID];
  v9 = [PLResourceDataStoreManager storeForExternalResource:v5 inLibraryWithID:v8];

  v14 = 0;
  v15 = 0;
  LOBYTE(v7) = [v9 storeExternalResource:v5 forAsset:v6 options:0 error:&v15 resultingResource:&v14];

  v10 = v15;
  v11 = v14;
  if ((v7 & 1) == 0 && (*MEMORY[0x1E6994D48] & 1) == 0)
  {
    v12 = __CPLAssetsdOSLogDomain();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v17 = v5;
      v18 = 2112;
      v19 = v10;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_ERROR, "Failed to store external resource %@, reason: %@", buf, 0x16u);
    }
  }

  return v11;
}

- (id)storedResourceForCPLResource:(id)a3 asset:(id)a4 adjusted:(BOOL)a5
{
  v5 = a5;
  v8 = a4;
  v9 = [PLResourceInstaller generateExternalResourceFromCPLResource:a3 asset:v8 fromAdjustedSet:v5];
  v10 = [(PLManagedAsset *)self storedResourceForExternalResource:v9 asset:v8];

  return v10;
}

- (BOOL)hasAdjustedCPLThumbResource
{
  v13 = *MEMORY[0x1E69E9840];
  v8 = 0u;
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v2 = [(PLManagedAsset *)self modernResources];
  v3 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
  if (v3)
  {
    v4 = *v9;
    while (2)
    {
      for (i = 0; i != v3; ++i)
      {
        if (*v9 != v4)
        {
          objc_enumerationMutation(v2);
        }

        v6 = *(*(&v8 + 1) + 8 * i);
        if ([v6 cplType] == 5 && (objc_msgSend(v6, "isAdjustedResource") & 1) != 0)
        {
          LOBYTE(v3) = 1;
          goto LABEL_12;
        }
      }

      v3 = [v2 countByEnumeratingWithState:&v8 objects:v12 count:16];
      if (v3)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  return v3;
}

- (id)allCPLResourcesForPruning
{
  v17 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = [(PLManagedAsset *)self modernResources];
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ((([v9 isCPLAssetResource] & 1) != 0 || objc_msgSend(v9, "isCPLMasterResource")) && ((objc_msgSend(v9, "isLocallyAvailable") & 1) != 0 || objc_msgSend(v9, "cplType") == 5))
        {
          [v3 addObject:v9];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
    }

    while (v6);
  }

  v10 = [v3 allObjects];

  return v10;
}

- (id)allMasterCPLResources
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v4 = [(PLManagedAsset *)self modernResources];
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v12;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v11 + 1) + 8 * i);
        if ([v9 isCPLMasterResource])
        {
          [v3 addObject:v9];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  return v3;
}

- (id)allAssetCPLResources
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DFA8]);
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v4 = [(PLManagedAsset *)self modernResources];
  v5 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v12;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v11 + 1) + 8 * i);
        if ([v9 isCPLAssetResource])
        {
          [v3 addObject:v9];
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  return v3;
}

- (id)assetResourceForCPLType:(unint64_t)a3
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = [(PLManagedAsset *)self modernResources];
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 cplType] == a3 && objc_msgSend(v9, "isCPLAssetResource"))
        {
          v10 = v9;
          goto LABEL_12;
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_12:

  return v10;
}

- (id)masterResourceForCPLType:(unint64_t)a3
{
  v17 = *MEMORY[0x1E69E9840];
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v4 = [(PLManagedAsset *)self modernResources];
  v5 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v13;
    while (2)
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v13 != v7)
        {
          objc_enumerationMutation(v4);
        }

        v9 = *(*(&v12 + 1) + 8 * i);
        if ([v9 cplType] == a3 && objc_msgSend(v9, "isCPLMasterResource"))
        {
          v10 = v9;
          goto LABEL_12;
        }
      }

      v6 = [v4 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v6)
      {
        continue;
      }

      break;
    }
  }

  v10 = 0;
LABEL_12:

  return v10;
}

- (id)resourceForCPLType:(unint64_t)a3 version:(unsigned int)a4
{
  v19 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v6 = [(PLManagedAsset *)self modernResources];
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v15;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v15 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v14 + 1) + 8 * i);
        if ([v11 cplType] == a3 && objc_msgSend(v11, "version") == a4)
        {
          v12 = v11;
          goto LABEL_12;
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  v12 = 0;
LABEL_12:

  return v12;
}

+ (void)rm_cplResourceWasUploaded:(id)a3 photoLibrary:(id)a4
{
  v25 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v8 = [v5 itemScopedIdentifier];
  v9 = [PLManagedAsset assetWithScopedIdentifier:v8 inLibrary:v6 prefetchResources:1];
  v10 = [v5 resourceType];
  if (v9)
  {
    v11 = [v9 assetResourceForCPLType:v10];
    if (v11)
    {
      [v7 addObject:v11];
    }
  }

  else
  {
    v12 = [PLCloudMaster cloudMasterWithScopedIdentifier:v8 prefetchResources:1 inLibrary:v6];
    v11 = v12;
    if (v12)
    {
      v13 = [v12 rm_assetAttachedResourcesForResourceType:v10];
      [v7 addObjectsFromArray:v13];
    }
  }

  v22 = 0u;
  v23 = 0u;
  v20 = 0u;
  v21 = 0u;
  v14 = v7;
  v15 = [v14 countByEnumeratingWithState:&v20 objects:v24 count:16];
  if (v15)
  {
    v16 = v15;
    v17 = *v21;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v21 != v17)
        {
          objc_enumerationMutation(v14);
        }

        v19 = *(*(&v20 + 1) + 8 * i);
        if ([v19 cloudLocalState] != 3)
        {
          [v19 setCloudLocalState:3];
        }

        if ([v19 remoteAvailability] != 1)
        {
          [v19 setRemoteAvailability:1];
        }
      }

      v16 = [v14 countByEnumeratingWithState:&v20 objects:v24 count:16];
    }

    while (v16);
  }
}

+ (void)_rm_copyResourceFileFrom:(id)a3 to:(id)a4 forCloudMaster:(id)a5 andAsset:(id)a6
{
  v49 = *MEMORY[0x1E69E9840];
  v11 = a3;
  v12 = a4;
  v13 = a5;
  v14 = a6;
  v15 = [MEMORY[0x1E696AC08] defaultManager];
  v16 = [v11 fileURL];
  v17 = [v16 path];

  v18 = [v12 fileURL];
  v19 = [v18 path];

  if (v17 && v19 && [v15 fileExistsAtPath:v17] && (objc_msgSend(v15, "fileExistsAtPath:", v19) & 1) == 0)
  {
    v20 = [v14 pathManager];
    v33 = [v20 isUBF];
    if (v33)
    {
      v34 = v20;
      v21 = [v14 assetID];
      v40 = [v13 originalFilenameForResourceType:objc_msgSend(v12 filePath:{"cplTypeWithAssetID:", v21), v19}];

      if ([v11 resourceType] == 16)
      {
        v31 = [MEMORY[0x1E696AAA8] currentHandler];
        [v31 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+RM+CPL.m" lineNumber:253 description:{@"Invalid parameter not satisfying: %@", @"fromResource.resourceType != PLResourceTypeContextualVideoThumbnail"}];
      }

      v38 = objc_alloc(MEMORY[0x1E69BF298]);
      v22 = [v14 uuid];
      v32 = [v14 bundleScope];
      v36 = [v12 uniformTypeIdentifier];
      v23 = [v36 identifier];
      v39 = [v38 initWithAssetUuid:v22 bundleScope:v32 uti:v23 resourceVersion:0 resourceType:objc_msgSend(v12 recipeID:"resourceType") originalFilename:objc_msgSend(v12 customSuffix:{"recipeID"), v40, 0}];

      v20 = v34;
    }

    else
    {
      v39 = 0;
    }

    [v19 stringByDeletingLastPathComponent];
    v37 = v42[1] = 0;
    v24 = [v15 createDirectoryIfNeededAtPath:? error:?];
    v41 = 0;
    if (!v24)
    {
      v30 = v37;
      if (*MEMORY[0x1E6994D48])
      {
LABEL_25:

        goto LABEL_26;
      }

      v26 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412546;
        v44 = v37;
        v45 = 2112;
        v46 = v41;
        _os_log_impl(&dword_19BF1F000, v26, OS_LOG_TYPE_ERROR, "Failed to create directory for resource file at %@. Error: %@", buf, 0x16u);
      }

LABEL_24:

      goto LABEL_25;
    }

    v42[0] = 0;
    v25 = [v15 copyItemAtPath:v17 toPath:v19 error:v42];
    v26 = v42[0];
    if (v25)
    {
      v35 = v20;
      v27 = [v14 assetID];
      v28 = [v12 cplTypeWithAssetID:v27];

      if (v28 == 1)
      {
        [v14 persistMetadataToFilesystem];
      }

      v20 = v35;
      if (!v33)
      {
        if (PLResourceIsOriginalNonDerivativeWithType(v12))
        {
          [v12 persistResourceTypeToFileURL];
        }

        goto LABEL_23;
      }

      v29 = [MEMORY[0x1E695DFF8] fileURLWithPath:v19 isDirectory:0];
      [v35 setExtendedAttributesWithIdentifier:v39 andURL:v29];
    }

    else
    {
      if (*MEMORY[0x1E6994D48])
      {
LABEL_23:
        v30 = v37;
        goto LABEL_24;
      }

      v29 = __CPLAssetsdOSLogDomain();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412802;
        v44 = v17;
        v45 = 2112;
        v46 = v19;
        v47 = 2112;
        v48 = v26;
        _os_log_impl(&dword_19BF1F000, v29, OS_LOG_TYPE_ERROR, "Failed to copy master resource file from %@ to duplicated asset %@. Error: %@", buf, 0x20u);
      }
    }

    goto LABEL_23;
  }

LABEL_26:
}

- (unsigned)fullSizeRenderResourceRecipeID
{
  v2 = [(PLManagedAsset *)self kind];
  if (v2 > 3)
  {
    return 0;
  }

  else
  {
    return dword_19C60B0B0[v2];
  }
}

- (BOOL)requiresVideoComplementDeferredFinalization
{
  v3 = [(PLManagedAsset *)self pathForDeferredVideoComplementFile];

  if (v3)
  {
    if ([(PLManagedAsset *)self videoDeferredProcessingNeeded])
    {
      return 1;
    }

    v5 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:131280 andVersion:0];
    if ([v5 count] == 1)
    {
      v6 = [(PLManagedAsset *)self persistedOriginalVideoComplementResource];

      if (!v6)
      {
        return 1;
      }
    }

    else
    {
    }
  }

  return 0;
}

- (BOOL)requiresImageDeferredFinalization
{
  v3 = [(PLManagedAsset *)self fileURLForCurrentDeferredProcessingPreviewFile];

  if (!v3)
  {
    return 0;
  }

  v4 = [(PLManagedAsset *)self deferredProcessingNeeded];
  result = 1;
  if (v4 != 1 && v4 != 10)
  {
    return [(PLManagedAsset *)self resourceModelIndicatesImageDeferredFinalizationNeeded];
  }

  return result;
}

- (BOOL)resourceModelIndicatesImageDeferredFinalizationNeeded
{
  v3 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:65944 andVersion:0];
  v4 = 0;
  if ([v3 count] == 1)
  {
    v5 = [(PLManagedAsset *)self persistedOriginalImageResource];
    v4 = v5 == 0;
  }

  return v4;
}

- (BOOL)resourceModelIndicatesDeepFusionNeeded
{
  v3 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:65943 andVersion:0];
  v4 = 0;
  if ([v3 count] == 1)
  {
    v5 = [(PLManagedAsset *)self persistedOriginalImageResource];
    v4 = v5 == 0;
  }

  return v4;
}

- (void)reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker
{
  v46[1] = *MEMORY[0x1E69E9840];
  if (([(PLManagedAsset *)self isDeleted]& 1) == 0 && ![(PLManagedAsset *)self isCloudSharedAsset])
  {
    v3 = [PLResourceRecipe recipeFromID:65944];
    v4 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FC02B8];
    v5 = [MEMORY[0x1E695DFD8] setWithObject:&unk_1F0FBEE30];
    v6 = [PLResourceGenerator locallyUnavailableRecipesFromRecipes:v4 versions:v5 asset:self];

    v7 = [v6 containsObject:v3];
    v8 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_265_113176];

    if (v7 && !v8)
    {
      v9 = [(PLManagedAsset *)self mainFileURL];
      v10 = [v9 path];
      v11 = [(PLManagedAsset *)self width];
      v12 = [(PLManagedAsset *)self height];
      LOWORD(v40) = [(PLManagedAsset *)self kind];
      v13 = [PLResourceInstaller generateValidatedExternalImageResourceOfType:0 forFilePath:v10 requireFileToBePresent:0 version:0 basedOnFullSizeWidth:v11 andHeight:v12 recipe:v3 assetKind:v40 error:0];

      v46[0] = v13;
      v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v46 count:1];
      v15 = [PLResourceDataStoreManager storeExternalResources:v14 forAsset:self forLifecycleEvent:2 error:0];

      v16 = [v15 anyObject];
      v17 = v16;
      if (v16)
      {
        [v16 setLocalAvailabilityTarget:1];
        v18 = PLImageManagerGetLog();
        if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
        {
          v19 = [(PLManagedAsset *)self uuid];
          *buf = 138543618;
          v43 = v3;
          v44 = 2114;
          v45 = v19;
          _os_log_impl(&dword_19BF1F000, v18, OS_LOG_TYPE_DEFAULT, "[RM]: Scheduling generation of recipe: %{public}@ for asset uuid: %{public}@...", buf, 0x16u);
        }
      }

      v20 = [(PLManagedObject *)self photoLibrary];
      v21 = [v20 libraryServicesManager];
      v22 = [v21 backgroundJobService];
      [v22 signalBackgroundProcessingNeededOnLibrary:v20];
    }

    v23 = [PLResourceRecipe recipeFromID:131280];
    v24 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FC02D0];
    v25 = [MEMORY[0x1E695DFD8] setWithObject:&unk_1F0FBEE30];
    v26 = [PLResourceGenerator locallyUnavailableRecipesFromRecipes:v24 versions:v25 asset:self];

    v27 = [v26 containsObject:v23];
    v28 = [(PLManagedAsset *)self firstPersistedResourceMatching:&__block_literal_global_271_113178];
    v29 = v28;
    if (v27 && !v28)
    {
      v30 = objc_alloc_init(PLValidatedExternalResource);
      [(PLValidatedExternalResource *)v30 setResourceType:3];
      [(PLValidatedExternalResource *)v30 setVersion:0];
      -[PLValidatedExternalResource setRecipeID:](v30, "setRecipeID:", [v23 recipeID]);
      v41 = v30;
      v31 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v41 count:1];
      v32 = [PLResourceDataStoreManager storeExternalResources:v31 forAsset:self forLifecycleEvent:2 error:0];

      v33 = [v32 anyObject];
      v34 = v33;
      if (v33)
      {
        [v33 setLocalAvailabilityTarget:1];
        v35 = PLImageManagerGetLog();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
        {
          v36 = [(PLManagedAsset *)self uuid];
          *buf = 138543618;
          v43 = v23;
          v44 = 2114;
          v45 = v36;
          _os_log_impl(&dword_19BF1F000, v35, OS_LOG_TYPE_DEFAULT, "[RM]: Scheduling generation of recipe: %{public}@ for asset uuid: %{public}@...", buf, 0x16u);
        }
      }

      v37 = [(PLManagedObject *)self photoLibrary];
      v38 = [v37 libraryServicesManager];
      v39 = [v38 backgroundJobService];
      [v39 signalBackgroundProcessingNeededOnLibrary:v37];
    }
  }
}

BOOL __98__PLManagedAsset_RM__reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker__block_invoke_269(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 recipeID])
  {
    v3 = 0;
  }

  else
  {
    v3 = [v2 resourceType] == 3;
  }

  return v3;
}

BOOL __98__PLManagedAsset_RM__reconsiderLocalAvailabilityTargetsForResourceGeneratableByAvailabilityWorker__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 recipeID])
  {
    v3 = 0;
  }

  else
  {
    v3 = [v2 resourceType] == 0;
  }

  return v3;
}

- (BOOL)repairAssetScopeValidationErrors:(id)a3
{
  v71 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = +[PLResourceModelValidationError allPossibleErrorCodes];
  if (![v4 count])
  {
    v6 = v5;

    v4 = v6;
  }

  v7 = [v4 mutableCopy];
  if ([v7 count])
  {
    v53 = 0;
    v49 = v5;
    v50 = v4;
    v48 = v7;
    while (1)
    {
      v8 = [v7 anyObject];
      v9 = [v8 integerValue];
      if (v9 <= 0xB)
      {
        break;
      }

LABEL_18:
      [v7 removeObject:{v8, v47}];

      if (![v7 count])
      {
        goto LABEL_66;
      }
    }

    if (((1 << v9) & 0xC14) != 0)
    {
      v10 = v8;
      v11 = [(PLManagedAsset *)self imageRequestHints];
      [(PLManagedAsset *)self recalculateImageRequestHints];
      v12 = [(PLManagedAsset *)self imageRequestHints];
      v52 = v11;
      LOBYTE(v11) = [v12 isEqualToData:v11];

      if (v11)
      {
        if ([(PLManagedAsset *)self hasMasterThumb]|| [(PLManagedAsset *)self thumbnailIndex]== -3)
        {
          v13 = PLImageManagerGetLog();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_DEFAULT))
          {
            v14 = [(PLManagedAsset *)self objectID];
            v15 = [(PLManagedAsset *)self thumbnailIndex];
            *buf = 138543874;
            v64 = v14;
            v65 = 2114;
            v66 = v4;
            v67 = 1024;
            LODWORD(v68) = v15;
            _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: Attempting to correct broken thumbnailIndex by regenerating thumbnails for objectID: %{public}@ for error codes: %{public}@, current thumbnailIndex: %d...", buf, 0x1Cu);
          }

          [(PLManagedAsset *)self generateAndUpdateThumbnailsWithPreviewImage:0 thumbnailImage:0 fromImageSource:0 imageData:0 forceSRGBConversion:0];
          v53 = [(PLManagedAsset *)self hasChanges];
        }
      }

      else
      {
        v16 = PLImageManagerGetLog();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_DEFAULT))
        {
          v17 = [(PLManagedAsset *)self objectID];
          v18 = [(PLManagedAsset *)self thumbnailIndex];
          *buf = 138543874;
          v64 = v17;
          v65 = 2114;
          v66 = v4;
          v67 = 1024;
          LODWORD(v68) = v18;
          _os_log_impl(&dword_19BF1F000, v16, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: Storing corrections to imageRequestHints for objectID: %{public}@ for error codes: %{public}@,  thumbnailIndex: %d...", buf, 0x1Cu);
        }

        v53 = 1;
      }

      [v7 removeObject:&unk_1F0FBEDE8];
      [v7 removeObject:&unk_1F0FBEE00];
      [v7 removeObject:&unk_1F0FBEE18];
      v8 = v10;
      goto LABEL_17;
    }

    if (v9 != 8)
    {
      goto LABEL_18;
    }

    v52 = [PLResourceGenerator expectedLocalResourceRecipesForAsset:self versions:&unk_1F0FC02A0];
    if ([v52 count])
    {
      v19 = v8;
      v20 = objc_alloc_init(MEMORY[0x1E695DFA8]);
      v59 = 0u;
      v60 = 0u;
      v61 = 0u;
      v62 = 0u;
      v21 = [(PLManagedAsset *)self modernResources];
      v22 = [v21 countByEnumeratingWithState:&v59 objects:v70 count:16];
      if (v22)
      {
        v23 = v22;
        v24 = *v60;
        do
        {
          for (i = 0; i != v23; ++i)
          {
            if (*v60 != v24)
            {
              objc_enumerationMutation(v21);
            }

            v26 = +[PLResourceRecipe recipeFromID:](PLResourceRecipe, "recipeFromID:", [*(*(&v59 + 1) + 8 * i) recipeID]);
            if (v26)
            {
              [v20 addObject:v26];
            }
          }

          v23 = [v21 countByEnumeratingWithState:&v59 objects:v70 count:16];
        }

        while (v23);
      }

      v27 = MEMORY[0x1E695DFA8];
      v28 = [v52 set];
      v29 = [v27 setWithSet:v28];

      [v29 minusSet:v20];
      v5 = v49;
      v4 = v50;
      v7 = v48;
      v8 = v19;
    }

    else
    {
      v29 = 0;
    }

    v51 = v29;
    if (![v29 count])
    {
LABEL_64:

LABEL_17:
      goto LABEL_18;
    }

    v47 = v8;
    v57 = 0u;
    v58 = 0u;
    v55 = 0u;
    v56 = 0u;
    v30 = v29;
    v31 = [v30 countByEnumeratingWithState:&v55 objects:v69 count:16];
    if (!v31)
    {
      goto LABEL_63;
    }

    v32 = v31;
    v33 = *v56;
LABEL_36:
    v34 = 0;
    while (1)
    {
      if (*v56 != v33)
      {
        objc_enumerationMutation(v30);
      }

      v35 = *(*(&v55 + 1) + 8 * v34);
      v36 = [v35 recipeID];
      if (v36 == 131272)
      {
        break;
      }

      if (v36 == 0x20000)
      {
        v37 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
        v38 = 1;
        if (!v37)
        {
          goto LABEL_55;
        }

        goto LABEL_47;
      }

      if (v36 != 65938)
      {
        v44 = PLImageManagerGetLog();
        if (os_log_type_enabled(v44, OS_LOG_TYPE_ERROR))
        {
          *buf = 134218242;
          v64 = 8;
          v65 = 2114;
          v66 = v35;
          _os_log_impl(&dword_19BF1F000, v44, OS_LOG_TYPE_ERROR, "[RM]: Repair: %ld failed unsupported recipe: %{public}@", buf, 0x16u);
        }

        v37 = 0;
        goto LABEL_55;
      }

      v37 = [(PLManagedAsset *)self pathForFullsizeRenderImageFile];
      v38 = 0;
      if (v37)
      {
        goto LABEL_47;
      }

LABEL_55:
      v43 = PLImageManagerGetLog();
      if (os_log_type_enabled(v43, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 134218242;
        v64 = 8;
        v65 = 2114;
        v66 = v35;
        _os_log_impl(&dword_19BF1F000, v43, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: %ld failed file not found for recipeID: %{public}@", buf, 0x16u);
      }

LABEL_61:

      if (v32 == ++v34)
      {
        v32 = [v30 countByEnumeratingWithState:&v55 objects:v69 count:16];
        if (!v32)
        {
LABEL_63:

          v5 = v49;
          v4 = v50;
          v8 = v47;
          v7 = v48;
          goto LABEL_64;
        }

        goto LABEL_36;
      }
    }

    v37 = [(PLManagedAsset *)self pathForFullsizeRenderVideoFile];
    v38 = 3;
    if (!v37)
    {
      goto LABEL_55;
    }

LABEL_47:
    v39 = [MEMORY[0x1E696AC08] defaultManager];
    v40 = [v39 fileExistsAtPath:v37];

    if (v40)
    {
      v41 = PLImageManagerGetLog();
      if (os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT))
      {
        *buf = 134218242;
        v64 = 8;
        v65 = 2114;
        v66 = v35;
        _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_DEFAULT, "[RM]: Repair: %ld found file on disk for missing recipeID: %{public}@, attempting install", buf, 0x16u);
      }

      v54 = 0;
      v42 = [PLResourceInstaller onDemand_installExistingAdjustedResourceAtFilePath:v37 withType:v38 recipe:v35 forAsset:self error:&v54];
      v43 = v54;
      if (v42)
      {
        v53 = [(PLManagedAsset *)self hasChanges];
      }

      else
      {
        v45 = PLImageManagerGetLog();
        if (os_log_type_enabled(v45, OS_LOG_TYPE_ERROR))
        {
          *buf = 134218498;
          v64 = 8;
          v65 = 2114;
          v66 = v35;
          v67 = 2112;
          v68 = v43;
          _os_log_impl(&dword_19BF1F000, v45, OS_LOG_TYPE_ERROR, "[RM]: Repair: %ld failed to install resource with recipeID: %{public}@, error: %@", buf, 0x20u);
        }
      }

      goto LABEL_61;
    }

    goto LABEL_55;
  }

  v53 = 0;
LABEL_66:

  return v53 & 1;
}

- (BOOL)_installExistingPurgeableResourceAtPath:(id)a3 dstPath:(id)a4 error:(id *)a5 installResourceHandler:(id)a6
{
  v53 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a6;
  v12 = [MEMORY[0x1E696AC08] defaultManager];
  v46 = 0;
  v13 = [v12 removeItemAtPath:v10 error:&v46];
  v14 = v46;

  if ((v13 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
  {
    v15 = PLBackendGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412546;
      v48 = v10;
      v49 = 2112;
      v50 = v14;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "Nonfatal error removing existing resource at path: '%@', error: %@", buf, 0x16u);
    }
  }

  v42 = v14;
  v16 = MEMORY[0x1E69BF238];
  v17 = [MEMORY[0x1E695DFF8] fileURLWithPath:{v9, a5}];
  v18 = [MEMORY[0x1E695DFF8] fileURLWithPath:v10];
  v19 = [(PLManagedObject *)self pathManager];
  v20 = [v19 capabilities];
  v45 = 0;
  LODWORD(v16) = [v16 ingestItemAtURL:v17 toURL:v18 type:4 options:14 capabilities:v20 error:&v45];
  v21 = v45;

  if (v16)
  {
    v44 = 0;
    v22 = [MEMORY[0x1E695DFF8] fileURLWithPath:v10];
    v23 = [PLCacheDeleteSupport markPurgeableForFileAtURL:v22 withUrgency:0 outInode:&v44];

    if (!v23)
    {
      v32 = PLBackendGetLog();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v48 = v10;
        _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_ERROR, "Error marking purgeable at path: '%@'", buf, 0xCu);
      }

      v33 = [MEMORY[0x1E696AC08] defaultManager];
      v43 = 0;
      v34 = [v33 removeItemAtPath:v10 error:&v43];
      v35 = v43;

      v31 = v41;
      if ((v34 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
      {
        v36 = PLBackendGetLog();
        if (os_log_type_enabled(v36, OS_LOG_TYPE_ERROR))
        {
          *buf = 138412290;
          v48 = v10;
          _os_log_impl(&dword_19BF1F000, v36, OS_LOG_TYPE_ERROR, "Error removing file at path: '%@'", buf, 0xCu);
        }
      }

      v30 = [MEMORY[0x1E696ABC0] errorWithDomain:*MEMORY[0x1E69BFF48] code:47019 userInfo:0];

      goto LABEL_22;
    }

    v24 = v11[2](v11);
    if ([v24 isSuccess])
    {
      v25 = v44;
      v26 = [v24 result];
      [v26 setFileID:v25];

      v27 = 0;
      v28 = 1;
      goto LABEL_25;
    }

    v30 = [v24 error];
  }

  else
  {
    v29 = PLBackendGetLog();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_ERROR))
    {
      *buf = 138412802;
      v48 = v9;
      v49 = 2112;
      v50 = v10;
      v51 = 2112;
      v52 = v21;
    }

    v30 = v21;
  }

  v31 = v41;
LABEL_22:
  v37 = v30;
  v27 = v37;
  if (v31)
  {
    v38 = v37;
    *v31 = v27;
  }

  v28 = 0;
LABEL_25:

  return v28;
}

- (id)_originalResources
{
  v2 = [(PLManagedAsset *)self modernResources];
  v3 = [v2 _pl_map:&__block_literal_global_245];

  return v3;
}

id __40__PLManagedAsset_RM___originalResources__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  if ([v2 version] || objc_msgSend(v2, "recipeID"))
  {
    v3 = 0;
  }

  else
  {
    v5 = [v2 resourceType];
    v3 = 0;
    if (v5 <= 3 && v5 != 2)
    {
      v3 = v2;
    }
  }

  return v3;
}

- (void)makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:(int64_t)a3 completion:(id)a4
{
  v42[1] = *MEMORY[0x1E69E9840];
  v6 = a4;
  v7 = [(PLManagedAsset *)self _originalResources];
  if ([v7 count])
  {
    v26 = [(PLManagedObject *)self photoLibrary];
    if (v26)
    {
      v8 = [MEMORY[0x1E695DFA8] set];
      v9 = [MEMORY[0x1E695DF70] array];
      v10 = dispatch_group_create();
      v36 = 0u;
      v37 = 0u;
      v38 = 0u;
      v39 = 0u;
      v24 = v7;
      obj = v7;
      v11 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
      if (v11)
      {
        v12 = v11;
        v13 = *v37;
        do
        {
          for (i = 0; i != v12; ++i)
          {
            if (*v37 != v13)
            {
              objc_enumerationMutation(obj);
            }

            v15 = *(*(&v36 + 1) + 8 * i);
            dispatch_group_enter(v10);
            v30[0] = MEMORY[0x1E69E9820];
            v30[1] = 3221225472;
            v30[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke;
            v30[3] = &unk_1E7577BE0;
            v30[4] = v15;
            v31 = v8;
            v32 = v9;
            v35 = a3;
            v16 = v26;
            v33 = v16;
            v34 = v10;
            [v16 performBlock:v30];
          }

          v12 = [obj countByEnumeratingWithState:&v36 objects:v40 count:16];
        }

        while (v12);
      }

      v17 = qos_class_self();
      v18 = dispatch_queue_attr_make_with_qos_class(0, v17, 0);
      v19 = dispatch_queue_create("[PLManagedAsset(RM) makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:completion:]", v18);

      v20 = +[PLConcurrencyLimiter sharedLimiter];
      v27[0] = MEMORY[0x1E69E9820];
      v27[1] = 3221225472;
      v27[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_4;
      v27[3] = &unk_1E7577C08;
      v28 = v9;
      v29 = v6;
      v21 = v9;
      [v20 groupNotify:v10 queue:v19 block:v27];

      v7 = v24;
    }

    else
    {
      v22 = MEMORY[0x1E696ABC0];
      v23 = *MEMORY[0x1E69BFF48];
      v41 = *MEMORY[0x1E696A278];
      v8 = [MEMORY[0x1E696AEC0] stringWithFormat:@"photoLibrary is nil in %s", "-[PLManagedAsset(RM) makeOriginalResourceAvailableAndMarkPurgeableWithUrgency:completion:]"];
      v42[0] = v8;
      v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v42 forKeys:&v41 count:1];
      v19 = [v22 errorWithDomain:v23 code:46502 userInfo:v10];
      (*(v6 + 2))(v6, v19);
    }
  }

  else
  {
    (*(v6 + 2))(v6, 0);
  }
}

void __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke(uint64_t a1)
{
  v2 = objc_alloc_init(PLResourceLocalAvailabilityRequestOptions);
  [(PLResourceLocalAvailabilityRequestOptions *)v2 setNetworkAccessAllowed:1];
  v3 = [MEMORY[0x1E6994BA8] defaultOptions];
  [(PLResourceLocalAvailabilityRequestOptions *)v2 setDownloadOptions:v3];

  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_2;
  v10[3] = &unk_1E7577BB8;
  v4 = *(a1 + 32);
  v5 = *(a1 + 40);
  v6 = *(a1 + 48);
  v14 = *(a1 + 72);
  *&v7 = *(a1 + 56);
  *(&v7 + 1) = *(a1 + 32);
  *&v8 = v5;
  *(&v8 + 1) = v6;
  v11 = v8;
  v12 = v7;
  v13 = *(a1 + 64);
  v9 = [v4 makeResourceLocallyAvailableWithOptions:v2 completion:v10];
}

void __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_4(uint64_t a1)
{
  v2 = [*(a1 + 32) firstObject];
  (*(*(a1 + 40) + 16))();
}

void __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    [*(a1 + 32) addObject:v5];
  }

  if (v6)
  {
    [*(a1 + 40) addObject:v6];
  }

  if (v5)
  {
    v12 = 0;
    v13 = 0;
    v7 = [PLCacheDeleteSupport markPurgeableForFileAtURL:v5 withUrgency:*(a1 + 72) outInode:&v13 error:&v12];
    v8 = v12;
    v9 = v8;
    if (v7)
    {
      v11[0] = MEMORY[0x1E69E9820];
      v11[1] = 3221225472;
      v11[2] = __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_3;
      v11[3] = &unk_1E7577B90;
      v10 = *(a1 + 48);
      v11[4] = *(a1 + 56);
      v11[5] = v13;
      [v10 performTransactionAndWait:v11];
    }

    else if (v8)
    {
      [*(a1 + 40) addObject:v8];
    }
  }

  dispatch_group_leave(*(a1 + 64));
}

uint64_t __90__PLManagedAsset_RM__makeOriginalResourceAvailableAndMarkPurgeableWithUrgency_completion___block_invoke_3(uint64_t a1)
{
  result = [*(a1 + 32) fileID];
  if (result != *(a1 + 40))
  {
    v3 = *(a1 + 32);

    return [v3 setFileID:?];
  }

  return result;
}

- (BOOL)installExistingAlchemistV2ResourceFileAtPath:(id)a3 recipeID:(unsigned int)a4 error:(id *)a5
{
  v6 = *&a4;
  v8 = a3;
  v9 = [(PLManagedAsset *)self pathForAlchemistV2ResourceFileWithRecipeID:v6];
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __82__PLManagedAsset_RM__installExistingAlchemistV2ResourceFileAtPath_recipeID_error___block_invoke;
  v12[3] = &unk_1E7577B68;
  v15 = v6;
  v13 = v9;
  v14 = self;
  v10 = v9;
  LOBYTE(a5) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:v8 dstPath:v10 error:a5 installResourceHandler:v12];

  return a5;
}

id __82__PLManagedAsset_RM__installExistingAlchemistV2ResourceFileAtPath_recipeID_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:*(a1 + 48)];
  v3 = [PLResourceInstaller onDemand_installExistingAlchemistV2ResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (BOOL)installExistingGenerativePlaygroundFaceResourcesFileAtPath:(id)a3 error:(id *)a4
{
  v6 = a3;
  v7 = [(PLManagedAsset *)self pathForGenerativePlaygroundFaceResourcesFile];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __87__PLManagedAsset_RM__installExistingGenerativePlaygroundFaceResourcesFileAtPath_error___block_invoke;
  v10[3] = &unk_1E7577B40;
  v11 = v7;
  v12 = self;
  v8 = v7;
  LOBYTE(a4) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:v6 dstPath:v8 error:a4 installResourceHandler:v10];

  return a4;
}

id __87__PLManagedAsset_RM__installExistingGenerativePlaygroundFaceResourcesFileAtPath_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:327693];
  v3 = [PLResourceInstaller onDemand_installExistingComputeResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (BOOL)installExistingAlchemistImageAtPath:(id)a3 error:(id *)a4
{
  v6 = a3;
  v7 = [(PLManagedAsset *)self pathForAlchemistImage];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __64__PLManagedAsset_RM__installExistingAlchemistImageAtPath_error___block_invoke;
  v10[3] = &unk_1E7577B40;
  v11 = v7;
  v12 = self;
  v8 = v7;
  LOBYTE(a4) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:v6 dstPath:v8 error:a4 installResourceHandler:v10];

  return a4;
}

id __64__PLManagedAsset_RM__installExistingAlchemistImageAtPath_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:66137];
  v3 = [PLResourceInstaller onDemand_installExistingAdjustmentSuggestionResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (BOOL)installExistingWallpaperComputeResourcesFileAtPath:(id)a3 error:(id *)a4
{
  v6 = a3;
  v7 = [(PLManagedAsset *)self pathForWallpaperComputeResourcesFile];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __79__PLManagedAsset_RM__installExistingWallpaperComputeResourcesFileAtPath_error___block_invoke;
  v10[3] = &unk_1E7577B40;
  v11 = v7;
  v12 = self;
  v8 = v7;
  LOBYTE(a4) = [(PLManagedAsset *)self _installExistingPurgeableResourceAtPath:v6 dstPath:v8 error:a4 installResourceHandler:v10];

  return a4;
}

id __79__PLManagedAsset_RM__installExistingWallpaperComputeResourcesFileAtPath_error___block_invoke(uint64_t a1)
{
  v2 = [PLResourceRecipe recipeFromID:327687];
  v3 = [PLResourceInstaller onDemand_installExistingComputeResourceAtFilePath:*(a1 + 32) recipe:v2 forAsset:*(a1 + 40)];

  return v3;
}

- (id)mediaMetadataForResourceVersion:(unsigned int)a3 mediaMetadataType:(id *)a4
{
  v20 = *MEMORY[0x1E69E9840];
  if (a3 == 2)
  {
    v11 = [(PLManagedAsset *)self additionalAttributes];
    v12 = [v11 mediaMetadata];
    v9 = [v12 data];

    v10 = [(PLManagedAsset *)self additionalAttributes];
  }

  else
  {
    if (a3)
    {
      v15 = PLImageManagerGetLog();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        v18 = 134217984;
        v19 = a3;
        _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[RM]: Invalid resource version for media metadata: %ld", &v18, 0xCu);
      }

      v9 = 0;
      goto LABEL_12;
    }

    v7 = [(PLManagedAsset *)self master];
    v8 = [v7 mediaMetadata];
    v9 = [v8 data];

    v10 = [(PLManagedAsset *)self master];
  }

  v13 = v10;
  v14 = [v10 mediaMetadataType];

  if (v9 && !v14)
  {
    v15 = PLImageManagerGetLog();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      v18 = 134217984;
      v19 = a3;
      _os_log_impl(&dword_19BF1F000, v15, OS_LOG_TYPE_ERROR, "[RM]: Media metadata with version: %ld has no type string", &v18, 0xCu);
    }

LABEL_12:

    v14 = 0;
  }

  if (a4)
  {
    v16 = v14;
    *a4 = v14;
  }

  return v9;
}

- (BOOL)isRAWPlusJPEGWithRAWOnTop
{
  if (![(PLManagedAsset *)self isRAWPlusJPEG])
  {
    return 0;
  }

  v3 = [(PLManagedAsset *)self additionalAttributes];
  v4 = [v3 originalResourceChoice];
  v5 = [v4 unsignedIntegerValue] == 1;

  return v5;
}

- (BOOL)isRAWPlusJPEG
{
  v3 = [(PLManagedAsset *)self primaryStoreOriginalResource];
  v4 = [v3 uniformTypeIdentifier];

  if ([v4 isPrimaryImageFormat])
  {
    v5 = [(PLManagedAsset *)self _anyOriginalNonDerivativeAlternateImageResource];
    v6 = [v5 uniformTypeIdentifier];
    v7 = [v6 conformsToRawImage];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)isRAWOnly
{
  v2 = [(PLManagedAsset *)self primaryStoreOriginalResource];
  v3 = [v2 uniformTypeIdentifier];
  v4 = [v3 conformsToRawImage];

  return v4;
}

- (BOOL)pruneLocalVideoKeyFrameImage
{
  v15 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedAsset *)self isVideo];
  if (v3)
  {
    v4 = [MEMORY[0x1E696AC08] defaultManager];
    v5 = [(PLManagedAsset *)self pathForLocalVideoKeyFrame];
    v12 = 0;
    v6 = [v4 removeItemAtPath:v5 error:&v12];
    v7 = v12;

    if ((v6 & 1) == 0 && (PLIsErrorFileNotFound() & 1) == 0)
    {
      v8 = PLBackendGetLog();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        *buf = 138412290;
        v14 = v7;
        _os_log_impl(&dword_19BF1F000, v8, OS_LOG_TYPE_ERROR, "Error removing local video key frame: %@", buf, 0xCu);
      }
    }

    v9 = [(PLManagedAsset *)self localVideoKeyFrameResource];
    v10 = [v9 isLocallyAvailable];
    if (v10)
    {
      [v9 markAsNotLocallyAvailable];
    }

    LOBYTE(v3) = v6 | v10;
  }

  return v3;
}

- (BOOL)resetVideoKeyFrameTimeAndDeleteKeyFrameResource
{
  v3 = [(PLManagedAsset *)self resetVideoKeyFrameTime];
  v4 = [(PLManagedAsset *)self pruneLocalVideoKeyFrameImage];
  v5 = [(PLManagedAsset *)self localVideoKeyFrameResource];

  if (v5)
  {
    v6 = [(PLManagedAsset *)self localVideoKeyFrameResource];
    [v6 deleteResource];

    v7 = 1;
  }

  else
  {
    v7 = v4 || v3;
  }

  return v7 & 1;
}

- (void)deleteResourceForSidecarRepresentation:(id)a3
{
  if (a3)
  {
    v3 = [a3 resource];
    [v3 deleteResource];
  }
}

- (void)deleteResourcesWithRecipeID:(unsigned int)a3 andVersion:(unsigned int)a4
{
  v14 = *MEMORY[0x1E69E9840];
  v4 = [(PLManagedAsset *)self persistedResourcesWithRecipeID:*&a3 andVersion:*&a4];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v5 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v10;
    do
    {
      v8 = 0;
      do
      {
        if (*v10 != v7)
        {
          objc_enumerationMutation(v4);
        }

        [*(*(&v9 + 1) + 8 * v8++) deleteResource];
      }

      while (v6 != v8);
      v6 = [v4 countByEnumeratingWithState:&v9 objects:v13 count:16];
    }

    while (v6);
  }
}

- (void)deleteAdjustedResources
{
  v28 = *MEMORY[0x1E69E9840];
  v2 = [(PLManagedAsset *)self persistedAdjustedResources];
  if ([v2 count])
  {
    v19 = 0u;
    v20 = 0u;
    v17 = 0u;
    v18 = 0u;
    v15 = v2;
    v3 = v2;
    v4 = [v3 countByEnumeratingWithState:&v17 objects:v27 count:16];
    if (v4)
    {
      v5 = v4;
      v6 = *v18;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v18 != v6)
          {
            objc_enumerationMutation(v3);
          }

          v8 = *(*(&v17 + 1) + 8 * i);
          v9 = PLImageManagerGetLog();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_DEFAULT))
          {
            v10 = [(PLManagedAsset *)self uuid];
            v11 = [v8 resourceType];
            v12 = @"invalid";
            if (v11 <= 0x1F)
            {
              v12 = off_1E75663B0[v11];
            }

            v13 = v12;
            v14 = +[PLResourceRecipe recipeFromID:](PLResourceRecipe, "recipeFromID:", [v8 recipeID]);
            *buf = 138412802;
            v22 = v10;
            v23 = 2114;
            v24 = v13;
            v25 = 2114;
            v26 = v14;
            _os_log_impl(&dword_19BF1F000, v9, OS_LOG_TYPE_DEFAULT, "Deleting adjusted resource row for asset %{pubic}@, type: %{public}@, recipe: %{public}@", buf, 0x20u);
          }

          [v8 deleteResource];
        }

        v5 = [v3 countByEnumeratingWithState:&v17 objects:v27 count:16];
      }

      while (v5);
    }

    v2 = v15;
  }
}

- (id)localVideoKeyFrameResource
{
  v2 = [(PLManagedAsset *)self persistedResourcesMatching:&__block_literal_global_227];
  v3 = [v2 anyObject];

  return v3;
}

BOOL __48__PLManagedAsset_RM__localVideoKeyFrameResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 recipeID] == 65749 && !objc_msgSend(v2, "resourceType") && objc_msgSend(v2, "version") == 3;

  return v3;
}

- (id)penultimateImageResource
{
  v2 = [(PLManagedAsset *)self persistedResourcesMatching:&__block_literal_global_225];
  v3 = [v2 anyObject];

  return v3;
}

BOOL __46__PLManagedAsset_RM__penultimateImageResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 version] == 1 && objc_msgSend(v2, "resourceType") == 0;

  return v3;
}

- (id)adjustmentDataResource
{
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K == %@", @"resourceType", &unk_1F0FBEDD0];
  v4 = [(PLManagedAsset *)self fetchResourcesForAssetVersions:&unk_1F0FC0288 allowDerivatives:0 additionalPredicate:v3 relationshipKeyPathsForPrefetching:0 error:0];
  v5 = [v4 firstObject];

  return v5;
}

- (id)persistedResourcesWithRecipeID:(unsigned int)a3 andVersion:(unsigned int)a4
{
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __64__PLManagedAsset_RM__persistedResourcesWithRecipeID_andVersion___block_invoke;
  v6[3] = &__block_descriptor_40_e28_B16__0__PLInternalResource_8l;
  v7 = a3;
  v8 = a4;
  v4 = [(PLManagedAsset *)self persistedResourcesMatching:v6];

  return v4;
}

BOOL __64__PLManagedAsset_RM__persistedResourcesWithRecipeID_andVersion___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 recipeID] == *(a1 + 32) && objc_msgSend(v3, "version") == *(a1 + 36);

  return v4;
}

- (id)resourcesWithVersion:(unsigned int)a3
{
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __43__PLManagedAsset_RM__resourcesWithVersion___block_invoke;
  v5[3] = &__block_descriptor_36_e28_B16__0__PLInternalResource_8l;
  v6 = a3;
  v3 = [(PLManagedAsset *)self persistedResourcesMatching:v5];

  return v3;
}

- (id)fetchOrCreateResourceWithIdentity:(id)a3
{
  v5 = a3;
  if (!v5)
  {
    v10 = [MEMORY[0x1E696AAA8] currentHandler];
    [v10 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1162 description:{@"Invalid parameter not satisfying: %@", @"identity"}];
  }

  v6 = [(PLManagedAsset *)self fetchResourceWithIdentity:v5 error:0];
  if (!v6)
  {
    v7 = [(PLManagedAsset *)self managedObjectContext];
    v8 = [(PLManagedAsset *)self objectID];
    v6 = [PLInternalResource insertResourceForAssetObjectID:v8 resourceIdentity:v5 inManagedObjectContext:v7];
  }

  return v6;
}

- (id)fetchResourceWithIdentity:(id)a3 error:(id *)a4
{
  v7 = a3;
  if (!v7)
  {
    v11 = [MEMORY[0x1E696AAA8] currentHandler];
    [v11 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1148 description:{@"Invalid parameter not satisfying: %@", @"identity"}];
  }

  v12 = 0;
  v8 = [(PLManagedAsset *)self _persistedResourceForResourceIdentity:v7 error:&v12];
  v9 = v12;
  if (a4 && !v8 && v9)
  {
    v9 = v9;
    *a4 = v9;
  }

  return v8;
}

BOOL __65__PLManagedAsset_RM__persistedPenultimateVideoComplementResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && objc_msgSend(v2, "version") == 1 && objc_msgSend(v2, "resourceType") == 3;

  return v3;
}

BOOL __62__PLManagedAsset_RM__persistedOriginalVideoComplementResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && !objc_msgSend(v2, "version") && objc_msgSend(v2, "resourceType") == 3;

  return v3;
}

BOOL __52__PLManagedAsset_RM__persistedOriginalVideoResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && !objc_msgSend(v2, "version") && objc_msgSend(v2, "resourceType") == 1;

  return v3;
}

BOOL __52__PLManagedAsset_RM__persistedOriginalImageResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = ![v2 recipeID] && !objc_msgSend(v2, "version") && objc_msgSend(v2, "resourceType") == 0;

  return v3;
}

- (id)firstPersistedResourceMatching:(id)a3
{
  v18 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (!v5)
  {
    v12 = [MEMORY[0x1E696AAA8] currentHandler];
    [v12 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1108 description:{@"Invalid parameter not satisfying: %@", @"filterBlock"}];
  }

  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  v6 = [(PLManagedAsset *)self modernResources];
  v7 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v7)
  {
    v8 = *v14;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v13 + 1) + 8 * i);
        if (v5[2](v5, v10))
        {
          v7 = v10;
          goto LABEL_13;
        }
      }

      v7 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_13:

  return v7;
}

- (id)persistedResourcesMatching:(id)a3
{
  v5 = a3;
  if (!v5)
  {
    v12 = [MEMORY[0x1E696AAA8] currentHandler];
    [v12 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:1097 description:{@"Invalid parameter not satisfying: %@", @"filterBlock"}];
  }

  v6 = MEMORY[0x1E696AE18];
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __49__PLManagedAsset_RM__persistedResourcesMatching___block_invoke;
  v13[3] = &unk_1E7577AD8;
  v14 = v5;
  v7 = v5;
  v8 = [v6 predicateWithBlock:v13];
  v9 = [(PLManagedAsset *)self modernResources];
  v10 = [v9 filteredSetUsingPredicate:v8];

  return v10;
}

- (id)allFileBackedResources
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v4 = [(PLManagedAsset *)self modernResources];
  v5 = [v4 allObjects];
  [v3 addObjectsFromArray:v5];

  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  v6 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:0, 0];
  v7 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v14;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v14 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v13 + 1) + 8 * i);
        if ((~[v11 recipeID] & 0x30000) != 0)
        {
          [v3 addObject:v11];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v8);
  }

  return v3;
}

- (id)fetchResourcesForAssetVersions:(id)a3 allowDerivatives:(BOOL)a4 additionalPredicate:(id)a5 relationshipKeyPathsForPrefetching:(id)a6 error:(id *)a7
{
  v9 = a4;
  v12 = a6;
  v13 = a5;
  v14 = a3;
  v15 = objc_opt_class();
  v16 = [(PLManagedAsset *)self objectID];
  v17 = [(PLManagedAsset *)self managedObjectContext];
  v18 = [v15 fetchResourcesForAssetWithObjectID:v16 inContext:v17 versions:v14 includeVirtualResources:1 allowDerivatives:v9 excludeDynamicCPLResources:0 additionalPredicate:v13 relationshipKeyPathsForPrefetching:v12 error:a7];

  return v18;
}

- (id)resourcesSortedByQualityWithOptions:(unsigned __int16)a3
{
  v3 = a3;
  if (resourcesSortedByQualityWithOptions__s_onceToken != -1)
  {
    dispatch_once(&resourcesSortedByQualityWithOptions__s_onceToken, &__block_literal_global_179_113246);
  }

  v5 = [MEMORY[0x1E695DF70] array];
  v6 = [(PLManagedAsset *)self modernResources];
  v7 = [v6 allObjects];
  [v5 addObjectsFromArray:v7];

  v8 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:v3];
  [v5 addObjectsFromArray:v8];

  [v5 sortUsingDescriptors:resourcesSortedByQualityWithOptions__s_sortDescriptors];

  return v5;
}

void __58__PLManagedAsset_RM__resourcesSortedByQualityWithOptions___block_invoke()
{
  v3[1] = *MEMORY[0x1E69E9840];
  v0 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"qualitySortValue" ascending:1];
  v3[0] = v0;
  v1 = [MEMORY[0x1E695DEC8] arrayWithObjects:v3 count:1];
  v2 = resourcesSortedByQualityWithOptions__s_sortDescriptors;
  resourcesSortedByQualityWithOptions__s_sortDescriptors = v1;
}

- (BOOL)deleteContextualVideoThumbnailFilesWithError:(id *)a3
{
  v17 = *MEMORY[0x1E69E9840];
  v5 = PLBackendGetLog();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEFAULT))
  {
    v6 = [(PLManagedAsset *)self uuid];
    *buf = 138543362;
    v16 = v6;
    _os_log_impl(&dword_19BF1F000, v5, OS_LOG_TYPE_DEFAULT, "Deleting contextual video thumbnails for asset %{public}@", buf, 0xCu);
  }

  v7 = [(PLManagedAsset *)self readonlyFileURLForContextualVideoThumbnailIdentifier:0];
  if (v7)
  {
    v8 = MEMORY[0x1E69BF238];
    v9 = [(PLManagedAsset *)self uuid];
    v14 = 0;
    LOBYTE(v8) = [v8 removeFilesInDirectoryAtURL:v7 withPrefix:v9 error:&v14 progress:0];
    v10 = v14;

    if (v8 & 1) != 0 || (PLIsErrorFileNotFound())
    {
      v11 = 1;
    }

    else if (a3)
    {
      v13 = v10;
      v11 = 0;
      *a3 = v10;
    }

    else
    {
      v11 = 0;
    }
  }

  else
  {
    v11 = 1;
  }

  return v11;
}

- (id)contextualVideoThumbnailURLs
{
  v18 = *MEMORY[0x1E69E9840];
  if ([(PLManagedAsset *)self isVideo])
  {
    v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v13 = 0u;
    v14 = 0u;
    v15 = 0u;
    v16 = 0u;
    v4 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:0, 0];
    v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
    if (v5)
    {
      v6 = v5;
      v7 = *v14;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v14 != v7)
          {
            objc_enumerationMutation(v4);
          }

          v9 = *(*(&v13 + 1) + 8 * i);
          if ([v9 resourceType] == 16)
          {
            v10 = [v9 fileURL];
            if (v10)
            {
              [v3 addObject:v10];
            }
          }
        }

        v6 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
      }

      while (v6);
    }

    v11 = [v3 copy];
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

- (id)writableFileURLForContextualVideoThumbnailIdentifier:(id)a3
{
  v23 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(PLManagedAsset *)self assetID];
  v6 = [v5 libraryID];
  v7 = PLDataStoreForClassIDAndLibraryID(0, v6);

  v8 = [v7 writableFileURLForContextualVideoThumbnailIdentifier:v4 asset:self];

  if (v8)
  {
    v9 = MEMORY[0x1E69BF238];
    v10 = [v8 URLByDeletingLastPathComponent];
    v16 = 0;
    v11 = [v9 createDirectoryAtURL:v10 error:&v16];
    v12 = v16;

    if ((v11 & 1) == 0)
    {
      v13 = PLBackendGetLog();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
      {
        v14 = [(PLManagedAsset *)self uuid];
        *buf = 136315650;
        v18 = "[PLManagedAsset(RM) writableFileURLForContextualVideoThumbnailIdentifier:]";
        v19 = 2114;
        v20 = v14;
        v21 = 2112;
        v22 = v12;
        _os_log_impl(&dword_19BF1F000, v13, OS_LOG_TYPE_ERROR, "%s for asset %{public}@ failed: %@", buf, 0x20u);
      }
    }
  }

  return v8;
}

- (id)readonlyFileURLForContextualVideoThumbnailIdentifier:(id)a3
{
  v4 = a3;
  v5 = [(PLManagedAsset *)self assetID];
  v6 = [v5 libraryID];
  v7 = PLDataStoreForClassIDAndLibraryID(0, v6);

  v8 = [v7 readonlyFileURLForContextualVideoThumbnailIdentifier:v4 asset:self];

  return v8;
}

- (BOOL)hasLargerThanThumbResourceLocal
{
  v15 = 0;
  v16 = &v15;
  v17 = 0x2020000000;
  v18 = 0;
  v3 = [(PLManagedAsset *)self imageRequestHints];
  v4 = [(PLManagedAsset *)self width];
  v5 = [(PLManagedAsset *)self height];
  v6 = [(PLManagedObject *)self photoLibrary];
  v7 = [v6 libraryID];
  v8 = [(PLManagedAsset *)self assetID];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke;
  v14[3] = &unk_1E7577A88;
  v14[4] = &v15;
  [PLManagedAsset enumerateImageRequestHintData:v3 assetWidth:v4 assetHeight:v5 libraryID:v7 startingOffset:0 assetID:v8 block:v14];

  if ((v16[3] & 1) == 0 && [(PLManagedAsset *)self isVideo])
  {
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke_2;
    v13[3] = &unk_1E7577AB0;
    v13[4] = self;
    v9 = [(PLManagedAsset *)self persistedResourcesMatching:v13];
    v10 = [v9 count] != 0;
    *(v16 + 24) = v10;
  }

  v11 = *(v16 + 24);
  _Block_object_dispose(&v15, 8);
  return v11;
}

uint64_t __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke(uint64_t result, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, unsigned int a9, _BYTE *a10)
{
  if (!a9 || HIWORD(a9) - 3 >= 2u)
  {
    *(*(*(result + 32) + 8) + 24) = 1;
    *a10 = 1;
  }

  return result;
}

BOOL __53__PLManagedAsset_RM__hasLargerThanThumbResourceLocal__block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 localAvailability];
  v5 = [v3 resourceType];
  v6 = [v3 version];

  v7 = [*(a1 + 32) hasAdjustments];
  if (v5 != 1)
  {
    return 0;
  }

  if (v7)
  {
    v8 = 2;
  }

  else
  {
    v8 = 0;
  }

  return (v6 == 3 || v8 == v6) && v4 >= 0;
}

- (id)masterThumbnailFileURLIfLocal
{
  v2 = [(PLManagedAsset *)self masterThumbnailResource];
  v3 = [v2 fileURL];

  return v3;
}

- (id)masterThumbnailResource
{
  v2 = [(PLManagedAsset *)self nonPersistedResourcesWithOptions:1];
  v3 = [v2 indexOfObjectPassingTest:&__block_literal_global_175];
  if (v3 == 0x7FFFFFFFFFFFFFFFLL)
  {
    v4 = 0;
  }

  else
  {
    v4 = [v2 objectAtIndex:v3];
  }

  return v4;
}

BOOL __45__PLManagedAsset_RM__masterThumbnailResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 recipeID];

  return [PLResourceDataStore isMasterThumbRecipeID:v2];
}

- (id)nonPersistedResourcesWithOptions:(unsigned __int16)a3
{
  v3 = a3;
  v20 = *MEMORY[0x1E69E9840];
  v5 = [MEMORY[0x1E695DF70] arrayWithCapacity:5];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v6 = [(PLManagedAsset *)self assetID];
  v7 = [v6 libraryID];
  v8 = [PLResourceDataStoreManager storesForLibraryID:v7];

  v9 = [v8 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v16;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v16 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v13 = [*(*(&v15 + 1) + 8 * i) virtualResourcesForAsset:self options:v3];
        [v5 addObjectsFromArray:v13];
      }

      v10 = [v8 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v10);
  }

  return v5;
}

- (id)mediaMetadataVirtualResources
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v4 = [(PLManagedAsset *)self master];
  v5 = [v4 mediaMetadata];
  v6 = [v5 data];

  if (v6)
  {
    v7 = [PLMediaMetadataVirtualResource alloc];
    v8 = [(PLManagedAsset *)self master];
    v9 = [v8 mediaMetadata];
    v10 = [v9 data];
    v11 = -[PLMediaMetadataVirtualResource initWithAsset:resourceType:version:recipeID:dataLength:](v7, "initWithAsset:resourceType:version:recipeID:dataLength:", self, 9, 0, 327685, [v10 length]);

    [v3 addObject:v11];
  }

  if ([(PLManagedAsset *)self hasAdjustments])
  {
    v12 = [(PLManagedAsset *)self additionalAttributes];
    v13 = [v12 mediaMetadata];
    v14 = [v13 data];

    if (v14)
    {
      v15 = [PLMediaMetadataVirtualResource alloc];
      v16 = [(PLManagedAsset *)self additionalAttributes];
      v17 = [v16 mediaMetadata];
      v18 = [v17 data];
      v19 = -[PLMediaMetadataVirtualResource initWithAsset:resourceType:version:recipeID:dataLength:](v15, "initWithAsset:resourceType:version:recipeID:dataLength:", self, 9, 2, 327685, [v18 length]);

      [v3 addObject:v19];
    }
  }

  return v3;
}

- (void)recalculateImageRequestHintsForResource:(id)a3 afterLocalAvailabilityChangeFrom:(signed __int16)a4 previousDataStoreKey:(id)a5
{
  v6 = a4;
  v51[1] = *MEMORY[0x1E69E9840];
  v9 = a3;
  v37 = a5;
  if (!v9)
  {
    v34 = [MEMORY[0x1E696AAA8] currentHandler];
    [v34 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:752 description:{@"Invalid parameter not satisfying: %@", @"resource"}];
  }

  v45 = 0;
  v46 = &v45;
  v47 = 0x2020000000;
  v48 = 0;
  v10 = [v9 localAvailability];
  if (v6 > 1 || v10 < 1)
  {
    v13 = [v9 localAvailability];
    v11 = v46;
    if (v6 < 1 || (v13 & 0x80000000) == 0)
    {
      if (!v46[3])
      {
        goto LABEL_22;
      }

      goto LABEL_10;
    }

    v12 = 2;
  }

  else
  {
    v11 = v46;
    v12 = 1;
  }

  v11[3] = v12;
LABEL_10:
  v14 = objc_alloc(MEMORY[0x1E695DF88]);
  v15 = [(PLManagedAsset *)self imageRequestHints];
  v16 = [v14 initWithCapacity:{objc_msgSend(v15, "length")}];

  v17 = [(PLManagedAsset *)self width];
  if ([(PLManagedAsset *)self height]* v17 < 1)
  {
    v21 = 0.0;
  }

  else
  {
    v18 = [v9 unorientedWidth];
    v19 = [v9 unorientedHeight];
    v20 = [(PLManagedAsset *)self width];
    v21 = (v19 * v18) / ([(PLManagedAsset *)self height]* v20);
  }

  if (PLCanIncludeResourceInHints(v9, self))
  {
    v22 = objc_opt_class();
    v51[0] = v9;
    v23 = [MEMORY[0x1E695DEC8] arrayWithObjects:v51 count:1];
    v24 = [v22 calculateImageRequestHintsFromSortedResources:v23 asset:self];
  }

  else
  {
    v24 = 0;
  }

  v36 = objc_opt_class();
  v25 = [(PLManagedAsset *)self imageRequestHints];
  v35 = [(PLManagedAsset *)self width];
  v26 = [(PLManagedAsset *)self height];
  v27 = [(PLManagedAsset *)self assetID];
  v28 = [v27 libraryID];
  v29 = [(PLManagedAsset *)self assetID];
  v38[0] = MEMORY[0x1E69E9820];
  v38[1] = 3221225472;
  v38[2] = __116__PLManagedAsset_RM__recalculateImageRequestHintsForResource_afterLocalAvailabilityChangeFrom_previousDataStoreKey___block_invoke;
  v38[3] = &unk_1E7577A40;
  v44 = v21;
  v39 = v9;
  v43 = &v45;
  v40 = v37;
  v30 = v24;
  v41 = v30;
  v31 = v16;
  v42 = v31;
  [v36 enumerateImageRequestHintData:v25 assetWidth:v35 assetHeight:v26 libraryID:v28 startingOffset:0 assetID:v29 block:v38];

  if (v46[3] == 1 && v30)
  {
    [v31 appendData:v30];
  }

  [(PLManagedAsset *)self setImageRequestHints:v31];
  v32 = PLImageManagerGetLog();
  if (os_log_type_enabled(v32, OS_LOG_TYPE_DEBUG))
  {
    v33 = [v31 length];
    *buf = 134217984;
    v50 = v33;
    _os_log_impl(&dword_19BF1F000, v32, OS_LOG_TYPE_DEBUG, "[RM]: Inserted/removed imageRequestHint, length = %ld", buf, 0xCu);
  }

LABEL_22:
  _Block_object_dispose(&v45, 8);
}

void __116__PLManagedAsset_RM__recalculateImageRequestHintsForResource_afterLocalAvailabilityChangeFrom_previousDataStoreKey___block_invoke(uint64_t a1, uint64_t a2, int a3, float a4, uint64_t a5, void *a6, void *a7, uint64_t a8, uint64_t a9)
{
  v24 = a6;
  v16 = a7;
  v17 = *(a1 + 72);
  if (v17 <= a4)
  {
    if (vabds_f32(a4, v17) >= 0.00000011921 || a3 == 0)
    {
      v18 = 1;
    }

    else
    {
      v20 = [*(a1 + 32) uniformTypeIdentifier];
      v18 = [v20 isPrimaryImageFormat];
    }
  }

  else
  {
    v18 = 0;
  }

  v21 = *(*(*(a1 + 64) + 8) + 24);
  if (v21 == 2)
  {
    v22 = [v16 isEqualToKey:*(a1 + 40)];
    v23 = (*(*(a1 + 64) + 8) + 24);
    if (v22)
    {
LABEL_21:
      *v23 = 0;
      goto LABEL_22;
    }

    v21 = *v23;
  }

  if (v21 == 1 && (v18 & 1) != 0)
  {
    if (*(a1 + 48))
    {
      [*(a1 + 56) appendData:?];
    }

    [*(a1 + 56) appendBytes:a8 length:a9];
LABEL_20:
    v23 = (*(*(a1 + 64) + 8) + 24);
    goto LABEL_21;
  }

  [*(a1 + 56) appendBytes:a8 length:a9];
  if (a2 == 0x7FFFFFFFFFFFFFFFLL && v21 == 1)
  {
    if (*(a1 + 48))
    {
      [*(a1 + 56) appendData:?];
    }

    goto LABEL_20;
  }

LABEL_22:
}

- (void)insertTableThumbImageRequestHints
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = [(PLManagedObject *)self photoLibrary];
  v4 = [v3 libraryID];
  v5 = PLDataStoreForClassIDAndLibraryID(1, v4);

  v6 = [v5 virtualResourcesForAsset:self options:1];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v7 = [v6 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v12;
    do
    {
      v10 = 0;
      do
      {
        if (*v12 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [(PLManagedAsset *)self recalculateImageRequestHintsForResource:*(*(&v11 + 1) + 8 * v10++) afterLocalAvailabilityChangeFrom:0xFFFFFFFFLL previousDataStoreKey:0];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v8);
  }
}

- (void)recalculateImageRequestHints
{
  v21 = *MEMORY[0x1E69E9840];
  v3 = PLImageManagerGetLog();
  v4 = os_signpost_id_make_with_pointer(v3, self);
  v5 = v3;
  v6 = v5;
  if (v4 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v5))
  {
    LOWORD(v17) = 0;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v6, OS_SIGNPOST_INTERVAL_BEGIN, v4, "ResourceModel", "RecalulateImageRequestHints", &v17, 2u);
  }

  v7 = objc_opt_class();
  v8 = [(PLManagedAsset *)self resourcesSortedByQualityWithOptions:1];
  v9 = [v7 calculateImageRequestHintsFromSortedResources:v8 asset:self];

  v10 = [(PLManagedAsset *)self imageRequestHints];
  v11 = [v9 isEqualToData:v10];

  if ((v11 & 1) == 0)
  {
    v12 = PLImageManagerGetLog();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
    {
      v13 = [(PLManagedAsset *)self uuid];
      v14 = [v9 length];
      v17 = 138412546;
      v18 = v13;
      v19 = 2048;
      v20 = v14;
      _os_log_impl(&dword_19BF1F000, v12, OS_LOG_TYPE_DEBUG, "[RM]: Recalculated image request hints for %@, length = %ld", &v17, 0x16u);
    }

    [(PLManagedAsset *)self setImageRequestHints:v9];
  }

  v15 = v6;
  v16 = v15;
  if (v4 - 1 <= 0xFFFFFFFFFFFFFFFDLL && os_signpost_enabled(v15))
  {
    LOWORD(v17) = 0;
    _os_signpost_emit_with_name_impl(&dword_19BF1F000, v16, OS_SIGNPOST_INTERVAL_END, v4, "ResourceModel", "RecalulateImageRequestHints", &v17, 2u);
  }
}

- (BOOL)imageRequestHintsContainsResource:(id)a3
{
  v4 = a3;
  v17 = 0;
  v18 = &v17;
  v19 = 0x2020000000;
  v20 = 0;
  v5 = objc_opt_class();
  v6 = [(PLManagedAsset *)self imageRequestHints];
  v7 = [(PLManagedAsset *)self width];
  v8 = [(PLManagedAsset *)self height];
  v9 = [(PLManagedObject *)self photoLibrary];
  v10 = [v9 libraryID];
  v11 = [(PLManagedAsset *)self assetID];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __56__PLManagedAsset_RM__imageRequestHintsContainsResource___block_invoke;
  v14[3] = &unk_1E7577A18;
  v14[4] = self;
  v12 = v4;
  v15 = v12;
  v16 = &v17;
  [v5 enumerateImageRequestHintData:v6 assetWidth:v7 assetHeight:v8 libraryID:v10 startingOffset:0 assetID:v11 block:v14];

  LOBYTE(v6) = *(v18 + 24);
  _Block_object_dispose(&v17, 8);

  return v6;
}

void __56__PLManagedAsset_RM__imageRequestHintsContainsResource___block_invoke(uint64_t a1, float a2, uint64_t a3, int a4, int a5, void *a6, void *a7, uint64_t a8, uint64_t a9, int a10, _BYTE *a11)
{
  v32 = a6;
  v16 = a7;
  v17 = [objc_opt_class() storeClassID];
  v18 = *(a1 + 32);
  if (v17 == 1)
  {
    v19 = [v18 width];
    if ([*(a1 + 32) height] * v19 < 1)
    {
      v23 = 0.0;
    }

    else
    {
      v20 = [*(a1 + 40) unorientedWidth];
      v21 = ([*(a1 + 40) unorientedHeight] * v20);
      v22 = [*(a1 + 32) width];
      v23 = v21 / ([*(a1 + 32) height] * v22);
    }

    if (vabds_f32(v23, a2) < 0.00000011921)
    {
      v30 = [*(a1 + 40) uniformTypeIdentifier];
      if ([v30 isPrimaryImageFormat] == a4 && objc_msgSend(*(a1 + 40), "isDefaultOrientation") == a5)
      {
        v31 = [*(a1 + 40) recipeID];

        if (v31 == a10)
        {
          *(*(*(a1 + 48) + 8) + 24) = 1;
          *a11 = 1;
        }
      }

      else
      {
      }
    }
  }

  else
  {
    v24 = [v18 assetID];
    v25 = [v32 resourceURLForKey:v16 assetID:v24];

    v26 = [*(a1 + 40) dataStore];
    v27 = [*(a1 + 40) dataStoreKey];
    v28 = [*(a1 + 40) assetID];
    v29 = [v26 resourceURLForKey:v27 assetID:v28];

    if (v25 && [v25 isEqual:v29])
    {
      *(*(*(a1 + 48) + 8) + 24) = 1;
      *a11 = 1;
    }
  }
}

- (id)validateForAssetID:(id)a3 resourceIdentity:(id)a4
{
  v114 = *MEMORY[0x1E69E9840];
  v73 = a3;
  v72 = a4;
  v106 = 0;
  v6 = [(PLManagedAsset *)self fetchResourcesForAssetVersions:0 allowDerivatives:1 additionalPredicate:0 relationshipKeyPathsForPrefetching:0 error:&v106];
  v71 = v106;
  v75 = objc_alloc_init(MEMORY[0x1E696AB50]);
  v84 = [(PLManagedAsset *)self isCloudSharedAsset];
  v102 = 0u;
  v103 = 0u;
  v104 = 0u;
  v105 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v102 objects:v113 count:16];
  if (v8)
  {
    v9 = 0;
    v76 = 0;
    obj = 0;
    v82 = 0;
    v10 = 0;
    v11 = *v103;
    v12 = MEMORY[0x1E695E0F0];
    while (1)
    {
      v13 = v7;
      for (i = 0; i != v8; ++i)
      {
        if (*v103 != v11)
        {
          objc_enumerationMutation(v13);
        }

        v15 = *(*(&v102 + 1) + 8 * i);
        if (v84)
        {
          if (-[PLManagedAsset isVideo](self, "isVideo") && [v15 dataStoreSubtype] == 5 || !-[PLManagedAsset isVideo](self, "isVideo", v71) && objc_msgSend(v15, "dataStoreSubtype") == 3)
          {
            v10 = 1;
          }
        }

        else
        {
          v10 |= [v15 cplType] == 1;
        }

        if (![v15 resourceType] && (!objc_msgSend(v15, "isDerivative") || -[PLManagedAsset kind](self, "kind")))
        {
          if ([v15 version] == 2 && !objc_msgSend(v15, "isDerivative"))
          {
            obj = 1;
          }

          else if (![v15 version] && (objc_msgSend(v15, "recipeID") == 65943 || objc_msgSend(v15, "recipeID") == 65951))
          {
            v16 = [(PLManagedAsset *)self deferredProcessingNeeded];
            if (v16 == 10 || v16 == 1)
            {
              v17 = [PLResourceModelValidationError unexpectedLocalResourceError:v15];
              v80 = [v12 arrayByAddingObject:v17];

              v76 = 1;
              v82 = 1;
              v12 = v80;
              goto LABEL_28;
            }

            v76 = 1;
          }

          v82 = 1;
        }

LABEL_28:
        v9 |= [v15 resourceType] == 3;
        v18 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:{objc_msgSend(v15, "cplType")}];
        [v75 addObject:v18];
      }

      v7 = v13;
      v8 = [v13 countByEnumeratingWithState:&v102 objects:v113 count:16];
      if (!v8)
      {

        LODWORD(v8) = v76;
        v19 = v82;
        if (v10)
        {
          goto LABEL_34;
        }

        goto LABEL_33;
      }
    }
  }

  v19 = 0;
  obj = 0;
  v9 = 0;
  v12 = MEMORY[0x1E695E0F0];
LABEL_33:
  v20 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Missing original resource.", v71];
  v21 = [v12 arrayByAddingObject:v20];

  v12 = v21;
LABEL_34:
  if ([(PLManagedAsset *)self kind]== 1 && !(([(PLManagedAsset *)self deferredProcessingNeeded]!= 0) | v19 & 1))
  {
    v22 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Video asset missing its image resource."];
    v23 = [v12 arrayByAddingObject:v22];

    v12 = v23;
  }

  if ([(PLManagedAsset *)self hasAdjustments]&& ![(PLManagedAsset *)self deferredProcessingNeeded]&& !(([(PLManagedAsset *)self kind]!= 0) | obj & 1))
  {
    v24 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Adjusted image asset missing its full size render resource."];
    v25 = [v12 arrayByAddingObject:v24];

    v12 = v25;
  }

  v26 = [(PLManagedAsset *)self deferredProcessingNeeded];
  v28 = v26 != 10 && v26 != 1;
  if (((v28 | v8) & 1) == 0)
  {
    v29 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Asset in deferred processing via capture pipline state missing its preview image resource."];
    v30 = [v12 arrayByAddingObject:v29];

    v12 = v30;
  }

  if (!(v9 & 1 | ![(PLManagedAsset *)self isPhotoIris]))
  {
    v31 = [PLResourceModelValidationError missingRequiredResourcesErrorForAsset:self message:@"Live photo with missing video complement resource."];
    v32 = [v12 arrayByAddingObject:v31];

    v12 = v32;
  }

  v100 = 0u;
  v101 = 0u;
  v98 = 0u;
  v99 = 0u;
  obja = v7;
  v85 = self;
  v77 = [obja countByEnumeratingWithState:&v98 objects:v112 count:16];
  if (v77)
  {
    v74 = *v99;
    v33 = MEMORY[0x1E695E0F0];
    do
    {
      v34 = 0;
      do
      {
        if (*v99 != v74)
        {
          objc_enumerationMutation(obja);
        }

        v81 = v34;
        v35 = *(*(&v98 + 1) + 8 * v34);
        v94 = 0u;
        v95 = 0u;
        v96 = 0u;
        v97 = 0u;
        v36 = obja;
        v37 = [v36 countByEnumeratingWithState:&v94 objects:v111 count:16];
        if (v37)
        {
          v38 = v37;
          v39 = *v95;
          v83 = v36;
          do
          {
            for (j = 0; j != v38; ++j)
            {
              if (*v95 != v39)
              {
                objc_enumerationMutation(v36);
              }

              v41 = *(*(&v94 + 1) + 8 * j);
              if (v35 != v41 && ([v33 containsObject:*(*(&v94 + 1) + 8 * j)] & 1) == 0 && PLResourceIdentityIsEqual(v35, v41))
              {
                v110[0] = v35;
                v110[1] = v41;
                v42 = [MEMORY[0x1E695DEC8] arrayWithObjects:v110 count:2];
                v43 = [PLResourceModelValidationError duplicateResourceErrorAmongResources:v42 forAsset:v85];

                v44 = [v12 arrayByAddingObject:v43];

                v109[0] = v35;
                v109[1] = v41;
                v45 = [MEMORY[0x1E695DEC8] arrayWithObjects:v109 count:2];
                v46 = [v33 arrayByAddingObjectsFromArray:v45];

                v36 = v83;
                v33 = v46;
                v12 = v44;
              }
            }

            v38 = [v36 countByEnumeratingWithState:&v94 objects:v111 count:16];
          }

          while (v38);
        }

        v34 = v81 + 1;
      }

      while (v81 + 1 != v77);
      v77 = [v36 countByEnumeratingWithState:&v98 objects:v112 count:16];
    }

    while (v77);
  }

  else
  {
    v33 = MEMORY[0x1E695E0F0];
  }

  v92 = 0u;
  v93 = 0u;
  v90 = 0u;
  v91 = 0u;
  v47 = v75;
  v48 = [v47 countByEnumeratingWithState:&v90 objects:v108 count:16];
  if (v48)
  {
    v49 = v48;
    v50 = *v91;
    do
    {
      for (k = 0; k != v49; ++k)
      {
        if (*v91 != v50)
        {
          objc_enumerationMutation(v47);
        }

        v52 = *(*(&v90 + 1) + 8 * k);
        v53 = [v52 integerValue];
        if (v53)
        {
          v54 = v53;
          v55 = [v47 countForObject:v52];
          v56 = [(PLManagedAsset *)v85 hasAdjustments];
          v57 = v54 > 0x1C || ((1 << v54) & 0x102104FC) == 0;
          v58 = 2;
          if (v57)
          {
            v58 = 1;
          }

          if (!v56)
          {
            v58 = 1;
          }

          if (v55 > v58)
          {
            v59 = [PLResourceModelValidationError duplicatedCPLTypeAssetErrorForAsset:v85 cplType:v54];
            v60 = [v12 arrayByAddingObject:v59];

            v12 = v60;
          }
        }
      }

      v49 = [v47 countByEnumeratingWithState:&v90 objects:v108 count:16];
    }

    while (v49);
  }

  v88 = 0u;
  v89 = 0u;
  v86 = 0u;
  v87 = 0u;
  v61 = obja;
  v62 = [v61 countByEnumeratingWithState:&v86 objects:v107 count:16];
  if (v62)
  {
    v63 = v62;
    v64 = *v87;
    v65 = v73;
    do
    {
      v66 = 0;
      v67 = v12;
      do
      {
        if (*v87 != v64)
        {
          objc_enumerationMutation(v61);
        }

        v68 = [*(*(&v86 + 1) + 8 * v66) validateForAssetID:v73 resourceIdentity:*(*(&v86 + 1) + 8 * v66)];
        v12 = [v67 arrayByAddingObjectsFromArray:v68];

        ++v66;
        v67 = v12;
      }

      while (v63 != v66);
      v63 = [v61 countByEnumeratingWithState:&v86 objects:v107 count:16];
    }

    while (v63);
  }

  else
  {
    v65 = v73;
  }

  v69 = v12;
  return v12;
}

- (id)virtualResourcesThatReplaceMissingPersistedResources:(id)a3
{
  v37 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = objc_alloc_init(MEMORY[0x1E695DF70]);
  if (![(PLManagedAsset *)self hasAdjustments])
  {
    goto LABEL_44;
  }

  [MEMORY[0x1E69BF328] maskForAssetsAllowingVirtualFullSizeRender];
  [(PLManagedAsset *)self savedAssetType];
  if (!PLValidatedSavedAssetTypeApplies())
  {
    goto LABEL_44;
  }

  v28 = self;
  v29 = v4;
  v30 = v5;
  v34 = 0u;
  v35 = 0u;
  v32 = 0u;
  v33 = 0u;
  v6 = v4;
  v7 = [v6 countByEnumeratingWithState:&v32 objects:v36 count:16];
  if (v7)
  {
    v8 = v7;
    v31 = 0;
    v9 = 0;
    v10 = 0;
    v11 = 0;
    v12 = *v33;
    do
    {
      v13 = 0;
      do
      {
        if (*v33 != v12)
        {
          objc_enumerationMutation(v6);
        }

        v14 = *(*(&v32 + 1) + 8 * v13);
        if ([v14 recipeID] == 65938)
        {
          v11 = 1;
        }

        else if ([v14 recipeID] == 131272)
        {
          v10 = 1;
        }

        else if ([v14 recipeID] == 0x20000)
        {
          v9 = 1;
        }

        else if (![v14 recipeID])
        {
          if ([v14 version] || objc_msgSend(v14, "resourceType") != 3)
          {
            if ([v14 version] == 1)
            {
              BYTE4(v31) |= [v14 resourceType] == 3;
            }
          }

          else
          {
            LOBYTE(v31) = 1;
          }
        }

        ++v13;
      }

      while (v8 != v13);
      v15 = [v6 countByEnumeratingWithState:&v32 objects:v36 count:16];
      v8 = v15;
    }

    while (v15);
  }

  else
  {
    v31 = 0;
    v9 = 0;
    v10 = 0;
    v11 = 0;
  }

  v16 = v28;
  v5 = v30;
  if ([(PLManagedAsset *)v28 isPhoto]&& (v11 & 1) == 0)
  {
    v17 = [[PLFullSizeRenderImageVirtualResource alloc] initWithAsset:v28];
    [v30 addObject:v17];
  }

  v18 = [(PLManagedAsset *)v28 additionalAttributes];
  v19 = [v18 unmanagedAdjustment];
  v20 = [v19 adjustmentBaseImageFormat];
  v21 = [v20 integerValue];

  v22 = 0;
  if ((BYTE4(v31) & (v21 == 1)) == 0 && (v31 & (v21 == 0)) == 0)
  {
    if (v21)
    {
      if (v21 != 1)
      {
        v22 = 1;
        goto LABEL_36;
      }

      v23 = [(PLManagedAsset *)v16 persistedPenultimateVideoComplementResource];
    }

    else
    {
      v23 = [(PLManagedAsset *)v16 persistedOriginalVideoComplementResource];
    }

    v22 = v23 == 0;

LABEL_36:
    v24 = [(PLManagedAsset *)v16 managedObjectContext];
    [v24 refreshObject:v16 mergeChanges:{-[PLManagedAsset hasChanges](v16, "hasChanges")}];
  }

  if ([(PLManagedAsset *)v16 isPhotoIris]&& !(([(PLManagedAsset *)v16 playbackStyle]== 1) | (v10 | v22) & 1) && ![PLManagedAsset isPhotoIrisPlaceholderWithPhotoIris:1 videoCpDuration:[(PLManagedAsset *)v16 videoCpDurationValue] isCloudShared:[(PLManagedAsset *)v16 isCloudSharedAsset] videoCpFilePath:0])
  {
    v25 = [[PLFullSizeRenderVideoComplementVirtualResource alloc] initWithAsset:v16];
    [v30 addObject:v25];
  }

  v4 = v29;
  if ([(PLManagedAsset *)v16 isVideo]&& !(v9 & 1 | ![(PLManagedAsset *)v16 hasNonSlomoAdjustments]))
  {
    v26 = [[PLFullSizeRenderVideoVirtualResource alloc] initWithAsset:v16];
    [v30 addObject:v26];
  }

LABEL_44:

  return v5;
}

BOOL __69__PLManagedAsset_RM___anyOriginalNonDerivativeAlternateImageResource__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  v3 = [v2 resourceType] == 4 && !objc_msgSend(v2, "version") && (objc_msgSend(v2, "recipeID") & 1) == 0;

  return v3;
}

- (id)_persistedResourceForResourceIdentity:(id)a3 error:(id *)a4
{
  v42[5] = *MEMORY[0x1E69E9840];
  v7 = a3;
  if (!v7)
  {
    v33 = [MEMORY[0x1E696AAA8] currentHandler];
    [v33 handleFailureInMethod:a2 object:self file:@"PLManagedAsset+RM.m" lineNumber:107 description:{@"Invalid parameter not satisfying: %@", @"identity"}];
  }

  v8 = [(PLManagedAsset *)self managedObjectContext];
  if (_persistedResourceForResourceIdentity_error__s_onceToken != -1)
  {
    dispatch_once(&_persistedResourceForResourceIdentity_error__s_onceToken, &__block_literal_global_96_113285);
  }

  v9 = [v7 uniformTypeIdentifier];
  v10 = [v9 identifier];
  v11 = PLFileTypeFromIdentifier(v10);

  v12 = MEMORY[0x1E695DF70];
  v13 = [v9 compactRepresentation];
  v14 = [v12 arrayWithObject:v13];

  if (v11)
  {
    v15 = [v9 identifier];
    v16 = [@"_" stringByAppendingString:v15];

    [v14 addObject:v16];
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __66__PLManagedAsset_RM___persistedResourceForResourceIdentity_error___block_invoke_2;
  aBlock[3] = &unk_1E7577980;
  v17 = v7;
  v38 = v17;
  v18 = v14;
  v39 = v18;
  v40 = self;
  v19 = _Block_copy(aBlock);
  if ([(PLManagedAsset *)self isInserted])
  {
    v20 = v19[2](v19);
  }

  else if (([(PLManagedAsset *)self hasFaultForRelationshipNamed:@"modernResources"]& 1) != 0 || (v19[2](v19), (v20 = objc_claimAutoreleasedReturnValue()) == 0))
  {
    v21 = _persistedResourceForResourceIdentity_error__s_fetchPredicateTemplate;
    v41[0] = @"ASSET";
    v34 = [(PLManagedAsset *)self objectID];
    v42[0] = v34;
    v41[1] = @"RESOURCE_TYPE";
    v22 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(v17, "resourceType")}];
    v42[1] = v22;
    v41[2] = @"VERSION";
    v35 = a4;
    v23 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(v17, "version")}];
    v42[2] = v23;
    v41[3] = @"RECIPEID";
    v24 = v8;
    v25 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(v17, "recipeID")}];
    v41[4] = @"UTIS";
    v42[3] = v25;
    v42[4] = v18;
    v26 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v42 forKeys:v41 count:5];
    v27 = [v21 predicateWithSubstitutionVariables:v26];

    v8 = v24;
    v28 = +[PLInternalResource fetchRequest];
    [v28 setPredicate:v27];
    v36 = 0;
    v29 = [v8 executeFetchRequest:v28 error:&v36];
    v30 = v36;
    v20 = [v29 firstObject];

    if (v35 && v30)
    {
      v31 = v30;
      *v35 = v30;
    }
  }

  return v20;
}

id __66__PLManagedAsset_RM___persistedResourceForResourceIdentity_error___block_invoke_2(uint64_t a1)
{
  v14[4] = *MEMORY[0x1E69E9840];
  v2 = _persistedResourceForResourceIdentity_error__s_intraAssetPredicateTemplate;
  v13[0] = @"RESOURCE_TYPE";
  v3 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(*(a1 + 32), "resourceType")}];
  v14[0] = v3;
  v13[1] = @"VERSION";
  v4 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(*(a1 + 32), "version")}];
  v14[1] = v4;
  v13[2] = @"RECIPEID";
  v5 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{objc_msgSend(*(a1 + 32), "recipeID")}];
  v13[3] = @"UTIS";
  v6 = *(a1 + 40);
  v14[2] = v5;
  v14[3] = v6;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v14 forKeys:v13 count:4];
  v8 = [v2 predicateWithSubstitutionVariables:v7];

  v9 = [*(a1 + 48) modernResources];
  v10 = [v9 filteredSetUsingPredicate:v8];
  v11 = [v10 anyObject];

  return v11;
}

void __66__PLManagedAsset_RM___persistedResourceForResourceIdentity_error___block_invoke()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset == $ASSET AND resourceType == $RESOURCE_TYPE AND version == $VERSION AND recipeID == $RECIPEID and compactUTI IN $UTIS"];
  v1 = _persistedResourceForResourceIdentity_error__s_fetchPredicateTemplate;
  _persistedResourceForResourceIdentity_error__s_fetchPredicateTemplate = v0;

  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"resourceType == $RESOURCE_TYPE AND version == $VERSION AND recipeID == $RECIPEID and compactUTI IN $UTIS"];
  v3 = _persistedResourceForResourceIdentity_error__s_intraAssetPredicateTemplate;
  _persistedResourceForResourceIdentity_error__s_intraAssetPredicateTemplate = v2;
}

+ (id)fetchResourcesForAssetWithObjectID:(id)a3 inContext:(id)a4 versions:(id)a5 includeVirtualResources:(BOOL)a6 allowDerivatives:(BOOL)a7 excludeDynamicCPLResources:(BOOL)a8 additionalPredicate:(id)a9 relationshipKeyPathsForPrefetching:(id)a10 error:(id *)a11
{
  v44 = a8;
  v11 = a7;
  v12 = a6;
  v49[1] = *MEMORY[0x1E69E9840];
  v16 = a3;
  v17 = a4;
  v18 = a5;
  v19 = v16;
  v20 = a9;
  v48 = a10;
  if (v19)
  {
    if (v17)
    {
      goto LABEL_3;
    }
  }

  else
  {
    v41 = [MEMORY[0x1E696AAA8] currentHandler];
    [v41 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+RM.m" lineNumber:1026 description:{@"Invalid parameter not satisfying: %@", @"assetObjectID"}];

    if (v17)
    {
      goto LABEL_3;
    }
  }

  v42 = [MEMORY[0x1E696AAA8] currentHandler];
  [v42 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+RM.m" lineNumber:1027 description:{@"Invalid parameter not satisfying: %@", @"context"}];

LABEL_3:
  v21 = [MEMORY[0x1E695DF70] array];
  v45 = v12;
  if (v12)
  {
    v22 = [MEMORY[0x1E695DF70] array];
    if (v18)
    {
      v23 = [MEMORY[0x1E696AE18] predicateWithFormat:@"version IN %@", v18];
      [v22 addObject:v23];
    }

    if (!v11)
    {
      v24 = [objc_opt_class() predicateFilteringForNonDerivativeRecipeIDs];
      [v22 addObject:v24];
    }

    v25 = v17;
    v43 = v18;
    if (v20)
    {
      [v22 addObject:v20];
    }

    v26 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v22];
    v27 = [PLManagedAsset assetWithObjectID:v19 inManagedObjectContext:v25];
    v28 = [v27 nonPersistedResourcesWithOptions:0];
    v29 = [v28 filteredArrayUsingPredicate:v26];

    [v21 addObjectsFromArray:v29];
    v18 = v43;
  }

  else
  {
    v27 = 0;
    v25 = v17;
    v26 = 0;
  }

  v30 = a1;
  v47 = v19;
  v31 = v19;
  v32 = v18;
  v33 = [v30 fetchRequestForResourcesWithObjectID:v31 versions:v18 allowDerivatives:v11 excludeDynamicCPLResources:v44 additionalPredicate:v20 relationshipKeyPathsForPrefetching:v48];
  v34 = v25;
  v35 = [v25 executeFetchRequest:v33 error:a11];
  [v21 addObjectsFromArray:v35];
  if (v45)
  {
    v36 = [v27 virtualResourcesThatReplaceMissingPersistedResources:v35];
    v37 = [v36 filteredArrayUsingPredicate:v26];

    [v21 addObjectsFromArray:v37];
  }

  v38 = [MEMORY[0x1E696AEB0] sortDescriptorWithKey:@"qualitySortValue" ascending:1];
  v49[0] = v38;
  v39 = [MEMORY[0x1E695DEC8] arrayWithObjects:v49 count:1];
  [v21 sortUsingDescriptors:v39];

  return v21;
}

+ (id)fetchRequestForResourcesWithObjectID:(id)a3 versions:(id)a4 allowDerivatives:(BOOL)a5 excludeDynamicCPLResources:(BOOL)a6 additionalPredicate:(id)a7 relationshipKeyPathsForPrefetching:(id)a8
{
  v10 = a6;
  v13 = a3;
  v14 = a4;
  v15 = a7;
  v16 = MEMORY[0x1E695DF70];
  v17 = a8;
  v18 = [v16 array];
  if (v14)
  {
    v19 = [MEMORY[0x1E696AE18] predicateWithFormat:@"version IN %@", v14];
    [v18 addObject:v19];
  }

  if (a5)
  {
    if (!v10)
    {
      goto LABEL_8;
    }

    v20 = [objc_opt_class() predicateExcludingLocallyUnavailableDynamicCPLResources];
  }

  else
  {
    v20 = [objc_opt_class() predicateFilteringForNonDerivativeRecipeIDs];
  }

  v21 = v20;
  [v18 addObject:v20];

LABEL_8:
  if (v15)
  {
    [v18 addObject:v15];
  }

  v22 = [MEMORY[0x1E696AE18] predicateWithFormat:@"asset == %@", v13];
  [v18 addObject:v22];

  v23 = +[PLInternalResource fetchRequest];
  v24 = [MEMORY[0x1E696AB28] andPredicateWithSubpredicates:v18];
  [v23 setPredicate:v24];

  [v23 setRelationshipKeyPathsForPrefetching:v17];
  [v23 setReturnsObjectsAsFaults:0];

  return v23;
}

+ (void)enumerateImageRequestHintData:(id)a3 assetWidth:(int64_t)a4 assetHeight:(int64_t)a5 libraryID:(id)a6 startingOffset:(int64_t)a7 assetID:(id)a8 block:(id)a9
{
  v56 = *MEMORY[0x1E69E9840];
  v16 = a3;
  v47 = a6;
  v46 = a8;
  v45 = a9;
  v53 = 0;
  v17 = [v16 bytes];
  v44 = v16;
  v18 = [v16 length];
  v49 = 0;
  v50 = &v49;
  v51 = 0x2020000000;
  v52 = a7;
  if (v18 - 1 < a7)
  {
    v43 = [MEMORY[0x1E696AAA8] currentHandler];
    [v43 handleFailureInMethod:a2 object:a1 file:@"PLManagedAsset+RM.m" lineNumber:616 description:@"enumerateImageRequestHintData: startingOffset must be less than hint length when data is available."];
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __114__PLManagedAsset_RM__enumerateImageRequestHintData_assetWidth_assetHeight_libraryID_startingOffset_assetID_block___block_invoke;
  aBlock[3] = &unk_1E75779F0;
  aBlock[4] = &v49;
  aBlock[5] = v18;
  v19 = _Block_copy(aBlock);
  v20 = v50 + 3;
  v21 = v50[3];
  if (v21 < v18 && (v53 & 1) == 0)
  {
    v22 = a4;
    v23 = a5;
    v24 = (a5 * a4);
    while (1)
    {
      v25 = v17 + v21;
      *v20 = v21 + 3;
      v26 = *(v17 + v21 + 2) & 3;
      v27 = PLDataStoreForClassIDAndLibraryID(v26, v47);
      if (!v27)
      {
        break;
      }

      v28 = [objc_opt_class() keyLengthWithDataPreview:*(v17 + v50[3])];
      if (!v28)
      {
        v41 = PLBackendGetLog();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
        {
          v42 = [v46 uuid];
          *buf = 138543362;
          v55 = v42;
          _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_ERROR, "Invalid keyLen. Exiting hint enumeration for assetID: %{public}@", buf, 0xCu);
        }

        goto LABEL_29;
      }

      v29 = v50[3];
      _ZF = v26 == 3 || v26 == 0;
      if (_ZF && *(v17 + v29) >= 0x10u)
      {
        v31 = PLBackendGetLog();
        if (os_log_type_enabled(v31, OS_LOG_TYPE_ERROR))
        {
          v32 = [v46 uuid];
          *buf = 138543362;
          v55 = v32;
          _os_log_impl(&dword_19BF1F000, v31, OS_LOG_TYPE_ERROR, "Invalid FilePath strategy hint data. Skipping hint assetID: %{public}@", buf, 0xCu);
        }

        v19[2](v19, v28);
      }

      else
      {
        if (v26 > 1)
        {
          [v27 keyFromKeyStruct:v17 + v29];
        }

        else
        {
          [PLTaggedPointerDataStoreKey keyWithKeyStruct:v17 + v29 keyLength:v28 forStoreClassID:v26 inLibraryWithID:v47];
        }
        v33 = ;
        v34 = [v33 recipeIDForAssetID:v46];
        v19[2](v19, v28);
        _H0 = *v25;
        __asm { FCVT            D0, H0 }

        v40 = sqrt(_D0);
        *&v40 = round(v22 / v40) * round(v23 / v40) / v24;
        (*(v45 + 2))(v45, v50[3], (*(v25 + 2) >> 2) & 1, (*(v25 + 2) >> 3) & 1, v27, v33, v25, v28 + 3, *&v40, v34, &v53);
      }

      v20 = v50 + 3;
      v21 = v50[3];
      if (v21 >= v18 || (v53 & 1) != 0)
      {
        goto LABEL_30;
      }
    }

    v41 = PLImageManagerGetLog();
    if (os_log_type_enabled(v41, OS_LOG_TYPE_ERROR))
    {
      *buf = 67109120;
      LODWORD(v55) = v26;
      _os_log_impl(&dword_19BF1F000, v41, OS_LOG_TYPE_ERROR, "[RM]: unable to parse image request hints (can't find data store class for classID: %d", buf, 8u);
    }

    v27 = 0;
LABEL_29:
  }

LABEL_30:

  _Block_object_dispose(&v49, 8);
}

uint64_t __114__PLManagedAsset_RM__enumerateImageRequestHintData_assetWidth_assetHeight_libraryID_startingOffset_assetID_block___block_invoke(uint64_t result, unsigned int a2)
{
  *(*(*(result + 32) + 8) + 24) += a2;
  v2 = *(*(result + 32) + 8);
  if (!a2 || *(v2 + 24) >= *(result + 40))
  {
    *(v2 + 24) = 0x7FFFFFFFFFFFFFFFLL;
  }

  return result;
}

+ (id)calculateImageRequestHintsFromSortedResources:(id)a3 asset:(id)a4
{
  v50 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v40 = [MEMORY[0x1E695DF88] data];
  v43 = 0u;
  v44 = 0u;
  v45 = 0u;
  v46 = 0u;
  v7 = v5;
  v8 = 0x1E695D000uLL;
  obj = v7;
  v9 = [v7 countByEnumeratingWithState:&v43 objects:v49 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v44;
    v39 = *v44;
    do
    {
      v12 = 0;
      v41 = v10;
      do
      {
        if (*v44 != v11)
        {
          objc_enumerationMutation(obj);
        }

        v13 = *(*(&v43 + 1) + 8 * v12);
        if (PLCanIncludeResourceInHints(v13, v6))
        {
          v14 = [v6 width];
          v15 = [v6 height];
          v16 = v13;
          v17 = [*(v8 + 3976) dataWithCapacity:3];
          v18 = [v16 dataStoreKey];
          v19 = [v18 keyData];

          if (v19)
          {
            v20 = [v16 dataStore];
            if (v20)
            {
              v21 = [objc_opt_class() storeClassID];
              v22 = [v16 unorientedWidth];
              v23 = [v16 unorientedHeight];
              _H0 = 5120;
              if (v15 * v14 >= 1)
              {
                _H0 = 5120;
                if (v23 * v22 >= 1)
                {
                  _S0 = 1.0 / ((v23 * v22) / (v15 * v14));
                  __asm { FCVT            H0, S0 }
                }
              }

              v30 = v21 & 3;
              if (fabsl(*&_H0) == COERCE_SHORT_FLOAT(31744))
              {
                v31 = COERCE_SHORT_FLOAT(31743);
              }

              else
              {
                v31 = *&_H0;
              }

              if ([v16 recipeID] == 65749)
              {
                LOWORD(v32) = COERCE_UNSIGNED_INT(1.0);
              }

              else
              {
                v32 = v31;
              }

              v47 = v32;
              v33 = [v16 uniformTypeIdentifier];
              if ([v33 isPrimaryImageFormat])
              {
                v34 = 4;
              }

              else
              {
                v34 = 0;
              }

              v35 = v34 | v30;

              if ([v16 isDefaultOrientation])
              {
                v36 = 8;
              }

              else
              {
                v36 = 0;
              }

              v48 = v35 | v36;
              [v17 appendBytes:&v47 length:3];
              [v17 appendData:v19];
              v37 = v17;
              v8 = 0x1E695D000;
            }

            else
            {
              v37 = 0;
            }

            v11 = v39;
          }

          else
          {
            v37 = 0;
          }

          if ([v37 length])
          {
            [v40 appendData:v37];
          }

          v10 = v41;
        }

        ++v12;
      }

      while (v10 != v12);
      v10 = [obj countByEnumeratingWithState:&v43 objects:v49 count:16];
    }

    while (v10);
  }

  return v40;
}

+ (id)debugDescriptionForHintData:(id)a3 assetWidth:(int64_t)a4 assetHeight:(int64_t)a5 assetID:(id)a6
{
  v10 = a6;
  v11 = MEMORY[0x1E696AD60];
  v12 = a3;
  v13 = objc_alloc_init(v11);
  v14 = [v10 uuid];
  [v13 appendFormat:@"Image request hints for %@", v14];

  v15 = [v10 libraryID];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __81__PLManagedAsset_RM__debugDescriptionForHintData_assetWidth_assetHeight_assetID___block_invoke;
  v21[3] = &unk_1E75779C8;
  v16 = v13;
  v22 = v16;
  v23 = v10;
  v17 = v10;
  [a1 enumerateImageRequestHintData:v12 assetWidth:a4 assetHeight:a5 libraryID:v15 startingOffset:0 assetID:v17 block:v21];

  v18 = v23;
  v19 = v16;

  return v16;
}

void __81__PLManagedAsset_RM__debugDescriptionForHintData_assetWidth_assetHeight_assetID___block_invoke(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, void *a6)
{
  v7 = *(a1 + 32);
  v8 = a6;
  v11 = DCIM_NSStringFromCGSize();
  v9 = [v8 fileURLForAssetID:*(a1 + 40)];

  v10 = [v9 path];
  [v7 appendFormat:@"\n  %@ %@", v11, v10];
}

+ (id)predicateExcludingLocallyUnavailableDynamicCPLResources
{
  if (predicateExcludingLocallyUnavailableDynamicCPLResources_s_onceToken != -1)
  {
    dispatch_once(&predicateExcludingLocallyUnavailableDynamicCPLResources_s_onceToken, &__block_literal_global_54);
  }

  v3 = predicateExcludingLocallyUnavailableDynamicCPLResources_s_predicate;

  return v3;
}

void __77__PLManagedAsset_RM__predicateExcludingLocallyUnavailableDynamicCPLResources__block_invoke()
{
  v9[4] = *MEMORY[0x1E69E9840];
  v0 = MEMORY[0x1E696AB28];
  v1 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K = %d", @"dataStoreClassID", 0];
  v9[0] = v1;
  v2 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K != %d", @"dataStoreSubtype", 0];
  v9[1] = v2;
  v3 = [MEMORY[0x1E696AE18] predicateWithFormat:@"%K < %d", @"localAvailability", 1];
  v9[2] = v3;
  v4 = [MEMORY[0x1E6994B90] predicateMatchingDynamicFingerprintForKey:@"fingerprint"];
  v9[3] = v4;
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:4];
  v6 = [v0 andPredicateWithSubpredicates:v5];
  v7 = [v0 notPredicateWithSubpredicate:v6];
  v8 = predicateExcludingLocallyUnavailableDynamicCPLResources_s_predicate;
  predicateExcludingLocallyUnavailableDynamicCPLResources_s_predicate = v7;
}

+ (id)predicateFilteringForNonDerivativeRecipeIDs
{
  if (predicateFilteringForNonDerivativeRecipeIDs_s_onceToken != -1)
  {
    dispatch_once(&predicateFilteringForNonDerivativeRecipeIDs_s_onceToken, &__block_literal_global_113364);
  }

  v3 = predicateFilteringForNonDerivativeRecipeIDs_s_predicate;

  return v3;
}

void __65__PLManagedAsset_RM__predicateFilteringForNonDerivativeRecipeIDs__block_invoke()
{
  v0 = [MEMORY[0x1E696AE18] predicateWithFormat:@"(%K == %d) || (%K & %d) != %d", @"recipeID", 0, @"recipeID", 1, 1];
  v1 = predicateFilteringForNonDerivativeRecipeIDs_s_predicate;
  predicateFilteringForNonDerivativeRecipeIDs_s_predicate = v0;
}

@end