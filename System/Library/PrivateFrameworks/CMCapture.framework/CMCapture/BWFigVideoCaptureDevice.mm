@interface BWFigVideoCaptureDevice
+ (uint64_t)_autofocusProcessorImageControlModeFromImageControlMode:(uint64_t)mode;
+ (void)initialize;
- ($06E035DAA80D7DA92D7AC3530BEA5F2A)bravoStreamSelectionConfiguration;
- ($06E035DAA80D7DA92D7AC3530BEA5F2A)bravoStreamSelectionConfigurationForRecording;
- ($273FE01EDA4852E8FFB0AF95686D18CC)maximumFrameRate;
- ($273FE01EDA4852E8FFB0AF95686D18CC)minimumFrameRate;
- ($2825F4736939C4A6D3AD43837233062D)sensorRawPoolDimensions;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)exposureDuration;
- ($3CC8671D27C23BF42ADDB32F2B5E48AE)zeroShutterLagEarliestAllowedPTS;
- ($AF35DC73A926DCC9144999D480AEA670)sphereShiftState;
- ($E2C29196C7A5C696474C6955C5A9CE06)deviceWhiteBalanceGains;
- ($E2C29196C7A5C696474C6955C5A9CE06)grayWorldDeviceWhiteBalanceGains;
- (BOOL)_depthDataDeliveryOrStereoPhotoCaptureUseSecondaryStream:(_BOOL8)result primaryStream:;
- (BOOL)_isLowLightSceneUsingFrameStatisticsByPortType:(uint64_t)type;
- (BOOL)_ubAWBReflowEnabledForCaptureType:(uint64_t)type primaryPortType:(void *)portType frameStatisticsByPortType:(void *)byPortType previewMetadata:;
- (BOOL)_ubDeliverDeferredPhotoProxyImageForCaptureType:(uint64_t)type captureFlags:(int)flags autoDeferredProcessingEnabled:;
- (BOOL)_ubGenerateLTMCurveForCaptureStream:(void *)stream frameStatistics:;
- (BOOL)_ubIsAutoFlashForSceneFlags:(int)flags digitalFlashModeForSceneMonitoring:;
- (BOOL)_ubIsFlashAvailable;
- (BOOL)_ubIsSuperWidePreferredOrCurrentPrimaryCaptureStreamInWideZoomRange;
- (BOOL)_ubUseSquareRootToneCurveForNonHDRCapturesUsingFrameStatistics:(void *)statistics captureParameters:(unint64_t)parameters sceneFlags:;
- (BOOL)_ubZeroShutterLagCancelWaitingForTimeMachines;
- (BOOL)bravoStreamSelectionConfigurationForRecordingEnabled;
- (BOOL)globalToneMappingEnabled;
- (BOOL)isPortTypeUsingZoomBasedSourceSensorRaws:(id)raws;
- (BOOL)isPropertyObserved:(id)observed;
- (BOOL)learnedNRUltraHighResolutionDowngradeSupported;
- (BOOL)needsToRelieveSystemPressure;
- (BOOL)portraitPreviewForegroundBlurEnabled;
- (BOOL)restorationOfForcedOffOverCaptureActiveSlaveStreamEnabled;
- (BOOL)setAutoFlashEnabled:(BOOL)enabled error:(id *)error;
- (BOOL)smartFramingIsMonitoringScene;
- (BOOL)supportsWideColor;
- (BOOL)ultraHighResolutionZeroShutterLagEnabled;
- (BWAdaptiveBracketingController)adaptiveUnifiedBracketingController;
- (BWFigVideoCaptureDevice)initWithCaptureDevice:(id)device attributes:(id)attributes synchronizedStreamsAttributes:(id)streamsAttributes unsynchronizedStreamsAttributes:(id)unsynchronizedStreamsAttributes multiCamEnabled:(BOOL)enabled midFrameSynchronizationEnabled:(BOOL)synchronizationEnabled applicationID:(id)d clientAuditToken:(id *)self0 tccIdentity:(id)self1 mediaEnvironment:(id)self2 deviceClientPriority:(int)self3 error:(int *)self4;
- (BWFigVideoCaptureStream)masterCaptureStream;
- (BWStillImageCaptureSettings)_stillImageCaptureSettingsWithID:(uint64_t)d captureType:(unsigned int)type deliverOriginalImage:(unsigned int)image deliverSushiRaw:(void *)raw bravoConstituentImageDeliveryDeviceTypes:(id)types clientBracketSettings:(uint64_t)settings captureFlags:(__int128 *)flags userInitiatedRequestPTS:(uint64_t)self0 frameStatisticsByPortType:;
- (BWStillImageCaptureSettings)_stillImageCaptureSettingsWithSettings:(uint64_t)settings;
- (BWStillImageCaptureSettings)_ubStillImageCaptureSettingsWithSettings:(unsigned __int8)settings speedOverQualityCaptureEnabled:;
- (CGRect)centerStageRectOfInterest;
- (CGRect)regionOfInterestWithoutOverscan;
- (CGSize)defaultAutoFocusTapWindowSize;
- (CGSize)defaultContinuousAutoFocusWindowSize;
- (CGSize)nonDestructiveCropSize;
- (CMTime)_collectPearlProjectorUpTime:(int)time isStillImage:;
- (CMTime)_updateMLVNRActiveTime:(CMTime *)result;
- (NSArray)bravoStreamSelectionEligibleFallbackPortTypes;
- (NSArray)smartCropCandidateFramingRects;
- (NSDictionary)moduleCalibrationByPortType;
- (NSDictionary)sensorRawPoolRequirements;
- (NSNumber)globalToneMappingEnabledOverride;
- (NSString)description;
- (NSString)orientation;
- (NSString)smartCameraStatus;
- (_BYTE)_ubIsHDRCaptureUsingSceneFlags:(_BYTE *)result;
- (_DWORD)_collectPearlTemperatureStatistics:(_DWORD *)result;
- (__n128)_resetAnalyticsData;
- (double)_setupZoomRampTuning;
- (double)_ubZeroShutterLagFrameSelectionForCaptureType:(uint64_t)type@<X2> captureFlags:(void *)flags@<X3> captureParameters:(void *)parameters@<X4> timeMachineFrameMetadata:(int)metadata@<W5> mainFrameCount:(__int128 *)count@<X6> userInitiatedRequestPTS:(uint64_t)s@<X8>;
- (double)previewShiftInSensorSpace;
- (float)ISO;
- (float)_baseZoomFactorForZoomFactor:(uint64_t)factor;
- (float)_exifFocalLengthOverrideForZoomFactor:(uint64_t)factor;
- (float)_minimumFrameRateForStreamingImageIntent:(void *)intent masterPortType:;
- (float)_nextLargerBaseZoomFactorForRequestedZoomFactor:(uint64_t)factor;
- (float)_updateTimeOfFlightStreamingTime:(float)result;
- (float)exposureTargetBias;
- (float)exposureTargetOffset;
- (float)lensPosition;
- (float)masterCaptureStreamLastFrameEIT;
- (float)parallaxMitigationStrengthAndTargetCaptureStream:(id *)stream;
- (float)requestedZoomFactorRelativeToPortType:(id)type;
- (float)timeLapseCaptureRate;
- (float)torchLevel;
- (float)zoomFactor;
- (id)_autoExposureBracketValuesForSettings:(id)result frameStatistics:;
- (id)_clientBracketSettingsWithSettings:(uint64_t)settings frameStatisticsByPortType:;
- (id)_collectAPSMacroInstabilityStatistics:(id *)result;
- (id)_initWithCaptureDevice:(id)device attributes:(id)attributes synchronizedStreamsAttributes:(id)streamsAttributes unsynchronizedStreamsAttributes:(id)unsynchronizedStreamsAttributes multiCamEnabled:(BOOL)enabled midFrameSynchronizationEnabled:(BOOL)synchronizationEnabled applicationID:(id)d clientAuditToken:(id *)self0 tccIdentity:(id)self1 mediaEnvironment:(id)self2 deviceVendor:(id)self3 createAutofocusSampleBufferProcessorFunction:(void *)self4 cameraParameters:(id)self5 deviceClientPriority:(int)self6 error:(int *)self7;
- (id)_manualExposureBracketParametersForSettings:(uint64_t)settings frameStatistics:(int)statistics use8dot8FixedPointGain:;
- (id)_updateSensorRegionsOfInterestBasedOnZoomFactor:(id *)result aspectRatio:(float)ratio;
- (id)cameraInfoByPortTypeIncludingLSCGains:(BOOL)gains includeCameraInfoForSensorRawProcessing:(BOOL)processing;
- (id)digitalFlashExposureTimes;
- (id)preferredMasterPortTypeForZoomFactor:(float)factor;
- (id)sceneClassificationConfidences;
- (id)stillImageCaptureSettingsWithSettings:(id)settings speedOverQualityCaptureEnabled:(BOOL)enabled;
- (id)synchronizationPrimaryForMidFrameSynchronizationEnabled:(BOOL)enabled;
- (int)_setupAutofocusSampleBufferProcessor;
- (int)aspectRatio;
- (int)autoImageControlMode;
- (int)captureStillImageNowWithSettings:(id)settings captureSettings:(id)captureSettings;
- (int)depthDataBaseRotation;
- (int)digitalFlashStatus;
- (int)maxStillImageCaptureBufferCountForHDRMode:(int)mode digitalFlashMode:(int)flashMode qualityPrioritization:(int)prioritization clientBracketCount:(int)count bravoConstituentImageDeliveryDeviceTypes:(id)types;
- (int)peakPowerSystemPressureLevel;
- (int)sensorRawHighResolutionFlavorForDimensions:(id)dimensions;
- (int)setAutomaticallyAdjustsImageControlMode:(BOOL)mode;
- (int)setAutomaticallyAdjustsTorch:(BOOL)torch;
- (int)setContinuousAutoFocusRect:(CGRect)rect isFocusRectInOverscanSpace:(BOOL)space;
- (int)setDeskViewAutoExposureAreaOfInterest:(CGRect)interest;
- (int)setExposureModeCustomWithExposureDuration:(id *)duration minFrameRate:(double)rate maxFrameRate:(double)frameRate ISO:(float)o requestID:(int)d;
- (int)setExposureModeLocked;
- (int)setExposureTargetBias:(float)bias requestID:(int)d;
- (int)setFaceDetectionDrivenImageProcessingMode:(int)mode;
- (int)setFocusModeAutoWithRect:(CGRect)rect restrictToRect:(BOOL)toRect continuous:(BOOL)continuous smooth:(BOOL)smooth rangeRestrictionNear:(float)near rangeRestrictionFar:(float)far isFocusRectInOverscanSpace:(BOOL)space;
- (int)setFocusModeManualWithLensPosition:(float)position requestID:(int)d;
- (int)setImageControlMode:(int)mode;
- (int)setProvidesStortorgetMetadata:(BOOL)metadata;
- (int)setSmartFramingEnabledFieldsOfView:(id)view;
- (int)setStillImageSceneMonitoringFlashMode:(int)mode hdrMode:(int)hdrMode qualityPrioritization:(int)prioritization digitalFlashMode:(int)flashMode;
- (int)setSubjectAreaChangeMonitoringEnabled:(BOOL)enabled;
- (int)setTorchLevel:(float)level;
- (int)setWhiteBalanceModeAuto;
- (int)setWhiteBalanceModeLockedWithGains:(id)gains requestID:(int)d;
- (int)shallowDepthOfFieldEffectStatus;
- (int)shallowDepthOfFieldStagePreviewStatus;
- (int)smartFramingConfiguredFieldOfView;
- (int)smartFramingSuggestedFieldOfView;
- (int)stereoVideoCaptureStatus;
- (int)streamingDigitalFlashMode;
- (int)systemPressureLevel;
- (int)thermalSystemPressureLevel;
- (int)timeOfFlightProjectorMode;
- (os_unfair_lock_s)_addStereoVideoCaptureSceneMonitoringMetadataToSampleBuffer:(os_unfair_lock_s *)result;
- (uint64_t)_addADRCExposureRealizedGainToStillImageSampleBuffer:(uint64_t)result;
- (uint64_t)_addAutofocusAndDiagnosticMetadata:(uint64_t)result;
- (uint64_t)_addDropFrameWaitingForTorchToRampUpKey:(uint64_t)result;
- (uint64_t)_addValidationAndCoreRepairStatusesToSampleBuffer:(uint64_t)result;
- (uint64_t)_bravoCameraForOISOrSISCaptureType:(uint64_t)result stereoFusionMode:(float)mode frameStatisticsByPortType:(float)type zoomFactor:(float)factor stereoFusionLowerBoundZoomFactor:(uint64_t)zoomFactor stereoFusionUpperBoundZoomFactor:(int)boundZoomFactor;
- (uint64_t)_captureStreamBasedSolelyOnZoomFactor:(uint64_t)factor;
- (uint64_t)_captureStreamForFaceDetectionWithMasterStreamSwitchoverSuspended:(uint64_t)suspended;
- (uint64_t)_checkCriticalFocusError:(uint64_t)result;
- (uint64_t)_checkSphereJitterDetection:(uint64_t)result;
- (uint64_t)_collectSensorTemperatureStatistics:(uint64_t)result;
- (uint64_t)_convertStillImageCaptureSettings:(void *)settings toStillImageCaptureNowOptions:(void *)options captureStreamPropertyValues:;
- (uint64_t)_copyAutofocusProcessorProperty:(uint64_t)property propertyValueOut:;
- (uint64_t)_copyAutofocusProcessorPropertyInternal:(uint64_t)result propertyValueOut:;
- (uint64_t)_copyCurrentFrameStatistics;
- (uint64_t)_createBWFigVideoCaptureStreamsForCaptureStreams:(void *)streams attributeDictionaries:(void *)dictionaries cameraParameters:synchronizedStreamsGroup:clientAuditToken:tccIdentity:mediaEnvironment:;
- (uint64_t)_currentStreamingImageIntent;
- (uint64_t)_deliverDepthDataForSettings:(uint64_t)result;
- (uint64_t)_deviceWillStartStreaming;
- (uint64_t)_focusIsStable:(uint64_t)result;
- (uint64_t)_initiateCaptureStillImageNowWithPTS:(uint64_t)result completionHandler:;
- (uint64_t)_isBaseZoomFactorOrNondisruptiveSwitchingFormatBaseZoomFactor:(uint64_t)result;
- (uint64_t)_ltmCurveForStreamingImageIntent:(uint64_t)result;
- (uint64_t)_overCaptureActiveSlaveStreamForZoomFactor:(char)factor masterStream:currentFrameRate:preferWider:;
- (uint64_t)_overCaptureMasterStreamForZoomFactor:(uint64_t)factor;
- (uint64_t)_postSDOFEffectStatus:(uint64_t)result SDOFStagePreviewStatus:;
- (uint64_t)_propagateStillImageSettings:(uint64_t)result toCMIOCaptureOptions:;
- (uint64_t)_reportCameraSwitchAnalyticsData:(void *)data recommendedMasterStream:(uint64_t)stream frameStatisticsByPortType:(const __CFDictionary *)type metadata:;
- (uint64_t)_reportDeskViewStreamingSessionCoreAnalyticsData;
- (uint64_t)_reportStreamingSessionCoreAnalyticsData;
- (uint64_t)_resolveStillImageCaptureTypeFromStatisticsByPortType:(void *)type masterCaptureStream:(int)stream flashMode:(int)mode hdrMode:(int)hdrMode qualityPrioritization:(int)prioritization stereoFusionMode:(int)fusionMode depthDataDeliveryEnabled:(void *)enabled bravoConstituentImageDeliveryDeviceTypes:(char)self0 burstQualityCaptureEnabled:(int)self1 clientBracketMode:(char)self2 forSceneMonitoring:(uint64_t *)self3 captureFlags:;
- (uint64_t)_resumeTimeMachines;
- (uint64_t)_sendInitialValuesToPortraitEffectPropertiesDelegate:(uint64_t)result;
- (uint64_t)_sendMacroFocusChangedNotification:(uint64_t)result;
- (uint64_t)_setAutoImageControlMode:(void *)mode completionHandler:;
- (uint64_t)_setAutofocusProcessorImageControlModeProperty:(uint64_t)result;
- (uint64_t)_setAutofocusProcessorProperty:(uint64_t)property propertyValue:;
- (uint64_t)_setAutofocusProcessorPropertyInternal:(const void *)internal propertyValue:;
- (uint64_t)_setExposureModeAutoWithRect:(double)rect isDefaultRect:(double)defaultRect;
- (uint64_t)_setMinimumFrameRate:(unsigned int)rate;
- (uint64_t)_setPropertySensorRawBufferPoolRetainCount:(id *)count;
- (uint64_t)_setSmoothFocusEnabled:(uint64_t)enabled;
- (uint64_t)_setSynchronizedStreamsGroupProperty:(uint64_t)result value:;
- (uint64_t)_setupMacroFocusDetection;
- (uint64_t)_setupStillImageCaptureStateMachine;
- (uint64_t)_shouldDeferAutofocusProcessorProperty:(void *)property value:;
- (uint64_t)_shouldUseSphereForStillImageCaptureTakingLowLightIntoAccount:(uint64_t)result deviceMotionActivity:(int)activity frameStatisticsByPortType:(int)type;
- (uint64_t)_stillImageSceneTypeForCaptureStream:(void *)stream frameStatisticsByPortType:(int)type flashMode:(int)mode hdrMode:(int)hdrMode qualityPrioritization:(int)prioritization digitalFlashMode:(unint64_t *)flashMode sceneFlags:;
- (uint64_t)_suspendTimeMachineWithCompletionHandler:(uint64_t)result;
- (uint64_t)_teardownAutoFocusSampleBufferProcessor;
- (uint64_t)_tryZeroShutterLagReferenceFrameSelectionWithZeroShutterLagPTS:(uint64_t)s captureType:(uint64_t)type captureFlags:(const __CFArray *)flags framesMetadata:(int)metadata frameCount:(_DWORD *)count referenceFrameBracketedCaptureSequenceNumberOut:(CMTime *)out preferredPTSOut:(void *)sOut selectedFramesRangeOut:;
- (uint64_t)_ubAddFrameParametersForDepthIfNeeded:(__int16)needed captureFlags:;
- (uint64_t)_ubAddSensorRawOutputBuffersToStillImageCaptureOptionsIfNeeded:(void *)needed stillImageCaptureOptionsOut:;
- (uint64_t)_ubAddSensorRawOutputBuffersToUnifiedBracketedCaptureParamsIfNeeded:(void *)needed unifiedBracketedCaptureParamsOut:;
- (uint64_t)_ubCBAFScanInProgressUsingFrameStatisticsByPortType:(uint64_t)type portTypes:(void *)types timeMachineFramesMetadata:;
- (uint64_t)_ubEVZeroCountForCaptureType:(char)type sceneFlags:(int)flags captureFlags:(void *)captureFlags frameStatistics:;
- (uint64_t)_ubEnableSphereForCaptureType:(uint64_t)result;
- (uint64_t)_ubEnabledOutputsForCaptureFlags:(int)flags captureType:(uint64_t *)type baseCaptureFrameFlagsOut:(unint64_t *)out discardCaptureFrameFlagsOut:;
- (uint64_t)_ubIsBravoMultiCameraCaptureForSettings:(uint64_t)settings sceneFlags:(int)flags deliverDepthData:;
- (uint64_t)_ubIsDigitalFlashCaptureForSettings:(__int16)settings sceneFlags:;
- (uint64_t)_ubIsRequestedHighResolutionFlavorSupportedForCaptureType:(uint64_t)type portType:(int)portType qualityPrioritization:(int)prioritization requestedHighResolutionFlavor:(unint64_t)flavor sceneFlags:(char)flags deliverDepthData:(char)data bravoConstituentPhotoCapture:(char)capture autoDeferredProcessingEnabled:(char)self0 canDefer:(char)self1 demosaicedRawRequested:(_BYTE *)self2 isUltraHighResolutionDowngradeOut:;
- (uint64_t)_ubIsTimeMachineFramesUsableForHDRUsingTimeMachineFramesMetadata:(uint64_t)metadata portTypes:(uint64_t)types sifrFlickerDetectionEnabled:(_BYTE *)enabled sifrFlickerDetected:;
- (uint64_t)_ubResolveDigitalFlashStatusForSceneFlags:(int)flags flashMode:;
- (uint64_t)_ubUpdateCurrentAdaptiveBracketedCaptureParamsForCaptureStreamSettings:(void *)settings frameStatistics:(int *)statistics timeMachineFrameSelection:;
- (uint64_t)_ubWhiteBalanceMetadataByPortTypeFromFrameStatistics:(uint64_t)statistics masterPortType:(void *)type;
- (uint64_t)_updateAutoFocusAreaOfInterestWithNormalizedRectInSensorSpace:(uint64_t)space zoomFactor:;
- (uint64_t)_updateAutoFocusRectIfNeededForZoomFactor:(uint64_t)factor;
- (uint64_t)_updateDeferredAutofocusProcessorPropertyStatesForProperty:(uint64_t)result;
- (uint64_t)_updateDynamicAspectRatioCumulativeTimeForStopTime:(uint64_t)result;
- (uint64_t)_updateExposureRectIfNeededForZoomFactor:(uint64_t)factor;
- (uint64_t)_updateExposureStateForAutofocusProperty:(uint64_t)result;
- (uint64_t)_updateFaceDetectionStateForAutofocusProperty:(uint64_t)result propertyValue:;
- (uint64_t)_updateFrameSkippingRatio;
- (uint64_t)_updateGlobalToneMappingEnabled;
- (uint64_t)_updateISPZoomDelayForNondisruptiveSwitchingWithZoomingOut:(uint64_t)result;
- (uint64_t)_updateImageControlModeStateForAutofocusProperty:(const void *)property propertyValue:;
- (uint64_t)_updateOrientationTotalTimes:(uint64_t)result;
- (uint64_t)_updateParallaxMitigationBasedOnZoomFactorEnabled;
- (uint64_t)_updateSensorRawPool;
- (uint64_t)_updateSensorRawPools;
- (uint64_t)_updateSensorRegionOfInterest:(double)interest forZoomFactor:(double)factor aspectRatio:(double)ratio previewShiftInSensorSpace:(double)space streamProperty:(float)property;
- (uint64_t)_updateSensorRegionOfInterestForActiveFraming;
- (uint64_t)_updateStatsMasterForMasterStream:(uint64_t)result;
- (uint64_t)_updateStreamMetadataSettings;
- (uint64_t)overCaptureActiveSlaveStreamForcedOff;
- (uint64_t)projectorModeMaskForProjectorMode:(uint64_t)mode;
- (unint64_t)_addPreviewWhiteBalanceMetadataToStillImageSampleBuffer:(unint64_t)result;
- (unint64_t)_evaluateSceneForMotionFreezingWithMasterStreamSwitchoverSuspended:(void *)suspended resultOut:;
- (unint64_t)_serviceMacroFocusDetectionWithFrameStatisticsByPortType:(unint64_t)result;
- (unint64_t)_ubDigitalFlashSceneFlagsForCaptureStream:(uint64_t)stream frameStatisticsByPortType:(int)type sphereAvailable:(int)available fusionEnabled:(int)enabled sceneMonitoring:;
- (unsigned)sensorRawPixelFormat;
- (unsigned)systemPressureFactors;
- (void)_accumulateInvalidFramesForAnalytics:(uint64_t)analytics;
- (void)_accumulateTimeOfFLightStreamingTime:(uint64_t)time;
- (void)_addCoreMediaMetadataAttachmentsToStillImageSampleBuffer:(char)buffer fromTimeMachine:;
- (void)_addExifMetadata:(char)metadata fromTimeMachine:;
- (void)_addNoiseReductionAndSharpeningConfigurationToStillImageCaptureOptions:(void *)options captureSettings:(void *)settings portType:;
- (void)_addPortraitSceneMonitoringMetadataToSampleBuffer:(uint64_t)buffer;
- (void)_addStateAttachmentsToVideoSampleBuffer:(uint64_t)buffer captureStream:;
- (void)_addStateInvariantAttachmentsToVideoSamplebuffer:(uint64_t)samplebuffer captureStream:;
- (void)_addStationaryFlagToMetadata:(void *)result;
- (void)_addStillImageSettingsToStillImageSampleBuffer:(uint64_t)buffer;
- (void)_addSystemPressureAttachments:(uint64_t)attachments;
- (void)_cameraColorCalibrationsForCaptureStream:(void *)result absoluteColorCalibrationsByPortType:;
- (void)_captureStillImageNowOnStreamWithOptions:captureStreamProperties:;
- (void)_captureStillImageNowWithSettings:(uint64_t)settings;
- (void)_checkDegradedAutoFocus:(uint64_t)focus;
- (void)_collectAPSStatistics:;
- (void)_configureZoomFudgingWithAspectRatio:(uint64_t)ratio;
- (void)_copyStreamsForAttributes:deviceClientPriority:errOut:;
- (void)_currentStillImageSceneTypeForcingFlashSceneDetectionEnabled:(int)enabled forcingHDRSceneDetectionEnabled:(int)detectionEnabled forcingSISSceneDetectionEnabled:(int)sceneDetectionEnabled forcingDigitalFlashSceneDetectionEnabled:;
- (void)_deviceDidStopStreaming;
- (void)_deviceWillStartStreaming;
- (void)_flashCalibrationDataForCaptureStream:(uint64_t)stream absoluteColorCalibrationsByPortType:(void *)type;
- (void)_getAutoFocusPropertyKeyAndAreaOfInterestWithNormalizedRectInSensorSpace:(uint64_t)space zoomFactor:propertyKeyOut:propertyValueOut:;
- (void)_handlePendingStillImageCaptureRequest;
- (void)_handleSmartFramingSuggestedFieldOfViewChangeIfNeeded:(uint64_t)needed;
- (void)_logStillImageCaptureTimingStatisticsForCoreAnalytics;
- (void)_overCaptureSelectLockedStreamsForRecommendedMasterStream:(float)stream requestedZoomFactor:(float)factor currentFrameRate:;
- (void)_postManualControlRequestCompletedWithName:(uint64_t)name requestID:(uint64_t)d timeDictionary:(uint64_t)dictionary additionalPayloadItems:(uint64_t)items;
- (void)_postNotificationWithName:(void *)name payloadNewPropertyValue:;
- (void)_postNotificationWithPayload:(id)payload notificationPayload:(id)notificationPayload;
- (void)_reportAPSOffsetEstimatorInfo;
- (void)_resetSDOFEffectAndStagePreviewStatus;
- (void)_resetStillImageCaptureRequestState;
- (void)_resetStillImageCaptureRequestStateInternal;
- (void)_sendMasterStreamChangedNotificationWithPortType:(void *)result;
- (void)_sendPreferredMasterStreamChangedNotificationWithPortType:(void *)result;
- (void)_sensorRawPoolsRequirements;
- (void)_serviceAutoImageControlModeWithSampleBuffer:(uint64_t)buffer fromCaptureStream:;
- (void)_serviceAutoTorchNotification:(uint64_t)notification sampleBuffer:(void *)buffer;
- (void)_serviceBravoStreamSelectionWithSampleBuffer:fromCaptureStream:frameStatisticsByPortType:streamingImageIntent:;
- (void)_serviceDeferredAutofocusProcessorPropertiesFromCaptureStream:(uint64_t)stream frameStatisticsByPortType:;
- (void)_serviceNondisruptiveSwitchingFormatForCaptureStream:(uint64_t)stream frameStatistics:(int)statistics streamingImageIntent:(uint64_t)intent isStationary:;
- (void)_serviceNondisruptiveSwitchingFormatWithSampleBuffer:fromCaptureStream:frameStatisticsByPortType:streamingImageIntent:;
- (void)_servicePendingStillImageCapture;
- (void)_servicePropertyChangeNotifications:(uint64_t)notifications;
- (void)_serviceRetryStillImageCaptureUsingFrameStatisticsByPortType:(uint64_t)type;
- (void)_serviceSDOFSceneMonitoringWithCaptureStream:(uint64_t)stream sampleBuffer:(uint64_t)buffer frameStatisticsByPortType:(int)type flashModeForSceneMonitoring:hdrModeForSceneMonitoring:qualityPrioritizationForSceneMonitoring:streamingImageIntent:;
- (void)_serviceStereoVideoCaptureSceneMonitoringWithFrameStatisticsByPortType:(int)type sceneFlags:(int)flags;
- (void)_serviceVariableFrameRateWithSampleBuffer:(void *)buffer fromCaptureStream:(uint64_t)stream frameStatisticsByPortType:;
- (void)_setISPZoomFactorSynchronously:(uint64_t)synchronously;
- (void)_setNewISPZoomFactorOnStream;
- (void)_stillImageCaptureInProgressSubstateForFrameStatisticsByPortType:masterPortType:captureType:captureFlags:;
- (void)_stillImageCaptureStateMachineDidTransitionToInProgress;
- (void)_teardownAutoFocusSampleBufferProcessor;
- (void)_ubAdaptiveStillImageCaptureSettingsWithSettings:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:;
- (void)_ubClientBracketStillImageCaptureSettings:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:;
- (void)_ubConvertStillImageCaptureSettings:useSynchronizedStreamsGroup:toStillImageCaptureNowOptions:captureStreamPropertyValues:;
- (void)_ubDeliverDepthDataForSettings:speedOverQuality:sceneFlags:;
- (void)_ubDetectedObjectsForDigitalFlashFromDetectedObjects:(uint64_t)objects finalCropRect:;
- (void)_ubFlashStillImageCaptureSettingsWithID:(uint64_t)d captureType:(uint64_t)type captureFlags:(uint64_t)flags sceneFlags:(uint64_t)sceneFlags frameStatisticsByPortType:(uint64_t)portType deliverSushiRaw:(uint64_t)raw bravoConstituentImageDeliveryDeviceTypes:(uint64_t)types;
- (void)_ubHighResolutionNondisruptiveSwitchingFormatIndexForCaptureStream:(int)stream;
- (void)_ubResolveStillImageCaptureFlagsForCaptureType:(uint64_t)type sceneFlags:(uint64_t)flags settings:(uint64_t)settings frameStatisticsByPortType:(uint64_t)portType hdrMode:(uint64_t)mode speedOverQuality:(uint64_t)quality speedOverQualityDowngrade:(uint64_t)downgrade qualityPrioritization:(uint64_t)self0 highResolutionFlavor:(uint64_t)self1 ultraHighResolutionDowngrade:(uint64_t)self2 canDefer:(uint64_t)self3 zeroShutterLagFailureReasonOut:(uint64_t)self4 metadata:(uint64_t)self5;
- (void)_ubResolveStillImageCaptureTypeWithSettings:(uint64_t)settings sceneFlags:(uint64_t)flags hdrMode:(uint64_t)mode qualityPrioritization:(uint64_t)prioritization clientBracket:(uint64_t)bracket canDefer:(uint64_t)defer primaryPortType:(uint64_t)type speedOverQualityInOut:(uint64_t)self0 speedOverQualityDowngradeOut:(uint64_t)self1;
- (void)_ubSetupMetadataTimeMachine;
- (void)_ubSphereOffsetsForAdaptiveBracketingParameters:(float)parameters pixelSize:;
- (void)_ubStillImageCaptureSettingsWithID:(uint64_t)d userInitiatedRequestPTS:(uint64_t)s captureType:(uint64_t)type captureFlags:(uint64_t)flags sceneFlags:(uint64_t)sceneFlags frameStatisticsByPortType:(uint64_t)portType metadata:(uint64_t)metadata deliverOriginalImage:(uint64_t)self0 deliverSushiRaw:(uint64_t)self1 bravoConstituentImageDeliveryDeviceTypes:(uint64_t)self2;
- (void)_ubStillImageSceneFlagsForCaptureStream:(uint64_t)stream frameStatisticsByPortType:fusionEnabled:metadata:sceneMonitoring:zoomFactorOverride:;
- (void)_ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:;
- (void)_ubValidateTimeMachineFramesMetadata:(uint64_t)metadata minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:;
- (void)_updateActionCameraMaxExposureDurationForFlickerFrequency:;
- (void)_updateBravoStreamSelectionForMasterStream:(int)stream forceNotification:;
- (void)_updateBravoSwitchOverStateForAutofocusProperty:(uint64_t)property propertyValue:;
- (void)_updateCurrentStillSmartCameraState;
- (void)_updateSDOFEffectStatus:(uint64_t)status newStagePreviewStatus:;
- (void)_updateSceneMonitorFocusStateForAutofocusProperty:(uint64_t)property propertyValue:;
- (void)_updateSlaveFrameRateForZoomFactor:(uint64_t)factor;
- (void)_updateSlaveFrameRateForZoomFactor:(uint64_t)factor masterCaptureStream:;
- (void)_updateSmartFramingFieldOfViewWithAspectRatio:(uint64_t)ratio zoomFactor:(float)factor;
- (void)_updateStateUsingVideoSampleBuffer:fromCaptureStream:;
- (void)_updateStereoVideoCaptureStatus:(uint64_t)status;
- (void)_updateStreamingImageIntentForChangedMasterStreamWithPortType:(uint64_t)type;
- (void)_updateStreamingImageIntentTo:from:masterPortType:;
- (void)_updateStreamingImageIntentWithNewImageControlMode:(uint64_t)mode oldImageControlMode:(uint64_t)controlMode;
- (void)_updateThermalPressureStatsWithOldSDOFEffectStatus:(uint64_t)status newSDOFEffectStatus:;
- (void)_updateUltraHighResSensorRawPool;
- (void)_updateVariableFrameRateSettings;
- (void)_updateWhiteBalanceStateForAutofocusProperty:(const void *)property propertyValue:;
- (void)_validateTimeMachineFramesUsingPreviewFramesMetadata:(uint64_t)metadata;
- (void)_zeroShutterLagStillImageCaptureSettingsWithID:(uint64_t)d captureType:(uint64_t)type deliverOriginalImage:(uint64_t)image deliverSushiRaw:(uint64_t)raw bravoConstituentImageDeliveryDeviceTypes:(uint64_t)types clientBracketSettings:(uint64_t)settings captureFlags:(uint64_t)flags userInitiatedRequestPTS:(uint64_t)self0 captureStreams:(uint64_t)self1 frameStatisticsByPortType:(uint64_t)self2;
- (void)cancelPrepareToCaptureStillImageNow;
- (void)captureStream:(id)stream didCompleteStillImageCaptureWithPTS:(id *)s error:(int)error;
- (void)captureStream:(id)stream didDropVideoSampleBufferWithPTS:(id *)s;
- (void)captureStream:(id)stream didUpdatePreviewShift:(CGPoint)shift;
- (void)captureStream:(id)stream willDiscardVideoSampleBuffer:(opaqueCMSampleBuffer *)buffer;
- (void)captureStream:(id)stream willEmitDepthSampleBuffer:(opaqueCMSampleBuffer *)buffer;
- (void)captureStream:(id)stream willEmitPointCloudSampleBuffer:(opaqueCMSampleBuffer *)buffer;
- (void)captureStream:(id)stream willEmitStillImageSampleBuffer:(opaqueCMSampleBuffer *)buffer fromTimeMachine:(BOOL)machine;
- (void)captureStream:(id)stream willEmitVideoSampleBuffer:(opaqueCMSampleBuffer *)buffer drivesCameraControls:(BOOL)controls;
- (void)captureStreamDidChangeActiveFormatIndex:(id)index;
- (void)captureStreamDidStartStreaming:(id)streaming;
- (void)captureStreamDidStopStreaming:(id)streaming;
- (void)captureStreamWillStartStreaming:(id)streaming;
- (void)captureStreamWillStopStreaming:(id)streaming;
- (void)dealloc;
- (void)initiateCaptureStillImageNowWithPTS:(id *)s completionHandler:(id)handler;
- (void)invalidateForParallelGraphRebuild;
- (void)liveReconfigureForOutputAspectRatioCompleted:(int64_t)completed forConfigurationID:(int64_t)d;
- (void)liveReconfigureForOutputAspectRatioFirstBufferReceived:(id *)received forConfigurationID:(id)d;
- (void)panWithTranslation:(CGPoint)translation;
- (void)performBlockOnNotificationQueue:(id)queue;
- (void)performOneShotFraming;
- (void)performReactionEffect:(id)effect;
- (void)pointCloudCaptureDevice:(id)device willEmitPointCloudSampleBuffer:(opaqueCMSampleBuffer *)buffer;
- (void)prepareToCaptureStillImageNow:(id)now;
- (void)pulseGenerator:(id)generator updateSynchronizationClock:(unint64_t)clock withError:(int)error;
- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withLockState:(BOOL)state;
- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withOutOfBoundsError:(int64_t)error;
- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withSessionStoppedExitStatus:(unsigned int)status;
- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withTriggerIsPresent:(BOOL)present;
- (void)rampToVideoZoomFactor:(float)factor withRampType:(int)type rate:(float)rate duration:(double)duration commandID:(int)d;
- (void)rampToVideoZoomFactor:(float)factor withTuning:(int)tuning commandID:(int)d;
- (void)registerForAEMatrixMetadata;
- (void)releaseResources;
- (void)resetFraming;
- (void)resetSmartFramingSceneMonitor;
- (void)semanticStyleSceneTypeDidChange:(int)change;
- (void)sendCalibrationDataToISP;
- (void)setActiveVideoMinFrameDuration:(id *)duration activeVideoMaxFrameDuration:(id *)frameDuration;
- (void)setAdaptiveUnifiedBracketingController:(id)controller;
- (void)setAspectRatio:(int)ratio;
- (void)setBackgroundBlurAperture:(float)aperture;
- (void)setBackgroundBlurEnabled:(BOOL)enabled;
- (void)setBackgroundReplacementEnabled:(BOOL)enabled;
- (void)setBackgroundReplacementPixelBuffer:(__CVBuffer *)buffer;
- (void)setBaseZoomFactorsByPortType:(id)type;
- (void)setBravoStreamSelectionConfiguration:(id)configuration;
- (void)setBravoStreamSelectionConfigurationForRecording:(id)recording;
- (void)setBravoStreamSelectionConfigurationForRecordingEnabled:(BOOL)enabled;
- (void)setBravoStreamSelectionEligibleFallbackPortTypes:(id)types;
- (void)setCenterStageDelegate:(id)delegate;
- (void)setCenterStageFieldOfViewRestrictedToWide:(BOOL)wide;
- (void)setCenterStageFramingMode:(int)mode;
- (void)setCenterStageMetadataDeliveryEnabled:(BOOL)enabled;
- (void)setCenterStageRectOfInterest:(CGRect)interest;
- (void)setCinematicFramingEnabled:(BOOL)enabled;
- (void)setCinematicVideoEnabled:(BOOL)enabled;
- (void)setCinematicVideoFocus:(id)focus;
- (void)setConfiguresStreamingImageIntentForActionCamera:(BOOL)camera;
- (void)setDeepFusionEnabled:(BOOL)enabled;
- (void)setDepthDataDeliveryEnabled:(BOOL)enabled;
- (void)setDepthMaxFrameRate:(float)rate;
- (void)setDepthWithDeepFusionEnabled:(BOOL)enabled;
- (void)setDeskCamActive:(BOOL)active;
- (void)setDeskViewCameraZoomFactor:(float)factor;
- (void)setDigitalFlashEnabled:(BOOL)enabled;
- (void)setDigitalFlashMetadataEnabled:(BOOL)enabled;
- (void)setDockedTrackingActive:(BOOL)active;
- (void)setFaceDetectionConfiguration:(id)configuration;
- (void)setGesturesEnabled:(BOOL)enabled;
- (void)setGlobalToneMappingEnabled:(BOOL)enabled;
- (void)setGlobalToneMappingEnabledOverride:(id)override;
- (void)setISPZoomFactor:(float)factor totalZoomFactor:(float)zoomFactor;
- (void)setLearnedNRMode:(unsigned int)mode;
- (void)setManualCinematicFramingDelegate:(id)delegate;
- (void)setMaxContinuousZoomFactorForDepthDataDelivery:(float)delivery;
- (void)setMaxDepthFrameRateChangedDelegate:(id)delegate;
- (void)setMaxExposureDurationClientOverride:(id *)override;
- (void)setMaxTorchLevel:(float)level;
- (void)setMaximumFrameRate:(float)rate attachedSessionID:(id)d;
- (void)setMaximumFrameRate:(id)rate;
- (void)setMemoryPool:(id)pool;
- (void)setMinimumFrameRate:(id)rate;
- (void)setMomentCaptureVideoRecordingSupported:(BOOL)supported;
- (void)setNonDestructiveCropSize:(CGSize)size;
- (void)setNondisruptiveSwitchingFormatIndicesByPortType:(id)type maximumAllowedFrameRate:(int)rate minimumFrameRate:(int)frameRate maximumFrameRate:(int)maximumFrameRate;
- (void)setNondisruptiveSwitchingFormatIndicesByZoomFactorSIFRBinned:(id)binned nondisruptiveSwitchingFormatIndicesByZoomFactorSIFRNonBinned:(id)nonBinned ultraHighResolutionNondisruptiveStreamingFormatIndex:(int)index mainFormatSIFRBinningFactor:(int)factor forPortType:(id)type quadraSubPixelSwitchingParameters:(id)parameters;
- (void)setOverCaptureEnabled:(BOOL)enabled;
- (void)setOverheadCameraMode:(int)mode;
- (void)setOverheadCameraModeChangeDelegate:(id)delegate;
- (void)setPeakPowerSystemPressureLevel:(int)level;
- (void)setPortraitEffectPropertiesDelegate:(id)delegate;
- (void)setPortraitEffectStudioLightQuality:(int64_t)quality;
- (void)setPreviewShiftInSensorSpace:(double)space;
- (void)setProperty:(id)property isObserved:(BOOL)observed;
- (void)setReactionEffectsEnabled:(BOOL)enabled;
- (void)setRegionOfInterestWithoutOverscan:(CGRect)overscan;
- (void)setRestorationOfForcedOffOverCaptureActiveSlaveStreamEnabled:(BOOL)enabled;
- (void)setSecureMetadataEnabled:(BOOL)enabled;
- (void)setSensorRegionOfInterestForCameraControls:(CGRect)controls forSensorDimensions:(id)dimensions;
- (void)setShallowDepthOfFieldEffectEnabled:(BOOL)enabled;
- (void)setSifrStillImageCaptureEnabledIfAvailable:(BOOL)available;
- (void)setSimulatedAperture:(float)aperture;
- (void)setSmartCameraEnabled:(BOOL)enabled;
- (void)setSmartCameraVersion:(id)version;
- (void)setSmartCropCandidateFramingRects:(id)rects;
- (void)setSmartFramingIsMonitoringScene:(BOOL)scene;
- (void)setSmartStyleAttachedMediaTimeMachineDelegate:(id)delegate;
- (void)setStereoPhotoCaptureEnabled:(BOOL)enabled;
- (void)setStereoVideoCaptureEnabled:(BOOL)enabled;
- (void)setStillImageCaptureEnabled:(BOOL)enabled;
- (void)setStillImageStabilizationSceneDetectionEnabled:(BOOL)enabled;
- (void)setStreamingDigitalFlashMode:(int)mode;
- (void)setStreamingFilterDelegate:(id)delegate;
- (void)setStudioLightingEnabled:(BOOL)enabled;
- (void)setStudioLightingIntensity:(float)intensity;
- (void)setSubjectSelectionDelegate:(id)delegate;
- (void)setSupplementalPointCloudCaptureDevice:(id)device;
- (void)setSupplementalPointCloudCaptureDeviceDelegate:(id)delegate;
- (void)setSuppressedGesturesEnabled:(BOOL)enabled;
- (void)setSystemPressureFactors:(unsigned int)factors;
- (void)setSystemPressureLevel:(int)level;
- (void)setTemporalNoiseReductionBand0StrengthModulation:(int)modulation;
- (void)setThermalSystemPressureLevel:(int)level;
- (void)setTimeLapseCaptureRate:(float)rate;
- (void)setTimeOfFlightProjectorMode:(int)mode;
- (void)setTrueVideoCaptureEnabled:(BOOL)enabled;
- (void)setUltraHighResolutionZeroShutterLagEnabled:(BOOL)enabled;
- (void)setUltraHighResolutionZeroShutterLagSupportEnabled:(BOOL)enabled;
- (void)setUltraWideActive:(BOOL)active;
- (void)setUnifiedBracketingMode:(int)mode;
- (void)setVideoHDRImageStatisticsEnabled:(BOOL)enabled;
- (void)setVideoStabilizationStrength:(int)strength;
- (void)setZeroShutterLagEarliestAllowedPTS:(id *)s;
- (void)setZeroShutterLagEnabled:(BOOL)enabled;
- (void)setZoomFactor:(float)factor;
- (void)setZoomFactorChangedDelegate:(id)delegate forPortType:(id)type;
- (void)startPanningAtPoint:(CGPoint)point;
- (void)startupFaceDetectionIfNeeded;
- (void)stopPointCloudCaptureForStillImageCaptureWithSettingsID:(int64_t)d;
- (void)unregisterForAEMatrixMetadata;
- (void)updateClientAuditToken:(id *)token;
- (void)updateFudgedZoomRanges;
- (void)updateLensSmudgeDetectionInfo:(id)info;
- (void)updatePortraitSceneMonitoringRequiresStageThresholds:(BOOL)thresholds;
- (void)updateSDOFBackgroundShiftSum:(float)sum invalidShiftRatio:(float)ratio closeCanonicalDisparityAverage:(float)average faceCanonicalDisparityAverages:(id)averages erodedForegroundRatio:(float)foregroundRatio foregroundRatio:(float)a8 occluded:(BOOL)occluded faces:(id)self0 personSegmentationRatio:(float)self1;
- (void)updateSmartCameraStreamPropertiesWithInferenceResult:(id)result;
- (void)updateSmartFramingCamGazeProbabilities:(id)probabilities;
- (void)updateSphereShiftStateWithSampleBuffer:(opaqueCMSampleBuffer *)buffer;
- (void)zeroShutterLagCancelWaitingForTimeMachinesForSettingsID:(int64_t)d;
- (void)zoomCommandHandler:(id)handler didApplyZoomFactor:(float)factor zoomFactorWithoutFudge:(float)fudge targetZoomFactor:(float)zoomFactor rampComplete:(BOOL)complete rampCommandID:(int)d;
@end

@implementation BWFigVideoCaptureDevice

- (uint64_t)_setupMacroFocusDetection
{
  if (result)
  {
    v2 = result;
    firstObject = [*(result + 664) firstObject];
    result = [firstObject hasFocus];
    if (result)
    {
      if (*(v2 + 680))
      {
        *(v2 + 1546) = 1;
        [*(v2 + 1416) wideToSuperWideFocusDistance];
        if (v4 == 0.0)
        {
          v4 = 14.0;
        }

        *(v2 + 1548) = v4;
        result = [*(v2 + 1416) superWideToWideFocusDistance];
        if (v5 == 0.0)
        {
          v5 = 16.0;
        }

        goto LABEL_8;
      }

      portType = [firstObject portType];
      v7 = *off_1E798A0D0;
      if (([portType isEqualToString:*off_1E798A0D0] & 1) != 0 || (result = objc_msgSend(objc_msgSend(firstObject, "portType"), "isEqualToString:", *off_1E798A0C0), result))
      {
        *(v2 + 1546) = 1;
        [objc_msgSend(firstObject "stream")];
        v8 = [objc_msgSend(OUTLINED_FUNCTION_133() "stream")];
        if (v1)
        {
          v9 = v8;
          if (v8)
          {
            [v1 floatValue];
            v11 = v10;
            [v9 floatValue];
            if (v11 <= v12)
            {
              v13 = v9;
            }

            else
            {
              v13 = v1;
            }

            result = [v13 floatValue];
            v15 = v14 * 1.25;
            *(v2 + 1548) = v15;
            v5 = v15 + 2.0;
LABEL_8:
            *(v2 + 1552) = v5;
            return result;
          }
        }

        result = [objc_msgSend(firstObject "portType")];
        v16 = (v2 + 1548);
        if (result)
        {
          *v16 = 0x4120000041000000;
        }

        else
        {
          *v16 = 0x41C0000041B00000;
        }
      }
    }
  }

  return result;
}

- (void)sendCalibrationDataToISP
{
  autoFocusPositionSensorCalibrationData = [+[FigCaptureCalibrationMonitor sharedInstance](FigCaptureCalibrationMonitor autoFocusPositionSensorCalibrationData];
  if (FigCapturePlatformIdentifier() < 6)
  {
    apsSphereInteractionCalibrationData = 0;
    autoFocusCalibrationData = 0;
  }

  else
  {
    autoFocusCalibrationData = [+[FigCaptureCalibrationMonitor sharedInstance](FigCaptureCalibrationMonitor autoFocusCalibrationData];
    apsSphereInteractionCalibrationData = [+[FigCaptureCalibrationMonitor sharedInstance](FigCaptureCalibrationMonitor apsSphereInteractionCalibrationData];
  }

  v21 = 0u;
  v22 = 0u;
  v19 = 0u;
  v20 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v19 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v20;
    v17 = *off_1E798BCB8;
    v16 = *off_1E798BC90;
    v10 = *off_1E798BCD8;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v20 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        v12 = *(*(&v19 + 1) + 8 * i);
        if (([objc_msgSend(v12 stream] & 1) == 0)
        {
          v13 = [autoFocusPositionSensorCalibrationData objectForKeyedSubscript:{objc_msgSend(v12, "nonLocalizedName")}];
          if (v13)
          {
            [objc_msgSend(v12 "stream")];
          }

          v14 = [autoFocusCalibrationData objectForKeyedSubscript:{objc_msgSend(v12, "nonLocalizedName")}];
          if (v14)
          {
            [objc_msgSend(v12 "stream")];
          }

          v15 = [apsSphereInteractionCalibrationData objectForKeyedSubscript:{objc_msgSend(v12, "nonLocalizedName")}];
          if (v15)
          {
            [objc_msgSend(v12 "stream")];
          }

          [objc_msgSend(v12 "stream")];
        }
      }

      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v19 objects:v18 count:16];
    }

    while (v8);
  }
}

- (uint64_t)_updateParallaxMitigationBasedOnZoomFactorEnabled
{
  if (result)
  {
    v1 = result;
    result = [objc_msgSend(objc_msgSend(*(result + 624) objectForKeyedSubscript:{@"SynchronizedStreamsSwitchOverParameters", "objectForKeyedSubscript:", @"parallaxMitigationBasedOnZoomFactorEnabled", "BOOLValue"}];
    if (result && (*(v1 + 3888) & 1) == 0)
    {
      v2 = *(v1 + 1568) ^ 1 | (*(v1 + 4300) != 0.0);
    }

    else
    {
      v2 = 0;
    }

    *(v1 + 1544) = v2 & (*(v1 + 217) == 0);
  }

  return result;
}

- (uint64_t)_updateStreamMetadataSettings
{
  if (result)
  {
    v2 = result;
    if (*(result + 2345) & 1) != 0 || (*(result + 2360))
    {
      v3 = 1;
    }

    else
    {
      OUTLINED_FUNCTION_43_13();
      v27 = *(v2 + 2192);
      if (OUTLINED_FUNCTION_122_4(v28, v29, v30, v31, v32, v33, v34, v35, v45, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67, v69, v71, v73, v75, v77, v79, v80, v82, v84, v86, v88, v90, v92))
      {
        v3 = 0;
        while (1)
        {
          OUTLINED_FUNCTION_49_7();
          if (!v36)
          {
            objc_enumerationMutation(v27);
          }

          v3 |= [objc_msgSend(*(v2 + 2192) objectForKeyedSubscript:{*v94), "referenceFrameSelectionMethod"}] == 3;
          OUTLINED_FUNCTION_51_11();
          if (v36)
          {
            v1 = OUTLINED_FUNCTION_122_4(v37, v38, v39, v40, v41, v42, v43, v44, v45, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67, v69, v71, v73, v75, v77, v79, v81, v83, v85, v87, v89, v91, v93);
            if (!v1)
            {
              break;
            }
          }
        }
      }

      else
      {
        v3 = 0;
      }
    }

    OUTLINED_FUNCTION_1_13();
    v4 = *(v2 + 656);
    result = OUTLINED_FUNCTION_1_3(v5, v6, v7, v8, v9, v10, v11, v12, v45, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67, v69, v71, v73, v75, v77);
    if (result)
    {
      OUTLINED_FUNCTION_125_4();
      v14 = *v13;
      do
      {
        v15 = 0;
        do
        {
          OUTLINED_FUNCTION_4_10();
          if (v16 != v14)
          {
            objc_enumerationMutation(v4);
          }

          v17 = *(v79 + 8 * v15);
          if (*(v2 + 2345))
          {
            v18 = 1;
          }

          else
          {
            v18 = *(v2 + 2360);
          }

          [*(v79 + 8 * v15) setAeStatisticsEnabled:v18 & 1];
          v19 = [v17 setRawFocusScoresEnabled:v3 & 1];
          ++v15;
        }

        while (v1 != v15);
        result = OUTLINED_FUNCTION_1_3(v19, v20, v21, v22, v23, v24, v25, v26, v46, v48, v50, v52, v54, v56, v58, v60, v62, v64, v66, v68, v70, v72, v74, v76, v78);
        v1 = result;
      }

      while (result);
    }
  }

  return result;
}

- (uint64_t)_updateGlobalToneMappingEnabled
{
  if (result)
  {
    v1 = result;
    os_unfair_lock_assert_owner((result + 2140));
    os_unfair_lock_assert_owner((v1 + 2140));
    v2 = *(v1 + 2336);
    if (v2)
    {
      result = [v2 BOOLValue];
    }

    else
    {
      result = *(v1 + 2332);
    }

    v3 = *(v1 + 2280);
    v4 = v3 > 8;
    v5 = (1 << v3) & 0x1E8;
    if (!v4 && v5 != 0)
    {
      if ((result & 1) == 0)
      {
        return result;
      }

      OUTLINED_FUNCTION_18_34();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v8 = OUTLINED_FUNCTION_8_5(os_log_and_send_and_compose_flags_and_os_log_type);
      if (OUTLINED_FUNCTION_6(v8))
      {
        OUTLINED_FUNCTION_5_6();
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
        OUTLINED_FUNCTION_247();
      }

      OUTLINED_FUNCTION_1_4();
      result = OUTLINED_FUNCTION_17_8();
      goto LABEL_15;
    }

    if (result)
    {
      *(v1 + 2280) = 4;
      *(v1 + 2272) = 1;
LABEL_15:
      *(v1 + 2384) = 0;
      return result;
    }

    v9 = *(v1 + 2384);
    if (v9 == 2)
    {
      v10 = 2;
    }

    else
    {
      v10 = v9 == 1;
    }

    *(v1 + 2280) = v10;
    *(v1 + 2272) = 1;
  }

  return result;
}

- (uint64_t)_currentStreamingImageIntent
{
  if (!self)
  {
    return 0;
  }

  os_unfair_lock_assert_not_owner(self + 535);
  os_unfair_lock_lock(self + 535);
  os_unfair_lock_opaque = self[569]._os_unfair_lock_opaque;
  os_unfair_lock_unlock(self + 535);
  return os_unfair_lock_opaque;
}

- (float)zoomFactor
{
  if (LOBYTE(self->_zoomRampTuning.jumpFrontFacingZoomOut[1].friction) == 1)
  {
    firstObject = [(NSArray *)[(BWFigVideoCaptureDevice *)self captureStreams] firstObject];

    [firstObject cmioZoomFactor];
  }

  else if (self->_previewVideoDepthNodeUnprepared)
  {
    [-[BWZoomRange referencedObject](self->_depthDataDeliveryZoomRange "referencedObject")];
    return v4;
  }

  else
  {
    whiteBalanceGains = self->_whiteBalanceGains;

    [(NSMutableDictionary *)whiteBalanceGains appliedZoomFactor];
  }

  return result;
}

- (double)previewShiftInSensorSpace
{
  if (!self)
  {
    return 0.0;
  }

  os_unfair_lock_lock((self + 3924));
  v2 = *(self + 3928);
  os_unfair_lock_unlock((self + 3924));
  return v2;
}

- (int)setWhiteBalanceModeAuto
{
  v2 = [(BWFigVideoCaptureDevice *)self _setAutofocusProcessorProperty:*MEMORY[0x1E695E4C0] propertyValue:?];
  if (v2)
  {
    OUTLINED_FUNCTION_0_8();
    FigDebugAssert3();
  }

  return v2;
}

- (void)_ubSetupMetadataTimeMachine
{
  if (self)
  {
    if (*(self + 2176) && (OUTLINED_FUNCTION_240(), v2))
    {
      if (!*(self + 2200))
      {
        OUTLINED_FUNCTION_8_7();
        OUTLINED_FUNCTION_80_2();
        v7 = __54__BWFigVideoCaptureDevice__ubSetupMetadataTimeMachine__block_invoke;
        v8 = &unk_1E799C3C0;
        selfCopy = self;
        v3 = [[BWMetadataTimeMachine alloc] initWithName:@"ZSL" capacity:(*(self + 3456) + 4) metadataHandlingPriority:14 addHandler:v6];
        *(self + 2200) = v3;
        v4 = *(self + 3460);
        v5 = *(self + 3476);
        [(BWMetadataTimeMachine *)v3 setEarliestAllowedPTS:&v4];
        *(self + 2216) = objc_alloc_init(MEMORY[0x1E695DF90]);
      }
    }

    else
    {

      *(self + 2200) = 0;
      *(self + 2216) = 0;
    }
  }
}

- (uint64_t)_updateFrameSkippingRatio
{
  if (result)
  {
    v1 = result;
    v2 = *(result + 4540);
    v3 = *(result + 4536);
    minimumFrameRate = [*(result + 600) minimumFrameRate];
    v6 = FigCaptureFrameRateAsInt(minimumFrameRate, v5);
    v7 = v2 < 1 || v3 == 0;
    if (v7 || v6 < *(v1 + 4540))
    {
      v11 = 1;
    }

    else
    {
      minimumFrameRate2 = [*(v1 + 600) minimumFrameRate];
      v11 = ((FigCaptureFrameRateAsInt(minimumFrameRate2, v10) + *(v1 + 4540) - 1) / *(v1 + 4540));
    }

    result = FigCapturePlatformIdentifier();
    if (result >= 11)
    {
      result = [*(v1 + 656) count];
      if (result == 1)
      {
        [*(v1 + 600) stream];
        [MEMORY[0x1E696AD98] numberWithInt:v11];
        v12 = OUTLINED_FUNCTION_139_1();

        return [v12 setPropertyIfSupported:? value:?];
      }
    }
  }

  return result;
}

- (BOOL)supportsWideColor
{
  v2 = [(NSDictionary *)self->_attributes objectForKeyedSubscript:@"WideColor"];

  return [v2 BOOLValue];
}

- (unsigned)sensorRawPixelFormat
{
  sensorRawPoolRequirements = [(BWFigVideoCaptureDevice *)self sensorRawPoolRequirements];
  if (!sensorRawPoolRequirements)
  {
    [BWFigVideoCaptureDevice sensorRawPixelFormat];
    return 0;
  }

  v3 = [(NSDictionary *)sensorRawPoolRequirements objectForKeyedSubscript:*MEMORY[0x1E6966130]];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    [BWFigVideoCaptureDevice sensorRawPixelFormat];
    return 0;
  }

  return [v3 intValue];
}

- (int)autoImageControlMode
{
  v6 = 0;
  v7 = &v6;
  v8 = 0x2020000000;
  v9 = 0;
  autofocusProcessorQueue = self->_autofocusProcessorQueue;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __47__BWFigVideoCaptureDevice_autoImageControlMode__block_invoke;
  v5[3] = &unk_1E798FAF8;
  v5[4] = self;
  v5[5] = &v6;
  dispatch_sync(autofocusProcessorQueue, v5);
  v3 = *(v7 + 6);
  _Block_object_dispose(&v6, 8);
  return v3;
}

- (BOOL)portraitPreviewForegroundBlurEnabled
{
  v3 = +[FigCaptureCameraParameters sharedInstance];
  v4 = *off_1E798A0C0;
  sensorIDString = [(BWFigVideoCaptureStream *)[(BWFigVideoCaptureDevice *)self captureStream] sensorIDString];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  activePortTypes = [(BWFigVideoCaptureDevice *)self activePortTypes];
  v7 = [(NSArray *)activePortTypes countByEnumeratingWithState:&v19 objects:v18 count:16];
  if (!v7)
  {
    goto LABEL_18;
  }

  v8 = v7;
  v16 = v4;
  v17 = v3;
  v9 = *v20;
  v10 = *off_1E798A0D8;
  v11 = *off_1E798A0E8;
  v12 = *off_1E798A0F8;
  while (2)
  {
    for (i = 0; i != v8; ++i)
    {
      if (*v20 != v9)
      {
        objc_enumerationMutation(activePortTypes);
      }

      v4 = *(*(&v19 + 1) + 8 * i);
      if ([v4 isEqualToString:{v10, v16}])
      {
        bravoTelephotoCaptureStream = [(BWFigVideoCaptureDevice *)self bravoTelephotoCaptureStream];
LABEL_16:
        sensorIDString = [(BWFigVideoCaptureStream *)bravoTelephotoCaptureStream sensorIDString];
        goto LABEL_17;
      }

      if ([v4 isEqualToString:v11])
      {
        bravoTelephotoCaptureStream = [(BWFigVideoCaptureDevice *)self pearlInfraredCaptureStream];
        goto LABEL_16;
      }

      if (-[NSArray count](-[BWFigVideoCaptureDevice activePortTypes](self, "activePortTypes"), "count") == 1 && [v4 isEqualToString:v12])
      {
        bravoTelephotoCaptureStream = [(BWFigVideoCaptureDevice *)self captureStream];
        goto LABEL_16;
      }
    }

    v8 = [(NSArray *)activePortTypes countByEnumeratingWithState:&v19 objects:v18 count:16];
    if (v8)
    {
      continue;
    }

    break;
  }

  v4 = v16;
LABEL_17:
  v3 = v17;
LABEL_18:
  [(BWFigVideoCaptureDevice *)self requestedZoomFactorRelativeToPortType:v4];
  return [(FigCaptureCameraParameters *)v3 portraitPreviewForegroundBlurEnabledForPortType:v4 sensorIDString:sensorIDString zoomFactor:?];
}

- (NSDictionary)sensorRawPoolRequirements
{
  OUTLINED_FUNCTION_84();
  v4 = v3;
  v5 = v2;
  v40[0] = 0;
  if (*(v2 + 156) == 1)
  {
    [BWFigVideoCaptureDevice _sensorRawPoolsRequirements];
    v19 = v18;
    if ([v18 count])
    {
      OUTLINED_FUNCTION_6_78();
      v22 = OUTLINED_FUNCTION_37(v20, v21, v39, v38);
      if (v22)
      {
        v23 = v22;
        v24 = 0;
        v25 = 0;
        v26 = *v39[2];
        obj = v19;
        do
        {
          for (i = 0; i != v23; ++i)
          {
            OUTLINED_FUNCTION_13_1();
            if (v28 != v26)
            {
              objc_enumerationMutation(obj);
            }

            v29 = [objc_msgSend(OUTLINED_FUNCTION_221() "objectForKeyedSubscript:"intValue"")];
            v30 = [objc_msgSend(OUTLINED_FUNCTION_347() "objectForKeyedSubscript:"intValue"")];
            if (v25 < 1 || v24 < 1 || v29 < v25 || v30 < v24)
            {
              v24 = v30;
              v25 = v29;
            }
          }

          v23 = [obj countByEnumeratingWithState:v39 objects:v38 count:16];
        }

        while (v23);
      }
    }
  }

  else
  {
    if ([v2 isBravoVariant])
    {
      v6 = [objc_msgSend(v5[81] "syncGroup")];
      if (v40[0])
      {
        goto LABEL_39;
      }
    }

    else
    {
      v6 = [objc_msgSend(v5[75] "stream")];
      if (v40[0])
      {
LABEL_39:
        OUTLINED_FUNCTION_14_21();
        FigDebugAssert3();
        goto LABEL_14;
      }
    }

    if ([v6 count])
    {
      v7 = *MEMORY[0x1E6966208];
      v37[0] = *MEMORY[0x1E6966160];
      v37[1] = v7;
      v8 = *MEMORY[0x1E6966020];
      v37[2] = *MEMORY[0x1E69660B8];
      v37[3] = v8;
      v9 = *MEMORY[0x1E6966130];
      v37[4] = *MEMORY[0x1E6966140];
      v37[5] = v9;
      [MEMORY[0x1E695DEC8] arrayWithObjects:v37 count:6];
      OUTLINED_FUNCTION_181();
      v36 = v10;
      OUTLINED_FUNCTION_47_0();
      if ([v11 countByEnumeratingWithState:? objects:? count:?])
      {
        while (1)
        {
          OUTLINED_FUNCTION_49_7();
          if (!v12)
          {
            objc_enumerationMutation(v4);
          }

          if (![v6 objectForKeyedSubscript:*v36])
          {
            break;
          }

          OUTLINED_FUNCTION_120_0();
          if (v12)
          {
            OUTLINED_FUNCTION_47_0();
            if (!OUTLINED_FUNCTION_37(v13, v14, v15, v16))
            {
              break;
            }
          }
        }
      }
    }
  }

LABEL_14:
  OUTLINED_FUNCTION_81();
  return result;
}

- (int)depthDataBaseRotation
{
  result = FigCaptureFrontDepthDataToRGBRotationAngle();
  if (!self->_pearlInfraredCaptureStream)
  {
    return 0;
  }

  return result;
}

- (int)thermalSystemPressureLevel
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  v3 = *&self->_configuresStreamingImageIntentForActionCamera;
  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
  return v3;
}

- (NSDictionary)moduleCalibrationByPortType
{
  dictionary = [MEMORY[0x1E695DF90] dictionary];
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  obj = self->_captureStreams;
  v4 = [(NSArray *)obj countByEnumeratingWithState:&v20 objects:v19 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v21;
    v7 = *off_1E798C150;
    do
    {
      v8 = 0;
      do
      {
        if (*v21 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v9 = *(*(&v20 + 1) + 8 * v8);
        if ([objc_msgSend(objc_msgSend(v9 "stream")])
        {
          v10 = +[FigWeakReference weakReferenceToObject:](FigWeakReference, "weakReferenceToObject:", [v9 stream]);
          portType = [v9 portType];
          v18[0] = MEMORY[0x1E69E9820];
          v18[1] = 3221225472;
          v18[2] = __54__BWFigVideoCaptureDevice_moduleCalibrationByPortType__block_invoke;
          v18[3] = &unk_1E799C000;
          v18[4] = v10;
          v18[5] = portType;
          v12 = objc_alloc_init(MEMORY[0x1E69916E8]);
          if (v12)
          {
            v13 = [objc_alloc(MEMORY[0x1E69916F0]) initWithPixelBufferProvider:v18];
            if (v13)
            {
              v14 = [objc_alloc(MEMORY[0x1E69916B8]) initWithPixelBufferProvider:v18];
              if (v14)
              {
                [v12 setShadingFPNCorrectionImage:v13];
                [v12 setBlacklevelShadingCorrectionThumbnails:v14];
                [dictionary setObject:v12 forKeyedSubscript:{objc_msgSend(v9, "portType")}];
              }
            }

            else
            {
              v14 = 0;
            }
          }

          else
          {
            v14 = 0;
            v13 = 0;
          }
        }

        else
        {
          v14 = 0;
          v13 = 0;
          v12 = 0;
        }

        ++v8;
      }

      while (v5 != v8);
      v15 = [(NSArray *)obj countByEnumeratingWithState:&v20 objects:v19 count:16];
      v5 = v15;
    }

    while (v15);
  }

  result = [dictionary count];
  if (result)
  {
    return [MEMORY[0x1E695DF20] dictionaryWithDictionary:dictionary];
  }

  return result;
}

- (void)registerForAEMatrixMetadata
{
  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  captureStreams = self->_captureStreams;
  v3 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v11;
    v6 = *off_1E798BBF8;
    v7 = MEMORY[0x1E695E118];
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v5)
        {
          objc_enumerationMutation(captureStreams);
        }

        [objc_msgSend(*(*(&v10 + 1) + 8 * i) "stream")];
      }

      v4 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
    }

    while (v4);
  }
}

- (void)_deviceWillStartStreaming
{
  if (!self)
  {
    return;
  }

  v2 = *(self + 1752);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __52__BWFigVideoCaptureDevice__deviceWillStartStreaming__block_invoke;
  block[3] = &unk_1E798F870;
  block[4] = self;
  dispatch_sync(v2, block);
  if ((([objc_msgSend(*(self + 624) objectForKeyedSubscript:{@"Focus", "BOOLValue"}] & 1) != 0 || objc_msgSend(objc_msgSend(*(self + 624), "objectForKeyedSubscript:", @"Exposure"), "BOOLValue")) && !objc_msgSend(objc_msgSend(objc_msgSend(*(self + 600), "stream"), "supportedProperties"), "objectForKeyedSubscript:", *off_1E798C0B0))
  {
    v398 = 0u;
    v397 = 0u;
    v396 = 0u;
    v395 = 0u;
    v3 = *(self + 656);
    v4 = [v3 countByEnumeratingWithState:&v395 objects:v394 count:16];
    if (v4)
    {
      v5 = v4;
      v6 = *v396;
      do
      {
        for (i = 0; i != v5; ++i)
        {
          if (*v396 != v6)
          {
            objc_enumerationMutation(v3);
          }

          [*(*(&v395 + 1) + 8 * i) setFaceDetectionEnabled:1];
        }

        v5 = [v3 countByEnumeratingWithState:&v395 objects:v394 count:16];
      }

      while (v5);
    }
  }

  v8 = *(self + 1560);
  if (v8)
  {
    stream = [v8 stream];
    [stream setProperty:*off_1E798C0F0 value:MEMORY[0x1E695E118]];
  }

  *(self + 1584) = 0;
  [(BWFigVideoCaptureDevice *)self _resetSDOFEffectAndStagePreviewStatus];
  if (*(self + 1568) == 1)
  {
    [(BWFigVideoCaptureDevice *)self _updateStreamingForegroundSegmentationNetworkUsingStage:?];
    v10 = objc_alloc_init(MEMORY[0x1E695DF90]);
    if (*(self + 1560))
    {
      portType = [*(self + 600) portType];
      v24 = &unk_1F224A940;
      v23 = v10;
    }

    else
    {
      if (![self isBravoVariant])
      {
LABEL_25:
        *(self + 1584) = v10;
        goto LABEL_26;
      }

      if (FigCapturePlatformIdentifier() < 9)
      {
        v393 = 0u;
        v392 = 0u;
        v391 = 0u;
        v390 = 0u;
        v66 = *(self + 656);
        v67 = [v66 countByEnumeratingWithState:&v390 objects:v389 count:16];
        if (v67)
        {
          v68 = v67;
          v69 = *v391;
          do
          {
            for (j = 0; j != v68; ++j)
            {
              if (*v391 != v69)
              {
                objc_enumerationMutation(v66);
              }

              [v10 setObject:&unk_1F224A950 forKeyedSubscript:{objc_msgSend(*(*(&v390 + 1) + 8 * j), "portType")}];
            }

            v68 = [v66 countByEnumeratingWithState:&v390 objects:v389 count:16];
          }

          while (v68);
        }

        goto LABEL_25;
      }

      if (*(self + 680))
      {
        v11 = MEMORY[0x1E696AD98];
        [*(self + 600) baseZoomFactor];
        *&v13 = v12 / 1.33;
        [v10 setObject:objc_msgSend(v11 forKeyedSubscript:{"numberWithFloat:", v13), objc_msgSend(*(self + 680), "portType")}];
      }

      v14 = *(self + 672);
      if (v14)
      {
        v15 = MEMORY[0x1E696AD98];
        [v14 baseZoomFactor];
        *&v17 = v16 / 1.33;
        [v10 setObject:objc_msgSend(v15 forKeyedSubscript:{"numberWithFloat:", v17), objc_msgSend(*(self + 672), "portType")}];
      }

      v18 = MEMORY[0x1E696AD98];
      [*(self + 600) baseZoomFactor];
      *&v20 = v19 / 1.33;
      v21 = [v18 numberWithFloat:v20];
      portType = [*(self + 600) portType];
      v23 = v10;
      v24 = v21;
    }

    [v23 setObject:v24 forKeyedSubscript:portType];
    goto LABEL_25;
  }

LABEL_26:
  v292 = (self + 1560);
  if ((*(self + 1593) & 1) != 0 || *(self + 1595) == 1)
  {
    os_unfair_lock_lock((self + 1596));

    *(self + 4000) = 0;
    os_unfair_lock_unlock((self + 1596));
    v25 = +[FigCaptureCameraParameters sharedInstance];
    *(self + 1624) = 1;
    if (*(self + 672))
    {
      [self requestedZoomFactorRelativeToPortType:*off_1E798A0C0];
      v27 = v39;
      portType2 = [*(self + 672) portType];
      sensorIDString = [*(self + 672) sensorIDString];
      LODWORD(v42) = v27;
      v43 = [(FigCaptureCameraParameters *)v25 portraitSceneMonitoringParametersForPortType:portType2 sensorIDString:sensorIDString zoomFactorRelativeToWidePortType:v42];
      portType3 = [*(self + 672) portType];
      v45 = *(self + 672);
    }

    else
    {
      if (!*(self + 680))
      {
        if (!*v292)
        {
          [self requestedZoomFactorRelativeToPortType:{objc_msgSend(*(self + 600), "portType")}];
          v27 = v26;
          portType4 = [*(self + 600) portType];
          sensorIDString2 = [*(self + 600) sensorIDString];
          LODWORD(v30) = v27;
          v31 = [(FigCaptureCameraParameters *)v25 portraitSceneMonitoringParametersForPortType:portType4 sensorIDString:sensorIDString2 zoomFactorRelativeToWidePortType:v30];
          v32 = v31;
          if (*(self + 2268) == 10)
          {
            *(self + 1624) = [objc_msgSend(v31 objectForKeyedSubscript:{@"SubjectTooFarMonitoringEnabled", "BOOLValue"}];
            v33 = [BWBravoPortraitSceneMonitorV3 alloc];
            v35 = *(self + 1595);
            v36 = *(self + 1593);
            v37 = (*(self + 1624) & 1) == 0;
            v38 = v32;
LABEL_50:
            LODWORD(v34) = v27;
            v53 = [(BWBravoPortraitSceneMonitorV3 *)v33 initWithTuningParameters:v38 zoomFactor:v35 portraitAutoSuggestEnabled:v36 shallowDepthOfFieldEnabled:0 attachDebugFrameStatistics:v37 stageSegmentationMonitoringEnabled:v34];
LABEL_68:
            *(self + 1616) = v53;
            goto LABEL_69;
          }

          v71 = [BWSingleCameraPortraitSceneMonitor alloc];
          v72 = v32;
LABEL_67:
          v53 = [(BWSingleCameraPortraitSceneMonitor *)v71 initWithTuningParameters:v72 attachDebugFrameStatistics:0];
          goto LABEL_68;
        }

        [self requestedZoomFactorRelativeToPortType:{objc_msgSend(*v292, "portType")}];
        v61 = v60;
        portType5 = [*(self + 1560) portType];
        sensorIDString3 = [*(self + 1560) sensorIDString];
        LODWORD(v64) = v61;
        v43 = [(FigCaptureCameraParameters *)v25 portraitSceneMonitoringParametersForPortType:portType5 sensorIDString:sensorIDString3 zoomFactorRelativeToWidePortType:v64];
        v65 = -[FigCaptureCameraParameters portraitSceneMonitorVersionForPortType:sensorIDString:](v25, "portraitSceneMonitorVersionForPortType:sensorIDString:", [*(self + 1560) portType], objc_msgSend(*(self + 1560), "sensorIDString"));
        if (*(self + 3993) == 1)
        {
          v59 = BWPearlCinematicVideoSceneMonitor;
        }

        else
        {
          if (v65 == 2)
          {
            v53 = [[BWPearlPortraitSceneMonitorV2 alloc] initWithTuningParameters:v43 attachDebugFrameStatistics:0 portraitAutoSuggestEnabled:*(self + 1595) shallowDepthOfFieldEnabled:*(self + 1593)];
            goto LABEL_68;
          }

          v59 = BWPearlPortraitSceneMonitor;
        }

LABEL_66:
        v71 = [v59 alloc];
        v72 = v43;
        goto LABEL_67;
      }

      [self requestedZoomFactorRelativeToPortType:*off_1E798A0C0];
      v27 = v54;
      portType6 = [*(self + 600) portType];
      sensorIDString4 = [*(self + 600) sensorIDString];
      LODWORD(v57) = v27;
      v43 = [(FigCaptureCameraParameters *)v25 portraitSceneMonitoringParametersForPortType:portType6 sensorIDString:sensorIDString4 zoomFactorRelativeToWidePortType:v57];
      portType3 = [*(self + 600) portType];
      v45 = *(self + 600);
    }

    v58 = -[FigCaptureCameraParameters portraitSceneMonitorVersionForPortType:sensorIDString:](v25, "portraitSceneMonitorVersionForPortType:sensorIDString:", portType3, [v45 sensorIDString]);
    if (*(self + 3993) == 1)
    {
      v59 = BWBravoCinematicVideoSceneMonitor;
    }

    else
    {
      if (v58 == 3)
      {
        *(self + 1624) = [objc_msgSend(v43 objectForKeyedSubscript:{@"SubjectTooFarMonitoringEnabled", "BOOLValue"}];
        v33 = [BWBravoPortraitSceneMonitorV3 alloc];
        v35 = *(self + 1595);
        v36 = *(self + 1593);
        v37 = (*(self + 1624) & 1) == 0;
        v38 = v43;
        goto LABEL_50;
      }

      if (v58 == 2)
      {
        v59 = BWBravoPortraitSceneMonitorV2;
      }

      else
      {
        v59 = BWBravoPortraitSceneMonitor;
      }
    }

    goto LABEL_66;
  }

  if (*(self + 4052) >= 3)
  {
    v46 = +[FigCaptureCameraParameters sharedInstance];
    dictionary = [MEMORY[0x1E695DF90] dictionary];
    v385 = 0u;
    v386 = 0u;
    v387 = 0u;
    v388 = 0u;
    v48 = *(self + 656);
    v49 = [v48 countByEnumeratingWithState:&v385 objects:v384 count:16];
    if (v49)
    {
      v50 = v49;
      v51 = *v386;
      do
      {
        for (k = 0; k != v50; ++k)
        {
          if (*v386 != v51)
          {
            objc_enumerationMutation(v48);
          }

          [dictionary setObject:-[FigCaptureCameraParameters actionCameraSceneMonitoringParametersForPortType:sensorIDString:](v46 forKeyedSubscript:{"actionCameraSceneMonitoringParametersForPortType:sensorIDString:", objc_msgSend(*(*(&v385 + 1) + 8 * k), "portType"), objc_msgSend(*(*(&v385 + 1) + 8 * k), "sensorIDString")), objc_msgSend(*(*(&v385 + 1) + 8 * k), "portType")}];
        }

        v50 = [v48 countByEnumeratingWithState:&v385 objects:v384 count:16];
      }

      while (v50);
    }

    v53 = [[BWActionCameraSceneMonitor alloc] initWithTuningParametersByPortType:dictionary videoStabilizationStrength:*(self + 4052) bravoTelephotoEnabled:*(self + 672) != 0 attachDebugFrameStatistics:0];
    goto LABEL_68;
  }

LABEL_69:
  if ((*(self + 217) & 1) != 0 || *(self + 218) == 1)
  {
    v73 = +[FigCaptureCameraParameters sharedInstance];
    dictionary2 = [MEMORY[0x1E695DF90] dictionary];
    v380 = 0u;
    v381 = 0u;
    v382 = 0u;
    v383 = 0u;
    v75 = *(self + 656);
    v76 = [v75 countByEnumeratingWithState:&v380 objects:v379 count:16];
    if (v76)
    {
      v77 = v76;
      v78 = *v381;
      do
      {
        for (m = 0; m != v77; ++m)
        {
          if (*v381 != v78)
          {
            objc_enumerationMutation(v75);
          }

          v80 = *(*(&v380 + 1) + 8 * m);
          v81 = *(self + 217);
          portType7 = [v80 portType];
          sensorIDString5 = [v80 sensorIDString];
          if (v81 == 1)
          {
            v84 = [(FigCaptureCameraParameters *)v73 stereoVideoCaptureSceneMonitoringParametersForPortType:portType7 sensorIDString:sensorIDString5];
          }

          else
          {
            v84 = [(FigCaptureCameraParameters *)v73 stereoPhotoCaptureSceneMonitoringParametersForPortType:portType7 sensorIDString:sensorIDString5];
          }

          [dictionary2 setObject:v84 forKeyedSubscript:{objc_msgSend(v80, "portType")}];
        }

        v77 = [v75 countByEnumeratingWithState:&v380 objects:v379 count:16];
      }

      while (v77);
    }

    *(self + 1632) = [[BWStereoVideoCaptureSceneMonitor alloc] initWithTuningParametersByPortType:dictionary2 attachDebugFrameStatistics:0];
    *(self + 1640) = 1;
  }

  if (*(self + 1672) == 1 && *(self + 1673) == 1)
  {
    if (!*(self + 1680))
    {
      *(self + 1680) = [[BWSmartFramingSceneMonitor alloc] initWithDynamicFieldOfViewRectsEnabled:0];
    }

    os_unfair_lock_lock((self + 1692));
    [*(self + 1680) setSmartFramingFieldOfViewRects:*(self + 1712)];
    os_unfair_lock_unlock((self + 1692));
  }

  else if (*(self + 189) == 1 && *(self + 216) == 1 && !*(self + 1680))
  {
    [self setSmartFramingIsMonitoringScene:1];
    *(self + 1680) = [[BWSmartFramingSceneMonitor alloc] initWithDynamicFieldOfViewRectsEnabled:1];

    *(self + 1728) = 0;
  }

  v85 = *(self + 2816);
  if (v85 && (*(self + 2648) & 1) == 0)
  {

    *(self + 2816) = 0;
  }

  if (*(self + 2648) != 1)
  {
    HIDWORD(v291) = 0;
    goto LABEL_113;
  }

  [(BWFigVideoCaptureDevice *)self _setupStillImageCaptureStateMachine];
  if ([*(self + 600) hasSphere] && (objc_msgSend(*(self + 600), "enablesSphereWhenAvailable") & 1) != 0)
  {
    v86 = 1;
LABEL_101:
    HIDWORD(v291) = v86;
    goto LABEL_103;
  }

  if ([*(self + 600) motionDataDeliveryEnabled])
  {
    v86 = *(self + 2176) != 0;
    goto LABEL_101;
  }

  HIDWORD(v291) = 0;
LABEL_103:
  if (BWDeviceIsiPhone() && !*(self + 2816))
  {
    *(self + 2816) = objc_alloc_init(BWAmbientLightSensor);
  }

  v378 = 0u;
  v377 = 0u;
  v376 = 0u;
  v375 = 0u;
  v87 = *(self + 656);
  v88 = [v87 countByEnumeratingWithState:&v375 objects:v374 count:16];
  if (v88)
  {
    v95 = v88;
    v96 = *v376;
    do
    {
      for (n = 0; n != v95; ++n)
      {
        if (*v376 != v96)
        {
          objc_enumerationMutation(v87);
        }

        v98 = *(*(&v375 + 1) + 8 * n);
        v99 = MEMORY[0x1E696AD98];
        [(BWFigVideoCaptureDevice *)self _ubHighResolutionNondisruptiveSwitchingFormatIndexForCaptureStream:v98, v89, v90, v91, v92, v93, v94, v287, v288, v289, v291, v292, v293, v295, v297, v298, v300, v301, v302, obj, v305, v306, v307, v308, v309, v310, v311, v312, v313, v314, v315, v316, v317, v318, selfCopy, v320, p_time, v322, v323, v324, v325, v326, v327];
        [*(self + 2248) setObject:objc_msgSend(v99 forKeyedSubscript:{"numberWithInt:", v100), objc_msgSend(v98, "portType")}];
      }

      v95 = [v87 countByEnumeratingWithState:&v375 objects:v374 count:16];
    }

    while (v95);
  }

LABEL_113:
  -[BWFigVideoCaptureDevice _configureZoomFudgingWithAspectRatio:](self, [self aspectRatio]);
  v101 = *(self + 3360);
  [*(self + 2952) requestedZoomFactor];
  [v101 requestedZoomFactorChanged:?];
  if (*(self + 1568) == 1 && (*(self + 1576) - 1) <= 1 && [self isBravoVariant])
  {
    [*(self + 2952) requestedZoomFactor];
    [BWFigVideoCaptureDevice _setISPZoomFactorSynchronously:self];
  }

  else
  {
    [BWFigVideoCaptureDevice _setISPZoomFactorSynchronously:self];
    [*(self + 2952) requestedZoomFactor];
    v103 = v102;
    [self aspectRatio];
    [BWFigVideoCaptureDevice _updateSensorRegionsOfInterestBasedOnZoomFactor:self aspectRatio:v103];
  }

  [*(self + 2952) reset];
  [(BWFigVideoCaptureDevice *)self _setupZoomRampTuning];
  v373 = 0u;
  v372 = 0u;
  v371 = 0u;
  v370 = 0u;
  v105 = *(self + 656);
  v106 = [v105 countByEnumeratingWithState:&v370 objects:v369 count:16];
  if (v106)
  {
    v107 = v106;
    v108 = *v371;
    do
    {
      for (ii = 0; ii != v107; ++ii)
      {
        if (*v371 != v108)
        {
          objc_enumerationMutation(v105);
        }

        [(BWFigVideoCaptureDevice *)self _serviceNondisruptiveSwitchingFormatForCaptureStream:0 frameStatistics:0 streamingImageIntent:0 isStationary:?];
      }

      v107 = [v105 countByEnumeratingWithState:&v370 objects:v369 count:16];
    }

    while (v107);
  }

  if (*(self + 3947) == 1)
  {
    maximumFrameRate = [*(self + 600) maximumFrameRate];
    *(self + 3964) = FigCaptureFrameRateAsFloat(maximumFrameRate, v111);
  }

  v112 = (self + 4096);
  *&v310 = self + 2952;
  v113 = (self + 656);
  *&v311 = self + 4096;
  if (![self isBravoVariant])
  {
    goto LABEL_330;
  }

  if (*(self + 705) == 1)
  {
    v114 = [objc_msgSend(*(self + 648) "syncGroup")];
    v115 = *off_1E798CC70;
    if ([v114 objectForKeyedSubscript:*off_1E798CC70])
    {
      syncGroup = [*(self + 648) syncGroup];
      [syncGroup setProperty:v115 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithBool:", *(self + 706))}];
    }
  }

  v117 = *(self + 672);
  v118 = 0;
  v119 = 0.0;
  if (v117)
  {
    v120 = [objc_msgSend(v117 "stream")];
    if (v120)
    {
      v119 = vcvts_n_f32_s32([v120 intValue], 8uLL);
    }

    [*(self + 672) maxEIT];
    v118 = v121;
  }

  if (*(self + 1568) == 1)
  {
    v122 = *(self + 1492);
    v123 = *(self + 1496);
  }

  else if (*(self + 3888) == 1)
  {
    v123 = *(self + 1504);
    v122 = v123;
  }

  else
  {
    v123 = *(self + 1484);
    v122 = *(self + 1476);
  }

  v124 = (self + 600);
  maximumFrameRate2 = [*(self + 600) maximumFrameRate];
  if (FigCaptureFrameRateAsInt(maximumFrameRate2, v126) / v122 < 5)
  {
    v129 = 4;
  }

  else
  {
    maximumFrameRate3 = [*v124 maximumFrameRate];
    v129 = FigCaptureFrameRateAsInt(maximumFrameRate3, v128) / v122;
  }

  *(self + 1480) = v129;
  maximumFrameRate4 = [*(self + 600) maximumFrameRate];
  v307 = (self + 600);
  v308 = (self + 672);
  if (FigCaptureFrameRateAsInt(maximumFrameRate4, v131) / v123 < 3)
  {
    v134 = 2;
  }

  else
  {
    maximumFrameRate5 = [*v124 maximumFrameRate];
    v134 = FigCaptureFrameRateAsInt(maximumFrameRate5, v133) / v123;
  }

  LODWORD(v309) = v134;
  *(self + 1488) = v134;
  *(self + 1516) = 0;
  *(self + 1536) = 0;
  v135 = [*(self + 656) count];
  [*(self + 600) maximumSupportedFrameRate];
  v137 = v136;
  if ([*(self + 600) videoHDRFusionEnabled])
  {
    v137 = v137 + v137;
  }

  v365 = 0u;
  v366 = 0u;
  v367 = 0u;
  v368 = 0u;
  v138 = *(self + 656);
  v139 = [v138 countByEnumeratingWithState:&v365 objects:v364 count:16];
  if (v139)
  {
    v140 = v139;
    v141 = *v366;
    do
    {
      for (jj = 0; jj != v140; ++jj)
      {
        if (*v366 != v141)
        {
          objc_enumerationMutation(v138);
        }

        if ((*(self + 1508) & 1) == 0 && (*(self + 1545) & 1) == 0 && (*(self + 1568) & 1) == 0 && *(self + 218) != 1)
        {
LABEL_160:
          v143 = 0;
          goto LABEL_162;
        }

        v143 = *(self + 3888) ^ 1;
        if ((*(self + 3888) & 1) == 0 && v135 >= 3)
        {
          if (*(self + 1568))
          {
            goto LABEL_160;
          }

          v143 = *(self + 218) ^ 1;
        }

LABEL_162:
        [*(*(&v365 + 1) + 8 * jj) setFirmwareTimeMachineEnabledWhenConfiguredAsSlave:v143 & 1];
      }

      v140 = [v138 countByEnumeratingWithState:&v365 objects:v364 count:16];
    }

    while (v140);
  }

  v144 = (self + 707);
  *(self + 707) = 0;
  *(self + 709) = 0;
  if ((*(self + 1568) & 1) == 0)
  {
    if ((*(self + 218) & 1) == 0)
    {
      v149 = v309;
      if ((*(self + 3888) & 1) == 0)
      {
        v306 = self + 707;
        v362 = 0u;
        v363 = 0u;
        v360 = 0u;
        v361 = 0u;
        v159 = *v113;
        v160 = [*v113 countByEnumeratingWithState:&v360 objects:v359 count:16];
        if (v160)
        {
          v162 = v160;
          v305 = self + 656;
          v163 = 0;
          DWORD2(v310) = 0;
          v161 = 0;
          v164 = *v361;
          v165 = *off_1E798A0C0;
          do
          {
            for (kk = 0; kk != v162; ++kk)
            {
              if (*v361 != v164)
              {
                objc_enumerationMutation(v159);
              }

              v167 = *(*(&v360 + 1) + 8 * kk);
              if ([v167 streamingRequiredWhenConfiguredAsSlave])
              {
                ++v161;
              }

              else if ([objc_msgSend(v167 "portType")] && ((*(self + 704) & 1) != 0 || *(self + 706) == 1))
              {
                ++v161;
                v163 = 1;
              }

              else if ([v167 visionDataRequiredWhenConfiguredAsSlave])
              {
                ++v161;
                ++DWORD2(v310);
              }
            }

            v162 = [v159 countByEnumeratingWithState:&v360 objects:v359 count:16];
          }

          while (v162);
          v145 = v163 ^ 1;
          v112 = v311;
          v113 = (self + 656);
        }

        else
        {
          DWORD2(v310) = 0;
          v161 = 0;
          v145 = 1;
        }

        v158 = v161 >= v135;
        if (v161 >= v135)
        {
          v157 = v161;
        }

        else
        {
          v157 = v161 + 1;
        }

        v149 = v309;
        v144 = (self + 707);
        goto LABEL_201;
      }

      DWORD2(v310) = 0;
      v157 = 2;
      v145 = 1;
      goto LABEL_181;
    }

    DWORD2(v310) = 0;
    v157 = 2;
    v145 = 1;
LABEL_174:
    v158 = 1;
    v149 = v309;
    goto LABEL_201;
  }

  v145 = 1;
  if (v135 < 3)
  {
    DWORD2(v310) = 0;
    v157 = 2;
    goto LABEL_174;
  }

  *(self + 709) = 1;
  maximumFrameRate6 = [*(self + 600) maximumFrameRate];
  v148 = FigCaptureFrameRateAsInt(maximumFrameRate6, v147);
  v149 = v309;
  v150 = v309;
  if (v148 / *(self + 1500) < v309)
  {
    maximumFrameRate7 = [*(self + 600) maximumFrameRate];
    v150 = FigCaptureFrameRateAsInt(maximumFrameRate7, v152) / *(self + 1500);
  }

  if (v150 < 3)
  {
    DWORD2(v310) = 0;
    v157 = 2;
    v158 = 1;
    v149 = 2;
    goto LABEL_201;
  }

  maximumFrameRate8 = [*(self + 600) maximumFrameRate];
  if (FigCaptureFrameRateAsInt(maximumFrameRate8, v154) / *(self + 1500) >= v309)
  {
    DWORD2(v310) = 0;
    v157 = 2;
LABEL_181:
    v158 = 1;
    goto LABEL_201;
  }

  maximumFrameRate9 = [*(self + 600) maximumFrameRate];
  DWORD2(v310) = 0;
  v157 = 2;
  v158 = 1;
  v149 = (FigCaptureFrameRateAsInt(maximumFrameRate9, v156) / *(self + 1500));
LABEL_201:
  if (*(self + 592))
  {
    v168 = 0;
    goto LABEL_213;
  }

  v169 = [*v113 count];
  v170 = v144;
  if (v169 == 1)
  {
    goto LABEL_204;
  }

  if (v137 > 30.0)
  {
    goto LABEL_209;
  }

  v170 = v144;
  if (v157 == 1)
  {
    goto LABEL_204;
  }

  if (v157 == 2 && ((v145 | v158) & 1) == 0)
  {
    v170 = (self + 708);
LABEL_204:
    *v170 = 1;
  }

LABEL_209:
  if (v157 < v135)
  {
    v168 = *v144;
  }

  else
  {
    v168 = 0;
  }

  v157 += v168;
  if (*(self + 3896) != 1)
  {
    goto LABEL_224;
  }

LABEL_213:
  if (v157 == 1)
  {
    v168 = 1;
    v157 = 2;
  }

  if (v157 < v135)
  {
    v171 = (self + 600);
    [*v307 maximumFrameRateForSensorRawOutputBufferPoolRequirements];
    if (v172 == 0.0)
    {
      maximumFrameRate10 = [*v307 maximumFrameRate];
      v172 = FigCaptureFrameRateAsFloat(maximumFrameRate10, v174);
    }

    v175 = 1484;
    if (*(self + 1592))
    {
      v175 = 1500;
    }

    v176 = v172 / *(self + v175);
    if (v176 >= v149)
    {
      v176 = v149;
    }

    v149 = fmaxf(v176, 2.0);
  }

  else
  {
LABEL_224:
    v171 = (self + 600);
  }

  if (v157 <= 1)
  {
    v177 = 1;
  }

  else
  {
    v177 = v157;
  }

  *(self + 1424) = v177 - 1;
  if ((v157 < 2 || [*(self + 648) maximumNumberOfSlaveStreamsWithoutFrameSkippingSupported]) && (*(self + 1545) & 1) == 0)
  {
    if (SDWORD2(v310) >= 1 && *(self + 1424) == DWORD2(v310))
    {
      v178 = *(self + 3400);
      maximumFrameRate11 = [*(self + 600) maximumFrameRate];
      v181 = FigCaptureFrameRateAsFloat(maximumFrameRate11, v180);
      v182 = v181;
      if (v178 > 0.0)
      {
        if (v178 >= v181)
        {
          maximumFrameRate12 = [*v171 maximumFrameRate];
          v182 = FigCaptureFrameRateAsFloat(maximumFrameRate12, v184);
        }

        else
        {
          v182 = *(self + 3400);
        }
      }

      maximumFrameRate13 = [*v171 maximumFrameRate];
      LODWORD(v149) = vcvtps_s32_f32(FigCaptureFrameRateAsFloat(maximumFrameRate13, v186) / v182);
    }
  }

  else
  {
    v149 = 1;
  }

  [(BWFigVideoCaptureDevice *)self _setMinimumMasterToSlaveFrameRateRatio:v149];
  [*(self + 648) setMaximumNumberOfSlaveStreamsWithoutFrameSkipping:*(self + 1424)];
  [*(self + 648) setMaximumNumberOfSlaveStreamsWithFrameProcessingEnabled:(*(self + 1424) - v168)];
  v187 = *(self + 4708);
  if (v187 <= 0)
  {
    v188 = 0;
  }

  else
  {
    v188 = (v187 - 1);
  }

  [*(self + 648) setMaximumNumberOfEnabledSlaveTimeMachines:v188];
  [BWFigVideoCaptureDevice _updateStatsMasterForMasterStream:self];
  v189 = [objc_msgSend(*(self + 648) "syncGroup")];
  v190 = *off_1E798CCC8;
  if ([v189 objectForKeyedSubscript:*off_1E798CCC8])
  {
    syncGroup2 = [*(self + 648) syncGroup];
    [syncGroup2 setProperty:v190 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithBool:", *(self + 710))}];
  }

  v192 = [objc_msgSend(*(self + 648) "syncGroup")];
  v193 = *off_1E798CC60;
  if ([v192 objectForKeyedSubscript:*off_1E798CC60])
  {
    syncGroup3 = [*(self + 648) syncGroup];
    [syncGroup3 setProperty:v193 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithBool:", *(self + 217))}];
  }

  if (!*(self + 680) || (v198 = (self + 680), [*v310 requestedZoomFactor], v200 = v199, objc_msgSend(*v171, "baseZoomFactor"), v200 >= v201) && (!objc_msgSend(*(self + 4376), "isEqualToString:", objc_msgSend(*(self + 680), "portType")) || (objc_msgSend(objc_msgSend(*(self + 1416), "eligibleFallbackPortTypes"), "containsObject:", *(self + 4376)) & 1) == 0))
  {
    if (!*v308)
    {
      goto LABEL_249;
    }

    [*v310 requestedZoomFactor];
    v196 = v195;
    [*v308 baseZoomFactor];
    if (v196 < v197)
    {
      goto LABEL_249;
    }

    if (![objc_msgSend(*(self + 1416) "eligibleFallbackPortTypes")])
    {
      v198 = (self + 672);
      goto LABEL_258;
    }

    v198 = (self + 672);
    if (([*(self + 4376) isEqualToString:{objc_msgSend(*(self + 672), "portType")}] & 1) == 0)
    {
LABEL_249:
      v198 = v171;
    }
  }

LABEL_258:
  v202 = *v198;
  *(self + 1392) = *v198;
  *(self + 688) = v202;
  if (*(self + 3888) == 1)
  {
    v112[8] = 1;
    if (*(self + 4088) == 1)
    {
      v112[1] = 1;
      *(self + 4100) = 0;
    }

    [*(self + 2952) requestedZoomFactor];
    if (*(self + 3898) == 1)
    {
      v203 = *(self + 1392);
    }

    else
    {
      v203 = [BWFigVideoCaptureDevice _overCaptureMasterStreamForZoomFactor:self];
      *(self + 1392) = v203;
    }

    v205 = [BWFigVideoCaptureDevice _overCaptureActiveSlaveStreamForZoomFactor:self masterStream:v203 currentFrameRate:0 preferWider:?];
    [v205 setStreamingRequiredWhenConfiguredAsSlave:1];
    if ((*(self + 1568) & 1) != 0 || *(self + 218) == 1)
    {
      v206 = *(self + 3448);
    }

    else
    {
      v206 = 0;
    }

    v208 = v206 & 1;
    v207 = v205;
  }

  else
  {
    if ((*(self + 1568) & 1) == 0 && *(self + 218) != 1)
    {
      v205 = 0;
      goto LABEL_277;
    }

    v204 = [*(self + 664) indexOfObject:?];
    if (v204 >= 1)
    {
      v205 = [*(self + 664) objectAtIndexedSubscript:(v204 - 1)];
    }

    else
    {
      v205 = 0;
    }

    v207 = v205;
    v208 = 1;
  }

  [v207 setFirmwareTimeMachineEnabledWhenConfiguredAsSlave:v208];
LABEL_277:
  *(self + 1400) = *(self + 1392);
  if (*(self + 1544) == 1)
  {
    v209 = [*(self + 664) indexOfObject:?];
    if (v209 >= [*(self + 664) count] - 1 || (v210 = objc_msgSend(*(self + 664), "objectAtIndexedSubscript:", v209 + 1)) == 0)
    {
      v210 = *(self + 1392);
    }

    *(self + 1536) = v210;
  }

  if ([*v113 count] < 3)
  {
    goto LABEL_310;
  }

  if (v205)
  {
    goto LABEL_307;
  }

  v357 = 0u;
  v358 = 0u;
  v355 = 0u;
  v356 = 0u;
  v211 = *v113;
  v212 = [*v113 countByEnumeratingWithState:&v355 objects:v354 count:16];
  if (v212)
  {
    v217 = v212;
    v205 = 0;
    v218 = *v356;
    do
    {
      for (mm = 0; mm != v217; ++mm)
      {
        v220 = v205;
        if (*v356 != v218)
        {
          objc_enumerationMutation(v211);
        }

        v205 = *(*(&v355 + 1) + 8 * mm);
        if (![v205 streamingRequiredWhenConfiguredAsSlave] || v205 == *(self + 1392))
        {
          v205 = v220;
        }

        else if (v220)
        {
          goto LABEL_285;
        }
      }

      v217 = [v211 countByEnumeratingWithState:&v355 objects:v354 count:16];
    }

    while (v217);
    if (v205)
    {
      goto LABEL_307;
    }
  }

LABEL_285:
  [*(self + 2952) requestedZoomFactor];
  v205 = [(BWFigVideoCaptureDevice *)self _captureStreamBasedSolelyOnZoomFactor:v213];
  if (v205 != *(self + 1392))
  {
    goto LABEL_304;
  }

  v214 = [*(self + 664) indexOfObject:?];
  v215 = *(self + 664);
  if (v214)
  {
    if (v214 >= [v215 count])
    {
      goto LABEL_304;
    }

    v215 = *(self + 664);
    v216 = v214 - 1;
  }

  else
  {
    v216 = 1;
  }

  v205 = [v215 objectAtIndexedSubscript:v216];
LABEL_304:
  if (v205)
  {
LABEL_307:
    v353[0] = *(self + 1392);
    v353[1] = v205;
    v222 = MEMORY[0x1E695DEC8];
    v223 = v353;
    v224 = 2;
LABEL_308:
    v221 = [v222 arrayWithObjects:v223 count:v224];
    goto LABEL_309;
  }

  if (*(self + 1392))
  {
    v352 = *(self + 1392);
    v222 = MEMORY[0x1E695DEC8];
    v223 = &v352;
    v224 = 1;
    goto LABEL_308;
  }

  v221 = 0;
LABEL_309:
  [*(self + 696) setSynchronizationSlavesOrderedByPriority:v221];
LABEL_310:
  v225 = v112[365] != 1 || (v112[364] & 1) != 0 || *(self + 1392) == *(self + 600);
  if ([*(self + 696) waitForMasterAEToSettle] && !v225)
  {
    [*(self + 696) setWaitForMasterAEToSettle:0];
  }

  [(BWFigVideoCaptureDevice *)self _updateBravoStreamSelectionForMasterStream:1 forceNotification:?];
  v226 = *(self + 1416);
  [*(self + 2952) requestedZoomFactor];
  [v226 resetWithZoomFactor:*(self + 1392) currentMasterStream:?];
  *&v227 = v119;
  [*(self + 1416) setTeleMaxAEGain:v227];
  LODWORD(v228) = v118;
  [*(self + 1416) setTeleMaxEIT:v228];
  if (*(self + 1576) == 3)
  {
    [BWFigVideoCaptureDevice _setSynchronizedStreamsGroupProperty:self value:?];
  }

  v350 = 0u;
  v351 = 0u;
  v348 = 0u;
  v349 = 0u;
  v229 = *v113;
  v230 = [*v113 countByEnumeratingWithState:&v348 objects:v347 count:16];
  if (v230)
  {
    v231 = v230;
    v232 = *v349;
    do
    {
      for (nn = 0; nn != v231; ++nn)
      {
        if (*v349 != v232)
        {
          objc_enumerationMutation(v229);
        }

        v234 = *(*(&v348 + 1) + 8 * nn);
        if (v234 == *(self + 1392))
        {
          [v234 willBecomeMasterStream];
          [v234 didBecomeMasterStream];
        }

        else
        {
          [v234 willBecomeSlaveStream];
          [v234 didBecomeSlaveStream];
        }
      }

      v231 = [v229 countByEnumeratingWithState:&v348 objects:v347 count:16];
    }

    while (v231);
  }

  FigMotionSphereShiftStateInitialize((self + 712), [self cameraInfoByPortType], 7);
  *(self + 1352) = -1;
  [*(self + 2952) requestedZoomFactor];
  [BWFigVideoCaptureDevice _updateSlaveFrameRateForZoomFactor:self];
  [*(self + 648) setMasterStream:*(self + 1392) allStreams:*(self + 656)];
  -[BWFigVideoCaptureDevice _sendMasterStreamChangedNotificationWithPortType:](self, [*(self + 1392) portType]);
  -[BWFigVideoCaptureDevice _sendPreferredMasterStreamChangedNotificationWithPortType:](self, [*(self + 1400) portType]);
LABEL_330:
  v235 = MEMORY[0x1E6960C70];
  v299 = *MEMORY[0x1E6960C70];
  *(self + 1360) = *MEMORY[0x1E6960C70];
  v294 = *(v235 + 16);
  *(self + 1376) = v294;
  v236 = MEMORY[0x1E6960CC0];
  v296 = *MEMORY[0x1E6960CC0];
  *(self + 4476) = *MEMORY[0x1E6960CC0];
  v237 = *(v236 + 16);
  *(self + 4492) = v237;
  *(self + 1556) = 0;
  [(BWFigVideoCaptureDevice *)self _sendMacroFocusChangedNotification:?];
  v112[449] = v112[448];
  *(self + 4548) = v296;
  *(self + 4564) = v237;
  *(self + 4572) = v296;
  v290 = v237;
  *(self + 4588) = v237;
  *(self + 4596) = 0;
  v112[504] = 0;
  if (*(self + 1560))
  {
    [(BWFigVideoCaptureDevice *)self _deviceWillStartStreaming:v310];
  }

  v345 = 0u;
  v346 = 0u;
  v343 = 0u;
  v344 = 0u;
  obja = *v113;
  v238 = [*v113 countByEnumeratingWithState:&v343 objects:v342 count:16];
  if (v238)
  {
    v239 = v238;
    *&v310 = *v344;
    v240 = *off_1E798BCC8;
    *(&v310 + 1) = *off_1E798BCD0;
    v302 = *off_1E798BCC0;
    v241 = *off_1E798C170;
    v242 = *off_1E798BDF8;
    v309 = *off_1E798C1E0;
    v308 = *off_1E798C1E8;
    v307 = *off_1E798C210;
    v306 = *off_1E798BF58;
    v305 = *off_1E798A248;
    v243 = MEMORY[0x1E695E118];
    do
    {
      for (i1 = 0; i1 != v239; ++i1)
      {
        if (*v344 != v310)
        {
          objc_enumerationMutation(obja);
        }

        v245 = *(*(&v343 + 1) + 8 * i1);
        stream2 = [v245 stream];
        if ([objc_msgSend(stream2 "supportedProperties")])
        {
          [stream2 setProperty:v240 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", *(self + 2056))}];
          if ([objc_msgSend(stream2 "supportedProperties")])
          {
            [stream2 setProperty:v302 value:v243];
            if (![stream2 getProperty:*(&v310 + 1) error:0])
            {
              v247 = *(self + 3504);
              if (!v247)
              {
                v247 = objc_alloc_init(MEMORY[0x1E695DFA8]);
                *(self + 3504) = v247;
              }

              [v247 addObject:{objc_msgSend(v245, "portType")}];
            }

            v248 = *(self + 3512);
            if (!v248)
            {
              v248 = objc_alloc_init(MEMORY[0x1E695DFA8]);
              *(self + 3512) = v248;
            }

            [v248 addObject:{objc_msgSend(v245, "portType")}];
            v249 = *(self + 3528);
            if (!v249)
            {
              v249 = objc_alloc_init(MEMORY[0x1E695DFA8]);
              *(self + 3528) = v249;
            }

            [v249 addObject:{objc_msgSend(v245, "portType")}];
          }

          if (!*(self + 3544))
          {
            *(self + 3544) = objc_alloc_init(MEMORY[0x1E695DF90]);
          }

          if (!*(self + 3552))
          {
            *(self + 3552) = objc_alloc_init(MEMORY[0x1E695DF90]);
          }
        }

        if ([objc_msgSend(stream2 "supportedProperties")])
        {
          [stream2 setProperty:v241 value:v243];
        }

        if ([objc_msgSend(stream2 "supportedProperties")])
        {
          [stream2 setProperty:v242 value:v243];
        }

        v250 = *(self + 1576) == 3 && v245 == [*(self + 664) firstObject];
        if ([objc_msgSend(stream2 "supportedProperties")] && (v250 & 1) == 0)
        {
          [v245 setTemporalNoiseReductionConfigurationBand0Enabled:(*(v311 + 65) & 1) == 0 rawEnabled:*(v311 + 66) modulation:*(self + 4168) adaptiveOverscanEnabled:*(self + 4058) strengthHighEnabled:*(v311 + 67)];
        }

        [stream2 setPropertyIfSupported:v308 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithBool:", *(v311 + 64) & ~v250 & 1)}];
        [stream2 setPropertyIfSupported:v307 value:v243];
        [stream2 setPropertyIfSupported:v306 value:v243];
        if ([v245 hasSphere] && objc_msgSend(objc_msgSend(stream2, "supportedProperties"), "objectForKeyedSubscript:", v241))
        {
          [stream2 setProperty:v241 value:v243];
          if (!*(self + 3560))
          {
            *(self + 3560) = objc_alloc_init(MEMORY[0x1E695DF90]);
          }

          if (!*(self + 3568))
          {
            *(self + 3568) = objc_alloc_init(MEMORY[0x1E695DF90]);
          }
        }

        v251 = [objc_msgSend(v245 "moduleInfo")];
        if (v251)
        {
          v252 = v251;
          v253 = *(self + 3664);
          if (!v253)
          {
            v253 = objc_alloc_init(MEMORY[0x1E695DF90]);
            *(self + 3664) = v253;
          }

          [v253 setObject:v252 forKeyedSubscript:{objc_msgSend(v245, "portType")}];
        }
      }

      v239 = [obja countByEnumeratingWithState:&v343 objects:v342 count:16];
    }

    while (v239);
  }

  *(self + 3672) = 0;
  *(self + 3596) = 0;
  *(self + 3392) = 0;
  v254 = v294;
  if ([objc_msgSend(*(self + 624) objectForKeyedSubscript:{@"Exposure", "BOOLValue"}])
  {
    v255 = *(self + 600);
    if (v255)
    {
      [v255 maxExposureDuration];
    }

    else
    {
      memset(&time, 0, sizeof(time));
    }

    v256 = CMTimeCopyAsDictionary(&time, *MEMORY[0x1E695E480]);
    v340 = @"NewPropertyValue";
    v341 = v256;
    [self _postNotificationWithPayload:@"MaxExposureDurationChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v341, &v340, 1)}];
  }

  if (*(self + 140) == 1)
  {
    if (*(self + 156) == 1)
    {
      [(BWFigVideoCaptureDevice *)self _updateSensorRawPools];
    }

    else
    {
      [(BWFigVideoCaptureDevice *)self _updateSensorRawPool];
      if (*(self + 148) >= 1 && *(self + 152) >= 1)
      {
        [(BWFigVideoCaptureDevice *)self _updateUltraHighResSensorRawPool:v280];
      }

      else
      {
        [*(self + 160) setObject:0 forKeyedSubscript:&unk_1F22469C0];
      }
    }
  }

  [*(self + 3880) enableForCaptureDevice:*(self + 8)];
  *(self + 2596) = v299;
  *(self + 2612) = v254;
  *(self + 2620) = 0;
  if (*(self + 3947) == 1)
  {
    v257 = v311;
    if (dword_1ED844350)
    {
      v339 = 0;
      type = OS_LOG_TYPE_DEFAULT;
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v259 = v339;
      if (os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, type))
      {
        v260 = v259;
      }

      else
      {
        v260 = v259 & 0xFFFFFFFE;
      }

      if (v260)
      {
        v261 = *(self + 120);
        v332 = 136315394;
        v333 = "[BWFigVideoCaptureDevice _deviceWillStartStreaming]";
        v334 = 2112;
        v335 = v261;
        LODWORD(v288) = 22;
        v287 = &v332;
        _os_log_send_and_compose_impl();
      }

      fig_log_call_emit_and_clean_up_after_send_and_compose();
    }

    dictionary3 = [MEMORY[0x1E695DF90] dictionary];
    v328 = 0u;
    v329 = 0u;
    v330 = 0u;
    v331 = 0u;
    v263 = *(self + 104);
    v264 = [v263 countByEnumeratingWithState:&v328 objects:&v322 count:16];
    if (v264)
    {
      v265 = v264;
      v266 = *v329;
      do
      {
        for (i2 = 0; i2 != v265; ++i2)
        {
          if (*v329 != v266)
          {
            objc_enumerationMutation(v263);
          }

          v268 = *(*(&v328 + 1) + 8 * i2);
          v269 = -[BWVariableFrameRateParameters initWithPortType:sensorIDDictionary:]([BWVariableFrameRateParameters alloc], "initWithPortType:sensorIDDictionary:", v268, [*(self + 104) objectForKeyedSubscript:v268]);
          if (v269)
          {
            v270 = v269;
            [dictionary3 setObject:v269 forKeyedSubscript:v268];
          }
        }

        v265 = [v263 countByEnumeratingWithState:&v328 objects:&v322 count:16];
      }

      while (v265);
    }

    if (!*(self + 3984))
    {
      *(self + 3984) = FigDispatchQueueCreateWithPriority();
    }

    *(self + 3976) = 0;
    v254 = v294;
    if (!*(self + 3952))
    {
      *(self + 3952) = -[BWVariableFrameRateSelector initWithPortTypes:forParameters:frameRateSwitchBasedOnMotionDisabled:teleAutoVideoFrameRateAllows24FPS:]([BWVariableFrameRateSelector alloc], "initWithPortTypes:forParameters:frameRateSwitchBasedOnMotionDisabled:teleAutoVideoFrameRateAllows24FPS:", *(self + 120), dictionary3, [objc_msgSend(+[FigCaptureSourceBackingsProvider sharedCaptureSourceBackingsProvider](FigCaptureSourceBackingsProvider "sharedCaptureSourceBackingsProvider")], *(self + 3992));
    }

    if (!*(self + 3968))
    {
      *(self + 3968) = objc_alloc_init(MEMORY[0x1E695DF90]);
    }
  }

  else
  {

    *(self + 3984) = 0;
    *(self + 3952) = 0;

    *(self + 3968) = 0;
    v257 = v311;
  }

  time.value = 0;
  *&time.timescale = &time;
  time.epoch = 0x2020000000;
  v337 = 0;
  portType8 = [*(self + 1392) portType];
  if (!portType8)
  {
    portType8 = [*(self + 600) portType];
  }

  v272 = *(self + 1656);
  v315 = MEMORY[0x1E69E9820];
  v316 = 3221225472;
  v317 = __52__BWFigVideoCaptureDevice__deviceWillStartStreaming__block_invoke_368;
  v318 = &unk_1E79907B0;
  v320 = portType8;
  p_time = &time;
  selfCopy = self;
  dispatch_sync(v272, &v315);
  v273 = *(*&time.timescale + 24);
  *(self + 3336) = v273;
  if ((v291 & 0x100000000) != 0 || v273)
  {
    v274 = objc_alloc_init(BWDeviceMotionActivityDetector);
    *(self + 3296) = v274;
    v275 = *(self + 2328);
    if (v275)
    {
      LOBYTE(v275) = *(*&time.timescale + 24);
    }

    [(BWDeviceMotionActivityDetector *)v274 setDirectionalMotionDetectionEnabled:v275 & 1];
    *(self + 3308) = v299;
    *(self + 3324) = v254;
  }

  if (*(self + 2488))
  {
    FigCaptureFrameRateFromFloat();
    [objc_msgSend(*(self + 2488) "referencedObject")];
  }

  v278 = mach_absolute_time();
  *(self + 3576) = v278;
  *(self + 296) = v278;
  *(self + 264) = v278;
  *(self + 368) = v278;
  *(self + 200) = v278;
  *(self + 4680) = v278;
  *(self + 496) = 0;
  *(self + 504) = -1;
  *(self + 512) = 0u;
  *(self + 528) = 0u;
  *(self + 328) = v278;
  *(self + 336) = 0;
  *(self + 344) = v278;
  *(self + 352) = 0;
  *(self + 3604) = 0;
  *(self + 3608) = 0;
  *(self + 3616) = -1;
  *(self + 3584) = 0;
  *(self + 3592) = 0;
  *(self + 3634) = 0;
  *(self + 3620) = 0u;
  *(self + 3644) = 0u;
  *(self + 3680) = vneg_f32(0x80000000800000);
  *(self + 3688) = 2139095039;
  *(self + 3712) = 0u;
  *(self + 3744) = v254;
  *(self + 3728) = v299;
  *(self + 3760) = 0;
  *(self + 3776) = 0;
  *(self + 3768) = v278;
  *(self + 3784) = -1;
  *(self + 3792) = 0;
  os_unfair_lock_lock((self + 4072));
  if (*(self + 4076) >= 3)
  {
    *(self + 3784) = 0;
  }

  os_unfair_lock_unlock((self + 4072));
  if (*v292)
  {
    *(self + 3696) = objc_alloc_init(BWStats);
    *(self + 3704) = objc_alloc_init(BWStats);
  }

  *(self + 3752) = objc_alloc_init(MEMORY[0x1E695DF90]);
  *(self + 4116) = 0u;
  *(self + 4132) = 0;
  *(self + 4136) = v299;
  *(self + 4152) = v254;
  v257[505] = 0;
  *(self + 4604) = 0;
  *(self + 4608) = v278;
  if (*(self + 256) == 1)
  {
    *(self + 400) = v299;
    *(self + 416) = v254;
    *(self + 424) = v296;
    *(self + 440) = v290;
  }

  if (*(self + 240) == 1)
  {
    *(self + 448) = v299;
    *(self + 464) = v254;
    *(self + 472) = v296;
    *(self + 488) = v290;
  }

  *(self + 4696) = 0;
  v279 = *(self + 4416);
  *(&v311 + 1) = MEMORY[0x1E69E9820];
  *&v312 = 3221225472;
  *(&v312 + 1) = __52__BWFigVideoCaptureDevice__deviceWillStartStreaming__block_invoke_371;
  *&v313 = &unk_1E7990178;
  *(&v313 + 1) = self;
  v314 = v278;
  dispatch_async(v279, &v311 + 8);
  v257[251] = [objc_msgSend(*(self + 600) "stream")];
  v257[250] = 1;
  [(BWFigVideoCaptureDevice *)self _updateFrameSkippingRatio];
  _Block_object_dispose(&time, 8);
}

- (int)_setupAutofocusSampleBufferProcessor
{
  OUTLINED_FUNCTION_84();
  v96 = v3;
  v5 = v4;
  v167[0] = 0;
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_0();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  if ([objc_msgSend(*(v5 + 8) "deviceID")] && (objc_msgSend(objc_msgSend(*(v5 + 600), "portType"), "isEqualToString:", *off_1E798A0C8) & 1) == 0)
  {
    v6 = *(v5 + 1744);
    if (!v6)
    {
      OUTLINED_FUNCTION_182();
      FigDebugAssert3();
      FigSignalErrorAtGM();
      goto LABEL_56;
    }

    v7 = MEMORY[0x1E695E480];
    if (v6 != FigSampleBufferProcessorCreateForAutofocus)
    {
      [*(v5 + 600) stream];
      [*(v5 + 672) stream];
      [*(v5 + 680) stream];
      [*(v5 + 648) syncGroup];
      v8 = OUTLINED_FUNCTION_17_26();
      v9 = v6(v8);
LABEL_8:
      v167[0] = v9;
      goto LABEL_56;
    }

    if (!*(v5 + 104) || (v10 = *(v5 + 600)) == 0 || !*(v5 + 96))
    {
      OUTLINED_FUNCTION_0();
      FigDebugAssert3();
      v167[0] = -12780;
      goto LABEL_56;
    }

    [objc_msgSend(v10 "stream")];
    if (v167[0])
    {
      OUTLINED_FUNCTION_14_21();
      goto LABEL_55;
    }

    [*(v5 + 600) supportedFormats];
    v11 = [v2 objectAtIndexedSubscript:{objc_msgSend(OUTLINED_FUNCTION_18_0(), "intValue")}];
    v12 = [objc_msgSend(v11 objectForKeyedSubscript:{*off_1E798D3F0), "BOOLValue"}];
    v13 = [objc_msgSend(v11 objectForKeyedSubscript:{*off_1E798D3F8), "intValue"}];
    if ([OUTLINED_FUNCTION_39() objectForKeyedSubscript:?])
    {
      v14 = [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"intValue"")];
    }

    else if (v12)
    {
      v14 = 2;
    }

    else
    {
      v14 = 1;
    }

    if ([OUTLINED_FUNCTION_9_0() objectForKeyedSubscript:?])
    {
      v15 = [objc_msgSend(OUTLINED_FUNCTION_9_0() "objectForKeyedSubscript:"intValue"")];
    }

    else if (v12)
    {
      v15 = 2;
    }

    else
    {
      v15 = 1;
    }

    v16 = *(v5 + 217);
    v17 = *(v5 + 104);
    v18 = *off_1E798A968;
    v165[0] = *off_1E798A9B8;
    v165[1] = v18;
    v19 = *(v5 + 120);
    v166[0] = v17;
    v166[1] = v19;
    v165[2] = *off_1E798A9E0;
    v20 = [MEMORY[0x1E696AD98] numberWithInt:v13];
    v21 = *off_1E798A978;
    v22 = *(v5 + 96);
    v166[2] = v20;
    v166[3] = v22;
    v23 = *off_1E798A970;
    v165[3] = v21;
    v165[4] = v23;
    v166[4] = [v5 cameraInfoByPortType];
    v165[5] = *off_1E798A9C0;
    v166[5] = [v11 objectForKeyedSubscript:*off_1E798C988];
    v165[6] = *off_1E798A9A8;
    v166[6] = [v11 objectForKeyedSubscript:*off_1E798C980];
    v165[7] = *off_1E798A998;
    v166[7] = [MEMORY[0x1E696AD98] numberWithInt:v14];
    v165[8] = *off_1E798A9A0;
    v166[8] = [MEMORY[0x1E696AD98] numberWithInt:v15];
    v165[9] = *off_1E798A988;
    v166[9] = [MEMORY[0x1E696AD98] numberWithBool:*(v5 + 3445)];
    v165[10] = *off_1E798A9C8;
    v166[10] = [MEMORY[0x1E696AD98] numberWithBool:v16];
    v165[11] = *off_1E798A980;
    v166[11] = [*(v5 + 1760) objectForKeyedSubscript:0x1F218A4D0];
    v24 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v166 forKeys:v165 count:12];
    *(v5 + 1792) = 256;
    v25 = MEMORY[0x1E6960C70];
    *(v5 + 1796) = *MEMORY[0x1E6960C70];
    *(v5 + 1812) = *(v25 + 16);
    *(v5 + 1820) = 0;
    *(v5 + 1828) = 256;
    memset(&v164, 0, sizeof(v164));
    HostTimeClock = CMClockGetHostTimeClock();
    CMClockGetTime(&v164, HostTimeClock);
    v27 = *(v5 + 1744);
    v28 = *v7;
    stream = [*(v5 + 600) stream];
    v167[0] = v27(v28, stream, [*(v5 + 672) stream], objc_msgSend(*(v5 + 680), "stream"), objc_msgSend(*(v5 + 648), "syncGroup"), v24, 0, v5 + 1784);
    memset(&v163, 0, sizeof(v163));
    v30 = CMClockGetHostTimeClock();
    CMClockGetTime(&lhs, v30);
    rhs = v164;
    v31 = CMTimeSubtract(&v163, &lhs, &rhs);
    if (OUTLINED_FUNCTION_275(v31, v32, v33, v34, v35, v36, v37, v38, v90, v92, v94, v96, v98, v100, v102, v104, v106, v108, v110, v112, v114, v116, v118, v120, v122, v124, v126, v128, v130, v132, v134, v136, v138, v140, v142, v144, *&lhs.value, lhs.epoch, v147, v148, v149, v150, v151, v152, v153, v154, v155, v156, v157, v158, v159, v160, v161, rhs.value, *&rhs.timescale, rhs.epoch, v163.value, *&v163.timescale, v163.epoch) > 0.5 && dword_1ED844350)
    {
      HIDWORD(v161) = 0;
      BYTE3(v161) = 0;
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, BYTE3(v161));
      OUTLINED_FUNCTION_4_0();
      if (stream)
      {
        v48 = OUTLINED_FUNCTION_275(v40, v41, v42, v43, v44, v45, v46, v47, p_rhs, v93, v95, v97, v99, v101, v103, v105, v107, v109, v111, v113, v115, v117, v119, v121, v123, v125, v127, v129, v131, v133, v135, v137, v139, v141, v143, v145, *&lhs.value, lhs.epoch, v147, v148, v149, v150, v151, v152, v153, v154, v155, v156, v157, v158, v159, v160, v161, rhs.value, *&rhs.timescale, rhs.epoch, v163.value, *&v163.timescale, v163.epoch);
        LODWORD(rhs.value) = 136315394;
        *(&rhs.value + 4) = "[BWFigVideoCaptureDevice _setupAutofocusSampleBufferProcessor]";
        LOWORD(rhs.flags) = 2048;
        *(&rhs.flags + 2) = v48;
        OUTLINED_FUNCTION_34_16();
        p_rhs = &rhs;
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_39_0();
    }

    if (v167[0])
    {
      goto LABEL_67;
    }

    if ([*(v5 + 1760) objectForKeyedSubscript:@"AutofocusProcessor_VideoMode"])
    {
      goto LABEL_30;
    }

    v76 = [BWFigVideoCaptureDevice _autofocusProcessorImageControlModeFromImageControlMode:?];
    if (!v76)
    {
      OUTLINED_FUNCTION_182();
      FigDebugAssert3();
      v9 = FigSignalErrorAtGM();
      goto LABEL_8;
    }

    v77 = v76;
    FigBaseObject = FigSampleBufferProcessorGetFigBaseObject();
    v79 = *(*(CMBaseObjectGetVTable() + 8) + 56);
    if (v79)
    {
      v167[0] = v79(FigBaseObject, @"AutofocusProcessor_VideoMode", v77);
      if (!v167[0])
      {
        v80 = OUTLINED_FUNCTION_3_19();
        [(BWFigVideoCaptureDevice *)v80 _updateWhiteBalanceStateForAutofocusProperty:v81 propertyValue:v77];
        v82 = OUTLINED_FUNCTION_3_19();
        [(BWFigVideoCaptureDevice *)v82 _updateImageControlModeStateForAutofocusProperty:v83 propertyValue:v77];
LABEL_30:
        v49 = *(v5 + 1760);
        OUTLINED_FUNCTION_47_0();
        v54 = OUTLINED_FUNCTION_52(v50, v51, v52, v53);
        if (!v54)
        {
          goto LABEL_45;
        }

        v55 = v54;
        while (1)
        {
          for (i = 0; i != v55; ++i)
          {
            OUTLINED_FUNCTION_50_3();
            if (!v57)
            {
              objc_enumerationMutation(v49);
            }

            v58 = *(8 * i);
            v59 = [*(v5 + 1760) objectForKeyedSubscript:{v58, p_rhs}];
            v60 = OUTLINED_FUNCTION_149_0();
            if ([(BWFigVideoCaptureDevice *)v60 _shouldDeferAutofocusProcessorProperty:v61 value:v62])
            {
              *(v5 + 1830) = 1;
            }

            else
            {
              v63 = FigSampleBufferProcessorGetFigBaseObject();
              v64 = *(*(CMBaseObjectGetVTable() + 8) + 56);
              if (v64)
              {
                v167[0] = v64(v63, v58, v59);
                if (!v167[0])
                {
                  goto LABEL_39;
                }
              }

              else
              {
                v167[0] = -12782;
              }

              OUTLINED_FUNCTION_1_5();
              OUTLINED_FUNCTION_2_5();
              FigDebugAssert3();
            }

            if (!v167[0])
            {
LABEL_39:
              [BWFigVideoCaptureDevice _updateExposureStateForAutofocusProperty:v5];
              v65 = OUTLINED_FUNCTION_149_0();
              [(BWFigVideoCaptureDevice *)v65 _updateWhiteBalanceStateForAutofocusProperty:v66 propertyValue:v67];
              v68 = OUTLINED_FUNCTION_149_0();
              [BWFigVideoCaptureDevice _updateFaceDetectionStateForAutofocusProperty:v68 propertyValue:?];
              v69 = OUTLINED_FUNCTION_149_0();
              [(BWFigVideoCaptureDevice *)v69 _updateImageControlModeStateForAutofocusProperty:v70 propertyValue:v71];
            }

            v167[0] = 0;
          }

          OUTLINED_FUNCTION_47_0();
          v55 = OUTLINED_FUNCTION_52(v72, v73, v74, v75);
          if (!v55)
          {
LABEL_45:
            if (FigCapturePlatformIdentifier() < 10)
            {
              goto LABEL_48;
            }

            v168.origin.x = OUTLINED_FUNCTION_69_5();
            if (CGRectIsEmpty(v168))
            {
              goto LABEL_47;
            }

            lhs.value = 0;
            rhs.value = 0;
            [v5 zoomFactor];
            OUTLINED_FUNCTION_69_5();
            [BWFigVideoCaptureDevice _getAutoFocusPropertyKeyAndAreaOfInterestWithNormalizedRectInSensorSpace:v5 zoomFactor:? propertyKeyOut:? propertyValueOut:?];
            v167[0] = v85;
            if (v85)
            {
              OUTLINED_FUNCTION_1_5();
              OUTLINED_FUNCTION_2_5();
              FigDebugAssert3();
            }

            value = lhs.value;
            v87 = rhs.value;
            v88 = FigSampleBufferProcessorGetFigBaseObject();
            v89 = *(*(CMBaseObjectGetVTable() + 8) + 56);
            if (!v89)
            {
              v167[0] = -12782;
              goto LABEL_63;
            }

            v167[0] = v89(v88, value, v87);
            if (v167[0])
            {
LABEL_63:
              OUTLINED_FUNCTION_1_5();
              OUTLINED_FUNCTION_2_5();
              FigDebugAssert3();
            }

LABEL_47:
            v167[0] = FigSampleBufferAutofocusProcessorStartNow(*(v5 + 1784));
            if (!v167[0])
            {
LABEL_48:
              CMNotificationCenterGetDefaultLocalCenter();
              CMNotificationCenterAddListener();
              goto LABEL_56;
            }

LABEL_67:
            OUTLINED_FUNCTION_0();
LABEL_55:
            FigDebugAssert3();
            goto LABEL_56;
          }
        }
      }
    }

    else
    {
      v167[0] = -12782;
    }

    OUTLINED_FUNCTION_1_5();
    goto LABEL_55;
  }

LABEL_56:
  OUTLINED_FUNCTION_81();
  return result;
}

- (void)_resetSDOFEffectAndStagePreviewStatus
{
  if (self)
  {
    os_unfair_lock_lock((self + 1596));
    *(self + 1600) = 0;

    os_unfair_lock_unlock((self + 1596));
  }
}

- (uint64_t)_setupStillImageCaptureStateMachine
{
  if (result)
  {
    v1 = result;
    if (*(result + 2760))
    {
      v3 = 0;
    }

    else
    {
      if (*(result + 2241))
      {
        v2 = 1;
      }

      else
      {
        v2 = 2;
      }

      v3 = [[FigStateMachine alloc] initWithLabel:@"Still Image State Machine" stateCount:4 initialState:v2 owner:result];
      [(FigStateMachine *)v3 setPerformsAtomicStateTransitions:0];
      [(FigStateMachine *)v3 setLabel:@"WaitingForValidFrameStatistics" forState:1];
      [(FigStateMachine *)v3 setLabel:@"Idle" forState:2];
      [(FigStateMachine *)v3 setLabel:@"Pending" forState:4];
      [(FigStateMachine *)v3 setLabel:@"InProgress" forState:8];
      [(FigStateMachine *)v3 whenTransitioningFromState:4 toState:8 callHandler:&__block_literal_global_584];
      [(FigStateMachine *)v3 whenTransitioningFromState:1 toState:2 callHandler:&__block_literal_global_586_0];
      [(FigStateMachine *)v3 whenTransitioningFromState:8 toState:2 callHandler:&__block_literal_global_588];
      result = [(FigStateMachine *)v3 whenTransitioningFromState:2 toState:8 callHandler:&__block_literal_global_590];
    }

    *(v1 + 2760) = v3;
  }

  return result;
}

- (void)_setNewISPZoomFactorOnStream
{
  if (self && [objc_msgSend(objc_msgSend(*(self + 600) "stream")])
  {
    os_unfair_lock_lock((self + 2984));
    v2 = *(self + 2972);
    v3 = *(self + 2968);
    v4 = *(self + 2976);
    os_unfair_lock_unlock((self + 2984));
    [self aspectRatio];
    v5 = OUTLINED_FUNCTION_114_4();
    [BWFigVideoCaptureDevice _updateSensorRegionsOfInterestBasedOnZoomFactor:v6 aspectRatio:v5];
    v8 = 1.0;
    if ((*(self + 3888) & 1) == 0 && (*(self + 1672) & 1) == 0 && (*(self + 218) & 1) == 0)
    {
      OUTLINED_FUNCTION_204();
      if (v9)
      {
        [objc_msgSend(self "masterCaptureStream")];
        [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"floatValue"")];
        if (*&v7 == 0.0)
        {
          *&v7 = 1.0;
        }

        v8 = v2;
        if (v2 >= *&v7)
        {
          [objc_msgSend(self "masterCaptureStream")];
          [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"floatValue"")];
          if (*&v7 == 0.0)
          {
            v8 = 1.0;
          }

          else
          {
            v8 = *&v7;
          }
        }
      }

      else
      {
        v10 = fminf(v2, 1.5);
        if (*(self + 217) == 1)
        {
          v8 = v10;
        }

        else
        {
          v8 = v2;
        }
      }
    }

    if (*(self + 4297) == 1)
    {
      if ([objc_msgSend(*(self + 672) "nondisruptiveSwitchingZoomFactors")])
      {
        [objc_msgSend(objc_msgSend(objc_msgSend(self "synchronizedStreamsGroup")];
        v12 = v11;
        [objc_msgSend(objc_msgSend(*(self + 672) "nondisruptiveSwitchingZoomFactors")];
        v14 = v13;
        [*(self + 672) baseZoomFactor];
        *&v7 = v12 * (v14 / *&v7);
        if (v8 >= *&v7)
        {
          v8 = *&v7;
        }
      }
    }

    if (v8 != v4)
    {
      v15 = v3 == 0.0 || v8 < v3;
      if (v15 || v4 < v3)
      {
        if (*(self + 1576) == 3)
        {
          v17 = *off_1E798A0C0;
          v18 = OUTLINED_FUNCTION_3_19();
          videoCaptureDimensions = [-[BWFigVideoCaptureDevice _captureStreamByPortType:](v18) videoCaptureDimensions];
          if (videoCaptureDimensions == 3840 && HIDWORD(videoCaptureDimensions) == 2160)
          {
            v20 = *off_1E798CA98;
          }

          else
          {
            v20 = *off_1E798CA98;
          }

          [objc_msgSend(objc_msgSend(*(self + 648) "baseZoomFactorsByPortType")];
          v23 = (v8 / v22) * 1.25;
          v29[0] = v17;
          [OUTLINED_FUNCTION_249() numberWithFloat:?];
          v30[0] = OUTLINED_FUNCTION_41(MEMORY[0x1E695DF20], v24, v25, v26);
          v29[1] = *off_1E798A0D0;
          *&v27 = v23;
          [*(v17 + 3480) numberWithFloat:{v27, v20}];
          v30[1] = OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v28);
          [MEMORY[0x1E695DF20] dictionaryWithObjects:v30 forKeys:v29 count:2];
          selfCopy = self;
        }

        else
        {
          *&v7 = v8;
          [MEMORY[0x1E696AD98] numberWithFloat:v7];
          selfCopy = OUTLINED_FUNCTION_17();
        }

        if (![BWFigVideoCaptureDevice _setSynchronizedStreamsGroupProperty:selfCopy value:?])
        {
          os_unfair_lock_lock((self + 2984));
          *(self + 2976) = v8;
          os_unfair_lock_unlock((self + 2984));
        }
      }
    }
  }
}

- (double)_setupZoomRampTuning
{
  if (self)
  {
    *(self + 3028) = xmmword_1AD056A20;
    *(self + 3044) = 0x3EF5C28F3F160419;
    *(self + 3052) = 1;
    *(self + 3056) = xmmword_1AD056A30;
    *(self + 3072) = xmmword_1AD056A40;
    *(self + 3088) = xmmword_1AD056A50;
    *(self + 3104) = xmmword_1AD056A60;
    *(self + 3120) = xmmword_1AD056A70;
    *(self + 3136) = xmmword_1AD056A80;
    *(self + 3168) = 1101004800;
    *(self + 3152) = xmmword_1AD056A90;
    v2 = *(self + 1672);
    v3 = 0.0;
    if (!*(self + 1672))
    {
      v3 = 0.001;
    }

    v4 = 112.0;
    if (!*(self + 1672))
    {
      v4 = 275.0;
    }

    v5 = 28.0;
    v6 = 21.0;
    if (!*(self + 1672))
    {
      v6 = 28.0;
    }

    *(self + 3224) = v4;
    *(self + 3228) = v6;
    *(self + 3220) = v3;
    *(self + 3240) = 1101004800;
    *(self + 3232) = 0x427000003A83126FLL;
    v7 = *"fff?";
    if (*(self + 4057))
    {
      v7 = 0.92;
    }

    if (*(self + 4048) != 5)
    {
      v7 = 0.86;
      if ((*(self + 4052) - 3) >= 2)
      {
        v7 = 1.0;
      }
    }

    *(self + 3280) = v7;
    *(self + 3284) = v7;
    *(self + 3204) = 1102577664;
    *(self + 3172) = xmmword_1AD056AA0;
    *(self + 3188) = xmmword_1AD056AB0;
    if (v2)
    {
      v5 = 23.0;
    }

    v8 = 320.0;
    if (v2)
    {
      v8 = 137.0;
    }

    *(self + 3260) = v8;
    *(self + 3264) = v5;
    *(self + 3256) = 981668463;
    result = 402653251.0;
    *(self + 3272) = 4735535009300480000;
    *(self + 3268) = 981668463;
  }

  return result;
}

- (uint64_t)_updateSensorRawPool
{
  if (!self)
  {
    return 0;
  }

  if (*(self + 140) != 1)
  {
    goto LABEL_41;
  }

  if (*(self + 156) == 1)
  {
    OUTLINED_FUNCTION_0_3();
    FigDebugAssert3();
LABEL_41:
    v17 = 0;
    v16 = 0;
    goto LABEL_30;
  }

  sensorRawPoolRequirements = [self sensorRawPoolRequirements];
  if (!sensorRawPoolRequirements)
  {
    v16 = 0;
    v17 = 4294954516;
    goto LABEL_30;
  }

  v3 = sensorRawPoolRequirements;
  v4 = [objc_msgSend(sensorRawPoolRequirements objectForKeyedSubscript:{*MEMORY[0x1E6966160]), "intValue"}];
  os_unfair_lock_lock((self + 144));
  v5 = *(self + 160);
  if (!v5)
  {
    v5 = objc_alloc_init(MEMORY[0x1E695DF90]);
    *(self + 160) = v5;
  }

  v6 = [v5 objectForKeyedSubscript:&unk_1F22469D8];
  if (v6)
  {
    v24 = v6;
    v11 = *(self + 168);
    v25 = v11 + v4;
    if (dword_1ED844350)
    {
      v28 = OUTLINED_FUNCTION_233();
      os_log_type_enabled(v28, v29);
      OUTLINED_FUNCTION_286();
      if (v14)
      {
        v27 = v26;
      }

      else
      {
        v27 = v30;
      }

      if (v27)
      {
        [v24 capacity];
        OUTLINED_FUNCTION_75();
        OUTLINED_FUNCTION_2_1();
        OUTLINED_FUNCTION_13();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_371();
    }

    [v24 flushToMinimumCapacity:v25];
    [v24 setCapacity:v25];
    v16 = 0;
  }

  else
  {
    v7 = objc_alloc_init(BWVideoFormatRequirements);
    [objc_msgSend(v3 objectForKeyedSubscript:{*MEMORY[0x1E6966208]), "intValue"}];
    [OUTLINED_FUNCTION_287() setWidth:?];
    [objc_msgSend(v3 objectForKeyedSubscript:{*MEMORY[0x1E69660B8]), "intValue"}];
    [OUTLINED_FUNCTION_287() setHeight:?];
    width = [(BWVideoFormatRequirements *)v7 width];
    height = [(BWVideoFormatRequirements *)v7 height];
    v10 = width < 1 || height < 1;
    if (v10 || ([objc_msgSend(v3 objectForKeyedSubscript:{*MEMORY[0x1E6966020]), "intValue"}], objc_msgSend(OUTLINED_FUNCTION_287(), "setBytesPerRowAlignment:"), objc_msgSend(objc_msgSend(v3, "objectForKeyedSubscript:", *MEMORY[0x1E6966140]), "intValue"), objc_msgSend(OUTLINED_FUNCTION_287(), "setPlaneAlignment:"), -[BWVideoFormatRequirements setHeightAlignment:](v7, "setHeightAlignment:", 16), v32 = objc_msgSend(v3, "objectForKeyedSubscript:", *MEMORY[0x1E6966130]), objc_msgSend(MEMORY[0x1E695DEC8], "arrayWithObjects:count:", &v32, 1), objc_msgSend(OUTLINED_FUNCTION_28(), "setSupportedPixelFormats:"), +[BWVideoFormatRequirements cacheModesForOptimizedDisplayAccess](BWVideoFormatRequirements, "cacheModesForOptimizedDisplayAccess"), objc_msgSend(OUTLINED_FUNCTION_28(), "setSupportedCacheModes:"), !-[NSArray count](-[BWVideoFormatRequirements supportedPixelFormats](v7, "supportedPixelFormats"), "count")) || (v31 = v7, objc_msgSend(MEMORY[0x1E695DEC8], "arrayWithObjects:count:", &v31, 1), !objc_msgSend(OUTLINED_FUNCTION_8(), "formatByResolvingRequirements:")))
    {
      v16 = 0;
      v17 = 4294954516;
      goto LABEL_29;
    }

    v11 = *(self + 168);
    if (dword_1ED844350)
    {
      v12 = OUTLINED_FUNCTION_233();
      os_log_type_enabled(v12, v29);
      OUTLINED_FUNCTION_97_0();
      if (v14)
      {
        v15 = v13;
      }

      else
      {
        v15 = v30;
      }

      if (v15)
      {
        OUTLINED_FUNCTION_177();
        OUTLINED_FUNCTION_2_1();
        OUTLINED_FUNCTION_13();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_128();
    }

    v18 = [BWPixelBufferPool alloc];
    [MEMORY[0x1E696AEC0] stringWithFormat:@"%@_SensorRawBufferPool", BWStringFromCaptureDeviceType(*(self + 588))];
    v19 = [OUTLINED_FUNCTION_86() initWithVideoFormat:? capacity:? name:? memoryPool:?];
    v16 = v19;
    if (!v19)
    {
      OUTLINED_FUNCTION_0_3();
      FigDebugAssert3();
      v17 = 0;
      goto LABEL_29;
    }

    [v19 preallocate];
    if ([self isBravoVariant])
    {
      [*(self + 648) syncGroup];
      v20 = *off_1E798CCD8;
      [v16 cvPixelBufferPool];
      v21 = [OUTLINED_FUNCTION_6_44() setProperty:v20 value:?];
      if (v21)
      {
        goto LABEL_45;
      }
    }

    else
    {
      [*(self + 600) stream];
      v22 = *off_1E798C128;
      [v16 cvPixelBufferPool];
      v21 = [OUTLINED_FUNCTION_6_44() setProperty:v22 value:?];
      if (v21)
      {
LABEL_45:
        v17 = v21;
        OUTLINED_FUNCTION_1_5();
        goto LABEL_46;
      }
    }

    [*(self + 160) setObject:v16 forKeyedSubscript:&unk_1F22469D8];
  }

  v17 = [(BWFigVideoCaptureDevice *)self _setPropertySensorRawBufferPoolRetainCount:v11];
  if (v17)
  {
    OUTLINED_FUNCTION_0_8();
LABEL_46:
    FigDebugAssert3();
  }

LABEL_29:
  os_unfair_lock_unlock((self + 144));
LABEL_30:

  return v17;
}

- (void)_updateUltraHighResSensorRawPool
{
  OUTLINED_FUNCTION_59_0();
  a48 = v50;
  a49 = v52;
  if (v51)
  {
    v53 = v51;
    if (*(v51 + 140) == 1)
    {
      if (*(v51 + 156) == 1)
      {
        OUTLINED_FUNCTION_0();
        FigDebugAssert3();
      }

      else
      {
        os_unfair_lock_lock((v51 + 144));
        v54 = *(v53 + 160);
        if (!v54)
        {
          v54 = objc_alloc_init(MEMORY[0x1E695DF90]);
          *(v53 + 160) = v54;
        }

        v55 = [v54 objectForKeyedSubscript:&unk_1F22469C0];
        if (v55)
        {
          v56 = v55;
          if (dword_1ED844350)
          {
            OUTLINED_FUNCTION_81_2();
            OUTLINED_FUNCTION_325();
            OUTLINED_FUNCTION_68_4();
            os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
            os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, a34);
            OUTLINED_FUNCTION_30();
            if (v49)
            {
              [v56 capacity];
              OUTLINED_FUNCTION_5();
              OUTLINED_FUNCTION_11_0();
              _os_log_send_and_compose_impl();
            }

            OUTLINED_FUNCTION_2_4();
            fig_log_call_emit_and_clean_up_after_send_and_compose();
          }

          [OUTLINED_FUNCTION_40() flushToMinimumCapacity:?];
          [OUTLINED_FUNCTION_40() setCapacity:?];
        }

        else
        {
          sensorRawPoolRequirements = [v53 sensorRawPoolRequirements];
          if (sensorRawPoolRequirements)
          {
            v59 = sensorRawPoolRequirements;
            v60 = objc_alloc_init(BWVideoFormatRequirements);
            [(BWVideoFormatRequirements *)v60 setWidth:*(v53 + 148)];
            [(BWVideoFormatRequirements *)v60 setHeight:*(v53 + 152)];
            [objc_msgSend(v59 objectForKeyedSubscript:{*MEMORY[0x1E6966020]), "intValue"}];
            [OUTLINED_FUNCTION_63_12() setBytesPerRowAlignment:?];
            [objc_msgSend(v59 objectForKeyedSubscript:{*MEMORY[0x1E6966140]), "intValue"}];
            [OUTLINED_FUNCTION_63_12() setPlaneAlignment:?];
            [(BWVideoFormatRequirements *)v60 setHeightAlignment:16];
            a37 = [v59 objectForKeyedSubscript:*MEMORY[0x1E6966130]];
            [MEMORY[0x1E695DEC8] arrayWithObjects:&a37 count:1];
            [OUTLINED_FUNCTION_4() setSupportedPixelFormats:?];
            +[BWVideoFormatRequirements cacheModesForOptimizedDisplayAccess];
            [OUTLINED_FUNCTION_4() setSupportedCacheModes:?];
            if ([(NSArray *)[(BWVideoFormatRequirements *)v60 supportedPixelFormats] count])
            {
              a36 = v60;
              [MEMORY[0x1E695DEC8] arrayWithObjects:&a36 count:1];
              v61 = [OUTLINED_FUNCTION_8() formatByResolvingRequirements:?];
              if (v61)
              {
                v62 = v61;
                v63 = *(v53 + 176);
                if (dword_1ED844350)
                {
                  OUTLINED_FUNCTION_81_2();
                  OUTLINED_FUNCTION_145_1();
                  OUTLINED_FUNCTION_68_4();
                  v64 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
                  os_log_type_enabled(v64, a34);
                  OUTLINED_FUNCTION_82_6();
                  if (v66)
                  {
                    a35 = v65;
                  }

                  if (a35)
                  {
                    OUTLINED_FUNCTION_5();
                    OUTLINED_FUNCTION_47_2();
                  }

                  OUTLINED_FUNCTION_2_4();
                  OUTLINED_FUNCTION_39_0();
                }

                v68 = [BWPixelBufferPool alloc];
                v69 = MEMORY[0x1E696AEC0];
                BWStringFromCaptureDeviceType(*(v53 + 588));
                v70 = -[BWPixelBufferPool initWithVideoFormat:capacity:name:memoryPool:](v68, "initWithVideoFormat:capacity:name:memoryPool:", v62, v63, [v69 stringWithFormat:@"%@_UltraHighResolutionSensorRawBufferPool"], *(v53 + 3880));
                [*(v53 + 160) setObject:v70 forKeyedSubscript:&unk_1F22469C0];
              }
            }
          }
        }

        os_unfair_lock_unlock((v53 + 144));
      }
    }
  }

  OUTLINED_FUNCTION_58_0();
}

- (int)smartFramingConfiguredFieldOfView
{
  os_unfair_lock_lock(&self->_smartFramingLock);
  smartFramingConfiguredFieldOfView = self->_smartFramingConfiguredFieldOfView;
  os_unfair_lock_unlock(&self->_smartFramingLock);
  return smartFramingConfiguredFieldOfView;
}

- (int)aspectRatio
{
  os_unfair_lock_lock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
  height_low = LODWORD(self->_nonDestructiveCropSize.height);
  os_unfair_lock_unlock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
  return height_low;
}

- (BWFigVideoCaptureStream)masterCaptureStream
{
  os_unfair_lock_lock(&self->_currentMasterCaptureStreamLock);
  currentMasterCaptureStream = self->_currentMasterCaptureStream;
  os_unfair_lock_unlock(&self->_currentMasterCaptureStreamLock);
  return currentMasterCaptureStream;
}

- (uint64_t)overCaptureActiveSlaveStreamForcedOff
{
  if (self)
  {
    os_unfair_lock_lock((self + 4072));
    v2 = *(self + 4097);
    os_unfair_lock_unlock((self + 4072));
  }

  else
  {
    v2 = 0;
  }

  return v2 & 1;
}

- (int)shallowDepthOfFieldEffectStatus
{
  os_unfair_lock_lock(&self->_sdofLock);
  sdofEffectStatus = self->_sdofEffectStatus;
  os_unfair_lock_unlock(&self->_sdofLock);
  return sdofEffectStatus;
}

- (BOOL)ultraHighResolutionZeroShutterLagEnabled
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  v3 = BYTE2(self->_currentStillSmartCameraResult);
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  return v3;
}

- (void)_servicePendingStillImageCapture
{
  if (self)
  {
    v2 = OUTLINED_FUNCTION_261(self);
    os_unfair_lock_assert_not_owner(v2);
    os_unfair_lock_lock((v1 + 1384));
    if ([*(v1 + 2760) currentState] == 4)
    {
      os_unfair_lock_assert_owner((v1 + 1384));
      if ((*(v1 + 1388) & 1) == 0 && (*(v1 + 1389) & 1) == 0 && (*(v1 + 1390) & 1) == 0)
      {
        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_18_34();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v4 = OUTLINED_FUNCTION_8_5(os_log_and_send_and_compose_flags_and_os_log_type);
          if (OUTLINED_FUNCTION_6(v4))
          {
            OUTLINED_FUNCTION_5_6();
            OUTLINED_FUNCTION_8_0();
            _os_log_send_and_compose_impl();
            OUTLINED_FUNCTION_247();
          }

          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_17_8();
        }

        [*(v1 + 2760) transitionToState:8];
      }
    }

    os_unfair_lock_unlock((v1 + 1384));
  }
}

- (void)_handlePendingStillImageCaptureRequest
{
  if (self)
  {
    v2 = OUTLINED_FUNCTION_261(self);
    os_unfair_lock_assert_owner(v2);
    v3 = *(v1 + 2776);
    if (v3)
    {
      *(v1 + 2768) = v3;
      *(v1 + 2776) = 0;
      [*(v1 + 2760) transitionToState:4];
      os_unfair_lock_assert_owner((v1 + 1384));
      if ((*(v1 + 1388) & 1) != 0 || (*(v1 + 1389) & 1) != 0 || *(v1 + 1390) == 1)
      {
        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_18_34();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v5 = OUTLINED_FUNCTION_8_5(os_log_and_send_and_compose_flags_and_os_log_type);
          if (OUTLINED_FUNCTION_6(v5))
          {
            OUTLINED_FUNCTION_5();
            OUTLINED_FUNCTION_8_0();
            _os_log_send_and_compose_impl();
            OUTLINED_FUNCTION_247();
          }

          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_17_8();
        }
      }

      else
      {
        v6 = *(v1 + 2760);

        [v6 transitionToState:8];
      }
    }
  }
}

- (BOOL)_ubZeroShutterLagCancelWaitingForTimeMachines
{
  if (!self)
  {
    return 0;
  }

  os_unfair_lock_lock((self + 2712));
  v2 = *(self + 2224);
  v3 = v2 >= 1 && v2 == *(self + 2232);
  os_unfair_lock_unlock((self + 2712));
  return v3;
}

- (BOOL)_ubIsSuperWidePreferredOrCurrentPrimaryCaptureStreamInWideZoomRange
{
  if (!self || *(self + 1546) != 1 || !*(self + 680))
  {
    return 0;
  }

  [*(self + 2952) requestedZoomFactor];
  v5 = [(BWFigVideoCaptureDevice *)self _captureStreamBasedSolelyOnZoomFactor:v4];
  os_unfair_lock_lock((self + 1408));
  v6 = *(self + 680);
  if (v5 == v6)
  {
    v2 = 0;
  }

  else
  {
    v2 = *(self + 1400) == v6 || *(self + 1392) == v6;
  }

  os_unfair_lock_unlock((self + 1408));
  return v2;
}

+ (void)initialize
{
  if (objc_opt_class() == self)
  {
    FigNote_AllowInternalDefaultLogs();
    fig_note_initialize_category_with_default_work_cf();

    fig_note_initialize_category_with_default_work_cf();
  }
}

- (BWFigVideoCaptureDevice)initWithCaptureDevice:(id)device attributes:(id)attributes synchronizedStreamsAttributes:(id)streamsAttributes unsynchronizedStreamsAttributes:(id)unsynchronizedStreamsAttributes multiCamEnabled:(BOOL)enabled midFrameSynchronizationEnabled:(BOOL)synchronizationEnabled applicationID:(id)d clientAuditToken:(id *)self0 tccIdentity:(id)self1 mediaEnvironment:(id)self2 deviceClientPriority:(int)self3 error:(int *)self4
{
  enabledCopy = enabled;
  synchronizationEnabledCopy = synchronizationEnabled;
  v17 = +[BWFigCaptureDeviceVendor sharedCaptureDeviceVendor];
  v18 = +[FigCaptureCameraParameters sharedInstance];
  v19 = *&token->var0[4];
  v26[0] = *token->var0;
  v26[1] = v19;
  LODWORD(v21) = priority;
  return [(BWFigVideoCaptureDevice *)self _initWithCaptureDevice:device attributes:attributes synchronizedStreamsAttributes:streamsAttributes unsynchronizedStreamsAttributes:unsynchronizedStreamsAttributes multiCamEnabled:enabledCopy midFrameSynchronizationEnabled:synchronizationEnabledCopy applicationID:d clientAuditToken:v26 tccIdentity:identity mediaEnvironment:environment deviceVendor:v17 createAutofocusSampleBufferProcessorFunction:FigSampleBufferProcessorCreateForAutofocus cameraParameters:v18 deviceClientPriority:v21 error:error];
}

- (id)_initWithCaptureDevice:(id)device attributes:(id)attributes synchronizedStreamsAttributes:(id)streamsAttributes unsynchronizedStreamsAttributes:(id)unsynchronizedStreamsAttributes multiCamEnabled:(BOOL)enabled midFrameSynchronizationEnabled:(BOOL)synchronizationEnabled applicationID:(id)d clientAuditToken:(id *)self0 tccIdentity:(id)self1 mediaEnvironment:(id)self2 deviceVendor:(id)self3 createAutofocusSampleBufferProcessorFunction:(void *)self4 cameraParameters:(id)self5 deviceClientPriority:(int)self6 error:(int *)self7
{
  errorCopy5 = error;
  v156[0] = 0;
  v155.receiver = self;
  v155.super_class = BWFigVideoCaptureDevice;
  v24 = [(BWFigVideoCaptureDevice *)&v155 init];
  if (!v24)
  {
    v25 = 0;
    v26 = 0;
LABEL_3:

    if (errorCopy5)
    {
      *errorCopy5 = v156[0];
    }

    return v24;
  }

  attributesCopy = attributes;
  if (!device)
  {
    [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
LABEL_155:
    v40 = 0;
    v37 = 0;
    goto LABEL_22;
  }

  *(v24 + 1) = device;
  *(v24 + 2) = vendor;
  *(v24 + 154) = [objc_msgSend(attributes objectForKeyedSubscript:{@"Position", "intValue"}];
  *(v24 + 147) = [objc_msgSend(attributes objectForKeyedSubscript:{@"DeviceType", "intValue"}];
  *(v24 + 78) = attributes;
  v28 = *&token->var0[4];
  *(v24 + 40) = *token->var0;
  *(v24 + 56) = v28;
  v29 = *&token->var0[4];
  v125 = *token->var0;
  v126 = v29;
  *(v24 + 18) = FigCaptureGetPIDFromAuditToken(&v125);
  v30 = *&token->var0[4];
  v125 = *token->var0;
  v126 = v30;
  v24[76] = FigCaptureClientIsRunningInXCTest(&v125) != 0;
  *(v24 + 20) = 0;
  *(v24 + 11) = [d copy];
  v24[592] = enabled;
  v24[710] = synchronizationEnabled;
  *(v24 + 3) = [*(v24 + 1) copyProperty:*off_1E7989FF0 error:v156];
  if (v156[0])
  {
    [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
    goto LABEL_155;
  }

  *(v24 + 16) = [*(v24 + 1) supportedProperties];
  *(v24 + 1944) = 0u;
  *(v24 + 245) = 0x3FF0000000000000;
  *(v24 + 246) = 0x3FF0000000000000;
  unsynchronizedStreamsAttributesCopy = streamsAttributes;
  if (!streamsAttributes)
  {
    unsynchronizedStreamsAttributesCopy = unsynchronizedStreamsAttributes;
    if (!unsynchronizedStreamsAttributes)
    {
      attributesCopy2 = attributes;
      unsynchronizedStreamsAttributesCopy = [MEMORY[0x1E695DEC8] arrayWithObjects:&attributesCopy2 count:1];
    }
  }

  [BWFigVideoCaptureDevice _copyStreamsForAttributes:deviceClientPriority:errOut:];
  v33 = v32;
  if (v156[0])
  {
    [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
LABEL_158:
    v40 = 0;
    errorCopy4 = error;
    v37 = v33;
    goto LABEL_23;
  }

  *(v24 + 15) = [(BWFigVideoCaptureDevice *)v24 _copyPortTypesFromStreams:v32 errOut:v156];
  if (v156[0])
  {
    [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
    goto LABEL_158;
  }

  v124 = unsynchronizedStreamsAttributesCopy;
  v34 = [attributes objectForKeyedSubscript:@"SynchronizedStreamsBaseZoomFactorOverrides"];
  v35 = [attributesCopy objectForKeyedSubscript:@"SynchronizedStreamsClientBaseZoomFactorsByPortType"];
  v36 = [v33 count];
  if (![objc_msgSend(*(v24 + 1) "supportedProperties")])
  {
    v37 = v33;
    goto LABEL_20;
  }

  v37 = v33;
  v38 = [*(v24 + 1) copySynchronizedStreamsGroupForStreams:v33 error:0];
  if (!v38)
  {
LABEL_20:
    if (v36 < 2)
    {
      v122 = v36;
      v40 = 0;
      v42 = v124;
      goto LABEL_29;
    }

    FigDebugAssert3();
    v40 = 0;
LABEL_22:
    errorCopy4 = error;
    goto LABEL_23;
  }

  v39 = v38;
  v40 = [[BWFigVideoCaptureSynchronizedStreamsGroup alloc] initWithSynchronizedStreamsGroup:v38 activeStreams:v33 readOnly:v36 < 2 baseZoomFactorOverrides:v34 clientBaseZoomFactorsByPortType:v35 error:v156];

  if (!v40)
  {
    [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
    goto LABEL_22;
  }

  v122 = v36;
  v41 = v36 >= 2;
  v42 = v124;
  if (v41)
  {
    *(v24 + 81) = v40;
  }

LABEL_29:
  v45 = *&token->var0[4];
  v125 = *token->var0;
  v126 = v45;
  v156[0] = [BWFigVideoCaptureDevice _createBWFigVideoCaptureStreamsForCaptureStreams:v24 attributeDictionaries:v37 cameraParameters:v42 synchronizedStreamsGroup:parameters clientAuditToken:? tccIdentity:? mediaEnvironment:?];
  if (v156[0])
  {
    [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
    goto LABEL_22;
  }

  *(v24 + 83) = [*(v24 + 82) sortedArrayUsingComparator:&__block_literal_global_120];
  errorCopy4 = error;
  if (v122 < 2)
  {
    v48 = [*(v24 + 82) objectAtIndexedSubscript:0];
    *(v24 + 75) = v48;
    [v48 portType];
    if (!FigCFEqual() || *(v24 + 147) == 20)
    {
LABEL_55:
      v121 = v40;
      [(BWFigVideoCaptureDevice *)v24 _setupMacroFocusDetection];
      *(v24 + 79) = [objc_msgSend(*(v24 + 75) "stream")];
      v66 = [objc_msgSend(*(v24 + 75) "stream")];
      *(v24 + 80) = v66;
      if (!v66)
      {
        *(v24 + 80) = [objc_msgSend(*(v24 + 75) "stream")];
      }

      *(v24 + 206) = FigDispatchQueueCreateWithPriority();
      *(v24 + 336) = FigDispatchQueueCreateWithPriority();
      *(v24 + 552) = FigDispatchQueueCreateWithPriority();
      *(v24 + 714) = 1065353216;
      v67 = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"SoftISP", "BOOLValue"}];
      v24[2240] = v67;
      if (v67)
      {
        *(v24 + 281) = objc_alloc_init(MEMORY[0x1E695DF90]);
        v150 = 0u;
        v151 = 0u;
        v152 = 0u;
        v153 = 0u;
        v68 = *(v24 + 82);
        v69 = [v68 countByEnumeratingWithState:&v150 objects:v149 count:16];
        if (v69)
        {
          v70 = v69;
          v71 = *v151;
          do
          {
            for (i = 0; i != v70; ++i)
            {
              if (*v151 != v71)
              {
                objc_enumerationMutation(v68);
              }

              [*(v24 + 281) setObject:&unk_1F2246978 forKeyedSubscript:{objc_msgSend(*(*(&v150 + 1) + 8 * i), "portType")}];
            }

            v70 = [v68 countByEnumeratingWithState:&v150 objects:v149 count:16];
          }

          while (v70);
        }
      }

      v147 = 0u;
      v148 = 0u;
      v145 = 0u;
      v146 = 0u;
      v73 = *(v24 + 13);
      v74 = [v73 countByEnumeratingWithState:&v145 objects:v144 count:16];
      if (v74)
      {
        v76 = v74;
        dictionary = 0;
        v77 = *v146;
        do
        {
          for (j = 0; j != v76; ++j)
          {
            if (*v146 != v77)
            {
              objc_enumerationMutation(v73);
            }

            v79 = *(*(&v145 + 1) + 8 * j);
            v80 = -[BWUBCaptureParameters initWithPortType:sensorIDDictionary:]([BWUBCaptureParameters alloc], "initWithPortType:sensorIDDictionary:", v79, [*(v24 + 13) objectForKeyedSubscript:v79]);
            v81 = v80;
            if (!dictionary && v80)
            {
              dictionary = [MEMORY[0x1E695DF90] dictionary];
            }

            [dictionary setObject:v81 forKeyedSubscript:v79];
          }

          v76 = [v73 countByEnumeratingWithState:&v145 objects:v144 count:16];
        }

        while (v76);
      }

      else
      {
        dictionary = 0;
      }

      *(v24 + 274) = [dictionary copy];
      *(v24 + 319) = fvcd_stillImageStabilizationIntegrationTimeThresholdFromSensorIDDictionary([*(v24 + 75) sensorIDDictionary]);
      v82 = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"StillImageCaptureNowAfterAutofocusTimeout", "BOOLValue"}];
      v24[2160] = v82;
      if (v82)
      {
        *(v24 + 541) = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"StillImageContrastBasedAutofocusTimeout", "intValue"}];
        *(v24 + 542) = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"StillImagePhaseDetectionAutofocusTimeout", "intValue"}];
      }

      v142 = 0u;
      v143 = 0u;
      v140 = 0u;
      v141 = 0u;
      v83 = *(v24 + 82);
      v84 = [v83 countByEnumeratingWithState:&v140 objects:v139 count:16];
      if (v84)
      {
        v85 = v84;
        v86 = *v141;
        do
        {
          for (k = 0; k != v85; ++k)
          {
            if (*v141 != v86)
            {
              objc_enumerationMutation(v83);
            }

            *(v24 + 34) |= BWActiveDeviceTypeFromPortType([*(*(&v140 + 1) + 8 * k) portType]);
          }

          v85 = [v83 countByEnumeratingWithState:&v140 objects:v139 count:16];
        }

        while (v85);
      }

      v24[2172] = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"Flash", "BOOLValue"}];
      *(v24 + 630) = 1097859072;
      v88 = [*(v24 + 78) objectForKeyedSubscript:@"AutoFlashNormalizedSNRThreshold"];
      if (v88)
      {
        [v88 floatValue];
        *(v24 + 630) = v89;
      }

      *(v24 + 314) = objc_alloc_init(MEMORY[0x1E695DF90]);
      if ([v37 count])
      {
        v90 = 0;
        do
        {
          v91 = [objc_msgSend(v124 objectAtIndexedSubscript:{v90), "objectForKeyedSubscript:", @"AutoFlashNormalizedSNRThreshold"}];
          if (v91)
          {
            v92 = v91;
          }

          else
          {
            v92 = &unk_1F224A920;
          }

          [*(v24 + 314) setObject:v92 forKeyedSubscript:{objc_msgSend(*(v24 + 15), "objectAtIndexedSubscript:", v90++)}];
        }

        while ([v37 count] > v90);
      }

      v24[2173] = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"NightMode", "BOOLValue"}];
      v93 = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"DigitalFlash", "BOOLValue"}];
      v24[2344] = v93;
      if (v93)
      {
        v94 = objc_alloc_init(MEMORY[0x1E695DFA8]);
        v135 = 0u;
        v136 = 0u;
        v137 = 0u;
        v138 = 0u;
        v95 = *(v24 + 274);
        v96 = [v95 countByEnumeratingWithState:&v135 objects:v134 count:16];
        if (v96)
        {
          v97 = v96;
          v98 = *v136;
          do
          {
            for (m = 0; m != v97; ++m)
            {
              if (*v136 != v98)
              {
                objc_enumerationMutation(v95);
              }

              v100 = *(*(&v135 + 1) + 8 * m);
              [objc_msgSend(*(v24 + 274) objectForKeyedSubscript:{v100), "digitalFlashAvailableEffectiveIntegrationTimeThreshold"}];
              [v94 addObject:v100];
            }

            v97 = [v95 countByEnumeratingWithState:&v135 objects:v134 count:16];
          }

          while (v97);
        }

        *(v24 + 297) = v94;
        v24[2388] = FigCapturePlatformIdentifier() > 7;
        v24[2389] = 1;
        *(v24 + 601) = -1;
        if (*(v24 + 154) == 2 || FigCapturePlatformIdentifier() >= 8)
        {
          *(v24 + 316) = [[BWMovingWindowStats alloc] initWithWindowSize:6];
          *(v24 + 304) = [[BWMovingWindowStats alloc] initWithWindowSize:8];
        }

        v24[2312] = 0;
      }

      if (v24[1546] == 1)
      {
        [objc_msgSend(*(v24 + 274) objectForKeyedSubscript:{*off_1E798A0D0), "autoFlashMacroNormalizedSNRThreshold"}];
        *(v24 + 318) = [[BWMovingWindowStats alloc] initWithWindowSize:6];
      }

      v24[2256] = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"DeepFusion", "BOOLValue"}];
      v24[2259] = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"LearnedFusion", "BOOLValue"}];
      *(v24 + 567) = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"StillImageDepthDataType", "intValue"}];
      *(v24 + 626) = 0;
      *(v24 + 742) = 0;
      v101 = objc_alloc_init(BWZoomCommandHandler);
      *(v24 + 369) = v101;
      [(BWZoomCommandHandler *)v101 setZoomCompletionDelegate:v24];
      *(v24 + 747) = 1036831949;
      *(v24 + 370) = FigDispatchQueueCreateWithPriority();
      *(v24 + 746) = 0;
      if (FigCapturePlatformIdentifier() >= 3)
      {
        v102 = 2;
      }

      else
      {
        v102 = 3;
      }

      *(v24 + 748) = v102;
      *(v24 + 3005) = 257;
      v24[3016] = [*(v24 + 82) count] == 1;
      *(v24 + 3020) = 0x400000003F666666;
      if (v24[3006])
      {
        v103 = *(v24 + 748) + 3;
      }

      else
      {
        v103 = *(v24 + 748);
      }

      *(v24 + 749) = v103;
      v130 = 0u;
      v131 = 0u;
      v132 = 0u;
      v133 = 0u;
      v104 = *(v24 + 82);
      v105 = [v104 countByEnumeratingWithState:&v130 objects:v129 count:16];
      if (v105)
      {
        v106 = v105;
        v107 = *v131;
        while (2)
        {
          for (n = 0; n != v106; ++n)
          {
            if (*v131 != v107)
            {
              objc_enumerationMutation(v104);
            }

            if ([*(*(&v130 + 1) + 8 * n) isCMIOZoomFactorSupported])
            {
              v24[3288] = 1;
              goto LABEL_123;
            }
          }

          v106 = [v104 countByEnumeratingWithState:&v130 objects:v129 count:16];
          if (v106)
          {
            continue;
          }

          break;
        }
      }

LABEL_123:
      *(v24 + 207) = FigDispatchQueueCreateWithPriority();
      *(v24 + 208) = FigDispatchQueueCreateWithPriority();
      *(v24 + 218) = function;
      *(v24 + 219) = dispatch_queue_create("com.apple.bwgraph.capture-device-autofocus-processor", 0);
      *(v24 + 220) = objc_alloc_init(MEMORY[0x1E695DF90]);
      *(v24 + 221) = FigSimpleMutexCreate();
      v24[2004] = 1;
      *(v24 + 251) = 0;
      *(v24 + 253) = 0x3FE0000000000000;
      *(v24 + 508) = 0;
      [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"AutoFocusPositionSensorMode", "intValue"}];
      CFPreferenceNumberWithDefault = FigGetCFPreferenceNumberWithDefault();
      *(v24 + 514) = CFPreferenceNumberWithDefault;
      if (CFPreferenceNumberWithDefault && ![objc_msgSend(objc_msgSend(*(v24 + 75) "stream")])
      {
        FrameworkRadarComponent = FigCaptureGetFrameworkRadarComponent();
        v128 = 0;
        type = OS_LOG_TYPE_DEFAULT;
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        v112 = v128;
        if (os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, type))
        {
          v113 = v112;
        }

        else
        {
          v113 = v112 & 0xFFFFFFFE;
        }

        if (v113)
        {
          _os_log_send_and_compose_impl();
        }

        fig_log_call_emit_and_clean_up_after_send_and_compose();
        v114 = *(v24 + 514);
        LODWORD(v125) = 67109120;
        DWORD1(v125) = v114;
        v115 = _os_log_send_and_compose_impl();
        FigCapturePleaseFileRadar(FrameworkRadarComponent, v115, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 1771, @"LastShownDate:BWFigVideoCaptureDevice.m:1771", @"LastShownBuild:BWFigVideoCaptureDevice.m:1771", 0);
        free(v115);
        *(v24 + 514) = 0;
      }

      *(v24 + 535) = 0;
      v25 = v121;
      if (v122 >= 2)
      {
        v26 = v37;
        if ([v24 isBravoVariant])
        {
          v116 = [objc_msgSend(objc_msgSend(attributesCopy objectForKeyedSubscript:{@"SynchronizedStreamsSwitchOverParameters", "objectForKeyedSubscript:", @"autoFocusRecommendedPrimaryPortTypeEnabled", "BOOLValue"}];
        }

        else
        {
          v116 = 0;
        }
      }

      else
      {
        v116 = 0;
        v26 = v37;
      }

      *(v24 + 268) = [[BWFrameStatisticsByPortType alloc] initWithPortTypes:*(v24 + 15) autoFocusRecommendedPrimaryPortTypeEnabled:v116];
      *(v24 + 269) = [[BWFrameStatisticsByPortType alloc] initWithPortTypes:*(v24 + 15) autoFocusRecommendedPrimaryPortTypeEnabled:v116];
      if ([v26 count])
      {
        v117 = 0;
        do
        {
          if ([objc_msgSend(v124 objectAtIndexedSubscript:{v117), "objectForKeyedSubscript:", @"SensorThermalLevelsByTemperature"}])
          {
            v118 = *(v24 + 545);
            if (!v118)
            {
              v118 = objc_alloc_init(MEMORY[0x1E695DFA8]);
              *(v24 + 545) = v118;
            }

            [v118 addObject:{objc_msgSend(*(v24 + 15), "objectAtIndexedSubscript:", v117)}];
          }

          ++v117;
        }

        while ([v26 count] > v117);
      }

      if (*(v24 + 545))
      {
        *(v24 + 546) = [objc_alloc(MEMORY[0x1E695DF90]) initWithCapacity:{objc_msgSend(*(v24 + 545), "count")}];
      }

      v119 = MEMORY[0x1E6960C70];
      *(v24 + 174) = *MEMORY[0x1E6960C70];
      *(v24 + 350) = *(v119 + 16);
      *(v24 + 356) = FigSimpleMutexCreate();
      *(v24 + 323) = FigSimpleMutexCreate();
      *(v24 + 2824) = vdupq_n_s32(0xDEADBEEF);
      *(v24 + 355) = objc_alloc_init(MEMORY[0x1E695DF90]);
      *(v24 + 678) = 0;
      *(v24 + 352) = 0;
      *(v24 + 346) = 0;
      *(v24 + 339) = 0;
      *(v24 + 365) = dispatch_queue_create("com.apple.bwgraph.capture-device-whitebalancegains", 0);
      *(v24 + 366) = objc_alloc_init(MEMORY[0x1E695DF90]);
      *(v24 + 367) = objc_alloc_init(MEMORY[0x1E695DF70]);
      v24[3796] = [objc_msgSend(objc_msgSend(*(v24 + 75) "stream")] != 0;
      v24[3872] = 0;
      CGSizeMakeWithDictionaryRepresentation([*(v24 + 78) objectForKeyedSubscript:@"DefaultAutoFocusTapWindowSize"], (v24 + 4008));
      CGSizeMakeWithDictionaryRepresentation([*(v24 + 78) objectForKeyedSubscript:@"DefaultContinuousAutoFocusWindowSize"], (v24 + 4024));
      v24[4096] = 1;
      v24[4104] = 1;
      v24[3920] = 1;
      *(v24 + 981) = 0;
      *(v24 + 3928) = *MEMORY[0x1E695EFF8];
      v24[1608] = 1;
      *(v24 + 399) = 0;
      v24[1625] = 1;
      *(v24 + 411) = 0;
      *(v24 + 494) = 0;
      *(v24 + 124) = 0u;
      *(v24 + 500) = 0;
      v24[3377] = [*(v24 + 75) hasSphere];
      v24[3378] = 1;
      *(v24 + 845) = 1065353216;
      *(v24 + 849) = 0;
      *(v24 + 833) = 1065353216;
      *(v24 + 2324) = 0x100000001;
      v24[2673] = 1;
      *(v24 + 669) = 3;
      [(BWFigVideoCaptureDevice *)v24 _updateStreamMetadataSettings];
      *(v24 + 72) = [[BWHistogramStats alloc] initWithBins:&unk_1F2249A38];
      if (*(v24 + 147) == 10)
      {
        *(v24 + 1027) = [objc_msgSend(*(v24 + 78) objectForKeyedSubscript:{@"TimeOfFlightCameraType", "intValue"}];
      }

      *(v24 + 36) = 0;
      v24[156] = [*(v24 + 75) isMultipleSensorRawBufferPoolsSupported];
      *(v24 + 1077) = 0;
      [(BWFigVideoCaptureDevice *)v24 _configureZoomFudgingWithAspectRatio:?];
      *(v24 + 523) = 0x3F80000000000002;
      *(v24 + 860) = 0;
      *(v24 + 423) = 0;
      *(v24 + 213) = [*(v24 + 78) objectForKeyedSubscript:@"SmartFramingZoomFactorsByFieldOfView"];
      v24[1721] = 1;
      *(v24 + 78) = -1082130432;
      v24[316] = 0;
      *(v24 + 70) = -1082130432;
      v24[284] = 0;
      v24[384] = 0;
      v24[4345] = 0;
      *(v24 + 1096) = 0;
      *(v24 + 551) = objc_alloc_init(BWDeviceOrientationMonitor);
      v120 = *(v24 + 147);
      if (v120 == 14)
      {
        [v24 setDeskCamActive:1];
        v120 = *(v24 + 147);
      }

      errorCopy5 = error;
      if (v120 == 7 && *(v24 + 154) == 1)
      {
        [v24 setUltraWideActive:1];
      }

      *(v24 + 1114) = -1;
      *(v24 + 1118) = 0;
      v24[4544] = FigCapturePlatformSupportsExclaves() != 0;
      *(v24 + 578) = objc_alloc_init(MEMORY[0x1E695DF90]);
      *(v24 + 1158) = 0;
      goto LABEL_3;
    }

    [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
  }

  else if ([v24 isBravoVariant])
  {
    v49 = [BWFigVideoCaptureDevice _captureStreamByPortType:v24];
    *(v24 + 75) = v49;
    if (v49)
    {
      v50 = *(v24 + 85);
      if (!v50)
      {
        v50 = v49;
      }

      *(v24 + 174) = v50;
      *(v24 + 175) = v50;
      *(v24 + 84) = [BWFigVideoCaptureDevice _captureStreamByPortType:v24];
      v51 = [BWFigVideoCaptureDevice _captureStreamByPortType:v24];
      *(v24 + 85) = v51;
      if (v51 | *(v24 + 84))
      {
        *(v24 + 353) = 0;
        v52 = [attributesCopy objectForKeyedSubscript:@"SynchronizedStreamsSlaveFrameRates"];
        *(v24 + 369) = [objc_msgSend(v52 objectForKeyedSubscript:{@"NominalSlaveFrameRate", "intValue"}];
        *(v24 + 371) = [objc_msgSend(v52 objectForKeyedSubscript:{@"ElevatedSlaveFrameRate", "intValue"}];
        v53 = [objc_msgSend(v52 objectForKeyedSubscript:{@"NominalSlaveFrameRateForDepthDataDelivery", "intValue"}];
        *(v24 + 373) = v53;
        if (!v53)
        {
          *(v24 + 373) = *(v24 + 369);
        }

        v54 = [objc_msgSend(v52 objectForKeyedSubscript:{@"ElevatedSlaveFrameRateForDepthDataDelivery", "intValue"}];
        *(v24 + 374) = v54;
        if (!v54)
        {
          *(v24 + 374) = *(v24 + 371);
        }

        v55 = [objc_msgSend(v52 objectForKeyedSubscript:{@"ElevatedSlaveFrameRateForDepthDataDeliveryWhenWaitingForExposureFocusStability", "intValue"}];
        *(v24 + 375) = v55;
        if (!v55)
        {
          *(v24 + 375) = *(v24 + 371);
        }

        *(v24 + 376) = 2;
        v56 = [attributesCopy objectForKeyedSubscript:@"SynchronizedStreamsSwitchOverParameters"];
        *(v24 + 177) = -[BWBravoStreamSelector initWithStreamSelectionAttributes:wideStream:teleStream:superWideStream:cameraCalibrationValid:]([BWBravoStreamSelector alloc], "initWithStreamSelectionAttributes:wideStream:teleStream:superWideStream:cameraCalibrationValid:", v56, *(v24 + 75), *(v24 + 84), *(v24 + 85), [+[BWFigCaptureDeviceVendor sharedCaptureDeviceVendor](BWFigCaptureDeviceVendor "sharedCaptureDeviceVendor")]);
        *(v24 + 381) = 1;
        *(v24 + 380) = [objc_msgSend(v56 objectForKeyedSubscript:{@"parallaxMitigationRampDuration", "intValue"}];
        *(v24 + 191) = [[BWRamp alloc] initWithName:@"ParallaxMitigationRamp"];
        *(v24 + 378) = 0;
        [(BWFigVideoCaptureDevice *)v24 _updateParallaxMitigationBasedOnZoomFactorEnabled];
        v24[705] = [objc_msgSend(attributesCopy objectForKeyedSubscript:{@"AWBStatisticsAveragingSupported", "BOOLValue"}];
        v57 = [attributesCopy objectForKeyedSubscript:@"SynchronizedStreamsStereoFusionZoomFactorRange"];
        [objc_msgSend(v57 objectAtIndexedSubscript:{0), "floatValue"}];
        *(v24 + 367) = v58;
        [objc_msgSend(v57 objectAtIndexedSubscript:{1), "floatValue"}];
        *(v24 + 368) = v59;
        [objc_msgSend(attributesCopy objectForKeyedSubscript:{@"SynchronizedStreamsOISSISStereoFusionTeleMinIntegrationTimeDenominator", "doubleValue"}];
        *(v24 + 321) = 1.0 / v60;
        [objc_msgSend(attributesCopy objectForKeyedSubscript:{@"SynchronizedStreamsOISSISStereoFusionTeleMinGain", "floatValue"}];
        *(v24 + 644) = v61;
        v62 = *(v24 + 84);
        if (v62)
        {
          *(v24 + 320) = fvcd_stillImageStabilizationIntegrationTimeThresholdFromSensorIDDictionary([v62 sensorIDDictionary]);
        }

        v24[1776] = [(NSDictionary *)[(BWFigCaptureSynchronizedStreamsGroup *)[(BWFigVideoCaptureSynchronizedStreamsGroup *)v40 syncGroup] supportedProperties] objectForKeyedSubscript:*off_1E798CC68]!= 0;
        *(v24 + 851) = 0;
        goto LABEL_52;
      }

      [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
    }

    else
    {
      [BWFigVideoCaptureDevice _initWithCaptureDevice:attributes:synchronizedStreamsAttributes:unsynchronizedStreamsAttributes:multiCamEnabled:midFrameSynchronizationEnabled:applicationID:clientAuditToken:tccIdentity:mediaEnvironment:deviceVendor:createAutofocusSampleBufferProcessorFunction:cameraParameters:deviceClientPriority:error:];
    }
  }

  else
  {
    v46 = *(v24 + 147);
    if (v46 == 12 || v46 == 6)
    {
      v47 = [BWFigVideoCaptureDevice _captureStreamByPortType:v24];
      *(v24 + 75) = v47;
      *(v24 + 174) = v47;
      if ([streamsAttributes count] == 2)
      {
        *(v24 + 195) = [BWFigVideoCaptureDevice _captureStreamByPortType:v24];
      }

LABEL_52:
      v63 = [v24 synchronizationPrimaryForMidFrameSynchronizationEnabled:v24[710]];
      v64 = v63;
      if (v63 != *(v24 + 75))
      {
        [objc_msgSend(*(v24 + 81) "syncGroup")];
      }

      v65 = [[BWStreamStartStopSynchronizer alloc] initWithStreams:*(v24 + 82) synchronizationPrimary:v64 timeoutInSeconds:0.0];
      *(v24 + 87) = v65;
      [(BWStreamStartStopSynchronizer *)v65 setWaitForMasterAEToSettle:(*(v24 + 147) & 0xFFFFFFFE) == 8];
      goto LABEL_55;
    }
  }

LABEL_23:

  if (errorCopy4)
  {
    v44 = v156[0];
    if (!v156[0])
    {
      v44 = -12780;
    }

    *errorCopy4 = v44;
  }

  return 0;
}

uint64_t __332__BWFigVideoCaptureDevice__initWithCaptureDevice_attributes_synchronizedStreamsAttributes_unsynchronizedStreamsAttributes_multiCamEnabled_midFrameSynchronizationEnabled_applicationID_clientAuditToken_tccIdentity_mediaEnvironment_deviceVendor_createAutofocusSampleBufferProcessorFunction_cameraParameters_deviceClientPriority_error___block_invoke(uint64_t a1, void *a2, void *a3)
{
  [a2 baseZoomFactor];
  v5 = v4;
  [a3 baseZoomFactor];
  if (v5 >= v6)
  {
    return 1;
  }

  else
  {
    return -1;
  }
}

- (NSString)description
{
  v3 = MEMORY[0x1E696AEC0];
  v4 = objc_opt_class();
  v5 = NSStringFromClass(v4);
  return [v3 stringWithFormat:@"<%@: %p> type:%@ portTypes:%@", v5, self, FigCaptureSourceDeviceTypeToShortString(self->_deviceType, self->_position), -[NSArray componentsJoinedByString:](self->_activePortTypes, "componentsJoinedByString:", @", ")];
}

- (void)setMemoryPool:(id)pool
{
  if ([(BWFigVideoCaptureStream *)self->_captureStream started])
  {
    [BWFigVideoCaptureDevice setMemoryPool:];
  }

  else
  {
    height = self->_regionOfInterestForCameraControlsNormalizedInSensorSpace.size.height;
    if (*&height != pool)
    {

      *&self->_regionOfInterestForCameraControlsNormalizedInSensorSpace.size.height = pool;
    }
  }
}

- (void)performBlockOnNotificationQueue:(id)queue
{
  if (queue)
  {
    notificationQueue = self->_notificationQueue;
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __59__BWFigVideoCaptureDevice_performBlockOnNotificationQueue___block_invoke;
    block[3] = &unk_1E798FEA0;
    block[4] = queue;
    dispatch_async(notificationQueue, block);
  }
}

void __59__BWFigVideoCaptureDevice_performBlockOnNotificationQueue___block_invoke(uint64_t a1)
{
  v2 = objc_autoreleasePoolPush();
  (*(*(a1 + 32) + 16))();

  objc_autoreleasePoolPop(v2);
}

- (void)releaseResources
{
  os_unfair_lock_lock(&self->_sensorRawPoolLock);
  if (self->_sensorRawPools)
  {
    if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
    {
      if (self->_multipleSensorRawBufferPoolsEnabled)
      {
        v3 = off_1E798CCE8;
      }

      else
      {
        v3 = off_1E798CCD8;
      }

      v4 = *v3;
      syncGroup = [(BWFigVideoCaptureSynchronizedStreamsGroup *)self->_synchronizedStreamsGroup syncGroup];
    }

    else
    {
      if (self->_multipleSensorRawBufferPoolsEnabled)
      {
        v6 = off_1E798C138;
      }

      else
      {
        v6 = off_1E798C128;
      }

      v4 = *v6;
      syncGroup = [(BWFigVideoCaptureStream *)self->_captureStream stream];
    }

    [(BWFigCaptureSynchronizedStreamsGroup *)syncGroup setProperty:v4 value:0];

    self->_sensorRawPools = 0;
  }

  os_unfair_lock_unlock(&self->_sensorRawPoolLock);
}

- ($273FE01EDA4852E8FFB0AF95686D18CC)minimumFrameRate
{
  minimumFrameRate = [(BWFigVideoCaptureStream *)self->_captureStream minimumFrameRate];
  result.var0 = minimumFrameRate;
  result.var1 = v3;
  return result;
}

- (void)setMinimumFrameRate:(id)rate
{
  var0 = rate.var0;
  var1 = rate.var1;
  v6 = FigCaptureFrameRateAsFloat(*&rate.var0, rate.var1);
  focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __47__BWFigVideoCaptureDevice_setMinimumFrameRate___block_invoke;
  v8[3] = &unk_1E7991CF0;
  v8[4] = self;
  v9 = v6;
  dispatch_async(focusAndExposureUpdateQueue, v8);
  [(BWFigVideoCaptureDevice *)self _setMinimumFrameRate:var1];
}

float __47__BWFigVideoCaptureDevice_setMinimumFrameRate___block_invoke(uint64_t a1)
{
  result = *(a1 + 40);
  *(*(a1 + 32) + 2284) = result;
  return result;
}

- ($273FE01EDA4852E8FFB0AF95686D18CC)maximumFrameRate
{
  maximumFrameRate = [(BWFigVideoCaptureStream *)self->_captureStream maximumFrameRate];
  result.var0 = maximumFrameRate;
  result.var1 = v3;
  return result;
}

- (void)setActiveVideoMinFrameDuration:(id *)duration activeVideoMaxFrameDuration:(id *)frameDuration
{
  v19 = 0u;
  v20 = 0u;
  v17 = 0u;
  v18 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v17 objects:v16 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v18;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v18 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        v11 = *(*(&v17 + 1) + 8 * i);
        v14 = *&duration->var0;
        var3 = duration->var3;
        v12 = *&frameDuration->var0;
        v13 = frameDuration->var3;
        [v11 setActiveVideoMinFrameDuration:&v14 activeVideoMaxFrameDuration:&v12];
      }

      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v17 objects:v16 count:16];
    }

    while (v8);
  }
}

- (void)setCinematicFramingEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  if (self->_cinematicFramingEnabled != enabled)
  {
    self->_cinematicFramingEnabled = enabled;
    v5 = mach_absolute_time();
    if (enabledCopy)
    {
      self->_cinematicFramingStartTime = v5;
    }

    else
    {
      self->_cinematicFramingTotalTime += v5 - self->_cinematicFramingStartTime;
    }
  }

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v13;
    do
    {
      v10 = 0;
      do
      {
        if (*v13 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v12 + 1) + 8 * v10++) setCinematicFramingEnabled:enabledCopy];
      }

      while (v8 != v10);
      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
    }

    while (v8);
  }
}

- (void)setBackgroundBlurEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  if (self->_backgroundBlurEnabled != enabled)
  {
    self->_backgroundBlurEnabled = enabled;
    v5 = mach_absolute_time();
    if (enabledCopy)
    {
      self->_backgroundBlurStartTime = v5;
    }

    else
    {
      self->_backgroundBlurTotalTime += v5 - self->_backgroundBlurStartTime;
    }
  }

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v13;
    do
    {
      v10 = 0;
      do
      {
        if (*v13 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v12 + 1) + 8 * v10++) setBackgroundBlurEnabled:enabledCopy];
      }

      while (v8 != v10);
      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
    }

    while (v8);
  }
}

- (void)setStudioLightingEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  if (self->_studioLightingEnabled != enabled)
  {
    self->_studioLightingEnabled = enabled;
    v5 = mach_absolute_time();
    if (enabledCopy)
    {
      self->_studioLightingStartTime = v5;
    }

    else
    {
      self->_studioLightingTotalTime += v5 - self->_studioLightingStartTime;
    }
  }

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v13;
    do
    {
      v10 = 0;
      do
      {
        if (*v13 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v12 + 1) + 8 * v10++) setStudioLightingEnabled:enabledCopy];
      }

      while (v8 != v10);
      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
    }

    while (v8);
  }
}

- (void)setReactionEffectsEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  if (self->_reactionEffectsEnabled != enabled)
  {
    self->_reactionEffectsEnabled = enabled;
    v5 = mach_absolute_time();
    if (enabledCopy)
    {
      self->_reactionEffectsEnabledStartTime = v5;
    }

    else
    {
      self->_reactionEffectsEnabledTotalTime += v5 - self->_reactionEffectsEnabledStartTime;
    }
  }

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v13;
    do
    {
      v10 = 0;
      do
      {
        if (*v13 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v12 + 1) + 8 * v10++) setReactionEffectsEnabled:enabledCopy];
      }

      while (v8 != v10);
      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
    }

    while (v8);
  }
}

- (void)setBackgroundReplacementEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  if (self->_backgroundReplacementEnabled != enabled)
  {
    self->_backgroundReplacementEnabled = enabled;
    v5 = mach_absolute_time();
    if (enabledCopy)
    {
      self->_backgroundReplacementStartTime = v5;
    }

    else
    {
      self->_backgroundReplacementTotalTime += v5 - self->_backgroundReplacementStartTime;
    }
  }

  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v13;
    do
    {
      v10 = 0;
      do
      {
        if (*v13 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v12 + 1) + 8 * v10++) setBackgroundReplacementEnabled:enabledCopy];
      }

      while (v8 != v10);
      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
    }

    while (v8);
  }
}

- (void)setStreamingFilterDelegate:(id)delegate
{
  self->_centerStageDelegate = 0;
  if (delegate)
  {
    v5 = [[FigWeakReference alloc] initWithReferencedObject:delegate];
    self->_centerStageDelegate = v5;
    referencedObject = [(FigWeakReference *)v5 referencedObject];
    LODWORD(v7) = self->_firstValidFramePTS.epoch;

    [referencedObject setSimulatedAperture:v7];
  }
}

- (id)cameraInfoByPortTypeIncludingLSCGains:(BOOL)gains includeCameraInfoForSensorRawProcessing:(BOOL)processing
{
  processingCopy = processing;
  gainsCopy = gains;
  selfCopy = self;
  v106 = 0u;
  v107 = 0u;
  v104 = 0u;
  v105 = 0u;
  captureStreams = self->_captureStreams;
  v93 = [(NSArray *)captureStreams countByEnumeratingWithState:&v104 objects:v103 count:16];
  v8 = 0;
  if (v93)
  {
    v9 = *v105;
    v92 = gainsCopy || processingCopy;
    v88 = *off_1E7989EE8;
    v91 = *off_1E7989EC8;
    v89 = *off_1E7989E98;
    v90 = *off_1E7989EB8;
    v94 = *off_1E7989E50;
    v10 = *off_1E798BC60;
    v66 = *off_1E7989ED8;
    v67 = *off_1E798C950;
    v68 = *off_1E7989F10;
    v69 = *off_1E7989F08;
    v73 = *off_1E7989EC0;
    v65 = *off_1E798BE30;
    v63 = *off_1E7989EF8;
    v64 = *off_1E7989EB0;
    v61 = *off_1E7989F28;
    v62 = *off_1E798C120;
    v60 = *off_1E7989F18;
    v72 = *off_1E7989E80;
    v58 = *off_1E7989E48;
    v59 = *off_1E7989E78;
    v56 = *off_1E798C2C8;
    v57 = *off_1E7989E70;
    v54 = *off_1E7989EA8;
    v55 = *off_1E7989F30;
    v52 = *off_1E7989F20;
    v53 = *off_1E798C118;
    v70 = *off_1E7989E68;
    v51 = *off_1E7989ED0;
    v50 = *off_1E7989E60;
    v49 = *off_1E798A0D0;
    v47 = *off_1E798A0C0;
    v48 = *off_1E7989E90;
    v46 = *off_1E7989E88;
    v86 = *off_1E7989E58;
    v85 = *off_1E7989F00;
    v84 = *off_1E798BF28;
    v77 = *off_1E798BF30;
    v76 = *off_1E7989EF0;
    v74 = *off_1E7989EE0;
    v83 = *off_1E798BEF0;
    v82 = *off_1E798BE80;
    v81 = *off_1E798BDA8;
    v80 = *off_1E798BDB0;
    v78 = *v105;
    v79 = *off_1E7989EA0;
    obj = captureStreams;
    v45 = selfCopy;
    v44 = processingCopy;
    do
    {
      v11 = 0;
      do
      {
        if (*v105 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v104 + 1) + 8 * v11);
        portType = [v12 portType];
        v14 = [(NSMutableDictionary *)selfCopy->_cameraInfoByPortType objectForKeyedSubscript:portType];
        if (v92)
        {
          v15 = [-[NSMutableDictionary objectForKeyedSubscript:](selfCopy->_cameraInfoByPortType objectForKeyedSubscript:{portType), "objectForKeyedSubscript:", v88}] == 0;
          if (processingCopy)
          {
            goto LABEL_10;
          }
        }

        else
        {
          v15 = 0;
          if (processingCopy)
          {
LABEL_10:
            v95 = [-[NSMutableDictionary objectForKeyedSubscript:](selfCopy->_cameraInfoByPortType objectForKeyedSubscript:{portType), "objectForKeyedSubscript:", v91}] == 0;
            HIDWORD(v97) = [-[NSMutableDictionary objectForKeyedSubscript:](selfCopy->_cameraInfoByPortType objectForKeyedSubscript:{portType), "objectForKeyedSubscript:", v90}] == 0;
            LODWORD(v97) = [-[NSMutableDictionary objectForKeyedSubscript:](selfCopy->_cameraInfoByPortType objectForKeyedSubscript:{portType), "objectForKeyedSubscript:", v89}] == 0;
            goto LABEL_11;
          }
        }

        v97 = 0;
        v95 = 0;
LABEL_11:
        v96 = portType;
        [objc_msgSend(-[NSMutableDictionary objectForKeyedSubscript:](selfCopy->_cameraInfoByPortType "objectForKeyedSubscript:{"objectForKeyedSubscript:", v94), "floatValue"}")];
        v17 = v16;
        [v12 baseZoomFactor];
        v19 = v18;
        if (v14 != 0 && !v15 && (v97 & 0x100000000) == 0 && (v97 & 1) == 0 && v17 == v18)
        {
          goto LABEL_29;
        }

        if (v14)
        {
          v20 = [objc_alloc(MEMORY[0x1E695DF90]) initWithDictionary:{-[NSMutableDictionary objectForKeyedSubscript:](selfCopy->_cameraInfoByPortType, "objectForKeyedSubscript:", portType)}];
          if (v17 == v19)
          {
            goto LABEL_18;
          }

          goto LABEL_17;
        }

        v71 = v15;
        v75 = objc_alloc_init(MEMORY[0x1E695DF90]);
        if (!v8)
        {
          v8 = objc_alloc_init(MEMORY[0x1E695DF90]);
          v99 = 0u;
          v100 = 0u;
          v101 = 0u;
          v102 = 0u;
          v27 = selfCopy->_captureStreams;
          v28 = [(NSArray *)v27 countByEnumeratingWithState:&v99 objects:v98 count:16];
          if (v28)
          {
            v29 = v28;
            v30 = *v100;
            do
            {
              for (i = 0; i != v29; ++i)
              {
                if (*v100 != v30)
                {
                  objc_enumerationMutation(v27);
                }

                [v8 setObject:objc_msgSend(objc_msgSend(*(*(&v99 + 1) + 8 * i) forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v10, 0), objc_msgSend(*(*(&v99 + 1) + 8 * i), "portType")}];
              }

              v29 = [(NSArray *)v27 countByEnumeratingWithState:&v99 objects:v98 count:16];
            }

            while (v29);
            selfCopy = v45;
            processingCopy = v44;
            v9 = v78;
          }
        }

        [v75 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", objc_msgSend(objc_msgSend(objc_msgSend(objc_msgSend(v12, "supportedFormats"), "firstObject"), "objectForKeyedSubscript:", v67), "intValue") > 0), v66}];
        [v12 opticalCenterOffset];
        [v75 setObject:CGPointCreateDictionaryRepresentation(v108) forKeyedSubscript:v69];
        [v12 opticalCenterOffsetInPhysicalSensorDimensions];
        [v75 setObject:CGPointCreateDictionaryRepresentation(v109) forKeyedSubscript:v68];
        [v75 setObject:objc_msgSend(v12 forKeyedSubscript:{"geometricDistortionCoefficients"), v73}];
        [v75 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v65, 0), v64}];
        [v75 setObject:objc_msgSend(v12 forKeyedSubscript:{"moduleInfo"), v63}];
        [v75 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v62, 0), v61}];
        v32 = MEMORY[0x1E696AD98];
        [v12 pixelSize];
        [v75 setObject:objc_msgSend(v32 forKeyedSubscript:{"numberWithFloat:"), v60}];
        [v75 setObject:objc_msgSend(v12 forKeyedSubscript:{"cameraViewMatrix"), v72}];
        [v75 setObject:objc_msgSend(v12 forKeyedSubscript:{"cameraPoseMatrix"), v59}];
        [v75 setObject:objc_msgSend(v8 forKeyedSubscript:{"objectForKeyedSubscript:", v96), v58}];
        [v75 setObject:-[BWFigVideoCaptureDevice _cameraColorCalibrationsForCaptureStream:absoluteColorCalibrationsByPortType:](selfCopy) forKeyedSubscript:v57];
        [v75 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v56, 0), v55}];
        [v75 setObject:-[BWFigVideoCaptureDevice _flashCalibrationDataForCaptureStream:absoluteColorCalibrationsByPortType:](selfCopy forKeyedSubscript:{v12), v54}];
        [v75 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v53, 0), v52}];
        calibrationValidRadiusForFullFieldOfView = [v12 calibrationValidRadiusForFullFieldOfView];
        if (calibrationValidRadiusForFullFieldOfView)
        {
          v34 = calibrationValidRadiusForFullFieldOfView;
          [v75 setObject:calibrationValidRadiusForFullFieldOfView forKeyedSubscript:v70];
          [v34 floatValue];
          v36 = v35 * 0.98;
          *&v36 = v36;
          [v75 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithFloat:", v36), v51}];
        }

        [v12 calibratedRotationAngle];
        if (v37 != 0.0)
        {
          v38 = MEMORY[0x1E696AD98];
          [v12 calibratedRotationAngle];
          [v75 setObject:objc_msgSend(v38 forKeyedSubscript:{"numberWithFloat:"), v50}];
        }

        dictionary = [MEMORY[0x1E695DF90] dictionary];
        if ([v12 hasOpticalCenterOffsetCalibratedForNarrowerFieldOfView])
        {
          [v12 opticalCenterOffsetCalibratedForNarrowerFieldOfView];
          [dictionary setObject:CGPointCreateDictionaryRepresentation(v110) forKeyedSubscript:v69];
          [v12 opticalCenterOffsetCalibratedForNarrowerFieldOfViewInPhysicalSensorDimensions];
          [dictionary setObject:CGPointCreateDictionaryRepresentation(v111) forKeyedSubscript:v68];
        }

        [dictionary setObject:objc_msgSend(v12 forKeyedSubscript:{"geometricDistortionCoefficientsCalibratedForNarrowerFieldOfView"), v73}];
        [dictionary setObject:objc_msgSend(v12 forKeyedSubscript:{"cameraViewMatrixCalibratedForNarrowerFieldOfView"), v72}];
        [dictionary setObject:objc_msgSend(v12 forKeyedSubscript:{"calibrationValidRadiusForNarrowerFieldOfView"), v70}];
        v20 = v75;
        if ([dictionary count])
        {
          if ([v96 isEqualToString:v49])
          {
            [v75 setObject:dictionary forKeyedSubscript:v48];
            v40 = v46;
          }

          else
          {
            if (![v96 isEqualToString:v47])
            {
              goto LABEL_52;
            }

            cameraViewMatrixCalibratedForNarrowerFieldOfView = [v12 cameraViewMatrixCalibratedForNarrowerFieldOfView];
            v40 = v48;
            if (!cameraViewMatrixCalibratedForNarrowerFieldOfView)
            {
              goto LABEL_52;
            }
          }

          [v75 setObject:dictionary forKeyedSubscript:v40];
        }

LABEL_52:
        v15 = v71;
LABEL_17:
        v21 = MEMORY[0x1E696AD98];
        [v12 baseZoomFactor];
        [v20 setObject:objc_msgSend(v21 forKeyedSubscript:{"numberWithFloat:"), v94}];
        v22 = MEMORY[0x1E696AD98];
        [v12 baseZoomFactorAfterGDC];
        [v20 setObject:objc_msgSend(v22 forKeyedSubscript:{"numberWithFloat:"), v86}];
        [v20 setObject:objc_msgSend(v12 forKeyedSubscript:{"nondisruptiveSwitchingZoomFactors"), v85}];
LABEL_18:
        if (v15)
        {
          v23 = [objc_msgSend(v12 "stream")];
          if (v23)
          {
            v24 = v23;
            bytes = [v23 bytes];
            [v20 setObject:v24 forKeyedSubscript:v88];
            [v20 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v77, 0), v76}];
            v26 = *bytes;
            v9 = v78;
            if (v26 == 2)
            {
              CMILSCOISAdaptation_convertV2LSCTableToV1LSCTable();
              [v20 setObject:0 forKeyedSubscript:v88];
              [v20 setObject:v24 forKeyedSubscript:v74];
            }
          }
        }

        if (v95)
        {
          [v20 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v83, 0), v91}];
        }

        if (HIDWORD(v97))
        {
          [v20 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v82, 0), v90}];
        }

        if (v97)
        {
          [v20 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v81, 0), v89}];
          [v20 setObject:objc_msgSend(objc_msgSend(v12 forKeyedSubscript:{"stream"), "getPropertyIfSupported:error:", v80, 0), v79}];
        }

        -[NSMutableDictionary setObject:forKeyedSubscript:](selfCopy->_cameraInfoByPortType, "setObject:forKeyedSubscript:", [v20 copy], v96);

LABEL_29:
        ++v11;
      }

      while (v11 != v93);
      v42 = [(NSArray *)obj countByEnumeratingWithState:&v104 objects:v103 count:16];
      v93 = v42;
    }

    while (v42);
  }

  return [(NSMutableDictionary *)selfCopy->_cameraInfoByPortType copy];
}

uint64_t __54__BWFigVideoCaptureDevice_moduleCalibrationByPortType__block_invoke(uint64_t a1)
{
  v1 = [objc_msgSend(*(a1 + 32) "referencedObject")];
  if (dword_1ED844350)
  {
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
    fig_log_call_emit_and_clean_up_after_send_and_compose();
  }

  return v1;
}

- (void)unregisterForAEMatrixMetadata
{
  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  captureStreams = self->_captureStreams;
  v3 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v11;
    v6 = *off_1E798BBF8;
    v7 = MEMORY[0x1E695E110];
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v11 != v5)
        {
          objc_enumerationMutation(captureStreams);
        }

        [objc_msgSend(*(*(&v10 + 1) + 8 * i) "stream")];
      }

      v4 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
    }

    while (v4);
  }
}

- (void)setFaceDetectionConfiguration:(id)configuration
{
  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  captureStreams = self->_captureStreams;
  v5 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v10 + 1) + 8 * i) setFaceDetectionConfiguration:configuration];
      }

      v6 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
    }

    while (v6);
  }
}

- (void)startupFaceDetectionIfNeeded
{
  v10 = 0u;
  v11 = 0u;
  v8 = 0u;
  v9 = 0u;
  captureStreams = self->_captureStreams;
  v3 = [(NSArray *)captureStreams countByEnumeratingWithState:&v8 objects:v7 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v9;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v9 != v5)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v8 + 1) + 8 * i) setObjectDetectionStartupDeferred:0];
      }

      v4 = [(NSArray *)captureStreams countByEnumeratingWithState:&v8 objects:v7 count:16];
    }

    while (v4);
  }
}

- (void)setTemporalNoiseReductionBand0StrengthModulation:(int)modulation
{
  v3 = *&modulation;
  v21 = 0u;
  v22 = 0u;
  v19 = 0u;
  v20 = 0u;
  captureStreams = self->_captureStreams;
  v6 = [(NSArray *)captureStreams countByEnumeratingWithState:&v19 objects:v18 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v20;
    do
    {
      v9 = 0;
      do
      {
        if (*v20 != v8)
        {
          objc_enumerationMutation(captureStreams);
        }

        v10 = *(*(&v19 + 1) + 8 * v9);
        if (self->_depthType == 3 && v10 == [(NSArray *)self->_captureStreamsByFocalLength firstObject])
        {
          v12 = BYTE2(self->_defaultContinuousAutoFocusWindowSize.height);
          v13 = BYTE3(self->_ptsOfLastTimeOfFlightFrameRateChange.value);
          v15 = v10;
          v14 = 0;
          v11 = 0;
          v16 = 0;
        }

        else
        {
          v11 = BYTE2(self->_ptsOfLastTimeOfFlightFrameRateChange.value);
          v12 = BYTE2(self->_defaultContinuousAutoFocusWindowSize.height);
          v13 = BYTE3(self->_ptsOfLastTimeOfFlightFrameRateChange.value);
          v14 = (self->_ptsOfLastTimeOfFlightFrameRateChange.value & 0x100) == 0;
          v15 = v10;
          v16 = v3;
        }

        [v15 setTemporalNoiseReductionConfigurationBand0Enabled:v14 rawEnabled:v11 modulation:v16 adaptiveOverscanEnabled:v12 strengthHighEnabled:v13];
        ++v9;
      }

      while (v7 != v9);
      v17 = [(NSArray *)captureStreams countByEnumeratingWithState:&v19 objects:v18 count:16];
      v7 = v17;
    }

    while (v17);
  }

  self->_ptsOfLastTimeOfFlightFrameRateChange.timescale = v3;
}

- (void)updateClientAuditToken:(id *)token
{
  os_unfair_lock_lock(&self->_clientAuditTokenLock);
  v5 = *token->var0;
  *&self->_clientAuditToken.val[4] = *&token->var0[4];
  *self->_clientAuditToken.val = v5;
  v6 = *&token->var0[4];
  v20 = *token->var0;
  v21 = v6;
  self->_clientPID = FigCaptureGetPIDFromAuditToken(&v20);
  v7 = *&token->var0[4];
  v20 = *token->var0;
  v21 = v7;
  self->_isRunningInXCTest = FigCaptureClientIsRunningInXCTest(&v20) != 0;
  os_unfair_lock_unlock(&self->_clientAuditTokenLock);
  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  captureStreams = self->_captureStreams;
  v9 = [(NSArray *)captureStreams countByEnumeratingWithState:&v16 objects:v15 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v17;
    do
    {
      v12 = 0;
      do
      {
        if (*v17 != v11)
        {
          objc_enumerationMutation(captureStreams);
        }

        v13 = *(*(&v16 + 1) + 8 * v12);
        v14 = *&token->var0[4];
        v20 = *token->var0;
        v21 = v14;
        [v13 updateClientAuditToken:&v20];
        ++v12;
      }

      while (v10 != v12);
      v10 = [(NSArray *)captureStreams countByEnumeratingWithState:&v16 objects:v15 count:16];
    }

    while (v10);
  }
}

- (void)_postNotificationWithPayload:(id)payload notificationPayload:(id)notificationPayload
{
  if (payload)
  {
    notificationQueue = self->_notificationQueue;
    if (notificationQueue)
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __76__BWFigVideoCaptureDevice__postNotificationWithPayload_notificationPayload___block_invoke;
      block[3] = &unk_1E798FD58;
      block[4] = payload;
      block[5] = self;
      block[6] = notificationPayload;
      dispatch_async(notificationQueue, block);
    }
  }

  else
  {
    [BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:];
  }
}

void __76__BWFigVideoCaptureDevice__postNotificationWithPayload_notificationPayload___block_invoke()
{
  v0 = objc_autoreleasePoolPush();
  CMNotificationCenterGetDefaultLocalCenter();
  CMNotificationCenterPostNotification();

  objc_autoreleasePoolPop(v0);
}

+ (uint64_t)_autofocusProcessorImageControlModeFromImageControlMode:(uint64_t)mode
{
  objc_opt_self();
  result = 0;
  if (a2 <= 2)
  {
    if (a2)
    {
      if (a2 == 1)
      {
        return 0x1F218A2B0;
      }

      else if (a2 == 2)
      {
        return 0x1F218A2D0;
      }
    }

    else
    {
      return 0x1F218A290;
    }
  }

  else if (a2 > 4)
  {
    if (a2 == 5)
    {
      return 0x1F218A330;
    }

    else if (a2 == 6)
    {
      return 0x1F218A350;
    }
  }

  else if (a2 == 3)
  {
    return 0x1F218A2F0;
  }

  else
  {
    return 0x1F218A310;
  }

  return result;
}

- (void)_teardownAutoFocusSampleBufferProcessor
{
  if (!_FigIsCurrentDispatchQueue())
  {
    [BWFigVideoCaptureDevice _teardownAutoFocusSampleBufferProcessor];
  }

  if (self->_autofocusProcessor)
  {
    FigBaseObject = FigSampleBufferProcessorGetFigBaseObject();
    if (FigBaseObject)
    {
      v4 = FigBaseObject;
      v5 = *(*(CMBaseObjectGetVTable() + 8) + 24);
      if (v5)
      {
        v5(v4);
      }
    }

    CMNotificationCenterGetDefaultLocalCenter();
    CMNotificationCenterRemoveListener();
    autofocusProcessor = self->_autofocusProcessor;
    if (autofocusProcessor)
    {
      CFRelease(autofocusProcessor);
      self->_autofocusProcessor = 0;
    }
  }
}

uint64_t __76__BWFigVideoCaptureDevice__copyAutofocusProcessorProperty_propertyValueOut___block_invoke(uint64_t a1)
{
  result = [BWFigVideoCaptureDevice _copyAutofocusProcessorPropertyInternal:? propertyValueOut:?];
  *(*(*(a1 + 40) + 8) + 24) = result;
  return result;
}

uint64_t __86__BWFigVideoCaptureDevice__updateWhiteBalanceStateForAutofocusProperty_propertyValue___block_invoke(uint64_t a1)
{
  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  v2 = *(*(a1 + 32) + 656);
  result = [v2 countByEnumeratingWithState:&v10 objects:v9 count:16];
  if (result)
  {
    v4 = result;
    v5 = *v11;
    v6 = *off_1E798BC58;
    do
    {
      v7 = 0;
      do
      {
        if (*v11 != v5)
        {
          objc_enumerationMutation(v2);
        }

        v8 = [*(*(&v10 + 1) + 8 * v7) stream];
        [v8 setPropertyIfSupported:v6 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithBool:", *(a1 + 40))}];
        ++v7;
      }

      while (v4 != v7);
      result = [v2 countByEnumeratingWithState:&v10 objects:v9 count:16];
      v4 = result;
    }

    while (result);
  }

  return result;
}

uint64_t __115__BWFigVideoCaptureDevice__serviceDeferredAutofocusProcessorPropertiesFromCaptureStream_frameStatisticsByPortType___block_invoke(uint64_t result)
{
  v1 = result;
  v2 = *(result + 32);
  if (*(v2 + 1831) == 1)
  {
    FigBaseObject = FigSampleBufferProcessorGetFigBaseObject();
    v4 = *(*(CMBaseObjectGetVTable() + 8) + 56);
    if (!v4 || (result = v4(FigBaseObject, 0x1F2189F90, *MEMORY[0x1E695E738]), result))
    {
      result = __115__BWFigVideoCaptureDevice__serviceDeferredAutofocusProcessorPropertiesFromCaptureStream_frameStatisticsByPortType___block_invoke_cold_1();
    }

    *(*(v1 + 32) + 1831) = 0;
    v2 = *(v1 + 32);
  }

  if (*(v2 + 1832) == 1)
  {
    v9[3] = [MEMORY[0x1E696AD98] numberWithInt:{*(v2 + 1836), *off_1E798AED0, *off_1E798AEC8, *off_1E798AEC0, *off_1E798A1C8, &unk_1F2246990, &unk_1F2246990, &unk_1F2246990}];
    v5 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v9 forKeys:&v8 count:4];
    v6 = FigSampleBufferProcessorGetFigBaseObject();
    v7 = *(*(CMBaseObjectGetVTable() + 8) + 56);
    if (!v7 || (result = v7(v6, 0x1F218A470, v5), result))
    {
      result = __115__BWFigVideoCaptureDevice__serviceDeferredAutofocusProcessorPropertiesFromCaptureStream_frameStatisticsByPortType___block_invoke_cold_2();
    }

    *(*(v1 + 32) + 1832) = 0;
    *(*(v1 + 32) + 1836) = 0;
  }

  return result;
}

- (void)captureStreamWillStartStreaming:(id)streaming
{
  if (self->_captureStream == streaming)
  {
    [(BWFigVideoCaptureDevice *)self _deviceWillStartStreaming];
  }

  synchronizedStreamsStartStopSynchronizer = self->_synchronizedStreamsStartStopSynchronizer;

  [(BWStreamStartStopSynchronizer *)synchronizedStreamsStartStopSynchronizer streamWillStart:streaming];
}

- (void)captureStreamDidStartStreaming:(id)streaming
{
  v5 = [objc_msgSend(streaming "stream")];
  if (v5)
  {
    [v5 floatValue];
    v7 = v6;
    [objc_msgSend(objc_msgSend(streaming "nondisruptiveSwitchingZoomFactors")];
    if (v8 == 0.0)
    {
      [streaming baseZoomFactor];
    }

    v9 = v7 * v8;
  }

  else
  {
    v9 = 1.0;
  }

  os_unfair_lock_lock(&self->_zoomFactorUpdateQueue);
  whiteBalanceModeForExif = self->_whiteBalanceModeForExif;
  if (*&whiteBalanceModeForExif <= v9)
  {
    *&whiteBalanceModeForExif = v9;
  }

  self->_whiteBalanceModeForExif = whiteBalanceModeForExif;
  os_unfair_lock_unlock(&self->_zoomFactorUpdateQueue);
  [(BWStreamStartStopSynchronizer *)self->_synchronizedStreamsStartStopSynchronizer streamDidStart:streaming];
  if (self->_captureStream == streaming)
  {
    if (v9 <= 1.0)
    {
      maxISPZoomFactor = 0.0;
    }

    else
    {
      maxISPZoomFactor = self->_maxISPZoomFactor;
    }

    if (self->_smartFramingEnabled)
    {
      v12 = 0;
    }

    else
    {
      v12 = LODWORD(maxISPZoomFactor);
    }

    [(NSMutableDictionary *)self->_whiteBalanceGains setTypicalISPZoomDelay:v12 maxISPZoomDelay:LODWORD(self->_newISPZoomFactor) clientCanCompensateForDelay:0];
  }

  if ([objc_msgSend(streaming "portType")])
  {
    self->_timeOfFlightCameraUseCaseMask |= 2u;
  }

  if (self->_deviceType == 13 && self->_depthDataDeliveryEnabled)
  {
    self->_timeOfFlightCameraUseCaseMask |= 8u;
  }

  if (self->_supplementalPointCloudCaptureDeviceDelegate)
  {
    self->_timeOfFlightCameraUseCaseMask |= 0x10u;
  }

  if (self->_bravoTelephotoCaptureStream == streaming)
  {
    [streaming maxEIT];
    bravoStreamSelector = self->_bravoStreamSelector;

    [(BWBravoStreamSelector *)bravoStreamSelector setTeleMaxEIT:?];
  }
}

- (void)captureStreamWillStopStreaming:(id)streaming
{
  p_systemPressureStatusLock = &self->_systemPressureStatusLock;
  if (BYTE6(self->_exifFocalLengthsByZoomFactor) == 1)
  {
    if ([(BWFigVideoCaptureStream *)self->_captureStream hasSphere])
    {
      os_unfair_lock_lock(&self->_bravoMasterLock);
      value = self->_mostRecentPTS.value;
      timescale = self->_mostRecentPTS.timescale;
      flags = self->_mostRecentPTS.flags;
      if (flags)
      {
        p_epoch = &self->_mostRecentPTS.epoch;
      }

      else
      {
        value = *MEMORY[0x1E6960C88];
        flags = *(MEMORY[0x1E6960C88] + 12);
        timescale = *(MEMORY[0x1E6960C88] + 8);
        p_epoch = (MEMORY[0x1E6960C88] + 16);
      }

      v12 = *p_epoch;
      os_unfair_lock_unlock(&self->_bravoMasterLock);
      os_unfair_lock_lock(&self->_streamingSessionAnalyticsVideoDimensions.height);
      memset(&v22, 0, sizeof(v22));
      lhs.value = value;
      lhs.timescale = timescale;
      lhs.flags = flags;
      lhs.epoch = v12;
      rhs = *&self->_streamingSessionAnalyticsHighlightRecoveryEnabled;
      CMTimeSubtract(&v22, &lhs, &rhs);
      memset(&lhs, 0, sizeof(lhs));
      rhs.value = value;
      rhs.timescale = timescale;
      rhs.flags = flags;
      rhs.epoch = v12;
      v23 = *(&self->_sphereMonitoringLock + 1);
      CMTimeSubtract(&lhs, &rhs, &v23);
      if ([self->_lastPTSOfActiveToStillPreviewActiveTransition.value isEqual:*off_1E798C470])
      {
        CMTimeMake(&rhs, -1, 30);
        lhs = rhs;
      }

      if ((lhs.flags & 1) != 0 && (rhs = lhs, CMTimeGetSeconds(&rhs) <= 0.5))
      {
        rhs = v22;
        v14 = CMTimeGetSeconds(&rhs) < 0.200000003;
        v15 = dbl_1AD056A10[v14];
        rhs = lhs;
        v11 = v15 - CMTimeGetSeconds(&rhs);
      }

      else
      {
        if ((0.033 - *&self->_streamingSessionAnalyticsPixelFormat) >= 0.0)
        {
          v11 = 0.033 - *&self->_streamingSessionAnalyticsPixelFormat;
        }

        else
        {
          v11 = 0.0;
        }

        rhs = v22;
        if (CMTimeGetSeconds(&rhs) >= 0.100000001)
        {
          LOBYTE(v14) = 0;
        }

        else
        {
          rhs = v22;
          v13 = 0.100000001 - CMTimeGetSeconds(&rhs);
          if (v11 < v13)
          {
            v11 = v13;
          }

          LOBYTE(v14) = 1;
        }
      }

      os_unfair_lock_lock(&self->_currentMasterCaptureStreamLock);
      if (LOBYTE(self->_activeSensorRegionForCameraControls.width) == 1 && self->_currentMasterCaptureStream == self->_captureStream)
      {
        v11 = v11 + -0.0333333333;
      }

      os_unfair_lock_unlock(&self->_currentMasterCaptureStreamLock);
      HIBYTE(p_systemPressureStatusLock[91]._os_unfair_lock_opaque) = v14;
      os_unfair_lock_unlock(&self->_streamingSessionAnalyticsVideoDimensions.height);
      if (v11 > 0.0)
      {
        goto LABEL_29;
      }
    }

    else if ((p_systemPressureStatusLock[91]._os_unfair_lock_opaque & 1) == 0)
    {
      [(NSMutableDictionary *)self->_whiteBalanceGains appliedZoomFactor];
      if (v8 == 1.0)
      {
        if ([(NSString *)[(BWFigVideoCaptureStream *)self->_captureStream portType] isEqualToString:*off_1E798A0F8])
        {
          width = self->_streamingSessionAnalyticsVideoDimensions.width;
          v10 = *&width;
          if (*&width > 1.0 || v10 <= 0.76)
          {
            if (*&width < 1.0 || v10 >= 1.32333333)
            {
              goto LABEL_30;
            }

            v11 = 0.2;
          }

          else
          {
            v11 = 0.1;
          }

LABEL_29:
          usleep((v11 * 1000000.0));
        }
      }
    }
  }

LABEL_30:
  [(BWStreamStartStopSynchronizer *)self->_synchronizedStreamsStartStopSynchronizer streamWillStop:streaming];
  os_unfair_lock_lock(&self->_transitionMonitorCoarseFocusTimeoutForVideoRecording);
  autoImageControlModeTransitionMonitor = self->_autoImageControlModeTransitionMonitor;
  self->_autoImageControlModeTransitionMonitor = 0;
  v17 = [*&self->_autoImageControlModeCompletionLock._os_unfair_lock_opaque description];

  *&self->_autoImageControlModeCompletionLock._os_unfair_lock_opaque = 0;
  os_unfair_lock_unlock(&self->_transitionMonitorCoarseFocusTimeoutForVideoRecording);
  if (autoImageControlModeTransitionMonitor)
  {
    if (dword_1ED844350)
    {
      LODWORD(rhs.value) = 0;
      LOBYTE(v23.value) = 0;
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v19 = rhs.value;
      if (os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, v23.value))
      {
        v20 = v19;
      }

      else
      {
        v20 = v19 & 0xFFFFFFFE;
      }

      if (v20)
      {
        LODWORD(lhs.value) = 136315394;
        *(&lhs.value + 4) = "[BWFigVideoCaptureDevice captureStreamWillStopStreaming:]";
        LOWORD(lhs.flags) = 2112;
        *(&lhs.flags + 2) = v17;
        _os_log_send_and_compose_impl();
      }

      fig_log_call_emit_and_clean_up_after_send_and_compose();
    }

    expectedMinimumFrameRatesByPortType = autoImageControlModeTransitionMonitor->_expectedMinimumFrameRatesByPortType;
    v22 = **&MEMORY[0x1E6960C70];
    (expectedMinimumFrameRatesByPortType)(autoImageControlModeTransitionMonitor, 0, &v22);
  }
}

- (void)captureStreamDidStopStreaming:(id)streaming
{
  if (self->_captureStream == streaming)
  {
    [(BWFigVideoCaptureDevice *)self _deviceDidStopStreaming];
  }

  synchronizedStreamsStartStopSynchronizer = self->_synchronizedStreamsStartStopSynchronizer;

  [(BWStreamStartStopSynchronizer *)synchronizedStreamsStartStopSynchronizer streamDidStop:streaming];
}

void __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke(uint64_t a1)
{
  v1 = *(*(a1 + 32) + 1784);
  if (v1)
  {
    v3 = *(a1 + 40);
    v4 = *(*(CMBaseObjectGetVTable() + 16) + 16);
    if (v4)
    {
      v4(v1, v3);
    }

    if (*(*(a1 + 32) + 3388) == 1)
    {
      v12 = 0;
      FigBaseObject = FigSampleBufferProcessorGetFigBaseObject();
      v6 = *(*(CMBaseObjectGetVTable() + 8) + 48);
      if (v6)
      {
        v6(FigBaseObject, 0x1F218A590, *MEMORY[0x1E695E480], &v12);
        v7 = v12;
      }

      else
      {
        v7 = 0;
      }

      v8 = [v7 intValue];
      if (!v12 || v8 > 0x10E)
      {
        goto LABEL_14;
      }

      v9 = FigCaptureExifOrientationFromRotationDegreesAndMirroring(v8, 0);
      os_unfair_lock_lock((*(a1 + 32) + 3396));
      v10 = *(a1 + 32);
      if (v9 != v10[848]._os_unfair_lock_opaque)
      {
        v10[848]._os_unfair_lock_opaque = v9;
        v10 = *(a1 + 32);
      }

      os_unfair_lock_unlock(v10 + 849);
      if (v9)
      {
        v11 = 0;
      }

      else
      {
LABEL_14:
        if (BWFigVideoCaptureDeviceNotificationOutputAspectRatioRequestID_block_invoke_sHasReportedInvalidOrientation)
        {
LABEL_17:

          return;
        }

        v11 = 1;
      }

      BWFigVideoCaptureDeviceNotificationOutputAspectRatioRequestID_block_invoke_sHasReportedInvalidOrientation = v11;
      goto LABEL_17;
    }
  }
}

uint64_t __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke_2(uint64_t a1)
{
  v1 = a1 + 32;
  result = [*(*(a1 + 32) + 4408) currentOrientation];
  if ((result - 1) > 5)
  {
    v3 = 0;
  }

  else
  {
    v3 = dword_1AD056B04[(result - 1)];
  }

  if (v3 != *(*v1 + 496))
  {
    return __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke_2_cold_1();
  }

  return result;
}

- (void)_addExifMetadata:(char)metadata fromTimeMachine:
{
  if (!self)
  {
    return;
  }

  v4 = target;
  selfCopy = self;
  v6 = CMGetAttachment(target, *off_1E798A3C8, 0);
  v7 = v6;
  if ((metadata & 1) == 0)
  {
    v116 = 0;
    v117 = &v116;
    v118 = 0x2020000000;
    v119 = 0;
    if (!v6)
    {
      FigDebugAssert3();
      _Block_object_dispose(&v116, 8);
      return;
    }

    if ([objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B118), "BOOLValue"}])
    {
      v8 = [v7 objectForKeyedSubscript:*off_1E798B4E0];
      v115 = 0;
      v113 = 0;
      v114 = 0;
      v108 = 0;
      v109 = &v108;
      v110 = 0x3052000000;
      v111 = __Block_byref_object_copy__41;
      v112 = __Block_byref_object_dispose__41;
      v9 = *(selfCopy + 2920);
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __60__BWFigVideoCaptureDevice__addExifMetadata_fromTimeMachine___block_invoke;
      block[3] = &unk_1E799C340;
      block[4] = selfCopy;
      block[5] = v8;
      block[6] = &v116;
      block[7] = &v108;
      dispatch_sync(v9, block);
      [v109[5] getValue:&v114];
      if (v114 | v115 || *(v117 + 6) == 1)
      {
        v10 = *(selfCopy + 2920);
        v106[0] = MEMORY[0x1E69E9820];
        v106[1] = 3221225472;
        v106[2] = __60__BWFigVideoCaptureDevice__addExifMetadata_fromTimeMachine___block_invoke_2;
        v106[3] = &unk_1E798F870;
        v106[4] = selfCopy;
        v11 = v106;
      }

      else
      {
        v10 = *(selfCopy + 2920);
        v105[0] = MEMORY[0x1E69E9820];
        v105[1] = 3221225472;
        v105[2] = __60__BWFigVideoCaptureDevice__addExifMetadata_fromTimeMachine___block_invoke_3;
        v105[3] = &unk_1E798F870;
        v105[4] = selfCopy;
        v11 = v105;
      }

      dispatch_sync(v10, v11);
      _Block_object_dispose(&v108, 8);
    }

    else
    {
      v12 = *(selfCopy + 2920);
      v104[0] = MEMORY[0x1E69E9820];
      v104[1] = 3221225472;
      v104[2] = __60__BWFigVideoCaptureDevice__addExifMetadata_fromTimeMachine___block_invoke_4;
      v104[3] = &unk_1E798F870;
      v104[4] = selfCopy;
      dispatch_sync(v12, v104);
    }

    [v7 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", *(selfCopy + 2944)), @"ExifWhiteBalance"}];
    _Block_object_dispose(&v116, 8);
  }

  v13 = [CMGetAttachment(v4 @"BWStillImageCaptureSettings"];
  if ([*(selfCopy + 656) count] < 2)
  {
    if (!v13)
    {
      goto LABEL_58;
    }
  }

  else
  {
    v75 = v13;
    targeta = v4;
    v14 = [v7 objectForKeyedSubscript:*off_1E798B540];
    v100 = 0u;
    v101 = 0u;
    v102 = 0u;
    v103 = 0u;
    v77 = selfCopy;
    v15 = *(selfCopy + 656);
    v16 = [v15 countByEnumeratingWithState:&v100 objects:v99 count:16];
    if (v16)
    {
      v17 = v16;
      obj = 0;
      array = 0;
      v19 = *v101;
      v20 = *off_1E798A0E8;
      v81 = *v101;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v101 != v19)
          {
            objc_enumerationMutation(v15);
          }

          v22 = *(*(&v100 + 1) + 8 * i);
          portType = [v22 portType];
          if (([portType isEqualToString:v14] & 1) == 0 && (objc_msgSend(portType, "isEqualToString:", v20) & 1) == 0)
          {
            if (!array)
            {
              array = [MEMORY[0x1E695DF70] array];
            }

            array2 = obj;
            if (!obj)
            {
              array2 = [MEMORY[0x1E695DF70] array];
            }

            v25 = MEMORY[0x1E696AD98];
            [v22 focalLength];
            [array addObject:{objc_msgSend(v25, "numberWithFloat:")}];
            v26 = MEMORY[0x1E696AD98];
            [v22 lensFNumber];
            obj = array2;
            [array2 addObject:{objc_msgSend(v26, "numberWithFloat:")}];
            v19 = v81;
          }
        }

        v17 = [v15 countByEnumeratingWithState:&v100 objects:v99 count:16];
      }

      while (v17);
    }

    else
    {
      obj = 0;
      array = 0;
    }

    v4 = targeta;
    CMSetAttachment(targeta, @"ExifSlaveFocalLengths", array, 1u);
    CMSetAttachment(targeta, @"ExifSlaveLensFNumbers", obj, 1u);
    v13 = v75;
    selfCopy = v77;
    if (!v75)
    {
      goto LABEL_58;
    }

    [(BWFigVideoCaptureDevice *)v75 _addExifMetadata:array fromTimeMachine:obj];
  }

  if (![v13 deviceType])
  {
    [v13 setDeviceType:*(selfCopy + 588)];
    [v13 setDevicePosition:*(selfCopy + 616)];
    [CMGetAttachment(v4 @"TotalZoomFactor"];
    [v13 setTotalZoomFactor:?];
    [CMGetAttachment(v4 @"UIZoomFactor"];
    [v13 setUiZoomFactor:?];
    [v13 totalZoomFactor];
    if (v27 != 0.0)
    {
      targetb = v4;
      v76 = v13;
      [v13 totalZoomFactor];
      v29 = v28;
      dictionary = [MEMORY[0x1E695DF90] dictionary];
      v95 = 0u;
      v96 = 0u;
      v97 = 0u;
      v98 = 0u;
      v78 = selfCopy;
      obja = *(selfCopy + 656);
      v31 = [obja countByEnumeratingWithState:&v95 objects:v94 count:16];
      if (v31)
      {
        v32 = v31;
        v33 = *v96;
        do
        {
          for (j = 0; j != v32; ++j)
          {
            if (*v96 != v33)
            {
              objc_enumerationMutation(obja);
            }

            v35 = *(*(&v95 + 1) + 8 * j);
            [v35 exifFocalLengthMultiplier];
            if (*&v36 == 0.0)
            {
              v37 = 1.0;
            }

            else
            {
              v37 = *&v36;
            }

            *&v36 = v37;
            v38 = [MEMORY[0x1E696AD98] numberWithFloat:v36];
            v39 = MEMORY[0x1E696AD98];
            [v35 baseZoomFactor];
            [dictionary setObject:v38 forKeyedSubscript:{objc_msgSend(v39, "numberWithFloat:")}];
            v92 = 0u;
            v93 = 0u;
            v90 = 0u;
            v91 = 0u;
            nondisruptiveSwitchingZoomFactors = [v35 nondisruptiveSwitchingZoomFactors];
            v41 = [nondisruptiveSwitchingZoomFactors countByEnumeratingWithState:&v90 objects:v89 count:16];
            if (v41)
            {
              v43 = v41;
              v44 = *v91;
              do
              {
                for (k = 0; k != v43; ++k)
                {
                  if (*v91 != v44)
                  {
                    objc_enumerationMutation(nondisruptiveSwitchingZoomFactors);
                  }

                  *&v42 = v37;
                  [dictionary setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithFloat:", v42), *(*(&v90 + 1) + 8 * k)}];
                }

                v43 = [nondisruptiveSwitchingZoomFactors countByEnumeratingWithState:&v90 objects:v89 count:16];
              }

              while (v43);
            }
          }

          v32 = [obja countByEnumeratingWithState:&v95 objects:v94 count:16];
        }

        while (v32);
      }

      v87 = 0u;
      v88 = 0u;
      v85 = 0u;
      v86 = 0u;
      allKeys = [dictionary allKeys];
      v47 = [allKeys countByEnumeratingWithState:&v85 objects:v84 count:16];
      if (v47)
      {
        v57 = v47;
        v52 = 0;
        v51 = 0;
        v58 = *v86;
        do
        {
          for (m = 0; m != v57; ++m)
          {
            if (*v86 != v58)
            {
              objc_enumerationMutation(allKeys);
            }

            v60 = *(*(&v85 + 1) + 8 * m);
            [v60 floatValue];
            v62 = v61;
            if (v61 <= v29)
            {
              if (!v52 || ([v52 floatValue], v62 > v63))
              {
                v52 = v60;
              }
            }

            if (v62 > v29)
            {
              if (!v51 || ([v51 floatValue], v62 < v64))
              {
                v51 = v60;
              }
            }
          }

          v57 = [allKeys countByEnumeratingWithState:&v85 objects:v84 count:16];
        }

        while (v57);
        v50 = v52 != 0;
        v49 = v51 != 0;
        if (v52)
        {
          selfCopy = v78;
          v4 = targetb;
          v53 = v76;
          if (v51)
          {
            [v52 floatValue];
            v66 = v29 - v65;
            [v51 floatValue];
            v68 = v67;
            [v52 floatValue];
            v70 = v66 / (v68 - v69);
            [objc_msgSend(dictionary objectForKeyedSubscript:{v52), "floatValue"}];
            v72 = v71;
            [objc_msgSend(dictionary objectForKeyedSubscript:{v51), "floatValue"}];
            *&v48 = v72 + ((*&v48 - v72) * v70);
            goto LABEL_82;
          }

LABEL_50:
          if (!v50 && !v49)
          {
LABEL_87:
            *&v48 = v29;
            [*(selfCopy + 2952) removeFudgeFromZoomFactor:v48];
            if ([(BWFigVideoCaptureDevice *)selfCopy _exifFocalLengthOverrideForZoomFactor:v74]!= 0.0)
            {
              [v53 setExifFocalLengthOverride:?];
            }

            goto LABEL_58;
          }

          if (v50)
          {
            v54 = v52;
          }

          else
          {
            v54 = v51;
          }

          [objc_msgSend(dictionary objectForKeyedSubscript:{v54), "floatValue"}];
LABEL_82:
          if (*&v48 != 0.0 && *&v48 != 1.0)
          {
            [v53 setExifFocalLengthMultiplier:?];
          }

          goto LABEL_87;
        }
      }

      else
      {
        v49 = 0;
        v50 = 0;
        v51 = 0;
        v52 = 0;
      }

      selfCopy = v78;
      v4 = targetb;
      v53 = v76;
      goto LABEL_50;
    }
  }

LABEL_58:
  v55 = *(selfCopy + 632);
  if (v55)
  {
    CMSetAttachment(v4, @"CameraManufacturer", v55, 1u);
  }

  v56 = *(selfCopy + 640);
  if (v56)
  {
    CMSetAttachment(v4, @"CameraNonLocalizedName", v56, 1u);
  }
}

- (void)captureStream:(id)stream willDiscardVideoSampleBuffer:(opaqueCMSampleBuffer *)buffer
{
  if (self->_ubCaptureParametersByPortType)
  {
    v5 = CMGetAttachment(buffer, *off_1E798A3C8, 0);
    v6 = [v5 objectForKeyedSubscript:*off_1E798B710];
    if (!v6 || [v6 BOOLValue])
    {
      ubCaptureParametersByPortType = self->_ubCaptureParametersByPortType;

      [(NSDictionary *)ubCaptureParametersByPortType addMetadata:v5];
    }
  }
}

- (void)captureStream:(id)stream willEmitStillImageSampleBuffer:(opaqueCMSampleBuffer *)buffer fromTimeMachine:(BOOL)machine
{
  [(BWFigVideoCaptureDevice *)self _addCoreMediaMetadataAttachmentsToStillImageSampleBuffer:buffer fromTimeMachine:machine];
  [(BWFigVideoCaptureDevice *)self _addExifMetadata:buffer fromTimeMachine:machine];
  BYTE2(self->_digitalFlashExposureTimesForSceneMonitoringByPortType) = [*&self->_skippedFramesCountForStillImageCaptureRetry captureType] == 11;
  v8 = CMGetAttachment(buffer, *off_1E798A3C8, 0);
  if ([objc_msgSend(v8 objectForKeyedSubscript:{*off_1E798B540), "isEqualToString:", *off_1E798A0E8}])
  {
    [(BWFigVideoCaptureDevice *)self _collectPearlTemperatureStatistics:buffer];
    [(BWFigVideoCaptureDevice *)self _collectPearlProjectorUpTime:buffer isStillImage:1];
  }

  if ([objc_msgSend(v8 objectForKeyedSubscript:{*off_1E798B5E8), "BOOLValue"}] && objc_msgSend(objc_msgSend(v8, "objectForKeyedSubscript:", *off_1E798B1B0), "intValue") >= 2)
  {
    objc_exception_throw([MEMORY[0x1E695DF30] exceptionWithName:*MEMORY[0x1E695D920] reason:@"Still image capture does not support binned SIFR" userInfo:0]);
  }

  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v10 = __88__BWFigVideoCaptureDevice_captureStream_willEmitStillImageSampleBuffer_fromTimeMachine___block_invoke;
  v11 = &__block_descriptor_40_e21_v16__0____CFString__8l;
  bufferCopy = buffer;
  __88__BWFigVideoCaptureDevice_captureStream_willEmitStillImageSampleBuffer_fromTimeMachine___block_invoke(v9, *off_1E798A3C0);
  v10(v9, *off_1E798A470);
}

__CVBuffer *__88__BWFigVideoCaptureDevice_captureStream_willEmitStillImageSampleBuffer_fromTimeMachine___block_invoke(uint64_t a1, const __CFString *a2)
{
  result = CMGetAttachment(*(a1 + 32), a2, 0);
  if (result)
  {
    v3 = result;
    CMGetAttachment(result, *off_1E798A3C8, 0);
    v6 = *(MEMORY[0x1E695F050] + 16);
    if (!FigCFDictionaryGetCGRectIfPresent())
    {
      CVPixelBufferGetWidth(v3);
      CVPixelBufferGetHeight(v3);
      FigCFDictionarySetCGRect();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
      return fig_log_call_emit_and_clean_up_after_send_and_compose();
    }

    if (*&v6 > CVPixelBufferGetWidth(v3) || (result = CVPixelBufferGetHeight(v3), *(&v6 + 1) > result))
    {
      FigCFDictionarySetCGRect();
      v4 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(v4, OS_LOG_TYPE_DEFAULT);
      return fig_log_call_emit_and_clean_up_after_send_and_compose();
    }
  }

  return result;
}

- (void)captureStream:(id)stream willEmitPointCloudSampleBuffer:(opaqueCMSampleBuffer *)buffer
{
  referencedObject = [*&self->_digitalFlashLockingAE referencedObject];

  [referencedObject pointCloudCaptureDevice:self willEmitPointCloudSampleBuffer:buffer];
}

- (void)captureStream:(id)stream didCompleteStillImageCaptureWithPTS:(id *)s error:(int)error
{
  v9 = [objc_msgSend(*&self->_skippedFramesCountForStillImageCaptureRetry "captureStreamSettings")];
  os_unfair_lock_lock(&self->_numberOfCompletedStillCaptures);
  eagerSwitchingTeleToWideNonDisruptiveSwitchingDelayCounter = self->_eagerSwitchingTeleToWideNonDisruptiveSwitchingDelayCounter;
  self->_eagerSwitchingTeleToWideNonDisruptiveSwitchingDelayCounter = eagerSwitchingTeleToWideNonDisruptiveSwitchingDelayCounter + 1;
  if (s->var2)
  {
    time1 = *s;
    time2 = *&self->_prepareToCaptureStillImageNowCompletionHandler;
    if (CMTimeCompare(&time1, &time2) > 0 || (BYTE4(self->_pendingPrepareToCaptureStillImageNowCompletionHandler) & 1) == 0)
    {
      v11 = *&s->var0;
      self->_lastStillImageCaptureEndPTS.value = s->var3;
      *&self->_prepareToCaptureStillImageNowCompletionHandler = v11;
    }
  }

  v12 = *&self->_skippedFramesCountForStillImageCaptureRetry;
  if (v12)
  {
    [v12 lastTimeMachinePTS];
    if ((v30 & 0x100000000) != 0)
    {
      v13 = *&self->_skippedFramesCountForStillImageCaptureRetry;
      if (v13)
      {
        [v13 lastTimeMachinePTS];
      }

      else
      {
        memset(&time1, 0, sizeof(time1));
      }

      time2 = *&self->_prepareToCaptureStillImageNowCompletionHandler;
      if (CMTimeCompare(&time1, &time2) > 0 || (BYTE4(self->_pendingPrepareToCaptureStillImageNowCompletionHandler) & 1) == 0)
      {
        v14 = *&self->_skippedFramesCountForStillImageCaptureRetry;
        if (v14)
        {
          [v14 lastTimeMachinePTS];
        }

        else
        {
          memset(&time1, 0, sizeof(time1));
        }

        *&self->_prepareToCaptureStillImageNowCompletionHandler = time1;
      }
    }
  }

  else
  {
    v29 = 0;
    v30 = 0;
    v31 = 0;
  }

  os_unfair_lock_unlock(&self->_numberOfCompletedStillCaptures);
  if (eagerSwitchingTeleToWideNonDisruptiveSwitchingDelayCounter >= v9)
  {
    FrameworkRadarComponent = FigCaptureGetFrameworkRadarComponent();
    v28 = 0;
    v27 = OS_LOG_TYPE_DEFAULT;
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v17 = v28;
    if (os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, v27))
    {
      v18 = v17;
    }

    else
    {
      v18 = v17 & 0xFFFFFFFE;
    }

    if (v18)
    {
      LODWORD(time2.value) = 136315138;
      *(&time2.value + 4) = "[BWFigVideoCaptureDevice captureStream:didCompleteStillImageCaptureWithPTS:error:]";
      _os_log_send_and_compose_impl();
    }

    fig_log_call_emit_and_clean_up_after_send_and_compose();
    LOWORD(time1.value) = 0;
    v19 = _os_log_send_and_compose_impl();
    FigCapturePleaseFileRadar(FrameworkRadarComponent, v19, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 5448, @"LastShownDate:BWFigVideoCaptureDevice.m:5448", @"LastShownBuild:BWFigVideoCaptureDevice.m:5448", 0);
    free(v19);
  }

  else if (eagerSwitchingTeleToWideNonDisruptiveSwitchingDelayCounter + 1 != v9)
  {
    return;
  }

  v20 = [*&self->_skippedFramesCountForStillImageCaptureRetry captureStreamSettingsForPortType:{objc_msgSend(stream, "portType")}];
  if ([v20 adaptiveBracketingParameters] && (objc_msgSend(v20, "reachedEndOfAdaptiveBracketing") & 1) == 0)
  {
    v22 = [objc_msgSend(*&self->_skippedFramesCountForStillImageCaptureRetry "frameStatisticsByPortType")];
    if (!error && [(BWFigVideoCaptureDevice *)self _ubUpdateCurrentAdaptiveBracketedCaptureParamsForCaptureStreamSettings:v20 frameStatistics:v22 timeMachineFrameSelection:0])
    {
      v23 = *&self->_skippedFramesCountForStillImageCaptureRetry;
      os_unfair_lock_lock(&self->_numberOfCompletedStillCaptures);
      [(BWFigVideoCaptureDevice *)self _resetStillImageCaptureRequestStateInternal];
      os_unfair_lock_unlock(&self->_numberOfCompletedStillCaptures);
      v24 = *&self->_stillImageEnhancedResByMaintainingSensorResolutionSupported;
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __83__BWFigVideoCaptureDevice_captureStream_didCompleteStillImageCaptureWithPTS_error___block_invoke;
      block[3] = &unk_1E798F898;
      block[4] = self;
      block[5] = v23;
      dispatch_async(v24, block);
      return;
    }

    [v20 setReachedEndOfAdaptiveBracketing:1];
LABEL_32:
    [(BWFigVideoCaptureDevice *)self _resetStillImageCaptureRequestState];
    return;
  }

  os_unfair_lock_lock(&self->_switchOverLock);
  v21 = BYTE1(self->_lastStillImageCaptureEndPTS.timescale);
  LOBYTE(self->_lastStillImageCaptureEndPTS.timescale) = 0;
  os_unfair_lock_unlock(&self->_switchOverLock);
  if ((v21 & 1) == 0)
  {
    goto LABEL_32;
  }
}

void __83__BWFigVideoCaptureDevice_captureStream_didCompleteStillImageCaptureWithPTS_error___block_invoke(uint64_t a1)
{
  [BWFigVideoCaptureDevice _captureStillImageNowWithSettings:?];
  v2 = *(a1 + 40);
}

- (void)captureStreamDidChangeActiveFormatIndex:(id)index
{
  -[NSMutableDictionary setObject:forKeyedSubscript:](self->_cameraInfoByPortType, "setObject:forKeyedSubscript:", 0, [index portType]);

  [(BWFigVideoCaptureDevice *)self _ubUpdateSIFREnabled];
}

uint64_t __63__BWFigVideoCaptureDevice_captureStream_didUpdatePreviewShift___block_invoke(uint64_t a1)
{
  [BWFigVideoCaptureDevice _updateAutoFocusRectIfNeededForZoomFactor:?];
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);

  return [(BWFigVideoCaptureDevice *)v2 _updateExposureRectIfNeededForZoomFactor:v3];
}

- (void)_serviceNondisruptiveSwitchingFormatForCaptureStream:(uint64_t)stream frameStatistics:(int)statistics streamingImageIntent:(uint64_t)intent isStationary:
{
  if (self)
  {
    v55 = 0;
    v56 = &v55;
    v57 = 0x2020000000;
    v58 = 0;
    if (![a2 zoomFactorToNondisruptiveSwitchingFormatIndexSIFRBinned] && !objc_msgSend(a2, "zoomFactorToNondisruptiveSwitchingFormatIndexSIFRNonBinned"))
    {
LABEL_52:
      _Block_object_dispose(&v55, 8);
      return;
    }

    [a2 baseZoomFactorAfterGDC];
    v11 = v10;
    [*(self + 2952) requestedZoomFactor];
    if (v11 <= v12)
    {
      [*(self + 2952) requestedZoomFactor];
    }

    else
    {
      [a2 baseZoomFactorAfterGDC];
    }

    v14 = v13;
    if (*(self + 4705) == 1)
    {
      [*(self + 2952) earlySwitchOverScaleFactorForZoomIn];
      if (v15 != 1.0)
      {
        [a2 baseZoomFactorAfterGDC];
        v17 = v16;
        [*(self + 2952) requestedZoomFactor];
        v19 = v18;
        [*(self + 2952) earlySwitchOverScaleFactorForZoomIn];
        if (v17 <= (v19 / v20))
        {
          [*(self + 2952) requestedZoomFactor];
          v23 = v22;
          [*(self + 2952) earlySwitchOverScaleFactorForZoomIn];
          v14 = v23 / v24;
        }

        else
        {
          [a2 baseZoomFactorAfterGDC];
          v14 = v21;
        }

        [*(self + 2952) rampTargetZoomFactor];
        if (v14 >= v25)
        {
          [*(self + 2952) rampTargetZoomFactor];
          v14 = v26;
        }
      }
    }

    v27 = *(self + 1752);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __130__BWFigVideoCaptureDevice__serviceNondisruptiveSwitchingFormatForCaptureStream_frameStatistics_streamingImageIntent_isStationary___block_invoke;
    block[3] = &unk_1E798FAF8;
    block[4] = self;
    block[5] = &v55;
    dispatch_sync(v27, block);
    masterCaptureStream = [self masterCaptureStream];
    v29 = *(v56 + 6);
    [*(self + 2952) rampTargetZoomFactor];
    if (v30 == 0.0)
    {
      v34 = 1;
    }

    else
    {
      [*(self + 2952) rampTargetZoomFactor];
      v32 = v31;
      [*(self + 2952) appliedZoomFactor];
      v34 = v32 >= v33;
    }

    if (FigCapturePlatformIdentifier() != 9 || *(self + 1568) != 1 || masterCaptureStream == a2)
    {
      if (*(self + 2673) == 1 && v29 != 2 && (*(self + 3888) & 1) == 0 && (*(self + 1568) & 1) == 0 && ([a2 streamingRequiredWhenConfiguredAsSlave] & 1) == 0 && objc_msgSend(objc_msgSend(a2, "portType"), "isEqual:", *off_1E798A0C0))
      {
        if (!v34)
        {
          [*(self + 2952) rampTargetZoomFactor];
          if (v35 < *(self + 3008))
          {
            [a2 baseZoomFactorAfterGDC];
            v14 = v36;
            *(self + 2680) = 0;
LABEL_66:
            [a2 baseZoomFactorAfterGDC];
            if (v14 == v48)
            {
LABEL_35:
              if ([self ultraHighResolutionZeroShutterLagEnabled] && (*(self + 3452) != 1 || (v38 = objc_msgSend(self, "systemPressureLevel"), *(self + 3453) = v38 > 1, v38 <= 1)))
              {
                v39 = *(self + 3451) ^ 1;
              }

              else
              {
                v39 = 0;
              }

              os_unfair_lock_lock((self + 1384));
              v40 = *(self + 2808);
              os_unfair_lock_unlock((self + 1384));
              v41 = [BWFigVideoCaptureDevice _depthDataDeliveryOrStereoPhotoCaptureUseSecondaryStream:self primaryStream:?];
              if (*(self + 2183) == 1)
              {
                v43 = *(self + 1545) | v41;
              }

              else
              {
                v43 = 0;
              }

              if (*(self + 1595) == 1)
              {
                v43 &= [a2 streamingRequiredWhenConfiguredAsSlave];
              }

              if (*(self + 4348) == 1)
              {
                v44 = v39 | v43 ^ 1;
              }

              else
              {
                v44 = 0;
              }

              if (statistics == 1)
              {
                v45 = 1;
              }

              else
              {
                v45 = 2 * (statistics == 2);
              }

              LOBYTE(v53) = v39 & 1;
              *&v42 = v14;
              [a2 serviceNondisruptiveSwitchingFormatForZoomFactor:stream frameStatistics:*(v56 + 6) imageControlMode:v45 stillImageDigitalFlashMode:intent isStationary:v44 & 1 binnedSIFROnSecondaryStreamAllowed:v40 ignoreZoomFactorAndQuadraSubPixelSceneMonitoring:v42 ultraHighResolutionZeroShutterLagEnabled:v53];
              goto LABEL_52;
            }

            [*(self + 2952) predictRampZoomFactorAfterNumberOfFrames:4 settingZoomFactorOfInterest:0.0];
            v50 = v49;
            if (v49 != 0.0)
            {
              [a2 baseZoomFactorAfterGDC];
              if (v51 <= v50)
              {
                v14 = v50;
              }

              else
              {
                [a2 baseZoomFactorAfterGDC];
                v14 = v52;
              }
            }

LABEL_34:
            *(self + 2680) = 0;
            goto LABEL_35;
          }
        }

        if (*(self + 672))
        {
          if (![objc_msgSend(masterCaptureStream "portType")])
          {
            if (v34)
            {
              goto LABEL_34;
            }

            if (*(self + 2680))
            {
              [a2 baseZoomFactorAfterGDC];
              v14 = v47;
              --*(self + 2680);
            }

            goto LABEL_66;
          }

          [a2 baseZoomFactorAfterGDC];
          v14 = v46;
          *(self + 2680) = *(self + 2676);
        }

LABEL_33:
        if (v34)
        {
          goto LABEL_34;
        }

        goto LABEL_66;
      }

      if (![objc_msgSend(a2 "portType")] || !objc_msgSend(self, "isBravoVariant"))
      {
        goto LABEL_33;
      }

      if (masterCaptureStream == a2)
      {
        if ((*(self + 3888) & 1) == 0)
        {
          if ([*(self + 1528) isRamping])
          {
            goto LABEL_32;
          }

          if ((*(self + 3888) & 1) == 0)
          {
            goto LABEL_33;
          }
        }

        if (*(self + 3944))
        {
          goto LABEL_33;
        }
      }
    }

LABEL_32:
    [a2 baseZoomFactorAfterGDC];
    v14 = v37;
    goto LABEL_33;
  }
}

- (uint64_t)_updateSensorRawPools
{
  if (!self)
  {
    return 0;
  }

  selfCopy = self;
  array = [MEMORY[0x1E695DF70] array];
  v110 = 0;
  v109 = 0;
  if (*(selfCopy + 156) != 1)
  {
    return 0;
  }

  [BWFigVideoCaptureDevice _sensorRawPoolsRequirements];
  v3 = v2;
  if (![v2 count] || objc_msgSend(v3, "count") > 3)
  {
    return 0;
  }

  os_unfair_lock_lock((selfCopy + 144));
  if (!*(selfCopy + 160))
  {
    *(selfCopy + 160) = objc_alloc_init(MEMORY[0x1E695DF90]);
  }

  v107 = 0u;
  v108 = 0u;
  v105 = 0u;
  v106 = 0u;
  v4 = 0x1E696A000;
  v72 = [v3 countByEnumeratingWithState:&v105 objects:v104 count:16];
  v74 = selfCopy;
  if (!v72)
  {
    goto LABEL_49;
  }

  v5 = 0;
  v70 = *v106;
  v68 = *MEMORY[0x1E6966208];
  v6 = *MEMORY[0x1E69660B8];
  v67 = *MEMORY[0x1E6966160];
  v65 = *MEMORY[0x1E6966020];
  v64 = *MEMORY[0x1E6966140];
  v66 = selfCopy + 168;
  v63 = *MEMORY[0x1E6966130];
  while (2)
  {
    for (i = 0; i != v72; ++i)
    {
      if (*v106 != v70)
      {
        objc_enumerationMutation(v3);
      }

      v8 = *(*(&v105 + 1) + 8 * i);
      v9 = FigCaptureSourceSensorRawHighResolutionFlavorFromDimensions([objc_msgSend(v8 objectForKeyedSubscript:{v68), "intValue"}] | (objc_msgSend(objc_msgSend(v8, "objectForKeyedSubscript:", v6), "intValue") << 32));
      v10 = [objc_msgSend(v8 objectForKeyedSubscript:{v68), "intValue"}];
      v11 = [objc_msgSend(v8 objectForKeyedSubscript:{v6), "intValue"}];
      if (v10 < 1 || v11 < 1)
      {
LABEL_45:
        v36 = 0;
        goto LABEL_68;
      }

      v13 = v11;
      v14 = v10;
      if (v9 == 2 && *(selfCopy + 148) != (v10 | (v11 << 32)))
      {
        v56 = MEMORY[0x1E695DF30];
        v57 = *MEMORY[0x1E695D930];
        v58 = MEMORY[0x1E696AEC0];
        v59 = BWStringFromDimensions();
        v60 = [v56 exceptionWithName:v57 reason:objc_msgSend(v58 userInfo:{"stringWithFormat:", @"Ultra high resolution sensor raw pool dimensions don't match expected %@ received %@", v59, BWStringFromDimensions()), 0}];
        objc_exception_throw(v60);
      }

      *(&v109 + v9) = [objc_msgSend(v8 objectForKeyedSubscript:{v67), "intValue"}];
      if ([*(selfCopy + 160) objectForKeyedSubscript:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v9)}])
      {
        v15 = [*(selfCopy + 160) objectForKeyedSubscript:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v9)}];
        if ([v15 width] != v14)
        {
          goto LABEL_45;
        }

        v4 = 0x1E696A000uLL;
        if ([v15 height] != v13)
        {
          goto LABEL_45;
        }
      }

      else
      {
        v16 = objc_alloc_init(BWVideoFormatRequirements);
        [(BWVideoFormatRequirements *)v16 setWidth:v10];
        [(BWVideoFormatRequirements *)v16 setHeight:v13];
        -[BWVideoFormatRequirements setBytesPerRowAlignment:](v16, "setBytesPerRowAlignment:", [objc_msgSend(v8 objectForKeyedSubscript:{v65), "intValue"}]);
        -[BWVideoFormatRequirements setPlaneAlignment:](v16, "setPlaneAlignment:", [objc_msgSend(v8 objectForKeyedSubscript:{v64), "intValue"}]);
        [(BWVideoFormatRequirements *)v16 setHeightAlignment:16];
        v103 = [v8 objectForKeyedSubscript:v63];
        -[BWVideoFormatRequirements setSupportedPixelFormats:](v16, "setSupportedPixelFormats:", [MEMORY[0x1E695DEC8] arrayWithObjects:&v103 count:1]);
        [(BWVideoFormatRequirements *)v16 setSupportedCacheModes:+[BWVideoFormatRequirements cacheModesForOptimizedDisplayAccess]];
        if (!-[NSArray count](-[BWVideoFormatRequirements supportedPixelFormats](v16, "supportedPixelFormats"), "count") || (v102 = v16, (v17 = +[BWVideoFormat formatByResolvingRequirements:](BWVideoFormat, "formatByResolvingRequirements:", [MEMORY[0x1E695DEC8] arrayWithObjects:&v102 count:1])) == 0))
        {
          v36 = 0;
          selfCopy = v74;
          goto LABEL_68;
        }

        v18 = v17;
        v19 = (*(&v109 + v9) + *(v66 + 4 * v9));
        if (dword_1ED844350)
        {
          v101 = 0;
          type = OS_LOG_TYPE_DEFAULT;
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v21 = v101;
          if (os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, type))
          {
            v22 = v21;
          }

          else
          {
            v22 = v21 & 0xFFFFFFFE;
          }

          if (v22)
          {
            v23 = FigCaptureSourceSensorRawHighResolutionFlavorToShortString(v9);
            v24 = *(v66 + 4 * v9);
            v25 = *(&v109 + v9);
            v76 = 136316162;
            v77 = "[BWFigVideoCaptureDevice _updateSensorRawPools]";
            v78 = 2112;
            v79 = v23;
            v80 = 1024;
            *v81 = v19;
            *&v81[4] = 1024;
            *&v81[6] = v24;
            LOWORD(v82) = 1024;
            *(&v82 + 2) = v25;
            _os_log_send_and_compose_impl();
          }

          fig_log_call_emit_and_clean_up_after_send_and_compose();
        }

        v26 = [BWPixelBufferPool alloc];
        v27 = -[BWPixelBufferPool initWithVideoFormat:capacity:name:memoryPool:](v26, "initWithVideoFormat:capacity:name:memoryPool:", v18, v19, [MEMORY[0x1E696AEC0] stringWithFormat:@"%@_SensorRawBufferPool_%u", BWStringFromCaptureDeviceType(*(v74 + 588)), v9], *(v74 + 3880));
        if (!v27)
        {
          [BWFigVideoCaptureDevice _updateSensorRawPools];
          v36 = 0;
          selfCopy = v74;
          goto LABEL_68;
        }

        v28 = v27;
        [(BWPixelBufferPool *)v27 preallocate];
        v4 = 0x1E696A000uLL;
        [*(v74 + 160) setObject:v28 forKeyedSubscript:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v9)}];
        v5 = 1;
        selfCopy = v74;
      }

      v99[0] = MEMORY[0x1E69E9820];
      v99[1] = 3221225472;
      v99[2] = __48__BWFigVideoCaptureDevice__updateSensorRawPools__block_invoke;
      v99[3] = &unk_1E799C070;
      v99[4] = selfCopy;
      v99[5] = &v109;
      [array insertObject:objc_msgSend(MEMORY[0x1E696AD98] atIndex:{"numberWithInt:", v9), objc_msgSend(array, "indexOfObject:inSortedRange:options:usingComparator:", objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v9), 0, objc_msgSend(array, "count"), 1024, v99)}];
    }

    v72 = [v3 countByEnumeratingWithState:&v105 objects:v104 count:16];
    if (v72)
    {
      continue;
    }

    break;
  }

  if ((v5 & 1) == 0)
  {
    goto LABEL_49;
  }

  array2 = [MEMORY[0x1E695DF70] array];
  v95 = 0u;
  v96 = 0u;
  v97 = 0u;
  v98 = 0u;
  v30 = [array countByEnumeratingWithState:&v95 objects:v94 count:16];
  if (v30)
  {
    v31 = v30;
    v32 = *v96;
    do
    {
      for (j = 0; j != v31; ++j)
      {
        if (*v96 != v32)
        {
          objc_enumerationMutation(array);
        }

        [array2 addObject:{objc_msgSend(objc_msgSend(*(selfCopy + 160), "objectForKeyedSubscript:", *(*(&v95 + 1) + 8 * j)), "cvPixelBufferPool")}];
      }

      v31 = [array countByEnumeratingWithState:&v95 objects:v94 count:16];
    }

    while (v31);
  }

  if ([selfCopy isBravoVariant])
  {
    syncGroup = [*(selfCopy + 648) syncGroup];
    v35 = off_1E798CCE8;
  }

  else
  {
    syncGroup = [*(selfCopy + 600) stream];
    v35 = off_1E798C138;
  }

  v37 = [syncGroup setProperty:*v35 value:array2];
  if (v37)
  {
    v36 = v37;
    [BWFigVideoCaptureDevice _updateSensorRawPools];
  }

  else
  {
LABEL_49:
    v71 = [MEMORY[0x1E695DF90] dictionaryWithCapacity:{objc_msgSend(array, "count")}];
    v90 = 0u;
    v91 = 0u;
    v92 = 0u;
    v93 = 0u;
    v73 = [array countByEnumeratingWithState:&v90 objects:v89 count:16];
    if (v73)
    {
      v69 = *v91;
      v38 = selfCopy + 168;
      do
      {
        for (k = 0; k != v73; ++k)
        {
          if (*v91 != v69)
          {
            objc_enumerationMutation(array);
          }

          intValue = [*(*(&v90 + 1) + 8 * k) intValue];
          v41 = [*(selfCopy + 160) objectForKeyedSubscript:{objc_msgSend(*(v4 + 3480), "numberWithInt:", intValue)}];
          v42 = intValue;
          v43 = (*(&v109 + intValue) + *(v38 + 4 * intValue));
          if (dword_1ED844350)
          {
            v101 = 0;
            type = OS_LOG_TYPE_DEFAULT;
            v44 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
            v45 = v101;
            if (os_log_type_enabled(v44, type))
            {
              v46 = v45;
            }

            else
            {
              v46 = v45 & 0xFFFFFFFE;
            }

            if (v46)
            {
              v47 = FigCaptureSourceDeviceTypeToShortString(*(v74 + 588), *(v74 + 616));
              v48 = FigCaptureSourceSensorRawHighResolutionFlavorToShortString(v42);
              capacity = [v41 capacity];
              v50 = *(v38 + 4 * v42);
              v51 = *(&v109 + v42);
              v76 = 136316674;
              v77 = "[BWFigVideoCaptureDevice _updateSensorRawPools]";
              v78 = 2112;
              v79 = v47;
              v80 = 2112;
              *v81 = v48;
              *&v81[8] = 2048;
              v82 = capacity;
              v83 = 1024;
              v84 = v43;
              v85 = 1024;
              v86 = v50;
              v87 = 1024;
              v88 = v51;
              LODWORD(v62) = 60;
              v61 = &v76;
              _os_log_send_and_compose_impl();
            }

            fig_log_call_emit_and_clean_up_after_send_and_compose();
            selfCopy = v74;
          }

          [v41 flushToMinimumCapacity:{v43, v61, v62}];
          [v41 setCapacity:v43];
          v4 = 0x1E696A000uLL;
          v52 = [MEMORY[0x1E696AD98] numberWithUnsignedInt:*(v38 + 4 * v42)];
          [v71 setObject:v52 forKeyedSubscript:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithUnsignedLong:", objc_msgSend(v41, "cvPixelBufferPool"))}];
        }

        v73 = [array countByEnumeratingWithState:&v90 objects:v89 count:16];
      }

      while (v73);
    }

    if ([selfCopy isBravoVariant])
    {
      syncGroup2 = [*(selfCopy + 648) syncGroup];
      v54 = off_1E798CCF8;
    }

    else
    {
      syncGroup2 = [*(selfCopy + 600) stream];
      v54 = off_1E798C148;
    }

    v36 = [syncGroup2 setProperty:*v54 value:v71];
    if (v36)
    {
      [BWFigVideoCaptureDevice _updateSensorRawPools];
    }
  }

LABEL_68:
  os_unfair_lock_unlock((selfCopy + 144));
  return v36;
}

void __52__BWFigVideoCaptureDevice__deviceWillStartStreaming__block_invoke_371(uint64_t a1)
{
  [*(*(a1 + 32) + 4408) start];
  v2 = *(*(a1 + 32) + 4400);
  if (v2)
  {
  }

  *(*(a1 + 32) + 4400) = objc_alloc_init(BWDeviceThermalMonitor);
  objc_initWeak(&location, *(a1 + 32));
  v3 = *(*(a1 + 32) + 4400);
  v4 = MEMORY[0x1E69E9820];
  v5 = 3221225472;
  v6 = __52__BWFigVideoCaptureDevice__deviceWillStartStreaming__block_invoke_2;
  v7 = &unk_1E7991F70;
  objc_copyWeak(&v8, &location);
  [v3 setThermalHandler:&v4];
  if ([*(*(a1 + 32) + 4400) thermalLevel] >= 2)
  {
    *(*(a1 + 32) + 4392) = *(a1 + 40);
  }

  objc_destroyWeak(&v8);
  objc_destroyWeak(&location);
}

uint64_t __52__BWFigVideoCaptureDevice__deviceWillStartStreaming__block_invoke_2(uint64_t a1, void *a2)
{
  result = objc_loadWeak((a1 + 32));
  if (result)
  {
    if (a2)
    {
      v4 = result;
      if (!*(result + 4392))
      {
        result = [a2 thermalLevel];
        if (result >= 2)
        {
          result = mach_absolute_time();
          *(v4 + 4392) = result;
        }
      }
    }
  }

  return result;
}

void __50__BWFigVideoCaptureDevice__deviceDidStopStreaming__block_invoke_3(uint64_t a1)
{
  *(*(a1 + 32) + 2768) = 0;

  *(*(a1 + 32) + 2776) = 0;
}

uint64_t __48__BWFigVideoCaptureDevice__updateSensorRawPools__block_invoke(uint64_t a1, void *a2, void *a3)
{
  v6 = [*(*(a1 + 32) + 160) objectForKeyedSubscript:a2];
  v7 = [*(*(a1 + 32) + 160) objectForKeyedSubscript:a3];
  v8 = *(a1 + 32);
  LODWORD(v8) = *(v8 + 4 * [a2 intValue] + 168);
  v9 = *(a1 + 40);
  v10 = (*(v9 + 4 * [a2 intValue]) + v8);
  v11 = *(a1 + 32);
  LODWORD(v11) = *(v11 + 4 * [a3 intValue] + 168);
  v12 = *(a1 + 40);
  v13 = *(v12 + 4 * [a3 intValue]) + v11;
  if ([v6 capacity] > v10 && objc_msgSend(v7, "capacity") <= v13)
  {
    return -1;
  }

  if ([v6 capacity] <= v10 && objc_msgSend(v7, "capacity") > v13)
  {
    return 1;
  }

  v15 = [v6 width];
  v16 = [v6 height] * v15;
  v17 = [v7 width];
  if (v16 > [v7 height] * v17)
  {
    return -1;
  }

  else
  {
    return 1;
  }
}

- (BOOL)isPortTypeUsingZoomBasedSourceSensorRaws:(id)raws
{
  if (self->_multipleSensorRawBufferPoolsEnabled && [(NSArray *)self->_activePortTypes containsObject:?])
  {
    os_unfair_lock_lock(&self->_sensorRawPoolLock);
    if ([(NSMutableDictionary *)self->_sensorRawPools objectForKeyedSubscript:&unk_1F22469F0])
    {
      if ([raws isEqualToString:*off_1E798A0D0])
      {
        isBravoVariant = 1;
LABEL_10:
        os_unfair_lock_unlock(&self->_sensorRawPoolLock);
        return isBravoVariant;
      }

      if ([raws isEqualToString:*off_1E798A0D8])
      {
        isBravoVariant = [(BWFigVideoCaptureDevice *)self isBravoVariant];
        goto LABEL_10;
      }
    }

    isBravoVariant = 0;
    goto LABEL_10;
  }

  return 0;
}

- (int)sensorRawHighResolutionFlavorForDimensions:(id)dimensions
{
  if (!self->_multipleSensorRawBufferPoolsEnabled && !self->_sensorRawPoolEnabled)
  {
    return 0;
  }

  os_unfair_lock_lock(&self->_sensorRawPoolLock);
  v16 = 0u;
  v17 = 0u;
  v14 = 0u;
  v15 = 0u;
  sensorRawPools = self->_sensorRawPools;
  v6 = [(NSMutableDictionary *)sensorRawPools countByEnumeratingWithState:&v14 objects:v13 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v15;
    while (2)
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(sensorRawPools);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        if ([-[NSMutableDictionary objectForKeyedSubscript:](self->_sensorRawPools objectForKeyedSubscript:{v10), "dimensions"}] == dimensions)
        {
          intValue = [v10 intValue];
          goto LABEL_13;
        }
      }

      v7 = [(NSMutableDictionary *)sensorRawPools countByEnumeratingWithState:&v14 objects:v13 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

  intValue = 0;
LABEL_13:
  os_unfair_lock_unlock(&self->_sensorRawPoolLock);
  return intValue;
}

- ($2825F4736939C4A6D3AD43837233062D)sensorRawPoolDimensions
{
  sensorRawPoolRequirements = [(BWFigVideoCaptureDevice *)self sensorRawPoolRequirements];
  v3 = [-[NSDictionary objectForKeyedSubscript:](sensorRawPoolRequirements objectForKeyedSubscript:{*MEMORY[0x1E6966208]), "intValue"}];
  return (v3 | ([-[NSDictionary objectForKeyedSubscript:](sensorRawPoolRequirements objectForKeyedSubscript:{*MEMORY[0x1E69660B8]), "intValue"}] << 32));
}

uint64_t __63__BWFigVideoCaptureDevice__servicePropertyChangeNotifications___block_invoke()
{
  result = FigGetCFPreferenceNumberWithDefault();
  _MergedGlobals_12 = result != 0;
  return result;
}

- (float)masterCaptureStreamLastFrameEIT
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  [objc_msgSend(*&self->_numAPSStatisticsSamples objectForKeyedSubscript:{-[BWFigVideoCaptureStream portType](-[BWFigVideoCaptureDevice masterCaptureStream](self, "masterCaptureStream"), "portType")), "eit"}];
  v4 = v3;
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  return v4;
}

- (void)setStillImageCaptureEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  captureStreams = self->_captureStreams;
  v6 = [(NSArray *)captureStreams countByEnumeratingWithState:&v11 objects:v10 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v12;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v12 != v8)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v11 + 1) + 8 * i) setStillImageCaptureEnabled:enabledCopy];
      }

      v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v11 objects:v10 count:16];
    }

    while (v7);
  }

  if (!enabledCopy)
  {
    [(BWFigVideoCaptureDevice *)self setUnifiedBracketingMode:0];
  }

  LOBYTE(self->_hdrModeForSceneMonitoring) = enabledCopy;
}

- (int)maxStillImageCaptureBufferCountForHDRMode:(int)mode digitalFlashMode:(int)flashMode qualityPrioritization:(int)prioritization clientBracketCount:(int)count bravoConstituentImageDeliveryDeviceTypes:(id)types
{
  modeCopy = mode;
  if (BYTE2(self->_stillImageContrastBasedAutofocusTimeout))
  {
    countCopy = 2;
  }

  else
  {
    countCopy = 1;
  }

  if (countCopy <= count)
  {
    countCopy = count;
  }

  if (countCopy <= 3)
  {
    v13 = 3;
  }

  else
  {
    v13 = countCopy;
  }

  if (mode)
  {
    v14 = v13;
  }

  else
  {
    v14 = countCopy;
  }

  if (prioritization >= 2)
  {
    if (!self->_stillImagePhaseDetectionAutofocusTimeout)
    {
      if (v14 <= 4)
      {
        v14 = 4;
      }

      if (flashMode)
      {
        goto LABEL_31;
      }

LABEL_45:
      v25 = 0;
      goto LABEL_46;
    }

    if ((BYTE4(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) & 0x10) != 0)
    {
      v15 = 2;
    }

    else
    {
      v15 = 4;
    }

    if (v15 <= v14)
    {
      v15 = v14;
    }

    if (v15 <= 5)
    {
      v16 = 5;
    }

    else
    {
      v16 = v15;
    }

    if (((prioritization != 2) & self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) != 0)
    {
      v15 = v16;
    }

    if (v15 <= 4)
    {
      v17 = 4;
    }

    else
    {
      v17 = v15;
    }

    if (((prioritization != 2) & BYTE3(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType)) != 0)
    {
      v14 = v17;
    }

    else
    {
      v14 = v15;
    }
  }

  if (!flashMode)
  {
    goto LABEL_45;
  }

LABEL_31:
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  v18 = *&self->_ubHDRWithBiasEnabled;
  v19 = [v18 countByEnumeratingWithState:&v36 objects:v35 count:16];
  if (v19)
  {
    v20 = v19;
    typesCopy = types;
    v34 = modeCopy;
    maxNumberOfFramesForAdaptiveBracketing = 0;
    v22 = *v37;
    do
    {
      for (i = 0; i != v20; ++i)
      {
        if (*v37 != v22)
        {
          objc_enumerationMutation(v18);
        }

        v24 = [*&self->_ubHDRWithBiasEnabled objectForKeyedSubscript:{*(*(&v36 + 1) + 8 * i), typesCopy}];
        if (maxNumberOfFramesForAdaptiveBracketing <= [v24 maxNumberOfFramesForAdaptiveBracketing])
        {
          maxNumberOfFramesForAdaptiveBracketing = [v24 maxNumberOfFramesForAdaptiveBracketing];
        }
      }

      v20 = [v18 countByEnumeratingWithState:&v36 objects:v35 count:16];
    }

    while (v20);
    v25 = maxNumberOfFramesForAdaptiveBracketing + 1;
    modeCopy = v34;
    types = typesCopy;
  }

  else
  {
    v25 = 1;
  }

LABEL_46:
  if (self->_bravoConstituentPhotoDeliveryEnabled && [types count] >= 1)
  {
    v26 = [types count];
  }

  else
  {
    v26 = 1;
  }

  if (self->_stereoFusionEnabled || self->_bravoConstituentPhotoDeliveryEnabled || self->_depthDataDeliveryEnabled)
  {
    if (v26 <= 2)
    {
      v26 = 2;
    }
  }

  else
  {
    if (v26 <= 2)
    {
      v32 = 2;
    }

    else
    {
      v32 = v26;
    }

    if (self->_stereoPhotoCaptureEnabled)
    {
      v26 = v32;
    }
  }

  if (prioritization <= 1 && count <= 0 && modeCopy == 0)
  {
    v29 = v14;
  }

  else
  {
    v29 = v14 + 1;
  }

  v30 = v26 * v29;
  if (v30 <= v25)
  {
    return v25;
  }

  else
  {
    return v30;
  }
}

- (id)stillImageCaptureSettingsWithSettings:(id)settings speedOverQualityCaptureEnabled:(BOOL)enabled
{
  [self->_lastStillImageCaptureEndPTS.epoch forceUpdateRearLuxLevel];
  if (self->_qualityPrioritizationForSceneMonitoring < 3)
  {
    v7 = [(BWFigVideoCaptureDevice *)self _stillImageCaptureSettingsWithSettings:settings];
  }

  else
  {
    v7 = [(BWFigVideoCaptureDevice *)self _ubStillImageCaptureSettingsWithSettings:settings speedOverQualityCaptureEnabled:enabled];
  }

  v8 = v7;
  [(BWStillImageCaptureSettings *)v7 setApplicationID:self->_applicationID];
  portType = [(BWFigVideoCaptureStream *)self->_currentMasterCaptureStream portType];
  if (!portType)
  {
    portType = [(BWFigVideoCaptureStream *)self->_captureStream portType];
  }

  [(BWStillImageCaptureSettings *)v8 setMasterPortType:portType];
  [settings scaleFactor];
  [(BWStillImageCaptureSettings *)v8 setScaleFactor:?];
  [-[BWStillImageCaptureSettings metadata](v8 "metadata")];
  synchronizedStreamsGroup = self->_synchronizedStreamsGroup;
  if (synchronizedStreamsGroup)
  {
    currentMasterCaptureStream = [(BWFigVideoCaptureSynchronizedStreamsGroup *)synchronizedStreamsGroup cameraControlsStatisticsMasterStream];
    if (!currentMasterCaptureStream)
    {
      currentMasterCaptureStream = self->_currentMasterCaptureStream;
    }
  }

  else
  {
    currentMasterCaptureStream = self->_captureStream;
  }

  [-[BWStillImageCaptureSettings metadata](v8 "metadata")];
  [-[BWStillImageCaptureSettings metadata](v8 "metadata")];
  [self->_lastStillImageCaptureEndPTS.epoch rearLuxLevel];
  v13 = v12;
  metadata = [(BWStillImageCaptureSettings *)v8 metadata];
  LODWORD(v15) = v13;
  [metadata setAlsRearLuxLevel:v15];
  return v8;
}

- (uint64_t)_resolveStillImageCaptureTypeFromStatisticsByPortType:(void *)type masterCaptureStream:(int)stream flashMode:(int)mode hdrMode:(int)hdrMode qualityPrioritization:(int)prioritization stereoFusionMode:(int)fusionMode depthDataDeliveryEnabled:(void *)enabled bravoConstituentImageDeliveryDeviceTypes:(char)self0 burstQualityCaptureEnabled:(int)self1 clientBracketMode:(char)self2 forSceneMonitoring:(uint64_t *)self3 captureFlags:
{
  if (!self)
  {
    return 0;
  }

  v89 = stream == 2;
  v90 = *(self + 2172);
  v92 = hdrMode > 1;
  v93 = *(self + 2173);
  v88 = [a2 objectForKeyedSubscript:{objc_msgSend(*(self + 600), "portType")}];
  v95 = a2;
  if (([v88 motionDataStatus] & 8) != 0)
  {
    hasSphere = 0;
  }

  else
  {
    hasSphere = [*(self + 600) hasSphere];
  }

  fusionModeCopy = fusionMode;
  isBravoVariant = [self isBravoVariant];
  v96 = *(self + 672);
  v20 = v96 == type;
  if ([enabled count])
  {
    typeCopy = type;
    prioritizationCopy = prioritization;
    v23 = [MEMORY[0x1E695DFD8] setWithObjects:{&unk_1F22469C0, &unk_1F2246AC8, 0}];
    v24 = [MEMORY[0x1E695DFD8] setWithObjects:{&unk_1F2246AE0, &unk_1F22469C0, 0}];
    v25 = [MEMORY[0x1E695DFD8] setWithArray:enabled];
    if ([v25 isEqual:v23])
    {
      v20 = 2;
    }

    else if ([v25 isEqual:v24])
    {
      v20 = 4;
    }

    prioritization = prioritizationCopy;
    type = typeCopy;
  }

  if (stream && *(self + 2172))
  {
    v26 = v20;
    if (*(self + 616) == 2)
    {
      v27 = 0;
    }

    else
    {
      FigSimpleMutexLock();
      v27 = *(self + 2628) <= 0.0;
      FigSimpleMutexUnlock();
    }

    if (types)
    {
      v28 = 0x4000;
    }

    else
    {
      v28 = 0;
    }

    if (stream == 1 && !v27)
    {
      v29 = 2;
      goto LABEL_30;
    }
  }

  else
  {
    v26 = v20;
    if (types)
    {
      v28 = 0x4000;
    }

    else
    {
      v28 = 0;
    }

    LOBYTE(v27) = *(self + 2172) ^ 1;
  }

  if (mode == 1)
  {
    v29 = 3;
LABEL_30:
    v30 = isBravoVariant;
    goto LABEL_31;
  }

  if (captureEnabled)
  {
    v29 = 7;
    goto LABEL_30;
  }

  prioritizationCopy2 = prioritization;
  if ((*(self + 76) & 1) != 0 || [v95 frameCount] >= 4)
  {
    v31 = [*(self + 2512) objectForKeyedSubscript:{objc_msgSend(type, "portType")}];
    v32 = [v95 objectForKeyedSubscript:{objc_msgSend(type, "portType")}];
    if (v31)
    {
      v33 = v32;
      v34 = v28;
    }

    else
    {
      v34 = v28;
      v31 = [*(self + 2512) objectForKeyedSubscript:{objc_msgSend(*(self + 600), "portType")}];
      v33 = v88;
    }

    v51 = v89 & v90;
    [v31 floatValue];
    v53 = v52;
    if (hdrMode >= 2)
    {
      v55 = [(BWFigVideoCaptureDevice *)self _isLowLightSceneUsingFrameStatisticsByPortType:v95];
      if (v27 & 1 | ((v55 & v51 & 1) == 0))
      {
        modeCopy3 = mode;
        v57 = 0;
        v28 = v34;
        enabledCopy3 = enabled;
        v61 = v92;
      }

      else
      {
        v77 = v55;
        v28 = v34;
        modeCopy3 = mode;
        if (hasSphere)
        {
          fvcd_estimateOISOutputImageSNR(v33);
        }

        else
        {
          [v33 normalizedSNR];
          v78 = v83 + 4.7712;
        }

        enabledCopy3 = enabled;
        v57 = v78 < v53;
        v61 = v92;
        LOBYTE(v55) = v77;
      }

      v56 = (v55 && !v57) & hasSphere;
      v60 = v93;
    }

    else
    {
      modeCopy3 = mode;
      if (v27 & 1 | ((v51 & 1) == 0))
      {
        LOBYTE(v55) = 0;
        v56 = 0;
        v57 = 0;
      }

      else
      {
        [v33 normalizedSNR];
        LOBYTE(v55) = 0;
        v56 = 0;
        v57 = v58 < v53;
      }

      v28 = v34;
      enabledCopy3 = enabled;
      v61 = v92;
      v60 = v93;
    }

    v62 = v61 & v60;
    if (modeCopy3 == 2)
    {
      v71 = v55;
      [BWFigVideoCaptureDevice _resolveStillImageCaptureTypeFromStatisticsByPortType:self masterCaptureStream:&v100 flashMode:? hdrMode:? qualityPrioritization:? stereoFusionMode:? depthDataDeliveryEnabled:? bravoConstituentImageDeliveryDeviceTypes:? burstQualityCaptureEnabled:? clientBracketMode:? forSceneMonitoring:? captureFlags:?];
      LOBYTE(v55) = v71;
      v63 = v100;
      if (v62)
      {
LABEL_76:
        v64 = v55;
        v65 = [enabledCopy3 count];
        v66 = 0;
        if (v65)
        {
          v30 = isBravoVariant;
        }

        else
        {
          v30 = isBravoVariant;
          LOBYTE(v55) = v64;
          if (v96 == type)
          {
LABEL_88:
            v72 = v57 | v63 | v66;
            if (v63)
            {
              v73 = 3;
            }

            else
            {
              v73 = 6;
            }

            if (v57)
            {
              v73 = 2;
            }

            if (v55)
            {
              v74 = 4;
            }

            else
            {
              v74 = 1;
            }

            if (v56)
            {
              v74 = 5;
            }

            if (v72)
            {
              v29 = v73;
            }

            else
            {
              v29 = v74;
            }

            if (v55)
            {
              LODWORD(v75) = 4;
            }

            else
            {
              LODWORD(v75) = v29;
            }

            if (v56)
            {
              v75 = 5;
            }

            else
            {
              v75 = v75;
            }

            if (v96 == type)
            {
              v76 = v30;
            }

            else
            {
              v76 = 0;
            }

            if (v76 & v63)
            {
              v29 = v75;
            }

            prioritization = prioritizationCopy2;
LABEL_31:
            if (fusionModeCopy && (*(self + 1593) != 1 || [self shallowDepthOfFieldEffectStatus] == 1))
            {
              if (*(self + 672))
              {
                v26 = 2;
              }

              else if (*(self + 1560))
              {
                v26 = 3;
              }

              v35 = 2048;
              if ((v30 & (v29 == 3)) != 0)
              {
                v35 = 133120;
              }

              v28 |= v35;
            }

            if (!v30 || !prioritization || (*(self + 1508) & 1) == 0)
            {
              goto LABEL_119;
            }

            v36 = [*(self + 1416) telephotoLimitsReachedForFrameStatisticsByPortType:v95] ^ 1;
            if (v96 != type)
            {
              [self zoomFactor];
              v38 = v37;
              [*(self + 672) baseZoomFactor];
              v36 = (v38 < v39) & v36;
            }

            if ((v29 - 1) > 4)
            {
              goto LABEL_119;
            }

            v40 = prioritization == 2 ? v36 : 0;
            if (prioritization != 1 && !v40)
            {
              goto LABEL_119;
            }

            [self zoomFactor];
            v43 = v42;
            if (v96 == type)
            {
              [*(self + 672) baseZoomFactor];
              if (v43 < v44)
              {
                [*(self + 672) baseZoomFactor];
                v43 = v45;
              }
            }

            v46 = *(self + 1468);
            if ((v29 - 1) > 2)
            {
              v79 = [BWFigVideoCaptureDevice _bravoCameraForOISOrSISCaptureType:self stereoFusionMode:v43 frameStatisticsByPortType:*(self + 1468) zoomFactor:*(self + 1472) stereoFusionLowerBoundZoomFactor:v41 stereoFusionUpperBoundZoomFactor:prioritization];
              if (v79 == 2)
              {
LABEL_67:
                v26 = 2;
                v50 = 1024;
LABEL_118:
                v28 |= v50;
LABEL_119:
                if (v26 == 1)
                {
                  hasSphere2 = [*(self + 672) hasSphere];
                  if (v29 == 5)
                  {
                    v81 = hasSphere2;
                  }

                  else
                  {
                    v81 = 1;
                  }

                  if (v81)
                  {
                    v29 = v29;
                  }

                  else
                  {
                    v29 = 4;
                  }
                }

                if ((bracketMode & 1) == 0 && *(self + 3376) == 1)
                {
                  [(BWFigVideoCaptureDevice *)self _updateCurrentStillSmartCameraState];
                  if (v29 == 5)
                  {
                    if (*(self + 3377) == 1 && (-[BWFigVideoCaptureDevice _evaluateSceneForMotionFreezingWithMasterStreamSwitchoverSuspended:resultOut:](self, 1, 0) & 1) != 0 && ([self zoomFactor], v84 <= 2.5))
                    {
                      v100 = 0;
                      v101 = &v100;
                      v102 = 0x2020000000;
                      v103 = 0;
                      v85 = dispatch_semaphore_create(0);
                      v86 = *(self + 3344);
                      v99[0] = MEMORY[0x1E69E9820];
                      v99[1] = 3221225472;
                      v99[2] = __301__BWFigVideoCaptureDevice__resolveStillImageCaptureTypeFromStatisticsByPortType_masterCaptureStream_flashMode_hdrMode_qualityPrioritization_stereoFusionMode_depthDataDeliveryEnabled_bravoConstituentImageDeliveryDeviceTypes_burstQualityCaptureEnabled_clientBracketMode_forSceneMonitoring_captureFlags___block_invoke;
                      v99[3] = &unk_1E799C4C8;
                      v99[4] = v85;
                      v99[5] = &v100;
                      [v86 detectMotionOnStoredFramesWithSmartCameraDiagnostics:0 completionHandler:v99];
                      dispatch_semaphore_wait(v85, 0xFFFFFFFFFFFFFFFFLL);

                      if (*(v101 + 24))
                      {
                        v29 = 4;
                      }

                      else
                      {
                        v29 = 5;
                      }

                      _Block_object_dispose(&v100, 8);
                    }

                    else
                    {
                      v29 = 5;
                    }
                  }
                }

                goto LABEL_128;
              }

              v26 = v79;
            }

            else
            {
              [*(self + 672) baseZoomFactor];
              if (v43 < v47 && v43 >= v46)
              {
                goto LABEL_67;
              }
            }

            v50 = 0;
            goto LABEL_118;
          }

          [objc_msgSend(objc_msgSend(objc_msgSend(*(self + 600) "sensorIDDictionary")];
          if (v67 <= 0.0)
          {
            aeLimitsReached = [v88 aeLimitsReached];
          }

          else
          {
            v68 = v67;
            [v88 gain];
            aeLimitsReached = v69 >= v68;
          }

          v66 = v56 & aeLimitsReached;
        }

        LOBYTE(v55) = v64;
        goto LABEL_88;
      }
    }

    else
    {
      v63 = 0;
      if (v62)
      {
        goto LABEL_76;
      }
    }

    v66 = 0;
    v30 = isBravoVariant;
    goto LABEL_88;
  }

  v29 = 1;
LABEL_128:
  if (monitoring)
  {
    *monitoring = v28;
  }

  return v29;
}

- (BWStillImageCaptureSettings)_stillImageCaptureSettingsWithID:(uint64_t)d captureType:(unsigned int)type deliverOriginalImage:(unsigned int)image deliverSushiRaw:(void *)raw bravoConstituentImageDeliveryDeviceTypes:(id)types clientBracketSettings:(uint64_t)settings captureFlags:(__int128 *)flags userInitiatedRequestPTS:(uint64_t)self0 frameStatisticsByPortType:
{
  if (result)
  {
    v14 = result;
    isBravoVariant = [(BWStillImageCaptureSettings *)result isBravoVariant];
    v16 = *(v14 + 1560);
    portType = [*(v14 + 680) portType];
    sensorIDString = [*(v14 + 680) sensorIDString];
    portType2 = [*(v14 + 600) portType];
    sensorIDString2 = [*(v14 + 600) sensorIDString];
    portType3 = [*(v14 + 672) portType];
    sensorIDString3 = [*(v14 + 672) sensorIDString];
    portType4 = [*(v14 + 1560) portType];
    sensorIDString4 = [*(v14 + 1560) sensorIDString];
    obj = [MEMORY[0x1E695DF70] array];
    v20 = *(v14 + 1392);
    if (!v20)
    {
      v20 = *(v14 + 600);
    }

    v114 = sensorIDString4;
    rawCopy = raw;
    v117 = isBravoVariant;
    if (isBravoVariant)
    {
      typesCopy = types;
      array = [MEMORY[0x1E695DF70] array];
      v22 = array;
      if ((settings & 0xC00) != 0)
      {
        if (*(v14 + 672) || *(v14 + 680))
        {
          [array addObject:?];
        }
      }

      else if ([raw count])
      {
        v61 = [(BWFigVideoCaptureDevice *)v14 _captureStreamsForBravoConstituentImageDeliveryDeviceTypes:raw];
        v153 = 0u;
        v154 = 0u;
        v155 = 0u;
        v156 = 0u;
        v62 = *(v14 + 656);
        v63 = [v62 countByEnumeratingWithState:&v153 objects:v152 count:16];
        if (v63)
        {
          v64 = v63;
          v65 = *v154;
          dCopy = d;
          do
          {
            settingsCopy = settings;
            for (i = 0; i != v64; ++i)
            {
              if (*v154 != v65)
              {
                objc_enumerationMutation(v62);
              }

              v68 = *(*(&v153 + 1) + 8 * i);
              if (v68 != v20)
              {
                [v22 addObject:*(*(&v153 + 1) + 8 * i)];
              }

              if (([v61 containsObject:v68] & 1) == 0)
              {
                [obj addObject:{objc_msgSend(v68, "portType")}];
              }
            }

            v64 = [v62 countByEnumeratingWithState:&v153 objects:v152 count:16];
            settings = settingsCopy;
            d = dCopy;
          }

          while (v64);
        }
      }

      if ([v22 count])
      {
        v25 = *(v14 + 680);
        v23 = v25 == 0;
        v26 = 4 * (v25 != 0);
        if (v23)
        {
          v27 = 2;
        }

        else
        {
          v27 = 6;
        }

        if (*(v14 + 672))
        {
          v24 = v27;
        }

        else
        {
          v24 = v26;
        }

        types = typesCopy;
      }

      else
      {
        types = typesCopy;
        if ([objc_msgSend(*(v14 + 1392) "portType")])
        {
          v24 = 1;
        }

        else if ([objc_msgSend(*(v14 + 1392) "portType")])
        {
          v24 = 5;
        }

        else
        {
          v24 = 0;
        }
      }
    }

    else
    {
      if (v16)
      {
        v23 = (settings & 0x800) == 0;
      }

      else
      {
        v23 = 1;
      }

      if (v23)
      {
        v24 = 0;
      }

      else
      {
        v24 = 3;
      }
    }

    if (*(v14 + 3448) == 1)
    {
      v150 = *flags;
      v151 = *(flags + 2);
      LODWORD(v97) = v24;
      [(BWFigVideoCaptureDevice *)v14 _zeroShutterLagStillImageCaptureSettingsWithID:a2 captureType:d deliverOriginalImage:type deliverSushiRaw:image bravoConstituentImageDeliveryDeviceTypes:v18 clientBracketSettings:v19 captureFlags:settings userInitiatedRequestPTS:&v150 captureStreams:v97 frameStatisticsByPortType:s, v98, v99, v101, v103, v105, v107, sensorIDString, portType2, sensorIDString2, sensorIDString3, portType4, v114];
      if (v48)
      {
        v28 = v48;
        return v28;
      }
    }

    v130 = 0;
    v28 = 0;
    if (d > 3)
    {
      if (d > 5)
      {
        if (d != 7)
        {
          if (d != 10)
          {
            v29 = 0;
            typesCopy8 = 0;
            typesCopy6 = 0;
            types = 0;
            v132 = 0;
            typesCopy7 = 0;
            settingsCopy32 = settings;
            settingsCopy33 = settings;
            dCopy5 = 0;
            dCopy4 = 0;
            v125 = 0;
            if (d == 6)
            {
              [BWFigVideoCaptureDevice _stillImageCaptureSettingsWithID:v14 captureType:v138 deliverOriginalImage:v139 deliverSushiRaw:&v150 bravoConstituentImageDeliveryDeviceTypes:? clientBracketSettings:? captureFlags:? userInitiatedRequestPTS:? frameStatisticsByPortType:?];
              v132 = 0;
              typesCopy8 = 0;
              typesCopy6 = 0;
              v130 = 0;
              typesCopy7 = 0;
              dCopy5 = 0;
              v125 = 0;
              types = v150;
              dCopy4 = 6;
              settingsCopy32 = settings;
              settingsCopy33 = settings;
              v29 = &unk_1F2249B88;
            }

            goto LABEL_153;
          }

          return v28;
        }

        if (v24 <= 2)
        {
          if (!v24)
          {
            v42 = 0;
            typesCopy7 = 0;
            v45 = 7;
            goto LABEL_114;
          }

          if (v24 == 1)
          {
            typesCopy3 = 0;
            typesCopy7 = 0;
            v42 = 0;
            v44 = 0;
          }

          else
          {
            typesCopy7 = 0;
            v42 = 0;
            v44 = 7;
            typesCopy3 = types;
          }

          goto LABEL_116;
        }

        v130 = 0;
        typesCopy6 = 0;
        v42 = 7;
        if (v24 > 4)
        {
          typesCopy3 = types;
          typesCopy7 = types;
          v44 = 7;
          if (v24 == 5)
          {
            typesCopy7 = types;
            types = 0;
            v45 = 0;
LABEL_114:
            v132 = 0;
            v29 = 0;
            typesCopy8 = 0;
            typesCopy6 = 0;
            dCopy5 = 0;
            dCopy4 = v45;
            v125 = v42;
            settingsCopy32 = settings;
            settingsCopy33 = settings;
            v130 = 0;
            goto LABEL_153;
          }

LABEL_116:
          v132 = 0;
          v29 = 0;
          typesCopy8 = 0;
          v130 = 0;
          dCopy5 = 0;
          v125 = v42;
          HIDWORD(dCopy4) = 7;
          typesCopy6 = types;
          types = typesCopy3;
LABEL_152:
          settingsCopy32 = settings;
          settingsCopy33 = settings;
          LODWORD(dCopy4) = v44;
          goto LABEL_153;
        }

        if (v24 == 4)
        {
          dCopy4 = 7;
          v29 = 0;
          typesCopy8 = 0;
          v132 = 0;
          typesCopy7 = types;
          settingsCopy32 = settings;
          settingsCopy33 = settings;
          dCopy5 = 0;
          v125 = 7;
          goto LABEL_153;
        }

        [BWFigVideoCaptureDevice _stillImageCaptureSettingsWithID:captureType:deliverOriginalImage:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:clientBracketSettings:captureFlags:userInitiatedRequestPTS:frameStatisticsByPortType:];
        v132 = 0;
        typesCopy6 = 0;
        v130 = 0;
        typesCopy7 = 0;
        v125 = 0;
        v29 = v150;
        dCopy5 = 7;
        typesCopy8 = types;
        settingsCopy32 = settings;
        settingsCopy33 = settings;
        v50 = 7;
        goto LABEL_98;
      }

      if (d != 4)
      {
        v37 = *off_1E798B8D8;
        v146 = *off_1E798B8D8;
        v147 = &unk_1F2249AC8;
        v38 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v147 forKeys:&v146 count:1];
        if (v24 != 2)
        {
          if (v24 != 1)
          {
            if (!v24)
            {
              types = [BWBracketSettings bracketSettingsForBracketingMode:3];
              [types setProvidePreBracketedEV0:*(v14 + 2685)];
              [types setOisBracketedCaptureParams:v38];
              v132 = 0;
              v29 = 0;
              typesCopy8 = 0;
              typesCopy6 = 0;
              v130 = 0;
              typesCopy7 = 0;
              dCopy5 = 0;
              HIDWORD(dCopy4) = 0;
              v125 = 0;
              v39 = 5;
LABEL_107:
              LODWORD(dCopy4) = v39;
              goto LABEL_147;
            }

LABEL_146:
            v132 = 0;
            v29 = 0;
            typesCopy8 = 0;
            typesCopy6 = 0;
            v130 = 0;
            types = 0;
            typesCopy7 = 0;
            dCopy5 = 0;
            dCopy4 = 0;
            v125 = 0;
            goto LABEL_147;
          }

          if ([*(v14 + 672) hasSphere])
          {
            typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:3];
            [typesCopy6 setProvidePreBracketedEV0:*(v14 + 2685)];
            [typesCopy6 setOisBracketedCaptureParams:v38];
            v132 = 0;
            v29 = 0;
            typesCopy8 = 0;
            v130 = 0;
            types = 0;
            typesCopy7 = 0;
            dCopy5 = 0;
            LODWORD(dCopy4) = 0;
            v125 = 0;
            v52 = 5;
LABEL_120:
            HIDWORD(dCopy4) = v52;
            goto LABEL_147;
          }

          typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:2];
          [typesCopy6 setProvidePreBracketedEV0:1];
          v46 = &unk_1F2249B58;
          goto LABEL_118;
        }

        if ((settings & 0x400) != 0 || (v55 = [rawCopy count], (settings & 0x800) == 0) && v55)
        {
          hasSphere = [*(v14 + 672) hasSphere];
          v57 = [BWBracketSettings bracketSettingsForBracketingMode:3];
          v58 = v57;
          if (hasSphere)
          {
            [v57 setProvidePreBracketedEV0:*(v14 + 2685)];
            [v58 setOisBracketedCaptureParams:v38];
            v59 = [BWBracketSettings bracketSettingsForBracketingMode:3];
            [v59 setProvidePreBracketedEV0:*(v14 + 2685)];
            [v59 setOisBracketedCaptureParams:v38];
            v132 = 0;
            v29 = 0;
            typesCopy8 = 0;
            v130 = 0;
            typesCopy7 = 0;
            dCopy5 = 0;
            v125 = 0;
            dCopy4 = 0x500000005;
          }

          else
          {
            [v57 setProvidePreBracketedEV0:1];
            [v58 setOisBracketedCaptureParams:v38];
            if (*(v14 + 2685))
            {
              v69 = 0;
            }

            else
            {
              v69 = &unk_1F2249AE0;
            }

            v144 = v37;
            v145 = &unk_1F2249AF8;
            v70 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v145 forKeys:&v144 count:1];
            v59 = [BWBracketSettings bracketSettingsForBracketingMode:2];
            [v59 setProvidePreBracketedEV0:1];
            [v59 setOisBracketedCaptureParams:v70];
            v29 = v69;
            v132 = 0;
            typesCopy8 = 0;
            v130 = 0;
            typesCopy7 = 0;
            dCopy5 = 0;
            v125 = 0;
            dCopy4 = 0x400000005;
          }

          settingsCopy32 = settings;
          settingsCopy33 = settings;
          types = v58;
          typesCopy6 = v59;
          goto LABEL_153;
        }

        if ((settings & 0x800) == 0)
        {
          goto LABEL_146;
        }

        if (![*(v14 + 672) hasSphere])
        {
          v142 = v37;
          v143 = &unk_1F2249B10;
          v92 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v143 forKeys:&v142 count:1];
          if (*(v14 + 2685))
          {
            v93 = 0;
          }

          else
          {
            v93 = &unk_1F2249B28;
          }

          v94 = [BWBracketSettings bracketSettingsForBracketingMode:3];
          [v94 setProvidePreBracketedEV0:1];
          [v94 setOisBracketedCaptureParams:v92];
          v140 = v37;
          types = v94;
          v141 = &unk_1F2249B40;
          v95 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v141 forKeys:&v140 count:1];
          typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:2];
          [typesCopy6 setProvidePreBracketedEV0:1];
          [typesCopy6 setOisBracketedCaptureParams:v95];
          v29 = v93;
          v132 = 0;
          typesCopy8 = 0;
          v130 = 0;
          typesCopy7 = 0;
          dCopy5 = 0;
          v125 = 0;
          LODWORD(dCopy4) = 5;
          goto LABEL_119;
        }

        types = [BWBracketSettings bracketSettingsForBracketingMode:3];
        [types setProvidePreBracketedEV0:*(v14 + 2685)];
        [types setOisBracketedCaptureParams:v38];
        typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:3];
        [typesCopy6 setProvidePreBracketedEV0:*(v14 + 2685)];
        [typesCopy6 setOisBracketedCaptureParams:v38];
        v132 = 0;
        v29 = 0;
        typesCopy8 = 0;
        v130 = 0;
        typesCopy7 = 0;
        dCopy5 = 0;
        v125 = 0;
        v44 = 5;
LABEL_151:
        HIDWORD(dCopy4) = v44;
        goto LABEL_152;
      }

      v130 = 0;
      if (v24 <= 1)
      {
        if (!v24)
        {
          types = [BWBracketSettings bracketSettingsForBracketingMode:2];
          [types setProvidePreBracketedEV0:1];
          [types setExposureValues:&unk_1F2249AB0];
          v132 = 0;
          v29 = 0;
          typesCopy8 = 0;
          typesCopy6 = 0;
          v130 = 0;
          typesCopy7 = 0;
          dCopy5 = 0;
          HIDWORD(dCopy4) = 0;
          v125 = 0;
          v39 = 4;
          goto LABEL_107;
        }

        v29 = 0;
        typesCopy8 = 0;
        typesCopy6 = 0;
        types = 0;
        v132 = 0;
        typesCopy7 = 0;
        settingsCopy32 = settings;
        settingsCopy33 = settings;
        dCopy5 = 0;
        dCopy4 = 0;
        v125 = 0;
        if (v24 == 1)
        {
          typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:2];
          [typesCopy6 setProvidePreBracketedEV0:1];
          v46 = &unk_1F2249AB0;
LABEL_118:
          [typesCopy6 setExposureValues:v46];
          v132 = 0;
          v29 = 0;
          typesCopy8 = 0;
          v130 = 0;
          types = 0;
          typesCopy7 = 0;
          dCopy5 = 0;
          LODWORD(dCopy4) = 0;
          v125 = 0;
LABEL_119:
          v52 = 4;
          goto LABEL_120;
        }

        goto LABEL_153;
      }

      if (v24 == 2)
      {
        types = [BWBracketSettings bracketSettingsForBracketingMode:2];
        [types setProvidePreBracketedEV0:1];
        [types setExposureValues:&unk_1F2249AB0];
        typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:2];
        [typesCopy6 setProvidePreBracketedEV0:1];
        [typesCopy6 setExposureValues:&unk_1F2249AB0];
        v132 = 0;
        v29 = 0;
        typesCopy8 = 0;
        v130 = 0;
        typesCopy7 = 0;
        dCopy5 = 0;
        v125 = 0;
        v44 = 4;
        goto LABEL_151;
      }

      v29 = 0;
      typesCopy8 = 0;
      typesCopy6 = 0;
      types = 0;
      v132 = 0;
      typesCopy7 = 0;
      settingsCopy32 = settings;
      settingsCopy33 = settings;
      dCopy5 = 0;
      dCopy4 = 0;
      v125 = 0;
      if (v24 != 3)
      {
LABEL_153:
        v100 = settingsCopy33;
        v102 = settingsCopy32;
        v104 = typesCopy7;
        v106 = typesCopy8;
        v115 = dCopy5;
        v71 = v29;
        v108 = typesCopy6;
        typesCopy9 = types;
        settingsCopy20 = settings;
        dCopy2 = d;
        v136 = 0u;
        v137 = 0u;
        v134 = 0u;
        v135 = 0u;
        v72 = [obj countByEnumeratingWithState:&v134 objects:v133 count:16];
        if (v72)
        {
          v73 = v72;
          v74 = 0;
          v75 = *v135;
          v76 = *off_1E798A0D0;
          v77 = *off_1E798A0C0;
          v78 = *off_1E798A0D8;
          v79 = MEMORY[0x1E695E0F0];
          do
          {
            for (j = 0; j != v73; ++j)
            {
              if (*v135 != v75)
              {
                objc_enumerationMutation(obj);
              }

              v81 = *(*(&v134 + 1) + 8 * j);
              if ([v81 isEqualToString:v76])
              {
                v74 = v79;
              }

              if ([v81 isEqualToString:v77])
              {
                v71 = v79;
              }

              v82 = [v81 isEqualToString:v78];
              v83 = v132;
              if (v82)
              {
                v83 = v79;
              }

              v132 = v83;
            }

            v73 = [obj countByEnumeratingWithState:&v134 objects:v133 count:16];
          }

          while (v73);
        }

        else
        {
          v74 = 0;
        }

        v84 = objc_alloc_init(MEMORY[0x1E695DF70]);
        if (v125)
        {
          v85 = v130;
          v86 = [[BWStillImageCaptureStreamSettings alloc] initWithPortType:portType captureType:v125 captureFlags:v100 timeMachineFrameCount:v130 bracketSettings:v104 validBracketedCaptureSequenceNumbers:v74];
          [(BWStillImageCaptureStreamSettings *)v86 setSensorIDString:sensorIDString];
          [v84 addObject:v86];
          v87 = settingsCopy20;
          v88 = dCopy2;
        }

        else
        {
          v86 = 0;
          v87 = settingsCopy20;
          v88 = dCopy2;
          v85 = v130;
        }

        if (dCopy4)
        {
          v89 = [[BWStillImageCaptureStreamSettings alloc] initWithPortType:portType2 captureType:dCopy4 captureFlags:v102 timeMachineFrameCount:v85 bracketSettings:typesCopy9 validBracketedCaptureSequenceNumbers:v71];
          [(BWStillImageCaptureStreamSettings *)v89 setSensorIDString:sensorIDString2];
          [v84 addObject:v89];
        }

        else
        {
          v89 = 0;
        }

        if (HIDWORD(dCopy4))
        {
          v90 = [[BWStillImageCaptureStreamSettings alloc] initWithPortType:portType3 captureType:HIDWORD(dCopy4) captureFlags:v87 timeMachineFrameCount:v85 bracketSettings:v108 validBracketedCaptureSequenceNumbers:v132];
          [(BWStillImageCaptureStreamSettings *)v90 setSensorIDString:sensorIDString3];
          [v84 addObject:v90];
        }

        else
        {
          v90 = 0;
        }

        if (v115)
        {
          v91 = [[BWStillImageCaptureStreamSettings alloc] initWithPortType:portType4 captureType:v115 captureFlags:v87 timeMachineFrameCount:v85 bracketSettings:v106 validBracketedCaptureSequenceNumbers:0];
          [(BWStillImageCaptureStreamSettings *)v91 setSensorIDString:v114];
          [v84 addObject:v91];
        }

        else
        {
          v91 = 0;
        }

        LOBYTE(v96) = image;
        v28 = [[BWStillImageCaptureSettings alloc] initWithSettingsID:a2 captureType:v88 captureFlags:v87 sceneFlags:0 frameStatisticsByPortType:s deliverOriginalImage:type deliverSushiRaw:v96 captureStreamSettings:v84];
        [(BWStillImageCaptureSettings *)v28 setMetadata:objc_alloc_init(BWStillImageCaptureMetadata)];

        return v28;
      }

      types = [BWBracketSettings bracketSettingsForBracketingMode:2];
      [types setProvidePreBracketedEV0:1];
      [types setExposureValues:&unk_1F2249AB0];
      v49 = [BWBracketSettings bracketSettingsForBracketingMode:2];
      [v49 setProvidePreBracketedEV0:1];
      [v49 setExposureValues:&unk_1F2249AB0];
      typesCopy8 = v49;
      v132 = 0;
      v29 = 0;
      typesCopy6 = 0;
      v130 = 0;
      typesCopy7 = 0;
      v125 = 0;
      dCopy5 = 4;
      settingsCopy32 = settings;
      settingsCopy33 = settings;
      v50 = 4;
LABEL_98:
      dCopy4 = v50;
      goto LABEL_153;
    }

    if (d <= 1)
    {
      if (!d)
      {
        return v28;
      }

      v29 = 0;
      typesCopy8 = 0;
      typesCopy6 = 0;
      types = 0;
      v132 = 0;
      typesCopy7 = 0;
      settingsCopy32 = settings;
      settingsCopy33 = settings;
      dCopy5 = 0;
      dCopy4 = 0;
      v125 = 0;
      if (d != 1)
      {
        goto LABEL_153;
      }

      v130 = 1;
LABEL_49:
      dCopy6 = 0;
      if (v24 <= 2)
      {
        dCopy4 = __PAIR64__(v24, d);
        dCopy9 = v24;
        dCopy5 = v24;
        if (!v24)
        {
          goto LABEL_76;
        }

        dCopy8 = d;
        dCopy9 = 0;
        if (v24 == 1)
        {
          dCopy8 = 0;
          dCopy9 = 0;
        }
      }

      else
      {
        if (v24 <= 4)
        {
          if (v24 == 3)
          {
            dCopy4 = d;
            dCopy9 = 0;
            dCopy5 = d;
            goto LABEL_76;
          }

          HIDWORD(dCopy4) = 0;
          dCopy6 = d;
          dCopy9 = d;
          goto LABEL_75;
        }

        dCopy8 = d;
        dCopy9 = d;
        HIDWORD(dCopy4) = 0;
        if (v24 == 5)
        {
LABEL_75:
          dCopy5 = 0;
          LODWORD(dCopy4) = dCopy6;
LABEL_76:
          v51 = v117 ^ 1;
          if ((settings & 0x800) == 0)
          {
            v51 = 1;
          }

          v125 = dCopy9;
          if ((v51 & 1) == 0 && ![rawCopy count] && (*(v14 + 3888) & 1) == 0)
          {
            if (v24 == 4)
            {
              v132 = 0;
              v29 = 0;
              typesCopy8 = 0;
              typesCopy6 = 0;
              types = 0;
              typesCopy7 = 0;
              settingsCopy33 = settings & 0xFFFFFFFFFFFEFFFFLL;
              settingsCopy32 = settings;
              goto LABEL_153;
            }

            if (v24 == 2)
            {
              v132 = 0;
              v29 = 0;
              typesCopy8 = 0;
              typesCopy6 = 0;
              types = 0;
              typesCopy7 = 0;
              settingsCopy32 = settings & 0xFFFFFFFFFFFEFFFFLL;
LABEL_148:
              settingsCopy33 = settings;
              goto LABEL_153;
            }
          }

          v132 = 0;
          v29 = 0;
          typesCopy8 = 0;
          typesCopy6 = 0;
          types = 0;
          typesCopy7 = 0;
LABEL_147:
          settingsCopy32 = settings;
          goto LABEL_148;
        }
      }

      dCopy6 = dCopy8;
      HIDWORD(dCopy4) = d;
      goto LABEL_75;
    }

    if (d == 2)
    {
      goto LABEL_49;
    }

    if (type & 1) != 0 || (*(v14 + 2685))
    {
      v36 = 1;
    }

    else
    {
      v36 = *(v14 + 2684);
    }

    v130 = 0;
    typesCopy7 = 0;
    if (*(v14 + 2684))
    {
      v53 = &unk_1F2249A68;
    }

    else
    {
      v53 = &unk_1F2249A80;
    }

    if (v24 <= 1)
    {
      if (!v24)
      {
        types = [BWBracketSettings bracketSettingsForBracketingMode:1];
        [types setProvidePreBracketedEV0:v36 & 1];
        [types setExposureValues:v53];
        v132 = 0;
        v29 = 0;
        typesCopy8 = 0;
        typesCopy6 = 0;
        v130 = 0;
        typesCopy7 = 0;
        dCopy5 = 0;
        HIDWORD(dCopy4) = 0;
        v125 = 0;
        v39 = 3;
        goto LABEL_107;
      }

      v29 = 0;
      typesCopy8 = 0;
      typesCopy6 = 0;
      types = 0;
      v132 = 0;
      settingsCopy32 = settings;
      settingsCopy33 = settings;
      dCopy5 = 0;
      dCopy4 = 0;
      v125 = 0;
      if (v24 == 1)
      {
        typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:1];
        [typesCopy6 setProvidePreBracketedEV0:v36 & 1];
        [typesCopy6 setExposureValues:v53];
        v132 = 0;
        v29 = 0;
        typesCopy8 = 0;
        v130 = 0;
        types = 0;
        typesCopy7 = 0;
        dCopy5 = 0;
        LODWORD(dCopy4) = 0;
        v125 = 0;
        v52 = 3;
        goto LABEL_120;
      }

      goto LABEL_153;
    }

    if (v24 != 2)
    {
      v29 = 0;
      typesCopy8 = 0;
      typesCopy6 = 0;
      types = 0;
      v132 = 0;
      settingsCopy32 = settings;
      settingsCopy33 = settings;
      dCopy5 = 0;
      dCopy4 = 0;
      v125 = 0;
      if (v24 != 3)
      {
        goto LABEL_153;
      }

      types = [BWBracketSettings bracketSettingsForBracketingMode:1];
      [types setProvidePreBracketedEV0:v36 & 1];
      [types setExposureValues:v53];
      v54 = [BWBracketSettings bracketSettingsForBracketingMode:1];
      [v54 setProvidePreBracketedEV0:v36 & 1];
      [v54 setExposureValues:&unk_1F2249A98];
      typesCopy8 = v54;
      v132 = 0;
      v29 = 0;
      typesCopy6 = 0;
      v130 = 0;
      typesCopy7 = 0;
      v125 = 0;
      dCopy5 = 3;
      settingsCopy32 = settings;
      settingsCopy33 = settings;
      v50 = 3;
      goto LABEL_98;
    }

    types = [BWBracketSettings bracketSettingsForBracketingMode:1];
    [types setProvidePreBracketedEV0:v36 & 1];
    [types setExposureValues:v53];
    typesCopy6 = [BWBracketSettings bracketSettingsForBracketingMode:1];
    [typesCopy6 setProvidePreBracketedEV0:v36 & 1];
    [typesCopy6 setExposureValues:v53];
    if ([v53 containsObject:&unk_1F2246990])
    {
      v60 = [v53 indexOfObject:&unk_1F2246990] + 1;
    }

    else
    {
      v60 = 2;
    }

    if ((settings & 0x400) != 0)
    {
      v149[0] = &unk_1F2246990;
      v149[1] = [MEMORY[0x1E696AD98] numberWithInt:v60];
      v132 = [MEMORY[0x1E695DEC8] arrayWithObjects:v149 count:2];
    }

    else
    {
      if ((settings & 0x800) != 0)
      {
        v148[0] = &unk_1F2246990;
        v148[1] = [MEMORY[0x1E696AD98] numberWithInt:v60];
        v29 = [MEMORY[0x1E695DEC8] arrayWithObjects:v148 count:2];
        v132 = 0;
        goto LABEL_150;
      }

      v132 = 0;
    }

    v29 = 0;
LABEL_150:
    typesCopy8 = 0;
    v130 = 0;
    typesCopy7 = 0;
    dCopy5 = 0;
    v125 = 0;
    v44 = 3;
    goto LABEL_151;
  }

  return result;
}

void __68__BWFigVideoCaptureDevice__suspendTimeMachineWithCompletionHandler___block_invoke(uint64_t a1, char a2, uint64_t a3, uint64_t a4, __int128 *a5)
{
  v5 = *(*(a1 + 32) + 2688);
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v6 = a5[1];
  v9 = *a5;
  v8[2] = __68__BWFigVideoCaptureDevice__suspendTimeMachineWithCompletionHandler___block_invoke_2;
  v8[3] = &unk_1E799C098;
  v7 = *(a1 + 40);
  v8[5] = a4;
  v8[6] = v7;
  v12 = a2;
  v8[4] = a3;
  v10 = v6;
  v11 = a5[2];
  dispatch_async(v5, v8);
}

uint64_t __68__BWFigVideoCaptureDevice__suspendTimeMachineWithCompletionHandler___block_invoke_2(uint64_t a1)
{
  v1 = *(a1 + 40);
  v2 = *(a1 + 48);
  v3 = *(a1 + 104);
  v4 = *(a1 + 32);
  v5 = *(v2 + 16);
  v6 = *(a1 + 72);
  v8[0] = *(a1 + 56);
  v8[1] = v6;
  v8[2] = *(a1 + 88);
  return v5(v2, v3, v4, v1, v8);
}

uint64_t __82__BWFigVideoCaptureDevice__initiateCaptureStillImageNowWithPTS_completionHandler___block_invoke(uint64_t a1, int a2, uint64_t a3)
{
  if (!a2)
  {
    return __82__BWFigVideoCaptureDevice__initiateCaptureStillImageNowWithPTS_completionHandler___block_invoke_cold_2(a1);
  }

  result = __82__BWFigVideoCaptureDevice__initiateCaptureStillImageNowWithPTS_completionHandler___block_invoke_cold_1(a1, a3);
  if (result)
  {
    return __82__BWFigVideoCaptureDevice__initiateCaptureStillImageNowWithPTS_completionHandler___block_invoke_cold_2(a1);
  }

  return result;
}

- (void)initiateCaptureStillImageNowWithPTS:(id *)s completionHandler:(id)handler
{
  v4 = *&self->_stillImageEnhancedResByMaintainingSensorResolutionSupported;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __81__BWFigVideoCaptureDevice_initiateCaptureStillImageNowWithPTS_completionHandler___block_invoke;
  block[3] = &unk_1E799C0E8;
  v6 = *s;
  block[4] = self;
  block[5] = handler;
  dispatch_async(v4, block);
}

- (void)prepareToCaptureStillImageNow:(id)now
{
  v3 = *&self->_stillImageEnhancedResByMaintainingSensorResolutionSupported;
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __57__BWFigVideoCaptureDevice_prepareToCaptureStillImageNow___block_invoke;
  v4[3] = &unk_1E7990390;
  v4[4] = self;
  v4[5] = now;
  dispatch_async(v3, v4);
}

void __57__BWFigVideoCaptureDevice_prepareToCaptureStillImageNow___block_invoke(uint64_t a1)
{
  *(*(a1 + 32) + 2776) = [*(a1 + 40) copy];
  os_unfair_lock_lock((*(a1 + 32) + 1384));
  if ([*(*(a1 + 32) + 2760) currentState] == 2)
  {
    [(BWFigVideoCaptureDevice *)*(a1 + 32) _handlePendingStillImageCaptureRequest];
  }

  v2 = (*(a1 + 32) + 1384);

  os_unfair_lock_unlock(v2);
}

- (void)cancelPrepareToCaptureStillImageNow
{
  if (*&self->_zeroShutterLagEarliestAllowedPTS.timescale)
  {
    [(BWFigVideoCaptureDevice *)self _resumeTimeMachines];

    *&self->_zeroShutterLagEarliestAllowedPTS.timescale = 0;
  }

  v3 = *&self->_stillImageEnhancedResByMaintainingSensorResolutionSupported;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __62__BWFigVideoCaptureDevice_cancelPrepareToCaptureStillImageNow__block_invoke;
  block[3] = &unk_1E798F870;
  block[4] = self;
  dispatch_async(v3, block);
}

void __62__BWFigVideoCaptureDevice_cancelPrepareToCaptureStillImageNow__block_invoke(uint64_t a1)
{
  os_unfair_lock_lock((*(a1 + 32) + 1384));
  if ([*(*(a1 + 32) + 2760) currentState] == 8 || objc_msgSend(*(*(a1 + 32) + 2760), "currentState") == 4)
  {
    [*(*(a1 + 32) + 2760) transitionToState:2];
  }

  v2 = (*(a1 + 32) + 1384);

  os_unfair_lock_unlock(v2);
}

- (int)captureStillImageNowWithSettings:(id)settings captureSettings:(id)captureSettings
{
  if ([objc_msgSend(captureSettings captureStreamSettings] < 2 || self && (self->_stereoFusionEnabled || self->_bravoConstituentPhotoDeliveryEnabled || self->_depthDataDeliveryEnabled || self->_stereoPhotoCaptureEnabled))
  {
    v6 = *&self->_stillImageEnhancedResByMaintainingSensorResolutionSupported;
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __76__BWFigVideoCaptureDevice_captureStillImageNowWithSettings_captureSettings___block_invoke;
    block[3] = &unk_1E798F898;
    block[4] = self;
    block[5] = captureSettings;
    dispatch_async(v6, block);
    return 0;
  }

  else
  {
    FrameworkRadarComponent = FigCaptureGetFrameworkRadarComponent();
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
    fig_log_call_emit_and_clean_up_after_send_and_compose();
    v10 = _os_log_send_and_compose_impl();
    FigCapturePleaseFileRadar(FrameworkRadarComponent, v10, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 9443, @"LastShownDate:BWFigVideoCaptureDevice.m:9443", @"LastShownBuild:BWFigVideoCaptureDevice.m:9443", 0);
    free(v10);
    return -12780;
  }
}

void __82__BWFigVideoCaptureDevice__stillImageCaptureStateMachineDidTransitionToInProgress__block_invoke(uint64_t a1)
{
  (*(*(*(a1 + 32) + 2768) + 16))();

  *(*(a1 + 32) + 2768) = 0;
}

- (uint64_t)_convertStillImageCaptureSettings:(void *)settings toStillImageCaptureNowOptions:(void *)options captureStreamPropertyValues:
{
  if (!self)
  {
    return 0;
  }

  v8 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v84 = objc_alloc_init(MEMORY[0x1E695DF90]);
  masterPortType = [a2 masterPortType];
  v118 = 0;
  v119 = &v118;
  v120 = 0x3052000000;
  v121 = __Block_byref_object_copy__41;
  v122 = __Block_byref_object_dispose__41;
  v123 = 0;
  v114 = 0u;
  v115 = 0u;
  v116 = 0u;
  v117 = 0u;
  selfCopy = self;
  v9 = *(self + 656);
  v10 = 0;
  v11 = [v9 countByEnumeratingWithState:&v114 objects:v113 count:16];
  if (!v11)
  {
    goto LABEL_17;
  }

  v89 = 0;
  v12 = *v115;
  do
  {
    for (i = 0; i != v11; ++i)
    {
      if (*v115 != v12)
      {
        objc_enumerationMutation(v9);
      }

      v14 = *(*(&v114 + 1) + 8 * i);
      v15 = [objc_msgSend(v14 "portType")];
      if (v10)
      {
        v16 = v10;
      }

      else
      {
        v16 = v14;
      }

      if (!v15)
      {
        v10 = v16;
      }

      v17 = v89;
      if (v15)
      {
        v17 = v14;
      }

      v89 = v17;
    }

    v11 = [v9 countByEnumeratingWithState:&v114 objects:v113 count:16];
  }

  while (v11);
  if (!v89)
  {
LABEL_17:
    v76 = v81;
    LODWORD(v74) = 0;
    FigDebugAssert3();
    v89 = 0;
  }

  v85 = [a2 captureStreamSettingsForPortType:{objc_msgSend(v89, "portType", v74, v76)}];
  v82 = [a2 captureStreamSettingsForPortType:{objc_msgSend(v10, "portType")}];
  v86 = a2;
  if ([objc_msgSend(v85 "timeMachineBracketedCaptureParams")])
  {
    v18 = 1;
  }

  else
  {
    v18 = [objc_msgSend(v85 "unifiedBracketedCaptureParams")] != 0;
  }

  v83 = v18;
  v111 = 0u;
  v112 = 0u;
  v109 = 0u;
  v110 = 0u;
  captureStreamSettings = [a2 captureStreamSettings];
  v20 = [captureStreamSettings countByEnumeratingWithState:&v109 objects:v108 count:16];
  if (!v20)
  {
    v80 = MEMORY[0x1E695E110];
    v21 = 0;
    v22 = 0;
    goto LABEL_48;
  }

  settingsCopy = settings;
  optionsCopy = options;
  LOBYTE(v21) = 0;
  v22 = 0;
  LOBYTE(settings) = 0;
  v23 = *v110;
  do
  {
    for (j = 0; j != v20; ++j)
    {
      if (*v110 != v23)
      {
        objc_enumerationMutation(captureStreamSettings);
      }

      v25 = *(*(&v109 + 1) + 8 * j);
      if (settings)
      {
        LODWORD(settings) = 1;
        if (v21)
        {
          goto LABEL_28;
        }
      }

      else
      {
        LODWORD(settings) = [objc_msgSend(*(*(&v109 + 1) + 8 * j) "bracketSettings")];
        if (v21)
        {
LABEL_28:
          v21 = 1;
          goto LABEL_31;
        }
      }

      v21 = [v25 captureType] == 2;
LABEL_31:
      v26 = [objc_msgSend(v25 "bracketSettings")];
      if (v22 == 3)
      {
        v27 = 3;
      }

      else
      {
        v27 = 2;
      }

      if (v26 != 2)
      {
        v27 = v22;
      }

      if ((v26 - 3) < 2 || v26 == 1)
      {
        v22 = v26;
      }

      else
      {
        v22 = v27;
      }
    }

    v20 = [captureStreamSettings countByEnumeratingWithState:&v109 objects:v108 count:16];
  }

  while (v20);
  v29 = MEMORY[0x1E695E118];
  if (!settings)
  {
    v29 = MEMORY[0x1E695E110];
  }

  v80 = v29;
  settings = settingsCopy;
  options = optionsCopy;
LABEL_48:
  if (*(selfCopy + 648) && !v82)
  {
    [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C5A8];
  }

  if ([v86 deliverSushiRaw])
  {
    [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C4F8];
  }

  if ([objc_msgSend(objc_msgSend(v89 "stream")])
  {
    [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C550];
  }

  if ([objc_msgSend(objc_msgSend(v89 "stream")])
  {
    [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C548];
  }

  if ([objc_msgSend(objc_msgSend(v89 "stream")])
  {
    [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C540];
  }

  if (!v83 && ([v86 captureFlags] & 0x800) != 0)
  {
    if (*(selfCopy + 3446) == 1)
    {
      [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C4E8];
    }

    if (*(selfCopy + 3447) == 1)
    {
      [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C4F0];
    }
  }

  if ([objc_msgSend(*(selfCopy + 624) objectForKeyedSubscript:{@"StillImageISPChromaNoiseReduction", "BOOLValue"}])
  {
    [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", *(selfCopy + 2700)), *off_1E798C538}];
  }

  if (*(selfCopy + 2172) == 1)
  {
    v30 = off_1E798A070;
    if (!v21)
    {
      v30 = off_1E798A068;
    }

    [v84 setObject:*v30 forKeyedSubscript:*off_1E798BE58];
  }

  if (!v21)
  {
    if (!v22)
    {
      if ([objc_msgSend(v85 "unifiedBracketedCaptureParams")])
      {
        [v8 setObject:objc_msgSend(v85 forKeyedSubscript:{"preBracketFrameCaptureParams"), *off_1E798C598}];
        [v8 setObject:objc_msgSend(v82 forKeyedSubscript:{"preBracketFrameCaptureParams"), *off_1E798C5A0}];
        [v8 setObject:objc_msgSend(v85 forKeyedSubscript:{"unifiedBracketedCaptureParams"), *off_1E798C5C8}];
        [v8 setObject:objc_msgSend(v82 forKeyedSubscript:{"unifiedBracketedCaptureParams"), *off_1E798C5D0}];
        if ([v85 captureType] != 7 || objc_msgSend(v85, "lensStabilizationEnabledForClientBracket"))
        {
          [v86 captureType];
          if ([BWFigVideoCaptureDevice _ubEnableSphereForCaptureType:selfCopy])
          {
            [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798BB60];
          }
        }

        if ([objc_msgSend(objc_msgSend(v89 "stream")])
        {
          [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C558];
        }

        if ([v85 captureFlags] < 0)
        {
          v37 = 500;
        }

        else
        {
          v37 = 0;
        }

        [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v37), *off_1E798C500}];
        v38 = [objc_msgSend(*(selfCopy + 2192) objectForKeyedSubscript:{objc_msgSend(v89, "portType")), "afWindowParams"}];
        if (v38)
        {
          v98 = *off_1E798BC50;
          v99 = v38;
          [v8 setObject:objc_msgSend(MEMORY[0x1E695DF20] forKeyedSubscript:{"dictionaryWithObjects:forKeys:count:", &v99, &v98, 1), *off_1E798B9F8}];
        }
      }

LABEL_110:
      if (!v83)
      {
        [(BWFigVideoCaptureDevice *)selfCopy _addNoiseReductionAndSharpeningConfigurationToStillImageCaptureOptions:v8 captureSettings:v86 portType:masterPortType];
        if (v82)
        {
          -[BWFigVideoCaptureDevice _addNoiseReductionAndSharpeningConfigurationToStillImageCaptureOptions:captureSettings:portType:](selfCopy, v8, v86, [v10 portType]);
        }
      }

      stillImageKeypointDetectionEnabled = [v89 stillImageKeypointDetectionEnabled];
      if (stillImageKeypointDetectionEnabled != [v89 keypointDetectionEnabled])
      {
        [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", stillImageKeypointDetectionEnabled), *off_1E798C580}];
      }

      if (*(selfCopy + 3448) == 1)
      {
        v42 = ([v86 captureFlags] & 0x2000) != 0 || objc_msgSend(v86, "captureType") == 1;
      }

      else
      {
        v42 = 0;
      }

      v43 = v83;
      if (v83)
      {
        v43 = [objc_msgSend(v85 "timeMachineBracketedCaptureParams")] != 0;
      }

      if (!v42 && !v43)
      {
        goto LABEL_135;
      }

      if ([objc_msgSend(v85 "timeMachineBracketedCaptureParams")])
      {
        [v8 setObject:objc_msgSend(v85 forKeyedSubscript:{"timeMachineBracketedCaptureParams"), *off_1E798C5B0}];
        if ([v86 captureType] == 10 && objc_msgSend(objc_msgSend(objc_msgSend(v89, "stream"), "getPropertyIfSupported:error:", *off_1E798BFC0, 0), "BOOLValue"))
        {
          [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C558];
        }

        if (![objc_msgSend(v85 "unifiedBracketedCaptureParams")])
        {
          [v8 setObject:*off_1E798BA18 forKeyedSubscript:*off_1E798BA88];
        }

        goto LABEL_135;
      }

      expectedTimeMachineFrameCaptureCount = [v85 expectedTimeMachineFrameCaptureCount];
      if (v85)
      {
        [v85 preferredTimeMachinePTS];
        if ((v96 & 0x100000000) != 0)
        {
          [v85 preferredTimeMachinePTS];
          v45 = CMTimeCopyAsDictionary(&time, *MEMORY[0x1E695E480]);
          v94[0] = *off_1E798C790;
          v46 = [MEMORY[0x1E696AD98] numberWithInt:expectedTimeMachineFrameCaptureCount];
          v94[1] = *off_1E798C798;
          v95[0] = v46;
          v95[1] = v45;
          v47 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v95 forKeys:v94 count:2];

LABEL_134:
          [v8 setObject:v47 forKeyedSubscript:*off_1E798C5B8];
LABEL_135:
          v48 = selfCopy;
          if (*(selfCopy + 1560))
          {
            v48 = selfCopy;
            if (([v86 captureFlags] & 0x800) != 0)
            {
              v49 = *off_1E798AE28;
              v90[0] = *off_1E798AE20;
              v90[1] = v49;
              v91[0] = &unk_1F22469C0;
              v91[1] = &unk_1F22469C0;
              v90[2] = *off_1E798AE30;
              v91[2] = &unk_1F22469D8;
              [v8 setObject:objc_msgSend(MEMORY[0x1E695DF20] forKeyedSubscript:{"dictionaryWithObjects:forKeys:count:", v91, v90, 3), *off_1E798C578}];
            }
          }

          if (([objc_msgSend(*(v48 + 8) "deviceID")] & 1) == 0)
          {
            [BWFigVideoCaptureDevice _propagateStillImageSettings:selfCopy toCMIOCaptureOptions:?];
          }

          goto LABEL_140;
        }
      }

      else
      {
        v95[2] = 0;
        v96 = 0;
        v97 = 0;
      }

      v92 = *off_1E798C790;
      v93 = [MEMORY[0x1E696AD98] numberWithInt:expectedTimeMachineFrameCaptureCount];
      v47 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v93 forKeys:&v92 count:1];
      goto LABEL_134;
    }

    bracketSettings = [v85 bracketSettings];
    bracketSettings2 = [v82 bracketSettings];
    [v8 setObject:v80 forKeyedSubscript:*off_1E798BB40];
    if (v22 <= 2)
    {
      if (v22 != 1)
      {
        if (v22 != 2)
        {
          goto LABEL_110;
        }

        if ([bracketSettings exposureValues])
        {
          exposureValues = [bracketSettings exposureValues];
          v36 = off_1E798B9C8;
        }

        else
        {
          if (![bracketSettings manualExposureBracketedCaptureParams])
          {
            goto LABEL_159;
          }

          exposureValues = [bracketSettings manualExposureBracketedCaptureParams];
          v36 = off_1E798BAD0;
        }

        [v8 setObject:exposureValues forKeyedSubscript:*v36];
LABEL_159:
        [v8 setObject:*off_1E798BA10 forKeyedSubscript:*off_1E798BA88];
        if (*(selfCopy + 3377) == 1)
        {
          [v86 frameStatisticsByPortType];
          if ([*(selfCopy + 600) sphereEnabled])
          {
            v54 = *(selfCopy + 3296);
            if (v54)
            {
              isStationary = [v54 isStationary];
            }

            else
            {
              isStationary = 0;
            }

            v60 = ([*(selfCopy + 600) motionDataInvalid] | isStationary) ^ 1;
          }

          else
          {
            LOBYTE(v60) = 0;
          }

          [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", v60 & 1), *off_1E798BB60}];
        }

        if ([bracketSettings2 exposureValues])
        {
          exposureValues2 = [bracketSettings2 exposureValues];
          v68 = off_1E798B9D0;
        }

        else
        {
          if (![bracketSettings2 manualExposureBracketedCaptureParams])
          {
LABEL_203:
            if ([objc_msgSend(objc_msgSend(v89 "stream")])
            {
              [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C558];
            }

            v69 = [objc_msgSend(v89 "sensorIDDictionary")];
            v70 = *off_1E798BC50;
            v71 = [v69 objectForKeyedSubscript:*off_1E798BC50];
            if (v71)
            {
              v105 = v70;
              v106 = v71;
              [v8 setObject:objc_msgSend(MEMORY[0x1E695DF20] forKeyedSubscript:{"dictionaryWithObjects:forKeys:count:", &v106, &v105, 1), *off_1E798B9F8}];
              goto LABEL_110;
            }

            FrameworkRadarComponent = FigCaptureGetFrameworkRadarComponent();
            v104 = 0;
            type = OS_LOG_TYPE_DEFAULT;
            os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
            os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
            fig_log_call_emit_and_clean_up_after_send_and_compose();
            LOWORD(time.value) = 0;
            v66 = _os_log_send_and_compose_impl();
            v77 = 0;
            FigCapturePleaseFileRadar(FrameworkRadarComponent, v66, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10345, @"LastShownDate:BWFigVideoCaptureDevice.m:10345", @"LastShownBuild:BWFigVideoCaptureDevice.m:10345", 0);
            goto LABEL_208;
          }

          exposureValues2 = [bracketSettings2 manualExposureBracketedCaptureParams];
          v68 = off_1E798BAD8;
        }

        [v8 setObject:exposureValues2 forKeyedSubscript:*v68];
        goto LABEL_203;
      }

      if ([bracketSettings exposureValues])
      {
        [v8 setObject:objc_msgSend(bracketSettings forKeyedSubscript:{"exposureValues"), *off_1E798B9C8}];
        [v8 setObject:*off_1E798BA08 forKeyedSubscript:*off_1E798BA88];
        [v86 frameStatisticsByPortType];
        [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", -[BWFigVideoCaptureDevice _shouldUseSphereForStillImageCaptureTakingLowLightIntoAccount:deviceMotionActivity:frameStatisticsByPortType:](selfCopy, 1, 1)), *off_1E798BB60}];
        if (*(selfCopy + 2684) == 1)
        {
          [v8 setObject:&unk_1F22469F0 forKeyedSubscript:*off_1E798C5C0];
        }

        if (bracketSettings2)
        {
          [v8 setObject:objc_msgSend(bracketSettings2 forKeyedSubscript:{"exposureValues"), *off_1E798B9D0}];
        }

        if ([objc_msgSend(objc_msgSend(v89 "stream")])
        {
          [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C558];
        }

        goto LABEL_110;
      }

LABEL_210:
      v77 = v81;
      LODWORD(v75) = 0;
      FigDebugAssert3();
LABEL_140:
      v50 = 0;
      goto LABEL_141;
    }

    if (v22 != 3)
    {
      if (v22 != 4)
      {
        goto LABEL_110;
      }

      if (![bracketSettings exposureValues] && !objc_msgSend(bracketSettings, "manualExposureBracketedCaptureParams") || objc_msgSend(bracketSettings, "exposureValues") && objc_msgSend(bracketSettings, "manualExposureBracketedCaptureParams"))
      {
        goto LABEL_210;
      }

      if ([bracketSettings exposureValues])
      {
        exposureValues3 = [bracketSettings exposureValues];
        v40 = off_1E798B9C8;
      }

      else
      {
        if (![bracketSettings manualExposureBracketedCaptureParams])
        {
LABEL_173:
          [v8 setObject:*off_1E798BA00 forKeyedSubscript:*off_1E798BA88];
          if ([*(selfCopy + 600) hasSphere] && objc_msgSend(bracketSettings, "lensStabilizationEnabledForClientBracket"))
          {
            [v86 frameStatisticsByPortType];
            if ([*(selfCopy + 600) sphereEnabled])
            {
              v59 = [*(selfCopy + 600) motionDataInvalid] ^ 1;
            }

            else
            {
              v59 = 0;
            }

            [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", v59), *off_1E798BB60}];
          }

          goto LABEL_110;
        }

        exposureValues3 = [bracketSettings manualExposureBracketedCaptureParams];
        v40 = off_1E798BAD0;
      }

      [v8 setObject:exposureValues3 forKeyedSubscript:*v40];
      goto LABEL_173;
    }

    if ([bracketSettings oisBracketedCaptureParams])
    {
      oisBracketedCaptureParams = [bracketSettings oisBracketedCaptureParams];
      v53 = off_1E798BB30;
    }

    else
    {
      if (![bracketSettings manualExposureBracketedCaptureParams])
      {
        goto LABEL_166;
      }

      [v8 setObject:objc_msgSend(bracketSettings forKeyedSubscript:{"manualExposureBracketedCaptureParams"), *off_1E798BAD0}];
      oisBracketedCaptureParams = *off_1E798BA00;
      v53 = off_1E798BA88;
    }

    [v8 setObject:oisBracketedCaptureParams forKeyedSubscript:*v53];
LABEL_166:
    [v86 frameStatisticsByPortType];
    if ([*(selfCopy + 600) sphereEnabled])
    {
      v56 = *(selfCopy + 3296);
      if (v56)
      {
        isStationary2 = [v56 isStationary];
      }

      else
      {
        isStationary2 = 0;
      }

      v58 = ([*(selfCopy + 600) motionDataInvalid] | isStationary2) ^ 1;
    }

    else
    {
      LOBYTE(v58) = 0;
    }

    [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", v58 & 1), *off_1E798BB60}];
    if ([bracketSettings2 oisBracketedCaptureParams])
    {
      oisBracketedCaptureParams2 = [bracketSettings2 oisBracketedCaptureParams];
      v62 = off_1E798BB38;
    }

    else
    {
      if (![bracketSettings2 manualExposureBracketedCaptureParams])
      {
LABEL_185:
        if ([objc_msgSend(objc_msgSend(v89 "stream")])
        {
          [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C558];
        }

        if (*(selfCopy + 2176))
        {
          v63 = [objc_msgSend(*(selfCopy + 2192) objectForKeyedSubscript:{objc_msgSend(v89, "portType")), "afWindowParams"}];
        }

        else
        {
          v63 = [objc_msgSend(objc_msgSend(v89 "sensorIDDictionary")];
        }

        if (v63)
        {
          v100 = *off_1E798BC50;
          v101 = v63;
          [v8 setObject:objc_msgSend(MEMORY[0x1E695DF20] forKeyedSubscript:{"dictionaryWithObjects:forKeys:count:", &v101, &v100, 1), *off_1E798B9F8}];
          goto LABEL_110;
        }

        v64 = FigCaptureGetFrameworkRadarComponent();
        v104 = 0;
        type = OS_LOG_TYPE_DEFAULT;
        v65 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        os_log_type_enabled(v65, OS_LOG_TYPE_DEFAULT);
        fig_log_call_emit_and_clean_up_after_send_and_compose();
        LOWORD(time.value) = 0;
        v66 = _os_log_send_and_compose_impl();
        v77 = 0;
        FigCapturePleaseFileRadar(v64, v66, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10380, @"LastShownDate:BWFigVideoCaptureDevice.m:10380", @"LastShownBuild:BWFigVideoCaptureDevice.m:10380", 0);
LABEL_208:
        free(v66);
        goto LABEL_110;
      }

      oisBracketedCaptureParams2 = [bracketSettings2 manualExposureBracketedCaptureParams];
      v62 = off_1E798BAD8;
    }

    [v8 setObject:oisBracketedCaptureParams2 forKeyedSubscript:*v62];
    goto LABEL_185;
  }

  if (*(selfCopy + 2172) == 1)
  {
    v31 = *(selfCopy + 1752);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __119__BWFigVideoCaptureDevice__convertStillImageCaptureSettings_toStillImageCaptureNowOptions_captureStreamPropertyValues___block_invoke;
    block[3] = &unk_1E79904A0;
    block[4] = selfCopy;
    block[5] = &v118;
    dispatch_sync(v31, block);
    if (v119[5])
    {
      [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798B9E8];
      [v84 addEntriesFromDictionary:v119[5]];
    }

    if ([*(selfCopy + 600) sphereEnabled])
    {
      if (*(selfCopy + 2652) < 3)
      {
        [v86 frameStatisticsByPortType];
        v32 = [BWFigVideoCaptureDevice _shouldUseSphereForStillImageCaptureTakingLowLightIntoAccount:selfCopy deviceMotionActivity:1 frameStatisticsByPortType:1];
      }

      else
      {
        [v86 captureType];
        v32 = [BWFigVideoCaptureDevice _ubEnableSphereForCaptureType:selfCopy];
      }

      [v8 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", v32), *off_1E798BB60}];
    }

    if (([v85 captureFlags] & 0x10000) != 0)
    {
      [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C568];
    }

    if (([v82 captureFlags] & 0x10000) != 0)
    {
      [v8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C570];
    }

    goto LABEL_110;
  }

  v50 = 4294954516;
LABEL_141:
  if (![v8 count])
  {

    v8 = 0;
  }

  if (![v84 count])
  {

    v84 = 0;
  }

  *settings = v8;
  *options = v84;
  _Block_object_dispose(&v118, 8);
  return v50;
}

uint64_t __119__BWFigVideoCaptureDevice__convertStillImageCaptureSettings_toStillImageCaptureNowOptions_captureStreamPropertyValues___block_invoke(uint64_t a1)
{
  result = *(*(a1 + 32) + 1784);
  if (result)
  {
    v20 = 0;
    v3 = *MEMORY[0x1E695E480];
    FigBaseObject = FigSampleBufferProcessorGetFigBaseObject();
    v5 = *(*(CMBaseObjectGetVTable() + 8) + 48);
    if (v5)
    {
      v5(FigBaseObject, 0x1F2189F30, v3, &v20);
      if (v20)
      {
        goto LABEL_7;
      }
    }

    v6 = FigSampleBufferProcessorGetFigBaseObject();
    v7 = *(*(CMBaseObjectGetVTable() + 8) + 48);
    if (v7)
    {
      v7(v6, 0x1F218A370, v3, &v20);
    }

    if (v20)
    {
LABEL_7:
      v17[4] = 0;
      v17[5] = 0;
      FigCFDictionaryGetCGFloatIfPresent();
      FigCFDictionaryGetCGFloatIfPresent();
      FigCFDictionaryGetCGFloatIfPresent();
      FigCFDictionaryGetCGFloatIfPresent();
      v18 = 0.0 * 0.5 + 0.5 + -0.45;
      v19 = v18;
      v16[0] = @"x";
      v17[0] = [MEMORY[0x1E696AD98] numberWithDouble:?];
      v16[1] = @"y";
      v17[1] = [MEMORY[0x1E696AD98] numberWithDouble:v18];
      v16[2] = @"w";
      v17[2] = [MEMORY[0x1E696AD98] numberWithDouble:0.0];
      v16[3] = @"h";
      v17[3] = [MEMORY[0x1E696AD98] numberWithDouble:0.0];
      v8 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v17 forKeys:v16 count:4];
      v9 = FigSampleBufferProcessorGetFigBaseObject();
      v10 = *(*(CMBaseObjectGetVTable() + 8) + 56);
      if (v10)
      {
        v10(v9, 0x1F2189F70, v8);
      }

      if (v20)
      {
        CFRelease(v20);
      }
    }

    v11 = *(*(a1 + 40) + 8);
    v12 = FigSampleBufferProcessorGetFigBaseObject();
    VTable = CMBaseObjectGetVTable();
    v14 = *(VTable + 8);
    result = VTable + 8;
    v15 = *(v14 + 48);
    if (v15)
    {
      return v15(v12, 0x1F218A570, v3, v11 + 40);
    }
  }

  return result;
}

- (void)_addNoiseReductionAndSharpeningConfigurationToStillImageCaptureOptions:(void *)options captureSettings:(void *)settings portType:
{
  if (!self)
  {
    return;
  }

  v8 = [BWFigVideoCaptureDevice _captureStreamByPortType:self];
  if (![objc_msgSend(objc_msgSend(v8 "stream")])
  {
    return;
  }

  v9 = [options captureStreamSettingsForPortType:settings];
  v10 = [objc_msgSend(options "frameStatisticsByPortType")];
  v11 = [objc_msgSend(*(self + 624) objectForKeyedSubscript:{@"IspMBNRSupported", "BOOLValue"}];
  v12 = [objc_msgSend(*(self + 624) objectForKeyedSubscript:{@"MultiPassIspMBNRSupported", "BOOLValue"}];
  v13 = [objc_msgSend(options "masterPortType")];
  if ((v11 & 1) == 0 && (!v12 || *(self + 3444) != 1 || ([options captureFlags] & 0x4000) != 0 || !(v13 & 1 | ((*(self + 1593) & 1) == 0))))
  {
    [v10 gain];
    v22 = [v8 noiseReductionAndSharpeningConfigurationForType:0 gain:?];
    if (v22)
    {
      v23 = v22;
      if ([options captureType] == 3 && objc_msgSend(objc_msgSend(v9, "bracketSettings"), "providePreBracketedEV0"))
      {
        v47[0] = v23;
        v47[1] = v23;
        v24 = MEMORY[0x1E695DEC8];
        v25 = v47;
LABEL_36:
        v26 = 2;
        goto LABEL_22;
      }

      v46 = v23;
      v24 = MEMORY[0x1E695DEC8];
      v25 = &v46;
      goto LABEL_21;
    }

    FrameworkRadarComponent = FigCaptureGetFrameworkRadarComponent();
    v56 = 0;
    v55 = 0;
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
    fig_log_call_emit_and_clean_up_after_send_and_compose();
    v53 = 138412290;
    v54 = BWPortTypeToDisplayString(settings, v39);
    v38 = _os_log_send_and_compose_impl();
    FigCapturePleaseFileRadar(FrameworkRadarComponent, v38, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10624, @"LastShownDate:BWFigVideoCaptureDevice.m:10624", @"LastShownBuild:BWFigVideoCaptureDevice.m:10624", 0);
    goto LABEL_42;
  }

  [v10 gain];
  v15 = v14;
  captureFlags = [v9 captureFlags];
  LODWORD(v17) = v15;
  v18 = [v8 noiseReductionAndSharpeningConfigurationForType:1 gain:(captureFlags >> 4) & 1 qSub:v17];
  if (!v18)
  {
    v33 = FigCaptureGetFrameworkRadarComponent();
    v56 = 0;
    v55 = 0;
    v34 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    os_log_type_enabled(v34, OS_LOG_TYPE_DEFAULT);
    fig_log_call_emit_and_clean_up_after_send_and_compose();
    v53 = 138412290;
    v54 = BWPortTypeToDisplayString(settings, v37);
    v38 = _os_log_send_and_compose_impl();
    FigCapturePleaseFileRadar(v33, v38, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10569, @"LastShownDate:BWFigVideoCaptureDevice.m:10569", @"LastShownBuild:BWFigVideoCaptureDevice.m:10569", 0);
    goto LABEL_42;
  }

  v19 = v18;
  captureType = [options captureType];
  v21 = 0;
  if (captureType > 4)
  {
    if ((captureType - 6) >= 2)
    {
      if (captureType == 5)
      {
        [v10 gain];
        v29 = [v8 noiseReductionAndSharpeningConfigurationForType:3 gain:?];
        if (v29)
        {
          v49 = v29;
          v24 = MEMORY[0x1E695DEC8];
          v25 = &v49;
          goto LABEL_21;
        }

        v42 = FigCaptureGetFrameworkRadarComponent();
        v56 = 0;
        v55 = 0;
        v43 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        os_log_type_enabled(v43, OS_LOG_TYPE_DEFAULT);
        fig_log_call_emit_and_clean_up_after_send_and_compose();
        LOWORD(v53) = 0;
        v38 = _os_log_send_and_compose_impl();
        FigCapturePleaseFileRadar(v42, v38, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10597, @"LastShownDate:BWFigVideoCaptureDevice.m:10597", @"LastShownBuild:BWFigVideoCaptureDevice.m:10597", 0);
        goto LABEL_42;
      }

      if ((captureType - 10) >= 4)
      {
        goto LABEL_23;
      }

LABEL_38:
      v32 = [MEMORY[0x1E695DF30] exceptionWithName:*MEMORY[0x1E695D940] reason:objc_msgSend(MEMORY[0x1E696AEC0] userInfo:{"stringWithFormat:", @"Still image capture type '%@' not supported", BWPhotoEncoderStringFromEncodingScheme(objc_msgSend(options, "captureType", 0))), 0}];
      objc_exception_throw(v32);
    }

LABEL_20:
    v48 = v19;
    v24 = MEMORY[0x1E695DEC8];
    v25 = &v48;
    goto LABEL_21;
  }

  if (captureType > 2)
  {
    if (captureType == 3)
    {
      [v10 gain];
      v30 = [v8 noiseReductionAndSharpeningConfigurationForType:2 gain:?];
      if (v30)
      {
        v31 = v30;
        if ([objc_msgSend(v9 "bracketSettings")])
        {
          v52[0] = v19;
          v52[1] = v31;
          v24 = MEMORY[0x1E695DEC8];
          v25 = v52;
          goto LABEL_36;
        }

        v51 = v31;
        v24 = MEMORY[0x1E695DEC8];
        v25 = &v51;
LABEL_21:
        v26 = 1;
LABEL_22:
        v21 = [v24 arrayWithObjects:v25 count:v26];
        goto LABEL_23;
      }

      v40 = FigCaptureGetFrameworkRadarComponent();
      v56 = 0;
      v55 = 0;
      v41 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(v41, OS_LOG_TYPE_DEFAULT);
      fig_log_call_emit_and_clean_up_after_send_and_compose();
      LOWORD(v53) = 0;
      v38 = _os_log_send_and_compose_impl();
      FigCapturePleaseFileRadar(v40, v38, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10578, @"LastShownDate:BWFigVideoCaptureDevice.m:10578", @"LastShownBuild:BWFigVideoCaptureDevice.m:10578", 0);
    }

    else
    {
      [v10 gain];
      v28 = [v8 noiseReductionAndSharpeningConfigurationForType:4 gain:?];
      if (v28)
      {
        v50 = v28;
        v24 = MEMORY[0x1E695DEC8];
        v25 = &v50;
        goto LABEL_21;
      }

      v44 = FigCaptureGetFrameworkRadarComponent();
      v56 = 0;
      v55 = 0;
      v45 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(v45, OS_LOG_TYPE_DEFAULT);
      fig_log_call_emit_and_clean_up_after_send_and_compose();
      LOWORD(v53) = 0;
      v38 = _os_log_send_and_compose_impl();
      FigCapturePleaseFileRadar(v44, v38, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10590, @"LastShownDate:BWFigVideoCaptureDevice.m:10590", @"LastShownBuild:BWFigVideoCaptureDevice.m:10590", 0);
    }

LABEL_42:
    free(v38);
    return;
  }

  if ((captureType - 1) < 2)
  {
    goto LABEL_20;
  }

  if (!captureType)
  {
    goto LABEL_38;
  }

LABEL_23:
  v27 = off_1E798C588;
  if (!v13)
  {
    v27 = off_1E798C590;
  }

  [a2 setObject:v21 forKeyedSubscript:*v27];
}

uint64_t __62__BWFigVideoCaptureDevice__addAutofocusAndDiagnosticMetadata___block_invoke(uint64_t result)
{
  if (*(*(result + 32) + 1784))
  {
    return FigSampleBufferAutofocusProcessorAddTimestampedMetadata(*(*(result + 32) + 1784));
  }

  return result;
}

- (void)setSensorRegionOfInterestForCameraControls:(CGRect)controls forSensorDimensions:(id)dimensions
{
  if (BYTE4(self->_timeOfLastSystemPressureChange) == 1)
  {
    *&self->_maxSystemPressureLevel = controls;
    *&self->_regionOfInterestForCameraControlsNormalizedInSensorSpace.origin.y = dimensions;
    FigCaptureMetadataUtilitiesNormalizeCropRect(controls.origin.x, controls.origin.y, controls.size.width, controls.size.height);
    self->_regionOfInterestForCameraControls.origin.y = v5;
    self->_regionOfInterestForCameraControls.size.width = v6;
    self->_regionOfInterestForCameraControls.size.height = v7;
    self->_regionOfInterestForCameraControlsNormalizedInSensorSpace.origin.x = v8;
  }
}

- (int)setFocusModeAutoWithRect:(CGRect)rect restrictToRect:(BOOL)toRect continuous:(BOOL)continuous smooth:(BOOL)smooth rangeRestrictionNear:(float)near rangeRestrictionFar:(float)far isFocusRectInOverscanSpace:(BOOL)space
{
  v9 = &kFigImageControlSampleBufferProcessorProperty_ContinuousAutoFocus;
  if (!continuous)
  {
    v9 = &kFigImageControlSampleBufferProcessorProperty_FocusScan;
  }

  v10 = *v9;
  focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __153__BWFigVideoCaptureDevice_setFocusModeAutoWithRect_restrictToRect_continuous_smooth_rangeRestrictionNear_rangeRestrictionFar_isFocusRectInOverscanSpace___block_invoke;
  v13[3] = &unk_1E799C190;
  rectCopy = rect;
  spaceCopy = space;
  v13[4] = self;
  continuousCopy = continuous;
  smoothCopy = smooth;
  nearCopy = near;
  farCopy = far;
  toRectCopy = toRect;
  v15 = v10;
  dispatch_sync(focusAndExposureUpdateQueue, v13);
  return 0;
}

- (int)setContinuousAutoFocusRect:(CGRect)rect isFocusRectInOverscanSpace:(BOOL)space
{
  height = rect.size.height;
  width = rect.size.width;
  y = rect.origin.y;
  x = rect.origin.x;
  if (!_FigIsNotCurrentDispatchQueue())
  {
    [BWFigVideoCaptureDevice setContinuousAutoFocusRect:isFocusRectInOverscanSpace:];
  }

  v15 = 0;
  v16 = &v15;
  v17 = 0x2020000000;
  v18 = 0;
  focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __81__BWFigVideoCaptureDevice_setContinuousAutoFocusRect_isFocusRectInOverscanSpace___block_invoke;
  block[3] = &unk_1E799C1B8;
  *&block[6] = x;
  *&block[7] = y;
  *&block[8] = width;
  *&block[9] = height;
  spaceCopy = space;
  block[4] = self;
  block[5] = &v15;
  dispatch_sync(focusAndExposureUpdateQueue, block);
  v11 = *(v16 + 6);
  _Block_object_dispose(&v15, 8);
  return v11;
}

uint64_t __81__BWFigVideoCaptureDevice_setContinuousAutoFocusRect_isFocusRectInOverscanSpace___block_invoke(uint64_t a1)
{
  v2 = 1944;
  if (*(a1 + 80))
  {
    v2 = 3832;
  }

  v3 = 1952;
  if (*(a1 + 80))
  {
    v3 = 3840;
  }

  v4 = 1960;
  if (*(a1 + 80))
  {
    v4 = 3848;
  }

  v5 = FigCaptureTransformNormalizedRectFromCoordinateSpaceOfNormalizedRect(*(a1 + 48), *(a1 + 56), *(a1 + 64), *(a1 + 72), *(*(a1 + 32) + v2), *(*(a1 + 32) + v3), *(*(a1 + 32) + v4));
  v7 = v6;
  v9 = v8;
  v11 = v10;
  v12 = *(a1 + 32);
  [v12 zoomFactor];
  result = [BWFigVideoCaptureDevice _updateAutoFocusAreaOfInterestWithNormalizedRectInSensorSpace:v12 zoomFactor:?];
  *(*(*(a1 + 40) + 8) + 24) = result;
  if (!*(*(*(a1 + 40) + 8) + 24))
  {
    v14 = *(a1 + 32);
    v14[235] = v5;
    *(v14 + 236) = v7;
    *(v14 + 237) = v9;
    *(v14 + 238) = v11;
  }

  return result;
}

__n128 __72__BWFigVideoCaptureDevice_setFocusModeManualWithLensPosition_requestID___block_invoke(uint64_t a1)
{
  v1 = (*(a1 + 32) + 1880);
  result = *MEMORY[0x1E695F050];
  v3 = *(MEMORY[0x1E695F050] + 16);
  *v1 = *MEMORY[0x1E695F050];
  v1[1] = v3;
  return result;
}

- (float)lensPosition
{
  FigSimpleMutexLock();
  v3 = *&self->_observedProperties;
  FigSimpleMutexUnlock();
  return v3;
}

- (void)setCinematicVideoFocus:(id)focus
{
  os_unfair_lock_lock(&self->_sdofLock);
  v5 = *&self->_variableFrameRateUpdateLock._os_unfair_lock_opaque;
  if (v5 != focus)
  {

    *&self->_variableFrameRateUpdateLock._os_unfair_lock_opaque = [focus mutableCopy];
  }

  os_unfair_lock_unlock(&self->_sdofLock);
}

- (void)setRegionOfInterestWithoutOverscan:(CGRect)overscan
{
  *&self->_cachedFocusRectNormalizedInSensorSpace.size.height = overscan;
  y = self->_regionOfInterestForCameraControlsNormalizedInSensorSpace.origin.y;
  if (SLODWORD(y) > 0 && SHIDWORD(y) > 0)
  {
    v5 = LODWORD(y);
  }

  else
  {
    v5 = overscan.size.width + overscan.origin.x * 2.0;
  }

  height = self->_regionOfInterestWithoutOverscan.size.height;
  x = self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.origin.x;
  v8 = self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.origin.y;
  width = self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.width;
  v16.origin.x = FigCaptureMetadataUtilitiesRectNormalizedToRect(overscan.origin.x, overscan.origin.y, overscan.size.width, overscan.size.height, 0.0, 0.0, v5);
  v16.origin.y = v10;
  v16.size.width = v11;
  v16.size.height = v12;
  self->_regionOfInterestWithoutOverscan.size.height = v16.origin.x;
  self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.origin.x = v10;
  self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.origin.y = v11;
  self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.width = v12;
  v15.origin.x = height;
  v15.origin.y = x;
  v15.size.width = v8;
  v15.size.height = width;
  if (!CGRectEqualToRect(v15, v16))
  {
    focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __62__BWFigVideoCaptureDevice_setRegionOfInterestWithoutOverscan___block_invoke;
    block[3] = &unk_1E79914E0;
    block[4] = self;
    *&block[5] = height;
    *&block[6] = x;
    *&block[7] = v8;
    *&block[8] = width;
    dispatch_sync(focusAndExposureUpdateQueue, block);
  }
}

uint64_t __62__BWFigVideoCaptureDevice_setRegionOfInterestWithoutOverscan___block_invoke(uint64_t a1)
{
  v1 = a1 + 32;
  [*(*(a1 + 32) + 2952) requestedZoomFactor];
  if (!CGRectIsEmpty(*(*v1 + 1880)))
  {
    __62__BWFigVideoCaptureDevice_setRegionOfInterestWithoutOverscan___block_invoke_cold_1();
  }

  result = CGRectIsEmpty(*(*v1 + 1840));
  if ((result & 1) == 0)
  {
    return __62__BWFigVideoCaptureDevice_setRegionOfInterestWithoutOverscan___block_invoke_cold_2();
  }

  return result;
}

- (CGRect)regionOfInterestWithoutOverscan
{
  height = self->_cachedFocusRectNormalizedInSensorSpace.size.height;
  x = self->_regionOfInterestWithoutOverscan.origin.x;
  y = self->_regionOfInterestWithoutOverscan.origin.y;
  width = self->_regionOfInterestWithoutOverscan.size.width;
  result.size.height = width;
  result.size.width = y;
  result.origin.y = x;
  result.origin.x = height;
  return result;
}

__n128 __48__BWFigVideoCaptureDevice_setExposureModeLocked__block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  result = *MEMORY[0x1E695F050];
  v3 = *(MEMORY[0x1E695F050] + 16);
  *(v1 + 1840) = *MEMORY[0x1E695F050];
  *(v1 + 1856) = v3;
  return result;
}

__n128 __109__BWFigVideoCaptureDevice_setExposureModeCustomWithExposureDuration_minFrameRate_maxFrameRate_ISO_requestID___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  result = *MEMORY[0x1E695F050];
  v3 = *(MEMORY[0x1E695F050] + 16);
  *(v1 + 1840) = *MEMORY[0x1E695F050];
  *(v1 + 1856) = v3;
  return result;
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)exposureDuration
{
  FigSimpleMutexLock();
  *&retstr->var0 = *(&self->_observedProperties + 4);
  retstr->var3 = *(&self->_lensPosition + 1);

  return FigSimpleMutexUnlock();
}

- (float)ISO
{
  FigSimpleMutexLock();
  v3 = *(&self->_exposureDuration.value + 1);
  FigSimpleMutexUnlock();
  return v3;
}

- (float)exposureTargetOffset
{
  FigSimpleMutexLock();
  v3 = *&self->_exposureDuration.flags;
  FigSimpleMutexUnlock();
  return v3;
}

- (void)setMaxExposureDurationClientOverride:(id *)override
{
  v13 = *MEMORY[0x1E6960C68];
  v5 = *(MEMORY[0x1E6960C68] + 16);
  v23.epoch = v5;
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  *&v23.value = v13;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v19 objects:v18 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v20;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v20 != v9)
        {
          objc_enumerationMutation(captureStreams);
        }

        v11 = *(*(&v19 + 1) + 8 * i);
        memset(&time1, 0, sizeof(time1));
        if (v11)
        {
          time2 = *override;
          [(BWFigVideoCaptureStream *)v11 updateMaxExposureDurationClientOverride:&time2];
        }

        if (v11 == self->_captureStream)
        {
          v23 = time1;
        }

        if (v11 == self->_bravoTelephotoCaptureStream)
        {
          [(BWFigVideoCaptureStream *)v11 maxEIT];
          [(BWBravoStreamSelector *)self->_bravoStreamSelector setTeleMaxEIT:?];
        }
      }

      v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v19 objects:v18 count:16];
    }

    while (v8);
  }

  time1 = v23;
  *&time2.value = v13;
  time2.epoch = v5;
  if (CMTimeCompare(&time1, &time2))
  {
    v12 = *MEMORY[0x1E695E480];
    time1 = v23;
    v14 = @"NewPropertyValue";
    v15 = CMTimeCopyAsDictionary(&time1, v12);
    -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"MaxExposureDurationChanged", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v15 forKeys:&v14 count:1]);
  }
}

- (void)setVideoStabilizationStrength:(int)strength
{
  v3 = *&strength;
  HIDWORD(self->_defaultContinuousAutoFocusWindowSize.width) = strength;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  captureStreams = self->_captureStreams;
  v6 = [(NSArray *)captureStreams countByEnumeratingWithState:&v11 objects:v10 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v12;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v12 != v8)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v11 + 1) + 8 * i) setVideoStabilizationStrength:v3];
      }

      v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v11 objects:v10 count:16];
    }

    while (v7);
  }

  if (SHIDWORD(self->_defaultContinuousAutoFocusWindowSize.width) >= 3)
  {
    os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
    *&self->_streamingImageIntentNeedsUpdate = 8;
    self->_learnedNRUltraHighResolutionDowngradeEnabled = 1;
    os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  }
}

- (void)setConfiguresStreamingImageIntentForActionCamera:(BOOL)camera
{
  LOBYTE(self->_defaultContinuousAutoFocusWindowSize.height) = camera;
  if (camera)
  {
    os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
    *&self->_streamingImageIntentNeedsUpdate = 8;
    self->_learnedNRUltraHighResolutionDowngradeEnabled = 1;

    os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  }
}

- (void)setStereoVideoCaptureEnabled:(BOOL)enabled
{
  if (self->_stereoVideoCaptureEnabled != enabled)
  {
    self->_stereoVideoCaptureEnabled = enabled;
    [(BWFigVideoCaptureDevice *)self _updateParallaxMitigationBasedOnZoomFactorEnabled];
  }
}

- (int)stereoVideoCaptureStatus
{
  os_unfair_lock_lock(&self->_stereoVideoCaptureSceneMonitorLock);
  stereoVideoCaptureStatus = self->_stereoVideoCaptureStatus;
  os_unfair_lock_unlock(&self->_stereoVideoCaptureSceneMonitorLock);
  return stereoVideoCaptureStatus;
}

- (void)setStereoPhotoCaptureEnabled:(BOOL)enabled
{
  if (self->_stereoPhotoCaptureEnabled != enabled)
  {
    v17 = v3;
    v18 = v4;
    self->_stereoPhotoCaptureEnabled = enabled;
    if (enabled)
    {
      dictionary = [MEMORY[0x1E695DF90] dictionary];
      v13 = 0u;
      v14 = 0u;
      v15 = 0u;
      v16 = 0u;
      activePortTypes = self->_activePortTypes;
      v8 = [(NSArray *)activePortTypes countByEnumeratingWithState:&v13 objects:v12 count:16];
      if (v8)
      {
        v9 = v8;
        v10 = *v14;
        do
        {
          for (i = 0; i != v9; ++i)
          {
            if (*v14 != v10)
            {
              objc_enumerationMutation(activePortTypes);
            }

            [dictionary setObject:-[BWMovingWindowStats initWithWindowSize:]([BWMovingWindowStats alloc] forKeyedSubscript:{"initWithWindowSize:", 6), *(*(&v13 + 1) + 8 * i)}];
          }

          v9 = [(NSArray *)activePortTypes countByEnumeratingWithState:&v13 objects:v12 count:16];
        }

        while (v9);
      }

      self->_stereoPhotoSNRSimpleMovingAverageByPortType = [objc_alloc(MEMORY[0x1E695DF20]) initWithDictionary:dictionary];
      self->_stereoPhotoLastSceneSNRByPortType = objc_alloc_init(MEMORY[0x1E695DF90]);
    }

    else
    {

      self->_stereoPhotoSNRSimpleMovingAverageByPortType = 0;
      self->_stereoPhotoLastSceneSNRByPortType = 0;
    }
  }
}

- (int)setAutomaticallyAdjustsImageControlMode:(BOOL)mode
{
  v8 = 0;
  v9 = &v8;
  v10 = 0x2020000000;
  v11 = 0;
  autofocusProcessorQueue = self->_autofocusProcessorQueue;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __67__BWFigVideoCaptureDevice_setAutomaticallyAdjustsImageControlMode___block_invoke;
  block[3] = &unk_1E799C298;
  modeCopy = mode;
  block[4] = self;
  block[5] = &v8;
  dispatch_sync(autofocusProcessorQueue, block);
  v4 = *(v9 + 6);
  _Block_object_dispose(&v8, 8);
  return v4;
}

- (uint64_t)_setAutoImageControlMode:(void *)mode completionHandler:
{
  selfCopy = self;
  if (self)
  {
    v75 = 0;
    v76 = &v75;
    v77 = 0x2020000000;
    v78 = 0;
    v71 = 0;
    v72 = &v71;
    v73 = 0x2020000000;
    v74 = a2;
    v6 = *(self + 1752);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __70__BWFigVideoCaptureDevice__setAutoImageControlMode_completionHandler___block_invoke;
    block[3] = &unk_1E799C2C0;
    v70 = a2;
    block[4] = selfCopy;
    block[5] = &v75;
    block[6] = &v71;
    dispatch_sync(v6, block);
    v7 = *(v72 + 6);
    if (mode && v7 == a2)
    {
      v8 = *(v76 + 6);
      if (dword_1ED844350)
      {
        v68 = 0;
        v67 = OS_LOG_TYPE_DEFAULT;
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
        fig_log_call_emit_and_clean_up_after_send_and_compose();
      }

      v10 = mode[2];
      v65 = *MEMORY[0x1E6960C70];
      v66 = *(MEMORY[0x1E6960C70] + 16);
      v10(mode, v8 == 0, &v65);
      v7 = *(v72 + 6);
    }

    if (v7 != a2)
    {
      if (*(selfCopy + 3946) == 1)
      {
        *(selfCopy + 2016) = a2 == 2;
        if (a2 == 2)
        {
          dictionary = 0;
        }

        else
        {
          dictionary = [MEMORY[0x1E695DF90] dictionary];
        }

        v63 = 0u;
        v64 = 0u;
        v61 = 0u;
        v62 = 0u;
        v18 = *(selfCopy + 656);
        v19 = [v18 countByEnumeratingWithState:&v61 objects:&v45 count:{16, v39, v41}];
        if (v19)
        {
          v20 = *v62;
          do
          {
            for (i = 0; i != v19; ++i)
            {
              if (*v62 != v20)
              {
                objc_enumerationMutation(v18);
              }

              if (a2 != 2)
              {
                v22 = *(*(&v61 + 1) + 8 * i);
                [v22 setSphereVideoEnabled:0];
                [dictionary setObject:objc_msgSend(v22 forKeyedSubscript:{"currentSphereMode"), objc_msgSend(v22, "portType")}];
              }
            }

            v19 = [v18 countByEnumeratingWithState:&v61 objects:&v45 count:16];
          }

          while (v19);
        }

        if (mode)
        {
          v23 = objc_alloc_init(BWImageControlModeTransitionMonitor);
          [(BWImageControlModeTransitionMonitor *)v23 setExpectedSphereModesByPortType:dictionary];
          if (a2 == 2)
          {
            [(BWImageControlModeTransitionMonitor *)v23 setCoarseFocusCheckTimeout:*(selfCopy + 2024)];
            [(BWImageControlModeTransitionMonitor *)v23 setWaitForTorchToRampUp:1];
          }
        }

        else
        {
          v23 = 0;
        }

        os_unfair_lock_lock((selfCopy + 2032));

        *(selfCopy + 2040) = v23;
        v24 = *(selfCopy + 2048);
        *(selfCopy + 2048) = [mode copy];
        os_unfair_lock_unlock((selfCopy + 2032));
        if (v24)
        {
          if (dword_1ED844350)
          {
            v68 = 0;
            v67 = OS_LOG_TYPE_DEFAULT;
            v25 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
            v26 = v68;
            if (os_log_type_enabled(v25, v67))
            {
              v27 = v26;
            }

            else
            {
              v27 = v26 & 0xFFFFFFFE;
            }

            if (v27)
            {
              *v43 = 136315138;
              *&v43[4] = "[BWFigVideoCaptureDevice _setAutoImageControlMode:completionHandler:]";
              LODWORD(v42) = 12;
              v40 = v43;
              _os_log_send_and_compose_impl();
            }

            fig_log_call_emit_and_clean_up_after_send_and_compose();
          }

          v28 = v24[2];
          v65 = *MEMORY[0x1E6960C70];
          v66 = *(MEMORY[0x1E6960C70] + 16);
          v28(v24, 0, &v65);
        }

        os_unfair_lock_lock((selfCopy + 2140));
        if (a2 == 2)
        {
          if (*(selfCopy + 2280) != 3 && dword_1ED844350)
          {
            v68 = 0;
            v67 = OS_LOG_TYPE_DEFAULT;
            v34 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
            v35 = v68;
            if (os_log_type_enabled(v34, v67))
            {
              v36 = v35;
            }

            else
            {
              v36 = v35 & 0xFFFFFFFE;
            }

            if (v36)
            {
              v37 = fvcd_streamingImageIntentToString(*(selfCopy + 2280));
              *v43 = 136315650;
              *&v43[4] = "[BWFigVideoCaptureDevice _setAutoImageControlMode:completionHandler:]";
              *&v43[12] = 2112;
              *&v43[14] = v37;
              *&v43[22] = 2112;
              v44 = @"MomentCaptureVideoRecording";
              _os_log_send_and_compose_impl();
            }

            fig_log_call_emit_and_clean_up_after_send_and_compose();
          }

          *(selfCopy + 2280) = 3;
          *(selfCopy + 2272) = 1;
        }

        else
        {
          [(BWFigVideoCaptureDevice *)selfCopy _updateStreamingImageIntentWithNewImageControlMode:a2 oldImageControlMode:*(v72 + 6), v29, v30, v31, v32, v33, v40, v42, *v43, *&v43[8], *&v43[16], v44, v45, v46, v47, v48, v49, v50, v51, v52, v53, v54, v55, v56, v57, v58, v59, v60, v61, SWORD4(v61), SBYTE10(v61), BYTE11(v61)];
        }

        os_unfair_lock_unlock((selfCopy + 2140));
        v38 = [(BWFigVideoCaptureDevice *)selfCopy _setSmoothFocusEnabled:?];
        *(v76 + 6) = v38;
      }

      else
      {
        os_unfair_lock_lock((selfCopy + 2140));
        [(BWFigVideoCaptureDevice *)selfCopy _updateStreamingImageIntentWithNewImageControlMode:a2 oldImageControlMode:*(v72 + 6), v11, v12, v13, v14, v15, v39, v41, *v43, *&v43[8], *&v43[16], v44, v45, v46, v47, v48, v49, v50, v51, v52, v53, v54, v55, v56, v57, v58, v59, v60, v61, SWORD4(v61), SBYTE10(v61), BYTE11(v61)];
        os_unfair_lock_unlock((selfCopy + 2140));
      }
    }

    selfCopy = *(v76 + 6);
    _Block_object_dispose(&v71, 8);
    _Block_object_dispose(&v75, 8);
  }

  return selfCopy;
}

uint64_t __70__BWFigVideoCaptureDevice__setAutoImageControlMode_completionHandler___block_invoke(uint64_t a1)
{
  v4 = *(a1 + 56);
  result = a1 + 56;
  v3 = v4;
  v5 = *(result - 24);
  if (*(v5 + 2008) != v4)
  {
    *(v5 + 2008) = v3;
    v6 = *(a1 + 32);
    if (*(v6 + 2004) == 1)
    {
      v7 = *(v6 + 2012);
      if (*(v6 + 2008) != v7)
      {
        return __70__BWFigVideoCaptureDevice__setAutoImageControlMode_completionHandler___block_invoke_cold_1(result, v6, a1, v7);
      }
    }
  }

  return result;
}

- (int)setImageControlMode:(int)mode
{
  v8 = 0;
  v9 = &v8;
  v10 = 0x2020000000;
  v11 = 0;
  autofocusProcessorQueue = self->_autofocusProcessorQueue;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __47__BWFigVideoCaptureDevice_setImageControlMode___block_invoke;
  block[3] = &unk_1E799C2E8;
  block[4] = self;
  block[5] = &v8;
  modeCopy = mode;
  dispatch_sync(autofocusProcessorQueue, block);
  v4 = *(v9 + 6);
  _Block_object_dispose(&v8, 8);
  return v4;
}

uint64_t __47__BWFigVideoCaptureDevice_setImageControlMode___block_invoke(uint64_t a1)
{
  if ((*(*(a1 + 32) + 2004) & 1) == 0)
  {
    return __47__BWFigVideoCaptureDevice_setImageControlMode___block_invoke_cold_1();
  }

  result = FigSignalErrorAtGM();
  *(*(*(a1 + 40) + 8) + 24) = result;
  return result;
}

unint64_t __72__BWFigVideoCaptureDevice_setWhiteBalanceModeLockedWithGains_requestID___block_invoke(uint64_t a1)
{
  v2 = [MEMORY[0x1E696B098] valueWithBytes:a1 + 44 objCType:"{?=fff}"];
  [*(*(a1 + 32) + 2928) setObject:v2 forKeyedSubscript:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", *(a1 + 40))}];
  [*(*(a1 + 32) + 2936) insertObject:objc_msgSend(MEMORY[0x1E696AD98] atIndex:{"numberWithInt:", *(a1 + 40)), 0}];
  result = [*(*(a1 + 32) + 2928) count];
  if (result >= 0x1E)
  {
    v4 = [*(*(a1 + 32) + 2936) count];
    v5 = v4 - ([*(*(a1 + 32) + 2936) count] >> 1);
    v6 = [*(*(a1 + 32) + 2936) count];
    v7 = [*(*(a1 + 32) + 2936) objectsAtIndexes:{objc_msgSend(MEMORY[0x1E696AC90], "indexSetWithIndexesInRange:", v5, v6 >> 1)}];
    [*(*(a1 + 32) + 2928) removeObjectsForKeys:v7];
    v8 = *(*(a1 + 32) + 2936);

    return [v8 removeObjectsInArray:v7];
  }

  return result;
}

- ($E2C29196C7A5C696474C6955C5A9CE06)deviceWhiteBalanceGains
{
  FigSimpleMutexLock();
  v3 = *&self->_exposureDuration.epoch;
  v4 = *(&self->_exposureDuration.epoch + 1);
  ISO = self->_ISO;
  FigSimpleMutexUnlock();
  v6 = v3;
  v7 = v4;
  v8 = ISO;
  result.var2 = v8;
  result.var1 = v7;
  result.var0 = v6;
  return result;
}

- ($E2C29196C7A5C696474C6955C5A9CE06)grayWorldDeviceWhiteBalanceGains
{
  FigSimpleMutexLock();
  exposureTargetBias = self->_exposureTargetBias;
  exposureTargetOffset = self->_exposureTargetOffset;
  redGain = self->_deviceWhiteBalanceGains.redGain;
  FigSimpleMutexUnlock();
  v6 = exposureTargetBias;
  v7 = exposureTargetOffset;
  v8 = redGain;
  result.var2 = v8;
  result.var1 = v7;
  result.var0 = v6;
  return result;
}

uint64_t __60__BWFigVideoCaptureDevice__addExifMetadata_fromTimeMachine___block_invoke(uint64_t a1)
{
  *(*(*(a1 + 48) + 8) + 24) = *(*(a1 + 32) + 2944);
  result = [*(a1 + 40) intValue];
  if (result >= 1)
  {
    result = [*(*(a1 + 32) + 2928) objectForKeyedSubscript:*(a1 + 40)];
    *(*(*(a1 + 56) + 8) + 40) = result;
  }

  return result;
}

uint64_t __60__BWFigVideoCaptureDevice__addExifMetadata_fromTimeMachine___block_invoke_4(uint64_t result)
{
  v1 = *(result + 32);
  if (*(v1 + 2944) == 1)
  {
    v2 = result;
    [*(v1 + 2928) removeAllObjects];
    result = [*(*(v2 + 32) + 2936) removeAllObjects];
    *(*(v2 + 32) + 2944) = 0;
  }

  return result;
}

- (int)setFaceDetectionDrivenImageProcessingMode:(int)mode
{
  v5 = 0;
  if (mode > 1)
  {
    if (mode == 2)
    {
      v6 = &kFigAutofocusSampleBufferProcessorFaceDetectionMode_Disable;
      v7 = BYTE1(self->_variableFrameRateLastRequestedAEMaxGainByPortType);
      v8 = &kFigAutofocusSampleBufferProcessorFaceDetectionMode_AF;
    }

    else
    {
      if (mode != 3)
      {
        goto LABEL_13;
      }

      v6 = &kFigAutofocusSampleBufferProcessorFaceDetectionMode_AE;
      v7 = BYTE1(self->_variableFrameRateLastRequestedAEMaxGainByPortType);
      v8 = &kFigAutofocusSampleBufferProcessorFaceDetectionMode_AEAndAF;
    }

    if (!v7)
    {
      v6 = v8;
    }

    v5 = *v6;
  }

  else if (mode)
  {
    if (mode == 1)
    {
      v5 = @"AEOnly";
    }
  }

  else
  {
    v5 = @"Disable";
  }

LABEL_13:
  if (self->_faceDetectionDrivenImageProcessingModeString == v5)
  {
    return 0;
  }

  v11 = v3;
  v12 = v4;
  [(BWFigVideoCaptureDevice *)self setFaceDetectionDrivenImageProcessingMode:v5, &self->_faceDetectionDrivenImageProcessingModeString, &v10];
  return v10;
}

- (int)setTorchLevel:(float)level
{
  FigSimpleMutexLock();
  v5 = *(&self->_autoTorchRampedUpTime.epoch + 1);
  if (level == -3.4028e38)
  {
    levelCopy = *&self->_autoTorchRampedUpTime.epoch;
    if (levelCopy <= v5)
    {
      goto LABEL_4;
    }

    goto LABEL_3;
  }

  levelCopy = level;
  if (level == 3.4028e38)
  {
LABEL_3:
    levelCopy = *(&self->_autoTorchRampedUpTime.epoch + 1);
  }

LABEL_4:
  if (levelCopy > v5)
  {
    [BWFigVideoCaptureDevice setTorchLevel:];
    v13 = 0;
    v11 = 0;
    v12 = 0;
    v10 = -16540;
  }

  else
  {
    v7 = *&self->_autoTorchRampedUpTime.epoch;
    if (levelCopy == v7)
    {
      v10 = 0;
    }

    else
    {
      stream = [(BWFigVideoCaptureStream *)self->_captureStream stream];
      *&v9 = levelCopy;
      v10 = -[BWFigCaptureStream setProperty:value:](stream, "setProperty:value:", *off_1E798C230, [MEMORY[0x1E696AD98] numberWithFloat:v9]);
      if (v10)
      {
        levelCopy = 0.0;
      }

      v7 = *&self->_autoTorchRampedUpTime.epoch;
    }

    v11 = levelCopy != v7;
    if (levelCopy != v7)
    {
      *&self->_autoTorchRampedUpTime.epoch = levelCopy;
    }

    v12 = levelCopy > 0.0;
    if (BYTE1(self->_autoTorchRampedUpTime.flags) == v12)
    {
      v13 = 0;
    }

    else
    {
      BYTE1(self->_autoTorchRampedUpTime.flags) = v12;
      v13 = 1;
    }
  }

  FigSimpleMutexUnlock();
  if (level == -3.4028e38)
  {
    v20 = @"NewPropertyValue";
    v21 = [MEMORY[0x1E696AD98] numberWithBool:v5 < 1.0];
    -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"TorchOverheated", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v21 forKeys:&v20 count:1]);
  }

  if (v13)
  {
    v18 = @"NewPropertyValue";
    v19 = [MEMORY[0x1E696AD98] numberWithBool:v12];
    -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"TorchActive", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v19 forKeys:&v18 count:1]);
  }

  if (v11)
  {
    *&v14 = levelCopy;
    v17 = [MEMORY[0x1E696AD98] numberWithFloat:{v14, @"NewPropertyValue"}];
    -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"TorchLevel", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v17 forKeys:&v16 count:1]);
    os_unfair_lock_lock(&self->_clientAuditTokenLock);
    FigCaptureLogTorchPowerEvent(self->_clientPID, self->_applicationID, levelCopy);
    os_unfair_lock_unlock(&self->_clientAuditTokenLock);
  }

  return v10;
}

- (float)torchLevel
{
  FigSimpleMutexLock();
  v3 = *&self->_autoTorchRampedUpTime.epoch;
  FigSimpleMutexUnlock();
  return v3;
}

- (void)setMaxTorchLevel:(float)level
{
  FigSimpleMutexLock();
  *(&self->_autoTorchRampedUpTime.epoch + 1) = level;
  FigSimpleMutexUnlock();
  LODWORD(v5) = -8388609;

  [(BWFigVideoCaptureDevice *)self setTorchLevel:v5];
}

- (int)setAutomaticallyAdjustsTorch:(BOOL)torch
{
  torchCopy = torch;
  FigSimpleMutexLock();
  if (LOBYTE(self->_torchLock) != torchCopy)
  {
    LOBYTE(self->_torchLock) = torchCopy;
    BYTE1(self->_torchLock) = 0;
    LOBYTE(self->_autoTorchRampedUpTime.flags) = 0;
  }

  FigSimpleMutexUnlock();
  return 0;
}

- (void)_serviceAutoTorchNotification:(uint64_t)notification sampleBuffer:(void *)buffer
{
  if (notification)
  {
    v29 = 0;
    v30 = &v29;
    v31 = 0x2020000000;
    v32 = 0;
    if (!buffer)
    {
      FigDebugAssert3();
LABEL_31:
      _Block_object_dispose(&v29, 8);
      return;
    }

    v4 = *(notification + 1752);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __70__BWFigVideoCaptureDevice__serviceAutoTorchNotification_sampleBuffer___block_invoke;
    block[3] = &unk_1E798FAF8;
    block[4] = notification;
    block[5] = &v29;
    dispatch_sync(v4, block);
    FigSimpleMutexLock();
    v5 = -1.0;
    if (*(notification + 2592) == 1 && *(notification + 2628) > 0.0)
    {
      v6 = *(v30 + 6);
      v7 = v6 != 2;
      if (v6 == 2)
      {
        if ((*(notification + 2593) & 1) == 0 && ([buffer frameCount] > 3 || *(notification + 4347) == 1))
        {
          v9 = *(notification + 1392);
          if (!v9)
          {
            v9 = *(notification + 600);
          }

          v10 = [buffer objectForKeyedSubscript:{objc_msgSend(v9, "portType")}];
          if ([v10 isValid])
          {
            [v10 normalizedSNR];
            v12 = v11;
            [objc_msgSend(*(notification + 2512) objectForKeyedSubscript:{objc_msgSend(v9, "portType")), "floatValue"}];
            v14 = v12 < v13;
            if (v12 >= v13)
            {
              v5 = 0.0;
            }

            else
            {
              v5 = 3.4028e38;
            }

            *(notification + 2593) = 1;
            if (v14)
            {
              HostTimeClock = CMClockGetHostTimeClock();
              CMClockGetTime(&lhs, HostTimeClock);
              CMTimeMake(&rhs, 120, 1000);
              CMTimeAdd(&v27, &lhs, &rhs);
              v22 = 0;
              v8 = 0;
              *(notification + 2596) = v27;
            }

            else
            {
              v22 = 0;
              v8 = 0;
            }

            goto LABEL_33;
          }
        }
      }

      else
      {
        *(notification + 2593) = 0;
        if (*(notification + 2624) != 0.0)
        {
          v8 = 0;
          v7 = 0;
          v5 = 0.0;
LABEL_27:
          FigSimpleMutexUnlock();
          if (v5 != -1.0)
          {
            *&v21 = v5;
            [notification setTorchLevel:v21];
          }

          if (v7)
          {
            v23 = @"NewPropertyValue";
            v24 = [MEMORY[0x1E696AD98] numberWithBool:v8];
            [notification _postNotificationWithPayload:@"TorchActive" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v24, &v23, 1)}];
          }

          goto LABEL_31;
        }

        v16 = *(notification + 1392);
        if (!v16)
        {
          v16 = *(notification + 600);
        }

        v17 = [buffer objectForKeyedSubscript:{objc_msgSend(v16, "portType")}];
        if ([v17 isValid])
        {
          [v17 normalizedSNR];
          v19 = v18;
          [objc_msgSend(*(notification + 2512) objectForKeyedSubscript:{objc_msgSend(v16, "portType")), "floatValue"}];
          v8 = v19 < v20;
          if (*(notification + 2621) != v8)
          {
            *(notification + 2621) = v8;
            v22 = v19 < v20;
LABEL_33:
            *(notification + 2620) = v22;
            goto LABEL_27;
          }

LABEL_26:
          v7 = 0;
          goto LABEL_27;
        }
      }
    }

    v8 = 0;
    goto LABEL_26;
  }
}

- (int)setStillImageSceneMonitoringFlashMode:(int)mode hdrMode:(int)hdrMode qualityPrioritization:(int)prioritization digitalFlashMode:(int)flashMode
{
  flashModeCopy2 = flashMode;
  v17 = 0;
  v18 = &v17;
  v19 = 0x2020000000;
  v20 = 0;
  if (flashMode && (BYTE1(self->_globalToneMappingEnabledOverride) & 1) == 0)
  {
    if (BYTE4(self->_exifFocalLengthsByZoomFactor))
    {
      flashModeCopy2 = 0;
    }

    else
    {
      flashModeCopy2 = flashMode;
    }
  }

  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  torchLevel = self->_torchLevel;
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  if ((hdrMode & 0xFFFFFFFD) == 0 && LODWORD(torchLevel) != hdrMode)
  {
    autofocusProcessorQueue = self->_autofocusProcessorQueue;
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __112__BWFigVideoCaptureDevice_setStillImageSceneMonitoringFlashMode_hdrMode_qualityPrioritization_digitalFlashMode___block_invoke;
    block[3] = &unk_1E799C2E8;
    hdrModeCopy = hdrMode;
    block[4] = self;
    block[5] = &v17;
    dispatch_sync(autofocusProcessorQueue, block);
  }

  if (*(v18 + 6))
  {
    FigDebugAssert3();
  }

  else
  {
    os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
    *&self->_torchWillBeEnabledForVideoRecording = mode;
    LODWORD(self->_torchLevel) = hdrMode;
    LODWORD(self->_maxTorchLevel) = prioritization;
    LODWORD(self->_ubAdaptiveBracketingController) = flashModeCopy2;
    HIBYTE(self->_flashModeForSceneMonitoring) = 1;
    os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  }

  v13 = *(v18 + 6);
  _Block_object_dispose(&v17, 8);
  return v13;
}

- (BOOL)setAutoFlashEnabled:(BOOL)enabled error:(id *)error
{
  if (enabled)
  {
    v5 = 2;
  }

  else
  {
    v5 = 0;
  }

  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  torchLevel_low = LODWORD(self->_torchLevel);
  maxTorchLevel_low = LODWORD(self->_maxTorchLevel);
  ubAdaptiveBracketingController_low = LODWORD(self->_ubAdaptiveBracketingController);
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  [(BWFigVideoCaptureDevice *)self setStillImageSceneMonitoringFlashMode:v5 hdrMode:torchLevel_low qualityPrioritization:maxTorchLevel_low digitalFlashMode:ubAdaptiveBracketingController_low];
  return 1;
}

- (void)setStillImageStabilizationSceneDetectionEnabled:(BOOL)enabled
{
  if (enabled)
  {
    v4 = 2;
  }

  else
  {
    v4 = 1;
  }

  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  v5 = *&self->_torchWillBeEnabledForVideoRecording;
  torchLevel_low = LODWORD(self->_torchLevel);
  ubAdaptiveBracketingController_low = LODWORD(self->_ubAdaptiveBracketingController);
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);

  [(BWFigVideoCaptureDevice *)self setStillImageSceneMonitoringFlashMode:v5 hdrMode:torchLevel_low qualityPrioritization:v4 digitalFlashMode:ubAdaptiveBracketingController_low];
}

- (void)setZoomFactor:(float)factor
{
  if (LOBYTE(self->_zoomRampTuning.jumpFrontFacingZoomOut[1].friction) == 1)
  {
    firstObject = [(NSArray *)[(BWFigVideoCaptureDevice *)self captureStreams] firstObject];
    *&v6 = factor;
    [firstObject setCmioZoomFactor:v6];
  }

  else if (self->_previewVideoDepthNodeUnprepared)
  {
    [-[BWZoomRange referencedObject](self->_depthDataDeliveryZoomRange "referencedObject")];
  }

  else
  {
    [(NSMutableDictionary *)self->_whiteBalanceGains setRequestedZoomFactor:*&factor];
    v7 = *&self->_minimumTimeBetweenStationaryChecks;
    [(NSMutableDictionary *)self->_whiteBalanceGains requestedZoomFactor];
    [v7 requestedZoomFactorChanged:?];
  }

  if (self->_smartFramingEnabled)
  {
    [(BWFigVideoCaptureDevice *)self aspectRatio];

    [BWFigVideoCaptureDevice _updateSmartFramingFieldOfViewWithAspectRatio:factor zoomFactor:?];
  }
}

- (void)rampToVideoZoomFactor:(float)factor withRampType:(int)type rate:(float)rate duration:(double)duration commandID:(int)d
{
  v7 = *&d;
  v10 = *&type;
  [(NSMutableDictionary *)self->_whiteBalanceGains applyFudgeToZoomFactor:?];
  v14 = v13;
  v15 = [(BWFigVideoCaptureDevice *)self _isBaseZoomFactorOrNondisruptiveSwitchingFormatBaseZoomFactor:v13];
  v21 = v15;
  if (v10 == 2 && (self->_activeSensorRegionForCameraControls.width & 1) != 0 && self->_lumaHistogramsEnabled)
  {
    v22 = duration != 0.25;
    v16 = 0.5;
    if (duration == 0.5)
    {
      v22 = 0;
    }

    if (v22 & v15)
    {
      zoomFactorUpdateQueue_high = 0;
      duration = 0.0;
      v10 = 3;
      goto LABEL_17;
    }

    [(BWFigVideoCaptureDevice *)self zoomFactor];
    v25 = v24 > factor;
    v16 = dbl_1AD056AC0[v24 > factor];
    if (v16 >= duration)
    {
      duration = dbl_1AD056AC0[v25];
    }
  }

  v26 = v21 ^ 1;
  zoomFactorUpdateQueue_high = 1008981770;
  if (v10 != 2)
  {
    v26 = 1;
  }

  if ((v26 & 1) == 0)
  {
    if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
    {
      [(BWFigVideoCaptureDevice *)self zoomFactor];
      if (*&v16 < factor)
      {
        zoomFactorUpdateQueue_high = HIDWORD(self->_zoomFactorUpdateQueue);
      }
    }

    v10 = 2;
  }

LABEL_17:
  LODWORD(v19) = 1.0;
  LODWORD(v20) = 1.0;
  *&v16 = factor;
  *&v17 = rate;
  LODWORD(v18) = zoomFactorUpdateQueue_high;
  [(NSMutableDictionary *)self->_whiteBalanceGains rampToVideoZoomFactor:v10 withRampType:0 rate:v7 duration:v16 snapToTargetZoomFactorWithinRampFraction:v17 rampTuning:duration earlySwitchOverScaleFactorForZoomIn:v18 allowableMinimumDigitalZoomFactorDuringZoomOut:v19 commandID:v20];
  v27 = *&self->_minimumTimeBetweenStationaryChecks;
  *&v28 = v14;

  [v27 requestedZoomFactorChanged:v28];
}

- (void)setISPZoomFactor:(float)factor totalZoomFactor:(float)zoomFactor
{
  os_unfair_lock_lock(&self->_zoomFactorUpdateQueue);
  *(&self->_whiteBalanceModeForExif + 1) = factor;
  *(&self->_zoomCommandHandler + 1) = zoomFactor;
  os_unfair_lock_unlock(&self->_zoomFactorUpdateQueue);
  whiteBalanceGainsOrderedKeys = self->_whiteBalanceGainsOrderedKeys;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __60__BWFigVideoCaptureDevice_setISPZoomFactor_totalZoomFactor___block_invoke;
  block[3] = &unk_1E798F870;
  block[4] = self;
  dispatch_async(&whiteBalanceGainsOrderedKeys->super.super, block);
}

- (void)setBaseZoomFactorsByPortType:(id)type
{
  v14 = 0u;
  v15 = 0u;
  v12 = 0u;
  v13 = 0u;
  captureStreams = self->_captureStreams;
  v6 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v13;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v13 != v8)
        {
          objc_enumerationMutation(captureStreams);
        }

        v10 = *(*(&v12 + 1) + 8 * i);
        [objc_msgSend(type objectForKeyedSubscript:{objc_msgSend(v10, "portType")), "floatValue"}];
        [v10 setBaseZoomFactor:?];
      }

      v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
    }

    while (v7);
  }

  [(BWFigVideoCaptureSynchronizedStreamsGroup *)self->_synchronizedStreamsGroup setBaseZoomFactorsByPortType:type];
}

- (void)setNondisruptiveSwitchingFormatIndicesByPortType:(id)type maximumAllowedFrameRate:(int)rate minimumFrameRate:(int)frameRate maximumFrameRate:(int)maximumFrameRate
{
  v6 = *&maximumFrameRate;
  v7 = *&frameRate;
  supportedProperties = [(BWFigCaptureSynchronizedStreamsGroup *)[(BWFigVideoCaptureSynchronizedStreamsGroup *)self->_synchronizedStreamsGroup syncGroup] supportedProperties];
  v11 = *off_1E798CC78;
  if ([(NSDictionary *)supportedProperties objectForKeyedSubscript:*off_1E798CC78])
  {
    v44 = v11;
    v46 = v7;
    v47 = v6;
    dictionary = [MEMORY[0x1E695DF90] dictionary];
    v63 = 0u;
    v64 = 0u;
    v65 = 0u;
    v66 = 0u;
    selfCopy = self;
    obj = self->_captureStreams;
    v12 = [(NSArray *)obj countByEnumeratingWithState:&v63 objects:v62 count:16];
    if (v12)
    {
      v13 = v12;
      v49 = *v64;
      v14 = *MEMORY[0x1E695E738];
      v15 = *off_1E798A1F8;
      v16 = *off_1E798A1C8;
      do
      {
        for (i = 0; i != v13; ++i)
        {
          if (*v64 != v49)
          {
            objc_enumerationMutation(obj);
          }

          v18 = *(*(&v63 + 1) + 8 * i);
          v19 = [type objectForKeyedSubscript:{objc_msgSend(v18, "portType")}];
          v20 = v19;
          if (v19)
          {
            intValue = [v19 intValue];
          }

          else
          {
            intValue = -1;
          }

          activeNondisruptiveSwitchingCommandID = [v18 activeNondisruptiveSwitchingCommandID];
          activeNondisruptiveSwitchingFormatIndex = [v18 activeNondisruptiveSwitchingFormatIndex];
          if (activeNondisruptiveSwitchingFormatIndex == -1 && intValue != -1)
          {
            activeNondisruptiveSwitchingFormatIndex = [v18 activeFormatIndex];
          }

          if (intValue == activeNondisruptiveSwitchingFormatIndex)
          {
            v25 = activeNondisruptiveSwitchingCommandID;
          }

          else
          {
            v25 = activeNondisruptiveSwitchingCommandID + 1;
          }

          dictionary2 = [MEMORY[0x1E695DF90] dictionary];
          v27 = dictionary2;
          if (v20)
          {
            v28 = v20;
          }

          else
          {
            v28 = v14;
          }

          [dictionary2 setObject:v28 forKeyedSubscript:v15];
          [v27 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v25), v16}];
          [dictionary setObject:v27 forKeyedSubscript:{objc_msgSend(v18, "portType")}];
        }

        v13 = [(NSArray *)obj countByEnumeratingWithState:&v63 objects:v62 count:16];
      }

      while (v13);
    }

    if (rate && v46 && v47 && [(BWFigVideoCaptureStream *)selfCopy->_captureStream isNondisruptiveFastSwitchingSupported])
    {
      [dictionary setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", rate), *off_1E798A230}];
      [dictionary setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v46), *off_1E798A240}];
      [dictionary setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v47), *off_1E798A238}];
    }

    if ([(BWFigCaptureSynchronizedStreamsGroup *)[(BWFigVideoCaptureSynchronizedStreamsGroup *)selfCopy->_synchronizedStreamsGroup syncGroup] setProperty:v44 value:dictionary])
    {
      [BWFigVideoCaptureDevice setNondisruptiveSwitchingFormatIndicesByPortType:maximumAllowedFrameRate:minimumFrameRate:maximumFrameRate:];
    }

    else
    {
      v60 = 0u;
      v61 = 0u;
      v58 = 0u;
      v59 = 0u;
      captureStreams = selfCopy->_captureStreams;
      v30 = [(NSArray *)captureStreams countByEnumeratingWithState:&v58 objects:v57 count:16];
      if (v30)
      {
        v31 = v30;
        v32 = *v59;
        v33 = *off_1E798A1C8;
        do
        {
          for (j = 0; j != v31; ++j)
          {
            if (*v59 != v32)
            {
              objc_enumerationMutation(captureStreams);
            }

            v35 = *(*(&v58 + 1) + 8 * j);
            if ([type objectForKeyedSubscript:{objc_msgSend(v35, "portType")}])
            {
              v36 = [objc_msgSend(type objectForKeyedSubscript:{objc_msgSend(v35, "portType")), "intValue"}];
            }

            else
            {
              v36 = 0xFFFFFFFFLL;
            }

            [v35 synchronizedStreamsGroupDidUpdateActiveNondisruptiveSwitchingFormatIndex:v36 activeNondisruptiveSwitchingCommandID:objc_msgSend(objc_msgSend(objc_msgSend(dictionary maximumAllowedFrameRate:"objectForKeyedSubscript:" minimumFrameRate:objc_msgSend(v35 maximumFrameRate:{"portType")), "objectForKeyedSubscript:", v33), "intValue"), rate, v46, v47}];
          }

          v31 = [(NSArray *)captureStreams countByEnumeratingWithState:&v58 objects:v57 count:16];
        }

        while (v31);
      }
    }
  }

  else
  {
    v55 = 0u;
    v56 = 0u;
    v53 = 0u;
    v54 = 0u;
    v37 = self->_captureStreams;
    v38 = [(NSArray *)v37 countByEnumeratingWithState:&v53 objects:v52 count:16];
    if (v38)
    {
      v39 = v38;
      v40 = *v54;
      do
      {
        for (k = 0; k != v39; ++k)
        {
          if (*v54 != v40)
          {
            objc_enumerationMutation(v37);
          }

          v42 = *(*(&v53 + 1) + 8 * k);
          if ([type objectForKeyedSubscript:{objc_msgSend(v42, "portType")}])
          {
            v43 = [objc_msgSend(type objectForKeyedSubscript:{objc_msgSend(v42, "portType")), "intValue"}];
          }

          else
          {
            v43 = 0xFFFFFFFFLL;
          }

          [v42 setActiveNondisruptiveSwitchingFormatIndex:v43 maximumAllowedFrameRate:rate minimumFrameRate:v7 maximumFrameRate:v6];
          [v42 synchronizedStreamsGroupDidUpdateActiveNondisruptiveSwitchingFormatIndex:v43 activeNondisruptiveSwitchingCommandID:objc_msgSend(v42 maximumAllowedFrameRate:"activeNondisruptiveSwitchingCommandID") minimumFrameRate:rate maximumFrameRate:{v7, v6}];
        }

        v39 = [(NSArray *)v37 countByEnumeratingWithState:&v53 objects:v52 count:16];
      }

      while (v39);
    }
  }
}

- (void)zoomCommandHandler:(id)handler didApplyZoomFactor:(float)factor zoomFactorWithoutFudge:(float)fudge targetZoomFactor:(float)zoomFactor rampComplete:(BOOL)complete rampCommandID:(int)d
{
  if (d)
  {
    v10 = *&d;
    completeCopy = complete;
    v18[0] = @"ZoomFactor";
    *&v13 = fudge;
    v19[0] = [MEMORY[0x1E696AD98] numberWithFloat:{handler, v13}];
    v18[1] = @"TargetZoomFactor";
    *&v14 = zoomFactor;
    v19[1] = [MEMORY[0x1E696AD98] numberWithFloat:v14];
    v18[2] = @"ZoomRampCommandID";
    v19[2] = [MEMORY[0x1E696AD98] numberWithInt:v10];
    v18[3] = @"ZoomRampComplete";
    v19[3] = [MEMORY[0x1E696AD98] numberWithBool:completeCopy];
    -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"VideoZoomRampUpdate", [MEMORY[0x1E695DF20] dictionaryWithObjects:v19 forKeys:v18 count:4]);
  }

  if (self->_smartFramingEnabled)
  {
    [BWFigVideoCaptureDevice zoomCommandHandler:didApplyZoomFactor:zoomFactorWithoutFudge:targetZoomFactor:rampComplete:rampCommandID:];
  }

  focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __132__BWFigVideoCaptureDevice_zoomCommandHandler_didApplyZoomFactor_zoomFactorWithoutFudge_targetZoomFactor_rampComplete_rampCommandID___block_invoke;
  v16[3] = &unk_1E7991CF0;
  v16[4] = self;
  factorCopy = factor;
  dispatch_async(focusAndExposureUpdateQueue, v16);
}

- (CGSize)nonDestructiveCropSize
{
  os_unfair_lock_lock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
  v3 = *&self->_aspectRatioCropLock._os_unfair_lock_opaque;
  width = self->_nonDestructiveCropSize.width;
  os_unfair_lock_unlock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
  v5 = v3;
  v6 = width;
  result.height = v6;
  result.width = v5;
  return result;
}

- (void)setNonDestructiveCropSize:(CGSize)size
{
  height = size.height;
  width = size.width;
  os_unfair_lock_lock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
  *&self->_aspectRatioCropLock._os_unfair_lock_opaque = width;
  self->_nonDestructiveCropSize.width = height;

  os_unfair_lock_unlock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
}

- (void)setAspectRatio:(int)ratio
{
  v3 = *&ratio;
  os_unfair_lock_lock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
  if (LODWORD(self->_nonDestructiveCropSize.height) == v3)
  {

    os_unfair_lock_unlock(&self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height);
  }

  else
  {
    [(BWFigVideoCaptureDevice *)self setAspectRatio:v3, &self->_nonDestructiveCropSize.height, &self->_regionOfInterestWithoutOverscanNormalizedInSensorSpace.size.height];
  }
}

- (BOOL)isPropertyObserved:(id)observed
{
  v3 = [*&self->_currentManualFocusCompletedID objectForKeyedSubscript:observed];

  return [v3 BOOLValue];
}

- (void)setProperty:(id)property isObserved:(BOOL)observed
{
  observedCopy = observed;
  FigSimpleMutexLock();
  [*&self->_currentManualFocusCompletedID setObject:objc_msgSend(MEMORY[0x1E696AD98] forKey:{"numberWithBool:", observedCopy), property}];

  FigSimpleMutexUnlock();
}

- (void)setGlobalToneMappingEnabled:(BOOL)enabled
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  LOBYTE(self->_timeLapseStationaryHysteresisLag) = enabled;
  [(BWFigVideoCaptureDevice *)self _updateGlobalToneMappingEnabled];

  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
}

- (BOOL)globalToneMappingEnabled
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  v3 = *&self->_streamingImageIntentNeedsUpdate;
  timeLapseStationaryHysteresisLag = v3 == 4;
  if (v3 == 3)
  {
    timeLapseStationaryHysteresisLag = self->_timeLapseStationaryHysteresisLag;
  }

  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  return timeLapseStationaryHysteresisLag & 1;
}

- (void)setGlobalToneMappingEnabledOverride:(id)override
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  if (*&self->_timeLapseDirectionalMotionDetectionEnabled != override && ([override isEqual:?] & 1) == 0)
  {

    *&self->_timeLapseDirectionalMotionDetectionEnabled = override;
    [(BWFigVideoCaptureDevice *)self _updateGlobalToneMappingEnabled];
  }

  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
}

- (NSNumber)globalToneMappingEnabledOverride
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  v3 = *&self->_timeLapseDirectionalMotionDetectionEnabled;
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);

  return v3;
}

- (void)setUnifiedBracketingMode:(int)mode
{
  if ((!mode || LOBYTE(self->_hdrModeForSceneMonitoring) == 1) && self->_stillImagePhaseDetectionAutofocusTimeout != mode)
  {
    self->_stillImagePhaseDetectionAutofocusTimeout = mode;
    v25 = 0u;
    v26 = 0u;
    v27 = 0u;
    v28 = 0u;
    v5 = *&self->_ubHDRWithBiasEnabled;
    v6 = [v5 countByEnumeratingWithState:&v25 objects:v24 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = *v26;
      do
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v26 != v8)
          {
            objc_enumerationMutation(v5);
          }

          v10 = [*&self->_ubHDRWithBiasEnabled objectForKeyedSubscript:*(*(&v25 + 1) + 8 * i)];
          if ([v10 preserveBlackLevel])
          {
            LOBYTE(self->_unifiedBracketingMode) = 1;
          }

          if ([v10 nonHDRBrightLightCapturesEnabled])
          {
            BYTE1(self->_unifiedBracketingMode) = 1;
          }
        }

        v7 = [v5 countByEnumeratingWithState:&v25 objects:v24 count:16];
      }

      while (v7);
    }

    stillImagePhaseDetectionAutofocusTimeout = self->_stillImagePhaseDetectionAutofocusTimeout;
    v20 = 0u;
    v21 = 0u;
    v22 = 0u;
    v23 = 0u;
    captureStreams = self->_captureStreams;
    v13 = [(NSArray *)captureStreams countByEnumeratingWithState:&v20 objects:v19 count:16];
    if (v13)
    {
      v14 = v13;
      v15 = *v21;
      do
      {
        for (j = 0; j != v14; ++j)
        {
          if (*v21 != v15)
          {
            objc_enumerationMutation(captureStreams);
          }

          v17 = *(*(&v20 + 1) + 8 * j);
          [v17 setUnifiedBracketingEnabled:stillImagePhaseDetectionAutofocusTimeout == 1];
          [v17 setZeroShutterLagEnabled:(stillImagePhaseDetectionAutofocusTimeout == 1) & self->_currentStillSmartCameraResult];
        }

        v14 = [(NSArray *)captureStreams countByEnumeratingWithState:&v20 objects:v19 count:16];
      }

      while (v14);
    }

    [(BWFigVideoCaptureDevice *)self _updateStreamMetadataSettings];
    [(BWFigVideoCaptureDevice *)self _ubUpdateSIFREnabled];
    [(BWFigVideoCaptureDevice *)self _ubSetupMetadataTimeMachine];
    os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
    if (mode)
    {
      v18 = 1;
    }

    else
    {
      v18 = LODWORD(self->_torchLevel) != 0;
    }

    os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
    -[BWFigVideoCaptureDevice _setAutofocusProcessorProperty:propertyValue:](self, 0x1F218A5D0, [MEMORY[0x1E696AD98] numberWithBool:v18]);
    -[BWFigVideoCaptureDevice _setAutofocusProcessorProperty:propertyValue:](self, 0x1F218A5F0, [MEMORY[0x1E696AD98] numberWithBool:mode != 0]);
  }
}

- (void)setSifrStillImageCaptureEnabledIfAvailable:(BOOL)available
{
  if (self->_redEyeReductionEnabled != available)
  {
    self->_redEyeReductionEnabled = available;
    [(BWFigVideoCaptureDevice *)self _ubUpdateSIFREnabled];
  }
}

- (void)setDeepFusionEnabled:(BOOL)enabled
{
  if (BYTE1(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) != enabled)
  {
    if (enabled && self->_stillImagePhaseDetectionAutofocusTimeout != 1)
    {
      enabledCopy = enabled;
      selfCopy = self;
      [BWFigVideoCaptureDevice setDeepFusionEnabled:];
      self = selfCopy;
      enabled = enabledCopy;
    }

    BYTE1(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) = enabled;
  }
}

- (void)setDepthWithDeepFusionEnabled:(BOOL)enabled
{
  if (BYTE2(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) != enabled)
  {
    if (enabled && (BYTE1(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) & 1) == 0)
    {
      enabledCopy = enabled;
      selfCopy = self;
      [BWFigVideoCaptureDevice setDepthWithDeepFusionEnabled:];
      self = selfCopy;
      enabled = enabledCopy;
    }

    BYTE2(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) = enabled;
  }
}

- (void)setLearnedNRMode:(unsigned int)mode
{
  if (HIDWORD(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) != mode)
  {
    if (mode)
    {
      if (!self->_stillImagePhaseDetectionAutofocusTimeout)
      {
        [BWFigVideoCaptureDevice setLearnedNRMode:];
      }
    }

    HIDWORD(self->_highResolutionNondisruptiveSwitchingFormatIndexByPortType) = mode;
  }
}

- (BOOL)learnedNRUltraHighResolutionDowngradeSupported
{
  memset(v6, 0, sizeof(v6));
  v3 = [*&self->_ubHDRWithBiasEnabled countByEnumeratingWithState:v6 objects:&v5 count:16];
  if (v3)
  {
    [objc_msgSend(*&self->_ubHDRWithBiasEnabled objectForKeyedSubscript:{**(&v6[0] + 1)), "learnedNRUltraHighResolutionDowngradeEffectiveIntegrationTimeThreshold"}];
    LOBYTE(v3) = 1;
  }

  return v3;
}

- (void)setDigitalFlashEnabled:(BOOL)enabled
{
  if (BYTE1(self->_globalToneMappingEnabledOverride) != enabled)
  {
    v18 = v3;
    v19 = v4;
    enabledCopy = enabled;
    if (enabled)
    {
      if (self->_stillImagePhaseDetectionAutofocusTimeout != 1)
      {
        [BWFigVideoCaptureDevice setDigitalFlashEnabled:];
      }

      BYTE1(self->_globalToneMappingEnabledOverride) = enabledCopy;

      v7 = objc_alloc_init(MEMORY[0x1E695DF90]);
    }

    else
    {
      BYTE1(self->_globalToneMappingEnabledOverride) = 0;

      v7 = 0;
    }

    *&self->_digitalFlashExposureTimes[2] = v7;
    [(BWFigVideoCaptureDevice *)self _updateStreamMetadataSettings];
    v16 = 0u;
    v17 = 0u;
    v14 = 0u;
    v15 = 0u;
    captureStreams = self->_captureStreams;
    v9 = [(NSArray *)captureStreams countByEnumeratingWithState:&v14 objects:v13 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v15;
      do
      {
        v12 = 0;
        do
        {
          if (*v15 != v11)
          {
            objc_enumerationMutation(captureStreams);
          }

          [*(*(&v14 + 1) + 8 * v12++) setDigitalFlashEnabled:enabledCopy];
        }

        while (v10 != v12);
        v10 = [(NSArray *)captureStreams countByEnumeratingWithState:&v14 objects:v13 count:16];
      }

      while (v10);
    }
  }
}

- (void)setDigitalFlashMetadataEnabled:(BOOL)enabled
{
  if (LOBYTE(self->_portTypesWithDigitalFlashZeroShutterLagEnabled) != enabled)
  {
    LOBYTE(self->_portTypesWithDigitalFlashZeroShutterLagEnabled) = enabled;
    [(BWFigVideoCaptureDevice *)self _updateStreamMetadataSettings];
  }
}

- (void)setStreamingDigitalFlashMode:(int)mode
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  v5 = *&self->_streamingImageIntentNeedsUpdate;
  if ((v5 - 5) < 4 || v5 == 3)
  {
    if (!mode)
    {
      goto LABEL_9;
    }

    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
    fig_log_call_emit_and_clean_up_after_send_and_compose();
LABEL_8:
    LOBYTE(self->_timeLapseStationaryHysteresisLag) = 0;
    goto LABEL_9;
  }

  v8 = mode == 1;
  if (mode == 2)
  {
    v8 = 2;
  }

  *&self->_streamingImageIntentNeedsUpdate = v8;
  self->_learnedNRUltraHighResolutionDowngradeEnabled = 1;
  if (mode)
  {
    goto LABEL_8;
  }

LABEL_9:
  LODWORD(self->_digitalFlashSupportedPortTypes) = mode;
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
}

- (int)streamingDigitalFlashMode
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  v3 = *&self->_streamingImageIntentNeedsUpdate;
  if (v3 == 1)
  {
    digitalFlashSupportedPortTypes = 1;
  }

  else
  {
    digitalFlashSupportedPortTypes = 2 * (v3 == 2);
  }

  if (v3 == 3)
  {
    digitalFlashSupportedPortTypes = self->_digitalFlashSupportedPortTypes;
  }

  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  return digitalFlashSupportedPortTypes;
}

- (void)setAdaptiveUnifiedBracketingController:(id)controller
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  objc_storeWeak(&self->_streamingDigitalFlashMode, controller);

  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
}

- (BWAdaptiveBracketingController)adaptiveUnifiedBracketingController
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  WeakRetained = objc_loadWeakRetained(&self->_streamingDigitalFlashMode);
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);

  return WeakRetained;
}

float __151__BWFigVideoCaptureDevice__ubStillImageSceneFlagsForCaptureStream_frameStatisticsByPortType_fusionEnabled_metadata_sceneMonitoring_zoomFactorOverride___block_invoke(uint64_t a1, uint64_t a2)
{
  v4 = [*(*(a1 + 32) + 224) objectForKeyedSubscript:a2];
  [objc_msgSend(*(a1 + 40) objectForKeyedSubscript:{a2), "normalizedSNR"}];
  [v4 addDataPoint:v5];
  [v4 average];
  v7 = v6;
  [objc_msgSend(*(*(a1 + 32) + 232) objectForKeyedSubscript:{a2), "floatValue"}];
  if (*&v8 != 0.0 && fabsf((*&v8 - v7) / ((*&v8 + v7) * 0.5)) < 0.1)
  {
    v7 = *&v8;
  }

  *&v8 = v7;
  [*(*(a1 + 32) + 232) setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithFloat:", v8), a2}];
  return v7;
}

- (BOOL)_ubUseSquareRootToneCurveForNonHDRCapturesUsingFrameStatistics:(void *)statistics captureParameters:(unint64_t)parameters sceneFlags:
{
  result = 0;
  if (self && (parameters & 0xC) != 0)
  {
    if ([statistics toneCurveBehavior] == 2)
    {
      return 0;
    }

    else if (*(self + 2183) == 1)
    {
      return (parameters >> 1) & 1;
    }

    else
    {
      [a2 integrationTime];
      v10 = v9;
      [a2 gain];
      v12 = v10 * v11;
      [statistics sifrMainEffectiveIntegrationTimeThreshold];
      return v12 <= v13;
    }
  }

  return result;
}

- (uint64_t)_ubResolveDigitalFlashStatusForSceneFlags:(int)flags flashMode:
{
  result = 0;
  if (self && (a2 & 0x4000) == 0)
  {
    if ((*&a2 & 0x28000) != 0)
    {
      v5 = 0;
    }

    else if (flags)
    {
      v5 = *(self + 2389) != 1 || (a2 & 0x10000000) == 0;
    }

    else
    {
      v5 = 1;
    }

    if (!flags)
    {
      v5 = 1;
    }

    if ((a2 & 0x800) != 0 && v5 || (a2 & 0x20000000) != 0 && !flags)
    {
      return 2;
    }

    else
    {
      return (a2 >> 10) & 1;
    }
  }

  return result;
}

- (double)_ubZeroShutterLagFrameSelectionForCaptureType:(uint64_t)type@<X2> captureFlags:(void *)flags@<X3> captureParameters:(void *)parameters@<X4> timeMachineFrameMetadata:(int)metadata@<W5> mainFrameCount:(__int128 *)count@<X6> userInitiatedRequestPTS:(uint64_t)s@<X8>
{
  if (!self)
  {
    *&v41 = 0;
    *(s + 16) = 0u;
    *(s + 32) = 0u;
    *s = 0u;
    return *&v41;
  }

  countCopy4 = count;
  metadataCopy5 = metadata;
  flagsCopy3 = flags;
  typeCopy4 = type;
  *v54 = -1;
  if (a2 != 1)
  {
    goto LABEL_7;
  }

  if (*(self + 3448) != 1)
  {
    goto LABEL_34;
  }

  if ((type & 0x2000) != 0)
  {
    goto LABEL_7;
  }

  if ((type & 0x40) != 0)
  {
LABEL_34:
    array = 0;
LABEL_35:
    *v54 = 0;
    goto LABEL_36;
  }

  v14 = *(self + 3456);
  v54[0] = v14 - 1;
  v54[1] = v14 - 1;
  if (v14 <= 0)
  {
LABEL_7:
    v18 = [MEMORY[0x1E696AD50] indexSetWithIndexesInRange:{0, objc_msgSend(parameters, "count")}];
    array = [MEMORY[0x1E695DF70] array];
    if ([parameters count])
    {
      v20 = 0;
      do
      {
        v21 = [parameters objectAtIndexedSubscript:v20];
        if ([objc_msgSend(v21 objectForKeyedSubscript:{0x1F216F0F0), "BOOLValue"}])
        {
          [v18 removeIndex:v20];
        }

        else
        {
          [array addObject:v21];
        }

        ++v20;
      }

      while ([parameters count] > v20);
    }

    flagsCopy3 = flags;
    referenceFrameSelectionMethod = [flags referenceFrameSelectionMethod];
    v23 = 0;
    if (referenceFrameSelectionMethod > 1)
    {
      countCopy4 = count;
      if (referenceFrameSelectionMethod != 2)
      {
        metadataCopy5 = metadata;
        typeCopy4 = type;
        if (referenceFrameSelectionMethod == 3)
        {
          motionAndFocusScoreWeights = [flagsCopy3 motionAndFocusScoreWeights];
LABEL_21:
          v23 = BWReferenceFrameSelectionUsingMotionAndFocusScores(array, motionAndFocusScoreWeights, metadataCopy5, &v54[1], v54);
        }

LABEL_26:
        if (!v23)
        {
          v27 = v54[0];
          if ((v54[0] & 0x80000000) == 0 && [parameters count] > v27)
          {
            v28 = [array count];
            if (v28 < [parameters count])
            {
              firstIndex = [v18 firstIndex];
              v30 = v54[0];
              if (v54[0])
              {
                v31 = 0;
                do
                {
                  firstIndex = [v18 indexGreaterThanIndex:firstIndex];
                  ++v31;
                  v30 = v54[0];
                }

                while (v31 < v54[0]);
              }

              v54[0] = firstIndex;
              v54[1] += firstIndex - v30;
            }

            goto LABEL_36;
          }
        }

        goto LABEL_35;
      }

      metadataCopy5 = metadata;
      v23 = BWReferenceFrameSelectionUsingBlurScores(array, metadata, &v54[1], v54);
    }

    else
    {
      if (referenceFrameSelectionMethod)
      {
        countCopy4 = count;
        metadataCopy5 = metadata;
        typeCopy4 = type;
        if (referenceFrameSelectionMethod == 1)
        {
          if (*(countCopy4 + 12))
          {
            v51 = *countCopy4;
            v23 = FigCapturePTSBasedReferenceFrameSelection(1, array, &v51, metadataCopy5, &v54[1], v54);
            goto LABEL_26;
          }

          motionAndFocusScoreWeights = &unk_1F2249BD0;
          goto LABEL_21;
        }

        goto LABEL_26;
      }

      FrameworkRadarComponent = FigCaptureGetFrameworkRadarComponent();
      v53 = 0;
      v52 = 0;
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
      flagsCopy3 = flags;
      fig_log_call_emit_and_clean_up_after_send_and_compose();
      LOWORD(v51.value) = 0;
      v26 = _os_log_send_and_compose_impl();
      FigCapturePleaseFileRadar(FrameworkRadarComponent, v26, 0, 0, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 22717, @"LastShownDate:BWFigVideoCaptureDevice.m:22717", @"LastShownBuild:BWFigVideoCaptureDevice.m:22717", 0);
      free(v26);
      v23 = BWReferenceFrameSelectionUsingMotionAndFocusScores(array, &unk_1F2249BB8, metadata, &v54[1], v54);
      countCopy4 = count;
      metadataCopy5 = metadata;
    }

    typeCopy4 = type;
    goto LABEL_26;
  }

  array = 0;
LABEL_36:
  v32 = [array count];
  v33 = -1;
  if ((typeCopy4 & 0x60000100000) != 0 && v32)
  {
    v47[0] = MEMORY[0x1E69E9820];
    v47[1] = 3221225472;
    v48 = __168__BWFigVideoCaptureDevice__ubZeroShutterLagFrameSelectionForCaptureType_captureFlags_captureParameters_timeMachineFrameMetadata_mainFrameCount_userInitiatedRequestPTS___block_invoke;
    v49 = &unk_1E799C4A0;
    parametersCopy = parameters;
    usePreviousSIFR = [flagsCopy3 usePreviousSIFR];
    if (v54[0] <= 1)
    {
      v35 = 1;
    }

    else
    {
      v35 = v54[0];
    }

    v36 = v35 - 1;
    if (usePreviousSIFR)
    {
      v37 = v36;
    }

    else
    {
      v37 = v54[0];
    }

    if ((typeCopy4 & 0x20) != 0)
    {
      v38 = (v37 - 1);
      if (v37 < 1)
      {
        v33 = v37;
      }

      else
      {
        v33 = v37;
        if ((v48(v47, v37) & 1) == 0)
        {
          if (![flagsCopy3 usePreviousSIFR] || (v33 = v37 + 1, (v48(v47, v37 + 1) & 1) == 0))
          {
            if ([parameters count] < 2)
            {
LABEL_57:
              LODWORD(v38) = -1;
            }

            else
            {
              v39 = (v37 + 1);
              v40 = 1;
              while ((v48(v47, v38) & 1) == 0)
              {
                if (v48(v47, v39))
                {
                  LODWORD(v38) = v39;
                  break;
                }

                ++v40;
                v39 = (v39 + 1);
                v38 = (v38 - 1);
                if ([parameters count] <= v40)
                {
                  goto LABEL_57;
                }
              }
            }

            v33 = v38 & ~(v38 >> 31);
          }
        }
      }
    }

    else if (v48(v47, v37))
    {
      v33 = v37;
    }

    else
    {
      v33 = v54[0];
    }
  }

  v41 = *countCopy4;
  *s = *countCopy4;
  *(s + 16) = *(countCopy4 + 2);
  v42 = v54[0];
  v43 = v54[1];
  *(s + 24) = v54[1];
  *(s + 28) = metadataCopy5;
  *(s + 32) = v43;
  *(s + 36) = metadataCopy5;
  *(s + 40) = v42;
  *(s + 44) = v33;
  return *&v41;
}

uint64_t __85__BWFigVideoCaptureDevice__ubSphereOffsetsForAdaptiveBracketingParameters_pixelSize___block_invoke(uint64_t a1, int a2)
{
  v3 = (*(a1 + 48) * a2);
  v6.y = 0.0;
  v6.x = v3;
  DictionaryRepresentation = CGPointCreateDictionaryRepresentation(v6);
  [*(a1 + 32) addObject:DictionaryRepresentation];
  if (DictionaryRepresentation)
  {
    CFRelease(DictionaryRepresentation);
  }

  return [*(a1 + 40) appendFormat:@" (%.3f, %.3f)", *&v3, 0];
}

uint64_t __85__BWFigVideoCaptureDevice__ubSphereOffsetsForAdaptiveBracketingParameters_pixelSize___block_invoke_2(uint64_t result, int a2, int a3)
{
  if (a3 >= 1)
  {
    v3 = a2;
    v4 = result;
    v5 = a3 + a2;
    do
    {
      result = (*(*(v4 + 32) + 16))();
      ++v3;
    }

    while (v3 < v5);
  }

  return result;
}

uint64_t __85__BWFigVideoCaptureDevice__ubSphereOffsetsForAdaptiveBracketingParameters_pixelSize___block_invoke_3(uint64_t result, int a2, int a3)
{
  if (a3 >= 1)
  {
    v3 = a2;
    v4 = result;
    v5 = a2 - a3;
    do
    {
      result = (*(*(v4 + 32) + 16))();
      --v3;
    }

    while (v3 > v5);
  }

  return result;
}

- (uint64_t)_ubAddFrameParametersForDepthIfNeeded:(__int16)needed captureFlags:
{
  if (result && (needed & 0x800) != 0)
  {
    v4 = result;
    if (*(result + 3446) == 1)
    {
      result = [a2 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C5E0];
    }

    if (*(v4 + 3447) == 1)
    {
      v5 = *off_1E798C5F0;
      v6 = MEMORY[0x1E695E118];

      return [a2 setObject:v6 forKeyedSubscript:v5];
    }
  }

  return result;
}

void *__95__BWFigVideoCaptureDevice__ubWhiteBalanceMetadataByPortTypeFromFrameStatistics_masterPortType___block_invoke(uint64_t a1, void *a2)
{
  v3 = BWGetWhiteBalanceMetadataFromFrameStatistics(a2);
  [v3 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", *(a1 + 32)), *off_1E798B148}];
  [v3 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", *(a1 + 33)), *off_1E798B118}];
  if ([v3 count])
  {
    return v3;
  }

  else
  {
    return 0;
  }
}

uint64_t __197__BWFigVideoCaptureDevice__ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream_captureStreams_settings_frameStatisticsByPortType_waitForTimeMachineToFill_failureReasonOut___block_invoke(uint64_t a1, void *a2, void *a3)
{
  if ([objc_msgSend(a3 objectForKeyedSubscript:{0x1F216F0F0), "BOOLValue"}])
  {
    return [MEMORY[0x1E696AEC0] stringWithFormat:@"portType:%@, dropped frame", BWPortTypeToDisplayString(a2, v5), v9, v10];
  }

  v7 = [a3 objectForKeyedSubscript:*off_1E798B5F0];
  return [MEMORY[0x1E696AEC0] stringWithFormat:@"portType:%@, sifr:%d, sifrSkipped:%d", BWPortTypeToDisplayString(a2, v8), v7 != 0, objc_msgSend(objc_msgSend(v7, "objectForKeyedSubscript:", *off_1E798B5F8), "BOOLValue")];
}

uint64_t __168__BWFigVideoCaptureDevice__ubZeroShutterLagFrameSelectionForCaptureType_captureFlags_captureParameters_timeMachineFrameMetadata_mainFrameCount_userInitiatedRequestPTS___block_invoke(uint64_t a1, unsigned int a2)
{
  if ((a2 & 0x80000000) != 0)
  {
    return 0;
  }

  if ([*(a1 + 32) count] <= a2)
  {
    return 0;
  }

  result = [objc_msgSend(*(a1 + 32) objectAtIndexedSubscript:{a2), "objectForKeyedSubscript:", *off_1E798B5F0}];
  if (result)
  {
    v5 = [objc_msgSend(result objectForKeyedSubscript:{*off_1E798B5F8), "BOOLValue"}] ^ 1;
    if (a2)
    {
      return v5;
    }

    else
    {
      return 1;
    }
  }

  return result;
}

- (id)synchronizationPrimaryForMidFrameSynchronizationEnabled:(BOOL)enabled
{
  captureStream = self->_captureStream;
  supportedProperties = [(BWFigCaptureSynchronizedStreamsGroup *)[(BWFigVideoCaptureSynchronizedStreamsGroup *)self->_synchronizedStreamsGroup syncGroup] supportedProperties];
  v6 = *off_1E798CCC8;
  if ([(NSDictionary *)supportedProperties objectForKeyedSubscript:*off_1E798CCC8])
  {
    syncGroup = [(BWFigVideoCaptureSynchronizedStreamsGroup *)self->_synchronizedStreamsGroup syncGroup];
    -[BWFigCaptureSynchronizedStreamsGroup setProperty:value:](syncGroup, "setProperty:value:", v6, [MEMORY[0x1E696AD98] numberWithBool:self->_midFrameSynchronizationEnabled]);
  }

  return captureStream;
}

- ($06E035DAA80D7DA92D7AC3530BEA5F2A)bravoStreamSelectionConfiguration
{
  os_unfair_lock_lock(&self->_switchOverLock);
  selectionBehavior = self->_bravoStreamSelectionConfiguration.selectionBehavior;
  restrictedSelectionConditions = self->_bravoStreamSelectionConfiguration.restrictedSelectionConditions;
  os_unfair_lock_unlock(&self->_switchOverLock);
  v5 = selectionBehavior;
  v6 = restrictedSelectionConditions;
  result.var1 = v6;
  result.var0 = v5;
  return result;
}

- (void)setBravoStreamSelectionConfiguration:(id)configuration
{
  var1 = configuration.var1;
  var0 = configuration.var0;
  os_unfair_lock_lock(&self->_switchOverLock);
  self->_bravoStreamSelectionConfiguration.selectionBehavior = var0;
  self->_bravoStreamSelectionConfiguration.restrictedSelectionConditions = var1;

  os_unfair_lock_unlock(&self->_switchOverLock);
}

- ($06E035DAA80D7DA92D7AC3530BEA5F2A)bravoStreamSelectionConfigurationForRecording
{
  os_unfair_lock_lock(&self->_switchOverLock);
  selectionBehavior = self->_bravoStreamSelectionConfigurationForRecording.selectionBehavior;
  restrictedSelectionConditions = self->_bravoStreamSelectionConfigurationForRecording.restrictedSelectionConditions;
  os_unfair_lock_unlock(&self->_switchOverLock);
  v5 = selectionBehavior;
  v6 = restrictedSelectionConditions;
  result.var1 = v6;
  result.var0 = v5;
  return result;
}

- (void)setBravoStreamSelectionConfigurationForRecording:(id)recording
{
  var1 = recording.var1;
  var0 = recording.var0;
  os_unfair_lock_lock(&self->_switchOverLock);
  self->_bravoStreamSelectionConfigurationForRecording.selectionBehavior = var0;
  self->_bravoStreamSelectionConfigurationForRecording.restrictedSelectionConditions = var1;

  os_unfair_lock_unlock(&self->_switchOverLock);
}

- (BOOL)bravoStreamSelectionConfigurationForRecordingEnabled
{
  os_unfair_lock_lock(&self->_switchOverLock);
  bravoStreamSelectionConfigurationForRecordingEnabled = self->_bravoStreamSelectionConfigurationForRecordingEnabled;
  os_unfair_lock_unlock(&self->_switchOverLock);
  return bravoStreamSelectionConfigurationForRecordingEnabled;
}

- (void)setBravoStreamSelectionConfigurationForRecordingEnabled:(BOOL)enabled
{
  os_unfair_lock_lock(&self->_switchOverLock);
  self->_bravoStreamSelectionConfigurationForRecordingEnabled = enabled;

  os_unfair_lock_unlock(&self->_switchOverLock);
}

- (void)setBravoStreamSelectionEligibleFallbackPortTypes:(id)types
{
  os_unfair_lock_lock(&self->_switchOverLock);
  [(BWBravoStreamSelector *)self->_bravoStreamSelector setEligibleFallbackPortTypes:types];

  os_unfair_lock_unlock(&self->_switchOverLock);
}

- (NSArray)bravoStreamSelectionEligibleFallbackPortTypes
{
  os_unfair_lock_lock(&self->_switchOverLock);
  eligibleFallbackPortTypes = [(BWBravoStreamSelector *)self->_bravoStreamSelector eligibleFallbackPortTypes];
  os_unfair_lock_unlock(&self->_switchOverLock);
  return eligibleFallbackPortTypes;
}

- (float)parallaxMitigationStrengthAndTargetCaptureStream:(id *)stream
{
  os_unfair_lock_lock(&self->_parallaxMitigationStrengthLock);
  parallaxMitigationStrength = self->_parallaxMitigationStrength;
  parallaxMitigationTargetCaptureStream = self->_parallaxMitigationTargetCaptureStream;
  os_unfair_lock_unlock(&self->_parallaxMitigationStrengthLock);
  if (stream)
  {
    *stream = parallaxMitigationTargetCaptureStream;
  }

  return parallaxMitigationStrength;
}

- ($AF35DC73A926DCC9144999D480AEA670)sphereShiftState
{
  os_unfair_lock_lock(&self->_sphereShiftStateLock);
  memcpy(retstr, &self->_sphereShiftState, sizeof($AF35DC73A926DCC9144999D480AEA670));

  os_unfair_lock_unlock(&self->_sphereShiftStateLock);
  return result;
}

- (uint64_t)projectorModeMaskForProjectorMode:(uint64_t)mode
{
  result = 0;
  if (mode)
  {
    if (a2 <= 6)
    {
      return dword_1AD056B30[a2];
    }
  }

  return result;
}

- (void)setTimeOfFlightProjectorMode:(int)mode
{
  v3 = *&mode;
  if ([(NSString *)[(BWFigVideoCaptureStream *)self->_captureStream portType] isEqualToString:*off_1E798A0C8])
  {
    v6 = [MEMORY[0x1E696AD98] numberWithInt:{v3, *off_1E798CD48}];
    -[BWFigCaptureStream setProperty:value:](-[BWFigVideoCaptureStream stream](self->_captureStream, "stream"), "setProperty:value:", *off_1E798C220, [MEMORY[0x1E695DF20] dictionaryWithObjects:&v6 forKeys:&v5 count:1]);
    self->_timeOfFlightCameraProjectorModeMask |= [(BWFigVideoCaptureDevice *)self projectorModeMaskForProjectorMode:v3];
  }
}

- (int)timeOfFlightProjectorMode
{
  if (![(NSString *)[(BWFigVideoCaptureStream *)self->_captureStream portType] isEqualToString:*off_1E798A0C8])
  {
    return 0;
  }

  v3 = [(BWFigCaptureStream *)[(BWFigVideoCaptureStream *)self->_captureStream stream] getProperty:*off_1E798C220 error:0];
  if (!v3)
  {
    return 0;
  }

  v4 = [v3 objectForKeyedSubscript:*off_1E798CD48];

  return [v4 intValue];
}

- (void)pointCloudCaptureDevice:(id)device willEmitPointCloudSampleBuffer:(opaqueCMSampleBuffer *)buffer
{
  [objc_msgSend(CMGetAttachment(buffer *off_1E798A3C8];
  v6 = v5;
  os_unfair_lock_lock(&self->_supplementalPointCloudCaptureDeviceStreamingMinimumFrameRate);
  self->_supplementalPointCloudCaptureDeviceCaptureMinimumFrameRate = v6;

  os_unfair_lock_unlock(&self->_supplementalPointCloudCaptureDeviceStreamingMinimumFrameRate);
}

- (void)setSupplementalPointCloudCaptureDeviceDelegate:(id)delegate
{
  if (delegate)
  {
    v5 = [[FigWeakReference alloc] initWithReferencedObject:delegate];
  }

  else
  {
    v5 = 0;
  }

  *&self->_digitalFlashLockingAE = v5;
}

- (void)stopPointCloudCaptureForStillImageCaptureWithSettingsID:(int64_t)d
{
  v3 = *&self->_stillImageEnhancedResByMaintainingSensorResolutionSupported;
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __83__BWFigVideoCaptureDevice_stopPointCloudCaptureForStillImageCaptureWithSettingsID___block_invoke;
  v4[3] = &unk_1E7990178;
  v4[4] = self;
  v4[5] = d;
  dispatch_async(v3, v4);
}

void __83__BWFigVideoCaptureDevice_stopPointCloudCaptureForStillImageCaptureWithSettingsID___block_invoke(uint64_t a1)
{
  os_unfair_lock_lock((*(a1 + 32) + 2712));
  v2 = *(a1 + 40);
  v3 = [*(*(a1 + 32) + 2720) settingsID];
  v4 = *(a1 + 32);
  if (v2 == v3)
  {
    v5 = [*(v4 + 2720) captureFlags];
    os_unfair_lock_unlock((*(a1 + 32) + 2712));
    if ((v5 & 0x200) != 0)
    {
      if (dword_1ED844350)
      {
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
        fig_log_call_emit_and_clean_up_after_send_and_compose();
      }

      FigCaptureFrameRateFromFloat();
      [objc_msgSend(*(*(a1 + 32) + 2488) "referencedObject")];
    }
  }

  else
  {

    os_unfair_lock_unlock((v4 + 2712));
  }
}

- (void)setDepthMaxFrameRate:(float)rate
{
  if (self->_depthMaxFrameRate != rate)
  {
    [(BWFigVideoCaptureDevice *)&self->_depthMaxFrameRate setDepthMaxFrameRate:rate];
  }
}

- (void)setShallowDepthOfFieldEffectEnabled:(BOOL)enabled
{
  self->_shallowDepthOfFieldEffectEnabled = enabled;
  if (!self->_sdofSceneMonitoringEnabled)
  {
    return;
  }

  v13 = v5;
  v14 = v4;
  v15 = v3;
  enabledCopy = enabled;
  os_unfair_lock_lock(&self->_sdofLock);
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  portraitSceneMonitor = self->_portraitSceneMonitor;
  if (isKindOfClass)
  {
    goto LABEL_5;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    portraitSceneMonitor = self->_portraitSceneMonitor;
LABEL_5:
    [(BWPortraitSceneMonitor *)portraitSceneMonitor setShallowDepthOfFieldRenderingEnabled:enabledCopy, v6, v13, v14, v15, v7];
  }

  os_unfair_lock_unlock(&self->_sdofLock);
}

- (int)shallowDepthOfFieldStagePreviewStatus
{
  os_unfair_lock_lock(&self->_sdofLock);
  sdofStagePreviewStatus = self->_sdofStagePreviewStatus;
  os_unfair_lock_unlock(&self->_sdofLock);
  return sdofStagePreviewStatus;
}

- (void)updateSDOFBackgroundShiftSum:(float)sum invalidShiftRatio:(float)ratio closeCanonicalDisparityAverage:(float)average faceCanonicalDisparityAverages:(id)averages erodedForegroundRatio:(float)foregroundRatio foregroundRatio:(float)a8 occluded:(BOOL)occluded faces:(id)self0 personSegmentationRatio:(float)self1
{
  occludedCopy = occluded;
  os_unfair_lock_lock(&self->_sdofLock);
  *&v21 = sum;
  *&v22 = ratio;
  *&v23 = average;
  *&v24 = foregroundRatio;
  *&v25 = a8;
  *&v26 = segmentationRatio;
  [(BWPortraitSceneMonitor *)self->_portraitSceneMonitor setSDOFBackgroundShiftSum:averages invalidShiftRatio:occludedCopy closeCanonicalDisparityAverage:faces faceCanonicalDisparityAverages:v21 erodedForegroundRatio:v22 foregroundRatio:v23 occluded:v24 faces:v25 personSegmentationRatio:v26];

  os_unfair_lock_unlock(&self->_sdofLock);
}

- (void)updatePortraitSceneMonitoringRequiresStageThresholds:(BOOL)thresholds
{
  thresholdsCopy = thresholds;
  os_unfair_lock_lock(&self->_sdofLock);
  portraitSceneMonitoringRequiresStageThresholds = [(BWPortraitSceneMonitor *)self->_portraitSceneMonitor portraitSceneMonitoringRequiresStageThresholds];
  [(BWPortraitSceneMonitor *)self->_portraitSceneMonitor setPortraitSceneMonitoringRequiresStageThresholds:thresholdsCopy];
  os_unfair_lock_unlock(&self->_sdofLock);
  if (portraitSceneMonitoringRequiresStageThresholds != thresholdsCopy)
  {
    [BWFigVideoCaptureDevice updatePortraitSceneMonitoringRequiresStageThresholds:];
  }
}

- (void)setZoomFactorChangedDelegate:(id)delegate forPortType:(id)type
{
  if (!delegate || !*&self->_minimumTimeBetweenStationaryChecks)
  {
    *&self->_minimumTimeBetweenStationaryChecks = delegate;
    if (!delegate)
    {
      type = 0;
    }

    self->_previewTimeMachineProcessor = type;
  }
}

- (void)setSmartCameraEnabled:(BOOL)enabled
{
  if (LOBYTE(self->_smartStyleAttachedMediaTimeMachineDelegate) != enabled)
  {
    v9[5] = v3;
    v9[6] = v4;
    LOBYTE(self->_smartStyleAttachedMediaTimeMachineDelegate) = enabled;
    v8 = @"NewPropertyValue";
    v9[0] = [MEMORY[0x1E696AD98] numberWithBool:?];
    -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"SmartCameraEnabledChanged", [MEMORY[0x1E695DF20] dictionaryWithObjects:v9 forKeys:&v8 count:1]);
    if (*&self->_currentExifOrientation)
    {
      v6 = @"NewPropertyValue";
      v7 = MEMORY[0x1E695E0F8];
      -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"SceneClassificationConfidencesChanged", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v7 forKeys:&v6 count:1]);
    }
  }
}

- (void)setSmartCameraVersion:(id)version
{
  v3 = *&version.var0;
  if (![(BWFigVideoCaptureStream *)self->_captureStream started])
  {
    v5 = (v3 << 8) | BYTE2(v3);
    stream = [(BWFigVideoCaptureStream *)self->_captureStream stream];
    v7 = *off_1E798C110;
    v8 = [MEMORY[0x1E696AD98] numberWithUnsignedShort:v5];

    [(BWFigCaptureStream *)stream setProperty:v7 value:v8];
  }
}

- (void)updateSmartCameraStreamPropertiesWithInferenceResult:(id)result
{
  if (self->_smartStyleAttachedMediaTimeMachineDelegate)
  {
    if ([result inferenceType] == 101)
    {
      inferences = [result inferences];
      os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);

      *&self->_currentExifOrientation = result;
      os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
      if ([(BWFigVideoCaptureDevice *)self isPropertyObserved:@"SceneClassificationConfidences"])
      {
        v8 = @"NewPropertyValue";
        v9 = inferences;
        -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"SceneClassificationConfidencesChanged", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v9 forKeys:&v8 count:1]);
      }

      supportedProperties = [(BWFigCaptureStream *)[(BWFigVideoCaptureStream *)self->_captureStream stream] supportedProperties];
      v7 = *off_1E798C108;
      if ([(NSDictionary *)supportedProperties objectForKeyedSubscript:*off_1E798C108])
      {
        [(BWFigCaptureStream *)[(BWFigVideoCaptureStream *)self->_captureStream stream] setProperty:v7 value:inferences];
      }
    }

    else
    {
      [BWFigVideoCaptureDevice updateSmartCameraStreamPropertiesWithInferenceResult:];
    }
  }

  else
  {
    [BWFigVideoCaptureDevice updateSmartCameraStreamPropertiesWithInferenceResult:];
  }
}

- (id)sceneClassificationConfidences
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  if (LOBYTE(self->_smartStyleAttachedMediaTimeMachineDelegate) == 1)
  {
    inferences = [*&self->_currentExifOrientation inferences];
  }

  else
  {
    inferences = 0;
  }

  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  if (inferences)
  {
    return inferences;
  }

  else
  {
    return MEMORY[0x1E695E0F8];
  }
}

- (NSString)smartCameraStatus
{
  v2 = [(BWFigVideoCaptureDevice *)self _evaluateSceneForMotionFreezingWithMasterStreamSwitchoverSuspended:0 resultOut:?];
  string = [MEMORY[0x1E696AD60] string];
  result = 0;
  if (v2)
  {
    [string appendFormat:@"PAM: "];
    if ((v2 & 0x100) != 0)
    {
      [string appendString:@"Face"];
    }

    return string;
  }

  return result;
}

- (NSString)orientation
{
  os_unfair_lock_lock(&self->_zoomFactorChangedDelegatePortType + 1);
  zoomFactorChangedDelegatePortType = self->_zoomFactorChangedDelegatePortType;
  if (zoomFactorChangedDelegatePortType)
  {
    v4 = FigCaptureRotationDegreesAndMirroringFromExifOrientation(zoomFactorChangedDelegatePortType, 0);
    v5 = FigCaptureOrientationFromRotationDegrees(v4, self->_position == 2, [(BWFigVideoCaptureDevice *)self isExternalVariant], 0);
    v6 = FigCaptureVideoOrientationToString(v5);
  }

  else
  {
    v6 = @"Unknown";
  }

  os_unfair_lock_unlock(&self->_zoomFactorChangedDelegatePortType + 1);
  return &v6->isa;
}

- (int)smartFramingSuggestedFieldOfView
{
  os_unfair_lock_lock(&self->_smartFramingLock);
  smartFramingSuggestedFieldOfView = self->_smartFramingSuggestedFieldOfView;
  os_unfair_lock_unlock(&self->_smartFramingLock);
  return smartFramingSuggestedFieldOfView;
}

- (BOOL)smartFramingIsMonitoringScene
{
  os_unfair_lock_lock(&self->_smartFramingLock);
  smartFramingIsMonitoringScene = self->_smartFramingIsMonitoringScene;
  os_unfair_lock_unlock(&self->_smartFramingLock);
  return smartFramingIsMonitoringScene;
}

- (void)setSmartFramingIsMonitoringScene:(BOOL)scene
{
  os_unfair_lock_lock(&self->_smartFramingLock);
  self->_smartFramingIsMonitoringScene = scene;

  os_unfair_lock_unlock(&self->_smartFramingLock);
}

- (NSArray)smartCropCandidateFramingRects
{
  os_unfair_lock_lock(&self->_smartFramingLock);
  smartCropCandidateFramingRects = self->_smartCropCandidateFramingRects;
  os_unfair_lock_unlock(&self->_smartFramingLock);
  return smartCropCandidateFramingRects;
}

- (void)setSmartCropCandidateFramingRects:(id)rects
{
  os_unfair_lock_lock(&self->_smartFramingLock);

  self->_smartCropCandidateFramingRects = rects;

  os_unfair_lock_unlock(&self->_smartFramingLock);
}

- (void)updateSmartFramingCamGazeProbabilities:(id)probabilities
{
  os_unfair_lock_lock(&self->_smartFramingLock);
  [(BWSmartFramingSceneMonitor *)self->_smartFramingSceneMonitor setSmartFramingCamGazeProbabilitiesByFaceGroupID:probabilities];

  os_unfair_lock_unlock(&self->_smartFramingLock);
}

- (void)resetSmartFramingSceneMonitor
{
  os_unfair_lock_lock(&self->_smartFramingLock);
  [(BWSmartFramingSceneMonitor *)self->_smartFramingSceneMonitor reset];
  os_unfair_lock_unlock(&self->_smartFramingLock);

  self->_smartCropCandidateFramingRects = 0;
}

- (void)updateLensSmudgeDetectionInfo:(id)info
{
  v5 = *off_1E798A778;
  v6 = [objc_msgSend(info objectForKeyedSubscript:{*off_1E798A778), "intValue"}];
  os_unfair_lock_lock(&self->_mostRecentSmartCameraResult);
  v7 = [*&self->_smartCameraVersion.major objectForKeyedSubscript:v5];
  v8 = [info objectForKeyedSubscript:v5];

  *&self->_smartCameraVersion.major = info;
  os_unfair_lock_unlock(&self->_mostRecentSmartCameraResult);
  if (v7 != v8)
  {
    v10 = [MEMORY[0x1E696AD98] numberWithInt:{v6, @"LensSmudgeDetectionStatus"}];
    -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"LensSmudgeDetectionStatusChanged", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v10 forKeys:&v9 count:1]);
  }
}

- (void)semanticStyleSceneTypeDidChange:(int)change
{
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  LODWORD(self->_zoomFactorChangedDelegate) = change;

  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
}

- (void)setZeroShutterLagEnabled:(BOOL)enabled
{
  if (LOBYTE(self->_currentStillSmartCameraResult) != enabled)
  {
    v17 = v3;
    v18 = v4;
    LOBYTE(self->_currentStillSmartCameraResult) = enabled;
    [(BWFigVideoCaptureDevice *)self _ubSetupMetadataTimeMachine];
    v15 = 0u;
    v16 = 0u;
    v13 = 0u;
    v14 = 0u;
    captureStreams = self->_captureStreams;
    v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v13 objects:v12 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v14;
      do
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v14 != v9)
          {
            objc_enumerationMutation(captureStreams);
          }

          v11 = LOBYTE(self->_currentStillSmartCameraResult) == 1 && self->_stillImagePhaseDetectionAutofocusTimeout != 2;
          [*(*(&v13 + 1) + 8 * i) setZeroShutterLagEnabled:v11];
        }

        v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v13 objects:v12 count:16];
      }

      while (v8);
    }
  }
}

- (void)setUltraHighResolutionZeroShutterLagSupportEnabled:(BOOL)enabled
{
  if (enabled)
  {
    if (self->_multipleSensorRawBufferPoolsEnabled)
    {
      BYTE1(self->_currentStillSmartCameraResult) = enabled;
      isRunningInXCTest = self->_isRunningInXCTest;
      BYTE4(self->_currentStillSmartCameraResult) = !isRunningInXCTest;
      if (isRunningInXCTest)
      {
        if (dword_1ED844350)
        {
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
          fig_log_call_emit_and_clean_up_after_send_and_compose();
        }
      }
    }
  }

  else
  {
    BYTE1(self->_currentStillSmartCameraResult) = 0;
    BYTE4(self->_currentStillSmartCameraResult) = 0;

    [(BWFigVideoCaptureDevice *)self setUltraHighResolutionZeroShutterLagEnabled:?];
  }
}

- (void)setUltraHighResolutionZeroShutterLagEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  if (!enabled || BYTE1(self->_currentStillSmartCameraResult) == 1)
  {
    os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
    if (BYTE2(self->_currentStillSmartCameraResult) != enabledCopy)
    {
      BYTE2(self->_currentStillSmartCameraResult) = enabledCopy;
    }

    os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
  }
}

- (void)setZeroShutterLagEarliestAllowedPTS:(id *)s
{
  v3 = *&s->var0;
  *&self->_ultraHighResolutionZeroShutterLagThermalMitigationSupportEnabled = s->var3;
  *(&self->_lensSmudgeDetectionInfo + 4) = v3;
  v4 = *s;
  [(NSDictionary *)self->_ubCaptureParametersByPortType setEarliestAllowedPTS:&v4];
}

- ($3CC8671D27C23BF42ADDB32F2B5E48AE)zeroShutterLagEarliestAllowedPTS
{
  *&retstr->var0 = *(&self[144].var0 + 4);
  retstr->var3 = *(&self[144].var3 + 4);
  return self;
}

- (void)setTimeLapseCaptureRate:(float)rate
{
  if ([(NSDictionary *)[(BWFigCaptureStream *)[(BWFigVideoCaptureStream *)self->_captureStream stream] supportedProperties] objectForKeyedSubscript:*off_1E798C1F0])
  {
    focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __51__BWFigVideoCaptureDevice_setTimeLapseCaptureRate___block_invoke;
    v6[3] = &unk_1E7991CF0;
    v6[4] = self;
    rateCopy = rate;
    dispatch_sync(focusAndExposureUpdateQueue, v6);
  }
}

- (float)timeLapseCaptureRate
{
  v6 = 0;
  v7 = &v6;
  v8 = 0x2020000000;
  v9 = 0;
  focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __47__BWFigVideoCaptureDevice_timeLapseCaptureRate__block_invoke;
  v5[3] = &unk_1E798FAF8;
  v5[4] = self;
  v5[5] = &v6;
  dispatch_sync(focusAndExposureUpdateQueue, v5);
  v3 = v7[6];
  _Block_object_dispose(&v6, 8);
  return v3;
}

float __47__BWFigVideoCaptureDevice_timeLapseCaptureRate__block_invoke(uint64_t a1)
{
  result = *(*(a1 + 32) + 2316);
  *(*(*(a1 + 40) + 8) + 24) = result;
  return result;
}

- (void)setOverCaptureEnabled:(BOOL)enabled
{
  if (LOBYTE(self->_activeSensorRegionForCameraControls.width) != enabled)
  {
    v22 = v6;
    v23 = v5;
    v24 = v3;
    v25 = v4;
    enabledCopy = enabled;
    LOBYTE(self->_activeSensorRegionForCameraControls.width) = enabled;
    v18 = 0u;
    v19 = 0u;
    v20 = 0u;
    v21 = 0u;
    captureStreams = self->_captureStreams;
    v10 = [(NSArray *)captureStreams countByEnumeratingWithState:&v18 objects:v17 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v19;
      v13 = *MEMORY[0x1E695EFF8];
      v14 = *(MEMORY[0x1E695EFF8] + 8);
      do
      {
        for (i = 0; i != v11; ++i)
        {
          if (*v19 != v12)
          {
            objc_enumerationMutation(captureStreams);
          }

          v16 = *(*(&v18 + 1) + 8 * i);
          [v16 setOverCaptureEnabled:enabledCopy];
          [v16 setPreviewShift:{v13, v14}];
          [v16 setPreviewShiftAtBaseZoom:{v13, v14}];
        }

        v11 = [(NSArray *)captureStreams countByEnumeratingWithState:&v18 objects:v17 count:16];
      }

      while (v11);
    }

    if (enabledCopy)
    {
      *&self->_lumaHistogramsEnabled = 16843009;
      *(&self->_lumaHistogramsEnabled + 4) = [(BWBravoStreamSelector *)self->_bravoStreamSelector superWideAutoSwitchingSupported];
      LODWORD(self->_overCapturePercentage) = 22;
    }

    [(BWFigVideoCaptureDevice *)self _updateParallaxMitigationBasedOnZoomFactorEnabled];
  }
}

- (void)setMomentCaptureVideoRecordingSupported:(BOOL)supported
{
  if (*(&self->_applyPreviewShiftToFocusAndExposureRect + 2) != supported)
  {
    *(&self->_applyPreviewShiftToFocusAndExposureRect + 2) = supported;
    if (supported && !self->_lumaHistogramsEnabled)
    {
      self->_lumaHistogramsEnabled = 1;
    }
  }
}

uint64_t __67__BWFigVideoCaptureDevice__reportStreamingSessionCoreAnalyticsData__block_invoke(uint64_t a1)
{
  [*(a1 + 32) setOrientationPortraitTime:FigHostTimeToNanoseconds() / 0xF4240uLL];
  [*(a1 + 32) setOrientationLandscapeTime:FigHostTimeToNanoseconds() / 0xF4240uLL];
  [*(a1 + 32) setOrientationFaceUpTime:FigHostTimeToNanoseconds() / 0xF4240uLL];
  v2 = FigHostTimeToNanoseconds() / 0xF4240uLL;
  v3 = *(a1 + 32);

  return [v3 setOrientationFaceDownTime:v2];
}

- (void)setSystemPressureLevel:(int)level
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  if (self->_videoStabilizationStrength != level)
  {
    if (level < 3)
    {
      LOBYTE(self->_flickerAvoidanceMonitor) = 0;
      if (LOBYTE(self->_thermalSystemPressureLevel) == 1)
      {
        BYTE1(self->_systemPressureStatusLock._os_unfair_lock_opaque) = 0;
      }
    }

    else
    {
      LOBYTE(self->_flickerAvoidanceMonitor) = 1;
      if (self->_accumulatedSystemPressureLevel == -1)
      {
        mach_absolute_time();
        self->_accumulatedSystemPressureLevel = FigHostTimeToNanoseconds() / 0xF4240uLL;
      }
    }

    v5 = mach_absolute_time();
    videoStabilizationStrength = self->_videoStabilizationStrength;
    *&self->_previousInfraredFramePTS.timescale += FigHostTimeToNanoseconds() / 0xF4240uLL * videoStabilizationStrength;
    self->_previousInfraredFramePTS.epoch = v5;
    if (SLODWORD(self->_sensorTemperatureStatsByPortType) < level)
    {
      LODWORD(self->_sensorTemperatureStatsByPortType) = level;
      LODWORD(self->_timeOfLastSystemPressureChange) = HIDWORD(self->_flickerAvoidanceMonitor);
    }

    self->_videoStabilizationStrength = level;
  }

  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
}

- (int)systemPressureLevel
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  videoStabilizationStrength = self->_videoStabilizationStrength;
  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
  return videoStabilizationStrength;
}

- (void)setSystemPressureFactors:(unsigned int)factors
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  HIDWORD(self->_flickerAvoidanceMonitor) = factors;
  if (self->_videoStabilizationStrength == LODWORD(self->_sensorTemperatureStatsByPortType))
  {
    LODWORD(self->_timeOfLastSystemPressureChange) |= factors;
  }

  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
}

- (unsigned)systemPressureFactors
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  flickerAvoidanceMonitor_high = HIDWORD(self->_flickerAvoidanceMonitor);
  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
  return flickerAvoidanceMonitor_high;
}

- (void)setThermalSystemPressureLevel:(int)level
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  *&self->_configuresStreamingImageIntentForActionCamera = level;

  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
}

- (void)setPeakPowerSystemPressureLevel:(int)level
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  *(&self->_adaptiveOverscanEnabled + 2) = level;

  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
}

- (int)peakPowerSystemPressureLevel
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  v3 = *(&self->_adaptiveOverscanEnabled + 2);
  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
  return v3;
}

- (BOOL)needsToRelieveSystemPressure
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  flickerAvoidanceMonitor = self->_flickerAvoidanceMonitor;
  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
  return flickerAvoidanceMonitor;
}

- (void)setRestorationOfForcedOffOverCaptureActiveSlaveStreamEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  p_systemPressureStatusLock = &self->_systemPressureStatusLock;
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  if (LOBYTE(p_systemPressureStatusLock[2]._os_unfair_lock_opaque) != enabledCopy)
  {
    LOBYTE(p_systemPressureStatusLock[2]._os_unfair_lock_opaque) = enabledCopy;
    v6 = BYTE1(p_systemPressureStatusLock->_os_unfair_lock_opaque) != 1 || enabledCopy == 0;
    if (!v6 && (self->_flickerAvoidanceMonitor & 1) == 0)
    {
      BYTE1(p_systemPressureStatusLock->_os_unfair_lock_opaque) = 0;
    }
  }

  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
}

- (BOOL)restorationOfForcedOffOverCaptureActiveSlaveStreamEnabled
{
  os_unfair_lock_lock(&self->_maxOverscanVideoStabilizationMethod);
  thermalSystemPressureLevel = self->_thermalSystemPressureLevel;
  os_unfair_lock_unlock(&self->_maxOverscanVideoStabilizationMethod);
  return thermalSystemPressureLevel;
}

- (void)setMaxDepthFrameRateChangedDelegate:(id)delegate
{
  self->_ptsOfLastTimeOfFlightFrameRateChange.epoch = 0;
  if (delegate)
  {
    self->_ptsOfLastTimeOfFlightFrameRateChange.epoch = [[FigWeakReference alloc] initWithReferencedObject:delegate];
  }
}

- (void)setOverheadCameraMode:(int)mode
{
  v3 = *&mode;
  *&self->_temporalNoiseReductionEnabled = mode;
  referencedObject = [*&self->_temporalNoiseReductionBand0StrengthModulation referencedObject];

  [referencedObject didChangeOverheadCameraMode:v3];
}

- (void)setDeskViewCameraZoomFactor:(float)factor
{
  *&self->_disableTemporalNoiseReductionWhenStopping = factor;
  referencedObject = [*&self->_temporalNoiseReductionBand0StrengthModulation referencedObject];

  [referencedObject setDeskViewCameraZoomFactor:factor];
}

- (void)setOverheadCameraModeChangeDelegate:(id)delegate
{
  *&self->_temporalNoiseReductionBand0StrengthModulation = 0;
  if (delegate)
  {
    *&self->_temporalNoiseReductionBand0StrengthModulation = [[FigWeakReference alloc] initWithReferencedObject:delegate];
  }
}

- (int)setDeskViewAutoExposureAreaOfInterest:(CGRect)interest
{
  v8 = 0;
  v9 = &v8;
  v10 = 0x2020000000;
  v11 = 0;
  if (self->_deskCamActive)
  {
    focusAndExposureUpdateQueue = self->_focusAndExposureUpdateQueue;
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __65__BWFigVideoCaptureDevice_setDeskViewAutoExposureAreaOfInterest___block_invoke;
    block[3] = &unk_1E799C260;
    interestCopy = interest;
    block[4] = self;
    block[5] = &v8;
    dispatch_sync(focusAndExposureUpdateQueue, block);
    v4 = *(v9 + 6);
  }

  else
  {
    FigDebugAssert3();
    v4 = -12782;
    *(v9 + 6) = -12782;
  }

  _Block_object_dispose(&v8, 8);
  return v4;
}

- (void)setSubjectSelectionDelegate:(id)delegate
{
  self->_maxDepthFrameRateChangedDelegate = 0;
  if (delegate)
  {
    self->_maxDepthFrameRateChangedDelegate = [[FigWeakReference alloc] initWithReferencedObject:delegate];
  }
}

- (CGRect)centerStageRectOfInterest
{
  v2 = *&self->_overheadCameraMode;
  overheadCameraModeChangedDelegate = self->_overheadCameraModeChangedDelegate;
  subjectSelectionDelegate = self->_subjectSelectionDelegate;
  x = self->_centerStageRectOfInterest.origin.x;
  result.size.height = x;
  result.size.width = *&subjectSelectionDelegate;
  result.origin.y = *&overheadCameraModeChangedDelegate;
  result.origin.x = v2;
  return result;
}

- (void)setCenterStageFramingMode:(int)mode
{
  v3 = *&mode;
  HIDWORD(self->_centerStageRectOfInterest.size.width) = mode;
  [-[FigWeakReference referencedObject](self->_maxDepthFrameRateChangedDelegate "referencedObject")];
  [objc_msgSend(*&self->_centerStageRectOfInterest.origin.y "referencedObject")];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  captureStreams = self->_captureStreams;
  v6 = [(NSArray *)captureStreams countByEnumeratingWithState:&v11 objects:v10 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v12;
    do
    {
      v9 = 0;
      do
      {
        if (*v12 != v8)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v11 + 1) + 8 * v9++) setCenterStageFramingMode:v3];
      }

      while (v7 != v9);
      v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v11 objects:v10 count:16];
    }

    while (v7);
  }
}

- (void)setCenterStageMetadataDeliveryEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  LOBYTE(self->_centerStageRectOfInterest.size.height) = enabled;
  referencedObject = [*&self->_centerStageRectOfInterest.origin.y referencedObject];

  [referencedObject didChangeCenterStageMetadataDeliveryEnabled:enabledCopy];
}

- (void)setCenterStageDelegate:(id)delegate
{
  self->_centerStageRectOfInterest.origin.y = 0.0;
  if (delegate)
  {
    v5 = [[FigWeakReference alloc] initWithReferencedObject:delegate];
    *&self->_centerStageRectOfInterest.origin.y = v5;
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __50__BWFigVideoCaptureDevice_setCenterStageDelegate___block_invoke;
    v6[3] = &unk_1E798F870;
    v6[4] = self;
    [-[FigWeakReference referencedObject](v5 "referencedObject")];
  }
}

uint64_t __50__BWFigVideoCaptureDevice_setCenterStageDelegate___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(v2 + 4240) referencedObject];
  v4 = [*(*(a1 + 32) + 4336) referencedObject];

  return fvcd_handleRegionOfInterestChangedForCameraControlsFromFramingDelegates(v2, v3, v4);
}

- (void)setCenterStageFieldOfViewRestrictedToWide:(BOOL)wide
{
  wideCopy = wide;
  LOBYTE(self->_centerStageRectOfInterest.size.width) = wide;
  referencedObject = [*&self->_centerStageRectOfInterest.origin.y referencedObject];

  [referencedObject restrictCenterStageFieldOfViewToWide:wideCopy];
}

- (void)setManualCinematicFramingDelegate:(id)delegate
{
  self->_depthDataDeliveryZoomRange = 0;
  if (delegate)
  {
    v5 = [[FigWeakReference alloc] initWithReferencedObject:delegate];
    self->_depthDataDeliveryZoomRange = v5;
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __61__BWFigVideoCaptureDevice_setManualCinematicFramingDelegate___block_invoke;
    v6[3] = &unk_1E798F870;
    v6[4] = self;
    [-[FigWeakReference referencedObject](v5 "referencedObject")];
  }
}

- (void)startPanningAtPoint:(CGPoint)point
{
  y = point.y;
  x = point.x;
  referencedObject = [(BWZoomRange *)self->_depthDataDeliveryZoomRange referencedObject];

  [referencedObject startPanningAtPoint:{x, y}];
}

- (void)panWithTranslation:(CGPoint)translation
{
  y = translation.y;
  x = translation.x;
  referencedObject = [(BWZoomRange *)self->_depthDataDeliveryZoomRange referencedObject];

  [referencedObject panWithTranslation:{x, y}];
}

- (void)performOneShotFraming
{
  referencedObject = [(BWZoomRange *)self->_depthDataDeliveryZoomRange referencedObject];

  [referencedObject performOneShotFraming];
}

- (void)resetFraming
{
  referencedObject = [(BWZoomRange *)self->_depthDataDeliveryZoomRange referencedObject];

  [referencedObject resetFraming];
}

- (void)setDockedTrackingActive:(BOOL)active
{
  if (BYTE1(self->_portraitEffectPropertiesDelegate) != active)
  {
    v13[9] = v3;
    v13[10] = v4;
    BYTE1(self->_portraitEffectPropertiesDelegate) = active;
    if (self->_deviceType != 16)
    {
      v12 = @"NewPropertyValue";
      v13[0] = [MEMORY[0x1E696AD98] numberWithBool:?];
      v6 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v13 forKeys:&v12 count:1];
      if (dword_1ED844350)
      {
        v11 = 0;
        v10 = 0;
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
        fig_log_call_emit_and_clean_up_after_send_and_compose();
      }

      [(BWFigVideoCaptureDevice *)self _postNotificationWithPayload:@"DockedTrackingActiveChangedNotification" notificationPayload:v6, v8, v9];
    }
  }
}

- (void)setSmartStyleAttachedMediaTimeMachineDelegate:(id)delegate
{
  if (delegate)
  {
    v5 = [[FigWeakReference alloc] initWithReferencedObject:delegate];
  }

  else
  {
    v5 = 0;
  }

  self->_ptsOfLastFrameForStationaryCheck.epoch = v5;
}

- (void)setPortraitEffectPropertiesDelegate:(id)delegate
{
  v5 = *&self->_zoomPIPSuspended;
  if (v5)
  {
    [objc_msgSend(v5 "referencedObject")];
    [objc_msgSend(*&self->_zoomPIPSuspended "referencedObject")];

    *&self->_zoomPIPSuspended = 0;
  }

  if (delegate)
  {
    [BWFigVideoCaptureDevice setPortraitEffectPropertiesDelegate:];
  }
}

- (void)setBackgroundBlurAperture:(float)aperture
{
  backgroundBlurApertureInitial = self->_backgroundBlurApertureInitial;
  if (backgroundBlurApertureInitial >= 0.0)
  {
    if (backgroundBlurApertureInitial != aperture && self->_backgroundBlurEnabled)
    {
      self->_backgroundBlurApertureChanged = 1;
    }
  }

  else
  {
    self->_backgroundBlurApertureInitial = aperture;
  }

  self->_backgroundBlurAperture = aperture;
  v6 = *&self->_zoomPIPSuspended;
  if (v6)
  {
    captureStream = [v6 referencedObject];
  }

  else if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
  {
    captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
  }

  else
  {
    captureStream = self->_captureStream;
  }

  *&v8 = aperture;

  [(BWFigVideoCaptureStream *)captureStream didChangeBackgroundBlurAperture:v8];
}

- (void)setStudioLightingIntensity:(float)intensity
{
  studioLightingIntensityInitial = self->_studioLightingIntensityInitial;
  if (studioLightingIntensityInitial >= 0.0)
  {
    if (studioLightingIntensityInitial != intensity && self->_studioLightingEnabled)
    {
      self->_studioLightingIntensityChanged = 1;
    }
  }

  else
  {
    self->_studioLightingIntensityInitial = intensity;
  }

  self->_studioLightingIntensity = intensity;
  v6 = *&self->_zoomPIPSuspended;
  if (v6)
  {
    captureStream = [v6 referencedObject];
  }

  else if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
  {
    captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
  }

  else
  {
    captureStream = self->_captureStream;
  }

  *&v8 = intensity;

  [(BWFigVideoCaptureStream *)captureStream didChangeStudioLightingIntensity:v8];
}

- (void)setGesturesEnabled:(BOOL)enabled
{
  if (self->_gesturesEnabled != enabled)
  {
    enabledCopy = enabled;
    self->_gesturesEnabled = enabled;
    v6 = mach_absolute_time();
    if (enabledCopy)
    {
      self->_gesturesEnabledStartTime = v6;
    }

    else
    {
      self->_gesturesEnabledTotalTime += v6 - self->_gesturesEnabledStartTime;
    }

    v7 = *&self->_zoomPIPSuspended;
    if (v7)
    {
      captureStream = [v7 referencedObject];
    }

    else if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
    {
      captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
    }

    else
    {
      captureStream = self->_captureStream;
    }

    [(BWFigVideoCaptureStream *)captureStream didChangeGesturesEnabled:enabledCopy];
  }
}

- (void)setSuppressedGesturesEnabled:(BOOL)enabled
{
  if (self->_suppressedGesturesEnabled != enabled)
  {
    enabledCopy = enabled;
    self->_suppressedGesturesEnabled = enabled;
    v6 = *&self->_zoomPIPSuspended;
    if (v6)
    {
      captureStream = [v6 referencedObject];
    }

    else if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
    {
      captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
    }

    else
    {
      captureStream = self->_captureStream;
    }

    [(BWFigVideoCaptureStream *)captureStream didChangeSuppressedGesturesEnabled:enabledCopy];
  }
}

- (void)setBackgroundReplacementPixelBuffer:(__CVBuffer *)buffer
{
  backgroundReplacementPixelBuffer = self->_backgroundReplacementPixelBuffer;
  if (!self->_backgroundReplacementEnabled || buffer == 0 || backgroundReplacementPixelBuffer == 0)
  {
    self->_backgroundReplacementPixelBuffer = buffer;
    if (!buffer)
    {
      if (!backgroundReplacementPixelBuffer)
      {
        goto LABEL_12;
      }

      goto LABEL_11;
    }
  }

  else
  {
    self->_backgroundReplacementPixelBufferChanged = 1;
    self->_backgroundReplacementPixelBuffer = buffer;
  }

  CFRetain(buffer);
  if (backgroundReplacementPixelBuffer)
  {
LABEL_11:
    CFRelease(backgroundReplacementPixelBuffer);
  }

LABEL_12:
  v8 = *&self->_zoomPIPSuspended;
  if (v8)
  {
    captureStream = [v8 referencedObject];
  }

  else if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
  {
    captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
  }

  else
  {
    captureStream = self->_captureStream;
  }

  [(BWFigVideoCaptureStream *)captureStream didChangeBackgroundReplacementPixelBuffer:buffer];
}

- (void)setSecureMetadataEnabled:(BOOL)enabled
{
  if ((self->_firstValidFramePTS.value & 1) == 0)
  {
    LOBYTE(self->_firstValidFramePTS.value) = enabled;
  }
}

- (void)setTrueVideoCaptureEnabled:(BOOL)enabled
{
  if (BYTE4(self->_exifFocalLengthsByZoomFactor) != enabled)
  {
    v16 = v3;
    v17 = v4;
    enabledCopy = enabled;
    BYTE4(self->_exifFocalLengthsByZoomFactor) = enabled;
    v12 = 0u;
    v13 = 0u;
    v14 = 0u;
    v15 = 0u;
    captureStreams = self->_captureStreams;
    v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v13;
      do
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v13 != v9)
          {
            objc_enumerationMutation(captureStreams);
          }

          [*(*(&v12 + 1) + 8 * i) setTrueVideoCaptureEnabled:enabledCopy];
        }

        v8 = [(NSArray *)captureStreams countByEnumeratingWithState:&v12 objects:v11 count:16];
      }

      while (v8);
    }
  }
}

- (void)setMaximumFrameRate:(float)rate attachedSessionID:(id)d
{
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  captureStreams = self->_captureStreams;
  v7 = [(NSArray *)captureStreams countByEnumeratingWithState:&v13 objects:v12 count:16];
  if (v7)
  {
    v9 = v7;
    v10 = *v14;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v14 != v10)
        {
          objc_enumerationMutation(captureStreams);
        }

        *&v8 = rate;
        [*(*(&v13 + 1) + 8 * i) setMaximumFrameRate:d attachedSessionID:v8];
      }

      v9 = [(NSArray *)captureStreams countByEnumeratingWithState:&v13 objects:v12 count:16];
    }

    while (v9);
  }
}

- (void)liveReconfigureForOutputAspectRatioCompleted:(int64_t)completed forConfigurationID:(int64_t)d
{
  os_unfair_lock_lock(&self->_longestContinuousPortraitInPhotoPreviewInMS);
  v7 = [*&self->_invalidFrameCountAfterFirstValidFrame objectForKeyedSubscript:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithLongLong:", d)}];
  if (!v7)
  {
    v8 = *MEMORY[0x1E695E480];
    time = **&MEMORY[0x1E6960C70];
    v7 = CMTimeCopyAsDictionary(&time, v8);
  }

  v27[0] = @"NewPropertyValue";
  v27[1] = @"OutputAspectRatioRequestID";
  v28[0] = v7;
  v28[1] = [MEMORY[0x1E696AD98] numberWithLongLong:completed];
  v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v28 forKeys:v27 count:2];
  if (dword_1ED844350)
  {
    v26 = 0;
    v25 = OS_LOG_TYPE_DEFAULT;
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v11 = v26;
    if (os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, v25))
    {
      v12 = v11;
    }

    else
    {
      v12 = v11 & 0xFFFFFFFE;
    }

    if (v12)
    {
      v16 = 136315906;
      v17 = "[BWFigVideoCaptureDevice liveReconfigureForOutputAspectRatioCompleted:forConfigurationID:]";
      v18 = 2114;
      v19 = v9;
      v20 = 2048;
      dCopy = d;
      v22 = 2114;
      selfCopy = self;
      LODWORD(v15) = 42;
      v14 = &v16;
      _os_log_send_and_compose_impl();
    }

    fig_log_call_emit_and_clean_up_after_send_and_compose();
  }

  [(BWFigVideoCaptureDevice *)self _postNotificationWithPayload:@"LiveReconfigurationComplete" notificationPayload:v9, v14, v15];
  if ((d & 0x8000000000000000) == 0)
  {
    v13 = 0;
    do
    {
      [*&self->_invalidFrameCountAfterFirstValidFrame removeObjectForKey:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithLongLong:", v13++)}];
    }

    while (d + 1 != v13);
  }

  os_unfair_lock_unlock(&self->_longestContinuousPortraitInPhotoPreviewInMS);
}

- (void)setVideoHDRImageStatisticsEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  v12 = 0u;
  v13 = 0u;
  v10 = 0u;
  v11 = 0u;
  captureStreams = self->_captureStreams;
  v5 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
  if (v5)
  {
    v6 = v5;
    v7 = *v11;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v11 != v7)
        {
          objc_enumerationMutation(captureStreams);
        }

        [*(*(&v10 + 1) + 8 * i) setVideoHDRImageStatisticsEnabled:enabledCopy];
      }

      v6 = [(NSArray *)captureStreams countByEnumeratingWithState:&v10 objects:v9 count:16];
    }

    while (v6);
  }
}

- (void)pulseGenerator:(id)generator updateSynchronizationClock:(unint64_t)clock withError:(int)error
{
  if (*MEMORY[0x1E69DA108] == clock)
  {
    v11 = @"PulseGeneratorUpdateClockID";
    v10 = [MEMORY[0x1E696AD98] numberWithInt:{*&error, @"PulseGeneratorError"}];
    v12 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v10 forKeys:&v9 count:1];
    v6 = MEMORY[0x1E695DF20];
    v7 = &v12;
    v8 = &v11;
  }

  else
  {
    v15 = @"PulseGeneratorUpdateClockID";
    v13 = @"PulseGeneratorUpdateStatus";
    v14 = [MEMORY[0x1E696AD98] numberWithUnsignedLongLong:clock];
    v16 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v14 forKeys:&v13 count:1];
    v6 = MEMORY[0x1E695DF20];
    v7 = &v16;
    v8 = &v15;
  }

  -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"FigPulseGeneratorUpdate", [v6 dictionaryWithObjects:v7 forKeys:v8 count:1]);
}

- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withOutOfBoundsError:(int64_t)error
{
  v5 = *&d;
  v9 = @"PulseGeneratorUpdateOutOfBounds";
  v7[1] = @"PulseGeneratorUpdateTriggerID";
  v8[0] = [MEMORY[0x1E696AD98] numberWithLongLong:{error, @"PulseGeneratorError"}];
  v8[1] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v5];
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v8 forKeys:v7 count:2];
  -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"FigPulseGeneratorUpdate", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v10 forKeys:&v9 count:1]);
}

- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withLockState:(BOOL)state
{
  stateCopy = state;
  v9 = @"PulseGeneratorUpdateLockState";
  v7[1] = @"PulseGeneratorUpdateState";
  v8[0] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{*&d, @"PulseGeneratorUpdateTriggerID"}];
  v8[1] = [MEMORY[0x1E696AD98] numberWithBool:stateCopy];
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v8 forKeys:v7 count:2];
  -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"FigPulseGeneratorUpdate", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v10 forKeys:&v9 count:1]);
}

- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withSessionStoppedExitStatus:(unsigned int)status
{
  v5 = *&status;
  v9 = @"PulseGeneratorUpdateSessionStopped";
  v7[1] = @"PulseGeneratorUpdateStatus";
  v8[0] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{*&d, @"PulseGeneratorUpdateTriggerID"}];
  v8[1] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v5];
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v8 forKeys:v7 count:2];
  -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"FigPulseGeneratorUpdate", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v10 forKeys:&v9 count:1]);
}

- (void)pulseGenerator:(id)generator updatedTriggerID:(unsigned int)d withTriggerIsPresent:(BOOL)present
{
  presentCopy = present;
  v9 = @"PulseGeneratorUpdateTriggerPreset";
  v7[1] = @"PulseGeneratorUpdateState";
  v8[0] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:{*&d, @"PulseGeneratorUpdateTriggerID"}];
  v8[1] = [MEMORY[0x1E696AD98] numberWithBool:presentCopy];
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v8 forKeys:v7 count:2];
  -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"FigPulseGeneratorUpdate", [MEMORY[0x1E695DF20] dictionaryWithObjects:&v10 forKeys:&v9 count:1]);
}

- (CGSize)defaultAutoFocusTapWindowSize
{
  variableFrameRateUpdateQueue = self->_variableFrameRateUpdateQueue;
  v3 = *&self->_teleAutoVideoFrameRateAllows24FPS;
  result.height = v3;
  result.width = *&variableFrameRateUpdateQueue;
  return result;
}

- (CGSize)defaultContinuousAutoFocusWindowSize
{
  cinematicVideoFocusRequest = self->_cinematicVideoFocusRequest;
  width = self->_defaultAutoFocusTapWindowSize.width;
  result.height = width;
  result.width = *&cinematicVideoFocusRequest;
  return result;
}

- (void)_copyStreamsForAttributes:deviceClientPriority:errOut:
{
  OUTLINED_FUNCTION_84();
  if (v0)
  {
    v4 = v3;
    v5 = v2;
    v6 = v1;
    v7 = v0;
    v40[0] = 0;
    v8 = FigCaptureExternalCameraReplacesBuiltIn(0);
    v9 = [objc_msgSend(*(v7 + 8) "deviceID")];
    [v6 count];
    v10 = [OUTLINED_FUNCTION_37_0() arrayWithCapacity:?];
    if (v9 & 1) != 0 || (v8)
    {
      v37 = v5;
      [v6 count];
      v22 = [OUTLINED_FUNCTION_36() arrayWithCapacity:?];
      OUTLINED_FUNCTION_13_14();
      v27 = OUTLINED_FUNCTION_64(v23, v24, v25, v26);
      if (v27)
      {
        v28 = v27;
        do
        {
          for (i = 0; i != v28; ++i)
          {
            OUTLINED_FUNCTION_42();
            if (!v30)
            {
              objc_enumerationMutation(v6);
            }

            [*(8 * i) objectForKeyedSubscript:@"DeviceType"];
            [OUTLINED_FUNCTION_37_0() addObject:?];
            [OUTLINED_FUNCTION_6_75() objectForKeyedSubscript:?];
            [OUTLINED_FUNCTION_36() addObject:?];
          }

          OUTLINED_FUNCTION_13_14();
          v28 = OUTLINED_FUNCTION_64(v31, v32, v33, v34);
        }

        while (v28);
      }

      v35 = [*(v7 + 16) copyStreamsFromDevice:*(v7 + 8) positions:v22 deviceTypes:v10 deviceClientPriority:v37 allowsStreamControlLoss:0 error:v40];
      if (v40[0])
      {
        OUTLINED_FUNCTION_14_21();
        FigDebugAssert3();
      }

      else
      {
        v36 = [v35 count];
        if (v36 != [v6 count])
        {
          OUTLINED_FUNCTION_0();
          goto LABEL_28;
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_6_78();
      v13 = OUTLINED_FUNCTION_64(v11, v12, v39, v38);
      if (v13)
      {
        v14 = v13;
        OUTLINED_FUNCTION_343();
        v15 = *off_1E798C240;
        do
        {
          for (j = 0; j != v14; ++j)
          {
            OUTLINED_FUNCTION_13_1();
            if (v17 != 0x1E695D000)
            {
              objc_enumerationMutation(v6);
            }

            [*(v39[1] + 8 * j) objectForKeyedSubscript:v15];
            v18 = [OUTLINED_FUNCTION_37_0() addObject:?];
          }

          v14 = OUTLINED_FUNCTION_64(v18, v19, v39, v38);
        }

        while (v14);
      }

      v20 = [*(v7 + 16) copyStreamsWithUniqueIDs:v10 forDevice:*(v7 + 8) deviceClientPriority:v5 error:v40];
      if (v40[0])
      {
        OUTLINED_FUNCTION_14_21();
        FigDebugAssert3();
      }

      else
      {
        v21 = [v20 count];
        if (v21 != [v6 count])
        {
          OUTLINED_FUNCTION_0();
LABEL_28:
          FigDebugAssert3();
          v40[0] = -12780;
        }
      }
    }

    *v4 = v40[0];
  }

  OUTLINED_FUNCTION_81();
}

- (uint64_t)_createBWFigVideoCaptureStreamsForCaptureStreams:(void *)streams attributeDictionaries:(void *)dictionaries cameraParameters:synchronizedStreamsGroup:clientAuditToken:tccIdentity:mediaEnvironment:
{
  if (result)
  {
    v5 = result;
    v6 = objc_alloc(MEMORY[0x1E695DF70]);
    [a2 count];
    v7 = [OUTLINED_FUNCTION_17() initWithCapacity:?];
    [a2 count];
    v18 = [OUTLINED_FUNCTION_17() dictionaryWithCapacity:?];
    [a2 count];
    v8 = [OUTLINED_FUNCTION_17() dictionaryWithCapacity:?];
    if ([a2 count])
    {
      v9 = 0;
      do
      {
        v10 = v7;
        v11 = [a2 objectAtIndexedSubscript:v9];
        portType = [v11 portType];
        [streams objectAtIndexedSubscript:v9];
        [dictionaries sensorIDDictionaryForStream:v11];
        v13 = [BWFigVideoCaptureStream alloc];
        OUTLINED_FUNCTION_209();
        v15 = [v14 initWithCaptureStream:v11 parentDevice:? attributes:? sensorIDDictionary:? synchronizedStreamsGroup:? applicationID:? clientAuditToken:? tccIdentity:? mediaEnvironment:? error:?];
        [v15 setDelegate:v5];
        [v18 setObject:objc_msgSend(v15 forKeyedSubscript:{"moduleInfo"), portType}];
        [v15 sensorIDDictionary];
        [OUTLINED_FUNCTION_17() setObject:? forKeyedSubscript:?];
        *(v5 + 288) = 1077936128;
        *(v5 + 320) = 1056964608;
        [BWFigVideoCaptureDevice _sendInitialValuesToPortraitEffectPropertiesDelegate:v5];
        v7 = v10;
        [OUTLINED_FUNCTION_9_0() addObject:?];

        ++v9;
      }

      while ([a2 count] > v9);
    }

    *(v5 + 96) = [v18 copy];
    *(v5 + 104) = [v8 copy];
    *(v5 + 656) = [v7 copy];
    *(v5 + 112) = objc_alloc_init(MEMORY[0x1E695DF90]);

    return 0;
  }

  return result;
}

- (void)_configureZoomFudgingWithAspectRatio:(uint64_t)ratio
{
  if (ratio)
  {
    clientBaseZoomFactorsByPortType = [*(ratio + 648) clientBaseZoomFactorsByPortType];
    if ([clientBaseZoomFactorsByPortType count])
    {
      goto LABEL_3;
    }

    v61 = *off_1E798A0D0;
    v62 = OUTLINED_FUNCTION_70();
    v63 = [BWFigVideoCaptureDevice _captureStreamByPortType:v62];
    if (v63)
    {
      v64 = v63;
      if (a2)
      {
        [v63 fudgedBaseZoomFactorForAspectRatio:?];
      }

      else
      {
        [v63 baseZoomFactorAfterGDC];
      }

      v66 = v65;
      [v64 baseZoomFactor];
      if (v66 != v67)
      {
        v80 = v61;
        v81 = &unk_1F224A940;
        clientBaseZoomFactorsByPortType = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v81 forKeys:&v80 count:1];
      }
    }

    v68 = *off_1E798A0F8;
    v69 = OUTLINED_FUNCTION_70();
    v70 = [BWFigVideoCaptureDevice _captureStreamByPortType:v69];
    if (!v70)
    {
      goto LABEL_3;
    }

    v71 = v70;
    if (a2)
    {
      [v70 fudgedBaseZoomFactorForAspectRatio:?];
    }

    else
    {
      [v70 baseZoomFactorAfterGDC];
    }

    v73 = v72;
    [v71 baseZoomFactor];
    if (v73 == v74)
    {
LABEL_3:
      v3 = [clientBaseZoomFactorsByPortType count];
    }

    else
    {
      v78 = v68;
      v79 = &unk_1F224A940;
      clientBaseZoomFactorsByPortType = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v79 forKeys:&v78 count:1];
      v3 = [clientBaseZoomFactorsByPortType count];
    }

    if (!v3)
    {
      goto LABEL_42;
    }

    array = [MEMORY[0x1E695DF70] array];
    array2 = [MEMORY[0x1E695DF70] array];
    if ([*(ratio + 664) count])
    {
      v6 = 0;
      v75 = *off_1E798A0E8;
      v7 = 0.0;
      do
      {
        v8 = [*(ratio + 664) objectAtIndexedSubscript:v6];
        portType = [v8 portType];
        if ([clientBaseZoomFactorsByPortType objectForKeyedSubscript:portType] && (objc_msgSend(portType, "isEqualToString:", v75) & 1) == 0)
        {
          [objc_msgSend(clientBaseZoomFactorsByPortType objectForKeyedSubscript:{portType), "floatValue"}];
          v11 = v10;
          if (v10 == 0.0)
          {
            [v8 baseZoomFactor];
            v11 = v12;
          }

          if (a2)
          {
            [v8 fudgedBaseZoomFactorForAspectRatio:?];
          }

          else
          {
            [v8 baseZoomFactorAfterGDC];
          }

          v14 = *&v13;
          *&v13 = v11;
          [MEMORY[0x1E696AD98] numberWithFloat:v13];
          [OUTLINED_FUNCTION_8() addObject:?];
          *&v15 = v14;
          [MEMORY[0x1E696AD98] numberWithFloat:v15];
          [OUTLINED_FUNCTION_7() addObject:?];
          v7 = v11 + v11;
          nondisruptiveSwitchingZoomFactors = [v8 nondisruptiveSwitchingZoomFactors];
          OUTLINED_FUNCTION_47_0();
          v18 = [v17 countByEnumeratingWithState:? objects:? count:?];
          if (v18)
          {
            v19 = v18;
            do
            {
              for (i = 0; i != v19; ++i)
              {
                OUTLINED_FUNCTION_21_20();
                if (!v46)
                {
                  objc_enumerationMutation(nondisruptiveSwitchingZoomFactors);
                }

                [*(8 * i) floatValue];
                if (v21 > v14)
                {
                  v22 = v21;
                  if ([*(ratio + 664) count] > v6 + 1)
                  {
                    v24 = [*(ratio + 664) objectAtIndexedSubscript:v6 + 1];
                    if (a2)
                    {
                      [v24 fudgedBaseZoomFactorForAspectRatio:?];
                    }

                    else
                    {
                      [v24 baseZoomFactorAfterGDC];
                    }

                    if (*&v23 <= v22)
                    {
                      goto LABEL_28;
                    }
                  }

                  *&v23 = (v11 * v22) / v14;
                  [MEMORY[0x1E696AD98] numberWithFloat:v23];
                  [OUTLINED_FUNCTION_8() addObject:?];
                  *&v25 = v22;
                  [MEMORY[0x1E696AD98] numberWithFloat:v25];
                  [OUTLINED_FUNCTION_7() addObject:?];
                  v7 = ((v11 * v22) / v14) + ((v11 * v22) / v14);
                }
              }

              OUTLINED_FUNCTION_47_0();
              v19 = OUTLINED_FUNCTION_273(v26, v27, v28, v29);
            }

            while (v19);
          }
        }

LABEL_28:
        ++v6;
      }

      while ([*(ratio + 664) count] > v6);
      if (v7 != 0.0)
      {
        *&v30 = v7;
        [MEMORY[0x1E696AD98] numberWithFloat:v30];
        [OUTLINED_FUNCTION_8() addObject:?];
        *&v31 = v7;
        [MEMORY[0x1E696AD98] numberWithFloat:v31];
        [OUTLINED_FUNCTION_7() addObject:?];
      }
    }

    if ([array count] >= 2)
    {
      v32 = [array count] - 1;
      v33 = [MEMORY[0x1E695DF70] arrayWithCapacity:v32];
      if (v32)
      {
        v34 = 0;
        do
        {
          v35 = v34;
          [objc_msgSend(OUTLINED_FUNCTION_351() "objectAtIndexedSubscript:"floatValue"")];
          v37 = v36;
          ++v34;
          [objc_msgSend(OUTLINED_FUNCTION_351() "objectAtIndexedSubscript:"floatValue"")];
          v39 = v38;
          [objc_msgSend(array2 objectAtIndexedSubscript:{v35), "floatValue"}];
          v41 = v40;
          [objc_msgSend(array2 objectAtIndexedSubscript:{v34), "floatValue"}];
          v46 = v37 == v41 && v39 == *&v42;
          if (!v46)
          {
            LODWORD(v45) = LODWORD(v42);
            *&v42 = v37;
            *&v43 = v39;
            *&v44 = v41;
            if ([BWZoomRange fudgedZoomRangeWithLower:v42 upperBound:v43 fudgedLowerBound:v44 fudgedUpperBound:v45])
            {
              [OUTLINED_FUNCTION_4() addObject:?];
            }
          }
        }

        while (v34 != v32);
      }
    }

    else
    {
LABEL_42:
      v33 = 0;
    }

    [*(ratio + 2952) setFudgedZoomRanges:v33];
    OUTLINED_FUNCTION_204();
    if (!v46 || ([objc_msgSend(objc_msgSend(*(ratio + 624) objectForKeyedSubscript:{@"VideoZoomFactorsForDepthDataDelivery", "firstObject"), "floatValue"}], *&v47 == 0.0))
    {
      v60 = 0;
    }

    else
    {
      v48 = LODWORD(v47);
      if (*(ratio + 4300) == 0.0)
      {
        v49 = INFINITY;
      }

      else
      {
        v49 = *(ratio + 4300);
      }

      [*(ratio + 2952) applyFudgeToZoomFactor:v47];
      v51 = v50;
      *&v52 = v49;
      [*(ratio + 2952) applyFudgeToZoomFactor:v52];
      v54 = v53;
      v55 = [BWZoomRange alloc];
      LODWORD(v56) = v48;
      *&v57 = v49;
      LODWORD(v58) = v51;
      LODWORD(v59) = v54;
      v60 = [(BWZoomRange *)v55 initWithLowerBound:v56 upperBound:v57 fudgedLowerBound:v58 fudgedUpperBound:v59];
    }

    os_unfair_lock_lock((ratio + 4308));

    *(ratio + 4312) = v60;
    os_unfair_lock_unlock((ratio + 4308));
  }
}

- (void)invalidateForParallelGraphRebuild
{
  [(BWFigVideoCaptureDevice *)self releaseResources];
  [(BWFigVideoCaptureDevice *)self _returnStreamsToVendor];

  self->_deviceVendor = 0;
  memset(v10, 0, sizeof(v10));
  captureStreams = self->_captureStreams;
  if (OUTLINED_FUNCTION_37(v4, v5, v10, v9))
  {
    do
    {
      OUTLINED_FUNCTION_49_7();
      if (!v6)
      {
        objc_enumerationMutation(captureStreams);
      }

      [**(&v10[0] + 1) setDelegate:0];
      OUTLINED_FUNCTION_120_0();
    }

    while (!v6 || OUTLINED_FUNCTION_37(v7, v8, v10, v9));
  }

  self->_synchronizedStreamsStartStopSynchronizer = 0;
  self->_synchronizedStreamsGroup = 0;
  self->_captureStream = 0;
  self->_pearlInfraredCaptureStream = 0;
  self->_parallaxMitigationTargetCaptureStream = 0;
  self->_bravoTelephotoCaptureStream = 0;
  *&self->_bravoSuperWideCaptureStream = 0u;
  *&self->_currentMasterCaptureStream = 0u;

  self->_captureStreams = 0;
  self->_captureStreamsByFocalLength = 0;

  self->_memoryPool = 0;
  self->_device = 0;
}

- (void)dealloc
{
  [(BWFigVideoCaptureDevice *)self releaseResources];

  self->_notificationQueue = 0;
  [(BWFigVideoCaptureDevice *)self _returnStreamsToVendor];

  OUTLINED_FUNCTION_43_13();
  captureStreams = self->_captureStreams;
  if (OUTLINED_FUNCTION_64(v4, v5, v15, v14))
  {
    do
    {
      OUTLINED_FUNCTION_21_20();
      if (!v6)
      {
        objc_enumerationMutation(captureStreams);
      }

      [*v16 setDelegate:0];
      OUTLINED_FUNCTION_131_2();
    }

    while (!v6 || OUTLINED_FUNCTION_64(v7, v8, v15, v14));
  }

  clock = self->_clock;
  if (clock)
  {
    CFRelease(clock);
  }

  msgClock = self->_msgClock;
  if (msgClock)
  {
    CFRelease(msgClock);
  }

  [+[FigPulseGenerator sharedFigPulseGenerator](FigPulseGenerator "sharedFigPulseGenerator")];
  autoImageControlModeTransitionMonitor = 0;
  if (self->_autoImageControlModeTransitionMonitor)
  {
    OUTLINED_FUNCTION_0_3();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
    autoImageControlModeTransitionMonitor = self->_autoImageControlModeTransitionMonitor;
  }

  if (self->_autofocusProcessor)
  {
    OUTLINED_FUNCTION_0_3();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  FigSimpleMutexDestroy();
  FigSimpleMutexDestroy();

  FigSimpleMutexDestroy();
  backgroundReplacementPixelBuffer = self->_backgroundReplacementPixelBuffer;
  if (backgroundReplacementPixelBuffer)
  {
    CFRelease(backgroundReplacementPixelBuffer);
  }

  v13.receiver = self;
  v13.super_class = BWFigVideoCaptureDevice;
  [(BWFigVideoCaptureDevice *)&v13 dealloc];
}

- (uint64_t)_sendInitialValuesToPortraitEffectPropertiesDelegate:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_80();
    LODWORD(v4) = *(v3 + 288);
    [v5 didChangeBackgroundBlurAperture:v4];
    LODWORD(v6) = *(v2 + 320);
    [v1 didChangeStudioLightingIntensity:v6];
    [v1 didChangeGesturesEnabled:*(v2 + 326)];
    [v1 didChangeSuppressedGesturesEnabled:*(v2 + 327)];
    [v1 didChangeBackgroundReplacementPixelBuffer:*(v2 + 392)];
    v7 = [FigWeakReference weakReferenceToObject:v2];
    OUTLINED_FUNCTION_112_6();
    v11 = 3221225472;
    v12 = __80__BWFigVideoCaptureDevice__sendInitialValuesToPortraitEffectPropertiesDelegate___block_invoke;
    v13 = &unk_1E799C558;
    v14 = v8;
    [v1 setReactionsInProgressChangedHandler:v10];
    OUTLINED_FUNCTION_33_0();
    v9[1] = 3221225472;
    v9[2] = __80__BWFigVideoCaptureDevice__sendInitialValuesToPortraitEffectPropertiesDelegate___block_invoke_2;
    v9[3] = &unk_1E798F870;
    v9[4] = v7;
    return [v1 setSuppressedGestureHandler:v9];
  }

  return result;
}

- (uint64_t)_setMinimumFrameRate:(unsigned int)rate
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    memset(&v26, 0, sizeof(v26));
    v7 = *(v6 + 600);
    if (v7)
    {
      [v7 maxExposureDuration];
    }

    OUTLINED_FUNCTION_6_78();
    v8 = *(v3 + 656);
    OUTLINED_FUNCTION_345();
    v13 = OUTLINED_FUNCTION_64(v9, v10, v11, v12);
    if (v13)
    {
      v14 = v13;
      do
      {
        for (i = 0; i != v14; ++i)
        {
          OUTLINED_FUNCTION_89();
          if (!v16)
          {
            objc_enumerationMutation(v8);
          }

          [*(v25 + 8 * i) setMinimumFrameRate:{v4, rate}];
        }

        OUTLINED_FUNCTION_345();
        v14 = OUTLINED_FUNCTION_64(v17, v18, v19, v20);
      }

      while (v14);
    }

    if ([objc_msgSend(*(v3 + 624) objectForKeyedSubscript:{@"Exposure", "BOOLValue"}])
    {
      if ((v26.flags & 1) == 0)
      {
        v21 = *MEMORY[0x1E695E480];
        time = v26;
        v22 = CMTimeCopyAsDictionary(&time, v21);
        [v3 _postNotificationWithPayload:@"MaxExposureDurationChanged" notificationPayload:{OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v23, @"NewPropertyValue", v22)}];
      }
    }

    return [(BWFigVideoCaptureDevice *)v3 _updateFrameSkippingRatio];
  }

  return result;
}

- (void)setMaximumFrameRate:(id)rate
{
  var1 = rate.var1;
  OUTLINED_FUNCTION_176();
  OUTLINED_FUNCTION_1_13();
  v8 = *(v7 + 656);
  if (OUTLINED_FUNCTION_0_0(v7, v9, v10, v11, v12, v13, v14, v15, v28, v30, v32, v34, v36, v38, v40, v42, v44, v46, v48, v50, v52, v54, v56, v58, v60))
  {
    OUTLINED_FUNCTION_61_6();
    v17 = *v16;
    do
    {
      v18 = 0;
      do
      {
        OUTLINED_FUNCTION_4_10();
        if (v19 != v17)
        {
          objc_enumerationMutation(v8);
        }

        v20 = [*(v62 + 8 * v18++) setMaximumFrameRate:{v4, var1}];
      }

      while (v5 != v18);
      v5 = OUTLINED_FUNCTION_0_0(v20, v21, v22, v23, v24, v25, v26, v27, v29, v31, v33, v35, v37, v39, v41, v43, v45, v47, v49, v51, v53, v55, v57, v59, v61);
    }

    while (v5);
  }

  [*(v3 + 2952) requestedZoomFactor];
  [BWFigVideoCaptureDevice _updateSlaveFrameRateForZoomFactor:v3];
  [(BWFigVideoCaptureDevice *)v3 _updateFrameSkippingRatio];
}

- (void)_updateSlaveFrameRateForZoomFactor:(uint64_t)factor
{
  if (factor)
  {
    OUTLINED_FUNCTION_124_5();
    os_unfair_lock_lock(v2 + 352);
    os_unfair_lock_unlock(v1 + 352);
    OUTLINED_FUNCTION_114_4();

    [BWFigVideoCaptureDevice _updateSlaveFrameRateForZoomFactor:v3 masterCaptureStream:?];
  }
}

- (void)_cameraColorCalibrationsForCaptureStream:(void *)result absoluteColorCalibrationsByPortType:
{
  if (result)
  {
    OUTLINED_FUNCTION_67_8();
    v3 = 0;
    +[FigCaptureCameraParameters sharedInstance];
    [OUTLINED_FUNCTION_18_0() portType];
    [OUTLINED_FUNCTION_133() sensorIDString];
    result = [objc_msgSend(OUTLINED_FUNCTION_39() "sensorIDDictionaryForPortType:"objectForKeyedSubscript:" sensorIDString:@"ModuleConfig"")];
    if (result)
    {
      v1 = result;
      result = [objc_msgSend(result objectForKeyedSubscript:{@"AutoWhiteBalance", "objectForKeyedSubscript:", @"IdealColorCalibrations"}];
      if (result)
      {
        v2 = result;
        result = [v1 objectForKeyedSubscript:@"AutoWhiteBalance"];
        if (result)
        {
          [OUTLINED_FUNCTION_133() portType];
          result = [OUTLINED_FUNCTION_17() objectForKeyedSubscript:?];
          if (result)
          {
            [MEMORY[0x1E6993800] getColorCalibrationsUsingIdealColorCalbrations:v2 absoluteColorCalibrations:result colorCalibrationsOut:&v3 awbConfig:v1];
            return v3;
          }
        }
      }
    }
  }

  return result;
}

- (void)_flashCalibrationDataForCaptureStream:(uint64_t)stream absoluteColorCalibrationsByPortType:(void *)type
{
  if (!stream)
  {
    return 0;
  }

  v3 = [objc_msgSend(type "stream")];
  v4 = v3;
  if (v3)
  {
    bytes = [v3 bytes];
    if (bytes)
    {
      v6 = bytes;
      portType = [type portType];
      v8 = *off_1E798A0D0;
      if ([portType isEqualToString:*off_1E798A0D0])
      {
        if (*v6 == 1)
        {
          +[FigCaptureCameraParameters sharedInstance];
          [type sensorIDString];
          v9 = [objc_msgSend(OUTLINED_FUNCTION_67_5() sensorIDDictionaryForPortType:v8) sensorIDString:{"objectForKeyedSubscript:", @"ModuleConfig"}];
          if (v9)
          {
            v10 = v9;
            cameraTuningParameters = [+[FigCaptureCameraParameters sharedInstance](FigCaptureCameraParameters cameraTuningParameters];
            v12 = *off_1E798A0C0;
            v13 = [objc_msgSend(-[NSDictionary objectForKeyedSubscript:](cameraTuningParameters objectForKeyedSubscript:{*off_1E798A0C0), "allKeys"), "firstObject"}];
            if (v13)
            {
              v14 = [-[FigCaptureCameraParameters sensorIDDictionaryForPortType:sensorIDString:](+[FigCaptureCameraParameters sharedInstance](FigCaptureCameraParameters "sharedInstance")];
              if (v14)
              {
                v15 = v14;
                if (FigCapturePlatformIdentifier() > 11)
                {
                  if ([OUTLINED_FUNCTION_267() objectForKeyedSubscript:?])
                  {
                    v16 = [OUTLINED_FUNCTION_352() objectForKeyedSubscript:v12];
                    if (v16)
                    {
                      [MEMORY[0x1E6993800] calculateSTRBKeyFromWideCameraLatticeModel:v6 moduleConfig:v15 absoluteColorCalibrations:v16 secondaryModuleConfig:v10 secondaryAbsoluteColorCalibrations:v8];
                    }
                  }
                }

                else
                {
                  [MEMORY[0x1E6993800] calculateSTRBKeyFromWideCamera:v6 moduleConfig:v10 secondaryModuleConfig:v15];
                }
              }
            }

            else
            {
              OUTLINED_FUNCTION_0();
              FigDebugAssert3();
            }
          }
        }
      }
    }
  }

  return v4;
}

- (void)_postNotificationWithName:(void *)name payloadNewPropertyValue:
{
  nameCopy = name;
  if (self)
  {
    OUTLINED_FUNCTION_80();
    [objc_alloc(MEMORY[0x1E695DF20]) initWithObjects:&nameCopy forKeys:&BWFigVideoCaptureDeviceNotificationNewPropertyValueKey count:name != 0];
    [OUTLINED_FUNCTION_18_0() _postNotificationWithPayload:v3 notificationPayload:name];
  }
}

- (void)_updateWhiteBalanceStateForAutofocusProperty:(const void *)property propertyValue:
{
  if (!self)
  {
    return;
  }

  OUTLINED_FUNCTION_166();
  if (CFEqual(v4, @"AutoWhiteBalanceLock"))
  {
    v6 = CFGetTypeID(property);
    if (v6 != CFBooleanGetTypeID() || !CFBooleanGetValue(property))
    {
      v7 = 0;
      v8 = 1;
LABEL_8:
      FigSimpleMutexLock();
      *(v3 + 1828) = v8;
      if (v7)
      {
        [v3 _postNotificationWithPayload:@"AWBStatusChanged" notificationPayload:{OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v9, @"NewPropertyValue", MEMORY[0x1E695E118])}];
      }

      FigSimpleMutexUnlock();
      return;
    }

LABEL_7:
    v8 = 0;
    v7 = 1;
    goto LABEL_8;
  }

  if (CFEqual(v4, @"WhiteBalanceGains"))
  {
    goto LABEL_7;
  }

  if (CFEqual(v4, @"AutofocusProcessor_VideoMode") && ([&unk_1F2249A50 containsObject:FigCaptureGetModelSpecificName()] & 1) == 0)
  {
    if (CFEqual(property, @"Mode_StillPreview"))
    {
      v10 = 0;
    }

    else
    {
      v10 = CFEqual(property, @"Mode_Panorama") == 0;
    }

    v11 = *(v3 + 1664);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __86__BWFigVideoCaptureDevice__updateWhiteBalanceStateForAutofocusProperty_propertyValue___block_invoke;
    block[3] = &unk_1E7990078;
    block[4] = v3;
    v13 = v10;
    dispatch_async(v11, block);
  }
}

- (uint64_t)_updateImageControlModeStateForAutofocusProperty:(const void *)property propertyValue:
{
  if (result)
  {
    v3 = result;
    if (*(result + 2004) == 1)
    {
      result = CFEqual(cf1, @"AutofocusProcessor_VideoMode");
      if (result)
      {
        if (!property || (v5 = CFGetTypeID(property), v5 != CFStringGetTypeID()))
        {
          OUTLINED_FUNCTION_2_9();
          return FigDebugAssert3();
        }

        if (CFEqual(property, @"Mode_StillPreview"))
        {
          v6 = 0;
        }

        else if (CFEqual(property, @"Mode_VideoPreview"))
        {
          v6 = 1;
        }

        else if (CFEqual(property, @"Mode_VideoRecording"))
        {
          v6 = 2;
        }

        else if (CFEqual(property, @"Mode_Conference"))
        {
          v6 = 3;
        }

        else if (CFEqual(property, @"Mode_Panorama"))
        {
          v6 = 4;
        }

        else if (CFEqual(property, @"Mode_TimeLapsePreview"))
        {
          v6 = 5;
        }

        else
        {
          result = CFEqual(property, @"Mode_TimeLapseCapture");
          if (!result)
          {
            return result;
          }

          v6 = 6;
        }

        [MEMORY[0x1E696AD98] numberWithInt:v6];
        return [v3 _postNotificationWithPayload:@"ImageControlModeChanged" notificationPayload:{OUTLINED_FUNCTION_41(MEMORY[0x1E695DF20], v7, v8, v9)}];
      }
    }
  }

  return result;
}

- (uint64_t)_shouldDeferAutofocusProcessorProperty:(void *)property value:
{
  if (!self)
  {
    return 0;
  }

  OUTLINED_FUNCTION_166();
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_0();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  if (![v4 isEqualToString:0x1F2189F90])
  {
    if ([v4 isEqualToString:0x1F218A470])
    {
      [objc_msgSend(property objectForKeyedSubscript:{*off_1E798AED0), "floatValue"}];
      if (v7 == 0.0)
      {
        [objc_msgSend(property objectForKeyedSubscript:{*off_1E798AEC8), "floatValue"}];
        if (v8 == 0.0)
        {
          [objc_msgSend(property objectForKeyedSubscript:{*off_1E798AEC0), "floatValue"}];
          if (v9 == 0.0)
          {
            v6 = 1;
            *(v3 + 1832) = 1;
            *(v3 + 1836) = [objc_msgSend(property objectForKeyedSubscript:{*off_1E798A1C8), "intValue"}];
            return v6;
          }
        }
      }
    }

    return 0;
  }

  v6 = 1;
  *(v3 + 1831) = 1;
  return v6;
}

- (uint64_t)_updateExposureStateForAutofocusProperty:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    if (CFEqual(v2, @"SpotMeteredExposure"))
    {
      v3 = 1;
    }

    else
    {
      v3 = CFEqual(v2, @"AutoExposure") != 0;
    }

    if (CFEqual(v2, @"ManualExposure"))
    {
      v4 = 1;
      goto LABEL_7;
    }

    result = CFEqual(v2, @"ExposureLock");
    v4 = result != 0;
    if (v3 || result)
    {
LABEL_7:
      FigSimpleMutexLock();
      *(v1 + 1792) = v3;
      if (v3)
      {
        *(v1 + 1820) = (*(v1 + 1820) + 1);
        HostTimeClock = CMClockGetHostTimeClock();
        CMClockGetTime(&v8, HostTimeClock);
        *(v1 + 1796) = v8;
        if (!v4)
        {
          return FigSimpleMutexUnlock();
        }
      }

      else
      {
        *(v1 + 1820) = 0;
        if (!v4)
        {
          return FigSimpleMutexUnlock();
        }
      }

      v6 = @"NewPropertyValue";
      v7 = MEMORY[0x1E695E118];
      [v1 _postNotificationWithPayload:@"AEStatusChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v7, &v6, 1)}];
      return FigSimpleMutexUnlock();
    }
  }

  return result;
}

- (uint64_t)_updateFaceDetectionStateForAutofocusProperty:(uint64_t)result propertyValue:
{
  if (result)
  {
    OUTLINED_FUNCTION_176();
    result = CFEqual(v3, @"FaceDetectionMode");
    if (result)
    {
      if (v2 && (v4 = CFGetTypeID(v2), v4 == CFStringGetTypeID()))
      {
        result = CFEqual(v2, @"Disable");
        if (!result)
        {
          memset(v13, 0, sizeof(v13));
          v6 = *(v1 + 656);
          result = OUTLINED_FUNCTION_1_18(result, v5, v13, v12);
          if (result)
          {
            v7 = result;
            do
            {
              v8 = 0;
              do
              {
                OUTLINED_FUNCTION_6_30();
                if (!v9)
                {
                  objc_enumerationMutation(v6);
                }

                v10 = [*(*(&v13[0] + 1) + 8 * v8++) setFaceDetectionEnabled:1];
              }

              while (v7 != v8);
              result = OUTLINED_FUNCTION_1_18(v10, v11, v13, v12);
              v7 = result;
            }

            while (result);
          }
        }
      }

      else
      {
        OUTLINED_FUNCTION_2_9();
        return FigDebugAssert3();
      }
    }
  }

  return result;
}

- (void)_getAutoFocusPropertyKeyAndAreaOfInterestWithNormalizedRectInSensorSpace:(uint64_t)space zoomFactor:propertyKeyOut:propertyValueOut:
{
  if (space)
  {
    OUTLINED_FUNCTION_134_4();
    v4 = v3;
    if (v3 && (v5 = v2) != 0)
    {
      OUTLINED_FUNCTION_258();
      v7 = v6;
      if (*(v6 + 1776) == 1)
      {
        dictionary = [MEMORY[0x1E695DF90] dictionary];
        v9 = *(v7 + 656);
        OUTLINED_FUNCTION_47_0();
        v14 = OUTLINED_FUNCTION_1_0(v10, v11, v12, v13);
        if (v14)
        {
          v15 = v14;
          do
          {
            for (i = 0; i != v15; ++i)
            {
              OUTLINED_FUNCTION_142_0();
              if (!v17)
              {
                objc_enumerationMutation(v9);
              }

              v18 = *(8 * i);
              [v18 previewShift];
              v20 = v19 / *(v7 + 1960);
              v22 = v21 / *(v7 + 1968);
              [v18 baseZoomFactor];
              v46 = *(v7 + 1968);
              v44 = *(v7 + 1952);
              v42 = *(v7 + 1944);
              v23 = OUTLINED_FUNCTION_16_3();
              fvcd_applyZoomAndPreviewShiftToSensorSpaceRect(v23, v24, v25, v26, v27, v20, v22, v28, v42, *&v44, *(&v44 + 1), v46);
              [dictionary setObject:CGRectCreateDictionaryRepresentation(v48) forKeyedSubscript:{objc_msgSend(v18, "portType")}];
            }

            OUTLINED_FUNCTION_47_0();
            v15 = OUTLINED_FUNCTION_1_0(v29, v30, v31, v32);
          }

          while (v15);
        }

        *v4 = 0x1F218A410;
        *v5 = dictionary;
      }

      else
      {
        os_unfair_lock_lock((v6 + 3924));
        v33 = *(v7 + 3928);
        v34 = *(v7 + 3936);
        os_unfair_lock_unlock((v7 + 3924));
        v47 = *(v7 + 1968);
        v45 = *(v7 + 1952);
        v43 = *(v7 + 1944);
        v35 = OUTLINED_FUNCTION_16_3();
        LODWORD(v36) = v1;
        fvcd_applyZoomAndPreviewShiftToSensorSpaceRect(v35, v37, v38, v39, v36, v33, v34, v40, v43, *&v45, *(&v45 + 1), v47);
        v41 = CGRectCreateDictionaryRepresentation(v49);
        *v4 = 0x1F218A3D0;
        *v5 = v41;
      }
    }

    else
    {
      OUTLINED_FUNCTION_0();
      FigDebugAssert3();
    }

    OUTLINED_FUNCTION_133_5();
  }
}

- (uint64_t)_copyAutofocusProcessorProperty:(uint64_t)property propertyValueOut:
{
  if (!self)
  {
    return 0;
  }

  v7[0] = 0;
  v7[1] = v7;
  v7[2] = 0x2020000000;
  v8 = 0;
  v4 = *(self + 1752);
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __76__BWFigVideoCaptureDevice__copyAutofocusProcessorProperty_propertyValueOut___block_invoke;
  v6[3] = &unk_1E799C028;
  v6[4] = self;
  v6[5] = v7;
  v6[6] = a2;
  v6[7] = property;
  dispatch_sync(v4, v6);
  OUTLINED_FUNCTION_190();
  return v3;
}

- (uint64_t)_copyAutofocusProcessorPropertyInternal:(uint64_t)result propertyValueOut:
{
  if (!result)
  {
    return result;
  }

  OUTLINED_FUNCTION_67_8();
  v4 = v3;
  if (_FigIsCurrentDispatchQueue())
  {
    if (!v2)
    {
LABEL_18:
      OUTLINED_FUNCTION_2_9();
      FigDebugAssert3();
      return 4294954516;
    }
  }

  else
  {
    OUTLINED_FUNCTION_2_9();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
    if (!v2)
    {
      goto LABEL_18;
    }
  }

  if (!v1)
  {
    goto LABEL_18;
  }

  if (*(v4 + 1784))
  {
    FigSampleBufferProcessorGetFigBaseObject();
    if (*(*(CMBaseObjectGetVTable() + 8) + 48))
    {
      v5 = OUTLINED_FUNCTION_2_42();

      return v6(v5);
    }

    else
    {
      return 4294954514;
    }
  }

  else
  {
    v7 = [*(v4 + 1760) objectForKeyedSubscript:v2];
    if (v7)
    {
      v8 = v7;
      objc_opt_class();
      OUTLINED_FUNCTION_10_29();
      if (objc_opt_isKindOfClass())
      {
        result = 0;
        *v1 = 0;
      }

      else
      {
        v9 = CFRetain(v8);
        result = 0;
        *v1 = v9;
      }
    }

    else
    {
      return 4294954513;
    }
  }

  return result;
}

- (uint64_t)_setAutofocusProcessorProperty:(uint64_t)property propertyValue:
{
  if (result)
  {
    if (a2)
    {
      v3 = *(result + 1752);
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __72__BWFigVideoCaptureDevice__setAutofocusProcessorProperty_propertyValue___block_invoke;
      block[3] = &unk_1E7991EF8;
      block[4] = result;
      block[5] = a2;
      block[6] = property;
      dispatch_sync(v3, block);
      return 0;
    }

    else
    {
      OUTLINED_FUNCTION_0();
      FigDebugAssert3();
      return 4294954516;
    }
  }

  return result;
}

- (uint64_t)_setAutofocusProcessorPropertyInternal:(const void *)internal propertyValue:
{
  if (!self)
  {
    return 0;
  }

  OUTLINED_FUNCTION_80();
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_0();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  if (*(v4 + 1784))
  {
    v7 = OUTLINED_FUNCTION_44();
    [BWFigVideoCaptureDevice _updateDeferredAutofocusProcessorPropertyStatesForProperty:v7];
    FigBaseObject = FigSampleBufferProcessorGetFigBaseObject();
    v9 = *(*(CMBaseObjectGetVTable() + 8) + 56);
    if (v9)
    {
      v6 = v9(FigBaseObject, v3, internal);
      if (!v6)
      {
        v12 = OUTLINED_FUNCTION_44();
        [BWFigVideoCaptureDevice _updateExposureStateForAutofocusProperty:v12];
        v13 = OUTLINED_FUNCTION_44();
        [(BWFigVideoCaptureDevice *)v13 _updateWhiteBalanceStateForAutofocusProperty:v14 propertyValue:internal];
        v15 = OUTLINED_FUNCTION_44();
        [BWFigVideoCaptureDevice _updateFaceDetectionStateForAutofocusProperty:v15 propertyValue:?];
        v16 = OUTLINED_FUNCTION_44();
        [(BWFigVideoCaptureDevice *)v16 _updateImageControlModeStateForAutofocusProperty:v17 propertyValue:internal];
        v18 = OUTLINED_FUNCTION_44();
        [BWFigVideoCaptureDevice _updateBravoSwitchOverStateForAutofocusProperty:v18 propertyValue:?];
      }
    }

    else
    {
      v6 = 4294954514;
    }
  }

  else
  {
    v6 = 0;
  }

  if (!internal || CFEqual(internal, *MEMORY[0x1E695E738]))
  {
    internal = [MEMORY[0x1E695DFB0] null];
  }

  [*(v4 + 1760) setObject:internal forKeyedSubscript:v3];
  v10 = OUTLINED_FUNCTION_44();
  [BWFigVideoCaptureDevice _updateSceneMonitorFocusStateForAutofocusProperty:v10 propertyValue:?];
  return v6;
}

- (uint64_t)_updateDeferredAutofocusProcessorPropertyStatesForProperty:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    result = _FigIsCurrentDispatchQueue();
    if (!result)
    {
      OUTLINED_FUNCTION_2_9();
      OUTLINED_FUNCTION_2_5();
      result = FigDebugAssert3();
    }

    if (*(v1 + 1831) == 1)
    {
      result = [v2 isEqualToString:0x1F2189F30];
      if (result & 1) != 0 || (result = [v2 isEqualToString:0x1F218A370], (result) || (result = objc_msgSend(v2, "isEqualToString:", 0x1F2189FB0), (result) || (result = objc_msgSend(v2, "isEqualToString:", 0x1F2189F90), result))
      {
        *(v1 + 1831) = 0;
      }
    }

    if (*(v1 + 1832) == 1)
    {
      result = [v2 isEqualToString:0x1F218A490];
      if ((result & 1) != 0 || (result = [v2 isEqualToString:0x1F218A470], result))
      {
        *(v1 + 1832) = 0;
        *(v1 + 1836) = 0;
      }
    }
  }

  return result;
}

- (void)_updateBravoSwitchOverStateForAutofocusProperty:(uint64_t)property propertyValue:
{
  if (!property)
  {
    return;
  }

  OUTLINED_FUNCTION_166();
  v3 = CFEqual(v2, @"ContinuousAutoFocus");
  if (CFEqual(v2, @"ManualFocus"))
  {
    v4 = 1;
  }

  else
  {
    v4 = CFEqual(v2, @"FocusLock") != 0;
  }

  v5 = CFEqual(v2, @"FocusScan");
  if (CFEqual(v2, @"SpotMeteredExposure"))
  {
    v6 = 1;
  }

  else
  {
    v6 = CFEqual(v2, @"AutoExposure") != 0;
  }

  if (CFEqual(v2, @"ManualExposure"))
  {
    v7 = (v1 + 1384);
    os_unfair_lock_lock((v1 + 1384));
    if (v3 == 0 && !v4)
    {
      v8 = 1;
LABEL_16:
      if (v5)
      {
        *(v1 + 1428) = 1;
      }

      else if (v6 || v8)
      {
        [*(v1 + 1416) exposureModeDidChange];
      }

      goto LABEL_20;
    }
  }

  else
  {
    v9 = v3 != 0;
    v10 = CFEqual(v2, @"ExposureLock");
    v8 = v10 != 0;
    v11 = v9 || v4;
    if (!v11 && v5 == 0 && !v6 && !v10)
    {
      return;
    }

    v7 = (v1 + 1384);
    os_unfair_lock_lock((v1 + 1384));
    if (!v11)
    {
      goto LABEL_16;
    }
  }

  [*(v1 + 1416) focusModeDidChange];
LABEL_20:

  os_unfair_lock_unlock(v7);
}

- (void)_updateSceneMonitorFocusStateForAutofocusProperty:(uint64_t)property propertyValue:
{
  if (property)
  {
    OUTLINED_FUNCTION_166();
    v3 = CFEqual(v2, @"ContinuousAutoFocus") || CFEqual(v2, @"ContinuousAutoFocusAreaOfInterest") || CFEqual(v2, @"ContinuousAutoFocusAreaOfInterestByPortType") != 0;
    if (CFEqual(v2, @"ManualFocus"))
    {
      v4 = 1;
    }

    else
    {
      v4 = CFEqual(v2, @"FocusLock") != 0;
    }

    v5 = CFEqual(v2, @"FocusScan");
    if (v3 || v4 || v5)
    {
      v6 = v5 != 0;
      os_unfair_lock_lock((v1 + 1596));
      [*(v1 + 1616) setAutoFocusInProgress:v3 focusLocked:v4 oneShotFocusScanInProgress:v6];
      os_unfair_lock_unlock((v1 + 1596));
      os_unfair_lock_lock((v1 + 1644));
      [*(v1 + 1632) setAutoFocusInProgress:v3 focusLocked:v4 oneShotFocusScanInProgress:v6];

      os_unfair_lock_unlock((v1 + 1644));
    }
  }
}

- (uint64_t)_setAutofocusProcessorImageControlModeProperty:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    if (!_FigIsCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_2_9();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    if (*(v1 + 2012) == v2)
    {
      return 0;
    }

    else
    {
      v3 = [BWFigVideoCaptureDevice _autofocusProcessorImageControlModeFromImageControlMode:v2];
      if (v3)
      {
        result = [(BWFigVideoCaptureDevice *)v1 _setAutofocusProcessorPropertyInternal:v3 propertyValue:?];
        if (!result)
        {
          *(v1 + 2012) = v2;
          v4 = v2 == 2 && [objc_msgSend(objc_msgSend(*(v1 + 600) "stream")] != 0;
          result = 0;
          *(v1 + 2060) = v4;
        }
      }

      else
      {
        FigDebugAssert3();

        return FigSignalErrorAtGM();
      }
    }
  }

  return result;
}

- (void)_serviceDeferredAutofocusProcessorPropertiesFromCaptureStream:(uint64_t)stream frameStatisticsByPortType:
{
  if (stream)
  {
    if (*(stream + 1830) == 1)
    {
      OUTLINED_FUNCTION_175();
      if ([v4 frameCount] >= 3)
      {
        [v2 portType];
        v5 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
        if ([v5 aeTarget])
        {
          if ([v5 aeAverage])
          {
            aeTarget = [v5 aeTarget];
            aeAverage = [v5 aeAverage];
            if ([v1 frameCount] > 0xB || (v8 = aeTarget / aeAverage, v8 > 0.8) && v8 < 1.2)
            {
              OUTLINED_FUNCTION_7_1();
              v11 = 3221225472;
              v12 = __115__BWFigVideoCaptureDevice__serviceDeferredAutofocusProcessorPropertiesFromCaptureStream_frameStatisticsByPortType___block_invoke;
              v13 = &unk_1E798F870;
              streamCopy = stream;
              dispatch_async(v9, block);
              *(stream + 1830) = 0;
            }
          }
        }
      }
    }
  }
}

- (void)_deviceDidStopStreaming
{
  if (self)
  {
    OUTLINED_FUNCTION_60();
    v2 = v1;
    v3 = v1 + 4096;
    if (*(v1 + 4346) == 1)
    {
      *(v1 + 4462) = 0;
      *(v1 + 4464) = 0;
      v4 = MEMORY[0x1E6960C70];
      *v95 = *MEMORY[0x1E6960C70];
      *(v1 + 4500) = *MEMORY[0x1E6960C70];
      v5 = *(v4 + 16);
      *(v1 + 4516) = v5;
      if (*(v1 + 1616))
      {
        v151[0] = @"EffectStatus";
        v151[1] = @"StagePreviewStatus";
        v152[0] = &unk_1F22469D8;
        v152[1] = &unk_1F22469D8;
        [v1 _postNotificationWithPayload:@"ShallowDepthOfFieldStatusChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", v152, v151, 2)}];
      }

      if (*(v2 + 1632))
      {
        v149 = @"NewPropertyValue";
        v150 = &unk_1F22469F0;
        [v2 _postNotificationWithPayload:@"StereoVideoCaptureStatusChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v150, &v149, 1)}];
      }

      v6 = *(v2 + 1752);
      v148[0] = MEMORY[0x1E69E9820];
      v148[1] = 3221225472;
      v148[2] = __50__BWFigVideoCaptureDevice__deviceDidStopStreaming__block_invoke;
      v148[3] = &unk_1E798F870;
      v148[4] = v2;
      dispatch_sync(v6, v148);
      portType = [*(v2 + 1392) portType];
      if (!portType)
      {
        portType = [*(v2 + 600) portType];
      }

      v8 = *(v2 + 1656);
      v147[0] = MEMORY[0x1E69E9820];
      v147[1] = 3221225472;
      v147[2] = __50__BWFigVideoCaptureDevice__deviceDidStopStreaming__block_invoke_2;
      v147[3] = &unk_1E798F898;
      v147[4] = v2;
      v147[5] = portType;
      dispatch_sync(v8, v147);
      dispatch_sync(*(v2 + 1664), &__block_literal_global_393_0);
      dispatch_sync(*(v2 + 2960), &__block_literal_global_396);
      if (*(v3 + 68) == 1)
      {
        v145 = 0u;
        v146 = 0u;
        v143 = 0u;
        v144 = 0u;
        v9 = *(v2 + 656);
        OUTLINED_FUNCTION_314();
        if (OUTLINED_FUNCTION_37(v10, v11, v12, v13))
        {
          v14 = *off_1E798C1E8;
          v15 = MEMORY[0x1E695E110];
          while (1)
          {
            OUTLINED_FUNCTION_142_0();
            if (!v16)
            {
              objc_enumerationMutation(v9);
            }

            [objc_msgSend(**(&v143 + 1) "stream")];
            OUTLINED_FUNCTION_46_10();
            if (v16)
            {
              OUTLINED_FUNCTION_314();
              if (!OUTLINED_FUNCTION_37(v17, v18, v19, v20))
              {
                break;
              }
            }
          }
        }
      }

      [*(v2 + 2952) setFudgedZoomRanges:0];
      os_unfair_lock_lock((v2 + 1596));

      *(v2 + 1616) = 0;
      os_unfair_lock_unlock((v2 + 1596));
      os_unfair_lock_lock((v2 + 1644));

      *(v2 + 1632) = 0;
      os_unfair_lock_unlock((v2 + 1644));
      if (*(v2 + 2648) == 1)
      {
        [*(v2 + 2200) reset];
        *(v2 + 2208) = 0;
        *(v2 + 2224) = 0u;
        *(v2 + 2784) = *v95;
        *(v2 + 2800) = v5;
        *(v2 + 3451) = 0;
        *(v2 + 3453) = 0;
        if (*(v2 + 2760))
        {
          v21 = *(v2 + 2688);
          block[0] = MEMORY[0x1E69E9820];
          block[1] = 3221225472;
          block[2] = __50__BWFigVideoCaptureDevice__deviceDidStopStreaming__block_invoke_3;
          block[3] = &unk_1E798F870;
          block[4] = v2;
          dispatch_sync(v21, block);
          [v2 _resetStillImageCaptureRequestState];

          *(v2 + 2760) = 0;
        }
      }

      [v2 setTorchLevel:0.0];

      *(v2 + 3296) = 0;
      os_unfair_lock_lock((v2 + 2140));
      [*(v2 + 2144) reset];
      *(v2 + 2404) = -1;
      os_unfair_lock_unlock((v2 + 2140));
      [(BWFigVideoCaptureDevice *)v2 _reportAPSOffsetEstimatorInfo:v22];
      if (*(v2 + 240) != 1 || ([(BWFigVideoCaptureDevice *)v2 _reportDeskViewStreamingSessionCoreAnalyticsData], *(v2 + 256) == 1))
      {
        [(BWFigVideoCaptureDevice *)v2 _reportStreamingSessionCoreAnalyticsData];
      }

      v29 = [*(v2 + 3520) count];
      if (v29)
      {
        memset(v141, 0, sizeof(v141));
        v31 = *(v2 + 3520);
        if (OUTLINED_FUNCTION_37(v29, v30, v141, v140))
        {
          do
          {
            OUTLINED_FUNCTION_21_20();
            if (!v16)
            {
              objc_enumerationMutation(v31);
            }

            [+[BWAggdDataReporter sharedInstance](BWAggdDataReporter reportCriticalFocusErrorOccurredForPortType:"reportCriticalFocusErrorOccurredForPortType:", **(&v141[0] + 1)];
            OUTLINED_FUNCTION_51_11();
          }

          while (!v16 || OUTLINED_FUNCTION_37(v32, v33, v141, v140));
        }
      }

      *(v2 + 3512) = 0;
      *(v2 + 3520) = 0;

      *(v2 + 3528) = 0;
      *(v2 + 3536) = 0;

      *(v2 + 3544) = 0;
      *(v2 + 3552) = 0;
      if ([*(v2 + 3560) count])
      {
        v138 = 0u;
        v139 = 0u;
        v136 = 0u;
        v137 = 0u;
        v34 = *(v2 + 3560);
        OUTLINED_FUNCTION_341();
        v39 = OUTLINED_FUNCTION_37(v35, v36, v37, v38);
        if (v39)
        {
          v40 = v39;
          do
          {
            for (i = 0; i != v40; ++i)
            {
              OUTLINED_FUNCTION_32_10();
              if (!v16)
              {
                objc_enumerationMutation(v34);
              }

              -[BWAggdDataReporter reportSphereJitterDetectionsForPortType:detectionAttemps:successfulDetections:](+[BWAggdDataReporter sharedInstance](BWAggdDataReporter, "sharedInstance"), "reportSphereJitterDetectionsForPortType:detectionAttemps:successfulDetections:", *(*(&v136 + 1) + 8 * i), [objc_msgSend(*(v2 + 3560) objectForKeyedSubscript:{*(*(&v136 + 1) + 8 * i)), "intValue"}], objc_msgSend(objc_msgSend(*(v2 + 3568), "objectForKeyedSubscript:", *(*(&v136 + 1) + 8 * i)), "intValue"));
            }

            OUTLINED_FUNCTION_341();
            v40 = OUTLINED_FUNCTION_37(v42, v43, v44, v45);
          }

          while (v40);
        }
      }

      *(v2 + 3560) = 0;
      *(v2 + 3568) = 0;

      *(v2 + 3664) = 0;
      *(v2 + 3696) = 0;

      *(v2 + 3704) = 0;
      *(v2 + 3752) = 0;
      [*(v2 + 3880) disableForCaptureDevice:*(v2 + 8)];

      *(v2 + 3952) = 0;
      *(v2 + 3968) = 0;
      [*(v2 + 696) setWaitForMasterAEToSettle:0];
      OUTLINED_FUNCTION_251();
      *(v2 + 384) = 0;
      v46 = *(v2 + 4416);
      v121 = MEMORY[0x1E69E9820];
      v122 = 3221225472;
      v123 = __50__BWFigVideoCaptureDevice__deviceDidStopStreaming__block_invoke_4;
      v124 = &unk_1E798F870;
      v125 = v2;
      dispatch_async(v46, &v121);
      *(v2 + 4392) = 0;
      activeVideoLockedFrameRate = [*(v2 + 600) activeVideoLockedFrameRate];
      if (FigCaptureFrameRateIsValidRational(activeVideoLockedFrameRate, v48))
      {
        v49 = [+[FigPulseGenerator sharedFigPulseGenerator](FigPulseGenerator "sharedFigPulseGenerator")];
        [+[FigPulseGenerator sharedFigPulseGenerator](FigPulseGenerator "sharedFigPulseGenerator")];
        if (v49)
        {
          OUTLINED_FUNCTION_307();
          OUTLINED_FUNCTION_228();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v58 = OUTLINED_FUNCTION_366(os_log_and_send_and_compose_flags_and_os_log_type, v51, v52, v53, v54, v55, v56, v57, v92, v94, v96, v97, *v99, *&v99[8], *&v99[16], v103, v104, v105, v106, v107, v108, v109, v110, v111, v112, v113, v114, v115, v116, v117, v118, v119, type, SBYTE2(type), BYTE3(type), SHIDWORD(type));
          if (OUTLINED_FUNCTION_5_24(v58))
          {
            *v99 = 136315394;
            *&v99[4] = "[BWFigVideoCaptureDevice _deviceDidStopStreaming]";
            OUTLINED_FUNCTION_177();
            *&v99[14] = v49;
            OUTLINED_FUNCTION_2_1();
            OUTLINED_FUNCTION_4_4();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_87_6();
          OUTLINED_FUNCTION_13_0();
          FigCaptureGetFrameworkRadarComponent();
          OUTLINED_FUNCTION_307();
          v59 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          os_log_type_enabled(v59, BYTE3(type));
          OUTLINED_FUNCTION_82_6();
          if (v16)
          {
            v61 = v60;
          }

          else
          {
            v61 = HIDWORD(type);
          }

          if (v61)
          {
            *v99 = 136315394;
            *&v99[4] = "[BWFigVideoCaptureDevice _deviceDidStopStreaming]";
            OUTLINED_FUNCTION_177();
            *&v99[14] = v49;
            OUTLINED_FUNCTION_2_1();
            OUTLINED_FUNCTION_47_2();
          }

          OUTLINED_FUNCTION_116_5();
          OUTLINED_FUNCTION_8_1();
          OUTLINED_FUNCTION_39_0();
          LODWORD(v104) = 67109120;
          HIDWORD(v104) = v49;
          OUTLINED_FUNCTION_305();
          OUTLINED_FUNCTION_5_61();
          _os_log_send_and_compose_impl();
          OUTLINED_FUNCTION_13_18();
          OUTLINED_FUNCTION_26_22();
          FigCapturePleaseFileRadar(v62, v63, v64, v65, v66, 7046, v67, v68, &v104);
          free(v49);
        }
      }

      activeVideoExternalSyncFrameRate = [*(v2 + 600) activeVideoExternalSyncFrameRate];
      if (FigCaptureFrameRateIsValidRational(activeVideoExternalSyncFrameRate, v70))
      {
        v71 = [+[FigPulseGenerator sharedFigPulseGenerator](FigPulseGenerator "sharedFigPulseGenerator")];
        [+[FigPulseGenerator sharedFigPulseGenerator](FigPulseGenerator "sharedFigPulseGenerator")];
        if (v71)
        {
          OUTLINED_FUNCTION_307();
          OUTLINED_FUNCTION_228();
          v72 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v73 = os_log_type_enabled(v72, BYTE3(type));
          if (OUTLINED_FUNCTION_6(v73))
          {
            *v99 = 136315394;
            *&v99[4] = "[BWFigVideoCaptureDevice _deviceDidStopStreaming]";
            OUTLINED_FUNCTION_177();
            *&v99[14] = v71;
            OUTLINED_FUNCTION_2_1();
            OUTLINED_FUNCTION_8_0();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_17_8();
          FigCaptureGetFrameworkRadarComponent();
          OUTLINED_FUNCTION_307();
          OUTLINED_FUNCTION_228();
          v74 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v82 = OUTLINED_FUNCTION_366(v74, v75, v76, v77, v78, v79, v80, v81, v92, v94, v96, v97, *v99, *&v99[8], *&v99[16], v103, v104, v105, v106, v107, v108, v109, v110, v111, v112, v113, v114, v115, v116, v117, v118, v119, type, SBYTE2(type), BYTE3(type), SHIDWORD(type));
          if (OUTLINED_FUNCTION_5_24(v82))
          {
            OUTLINED_FUNCTION_177();
            OUTLINED_FUNCTION_2_1();
            OUTLINED_FUNCTION_4_4();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_8_1();
          OUTLINED_FUNCTION_13_0();
          LODWORD(v104) = 67109120;
          HIDWORD(v104) = v71;
          OUTLINED_FUNCTION_305();
          OUTLINED_FUNCTION_5_61();
          v83 = _os_log_send_and_compose_impl();
          OUTLINED_FUNCTION_11();
          OUTLINED_FUNCTION_44();
          OUTLINED_FUNCTION_10();
          FigCapturePleaseFileRadar(v84, v85, v86, v87, v88, 7057, v89, v90, &v104);
          free(v83);
        }
      }

      *(v3 + 250) = 0;
    }

    OUTLINED_FUNCTION_128_0();
  }
}

- (float)_updateTimeOfFlightStreamingTime:(float)result
{
  if (self)
  {
    OUTLINED_FUNCTION_1_80(self, a2);
    v10 = *(v4 + 4136);
    CMTimeSubtract(&time, &lhs, &v10);
    Seconds = CMTimeGetSeconds(&time);
    v6 = *(self + 4132);
    v7 = 4124;
    v8 = 4128;
    if (v6 == 1)
    {
      v8 = 4120;
    }

    if (v6 != 8)
    {
      v7 = v8;
    }

    if (v6)
    {
      v9 = v7;
    }

    else
    {
      v9 = 4116;
    }

    result = *(self + v9) + Seconds;
    *(self + v9) = result;
  }

  return result;
}

- (void)_accumulateTimeOfFLightStreamingTime:(uint64_t)time
{
  if (time)
  {
    OUTLINED_FUNCTION_54();
    [objc_msgSend(OUTLINED_FUNCTION_7_24(v3 *off_1E798A3C8)];
    if (v4 == 0.0)
    {
      v5 = 0;
    }

    else if (fabsf(v4 + -1.0) <= 0.2)
    {
      v5 = 1;
    }

    else if (fabsf(v4 + -8.0) > 0.2)
    {
      v5 = -1;
    }

    else
    {
      v5 = 8;
    }

    memset(&v27, 0, sizeof(v27));
    PresentationTimeStamp = CMSampleBufferGetPresentationTimeStamp(&v27, v2);
    v14 = (v1 + 4136);
    if ((*(v1 + 4148) & 1) == 0)
    {
      goto LABEL_10;
    }

    if (*(v1 + 4132) != v5)
    {
      OUTLINED_FUNCTION_66_8(PresentationTimeStamp, v7, v8, v9, v10, v11, v12, v13, v24.value, *&v24.timescale, v24.epoch, v25, time1.value, *&time1.timescale, time1.epoch, *&v27.value);
      *&v24.value = *v14;
      v24.epoch = *(v1 + 4152);
      v15 = CMTimeCompare(&time1, &v24);
      if (v15 >= 1)
      {
        LODWORD(v23) = OUTLINED_FUNCTION_66_8(v15, v16, v17, v18, v19, v20, v21, v22, v24.value, *&v24.timescale, v24.epoch, v25, time1.value, *&time1.timescale, time1.epoch, *&v27.value).n128_u32[0];
        [(BWFigVideoCaptureDevice *)v1 _updateTimeOfFlightStreamingTime:v23];
LABEL_10:
        *(v1 + 4132) = v5;
        *v14 = *&v27.value;
        *(v1 + 4152) = v27.epoch;
      }
    }
  }
}

- (void)captureStream:(id)stream willEmitVideoSampleBuffer:(opaqueCMSampleBuffer *)buffer drivesCameraControls:(BOOL)controls
{
  controlsCopy = controls;
  [BWFigVideoCaptureDevice _addStateInvariantAttachmentsToVideoSamplebuffer:? captureStream:?];
  if (controlsCopy)
  {
    v9 = OUTLINED_FUNCTION_44();
    [BWFigVideoCaptureDevice _serviceAutoImageControlModeWithSampleBuffer:v9 fromCaptureStream:?];
    v10 = OUTLINED_FUNCTION_4_3();
    v13 = CMGetAttachment(v10, v11, v12);
    if (self->_manualCinematicFramingDelegate)
    {
      [stream portType];
      if ([OUTLINED_FUNCTION_28() containsObject:?])
      {
        [objc_msgSend(v13 objectForKeyedSubscript:{*off_1E798B678), "floatValue"}];
        v15 = roundf(v14 * 10.0) / 10.0;
        [stream portType];
        [objc_msgSend(OUTLINED_FUNCTION_28() "objectForKeyedSubscript:"floatValue"")];
        if (v15 != *&v16)
        {
          *&v16 = v15;
          v17 = [MEMORY[0x1E696AD98] numberWithFloat:v16];
          [stream portType];
          [OUTLINED_FUNCTION_347() setObject:? forKeyedSubscript:?];
          v71[0] = @"PortType";
          v71[1] = @"NewPropertyValue";
          v72[0] = [stream portType];
          v72[1] = v17;
          -[BWFigVideoCaptureDevice _postNotificationWithPayload:notificationPayload:](self, "_postNotificationWithPayload:notificationPayload:", @"ImageSensorTemperatureChanged", [MEMORY[0x1E695DF20] dictionaryWithObjects:v72 forKeys:v71 count:2]);
        }
      }
    }

    v18 = [v13 objectForKeyedSubscript:*off_1E798B718];
    if (!v18 || [v18 BOOLValue])
    {
      memset(&v70, 0, sizeof(v70));
      CMSampleBufferGetPresentationTimeStamp(&v70, buffer);
      isBravoVariant = [(BWFigVideoCaptureDevice *)self isBravoVariant];
      if (isBravoVariant)
      {
        os_unfair_lock_lock(&self->_bravoMasterLock);
        if ((self->_mostRecentPTS.flags & 1) == 0 || (OUTLINED_FUNCTION_66_8(v28, v29, v30, v31, v32, v33, v34, v35, v55, v58, v59, v62, v65, v68, v69, *&v70.value), v28 = OUTLINED_FUNCTION_234(v37, v38, v39, v40, v41, v42, v43, v44, v56, v60, v63, v66), v28 >= 1))
        {
          OUTLINED_FUNCTION_302(v28, v29, v30, v31, v32, v33, v34, v35, v55, v58, v59, v62, v65, v68, v69, v36, v70.value);
          OUTLINED_FUNCTION_44();
          [BWFigVideoCaptureDevice _updateStateUsingVideoSampleBuffer:fromCaptureStream:];
        }

        os_unfair_lock_unlock(&self->_bravoMasterLock);
      }

      else
      {
        if ((self->_mostRecentPTS.flags & 1) == 0 || (OUTLINED_FUNCTION_66_8(isBravoVariant, v20, v21, v22, v23, v24, v25, v26, v55, v58, v59, v62, v65, v68, v69, *&v70.value), isBravoVariant = OUTLINED_FUNCTION_234(v45, v46, v47, v48, v49, v50, v51, v52, v57, v61, v64, v67), isBravoVariant >= 1))
        {
          OUTLINED_FUNCTION_302(isBravoVariant, v20, v21, v22, v23, v24, v25, v26, v55, v58, v59, v62, v65, v68, v69, v27, v70.value);
        }

        OUTLINED_FUNCTION_44();
        [BWFigVideoCaptureDevice _updateStateUsingVideoSampleBuffer:fromCaptureStream:];
      }
    }
  }

  v53 = OUTLINED_FUNCTION_44();
  [BWFigVideoCaptureDevice _addStateAttachmentsToVideoSampleBuffer:v53 captureStream:?];
  v54 = OUTLINED_FUNCTION_44();
  [BWFigVideoCaptureDevice _addValidationAndCoreRepairStatusesToSampleBuffer:v54];
}

- (void)_addStateInvariantAttachmentsToVideoSamplebuffer:(uint64_t)samplebuffer captureStream:
{
  if (samplebuffer)
  {
    if ((OUTLINED_FUNCTION_80(), -[BWFigVideoCaptureDevice _addExifMetadata:fromTimeMachine:](v3, v4, 0), [MEMORY[0x1E696AD98] numberWithInt:*(v2 + 588)], v5 = OUTLINED_FUNCTION_35_19(), CMSetAttachment(v5, v6, v7, v8), OUTLINED_FUNCTION_298(), v9) && *(v2 + 1572) == 0.0 || *(v2 + 4304) == 1)
    {
      v10 = MEMORY[0x1E695E118];

      CMSetAttachment(v1, @"DepthDisabled", v10, 1u);
    }
  }
}

- (void)_serviceAutoImageControlModeWithSampleBuffer:(uint64_t)buffer fromCaptureStream:
{
  if (buffer)
  {
    OUTLINED_FUNCTION_84();
    OUTLINED_FUNCTION_80();
    v3 = OUTLINED_FUNCTION_4_3();
    v6 = CMGetAttachment(v3, v4, v5);
    v7 = [v6 objectForKeyedSubscript:*off_1E798B710];
    bOOLValue = [v7 BOOLValue];
    if ((!v7 || bOOLValue) && *(v2 + 2016) == 1 && ([objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B6B0), "isEqualToString:", *off_1E798C470}] & 1) == 0)
    {
      dictionary = [MEMORY[0x1E695DF90] dictionary];
      v39 = 0u;
      v40 = 0u;
      v41 = 0u;
      v42 = 0u;
      v10 = *(v2 + 656);
      v12 = OUTLINED_FUNCTION_52(dictionary, v11, &v39, v38);
      if (v12)
      {
        v13 = v12;
        v14 = *v40;
        do
        {
          for (i = 0; i != v13; ++i)
          {
            OUTLINED_FUNCTION_13_1();
            if (v16 != v14)
            {
              objc_enumerationMutation(v10);
            }

            v17 = *(*(&v39 + 1) + 8 * i);
            [v17 setSphereVideoEnabled:1];
            [v17 currentSphereMode];
            [v17 portType];
            v18 = [OUTLINED_FUNCTION_85_0() setObject:? forKeyedSubscript:?];
          }

          v13 = OUTLINED_FUNCTION_52(v18, v19, &v39, v38);
        }

        while (v13);
      }

      *(v2 + 2016) = 0;
      os_unfair_lock_lock((v2 + 2032));
      [*(v2 + 2040) setExpectedSphereModesByPortType:dictionary];
      os_unfair_lock_unlock((v2 + 2032));
    }

    if ([v2 isBravoVariant])
    {
      masterCaptureStream = [v2 masterCaptureStream];
    }

    else
    {
      masterCaptureStream = *(v2 + 600);
    }

    os_unfair_lock_lock((v2 + 2032));
    if (!*(v2 + 2040))
    {
      goto LABEL_30;
    }

    OUTLINED_FUNCTION_231();
    v21 = *(v2 + 656);
    OUTLINED_FUNCTION_47_0();
    v26 = OUTLINED_FUNCTION_52(v22, v23, v24, v25);
    if (v26)
    {
      v27 = v26;
LABEL_20:
      v28 = 0;
      while (1)
      {
        OUTLINED_FUNCTION_30_6();
        if (!v29)
        {
          objc_enumerationMutation(v21);
        }

        v30 = *(v37 + 8 * v28);
        if ([v30 streamingRequiredWhenConfiguredAsSlave])
        {
          break;
        }

        if (v27 == ++v28)
        {
          OUTLINED_FUNCTION_47_0();
          v27 = OUTLINED_FUNCTION_52(v31, v32, v33, v34);
          if (v27)
          {
            goto LABEL_20;
          }

          goto LABEL_26;
        }
      }
    }

    else
    {
LABEL_26:
      v30 = 0;
    }

    if ([*(v2 + 2040) isTransitionCompleteWithSampleBuffer:v1 masterCaptureStreamPortType:objc_msgSend(masterCaptureStream activeSlaveStreamPortType:{"portType"), objc_msgSend(v30, "portType")}])
    {
      v35 = *(v2 + 2048);
      *(v2 + 2048) = 0;

      *(v2 + 2040) = 0;
      os_unfair_lock_unlock((v2 + 2032));
      if (v35)
      {
        CMSampleBufferGetPresentationTimeStamp(&v36, v1);
        (v35)[2](v35, 1, &v36);
      }
    }

    else
    {
LABEL_30:
      os_unfair_lock_unlock((v2 + 2032));
    }

    OUTLINED_FUNCTION_81();
  }
}

- (void)_updateStateUsingVideoSampleBuffer:fromCaptureStream:
{
  OUTLINED_FUNCTION_357();
  v362[0] = v0;
  v362[1] = v4;
  v283 = v4;
  if (!v1)
  {
    goto LABEL_341;
  }

  v5 = v2;
  v6 = v1;
  v303 = v3;
  v7 = (v1 + 4096);
  key = *off_1E798A3C8;
  v8 = CMGetAttachment(v2, *off_1E798A3C8, 0);
  v9 = v8;
  if (v7[448] == 1 && v7[449] == 1)
  {
    -[BWFigVideoCaptureDevice _accumulateInvalidFramesForAnalytics:](v6, [objc_msgSend(v8 objectForKeyedSubscript:{*off_1E798B430), "BOOLValue"}]);
  }

  v287 = v7;
  if (v7[16] != 1)
  {
    goto LABEL_20;
  }

  v10 = OUTLINED_FUNCTION_84_5();
  [BWFigVideoCaptureDevice _accumulateTimeOfFLightStreamingTime:v10];
  if ((v7[16] & 1) == 0 || (*(v6 + 180) & 4) != 0)
  {
    goto LABEL_20;
  }

  v11 = *off_1E798B460;
  if ([objc_msgSend(v9 objectForKeyedSubscript:{*off_1E798B460), "intValue"}] != 7)
  {
    v12 = [v9 objectForKeyedSubscript:*off_1E798B730];
    if (!v12)
    {
      goto LABEL_20;
    }

    v13 = v12;
    memset(v353, 0, sizeof(v353));
    v14 = [v12 countByEnumeratingWithState:v353 objects:v352 count:16];
    if (!v14)
    {
      goto LABEL_20;
    }

    v15 = v14;
LABEL_12:
    v16 = 0;
    while (1)
    {
      OUTLINED_FUNCTION_6_30();
      if (!v17)
      {
        objc_enumerationMutation(v13);
      }

      v18 = [objc_msgSend(objc_msgSend(v13 objectForKeyedSubscript:{*(*(&v353[0] + 1) + 8 * v16)), "objectForKeyedSubscript:", v11), "intValue"}];
      if (v18 == 7)
      {
        break;
      }

      if (v15 == ++v16)
      {
        v15 = OUTLINED_FUNCTION_37_2(v18, v19, v353, v352);
        if (v15)
        {
          goto LABEL_12;
        }

        goto LABEL_20;
      }
    }
  }

  *(v6 + 180) = vorr_s8(*(v6 + 180), 0x2000000004);
LABEL_20:
  os_unfair_lock_lock((v6 + 1384));
  HIDWORD(v285) = [*(v6 + 2760) currentState];
  if ([*(v6 + 2760) currentState] == 8 || *(v6 + 2474) == 1)
  {
    if (*(v6 + 2808))
    {
      v297 = 1;
      HIDWORD(v301) = 1;
    }

    else
    {
      HIDWORD(v301) = 1;
      LODWORD(v297) = *(v6 + 2809);
      HIDWORD(v297) = v297;
    }
  }

  else
  {
    v297 = 0;
    HIDWORD(v301) = 0;
  }

  os_unfair_lock_unlock((v6 + 1384));
  v21 = *(v6 + 3296);
  if (!v21)
  {
    goto LABEL_27;
  }

  [v21 processSampleBuffer:v5];
  v359 = 0uLL;
  *&v360 = 0;
  v22 = OUTLINED_FUNCTION_244();
  CMSampleBufferGetPresentationTimeStamp(v23, v22);
  if ((*(v6 + 3320) & 1) == 0)
  {
    v293 = 0;
    *&Seconds = OUTLINED_FUNCTION_293().n128_u64[0];
    goto LABEL_30;
  }

  memset(time1, 0, 24);
  *&lhs.value = v359;
  lhs.epoch = v360;
  rhs = *(v6 + 3308);
  CMTimeSubtract(time1, &lhs, &rhs);
  lhs = *time1;
  Seconds = CMTimeGetSeconds(&lhs);
  if (Seconds >= *(v6 + 3332))
  {
    if (HIDWORD(v301) && *(v6 + 3336) != 1)
    {
      v293 = 0;
    }

    else
    {
      *(v6 + 3304) = [*(v6 + 3296) isStationary];
      OUTLINED_FUNCTION_240();
      if (v17 && (memset(v350, 0, sizeof(v350)), v42 = *(v6 + 656), (v43 = OUTLINED_FUNCTION_1_0(v40, v41, v350, v349)) != 0))
      {
        v50 = v43;
        v51 = v5;
        do
        {
          for (i = 0; i != v50; ++i)
          {
            OUTLINED_FUNCTION_49_7();
            if (!v17)
            {
              objc_enumerationMutation(v42);
            }

            v53 = [*(*(&v350[0] + 1) + 8 * i) setIsStationary:*(v6 + 3304)];
          }

          v50 = OUTLINED_FUNCTION_1_0(v53, v54, v350, v349);
        }

        while (v50);
        v293 = 1;
        v5 = v51;
      }

      else
      {
        v293 = 1;
      }
    }

    *&Seconds = OUTLINED_FUNCTION_293().n128_u64[0];
  }

  else
  {
LABEL_27:
    v293 = 0;
  }

LABEL_30:
  v24 = 0x1E696A000;
  v302 = v9;
  if (*(v6 + 2200) && [*(v6 + 2144) frameCount])
  {
    if ((*(v6 + 2208) & 1) == 0)
    {
      if ([*(v6 + 656) count] >= 2 && ((*(v6 + 1568) & 1) != 0 || (OUTLINED_FUNCTION_291(), v17)))
      {
        HIDWORD(v294) = HIDWORD(v5);
        if ([*(v6 + 2144) frameCount] <= 1)
        {
          [*(v6 + 2216) removeAllObjects];
        }

        v25 = [v9 objectForKeyedSubscript:*off_1E798B730];
        *v345 = 0u;
        v346 = 0u;
        *v347 = 0u;
        v348 = 0u;
        v26 = *(v6 + 120);
        v28 = OUTLINED_FUNCTION_37_2(v25, v27, v345, v344);
        if (v28)
        {
          v30 = v28;
          v31 = *off_1E798B5F0;
          do
          {
            v32 = 0;
            do
            {
              OUTLINED_FUNCTION_89();
              if (!v17)
              {
                objc_enumerationMutation(v26);
              }

              v33 = *(v345[1] + 8 * v32);
              [v303 portType];
              v34 = [OUTLINED_FUNCTION_47() isEqualToString:?];
              if ((v34 & 1) == 0)
              {
                v34 = [v25 objectForKeyedSubscript:v33];
                if (v34)
                {
                  if (*(v6 + 2183) != 1 || ![v302 objectForKeyedSubscript:v31] || (v34 = objc_msgSend(OUTLINED_FUNCTION_6_75(), "objectForKeyedSubscript:")) != 0 || *(v6 + 1560))
                  {
                    v36 = [*(v6 + 2216) objectForKeyedSubscript:v33];
                    if (!v36)
                    {
                      v36 = &unk_1F22469A8;
                    }

                    v34 = [*(v6 + 2216) setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", objc_msgSend(v36, "intValue") - 1), v33}];
                  }
                }
              }

              ++v32;
            }

            while (v30 != v32);
            v28 = OUTLINED_FUNCTION_37_2(v34, v35, v345, v344);
            v30 = v28;
          }

          while (v28);
        }

        *v342 = 0u;
        v343 = 0u;
        *v340 = 0u;
        v341 = 0u;
        v37 = *(v6 + 2216);
        v38 = OUTLINED_FUNCTION_37_2(v28, v29, v340, v339);
        if (v38)
        {
          v44 = v38;
          array = 0;
          v45 = *v341;
          v9 = v302;
          do
          {
            for (j = 0; j != v44; ++j)
            {
              if (*v341 != v45)
              {
                objc_enumerationMutation(v37);
              }

              v47 = *(v340[1] + 8 * j);
              v48 = [objc_msgSend(*(v6 + 2216) objectForKeyedSubscript:{v47), "intValue"}];
              if (v48 <= 0)
              {
                if (!array)
                {
                  array = [MEMORY[0x1E695DF70] array];
                }

                BWPortTypeToDisplayString(v47, v49);
                v48 = [OUTLINED_FUNCTION_28() addObject:?];
              }
            }

            v44 = OUTLINED_FUNCTION_37_2(v48, v49, v340, v339);
          }

          while (v44);
        }

        else
        {
          array = 0;
          v9 = v302;
        }

        OUTLINED_FUNCTION_107_4();
        if (v17)
        {
          active = [(BWFigVideoCaptureDevice *)v6 overCaptureActiveSlaveStreamForcedOff];
        }

        else
        {
          active = 0;
        }

        v56 = ([array count] != 0) | active;
        *(v6 + 2208) = v56 & 1;
        if ((v56 & 1) != 0 && dword_1ED844350)
        {
          LODWORD(lhs.value) = 0;
          LOBYTE(rhs.value) = 0;
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          value = lhs.value;
          os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, rhs.value);
          OUTLINED_FUNCTION_97_0();
          if (v17)
          {
            v60 = v59;
          }

          else
          {
            v60 = value;
          }

          if (v60)
          {
            frameCount = [*(v6 + 2144) frameCount];
            v62 = [array componentsJoinedByString:{@", "}];
            *time1 = 136315906;
            *&time1[4] = "[BWFigVideoCaptureDevice _updateStateUsingVideoSampleBuffer:fromCaptureStream:]";
            *&time1[12] = 1026;
            *&time1[14] = frameCount;
            *&time1[18] = 2114;
            *&time1[20] = v62;
            *&time1[28] = 1026;
            *&time1[30] = active;
            OUTLINED_FUNCTION_14_28();
            OUTLINED_FUNCTION_4_4();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_128();
          v9 = v302;
        }
      }

      else
      {
        *(v6 + 2208) = 1;
      }
    }

    if ([(BWFigVideoCaptureDevice *)v6 _ubZeroShutterLagCancelWaitingForTimeMachines])
    {
      [*(v6 + 2200) reset];
    }

    v24 = 0x1E696A000uLL;
    if (*(v6 + 2208) == 1)
    {
      [*(v6 + 2200) addMetadata:v9];
    }
  }

  v63 = *(v6 + 1752);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke;
  block[3] = &unk_1E7990178;
  block[4] = v6;
  block[5] = v5;
  dispatch_sync(v63, block);
  if (!*(v6 + 3596))
  {
    v64 = *off_1E798B1D8;
    if ([v9 objectForKeyedSubscript:*off_1E798B1D8])
    {
      *(v6 + 3596) = [objc_msgSend(v9 objectForKeyedSubscript:{v64), "intValue"}];
    }
  }

  if (!*(v6 + 3600))
  {
    os_unfair_lock_lock((v6 + 3396));
    v65 = *(v6 + 3392);
    if (v65)
    {
      *(v6 + 3600) = v65;
    }

    os_unfair_lock_unlock((v6 + 3396));
  }

  v66 = *(v6 + 4416);
  v336[0] = MEMORY[0x1E69E9820];
  v336[1] = 3221225472;
  v336[2] = __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke_2;
  v336[3] = &unk_1E798F870;
  v336[4] = v6;
  dispatch_async(v66, v336);
  v67 = *(v6 + 2152);
  [*(v6 + 2144) copyTo:v67];
  if (!v9)
  {
    FigCaptureGetFrameworkRadarComponent();
    OUTLINED_FUNCTION_232();
    v264 = OUTLINED_FUNCTION_277();
    OUTLINED_FUNCTION_370(v264);
    OUTLINED_FUNCTION_5_3();
    fig_log_call_emit_and_clean_up_after_send_and_compose();
    LOWORD(v359) = 0;
    OUTLINED_FUNCTION_16_14();
    OUTLINED_FUNCTION_5_61();
    _os_log_send_and_compose_impl();
    OUTLINED_FUNCTION_13_18();
    OUTLINED_FUNCTION_26_22();
    v274 = 7975;
LABEL_361:
    FigCapturePleaseFileRadar(v267, v268, v269, v270, v271, v274, v272, v273, v275);
    free(&v359);
    v9 = v302;
    v24 = 0x1E696A000;
    goto LABEL_109;
  }

  if (!v67)
  {
    FigCaptureGetFrameworkRadarComponent();
    OUTLINED_FUNCTION_232();
    v265 = OUTLINED_FUNCTION_277();
    if (OUTLINED_FUNCTION_370(v265))
    {
      v266 = v9;
    }

    else
    {
      v266 = v9 & 0xFFFFFFFE;
    }

    if (v266)
    {
      *time1 = 136315138;
      *&time1[4] = "fvcd_updateFrameStatistics";
      OUTLINED_FUNCTION_14_28();
      OUTLINED_FUNCTION_13();
      _os_log_send_and_compose_impl();
    }

    OUTLINED_FUNCTION_5_3();
    fig_log_call_emit_and_clean_up_after_send_and_compose();
    LOWORD(v359) = 0;
    OUTLINED_FUNCTION_16_14();
    OUTLINED_FUNCTION_5_61();
    _os_log_send_and_compose_impl();
    OUTLINED_FUNCTION_13_18();
    OUTLINED_FUNCTION_26_22();
    v274 = 7976;
    goto LABEL_361;
  }

  [OUTLINED_FUNCTION_322() updateWithFrameMetadata:? updateFocusDistance:?];
LABEL_109:
  v68 = [objc_msgSend(v9 objectForKeyedSubscript:{*off_1E798B068), "BOOLValue"}];
  os_unfair_lock_lock((v6 + 2140));
  *(v6 + 2152) = *(v6 + 2144);
  *(v6 + 2144) = v67;
  LODWORD(v294) = *(v6 + 2647);
  *(v6 + 2647) = 0;
  v69 = *(v6 + 2276);
  if ((v69 - 5) >= 3 && (*(v6 + 2280) - 5) > 2)
  {
    v73 = 1;
  }

  else
  {
    if (v293)
    {
      v70 = *(v6 + 2324);
      if ((*(v6 + 3304) & 1) == 0 && v70 >= *(v6 + 2320) - 1)
      {
        v70 = *(v6 + 2320) - 1;
      }

      v71 = v70 & ~(v70 >> 31);
      *(v6 + 2320) = v71;
    }

    else
    {
      v71 = *(v6 + 2320);
    }

    if (v71 < 1)
    {
      if (v69 == 7)
      {
        v72 = 6;
        goto LABEL_123;
      }
    }

    else if (v69 == 6 || *(v6 + 2280) == 6)
    {
      v72 = 7;
LABEL_123:
      v73 = 0;
      *(v6 + 2280) = v72;
      *(v6 + 2272) = 1;
      goto LABEL_126;
    }

    v73 = 0;
  }

LABEL_126:
  LODWORD(v291) = *(v6 + 2636);
  HIDWORD(v291) = *(v6 + 2632);
  HIDWORD(v289) = *(v6 + 2640);
  v74 = *(v6 + 2400);
  if (v68 && *(v6 + 2280) == 3 || (v75 = *(v6 + 2280), (HIDWORD(v301) & v73 & 1) != 0) || (v76 = *(v6 + 2272), !*(v6 + 2272)))
  {
    os_unfair_lock_unlock((v6 + 2140));
    goto LABEL_147;
  }

  *(v6 + 2276) = v75;
  *(v6 + 2272) = 0;
  os_unfair_lock_unlock((v6 + 2140));
  if (!v76)
  {
    goto LABEL_147;
  }

  v78 = v75 - 5;
  *(v6 + 3336) = (v75 - 5) < 3;
  v79 = *(v6 + 3296);
  if (v79 || v78 > 2)
  {
    if ((v69 - 5) >= 3 && v78 > 2)
    {
      goto LABEL_146;
    }
  }

  else
  {
    *(v6 + 3296) = objc_alloc_init(BWDeviceMotionActivityDetector);
    *&v77 = OUTLINED_FUNCTION_19_1((v6 + 3308)).n128_u64[0];
  }

  if (*(v6 + 2328))
  {
    v81 = v78 >= 3;
  }

  else
  {
    v81 = 1;
  }

  v82 = !v81;
  [v79 setDirectionalMotionDetectionEnabled:{v82, v77}];
LABEL_146:
  v83 = [v302 objectForKeyedSubscript:*off_1E798B540];
  v84 = *(v6 + 1656);
  v333[0] = MEMORY[0x1E69E9820];
  v333[1] = 3221225472;
  v333[2] = __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke_3;
  v333[3] = &unk_1E798FE50;
  v334 = v75;
  v335 = v69;
  v333[4] = v6;
  v333[5] = v83;
  dispatch_sync(v84, v333);
LABEL_147:
  if (*(v6 + 1830) == 1)
  {
    v85 = OUTLINED_FUNCTION_1_19();
    [BWFigVideoCaptureDevice _serviceDeferredAutofocusProcessorPropertiesFromCaptureStream:v85 frameStatisticsByPortType:?];
  }

  OUTLINED_FUNCTION_204();
  if (v17)
  {
    os_unfair_lock_lock((v6 + 4308));
    [*(v6 + 4312) fudgedLowerBound];
    v87 = v86;
    [*(v6 + 4312) fudgedUpperBound];
    v89 = v88;
    os_unfair_lock_unlock((v6 + 4308));
    if (v87 == 0.0 || ([*(v6 + 2952) appliedZoomFactor], v90 < v87) || (objc_msgSend(*(v6 + 2952), "appliedZoomFactor"), v89 < v91) || *(v6 + 1572) == 0.0)
    {
      v92 = 1;
    }

    else
    {
      v92 = *(v287 + 208);
    }

    [*(v24 + 3480) numberWithBool:v92 & 1];
    OUTLINED_FUNCTION_37_0();
    OUTLINED_FUNCTION_295();
    CMSetAttachment(v93, v94, v95, v96);
  }

  if (*(v6 + 1616) && !(BYTE4(v301) & 1 | ((*(v6 + 1608) & 1) == 0)))
  {
    v97 = OUTLINED_FUNCTION_1_19();
    [BWFigVideoCaptureDevice _serviceSDOFSceneMonitoringWithCaptureStream:v97 sampleBuffer:v98 frameStatisticsByPortType:v5 flashModeForSceneMonitoring:v67 hdrModeForSceneMonitoring:SHIDWORD(v291) qualityPrioritizationForSceneMonitoring:? streamingImageIntent:?];
  }

  if (*(v6 + 1680))
  {
    if (*(v6 + 1672) == 1 && [v6 smartFramingIsMonitoringScene] && (*(v287 + 249) & 1) == 0)
    {
      os_unfair_lock_lock((v6 + 2140));
      v108 = *(v6 + 2644);
      os_unfair_lock_unlock((v6 + 2140));
      v109 = *(v6 + 1720);
      if (v109 != v108)
      {
        *(v6 + 1720) = v108;
      }

      if (*(v6 + 1721) != 1 || (v108 & 1) == 0)
      {
        LODWORD(v359) = 0;
        os_unfair_lock_lock((v6 + 1692));
        if (v109 != v108 && (*(v6 + 1721) & 1) != 0)
        {
          [*(v6 + 1680) reset];
        }

        v110 = [*(v6 + 1680) resolveSuggestedFieldOfViewWithSampleBuffer:v5 suggestedFieldOfViewOut:&v359];
        os_unfair_lock_unlock((v6 + 1692));
        if (!v110)
        {
          [BWFigVideoCaptureDevice _handleSmartFramingSuggestedFieldOfViewChangeIfNeeded:v6];
        }
      }
    }

    else if (*(v6 + 1680))
    {
      if (*(v6 + 189) == 1 && *(v6 + 216) == 1)
      {
        if (*(v6 + 1728))
        {
          if ([v6 smartFramingIsMonitoringScene])
          {
            if ((*(v287 + 249) & 1) == 0)
            {
              v359 = 0u;
              v360 = 0u;
              os_unfair_lock_lock((v6 + 1692));
              v99 = [*(v6 + 1680) resolveSuggestedFieldOfViewRectWithSampleBuffer:v5 fromFieldOfViewRects:*(v6 + 1728) suggestedFieldOfViewRectOut:&v359];
              os_unfair_lock_unlock((v6 + 1692));
              if (!v99)
              {
                OUTLINED_FUNCTION_222(v100, v101, v102, v103, v104, v105, v106, v107, v275, v278, v281, v283, v285, v287, v289, v291, v294, v297, key);
                FigCFDictionarySetCGRect();
              }
            }
          }
        }
      }
    }
  }

  if (*(v6 + 1416))
  {
    if ((v301 & 0x100000000) == 0)
    {
      OUTLINED_FUNCTION_84_5();
      [BWFigVideoCaptureDevice _serviceBravoStreamSelectionWithSampleBuffer:fromCaptureStream:frameStatisticsByPortType:streamingImageIntent:];
    }

    if (!CMGetAttachment(v5, @"RecommendedMasterPortType", 0))
    {
      [objc_msgSend(*(v6 + 1416) "recommendedMasterStream")];
      v111 = OUTLINED_FUNCTION_37_0();
      CMSetAttachment(v111, @"RecommendedMasterPortType", v112, 1u);
      [objc_msgSend(*(v6 + 1416) "preferredMasterStreamIgnoringEligibleFallbackPortTypes")];
      OUTLINED_FUNCTION_37_0();
      OUTLINED_FUNCTION_295();
      CMSetAttachment(v113, v114, v115, v116);
      [MEMORY[0x1E696AD98] numberWithInt:{objc_msgSend(*(v6 + 1416), "lastSelectionReason")}];
      OUTLINED_FUNCTION_37_0();
      OUTLINED_FUNCTION_295();
      CMSetAttachment(v117, v118, v119, v120);
    }
  }

  v121 = v303;
  if (v297 & 1 | ((v301 & 0x100000000) == 0))
  {
    OUTLINED_FUNCTION_84_5();
    [BWFigVideoCaptureDevice _serviceNondisruptiveSwitchingFormatWithSampleBuffer:fromCaptureStream:frameStatisticsByPortType:streamingImageIntent:];
  }

  [v303 previewShift];
  [v6 captureStream:v303 didUpdatePreviewShift:?];
  if ((v297 & 0x100000000) != 0)
  {
    [v6 _resetStillImageCaptureRequestState];
  }

  [(BWFigVideoCaptureDevice *)v6 _servicePendingStillImageCapture];
  if (*(v6 + 1560))
  {
    [*(v6 + 648) setMasterStream:*(v6 + 600) allStreams:*(v6 + 656)];
  }

  if (*(v6 + 1546) == 1)
  {
    v122 = OUTLINED_FUNCTION_210();
    [BWFigVideoCaptureDevice _serviceMacroFocusDetectionWithFrameStatisticsByPortType:v122];
  }

  if (*(v6 + 3952))
  {
    v123 = OUTLINED_FUNCTION_84_5();
    [(BWFigVideoCaptureDevice *)v123 _serviceVariableFrameRateWithSampleBuffer:v124 fromCaptureStream:v303 frameStatisticsByPortType:v67];
  }

  if (v69 == 8)
  {
    [v303 portType];
    if ([OUTLINED_FUNCTION_40_9() detectFlickerWithSampleBuffer:v5 fromCaptureStreamWithPortType:?])
    {
      flickerFrequency = [*(v6 + 4064) flickerFrequency];
      v126 = *(v6 + 1656);
      v331[0] = MEMORY[0x1E69E9820];
      v331[1] = 3221225472;
      v331[2] = __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke_4;
      v331[3] = &unk_1E7991CF0;
      v331[4] = v6;
      v332 = flickerFrequency;
      dispatch_async(v126, v331);
    }
  }

  v127 = OUTLINED_FUNCTION_84_5();
  [BWFigVideoCaptureDevice _servicePropertyChangeNotifications:v127];
  if (!v5)
  {
    OUTLINED_FUNCTION_267();
    FigDebugAssert3();
    v280 = v283;
    LODWORD(v275) = 0;
    OUTLINED_FUNCTION_267();
    v121 = v303;
LABEL_358:
    FigDebugAssert3();
    goto LABEL_225;
  }

  v136 = OUTLINED_FUNCTION_222(v128, v129, v130, v131, v132, v133, v134, v135, v275, v278, v281, v283, v285, v287, v289, v291, v294, v297, key);
  if (v136)
  {
    v137 = v136;
    v138 = CFDictionaryGetValue(v136, *off_1E798B078);
    if (v138)
    {
      LODWORD(valuePtr[0]) = 0;
      LODWORD(v354[0]) = 0;
      CFNumberGetValue(v138, kCFNumberSInt32Type, valuePtr);
      v146 = CFDictionaryGetValue(v137, *off_1E798B060);
      v147 = 0;
      if (v146)
      {
        CFNumberGetValue(v146, kCFNumberSInt32Type, v354);
        v147 = LODWORD(v354[0]) != 0;
      }

      v148 = LODWORD(valuePtr[0]) != 0;
      FigSimpleMutexLock();
      if (*(v6 + 1792) == 1)
      {
        v149 = v148 || v147;
        if (*(v6 + 1820))
        {
          if (*(v6 + 1808))
          {
            v359 = 0uLL;
            *&v360 = 0;
            v150 = OUTLINED_FUNCTION_244();
            CMSampleBufferGetPresentationTimeStamp(v151, v150);
            *time1 = v359;
            *&time1[16] = v360;
            lhs = *(v6 + 1796);
            if (CMTimeCompare(time1, &lhs) >= 1)
            {
              v152 = *(v6 + 1793);
              if (v152 == (v149 & 1))
              {
                v153 = *(v6 + 1824);
                if (v153 < 3)
                {
                  *(v6 + 1824) = v153 + 1;
                }

                else
                {
                  v149 = v152 ^ 1;
                  v154 = MEMORY[0x1E6960C70];
                  *(v6 + 1796) = *MEMORY[0x1E6960C70];
                  *(v6 + 1812) = *(v154 + 16);
                }
              }
            }
          }
        }

        v155 = v149 & 1;
        if (*(v6 + 1793) != (v149 & 1))
        {
          v156 = *(v6 + 1820);
          if (v156)
          {
            v157 = v156 - 1;
            *(v6 + 1820) = v157;
            if (!v157)
            {
              OUTLINED_FUNCTION_19_1((v6 + 1796));
            }
          }

          *(v6 + 1793) = v155;
          v356[0] = @"NewPropertyValue";
          rhs.value = [MEMORY[0x1E696AD98] numberWithBool:?];
          [v6 _postNotificationWithPayload:@"AEStatusChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &rhs, v356, 1)}];
        }
      }

      LODWORD(v138) = FigSimpleMutexUnlock();
    }
  }

  else
  {
    OUTLINED_FUNCTION_0();
    LODWORD(v138) = FigDebugAssert3();
  }

  v158 = OUTLINED_FUNCTION_222(v138, v139, v140, v141, v142, v143, v144, v145, v276, v279, v282, v284, v286, v288, v290, v292, v295, v298, keya);
  if (!v158)
  {
    OUTLINED_FUNCTION_0();
    goto LABEL_358;
  }

  v159 = CFDictionaryGetValue(v158, *off_1E798B148);
  if (v159)
  {
    LODWORD(lhs.value) = 0;
    CFNumberGetValue(v159, kCFNumberSInt32Type, &lhs);
    v160 = lhs.value;
    v161 = LODWORD(lhs.value) != 0;
    FigSimpleMutexLock();
    if (*(v6 + 1828) == 1 && *(v6 + 1829) != v161)
    {
      *(v6 + 1829) = v161;
      *time1 = @"NewPropertyValue";
      *&v359 = [MEMORY[0x1E696AD98] numberWithBool:v160 != 0];
      [v6 _postNotificationWithPayload:@"AWBStatusChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v359, time1, 1)}];
    }

    FigSimpleMutexUnlock();
  }

LABEL_225:
  v162 = OUTLINED_FUNCTION_84_5();
  v163 = [BWFigVideoCaptureDevice _serviceCompletedRequestNotifications:v162];
  if (*(v6 + 2648) != 1)
  {
    v177 = 0;
    goto LABEL_264;
  }

  [OUTLINED_FUNCTION_222(v163 v164];
  v358 = 0;
  v171 = v294 ^ 1;
  if (*(v6 + 2652) <= 2)
  {
    v171 = 0;
  }

  if ((HIDWORD(v301) & v171 & 1) == 0)
  {
    v172 = [(BWFigVideoCaptureDevice *)v6 _stillImageSceneTypeForCaptureStream:v121 frameStatisticsByPortType:v67 flashMode:SHIDWORD(v291) hdrMode:v291 qualityPrioritization:SHIDWORD(v289) digitalFlashMode:v74 sceneFlags:&v358];
    v173 = v172 == 1;
    v174 = v172 == 2;
    v175 = v172 == 3;
    memset(&lhs, 0, sizeof(lhs));
    if (!v74)
    {
LABEL_247:
      os_unfair_lock_lock((v6 + 2140));
      if ((v294 & 1) == 0 && *(v6 + 2644) == v173 && *(v6 + 2645) == v174)
      {
        v186 = *(v6 + 2646);
        *(v6 + 2644) = v173;
        *(v6 + 2646) = v175;
        v187 = v186 != v175 || *(v6 + 2404) != v74;
      }

      else
      {
        *(v6 + 2644) = v173;
        *(v6 + 2645) = v174;
        v187 = 1;
        *(v6 + 2646) = v175;
      }

      *(v6 + 2404) = v74;
      p_timescale = &lhs.timescale;
      for (k = 2448; k != 2464; k += 8)
      {
        v187 = v187 || *(v6 + k) != *p_timescale;
        *(v6 + k) = *p_timescale;
        p_timescale += 2;
      }

      os_unfair_lock_unlock((v6 + 2140));
      if (v187)
      {
        if (v74 < 1)
        {
          v190 = MEMORY[0x1E695E0F8];
          v173 = 0x1E696A000uLL;
        }

        else
        {
          v356[0] = @"Min";
          rhs.value = [OUTLINED_FUNCTION_208() numberWithDouble:*&lhs.timescale];
          v356[1] = @"Max";
          *&rhs.timescale = [*(v173 + 3480) numberWithDouble:*&lhs.epoch];
          v190 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&rhs forKeys:v356 count:2];
        }

        v354[0] = @"Status";
        v191 = [*(v173 + 3480) numberWithInt:v74];
        v354[1] = @"ExposureTimes";
        valuePtr[0] = v191;
        valuePtr[1] = v190;
        v192 = [MEMORY[0x1E695DF20] dictionaryWithObjects:valuePtr forKeys:v354 count:2];
        *time1 = @"FlashScene";
        *&v359 = [*(v173 + 3480) numberWithBool:v172 == 1];
        *&time1[8] = @"HDRScene";
        *(&v359 + 1) = [*(v173 + 3480) numberWithBool:v172 == 2];
        *&time1[16] = @"SISScene";
        v193 = [*(v173 + 3480) numberWithBool:v172 == 3];
        *&time1[24] = @"DigitalFlashScene";
        *&v360 = v193;
        *(&v360 + 1) = v192;
        [v6 _postNotificationWithPayload:@"StillImageSceneChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v359, time1, 4)}];
        v121 = v303;
      }

      goto LABEL_263;
    }

    LODWORD(key) = v172 == 2;
    [v121 portType];
    if (![OUTLINED_FUNCTION_4() containsObject:?])
    {
      v74 = 0;
      goto LABEL_247;
    }

    os_unfair_lock_lock((v6 + 2140));
    v74 = *(v6 + 2404);
    [v121 portType];
    v176 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
    if (v176)
    {
      v178 = v176;
      os_unfair_lock_unlock((v6 + 2140));
    }

    else
    {
      if (!objc_loadWeak((v6 + 2392)))
      {
        os_unfair_lock_unlock((v6 + 2140));
        v121 = v303;
        goto LABEL_247;
      }

      objc_loadWeak((v6 + 2392));
      HIDWORD(v297) = v172 == 3;
      [v303 portType];
      v178 = [OUTLINED_FUNCTION_4() adaptiveBracketingDigitalFlashTotalIntegrationTimesProviderForPortType:? wait:?];
      [v303 portType];
      [OUTLINED_FUNCTION_40_9() setObject:v178 forKeyedSubscript:?];
      os_unfair_lock_unlock((v6 + 2140));
      if (!v178)
      {
LABEL_246:
        v121 = v303;
        goto LABEL_247;
      }
    }

    if ((v358 & 0x4000) != 0)
    {
      v74 = 0;
    }

    else
    {
      if ((~v358 & 0x40040) != 0)
      {
        v74 = [(BWFigVideoCaptureDevice *)v6 _ubResolveDigitalFlashStatusForSceneFlags:v358 flashMode:SHIDWORD(v291)];
      }

      if (v74 >= 1)
      {
        LODWORD(v297) = v74;
        HIDWORD(v297) = v172 == 3;
        HIDWORD(v291) = v172 == 1;
        v179 = v5;
        [v303 portType];
        v180 = [OUTLINED_FUNCTION_15() objectForKeyedSubscript:?];
        v181 = v358;
        [v180 finalCropRect];
        v182 = [BWFigVideoCaptureDevice _ubDetectedObjectsForDigitalFlashFromDetectedObjects:v6 finalCropRect:?];
        v183 = 1;
        v184 = (v181 >> 13) & 1;
        do
        {
          [v178 totalIntegrationTimeForDigitalFlashMode:v183 frameStatistics:v180 stationary:v184 detectedObjects:v182];
          *(&lhs.value + v183++) = v185;
        }

        while (v183 != 3);
        v5 = v179;
        v74 = v297;
        v173 = v172 == 1;
        v174 = v172 == 2;
      }
    }

    goto LABEL_246;
  }

LABEL_263:
  v177 = v358;
LABEL_264:
  v194 = v302;
  if ([objc_msgSend(*(v6 + 624) objectForKeyedSubscript:{@"Torch", v275), "BOOLValue"}])
  {
    v195 = OUTLINED_FUNCTION_210();
    [BWFigVideoCaptureDevice _serviceAutoTorchNotification:v195 sampleBuffer:v196];
  }

  if ((v301 & 0x100000000) == 0 && *(v6 + 1625) == 1)
  {
    v197 = OUTLINED_FUNCTION_210();
    [(BWFigVideoCaptureDevice *)v197 _serviceStereoVideoCaptureSceneMonitoringWithFrameStatisticsByPortType:v198 sceneFlags:v177, v199, v200, v201, v202, v203, v277, v280, SHIDWORD(v280), v281, v283, v285, v287, v289, v291, v294, v297, key, v301, v302, v303, v304, v305, v306, v307, v308, v310, v311, v312, v313, v314, v315, v316, v317, v318, v319, v320, v321, v322, v323, v324, v325, v326, v327, v328, v329, v330];
  }

  if (*(v6 + 2060) == 1)
  {
    OUTLINED_FUNCTION_84_5();
    [BWFigVideoCaptureDevice _collectAPSStatistics:];
  }

  else if (*(v6 + 2061) == 1)
  {
    [BWAutoFocusPositionSensorMonitor logVideoRecordingAPSStatistics:v6 + 2064];
    *(v6 + 2061) = 0;
  }

  if ([*(v6 + 3512) count])
  {
    v204 = OUTLINED_FUNCTION_84_5();
    [(BWFigVideoCaptureDevice *)v204 _checkCriticalFocusError:v205];
  }

  if (*(v6 + 3528) && [*(v6 + 3528) containsObject:{objc_msgSend(v194, "objectForKeyedSubscript:", *off_1E798B540)}])
  {
    v206 = OUTLINED_FUNCTION_84_5();
    [(BWFigVideoCaptureDevice *)v206 _checkDegradedAutoFocus:v207];
  }

  if (*(v6 + 3560))
  {
    v208 = OUTLINED_FUNCTION_84_5();
    [(BWFigVideoCaptureDevice *)v208 _checkSphereJitterDetection:v209];
  }

  if (!*(v6 + 3672))
  {
    *(v6 + 3672) = [v194 objectForKeyedSubscript:*off_1E798B6B0];
  }

  v210 = OUTLINED_FUNCTION_84_5();
  [(BWFigVideoCaptureDevice *)v210 _collectAPSMacroInstabilityStatistics:v211];
  v212 = OUTLINED_FUNCTION_84_5();
  [(BWFigVideoCaptureDevice *)v212 _collectSensorTemperatureStatistics:v213];
  v214 = OUTLINED_FUNCTION_84_5();
  [BWFigVideoCaptureDevice _updateMLVNRActiveTime:v214];
  if (*(v6 + 2648) != 1)
  {
    goto LABEL_321;
  }

  if (HIDWORD(v285) == 1 && [v67 frameCount])
  {
    if (*(v6 + 1545) == 1)
    {
      v215 = *(v6 + 120);
      OUTLINED_FUNCTION_206();
      v220 = OUTLINED_FUNCTION_1_0(v216, v217, v218, v219);
      if (!v220)
      {
        goto LABEL_307;
      }

      v221 = v220;
      v296 = v5;
      v222 = MEMORY[0];
      v223 = *off_1E798A0E8;
      v224 = 1;
      while (1)
      {
        for (m = 0; m != v221; ++m)
        {
          if (MEMORY[0] != v222)
          {
            objc_enumerationMutation(v215);
          }

          v226 = *(8 * m);
          if (!*(v6 + 1560))
          {
            if ((v224 & 1) == 0)
            {
              v224 = 0;
              continue;
            }

LABEL_296:
            v229 = [v67 objectForKeyedSubscript:v226];
            if (v229)
            {
              [v229 pts];
              v224 = v309 & 1;
            }

            else
            {
              v224 = 0;
              v309 = 0;
            }

            continue;
          }

          v227 = [*(8 * m) isEqualToString:v223];
          if (v227)
          {
            v224 &= v227;
            continue;
          }

          v228 = v224 ^ 1;
          v224 &= v227;
          if ((v228 & 1) == 0)
          {
            goto LABEL_296;
          }
        }

        OUTLINED_FUNCTION_206();
        v221 = OUTLINED_FUNCTION_1_0(v230, v231, v232, v233);
        if (!v221)
        {
          v5 = v296;
          v194 = v302;
          if (!v224)
          {
            goto LABEL_311;
          }

LABEL_307:
          os_unfair_lock_lock((v6 + 1384));
          [*(v6 + 2760) transitionToState:2];
          os_unfair_lock_unlock((v6 + 1384));
          goto LABEL_311;
        }
      }
    }

    [v303 portType];
    v234 = [OUTLINED_FUNCTION_15() objectForKeyedSubscript:?];
    if (v234)
    {
      [v234 pts];
      if ((v305 & 0x100000000) != 0)
      {
        goto LABEL_307;
      }
    }
  }

LABEL_311:
  if (*(v6 + 2160) == 1)
  {
    v252 = OUTLINED_FUNCTION_210();
    [BWFigVideoCaptureDevice _serviceRetryStillImageCaptureUsingFrameStatisticsByPortType:v252];
  }

  else
  {
    os_unfair_lock_lock((v6 + 2712));
    if (*(v6 + 2752) == 1)
    {
      if ([BWStillImageTimeMachine afComplete:v5])
      {
        *(v6 + 2752) = 0;
        os_unfair_lock_unlock((v6 + 2712));
        v121 = v303;
        if (*(v6 + 2704) < 60)
        {
          v235 = (v6 + 2704);
          v236 = *(v6 + 2688);
          *&v359 = MEMORY[0x1E69E9820];
          *(&v359 + 1) = 3221225472;
          *&v360 = __fvcd_serviceRetryStillImageCapture_block_invoke;
          *(&v360 + 1) = &unk_1E798F870;
          v361 = v6;
          dispatch_async(v236, &v359);
          v237 = *(v6 + 2704);
LABEL_320:
          *v235 = v237 + 1;
          goto LABEL_321;
        }
      }

      else
      {
        os_unfair_lock_unlock((v6 + 2712));
        v237 = *(v6 + 2704);
        v121 = v303;
        if (v237 < 60)
        {
          v235 = (v6 + 2704);
          goto LABEL_320;
        }
      }

      FigCaptureGetFrameworkRadarComponent();
      OUTLINED_FUNCTION_232();
      v253 = OUTLINED_FUNCTION_277();
      v254 = lhs.value;
      os_log_type_enabled(v253, rhs.value);
      OUTLINED_FUNCTION_97_0();
      if (v17)
      {
        v256 = v255;
      }

      else
      {
        v256 = v254;
      }

      if (v256)
      {
        *time1 = 136315394;
        *&time1[4] = "fvcd_serviceRetryStillImageCapture";
        *&time1[12] = 1024;
        *&time1[14] = 60;
        OUTLINED_FUNCTION_14_28();
        OUTLINED_FUNCTION_13();
        _os_log_send_and_compose_impl();
      }

      v121 = v303;
      OUTLINED_FUNCTION_5_3();
      OUTLINED_FUNCTION_128();
      *&v359 = 0x3C04000100;
      OUTLINED_FUNCTION_305();
      OUTLINED_FUNCTION_5_61();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_13_18();
      OUTLINED_FUNCTION_26_22();
      FigCapturePleaseFileRadar(v257, v258, v259, v260, v261, 11706, v262, v263, v362);
      free(&v359);
      [BWFigVideoCaptureDevice _terminateCaptureAndEmitStillImageCaptureError:v6 stillImageCaptureNowOptions:4294950493 stillImageCaptureStreamProperties:?];
      goto LABEL_321;
    }

    os_unfair_lock_unlock((v6 + 2712));
  }

  v121 = v303;
LABEL_321:
  if (*(v6 + 544) == 1)
  {
    v238 = [objc_msgSend(objc_msgSend(v194 objectForKeyedSubscript:{*off_1E798B220), "objectForKeyedSubscript:", *off_1E798ACB8), "objectForKeyedSubscript:", *off_1E798ACE8}];
    if (!v238)
    {
      v238 = [v194 objectForKeyedSubscript:*off_1E798B218];
    }

    v239 = *(v6 + 568);
    if ([v238 count] >= v239)
    {
      v240 = [v238 count];
    }

    else
    {
      v240 = *(v6 + 568);
    }

    *(v6 + 568) = v240;
    v241 = *(v6 + 576);
    [objc_msgSend(v194 objectForKeyedSubscript:{*off_1E798B4B8), "doubleValue"}];
    [v241 addDataPoint:?];
  }

  *(v6 + 608) = [v121 portType];
  if (v5)
  {
    if (*(v6 + 4456) == -1)
    {
      ImageBuffer = CMSampleBufferGetImageBuffer(v5);
      if (ImageBuffer)
      {
        *(v6 + 4456) = BWPixelBufferColorSpace(ImageBuffer);
      }
    }
  }

  if ([*(v6 + 600) hasSphere])
  {
    os_unfair_lock_lock((v6 + 4472));
    v243 = [v194 objectForKeyedSubscript:*off_1E798B6D0];
    if (v243)
    {
      *&time1[8] = 0;
      *time1 = 0;
      [v243 getBytes:time1 length:16];
      if (!*time1)
      {
        v245 = vmovl_u16(*&time1[2]);
        v246 = vaddvq_s32(v245) + *&time1[10] + *&time1[12] + *&time1[14];
        v244 = ((v246 - v245.i32[0]) / v246);
        if (v244 >= 0.05)
        {
          v247 = OUTLINED_FUNCTION_244();
          CMSampleBufferGetPresentationTimeStamp(v248, v247);
          *&v244 = OUTLINED_FUNCTION_292().n128_u64[0];
        }
      }
    }

    v249 = [v194 objectForKeyedSubscript:{*off_1E798B6B0, v244}];
    if ([v249 isEqual:*off_1E798C4A8] && objc_msgSend(*(v6 + 4528), "isEqual:", *off_1E798C470))
    {
      v250 = OUTLINED_FUNCTION_244();
      CMSampleBufferGetPresentationTimeStamp(v251, v250);
      OUTLINED_FUNCTION_292();
    }

    *(v6 + 4528) = v249;
    os_unfair_lock_unlock((v6 + 4472));
  }

LABEL_341:
  OUTLINED_FUNCTION_353();
}

- (void)_addStateAttachmentsToVideoSampleBuffer:(uint64_t)buffer captureStream:
{
  if (buffer)
  {
    OUTLINED_FUNCTION_80();
    v4 = *(v3 + 3952);
    if (v4)
    {
      [v4 addAttachmentsToSamplebuffer:v1];
    }

    v5 = OUTLINED_FUNCTION_44();
    [BWFigVideoCaptureDevice _addSystemPressureAttachments:v5];
    if (*(v2 + 3388) == 1)
    {
      os_unfair_lock_lock((v2 + 3396));
      [MEMORY[0x1E696AD98] numberWithInt:*(v2 + 3392)];
      v6 = OUTLINED_FUNCTION_35_19();
      CMSetAttachment(v6, v7, v8, v9);
      os_unfair_lock_unlock((v2 + 3396));
    }

    if (*(v2 + 2474) == 1)
    {
      CMSetAttachment(v1, @"BWBurnAfterReading", MEMORY[0x1E695E118], 0);
    }

    if ([*(v2 + 600) sphereEnabled])
    {
      v10 = *(v2 + 3888);
    }

    else
    {
      v10 = 0;
    }

    if (*(v2 + 1625) == 1 && *(v2 + 1632))
    {
      v24 = OUTLINED_FUNCTION_44();
      [(BWFigVideoCaptureDevice *)v24 _addStereoVideoCaptureSceneMonitoringMetadataToSampleBuffer:v25];
    }

    v11 = *(v2 + 4424);
    if ((v11 & 1) == 0)
    {
      if ([*(v2 + 2760) currentState] == 4 || objc_msgSend(*(v2 + 2760), "currentState") == 8)
      {
        v11 = 1;
        *(v2 + 4424) = 1;
      }

      else
      {
        v11 = *(v2 + 4424);
      }
    }

    [MEMORY[0x1E696AD98] numberWithBool:v11 & 1];
    v12 = OUTLINED_FUNCTION_35_19();
    CMSetAttachment(v12, v13, v14, v15);
    if (v10)
    {
      v22 = OUTLINED_FUNCTION_44();
      [(BWFigVideoCaptureDevice *)v22 _addStationaryFlagToMetadata:v23];
    }

    if (*(v2 + 2620) & 1) != 0 || (*(v2 + 2608))
    {
      v20 = OUTLINED_FUNCTION_44();
      [(BWFigVideoCaptureDevice *)v20 _addDropFrameWaitingForTorchToRampUpKey:v21];
    }

    if (*(v2 + 4462) == 1 && *(v2 + 4463) == 1)
    {
      CMSetAttachment(v1, @"TrueVideoTransitionLargeSphereTravelDetected", MEMORY[0x1E695E118], 1u);
    }

    [MEMORY[0x1E696AD98] numberWithBool:*(v2 + 1390)];
    v16 = OUTLINED_FUNCTION_35_19();

    CMSetAttachment(v16, v17, v18, v19);
  }
}

- (uint64_t)_addValidationAndCoreRepairStatusesToSampleBuffer:(uint64_t)result
{
  if (!result)
  {
    return result;
  }

  v1 = result;
  v2 = FigCaptureDeviceIORegValuesByKeys();
  FigCaptureDeviceCoreRepairStatusesByKeys();
  dictionary = [MEMORY[0x1E695DF90] dictionary];
  dictionary2 = [MEMORY[0x1E695DF90] dictionary];
  v5 = *(v1 + 616);
  if (v5 == 2)
  {
    v6 = kFigCaptureDeviceIORegKey_FCClValidationStatus;
    goto LABEL_6;
  }

  if (v5 == 1)
  {
    [v2 objectForKeyedSubscript:0x1F21ADBD0];
    [OUTLINED_FUNCTION_4() setObject:? forKeyedSubscript:?];
    v6 = kFigCaptureDeviceIORegKey_CmPMValidationStatus;
LABEL_6:
    [v2 objectForKeyedSubscript:*v6];
    [OUTLINED_FUNCTION_4() setObject:? forKeyedSubscript:?];
    [OUTLINED_FUNCTION_86() objectForKeyedSubscript:?];
    [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
  }

  v7 = OUTLINED_FUNCTION_4_3();
  v10 = CMGetAttachment(v7, v8, v9);
  [v10 setObject:dictionary forKeyedSubscript:*off_1E798A558];
  v11 = *off_1E798A590;

  return [v10 setObject:dictionary2 forKeyedSubscript:v11];
}

- (uint64_t)_updateOrientationTotalTimes:(uint64_t)result
{
  if (result)
  {
    v2 = *(result + 504);
    if ((v2 & 0x8000000000000000) == 0)
    {
      v3 = *(result + 496) - 1;
      if (v3 <= 3)
      {
        *(result + 8 * v3 + 512) += a2 - v2;
      }
    }
  }

  return result;
}

- (void)_accumulateInvalidFramesForAnalytics:(uint64_t)analytics
{
  if (analytics)
  {
    if (a2)
    {
      OUTLINED_FUNCTION_42_15();
      v13 = *MEMORY[0x1E6960CC0];
      *&time2.value = *MEMORY[0x1E6960CC0];
      v4 = *(MEMORY[0x1E6960CC0] + 16);
      time2.epoch = v4;
      if (CMTimeCompare(&time1, &time2))
      {
        ++*(analytics + 4596);
      }

      OUTLINED_FUNCTION_42_15();
      *&time2.value = v13;
      time2.epoch = v4;
      if (!CMTimeCompare(&time1, &time2))
      {
        OUTLINED_FUNCTION_310();
        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_81_2();
          OUTLINED_FUNCTION_201();
          OUTLINED_FUNCTION_68_4();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          OUTLINED_FUNCTION_363(os_log_and_send_and_compose_flags_and_os_log_type);
          OUTLINED_FUNCTION_39_7();
          if (v7)
          {
            v8 = v6;
          }

          else
          {
            v8 = v2;
          }

          if (!v8)
          {
            goto LABEL_19;
          }

          goto LABEL_18;
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_42_15();
      time2 = **&MEMORY[0x1E6960CC0];
      if (!CMTimeCompare(&time1, &time2))
      {
        OUTLINED_FUNCTION_310();
        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_81_2();
          OUTLINED_FUNCTION_201();
          OUTLINED_FUNCTION_68_4();
          v9 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          OUTLINED_FUNCTION_363(v9);
          OUTLINED_FUNCTION_39_7();
          if (v7)
          {
            v11 = v10;
          }

          else
          {
            v11 = v2;
          }

          if (!v11)
          {
            goto LABEL_19;
          }

LABEL_18:
          OUTLINED_FUNCTION_42_15();
          Seconds = CMTimeGetSeconds(&time1);
          LODWORD(time2.value) = 136315394;
          *(&time2.value + 4) = "[BWFigVideoCaptureDevice _accumulateInvalidFramesForAnalytics:]";
          LOWORD(time2.flags) = 2048;
          *(&time2.flags + 2) = Seconds;
          OUTLINED_FUNCTION_34_16();
          OUTLINED_FUNCTION_7_4();
          _os_log_send_and_compose_impl();
LABEL_19:
          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_17_8();
        }
      }
    }
  }
}

- (void)_updateStreamingImageIntentTo:from:masterPortType:
{
  OUTLINED_FUNCTION_6_4();
  HIDWORD(v123) = v2;
  v126 = v3;
  if (!v3)
  {
    goto LABEL_113;
  }

  v4 = v1;
  v5 = v0;
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_0_3();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  if (v5 == HIDWORD(v123))
  {
    goto LABEL_113;
  }

  if (!HIDWORD(v123))
  {
    minimumFrameRate = [v126 minimumFrameRate];
    *(v126 + 2284) = FigCaptureFrameRateAsFloat(minimumFrameRate, v7);
    maximumFrameRate = [v126 maximumFrameRate];
    *(v126 + 2288) = FigCaptureFrameRateAsFloat(maximumFrameRate, v9);
  }

  LODWORD(v115) = v5 - 1;
  if (v5 - 1 >= 2)
  {
    HIDWORD(v119) = (HIDWORD(v123) - 1) < 2;
    if (v5 - 5 < 3)
    {
      v10 = 1;
      v11 = 1;
      goto LABEL_12;
    }
  }

  else
  {
    HIDWORD(v119) = 1;
  }

  v10 = 0;
  v11 = (HIDWORD(v123) - 5) < 3;
LABEL_12:
  HIDWORD(v115) = v11;
  v114 = fvcd_timeLapseCaptureConfigurationForStreamingImageIntent(v5);
  v12 = v5 == 3 || HIDWORD(v123) == 3;
  v13 = v12;
  LODWORD(v123) = v10;
  if (v10 && (v5 != 7 ? (FigCapturePlatformIdentifier() >= 10 ? (v15 = 16) : (v15 = 33), v14 = 8) : (v14 = 0, v15 = 0), *v127 = *off_1E798B9E0, time.value = [MEMORY[0x1E696AD98] numberWithInt:v15], *&v127[8] = *off_1E798B9D8, *&time.timescale = objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v14), (v16 = objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &time, v127, 2)) != 0))
  {
    v108 = v16;
    [BWFigVideoCaptureDevice _setSynchronizedStreamsGroupProperty:v126 value:?];
  }

  else
  {
    v108 = 0;
  }

  LODWORD(v119) = [BWFigVideoCaptureDevice _ltmCurveForStreamingImageIntent:v126];
  v125 = [BWFigVideoCaptureDevice _ltmCurveForStreamingImageIntent:v126];
  v17 = [(BWFigVideoCaptureDevice *)v126 _minimumFrameRateForStreamingImageIntent:v5 masterPortType:v4];
  v18 = 30.0;
  if (v5 != 3)
  {
    v18 = *(v126 + 2288);
  }

  FigCaptureFrameRateFromFloat();
  [(BWFigVideoCaptureDevice *)v126 _setMinimumFrameRate:v19, v20];
  FigCaptureFrameRateFromFloat();
  [v126 setMaximumFrameRate:{v22, v21}];
  dictionary = [MEMORY[0x1E695DF90] dictionary];
  dictionary2 = [MEMORY[0x1E695DF90] dictionary];
  dictionary3 = [MEMORY[0x1E695DF90] dictionary];
  v155 = 0u;
  v156 = 0u;
  v157 = 0u;
  v158 = 0u;
  obj = *(v126 + 656);
  v122 = [obj countByEnumeratingWithState:&v155 objects:v154 count:16];
  if (v122)
  {
    LODWORD(v107) = v5 == 3;
    v118 = *v156;
    v111 = *off_1E798BF38;
    allocator = *MEMORY[0x1E695E480];
    HIDWORD(v99) = fmaxf(v17, 1.0);
    v98 = *off_1E798A0D8;
    if (v5 == 2)
    {
      v23 = 1024.0;
    }

    else
    {
      v23 = 512.0;
    }

    if (v5 == 2)
    {
      v24 = 2048.0;
    }

    else
    {
      v24 = 1024.0;
    }

    v110 = *off_1E798BC00;
    HIDWORD(v117) = v13 | HIDWORD(v119) | HIDWORD(v115);
    v25 = v17;
    v104 = *off_1E798C1F0;
    v103 = *off_1E798C780;
    v101 = *off_1E798B9E0;
    v102 = *off_1E798C788;
    v100 = *off_1E798B9D8;
    *(&v26 + 1) = *(MEMORY[0x1E6960C70] + 8);
    v124 = *(MEMORY[0x1E6960C70] + 16);
    *&v26 = 136318210;
    v106 = v26;
    HIDWORD(v107) = v5;
    do
    {
      v27 = 0;
      v28 = v123;
      v29 = 0x1E696A000uLL;
      do
      {
        if (*v156 != v118)
        {
          objc_enumerationMutation(obj);
        }

        v30 = *(*(&v155 + 1) + 8 * v27);
        portType = [v30 portType];
        v32 = *(v29 + 3480);
        minimumFrameRate2 = [v30 minimumFrameRate];
        [dictionary setObject:objc_msgSend(v32 forKeyedSubscript:{"numberWithInt:", FigCaptureFrameRateAsInt(minimumFrameRate2, v34)), portType}];
        if (*(v126 + 2288) >= v18)
        {
          v38 = &unk_1F2246990;
        }

        else
        {
          v35 = *(v29 + 3480);
          maximumFrameRate2 = [v30 maximumFrameRate];
          v116 = v116 & 0xFFFFFFFF00000000 | v37;
          v38 = [v35 numberWithInt:{FigCaptureFrameRateAsInt(maximumFrameRate2, v116)}];
        }

        v39 = [dictionary2 setObject:v38 forKeyedSubscript:portType];
        if (v119 != v125)
        {
          [dictionary3 setObject:objc_msgSend(*(v29 + 3480) forKeyedSubscript:{"numberWithInt:", v125), portType}];
          [v30 stream];
          [*(v29 + 3480) numberWithInt:v125];
          v39 = [OUTLINED_FUNCTION_40_9() setProperty:v111 value:?];
        }

        if (!HIDWORD(v123))
        {
          if (!*(v126 + 2296))
          {
            *(v126 + 2296) = objc_alloc_init(MEMORY[0x1E695DF90]);
          }

          v48 = *(v29 + 3480);
          [v30 aeMaxGain];
          [*(v126 + 2296) setObject:objc_msgSend(v48 forKeyedSubscript:{"numberWithFloat:"), portType}];
          if (*(v126 + 2304))
          {
            if (v30)
            {
              goto LABEL_51;
            }

LABEL_53:
            memset(&time, 0, sizeof(time));
          }

          else
          {
            *(v126 + 2304) = objc_alloc_init(MEMORY[0x1E695DF90]);
            if (!v30)
            {
              goto LABEL_53;
            }

LABEL_51:
            [v30 maxExposureDurationFrameworkOverride];
          }

          v39 = [*(v126 + 2304) setObject:CMTimeCopyAsDictionary(&time forKeyedSubscript:{allocator), portType}];
        }

        *&v49 = OUTLINED_FUNCTION_227(v39, v40, v41, v42, v43, v44, v45, v46, v96, v97, v98, v99, v100, v101, v102, v103, v104, allocator, v106, *(&v106 + 1), v107, v108, v109, v110, v111, dictionary3, obj, v114, v115, v116, v117, v118, v119, dictionary2, dictionary, v122, v123, v124, v47).n128_u64[0];
        v153.epoch = v50;
        memset(&time, 0, sizeof(time));
        [v30 portType];
        v51 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
        v52 = CMTimeMakeFromDictionary(&time, v51);
        switch(v5)
        {
          case 0u:
          case 4u:
          case 8u:
            [objc_msgSend(*(v126 + 2296) objectForKeyedSubscript:{portType), "floatValue"}];
            v62 = v61;
            *&v153.value = *&time.value;
            epoch = time.epoch;
            goto LABEL_62;
          case 1u:
          case 2u:
            if (*(v126 + 2312) != 1 || (v52 = [portType isEqualToString:v98], !v52) || (v52 = objc_msgSend(*(v126 + 2376), "containsObject:", portType), v62 = v24, (v52 & 1) == 0))
            {
              v62 = v23;
            }

            OUTLINED_FUNCTION_227(v52, v53, v54, v55, v56, v57, v58, v59, v96, v97, v98, v99, v100, v101, v102, v103, v104, allocator, v106, *(&v106 + 1), v107, v108, v109, v110, v111, dictionary3, obj, v114, v115, v116, v117, v118, v119, dictionary2, dictionary, v122, v123, v124, v60);
LABEL_62:
            v153.epoch = epoch;
            break;
          case 3u:
            [v30 momentCaptureVideoRecordingAEMaxGain];
            if (v65 == 0.0)
            {
              v62 = 120.0;
            }

            else
            {
              v62 = v65;
            }

            CMTimeMake(&v153, 1, SHIDWORD(v99));
            break;
          case 5u:
          case 7u:
            OUTLINED_FUNCTION_227(v52, v53, v54, v55, v56, v57, v58, v59, v96, v97, v98, v99, v100, v101, v102, v103, v104, allocator, v106, *(&v106 + 1), v107, v108, v109, v110, v111, dictionary3, obj, v114, v115, v116, v117, v118, v119, dictionary2, dictionary, v122, v123, v124, v60);
            goto LABEL_69;
          case 6u:
            *&v153.value = *&time.value;
            v64 = time.epoch;
LABEL_69:
            v153.epoch = v64;
            v62 = 512.0;
            break;
          default:
            v62 = 0.0;
            break;
        }

        [objc_msgSend(*(v126 + 2296) objectForKeyedSubscript:{portType), "floatValue"}];
        if (v66 > 0.0 && v62 > 0.0)
        {
          [v30 stream];
          LODWORD(v67) = vcvts_n_s32_f32(v62, 8uLL);
          [*(v29 + 3480) numberWithInt:v67];
          if (![OUTLINED_FUNCTION_40_9() setProperty:v110 value:?])
          {
            *&v68 = v62;
            [v30 setAeMaxGain:v68];
          }
        }

        if (HIDWORD(v119))
        {
          [*(v126 + 600) portType];
          v69 = [OUTLINED_FUNCTION_4() containsObject:?];
        }

        else
        {
          v69 = 0;
        }

        if (((v5 == 3) ^ [v30 lowLightVideoEnabled]) & 1) != 0 || (updateAETables = objc_msgSend(v30, "timeLapseEnabled"), ((v28 ^ updateAETables | v69)))
        {
          [v30 setLowLightVideoEnabled:v5 == 3];
          [v30 setTimeLapseEnabled:v28];
          if (v69)
          {
            [v30 setDigitalFlashZeroShutterLagEnabled:v115 < 2];
          }

          updateAETables = [v30 updateAETables];
        }

        if (HIDWORD(v117))
        {
          time = v153;
          [v30 setMaxExposureDurationFrameworkOverride:&time];
          updateAETables = [v30 updateMaxExposureDuration];
          if (HIDWORD(v115))
          {
            updateAETables = [objc_msgSend(v30 "stream")];
          }
        }

        v29 = 0x1E696A000;
        if (v30 == *(v126 + 672))
        {
          [v30 maxEIT];
          v77 = v76;
          if (v115 > 1)
          {
            if (!v28)
            {
              goto LABEL_92;
            }
          }

          else
          {
            [*(v126 + 672) portType];
            if ([OUTLINED_FUNCTION_4() containsObject:?])
            {
              v77 = 2139095039;
LABEL_92:
              [*(v126 + 1416) setTeleMaxAEGain:?];
              LODWORD(v78) = v77;
              updateAETables = [*(v126 + 1416) setTeleMaxEIT:v78];
              goto LABEL_93;
            }
          }

          [v30 portType];
          [objc_msgSend(OUTLINED_FUNCTION_4() "objectForKeyedSubscript:"floatValue"")];
          goto LABEL_92;
        }

LABEL_93:
        if (dword_1ED844350)
        {
          v152 = 0;
          type = OS_LOG_TYPE_DEFAULT;
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v80 = v152;
          os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, type);
          OUTLINED_FUNCTION_39_7();
          if (v12)
          {
            v82 = v81;
          }

          else
          {
            v82 = v80;
          }

          if (v82)
          {
            v83 = fvcd_streamingImageIntentToString(HIDWORD(v123));
            v84 = fvcd_streamingImageIntentToString(v5);
            v86 = BWPortTypeToDisplayString(portType, v85);
            if (v114)
            {
              v87 = MEMORY[0x1E696AEC0];
              [objc_msgSend(v114 objectForKeyedSubscript:{v103), "floatValue"}];
              *&v89 = v88;
              v97 = [objc_msgSend(v114 objectForKeyedSubscript:{v102), "BOOLValue"}];
              v96 = v89;
              v90 = [v87 stringWithFormat:@"SampleRate:%f, SmoothingEnabled:%d"];
            }

            else
            {
              v90 = @"-";
            }

            if (v108)
            {
              v109 = v83;
              v91 = v84;
              v92 = MEMORY[0x1E696AEC0];
              v96 = [objc_msgSend(v108 objectForKeyedSubscript:{v101), "intValue"}];
              v97 = [objc_msgSend(v108 objectForKeyedSubscript:{v100), "intValue"}];
              v93 = v92;
              v84 = v91;
              v83 = v109;
              v94 = [v93 stringWithFormat:@"Unlock:%d, Lock:%d"];
            }

            else
            {
              v94 = @"-";
            }

            v29 = 0x1E696A000;
            *v127 = v106;
            *&v127[4] = "[BWFigVideoCaptureDevice _updateStreamingImageIntentTo:from:masterPortType:]";
            *&v127[12] = 2112;
            *&v127[14] = v83;
            v128 = 2112;
            v129 = v84;
            v130 = 2112;
            v131 = v86;
            v132 = 1024;
            v133 = v125;
            v134 = 2048;
            v135 = v25;
            v136 = 2048;
            v137 = v18;
            v138 = 2048;
            v139 = v62;
            v140 = 1024;
            v141 = v107;
            v142 = 1024;
            v143 = v123;
            v144 = 1024;
            v145 = HIDWORD(v115);
            v146 = 2112;
            v147 = v90;
            v148 = 2112;
            v149 = v94;
            LODWORD(v97) = 116;
            OUTLINED_FUNCTION_242();
            OUTLINED_FUNCTION_13();
            _os_log_send_and_compose_impl();
            v5 = HIDWORD(v107);
          }

          OUTLINED_FUNCTION_2_4();
          updateAETables = OUTLINED_FUNCTION_17_8();
          v28 = v123;
        }

        ++v27;
      }

      while (v122 != v27);
      v122 = OUTLINED_FUNCTION_281(updateAETables, v71, &v155, v154, v72, v73, v74, v75, v96, v97, v98, v99, v100, v101, v102, v103, v104, allocator, v106, *(&v106 + 1), v107, v108, v109, v110, v111, dictionary3, obj);
    }

    while (v122);
  }

  if ([dictionary3 count])
  {
    v95 = 5;
  }

  else
  {
    v95 = 0;
  }

  os_unfair_lock_lock((v126 + 2032));
  [*(v126 + 2040) setExpectedMinimumFrameRatesByPortType:dictionary];
  [*(v126 + 2040) setExpectedMaximumFrameRatesByPortType:dictionary2];
  [*(v126 + 2040) setExpectedLTMCurvesByPortType:dictionary3];
  [*(v126 + 2040) setLtmCurvesTransitionFrameCount:v95];
  os_unfair_lock_unlock((v126 + 2032));
LABEL_113:
  OUTLINED_FUNCTION_5_5();
}

- (void)_serviceSDOFSceneMonitoringWithCaptureStream:(uint64_t)stream sampleBuffer:(uint64_t)buffer frameStatisticsByPortType:(int)type flashModeForSceneMonitoring:hdrModeForSceneMonitoring:qualityPrioritizationForSceneMonitoring:streamingImageIntent:
{
  if (self)
  {
    OUTLINED_FUNCTION_176();
    v52 = 0;
    v53 = 0;
    [(BWFigVideoCaptureDevice *)v9 _stillImageSceneTypeForCaptureStream:v10 frameStatisticsByPortType:v11 flashMode:v12 hdrMode:v13 qualityPrioritization:v14 digitalFlashMode:0 sceneFlags:&v52];
    os_unfair_lock_lock((v5 + 1596));
    objc_opt_class();
    OUTLINED_FUNCTION_326();
    if (objc_opt_isKindOfClass())
    {
      v15 = *(v5 + 1616);
      [objc_msgSend(objc_msgSend(*(v5 + 648) "clientBaseZoomFactorsByPortType")];
      v17 = v16 == 0.0 ? 1.0 : v16;
      [*(v5 + 2952) appliedZoomFactorWithoutFudge];
      v19 = v18 / v17;
      [v15 zoomFactorForTuningParameters];
      if (vabds_f32(v19, v20) > 0.1)
      {
        os_unfair_lock_lock((v5 + 1408));
        v21 = *(v5 + 1392);
        if (!v21)
        {
          v21 = *(v5 + 600);
        }

        os_unfair_lock_unlock((v5 + 1408));
        v22 = +[FigCaptureCameraParameters sharedInstance];
        portType = [v21 portType];
        sensorIDString = [v21 sensorIDString];
        *&v25 = v19;
        if ([(FigCaptureCameraParameters *)v22 portraitSceneMonitoringParametersForPortType:portType sensorIDString:sensorIDString zoomFactorRelativeToWidePortType:v25])
        {
          v26 = OUTLINED_FUNCTION_15();
          *&v27 = v19;
          [v26 updateTuningParameters:v27 zoomFactor:?];
        }
      }
    }

    os_unfair_lock_lock((v5 + 4072));
    v28 = *(v5 + 4084);
    os_unfair_lock_unlock((v5 + 4072));
    LODWORD(v49) = v28;
    v29 = [*(v5 + 1616) resolveSDOFStatusWithSampleBuffer:v6 frameStatisticsByPortType:buffer sceneFlags:v49 flashOrTorchWillBeActive:&v53 + 4 digitalFlashWillFire:&v53 thermalPressureLevel:? peakPowerPressureLevel:? effectStatus:? stagePreviewStatus:?];
    [*(v5 + 1616) focusDistanceToMaxAllowedFocusDistanceRatio];
    v31 = v30;
    v32 = *(v5 + 4000);
    if (v32)
    {
      point = *MEMORY[0x1E695EFF8];
      v33 = CGPointMakeWithDictionaryRepresentation([v32 objectForKeyedSubscript:@"CinematicVideoFocusPoint"], &point);
      v34 = OUTLINED_FUNCTION_7_24(v33, *off_1E798A3C8);
      rect.origin.x = 0.0;
      rect.origin.y = 0.0;
      __asm { FMOV            V0.2D, #1.0 }

      rect.size = _Q0;
      CGRectMakeWithDictionaryRepresentation([v34 objectForKeyedSubscript:*off_1E798A5C8], &rect);
      v54.x = FigCaptureTransformNormalizedPointFromCoordinateSpaceOfNormalizedRect(point.x, point.y, rect.origin.x, rect.origin.y, rect.size.width);
      DictionaryRepresentation = CGPointCreateDictionaryRepresentation(v54);
      [*(v5 + 4000) setObject:DictionaryRepresentation forKeyedSubscript:@"CinematicVideoFocusPoint"];
      CMSetAttachment(v6, @"CinematicVideoFocusRequest", *(v5 + 4000), 1u);

      *(v5 + 4000) = 0;
    }

    os_unfair_lock_unlock((v5 + 1596));
    if (*(v5 + 1595) == 1)
    {
      v41 = [CMGetAttachment(v6 @"DepthDisabled"];
      v42 = v41;
      v43 = *(v5 + 680);
      if (v43)
      {
        [*(v5 + 1416) eligibleFallbackPortTypes];
        [*(v5 + 680) portType];
        v41 = [OUTLINED_FUNCTION_28() containsObject:?];
        LODWORD(v43) = (*(v5 + 1556) & v41);
      }

      if ((v43 | v42))
      {
        v53 = 0;
        v29 = 1;
        if (!(v42 & 1 | ((v43 & 1) == 0)))
        {
          CMSetAttachment(v6, @"DepthDisabled", MEMORY[0x1E695E118], 1u);
        }
      }
    }

    if (*(v5 + 1595) == 1 && *(v5 + 2488))
    {
      if ((HIDWORD(v53) - 11) <= 1 && (v52 & 0x2000000) == 0)
      {
        v41 = [(BWFigVideoCaptureDevice *)v5 _ubResolveDigitalFlashStatusForSceneFlags:v52 flashMode:type];
        if (v41 == 2 || (v41 = [v5 streamingDigitalFlashMode], v41))
        {
          HIDWORD(v53) = 0;
        }
      }
    }

    else if ((*(v5 + 2345) != 1 || (v52 & 0x4000) != 0) && *(v5 + 1594) == 1 && (HIDWORD(v53) & 0xFFFFFFFB) == 1)
    {
      [*(v5 + 600) baseZoomFactor];
      v46 = OUTLINED_FUNCTION_84_5();
      [BWFigVideoCaptureDevice _ubStillImageSceneFlagsForCaptureStream:v46 frameStatisticsByPortType:? fusionEnabled:? metadata:? sceneMonitoring:? zoomFactorOverride:?];
      v41 = [(BWFigVideoCaptureDevice *)v5 _ubResolveDigitalFlashStatusForSceneFlags:v47 flashMode:type];
      if (v41)
      {
        if (HIDWORD(v53) == 1)
        {
          v48 = 9;
        }

        else
        {
          v48 = 10;
        }

        HIDWORD(v53) = v48;
      }
    }

    if (v31 != 0.0)
    {
      v44 = OUTLINED_FUNCTION_7_24(v41, *off_1E798A3C8);
      *&v45 = v31;
      [v44 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithFloat:", v45), *off_1E798D338}];
    }

    if (v29)
    {
      [BWFigVideoCaptureDevice _updateSDOFEffectStatus:v5 newStagePreviewStatus:?];
    }
  }
}

- (void)_handleSmartFramingSuggestedFieldOfViewChangeIfNeeded:(uint64_t)needed
{
  if (needed)
  {
    OUTLINED_FUNCTION_54();
    os_unfair_lock_lock(v3 + 423);
    if (!v2 || v1[422]._os_unfair_lock_opaque == v2)
    {

      os_unfair_lock_unlock(v1 + 423);
    }

    else
    {
      v1[422]._os_unfair_lock_opaque = v2;
      os_unfair_lock_unlock(v1 + 423);
      v4 = FigCaptureSmartFramingFieldOfViewStringFromType(v2);
      [(os_unfair_lock_s *)v1 _postNotificationWithPayload:@"SmartFramingFieldOfViewChangedNotification" notificationPayload:OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v5, @"NewPropertyValue", v4)];
    }
  }
}

- (void)_serviceBravoStreamSelectionWithSampleBuffer:fromCaptureStream:frameStatisticsByPortType:streamingImageIntent:
{
  OUTLINED_FUNCTION_6_4();
  if (!v0)
  {
    goto LABEL_126;
  }

  v5 = v4;
  v6 = v3;
  v7 = v2;
  v8 = v1;
  v9 = v0;
  os_unfair_lock_lock(v0 + 352);
  v10 = *(v9 + 1392);
  v11 = *(v9 + 1400);
  os_unfair_lock_unlock((v9 + 1408));
  [*(v9 + 2952) rampZoomFactorOfInterest];
  if (v12 <= 0.0)
  {
    v169 = CMGetAttachment(v8, *off_1E798A3C8, 0);
    v166 = [v169 objectForKeyedSubscript:*off_1E798B220];
    active = [(BWFigVideoCaptureDevice *)v9 overCaptureActiveSlaveStreamForcedOff];
    if (*(v9 + 3888) == 1)
    {
      [objc_msgSend(v169 objectForKeyedSubscript:{*off_1E798B210), "floatValue"}];
    }

    [*(v9 + 2952) requestedZoomFactor];
    v21 = v20;
    if (*(v9 + 3888) & ~active)
    {
      v22 = 24;
    }

    else
    {
      v22 = 3;
    }

    *&v23 = [(BWFigVideoCaptureDevice *)v9 _nextLargerBaseZoomFactorForRequestedZoomFactor:v20];
    [*(v9 + 2952) predictRampZoomFactorAfterNumberOfFrames:v22 settingZoomFactorOfInterest:v23];
    v25 = v24;
    if (v24 != 0.0)
    {
      v21 = v24;
    }

    [*(v9 + 2952) rampZoomFactorOfInterest];
    v27 = v26;
    if (v10 != v7)
    {
      if (v26 <= 0.0)
      {
        goto LABEL_126;
      }

      OUTLINED_FUNCTION_107_4();
      if (!v34)
      {
        goto LABEL_126;
      }

      v13 = MEMORY[0x1E696AD98];
      goto LABEL_6;
    }

    v28 = *(v9 + 1516);
    v29 = *(v9 + 1536);
    [*(v9 + 2952) rampTargetZoomFactor];
    v31 = v30;
    [BWFigVideoCaptureDevice _updateStatsMasterForMasterStream:v9];
    v32 = OUTLINED_FUNCTION_3_19();
    [(BWFigVideoCaptureDevice *)v32 _updateBravoStreamSelectionForMasterStream:v33 forceNotification:0];
    os_unfair_lock_lock((v9 + 1384));
    v154 = *(v9 + 688);
    v155 = v29;
    v34 = v154 != v29 || v29 == 0;
    if (v34)
    {
      v35 = v10;
    }

    else
    {
      v35 = *(v9 + 688);
    }

    if (*(v9 + 3888))
    {
      v36 = *(v9 + 688);
    }

    else
    {
      v36 = v35;
    }

    key = v36;
    lastObject = [*(v9 + 664) lastObject];
    v38 = [objc_msgSend(lastObject "portType")];
    v39 = 0;
    if (v38)
    {
      nondisruptiveSwitchingZoomFactors = [lastObject nondisruptiveSwitchingZoomFactors];
      v40 = MEMORY[0x1E696AD98];
      [*(v9 + 2952) rampTargetZoomFactor];
      v41 = [v40 numberWithFloat:?];
      v39 = [OUTLINED_FUNCTION_271(v41 v42];
    }

    v49 = v21;
    if (*(v9 + 4705) == 1)
    {
      v50 = v39;
      [*(v9 + 2952) earlySwitchOverScaleFactorForZoomIn];
      OUTLINED_FUNCTION_35_3();
      v51 = v34;
      v49 = v21;
      if (((v51 | v50) & 1) == 0)
      {
        [*(v9 + 2952) earlySwitchOverScaleFactorForZoomIn];
        v49 = v21 / v52;
      }
    }

    v53 = 2 * (v5 == 2);
    if (v5 == 1)
    {
      v53 = 1;
    }

    v161 = v53;
    v54 = *(v9 + 1416);
    v55 = *(v9 + 2644);
    objc = *(v9 + 3304);
    cameraControlsStatisticsMasterStream = [*(v9 + 648) cameraControlsStatisticsMasterStream];
    *&v56 = v49;
    v57 = [v54 recommendMasterStreamUsingCurrentMasterStream:key frameStatisticsByPortType:v6 zoomFactor:v55 isAutoFlashScene:v161 digitalFlashMode:objc isStationary:v166 detectedObjects:v56 cameraControlsStatisticsMasterStream:?];
    preferredMasterStreamIgnoringEligibleFallbackPortTypes = [*(v9 + 1416) preferredMasterStreamIgnoringEligibleFallbackPortTypes];
    [(__CFString *)v57 portType];
    v59 = OUTLINED_FUNCTION_15();
    CMSetAttachment(v59, @"RecommendedMasterPortType", v60, 1u);
    keya = preferredMasterStreamIgnoringEligibleFallbackPortTypes;
    [(__CFString *)preferredMasterStreamIgnoringEligibleFallbackPortTypes portType];
    v61 = OUTLINED_FUNCTION_15();
    CMSetAttachment(v61, @"PreferredMasterPortType", v62, 1u);
    [MEMORY[0x1E696AD98] numberWithInt:{objc_msgSend(*(v9 + 1416), "lastSelectionReason")}];
    v63 = OUTLINED_FUNCTION_15();
    CMSetAttachment(v63, @"LastRecommendedMasterSelectionReason", v64, 1u);
    OUTLINED_FUNCTION_107_4();
    if (v34)
    {
      if (v27 > 0.0)
      {
        *&v65 = v27;
        [MEMORY[0x1E696AD98] numberWithFloat:v65];
        v77 = OUTLINED_FUNCTION_15();
        CMSetAttachment(v77, @"RampZoomFactorOfInterest", v78, 1u);
      }

      v79 = OUTLINED_FUNCTION_316();
      [(BWFigVideoCaptureDevice *)v80 _overCaptureSelectLockedStreamsForRecommendedMasterStream:v81 requestedZoomFactor:v79 currentFrameRate:v82];
      v83 = *(v9 + 3904);
      if ((!v83 || [v83 containsObject:v57]) && v57 != *(v9 + 688))
      {
        *(v9 + 688) = v57;
      }

      OUTLINED_FUNCTION_114_4();
      v66 = [BWFigVideoCaptureDevice _overCaptureMasterStreamForZoomFactor:v84];
      if ((*(v9 + 3898) & 1) == 0 && (*(v9 + 1568) & 1) == 0)
      {
        OUTLINED_FUNCTION_114_4();
        v168 = v66;
        v162 = [BWFigVideoCaptureDevice _overCaptureActiveSlaveStreamForZoomFactor:v85 masterStream:v66 currentFrameRate:0 preferWider:?];
        memset(v252, 0, 64);
        obja = *(v9 + 664);
        if ([obja countByEnumeratingWithState:v252 objects:v251 count:16])
        {
          v86 = 0;
          do
          {
            OUTLINED_FUNCTION_50_3();
            if (!v34)
            {
              objc_enumerationMutation(obja);
            }

            v87 = *v252[1];
            if (*v252[1] != *(v9 + 1392) && [*v252[1] streamingRequiredWhenConfiguredAsSlave])
            {
              v86 = v87;
            }

            OUTLINED_FUNCTION_78_0();
          }

          while (!v34 || [obja countByEnumeratingWithState:v252 objects:v251 count:16]);
        }

        else
        {
          v86 = 0;
        }

        if (v162 != v86)
        {
          [v162 setStreamingRequiredWhenConfiguredAsSlave:1];
          v132 = [v162 setFirmwareTimeMachineEnabledWhenConfiguredAsSlave:0];
          v133 = *(v9 + 656);
          if (OUTLINED_FUNCTION_361(v132, v134, v135, v136, v137, v138, v139, v140, cameraControlsStatisticsMasterStream, v154, v155, obja, v162, keya, v66, v169, v170, v172, v174, v176, v178, v180, v182, v184, v186, v188, v190, v192, v194, v196, v198, v200, v202, v204, v206, v208, v210, v212, v214, v216, v218, v220, v222, v224, v226, v228, v230, v232, v234, v236, v238, v240, v242, v244, v246, v248, 0))
          {
            do
            {
              OUTLINED_FUNCTION_21_20();
              if (!v34)
              {
                objc_enumerationMutation(v133);
              }

              v141 = MEMORY[0];
              if (MEMORY[0] != v168 && MEMORY[0] != v163)
              {
                [MEMORY[0] setStreamingRequiredWhenConfiguredAsSlave:0];
                [v141 setFirmwareTimeMachineEnabledWhenConfiguredAsSlave:0];
              }

              OUTLINED_FUNCTION_46_10();
            }

            while (!v34 || OUTLINED_FUNCTION_361(v143, v144, v145, v146, v147, v148, v149, v150, v153, v154, v155, objb, v163, keya, v168, v169, v171, v173, v175, v177, v179, v181, v183, v185, v187, v189, v191, v193, v195, v197, v199, v201, v203, v205, v207, v209, v211, v213, v215, v217, v219, v221, v223, v225, v227, v229, v231, v233, v235, v237, v239, v241, v243, v245, v247, v249, v250));
          }
        }

        v66 = v168;
      }
    }

    else
    {
      v66 = v57;
      if (v57 != *(v9 + 688))
      {
        *(v9 + 688) = v57;
      }
    }

    os_unfair_lock_unlock((v9 + 1384));
    [(__CFString *)v10 baseZoomFactor];
    v68 = v67;
    [(__CFString *)v66 baseZoomFactor];
    if (v68 >= v69)
    {
      v70 = 0;
    }

    else
    {
      v70 = *(v9 + 3888) ^ 1;
    }

    if ([*(v9 + 1528) isRamping])
    {
      [*(v9 + 1528) updateRampForNextIteration];
      v28 = v71;
      if ([*(v9 + 1528) isRampingUp])
      {
        if (v66 == v154)
        {
LABEL_167:
          v110 = v155;
          goto LABEL_168;
        }

        [*(v9 + 1528) reset];
      }
    }

    v167 = v66;
    if (v70)
    {
      OUTLINED_FUNCTION_35_3();
      v72 = v34;
      v73 = (v9 + 1388);
      v74 = v72 & *(v9 + 1388);
      if (*(v9 + 1388) & 1) == 0 || (v72 & *(v9 + 1388))
      {
LABEL_97:
        if (*(v9 + 1389) == 1)
        {
          [*(v9 + 2952) appliedZoomFactor];
          if (vabds_f32(v31, v102) < 0.001 || v31 == 0.0)
          {
            os_unfair_lock_lock((v9 + 1384));
            *(v9 + 1389) = 0;
            os_unfair_lock_unlock((v9 + 1384));
          }
        }

        OUTLINED_FUNCTION_107_4();
        if (v34 && *(v9 + 672) && ([*(v9 + 2952) appliedZoomFactor], v21 > v103) && (objc_msgSend(*(v9 + 672), "baseZoomFactor"), v21 >= v104))
        {
          v105 = *(v9 + 680) == v7;
          v106 = *(v9 + 600) == v7;
        }

        else
        {
          v105 = 0;
          v106 = 0;
        }

        OUTLINED_FUNCTION_107_4();
        if (v34)
        {
          OUTLINED_FUNCTION_204();
          if (v34)
          {
            [v9 shallowDepthOfFieldEffectStatus];
          }
        }

        if (v74)
        {
          v107 = 0;
          v108 = 1;
        }

        else
        {
          os_unfair_lock_lock((v9 + 1384));
          v107 = [*(v9 + 2760) currentState] == 8;
          v109 = v167 == v7 || v107;
          if ((v109 & 1) == 0)
          {
            *v73 = 1;
            if (v105)
            {
              *(v9 + 1389) = 1;
            }
          }

          v108 = v109 ^ 1;
          os_unfair_lock_unlock((v9 + 1384));
        }

        if (v107 || keya == v11)
        {
          if (v108)
          {
            goto LABEL_124;
          }
        }

        else
        {
          os_unfair_lock_lock((v9 + 1384));
          *(v9 + 1400) = keya;
          os_unfair_lock_unlock((v9 + 1384));
          -[BWFigVideoCaptureDevice _sendPreferredMasterStreamChangedNotificationWithPortType:](v9, [*(v9 + 1400) portType]);
          if (v108)
          {
LABEL_124:
            v110 = v167;
            [(__CFString *)v167 portType];
            if ([OUTLINED_FUNCTION_7() isEqualToString:?])
            {
              [*(v9 + 2952) resetZoomFactorOfInterest];
LABEL_126:
              OUTLINED_FUNCTION_5_5();
              return;
            }

            [(__CFString *)v10 willBecomeSlaveStream];
            [(__CFString *)v167 willBecomeMasterStream];
            v114 = *(v9 + 1528);
            v115 = *(v9 + 3888);
            if (v114 && (*(v9 + 3888) & 1) == 0)
            {
              if (v70)
              {
                if (v25 == 0.0)
                {
                  v110 = v167;
                  if (*(v9 + 1516) == 0.0)
                  {
                    LODWORD(v113) = 1.0;
                    [v114 startRampFrom:*(v9 + 1520) to:*(v9 + 1524) iterations:0.0 shape:v113];
                    [*(v9 + 1528) updateRampForNextIteration];
                    v28 = v116;
LABEL_168:
                    OUTLINED_FUNCTION_114_4();
                    [BWFigVideoCaptureDevice _updateSlaveFrameRateForZoomFactor:v131 masterCaptureStream:?];
                    if ([*(v9 + 648) setMasterStream:v10 allStreams:*(v9 + 656)])
                    {
                      os_unfair_lock_lock((v9 + 1384));
                      *(v9 + 1389) = 0;
                      os_unfair_lock_unlock((v9 + 1384));
                    }

                    if (*(v9 + 1516) != v28 || *(v9 + 1544) == 1 && *(v9 + 1536) != v110)
                    {
                      os_unfair_lock_lock((v9 + 1512));
                      *(v9 + 1516) = v28;
                      *(v9 + 1536) = v110;
                      os_unfair_lock_unlock((v9 + 1512));
                    }

                    goto LABEL_126;
                  }
                }

                else
                {
                  v110 = v167;
                }

                goto LABEL_150;
              }

              v117 = *(v9 + 1524);
              if (v117 == 1)
              {
                v118 = 2;
              }

              else
              {
                v118 = *(v9 + 1524);
              }

              if (v117 == 2)
              {
                v119 = 1;
              }

              else
              {
                v119 = v118;
              }

              v28 = 1.0;
              LODWORD(v112) = 1.0;
              [v114 startRampFrom:*(v9 + 1520) to:v119 iterations:v112 shape:0.0];
              v115 = *(v9 + 3888);
              v155 = v10;
            }

            if (v115)
            {
              OUTLINED_FUNCTION_84_5();
              v120 = OUTLINED_FUNCTION_316();
              [BWFigVideoCaptureDevice _overCaptureConfigureActiveSlaveStreamForMasterStream:v120 zoomFactor:? currentFrameRate:? preferWider:?];
LABEL_154:
              OUTLINED_FUNCTION_114_4();
              [BWFigVideoCaptureDevice _updateSlaveFrameRateForZoomFactor:v122 masterCaptureStream:?];
              v123 = OUTLINED_FUNCTION_3_19();
              [(BWFigVideoCaptureDevice *)v123 _reportCameraSwitchAnalyticsData:v124 recommendedMasterStream:v110 frameStatisticsByPortType:v6 metadata:v169];
              if ([*(v9 + 648) setMasterStream:v110 allStreams:*(v9 + 656)])
              {
                os_unfair_lock_lock((v9 + 1384));
                *(v9 + 1388) = 0;
                os_unfair_lock_unlock((v9 + 1384));
                [(__CFString *)v10 willBecomeMasterStream];
                [(__CFString *)v110 willBecomeSlaveStream];
                [(__CFString *)v10 didBecomeMasterStream];
                [(__CFString *)v110 didBecomeSlaveStream];
                OUTLINED_FUNCTION_107_4();
                if (v34)
                {
                  OUTLINED_FUNCTION_3_19();
                  v130 = OUTLINED_FUNCTION_316();
                  [BWFigVideoCaptureDevice _overCaptureConfigureActiveSlaveStreamForMasterStream:v130 zoomFactor:? currentFrameRate:? preferWider:?];
                }

                else if ((*(v9 + 1568) & 1) != 0 || (OUTLINED_FUNCTION_291(), v34))
                {
                  [BWFigVideoCaptureDevice _depthDataDeliveryOrStereoPhotoCaptureConfigureActiveSlaveStreamForPrimaryStream:v9];
                }
              }

              else
              {
                os_unfair_lock_lock((v9 + 1408));
                *(v9 + 1392) = v110;
                os_unfair_lock_unlock((v9 + 1408));
                [(__CFString *)v110 portType];
                v125 = OUTLINED_FUNCTION_3_19();
                [(BWFigVideoCaptureDevice *)v125 _sendMasterStreamChangedNotificationWithPortType:v126];
                v127 = OUTLINED_FUNCTION_3_19();
                [BWFigVideoCaptureDevice _updateStreamingImageIntentForChangedMasterStreamWithPortType:v127];
                if (*(v9 + 3945) == 1)
                {
                  if ([*(v9 + 1416) lastSelectionReason])
                  {
                    [*(v9 + 2952) appliedZoomFactor];
                    v129 = v128;
                    [v9 aspectRatio];
                    [BWFigVideoCaptureDevice _updateSensorRegionsOfInterestBasedOnZoomFactor:v9 aspectRatio:v129];
                  }

                  v10 = v167;
                }

                else
                {
                  v10 = v110;
                }
              }

              goto LABEL_167;
            }

LABEL_150:
            if ((*(v9 + 1568) & 1) != 0 || (OUTLINED_FUNCTION_291(), v34))
            {
              v121 = OUTLINED_FUNCTION_84_5();
              [BWFigVideoCaptureDevice _depthDataDeliveryOrStereoPhotoCaptureConfigureActiveSlaveStreamForPrimaryStream:v121];
            }

            goto LABEL_154;
          }
        }

        OUTLINED_FUNCTION_107_4();
        if (v34 && (!v106 || !v107))
        {
          OUTLINED_FUNCTION_3_19();
          v111 = OUTLINED_FUNCTION_316();
          if (([BWFigVideoCaptureDevice _overCaptureConfigureActiveSlaveStreamForMasterStream:v111 zoomFactor:? currentFrameRate:? preferWider:?]& v106) == 1)
          {
            os_unfair_lock_lock((v9 + 1384));
            *(v9 + 1389) = 1;
            os_unfair_lock_unlock((v9 + 1384));
          }
        }

        goto LABEL_167;
      }
    }

    else
    {
      v73 = (v9 + 1388);
      if (*(v9 + 1388) != 1)
      {
LABEL_96:
        v74 = 0;
        goto LABEL_97;
      }

      if (([*(v9 + 1528) isRamping] & 1) == 0)
      {
        v28 = 0.0;
        if (*(v9 + 1544) == 1)
        {
          v75 = [*(v9 + 664) indexOfObject:v10];
          if (v75 >= [*(v9 + 664) count] - 1)
          {
            v76 = 0;
          }

          else
          {
            v76 = [*(v9 + 664) objectAtIndexedSubscript:v75 + 1];
          }

          if (v76)
          {
            v88 = v76;
          }

          else
          {
            v88 = v10;
          }

          v155 = v88;
        }

        else
        {
          v155 = 0;
        }
      }
    }

    os_unfair_lock_lock((v9 + 1384));
    *(v9 + 1388) = 0;
    os_unfair_lock_unlock((v9 + 1384));
    [(__CFString *)v10 didBecomeMasterStream];
    v89 = *(v9 + 656);
    OUTLINED_FUNCTION_19_25();
    v94 = OUTLINED_FUNCTION_273(v90, v91, v92, v93);
    if (v94)
    {
      v95 = v94;
      do
      {
        for (i = 0; i != v95; ++i)
        {
          OUTLINED_FUNCTION_21_20();
          if (!v34)
          {
            objc_enumerationMutation(v89);
          }

          v97 = *(8 * i);
          if (v97 != v7)
          {
            [(__CFString *)v97 didBecomeSlaveStream];
          }
        }

        OUTLINED_FUNCTION_19_25();
        v95 = OUTLINED_FUNCTION_273(v98, v99, v100, v101);
      }

      while (v95);
    }

    goto LABEL_96;
  }

  OUTLINED_FUNCTION_107_4();
  if (!v34)
  {
    goto LABEL_126;
  }

  v13 = MEMORY[0x1E696AD98];
LABEL_6:
  [v13 numberWithFloat:?];
  OUTLINED_FUNCTION_15();
  OUTLINED_FUNCTION_5_5();

  CMSetAttachment(v14, v15, v16, v17);
}

- (void)_serviceNondisruptiveSwitchingFormatWithSampleBuffer:fromCaptureStream:frameStatisticsByPortType:streamingImageIntent:
{
  OUTLINED_FUNCTION_84();
  v3 = v2;
  v78 = v4;
  v80 = v5;
  if (!v0)
  {
    goto LABEL_50;
  }

  v6 = v0;
  v76 = OUTLINED_FUNCTION_4_12(v1, *off_1E798A3C8);
  v79 = [v76 objectForKeyedSubscript:*off_1E798B730];
  memset(v125, 0, 64);
  obj = *(v6 + 656);
  v7 = [obj countByEnumeratingWithState:v125 objects:v124 count:16];
  if (!v7)
  {
    v9 = 0;
    goto LABEL_17;
  }

  v8 = v7;
  v74 = v3;
  v9 = 0;
  OUTLINED_FUNCTION_343();
  v11 = *v10;
  do
  {
    for (i = 0; i != v8; ++i)
    {
      OUTLINED_FUNCTION_13_1();
      if (v13 != v3)
      {
        objc_enumerationMutation(obj);
      }

      v14 = *(v125[1] + 8 * i);
      [v14 portType];
      v15 = [OUTLINED_FUNCTION_36() objectForKeyedSubscript:?];
      [(BWFigVideoCaptureDevice *)v6 _serviceNondisruptiveSwitchingFormatForCaptureStream:v14 frameStatistics:v15 streamingImageIntent:v78 isStationary:*(v6 + 3304)];
      activeNondisruptiveSwitchingCommandID = [v14 activeNondisruptiveSwitchingCommandID];
      if (v14 == v80)
      {
        v17 = v76;
      }

      else
      {
        v17 = [v79 objectForKeyedSubscript:{objc_msgSend(v14, "portType")}];
        if (!v17)
        {
          completedNondisruptiveSwitchingCommandID = [v14 completedNondisruptiveSwitchingCommandID];
          goto LABEL_12;
        }
      }

      completedNondisruptiveSwitchingCommandID = [objc_msgSend(v17 objectForKeyedSubscript:{v11), "intValue"}];
LABEL_12:
      v19 = completedNondisruptiveSwitchingCommandID;
      if (completedNondisruptiveSwitchingCommandID > activeNondisruptiveSwitchingCommandID)
      {
        OUTLINED_FUNCTION_0();
        FigDebugAssert3();
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
        OUTLINED_FUNCTION_82_6();
        if (v32)
        {
          v65 = v64;
        }

        else
        {
          v65 = 0;
        }

        if (v65)
        {
          portType = [v14 portType];
          BWPortTypeToDisplayString(portType, v67);
          OUTLINED_FUNCTION_146_1();
          *(v69 + 14) = v68;
          *(v69 + 30) = activeNondisruptiveSwitchingCommandID;
          OUTLINED_FUNCTION_242();
          OUTLINED_FUNCTION_7_4();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_1_4();
        goto LABEL_49;
      }

      [v14 setCompletedNondisruptiveSwitchingCommandID:completedNondisruptiveSwitchingCommandID];
      v9 |= v19 < activeNondisruptiveSwitchingCommandID;
    }

    v8 = [obj countByEnumeratingWithState:v125 objects:v124 count:16];
  }

  while (v8);
LABEL_17:
  os_unfair_lock_lock((v6 + 1384));
  v20 = *(v6 + 1390) & (v9 ^ 1);
  *(v6 + 1390) = v9 & 1;
  if ((v9 ^ 1))
  {
    os_unfair_lock_unlock((v6 + 1384));
    if ((v20 & 1) == 0)
    {
      goto LABEL_50;
    }
  }

  else
  {
    if (*(v6 + 2808) == 1 && (*(v6 + 2809) & 1) == 0)
    {
      *(v6 + 2809) = 1;
    }

    os_unfair_lock_unlock((v6 + 1384));
  }

  HIDWORD(v77) = v20;
  string = [MEMORY[0x1E696AD60] string];
  *&v22 = OUTLINED_FUNCTION_346();
  *v101 = v22;
  v102 = v22;
  v23 = *(v6 + 656);
  OUTLINED_FUNCTION_59_7();
  v28 = OUTLINED_FUNCTION_52(v24, v25, v26, v27);
  if (!v28)
  {
    goto LABEL_35;
  }

  v29 = v28;
  v30 = *off_1E798B500;
  while (2)
  {
    v31 = 0;
    while (2)
    {
      OUTLINED_FUNCTION_42();
      if (!v32)
      {
        objc_enumerationMutation(v23);
      }

      v33 = *(v98 + 8 * v31);
      if (v33 == v80)
      {
        v34 = v76;
      }

      else
      {
        v34 = [v79 objectForKeyedSubscript:{objc_msgSend(*(v98 + 8 * v31), "portType")}];
        if (!v34)
        {
          completedNondisruptiveSwitchingCommandID2 = [v33 completedNondisruptiveSwitchingCommandID];
          goto LABEL_33;
        }
      }

      completedNondisruptiveSwitchingCommandID2 = [objc_msgSend(v34 objectForKeyedSubscript:{v30), "intValue"}];
LABEL_33:
      v36 = completedNondisruptiveSwitchingCommandID2;
      portType2 = [v33 portType];
      v39 = BWPortTypeToDisplayString(portType2, v38);
      v71 = v36;
      activeNondisruptiveSwitchingCommandID2 = [v33 activeNondisruptiveSwitchingCommandID];
      v70 = v39;
      [string appendFormat:@"%@: Metadata ID:%d, active ID:%d."];
      if (v29 != ++v31)
      {
        continue;
      }

      break;
    }

    OUTLINED_FUNCTION_59_7();
    v29 = OUTLINED_FUNCTION_52(v40, v41, v42, v43);
    if (v29)
    {
      continue;
    }

    break;
  }

LABEL_35:
  if (v20)
  {
    if (dword_1ED844350)
    {
      OUTLINED_FUNCTION_87_6();
      v44 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v52 = OUTLINED_FUNCTION_364(v44, v45, v46, v47, v48, v49, v50, v51, v70, v71, activeNondisruptiveSwitchingCommandID2, v73, v74, obj, v76, v77, v79, v80, v81, v82, v83, v84, v85, v86, v87, v88, v89, v90, v91, v92, v93, v94, v95, v96, v97, v98, v99, v100, v101[0], v101[1], v102, *(&v102 + 1), v103, v104, v105, v106, v107, v108, v109, v110, v111, v112, v113, v114, v115, v116, v117, v118, v119, v120, v121, v122, v123);
      if (OUTLINED_FUNCTION_5_2(v52))
      {
LABEL_41:
        OUTLINED_FUNCTION_146_1();
        *(v62 + 14) = string;
        OUTLINED_FUNCTION_34_16();
        OUTLINED_FUNCTION_242();
        OUTLINED_FUNCTION_7_4();
        _os_log_send_and_compose_impl();
      }

LABEL_47:
      OUTLINED_FUNCTION_2_4();
LABEL_49:
      fig_log_call_emit_and_clean_up_after_send_and_compose();
    }
  }

  else if (dword_1ED844350)
  {
    OUTLINED_FUNCTION_87_6();
    v53 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v61 = OUTLINED_FUNCTION_364(v53, v54, v55, v56, v57, v58, v59, v60, v70, v71, activeNondisruptiveSwitchingCommandID2, v73, v74, obj, v76, v77, v79, v80, v81, v82, v83, v84, v85, v86, v87, v88, v89, v90, v91, v92, v93, v94, v95, v96, v97, v98, v99, v100, v101[0], v101[1], v102, *(&v102 + 1), v103, v104, v105, v106, v107, v108, v109, v110, v111, v112, v113, v114, v115, v116, v117, v118, v119, v120, v121, v122, v123);
    if (OUTLINED_FUNCTION_5_2(v61))
    {
      goto LABEL_41;
    }

    goto LABEL_47;
  }

LABEL_50:
  OUTLINED_FUNCTION_81();
}

- (unint64_t)_serviceMacroFocusDetectionWithFrameStatisticsByPortType:(unint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    v4 = *(v3 + 680);
    if (!v4)
    {
      v4 = *(v1 + 600);
    }

    [v4 portType];
    v5 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
    v6 = OUTLINED_FUNCTION_1_19();
    v8 = [(BWFigVideoCaptureDevice *)v6 _focusIsStable:v7];
    [v5 focusDistance];
    v10 = v9;
    result = [v2 frameCount];
    if (result >= 0x1F && v8 && v10 > 0.0)
    {
      v11 = 1548;
      if (*(v1 + 1556))
      {
        v11 = 1552;
      }

      v12 = *(v1 + v11);
      v13 = v10 < v12;
      if (*(v1 + 1556) != v13)
      {
        *(v1 + 1556) = v13;
        [MEMORY[0x1E696AD98] numberWithBool:{v10 < v12, @"NewPropertyValue"}];
        return [v1 _postNotificationWithPayload:@"MacroFocusNotification" notificationPayload:{OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v14)}];
      }
    }
  }

  return result;
}

- (void)_serviceVariableFrameRateWithSampleBuffer:(void *)buffer fromCaptureStream:(uint64_t)stream frameStatisticsByPortType:
{
  if (self)
  {
    OUTLINED_FUNCTION_54();
    [v8 portType];
    [OUTLINED_FUNCTION_7() objectForKeyedSubscript:?];
    maximumFrameRate = [OUTLINED_FUNCTION_25_0() maximumFrameRate];
    FigCaptureFrameRateAsFloat(maximumFrameRate, v10);
    timeForLastRequestedZoomFactor = [*(v4 + 2952) timeForLastRequestedZoomFactor];
    FigGetUpTimeNanoseconds();
    v12 = OUTLINED_FUNCTION_123_4();
    v14 = v12 > (v13 - timeForLastRequestedZoomFactor);
    os_unfair_lock_lock((v4 + 2140));
    v15 = *(v4 + 3416);
    os_unfair_lock_unlock((v4 + 2140));
    v16 = *(v4 + 3952);
    maximumFrameRate2 = [buffer maximumFrameRate];
    v19 = FigCaptureFrameRateAsFloat(maximumFrameRate2, v18);
    [buffer aeMaxGain];
    LODWORD(v21) = v20;
    *&v22 = v19;
    [v16 processSampleBuffer:v5 frameStatistics:stream currentFrameRate:v14 aeMaxGain:v15 zoomInProgress:v22 mostRecentInferenceResult:v21];
    os_unfair_lock_lock((v4 + 3976));
    [*(v4 + 3952) suggestedFrameRate];
    *(v4 + 3960) = v23;
    if (v23 == 0.0)
    {

      os_unfair_lock_unlock((v4 + 3976));
    }

    else
    {
      v24 = v23;
      v25 = *(v4 + 3964);
      os_unfair_lock_unlock((v4 + 3976));
      if (v24 != v25)
      {
        OUTLINED_FUNCTION_7_1();
        v28 = 3221225472;
        v29 = __113__BWFigVideoCaptureDevice__serviceVariableFrameRateWithSampleBuffer_fromCaptureStream_frameStatisticsByPortType___block_invoke;
        v30 = &unk_1E798F870;
        v31 = v4;
        dispatch_async(v26, block);
      }
    }
  }
}

- (void)_updateActionCameraMaxExposureDurationForFlickerFrequency:
{
  OUTLINED_FUNCTION_60();
  v29 = v3;
  if (v2)
  {
    v4 = v2;
    if (!_FigIsCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_2_9();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    obj = OUTLINED_FUNCTION_270();
    v5 = [obj countByEnumeratingWithState:? objects:? count:?];
    if (v5)
    {
      v6 = v5;
      v7 = *off_1E798BC00;
      do
      {
        for (i = 0; i != v6; ++i)
        {
          OUTLINED_FUNCTION_6_30();
          if (!v9)
          {
            objc_enumerationMutation(obj);
          }

          v10 = *(v34[1] + 8 * i);
          portType = [v10 portType];
          if (v29)
          {
            CMTimeMake(&time, 1, 2 * v29);
            OUTLINED_FUNCTION_324();
            epoch_high = HIDWORD(time.epoch);
            time.value = v0;
            time.timescale = v1;
            *&time.flags = v12;
            Seconds = CMTimeGetSeconds(&time);
            CMTimeMakeFromDictionary(&time, [v4[288] objectForKeyedSubscript:portType]);
            *&Seconds = Seconds / CMTimeGetSeconds(&time);
            [objc_msgSend(v4[287] objectForKeyedSubscript:{portType), "floatValue"}];
            v15 = v14 / *&Seconds;
          }

          else
          {
            CMTimeMakeFromDictionary(&time, [v4[288] objectForKeyedSubscript:portType]);
            OUTLINED_FUNCTION_324();
            epoch_high = HIDWORD(time.epoch);
            [objc_msgSend(v4[287] objectForKeyedSubscript:{portType), "floatValue"}];
            v15 = v16;
          }

          *&time.flags = v34[9];
          HIDWORD(time.epoch) = epoch_high;
          time.value = v0;
          time.timescale = v1;
          [v10 setMaxExposureDurationFrameworkOverride:&time];
          [v10 updateMaxExposureDuration];
          stream = [v10 stream];
          LODWORD(v18) = vcvts_n_s32_f32(v15, 8uLL);
          if (![stream setProperty:v7 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v18)}])
          {
            *&v19 = v15;
            [v10 setAeMaxGain:v19];
          }

          if (v10 == v4[84])
          {
            [v10 maxEIT];
            v21 = v20;
            *&v22 = v15;
            [v4[177] setTeleMaxAEGain:v22];
            LODWORD(v23) = v21;
            [v4[177] setTeleMaxEIT:v23];
          }
        }

        v6 = [obj countByEnumeratingWithState:v34 objects:v33 count:16];
      }

      while (v6);
    }

    if (v29)
    {
      if (dword_1ED844350)
      {
        v32 = 0;
        type = OS_LOG_TYPE_DEFAULT;
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        v25 = os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, type);
        if (OUTLINED_FUNCTION_6(v25))
        {
          OUTLINED_FUNCTION_75();
          OUTLINED_FUNCTION_315();
          OUTLINED_FUNCTION_2_1();
          OUTLINED_FUNCTION_8_0();
          _os_log_send_and_compose_impl();
        }

LABEL_25:
        OUTLINED_FUNCTION_2_4();
        fig_log_call_emit_and_clean_up_after_send_and_compose();
      }
    }

    else if (dword_1ED844350)
    {
      v32 = 0;
      type = OS_LOG_TYPE_DEFAULT;
      v26 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v27 = os_log_type_enabled(v26, type);
      if (OUTLINED_FUNCTION_5_2(v27))
      {
        OUTLINED_FUNCTION_75();
        OUTLINED_FUNCTION_315();
        OUTLINED_FUNCTION_2_1();
        OUTLINED_FUNCTION_7_4();
        _os_log_send_and_compose_impl();
      }

      goto LABEL_25;
    }
  }

  OUTLINED_FUNCTION_128_0();
}

- (void)_collectAPSStatistics:
{
  OUTLINED_FUNCTION_357();
  if (v0)
  {
    v2 = v0;
    v3 = OUTLINED_FUNCTION_4_12(v1, *off_1E798A3C8);
    if (v3)
    {
      v4 = v3;
      [v3 objectForKeyedSubscript:*off_1E798B540];
      [v4 objectForKeyedSubscript:*off_1E798B730];
      if (([OUTLINED_FUNCTION_9_0() isEqualToString:?] & 1) == 0)
      {
        [OUTLINED_FUNCTION_86() objectForKeyedSubscript:?];
      }

      if (([OUTLINED_FUNCTION_9_0() isEqualToString:?] & 1) == 0)
      {
        [OUTLINED_FUNCTION_86() objectForKeyedSubscript:?];
      }

      if (*(v2 + 2061))
      {
        v5 = *off_1E798B188;
        v6 = [OUTLINED_FUNCTION_221() objectForKeyedSubscript:?];
        v7 = *off_1E798B6A8;
        v8 = [OUTLINED_FUNCTION_347() objectForKeyedSubscript:?];
        if (v6 && v8)
        {
          OUTLINED_FUNCTION_203();
          [OUTLINED_FUNCTION_237() floatValue];
          *(v2 + 2064) = OUTLINED_FUNCTION_17_35(v9);
          v10 = *(v2 + 2068);
          [OUTLINED_FUNCTION_237() floatValue];
          if (v10 <= v11)
          {
            [OUTLINED_FUNCTION_237() floatValue];
          }

          else
          {
            v12 = *(v2 + 2068);
          }

          *(v2 + 2068) = v12;
          v37 = *(v2 + 2072);
          [OUTLINED_FUNCTION_237() floatValue];
          if (v37 >= v38)
          {
            [OUTLINED_FUNCTION_237() floatValue];
          }

          else
          {
            v39 = *(v2 + 2072);
          }

          *(v2 + 2072) = v39;
          OUTLINED_FUNCTION_203();
          [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2076) = OUTLINED_FUNCTION_17_35(v40);
          v41 = *(v2 + 2080);
          [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          if (v41 <= v42)
          {
            [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v43 = *(v2 + 2080);
          }

          *(v2 + 2080) = v43;
          v44 = *(v2 + 2084);
          [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          if (v44 >= v45)
          {
            [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v46 = *(v2 + 2084);
          }

          *(v2 + 2084) = v46;
        }

        [OUTLINED_FUNCTION_39() objectForKeyedSubscript:?];
        v47 = [OUTLINED_FUNCTION_25_0() objectForKeyedSubscript:v7];
        if (v5 && v47)
        {
          OUTLINED_FUNCTION_203();
          [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2088) = OUTLINED_FUNCTION_17_35(v48);
          v49 = *(v2 + 2092);
          [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          if (v49 <= v50)
          {
            [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v51 = *(v2 + 2092);
          }

          *(v2 + 2092) = v51;
          v52 = *(v2 + 2096);
          [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          if (v52 >= v53)
          {
            [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v54 = *(v2 + 2096);
          }

          *(v2 + 2096) = v54;
          OUTLINED_FUNCTION_203();
          [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2100) = OUTLINED_FUNCTION_17_35(v55);
          v56 = *(v2 + 2104);
          [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          if (v56 <= v57)
          {
            [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v58 = *(v2 + 2104);
          }

          *(v2 + 2104) = v58;
          v59 = *(v2 + 2108);
          [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          if (v59 >= v60)
          {
            [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v61 = *(v2 + 2108);
          }

          *(v2 + 2108) = v61;
        }

        if ([v4 objectForKeyedSubscript:*off_1E798B230])
        {
          *&v62 = OUTLINED_FUNCTION_203();
          [objc_msgSend(v63 objectForKeyedSubscript:{*off_1E798AD18, v62), "floatValue"}];
          *(v2 + 2112) = OUTLINED_FUNCTION_17_35(v64);
          v65 = *(v2 + 2116);
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          if (v65 <= v66)
          {
            [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v67 = *(v2 + 2116);
          }

          *(v2 + 2116) = v67;
          v68 = *(v2 + 2120);
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          if (v68 >= v69)
          {
            [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v70 = *(v2 + 2120);
          }

          *(v2 + 2120) = v70;
          OUTLINED_FUNCTION_203();
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2124) = OUTLINED_FUNCTION_17_35(v71);
          v72 = *(v2 + 2128);
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          if (v72 <= v73)
          {
            [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v74 = *(v2 + 2128);
          }

          *(v2 + 2128) = v74;
          v75 = *(v2 + 2132);
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          if (v75 >= v76)
          {
            [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          }

          else
          {
            v77 = *(v2 + 2132);
          }

          *(v2 + 2132) = v77;
        }

        ++*(v2 + 2136);
      }

      else
      {
        *(v2 + 2061) = 1;
        *(v2 + 2136) = 1;
        *(v2 + 2064) = 0u;
        *(v2 + 2080) = 0u;
        *(v2 + 2096) = 0u;
        *(v2 + 2112) = 0u;
        *(v2 + 2128) = 0;
        v13 = *off_1E798B188;
        v14 = [OUTLINED_FUNCTION_221() objectForKeyedSubscript:?];
        v15 = *off_1E798B6A8;
        v16 = [OUTLINED_FUNCTION_347() objectForKeyedSubscript:?];
        if (v14 && v16)
        {
          [OUTLINED_FUNCTION_237() floatValue];
          *(v2 + 2064) = v17;
          [OUTLINED_FUNCTION_237() floatValue];
          *(v2 + 2068) = v18;
          [OUTLINED_FUNCTION_237() floatValue];
          *(v2 + 2072) = v19;
          [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2076) = v20;
          [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2080) = v21;
          [objc_msgSend(OUTLINED_FUNCTION_132_5() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2084) = v22;
        }

        [OUTLINED_FUNCTION_39() objectForKeyedSubscript:?];
        v23 = [OUTLINED_FUNCTION_25_0() objectForKeyedSubscript:v15];
        if (v13 && v23)
        {
          [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2088) = v24;
          [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2092) = v25;
          [objc_msgSend(OUTLINED_FUNCTION_86() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2096) = v26;
          [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2100) = v27;
          [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2104) = v28;
          [objc_msgSend(OUTLINED_FUNCTION_39() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2108) = v29;
        }

        v30 = [v4 objectForKeyedSubscript:*off_1E798B230];
        if (v30)
        {
          [objc_msgSend(v30 objectForKeyedSubscript:{*off_1E798AD18), "floatValue"}];
          *(v2 + 2112) = v31;
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2116) = v32;
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2120) = v33;
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2124) = v34;
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2128) = v35;
          [objc_msgSend(OUTLINED_FUNCTION_40() "objectForKeyedSubscript:"floatValue"")];
          *(v2 + 2132) = v36;
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_2_9();
      FigDebugAssert3();
    }
  }

  OUTLINED_FUNCTION_353();
}

- (uint64_t)_checkCriticalFocusError:(uint64_t)result
{
  if (result)
  {
    v2 = result;
    v3 = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
    if (v3)
    {
      v4 = v3;
      v5 = [v3 objectForKeyedSubscript:*off_1E798B540];
      result = [*(v2 + 3512) containsObject:v5];
      if (result)
      {
        result = [objc_msgSend(v4 objectForKeyedSubscript:{*off_1E798B200), "BOOLValue"}];
        if (result)
        {
          v6 = *(v2 + 3520);
          if (!v6)
          {
            v6 = objc_alloc_init(MEMORY[0x1E695DFA8]);
            *(v2 + 3520) = v6;
          }

          [v6 addObject:v5];
          v7 = *(v2 + 3512);

          return [v7 removeObject:v5];
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_0_3();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (void)_checkDegradedAutoFocus:(uint64_t)focus
{
  if (focus)
  {
    v3 = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
    if (v3)
    {
      v4 = v3;
      v5 = [v3 objectForKeyedSubscript:*off_1E798B540];
      v6 = [objc_msgSend(v4 objectForKeyedSubscript:{*off_1E798B180), "objectForKeyedSubscript:", *off_1E798AA90}];
      if (!v6)
      {
        goto LABEL_8;
      }

      v7 = v6;
      if ([v6 intValue])
      {
        if (!*(focus + 3536))
        {
          *(focus + 3536) = objc_alloc_init(MEMORY[0x1E695DF90]);
        }

        [v7 intValue];
        [*(focus + 3536) setObject:objc_msgSend(OUTLINED_FUNCTION_7() forKeyedSubscript:{"numberWithInt:"), v5}];
        [*(focus + 3528) removeObject:v5];
        if (![*(focus + 3528) count])
        {
LABEL_8:

          *(focus + 3528) = 0;
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_0_3();
      FigDebugAssert3();
    }
  }
}

- (uint64_t)_checkSphereJitterDetection:(uint64_t)result
{
  if (result)
  {
    v2 = result;
    v3 = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
    if (v3)
    {
      v4 = v3;
      result = [v3 objectForKeyedSubscript:*off_1E798B6A8];
      if (result)
      {
        v5 = result;
        v6 = [v4 objectForKeyedSubscript:*off_1E798B540];
        v7 = [objc_msgSend(v5 objectForKeyedSubscript:{*off_1E798C448), "intValue"}];
        if (v7)
        {
          [*(v2 + 3560) setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", objc_msgSend(objc_msgSend(*(v2 + 3560), "objectForKeyedSubscript:", v6), "intValue") + v7), v6}];
        }

        result = [objc_msgSend(v5 objectForKeyedSubscript:{*off_1E798C468), "intValue"}];
        if (result)
        {
          v8 = [MEMORY[0x1E696AD98] numberWithInt:{objc_msgSend(objc_msgSend(*(v2 + 3568), "objectForKeyedSubscript:", v6), "intValue") + result}];
          v9 = *(v2 + 3568);

          return [v9 setObject:v8 forKeyedSubscript:v6];
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_0_3();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (id)_collectAPSMacroInstabilityStatistics:(id *)result
{
  if (result)
  {
    v2 = result;
    v3 = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
    if (v3)
    {
      v4 = v3;
      result = [v3 objectForKeyedSubscript:*off_1E798B180];
      if (result)
      {
        v5 = result;
        v6 = [v4 objectForKeyedSubscript:*off_1E798B540];
        v7 = [v5 objectForKeyedSubscript:*off_1E798AAB0];
        if (v7)
        {
          v8 = v7;
          [v7 floatValue];
          v10 = v9;
          [objc_msgSend(v2[443] objectForKeyedSubscript:{v6), "floatValue"}];
          if (v10 > v11)
          {
            v12 = MEMORY[0x1E696AD98];
            [v8 floatValue];
            [v2[443] setObject:objc_msgSend(v12 forKeyedSubscript:{"numberWithFloat:"), v6}];
          }
        }

        result = [v5 objectForKeyedSubscript:*off_1E798AAB8];
        if (result)
        {
          v13 = result;
          [result floatValue];
          v15 = v14;
          result = [objc_msgSend(v2[444] objectForKeyedSubscript:{v6), "floatValue"}];
          if (v15 > v16)
          {
            v17 = MEMORY[0x1E696AD98];
            [v13 floatValue];
            v18 = [v17 numberWithFloat:?];
            v19 = v2[444];

            return [v19 setObject:v18 forKeyedSubscript:v6];
          }
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_0_3();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (uint64_t)_collectSensorTemperatureStatistics:(uint64_t)result
{
  if (result)
  {
    v2 = result;
    v3 = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
    if (v3)
    {
      v4 = v3;
      result = [v3 objectForKeyedSubscript:*off_1E798B678];
      if (result)
      {
        v5 = result;
        v6 = [v4 objectForKeyedSubscript:*off_1E798B540];
        if (![*(v2 + 3752) objectForKeyedSubscript:v6])
        {
          [*(v2 + 3752) setObject:objc_alloc_init(BWStats) forKeyedSubscript:v6];
        }

        v7 = [*(v2 + 3752) objectForKeyedSubscript:v6];
        [v5 floatValue];
        v9 = v8;

        return [v7 addDataPoint:v9];
      }
    }

    else
    {
      OUTLINED_FUNCTION_0_3();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (CMTime)_updateMLVNRActiveTime:(CMTime *)result
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    v4 = OUTLINED_FUNCTION_7_24(v3, *off_1E798A3C8);
    if (!v4)
    {
      OUTLINED_FUNCTION_2_9();
      return FigDebugAssert3();
    }

    v5 = v4;
    memset(&v33, 0, sizeof(v33));
    CMSampleBufferGetPresentationTimeStamp(&v33, v2);
    result = [objc_msgSend(v5 objectForKeyedSubscript:{*off_1E798B4C0), "BOOLValue"}];
    v6 = *(v1 + 412);
    if (result)
    {
      if ((v6 & 1) == 0)
      {
        *(v1 + 400) = v33;
      }

      if ((*(v1 + 460) & 1) == 0)
      {
        *(v1 + 448) = *&v33.value;
        epoch = v33.epoch;
LABEL_12:
        *(v1 + 464) = epoch;
      }
    }

    else
    {
      v8 = MEMORY[0x1E6960C70];
      if (v6)
      {
        OUTLINED_FUNCTION_199();
        OUTLINED_FUNCTION_359(*(v1 + 416), v9, v12, v15, v18, v19, v22, *(v1 + 400), *(v1 + 408), v25, v28, v31);
        result = OUTLINED_FUNCTION_186(*(v1 + 440), v10, v13, v16, v20, v23, *(v1 + 424), *(v1 + 432), v26, v29, v31);
        *(v1 + 424) = v31;
        *(v1 + 440) = v32;
        *(v1 + 400) = *v8;
        *(v1 + 416) = *(v8 + 16);
      }

      if (*(v1 + 460))
      {
        OUTLINED_FUNCTION_199();
        OUTLINED_FUNCTION_359(*(v1 + 464), v9, v12, v15, v18, v19, v22, *(v1 + 448), *(v1 + 456), v25, v28, v31);
        result = OUTLINED_FUNCTION_186(*(v1 + 488), v11, v14, v17, v21, v24, *(v1 + 472), *(v1 + 480), v27, v30, v31);
        *(v1 + 472) = v31;
        *(v1 + 488) = v32;
        *(v1 + 448) = *v8;
        epoch = *(v8 + 16);
        goto LABEL_12;
      }
    }
  }

  return result;
}

- (void)_serviceRetryStillImageCaptureUsingFrameStatisticsByPortType:(uint64_t)type
{
  if (type)
  {
    OUTLINED_FUNCTION_54();
    os_unfair_lock_lock(v2 + 678);
    v3 = *(v1 + 2752);
    masterPortType = [*(v1 + 2720) masterPortType];
    [*(v1 + 2720) captureType];
    [*(v1 + 2720) captureFlags];
    os_unfair_lock_unlock((v1 + 2712));
    if (v3 == 1)
    {
      OUTLINED_FUNCTION_3_19();
      [BWFigVideoCaptureDevice _stillImageCaptureInProgressSubstateForFrameStatisticsByPortType:masterPortType:captureType:captureFlags:];
      if (v5)
      {
        if (v5 == 1)
        {
          os_unfair_lock_lock((v1 + 2712));
          *(v1 + 2752) = 0;
          os_unfair_lock_unlock((v1 + 2712));
          OUTLINED_FUNCTION_7_1();
          v8 = 3221225472;
          v9 = __88__BWFigVideoCaptureDevice__serviceRetryStillImageCaptureUsingFrameStatisticsByPortType___block_invoke;
          v10 = &unk_1E798F870;
          v11 = v1;
          dispatch_async(v6, block);
        }

        else
        {
          ++*(v1 + 2704);
          if (v5 == 5)
          {
            ++*(v1 + 2812);
          }
        }
      }
    }
  }
}

- (void)_addSystemPressureAttachments:(uint64_t)attachments
{
  if (attachments)
  {
    os_unfair_lock_lock((attachments + 4072));
    v2 = *(attachments + 4076);
    v3 = *(attachments + 4080);
    v4 = *(attachments + 4092);
    if (*(attachments + 4097))
    {
      if (*(attachments + 4100) > 0)
      {
        v5 = 2;
      }

      else
      {
        v5 = 3;
      }

      os_unfair_lock_unlock((attachments + 4072));
      [MEMORY[0x1E696AD98] numberWithInt:v5];
      v6 = OUTLINED_FUNCTION_17();
      CMSetAttachment(v6, @"OverCaptureSlaveStreamStatus", v7, 1u);
    }

    else
    {
      os_unfair_lock_unlock((attachments + 4072));
    }

    v8 = *off_1E798D4E0;
    [MEMORY[0x1E696AD98] numberWithInt:v2];
    v9 = OUTLINED_FUNCTION_17();
    CMSetAttachment(v9, v8, v10, 1u);
    v11 = *off_1E798D4E8;
    [MEMORY[0x1E696AD98] numberWithUnsignedInt:v4];
    v12 = OUTLINED_FUNCTION_17();
    CMSetAttachment(v12, v11, v13, 1u);
    [MEMORY[0x1E696AD98] numberWithInt:v3];
    v14 = OUTLINED_FUNCTION_35_19();

    CMSetAttachment(v14, v15, v16, v17);
  }
}

- (os_unfair_lock_s)_addStereoVideoCaptureSceneMonitoringMetadataToSampleBuffer:(os_unfair_lock_s *)result
{
  if (result)
  {
    if (a2)
    {
      v2 = result;
      os_unfair_lock_lock(result + 411);
      os_unfair_lock_opaque = v2[410]._os_unfair_lock_opaque;
      os_unfair_lock_unlock(v2 + 411);
      v4 = OUTLINED_FUNCTION_4_3();
      v7 = CMGetAttachment(v4, v5, v6);
      v8 = [MEMORY[0x1E696AD98] numberWithInt:os_unfair_lock_opaque];

      return [v7 setObject:v8 forKeyedSubscript:0x1F21A9D70];
    }

    else
    {
      OUTLINED_FUNCTION_0();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (void)_addStationaryFlagToMetadata:(void *)result
{
  if (result)
  {
    v2 = result;
    result = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
    if (result)
    {
      v3 = result;
      result = v2[412];
      if (result)
      {
        v4 = [MEMORY[0x1E696AD98] numberWithBool:{objc_msgSend(result, "isStationary")}];
        v5 = *off_1E798A938;

        return [v3 setObject:v4 forKeyedSubscript:v5];
      }
    }
  }

  return result;
}

- (uint64_t)_addDropFrameWaitingForTorchToRampUpKey:(uint64_t)result
{
  if (result)
  {
    if (a2)
    {
      v3 = result;
      FigSimpleMutexLock();
      if ((*(v3 + 2620) & 1) != 0 || (CMSampleBufferGetPresentationTimeStamp(&time1, a2), OUTLINED_FUNCTION_37_7(), CMTimeCompare(&time1, &time2) < 0))
      {
        CMSetAttachment(a2, @"DropFrameWaitingForTorchToRampUp", MEMORY[0x1E695E118], 1u);
      }

      else
      {
        v4 = MEMORY[0x1E6960C70];
        *(v3 + 2596) = *MEMORY[0x1E6960C70];
        *(v3 + 2612) = *(v4 + 16);
      }

      return FigSimpleMutexUnlock();
    }

    else
    {
      OUTLINED_FUNCTION_0();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (void)captureStream:(id)stream didDropVideoSampleBufferWithPTS:(id *)s
{
  if (self->_ubCaptureParametersByPortType)
  {
    if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
    {
      captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
    }

    else
    {
      captureStream = self->_captureStream;
    }

    if (captureStream == stream)
    {
      ubCaptureParametersByPortType = self->_ubCaptureParametersByPortType;
      portType = [stream portType];
      v10 = *&s->var0;
      var3 = s->var3;
      [(NSDictionary *)ubCaptureParametersByPortType addDroppedFrameForPortType:portType pts:&v10];
    }
  }
}

- (void)_addCoreMediaMetadataAttachmentsToStillImageSampleBuffer:(char)buffer fromTimeMachine:
{
  if (self)
  {
    OUTLINED_FUNCTION_80();
    if (*(v6 + 2242) == 1)
    {
      v7 = BWStillImageCaptureFrameFlagsForSampleBuffer(v3);
      if (v7 >> 62)
      {
        if ((v7 & 0x3000000000000000) == 0)
        {
          ImageBuffer = CMSampleBufferGetImageBuffer(v3);
          PixelFormatType = CVPixelBufferGetPixelFormatType(ImageBuffer);
          if (FigCapturePixelFormatIsVersatileRaw(PixelFormatType))
          {
            BWCleanupRawStillImageSampleBuffer(v3);
          }
        }
      }
    }

    v10 = OUTLINED_FUNCTION_44();
    [(BWFigVideoCaptureDevice *)v10 _addStillImageSettingsToStillImageSampleBuffer:v11];
    v12 = OUTLINED_FUNCTION_44();
    [(BWFigVideoCaptureDevice *)v12 _addPreviewWhiteBalanceMetadataToStillImageSampleBuffer:v13];
    v14 = OUTLINED_FUNCTION_44();
    [(BWFigVideoCaptureDevice *)v14 _addADRCExposureRealizedGainToStillImageSampleBuffer:v15];
    [MEMORY[0x1E696AD98] numberWithInt:*(v4 + 588)];
    v16 = OUTLINED_FUNCTION_17();
    CMSetAttachment(v16, @"CaptureDeviceType", v17, 1u);
    v18 = OUTLINED_FUNCTION_44();
    [(BWFigVideoCaptureDevice *)v18 _addAutofocusAndDiagnosticMetadata:v19];
    if (*(v4 + 3296) && [*(v4 + 600) sphereEnabled] && (buffer & 1) == 0)
    {
      [*(v4 + 3296) processSampleBuffer:v3];
    }

    if (*(v4 + 1608) == 1)
    {
      v99 = OUTLINED_FUNCTION_44();
      [(BWFigVideoCaptureDevice *)v99 _addPortraitSceneMonitoringMetadataToSampleBuffer:v100];
    }

    if (*(v4 + 218) == 1 && *(v4 + 1625) == 1 && *(v4 + 1632))
    {
      v101 = OUTLINED_FUNCTION_44();
      [(BWFigVideoCaptureDevice *)v101 _addStereoVideoCaptureSceneMonitoringMetadataToSampleBuffer:v102];
    }

    if (*(v4 + 3352))
    {
      v20 = OUTLINED_FUNCTION_4_3();
      v23 = CMGetAttachment(v20, v21, v22);
      memset(&v121, 0, sizeof(v121));
      CMTimeMakeFromDictionary(&v121, [v23 objectForKeyedSubscript:*off_1E798A420]);
      [*(v4 + 3352) referencedObject];
      v32 = OUTLINED_FUNCTION_19_33(v24, v25, v26, v27, v28, v29, v30, v31, v103, v109, v115, *&v121.value);
      if ([v33 getMetadataDictionaryForPts:v32])
      {
        [OUTLINED_FUNCTION_8() addEntriesFromDictionary:?];
      }

      if (([*(v4 + 2720) captureFlags] & 4) == 0)
      {
        [*(v4 + 3352) referencedObject];
        v42 = OUTLINED_FUNCTION_19_33(v34, v35, v36, v37, v38, v39, v40, v41, v104, v110, v116, *&v121.value);
        [v43 copyAttachedMediaSampleBufferForPts:v42 attachedMediaKey:?];
        v44 = OUTLINED_FUNCTION_45_12();
        BWSampleBufferSetAttachedMedia(v44, v45, v46);
        if (v23)
        {
          CFRelease(v23);
        }

        [*(v4 + 3352) referencedObject];
        v55 = OUTLINED_FUNCTION_19_33(v47, v48, v49, v50, v51, v52, v53, v54, v105, v111, v117, *&v121.value);
        [v56 copyAttachedMediaSampleBufferForPts:v55 attachedMediaKey:?];
        v57 = OUTLINED_FUNCTION_45_12();
        BWSampleBufferSetAttachedMedia(v57, v58, v59);
        if (v23)
        {
          CFRelease(v23);
        }

        [*(v4 + 3352) referencedObject];
        v68 = OUTLINED_FUNCTION_19_33(v60, v61, v62, v63, v64, v65, v66, v67, v106, v112, v118, *&v121.value);
        [v69 copyAttachedMediaSampleBufferForPts:v68 attachedMediaKey:?];
        v70 = OUTLINED_FUNCTION_45_12();
        BWSampleBufferSetAttachedMedia(v70, v71, v72);
        if (v23)
        {
          CFRelease(v23);
        }

        [*(v4 + 3352) referencedObject];
        v81 = OUTLINED_FUNCTION_19_33(v73, v74, v75, v76, v77, v78, v79, v80, v107, v113, v119, *&v121.value);
        [v82 copyAttachedMediaSampleBufferForPts:v81 attachedMediaKey:?];
        v83 = OUTLINED_FUNCTION_45_12();
        BWSampleBufferSetAttachedMedia(v83, v84, v85);
        if (v23)
        {
          CFRelease(v23);
        }

        [*(v4 + 3352) referencedObject];
        v94 = OUTLINED_FUNCTION_19_33(v86, v87, v88, v89, v90, v91, v92, v93, v108, v114, v120, *&v121.value);
        v96 = [v95 copyAttachedMediaSampleBufferForPts:v94 attachedMediaKey:?];
        v97 = OUTLINED_FUNCTION_70();
        BWSampleBufferSetAttachedMedia(v97, v98, v96);
        if (v96)
        {
          CFRelease(v96);
        }
      }
    }
  }
}

- (_DWORD)_collectPearlTemperatureStatistics:(_DWORD *)result
{
  if (result)
  {
    v2 = result;
    v3 = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
    if (v3)
    {
      v4 = v3;
      OUTLINED_FUNCTION_52_16();
      if (v5)
      {
        v6 = [v4 objectForKeyedSubscript:*off_1E798B6E8];
        if (v6)
        {
          [v6 floatValue];
          v2[920] = v7;
        }
      }

      v8 = [v4 objectForKeyedSubscript:*off_1E798B6E0];
      if (v8)
      {
        v9 = v8;
        OUTLINED_FUNCTION_52_16();
        if (v5)
        {
          [v9 floatValue];
          v2[921] = v10;
        }

        [v9 floatValue];
        v2[922] = v11;
        v12 = *(v2 + 462);
        [v9 floatValue];
        [v12 addDataPoint:v13];
      }

      result = [v4 objectForKeyedSubscript:*off_1E798B678];
      if (result)
      {
        v14 = *(v2 + 463);
        [result floatValue];
        v16 = v15;

        return [v14 addDataPoint:v16];
      }
    }

    else
    {
      OUTLINED_FUNCTION_2_9();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (CMTime)_collectPearlProjectorUpTime:(int)time isStillImage:
{
  if (result)
  {
    OUTLINED_FUNCTION_166();
    v6 = CMGetAttachment(v4, *off_1E798A3C8, 0);
    if (v6)
    {
      result = [objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B3F8), "intValue"}];
      if (result == 2)
      {
        memset(&v10, 0, sizeof(v10));
        result = CMSampleBufferGetPresentationTimeStamp(&v10, v4);
        if ((*(v3 + 3740) & 1) == 0 || (time1 = v10, OUTLINED_FUNCTION_37_7(), result = CMTimeCompare(&time1, &time2), result >= 1))
        {
          *(v3 + 3728) = v10;
          v7 = 3712;
          if (time)
          {
            v7 = 3720;
          }

          *(v3 + v7) += 2940;
        }
      }
    }

    else
    {
      OUTLINED_FUNCTION_0();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (void)captureStream:(id)stream willEmitDepthSampleBuffer:(opaqueCMSampleBuffer *)buffer
{
  v5 = CMGetAttachment(buffer, *off_1E798A3C8, 0);
  v6 = [v5 objectForKeyedSubscript:*off_1E798B6E0];
  if (v6)
  {
    [(BWFigVideoCaptureDevice *)self _postNotificationWithPayload:@"PearlProjectorTemperatureChanged" notificationPayload:OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v7, @"NewPropertyValue", v6)];
  }

  if ([objc_msgSend(v5 objectForKeyedSubscript:{*off_1E798B540), "isEqualToString:", *off_1E798A0E8}])
  {
    v8 = OUTLINED_FUNCTION_44();
    [(BWFigVideoCaptureDevice *)v8 _collectPearlTemperatureStatistics:v9];
    v10 = OUTLINED_FUNCTION_44();
    [(BWFigVideoCaptureDevice *)v10 _collectPearlProjectorUpTime:v11 isStillImage:0];
  }

  v12 = OUTLINED_FUNCTION_44();
  [BWFigVideoCaptureDevice _addSystemPressureAttachments:v12];
}

- (uint64_t)_ubUpdateCurrentAdaptiveBracketedCaptureParamsForCaptureStreamSettings:(void *)settings frameStatistics:(int *)statistics timeMachineFrameSelection:
{
  if (result)
  {
    v7 = result;
    if (!_FigIsNotCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_2_9();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    if ([a2 captureType] == 11)
    {
      v8 = [objc_msgSend(a2 "adaptiveBracketingParameters")];
      result = [v8 count];
      if (result)
      {
        v71 = v8;
        v9 = 0x1E695D000uLL;
        array = [MEMORY[0x1E695DF70] array];
        v74 = 0;
        v75[0] = 0;
        v10 = -[BWFigVideoCaptureDevice _ubEnabledOutputsForCaptureFlags:captureType:baseCaptureFrameFlagsOut:discardCaptureFrameFlagsOut:](v7, [a2 captureFlags], objc_msgSend(a2, "captureType"), v75, &v74);
        v72 = v10;
        if (v10)
        {
          v11 = ([v10 intValue] >> 1) & 1;
        }

        else
        {
          v11 = 1;
        }

        v56 = v11;
        adaptiveBracketingGroupCaptureCount = [a2 adaptiveBracketingGroupCaptureCount];
        v54 = [objc_msgSend(a2 "adaptiveBracketingParameters")];
        captureFlags = [a2 captureFlags];
        v13 = captureFlags;
        if ((captureFlags & 0x800000) != 0)
        {
          v14 = 1;
        }

        else if ((captureFlags & 0x20000000) != 0)
        {
          v14 = 2;
        }

        else if ((captureFlags & 0x40000000) != 0)
        {
          v14 = 3;
        }

        else
        {
          v14 = 0;
        }

        if ((captureFlags & 0x100) != 0)
        {
          v15 = v14;
        }

        else
        {
          v15 = 0;
        }

        v65 = v15;
        v61 = v15 != 0;
        v16 = *(v7 + 1392);
        if (!v16)
        {
          v16 = *(v7 + 600);
        }

        [settings gain];
        v18 = v17;
        captureFlags2 = [a2 captureFlags];
        v63 = v16;
        LODWORD(v20) = v18;
        v67 = [v16 noiseReductionAndSharpeningConfigurationForType:1 gain:(captureFlags2 >> 4) & 1 qSub:v20];
        v21 = off_1E798C608;
        v69 = v13;
        v55 = a2;
        v53 = v14;
        if (statistics)
        {
          LODWORD(v22) = statistics[9];
          array2 = [MEMORY[0x1E695DF70] array];
          if (statistics[7] >= 1)
          {
            v23 = statistics[8];
            v24 = statistics[9];
            v25 = statistics[6];
            v26 = *off_1E798C698;
            v27 = *off_1E798C608;
            v28 = v25 - v23;
            do
            {
              v29 = v28 >= v24 || v23 > v25;
              v30 = &v74;
              if (!v29)
              {
                v30 = v75;
              }

              v31 = *v30;
              v32 = *v30 | 2;
              if (!adaptiveBracketingGroupCaptureCount && ([v55 referenceFrameIndex] & 0x80000000) == 0 && v25 == statistics[10])
              {
                v32 = v31 | 0x12;
              }

              dictionary = [MEMORY[0x1E695DF90] dictionary];
              [MEMORY[0x1E696AD98] numberWithInt:v25];
              [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
              [dictionary setObject:&unk_1F22469D8 forKeyedSubscript:v26];
              [dictionary setObject:v72 forKeyedSubscript:v27];
              [array2 addObject:dictionary];
              [array addObject:{+[BWStillImageCaptureTimeMachineFrameInfo infoWithTimeMachineIndex:mainFlags:sifrFlags:](BWStillImageCaptureTimeMachineFrameInfo, "infoWithTimeMachineIndex:mainFlags:sifrFlags:", v25++, v32, 0)}];
              ++v28;
            }

            while (v25 < statistics[7] + statistics[6]);
            v8 = v71;
            v21 = off_1E798C608;
            v9 = 0x1E695D000;
          }
        }

        else
        {
          array2 = 0;
          LODWORD(v22) = 0;
        }

        dictionary2 = [MEMORY[0x1E695DF90] dictionary];
        array3 = [*(v9 + 3952) array];
        v34 = 0x1E696A000uLL;
        if ([v8 count] != v22)
        {
          [dictionary2 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", adaptiveBracketingGroupCaptureCount != 0), *off_1E798C600}];
          if (!((adaptiveBracketingGroupCaptureCount != 0) | v56 & 1) || ([dictionary2 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C630], objc_msgSend(dictionary2, "setObject:forKeyedSubscript:", objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v65), *off_1E798C690), v34 = 0x1E696A000uLL, objc_msgSend(dictionary2, "setObject:forKeyedSubscript:", objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", *&v61 & (v69 >> 25)), *off_1E798C668), objc_msgSend(dictionary2, "setObject:forKeyedSubscript:", objc_msgSend(MEMORY[0x1E696AD98], "numberWithBool:", (v69 >> 15) & 1), *off_1E798C5F8), objc_msgSend(dictionary2, "setObject:forKeyedSubscript:", v67, *off_1E798C658), !adaptiveBracketingGroupCaptureCount))
          {
            [dictionary2 setObject:v72 forKeyedSubscript:*v21];
            [array addObject:{OUTLINED_FUNCTION_375(BWStillImageCaptureBracketFrameInfo, v35, v36, v75[0] | 0x20)}];
          }

          v68 = [v55 adaptiveBracketingSphereOffsetsForNextGroupWithFrameCount:{objc_msgSend(v8, "count")}];
          if ([v63 hasSphere])
          {
            v37 = ![v63 isStationary] || objc_msgSend(v68, "count") != 0;
            v66 = v37;
          }

          else
          {
            v66 = 0;
          }

          [objc_msgSend(v55 "adaptiveBracketingParameters")];
          v52 = v56 ? [v63 noiseReductionAndSharpeningConfigurationForType:17 gain:?] : 0;
          v22 = v22;
          if (([v55 captureFlags] & 0x100000000) != 0)
          {
            [v63 portType];
            v38 = [objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:"intValue"")];
          }

          else
          {
            v38 = 0xFFFFFFFFLL;
          }

          v64 = v75[0];
          if ([v8 count] > v22)
          {
            v62 = *off_1E798C698;
            v60 = *off_1E798C918;
            v59 = *off_1E798C650;
            v39 = *v21;
            v51 = *off_1E798C640;
            v50 = *off_1E798C658;
            v48 = *off_1E798C6A0;
            v40 = 1;
            do
            {
              v41 = v34;
              v42 = [OUTLINED_FUNCTION_9_0() objectAtIndexedSubscript:?];
              dictionary3 = [MEMORY[0x1E695DF90] dictionary];
              [dictionary3 setObject:&unk_1F22469D8 forKeyedSubscript:v62];
              [dictionary3 setObject:&unk_1F22469C0 forKeyedSubscript:v60];
              [OUTLINED_FUNCTION_85_0() setObject:? forKeyedSubscript:?];
              [*(v41 + 3480) numberWithInt:{objc_msgSend(v42, "integrationTimeInMicroseconds")}];
              [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
              v44 = *(v41 + 3480);
              [v42 gain];
              [v44 numberWithFloat:?];
              [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
              maxAGC = [v42 maxAGC];
              if (maxAGC < 1)
              {
                v46 = 0;
              }

              else
              {
                v46 = [*(v41 + 3480) numberWithInt:maxAGC];
              }

              v34 = v41;
              [dictionary3 setObject:v46 forKeyedSubscript:v59];
              [*(v41 + 3480) numberWithInt:v66];
              [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
              [v68 objectAtIndexedSubscript:v22];
              [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
              [dictionary3 setObject:v72 forKeyedSubscript:v39];
              if ((v38 & 0x80000000) != 0)
              {
                if (!v56)
                {
                  goto LABEL_67;
                }

                [*(v41 + 3480) numberWithBool:(v69 >> 25) & 1];
                [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
                [*(v41 + 3480) numberWithInt:v53];
                [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
                [OUTLINED_FUNCTION_85_0() setObject:? forKeyedSubscript:?];
                [dictionary3 setObject:&unk_1F22469F0 forKeyedSubscript:v51];
                [dictionary3 setObject:v52 forKeyedSubscript:v50];
                if (v54)
                {
                  [dictionary3 setObject:&unk_1F22469F0 forKeyedSubscript:v48];
                  if (!v22 && !adaptiveBracketingGroupCaptureCount)
                  {
                    [OUTLINED_FUNCTION_85_0() setObject:? forKeyedSubscript:?];
                  }
                }

                if ((v69 & 0x8000) == 0)
                {
                  goto LABEL_67;
                }

                v47 = OUTLINED_FUNCTION_85_0();
              }

              else
              {
                [*(v41 + 3480) numberWithInt:v38];
                v47 = OUTLINED_FUNCTION_8();
              }

              [v47 setObject:? forKeyedSubscript:?];
LABEL_67:
              if ((v69 & 0x80000000000) != 0)
              {
                [OUTLINED_FUNCTION_85_0() setObject:? forKeyedSubscript:?];
              }

              [array3 addObject:dictionary3];
              [array addObject:{+[BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:mainFlags:sifrFlags:](BWStillImageCaptureBracketFrameInfo, "infoWithBracketedCaptureSequenceNumber:mainFlags:sifrFlags:", v40, v64 | 0x40, 0)}];
              ++v22;
              v8 = v71;
              v40 = (v40 + 1);
            }

            while ([v71 count] > v22);
          }
        }

        [v55 addAdaptiveBracketingFrameParameters:v8 timeMachineBracketedCaptureParams:array2 preBracketFrameCaptureParams:dictionary2 unifiedBracketedCaptureParams:array3 captureFrameInfos:array];
        return 1;
      }
    }

    else
    {
      return 0;
    }
  }

  return result;
}

- (void)_resetStillImageCaptureRequestStateInternal
{
  if (self)
  {
    os_unfair_lock_assert_owner((self + 2712));
    *(self + 2752) = 0;
    *(self + 2748) = 0;

    *(self + 2728) = 0;
    *(self + 2736) = 0;
    *(self + 2744) = 0;

    *(self + 2720) = 0;
    *(self + 2704) = 0;
    *(self + 2812) = 0;
    *(self + 2696) = 0;

    *(self + 3496) = 0;
    *(self + 2224) = 0;
  }
}

- (void)_captureStillImageNowWithSettings:(uint64_t)settings
{
  if (settings)
  {
    OUTLINED_FUNCTION_84();
    v2 = v1;
    v4 = v3;
    if (!_FigIsCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_0();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    captureType = [v2 captureType];
    captureFlags = [v2 captureFlags];
    v70 = 0;
    v71[0] = 0;
    v7 = v2;
    os_unfair_lock_lock((v4 + 2712));
    *(v4 + 2720) = v2;
    os_unfair_lock_unlock((v4 + 2712));
    if (captureType == 1 && [*(v4 + 600) timeMachineEnabled])
    {
      if ([*(v4 + 2720) deliverSushiRaw])
      {
        OUTLINED_FUNCTION_0();
        OUTLINED_FUNCTION_2_5();
        FigDebugAssert3();
        FigCaptureGetFrameworkRadarComponent();
        v69 = 0;
        v68 = 0;
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        v57 = os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
        if (OUTLINED_FUNCTION_5_24(v57))
        {
          OUTLINED_FUNCTION_5_6();
          OUTLINED_FUNCTION_4_4();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_8_1();
        OUTLINED_FUNCTION_13_0();
        v67 = 0;
        OUTLINED_FUNCTION_5_61();
        v58 = _os_log_send_and_compose_impl();
        OUTLINED_FUNCTION_11();
        OUTLINED_FUNCTION_17_26();
        OUTLINED_FUNCTION_10();
        FigCapturePleaseFileRadar(v59, v60, v61, v62, v63, 10826, v64, v65, &v67);
        free(v58);
      }

      if ([v4 isBravoVariant])
      {
        captureStreamSettings = [*(v4 + 2720) captureStreamSettings];
        OUTLINED_FUNCTION_341();
        if ([v50 countByEnumeratingWithState:? objects:? count:?])
        {
          while (1)
          {
            OUTLINED_FUNCTION_49_7();
            if (!v17)
            {
              objc_enumerationMutation(captureStreamSettings);
            }

            [MEMORY[0] portType];
            [-[BWFigVideoCaptureDevice _captureStreamByPortType:](v4) captureStillImageFromTimeMachineWithStillImageSettings:*(v4 + 2720)];
            OUTLINED_FUNCTION_120_0();
            if (v17)
            {
              OUTLINED_FUNCTION_341();
              if (!OUTLINED_FUNCTION_37(v51, v52, v53, v54))
              {
                break;
              }
            }
          }
        }
      }

      else
      {
        [*(v4 + 600) captureStillImageFromTimeMachineWithStillImageSettings:*(v4 + 2720)];
      }

      v31 = 0;
      goto LABEL_93;
    }

    OUTLINED_FUNCTION_346();
    v66 = v8;
    v9 = *(v4 + 656);
    OUTLINED_FUNCTION_13_14();
    v14 = OUTLINED_FUNCTION_1_0(v10, v11, v12, v13);
    if (v14)
    {
      v15 = v14;
      do
      {
        for (i = 0; i != v15; ++i)
        {
          OUTLINED_FUNCTION_142_0();
          if (!v17)
          {
            objc_enumerationMutation(v9);
          }

          v18 = *(v66 + 8 * i);
          [v18 portType];
          if ([OUTLINED_FUNCTION_15() captureStreamSettingsForPortType:?])
          {
            [v18 prepareForStillImageCaptureFromFirmwareWithStillImageSettings:*(v4 + 2720)];
          }
        }

        OUTLINED_FUNCTION_13_14();
        v15 = OUTLINED_FUNCTION_1_0(v19, v20, v21, v22);
      }

      while (v15);
    }

    [v2 masterPortType];
    v23 = [OUTLINED_FUNCTION_7() captureStreamSettingsForPortType:?];
    v24 = v23;
    if ((captureFlags & 0x80) != 0)
    {
      if (*(v4 + 1560))
      {
        v25 = [objc_msgSend(v23 "unifiedBracketedCaptureParams")] == 0;
      }

      else
      {
        v25 = 1;
      }
    }

    else
    {
      v25 = 0;
    }

    if (captureType == 2)
    {
      v26 = (captureFlags & 0x60800000) != 0 || [objc_msgSend(v24 "unifiedBracketedCaptureParams")] != 0;
    }

    else
    {
      v26 = 0;
    }

    v27 = (captureFlags >> 8) & 1;
    if ((captureFlags & 0x8004) != 0)
    {
      if (!*(v4 + 1560))
      {
        LODWORD(v27) = 1;
      }

      if (((v27 | v25) & 1) == 0)
      {
LABEL_30:
        if (*(v4 + 648) && *(v4 + 2652) >= 3)
        {
          if (captureType == 7)
          {
            v28 = 0;
          }

          else
          {
            v28 = [objc_msgSend(v2 "masterPortType")];
          }

          v35 = [objc_msgSend(v2 "captureStreamSettings")];
          v37 = (captureFlags & 0x800) == 0 && v35 > 1;
          v38 = *(v4 + 1560);
          v39 = (v38 != 0) & (captureFlags >> 8);
          if (captureType != 2)
          {
            LOBYTE(v39) = 0;
          }

          LOBYTE(v29) = 1;
          if (captureType == 11 || (v39 & 1) != 0)
          {
            goto LABEL_72;
          }

          v29 = 0;
          if (!v38 && captureType != 6)
          {
            v29 = *(v4 + 3888) | v26 | v28 | v37;
          }
        }

        else
        {
          v29 = 0;
        }

        if (((v29 | v26) & 1) == 0)
        {
          v30 = [(BWFigVideoCaptureDevice *)v4 _convertStillImageCaptureSettings:v71 toStillImageCaptureNowOptions:&v70 captureStreamPropertyValues:?];
          LOBYTE(v29) = 0;
LABEL_37:
          v31 = v71[0];
          if (v30)
          {
LABEL_90:
            [BWFigVideoCaptureDevice _terminateCaptureAndEmitStillImageCaptureError:v4 stillImageCaptureNowOptions:v30 stillImageCaptureStreamProperties:?];
            goto LABEL_70;
          }

          *(v4 + 2728) = v71[0];
          *(v4 + 2736) = v70;
          *(v4 + 2744) = v29 & 1;
          if ((captureFlags & 0x200) != 0)
          {
            if (dword_1ED844350)
            {
              v69 = 0;
              v68 = 0;
              v32 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
              os_log_type_enabled(v32, OS_LOG_TYPE_DEFAULT);
              OUTLINED_FUNCTION_286();
              if (v17)
              {
                v34 = v33;
              }

              else
              {
                v34 = 0;
              }

              if (v34)
              {
                OUTLINED_FUNCTION_5();
                OUTLINED_FUNCTION_13();
                _os_log_send_and_compose_impl();
              }

              OUTLINED_FUNCTION_2_4();
              OUTLINED_FUNCTION_371();
            }

            FigCaptureFrameRateFromFloat();
            [objc_msgSend(*(v4 + 2488) "referencedObject")];
          }

          if (captureType == 2 && ([v2 sceneFlags] & 0x10000000) != 0)
          {
            [v2 masterPortType];
            v42 = [objc_msgSend(OUTLINED_FUNCTION_36() "objectForKeyedSubscript:"macroFlashQSubSwitchingEnabled"")];
          }

          else
          {
            v42 = 0;
          }

          v43 = captureFlags & 0x41;
          if ((v42 & 1) != 0 || v43 == 65)
          {
            *(v4 + 3451) = v43 == 65;
            os_unfair_lock_lock((v4 + 1384));
            *(v4 + 2808) = 1;
            os_unfair_lock_unlock((v4 + 1384));
            os_unfair_lock_lock((v4 + 2712));
            *(v4 + 2752) = 1;
            os_unfair_lock_unlock((v4 + 2712));
LABEL_70:

            OUTLINED_FUNCTION_81();
            return;
          }

          if (*(v4 + 2160) == 1)
          {
            v45 = *(v4 + 2164);
            if (v45 >= *(v4 + 2168))
            {
              v45 = *(v4 + 2168);
            }

            *(v4 + 2708) = v45;
            [*(v4 + 2720) frameStatisticsByPortType];
            [*(v4 + 2720) masterPortType];
            OUTLINED_FUNCTION_17();
            [BWFigVideoCaptureDevice _stillImageCaptureInProgressSubstateForFrameStatisticsByPortType:masterPortType:captureType:captureFlags:];
            v47 = v46;
            v48 = v46 > 1;
            os_unfair_lock_lock((v4 + 2712));
            *(v4 + 2752) = v48;
            os_unfair_lock_unlock((v4 + 2712));
            if (v47 > 1)
            {
              goto LABEL_70;
            }
          }

          else
          {
            os_unfair_lock_lock((v4 + 2712));
            *(v4 + 2752) = 0;
            os_unfair_lock_unlock((v4 + 2712));
          }

          [BWFigVideoCaptureDevice _captureStillImageNowOnStreamWithOptions:captureStreamProperties:];
          if (v55)
          {
            v30 = v55;
            goto LABEL_90;
          }

LABEL_93:
          [(BWFigVideoCaptureDevice *)v4 _logStillImageCaptureTimingStatisticsForCoreAnalytics];
          goto LABEL_70;
        }

LABEL_72:
        [BWFigVideoCaptureDevice _ubConvertStillImageCaptureSettings:useSynchronizedStreamsGroup:toStillImageCaptureNowOptions:captureStreamPropertyValues:];
        v30 = v44;
        goto LABEL_37;
      }
    }

    else if (!((captureFlags >> 8) & 1 | v25))
    {
      goto LABEL_30;
    }

    v26 = 1;
    goto LABEL_30;
  }
}

- (void)captureStream:(id)stream didUpdatePreviewShift:(CGPoint)shift
{
  if (self->_allocateResourcesCompatibleWithOverCapture)
  {
    v26 = v9;
    v27 = v8;
    v28 = v5;
    v29 = v4;
    v30 = v6;
    v31 = v7;
    y = shift.y;
    x = shift.x;
    OUTLINED_FUNCTION_176();
    if ([v12 masterCaptureStream] == v5)
    {
      os_unfair_lock_lock((v4 + 1384));
      v13 = *(v4 + 1390);
      os_unfair_lock_unlock((v4 + 1384));
      if ((v13 & 1) == 0)
      {
        [v5 baseZoomFactor];
        v15 = x / v14;
        [v5 baseZoomFactor];
        v17 = y / v16;
        v18 = v15 / *(v4 + 1960);
        v19 = v17 / *(v4 + 1968);
        previewShiftInSensorSpace = [(BWFigVideoCaptureDevice *)v4 previewShiftInSensorSpace];
        if (FigCaptureGetDistanceBetweenPoints(v18, v19, previewShiftInSensorSpace, v21) > 0.001)
        {
          [(BWFigVideoCaptureDevice *)v4 setPreviewShiftInSensorSpace:v18, v19];
          [v4 zoomFactor];
          OUTLINED_FUNCTION_33_0();
          v24[1] = 3221225472;
          v24[2] = __63__BWFigVideoCaptureDevice_captureStream_didUpdatePreviewShift___block_invoke;
          v24[3] = &unk_1E7991CF0;
          v24[4] = v4;
          v25 = v22;
          dispatch_async(v23, v24);
        }
      }
    }
  }
}

- (void)setPreviewShiftInSensorSpace:(double)space
{
  if (self)
  {
    os_unfair_lock_lock((self + 3924));
    *(self + 3928) = a2;
    *(self + 3936) = space;

    os_unfair_lock_unlock((self + 3924));
  }
}

- (uint64_t)_updateAutoFocusRectIfNeededForZoomFactor:(uint64_t)factor
{
  if (!factor)
  {
    return 0;
  }

  OUTLINED_FUNCTION_124_5();
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_0_3();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  v4.origin.x = OUTLINED_FUNCTION_69_5();
  if (CGRectIsEmpty(v4))
  {
    return 0;
  }

  OUTLINED_FUNCTION_69_5();

  return [BWFigVideoCaptureDevice _updateAutoFocusAreaOfInterestWithNormalizedRectInSensorSpace:v1 zoomFactor:?];
}

- (uint64_t)_updateExposureRectIfNeededForZoomFactor:(uint64_t)factor
{
  factorCopy = factor;
  if (factor)
  {
    v15.origin.x = OUTLINED_FUNCTION_344();
    if (CGRectIsEmpty(v15))
    {
      return 0;
    }

    else
    {
      os_unfair_lock_lock((factorCopy + 3924));
      v5 = *(factorCopy + 3928);
      v6 = *(factorCopy + 3936);
      os_unfair_lock_unlock((factorCopy + 3924));
      v7 = OUTLINED_FUNCTION_344();
      v8 = *(factorCopy + 1944);
      *&v8 = a2;
      fvcd_applyZoomAndPreviewShiftToSensorSpaceRect(v7, v9, v10, v11, v8, v5, v6, v12, *(factorCopy + 1944), *(factorCopy + 1952), *(factorCopy + 1960), *(factorCopy + 1968));
      DictionaryRepresentation = CGRectCreateDictionaryRepresentation(v16);
      v14 = kFigImageControlSampleBufferProcessorProperty_SpotMeteredExposureAreaOfInterest;
      if (!*(factorCopy + 1872))
      {
        v14 = kFigImageControlSampleBufferProcessorProperty_AutoExposureAreaOfInterest;
      }

      factorCopy = [(BWFigVideoCaptureDevice *)factorCopy _setAutofocusProcessorProperty:DictionaryRepresentation propertyValue:?];
      if (DictionaryRepresentation)
      {
        CFRelease(DictionaryRepresentation);
      }
    }
  }

  return factorCopy;
}

- (void)_ubHighResolutionNondisruptiveSwitchingFormatIndexForCaptureStream:(int)stream
{
  if (self)
  {
    OUTLINED_FUNCTION_91();
    OUTLINED_FUNCTION_166();
    if ([objc_msgSend(v46 "supportedFormats")])
    {
      [v45 activeFormatIndex];
      [objc_msgSend(OUTLINED_FUNCTION_63_12() "objectAtIndexedSubscript:{"objectForKeyedSubscript:", *off_1E798C998}")];
      OUTLINED_FUNCTION_17_20();
      obja = v47;
      v48 = [v47 countByEnumeratingWithState:? objects:? count:?];
      if (v48)
      {
        v49 = v48;
        v50 = *off_1E798C988;
        v51 = *off_1E798C980;
        while (2)
        {
          for (i = 0; i != v49; ++i)
          {
            OUTLINED_FUNCTION_32_10();
            if (!v53)
            {
              objc_enumerationMutation(obja);
            }

            v54 = *(8 * i);
            [v54 intValue];
            v55 = [OUTLINED_FUNCTION_63_12() objectAtIndexedSubscript:?];
            v56 = [objc_msgSend(v55 objectForKeyedSubscript:{v50), "intValue"}];
            if ((v56 | ([objc_msgSend(v55 objectForKeyedSubscript:{v51), "intValue"}] << 32)) == *(v44 + 148))
            {
              [v54 intValue];
              goto LABEL_13;
            }
          }

          OUTLINED_FUNCTION_17_20();
          v49 = [obja countByEnumeratingWithState:? objects:? count:?];
          if (v49)
          {
            continue;
          }

          break;
        }
      }
    }

LABEL_13:
    OUTLINED_FUNCTION_90_3();
  }
}

- (void)_setISPZoomFactorSynchronously:(uint64_t)synchronously
{
  if (synchronously)
  {
    OUTLINED_FUNCTION_124_5();
    os_unfair_lock_lock(v3 + 746);
    v1[744]._os_unfair_lock_opaque = 0;
    v1[743]._os_unfair_lock_opaque = v2;
    v1[745]._os_unfair_lock_opaque = v2;
    os_unfair_lock_unlock(v1 + 746);

    [(BWFigVideoCaptureDevice *)v1 _setNewISPZoomFactorOnStream];
  }
}

- (id)_updateSensorRegionsOfInterestBasedOnZoomFactor:(id *)result aspectRatio:(float)ratio
{
  if (result)
  {
    v3 = result;
    if (*(result + 3945) == 1)
    {
      result = [result masterCaptureStream];
      if (result == v3[85] && *(v3 + 753) <= ratio)
      {
        result = [v3[177] lastSelectionReason];
        if (result)
        {
          result = [v3[85] previewShiftAtBaseZoom];
        }
      }
    }

    if (*(v3 + 3796) == 1)
    {
      v4 = OUTLINED_FUNCTION_264();
      result = [(BWFigVideoCaptureDevice *)v4 _updateSensorRegionOfInterest:v5 forZoomFactor:v6 aspectRatio:v7 previewShiftInSensorSpace:v8 streamProperty:v9, v10, v11, v12];
    }

    if (*(v3 + 3873) == 1)
    {
      v13 = OUTLINED_FUNCTION_264();

      return [(BWFigVideoCaptureDevice *)v13 _updateSensorRegionOfInterest:v14 forZoomFactor:v15 aspectRatio:v16 previewShiftInSensorSpace:v17 streamProperty:v18, v19, v20, v21];
    }
  }

  return result;
}

- (uint64_t)_updateStatsMasterForMasterStream:(uint64_t)result
{
  if (result)
  {
    v1 = result;
    if (*(result + 648))
    {
      OUTLINED_FUNCTION_107_4();
      if (v2)
      {
        os_unfair_lock_lock((v1 + 4072));
        v3 = *(v1 + 4097) != 1 || *(v1 + 4100) > 0;
        os_unfair_lock_unlock((v1 + 4072));
      }

      else
      {
        v3 = 1;
      }

      OUTLINED_FUNCTION_204();
      if (v2)
      {
        v4 = *(v1 + 4300) != 0.0;
      }

      else
      {
        v4 = 1;
      }

      v5 = *(v1 + 648);
      if (v5 && (*(v1 + 704) & (v4 && v3) & 1) != 0)
      {
        v6 = *(v1 + 600);
      }

      else
      {
        v6 = 0;
      }

      return [v5 setCameraControlsStatisticsMasterStream:v6];
    }
  }

  return result;
}

- (uint64_t)_overCaptureMasterStreamForZoomFactor:(uint64_t)factor
{
  if (!factor)
  {
    return 0;
  }

  OUTLINED_FUNCTION_124_5();
  if (*(v3 + 3898) != 1)
  {
    if (*(v1 + 680) || (v4 = *(v1 + 672)) == 0)
    {
      v4 = *(v1 + 600);
    }

    OUTLINED_FUNCTION_204();
    if (v5)
    {
      if (*(v1 + 588) == 9)
      {
        [*(v1 + 672) baseZoomFactor];
        if (v6 <= v2)
        {
          return *(v1 + 672);
        }
      }
    }

    return v4;
  }

  if (*(v1 + 3899) == 1)
  {
    return *(v1 + 688);
  }

  v9 = OUTLINED_FUNCTION_114_4();

  return [(BWFigVideoCaptureDevice *)v8 _captureStreamBasedSolelyOnZoomFactor:v9];
}

- (uint64_t)_overCaptureActiveSlaveStreamForZoomFactor:(char)factor masterStream:currentFrameRate:preferWider:
{
  if (!self)
  {
    return 0;
  }

  OUTLINED_FUNCTION_124_5();
  v8 = v7 + 4096;
  if (*(v7 + 4096) != 1)
  {
    goto LABEL_15;
  }

  v9 = v6;
  os_unfair_lock_lock((v3 + 4072));
  if (*(v3 + 4088) == 1)
  {
    if ((*(v8 + 1) & 1) == 0)
    {
      *(v8 + 1) = 1;
      if (v9 <= 0.0)
      {
        v9 = 30.0;
      }

      *(v3 + 4100) = (v9 * BWOverCaptureRenderDurationInSecondsAfterThermalMitigationStart());
    }
  }

  else if (*(v8 + 1) && *(v8 + 8) == 1)
  {
    *(v8 + 1) = 0;
  }

  os_unfair_lock_unlock((v3 + 4072));
  if (*(v8 + 1) != 1)
  {
    goto LABEL_15;
  }

  v10 = *(v3 + 4100);
  v11 = __OFSUB__(v10, 1);
  v12 = v10 - 1;
  if (v12 < 0 != v11)
  {
    return 0;
  }

  *(v3 + 4100) = v12;
LABEL_15:
  v14 = OUTLINED_FUNCTION_114_4();
  v16 = [*(v3 + 664) indexOfObject:{-[BWFigVideoCaptureDevice _captureStreamBasedSolelyOnZoomFactor:](v15, v14)}];
  v17 = [*(v3 + 664) indexOfObject:a2];
  if (factor)
  {
    goto LABEL_19;
  }

  v18 = v17 - v16;
  if (v17 - v16 < 0)
  {
    v18 = v16 - v17;
  }

  if (v18 != 1)
  {
LABEL_19:
    if (v17)
    {
      v16 = v17 - 1;
    }

    else
    {
      v16 = 1;
    }
  }

  v19 = *(v3 + 664);

  return [v19 objectAtIndexedSubscript:v16];
}

- (uint64_t)_captureStreamBasedSolelyOnZoomFactor:(uint64_t)factor
{
  if (!factor)
  {
    return 0;
  }

  firstObject = [*(factor + 664) firstObject];
  OUTLINED_FUNCTION_7_42();
  v5 = *(factor + 664);
  if (OUTLINED_FUNCTION_1_3(v6, v7, v8, v9, v10, v11, v12, v13, v26, v28, v30, v32, v34, v36, v38, v40, v42, v44, v46, v48, v50, v52, v54, v56, v58))
  {
    OUTLINED_FUNCTION_125_4();
    do
    {
      OUTLINED_FUNCTION_39_19();
      if (!v14)
      {
        objc_enumerationMutation(v5);
      }

      v15 = *v60;
      [*v60 baseZoomFactor];
      if (v16 <= a2)
      {
        firstObject = v15;
      }

      OUTLINED_FUNCTION_51_11();
    }

    while (!v14 || OUTLINED_FUNCTION_1_3(v17, v18, v19, v20, v21, v22, v23, v24, v27, v29, v31, v33, v35, v37, v39, v41, v43, v45, v47, v49, v51, v53, v55, v57, v59));
  }

  return firstObject;
}

- (void)_updateBravoStreamSelectionForMasterStream:(int)stream forceNotification:
{
  if (self)
  {
    OUTLINED_FUNCTION_54();
    os_unfair_lock_lock(v6 + 346);
    v7 = 1432;
    if (*(v3 + 1464))
    {
      v7 = 1448;
    }

    v16 = *(v3 + v7);
    if ([*(v3 + 1416) selectionConfiguration] == v16 && v8 == *(&v16 + 1))
    {
      os_unfair_lock_unlock((v3 + 1384));
      if (!stream)
      {
        return;
      }
    }

    else
    {
      [*(v3 + 1416) setSelectionConfiguration:v16];
      os_unfair_lock_unlock((v3 + 1384));
    }

    v10 = 1.0;
    if (v16 == 3)
    {
      [*(v3 + 648) clientBaseZoomFactorsByPortType];
      [OUTLINED_FUNCTION_18_0() portType];
      v11 = [OUTLINED_FUNCTION_8() objectForKeyedSubscript:?];
      if (v11)
      {
        [v11 floatValue];
      }

      else
      {
        [v4 baseZoomFactor];
      }

      v10 = v12;
    }

    v14[1] = @"MinAvailableVideoZoomFactor";
    v15[0] = [MEMORY[0x1E695DEF0] dataWithBytes:&v16 length:{16, @"NewPropertyValue"}];
    *&v13 = v10;
    v15[1] = [MEMORY[0x1E696AD98] numberWithFloat:v13];
    [v3 _postNotificationWithPayload:@"BravoStreamSelectionConfigurationChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", v15, v14, 2)}];
  }
}

- (uint64_t)_setSynchronizedStreamsGroupProperty:(uint64_t)result value:
{
  if (result)
  {
    OUTLINED_FUNCTION_67_8();
    v4 = v3;
    if ([objc_msgSend(objc_msgSend(*(v3 + 648) "syncGroup")])
    {
      syncGroup = [*(v4 + 648) syncGroup];
    }

    else
    {
      syncGroup = [*(v4 + 600) stream];
    }

    return [syncGroup setProperty:v2 value:v1];
  }

  return result;
}

- (void)_sendMasterStreamChangedNotificationWithPortType:(void *)result
{
  if (result)
  {
    return [result _postNotificationWithPayload:@"BravoMasterStreamChangedNotification" notificationPayload:{OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], a2, @"NewPropertyValue", a2)}];
  }

  return result;
}

- (void)_sendPreferredMasterStreamChangedNotificationWithPortType:(void *)result
{
  if (result)
  {
    return [result _postNotificationWithPayload:@"PreferredBravoMasterStreamChangedNotification" notificationPayload:{OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], a2, @"NewPropertyValue", a2)}];
  }

  return result;
}

- (uint64_t)_sendMacroFocusChangedNotification:(uint64_t)result
{
  if (result)
  {
    v2 = result;
    [MEMORY[0x1E696AD98] numberWithBool:{a2, @"NewPropertyValue"}];
    return [v2 _postNotificationWithPayload:@"MacroFocusNotification" notificationPayload:{OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v3)}];
  }

  return result;
}

void __52__BWFigVideoCaptureDevice__deviceWillStartStreaming__block_invoke_368(uint64_t a1)
{
  os_unfair_lock_lock((*(a1 + 32) + 2140));
  v2 = *(a1 + 32);
  v3 = *(v2 + 2276);
  v4 = *(v2 + 2280);
  *(v2 + 2276) = v4;
  os_unfair_lock_unlock((*(a1 + 32) + 2140));
  *(*(*(a1 + 48) + 8) + 24) = v4 - 5 < 3;
  v5 = v3 == v4 || dword_1ED844350 == 0;
  if (!v5)
  {
    OUTLINED_FUNCTION_112();
    OUTLINED_FUNCTION_325();
    v6 = OUTLINED_FUNCTION_77();
    os_log_type_enabled(v6, v9);
    OUTLINED_FUNCTION_82_6();
    if (v5)
    {
      v8 = v7;
    }

    else
    {
      v8 = v10;
    }

    if (v8)
    {
      fvcd_streamingImageIntentToString(v4);
      OUTLINED_FUNCTION_78();
      OUTLINED_FUNCTION_5();
      OUTLINED_FUNCTION_47_2();
    }

    OUTLINED_FUNCTION_2_4();
    OUTLINED_FUNCTION_39_0();
  }

  [BWFigVideoCaptureDevice _updateStreamingImageIntentTo:from:masterPortType:];
  if (v4 == 8 && (*(*(a1 + 32) + 3947) & 1) == 0)
  {
    *(*(a1 + 32) + 4064) = [[BWActionCameraFlickerAvoidanceMonitor alloc] initWithDefaultMaxExposureDurationFrameworkOverrideByPortType:*(*(a1 + 32) + 2304)];
  }
}

void __50__BWFigVideoCaptureDevice__deviceDidStopStreaming__block_invoke_2(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, uint64_t a12, uint64_t a13, uint64_t a14, uint64_t a15, uint64_t a16, uint64_t a17, uint64_t a18, uint64_t a19, uint64_t a20, uint64_t a21, uint64_t a22, uint64_t a23, uint64_t a24, uint64_t a25, uint64_t a26, uint64_t a27, uint64_t a28, uint64_t a29, uint64_t a30, uint64_t a31, __int16 a32, char a33, os_log_type_t a34)
{
  OUTLINED_FUNCTION_58_2();
  v35 = v34;
  os_unfair_lock_lock((*(v34 + 32) + 2140));
  v36 = *(v35 + 32);
  v37 = *(v36 + 2276);
  *(v36 + 2276) = 0;
  v38 = *(v35 + 32);
  if (*(v38 + 2280) == 3)
  {
    v39 = *(v38 + 2384);
    v40 = v39 - 1;
    v41 = v39 == 2 ? 2 : v39 == 1;
    os_unfair_lock_assert_owner((v38 + 2140));
    v42 = *(v38 + 2336);
    v43 = v42 ? [v42 BOOLValue] : *(v38 + 2332);
    v44 = (v43 & 1) != 0 ? 4 : v41;
    *(*(v35 + 32) + 2280) = v44;
    v45 = *(v35 + 32);
    if (v45)
    {
      os_unfair_lock_assert_owner((v45 + 2140));
      v46 = *(v45 + 2336);
      if (v46)
      {
        LOBYTE(v47) = [v46 BOOLValue];
      }

      else
      {
        v47 = *(v45 + 2332);
      }
    }

    else
    {
      LOBYTE(v47) = 0;
    }

    if (v47 & 1 | (v40 < 2) && dword_1ED844350)
    {
      OUTLINED_FUNCTION_112();
      v48 = OUTLINED_FUNCTION_77();
      os_log_type_enabled(v48, a34);
      OUTLINED_FUNCTION_4_0();
      if (v38)
      {
        v49 = *(v35 + 32);
        if (v49)
        {
          os_unfair_lock_assert_owner((v49 + 2140));
          v50 = *(v49 + 2336);
          if (v50)
          {
            [v50 BOOLValue];
          }
        }

        fvcd_streamingImageIntentToString(*(*(v35 + 32) + 2280));
        OUTLINED_FUNCTION_5();
        OUTLINED_FUNCTION_4_4();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_39_0();
    }
  }

  os_unfair_lock_unlock((*(v35 + 32) + 2140));
  if (v37 && dword_1ED844350)
  {
    OUTLINED_FUNCTION_112();
    v51 = OUTLINED_FUNCTION_77();
    v52 = OUTLINED_FUNCTION_26_8(v51);
    if (OUTLINED_FUNCTION_5_24(v52))
    {
      OUTLINED_FUNCTION_78();
      OUTLINED_FUNCTION_5();
      OUTLINED_FUNCTION_4_4();
      _os_log_send_and_compose_impl();
    }

    OUTLINED_FUNCTION_2_4();
    OUTLINED_FUNCTION_13_0();
  }

  [BWFigVideoCaptureDevice _updateStreamingImageIntentTo:from:masterPortType:];

  *(*(v35 + 32) + 4064) = 0;
  OUTLINED_FUNCTION_56();
}

- (void)_reportAPSOffsetEstimatorInfo
{
  if (self)
  {
    OUTLINED_FUNCTION_91();
    a48 = v49;
    a49 = v50;
    v52 = v51;
    if (*(v51 + 3504))
    {
      OUTLINED_FUNCTION_231();
      v53 = *(v52 + 656);
      OUTLINED_FUNCTION_17_20();
      v58 = OUTLINED_FUNCTION_37(v54, v55, v56, v57);
      if (v58)
      {
        v59 = v58;
        v60 = *off_1E798BCD0;
        do
        {
          for (i = 0; i != v59; ++i)
          {
            OUTLINED_FUNCTION_142_0();
            if (!v62)
            {
              objc_enumerationMutation(v53);
            }

            v63 = *(a29 + 8 * i);
            [v63 portType];
            if ([OUTLINED_FUNCTION_37_0() containsObject:?])
            {
              a11 = 0;
              v64 = [objc_msgSend(v63 "stream")];
              if (v64)
              {
                v65 = v64;
                [v63 portType];
                [OUTLINED_FUNCTION_67_5() processAPSOffsetEstimatorInfo:v65 portType:?];
              }
            }
          }

          OUTLINED_FUNCTION_17_20();
          v59 = OUTLINED_FUNCTION_37(v66, v67, v68, v69);
        }

        while (v59);
      }

      *(v52 + 3504) = 0;
    }

    OUTLINED_FUNCTION_90_3();
  }
}

- (uint64_t)_reportDeskViewStreamingSessionCoreAnalyticsData
{
  if (result)
  {
    v1 = result;
    v2 = objc_alloc_init(BWStreamingSessionAnalyticsPayload);
    [(BWStreamingSessionAnalyticsPayload *)v2 setActiveDeviceMask:*(v1 + 136)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setDeviceType:14];
    [*(v1 + 600) continuityCameraClientDeviceClass];
    [OUTLINED_FUNCTION_17() setContinuityCameraClientDeviceClass:?];
    mach_absolute_time();
    v3 = FigHostTimeToNanoseconds();
    OUTLINED_FUNCTION_360(v3);
    [(BWStreamingSessionAnalyticsPayload *)v2 setClientApplicationID:*(v1 + 88)];
    if (*(v1 + 460))
    {
      memset(&time, 0, sizeof(time));
      v4 = FigHostTimeToNanoseconds();
      CMTimeMake(&time, v4, 1000000000);
      memset(&v22, 0, sizeof(v22));
      lhs = time;
      rhs = *(v1 + 448);
      CMTimeSubtract(&v22, &lhs, &rhs);
      rhs = *(v1 + 472);
      v19 = v22;
      CMTimeAdd(&lhs, &rhs, &v19);
      *(v1 + 472) = lhs;
    }

    time = *(v1 + 472);
    [(BWStreamingSessionAnalyticsPayload *)v2 setMlvnrActiveTime:(CMTimeGetSeconds(&time) * 1000.0)];
    if (dword_1ED844350)
    {
      LODWORD(lhs.value) = 0;
      LOBYTE(rhs.value) = 0;
      OUTLINED_FUNCTION_201();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      value = lhs.value;
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, rhs.value);
      OUTLINED_FUNCTION_39_7();
      if (v8)
      {
        v9 = v7;
      }

      else
      {
        v9 = value;
      }

      if (v9)
      {
        mlvnrActiveTime = [(BWStreamingSessionAnalyticsPayload *)v2 mlvnrActiveTime];
        LODWORD(v22.value) = 136315394;
        *(&v22.value + 4) = "[BWFigVideoCaptureDevice _reportDeskViewStreamingSessionCoreAnalyticsData]";
        LOWORD(v22.flags) = 1024;
        *(&v22.flags + 2) = mlvnrActiveTime;
        LODWORD(v17) = 18;
        v16 = &v22;
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_17_8();
      if (dword_1ED844350)
      {
        LODWORD(lhs.value) = 0;
        LOBYTE(rhs.value) = 0;
        v11 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        v12 = lhs.value;
        os_log_type_enabled(v11, rhs.value);
        OUTLINED_FUNCTION_115_0();
        if (v8)
        {
          v14 = v13;
        }

        else
        {
          v14 = v12;
        }

        if (v14)
        {
          v15 = OUTLINED_FUNCTION_309([(BWStreamingSessionAnalyticsPayload *)v2 streamingTime]);
          LODWORD(v22.value) = 136315394;
          *(&v22.value + 4) = "[BWFigVideoCaptureDevice _reportDeskViewStreamingSessionCoreAnalyticsData]";
          LOWORD(v22.flags) = 2048;
          *(&v22.flags + 2) = v15;
          OUTLINED_FUNCTION_34_16();
          v16 = &v22;
          OUTLINED_FUNCTION_8_0();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        OUTLINED_FUNCTION_13_0();
      }
    }

    return [+[BWCoreAnalyticsReporter sendEvent:v16], "sendEvent:", v2];
  }

  return result;
}

- (uint64_t)_reportStreamingSessionCoreAnalyticsData
{
  if (result)
  {
    v1 = result;
    v2 = objc_alloc_init(BWStreamingSessionAnalyticsPayload);
    [(BWStreamingSessionAnalyticsPayload *)v2 setActiveDeviceMask:*(v1 + 136)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setDeviceType:*(v1 + 588)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setDevicePosition:*(v1 + 616)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setStartingCameraPosture:*(v1 + 3596)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setStreamingStartExifOrientation:*(v1 + 3600)];
    mach_absolute_time();
    v3 = FigHostTimeToNanoseconds();
    [(BWStreamingSessionAnalyticsPayload *)v2 setStreamingTime:v3 / 0xF4240];
    if (*(v1 + 293) == 1)
    {
      OUTLINED_FUNCTION_198();
      *(v1 + 304) = v4;
    }

    if (*(v1 + 258) == 1)
    {
      OUTLINED_FUNCTION_198();
      *(v1 + 272) = v5;
    }

    if (*(v1 + 361) == 1)
    {
      OUTLINED_FUNCTION_198();
      *(v1 + 376) = v6;
    }

    if (*(v1 + 189) == 1)
    {
      OUTLINED_FUNCTION_198();
      *(v1 + 208) = v7;
    }

    if (*(v1 + 325) == 1)
    {
      OUTLINED_FUNCTION_198();
      *(v1 + 336) = v8;
    }

    if (*(v1 + 326) == 1)
    {
      OUTLINED_FUNCTION_198();
      *(v1 + 352) = v9;
    }

    v10 = OUTLINED_FUNCTION_17_26();
    [(BWFigVideoCaptureDevice *)v10 _updateOrientationTotalTimes:v11];
    v12 = OUTLINED_FUNCTION_17_26();
    [(BWFigVideoCaptureDevice *)v12 _updateDynamicAspectRatioCumulativeTimeForStopTime:v13];
    if (*(v1 + 3584))
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfPhotoCaptures:?];
      [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfBurstPhotoCaptures:*(v1 + 3588)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfBalancedPhotoCaptures:*(v1 + 3592)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfButtonMashingCapturesAtRate0:*(v1 + 3624)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfButtonMashingEventsAtRate0:*(v1 + 3632)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfButtonMashingCapturesAtRate1:*(v1 + 3628)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfButtonMashingEventsAtRate1:*(v1 + 3636)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setLongestButtonMashingEventAtRate0:*(v1 + 3644)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setLongestButtonMashingEventAtRate1:*(v1 + 3648)];
      if (*(v1 + 3604))
      {
        [(BWStreamingSessionAnalyticsPayload *)v2 setTimeToFirstPhotoCapture:?];
      }

      if (*(v1 + 3620))
      {
        [(BWStreamingSessionAnalyticsPayload *)v2 setMaxTimeSinceLastPhotoCapture:?];
      }

      if (*(v1 + 3616) != -1)
      {
        [(BWStreamingSessionAnalyticsPayload *)v2 setMinTimeSinceLastPhotoCapture:?];
      }
    }

    [(BWStreamingSessionAnalyticsPayload *)v2 setClientApplicationID:*(v1 + 88)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setSunburnDetectOccurred:*(v1 + 3520)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setDegradedAutoFocusStatus:*(v1 + 3536)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setApsMaxDynamicGainDerate:*(v1 + 3544)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setApsMaxTopEndDynamicBuffer:*(v1 + 3552)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfSphereJitterDetectAttempts:*(v1 + 3560)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setNumberOfSphereJitterDetects:*(v1 + 3568)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setActuatorVendor:*(v1 + 3664)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setSphereMode:*(v1 + 3672)];
    if (*(v1 + 180))
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setTimeOfFlightCameraUsageTypeMask:?];
    }

    if (*(v1 + 184))
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setTimeOfFlightCameraProjectorModeMask:?];
    }

    OUTLINED_FUNCTION_52_16();
    if (!v14)
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setStructuredLightIdleTemperatureFirstReading:?];
    }

    OUTLINED_FUNCTION_52_16();
    if (!v14)
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setStructuredLightActiveTemperatureFirstReading:?];
    }

    OUTLINED_FUNCTION_52_16();
    if (!v14)
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setStructuredLightActiveTemperatureLastReading:?];
    }

    if ([*(v1 + 3696) numberOfSamples])
    {
      [*(v1 + 3696) max];
      [*(v1 + 3696) min];
      [OUTLINED_FUNCTION_26_17() setStructuredLightActiveTemperatureRange:?];
      [*(v1 + 3696) average];
      [OUTLINED_FUNCTION_26_17() setStructuredLightActiveTemperatureAverage:?];
    }

    if ([*(v1 + 3704) numberOfSamples])
    {
      [*(v1 + 3704) max];
      [*(v1 + 3704) min];
      [OUTLINED_FUNCTION_26_17() setInfaredSensorTemperatureRange:?];
      [*(v1 + 3704) average];
      [OUTLINED_FUNCTION_26_17() setInfaredSensorTemperatureAverage:?];
    }

    [(BWStreamingSessionAnalyticsPayload *)v2 setSensorTemperatureStats:*(v1 + 3752)];
    v15 = *(v1 + 3712);
    if (v15 || *(v1 + 3720))
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setInfraredProjectorUptimeInMsForLowPowerSparse:v15 / 0x3E8];
      [(BWStreamingSessionAnalyticsPayload *)v2 setInfraredProjectorUptimeInMsForHighPowerSparse:*(v1 + 3720) / 0x3E8uLL];
    }

    systemPressureLevel = [v1 systemPressureLevel];
    v17 = *(v1 + 3760) + FigHostTimeToNanoseconds() / 0xF4240uLL * systemPressureLevel;
    *(v1 + 3760) = v17;
    if (v3 >= 0xF4240)
    {
      *&v18 = (v17 / (v3 / 0xF4240));
      [(BWStreamingSessionAnalyticsPayload *)v2 setAverageSystemPressureLevel:v18];
    }

    [(BWStreamingSessionAnalyticsPayload *)v2 setMaxSystemPressureLevel:*(v1 + 3776)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setSystemPressureFactors:*(v1 + 3792)];
    if ((*(v1 + 3784) & 0x8000000000000000) == 0)
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setTimeToCriticalSystemPressureInMS:?];
    }

    v19 = *(v1 + 4416);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __67__BWFigVideoCaptureDevice__reportStreamingSessionCoreAnalyticsData__block_invoke;
    block[3] = &unk_1E798F898;
    block[4] = v2;
    block[5] = v1;
    dispatch_sync(v19, block);
    [(BWStreamingSessionAnalyticsPayload *)v2 setCinematicFramingSupported:*(v1 + 188)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setCinematicFramingEnabled:*(v1 + 189)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setCinematicFramingControlMode:*(v1 + 192)];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setCinematicFramingTime:?];
    [objc_msgSend(v1 "centerStageDelegate")];
    LODWORD(v20) = [objc_msgSend(OUTLINED_FUNCTION_133() "centerStageDelegate")];
    [(BWStreamingSessionAnalyticsPayload *)v2 setSmartCropSupported:*(v1 + 216)];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setCinematicFramingSingleFaceDetectedTime:?];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setCinematicFramingMultipleFacesDetectedTime:?];
    [(BWStreamingSessionAnalyticsPayload *)v2 setBackgroundBlurSupported:*(v1 + 257)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setBackgroundBlurEnabled:*(v1 + 258)];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setBackgroundBlurTime:?];
    LODWORD(v21) = *(v1 + 288);
    [(BWStreamingSessionAnalyticsPayload *)v2 setBackgroundBlurAperture:v21];
    [(BWStreamingSessionAnalyticsPayload *)v2 setBackgroundBlurApertureChanged:*(v1 + 284)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setStudioLightingSupported:*(v1 + 292)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setStudioLightingEnabled:*(v1 + 293)];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setStudioLightingTime:?];
    LODWORD(v22) = *(v1 + 320);
    [(BWStreamingSessionAnalyticsPayload *)v2 setStudioLightingIntensity:v22];
    [(BWStreamingSessionAnalyticsPayload *)v2 setStudioLightingIntensityChanged:*(v1 + 316)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setReactionEffectsSupported:*(v1 + 324)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setReactionEffectsEnabled:*(v1 + 325)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setGesturesEnabled:*(v1 + 326)];
    v23 = *(v1 + 4320);
    if (v23)
    {
      referencedObject = [v23 referencedObject];
    }

    else if ([v1 isBravoVariant])
    {
      referencedObject = [v1 masterCaptureStream];
    }

    else
    {
      referencedObject = *(v1 + 600);
    }

    [referencedObject reactionCount];
    [OUTLINED_FUNCTION_17() setReactionCount:?];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setReactionEffectsEnabledTime:?];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setGesturesEnabledTime:?];
    [(BWStreamingSessionAnalyticsPayload *)v2 setBackgroundReplacementSupported:*(v1 + 360)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setBackgroundReplacementEnabled:*(v1 + 361)];
    FigHostTimeToNanoseconds();
    [OUTLINED_FUNCTION_102_5() setBackgroundReplacementTime:?];
    [(BWStreamingSessionAnalyticsPayload *)v2 setBackgroundReplacementPixelBufferChanged:*(v1 + 384)];
    if (*(v1 + 412))
    {
      memset(&time, 0, sizeof(time));
      v25 = FigHostTimeToNanoseconds();
      CMTimeMake(&time, v25, 1000000000);
      memset(&time2, 0, sizeof(time2));
      lhs = time;
      rhs = *(v1 + 400);
      CMTimeSubtract(&time2, &lhs, &rhs);
      rhs = *(v1 + 424);
      v55 = time2;
      CMTimeAdd(&lhs, &rhs, &v55);
      *(v1 + 424) = lhs;
    }

    time = *(v1 + 424);
    [(BWStreamingSessionAnalyticsPayload *)v2 setMlvnrActiveTime:(CMTimeGetSeconds(&time) * 1000.0)];
    if (dword_1ED844350)
    {
      OUTLINED_FUNCTION_91_9();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      value = lhs.value;
      LODWORD(v20) = LOBYTE(rhs.value);
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, rhs.value);
      OUTLINED_FUNCTION_82_6();
      if (v14)
      {
        v29 = v28;
      }

      else
      {
        v29 = value;
      }

      if (v29)
      {
        [(BWStreamingSessionAnalyticsPayload *)v2 mlvnrActiveTime];
        LODWORD(time2.value) = 136315394;
        *(&time2.value + 4) = "[BWFigVideoCaptureDevice _reportStreamingSessionCoreAnalyticsData]";
        OUTLINED_FUNCTION_177();
        *(&time2.flags + 2) = v30;
        OUTLINED_FUNCTION_2_1();
        OUTLINED_FUNCTION_47_2();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_39_0();
    }

    [(BWStreamingSessionAnalyticsPayload *)v2 setCinematicVideoEnabled:*(v1 + 3993)];
    LODWORD(v31) = *(v1 + 4040);
    [(BWStreamingSessionAnalyticsPayload *)v2 setCinematicVideoAverageRenderingTime:v31];
    LODWORD(v32) = *(v1 + 4044);
    [(BWStreamingSessionAnalyticsPayload *)v2 setCinematicVideoWorstCaseRenderingTime:v32];
    if (*(v1 + 4148))
    {
      if (*(v1 + 1372))
      {
        time = *(v1 + 1360);
        time2 = *(v1 + 4136);
        if (CMTimeCompare(&time, &time2) >= 1)
        {
          time = *(v1 + 1360);
          [(BWFigVideoCaptureDevice *)v1 _updateTimeOfFlightStreamingTime:*&time.value];
        }
      }

      [OUTLINED_FUNCTION_137_4() setTimeOfFlightAssistedAutoFocusStreamingTimeAt0FPS:?];
      [OUTLINED_FUNCTION_137_4() setTimeOfFlightAssistedAutoFocusStreamingTimeAt1FPS:?];
      [OUTLINED_FUNCTION_137_4() setTimeOfFlightAssistedAutoFocusStreamingTimeAt8FPS:?];
      [OUTLINED_FUNCTION_137_4() setTimeOfFlightAssistedAutoFocusStreamingTimeAtOtherFPS:?];
    }

    BWUtilitiesUnderlyingDeviceTypeFromPortType(*(v1 + 608), *(v1 + 588));
    [OUTLINED_FUNCTION_17() setCaptureDeviceType:?];
    [(BWStreamingSessionAnalyticsPayload *)v2 setFaceDrivenAEAFEnabledByDefault:*(v1 + 544)];
    if (*(v1 + 544) == 1)
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setFaceDrivenAEDisabledCount:*(v1 + 564)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setFaceDrivenAFDisabledCount:*(v1 + 560)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setMaxFacesDetected:*(v1 + 568)];
      [*(v1 + 576) min];
      [OUTLINED_FUNCTION_26_17() setMinLuxValue:?];
      [*(v1 + 576) max];
      [OUTLINED_FUNCTION_26_17() setMaxLuxValue:?];
      [*(v1 + 576) average];
      [OUTLINED_FUNCTION_26_17() setAverageLuxValue:?];
      time.value = 0;
      [*(v1 + 576) getEstimatedQuantiles:&time n:2];
      [OUTLINED_FUNCTION_26_17() setMedianLuxValue:?];
      [*(v1 + 576) histogramAsDictionary];
      [OUTLINED_FUNCTION_17() setLuxHistogram:?];
      [(BWStreamingSessionAnalyticsPayload *)v2 setPhotoFormat:*(v1 + 584)];
    }

    OUTLINED_FUNCTION_298();
    if (v14)
    {
      LODWORD(v33) = *(v1 + 1572);
      [(BWStreamingSessionAnalyticsPayload *)v2 setDepthMaxFrameRate:v33];
      [(BWStreamingSessionAnalyticsPayload *)v2 setDepthFormatDimensionWidth:*(v1 + 4272)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setDepthFormatDimensionHeight:*(v1 + 4276)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setDepthPixelFormat:*(v1 + 4280)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setDepthDataFiltered:*(v1 + 4284)];
    }

    [*(v1 + 600) continuityCameraClientDeviceClass];
    [OUTLINED_FUNCTION_17() setContinuityCameraClientDeviceClass:?];
    if (*(v1 + 4392) >= 1)
    {
      FigHostTimeToNanoseconds();
      [OUTLINED_FUNCTION_102_5() setThermalThrottledTime:?];
    }

    if (*(v1 + 600))
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setPixelFormat:*(v1 + 4440)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setVideoDimensions:*(v1 + 4444)];
      [(BWStreamingSessionAnalyticsPayload *)v2 setHighlightRecoveryEnabled:*(v1 + 4452)];
      [*(v1 + 600) minimumSupportedFrameRate];
      [(BWStreamingSessionAnalyticsPayload *)v2 setMinimumSupportedFrameRate:?];
      [*(v1 + 600) maximumSupportedFrameRate];
      [(BWStreamingSessionAnalyticsPayload *)v2 setMaximumSupportedFrameRate:?];
      minimumFrameRate = [*(v1 + 600) minimumFrameRate];
      *&v36 = FigCaptureFrameRateAsFloat(minimumFrameRate, v35);
      [(BWStreamingSessionAnalyticsPayload *)v2 setMinimumFrameRate:v36];
      maximumFrameRate = [*(v1 + 600) maximumFrameRate];
      *&v39 = FigCaptureFrameRateAsFloat(maximumFrameRate, v38);
      [(BWStreamingSessionAnalyticsPayload *)v2 setMaximumFrameRate:v39];
      v40 = [objc_msgSend(*(v1 + 600) "supportedFormats")];
      if (v40)
      {
        v41 = v40;
        [objc_msgSend(v40 objectForKeyedSubscript:{*off_1E798D3E8), "floatValue"}];
        [(BWStreamingSessionAnalyticsPayload *)v2 setFieldOfView:?];
        [objc_msgSend(v41 objectForKeyedSubscript:{*off_1E798D3F0), "BOOLValue"}];
        [OUTLINED_FUNCTION_17() setBinned:?];
      }

      [(BWStreamingSessionAnalyticsPayload *)v2 setColorSpace:*(v1 + 4456)];
    }

    [(BWStreamingSessionAnalyticsPayload *)v2 setClientIsVOIP:*(v1 + 4453)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setAudioMixWithOthersEnabled:*(v1 + 4454)];
    if (*(v1 + 4544) == 1)
    {
      time = *(v1 + 4548);
      v51 = *MEMORY[0x1E6960CC0];
      *&time2.value = *MEMORY[0x1E6960CC0];
      v42 = *(MEMORY[0x1E6960CC0] + 16);
      time2.epoch = v42;
      if (CMTimeCompare(&time, &time2))
      {
        v20 = (v1 + 4572);
        time = *(v1 + 4572);
        *&time2.value = v51;
        time2.epoch = v42;
        if (CMTimeCompare(&time, &time2))
        {
          *&time2.value = *v20;
          v43 = *(v1 + 4588);
        }

        else
        {
          *&time2.value = *(v1 + 1360);
          v43 = *(v1 + 1376);
        }

        time2.epoch = v43;
        lhs = *(v1 + 4548);
        CMTimeSubtract(&time, &time2, &lhs);
        Seconds = CMTimeGetSeconds(&time);
        if (Seconds > 0.16667)
        {
          [(BWStreamingSessionAnalyticsPayload *)v2 setInvalidFrameDurationBeforeFirstValidFrame:?];
        }
      }

      if (*(v1 + 4596))
      {
        [(BWStreamingSessionAnalyticsPayload *)v2 setInvalidFrameCountAfterFirstValidFrame:?];
        OUTLINED_FUNCTION_91_9();
        v45 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        LODWORD(v20) = lhs.value;
        v46 = os_log_type_enabled(v45, rhs.value);
        if (OUTLINED_FUNCTION_5_24(v46))
        {
          v47 = *(v1 + 4596);
          LODWORD(time2.value) = 136315394;
          *(&time2.value + 4) = "[BWFigVideoCaptureDevice _reportStreamingSessionCoreAnalyticsData]";
          LOWORD(time2.flags) = 1024;
          *(&time2.flags + 2) = v47;
          OUTLINED_FUNCTION_2_1();
          OUTLINED_FUNCTION_4_4();
          _os_log_send_and_compose_impl();
          LODWORD(v20) = lhs.value;
        }

        OUTLINED_FUNCTION_1_4();
        OUTLINED_FUNCTION_13_0();
      }
    }

    [(BWStreamingSessionAnalyticsPayload *)v2 setSecureMetadataEnabled:*(v1 + 4600)];
    [BWFigVideoCaptureDevice _updateThermalPressureStatsWithOldSDOFEffectStatus:v1 newSDOFEffectStatus:?];
    [(BWStreamingSessionAnalyticsPayload *)v2 setHitPortraitInPhotoPreviewThermalPressure:*(v1 + 4601)];
    [(BWStreamingSessionAnalyticsPayload *)v2 setLongestContinuousPortraitInPhotoPreviewInMS:*(v1 + 4604)];
    if (*(v1 + 4688) == 1)
    {
      [(BWStreamingSessionAnalyticsPayload *)v2 setDynamicAspectRatioSupported:1];
      FigHostTimeToNanoseconds();
      [OUTLINED_FUNCTION_102_5() setDynamicAspectRatio1x1Time:?];
      FigHostTimeToNanoseconds();
      [OUTLINED_FUNCTION_102_5() setDynamicAspectRatio4x3Time:?];
      FigHostTimeToNanoseconds();
      [OUTLINED_FUNCTION_102_5() setDynamicAspectRatio3x4Time:?];
      FigHostTimeToNanoseconds();
      [OUTLINED_FUNCTION_102_5() setDynamicAspectRatio16x9Time:?];
      FigHostTimeToNanoseconds();
      [OUTLINED_FUNCTION_102_5() setDynamicAspectRatio9x16Time:?];
    }

    if (dword_1ED844350)
    {
      OUTLINED_FUNCTION_91_9();
      v48 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(v48, rhs.value);
      OUTLINED_FUNCTION_4_0();
      if (v20)
      {
        v49 = BWStringFromCaptureDeviceType(*(v1 + 588));
        v50 = OUTLINED_FUNCTION_309([(BWStreamingSessionAnalyticsPayload *)v2 streamingTime]);
        LODWORD(time2.value) = 136315650;
        *(&time2.value + 4) = "[BWFigVideoCaptureDevice _reportStreamingSessionCoreAnalyticsData]";
        LOWORD(time2.flags) = 2112;
        *(&time2.flags + 2) = v49;
        HIWORD(time2.epoch) = 2048;
        v53 = v50;
        OUTLINED_FUNCTION_2_1();
        OUTLINED_FUNCTION_4_4();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_39_0();
    }

    return [+[BWCoreAnalyticsReporter sharedInstance](BWCoreAnalyticsReporter sendEvent:"sendEvent:", v2];
  }

  return result;
}

- (uint64_t)_setPropertySensorRawBufferPoolRetainCount:(id *)count
{
  if (!count)
  {
    return 0;
  }

  if ([count isBravoVariant] && objc_msgSend(objc_msgSend(objc_msgSend(count[81], "syncGroup"), "supportedProperties"), "objectForKeyedSubscript:", *off_1E798CCF0))
  {
    [count[81] syncGroup];
    [MEMORY[0x1E696AD98] numberWithInt:a2];
    v4 = [OUTLINED_FUNCTION_39() setProperty:? value:?];
    if (v4)
    {
      goto LABEL_8;
    }

    return v4;
  }

  if (![objc_msgSend(objc_msgSend(count[75] "stream")])
  {
    return 0;
  }

  [count[75] stream];
  [MEMORY[0x1E696AD98] numberWithInt:a2];
  v4 = [OUTLINED_FUNCTION_39() setProperty:? value:?];
  if (v4)
  {
LABEL_8:
    OUTLINED_FUNCTION_0_6();
    FigDebugAssert3();
  }

  return v4;
}

- (void)_sensorRawPoolsRequirements
{
  OUTLINED_FUNCTION_84();
  v2 = v1;
  v3 = v0;
  if (v0)
  {
    v31 = 0;
    if ([v0 isBravoVariant])
    {
      v4 = [objc_msgSend(v3[81] "syncGroup")];
      if (v31)
      {
        goto LABEL_23;
      }
    }

    else
    {
      v4 = [objc_msgSend(v3[75] "stream")];
      if (v31)
      {
LABEL_23:
        OUTLINED_FUNCTION_14_21();
        FigDebugAssert3();
        goto LABEL_22;
      }
    }

    if ([v4 count])
    {
      v5 = *MEMORY[0x1E6966208];
      v30[0] = *MEMORY[0x1E6966160];
      v30[1] = v5;
      v6 = *MEMORY[0x1E6966020];
      v30[2] = *MEMORY[0x1E69660B8];
      v30[3] = v6;
      v7 = *MEMORY[0x1E6966130];
      v30[4] = *MEMORY[0x1E6966140];
      v30[5] = v7;
      [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:6];
      *&v8 = OUTLINED_FUNCTION_181();
      v29[0] = v8;
      v29[1] = v8;
      v29[2] = v8;
      v29[3] = v8;
      v11 = OUTLINED_FUNCTION_1_18(v9, v10, v29, v28);
      if (v11)
      {
        v12 = v11;
        while (2)
        {
          for (i = 0; i != v12; ++i)
          {
            OUTLINED_FUNCTION_89();
            if (!v14)
            {
              objc_enumerationMutation(v4);
            }

            v15 = *(*(&v29[0] + 1) + 8 * i);
            OUTLINED_FUNCTION_17_20();
            v20 = OUTLINED_FUNCTION_37(v16, v17, v18, v19);
            if (v20)
            {
              v22 = v20;
LABEL_14:
              v23 = 0;
              while (1)
              {
                OUTLINED_FUNCTION_50_3();
                if (!v14)
                {
                  objc_enumerationMutation(v2);
                }

                if (![v15 objectForKeyedSubscript:*(8 * v23)])
                {
                  goto LABEL_22;
                }

                if (v22 == ++v23)
                {
                  OUTLINED_FUNCTION_17_20();
                  v20 = OUTLINED_FUNCTION_37(v24, v25, v26, v27);
                  v22 = v20;
                  if (v20)
                  {
                    goto LABEL_14;
                  }

                  break;
                }
              }
            }
          }

          v12 = OUTLINED_FUNCTION_1_18(v20, v21, v29, v28);
          if (v12)
          {
            continue;
          }

          break;
        }
      }
    }
  }

LABEL_22:
  OUTLINED_FUNCTION_81();
}

- (void)_servicePropertyChangeNotifications:(uint64_t)notifications
{
  if (!notifications)
  {
    return;
  }

  OUTLINED_FUNCTION_134_4();
  v90 = v1;
  v91 = v2;
  v4 = v3;
  v6 = OUTLINED_FUNCTION_4_12(v5, *off_1E798A3C8);
  v89[0] = **&MEMORY[0x1E6960C70];
  v88 = 0.0;
  v87 = 0;
  v86 = 0.0;
  __s1 = 0;
  if (qword_1ED8451B0 != -1)
  {
    dispatch_once(&qword_1ED8451B0, &__block_literal_global_431);
  }

  v7 = [objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B4D8), "intValue"}];
  v8 = *(v4 + 2824);
  v9 = [objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B4D0), "intValue"}];
  v10 = *(v4 + 2828);
  v11 = [objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B2A0), "intValue"}];
  v68 = *(v4 + 2832);
  v69 = v11;
  v12 = [objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B4E0), "intValue"}];
  v66 = *(v4 + 2836);
  v67 = v12;
  isBravoVariant = [v4 isBravoVariant];
  v14 = v6;
  if (isBravoVariant)
  {
    v15 = [v6 objectForKeyedSubscript:*off_1E798B540];
    v16 = *off_1E798A0C0;
    v17 = [v15 isEqualToString:*off_1E798A0C0];
    v14 = v6;
    if ((v17 & 1) == 0)
    {
      v14 = [objc_msgSend(v6 objectForKeyedSubscript:{*off_1E798B730), "objectForKeyedSubscript:", v16}];
    }
  }

  if (v14)
  {
    v18 = off_1E798B4A8;
    if (*(v4 + 2056) != 8)
    {
      v18 = off_1E798B208;
    }

    v19 = [v14 objectForKeyedSubscript:*v18];
    if (v19)
    {
      v20 = ([v19 intValue] / -255.0) + 1.0;
    }

    else
    {
      v20 = 0.0;
    }
  }

  else
  {
    v20 = *(v4 + 2856);
  }

  v21 = [v6 objectForKeyedSubscript:*off_1E798B2A8];
  if (v21)
  {
    [v21 doubleValue];
    CMTimeMakeWithSeconds(v89, v22, 1000000000);
  }

  v23 = [v6 objectForKeyedSubscript:*off_1E798B3B0];
  v24 = 0.0;
  v25 = 0.0;
  if (v23)
  {
    [v23 floatValue];
    v25 = v26;
  }

  v27 = [v6 objectForKeyedSubscript:*off_1E798B298];
  v28 = v27;
  if (v27)
  {
    [v27 floatValue];
    v24 = v29;
  }

  v30 = [v6 objectForKeyedSubscript:*off_1E798B120];
  v31 = [v6 objectForKeyedSubscript:*off_1E798B0F8];
  v32 = [v6 objectForKeyedSubscript:*off_1E798B0C0];
  if (v30)
  {
    if (v31)
    {
      v33 = v32;
      if (v32)
      {
        [v30 floatValue];
        [v31 floatValue];
        [v33 floatValue];
        OUTLINED_FUNCTION_220();
        v87 = __PAIR64__(v35, v34);
        v88 = v36 / v37;
      }
    }
  }

  v38 = [v6 objectForKeyedSubscript:*off_1E798B110];
  v39 = [v6 objectForKeyedSubscript:*off_1E798B108];
  v40 = [v6 objectForKeyedSubscript:*off_1E798B100];
  if (v38)
  {
    if (v39)
    {
      v41 = v40;
      if (v40)
      {
        [v38 floatValue];
        [v39 floatValue];
        [v41 floatValue];
        OUTLINED_FUNCTION_220();
        __s1 = __PAIR64__(v43, v42);
        v86 = v44 / v45;
      }
    }
  }

  v46 = [v6 objectForKeyedSubscript:*off_1E798B088];
  v47 = [v6 objectForKeyedSubscript:*off_1E798B048];
  if (v46)
  {
    v48 = v47 == 0;
  }

  else
  {
    v48 = 1;
  }

  v49 = !v48;
  v50 = 0.0;
  if (!v48)
  {
    [v47 floatValue];
    v52 = v51;
    [v46 floatValue];
    v50 = log2f(v52 / v53);
  }

  FigSimpleMutexLock();
  if (v20 == *(v4 + 2856))
  {
    v54 = 0;
  }

  else
  {
    *(v4 + 2856) = v20;
    v54 = 1;
    if ((_MergedGlobals_12 & 1) == 0 && v7 <= v8)
    {
      v54 = [v4 isPropertyObserved:@"LensPosition"];
    }
  }

  OUTLINED_FUNCTION_342();
  time2 = *(v4 + 2860);
  if (CMTimeCompare(&time1, &time2))
  {
    *(v4 + 2860) = v89[0];
    v55 = 1;
    if ((_MergedGlobals_12 & 1) == 0 && v9 <= v10)
    {
      v55 = [v4 isPropertyObserved:@"ExposureDuration"];
    }
  }

  else
  {
    v55 = 0;
  }

  if (v25 == *(v4 + 2884))
  {
    v56 = 0;
    if (!v28)
    {
      goto LABEL_59;
    }
  }

  else
  {
    *(v4 + 2884) = v25;
    v56 = 1;
    if ((_MergedGlobals_12 & 1) == 0 && v9 <= v10)
    {
      v56 = [v4 isPropertyObserved:@"ISO"];
    }

    if (!v28)
    {
      goto LABEL_59;
    }
  }

  if (v24 != *(v4 + 2888) || v69 > v68)
  {
    *(v4 + 2888) = v24;
    v70 = 1;
    if (!v49)
    {
      goto LABEL_63;
    }

    goto LABEL_60;
  }

LABEL_59:
  v70 = 0;
  if (!v49)
  {
LABEL_63:
    v58 = 0;
    goto LABEL_64;
  }

LABEL_60:
  if (v50 == *(v4 + 2892))
  {
    goto LABEL_63;
  }

  *(v4 + 2892) = v50;
  if (_MergedGlobals_12)
  {
    v58 = 1;
  }

  else
  {
    v58 = [v4 isPropertyObserved:@"ExposureTargetOffset"];
  }

LABEL_64:
  if (!memcmp(&v87, (v4 + 2896), 0xCuLL))
  {
    v59 = 0;
  }

  else
  {
    *(v4 + 2896) = v87;
    *(v4 + 2904) = v88;
    v59 = 1;
    if ((_MergedGlobals_12 & 1) == 0 && v67 <= v66)
    {
      v59 = [v4 isPropertyObserved:@"DeviceWhiteBalanceGains"];
    }
  }

  if (!memcmp(&__s1, (v4 + 2908), 0xCuLL))
  {
    v60 = 0;
  }

  else
  {
    *(v4 + 2908) = __s1;
    *(v4 + 2916) = v86;
    if (_MergedGlobals_12)
    {
      v60 = 1;
    }

    else
    {
      v60 = [v4 isPropertyObserved:@"GrayWorldDeviceWhiteBalanceGains"];
    }
  }

  FigSimpleMutexUnlock();
  if (!v54)
  {
    if (!v55)
    {
      goto LABEL_76;
    }

LABEL_89:
    v79 = @"NewPropertyValue";
    OUTLINED_FUNCTION_342();
    v80 = CMTimeCopyAsDictionary(&time1, v65);
    [v4 _postNotificationWithPayload:@"ExposureDurationChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v80, &v79, 1)}];
    if (!v56)
    {
      goto LABEL_78;
    }

    goto LABEL_77;
  }

  v81 = @"NewPropertyValue";
  *&v61 = v20;
  v82 = [MEMORY[0x1E696AD98] numberWithFloat:v61];
  [v4 _postNotificationWithPayload:@"LensPositionChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v82, &v81, 1)}];
  if (v55)
  {
    goto LABEL_89;
  }

LABEL_76:
  if (v56)
  {
LABEL_77:
    v77 = @"NewPropertyValue";
    *&v61 = v25;
    v78 = [MEMORY[0x1E696AD98] numberWithFloat:v61];
    [v4 _postNotificationWithPayload:@"ISOChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v78, &v77, 1)}];
  }

LABEL_78:
  if (v70)
  {
    v75 = @"NewPropertyValue";
    *&v61 = v24;
    v76 = [MEMORY[0x1E696AD98] numberWithFloat:v61];
    [v4 _postNotificationWithPayload:@"ExposureTargetBiasChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v76, &v75, 1)}];
  }

  if (v58)
  {
    v73 = @"NewPropertyValue";
    *&v61 = v50;
    v74 = [MEMORY[0x1E696AD98] numberWithFloat:v61];
    [v4 _postNotificationWithPayload:@"ExposureTargetOffsetChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v74, &v73, 1)}];
  }

  if (v59)
  {
    v71 = @"NewPropertyValue";
    v72 = [MEMORY[0x1E695DEF0] dataWithBytes:&v87 length:12];
    [v4 _postNotificationWithPayload:@"WhiteBalanceGainsChanged" notificationPayload:{objc_msgSend(MEMORY[0x1E695DF20], "dictionaryWithObjects:forKeys:count:", &v72, &v71, 1)}];
  }

  if (v60)
  {
    [MEMORY[0x1E695DEF0] dataWithBytes:&__s1 length:12];
    [v4 _postNotificationWithPayload:@"GrayWorldWhiteBalanceGainsChanged" notificationPayload:{OUTLINED_FUNCTION_41(MEMORY[0x1E695DF20], v62, v63, v64)}];
  }

  OUTLINED_FUNCTION_133_5();
}

- (void)_postManualControlRequestCompletedWithName:(uint64_t)name requestID:(uint64_t)d timeDictionary:(uint64_t)dictionary additionalPayloadItems:(uint64_t)items
{
  if (self)
  {
    OUTLINED_FUNCTION_91();
    a43 = v44;
    a44 = v45;
    v47 = v46;
    v49 = v48;
    v51 = v50;
    v53 = v52;
    objc_alloc(MEMORY[0x1E695DF90]);
    [MEMORY[0x1E696AD98] numberWithInt:v49];
    v54 = [OUTLINED_FUNCTION_221() initWithObjectsAndKeys:?];
    a29 = 0u;
    a30 = 0u;
    a31 = 0u;
    a32 = 0u;
    allKeys = [v47 allKeys];
    v56 = [allKeys countByEnumeratingWithState:&a29 objects:&a13 count:16];
    if (v56)
    {
      v57 = v56;
      do
      {
        for (i = 0; i != v57; ++i)
        {
          OUTLINED_FUNCTION_50_3();
          if (!v59)
          {
            objc_enumerationMutation(allKeys);
          }

          [v47 objectForKeyedSubscript:*(*(&a29 + 1) + 8 * i)];
          v60 = [OUTLINED_FUNCTION_7() setObject:? forKeyedSubscript:?];
        }

        v57 = OUTLINED_FUNCTION_1_0(v60, v61, &a29, &a13);
      }

      while (v57);
    }

    [v53 _postNotificationWithPayload:v51 notificationPayload:v54];

    OUTLINED_FUNCTION_90_3();
  }
}

- (uint64_t)_copyCurrentFrameStatistics
{
  if (!self)
  {
    return 0;
  }

  v2 = [BWFrameStatisticsByPortType alloc];
  [*(self + 2144) portTypes];
  v3 = [OUTLINED_FUNCTION_4() initWithPortTypes:?];
  os_unfair_lock_lock((self + 2140));
  [*(self + 2144) copyTo:v3];
  os_unfair_lock_unlock((self + 2140));
  return v3;
}

- (BWStillImageCaptureSettings)_ubStillImageCaptureSettingsWithSettings:(unsigned __int8)settings speedOverQualityCaptureEnabled:
{
  if (!self)
  {
    return 0;
  }

  if (!objc_loadWeak((self + 2656)))
  {
    OUTLINED_FUNCTION_62();
    OUTLINED_FUNCTION_88_6();
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v105 = OUTLINED_FUNCTION_72_6(os_log_and_send_and_compose_flags_and_os_log_type);
    if (OUTLINED_FUNCTION_5_2(v105))
    {
      OUTLINED_FUNCTION_43_0();
      OUTLINED_FUNCTION_209();
      OUTLINED_FUNCTION_7_4();
      _os_log_send_and_compose_impl();
    }

    OUTLINED_FUNCTION_1_4();
    OUTLINED_FUNCTION_16_1();
    return 0;
  }

  if ([self isBravoVariant])
  {
    masterCaptureStream = [self masterCaptureStream];
  }

  else
  {
    masterCaptureStream = *(self + 600);
  }

  v7 = objc_alloc_init(BWStillImageCaptureMetadata);
  v151 = 0;
  _copyCurrentFrameStatistics = [(BWFigVideoCaptureDevice *)self _copyCurrentFrameStatistics];
  [a2 stillImageRequestTime];
  v9 = FigHostTimeToNanoseconds();
  OUTLINED_FUNCTION_360(v9);
  [(BWFigVideoCaptureDevice *)self _updateCurrentStillSmartCameraState];
  if ([*(self + 3424) isValid])
  {
    [(BWStillImageCaptureMetadata *)v7 setSmartCamVersion:*(self + 3408)];
    v10 = *(self + 3424);
    if (v10)
    {
      [v10 timestamp];
    }

    else
    {
      v149 = 0uLL;
      v150 = 0;
    }

    v152 = v149;
    v153 = v150;
    [(BWStillImageCaptureMetadata *)v7 setSmartCamTimestamp:&v152];
    [*(self + 3424) inferences];
    [OUTLINED_FUNCTION_17() setSmartCamInferences:?];
    [(BWStillImageCaptureMetadata *)v7 setIsPreviewSmartCamInferences:1];
    os_unfair_lock_lock((self + 2140));
    [(BWStillImageCaptureMetadata *)v7 setSemanticStyleSceneType:*(self + 3384)];
    os_unfair_lock_unlock((self + 2140));
  }

  v136 = v7;
  LODWORD(v11) = [a2 qualityPrioritization];
  LODWORD(v12) = [a2 HDRMode];
  if ([a2 flashMode] != 2)
  {
    [a2 autoStereoPhotoCaptureEnabled];
  }

  [BWFigVideoCaptureDevice _ubStillImageSceneFlagsForCaptureStream:self frameStatisticsByPortType:? fusionEnabled:? metadata:? sceneMonitoring:? zoomFactorOverride:?];
  v14 = v13;
  if ([a2 autoDeferredProcessingEnabled])
  {
    canDefer = [+[BWDeferredCaptureContainerManager sharedInstance](BWDeferredCaptureContainerManager canDefer];
  }

  else
  {
    canDefer = 1;
  }

  settingsCopy = settings;
  v16 = v11 > 1;
  v147 = 0;
  v146 = 0;
  v17 = [objc_msgSend(_copyCurrentFrameStatistics objectForKeyedSubscript:{objc_msgSend(masterCaptureStream, "portType")), "ltmCurve"}] == 2;
  if (v17 && v16)
  {
    v12 = 0;
  }

  else
  {
    v12 = v12;
  }

  if (v17 && v16)
  {
    v11 = 1;
  }

  else
  {
    v11 = v11;
  }

  v18 = [a2 bracketType] != 0;
  [masterCaptureStream portType];
  v19 = OUTLINED_FUNCTION_17_26();
  LODWORD(v127) = v12;
  [(BWFigVideoCaptureDevice *)v19 _ubResolveStillImageCaptureTypeWithSettings:v20 sceneFlags:v14 hdrMode:v12 qualityPrioritization:v11 clientBracket:v18 canDefer:canDefer primaryPortType:v21 speedOverQualityInOut:&settingsCopy speedOverQualityDowngradeOut:&v147, v112, v114, v116, v119, v122, v125, v127, _copyCurrentFrameStatistics, v133, v136, v139, v142];
  v23 = v22;
  OUTLINED_FUNCTION_17_26();
  [BWFigVideoCaptureDevice _ubDeliverDepthDataForSettings:speedOverQuality:sceneFlags:];
  v25 = v24;
  portType = [masterCaptureStream portType];
  resolutionFlavor = [a2 resolutionFlavor];
  constituentPhotoDeliveryEnabled = [a2 constituentPhotoDeliveryEnabled];
  autoDeferredProcessingEnabled = [a2 autoDeferredProcessingEnabled];
  IsDemosaicedRaw = FigCapturePixelFormatIsDemosaicedRaw([a2 rawOutputFormat]);
  HIDWORD(v128) = canDefer;
  v106 = autoDeferredProcessingEnabled;
  HIDWORD(v134) = v23;
  v30 = v11;
  v31 = v11;
  v32 = v25;
  [(BWFigVideoCaptureDevice *)self _ubIsRequestedHighResolutionFlavorSupportedForCaptureType:v23 portType:portType qualityPrioritization:v31 requestedHighResolutionFlavor:resolutionFlavor sceneFlags:v14 deliverDepthData:v25 bravoConstituentPhotoCapture:constituentPhotoDeliveryEnabled autoDeferredProcessingEnabled:v106 canDefer:canDefer demosaicedRawRequested:IsDemosaicedRaw isUltraHighResolutionDowngradeOut:&v146];
  resolutionFlavor2 = OUTLINED_FUNCTION_349();
  if (v34)
  {
    resolutionFlavor2 = [a2 resolutionFlavor];
  }

  v35 = v137;
  BYTE1(v109) = canDefer;
  LOBYTE(v109) = v146;
  v107 = __PAIR64__(resolutionFlavor2, v30);
  v36 = v30;
  v37 = v23;
  v38 = v128;
  [(BWFigVideoCaptureDevice *)self _ubResolveStillImageCaptureFlagsForCaptureType:v14 sceneFlags:a2 settings:v131 frameStatisticsByPortType:v128 hdrMode:settingsCopy speedOverQuality:v147 speedOverQualityDowngrade:v107 qualityPrioritization:v109 highResolutionFlavor:&v151 ultraHighResolutionDowngrade:v137 canDefer:v117 zeroShutterLagFailureReasonOut:v120 metadata:portType, self, v128, v131, v134, v137, v140, SHIDWORD(v140), v143, HIBYTE(v143), v144];
  v40 = v39;
  v41 = *(self + 2176) != 2 || v37 == 1;
  if (v41 || settingsCopy != 1 || *(self + 3448) != 1 || (v39 & 0x2000) != 0)
  {
    [v35 setZeroShutterLagFailureReason:v151];
    if (v37 > 0xD)
    {
      goto LABEL_39;
    }

    if (((1 << v37) & 0x3CC4) != 0)
    {
      v43 = OUTLINED_FUNCTION_17_26();
      [(BWFigVideoCaptureDevice *)v43 _ubIsBravoMultiCameraCaptureForSettings:v44 sceneFlags:v14 deliverDepthData:v32];
      v45 = v37 == 10;
      v46 = v37 - 2;
      v47 = v132;
      switch(v46)
      {
        case 0:
          if ((v40 & 8) == 0)
          {
            v48 = 2;
            goto LABEL_58;
          }

          [a2 settingsID];
          rawOutputFormat = [OUTLINED_FUNCTION_25_0() rawOutputFormat];
          IsBayerRaw = FigCapturePixelFormatIsBayerRaw(rawOutputFormat);
          [a2 bravoConstituentImageDeliveryDeviceTypes];
          HIDWORD(v135) = 2;
          v67 = OUTLINED_FUNCTION_9_19();
          LODWORD(canDefer) = HIDWORD(v129);
          [(BWFigVideoCaptureDevice *)v67 _ubFlashStillImageCaptureSettingsWithID:v68 captureType:2 captureFlags:v40 sceneFlags:v14 frameStatisticsByPortType:v132 deliverSushiRaw:IsBayerRaw bravoConstituentImageDeliveryDeviceTypes:v69, v108, v110, v113, v115, v118, v121, v124, v126, v129, v132, v135, v138];
          goto LABEL_56;
        case 5:
          if (*(self + 1560))
          {
            v48 = 7;
LABEL_58:
            HIDWORD(v135) = v48;
            goto LABEL_79;
          }

          HIDWORD(v135) = 7;
          OUTLINED_FUNCTION_17_26();
          [BWFigVideoCaptureDevice _ubClientBracketStillImageCaptureSettings:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:];
LABEL_56:
          v70 = v52;
          break;
        case 8:
        case 10:
        case 11:
          goto LABEL_68;
        case 9:
          if (a2)
          {
            [a2 stillImageUserInitiatedRequestPTS];
          }

          else
          {
            v152 = 0uLL;
            v153 = 0;
          }

          HIDWORD(v135) = 11;
          OUTLINED_FUNCTION_17_26();
          [BWFigVideoCaptureDevice _ubAdaptiveStillImageCaptureSettingsWithSettings:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:];
          goto LABEL_56;
        default:
          goto LABEL_79;
      }

      goto LABEL_83;
    }

    if (v37 != 1)
    {
LABEL_39:
      FigCaptureGetFrameworkRadarComponent();
      OUTLINED_FUNCTION_62();
      OUTLINED_FUNCTION_88_6();
      v49 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v50 = v155;
      os_log_type_enabled(v49, v154);
      OUTLINED_FUNCTION_39_7();
      if (!v41)
      {
        v51 = v50;
      }

      if (v51)
      {
        *v141 = 136315394;
        *&v141[4] = "[BWFigVideoCaptureDevice _ubStillImageCaptureSettingsWithSettings:speedOverQualityCaptureEnabled:]";
        *&v141[12] = 2112;
        *&v141[14] = BWPhotoEncoderStringFromEncodingScheme(v37);
        OUTLINED_FUNCTION_34_16();
        OUTLINED_FUNCTION_209();
        OUTLINED_FUNCTION_13();
        _os_log_send_and_compose_impl();
        OUTLINED_FUNCTION_297();
      }

      OUTLINED_FUNCTION_8_1();
      OUTLINED_FUNCTION_17_8();
      v56 = BWPhotoEncoderStringFromEncodingScheme(v37);
      LODWORD(v152) = 138412290;
      *(&v152 + 4) = v56;
      OUTLINED_FUNCTION_43_0();
      OUTLINED_FUNCTION_5_61();
      v57 = _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_11();
      OUTLINED_FUNCTION_1_19();
      OUTLINED_FUNCTION_10();
      FigCapturePleaseFileRadar(v58, v59, v60, v61, v62, 17456, v63, v64, &v152);
      free(v57);
      LODWORD(v38) = v129;
    }
  }

  else
  {
    if (dword_1ED844350)
    {
      OUTLINED_FUNCTION_62();
      v53 = OUTLINED_FUNCTION_39_10();
      v54 = v155;
      v124 = v53;
      HIDWORD(v121) = v154;
      os_log_type_enabled(v53, v154);
      OUTLINED_FUNCTION_286();
      if (!v41)
      {
        v55 = v54;
      }

      if (v55)
      {
        *v141 = 136315650;
        *&v141[4] = "[BWFigVideoCaptureDevice _ubStillImageCaptureSettingsWithSettings:speedOverQualityCaptureEnabled:]";
        *&v141[14] = BWPhotoEncoderStringFromEncodingScheme(1);
        v38 = v129;
        LOBYTE(canDefer) = BYTE4(v129);
        *&v141[22] = 2112;
        v145 = BWPhotoEncoderStringFromEncodingScheme(v37);
        OUTLINED_FUNCTION_29_12();
        OUTLINED_FUNCTION_209();
        OUTLINED_FUNCTION_13();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_371();
      v42 = settingsCopy;
    }

    else
    {
      v42 = 1;
    }

    BYTE1(v110) = canDefer;
    LOBYTE(v110) = v146;
    [(BWFigVideoCaptureDevice *)self _ubResolveStillImageCaptureFlagsForCaptureType:v14 sceneFlags:a2 settings:v132 frameStatisticsByPortType:v38 hdrMode:v42 & 1 speedOverQuality:v147 speedOverQualityDowngrade:v36 qualityPrioritization:v110 highResolutionFlavor:&v151 ultraHighResolutionDowngrade:v35 canDefer:v118 zeroShutterLagFailureReasonOut:v121 metadata:v124, v126, v129, v132, v135, v138, *v141, *&v141[4], v141[8], v141[9], *&v141[16]];
    v40 = v71;
    [v35 setZeroShutterLagFailureReason:v151];
  }

  if ((*(self + 3448) & 1) != 0 || (v40 & 0x8180) != 0)
  {
    v75 = OUTLINED_FUNCTION_17_26();
    [(BWFigVideoCaptureDevice *)v75 _ubIsBravoMultiCameraCaptureForSettings:v76 sceneFlags:v14 deliverDepthData:v32];
    v45 = 0;
    HIDWORD(v135) = 1;
  }

  else
  {
    v72 = BYTE4(v40) & 1 | *(self + 2242) & ((v40 & 4) != 0);
    v73 = OUTLINED_FUNCTION_17_26();
    [(BWFigVideoCaptureDevice *)v73 _ubIsBravoMultiCameraCaptureForSettings:v74 sceneFlags:v14 deliverDepthData:v32];
    HIDWORD(v135) = 1;
    if ((v72 & 1) == 0)
    {
LABEL_79:
      [a2 settingsID];
      rawOutputFormat2 = [OUTLINED_FUNCTION_25_0() rawOutputFormat];
      v85 = FigCapturePixelFormatIsBayerRaw(rawOutputFormat2);
      bravoConstituentImageDeliveryDeviceTypes = [a2 bravoConstituentImageDeliveryDeviceTypes];
      v87 = OUTLINED_FUNCTION_17_26();
      v90 = [(BWFigVideoCaptureDevice *)v87 _clientBracketSettingsWithSettings:v88 frameStatisticsByPortType:v89];
      if (a2)
      {
        [a2 stillImageUserInitiatedRequestPTS];
      }

      else
      {
        v152 = 0uLL;
        v153 = 0;
      }

      v91 = OUTLINED_FUNCTION_9_19();
      v92 = bravoConstituentImageDeliveryDeviceTypes;
      v47 = v93;
      v70 = [(BWFigVideoCaptureDevice *)v91 _stillImageCaptureSettingsWithID:v94 captureType:HIDWORD(v135) deliverOriginalImage:0 deliverSushiRaw:v85 bravoConstituentImageDeliveryDeviceTypes:v92 clientBracketSettings:v90 captureFlags:v40 userInitiatedRequestPTS:&v152 frameStatisticsByPortType:v132];
      [(BWStillImageCaptureSettings *)v70 setSceneFlags:v14];
      LODWORD(canDefer) = HIDWORD(v129);
      v35 = v138;
      goto LABEL_83;
    }

    v45 = 0;
  }

  v47 = v132;
LABEL_68:
  providesOriginalImage = [a2 providesOriginalImage];
  v78 = 0;
  if (v45 && providesOriginalImage && (v40 & 0x100000) != 0)
  {
    v78 = ((v14 & 4) != 0 || v38 == 1) && [objc_msgSend(a2 "bravoConstituentImageDeliveryDeviceTypes")] == 0;
  }

  [a2 settingsID];
  if (a2)
  {
    [a2 stillImageUserInitiatedRequestPTS];
  }

  else
  {
    v152 = 0uLL;
    v153 = 0;
  }

  v79 = FigCapturePixelFormatIsBayerRaw([a2 rawOutputFormat]);
  bravoConstituentImageDeliveryDeviceTypes2 = [a2 bravoConstituentImageDeliveryDeviceTypes];
  BYTE1(v108) = v79;
  LOBYTE(v108) = v78;
  v80 = OUTLINED_FUNCTION_9_19();
  v35 = v138;
  [(BWFigVideoCaptureDevice *)v80 _ubStillImageCaptureSettingsWithID:v81 userInitiatedRequestPTS:v82 captureType:HIDWORD(v135) captureFlags:v40 sceneFlags:v14 frameStatisticsByPortType:v47 metadata:v138 deliverOriginalImage:v108 deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes2 bravoConstituentImageDeliveryDeviceTypes:v113, v115, v118, v121, v124, v126, v129, v132, v135, v138, *v141, *&v141[8], v141[16], v141[17], v145];
  v70 = v83;
  LODWORD(canDefer) = v130;
LABEL_83:
  captureFlags = [(BWStillImageCaptureSettings *)v70 captureFlags];
  v96 = captureFlags;
  if ((captureFlags & 0x2004) == 4 && ((captureFlags & 8) != 0 || *(self + 2242) == 1))
  {
    [(BWStillImageCaptureSettings *)v70 masterPortType];
    v103 = OUTLINED_FUNCTION_4();
    [BWFigVideoCaptureDevice _ubWhiteBalanceMetadataByPortTypeFromFrameStatistics:v103 masterPortType:v47];
    [OUTLINED_FUNCTION_15() setPreviewWhiteBalanceMetadataByPortType:?];
    if (!canDefer)
    {
      goto LABEL_87;
    }
  }

  else if (!canDefer)
  {
LABEL_87:
    v97 = 0;
    goto LABEL_88;
  }

  v97 = -[BWFigVideoCaptureDevice _ubDeliverDeferredPhotoProxyImageForCaptureType:captureFlags:autoDeferredProcessingEnabled:](self, SHIDWORD(v135), v96, [a2 autoDeferredProcessingEnabled]);
LABEL_88:
  [(BWStillImageCaptureSettings *)v70 setDeliverDeferredPhotoProxyImage:v97];
  if ([v35 zeroShutterLagFailureReason] && dword_1ED844350)
  {
    OUTLINED_FUNCTION_62();
    v98 = OUTLINED_FUNCTION_39_10();
    v99 = v155;
    os_log_type_enabled(v98, v154);
    OUTLINED_FUNCTION_115_0();
    if (v41)
    {
      v101 = v100;
    }

    else
    {
      v101 = v99;
    }

    if (v101)
    {
      BWPhotoEncoderStringFromEncodingScheme(v151);
      OUTLINED_FUNCTION_34_16();
      OUTLINED_FUNCTION_209();
      OUTLINED_FUNCTION_8_0();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_17_32();
    }

    OUTLINED_FUNCTION_2_4();
    OUTLINED_FUNCTION_13_0();
  }

  [(BWStillImageCaptureSettings *)v70 setMetadata:v35];
  return v70;
}

- (BWStillImageCaptureSettings)_stillImageCaptureSettingsWithSettings:(uint64_t)settings
{
  if (!settings)
  {
    return 0;
  }

  if (*(settings + 2652) >= 3)
  {
    FigCaptureGetFrameworkRadarComponent();
    OUTLINED_FUNCTION_62();
    OUTLINED_FUNCTION_201();
    OUTLINED_FUNCTION_88_6();
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v28 = OUTLINED_FUNCTION_90_4(os_log_and_send_and_compose_flags_and_os_log_type);
    if (OUTLINED_FUNCTION_5_24(v28))
    {
      v29 = *(settings + 2652);
      v44 = 136315394;
      v45 = "[BWFigVideoCaptureDevice _stillImageCaptureSettingsWithSettings:]";
      v46 = 1024;
      v47 = v29;
      OUTLINED_FUNCTION_3_89();
      OUTLINED_FUNCTION_4_4();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_17_32();
    }

    OUTLINED_FUNCTION_8_1();
    OUTLINED_FUNCTION_13_0();
    v30 = *(settings + 2652);
    LODWORD(v48) = 67109120;
    DWORD1(v48) = v30;
    OUTLINED_FUNCTION_305();
    OUTLINED_FUNCTION_5_61();
    v31 = _os_log_send_and_compose_impl();
    OUTLINED_FUNCTION_11();
    OUTLINED_FUNCTION_44();
    OUTLINED_FUNCTION_10();
    FigCapturePleaseFileRadar(v32, v33, v34, v35, v36, 8198, v37, v38, &v48);
    free(v31);
    return 0;
  }

  if ([settings isBravoVariant])
  {
    masterCaptureStream = [settings masterCaptureStream];
  }

  else
  {
    masterCaptureStream = *(settings + 600);
  }

  _copyCurrentFrameStatistics = [(BWFigVideoCaptureDevice *)settings _copyCurrentFrameStatistics];
  v6 = OUTLINED_FUNCTION_3_19();
  v7 = [BWFigVideoCaptureDevice _deliverDepthDataForSettings:v6];
  v43 = 0;
  flashMode = [a2 flashMode];
  hDRMode = [a2 HDRMode];
  qualityPrioritization = [a2 qualityPrioritization];
  bravoImageFusionMode = [a2 bravoImageFusionMode];
  [a2 bravoConstituentImageDeliveryDeviceTypes];
  burstQualityCaptureEnabled = [OUTLINED_FUNCTION_217() burstQualityCaptureEnabled];
  bracketType = [a2 bracketType];
  v13 = OUTLINED_FUNCTION_70();
  v15 = [(BWFigVideoCaptureDevice *)v13 _resolveStillImageCaptureTypeFromStatisticsByPortType:v14 masterCaptureStream:masterCaptureStream flashMode:flashMode hdrMode:hDRMode qualityPrioritization:qualityPrioritization stereoFusionMode:bravoImageFusionMode depthDataDeliveryEnabled:v7 bravoConstituentImageDeliveryDeviceTypes:v2 burstQualityCaptureEnabled:burstQualityCaptureEnabled clientBracketMode:bracketType forSceneMonitoring:0 captureFlags:&v43];
  [a2 settingsID];
  providesOriginalImage = [OUTLINED_FUNCTION_352() providesOriginalImage];
  IsBayerRaw = FigCapturePixelFormatIsBayerRaw([a2 rawOutputFormat]);
  bravoConstituentImageDeliveryDeviceTypes = [a2 bravoConstituentImageDeliveryDeviceTypes];
  v19 = OUTLINED_FUNCTION_3_19();
  v21 = [(BWFigVideoCaptureDevice *)v19 _clientBracketSettingsWithSettings:v20 frameStatisticsByPortType:_copyCurrentFrameStatistics];
  v22 = v43;
  if (a2)
  {
    [a2 stillImageUserInitiatedRequestPTS];
  }

  else
  {
    v48 = 0uLL;
    v49 = 0;
  }

  v23 = [(BWFigVideoCaptureDevice *)settings _stillImageCaptureSettingsWithID:v7 captureType:v15 deliverOriginalImage:providesOriginalImage deliverSushiRaw:IsBayerRaw bravoConstituentImageDeliveryDeviceTypes:bravoConstituentImageDeliveryDeviceTypes clientBracketSettings:v21 captureFlags:v22 userInitiatedRequestPTS:&v48 frameStatisticsByPortType:_copyCurrentFrameStatistics];
  if ([*(settings + 3424) isValid])
  {
    [-[BWStillImageCaptureSettings metadata](v23 "metadata")];
    v24 = *(settings + 3424);
    if (v24)
    {
      [v24 timestamp];
    }

    else
    {
      v41 = 0uLL;
      v42 = 0;
    }

    metadata = [(BWStillImageCaptureSettings *)v23 metadata];
    v48 = v41;
    v49 = v42;
    [metadata setSmartCamTimestamp:&v48];
    [-[BWStillImageCaptureSettings metadata](v23 "metadata")];
    [-[BWStillImageCaptureSettings metadata](v23 "metadata")];
  }

  [a2 cmioCompressedFormat];
  [OUTLINED_FUNCTION_8() setCmioCompressedFormat:?];
  [a2 cmioHighResolutionPhotoEnabled];
  [OUTLINED_FUNCTION_8() setCmioHighResolutionPhotoEnabled:?];
  [a2 flashMode];
  [OUTLINED_FUNCTION_8() setCmioFlashMode:?];
  [a2 clientQualityPrioritization];
  [OUTLINED_FUNCTION_8() setCmioQualityPrioritization:?];
  -[BWStillImageCaptureSettings setCmioMaxPhotoDimensions:](v23, "setCmioMaxPhotoDimensions:", [a2 cmioMaxPhotoDimensionsWidth] | (objc_msgSend(a2, "cmioMaxPhotoDimensionsHeight") << 32));
  return v23;
}

- (uint64_t)_deliverDepthDataForSettings:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    if ([v3 depthDataDeliveryEnabled] & 1) != 0 || (BWCIFilterArrayContainsPortraitFilters(objc_msgSend(v2, "processedImageFilters")))
    {
      return 1;
    }

    else
    {
      result = [objc_msgSend(v2 "bravoConstituentImageDeliveryDeviceTypes")];
      if (result)
      {
        result = [v2 cameraCalibrationDataDeliveryEnabled];
        if (result)
        {
          return [objc_msgSend(*(v1 + 624) objectForKeyedSubscript:{@"ConstituentPhotoCalibrationData", "BOOLValue"}] ^ 1;
        }
      }
    }
  }

  return result;
}

- (id)_clientBracketSettingsWithSettings:(uint64_t)settings frameStatisticsByPortType:
{
  if (!self)
  {
    return 0;
  }

  OUTLINED_FUNCTION_7_3();
  if (![v6 bracketType])
  {
    return 0;
  }

  v7 = [BWBracketSettings bracketSettingsForBracketingMode:4];
  [v3 lensStabilizationDuringBracketEnabled];
  [OUTLINED_FUNCTION_17() setLensStabilizationEnabledForClientBracket:?];
  [*(v4 + 600) portType];
  [OUTLINED_FUNCTION_7() objectForKeyedSubscript:?];
  if ([OUTLINED_FUNCTION_133() bracketType] == 2)
  {
    v9 = OUTLINED_FUNCTION_2_42();
    [BWFigVideoCaptureDevice _autoExposureBracketValuesForSettings:v9 frameStatistics:?];
    [OUTLINED_FUNCTION_17() setExposureValues:?];
  }

  else if ([v3 bracketType] == 1)
  {
    v10 = OUTLINED_FUNCTION_2_42();
    [(BWFigVideoCaptureDevice *)v10 _manualExposureBracketParametersForSettings:v11 frameStatistics:settings use8dot8FixedPointGain:1];
    [OUTLINED_FUNCTION_17() setManualExposureBracketedCaptureParams:?];
  }

  return v7;
}

- (void)_zeroShutterLagStillImageCaptureSettingsWithID:(uint64_t)d captureType:(uint64_t)type deliverOriginalImage:(uint64_t)image deliverSushiRaw:(uint64_t)raw bravoConstituentImageDeliveryDeviceTypes:(uint64_t)types clientBracketSettings:(uint64_t)settings captureFlags:(uint64_t)flags userInitiatedRequestPTS:(uint64_t)self0 captureStreams:(uint64_t)self1 frameStatisticsByPortType:(uint64_t)self2
{
  if (self)
  {
    OUTLINED_FUNCTION_84();
    OUTLINED_FUNCTION_176();
    v30 = a22;
    v31 = (v26 & 0xFFFFFFFE) == 4 || v26 == 1;
    if (!v31 || (a22 & 0xFFFFFFFE) == 2)
    {
      goto LABEL_45;
    }

    v33 = v29;
    v34 = v28;
    v35 = v27;
    v36 = v25;
    portType = [*(v23 + 600) portType];
    portType2 = [*(v23 + 672) portType];
    v90 = **&MEMORY[0x1E6960C70];
    hasSphere = [*(v23 + 672) hasSphere];
    v40 = v24;
    if (v24 != 1)
    {
      if (v24 == 4)
      {
        if (a22 < 2)
        {
          v40 = 4;
          goto LABEL_26;
        }
      }

      else if (v24 == 5)
      {
        if (!a22)
        {
          v40 = 2;
          goto LABEL_26;
        }

        if (a22 == 1)
        {
          if (hasSphere)
          {
            v40 = 3;
          }

          else
          {
            v40 = 4;
          }

          goto LABEL_26;
        }
      }

      FigCaptureGetFrameworkRadarComponent();
      v89 = 0;
      v88 = 0;
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
      OUTLINED_FUNCTION_82_6();
      if (v31)
      {
        v43 = v42;
      }

      else
      {
        v43 = 0;
      }

      if (v43)
      {
        v83[1] = 136315394;
        v84 = "[BWFigVideoCaptureDevice _zeroShutterLagStillImageCaptureSettingsWithID:captureType:deliverOriginalImage:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:clientBracketSettings:captureFlags:userInitiatedRequestPTS:captureStreams:frameStatisticsByPortType:]";
        v85 = 2112;
        v86 = BWPhotoEncoderStringFromEncodingScheme(v24);
        OUTLINED_FUNCTION_34_16();
        OUTLINED_FUNCTION_242();
        OUTLINED_FUNCTION_47_2();
      }

      OUTLINED_FUNCTION_8_1();
      OUTLINED_FUNCTION_39_0();
      v44 = BWPhotoEncoderStringFromEncodingScheme(v24);
      LODWORD(v87[0].value) = 138412290;
      *(&v87[0].value + 4) = v44;
      OUTLINED_FUNCTION_43_0();
      OUTLINED_FUNCTION_5_61();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_13_18();
      OUTLINED_FUNCTION_26_22();
      FigCapturePleaseFileRadar(v45, v46, v47, v48, v49, 9000, v50, v51, v87);
      free(v24);
      goto LABEL_45;
    }

LABEL_26:
    v79 = v34;
    v83[0] = 0;
    v82[0] = 0;
    v82[1] = 0;
    v52 = *(v23 + 3496);
    if (v52)
    {
      v53 = [v52 count];
      if (v24 != 1 || v53 == *(v23 + 3456))
      {
        v76 = *(v23 + 3496);
        *&v87[0].value = *a21;
        v87[0].epoch = *(a21 + 16);
        if ([(BWFigVideoCaptureDevice *)v23 _tryZeroShutterLagReferenceFrameSelectionWithZeroShutterLagPTS:v87 captureType:v54 captureFlags:v55 framesMetadata:v76 frameCount:v40 referenceFrameBracketedCaptureSequenceNumberOut:v83 preferredPTSOut:&v90 selectedFramesRangeOut:v82])
        {
          v33 |= 0x2000uLL;
        }
      }

      else
      {
        v33 |= 0x2000uLL;
      }

      v57 = +[BWAggdDataReporter sharedInstance];
      if ((v33 & 0x2000) != 0)
      {
        [(BWAggdDataReporter *)v57 reportZeroShutterLagSuccess];
      }

      else
      {
        [(BWAggdDataReporter *)v57 reportZeroShutterLagReferenceFrameSelectionFailureForCaptureType:v24];
      }
    }

    if (v24 == 1 && (v33 & 0x2000) == 0)
    {
      v33 |= 0x2000uLL;
      if (*(v23 + 3496))
      {
        *&v90.value = *a21;
        v90.epoch = *(a21 + 16);
      }
    }

    if ((v33 & 0x2000) != 0)
    {
      if (v24 == 5)
      {
        v80 = *off_1E798B8D8;
        v81 = &unk_1F2249BA0;
        [MEMORY[0x1E695DF20] dictionaryWithObjects:&v81 forKeys:&v80 count:1];
        v78 = v36;
        if (a22 != 1)
        {
          if (!a22)
          {
            [+[BWBracketSettings bracketSettingsForBracketingMode:](BWBracketSettings bracketSettingsForBracketingMode:{3), "setProvidePreBracketedEV0:", *(v23 + 2685)}];
            [OUTLINED_FUNCTION_331() setOisBracketedCaptureParams:?];
            goto LABEL_52;
          }

          goto LABEL_53;
        }

        if ([*(v23 + 672) hasSphere])
        {
          [+[BWBracketSettings bracketSettingsForBracketingMode:](BWBracketSettings bracketSettingsForBracketingMode:{3), "setProvidePreBracketedEV0:", *(v23 + 2685)}];
          [OUTLINED_FUNCTION_331() setOisBracketedCaptureParams:?];
          v30 = 5;
          goto LABEL_59;
        }
      }

      else
      {
        if (v24 != 4)
        {
          v78 = v36;
          if (a22)
          {
            if (a22 != 1)
            {
              goto LABEL_53;
            }

LABEL_59:
            v59 = objc_alloc_init(MEMORY[0x1E695DF70]);
            v64 = [BWStillImageCaptureStreamSettings alloc];
            v63 = OUTLINED_FUNCTION_358(v64, v65, portType2, v30);
            [v59 addObject:v63];
            v62 = 0;
LABEL_60:
            LOBYTE(v77) = v79;
            v58 = [[BWStillImageCaptureSettings alloc] initWithSettingsID:v78 captureType:v24 captureFlags:v33 sceneFlags:0 frameStatisticsByPortType:a23 deliverOriginalImage:v35 deliverSushiRaw:v77 captureStreamSettings:v59];
            [(BWStillImageCaptureSettings *)v58 setTimeMachineReferenceFrameBracketedCaptureSequenceNumber:v83[0]];
            OUTLINED_FUNCTION_47_0();
            if (OUTLINED_FUNCTION_64(v66, v67, v68, v69))
            {
              while (1)
              {
                OUTLINED_FUNCTION_21_20();
                if (!v31)
                {
                  objc_enumerationMutation(v59);
                }

                v87[0] = v90;
                [MEMORY[0] setPreferredTimeMachinePTS:v87];
                OUTLINED_FUNCTION_131_2();
                if (v31)
                {
                  OUTLINED_FUNCTION_47_0();
                  if (!OUTLINED_FUNCTION_64(v70, v71, v72, v73))
                  {
                    break;
                  }
                }
              }
            }

            v74 = objc_alloc_init(BWStillImageCaptureMetadata);
            [OUTLINED_FUNCTION_4() setMetadata:?];

            if (v58)
            {
              goto LABEL_71;
            }

            goto LABEL_67;
          }

LABEL_52:
          v59 = objc_alloc_init(MEMORY[0x1E695DF70]);
          v60 = [BWStillImageCaptureStreamSettings alloc];
          v62 = OUTLINED_FUNCTION_358(v60, v61, portType, v24);
          [OUTLINED_FUNCTION_85_0() addObject:?];
LABEL_54:
          v63 = 0;
          goto LABEL_60;
        }

        v78 = v36;
        if (a22 != 1)
        {
          if (!a22)
          {
            [BWBracketSettings bracketSettingsForBracketingMode:2];
            goto LABEL_52;
          }

LABEL_53:
          v59 = objc_alloc_init(MEMORY[0x1E695DF70]);
          v62 = 0;
          goto LABEL_54;
        }
      }

      [BWBracketSettings bracketSettingsForBracketingMode:2];
      v30 = 4;
      goto LABEL_59;
    }

LABEL_45:
    v58 = 0;
LABEL_67:
    if (*(v23 + 3496))
    {
      OUTLINED_FUNCTION_240();
      if (v31)
      {
        [*(v23 + 3344) resume];
        [objc_msgSend(*(v23 + 600) "stream")];
      }
    }

LABEL_71:
    v75 = v58;
    OUTLINED_FUNCTION_81();
  }
}

- (uint64_t)_tryZeroShutterLagReferenceFrameSelectionWithZeroShutterLagPTS:(uint64_t)s captureType:(uint64_t)type captureFlags:(const __CFArray *)flags framesMetadata:(int)metadata frameCount:(_DWORD *)count referenceFrameBracketedCaptureSequenceNumberOut:(CMTime *)out preferredPTSOut:(void *)sOut selectedFramesRangeOut:
{
  if (result)
  {
    v13 = result;
    v20 = -1;
    v19 = -1;
    OUTLINED_FUNCTION_1_80(result, a2);
    FigCapturePTSBasedReferenceFrameSelection(0, flags, &v18, metadata, &v20, &v19);
    result = OUTLINED_FUNCTION_349();
    if (!v14)
    {
      v15 = v19;
      if ((v19 & 0x80000000) == 0)
      {
        if ([(__CFArray *)flags count]<= v15)
        {
          return 0;
        }

        else
        {
          result = [objc_msgSend(*(v13 + 3496) objectAtIndexedSubscript:{metadata + v20 - 1), "objectForKeyedSubscript:", *off_1E798A420}];
          if (result)
          {
            memset(&v17, 0, sizeof(v17));
            CMTimeMakeFromDictionary(&v17, result);
            v16 = v20;
            if (count)
            {
              *count = v19 - v20 + 1;
            }

            if (out)
            {
              *out = v17;
            }

            if (sOut)
            {
              *sOut = v16;
              sOut[1] = metadata;
            }

            return 1;
          }
        }
      }
    }
  }

  return result;
}

- (uint64_t)_resumeTimeMachines
{
  if (result)
  {
    v1 = result;
    if (*(result + 3448) == 1)
    {
      [*(result + 3344) resume];
      stream = [*(v1 + 600) stream];
      v3 = *off_1E798C200;

      return [stream sendCommandProperty:v3];
    }
  }

  return result;
}

- (void)_validateTimeMachineFramesUsingPreviewFramesMetadata:(uint64_t)metadata
{
  OUTLINED_FUNCTION_59_0();
  a42 = v45;
  a43 = v46;
  if (v47)
  {
    OUTLINED_FUNCTION_80();
    if (!*(v48 + 3296))
    {
      goto LABEL_14;
    }

    a30 = 0u;
    a31 = 0u;
    a28 = 0u;
    a29 = 0u;
    OUTLINED_FUNCTION_17_20();
    if (!OUTLINED_FUNCTION_1_18(v49, v50, v51, v52))
    {
      goto LABEL_14;
    }

    v53 = *off_1E798B6B0;
    v54 = *off_1E798C4A8;
    while (1)
    {
      OUTLINED_FUNCTION_30_6();
      if (!v55)
      {
        objc_enumerationMutation(v43);
      }

      v56 = [**(&a28 + 1) objectForKeyedSubscript:v53];
      if (v56)
      {
        if (![v56 isEqualToString:v54])
        {
          break;
        }
      }

      OUTLINED_FUNCTION_46_10();
      if (v55)
      {
        OUTLINED_FUNCTION_17_20();
        if (!OUTLINED_FUNCTION_1_18(v57, v58, v59, v60))
        {
          goto LABEL_14;
        }
      }
    }

    if (([*(v44 + 3296) isStationary] & 1) == 0)
    {
      [+[BWAggdDataReporter sharedInstance](BWAggdDataReporter reportZeroShutterLagSphereInitFailure];
    }

    else
    {
LABEL_14:
      a11 = 0;
      if (FigCaptureFrameMetadataIsUsableForPTSBasedReferenceFrameSelection(v43, &a11))
      {
        v61 = +[BWAggdDataReporter sharedInstance];
        [(BWAggdDataReporter *)v61 reportZeroShutterLagMetadataInitFailureWithReasons:a11];
      }
    }
  }

  OUTLINED_FUNCTION_58_0();
}

- (uint64_t)_suspendTimeMachineWithCompletionHandler:(uint64_t)result
{
  if (!result)
  {
    return result;
  }

  OUTLINED_FUNCTION_80();
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_2_9();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  v11 = [objc_msgSend(*(v2 + 600) "stream")];
  if (v11)
  {
    OUTLINED_FUNCTION_1_5();
  }

  else
  {
    v3 = *(v2 + 1392);
    if (!v3)
    {
      v3 = *(v2 + 600);
    }

    v4 = [objc_msgSend(v3 "stream")];
    if (!v11)
    {
      memset(&v10, 0, sizeof(v10));
      CMTimeRangeMakeFromDictionary(&v10, v4);
      v5 = *(v2 + 3344);
      v9[0] = MEMORY[0x1E69E9820];
      v9[1] = 3221225472;
      v9[2] = __68__BWFigVideoCaptureDevice__suspendTimeMachineWithCompletionHandler___block_invoke;
      v9[3] = &unk_1E799C0C0;
      v9[4] = v2;
      v9[5] = v1;
      v8 = v10;
      result = [v5 suspendWithPTSRange:&v8 completionHandler:v9];
      goto LABEL_9;
    }

    OUTLINED_FUNCTION_14_21();
  }

  result = FigDebugAssert3();
LABEL_9:
  if (v11)
  {
    if (*(v2 + 3448) == 1)
    {
      [*(v2 + 3344) resume];
      [objc_msgSend(*(v2 + 600) "stream")];
    }

    v6 = *(MEMORY[0x1E695EFD0] + 16);
    *&v8.start.value = *MEMORY[0x1E695EFD0];
    *&v8.start.epoch = v6;
    *&v8.duration.timescale = *(MEMORY[0x1E695EFD0] + 32);
    OUTLINED_FUNCTION_10();
    v7();
    return [+[BWAggdDataReporter sharedInstance](BWAggdDataReporter reportZeroShutterLagFirmwareTimeMachineInitFailure];
  }

  return result;
}

- (uint64_t)_initiateCaptureStillImageNowWithPTS:(uint64_t)result completionHandler:
{
  if (result)
  {
    OUTLINED_FUNCTION_176();
    if (!_FigIsCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_2_9();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    return [BWFigVideoCaptureDevice _suspendTimeMachineWithCompletionHandler:v1];
  }

  return result;
}

- (void)_stillImageCaptureStateMachineDidTransitionToInProgress
{
  if (self)
  {
    v1 = *(self + 2688);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __82__BWFigVideoCaptureDevice__stillImageCaptureStateMachineDidTransitionToInProgress__block_invoke;
    block[3] = &unk_1E798F870;
    block[4] = self;
    dispatch_async(v1, block);
  }
}

- (void)_currentStillImageSceneTypeForcingFlashSceneDetectionEnabled:(int)enabled forcingHDRSceneDetectionEnabled:(int)detectionEnabled forcingSISSceneDetectionEnabled:(int)sceneDetectionEnabled forcingDigitalFlashSceneDetectionEnabled:
{
  if (result)
  {
    v7 = result;
    if ([result isBravoVariant])
    {
      masterCaptureStream = [v7 masterCaptureStream];
    }

    else
    {
      masterCaptureStream = *(v7 + 600);
    }

    v10 = [BWFrameStatisticsByPortType alloc];
    [*(v7 + 2144) portTypes];
    v11 = [OUTLINED_FUNCTION_36() initWithPortTypes:?];
    os_unfair_lock_lock((v7 + 2140));
    [*(v7 + 2144) copyTo:v11];
    v12 = *(v7 + 2632);
    v13 = *(v7 + 2636);
    v14 = *(v7 + 2640);
    v15 = *(v7 + 2400);
    os_unfair_lock_unlock((v7 + 2140));
    if (a2)
    {
      v16 = 2;
    }

    else
    {
      v16 = v12;
    }

    if (enabled)
    {
      v17 = 2;
    }

    else
    {
      v17 = v13;
    }

    if (v14 <= 2)
    {
      v18 = 2;
    }

    else
    {
      v18 = v14;
    }

    if (detectionEnabled)
    {
      v19 = v18;
    }

    else
    {
      v19 = v14;
    }

    if (sceneDetectionEnabled)
    {
      v20 = 1;
    }

    else
    {
      v20 = v15;
    }

    return [(BWFigVideoCaptureDevice *)v7 _stillImageSceneTypeForCaptureStream:masterCaptureStream frameStatisticsByPortType:v11 flashMode:v16 hdrMode:v17 qualityPrioritization:v19 digitalFlashMode:v20 sceneFlags:0];
  }

  return result;
}

- (uint64_t)_stillImageSceneTypeForCaptureStream:(void *)stream frameStatisticsByPortType:(int)type flashMode:(int)mode hdrMode:(int)hdrMode qualityPrioritization:(int)prioritization digitalFlashMode:(unint64_t *)flashMode sceneFlags:
{
  if (result)
  {
    v12 = result;
    if (hdrMode >= 2 || mode | type | prioritization)
    {
      if (*(result + 2652) > 2)
      {
        [BWFigVideoCaptureDevice _ubStillImageSceneFlagsForCaptureStream:? frameStatisticsByPortType:? fusionEnabled:? metadata:? sceneMonitoring:? zoomFactorOverride:?];
        v16 = v15;
        if (type && [(BWFigVideoCaptureDevice *)v12 _ubIsAutoFlashForSceneFlags:v15 digitalFlashModeForSceneMonitoring:prioritization])
        {
          result = 1;
        }

        else if (mode && ([(BWFigVideoCaptureDevice *)v12 _ubIsHDRCaptureUsingSceneFlags:v16]& 1) != 0)
        {
          result = 2;
        }

        else
        {
          result = 3;
        }

        if (flashMode)
        {
          *flashMode = v16;
        }
      }

      else
      {
        [(BWFigVideoCaptureDevice *)result _resolveStillImageCaptureTypeFromStatisticsByPortType:stream masterCaptureStream:a2 flashMode:2 * (type != 0) hdrMode:2 * (mode != 0) qualityPrioritization:hdrMode stereoFusionMode:0 depthDataDeliveryEnabled:0 bravoConstituentImageDeliveryDeviceTypes:0 burstQualityCaptureEnabled:0 clientBracketMode:0 forSceneMonitoring:1 captureFlags:&v17];
        result = OUTLINED_FUNCTION_349();
        v14 = v13 - 2;
        if (v14 <= 4)
        {
          return dword_1AD056B1C[v14];
        }
      }
    }

    else
    {
      return 0;
    }
  }

  return result;
}

- (void)_ubStillImageSceneFlagsForCaptureStream:(uint64_t)stream frameStatisticsByPortType:fusionEnabled:metadata:sceneMonitoring:zoomFactorOverride:
{
  if (stream)
  {
    OUTLINED_FUNCTION_134_4();
    v140 = v3;
    v141 = v4;
    v6 = v5;
    v8 = v7;
    v10 = v9;
    v12 = v11;
    v14 = v13;
    OUTLINED_FUNCTION_7_3();
    if ([v15 frameCount] <= 3 && *(v2 + 76) != 1)
    {
LABEL_179:
      OUTLINED_FUNCTION_133_5();
      return;
    }

    [v1 portType];
    v16 = [OUTLINED_FUNCTION_47() objectForKeyedSubscript:?];
    v17 = *(v2 + 2192);
    [v1 portType];
    if (![OUTLINED_FUNCTION_28() objectForKeyedSubscript:?])
    {
      FigCaptureGetFrameworkRadarComponent();
      v139 = 0;
      v138 = 0;
      OUTLINED_FUNCTION_116_5();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v115 = os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
      if (OUTLINED_FUNCTION_6(v115))
      {
        v135 = 136315138;
        v136 = "[BWFigVideoCaptureDevice _ubStillImageSceneFlagsForCaptureStream:frameStatisticsByPortType:fusionEnabled:metadata:sceneMonitoring:zoomFactorOverride:]";
        OUTLINED_FUNCTION_43_0();
        OUTLINED_FUNCTION_209();
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_5_3();
      OUTLINED_FUNCTION_17_8();
      v137[0] = 0;
      OUTLINED_FUNCTION_16_14();
      OUTLINED_FUNCTION_5_61();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_13_18();
      v116 = OUTLINED_FUNCTION_6_1();
      FigCapturePleaseFileRadar(v116, v117, v118, v119, v120, 17843, v121, v122, v123);
      free(v137);
      goto LABEL_179;
    }

    [OUTLINED_FUNCTION_352() baseZoomFactor];
    v19 = v18;
    LODWORD(v126) = [v16 motionDataStatus];
    if ((v126 & 8) != 0)
    {
      HIDWORD(v126) = 0;
    }

    else
    {
      HIDWORD(v126) = [v1 hasSphere];
    }

    [v16 eit];
    v21 = v20;
    [v16 sifrGain];
    v23 = v22;
    if (*(v2 + 1556))
    {
      v24 = 272629760;
    }

    else if ([(BWFigVideoCaptureDevice *)v2 _ubIsSuperWidePreferredOrCurrentPrimaryCaptureStreamInWideZoomRange])
    {
      v24 = 0x10000000;
    }

    else
    {
      v24 = 0;
    }

    v134 = 0;
    [(BWFigVideoCaptureDevice *)v2 _copyAutofocusProcessorProperty:&v134 propertyValueOut:?];
    [v134 BOOLValue];
    OUTLINED_FUNCTION_223();

    [v16 hrEnabled];
    OUTLINED_FUNCTION_223();
    [v17 lowLightEffectiveIntegrationTimeThreshold];
    if (v21 > v25)
    {
      v24 |= 8u;
    }

    if (v23 > 0.0)
    {
      [v17 sifrMainEffectiveIntegrationTimeThreshold];
      if (v21 <= v26 || ([v17 sifrGainThreshold], v23 <= v27))
      {
        v24 |= 2u;
      }
    }

    ispDGain = [v16 ispDGain];
    [v16 ispDGainRangeExpansionFactor];
    v30 = v29;
    [v17 lowLightHDRWithoutSIFRISPDGainThreshold];
    if (v31 > 0.0)
    {
      [v17 lowLightHDRWithoutSIFRISPDGainThreshold];
      if ((ispDGain / (v30 * 256.0)) < v32)
      {
        v24 |= 0x10000u;
      }
    }

    if (([v1 hasSphere] & 1) == 0)
    {
      [v17 longWithoutSphereEffectiveIntegrationTimeThreshold];
      if (v33 > 0.0)
      {
        [v17 longWithoutSphereEffectiveIntegrationTimeThreshold];
        if (v21 <= v34)
        {
          v24 |= 0x200u;
        }
      }
    }

    v127 = v14;
    if (*(v2 + 2256) == 1 && *(v2 + 2257) == 1)
    {
      [v17 deepFusionEffectiveIntegrationTimeThreshold];
      if (v21 > v35 && ((v24 & 0xC) != 0 || (*(v2 + 2185) & 1) == 0))
      {
        v24 |= 0x1000u;
      }

      v36 = 1;
    }

    else
    {
      v36 = 0;
    }

    if (*(v2 + 2259) == 1)
    {
      objc_loadWeak((v2 + 2656));
      [v1 portType];
      if ([OUTLINED_FUNCTION_36() learnedFusionSupportedForPortType:?])
      {
        if (([v1 activeNondisruptiveSwitchingFormatIndex] & 0x80000000) == 0 && objc_msgSend(v1, "activeSensorDimensions") != *(v2 + 148))
        {
          v24 |= 0x40000000u;
        }
      }
    }

    if (*(v2 + 2240) == 1 && *(v2 + 148) >= 1 && *(v2 + 152) >= 1)
    {
      if ([v1 activeQuadraBinningFactor] == 1 || (objc_msgSend(v1, "portType"), (objc_msgSend(objc_msgSend(OUTLINED_FUNCTION_36(), "objectForKeyedSubscript:"), "intValue") & 0x80000000) != 0))
      {
        v42 = *(v2 + 148) < 1 || *(v2 + 152) < 1;
        if (v42 || [*(v2 + 600) sensorDimensions] != *(v2 + 148))
        {
          if (([v1 activeNondisruptiveSwitchingFormatIndex] & 0x80000000) == 0 && objc_msgSend(v1, "activeSensorDimensions") == *(v2 + 148))
          {
            v24 |= 0x200000u;
          }
        }

        else
        {
          v24 |= 0x200000u;
        }
      }

      else
      {
        [objc_msgSend(objc_msgSend(v1 "nondisruptiveSwitchingZoomFactors")];
        v39 = v38;
        if ((v36 & (v6 < v38)) != 0)
        {
          v24 |= 0x100000u;
        }

        [v17 upscaledEnhancedResolutionEffectiveIntegrationTimeThreshold];
        [v17 upscaledEnhancedResolutionEffectiveIntegrationTimeThreshold];
        if (v21 > v40)
        {
          v24 |= 0x80000000;
        }

        if (v6 < v39)
        {
          v24 |= 0x200000u;
        }

        if (*(v2 + 2264) == 1)
        {
          [v17 learnedNRUltraHighResolutionDowngradeEffectiveIntegrationTimeThreshold];
          [v17 learnedNRUltraHighResolutionDowngradeEffectiveIntegrationTimeThreshold];
          if (v21 > v41)
          {
            v24 |= 0x1000000u;
          }
        }
      }
    }

    if ((v36 & *(v2 + 218)) == 1 && [objc_msgSend(v1 "portType")])
    {
      if (v6 < (v19 * 1.1) && v19 <= v6)
      {
        v24 |= 0x80000u;
      }

      if (*(v2 + 3448) == 1)
      {
        [v16 integrationTime];
        if (v44 > 0.00833333333)
        {
          v24 |= 0x4000000u;
        }
      }

      if ([*(v2 + 664) indexOfObject:v1] >= 1)
      {
        v45 = [OUTLINED_FUNCTION_330(*(v2 + 664)) objectAtIndexedSubscript:?];
      }

      else
      {
        v45 = 0;
      }

      portType = [v45 portType];
      v54 = [OUTLINED_FUNCTION_271(portType v47];
      [v16 normalizedSNR];
      v56 = v55;
      [v54 normalizedSNR];
      v58 = v57;
      if (v8 && [*(v2 + 224) count])
      {
        OUTLINED_FUNCTION_112_6();
        v129 = 3221225472;
        v130 = __151__BWFigVideoCaptureDevice__ubStillImageSceneFlagsForCaptureStream_frameStatisticsByPortType_fusionEnabled_metadata_sceneMonitoring_zoomFactorOverride___block_invoke;
        v131 = &unk_1E799C3E8;
        v132 = v2;
        v133 = v127;
        v56 = __151__BWFigVideoCaptureDevice__ubStillImageSceneFlagsForCaptureStream_frameStatisticsByPortType_fusionEnabled_metadata_sceneMonitoring_zoomFactorOverride___block_invoke(v128, [v1 portType]);
        portType2 = [v45 portType];
        v58 = v130(v128, portType2);
      }

      [v17 stereoPhotoSNRThreshold];
      if (v56 < v60 || ([v17 stereoPhotoSNRDifferenceSecondarySNRThreshold], v58 < v61) && (objc_msgSend(v17, "stereoPhotoSNRDifferenceThreshold"), vabds_f32(v56, v58) > v62))
      {
        v24 |= 0x8000000u;
      }
    }

    if (*(v2 + 1568) == 1)
    {
      os_unfair_lock_lock((v2 + 4308));
      v63 = *(v2 + 4312);
      if (v63 && ([v63 fudgedLowerBound], v6 >= v64) && (objc_msgSend(*(v2 + 4312), "fudgedUpperBound"), v65 >= v6))
      {
        os_unfair_lock_unlock((v2 + 4308));
        v24 |= 0x800000u;
      }

      else
      {
        os_unfair_lock_unlock((v2 + 4308));
      }
    }

    if (*(v2 + 2180) == 1)
    {
      [v17 redSaturationMainEffectiveIntegrationTimeThreshold];
      v67 = v21 <= v66;
      if (*(v2 + 2183) == 1)
      {
        v68 = v66;
        [v17 redSaturationSIFRGainThreshold];
        if (v69 != 0.0)
        {
          v67 = v23 > 0.0;
          if (v23 > 0.0 && v21 > v68)
          {
            [v17 redSaturationSIFRGainThreshold];
            v67 = v23 <= v71;
          }
        }
      }

      if (v67)
      {
        v24 |= 0x100u;
      }
    }

    if (*(v2 + 3304))
    {
      v24 |= 0x2000u;
    }

    if (*(v2 + 2172) != 1)
    {
      v75 = 0;
      v76 = 0.0;
      goto LABEL_138;
    }

    v72 = off_1E798A0D0;
    if (*(v2 + 2544))
    {
      [objc_msgSend(*(v2 + 2192) objectForKeyedSubscript:{*off_1E798A0D0), "autoFlashMacroNormalizedSNRThreshold"}];
      v74 = v73;
    }

    else
    {
      v74 = NAN;
    }

    if (*(v2 + 2266) == 1)
    {
      [v17 autoFlashColorConstancyNormalizedSNRThreshold];
      [v17 autoFlashColorConstancyNormalizedSNRThreshold];
      v78 = v77;
      v79 = v16;
    }

    else
    {
      [v1 portType];
      v80 = [OUTLINED_FUNCTION_36() objectForKeyedSubscript:?];
      v79 = v16;
      if (!v80)
      {
        [*(v2 + 600) portType];
        v80 = [OUTLINED_FUNCTION_36() objectForKeyedSubscript:?];
        portType3 = [*(v2 + 600) portType];
        v79 = [OUTLINED_FUNCTION_271(portType3 v82];
      }

      [v80 floatValue];
      v78 = v89;
      if (v12)
      {
        v72 = off_1E798A0D0;
        if (HIDWORD(v126))
        {
          fvcd_estimateOISOutputImageSNR(v79);
          v76 = v90;
          v75 = 3;
        }

        else
        {
          [v79 normalizedSNR];
          v76 = v109 + 4.7712;
          v75 = 2;
        }

        goto LABEL_117;
      }

      v72 = off_1E798A0D0;
    }

    [v79 normalizedSNR];
    v76 = v91;
    v75 = 1;
LABEL_117:
    [objc_msgSend(v127 objectForKeyedSubscript:{*v72), "normalizedQsumSNR"}];
    v93 = v92;
    if (v8)
    {
      v94 = *(v2 + 2528);
      if (v94)
      {
        [v94 addDataPoint:v76];
        [*(v2 + 2528) average];
        v76 = v95;
        if (*(v2 + 2524) != 0.0)
        {
          OUTLINED_FUNCTION_243();
          if (v97 < 0.2)
          {
            v76 = v96;
          }
        }

        *(v2 + 2524) = v76;
      }

      v98 = *(v2 + 2544);
      if (v98)
      {
        [v98 addDataPoint:v93];
        [*(v2 + 2544) average];
        v93 = v99;
        if (*(v2 + 2536) != 0.0)
        {
          OUTLINED_FUNCTION_243();
          if (v101 < 0.2)
          {
            v93 = v100;
          }
        }

        *(v2 + 2536) = v93;
      }
    }

    v102 = v24 | 0x20000000;
    if (v93 >= v74)
    {
      v102 = v24;
    }

    if ((v24 & 0x10000000) == 0)
    {
      v102 = v24;
    }

    if ((v102 & 0x20000000) != 0 || v76 < v78)
    {
      v24 = v102 | 0x20;
    }

    else
    {
      v24 = v102;
    }

LABEL_138:
    if (*(v2 + 2344) != 1 || (*(v2 + 2345) & 1) == 0 && *(v2 + 1594) != 1)
    {
      goto LABEL_158;
    }

    [v1 portType];
    if (![OUTLINED_FUNCTION_36() containsObject:?])
    {
      goto LABEL_158;
    }

    if (*(v2 + 2488) && (v24 & 0x800000) != 0)
    {
      if ([objc_msgSend(v1 "portType")])
      {
        v105 = v6 < (v19 * 1.1) && v19 <= v6;
      }

      else
      {
        v105 = 0;
      }

      if (*(v2 + 1595) == 1 && *(v2 + 2488))
      {
        shallowDepthOfFieldEffectStatus = [v2 shallowDepthOfFieldEffectStatus];
        if (!v105 && BWShallowDepthOfFieldEffectStatusIsEnabled(shallowDepthOfFieldEffectStatus))
        {
          goto LABEL_158;
        }
      }

      else if (!v105)
      {
        goto LABEL_158;
      }
    }

    if (*(v2 + 2388) == 1 && (v110 = *(v2 + 600), v110 != v1))
    {
      if ((v126 & 8) != 0)
      {
        hasSphere = 0;
      }

      else
      {
        hasSphere = [*(v2 + 600) hasSphere];
        v110 = *(v2 + 600);
      }

      v111 = v2;
      v112 = v127;
    }

    else
    {
      v111 = OUTLINED_FUNCTION_2_42();
      v112 = v127;
      hasSphere = HIDWORD(v126);
    }

    [(BWFigVideoCaptureDevice *)v111 _ubDigitalFlashSceneFlagsForCaptureStream:v110 frameStatisticsByPortType:v112 sphereAvailable:hasSphere fusionEnabled:v12 sceneMonitoring:v8];
LABEL_158:
    [v10 setSnrType:v75];
    *&v107 = v76;
    [v10 setSnr:v107];
    if (*(v2 + 2173) == 1 && *(v2 + 2176) == 1 && [objc_msgSend(v1 "portType")])
    {
      [v17 nightModeMinGainThreshold];
      if (v108 <= 0.0)
      {
        [v16 aeLimitsReached];
      }

      else
      {
        [v16 gain];
      }

      OUTLINED_FUNCTION_223();
    }

    [v16 exposureBias];
    [v16 aeLocked];
    goto LABEL_179;
  }
}

- (BOOL)_ubIsAutoFlashForSceneFlags:(int)flags digitalFlashModeForSceneMonitoring:
{
  if (!self)
  {
    return 0;
  }

  if ((a2 & 0x20) != 0)
  {
    if (!flags || (a2 & 0x4800) != 0)
    {
      return [(BWFigVideoCaptureDevice *)self _ubIsFlashAvailable];
    }

    v3 = (a2 >> 29) & 1;
  }

  else
  {
    LOBYTE(v3) = 0;
  }

  if ((v3 & 1) == 0 && (((~a2 & 0x10000800) == 0) & *(self + 2389)) == 0)
  {
    return 0;
  }

  return [(BWFigVideoCaptureDevice *)self _ubIsFlashAvailable];
}

- (_BYTE)_ubIsHDRCaptureUsingSceneFlags:(_BYTE *)result
{
  if (result)
  {
    if (a2 & 0x40) == 0 || (result[2184])
    {
      if (result[2185])
      {
        v2 = a2 & 0xC;
        v4 = (~a2 & 0x10008) == 0 || v2 == 4;
        v5 = (v2 != 0) & (a2 >> 1);
        if (result[2183] == 1)
        {
          return v5;
        }

        else
        {
          return v4;
        }
      }

      else
      {
        return ((*&a2 & 0x10002) != 0);
      }
    }

    else
    {
      return 0;
    }
  }

  return result;
}

- (uint64_t)_bravoCameraForOISOrSISCaptureType:(uint64_t)result stereoFusionMode:(float)mode frameStatisticsByPortType:(float)type zoomFactor:(float)factor stereoFusionLowerBoundZoomFactor:(uint64_t)zoomFactor stereoFusionUpperBoundZoomFactor:(int)boundZoomFactor
{
  if (result)
  {
    v10 = result;
    [*(result + 672) portType];
    v11 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
    if (boundZoomFactor == 1)
    {
      return 2;
    }

    else if (mode < type || ((v12 = v11, v13 = *(v10 + 2568), [*(v10 + 672) baseZoomFactor], v15 = v14, objc_msgSend(*(v10 + 672), "baseZoomFactor"), v16 <= mode) && (objc_msgSend(v12, "integrationTime"), v17 >= v13 + -0.0000999999975) ? (objc_msgSend(v12, "gain"), v18 = v19 >= *(v10 + 2576)) : (v18 = 0), (result = 2, v15 <= mode) && (mode >= factor || !v18)))
    {
      [*(v10 + 672) baseZoomFactor];
      return v20 <= mode;
    }
  }

  return result;
}

- (void)_ubConvertStillImageCaptureSettings:useSynchronizedStreamsGroup:toStillImageCaptureNowOptions:captureStreamPropertyValues:
{
  OUTLINED_FUNCTION_60();
  if (!v1)
  {
    goto LABEL_123;
  }

  v6 = v5;
  v7 = v4;
  v8 = v3;
  v9 = v2;
  v10 = v1;
  v11 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v87 = objc_alloc_init(MEMORY[0x1E695DF90]);
  dictionary = [MEMORY[0x1E695DF90] dictionary];
  v114 = v11;
  v85 = v6;
  v89 = v7;
  if (![objc_msgSend(objc_msgSend(objc_msgSend(v9 "captureStreamSettings")] && !objc_msgSend(objc_msgSend(objc_msgSend(objc_msgSend(v9, "captureStreamSettings"), "firstObject"), "unifiedBracketedCaptureParams"), "count") || objc_msgSend(v9, "captureType") == 2 && (objc_msgSend(v9, "captureFlags") & 8) == 0)
  {
    if ([v9 captureType] != 1 && objc_msgSend(v9, "captureType") != 2)
    {
      FigCaptureGetFrameworkRadarComponent();
      v136 = 0;
      type = OS_LOG_TYPE_DEFAULT;
      OUTLINED_FUNCTION_145_1();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
      OUTLINED_FUNCTION_115_0();
      if (v14)
      {
        v72 = v71;
      }

      else
      {
        v72 = 0;
      }

      if (v72)
      {
        v129 = 136315394;
        v130 = "[BWFigVideoCaptureDevice _ubConvertStillImageCaptureSettings:useSynchronizedStreamsGroup:toStillImageCaptureNowOptions:captureStreamPropertyValues:]";
        v131 = 2112;
        v132 = BWPhotoEncoderStringFromEncodingScheme([v9 captureType]);
        OUTLINED_FUNCTION_34_16();
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_5_3();
      OUTLINED_FUNCTION_13_0();
      v73 = BWPhotoEncoderStringFromEncodingScheme([v9 captureType]);
      v133 = 138412290;
      v134 = v73;
      OUTLINED_FUNCTION_43_0();
      OUTLINED_FUNCTION_5_61();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_13_18();
      v74 = OUTLINED_FUNCTION_6_1();
      FigCapturePleaseFileRadar(v74, v75, v76, v77, v78, 9894, v79, v80, &v133);
      free(&v133);
      v32 = v87;
      goto LABEL_118;
    }

    v127 = 0u;
    v128 = 0u;
    v125 = 0u;
    v126 = 0u;
    captureStreamSettings = [v9 captureStreamSettings];
    OUTLINED_FUNCTION_102_4();
    if (![v13 countByEnumeratingWithState:? objects:? count:?])
    {
LABEL_35:
      captureType = [v9 captureType];
      lensStabilizationEnabledForClientBracket = captureType == 2;
      v32 = v87;
      if (captureType == 2)
      {
        if (v8)
        {
          v33 = *off_1E798C560;
          v34 = &unk_1F22469F0;
          v35 = v11;
        }

        else
        {
          v34 = *off_1E798A070;
          v33 = *off_1E798BE58;
          v35 = v87;
        }

        [v35 setObject:v34 forKeyedSubscript:v33];
      }

      if (([v9 captureFlags] & 0x800) == 0)
      {
        goto LABEL_75;
      }

      if (*(v10 + 3446) == 1)
      {
        [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C4E8];
      }

      if (*(v10 + 3447) != 1)
      {
        goto LABEL_75;
      }

      [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C4F0];
      if (captureType == 2)
      {
        goto LABEL_76;
      }

      goto LABEL_78;
    }

    v112 = *off_1E798C658;
    v110 = *off_1E798C568;
    v96 = *off_1E798BD50;
    v94 = *off_1E798C5F8;
    v106 = *off_1E798C690;
    obj = *off_1E798C668;
    v108 = *off_1E798C608;
    v98 = v9;
    v102 = v10;
    HIDWORD(v104) = v8;
    while (1)
    {
      OUTLINED_FUNCTION_49_7();
      if (!v14)
      {
        objc_enumerationMutation(captureStreamSettings);
      }

      v15 = **(&v125 + 1);
      if ([objc_msgSend(**(&v125 + 1) "portType")] && !v8)
      {
        goto LABEL_14;
      }

      dictionary2 = [MEMORY[0x1E695DF90] dictionary];
      [v15 portType];
      v17 = OUTLINED_FUNCTION_326();
      v18 = [BWFigVideoCaptureDevice _captureStreamByPortType:v17];
      v19 = v9;
      [v9 frameStatisticsByPortType];
      [v15 portType];
      v20 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
      if (([v15 captureFlags] & 0x80) != 0)
      {
        v21 = 30;
      }

      else
      {
        v21 = 1;
      }

      [v20 gain];
      v23 = v22;
      captureFlags = [v15 captureFlags];
      LODWORD(v25) = v23;
      [v18 noiseReductionAndSharpeningConfigurationForType:v21 gain:(captureFlags >> 4) & 1 qSub:v25];
      [OUTLINED_FUNCTION_36() setObject:? forKeyedSubscript:?];
      if (([v15 captureFlags] & 0x10000) != 0)
      {
        [dictionary2 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v110];
      }

      v9 = v19;
      captureType2 = [v19 captureType];
      v10 = v102;
      if (captureType2 == 2)
      {
        break;
      }

LABEL_33:
      [dictionary setObject:dictionary2 forKeyedSubscript:{objc_msgSend(v15, "portType")}];
      v11 = v114;
      v8 = HIDWORD(v104);
LABEL_14:
      OUTLINED_FUNCTION_335();
      if (v14)
      {
        OUTLINED_FUNCTION_102_4();
        if (![captureStreamSettings countByEnumeratingWithState:? objects:? count:?])
        {
          goto LABEL_35;
        }
      }
    }

    if (([v15 captureFlags] & 0x8000) != 0)
    {
      [objc_msgSend(v18 "stream")];
      [OUTLINED_FUNCTION_36() setObject:? forKeyedSubscript:?];
    }

    captureFlags2 = [v15 captureFlags];
    if ((captureFlags2 & 0x800000) != 0)
    {
      v28 = 1;
    }

    else if ((captureFlags2 & 0x20000000) != 0)
    {
      v28 = 2;
    }

    else
    {
      if ((captureFlags2 & 0x40000000) == 0)
      {
LABEL_32:
        [objc_msgSend(objc_msgSend(v15 "unifiedBracketedCaptureParams")];
        [OUTLINED_FUNCTION_36() setObject:? forKeyedSubscript:?];
        goto LABEL_33;
      }

      v28 = 3;
    }

    v29 = ([v15 captureFlags] >> 25) & 1;
    [MEMORY[0x1E696AD98] numberWithInt:v28];
    [OUTLINED_FUNCTION_36() setObject:? forKeyedSubscript:?];
    [MEMORY[0x1E696AD98] numberWithBool:v29];
    [OUTLINED_FUNCTION_36() setObject:? forKeyedSubscript:?];
    v9 = v98;
    goto LABEL_32;
  }

  memset(v140, 0, 64);
  obj = [v9 captureStreamSettings];
  if (![obj countByEnumeratingWithState:v140 objects:v139 count:16])
  {
    lensStabilizationEnabledForClientBracket = 0;
    v32 = v87;
    goto LABEL_73;
  }

  HIDWORD(v104) = v8;
  v98 = v9;
  lensStabilizationEnabledForClientBracket = 0;
  v110 = *off_1E798C5B0;
  v106 = *off_1E798C5C8;
  v108 = *off_1E798C598;
  v90 = *off_1E798BB60;
  LODWORD(v112) = -1;
  HIDWORD(v92) = 1;
  do
  {
    OUTLINED_FUNCTION_32_10();
    if (!v14)
    {
      objc_enumerationMutation(obj);
    }

    v36 = *v140[1];
    [MEMORY[0x1E695DF90] dictionary];
    if ([objc_msgSend(OUTLINED_FUNCTION_133() "timeMachineBracketedCaptureParams")])
    {
      [v36 timeMachineBracketedCaptureParams];
      [OUTLINED_FUNCTION_7() setObject:? forKeyedSubscript:?];
    }

    if (![objc_msgSend(v36 "unifiedBracketedCaptureParams")])
    {
      v38 = OUTLINED_FUNCTION_331();
LABEL_61:
      [v38 setObject:? forKeyedSubscript:?];
      goto LABEL_65;
    }

    [v36 preBracketFrameCaptureParams];
    [OUTLINED_FUNCTION_7() setObject:? forKeyedSubscript:?];
    [v36 unifiedBracketedCaptureParams];
    [OUTLINED_FUNCTION_7() setObject:? forKeyedSubscript:?];
    if ([v36 captureFlags] < 0)
    {
      v37 = 500;
    }

    else
    {
      v37 = 0;
    }

    LODWORD(v112) = v37;
    if ([v36 adaptiveBracketingParameters])
    {
      [OUTLINED_FUNCTION_352() portType];
      v39 = OUTLINED_FUNCTION_326();
      HIDWORD(v92) = [-[BWFigVideoCaptureDevice _captureStreamByPortType:](v39) hasFocus] ^ 1;
      captureFlags3 = [v36 captureFlags];
      v94 = MEMORY[0x1E696AD98];
      v96 = (captureFlags3 >> 37) & 1;
      [MEMORY[0x1E696AD98] numberWithInt:{objc_msgSend(v11, "stationary") ^ 1 | v96}];
      v11 = v114;
      v38 = v114;
      goto LABEL_61;
    }

    if (lensStabilizationEnabledForClientBracket)
    {
      lensStabilizationEnabledForClientBracket = 1;
      v11 = v114;
    }

    else
    {
      v11 = v114;
      if ([v36 captureType] == 7)
      {
        lensStabilizationEnabledForClientBracket = [v36 lensStabilizationEnabledForClientBracket];
      }

      else
      {
        lensStabilizationEnabledForClientBracket = 1;
      }
    }

LABEL_65:
    [OUTLINED_FUNCTION_331() setObject:? forKeyedSubscript:?];
    [dictionary setObject:v0 forKeyedSubscript:{objc_msgSend(v36, "portType")}];
    OUTLINED_FUNCTION_335();
  }

  while (!v14 || [obj countByEnumeratingWithState:v140 objects:v139 count:16]);
  v32 = v87;
  if ((v112 & 0x80000000) == 0)
  {
    [v11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:"), *off_1E798C500}];
  }

  if ((v92 & 0x100000000) != 0)
  {
LABEL_73:
    [v9 masterPortType];
    v41 = [objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:"afWindowParams"")];
    if ([v41 count])
    {
      v137 = *off_1E798BC50;
      v138 = v41;
      [v11 setObject:objc_msgSend(MEMORY[0x1E695DF20] forKeyedSubscript:{"dictionaryWithObjects:forKeys:count:", &v138, &v137, 1), *off_1E798B9F8}];
    }
  }

LABEL_75:
  if (lensStabilizationEnabledForClientBracket)
  {
LABEL_76:
    [v9 captureType];
    if ([BWFigVideoCaptureDevice _ubEnableSphereForCaptureType:v10])
    {
      [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798BB60];
    }
  }

LABEL_78:
  if (*(v10 + 1560))
  {
    v6 = v85;
    if (([v9 captureFlags] & 0x800) != 0)
    {
      v43 = *off_1E798AE28;
      v123[0] = *off_1E798AE20;
      v123[1] = v43;
      v124[0] = &unk_1F22469C0;
      v124[1] = &unk_1F22469C0;
      v123[2] = *off_1E798AE30;
      v124[2] = &unk_1F22469D8;
      [v11 setObject:objc_msgSend(MEMORY[0x1E695DF20] forKeyedSubscript:{"dictionaryWithObjects:forKeys:count:", v124, v123, 3), *off_1E798C578}];
      v42 = 1;
    }

    else
    {
      v42 = 0;
    }
  }

  else
  {
    v42 = 0;
    v6 = v85;
  }

  if ([v9 deliverSushiRaw])
  {
    [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C4F8];
  }

  [v9 masterPortType];
  v44 = OUTLINED_FUNCTION_326();
  v45 = [BWFigVideoCaptureDevice _captureStreamByPortType:v44];
  stillImageKeypointDetectionEnabled = [v45 stillImageKeypointDetectionEnabled];
  if (stillImageKeypointDetectionEnabled != [v45 keypointDetectionEnabled])
  {
    [v11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", stillImageKeypointDetectionEnabled), *off_1E798C580}];
  }

  if ([objc_msgSend(objc_msgSend(v45 "stream")])
  {
    [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C558];
  }

  if ([objc_msgSend(objc_msgSend(v45 "stream")])
  {
    [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C550];
  }

  if ([objc_msgSend(objc_msgSend(v45 "stream")])
  {
    [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C548];
  }

  if ([objc_msgSend(objc_msgSend(v45 "stream")])
  {
    [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C540];
  }

  if ([objc_msgSend(*(v10 + 624) objectForKeyedSubscript:{@"StillImageISPChromaNoiseReduction", "BOOLValue"}])
  {
    [v11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", *(v10 + 2700)), *off_1E798C538}];
  }

  if (v8)
  {
    v121 = 0u;
    v122 = 0u;
    v119 = 0u;
    v120 = 0u;
    OUTLINED_FUNCTION_206();
    v55 = OUTLINED_FUNCTION_281(v47, v48, v49, v50, v51, v52, v53, v54, v81, v83, v85, v87, v89, v90, v92, v94, v96, v98, obj, v102, v104, v106, v108, v110, v112, v114, dictionary);
    if (v55)
    {
      v56 = v55;
      do
      {
        for (i = 0; i != v56; ++i)
        {
          OUTLINED_FUNCTION_6_30();
          if (!v14)
          {
            objc_enumerationMutation(v117);
          }

          [v117 objectForKeyedSubscript:*(*(&v119 + 1) + 8 * i)];
          [OUTLINED_FUNCTION_28() setObject:? forKeyedSubscript:?];
        }

        OUTLINED_FUNCTION_206();
        v56 = OUTLINED_FUNCTION_281(v58, v59, v60, v61, v62, v63, v64, v65, v82, v84, v86, v88, v89, v91, v93, v95, v97, v99, obja, v103, v105, v107, v109, v111, v113, v115, v117);
      }

      while (v56);
    }
  }

  else
  {
    v66 = [dictionary objectForKeyedSubscript:{objc_msgSend(v9, "masterPortType")}];
    v67 = [v66 objectForKeyedSubscript:*off_1E798C658];
    if (v67)
    {
      v68 = v67;
      [OUTLINED_FUNCTION_4_3() setObject:? forKeyedSubscript:?];
      v118 = v68;
      [v66 setObject:objc_msgSend(MEMORY[0x1E695DEC8] forKeyedSubscript:{"arrayWithObjects:count:", &v118, 1), *off_1E798C588}];
    }

    [dictionary objectForKeyedSubscript:{objc_msgSend(v9, "masterPortType")}];
    [OUTLINED_FUNCTION_28() addEntriesFromDictionary:?];
    if (*(v10 + 648))
    {
      v69 = v42;
    }

    else
    {
      v69 = 1;
    }

    if ((v69 & 1) == 0)
    {
      [v11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C5A8];
    }
  }

  if (*(v10 + 2172) == 1 && [v9 captureType] != 2)
  {
    [v32 setObject:*off_1E798A068 forKeyedSubscript:*off_1E798BE58];
  }

  if (([objc_msgSend(*(v10 + 8) "deviceID")] & 1) == 0)
  {
    [BWFigVideoCaptureDevice _propagateStillImageSettings:v10 toCMIOCaptureOptions:?];
  }

LABEL_118:
  if (![v11 count])
  {

    v11 = 0;
  }

  if (![v32 count])
  {

    v32 = 0;
  }

  *v89 = v11;
  *v6 = v32;
LABEL_123:
  OUTLINED_FUNCTION_128_0();
}

- (uint64_t)_ubEnableSphereForCaptureType:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    result = [*(v3 + 600) sphereEnabled];
    if (result)
    {
      if ([*(v1 + 600) motionDataInvalid])
      {
        return 0;
      }

      else if (v2 == 7)
      {
        return 1;
      }

      else
      {
        if (*(v1 + 2176) == 2)
        {
          sphereVideoEnabled = [*(v1 + 600) sphereVideoEnabled];
        }

        else
        {
          sphereVideoEnabled = 1;
        }

        return sphereVideoEnabled & ([*(v1 + 3296) isStationary] ^ 1);
      }
    }
  }

  return result;
}

- (uint64_t)_propagateStillImageSettings:(uint64_t)result toCMIOCaptureOptions:
{
  if (result)
  {
    OUTLINED_FUNCTION_67_8();
    [v1 setObject:objc_msgSend(v4 forKeyedSubscript:{"cmioCompressedFormat"), *off_1E798C508}];
    [OUTLINED_FUNCTION_263() cmioHighResolutionPhotoEnabled];
    [v1 setObject:objc_msgSend(OUTLINED_FUNCTION_8() forKeyedSubscript:{"numberWithBool:"), *off_1E798C518}];
    [OUTLINED_FUNCTION_263() cmioFlashMode];
    [v1 setObject:objc_msgSend(OUTLINED_FUNCTION_8() forKeyedSubscript:{"numberWithInt:"), *off_1E798C510}];
    [OUTLINED_FUNCTION_263() cmioQualityPrioritization];
    [v1 setObject:objc_msgSend(OUTLINED_FUNCTION_8() forKeyedSubscript:{"numberWithInt:"), *off_1E798C530}];
    result = [v2 cmioMaxPhotoDimensions];
    if (result >= 1)
    {
      result = [v2 cmioMaxPhotoDimensions];
      if (SHIDWORD(result) >= 1)
      {
        [OUTLINED_FUNCTION_263() cmioMaxPhotoDimensions];
        [v1 setObject:objc_msgSend(OUTLINED_FUNCTION_8() forKeyedSubscript:{"numberWithInt:"), *off_1E798C528}];
        v5 = [v3 numberWithInt:{objc_msgSend(OUTLINED_FUNCTION_263(), "cmioMaxPhotoDimensions") >> 32}];
        v6 = *off_1E798C520;

        return [v1 setObject:v5 forKeyedSubscript:v6];
      }
    }
  }

  return result;
}

- (uint64_t)_shouldUseSphereForStillImageCaptureTakingLowLightIntoAccount:(uint64_t)result deviceMotionActivity:(int)activity frameStatisticsByPortType:(int)type
{
  if (result)
  {
    v5 = result;
    result = [*(result + 600) sphereEnabled];
    if (result)
    {
      isStationary = 0;
      v7 = *(v5 + 3296);
      if (v7 && type)
      {
        isStationary = [v7 isStationary];
      }

      if ([*(v5 + 600) motionDataInvalid])
      {
        return 0;
      }

      else
      {
        result = type & isStationary ^ 1u;
        if ((type & isStationary & 1) == 0 && activity)
        {
          v8 = OUTLINED_FUNCTION_44();

          return [(BWFigVideoCaptureDevice *)v8 _isLowLightSceneUsingFrameStatisticsByPortType:v9];
        }
      }
    }
  }

  return result;
}

- (void)_captureStillImageNowOnStreamWithOptions:captureStreamProperties:
{
  OUTLINED_FUNCTION_84();
  v4 = v3;
  if (!v0)
  {
    goto LABEL_81;
  }

  v5 = v2;
  v6 = v1;
  v7 = v0;
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_2_9();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  v78 = v6;
  if ([*(v7 + 2720) captureType] == 2)
  {
    [v7 setTorchLevel:0.0];
LABEL_12:
    HIDWORD(v77) = 0;
    goto LABEL_13;
  }

  if ([*(v7 + 2720) captureType] != 11)
  {
    goto LABEL_12;
  }

  [*(v7 + 2720) masterPortType];
  HIDWORD(v77) = [objc_msgSend(OUTLINED_FUNCTION_17() "captureStreamSettingsForPortType:"adaptiveBracketingGroupCaptureCount"")];
  if (SHIDWORD(v77) <= 1)
  {
    if (*(v7 + 2472) == 1)
    {
      [objc_msgSend(*(v7 + 600) "stream")];
    }

    if (*(v7 + 2473) == 1)
    {
      [objc_msgSend(*(v7 + 600) "stream")];
    }
  }

LABEL_13:
  OUTLINED_FUNCTION_6_78();
  v10 = OUTLINED_FUNCTION_52(v8, v9, v125, v124);
  v83 = v10;
  if (v10)
  {
    OUTLINED_FUNCTION_13_1();
    v82 = v12;
    *&v13 = 67109634;
    *v80 = v13;
    *&v13 = 136315906;
    *v79 = v13;
    v81 = v7;
    do
    {
      v14 = 0;
      do
      {
        OUTLINED_FUNCTION_13_1();
        if (v15 != v82)
        {
          objc_enumerationMutation(v5);
        }

        v16 = *(v125[1] + 8 * v14);
        [*(v7 + 600) stream];
        [v5 objectForKeyedSubscript:v16];
        v17 = [OUTLINED_FUNCTION_139_1() setProperty:? value:?];
        if (v17)
        {
          v19 = v17;
          FrameworkRadarComponent = FigCaptureGetFrameworkRadarComponent();
          LODWORD(v111) = 0;
          LOBYTE(type) = 0;
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
          OUTLINED_FUNCTION_8_1();
          fig_log_call_emit_and_clean_up_after_send_and_compose();
          v21 = [v5 objectForKeyedSubscript:v16];
          v122 = __PAIR64__(v19, v80[0]);
          *v123 = 2112;
          *&v123[2] = v16;
          *&v123[10] = 2112;
          *&v123[12] = v21;
          LODWORD(v75) = 28;
          OUTLINED_FUNCTION_5_61();
          v22 = _os_log_send_and_compose_impl();
          OUTLINED_FUNCTION_11();
          OUTLINED_FUNCTION_10();
          FigCapturePleaseFileRadar(v23, v24, v25, v26, "/Library/Caches/com.apple.xbs/Sources/CameraCapture/CMCapture/Sources/Graph/Base/BWFigVideoCaptureDevice.m", 10684, @"LastShownDate:BWFigVideoCaptureDevice.m:10684", @"LastShownBuild:BWFigVideoCaptureDevice.m:10684", &v122);
          free(v22);
          v7 = v81;
        }

        ++v14;
      }

      while (v83 != v14);
      v10 = OUTLINED_FUNCTION_52(v17, v18, v125, v124);
      v83 = v10;
    }

    while (v10);
  }

  memset(v113, 0, sizeof(v113));
  v27 = *(v7 + 656);
  if (OUTLINED_FUNCTION_37(v10, v11, v113, v112))
  {
    do
    {
      OUTLINED_FUNCTION_21_20();
      if (!v28)
      {
        objc_enumerationMutation(v27);
      }

      v29 = **(&v113[0] + 1);
      [**(&v113[0] + 1) portType];
      if ([OUTLINED_FUNCTION_7() captureStreamSettingsForPortType:?])
      {
        [v29 willCaptureStillImageFromFirmware];
      }

      OUTLINED_FUNCTION_51_11();
    }

    while (!v28 || OUTLINED_FUNCTION_37(v30, v31, v113, v112));
  }

  v111 = 0;
  if ((*(v7 + 156) & 1) == 0)
  {
    os_unfair_lock_lock((v7 + 144));
    v57 = [(BWFigVideoCaptureDevice *)v7 _ubAddSensorRawOutputBuffersToStillImageCaptureOptionsIfNeeded:v78 stillImageCaptureOptionsOut:&v111];
    os_unfair_lock_unlock((v7 + 144));
    if (v57)
    {
      FigDebugAssert3();
      goto LABEL_81;
    }
  }

  v32 = MEMORY[0x1E695FF58];
  if (*MEMORY[0x1E695FF58] == 1)
  {
    [*(v7 + 2720) settingsID];
    [*(v7 + 2720) captureType];
    kdebug_trace();
  }

  if (*(v7 + 2744) == 1)
  {
    syncGroup = [*(v7 + 648) syncGroup];
  }

  else
  {
    syncGroup = [*(v7 + 600) stream];
  }

  if (v111)
  {
    v34 = v111;
  }

  else
  {
    v34 = v78;
  }

  v35 = [syncGroup setProperty:*off_1E798C180 value:v34];
  if (*v32 == 1)
  {
    [*(v7 + 2720) settingsID];
    [*(v7 + 2720) captureType];
    kdebug_trace();
  }

  if (v111)
  {

    v111 = 0;
  }

  if (*(v7 + 3496))
  {
    [(BWFigVideoCaptureDevice *)v7 _resumeTimeMachines];
  }

  if (v35 == -12688)
  {
    ++*(v7 + 2748);
    os_unfair_lock_lock((v7 + 2712));
    if (([*(v7 + 2720) captureFlags] & 0x2000) == 0)
    {
      *(v7 + 2752) = 1;
      os_unfair_lock_unlock((v7 + 2712));
      goto LABEL_49;
    }

    v36 = *(v7 + 2748);
    *(v7 + 2752) = v36 < 8;
    os_unfair_lock_unlock((v7 + 2712));
    if (v36 < 8)
    {
LABEL_49:
      if (dword_1ED844350)
      {
        v37 = OUTLINED_FUNCTION_110_6();
        v45 = OUTLINED_FUNCTION_368(v37, v38, v39, v40, v41, v42, v43, v44, v74, v75, v76, v4, v77, v78, v79[0], v79[1], v80[0], v80[1], v81, v82, v83, FrameworkRadarComponent, v85, v86, v87, v88, v89, v90, v91, v92, v93, v94, v95, v96, v97, v98, v99, v100, v101, v102, v103, v104, v105, v106, v107, v108, v109, SBYTE2(v109), HIBYTE(v109), type);
        if (OUTLINED_FUNCTION_6(v45))
        {
          v46 = *(v7 + 2748);
          v114 = 136315650;
          OUTLINED_FUNCTION_117_5(v46);
          OUTLINED_FUNCTION_8_0();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        OUTLINED_FUNCTION_17_8();
      }

      goto LABEL_81;
    }

    if (dword_1ED844350)
    {
      v47 = OUTLINED_FUNCTION_110_6();
      v55 = OUTLINED_FUNCTION_368(v47, v48, v49, v50, v51, v52, v53, v54, v74, v75, v76, v4, v77, v78, v79[0], v79[1], v80[0], v80[1], v81, v82, v83, FrameworkRadarComponent, v85, v86, v87, v88, v89, v90, v91, v92, v93, v94, v95, v96, v97, v98, v99, v100, v101, v102, v103, v104, v105, v106, v107, v108, v109, SBYTE2(v109), HIBYTE(v109), type);
      if (OUTLINED_FUNCTION_6(v55))
      {
        v56 = *(v7 + 2748);
        v114 = 136315650;
        OUTLINED_FUNCTION_117_5(v56);
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_17_8();
    }
  }

  if (SHIDWORD(v77) >= 2 && v35)
  {
    if (dword_1ED844350)
    {
      v58 = OUTLINED_FUNCTION_110_6();
      os_log_type_enabled(v58, HIBYTE(v109));
      OUTLINED_FUNCTION_82_6();
      if (v28)
      {
        v60 = v59;
      }

      else
      {
        v60 = type;
      }

      if (v60)
      {
        v61 = BWPhotoEncoderStringFromEncodingScheme(11);
        settingsID = [*(v7 + 2720) settingsID];
        v114 = 136315907;
        v115 = "[BWFigVideoCaptureDevice _captureStillImageNowOnStreamWithOptions:captureStreamProperties:]";
        v116 = 2113;
        v117 = v61;
        v118 = 2048;
        v119 = settingsID;
        v120 = 1024;
        v121 = v35;
        OUTLINED_FUNCTION_338();
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_39_0();
    }

    portTypes = [*(v7 + 2720) portTypes];
    OUTLINED_FUNCTION_85();
    v65 = [v64 countByEnumeratingWithState:? objects:? count:?];
    if (v65)
    {
      v66 = v65;
      do
      {
        for (i = 0; i != v66; ++i)
        {
          OUTLINED_FUNCTION_89();
          if (!v28)
          {
            objc_enumerationMutation(portTypes);
          }

          v68 = [*(v7 + 2720) captureStreamSettingsForPortType:*(8 * i)];
          v69 = [BWFigVideoCaptureDevice _captureStreamByPortType:v7];
          [v68 setReachedEndOfAdaptiveBracketing:1];
          [*(v7 + 2720) masterPortType];
          if ([OUTLINED_FUNCTION_17() isEqualToString:?])
          {
            [v69 stillImageCaptureDelegate];
            if (v68)
            {
              [v68 adaptiveBracketingLastFramePTS];
            }

            else
            {
              *v123 = 0;
              v122 = 0;
              *&v123[8] = 0;
            }

            [OUTLINED_FUNCTION_118_0() captureStream:? didCaptureReferenceFrameWithPTS:? referenceFrameBracketedCaptureSequenceNumber:?];
          }

          [objc_msgSend(v69 "stillImageCaptureDelegate")];
        }

        OUTLINED_FUNCTION_85();
        v66 = OUTLINED_FUNCTION_37(v70, v71, v72, v73);
      }

      while (v66);
    }

    [objc_loadWeak((v7 + 2392)) stopAdaptiveBracketingForSettings:*(v7 + 2720) withGroup:(HIDWORD(v77) - 1)];
    [v7 _resetStillImageCaptureRequestState];
  }

LABEL_81:
  OUTLINED_FUNCTION_81();
}

- (uint64_t)_ubAddSensorRawOutputBuffersToStillImageCaptureOptionsIfNeeded:(void *)needed stillImageCaptureOptionsOut:
{
  if (!self)
  {
    return 0;
  }

  os_unfair_lock_assert_owner((self + 144));
  if ((*(self + 156) & 1) != 0 || ![*(self + 160) objectForKeyedSubscript:&unk_1F22469C0])
  {
    v6 = 0;
    v21 = 0;
    if (!needed)
    {
      return v6;
    }

    goto LABEL_28;
  }

  v21 = 0;
  v6 = 0;
  if (!needed || (*(self + 2242) & 1) == 0)
  {
LABEL_18:
    if (!needed)
    {
      return v6;
    }

    goto LABEL_28;
  }

  if (([*(self + 2720) captureFlags] & 0x300000000) == 0)
  {
    v21 = 0;
LABEL_27:
    v6 = 0;
    goto LABEL_28;
  }

  v21 = [a2 mutableCopy];
  if (*(self + 2744) == 1)
  {
    v25 = 0u;
    v26 = 0u;
    v23 = 0u;
    v24 = 0u;
    captureStreamSettings = [*(self + 2720) captureStreamSettings];
    OUTLINED_FUNCTION_345();
    v9 = [v8 countByEnumeratingWithState:? objects:? count:?];
    if (v9)
    {
      v10 = v9;
      neededCopy2 = needed;
      OUTLINED_FUNCTION_343();
      v11 = *off_1E798C5C8;
      while (2)
      {
        for (i = 0; i != v10; ++i)
        {
          OUTLINED_FUNCTION_13_1();
          if (v13 != needed)
          {
            objc_enumerationMutation(captureStreamSettings);
          }

          v14 = *(*(&v23 + 1) + 8 * i);
          [v14 portType];
          v15 = [OUTLINED_FUNCTION_28() objectForKeyedSubscript:?];
          v22[0] = 0;
          v16 = -[BWFigVideoCaptureDevice _ubAddSensorRawOutputBuffersToUnifiedBracketedCaptureParamsIfNeeded:unifiedBracketedCaptureParamsOut:](self, [v15 objectForKeyedSubscript:v11], v22);
          if (v16)
          {
            v6 = v16;
            OUTLINED_FUNCTION_1_5();
            goto LABEL_23;
          }

          v17 = [v15 mutableCopy];
          [v17 setObject:v22[0] forKeyedSubscript:v11];
          [v21 setObject:v17 forKeyedSubscript:{objc_msgSend(v14, "portType")}];
        }

        OUTLINED_FUNCTION_345();
        v10 = [captureStreamSettings countByEnumeratingWithState:? objects:? count:?];
        if (v10)
        {
          continue;
        }

        break;
      }

      v6 = 0;
      goto LABEL_17;
    }

    goto LABEL_27;
  }

  v22[0] = 0;
  v18 = *off_1E798C5C8;
  v6 = -[BWFigVideoCaptureDevice _ubAddSensorRawOutputBuffersToUnifiedBracketedCaptureParamsIfNeeded:unifiedBracketedCaptureParamsOut:](self, [a2 objectForKeyedSubscript:*off_1E798C5C8], v22);
  if (v6)
  {
    neededCopy2 = needed;
    OUTLINED_FUNCTION_0_8();
LABEL_23:
    FigDebugAssert3();

    v21 = 0;
LABEL_17:
    needed = neededCopy2;
    goto LABEL_18;
  }

  [v21 setObject:v22[0] forKeyedSubscript:v18];

LABEL_28:
  *needed = v21;
  return v6;
}

- (void)_stillImageCaptureInProgressSubstateForFrameStatisticsByPortType:masterPortType:captureType:captureFlags:
{
  OUTLINED_FUNCTION_60();
  if (!v1)
  {
    goto LABEL_27;
  }

  v6 = v5;
  v7 = v4;
  v8 = v3;
  v9 = v2;
  v10 = OUTLINED_FUNCTION_261(v1);
  os_unfair_lock_lock(v10);
  v11 = (v0 + 1384);
  if (*(v0 + 2808) != 1)
  {
    os_unfair_lock_unlock(v11);
    goto LABEL_15;
  }

  os_unfair_lock_assert_owner(v11);
  if ((*(v0 + 1388) & 1) == 0 && *(v0 + 1389) != 1)
  {
    v21 = *(v0 + 1390);
    os_unfair_lock_unlock((v0 + 1384));
    if (v21)
    {
      goto LABEL_6;
    }

LABEL_15:
    v18 = [v9 objectForKeyedSubscript:v8];
    if (v7 > 0xB || ((1 << v7) & 0x806) == 0 || *(v0 + 3496))
    {
      goto LABEL_27;
    }

    v20 = v18;
    if (v7 == 1 && (v18 = [v9 frameCount], v18 < 5))
    {
      OUTLINED_FUNCTION_147_2();
      v12 = 4;
    }

    else
    {
      v34 = v7;
      v22 = v6;
      if ((v6 & 0x400) != 0)
      {
        memset(v40, 0, 64);
        afStatus = OUTLINED_FUNCTION_1_0(v18, v19, v40, v39);
        if (afStatus)
        {
          v26 = afStatus;
          v25 = 0;
          do
          {
            v27 = 0;
            do
            {
              OUTLINED_FUNCTION_50_3();
              if (!v16)
              {
                objc_enumerationMutation(v9);
              }

              v28 = [objc_msgSend(v9 objectForKeyedSubscript:{*(v40[1] + 8 * v27)), "afStatus"}];
              v25 |= v28 == 2;
              ++v27;
            }

            while (v26 != v27);
            afStatus = OUTLINED_FUNCTION_1_0(v28, v29, v40, v39);
            v26 = afStatus;
          }

          while (afStatus);
        }

        else
        {
          v25 = 0;
        }
      }

      else
      {
        afStatus = [v20 afStatus];
        v25 = afStatus == 2;
      }

      if (v34 == 11)
      {
        if ([objc_msgSend(*(v0 + 2720) captureStreamSettingsForPortType:{v8), "adaptiveBracketingGroupCaptureCount"}] > 1)
        {
          goto LABEL_27;
        }

        v6 = v22;
        if ((v22 & 0x200) == 0 || (os_unfair_lock_lock((v0 + 2504)), v30 = *(v0 + 2508), os_unfair_lock_unlock((v0 + 2504)), v30 >= *(v0 + 2500)) || *(v0 + 2704) >= *(v0 + 2476))
        {
          [v20 focusingMethod];
          FigCaptureStreamFocusingMethodIsContrastBased();
        }

        if (dword_1ED844350)
        {
          v31 = OUTLINED_FUNCTION_235();
          os_log_type_enabled(v31, type);
          OUTLINED_FUNCTION_82_6();
          if (v16)
          {
            v33 = v32;
          }

          else
          {
            v33 = v38;
          }

          if (v33)
          {
            OUTLINED_FUNCTION_2_1();
            OUTLINED_FUNCTION_47_2();
          }

          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_39_0();
          OUTLINED_FUNCTION_147_2();
          v12 = 3;
          v6 = v22;
        }

        else
        {
          OUTLINED_FUNCTION_147_2();
          v12 = 3;
        }

        v7 = 11;
      }

      else
      {
        memset(v36, 0, sizeof(v36));
        if (OUTLINED_FUNCTION_1_0(afStatus, v24, v36, v35))
        {
          OUTLINED_FUNCTION_50_3();
          if (!v16)
          {
            objc_enumerationMutation(v9);
          }

          [objc_msgSend(v9 objectForKeyedSubscript:{**(&v36[0] + 1)), "focusingMethod"}];
          FigCaptureStreamFocusingMethodIsContrastBased();
        }

        v6 = v22;
        v7 = v34;
        if ((v25 ^ 1) & 1 | (*(v0 + 2704) >= *(v0 + 2812) + *(v0 + 2708)))
        {
          v12 = 1;
        }

        else
        {
          v12 = 2;
        }
      }
    }

    goto LABEL_7;
  }

  os_unfair_lock_unlock((v0 + 1384));
LABEL_6:
  OUTLINED_FUNCTION_147_2();
  v12 = 5;
LABEL_7:
  if (v12 >= 2 && dword_1ED844350)
  {
    v13 = OUTLINED_FUNCTION_235();
    v14 = v38;
    os_log_type_enabled(v13, type);
    OUTLINED_FUNCTION_97_0();
    if (v16)
    {
      v17 = v15;
    }

    else
    {
      v17 = v14;
    }

    if (v17)
    {
      [MEMORY[0x1E696AEC0] stringWithFormat:@"%d", v12];
      BWPhotoEncoderStringFromEncodingScheme(v7);
      BWStillImageCaptureFrameFlagsToShortString(v6);
      OUTLINED_FUNCTION_2_1();
      OUTLINED_FUNCTION_13();
      _os_log_send_and_compose_impl();
    }

    OUTLINED_FUNCTION_2_4();
    OUTLINED_FUNCTION_128();
  }

LABEL_27:
  OUTLINED_FUNCTION_128_0();
}

- (void)_logStillImageCaptureTimingStatisticsForCoreAnalytics
{
  if (self)
  {
    stillImageRequestTime = [*(self + 2720) stillImageRequestTime];
    ++*(self + 3584);
    if (([*(self + 2720) captureFlags] & 0x4000) != 0 || (v17 = 0, v18 = &v17, v19 = 0x2020000000, v20 = 0, OUTLINED_FUNCTION_0_7(), OUTLINED_FUNCTION_328(), v16[2] = __80__BWFigVideoCaptureDevice__logStillImageCaptureTimingStatisticsForCoreAnalytics__block_invoke, v16[3] = &unk_1E798FAF8, v16[4] = self, v16[5] = v3, dispatch_sync(v4, v16), v5 = *(v18 + 6), _Block_object_dispose(&v17, 8), v5 == 2))
    {
      ++*(self + 3588);
      return;
    }

    ++*(self + 3592);
    if (!*(self + 3604))
    {
      *(self + 3604) = FigHostTimeToNanoseconds() / 0xF4240uLL;
    }

    if (!*(self + 3608))
    {
      goto LABEL_31;
    }

    v6 = FigHostTimeToNanoseconds() / 0xF4240uLL;
    v7 = *(self + 3620);
    if (v7 <= v6)
    {
      v7 = v6;
    }

    *(self + 3620) = v7;
    v8 = *(self + 3616);
    if (v8 >= v6)
    {
      v8 = v6;
    }

    *(self + 3616) = v8;
    if (v6 > 0x1F3)
    {
      if (*(self + 3640))
      {
        *(self + 3640) = 0;
      }

      *(self + 3652) = 0;
      v10 = (self + 3656);
      if (v6 > 0x3E7)
      {
        if (*(self + 3641))
        {
          *(self + 3641) = 0;
        }

        *v10 = 0;
        goto LABEL_31;
      }

      v11 = (self + 3648);
      v12 = (self + 3628);
      if (*(self + 3641))
      {
LABEL_25:
        ++*v12;
        v13 = *v10;
        v14 = *v10 + 1;
        *v10 = v14;
        v15 = *v11;
        if (*v11 <= v14)
        {
          v15 = v13 + 1;
        }

        *v11 = v15;
LABEL_31:
        *(self + 3608) = stillImageRequestTime;
        return;
      }
    }

    else
    {
      if (*(self + 3640))
      {
        v9 = *(self + 3652) + 1;
      }

      else
      {
        *(self + 3640) = 1;
        ++*(self + 3632);
        v9 = 2;
      }

      ++*(self + 3624);
      *(self + 3652) = v9;
      if (*(self + 3644) > v9)
      {
        v9 = *(self + 3644);
      }

      *(self + 3644) = v9;
      v12 = (self + 3628);
      v10 = (self + 3656);
      v11 = (self + 3648);
      if (*(self + 3641))
      {
        goto LABEL_25;
      }
    }

    *(self + 3641) = 1;
    ++*(self + 3636);
    *(self + 3656) = 1;
    goto LABEL_25;
  }
}

- (void)_addStillImageSettingsToStillImageSampleBuffer:(uint64_t)buffer
{
  if (buffer)
  {
    if (target)
    {
      CMSetAttachment(target, @"BWStillImageCaptureSettings", *(buffer + 2720), 1u);
      [*(buffer + 2720) captureType];
      [OUTLINED_FUNCTION_7() numberWithInt:?];
      v3 = OUTLINED_FUNCTION_35_19();

      CMSetAttachment(v3, v4, v5, v6);
    }

    else
    {
      OUTLINED_FUNCTION_0();
      FigDebugAssert3();
    }
  }
}

- (unint64_t)_addPreviewWhiteBalanceMetadataToStillImageSampleBuffer:(unint64_t)result
{
  if (result)
  {
    if (a2)
    {
      v3 = result;
      result = [objc_msgSend(objc_msgSend(*(result + 2720) "metadata")];
      if (result)
      {
        result = [*(v3 + 2720) captureFlags];
        if ((result & 4) != 0)
        {
          v4 = [OUTLINED_FUNCTION_7_24(result *off_1E798A3C8)];
          v5 = *(v3 + 1560);
          if (!v5 || ([v5 portType], result = objc_msgSend(OUTLINED_FUNCTION_7(), "isEqualToString:"), (result & 1) == 0))
          {
            result = BWStillImageCaptureFrameFlagsForSampleBuffer(a2);
            if (result >> 62)
            {
              if ((result & 0x3000000000000000) == 0)
              {
                [objc_msgSend(objc_msgSend(*(v3 + 2720) "metadata")];
                v6 = OUTLINED_FUNCTION_8();

                return [v6 addEntriesFromDictionary:?];
              }
            }
          }
        }
      }
    }
  }

  return result;
}

- (uint64_t)_addADRCExposureRealizedGainToStillImageSampleBuffer:(uint64_t)result
{
  if (result)
  {
    if (a2)
    {
      v2 = result;
      v3 = OUTLINED_FUNCTION_4_12(a2, *off_1E798A3C8);
      [v3 objectForKeyedSubscript:*off_1E798B540];
      v4 = *(v2 + 1560);
      if (!v4 || ([v4 portType], result = objc_msgSend(OUTLINED_FUNCTION_8(), "isEqualToString:"), (result & 1) == 0))
      {
        result = [objc_msgSend(v3 objectForKeyedSubscript:{*off_1E798B1B8), "intValue"}];
        if (result >= 1)
        {
          v5 = *off_1E798A950;
          result = [v3 objectForKeyedSubscript:*off_1E798A950];
          if (result)
          {
            v6 = 1.0;
            if ([objc_msgSend(v3 objectForKeyedSubscript:{v5), "intValue"}] - 3 <= 0xFFFFFFFD)
            {
              os_unfair_lock_lock((v2 + 2140));
              [*(v2 + 2144) adrcExposureRealizedGain];
              v6 = v7;
              os_unfair_lock_unlock((v2 + 2140));
            }

            [objc_msgSend(v3 objectForKeyedSubscript:{@"ADRCExposureRealizedGain", "floatValue"}];
            *&v8 = v6;
            [MEMORY[0x1E696AD98] numberWithFloat:v8];
            v9 = OUTLINED_FUNCTION_17();

            return [v9 setObject:? forKeyedSubscript:?];
          }
        }
      }
    }
  }

  return result;
}

- (uint64_t)_addAutofocusAndDiagnosticMetadata:(uint64_t)result
{
  if (result)
  {
    if (a2)
    {
      v3 = result;
      v4 = OUTLINED_FUNCTION_1_19();
      v6 = CMGetAttachment(v4, v5, 0);
      if (!v6)
      {
        [MEMORY[0x1E695DF90] dictionary];
        v7 = OUTLINED_FUNCTION_45_12();
        CMSetAttachment(v7, v8, v9, 1u);
      }

      OUTLINED_FUNCTION_8_7();
      OUTLINED_FUNCTION_80_2();
      v14 = __62__BWFigVideoCaptureDevice__addAutofocusAndDiagnosticMetadata___block_invoke;
      v15 = &unk_1E798FE50;
      v17 = v6;
      v18 = a2;
      v16 = v3;
      dispatch_sync(v10, block);
      os_unfair_lock_lock((v3 + 3440));
      v11 = *(v3 + 3432);
      if (v11)
      {
        [v6 setObject:v11 forKeyedSubscript:*off_1E798A750];
      }

      os_unfair_lock_unlock((v3 + 3440));
      v12 = OUTLINED_FUNCTION_44();
      return [BWFigVideoCaptureDevice _addValidationAndCoreRepairStatusesToSampleBuffer:v12];
    }

    else
    {
      OUTLINED_FUNCTION_0();
      return FigDebugAssert3();
    }
  }

  return result;
}

- (void)_addPortraitSceneMonitoringMetadataToSampleBuffer:(uint64_t)buffer
{
  if (buffer)
  {
    if (!a2)
    {
      goto LABEL_8;
    }

    os_unfair_lock_lock((buffer + 1596));
    [*(buffer + 1616) focusDistanceToMaxAllowedFocusDistanceRatio];
    v4 = v3;
    os_unfair_lock_unlock((buffer + 1596));
    if (v4 == 0.0)
    {
      return;
    }

    v6 = OUTLINED_FUNCTION_7_24(v5, *off_1E798A3C8);
    if (v6)
    {
      v8 = v6;
      *&v7 = v4;
      v9 = [MEMORY[0x1E696AD98] numberWithFloat:v7];
      v10 = *off_1E798D338;

      [v8 setObject:v9 forKeyedSubscript:v10];
    }

    else
    {
LABEL_8:
      OUTLINED_FUNCTION_0();
      FigDebugAssert3();
    }
  }
}

- (void)_resetStillImageCaptureRequestState
{
  os_unfair_lock_lock(&self->_numberOfCompletedStillCaptures);
  digitalFlashExposureTimesForSceneMonitoringByPortType_low = LOBYTE(self->_digitalFlashExposureTimesForSceneMonitoringByPortType);
  v4 = BYTE1(self->_digitalFlashExposureTimesForSceneMonitoringByPortType);
  LOBYTE(self->_digitalFlashExposureTimesForSceneMonitoringByPortType) = 0;
  *(&self->_digitalFlashExposureTimesForSceneMonitoringByPortType + 1) = 0;
  captureFlags = [*&self->_skippedFramesCountForStillImageCaptureRetry captureFlags];
  [(BWFigVideoCaptureDevice *)self _resetStillImageCaptureRequestStateInternal];
  os_unfair_lock_unlock(&self->_numberOfCompletedStillCaptures);
  [(BWFigVideoCaptureDevice *)self _resumeTimeMachines];
  if (digitalFlashExposureTimesForSceneMonitoringByPortType_low != 1)
  {
    if (!v4)
    {
      goto LABEL_3;
    }

LABEL_6:
    [(BWFigCaptureStream *)[(BWFigVideoCaptureStream *)self->_captureStream stream] sendCommandProperty:*off_1E798BD90];
    if ((captureFlags & 0x200) == 0)
    {
      goto LABEL_12;
    }

    goto LABEL_7;
  }

  [(BWFigCaptureStream *)[(BWFigVideoCaptureStream *)self->_captureStream stream] sendCommandProperty:*off_1E798C248];
  if (v4)
  {
    goto LABEL_6;
  }

LABEL_3:
  if ((captureFlags & 0x200) == 0)
  {
    goto LABEL_12;
  }

LABEL_7:
  if (dword_1ED844350)
  {
    OUTLINED_FUNCTION_18_34();
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v7 = OUTLINED_FUNCTION_8_5(os_log_and_send_and_compose_flags_and_os_log_type);
    if (OUTLINED_FUNCTION_6(v7))
    {
      OUTLINED_FUNCTION_5();
      OUTLINED_FUNCTION_8_0();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_247();
    }

    OUTLINED_FUNCTION_2_4();
    OUTLINED_FUNCTION_17_8();
  }

  FigCaptureFrameRateFromFloat();
  [-[FigWeakReference referencedObject](self->_supplementalPointCloudCaptureDeviceDelegate "referencedObject")];
LABEL_12:

  *&self->_visionDataMaxFrameRate = 0;
  os_unfair_lock_lock(&self->_switchOverLock);
  LOWORD(self->_lastStillImageCaptureEndPTS.timescale) = 0;
  [*&self->_stillImageCaptureNowUsingSyncGroup transitionToState:2];
  os_unfair_lock_unlock(&self->_switchOverLock);
}

void __88__BWFigVideoCaptureDevice__serviceRetryStillImageCaptureUsingFrameStatisticsByPortType___block_invoke(uint64_t a1)
{
  OUTLINED_FUNCTION_86_3(a1);
  [BWFigVideoCaptureDevice _captureStillImageNowOnStreamWithOptions:captureStreamProperties:];
  if (v2)
  {
    v3 = v2;
    v4 = *(v1 + 32);

    [BWFigVideoCaptureDevice _terminateCaptureAndEmitStillImageCaptureError:v4 stillImageCaptureNowOptions:v3 stillImageCaptureStreamProperties:?];
  }
}

- (uint64_t)_updateSensorRegionOfInterest:(double)interest forZoomFactor:(double)factor aspectRatio:(double)ratio previewShiftInSensorSpace:(double)space streamProperty:(float)property
{
  if (result)
  {
    if (a2)
    {
      BWAspectRatioValueFromAspectRatio(a2);
      v12 = OUTLINED_FUNCTION_1_88();
      FigCaptureMetadataUtilitiesRectByCroppingRectToAspectRatio(v12, v13, v14, v15, v16);
    }

    v17 = OUTLINED_FUNCTION_1_88();
    FigCaptureMetadataUtilitiesNormalizeCropRect(v17, v18, v19, v20);
    *&v21 = property;
    fvcd_applyZoomAndPreviewShiftToSensorSpaceRect(v22, v23, v24, v25, v21, a8, a9, v26, v22, v23, v24, v25);
    v29 = (v28 * 1000.0);
    v31 = (v30 * 1000.0);
    v33 = (v32 * 1000.0);
    v35[0] = *off_1E798A280;
    v36[0] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:(v27 * 1000.0)];
    v35[1] = *off_1E798A2B0;
    v36[1] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v29];
    v35[2] = *off_1E798A2C0;
    v36[2] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v31];
    v35[3] = *off_1E798A288;
    v36[3] = [MEMORY[0x1E696AD98] numberWithUnsignedInt:v33];
    [MEMORY[0x1E695DF20] dictionaryWithObjects:v36 forKeys:v35 count:4];
    v34 = OUTLINED_FUNCTION_44();
    return [BWFigVideoCaptureDevice _setSynchronizedStreamsGroupProperty:v34 value:?];
  }

  return result;
}

- (uint64_t)_updateSensorRegionOfInterestForActiveFraming
{
  if (!result)
  {
    return result;
  }

  v1 = result;
  if (*(result + 189) != 1 || *(result + 4328) != 1 || *(result + 3796) != 1)
  {
    return result;
  }

  if (*(result + 3872) == 1 && (*(result + 240) & 1) == 0)
  {
    [objc_msgSend(*(result + 4240) "referencedObject")];
    referencedObject = [v1[542] referencedObject];
    v3 = 1;
    goto LABEL_13;
  }

  if (*(result + 4257) == 1 && (*(result + 4344) & 1) == 0 && (*(result + 240) & 1) == 0)
  {
    OUTLINED_FUNCTION_16_5();
    if (!CGRectEqualToRect(v12, v13))
    {
      [objc_msgSend(v1[530] "referencedObject")];
      referencedObject = [v1[542] referencedObject];
      v3 = 0;
LABEL_13:

      return [referencedObject setRegionOfInterestForCameraControlsFeedbackEnabled:v3];
    }
  }

  [objc_msgSend(v1[530] "referencedObject")];
  [objc_msgSend(v1[542] "referencedObject")];
  [v1 aspectRatio];
  v5 = OUTLINED_FUNCTION_308();
  v9 = *MEMORY[0x1E695EFF8];
  v10 = *(MEMORY[0x1E695EFF8] + 8);

  return [(BWFigVideoCaptureDevice *)v1 _updateSensorRegionOfInterest:v4 forZoomFactor:v5 aspectRatio:v6 previewShiftInSensorSpace:v7 streamProperty:v8, 1.0, v9, v10];
}

- (int)setSubjectAreaChangeMonitoringEnabled:(BOOL)enabled
{
  [MEMORY[0x1E696AD98] numberWithBool:enabled];
  v3 = OUTLINED_FUNCTION_17();

  return [(BWFigVideoCaptureDevice *)v3 _setAutofocusProcessorProperty:v4 propertyValue:?];
}

void __153__BWFigVideoCaptureDevice_setFocusModeAutoWithRect_restrictToRect_continuous_smooth_rangeRestrictionNear_rangeRestrictionFar_isFocusRectInOverscanSpace___block_invoke(uint64_t a1)
{
  v6 = 1944;
  if (*(a1 + 88))
  {
    v6 = 3832;
  }

  v7 = 1952;
  if (*(a1 + 88))
  {
    v7 = 3840;
  }

  v8 = 1960;
  if (*(a1 + 88))
  {
    v8 = 3848;
  }

  FigCaptureTransformNormalizedRectFromCoordinateSpaceOfNormalizedRect(*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64), *(*(a1 + 32) + v6), *(*(a1 + 32) + v7), *(*(a1 + 32) + v8));
  OUTLINED_FUNCTION_2_3();
  [*(a1 + 32) zoomFactor];
  v9 = *(a1 + 32);
  if (*(a1 + 89) == 1)
  {
    v9[235] = v1;
    v9[236] = v2;
    v9[237] = v3;
    v9[238] = v4;
  }

  else
  {
    v10 = v9 + 235;
    v11 = *(MEMORY[0x1E695F050] + 16);
    *v10 = *MEMORY[0x1E695F050];
    v10[1] = v11;
  }

  v18 = 0;
  v19 = 0;
  OUTLINED_FUNCTION_3();
  [BWFigVideoCaptureDevice _getAutoFocusPropertyKeyAndAreaOfInterestWithNormalizedRectInSensorSpace:v12 zoomFactor:? propertyKeyOut:? propertyValueOut:?];
  OUTLINED_FUNCTION_0_7();
  OUTLINED_FUNCTION_328();
  v16[2] = __153__BWFigVideoCaptureDevice_setFocusModeAutoWithRect_restrictToRect_continuous_smooth_rangeRestrictionNear_rangeRestrictionFar_isFocusRectInOverscanSpace___block_invoke_2;
  v16[3] = &unk_1E799B950;
  v17 = *(a1 + 90);
  v16[4] = v13;
  v16[5] = 0;
  v16[8] = *(a1 + 80);
  v14 = *(a1 + 72);
  v16[6] = 0;
  v16[7] = v14;
  dispatch_sync(v15, v16);
}

uint64_t __153__BWFigVideoCaptureDevice_setFocusModeAutoWithRect_restrictToRect_continuous_smooth_rangeRestrictionNear_rangeRestrictionFar_isFocusRectInOverscanSpace___block_invoke_2(uint64_t a1, double a2)
{
  v3 = *(a1 + 32);
  if (*(v3 + 3946) == 1 && *(v3 + 2008) == 2)
  {
    v4 = MEMORY[0x1E695E118];
  }

  else
  {
    v4 = [MEMORY[0x1E696AD98] numberWithBool:*(a1 + 72)];
  }

  v5 = *(a1 + 40);
  v12[0] = *(a1 + 48);
  v11[0] = v5;
  v11[1] = @"near";
  LODWORD(a2) = *(a1 + 64);
  v12[1] = [MEMORY[0x1E696AD98] numberWithFloat:{a2, v5, @"near"}];
  v11[2] = @"far";
  LODWORD(v6) = *(a1 + 68);
  v11[3] = @"smooth";
  v12[2] = [MEMORY[0x1E696AD98] numberWithFloat:v6];
  v12[3] = v4;
  v7 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v12 forKeys:v11 count:4];
  [MEMORY[0x1E696AD98] numberWithBool:*(a1 + 73)];
  v8 = OUTLINED_FUNCTION_8();
  [(BWFigVideoCaptureDevice *)v8 _setAutofocusProcessorPropertyInternal:v9 propertyValue:?];
  return [(BWFigVideoCaptureDevice *)*(a1 + 32) _setAutofocusProcessorPropertyInternal:v7 propertyValue:?];
}

- (uint64_t)_updateAutoFocusAreaOfInterestWithNormalizedRectInSensorSpace:(uint64_t)space zoomFactor:
{
  if (!space)
  {
    return 0;
  }

  OUTLINED_FUNCTION_258();
  v2 = v1;
  if (!_FigIsCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_0();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  OUTLINED_FUNCTION_16_3();
  [BWFigVideoCaptureDevice _getAutoFocusPropertyKeyAndAreaOfInterestWithNormalizedRectInSensorSpace:v3 zoomFactor:? propertyKeyOut:? propertyValueOut:?];
  if (!v4)
  {
    return [(BWFigVideoCaptureDevice *)v2 _setAutofocusProcessorProperty:0 propertyValue:?];
  }

  v5 = v4;
  OUTLINED_FUNCTION_1_5();
  FigDebugAssert3();
  return v5;
}

- (int)setFocusModeManualWithLensPosition:(float)position requestID:(int)d
{
  v4 = *&d;
  OUTLINED_FUNCTION_52_16();
  if (!v7)
  {
    v12 = ((1.0 - v6) * 255.0);
    goto LABEL_12;
  }

  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  isBravoVariant = [(BWFigVideoCaptureDevice *)self isBravoVariant];
  autoImageControlModeCompletionHandler = self->_autoImageControlModeCompletionHandler;
  if (!isBravoVariant)
  {
    if (autoImageControlModeCompletionHandler != 8)
    {
      v12 = 0x7FFFFFFFLL;
      goto LABEL_11;
    }

    [(BWFigVideoCaptureStream *)self->_captureStream portType];
    v10 = [OUTLINED_FUNCTION_7() objectForKeyedSubscript:?];
    goto LABEL_8;
  }

  [(BWFigVideoCaptureStream *)self->_captureStream portType];
  v10 = [OUTLINED_FUNCTION_7() objectForKeyedSubscript:?];
  if (autoImageControlModeCompletionHandler == 8)
  {
LABEL_8:
    logicalFocusLensPosition = [v10 logicalFocusLensPosition];
    goto LABEL_9;
  }

  logicalFocusLensPosition = [v10 focusPosition];
LABEL_9:
  v12 = logicalFocusLensPosition;
LABEL_11:
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
LABEL_12:
  v20[0] = *off_1E798AEB8;
  v21[0] = [MEMORY[0x1E696AD98] numberWithInt:v12];
  v20[1] = *off_1E798A1C8;
  v21[1] = [MEMORY[0x1E696AD98] numberWithInt:v4];
  v13 = -[BWFigVideoCaptureDevice _setAutofocusProcessorProperty:propertyValue:](self, 0x1F218A070, [MEMORY[0x1E695DF20] dictionaryWithObjects:v21 forKeys:v20 count:2]);
  if (v13)
  {
    OUTLINED_FUNCTION_0_8();
    FigDebugAssert3();
  }

  else
  {
    OUTLINED_FUNCTION_8_7();
    OUTLINED_FUNCTION_80_2();
    v17 = __72__BWFigVideoCaptureDevice_setFocusModeManualWithLensPosition_requestID___block_invoke;
    v18 = &unk_1E798F870;
    selfCopy = self;
    dispatch_sync(v14, block);
  }

  return v13;
}

- (void)setSimulatedAperture:(float)aperture
{
  if (*&self->_firstValidFramePTS.epoch != aperture)
  {
    *&self->_firstValidFramePTS.epoch = aperture;
    referencedObject = [(FigWeakReference *)self->_centerStageDelegate referencedObject];
    *&v5 = aperture;

    [referencedObject setSimulatedAperture:v5];
  }
}

- (uint64_t)_setSmoothFocusEnabled:(uint64_t)enabled
{
  if (!enabled)
  {
    return 0;
  }

  v7[0] = 0;
  v7[1] = v7;
  v7[2] = 0x2020000000;
  v8 = 0;
  v3 = *(enabled + 1656);
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __50__BWFigVideoCaptureDevice__setSmoothFocusEnabled___block_invoke;
  v5[3] = &unk_1E799C1E0;
  v6 = a2;
  v5[4] = enabled;
  v5[5] = v7;
  v5[6] = 0x1F218A090;
  dispatch_sync(v3, v5);
  OUTLINED_FUNCTION_190();
  return v2;
}

uint64_t __50__BWFigVideoCaptureDevice__setSmoothFocusEnabled___block_invoke(uint64_t a1)
{
  [MEMORY[0x1E696AD98] numberWithBool:{*(a1 + 56), @"smooth"}];
  OUTLINED_FUNCTION_92_5(MEMORY[0x1E695DF20], v2);
  v3 = OUTLINED_FUNCTION_348();
  v5 = [(BWFigVideoCaptureDevice *)v3 _setAutofocusProcessorProperty:v4 propertyValue:?];
  return OUTLINED_FUNCTION_93_3(v5);
}

- (uint64_t)_focusIsStable:(uint64_t)result
{
  if (result)
  {
    if ([a2 afStatus] != 4 && objc_msgSend(a2, "afStatus") != 3)
    {
      [a2 focusingMethod];
      FigCaptureStreamFocusingMethodIsPhaseDetectionBased();
    }

    return 1;
  }

  return result;
}

- (uint64_t)_setExposureModeAutoWithRect:(double)rect isDefaultRect:(double)defaultRect
{
  if (!self)
  {
    return 0;
  }

  v11[0] = 0;
  v11[1] = v11;
  v11[2] = 0x2020000000;
  v12 = 0;
  v7 = *(self + 1656);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __70__BWFigVideoCaptureDevice__setExposureModeAutoWithRect_isDefaultRect___block_invoke;
  block[3] = &unk_1E799C1B8;
  *&block[6] = rect;
  *&block[7] = defaultRect;
  *&block[8] = a5;
  *&block[9] = a6;
  v10 = a2;
  block[4] = self;
  block[5] = v11;
  dispatch_sync(v7, block);
  OUTLINED_FUNCTION_190();
  return v6;
}

- (int)setExposureModeLocked
{
  v3 = [(BWFigVideoCaptureDevice *)self _setAutofocusProcessorProperty:*MEMORY[0x1E695E738] propertyValue:?];
  if (v3)
  {
    FigDebugAssert3();
  }

  else
  {
    OUTLINED_FUNCTION_8_7();
    OUTLINED_FUNCTION_80_2();
    v7 = __48__BWFigVideoCaptureDevice_setExposureModeLocked__block_invoke;
    v8 = &unk_1E798F870;
    selfCopy = self;
    dispatch_sync(v4, block);
  }

  return v3;
}

- (int)setExposureTargetBias:(float)bias requestID:(int)d
{
  v5 = *&d;
  OUTLINED_FUNCTION_52_16();
  if (v7)
  {
    [(BWFigVideoCaptureDevice *)self exposureTargetBias];
  }

  v10[0] = *off_1E798BE20;
  v11[0] = [OUTLINED_FUNCTION_208() numberWithFloat:?];
  v10[1] = *off_1E798A1C8;
  v11[1] = [*(v4 + 3480) numberWithInt:v5];
  v8 = -[BWFigVideoCaptureDevice _setAutofocusProcessorProperty:propertyValue:](self, 0x1F218A450, [MEMORY[0x1E695DF20] dictionaryWithObjects:v11 forKeys:v10 count:2]);
  if (v8)
  {
    OUTLINED_FUNCTION_0_6();
    FigDebugAssert3();
  }

  return v8;
}

- (float)exposureTargetBias
{
  if (!self)
  {
    return 0.0;
  }

  FigSimpleMutexLock();
  v2 = *(self + 2888);
  FigSimpleMutexUnlock();
  return v2;
}

- (int)setExposureModeCustomWithExposureDuration:(id *)duration minFrameRate:(double)rate maxFrameRate:(double)frameRate ISO:(float)o requestID:(int)d
{
  v7 = *&d;
  v21[0] = @"IntegrationTime";
  time = *duration;
  v22[0] = [MEMORY[0x1E696AD98] numberWithDouble:CMTimeGetSeconds(&time)];
  v21[1] = @"ISO";
  *&v12 = o;
  v22[1] = [MEMORY[0x1E696AD98] numberWithFloat:v12];
  v21[2] = @"ManualExposureMinFrameRate";
  v22[2] = [MEMORY[0x1E696AD98] numberWithDouble:rate];
  v21[3] = @"ManualExposureMaxFrameRate";
  v22[3] = [MEMORY[0x1E696AD98] numberWithDouble:frameRate];
  v21[4] = *off_1E798A1C8;
  v22[4] = [MEMORY[0x1E696AD98] numberWithInt:v7];
  v13 = -[BWFigVideoCaptureDevice _setAutofocusProcessorProperty:propertyValue:](self, 0x1F2189FB0, [MEMORY[0x1E695DF20] dictionaryWithObjects:v22 forKeys:v21 count:5]);
  if (v13)
  {
    OUTLINED_FUNCTION_0_8();
    FigDebugAssert3();
  }

  else
  {
    OUTLINED_FUNCTION_8_7();
    OUTLINED_FUNCTION_80_2();
    v17 = __109__BWFigVideoCaptureDevice_setExposureModeCustomWithExposureDuration_minFrameRate_maxFrameRate_ISO_requestID___block_invoke;
    v18 = &unk_1E798F870;
    selfCopy = self;
    dispatch_sync(v14, block);
  }

  return v13;
}

uint64_t __70__BWFigVideoCaptureDevice__setExposureModeAutoWithRect_isDefaultRect___block_invoke(uint64_t a1)
{
  MidX = CGRectGetMidX(*(a1 + 48));
  MidY = CGRectGetMidY(*(a1 + 48));
  if (*(a1 + 80) == 1)
  {
    v4 = MidX != 0.5;
    if (MidY != 0.5)
    {
      v4 = 1;
    }
  }

  else
  {
    v4 = 1;
  }

  *(*(a1 + 32) + 1872) = v4;
  v5 = OUTLINED_FUNCTION_188(*(a1 + 48), *(a1 + 56), *(a1 + 64), *(a1 + 72));
  OUTLINED_FUNCTION_299(v5, v6, v7, v8);
  v9 = [(BWFigVideoCaptureDevice *)*(a1 + 32) previewShiftInSensorSpace];
  v11 = v10;
  v12 = *(a1 + 32);
  [v12 zoomFactor];
  LODWORD(v14) = v13;
  v15 = *(a1 + 32);
  fvcd_applyZoomAndPreviewShiftToSensorSpaceRect(*(v12 + 1840), *(v12 + 1848), *(v12 + 1856), *(v12 + 1864), v14, v9, v11, v15[246], v15[243], v15[244], v15[245], v15[246]);
  v17 = v16;
  v19 = v18;
  v21 = v20;
  v27[0] = @"x";
  v28[0] = [OUTLINED_FUNCTION_249() numberWithDouble:?];
  v27[1] = @"y";
  v28[1] = [*(v12 + 3480) numberWithDouble:v17];
  v27[2] = @"w";
  v28[2] = [*(v12 + 3480) numberWithDouble:v19];
  v27[3] = @"h";
  v28[3] = [*(v12 + 3480) numberWithDouble:v21];
  [MEMORY[0x1E695DF20] dictionaryWithObjects:v28 forKeys:v27 count:4];
  v22 = OUTLINED_FUNCTION_348();
  v24 = &kFigImageControlSampleBufferProcessorProperty_SpotMeteredExposure;
  if (!*(v22 + 1872))
  {
    v24 = &kFigImageControlSampleBufferProcessorProperty_AutoExposure;
  }

  v25 = [(BWFigVideoCaptureDevice *)v22 _setAutofocusProcessorProperty:v23 propertyValue:?];
  return OUTLINED_FUNCTION_93_3(v25);
}

- (void)_updateVariableFrameRateSettings
{
  if (self)
  {
    OUTLINED_FUNCTION_134_4();
    v4 = v3;
    os_unfair_lock_lock(v3 + 994);
    v5 = *&v4[990]._os_unfair_lock_opaque;
    v6 = *&v4[991]._os_unfair_lock_opaque;
    os_unfair_lock_unlock(v4 + 994);
    if (v5 != v6)
    {
      OUTLINED_FUNCTION_346();
      v31 = v7;
      OUTLINED_FUNCTION_13_14();
      obj = v8;
      v30 = [v8 countByEnumeratingWithState:? objects:? count:?];
      if (v30)
      {
        v29 = *off_1E798A0D8;
        v27 = *off_1E798BC00;
        do
        {
          for (i = 0; i != v30; ++i)
          {
            OUTLINED_FUNCTION_21_20();
            if (!v20)
            {
              objc_enumerationMutation(obj);
            }

            v10 = *(v31 + 8 * i);
            v11 = [objc_msgSend(v10 "portType")];
            if (!v11 || (v4[998]._os_unfair_lock_opaque & 1) != 0 || v5 != 24.0)
            {
              [v10 portType];
              [OUTLINED_FUNCTION_47() getAEMaxGainForPortType:v5 suggestedFrameRate:?];
              v13 = v12;
              [v10 portType];
              [objc_msgSend(OUTLINED_FUNCTION_47() "objectForKeyedSubscript:"floatValue"")];
              v15 = v14;
              FigCaptureFrameRateFromFloat();
              v1 = v1 & 0xFFFFFFFF00000000 | v16;
              [v10 setMaximumFrameRate:{v17, v1}];
              FigCaptureFrameRateFromFloat();
              v2 = v2 & 0xFFFFFFFF00000000 | v18;
              [v10 setMinimumFrameRate:{v19, v2}];
              v20 = v13 <= 0.0 || v13 == v15;
              if (!v20)
              {
                stream = [v10 stream];
                LODWORD(v22) = vcvts_n_s32_f32(v13, 8uLL);
                if (![stream setProperty:v27 value:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v22)}])
                {
                  *&v23 = v13;
                  [v10 setAeMaxGain:v23];
                  *&v24 = v13;
                  v25 = [MEMORY[0x1E696AD98] numberWithFloat:v24];
                  [v10 portType];
                  [OUTLINED_FUNCTION_6_44() setObject:v25 forKeyedSubscript:?];
                  if (v11)
                  {
                    *&v26 = v13;
                    [*&v4[354]._os_unfair_lock_opaque setTeleMaxAEGain:v26];
                    [v10 maxEIT];
                    [*&v4[354]._os_unfair_lock_opaque setTeleMaxEIT:?];
                  }
                }
              }
            }
          }

          OUTLINED_FUNCTION_13_14();
          v30 = [obj countByEnumeratingWithState:? objects:? count:?];
        }

        while (v30);
      }

      os_unfair_lock_lock(v4 + 994);
      *&v4[991]._os_unfair_lock_opaque = v5;
      os_unfair_lock_unlock(v4 + 994);
    }

    OUTLINED_FUNCTION_133_5();
  }
}

- (void)setCinematicVideoEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  BYTE1(self->_variableFrameRateLastRequestedAEMaxGainByPortType) = enabled;
  if (enabled)
  {
    v5 = 0x1F2175010;
  }

  else
  {
    v5 = 0;
  }

  [(BWFigVideoCaptureDevice *)self _setAutofocusProcessorProperty:v5 propertyValue:?];
  v63 = 0;
  [(BWFigVideoCaptureDevice *)self _copyAutofocusProcessorProperty:&v63 propertyValueOut:?];
  if (CFEqual(v63, @"AEAndAF"))
  {
    v6 = 3;
  }

  else if (CFEqual(v63, @"AEOnly"))
  {
    v6 = 1;
  }

  else
  {
    v6 = 2 * (CFEqual(v63, @"AFOnly") != 0);
  }

  [(BWFigVideoCaptureDevice *)self setFaceDetectionDrivenImageProcessingMode:v6];
  OUTLINED_FUNCTION_7_42();
  captureStreams = self->_captureStreams;
  if (OUTLINED_FUNCTION_1_3(v8, v9, v10, v11, v12, v13, v14, v15, v28, v30, v32, v34, v36, v38, v40, v42, v44, v46, v48, v50, v52, v54, v56, v58, v60))
  {
    OUTLINED_FUNCTION_125_4();
    v17 = *v16;
    do
    {
      OUTLINED_FUNCTION_4_10();
      if (v18 != v17)
      {
        objc_enumerationMutation(captureStreams);
      }

      [*v62 setCinematicVideoEnabled:enabledCopy];
      OUTLINED_FUNCTION_120_0();
    }

    while (!v27 || OUTLINED_FUNCTION_1_3(v19, v20, v21, v22, v23, v24, v25, v26, v29, v31, v33, v35, v37, v39, v41, v43, v45, v47, v49, v51, v53, v55, v57, v59, v61));
  }
}

- (void)_serviceStereoVideoCaptureSceneMonitoringWithFrameStatisticsByPortType:(int)type sceneFlags:(int)flags
{
  if (self)
  {
    OUTLINED_FUNCTION_91();
    a48 = v50;
    a49 = v51;
    OUTLINED_FUNCTION_67_8();
    v53 = v52;
    OUTLINED_FUNCTION_231();
    OUTLINED_FUNCTION_17_20();
    obja = v54;
    v55 = [v54 countByEnumeratingWithState:? objects:? count:?];
    if (v55)
    {
      v56 = v55;
      do
      {
        v57 = 0;
        do
        {
          OUTLINED_FUNCTION_142_0();
          if (!v58)
          {
            objc_enumerationMutation(obja);
          }

          v59 = *(a29 + 8 * v57);
          a11 = 1;
          os_unfair_lock_lock((v53 + 1644));
          v60 = *(v53 + 1632);
          [v59 portType];
          LODWORD(v59) = [v60 resolveStereoVideoCaptureStatusWithFrameStatistics:objc_msgSend(OUTLINED_FUNCTION_4() sceneFlags:"objectForKeyedSubscript:") stereoVideoCaptureStatusOut:{v49, &a11}];
          os_unfair_lock_unlock((v53 + 1644));
          if (v59)
          {
            [BWFigVideoCaptureDevice _updateStereoVideoCaptureStatus:v53];
          }

          ++v57;
        }

        while (v56 != v57);
        OUTLINED_FUNCTION_17_20();
        v56 = [obja countByEnumeratingWithState:? objects:? count:?];
      }

      while (v56);
    }

    OUTLINED_FUNCTION_90_3();
  }
}

- (void)_updateStereoVideoCaptureStatus:(uint64_t)status
{
  if (status)
  {
    OUTLINED_FUNCTION_54();
    os_unfair_lock_lock(v3 + 411);
    if (v1[410]._os_unfair_lock_opaque == v2)
    {

      os_unfair_lock_unlock(v1 + 411);
    }

    else
    {
      v1[410]._os_unfair_lock_opaque = v2;
      os_unfair_lock_unlock(v1 + 411);
      v4 = [MEMORY[0x1E695DF90] dictionaryWithObjectsAndKeys:{objc_msgSend(MEMORY[0x1E696AD98], "numberWithInt:", v2), @"NewPropertyValue", 0}];

      [(os_unfair_lock_s *)v1 _postNotificationWithPayload:@"StereoVideoCaptureStatusChanged" notificationPayload:v4];
    }
  }
}

- (int)setProvidesStortorgetMetadata:(BOOL)metadata
{
  [MEMORY[0x1E696AD98] numberWithBool:metadata];
  v3 = OUTLINED_FUNCTION_17();

  return [(BWFigVideoCaptureDevice *)v3 _setAutofocusProcessorProperty:v4 propertyValue:?];
}

- (void)_updateStreamingImageIntentWithNewImageControlMode:(uint64_t)mode oldImageControlMode:(uint64_t)controlMode
{
  if (self)
  {
    OUTLINED_FUNCTION_58_2();
    v36 = v35;
    v38 = v37;
    v40 = v39;
    os_unfair_lock_assert_owner(v39 + 535);
    if (v38 != v36)
    {
      v41 = v38;
      if ((v38 - 5) >= 2)
      {
        if (v40[1013]._os_unfair_lock_opaque > 2 || (v40[1014]._os_unfair_lock_opaque & 1) != 0)
        {
          v41 = 8;
        }

        else
        {
          os_unfair_lock_opaque = v40[596]._os_unfair_lock_opaque;
          if (os_unfair_lock_opaque == 2)
          {
            v43 = 2;
          }

          else
          {
            v43 = os_unfair_lock_opaque == 1;
          }

          os_unfair_lock_assert_owner(v40 + 535);
          v44 = *&v40[584]._os_unfair_lock_opaque;
          if (v44)
          {
            bOOLValue = [v44 BOOLValue];
          }

          else
          {
            bOOLValue = v40[583]._os_unfair_lock_opaque;
          }

          if (bOOLValue)
          {
            v41 = 4;
          }

          else
          {
            v41 = v43;
          }
        }
      }

      v40[570]._os_unfair_lock_opaque = v41;
      LOBYTE(v40[568]._os_unfair_lock_opaque) = 1;
      if (dword_1ED844350)
      {
        OUTLINED_FUNCTION_112();
        OUTLINED_FUNCTION_325();
        v46 = OUTLINED_FUNCTION_77();
        os_log_type_enabled(v46, a34);
        OUTLINED_FUNCTION_30();
        if (v34)
        {
          fvcd_streamingImageIntentToString(v40[570]._os_unfair_lock_opaque);
          OUTLINED_FUNCTION_5();
          OUTLINED_FUNCTION_11_0();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        fig_log_call_emit_and_clean_up_after_send_and_compose();
      }
    }

    OUTLINED_FUNCTION_56();
  }
}

- (int)setWhiteBalanceModeLockedWithGains:(id)gains requestID:(int)d
{
  v5 = *&d;
  var2 = gains.var2;
  var1 = gains.var1;
  var0 = gains.var0;
  v10 = *&self->_deviceWhiteBalanceGains.greenGain;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __72__BWFigVideoCaptureDevice_setWhiteBalanceModeLockedWithGains_requestID___block_invoke;
  block[3] = &unk_1E7991EF8;
  block[4] = self;
  dCopy = d;
  gainsCopy = gains;
  dispatch_sync(v10, block);
  v17[0] = *off_1E798AED0;
  v11 = OUTLINED_FUNCTION_208();
  LODWORD(v12) = vcvts_n_s32_f32(var0, 0xCuLL);
  v18[0] = [v11 numberWithUnsignedShort:v12];
  v17[1] = *off_1E798AEC8;
  LODWORD(v13) = vcvts_n_s32_f32(var1, 0xCuLL);
  v18[1] = [*(v4 + 3480) numberWithUnsignedShort:v13];
  v17[2] = *off_1E798AEC0;
  LODWORD(v14) = vcvts_n_s32_f32(var2, 0xCuLL);
  v18[2] = [*(v4 + 3480) numberWithUnsignedShort:v14];
  v17[3] = *off_1E798A1C8;
  v18[3] = [*(v4 + 3480) numberWithInt:v5];
  v15 = -[BWFigVideoCaptureDevice _setAutofocusProcessorProperty:propertyValue:](self, 0x1F218A470, [MEMORY[0x1E695DF20] dictionaryWithObjects:v18 forKeys:v17 count:4]);
  if (v15)
  {
    OUTLINED_FUNCTION_0_6();
    FigDebugAssert3();
  }

  return v15;
}

- (float)_exifFocalLengthOverrideForZoomFactor:(uint64_t)factor
{
  v2 = 0.0;
  if (factor)
  {
    if (*(factor + 4432))
    {
      v5 = OUTLINED_FUNCTION_1_13();
      allKeys = [v6 allKeys];
      OUTLINED_FUNCTION_43();
      v9 = [v8 countByEnumeratingWithState:? objects:? count:?];
      if (v9)
      {
        v10 = v9;
        v11 = 0;
        v12 = 0;
        v13 = *v33;
        do
        {
          for (i = 0; i != v10; ++i)
          {
            OUTLINED_FUNCTION_4_10();
            if (v15 != v13)
            {
              objc_enumerationMutation(allKeys);
            }

            v16 = *(v32 + 8 * i);
            [v16 floatValue];
            v18 = v17;
            if (v17 <= a2)
            {
              if (!v12 || ([v12 floatValue], v18 > v19))
              {
                v12 = v16;
              }
            }

            if (v18 >= a2)
            {
              if (!v11 || ([v11 floatValue], v18 < v20))
              {
                v11 = v16;
              }
            }
          }

          OUTLINED_FUNCTION_43();
          v10 = OUTLINED_FUNCTION_52(v21, v22, v23, v24);
        }

        while (v10);
        if (v12)
        {
          if (v11)
          {
            [v12 floatValue];
            v26 = v25;
            [v11 floatValue];
            v28 = v27;
            [objc_msgSend(*(factor + 4432) objectForKeyedSubscript:{v12), "floatValue"}];
            v2 = v29;
            [objc_msgSend(*(factor + 4432) objectForKeyedSubscript:{v11), "floatValue"}];
            if ((v28 - v26) > 0.0)
            {
              return v2 + ((v30 - v2) * ((a2 - v26) / (v28 - v26)));
            }
          }
        }
      }
    }
  }

  return v2;
}

uint64_t __112__BWFigVideoCaptureDevice_setStillImageSceneMonitoringFlashMode_hdrMode_qualityPrioritization_digitalFlashMode___block_invoke(uint64_t a1)
{
  if (*(*(a1 + 32) + 2176))
  {
    v1 = 1;
  }

  else
  {
    v1 = *(a1 + 48) != 0;
  }

  [MEMORY[0x1E696AD98] numberWithBool:v1];
  v2 = OUTLINED_FUNCTION_4();
  v4 = [(BWFigVideoCaptureDevice *)v2 _setAutofocusProcessorPropertyInternal:v3 propertyValue:?];
  return OUTLINED_FUNCTION_93_3(v4);
}

- (int)digitalFlashStatus
{
  if (LOBYTE(self->_globalToneMappingEnabledOverride) != 1)
  {
    return 0;
  }

  if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
  {
    captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
  }

  else
  {
    captureStream = self->_captureStream;
  }

  [(BWFigVideoCaptureStream *)captureStream portType];
  result = [OUTLINED_FUNCTION_8() containsObject:?];
  if (result)
  {
    v5 = [BWFrameStatisticsByPortType alloc];
    [*&self->_numAPSStatisticsSamples portTypes];
    v6 = [OUTLINED_FUNCTION_8() initWithPortTypes:?];
    os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
    [*&self->_numAPSStatisticsSamples copyTo:v6];
    os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
    v7 = OUTLINED_FUNCTION_3_19();
    [BWFigVideoCaptureDevice _ubStillImageSceneFlagsForCaptureStream:v7 frameStatisticsByPortType:? fusionEnabled:? metadata:? sceneMonitoring:? zoomFactorOverride:?];
    if ((v8 & 0x800) != 0)
    {
      return 2;
    }

    else
    {
      return (v8 >> 10) & 1;
    }
  }

  return result;
}

- (id)digitalFlashExposureTimes
{
  if (LOBYTE(self->_globalToneMappingEnabledOverride) != 1)
  {
    return MEMORY[0x1E695E0F8];
  }

  v37 = v2;
  v38 = v3;
  if ([(BWFigVideoCaptureDevice *)self isBravoVariant])
  {
    captureStream = [(BWFigVideoCaptureDevice *)self masterCaptureStream];
  }

  else
  {
    captureStream = self->_captureStream;
  }

  [(BWFigVideoCaptureStream *)captureStream portType];
  if (![OUTLINED_FUNCTION_8() containsObject:?])
  {
    return MEMORY[0x1E695E0F8];
  }

  v6 = [BWFrameStatisticsByPortType alloc];
  [*&self->_numAPSStatisticsSamples portTypes];
  v7 = [OUTLINED_FUNCTION_8() initWithPortTypes:?];
  os_unfair_lock_lock(&self->_apsStatistics.minDataFromGyro);
  [*&self->_numAPSStatisticsSamples copyTo:v7];
  [(BWFigVideoCaptureStream *)captureStream portType];
  v8 = [OUTLINED_FUNCTION_8() objectForKeyedSubscript:?];
  if (!v8)
  {
    WeakRetained = objc_loadWeakRetained(&self->_streamingDigitalFlashMode);
    os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
    [(BWFigVideoCaptureStream *)captureStream portType];
    v9 = [OUTLINED_FUNCTION_37_0() adaptiveBracketingDigitalFlashTotalIntegrationTimesProviderForPortType:? wait:?];

    if (v9)
    {
      goto LABEL_9;
    }

    OUTLINED_FUNCTION_0();
    FigDebugAssert3();
    FigCaptureGetFrameworkRadarComponent();
    v36 = 0;
    v35 = 0;
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v19 = os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
    if (OUTLINED_FUNCTION_6(v19))
    {
      v33 = 136315138;
      OUTLINED_FUNCTION_7_72();
      OUTLINED_FUNCTION_8_0();
      _os_log_send_and_compose_impl();
    }

    OUTLINED_FUNCTION_5_3();
    OUTLINED_FUNCTION_17_8();
    LOWORD(v34[0]) = 0;
    OUTLINED_FUNCTION_16_14();
    OUTLINED_FUNCTION_5_61();
    _os_log_send_and_compose_impl();
    OUTLINED_FUNCTION_13_18();
    v20 = OUTLINED_FUNCTION_6_1();
    FigCapturePleaseFileRadar(v20, v21, v22, v23, v24, 14820, v25, v26, v27);
    free(v34);
    return MEMORY[0x1E695E0F8];
  }

  v9 = v8;
  os_unfair_lock_unlock(&self->_apsStatistics.minDataFromGyro);
LABEL_9:
  v30 = 0;
  v31 = 0.0;
  v32 = 0.0;
  [(BWFigVideoCaptureStream *)captureStream portType];
  [OUTLINED_FUNCTION_28() objectForKeyedSubscript:?];
  isStationary = [OUTLINED_FUNCTION_133() isStationary];
  v12 = 0;
  if ([*&self->_digitalFlashMetadataEnabled count])
  {
    objectDetector = [(BWFigVideoCaptureStream *)captureStream objectDetector];
    if (v3)
    {
      [v3 pts];
    }

    else
    {
      memset(v34, 0, 24);
    }

    [(BWObjectDetector *)objectDetector objectsForPTS:v34];
    [v3 finalCropRect];
    v17 = OUTLINED_FUNCTION_3_19();
    v12 = [BWFigVideoCaptureDevice _ubDetectedObjectsForDigitalFlashFromDetectedObjects:v17 finalCropRect:?];
  }

  for (i = 1; i != 3; ++i)
  {
    [v9 totalIntegrationTimeForDigitalFlashMode:i frameStatistics:v3 stationary:isStationary detectedObjects:v12];
    *(&v30 + i) = v14;
  }

  v28[0] = @"Min";
  v28[1] = @"Max";
  v29[0] = [MEMORY[0x1E696AD98] numberWithDouble:v31];
  v29[1] = [MEMORY[0x1E696AD98] numberWithDouble:v32];
  return [MEMORY[0x1E695DF20] dictionaryWithObjects:v29 forKeys:v28 count:2];
}

- (void)_ubDetectedObjectsForDigitalFlashFromDetectedObjects:(uint64_t)objects finalCropRect:
{
  if (!objects)
  {
    return 0;
  }

  OUTLINED_FUNCTION_9_7();
  OUTLINED_FUNCTION_7_3();
  if (![v3 count] || !objc_msgSend(*(v1 + 2368), "count"))
  {
    return 0;
  }

  [*(v1 + 2368) count];
  v4 = [OUTLINED_FUNCTION_17() dictionaryWithCapacity:?];
  OUTLINED_FUNCTION_7_42();
  v5 = *(v1 + 2368);
  if (OUTLINED_FUNCTION_0_0(v6, v7, v8, v9, v10, v11, v12, v13, v36, v38, v40, v42, v44, v46, v48, v50, v52, v54, v56, v58, v60, v62, v64, v66, v68))
  {
    OUTLINED_FUNCTION_61_6();
    v15 = *v14;
    do
    {
      v16 = 0;
      do
      {
        OUTLINED_FUNCTION_4_10();
        if (v17 != v15)
        {
          objc_enumerationMutation(v5);
        }

        [OUTLINED_FUNCTION_267() objectForKeyedSubscript:?];
        v18 = [OUTLINED_FUNCTION_17() setObject:? forKeyedSubscript:?];
        ++v16;
      }

      while (v2 != v16);
      v2 = OUTLINED_FUNCTION_0_0(v18, v19, v20, v21, v22, v23, v24, v25, v37, v39, v41, v43, v45, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67, v69);
    }

    while (v2);
  }

  if (![v4 count])
  {
    return 0;
  }

  v70.origin.x = OUTLINED_FUNCTION_3_1();
  if (!CGRectIsNull(v70))
  {
    OUTLINED_FUNCTION_16_5();
    v71.origin.x = OUTLINED_FUNCTION_3_1();
    if (!CGRectEqualToRect(v71, v72))
    {
      v4 = CFPropertyListCreateDeepCopy(*MEMORY[0x1E695E480], v4, 1uLL);
      OUTLINED_FUNCTION_16_5();
      v26 = OUTLINED_FUNCTION_3_1();
      BWCorrectRectanglesInDetectedObjectsInfo(v27, v26, v28, v29, v30, v31, v32, v33, v34);
    }
  }

  if (![v4 count])
  {
    return 0;
  }

  return v4;
}

- (void)_updateSmartFramingFieldOfViewWithAspectRatio:(uint64_t)ratio zoomFactor:(float)factor
{
  if (ratio)
  {
    OUTLINED_FUNCTION_80();
    [*(v5 + 600) portType];
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"floatValue"")];
    IsSensorMountedInPortraitOrientation = FigCaptureSourceIsSensorMountedInPortraitOrientation(v6);
    FieldOfView = BWSmartFramingSceneMonitorGetFieldOfView(v2, IsSensorMountedInPortraitOrientation, *(v3 + 1704), factor);
    if (FieldOfView)
    {
      v9 = FieldOfView;
      os_unfair_lock_lock((v3 + 1692));
      v10 = *(v3 + 1696);
      if (v9 != v10)
      {
        *(v3 + 1696) = v9;
      }

      os_unfair_lock_unlock((v3 + 1692));
      v11 = v9 == v10 || dword_1ED844350 == 0;
      if (!v11)
      {
        OUTLINED_FUNCTION_112();
        OUTLINED_FUNCTION_201();
        v12 = OUTLINED_FUNCTION_77();
        os_log_type_enabled(v12, v15);
        OUTLINED_FUNCTION_39_7();
        if (v11)
        {
          v14 = v13;
        }

        else
        {
          v14 = v16;
        }

        if (v14)
        {
          BWSmartFramingSceneMonitorFieldOfViewKeyFromType(v9);
          OUTLINED_FUNCTION_78();
          OUTLINED_FUNCTION_5();
          OUTLINED_FUNCTION_8_0();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        OUTLINED_FUNCTION_17_8();
      }
    }
  }
}

- (uint64_t)_isBaseZoomFactorOrNondisruptiveSwitchingFormatBaseZoomFactor:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_1_13();
    v4 = *(v3 + 656);
    result = OUTLINED_FUNCTION_2_0(v3, v5, v6, v7, v8, v9, v10, v11, v27, v29, v31, v33, v35, v37, v39, v41, v43, v45, v47, v49, v51, v53, v55, v57, v59);
    if (result)
    {
      v12 = result;
      v13 = *v62;
      while (2)
      {
        for (i = 0; i != v12; ++i)
        {
          OUTLINED_FUNCTION_4_10();
          if (v15 != v13)
          {
            objc_enumerationMutation(v4);
          }

          v16 = *(v61 + 8 * i);
          [v16 baseZoomFactorAfterGDC];
          if (v17 != a2)
          {
            [v16 nondisruptiveSwitchingZoomFactors];
            *&v18 = a2;
            [MEMORY[0x1E696AD98] numberWithFloat:v18];
            v19 = [OUTLINED_FUNCTION_8() containsObject:?];
            if ((v19 & 1) == 0)
            {
              continue;
            }
          }

          return 1;
        }

        v12 = OUTLINED_FUNCTION_2_0(v19, v20, v21, v22, v23, v24, v25, v26, v28, v30, v32, v34, v36, v38, v40, v42, v44, v46, v48, v50, v52, v54, v56, v58, v60);
        result = 0;
        if (v12)
        {
          continue;
        }

        break;
      }
    }
  }

  return result;
}

- (void)rampToVideoZoomFactor:(float)factor withTuning:(int)tuning commandID:(int)d
{
  v5 = *&d;
  [(NSMutableDictionary *)self->_whiteBalanceGains applyFudgeToZoomFactor:?];
  v10 = v9;
  [(NSMutableDictionary *)self->_whiteBalanceGains appliedZoomFactorWithoutFudge];
  v12 = v11;
  v13 = OUTLINED_FUNCTION_114_4();
  v15 = [(BWFigVideoCaptureDevice *)v14 _isBaseZoomFactorOrNondisruptiveSwitchingFormatBaseZoomFactor:v13];
  v67 = 0;
  v68 = &v67;
  v69 = 0x2020000000;
  v70 = 0;
  OUTLINED_FUNCTION_0_7();
  OUTLINED_FUNCTION_328();
  v66[2] = __70__BWFigVideoCaptureDevice_rampToVideoZoomFactor_withTuning_commandID___block_invoke;
  v66[3] = &unk_1E798FAF8;
  v66[4] = self;
  v66[5] = v16;
  dispatch_sync(v17, v66);
  v24 = *(v68 + 6);
  v25 = BYTE1(self->_dynamicAspectRatio3x4CumulativeTime);
  if (tuning == 3)
  {
    tension = 1.0;
    if ((self->_activeSensorRegionForCameraControls.width & 1) == 0 && v12 > factor && BYTE1(self->_dynamicAspectRatio3x4CumulativeTime))
    {
      tension = self->_zoomRampTuning.jumpFrontFacingZoomOut[1].tension;
    }

    if (v24 != 2)
    {
      if (((v25 & 1) != 0 || LOBYTE(self->_activeSensorRegionForCameraControls.width)) && v12 > factor)
      {
        *&v18 = self->_zoomRampTuning.continuousDirectOverCaptureRecordingZoomOutSpring.snapFraction;
      }

      if (v15)
      {
        isBravoVariant = [(BWFigVideoCaptureDevice *)self isBravoVariant];
        if (v12 < factor && isBravoVariant)
        {
          OUTLINED_FUNCTION_107_4();
        }
      }
    }

    v37 = LOBYTE(self->_ispZoomLatency) == 1 && tension == 1.0;
    if (!v37 || ![(NSArray *)[(BWFigVideoCaptureStream *)self->_captureStream nondisruptiveSwitchingZoomFactors] count])
    {
      if (BYTE2(self->_newTotalZoomFactor) == 1 && (([(NSMutableDictionary *)self->_whiteBalanceGains appliedZoomFactor], v38 == self->_rampDefaultBravoSnapDistanceFraction) ? (v39 = v12 <= factor) : (v39 = 1), !v39 ? (v40 = v25 == 0) : (v40 = 1), !v40 && (OUTLINED_FUNCTION_107_4(), v37)))
      {
        if (LOBYTE(self->_newTotalZoomFactor))
        {
          goto LABEL_131;
        }

        LOBYTE(self->_newTotalZoomFactor) = 1;
        v41 = 2996;
      }

      else
      {
        if (LOBYTE(self->_newTotalZoomFactor) != 1)
        {
          goto LABEL_131;
        }

        LOBYTE(self->_newTotalZoomFactor) = 0;
        v41 = 2992;
      }

      [(NSMutableDictionary *)self->_whiteBalanceGains updateISPZoomDelay:*(&self->super.isa + v41)];
      goto LABEL_131;
    }

    goto LABEL_130;
  }

  if (tuning == 2)
  {
    if (!BYTE1(self->_dynamicAspectRatio3x4CumulativeTime))
    {
      goto LABEL_131;
    }

    v27 = 1.0;
    if ((self->_activeSensorRegionForCameraControls.width & 1) == 0 && v12 > factor)
    {
      v27 = self->_zoomRampTuning.jumpFrontFacingZoomOut[1].tension;
    }

    v28 = LOBYTE(self->_zoomRampTuning.continuousDirectPreview.exponentialSnapFraction) == 1 && v12 <= factor;
    if (v28 && (self->_activeSensorRegionForCameraControls.width & 1) == 0)
    {
      [(NSMutableDictionary *)self->_whiteBalanceGains appliedZoomFactor];
      [BWFigVideoCaptureDevice _baseZoomFactorForZoomFactor:?];
      OUTLINED_FUNCTION_114_4();
      [BWFigVideoCaptureDevice _baseZoomFactorForZoomFactor:v29];
    }

    if (v24 == 2 && BYTE1(self->_zoomRampTuning.continuousDirectPreview.exponentialSnapFraction) == 1)
    {
      *&v30 = OUTLINED_FUNCTION_253();
      [v31 rampToVideoZoomFactor:v30 usingSpringWithTension:? friction:? snapFraction:? rampTuning:? earlySwitchOverScaleFactorForZoomIn:? allowableMinimumDigitalZoomFactorDuringZoomOut:? rampStartFrameDelayAt30fps:? commandID:?];
      goto LABEL_132;
    }

    v63 = LOBYTE(self->_ispZoomLatency) == 1 && v27 == 1.0;
    if (!v63 || ![(NSArray *)[(BWFigVideoCaptureStream *)self->_captureStream nondisruptiveSwitchingZoomFactors] count])
    {
      goto LABEL_131;
    }

LABEL_130:
    [BWFigVideoCaptureDevice _updateISPZoomDelayForNondisruptiveSwitchingWithZoomingOut:?];
    goto LABEL_131;
  }

  if (tuning != 1)
  {
    goto LABEL_132;
  }

  if ((v25 & 1) == 0)
  {
    width_low = LOBYTE(self->_activeSensorRegionForCameraControls.width);
    if (width_low)
    {
      goto LABEL_70;
    }

    if (v15)
    {
      [(BWFigVideoCaptureDevice *)self isBravoVariant];
    }

    if (self->_position != 2)
    {
      v34 = v12 / factor;
      if (v12 < factor)
      {
        v34 = factor / v12;
      }

      log2f(v34);
    }

LABEL_131:
    *&v64 = OUTLINED_FUNCTION_253();
    [v65 rampToVideoZoomFactor:v64 withRampType:? rate:? duration:? snapToTargetZoomFactorWithinRampFraction:? rampTuning:? earlySwitchOverScaleFactorForZoomIn:? allowableMinimumDigitalZoomFactorDuringZoomOut:? commandID:?];
    goto LABEL_132;
  }

  if (v24 == 2)
  {
    v26 = 2;
    goto LABEL_71;
  }

  width_low = LOBYTE(self->_activeSensorRegionForCameraControls.width);
LABEL_70:
  v26 = width_low ^ 1;
LABEL_71:
  v42 = 3136;
  if (v12 > factor)
  {
    v42 = 3172;
  }

  if (self->_position == 2)
  {
    if (v12 <= factor)
    {
      v54 = (self + 12 * v26);
      v48 = v54[802];
      v49 = *(v54 + 803);
      v50 = *(v54 + 804);
      v47 = 1;
      goto LABEL_86;
    }

    v43 = self + 12 * v26;
    v44 = (v43 + 3244);
    v45 = (v43 + 3248);
    v46 = (v43 + 3252);
  }

  else
  {
    v44 = (self + 12 * v26 + v42);
    v45 = (v44 + 1);
    v46 = (v44 + 2);
  }

  v47 = v12 <= factor;
  v48 = *v44;
  v49 = *v45;
  v50 = *v46;
  if (*v44 == 0.0 && v12 > factor)
  {
    v52 = OUTLINED_FUNCTION_114_4();
    if ([(BWFigVideoCaptureDevice *)v53 _isBaseZoomFactorOrNondisruptiveSwitchingFormatBaseZoomFactor:v52])
    {
      v48 = 0.001;
    }
  }

LABEL_86:
  v55 = v25 ^ 1;
  snapFraction = 1.0;
  if (((v25 ^ 1) & 1) == 0 && v12 <= factor && (self->_activeSensorRegionForCameraControls.width & 1) == 0)
  {
    snapFraction = self->_zoomRampTuning.jumpFrontFacingZoomOut[1].snapFraction;
  }

  if (((v47 | v55) & 1) == 0 && ((OUTLINED_FUNCTION_107_4(), v37) ? (v57 = v24 == 2) : (v57 = 1), v57))
  {
    [(NSMutableDictionary *)self->_whiteBalanceGains appliedZoomFactor];
    if (*&v18 == *&self->_zoomFactorLock._os_unfair_lock_opaque)
    {
      LODWORD(v58) = 3;
    }

    else
    {
      LODWORD(v58) = 1;
    }
  }

  else
  {
    LODWORD(v58) = 1;
  }

  if (BYTE2(self->_newTotalZoomFactor) == 1 && (([(NSMutableDictionary *)self->_whiteBalanceGains appliedZoomFactor], *&v18 == self->_rampDefaultBravoSnapDistanceFraction) ? (v59 = v12 <= factor) : (v59 = 1), !v59 && v25 && (OUTLINED_FUNCTION_107_4(), v37)))
  {
    if ((LOBYTE(self->_newTotalZoomFactor) & 1) == 0)
    {
      LOBYTE(self->_newTotalZoomFactor) = 1;
      v60 = 2996;
LABEL_112:
      [(NSMutableDictionary *)self->_whiteBalanceGains updateISPZoomDelay:*(&self->super.isa + v60)];
    }
  }

  else if (LOBYTE(self->_newTotalZoomFactor) == 1)
  {
    LOBYTE(self->_newTotalZoomFactor) = 0;
    v60 = 2992;
    goto LABEL_112;
  }

  if (self->_position == 2)
  {
    v58 = 0;
  }

  else
  {
    v58 = v58;
  }

  v61 = 1.0;
  if (((LOBYTE(self->_activeSensorRegionForCameraControls.width) | v55 | v47) & 1) == 0)
  {
    [(NSMutableDictionary *)self->_whiteBalanceGains appliedZoomFactor];
    LODWORD(v19) = self->_zoomFactorLock._os_unfair_lock_opaque;
    if (*&v18 >= *&v19 && v10 < *&v19)
    {
      v61 = self->_zoomRampTuning.jumpFrontFacingZoomOut[1].tension;
    }
  }

  *&v18 = factor;
  LODWORD(v19) = v49;
  LODWORD(v20) = v50;
  *&v21 = v48;
  *&v22 = snapFraction;
  *&v23 = v61;
  [(NSMutableDictionary *)self->_whiteBalanceGains rampToVideoZoomFactor:1 usingSpringWithTension:v58 friction:v5 snapFraction:v18 rampTuning:v19 earlySwitchOverScaleFactorForZoomIn:v20 allowableMinimumDigitalZoomFactorDuringZoomOut:v21 rampStartFrameDelayAt30fps:v22 commandID:v23];
LABEL_132:
  *&v18 = v10;
  [*&self->_minimumTimeBetweenStationaryChecks requestedZoomFactorChanged:v18];
  _Block_object_dispose(&v67, 8);
}

- (float)_baseZoomFactorForZoomFactor:(uint64_t)factor
{
  if (!factor)
  {
    return 0.0;
  }

  OUTLINED_FUNCTION_124_5();
  v4 = [objc_msgSend(*(v3 + 664) "firstObject")];
  v6 = v5;
  v7 = *(v1 + 664);
  v15 = OUTLINED_FUNCTION_131_5(v4, v8, v9, v10, v11, v12, v13, v14, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67, v69, v71, v73, v75, v77, v79, v81, v83, v85, v87, v89, v91, v93, v95);
  if (v15)
  {
    v16 = v15;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        OUTLINED_FUNCTION_89();
        if (!v18)
        {
          objc_enumerationMutation(v7);
        }

        v19 = *(8 * i);
        [v19 baseZoomFactorAfterGDC];
        if (v20 <= v2)
        {
          [v19 baseZoomFactorAfterGDC];
          v6 = v21;
        }

        nondisruptiveSwitchingZoomFactors = [v19 nondisruptiveSwitchingZoomFactors];
        OUTLINED_FUNCTION_43();
        v24 = [v23 countByEnumeratingWithState:? objects:? count:?];
        if (v24)
        {
          OUTLINED_FUNCTION_61_6();
          v33 = *v32;
          while (1)
          {
            OUTLINED_FUNCTION_4_10();
            if (v34 != v33)
            {
              objc_enumerationMutation(nondisruptiveSwitchingZoomFactors);
            }

            v35 = *v82;
            [*v82 floatValue];
            if (v36 <= v2)
            {
              [v35 floatValue];
              v6 = v37;
            }

            OUTLINED_FUNCTION_78_0();
            if (v18)
            {
              v24 = OUTLINED_FUNCTION_0_0(v38, v39, v40, v41, v42, v43, v44, v45, v48, v50, v52, v54, v56, v58, v60, v62, v64, v66, v68, v70, v72, v74, v76, v78, v80);
              if (!v24)
              {
                break;
              }
            }
          }
        }
      }

      v16 = OUTLINED_FUNCTION_131_5(v24, v25, v26, v27, v28, v29, v30, v31, v48, v50, v52, v54, v56, v58, v60, v62, v64, v66, v68, v70, v72, v74, v76, v78, v80, v82, v84, v86, v88, v90, v92, v94, v96);
    }

    while (v16);
  }

  return v6;
}

- (uint64_t)_updateISPZoomDelayForNondisruptiveSwitchingWithZoomingOut:(uint64_t)result
{
  if (!result)
  {
    return result;
  }

  OUTLINED_FUNCTION_54();
  result = [objc_msgSend(objc_msgSend(*(v3 + 600) "nondisruptiveSwitchingZoomFactors")];
  if (v2)
  {
    v5 = v4;
    v6 = v4 * *(v1 + 3020);
    v7 = *(v1 + 3024);
    result = [*(v1 + 2952) appliedZoomFactor];
    if (v8 >= v6)
    {
      v11 = v5 * v7;
      result = [*(v1 + 2952) appliedZoomFactor];
      v9 = (v1 + 3004);
      if (v12 <= v11)
      {
        if ((*(v1 + 3004) & 1) == 0)
        {
          *v9 = 1;
        }

        LODWORD(v10) = *(v1 + 2992);
        v19 = (*(v1 + 2996) - v10);
        [*(v1 + 2952) appliedZoomFactor];
        v18 = (1.0 - ((v20 - v6) / (v11 - v6))) * v19;
        goto LABEL_23;
      }

      if ((*(v1 + 3004) & 1) == 0)
      {
        return result;
      }
    }

    else
    {
      if ((*(v1 + 3004) & 1) == 0)
      {
        return result;
      }

      v9 = (v1 + 3004);
    }

    v10 = *(v1 + 2992);
    if (*(v1 + 3000) > v10)
    {
      [*(v1 + 600) baseZoomFactorAfterGDC];
      v14 = v13;
      [*(v1 + 2952) appliedZoomFactor];
      v15 = v6 < *&v16;
      *&v16 = v6;
      if (!v15)
      {
        [*(v1 + 2952) appliedZoomFactor];
      }

      v17 = v14 <= *&v16;
      *&v16 = v14;
      if (v17)
      {
        [*(v1 + 2952) appliedZoomFactor];
        v15 = v6 < *&v16;
        *&v16 = v6;
        if (!v15)
        {
          [*(v1 + 2952) appliedZoomFactor];
        }
      }

      v18 = ((*&v16 - v14) / (v6 - v14)) * (*(v1 + 3000) - *(v1 + 2992));
LABEL_23:
      v10 = (ceilf(v18) + v10);
      goto LABEL_24;
    }
  }

  else
  {
    if (*(v1 + 3004) != 1)
    {
      return result;
    }

    v9 = (v1 + 3004);
    v10 = *(v1 + 2992);
  }

  *v9 = 0;
LABEL_24:
  *(v1 + 3000) = v10;
  v21 = *(v1 + 2952);

  return [v21 updateISPZoomDelay:v10];
}

- (float)requestedZoomFactorRelativeToPortType:(id)type
{
  [(BWFigVideoCaptureDevice *)self _configureZoomFudgingWithAspectRatio:?];
  [-[NSDictionary objectForKeyedSubscript:](-[BWFigVideoCaptureDevice baseZoomFactorsByPortType](self "baseZoomFactorsByPortType")];
  if (v5 == 0.0)
  {
    v6 = 1.0;
  }

  else
  {
    v6 = v5;
  }

  [(BWZoomCommandHandler *)[(BWFigVideoCaptureDevice *)self zoomCommandHandler] requestedZoomFactor];
  return v7 / v6;
}

- (void)setNondisruptiveSwitchingFormatIndicesByZoomFactorSIFRBinned:(id)binned nondisruptiveSwitchingFormatIndicesByZoomFactorSIFRNonBinned:(id)nonBinned ultraHighResolutionNondisruptiveStreamingFormatIndex:(int)index mainFormatSIFRBinningFactor:(int)factor forPortType:(id)type quadraSubPixelSwitchingParameters:(id)parameters
{
  *&self->_manualCinematicFramingEnabled = factor;
  if (factor != 2)
  {
    binned = nonBinned;
  }

  if (!self->_bravoTelephotoCaptureStream || (BYTE1(self->_variableFrameRateLastRequestedAEMaxGainByPortType) & 1) == 0)
  {
    v11 = [BWFigVideoCaptureDevice _captureStreamByPortType:?];
    v12 = [binned count];
    v13 = [binned count];
    v14 = 0x1E696A000uLL;
    if (v13 == 1)
    {
      v15 = MEMORY[0x1E696AD98];
      [v11 baseZoomFactor];
      [v15 numberWithFloat:?];
      v16 = [OUTLINED_FUNCTION_24_1() objectForKeyedSubscript:?];
      v14 = 0x1E696A000;
      if (v16)
      {
        intValue = [v16 intValue];
        goto LABEL_23;
      }
    }

    if (!v12)
    {
      intValue = 0xFFFFFFFFLL;
LABEL_23:
      if (BYTE4(self->_portraitEffectPropertiesDelegate) == 1 && (v25 = MEMORY[0x1E696AD98], [v11 baseZoomFactor], objc_msgSend(v25, "numberWithFloat:"), objc_msgSend(OUTLINED_FUNCTION_36(), "objectForKeyedSubscript:")))
      {
        v26 = OUTLINED_FUNCTION_260();
      }

      else
      {
        OUTLINED_FUNCTION_10();
      }

      [v26 setZoomFactorToNondisruptiveSwitchingFormatIndexSIFRBinned:? zoomFactorToNondisruptiveSwitchingFormatIndexSIFRNonBinned:? ultraHighResolutionNondisruptiveStreamingFormatIndex:? mainFormatSIFRBinningFactor:? quadraSubPixelSwitchingParameters:?];
      [v11 setActiveNondisruptiveSwitchingFormatIndex:intValue];
      return;
    }

    if (BYTE1(self->_newTotalZoomFactor) != 1 || (BYTE2(self->_newTotalZoomFactor) & 1) == 0 && (v18 = [type isEqualToString:*off_1E798A0D0], v14 = 0x1E696A000uLL, v18))
    {
      v19 = *(v14 + 3480);
      [v11 baseZoomFactor];
      [v19 numberWithFloat:?];
      v20 = [OUTLINED_FUNCTION_24_1() objectForKeyedSubscript:?];
      if (v20)
      {
        intValue = [v20 intValue];
      }

      else
      {
        intValue = 0xFFFFFFFFLL;
      }

      OUTLINED_FUNCTION_278();
      [v19 numberWithFloat:?];
      if ([OUTLINED_FUNCTION_36() objectForKeyedSubscript:?])
      {
        OUTLINED_FUNCTION_278();
        v31 = [v19 numberWithFloat:?];
        OUTLINED_FUNCTION_278();
        [v19 numberWithFloat:?];
        v32 = [OUTLINED_FUNCTION_36() objectForKeyedSubscript:?];
        [MEMORY[0x1E695DF20] dictionaryWithObjects:&v32 forKeys:&v31 count:1];
      }

      OUTLINED_FUNCTION_278();
      [v19 numberWithFloat:?];
      if ([OUTLINED_FUNCTION_37_0() objectForKeyedSubscript:?])
      {
        OUTLINED_FUNCTION_278();
        [v19 numberWithFloat:?];
        OUTLINED_FUNCTION_278();
        [v19 numberWithFloat:?];
        [OUTLINED_FUNCTION_37_0() objectForKeyedSubscript:?];
        OUTLINED_FUNCTION_41(MEMORY[0x1E695DF20], v22, v23, v24);
      }

      goto LABEL_23;
    }

    [OUTLINED_FUNCTION_260() setZoomFactorToNondisruptiveSwitchingFormatIndexSIFRBinned:? zoomFactorToNondisruptiveSwitchingFormatIndexSIFRNonBinned:? ultraHighResolutionNondisruptiveStreamingFormatIndex:? mainFormatSIFRBinningFactor:? quadraSubPixelSwitchingParameters:?];
    if ([type isEqual:*off_1E798A0C0])
    {
      [objc_msgSend(objc_msgSend(v11 "nondisruptiveSwitchingZoomFactors")];
      self->_zoomFactorLock._os_unfair_lock_opaque = v21;
    }

    else if ([type isEqual:*off_1E798A0D0])
    {
      [objc_msgSend(objc_msgSend(v11 "nondisruptiveSwitchingZoomFactors")];
      self->_rampDefaultBravoSnapDistanceFraction = v27;
      width = self->_activeSensorRegionForCameraControls.width;
      if (v27 <= 0.0)
      {
        width = 0;
      }

      *(&self->_applyPreviewShiftToFocusAndExposureRect + 1) = width;
    }

    v29 = OUTLINED_FUNCTION_44();

    [(BWFigVideoCaptureDevice *)v29 _serviceNondisruptiveSwitchingFormatForCaptureStream:v30 frameStatistics:0 streamingImageIntent:0 isStationary:0];
  }
}

- (void)updateFudgedZoomRanges
{
  aspectRatio = [(BWFigVideoCaptureDevice *)self aspectRatio];

  [(BWFigVideoCaptureDevice *)self _configureZoomFudgingWithAspectRatio:aspectRatio];
}

- (id)preferredMasterPortTypeForZoomFactor:(float)factor
{
  OUTLINED_FUNCTION_124_5();
  _copyCurrentFrameStatistics = [(BWFigVideoCaptureDevice *)v5 _copyCurrentFrameStatistics];
  v7 = *(v3 + 1416);
  LODWORD(v8) = v4;

  return [v7 preferredMasterPortTypeForFrameStatisticsByPortType:_copyCurrentFrameStatistics zoomFactor:v8];
}

uint64_t __132__BWFigVideoCaptureDevice_zoomCommandHandler_didApplyZoomFactor_zoomFactorWithoutFudge_targetZoomFactor_rampComplete_rampCommandID___block_invoke(uint64_t a1)
{
  v2 = OUTLINED_FUNCTION_86_3(a1);
  [BWFigVideoCaptureDevice _updateAutoFocusRectIfNeededForZoomFactor:v2];
  v3 = *(v1 + 32);
  v4 = *(v1 + 40);

  return [(BWFigVideoCaptureDevice *)v3 _updateExposureRectIfNeededForZoomFactor:v4];
}

- (uint64_t)_updateDynamicAspectRatioCumulativeTimeForStopTime:(uint64_t)result
{
  if (result)
  {
    v2 = result;
    if (*(result + 4688) == 1)
    {
      [*(result + 600) portType];
      [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"floatValue"")];
      result = FigCaptureSourceIsSensorMountedInPortraitOrientation(v4);
      v5 = *(v2 + 4680);
      *(v2 + 4680) = a2;
      v6 = a2 - v5;
      v7 = 4640;
      switch(*(v2 + 2000))
      {
        case 1:
          v8 = result == 0;
          v7 = 4664;
          v9 = 4672;
          goto LABEL_8;
        case 2:
          v8 = result == 0;
          v7 = 4672;
          v9 = 4664;
          goto LABEL_8;
        case 3:
          v8 = result == 0;
          v7 = 4648;
          v9 = 4656;
          goto LABEL_8;
        case 4:
          v8 = result == 0;
          v7 = 4656;
          v9 = 4648;
LABEL_8:
          if (!v8)
          {
            v7 = v9;
          }

          goto LABEL_10;
        case 5:
        case 6:
LABEL_10:
          *(v2 + v7) += v6;
          break;
        default:
          return result;
      }
    }
  }

  return result;
}

- (uint64_t)_ltmCurveForStreamingImageIntent:(uint64_t)result
{
  if (result)
  {
    OUTLINED_FUNCTION_80();
    if ([objc_msgSend(objc_msgSend(*(v3 + 600) "stream")] - 5 < 2)
    {
      return 0;
    }

    else if ((v1 - 5) >= 4)
    {
      if (v1 == 4)
      {
        v6 = 2;
      }

      else
      {
        v6 = 0;
      }

      if ((v1 - 1) >= 2)
      {
        return v6;
      }

      else
      {
        return 1;
      }
    }

    else
    {
      os_unfair_lock_lock((v2 + 2140));
      os_unfair_lock_assert_owner((v2 + 2140));
      v4 = *(v2 + 2336);
      if (v4)
      {
        bOOLValue = [v4 BOOLValue];
      }

      else
      {
        bOOLValue = *(v2 + 2332);
      }

      os_unfair_lock_unlock((v2 + 2140));
      if (v1 == 8)
      {
        v7 = 3;
      }

      else
      {
        v7 = 0;
      }

      if (bOOLValue)
      {
        return 2;
      }

      else
      {
        return v7;
      }
    }
  }

  return result;
}

- (float)_minimumFrameRateForStreamingImageIntent:(void *)intent masterPortType:
{
  result = 0.0;
  if (self)
  {
    switch(a2)
    {
      case 0:
      case 4:
      case 6:
      case 8:
        result = *(self + 2284);
        break;
      case 1:
      case 2:
        if (*(self + 2312) != 1)
        {
          goto LABEL_7;
        }

        if (![intent isEqualToString:{*off_1E798A0D8, 0.0}])
        {
          goto LABEL_7;
        }

        v6 = [*(self + 2376) containsObject:intent];
        result = 6.0;
        if ((v6 & 1) == 0)
        {
          goto LABEL_7;
        }

        break;
      case 3:
        result = 24.0;
        break;
      case 5:
LABEL_7:
        result = 8.0;
        break;
      case 7:
        [*(self + 600) minimumSupportedFrameRate];
        v8 = v7;
        result = 2.0;
        if (v8 >= 2.0)
        {
          v9 = *(self + 600);

          [v9 minimumSupportedFrameRate];
        }

        break;
      default:
        return result;
    }
  }

  return result;
}

- (void)_updateStreamingImageIntentForChangedMasterStreamWithPortType:(uint64_t)type
{
  if (type)
  {
    if (*(type + 2312) == 1)
    {
      v6[6] = v1;
      v6[7] = v2;
      OUTLINED_FUNCTION_0_7();
      OUTLINED_FUNCTION_328();
      v6[2] = __89__BWFigVideoCaptureDevice__updateStreamingImageIntentForChangedMasterStreamWithPortType___block_invoke;
      v6[3] = &unk_1E798F898;
      v6[4] = v3;
      v6[5] = v4;
      dispatch_async(v5, v6);
    }
  }
}

uint64_t __89__BWFigVideoCaptureDevice__updateStreamingImageIntentForChangedMasterStreamWithPortType___block_invoke(uint64_t a1)
{
  v2 = OUTLINED_FUNCTION_86_3(a1);
  result = [(BWFigVideoCaptureDevice *)v2 _currentStreamingImageIntent];
  if ((result - 1) <= 1)
  {
    v4 = *(v1 + 32);
    [(BWFigVideoCaptureDevice *)v4 _minimumFrameRateForStreamingImageIntent:*(v1 + 40) masterPortType:?];
    FigCaptureFrameRateFromFloat();

    return [(BWFigVideoCaptureDevice *)v4 _setMinimumFrameRate:v5, v6];
  }

  return result;
}

- (void)_updateCurrentStillSmartCameraState
{
  if (self && *(self + 3376) == 1)
  {

    os_unfair_lock_lock((self + 2140));
    *(self + 3424) = *(self + 3416);

    os_unfair_lock_unlock((self + 2140));
  }
}

- (void)_ubResolveStillImageCaptureTypeWithSettings:(uint64_t)settings sceneFlags:(uint64_t)flags hdrMode:(uint64_t)mode qualityPrioritization:(uint64_t)prioritization clientBracket:(uint64_t)bracket canDefer:(uint64_t)defer primaryPortType:(uint64_t)type speedOverQualityInOut:(uint64_t)self0 speedOverQualityDowngradeOut:(uint64_t)self1
{
  OUTLINED_FUNCTION_84();
  if (!v30)
  {
    goto LABEL_43;
  }

  v31 = v29;
  v32 = v28;
  v33 = v27;
  v34 = v26;
  v35 = v25;
  v36 = v24;
  OUTLINED_FUNCTION_166();
  if (a21)
  {
    v84 = *a21;
  }

  else
  {
    v84 = 0;
  }

  v37 = a22;
  v38 = OUTLINED_FUNCTION_70();
  if ((-[BWFigVideoCaptureDevice _ubIsDigitalFlashCaptureForSettings:sceneFlags:](v38, v39, v36) & 1) != 0 || [v23 flashMode] == 1 && -[BWFigVideoCaptureDevice _ubIsFlashAvailable](v22))
  {
    goto LABEL_6;
  }

  if (v35 == 1 || (v33 & 1) != 0)
  {
    LOBYTE(v34) = 0;
    if (v35 == 1)
    {
      LOBYTE(v42) = 0;
      goto LABEL_16;
    }

    goto LABEL_20;
  }

  if ([v23 flashMode] == 1)
  {
    v41 = 0;
    if (v36 & 0x4000) == 0 && (*(v22 + 2344))
    {
      os_unfair_lock_lock((v22 + 2140));
      v41 = *(v22 + 2400);
      os_unfair_lock_unlock((v22 + 2140));
    }
  }

  else
  {
    v41 = 0;
  }

  if ([v23 flashMode] != 2 || !-[BWFigVideoCaptureDevice _ubIsAutoFlashForSceneFlags:digitalFlashModeForSceneMonitoring:](v22, v36, v41))
  {
    if ((v36 & 0x40000000) != 0 && v34 >= 3)
    {
      autoDeferredProcessingEnabled = [v23 autoDeferredProcessingEnabled];
      v42 = 0;
      v44 = 13;
      if (autoDeferredProcessingEnabled && (v32 & 1) == 0)
      {
        if (*(v22 + 2176) != 1)
        {
          LOBYTE(v40) = dword_1ED844350;
          if (dword_1ED844350)
          {
            v48 = OUTLINED_FUNCTION_46_18();
            v49 = OUTLINED_FUNCTION_72_6(v48);
            if (OUTLINED_FUNCTION_5_2(v49))
            {
LABEL_46:
              OUTLINED_FUNCTION_7_72();
LABEL_47:
              OUTLINED_FUNCTION_7_4();
              _os_log_send_and_compose_impl();
            }

LABEL_123:
            OUTLINED_FUNCTION_10_52();
            OUTLINED_FUNCTION_54_12();
            OUTLINED_FUNCTION_207();
            goto LABEL_39;
          }

LABEL_122:
          LOBYTE(v34) = 0;
          goto LABEL_39;
        }

        LOBYTE(v40) = dword_1ED844350;
        if ((~*(v22 + 2260) & 0x11) == 0)
        {
          if (dword_1ED844350)
          {
            v45 = OUTLINED_FUNCTION_46_18();
            v46 = OUTLINED_FUNCTION_72_6(v45);
            if (OUTLINED_FUNCTION_5_2(v46))
            {
              goto LABEL_46;
            }

            goto LABEL_123;
          }

          goto LABEL_122;
        }

        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_62();
          OUTLINED_FUNCTION_116_5();
          v50 = OUTLINED_FUNCTION_39_10();
          v51 = OUTLINED_FUNCTION_108(v50);
          if (OUTLINED_FUNCTION_6(v51))
          {
            OUTLINED_FUNCTION_7_72();
            OUTLINED_FUNCTION_8_0();
            _os_log_send_and_compose_impl();
            OUTLINED_FUNCTION_297();
          }

          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_17_8();
        }

        LOBYTE(v42) = 0;
LABEL_16:
        LOBYTE(v40) = v84;
        if (v84)
        {
          LOBYTE(v40) = 0;
          LOBYTE(v34) = *(v22 + 2176) == 2 || !v42;
        }

        else
        {
          LOBYTE(v34) = 0;
        }

        goto LABEL_39;
      }

      goto LABEL_103;
    }

    if (v35 != 2 && v34 < 2)
    {
      goto LABEL_90;
    }

    OUTLINED_FUNCTION_70();
    [BWFigVideoCaptureDevice _ubDeliverDepthDataForSettings:speedOverQuality:sceneFlags:];
    v52 = OUTLINED_FUNCTION_70();
    v79 = v53;
    v55 = [(BWFigVideoCaptureDevice *)v52 _ubIsBravoMultiCameraCaptureForSettings:v54 sceneFlags:v36 deliverDepthData:v53];
    v76 = v55;
    v56 = 0;
    if (*(v22 + 2258) == 1)
    {
      v56 = [v23 constituentPhotoDeliveryEnabled] ^ 1;
    }

    if (*(v22 + 2257) == 1 && [objc_loadWeak((v22 + 2656)) deepFusionSupportedForPortType:v31])
    {
      v57 = v76 ^ 1;
      if (v79)
      {
        v57 = v56;
      }

      v75 = v57;
    }

    else
    {
      v75 = 0;
    }

    if ([v23 resolutionFlavor] != 1 && objc_msgSend(v23, "resolutionFlavor") != 2)
    {
      goto LABEL_83;
    }

    obj = [MEMORY[0x1E695DF70] array];
    if ([v23 resolutionFlavor] == 1)
    {
      v58 = &unk_1F2246A80;
    }

    else
    {
      if ([v23 resolutionFlavor] != 2 || (*(v22 + 2260) & 0xC) == 0)
      {
LABEL_73:
        OUTLINED_FUNCTION_85();
        v80 = [obj countByEnumeratingWithState:? objects:? count:?];
        if (v80)
        {
          v77 = MEMORY[0];
LABEL_75:
          v59 = 0;
          while (1)
          {
            if (MEMORY[0] != v77)
            {
              objc_enumerationMutation(obj);
            }

            v60 = *(8 * v59);
            v85[0] = 0;
            intValue = [v60 intValue];
            resolutionFlavor = [v23 resolutionFlavor];
            constituentPhotoDeliveryEnabled = [v23 constituentPhotoDeliveryEnabled];
            autoDeferredProcessingEnabled2 = [v23 autoDeferredProcessingEnabled];
            IsDemosaicedRaw = FigCapturePixelFormatIsDemosaicedRaw([v23 rawOutputFormat]);
            v63 = [(BWFigVideoCaptureDevice *)v22 _ubIsRequestedHighResolutionFlavorSupportedForCaptureType:intValue portType:v31 qualityPrioritization:v34 requestedHighResolutionFlavor:resolutionFlavor sceneFlags:v36 deliverDepthData:v79 bravoConstituentPhotoCapture:constituentPhotoDeliveryEnabled autoDeferredProcessingEnabled:autoDeferredProcessingEnabled2 canDefer:v32 demosaicedRawRequested:IsDemosaicedRaw isUltraHighResolutionDowngradeOut:v85];
            if (v85[0] == 1)
            {
              intValue2 = [v60 intValue];
LABEL_85:
              v42 = 0;
              goto LABEL_87;
            }

            if (v63)
            {
              break;
            }

            if (v80 == ++v59)
            {
              OUTLINED_FUNCTION_85();
              v80 = [obj countByEnumeratingWithState:? objects:? count:?];
              if (v80)
              {
                goto LABEL_75;
              }

              intValue2 = 0;
              goto LABEL_85;
            }
          }

          intValue2 = [v60 intValue];
          v42 = [v23 resolutionFlavor] == 2;
LABEL_87:
          v37 = a22;
          goto LABEL_88;
        }

LABEL_83:
        intValue2 = 0;
        v42 = 0;
LABEL_88:
        if ((v36 & 0x10) == 0 || (intValue2 != 0) | v76 & 1)
        {
          if (v75 && (intValue2 == 12 || (v36 & 0x1000) != 0 && v34 >= 3 && !intValue2))
          {
            autoDeferredProcessingEnabled3 = [v23 autoDeferredProcessingEnabled];
            v44 = 12;
            if (autoDeferredProcessingEnabled3 && (v32 & 1) == 0)
            {
              if (*(v22 + 2176) == 1)
              {
                LOBYTE(v40) = dword_1ED844350;
                if ((~*(v22 + 2260) & 0x11) != 0)
                {
                  if (dword_1ED844350)
                  {
                    OUTLINED_FUNCTION_62();
                    OUTLINED_FUNCTION_116_5();
                    v73 = OUTLINED_FUNCTION_39_10();
                    v74 = OUTLINED_FUNCTION_108(v73);
                    if (OUTLINED_FUNCTION_6(v74))
                    {
                      OUTLINED_FUNCTION_7_72();
                      OUTLINED_FUNCTION_8_0();
                      _os_log_send_and_compose_impl();
                      OUTLINED_FUNCTION_297();
                    }

                    OUTLINED_FUNCTION_2_4();
                    OUTLINED_FUNCTION_17_8();
                  }

                  goto LABEL_16;
                }

                if (!dword_1ED844350)
                {
                  goto LABEL_122;
                }

                v66 = OUTLINED_FUNCTION_46_18();
                v67 = OUTLINED_FUNCTION_72_6(v66);
                if (!OUTLINED_FUNCTION_5_2(v67))
                {
                  goto LABEL_123;
                }
              }

              else
              {
                LOBYTE(v40) = dword_1ED844350;
                if (!dword_1ED844350)
                {
                  goto LABEL_122;
                }

                v71 = OUTLINED_FUNCTION_46_18();
                v72 = OUTLINED_FUNCTION_72_6(v71);
                if (!OUTLINED_FUNCTION_5_2(v72))
                {
                  goto LABEL_123;
                }
              }

              OUTLINED_FUNCTION_7_72();
              goto LABEL_47;
            }

LABEL_103:
            if (*(v22 + 2260))
            {
              v68 = 1;
            }

            else
            {
              v68 = 10;
            }

            if ((v84 & !v42) == 1)
            {
              if (dword_1ED844350)
              {
                OUTLINED_FUNCTION_62();
                OUTLINED_FUNCTION_145_1();
                v69 = OUTLINED_FUNCTION_39_10();
                os_log_type_enabled(v69, v85[128]);
                OUTLINED_FUNCTION_4_0();
                if (v36)
                {
                  BWPhotoEncoderStringFromEncodingScheme(v68);
                  BWPhotoEncoderStringFromEncodingScheme(v44);
                  OUTLINED_FUNCTION_3_89();
                  OUTLINED_FUNCTION_7_4();
                  _os_log_send_and_compose_impl();
                }

                OUTLINED_FUNCTION_10_52();
                LOBYTE(v34) = 1;
                OUTLINED_FUNCTION_39_0();
              }

              else
              {
                LOBYTE(v34) = 1;
              }

              LOBYTE(v40) = 1;
              goto LABEL_39;
            }

            goto LABEL_90;
          }

          if (!intValue2)
          {
            LOBYTE(v34) = 0;
            v40 = *(v22 + 2260);
            if ((((v40 & 3) != 0) & ~*(v22 + 2264)) == 0)
            {
              v70 = v40 & 0x11;
              LOBYTE(v40) = 0;
              if (v70 == 17)
              {
                goto LABEL_39;
              }

              v40 = *(v22 + 2176);
              if (!v40)
              {
                LOBYTE(v34) = 0;
                goto LABEL_39;
              }

              goto LABEL_16;
            }

LABEL_20:
            LOBYTE(v40) = 0;
            goto LABEL_39;
          }
        }

LABEL_90:
        OUTLINED_FUNCTION_207();
        goto LABEL_39;
      }

      v58 = &unk_1F22469F0;
    }

    [obj addObject:v58];
    goto LABEL_73;
  }

LABEL_6:
  OUTLINED_FUNCTION_207();
LABEL_39:
  if (a21)
  {
    *a21 = v34;
  }

  if (v37)
  {
    *v37 = v40;
  }

LABEL_43:
  OUTLINED_FUNCTION_81();
}

- (void)_ubDeliverDepthDataForSettings:speedOverQuality:sceneFlags:
{
  OUTLINED_FUNCTION_58_2();
  if (!v4)
  {
    goto LABEL_19;
  }

  v5 = v3;
  OUTLINED_FUNCTION_54();
  v7 = BWCIFilterArrayContainsPortraitFilters([v6 processedImageFilters]);
  if (([v1 depthDataDeliveryEnabled] & 1) != 0 || v7)
  {
    if ((v5 & 0x800000) != 0)
    {
      digitalFlashMode = [v1 digitalFlashMode];
      if ((v5 & 0x4000) == 0 || digitalFlashMode < 1)
      {
        goto LABEL_19;
      }

      OUTLINED_FUNCTION_62();
      OUTLINED_FUNCTION_88_6();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v14 = OUTLINED_FUNCTION_90_4(os_log_and_send_and_compose_flags_and_os_log_type);
      if (OUTLINED_FUNCTION_5_24(v14))
      {
        OUTLINED_FUNCTION_11_49();
        OUTLINED_FUNCTION_4_4();
        _os_log_send_and_compose_impl();
        OUTLINED_FUNCTION_17_32();
      }

      goto LABEL_15;
    }

    if (dword_1ED844350)
    {
      OUTLINED_FUNCTION_62();
      v8 = OUTLINED_FUNCTION_39_10();
      OUTLINED_FUNCTION_90_4(v8);
      OUTLINED_FUNCTION_115_0();
      if (v10)
      {
        v11 = v9;
      }

      else
      {
        v11 = v2;
      }

      if (v11)
      {
        [*(v0 + 2952) appliedZoomFactorWithoutFudge];
        OUTLINED_FUNCTION_5();
        OUTLINED_FUNCTION_4_4();
        _os_log_send_and_compose_impl();
        OUTLINED_FUNCTION_17_32();
      }

LABEL_15:
      OUTLINED_FUNCTION_10_52();
      OUTLINED_FUNCTION_13_0();
    }
  }

  if ([v1 constituentPhotoDeliveryEnabled] && objc_msgSend(v1, "cameraCalibrationDataDeliveryEnabled") && (objc_msgSend(objc_msgSend(*(v0 + 624), "objectForKeyedSubscript:", @"ConstituentPhotoCalibrationData"), "BOOLValue") & 1) == 0 && dword_1ED844350)
  {
    OUTLINED_FUNCTION_62();
    v15 = OUTLINED_FUNCTION_39_10();
    v16 = OUTLINED_FUNCTION_72_6(v15);
    if (OUTLINED_FUNCTION_5_2(v16))
    {
      OUTLINED_FUNCTION_11_49();
      OUTLINED_FUNCTION_7_4();
      _os_log_send_and_compose_impl();
    }

    OUTLINED_FUNCTION_10_52();
    OUTLINED_FUNCTION_54_12();
  }

LABEL_19:
  OUTLINED_FUNCTION_56();
}

- (uint64_t)_ubIsRequestedHighResolutionFlavorSupportedForCaptureType:(uint64_t)type portType:(int)portType qualityPrioritization:(int)prioritization requestedHighResolutionFlavor:(unint64_t)flavor sceneFlags:(char)flags deliverDepthData:(char)data bravoConstituentPhotoCapture:(char)capture autoDeferredProcessingEnabled:(char)self0 canDefer:(char)self1 demosaicedRawRequested:(_BYTE *)self2 isUltraHighResolutionDowngradeOut:
{
  if (!self)
  {
    return 0;
  }

  if (prioritization == 2)
  {
    LOBYTE(v16) = 0;
    if (flavor & 0x200000) == 0 || (flags)
    {
LABEL_41:
      v17 = 0;
      goto LABEL_29;
    }

    v17 = 0;
    if (data)
    {
      goto LABEL_29;
    }

    if (![objc_msgSend(*(self + 2664) "objectForKeyedSubscript:{"containsObject:", &unk_1F22469C0}")])
    {
      goto LABEL_28;
    }

    if (a2 != 1 || portType < 2)
    {
      goto LABEL_28;
    }

    v19 = *(self + 2260);
    if ((v19 & 0xC) == 0)
    {
      goto LABEL_28;
    }

    if ((v19 & 4) != 0)
    {
      LOBYTE(v16) = v19 & BYTE3(flavor) & 1;
    }

    else
    {
      LOBYTE(v16) = 0;
      if ((v19 & 8) == 0 || !enabled)
      {
        v17 = 0;
        if ((flavor & 0x1000000) == 0)
        {
          goto LABEL_29;
        }

LABEL_35:
        if ((v16 & 1) == 0)
        {
          FigCaptureGetFrameworkRadarComponent();
          OUTLINED_FUNCTION_112();
          OUTLINED_FUNCTION_145_1();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v22 = OUTLINED_FUNCTION_26_8(os_log_and_send_and_compose_flags_and_os_log_type);
          if (OUTLINED_FUNCTION_5_24(v22))
          {
            OUTLINED_FUNCTION_5_6();
            OUTLINED_FUNCTION_4_4();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_8_1();
          OUTLINED_FUNCTION_13_0();
          v31 = 0;
          OUTLINED_FUNCTION_5_61();
          v23 = _os_log_send_and_compose_impl();
          OUTLINED_FUNCTION_11();
          OUTLINED_FUNCTION_17_26();
          OUTLINED_FUNCTION_10();
          FigCapturePleaseFileRadar(v24, v25, v26, v27, v28, 18479, v29, v30, &v31);
          free(v23);
          LOBYTE(v16) = 0;
        }

        goto LABEL_29;
      }

      v17 = 0;
      if (!capture)
      {
LABEL_34:
        if ((flavor & 0x1000000) == 0)
        {
          goto LABEL_29;
        }

        goto LABEL_35;
      }

      v16 = (flavor >> 24) & 1 & (v19 >> 1);
    }

    v17 = (flavor & 0x1000000) == 0;
    goto LABEL_34;
  }

  if (prioritization != 1)
  {
    LOBYTE(v16) = 0;
    v17 = prioritization == 0;
    goto LABEL_29;
  }

  LOBYTE(v16) = 0;
  if (!capture || !enabled)
  {
    goto LABEL_41;
  }

  v17 = 0;
  if (data)
  {
    goto LABEL_29;
  }

  if (![objc_msgSend(*(self + 2664) "objectForKeyedSubscript:{"containsObject:", &unk_1F22469F0}")] || defer && !*(self + 2672))
  {
LABEL_28:
    LOBYTE(v16) = 0;
    v17 = 0;
    goto LABEL_29;
  }

  LOBYTE(v16) = 0;
  if (portType > 2)
  {
    v17 = (a2 == 12) & *(self + 2257) & (flavor >> 20) | *(self + 2672);
  }

  else
  {
    v17 = 0;
  }

LABEL_29:
  if (requested)
  {
    *requested = v16;
  }

  return v17;
}

- (void)_ubResolveStillImageCaptureFlagsForCaptureType:(uint64_t)type sceneFlags:(uint64_t)flags settings:(uint64_t)settings frameStatisticsByPortType:(uint64_t)portType hdrMode:(uint64_t)mode speedOverQuality:(uint64_t)quality speedOverQualityDowngrade:(uint64_t)downgrade qualityPrioritization:(uint64_t)self0 highResolutionFlavor:(uint64_t)self1 ultraHighResolutionDowngrade:(uint64_t)self2 canDefer:(uint64_t)self3 zeroShutterLagFailureReasonOut:(uint64_t)self4 metadata:(uint64_t)self5
{
  OUTLINED_FUNCTION_84();
  v168 = v31;
  v170 = v32;
  if (v25)
  {
    v33 = v28;
    v34 = v27;
    v35 = v26;
    v36 = v25;
    v169 = v30;
    v162 = v29;
    v37 = a25;
    v186 = 0;
    v38 = *(v25 + 1392);
    if (!v38)
    {
      v38 = *(v25 + 600);
    }

    [v38 portType];
    v159 = [OUTLINED_FUNCTION_17() objectForKeyedSubscript:?];
    if (v159)
    {
      v161 = v33;
      [v38 portType];
      v164 = [OUTLINED_FUNCTION_17() objectForKeyedSubscript:?];
      if (v164)
      {
        hasSphere = [v38 hasSphere];
        motionDataInvalid = [v38 motionDataInvalid];
        v157 = hasSphere;
        if ((hasSphere & motionDataInvalid) != 0)
        {
          v41 = 0x200000;
        }

        else
        {
          v41 = 0;
        }

        v160 = motionDataInvalid;
        if (v35 == 12 && [v170 autoDeferredProcessingEnabled] && a24 && (((v34 & 0x8080000) == 0x80000) & objc_msgSend(v170, "autoStereoPhotoCaptureEnabled")) != 0)
        {
          v41 |= 0x4000000000uLL;
        }

        OUTLINED_FUNCTION_298();
        v167 = v34;
        v163 = v38;
        if (v42)
        {
          [BWFigVideoCaptureDevice _ubDeliverDepthDataForSettings:speedOverQuality:sceneFlags:];
          v97 = v96;
          if ((*(v36 + 1593) & 1) != 0 || *(v36 + 1595) == 1)
          {
            shallowDepthOfFieldEffectStatus = [v36 shallowDepthOfFieldEffectStatus];
            [MEMORY[0x1E696AD98] numberWithInt:shallowDepthOfFieldEffectStatus];
            [OUTLINED_FUNCTION_7() setShallowDepthOfFieldEffectSceneStatus:?];
            if ((v97 & ((shallowDepthOfFieldEffectStatus > 0xE) | (0x5FDu >> shallowDepthOfFieldEffectStatus))) == 1)
            {
              if (dword_1ED844350)
              {
                OUTLINED_FUNCTION_94_4();
                os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
                os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, v184);
                OUTLINED_FUNCTION_82_6();
                if (v42)
                {
                  v101 = v100;
                }

                else
                {
                  v101 = v185;
                }

                if (v101)
                {
                  v179 = 136315394;
                  v180 = "[BWFigVideoCaptureDevice _ubResolveStillImageCaptureFlagsForCaptureType:sceneFlags:settings:frameStatisticsByPortType:hdrMode:speedOverQuality:speedOverQualityDowngrade:qualityPrioritization:highResolutionFlavor:ultraHighResolutionDowngrade:canDefer:zeroShutterLagFailureReasonOut:metadata:]";
                  v181 = 1024;
                  v182 = shallowDepthOfFieldEffectStatus;
                  OUTLINED_FUNCTION_14_28();
                  OUTLINED_FUNCTION_4_4();
                  _os_log_send_and_compose_impl();
                }

                OUTLINED_FUNCTION_2_4();
                OUTLINED_FUNCTION_39_0();
              }

              v97 = 0;
            }
          }

          if ((v41 & 0x4000000000) != 0 || v97)
          {
            v134 = 2048;
            if ((*(v36 + 2241) & ((*(v36 + 2268) & 0xFFFFFFFE) == 8)) != 0)
            {
              v134 = 2052;
            }

            v41 |= v134;
            if (v35 == 11 && *(v36 + 2488) || *(v36 + 588) == 13)
            {
              v41 |= 0x200uLL;
            }
          }
        }

        isBravoVariant = [v36 isBravoVariant];
        if (isBravoVariant && (v41 & 0x4000000800) != 0 && (v41 & 0x200) == 0)
        {
          v95 = OUTLINED_FUNCTION_9_19();
          v45 = [BWFigVideoCaptureDevice _captureStreamsForDepthDataDeliveryOrStereoPhotoCaptureWithPrimaryCaptureStream:v95];
          constituentPhotoDeliveryEnabled = 1;
        }

        else
        {
          constituentPhotoDeliveryEnabled = [v170 constituentPhotoDeliveryEnabled];
          if ([v170 constituentPhotoDeliveryEnabled])
          {
            [v170 bravoConstituentImageDeliveryDeviceTypes];
            v102 = OUTLINED_FUNCTION_10_29();
            v44 = [(BWFigVideoCaptureDevice *)v102 _captureStreamsForBravoConstituentImageDeliveryDeviceTypes:v103];
          }

          else
          {
            v178 = v38;
            v44 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v178 count:1];
          }

          v45 = v44;
        }

        array = [MEMORY[0x1E695DF70] array];
        v174 = 0u;
        v175 = 0u;
        v176 = 0u;
        v177 = 0u;
        OUTLINED_FUNCTION_95_0();
        v51 = OUTLINED_FUNCTION_64(v47, v48, v49, v50);
        if (v51)
        {
          v53 = v51;
          do
          {
            v54 = 0;
            do
            {
              OUTLINED_FUNCTION_49_7();
              if (!v42)
              {
                objc_enumerationMutation(v45);
              }

              [*(*(&v174 + 1) + 8 * v54) portType];
              [OUTLINED_FUNCTION_37_0() addObject:?];
              ++v54;
            }

            while (v53 != v54);
            OUTLINED_FUNCTION_95_0();
            v51 = OUTLINED_FUNCTION_64(v55, v56, v57, v58);
            v53 = v51;
          }

          while (v51);
        }

        memset(v173, 0, 64);
        obj = v45;
        v59 = OUTLINED_FUNCTION_64(v51, v52, v173, v172);
        v165 = v35;
        v166 = array;
        if (!v59)
        {
          v62 = 0;
          goto LABEL_52;
        }

        v60 = v59;
        v61 = 0;
        LOBYTE(v62) = 0;
        v63 = *off_1E798BD50;
        while (1)
        {
          for (i = 0; i != v60; ++i)
          {
            OUTLINED_FUNCTION_30_6();
            if (!v42)
            {
              objc_enumerationMutation(obj);
            }

            v65 = *(*(&v173[0] + 1) + 8 * i);
            if (v61)
            {
              v61 = 1;
              if (!v62)
              {
                goto LABEL_35;
              }
            }

            else
            {
              v61 = [objc_msgSend(objc_msgSend(*(*(&v173[0] + 1) + 8 * i) "stream")];
              if (!v62)
              {
LABEL_35:
                v62 = [v65 activeQuadraBinningFactor] == 1;
                goto LABEL_38;
              }
            }

            v62 = 1;
LABEL_38:
            v66 = *(v36 + 148) < 1 || *(v36 + 152) < 1;
            if (!v66 && [v65 activeSensorDimensions] == *(v36 + 148))
            {
              v41 |= 0x40uLL;
            }

            [v65 portType];
            if ([objc_msgSend(OUTLINED_FUNCTION_24_1() "objectForKeyedSubscript:"alwaysUseAFTimeout"")])
            {
              v41 |= 0x80000000uLL;
            }
          }

          v60 = [obj countByEnumeratingWithState:v173 objects:v172 count:16];
          if (!v60)
          {
            if (v61)
            {
              v41 |= 0x8000uLL;
            }

            v35 = v165;
LABEL_52:
            if ((v41 & 0x40) != 0)
            {
              v67 = a24;
            }

            else
            {
              v67 = 1;
            }

            v68 = *(v36 + 2241);
            if (constituentPhotoDeliveryEnabled & 1) == 0 && FigCapturePixelFormatIsDemosaicedRaw([v170 rawOutputFormat]) && (objc_msgSend(objc_loadWeak((v36 + 2656)), "demosaicedRawSupportedForCaptureType:", v35))
            {
              v41 |= 0x100uLL;
            }

            v69 = 0x40000;
            if (v169)
            {
              v69 = 262146;
            }

            if (!v168)
            {
              v69 = 0;
            }

            v70 = v41 | v69;
            switch(v35)
            {
              case 1:
                if (!*(v36 + 2260))
                {
                  v37 = a25;
                  goto LABEL_182;
                }

                v37 = a25;
                if (([v170 burstQualityCaptureEnabled] & 1) != 0 || a21 <= 1 && (v162 != 2 || (*(v36 + 2260) & 0x10) == 0))
                {
                  goto LABEL_182;
                }

                if (a22 != 2)
                {
                  if (a22 == 1)
                  {
                    if ((*(v36 + 2672) & 1) == 0)
                    {
                      goto LABEL_182;
                    }
                  }

                  else if (a22 || (*(v36 + 2260) & 1) == 0 && (![v170 autoDeferredProcessingEnabled] || !a24 || (*(v36 + 2260) & 2) == 0))
                  {
                    goto LABEL_182;
                  }

LABEL_181:
                  v70 |= 0x80uLL;
                  goto LABEL_182;
                }

                if ((*(v36 + 2260) & 4) != 0 || [v170 autoDeferredProcessingEnabled] && a24 && (*(v36 + 2260) & 8) != 0)
                {
                  goto LABEL_181;
                }

LABEL_182:
                if ([v170 burstQualityCaptureEnabled])
                {
                  v71 = 0;
                  v70 |= 0x4000uLL;
LABEL_184:
                  v87 = v166;
                  if (a22 == 2)
                  {
                    LOBYTE(v94) = v167;
                  }

                  else
                  {
                    LOBYTE(v94) = v167;
                    if ((v70 & 0x80) != 0 && (a23 & 1) == 0)
                    {
                      if (v162)
                      {
                        if (v162 == 1)
                        {
                          goto LABEL_194;
                        }

                        if (v162 == 2)
                        {
                          LOBYTE(v183[0]) = 0;
                          v114 = OUTLINED_FUNCTION_9_19();
                          if (([(BWFigVideoCaptureDevice *)v114 _ubIsHDRCaptureUsingSceneFlags:v115]& 1) != 0)
                          {
                            v116 = OUTLINED_FUNCTION_13_33();
                            v120 = [(BWFigVideoCaptureDevice *)v116 _ubIsTimeMachineFramesUsableForHDRUsingTimeMachineFramesMetadata:v117 portTypes:v118 sifrFlickerDetectionEnabled:v168 sifrFlickerDetected:v119];
                            if (LOBYTE(v183[0]))
                            {
                              v70 |= 0x200000000000uLL;
                            }

                            if (v120)
                            {
LABEL_194:
                              if (v168)
                              {
                                v70 |= 0x20000000000uLL;
                              }

                              else
                              {
                                v70 |= (*(v36 + 2260) & 0x10) << 38;
                              }

                              if ((v70 & 0x800) != 0 && ((isBravoVariant & 1) != 0 || *(v36 + 1560) || *(v36 + 2268) == 10))
                              {
                                v70 |= 0x1000uLL;
                              }
                            }
                          }
                        }
                      }

                      else
                      {
                        v70 |= 0x1000000uLL;
                      }
                    }
                  }

                  goto LABEL_215;
                }

                if (a22 != 2)
                {
                  if (a23 & 1 | ((*(v36 + 3448) & 1) == 0) | (v67 ^ 1) & 1)
                  {
                    v71 = 0;
                  }

                  else if ((v70 & 0x80) != 0)
                  {
                    OUTLINED_FUNCTION_250();
                    [BWFigVideoCaptureDevice _ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:];
                    v71 = v135;
                  }

                  else
                  {
                    v71 = 0;
                    if (a21 == 1)
                    {
                      v70 |= 0x4000uLL;
                    }
                  }

                  goto LABEL_184;
                }

                v70 |= 0x100000000uLL;
                if ([v36 ultraHighResolutionZeroShutterLagEnabled])
                {
                  LOBYTE(v94) = v167;
                  v87 = v166;
                  v71 = 0;
                  if (*(v36 + 3453) == 1)
                  {
                    v186 = 14;
                  }
                }

                else
                {
                  v71 = 0;
                  LOBYTE(v94) = v167;
                  v87 = v166;
                }

LABEL_215:
                if (v68)
                {
                  burstQualityCaptureEnabled = [v170 burstQualityCaptureEnabled];
                  v122 = (v70 >> 30) & 4 | v70;
                  if ((v70 & 0x80) != 0)
                  {
                    v122 = v70 | 4;
                  }

                  if ((burstQualityCaptureEnabled & 1) == 0)
                  {
                    v70 = v122;
                  }
                }

                macroFlashQSubSwitchingEnabled = 0;
                v108 = v62;
                if ((v70 & 0x184) != 0 && (((v70 & 4) != 0) & *(v36 + 2242)) == 0)
                {
                  [v164 toneCurveBehavior];
                  OUTLINED_FUNCTION_255();
                  if (v42)
                  {
                    v124 = 0x20000000;
                  }

                  if (v123 == 4)
                  {
                    v124 = 0x40000000;
                  }

                  v125 = v124 | v70;
                  [v164 preserveBlackLevel];
                  macroFlashQSubSwitchingEnabled = OUTLINED_FUNCTION_349();
                  if (v126)
                  {
                    v70 = v125 | 0x2000000;
                  }

                  else
                  {
                    v70 = v125;
                  }
                }

                goto LABEL_154;
              case 2:
                constantColorEnabled = [v170 constantColorEnabled];
                if (*(v36 + 2265) == 1 && v68)
                {
                  v75 = (v41 & 0x900) != 0 || a21 > 1;
                  if ((v75 | constantColorEnabled))
                  {
                    v70 |= 0xCuLL;
                    if ((*(v36 + 2242) & 1) == 0)
                    {
                      [v164 toneCurveBehavior];
                      OUTLINED_FUNCTION_255();
                      if (v42)
                      {
                        v77 = 0x20000000;
                      }

                      if (v76 == 4)
                      {
                        v77 = 0x40000000;
                      }

                      v78 = v77 | v70;
                      if ([v164 preserveBlackLevel])
                      {
                        v70 = v78 | 0x2000000;
                      }

                      else
                      {
                        v70 = v78;
                      }
                    }

                    if (*(v36 + 2174) == 1 && ([v170 autoRedEyeReductionEnabled] & ((v70 & 0x100) == 0)) != 0)
                    {
                      v70 |= 0x10000uLL;
                    }

                    goto LABEL_149;
                  }

                  goto LABEL_103;
                }

                if ((v41 & 0x100) == 0)
                {
LABEL_103:
                  if (*(v36 + 2174) == 1)
                  {
                    [v170 autoRedEyeReductionEnabled];
                    OUTLINED_FUNCTION_223();
                  }

                  goto LABEL_149;
                }

                [v164 toneCurveBehavior];
                OUTLINED_FUNCTION_255();
                if (v42)
                {
                  v105 = 0x20000000;
                }

                if (v104 == 4)
                {
                  v105 = 0x40000000;
                }

                v106 = v105 | v70;
                if ([v164 preserveBlackLevel])
                {
                  v70 = v106 | 0x2000000;
                }

                else
                {
                  v70 = v106;
                }

LABEL_149:
                macroFlashQSubSwitchingEnabled = 0;
                v107 = v35;
                v71 = 0;
                v37 = a25;
                if (v107 == 2)
                {
                  LOBYTE(v94) = v167;
                  v87 = v166;
                  v108 = v62;
                  if ((v167 & 0x10000000) != 0)
                  {
                    macroFlashQSubSwitchingEnabled = [v164 macroFlashQSubSwitchingEnabled];
                    v71 = 0;
                  }
                }

                else
                {
LABEL_152:
                  LOBYTE(v94) = v167;
                  v87 = v166;
LABEL_153:
                  v108 = v62;
                }

                goto LABEL_154;
              case 7:
                if ((v41 & 0x100) != 0)
                {
                  [v164 toneCurveBehavior];
                  OUTLINED_FUNCTION_255();
                  if (v42)
                  {
                    v81 = 0x20000000;
                  }

                  if (v80 == 4)
                  {
                    v81 = 0x40000000;
                  }

                  v82 = v81 | v70;
                  preserveBlackLevel = [v164 preserveBlackLevel];
                  v71 = 0;
                  macroFlashQSubSwitchingEnabled = 0;
                  if (preserveBlackLevel)
                  {
                    v70 = v82 | 0x2000000;
                  }

                  else
                  {
                    v70 = v82;
                  }
                }

                else
                {
                  v71 = 0;
                  macroFlashQSubSwitchingEnabled = 0;
                }

                v37 = a25;
                goto LABEL_152;
              case 10:
              case 12:
              case 13:
                if (v35 == 12)
                {
                  v37 = a25;
                  if (a22 == 1)
                  {
                    if (*(v36 + 2672) == 1)
                    {
                      v70 |= 0x400000000uLL;
                    }

                    else if ((v167 & 0x80000000) != 0)
                    {
                      v70 |= 0x100000000000uLL;
                    }

                    else
                    {
                      v70 |= 0x200000000uLL;
                    }
                  }

                  else if (a22 == 2)
                  {
                    v70 |= 0x100000000uLL;
                  }
                }

                else
                {
                  v37 = a25;
                }

                usePreviousSIFR = 0;
                if (*(v36 + 1560))
                {
                  v87 = v166;
                  if ((v70 & 0x800) != 0)
                  {
                    if (*(v36 + 2183) == 1)
                    {
                      usePreviousSIFR = [v164 usePreviousSIFR];
                    }

                    else
                    {
                      usePreviousSIFR = 0;
                    }
                  }
                }

                else
                {
                  v87 = v166;
                }

                LOBYTE(v127) = 1;
                if ((v70 & 0x100000000) == 0 && (usePreviousSIFR & 1) == 0)
                {
                  v127 = v67 ^ 1 | (v70 >> 38) & 1 & (v167 >> 26);
                }

                v128 = [(BWFigVideoCaptureDevice *)v36 _ubIsHDRCaptureUsingSceneFlags:v167];
                v129 = v128;
                v71 = 0;
                if (*(v36 + 3448) == 1)
                {
                  v130 = v160;
                  if ((v127 & 1) == 0)
                  {
                    v131 = v128 ^ 1;
                    if (v162 != 2)
                    {
                      v131 = 0;
                    }

                    if (v131 & 1) != 0 || !v162 || (*(v36 + 2183))
                    {
                      OUTLINED_FUNCTION_250();
                      v137 = v136;
                      [BWFigVideoCaptureDevice _ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:];
                      v130 = v137;
                      v71 = v138;
                    }

                    else
                    {
                      v71 = 0;
                    }
                  }
                }

                else
                {
                  v130 = v160;
                }

                if (v68)
                {
                  v70 |= 4uLL;
                }

                if (v162 != 2)
                {
                  v94 = v167;
                  v108 = v62;
                  if (v162 == 1)
                  {
                    v70 |= 0x100000uLL;
                    v132 = 1;
                    if ((v70 & 4) == 0)
                    {
                      goto LABEL_274;
                    }

                    goto LABEL_254;
                  }

                  if (!v162)
                  {
                    v132 = 0;
                    v70 |= 0x1000000uLL;
                    if ((v70 & 4) == 0)
                    {
                      goto LABEL_274;
                    }

                    goto LABEL_254;
                  }

                  goto LABEL_253;
                }

                v94 = v167;
                v108 = v62;
                if (!v129)
                {
LABEL_253:
                  v132 = 0;
                  if ((v70 & 4) == 0)
                  {
                    goto LABEL_274;
                  }

                  goto LABEL_254;
                }

                v139 = OUTLINED_FUNCTION_13_33();
                v132 = [(BWFigVideoCaptureDevice *)v139 _ubIsTimeMachineFramesUsableForHDRUsingTimeMachineFramesMetadata:v140 portTypes:v141 sifrFlickerDetectionEnabled:0 sifrFlickerDetected:0];
                OUTLINED_FUNCTION_223();
                if ((v70 & 4) == 0)
                {
                  goto LABEL_274;
                }

LABEL_254:
                if (*(v36 + 2242))
                {
                  v133 = 0;
                  goto LABEL_284;
                }

LABEL_274:
                switch([v164 toneCurveBehavior])
                {
                  case 1u:
                    if ((v132 & 1) == 0 && ![(BWFigVideoCaptureDevice *)v36 _ubUseSquareRootToneCurveForNonHDRCapturesUsingFrameStatistics:v159 captureParameters:v164 sceneFlags:v94])
                    {
                      goto LABEL_278;
                    }

                    v70 |= 0x800000uLL;
                    v133 = 1;
                    break;
                  case 2u:
                    v133 = 0;
                    if (v132)
                    {
                      v70 |= 0x800000uLL;
                    }

                    break;
                  case 3u:
                    v133 = 0;
                    v70 |= 0x20000000uLL;
                    break;
                  case 4u:
                    v133 = 0;
                    v70 |= 0x40000000uLL;
                    break;
                  default:
LABEL_278:
                    v133 = 0;
                    break;
                }

                [v164 preserveBlackLevel];
                OUTLINED_FUNCTION_223();
                v130 = v160;
LABEL_284:
                if ((v168 & 1) == 0)
                {
                  if (v157)
                  {
                    if ((v94 & 0xC) != 0 || (*(v36 + 2185) & 1) == 0)
                    {
                      if ((*(v36 + 2176) != 2) | v130 & 1)
                      {
                        LOBYTE(v142) = (*(v36 + 2176) != 2) & (v130 ^ 1);
                      }

                      else
                      {
                        LOBYTE(v142) = [v163 sphereVideoEnabled];
                      }
                    }

                    else
                    {
                      LOBYTE(v142) = 0;
                    }
                  }

                  else
                  {
                    v142 = (v94 >> 9) & 1 | v133;
                    if ((v94 & 0xC) == 0 && v142)
                    {
                      LOBYTE(v142) = *(v36 + 2185) ^ 1;
                    }
                  }

                  if ((v165 & 0xFFFFFFFE) == 0xC)
                  {
                    v143 = 1;
                  }

                  else
                  {
                    v143 = v132;
                  }

                  if (v143 & 1) != 0 || (v142)
                  {
                    v70 |= 0x400000uLL;
                  }
                }

                if ((v70 & 0x800) == 0)
                {
                  goto LABEL_313;
                }

                if (*(v36 + 2181) == 1 && ((*(v36 + 3446) & 1) == 0 && (*(v36 + 3447) & 1) != 0 || (v94 & 0xC) == 0 || (v70 & 0x800000) != 0))
                {
                  v70 |= 0x20000uLL;
                }

                if (v132 && ((isBravoVariant & 1) != 0 || *(v36 + 1560) || *(v36 + 2268) == 10))
                {
                  macroFlashQSubSwitchingEnabled = 0;
                  v70 |= 0x1000uLL;
                }

                else
                {
LABEL_313:
                  macroFlashQSubSwitchingEnabled = 0;
                }

LABEL_154:
                if ((v108 | macroFlashQSubSwitchingEnabled) & 1 | BYTE4(v70) & 1)
                {
                  v109 = v70 | 0x10;
                }

                else
                {
                  v109 = v70;
                }

                if (v71)
                {
                  [(BWFigVideoCaptureDevice *)v36 _ubEVZeroCountForCaptureType:v165 sceneFlags:v94 captureFlags:v109 frameStatistics:v159];
                  [v163 portType];
                  v110 = OUTLINED_FUNCTION_13_33();
                  [BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:v110 minimumValidCount:? primaryPortType:? portTypes:? frameStatisticsByPortType:? deliverDepthData:?];
                  v186 = v111;
                  if (v111)
                  {
                    [(BWFigVideoCaptureDevice *)v36 _resumeTimeMachines];
                  }

                  else
                  {
                    *(v36 + 3496) = v71;
                    v112 = OUTLINED_FUNCTION_13_33();
                    [BWFigVideoCaptureDevice _ubFramesMetadataHasSIFRSkip:v112];
                  }
                }

                if (v186 != 3)
                {
                  [(BWFigVideoCaptureDevice *)v36 _ubCBAFScanInProgressUsingFrameStatisticsByPortType:v161 portTypes:v87 timeMachineFramesMetadata:0];
                }

                if (v37)
                {
                  goto LABEL_161;
                }

                goto LABEL_162;
              case 11:
                if (v68)
                {
                  v79 = v70 | 4;
                }

                else
                {
                  [v164 toneCurveBehavior];
                  OUTLINED_FUNCTION_255();
                  if (v42)
                  {
                    v85 = 0x20000000;
                  }

                  if (v84 == 4)
                  {
                    v85 = 0x40000000;
                  }

                  v86 = v85 | v70;
                  if ([v164 preserveBlackLevel])
                  {
                    v79 = v86 | 0x2000000;
                  }

                  else
                  {
                    v79 = v86;
                  }
                }

                v87 = v166;
                v37 = a25;
                objc_loadWeak((v36 + 2656));
                [v163 portType];
                v88 = [OUTLINED_FUNCTION_17() rawNightModeSupportedForPortType:?];
                v89 = v79 | 0x800000000;
                if (!v88)
                {
                  v89 = v79;
                }

                if (a22 == 2)
                {
                  v90 = v89 | 0x100000000;
                }

                else
                {
                  v90 = v89;
                }

                digitalFlashMode = [v170 digitalFlashMode];
                v71 = 0;
                macroFlashQSubSwitchingEnabled = 0;
                v92 = digitalFlashMode >= 2;
                v42 = digitalFlashMode == 2;
                v93 = v90 | 0x8000000;
                if (!v42)
                {
                  v93 = v90;
                }

                if (!v92)
                {
                  v93 = v90 | 0x4000000;
                }

                v70 = v93 | 0x80000000;
                LOBYTE(v94) = v167;
                goto LABEL_153;
              default:
                goto LABEL_149;
            }
          }
        }
      }

      FigCaptureGetFrameworkRadarComponent();
      OUTLINED_FUNCTION_94_4();
      v146 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v147 = OUTLINED_FUNCTION_369(v146);
      if (OUTLINED_FUNCTION_6(v147))
      {
        v179 = 136315138;
        v180 = "[BWFigVideoCaptureDevice _ubResolveStillImageCaptureFlagsForCaptureType:sceneFlags:settings:frameStatisticsByPortType:hdrMode:speedOverQuality:speedOverQualityDowngrade:qualityPrioritization:highResolutionFlavor:ultraHighResolutionDowngrade:canDefer:zeroShutterLagFailureReasonOut:metadata:]";
        OUTLINED_FUNCTION_14_28();
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_5_3();
      OUTLINED_FUNCTION_17_8();
      v183[0] = 0;
      OUTLINED_FUNCTION_16_14();
      OUTLINED_FUNCTION_5_61();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_13_18();
      v148 = OUTLINED_FUNCTION_6_1();
      v155 = 18800;
    }

    else
    {
      FigCaptureGetFrameworkRadarComponent();
      OUTLINED_FUNCTION_94_4();
      v144 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v145 = OUTLINED_FUNCTION_369(v144);
      if (OUTLINED_FUNCTION_6(v145))
      {
        v179 = 136315138;
        v180 = "[BWFigVideoCaptureDevice _ubResolveStillImageCaptureFlagsForCaptureType:sceneFlags:settings:frameStatisticsByPortType:hdrMode:speedOverQuality:speedOverQualityDowngrade:qualityPrioritization:highResolutionFlavor:ultraHighResolutionDowngrade:canDefer:zeroShutterLagFailureReasonOut:metadata:]";
        OUTLINED_FUNCTION_14_28();
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_5_3();
      OUTLINED_FUNCTION_17_8();
      v183[0] = 0;
      OUTLINED_FUNCTION_16_14();
      OUTLINED_FUNCTION_5_61();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_13_18();
      v148 = OUTLINED_FUNCTION_6_1();
      v155 = 18798;
    }

    FigCapturePleaseFileRadar(v148, v149, v150, v151, v152, v155, v153, v154, v156);
    free(v183);
    if (a25)
    {
LABEL_161:
      *v37 = v186;
    }
  }

LABEL_162:
  OUTLINED_FUNCTION_81();
}

- (uint64_t)_ubIsBravoMultiCameraCaptureForSettings:(uint64_t)settings sceneFlags:(int)flags deliverDepthData:
{
  if (result)
  {
    OUTLINED_FUNCTION_67_8();
    result = [v7 isBravoVariant];
    if (result)
    {
      result = [v5 constituentPhotoDeliveryEnabled];
      if ((result & 1) == 0)
      {
        if (flags)
        {
          v8 = OUTLINED_FUNCTION_2_42();
          return [(BWFigVideoCaptureDevice *)v8 _ubIsDigitalFlashCaptureForSettings:v9 sceneFlags:v4]^ 1;
        }
      }
    }
  }

  return result;
}

- (void)_ubStillImageCaptureSettingsWithID:(uint64_t)d userInitiatedRequestPTS:(uint64_t)s captureType:(uint64_t)type captureFlags:(uint64_t)flags sceneFlags:(uint64_t)sceneFlags frameStatisticsByPortType:(uint64_t)portType metadata:(uint64_t)metadata deliverOriginalImage:(uint64_t)self0 deliverSushiRaw:(uint64_t)self1 bravoConstituentImageDeliveryDeviceTypes:(uint64_t)self2
{
  OUTLINED_FUNCTION_60();
  v504 = v30;
  v496 = v31;
  HIDWORD(v569) = v32;
  if (!v25)
  {
    goto LABEL_362;
  }

  v33 = v29;
  v34 = v28;
  v35 = v27;
  v36 = v26;
  v37 = v25;
  if (!_FigIsNotCurrentDispatchQueue())
  {
    OUTLINED_FUNCTION_0_3();
    OUTLINED_FUNCTION_2_5();
    FigDebugAssert3();
  }

  v38 = *(v37 + 1392);
  if (!v38)
  {
    v38 = *(v37 + 600);
  }

  if (HIDWORD(v569) > 0xD || ((1 << SBYTE4(v569)) & 0x3402) == 0)
  {
    goto LABEL_360;
  }

  array = [MEMORY[0x1E695DF70] array];
  array2 = [MEMORY[0x1E695DF70] array];
  dictionary = [MEMORY[0x1E695DF90] dictionary];
  dictionary2 = [MEMORY[0x1E695DF90] dictionary];
  dictionary3 = [MEMORY[0x1E695DF90] dictionary];
  dictionary4 = [MEMORY[0x1E695DF90] dictionary];
  v438 = v33;
  if (!*(v37 + 648))
  {
    goto LABEL_9;
  }

  if ((v34 & 0x4000000800) != 0)
  {
    v54 = [BWFigVideoCaptureDevice _captureStreamsForDepthDataDeliveryOrStereoPhotoCaptureWithPrimaryCaptureStream:v37];
    [MEMORY[0x1E695DF70] array];
    *&v55 = OUTLINED_FUNCTION_181();
    v639[0] = v55;
    v639[1] = v55;
    v639[2] = v55;
    v639[3] = v55;
    if (OUTLINED_FUNCTION_64(v56, v57, v639, v638))
    {
      do
      {
        OUTLINED_FUNCTION_21_20();
        if (!v98)
        {
          objc_enumerationMutation(v54);
        }

        if (**(&v639[0] + 1) != v38)
        {
          [0x1E695D000 addObject:?];
        }

        OUTLINED_FUNCTION_131_2();
      }

      while (!v98 || OUTLINED_FUNCTION_64(v58, v59, v639, v638));
    }

    if ([0x1E695D000 count])
    {
      v60 = 0x1E695D000uLL;
    }

    else
    {
      v60 = 0;
    }

    v556 = v60;
    if (HIDWORD(v569) == 1)
    {
      v39 = 0;
      HIDWORD(v462) = 0;
    }

    else
    {
      v39 = 0;
      if ((v34 & 4) == 0 || *(v37 + 1560))
      {
        HIDWORD(v462) = 0;
      }

      else
      {
        HIDWORD(v462) = 0;
        v39 = [a25 count] == 0;
      }
    }
  }

  else
  {
    if (![a25 count])
    {
LABEL_9:
      v39 = 0;
      HIDWORD(v462) = 0;
      v556 = 0;
      goto LABEL_10;
    }

    v52 = [(BWFigVideoCaptureDevice *)v37 _captureStreamsForBravoConstituentImageDeliveryDeviceTypes:a25];
    HIDWORD(v462) = [v52 containsObject:v38] ^ 1;
    v556 = v52;
    [v52 removeObject:v38];
    v39 = 0;
  }

LABEL_10:
  portType = [v38 portType];
  v48 = OUTLINED_FUNCTION_376(portType, v41, v42, v43, v44, v45, v46, v47, v423, v427, v430, v434, v438, v442, v446, v450, v454, v458, v462, v466, v470, v34 & 4, v477, v481, v485, v489, v492, v496, v500, v504);
  [v38 portType];
  v49 = v37;
  v50 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
  v493 = v48;
  if ([v48 ltmCurve])
  {
    v34 |= 0x10000000uLL;
  }

  v584 = v49;
  v51 = (v34 & 0x2000) == 0 || *(v49 + 3496) == 0;
  LODWORD(v467) = v39;
  if ((v34 & 0x800000) != 0)
  {
    v53 = 1;
  }

  else if ((v34 & 0x20000000) != 0)
  {
    v53 = 2;
  }

  else if ((v34 & 0x40000000) != 0)
  {
    v53 = 3;
  }

  else
  {
    v53 = 0;
  }

  HIDWORD(v459) = (v34 & 0x100000000) == 0;
  v570 = v34 & 0x60000100000;
  LODWORD(v517) = (v34 & 0x60001100000) == 0;
  v61 = v34 & 0x100;
  if ((v34 & 0x100) != 0)
  {
    v62 = v53;
  }

  else
  {
    v62 = 0;
  }

  HIDWORD(v447) = v62;
  v63 = v62 != 0;
  v550 = v34;
  LODWORD(v582) = v53;
  if ((v34 & 0x100000040) == 0x100000000 || (v34 & 0x200000000) != 0)
  {
    [v38 portType];
    LODWORD(v463) = [objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:"intValue"")];
  }

  else
  {
    LODWORD(v463) = -1;
  }

  obj = [MEMORY[0x1E695DF70] array];
  v637 = 0;
  v636 = 0;
  v64 = OUTLINED_FUNCTION_44();
  v68 = [(BWFigVideoCaptureDevice *)v64 _ubEnabledOutputsForCaptureFlags:v65 captureType:SHIDWORD(v569) baseCaptureFrameFlagsOut:v66 discardCaptureFrameFlagsOut:v67];
  v594 = v68;
  if (v68)
  {
    v69 = ([v68 intValue] >> 1) & 1;
  }

  else
  {
    v69 = 1;
  }

  HIDWORD(v553) = v69;
  v70 = v497 & 0xC;
  v471 = v34 & 0x400000;
  LODWORD(v447) = *&v63 & (v34 >> 25);
  v451 = v36;
  if ((v34 & 0x8000) != 0)
  {
    HIDWORD(v538) = [objc_msgSend(objc_msgSend(v38 "stream")];
  }

  else
  {
    HIDWORD(v538) = 0;
  }

  v71 = v34 & 0x400000;
  if (v471 | v70)
  {
    v72 = 0;
  }

  else
  {
    v72 = (v34 & 0x60000100000) == 0;
  }

  if (HIDWORD(v569) != 10)
  {
    v72 = 0;
  }

  HIDWORD(v467) = v72;
  [v493 gain];
  v490 = v38;
  v541 = [v38 noiseReductionAndSharpeningConfigurationForType:1 gain:(v34 >> 4) & 1 qSub:?];
  v580 = (v34 >> 25) & 1;
  v501 = v471 >> 22;
  if (!HIDWORD(v553))
  {
    v455 = 0;
    v478 = 0;
    v523 = 0;
LABEL_62:
    v71 = [(BWFigVideoCaptureDevice *)v584 _ubEVZeroCountForCaptureType:v497 sceneFlags:v34 captureFlags:v493 frameStatistics:?];
    if ((v34 & 0x100000000) != 0)
    {
      v73 = HIDWORD(v569);
      goto LABEL_64;
    }

    if ((v34 & 0x80) == 0)
    {
      v73 = HIDWORD(v569);
      v74 = HIDWORD(v569) != 1;
      goto LABEL_80;
    }

    v73 = HIDWORD(v569);
LABEL_78:
    if ((v34 & 0x10000000000) != 0)
    {
      goto LABEL_366;
    }

    v74 = (v570 != 0) | *(v584 + 1568);
LABEL_80:
    if (v74 & v51)
    {
      goto LABEL_366;
    }

LABEL_81:
    v632 = 0u;
    v633 = 0u;
    v77 = *(v584 + 3496);
    v78 = *v35;
    v634 = 0u;
    *&v635[0].value = v78;
    v635[0].epoch = *(v35 + 2);
    HIDWORD(v443) = v71;
    v79 = v73;
    v80 = [(BWFigVideoCaptureDevice *)v584 _ubZeroShutterLagFrameSelectionForCaptureType:v73 captureFlags:v34 captureParameters:v50 timeMachineFrameMetadata:v77 mainFrameCount:v71 userInitiatedRequestPTS:&v635[0].value, &v632];
    v81 = v34;
    v82 = v474;
    if (v474)
    {
      portType2 = [v38 portType];
      v116 = [*(v584 + 3496) objectAtIndexedSubscript:SDWORD2(v634)];
      v117 = portType2;
      v34 = v550;
      v118 = [(BWFigVideoCaptureDevice *)v584 _ubAWBReflowEnabledForCaptureType:v79 primaryPortType:v117 frameStatisticsByPortType:v505 previewMetadata:v116];
      v82 = v474;
      v81 = v550 | 0x8000000000;
      if (!v118)
      {
        v81 = v550;
      }
    }

    v544 = v81;
    v83 = SDWORD2(v633);
    v84 = SHIDWORD(v633);
    v588 = v634;
    v591 = SDWORD1(v634);
    v85 = v634;
    v86 = off_1E798C7A0;
    if (v79 == 1 && !v570)
    {
      v37 = v584;
      if (SHIDWORD(v633) >= 1)
      {
        v87 = SHIDWORD(v633) + SDWORD2(v633);
        v88 = *off_1E798C698;
        v89 = *off_1E798C608;
        v560 = *off_1E798B378;
        v90 = -v634;
        v91 = *off_1E798C658;
        do
        {
          if ([*(v37 + 3496) count] <= v83)
          {
            v92 = 0;
          }

          else
          {
            v92 = [*(v37 + 3496) objectAtIndexedSubscript:v83];
          }

          v94 = v588 <= v83 && v90 + v83 < v591;
          dictionary5 = [MEMORY[0x1E695DF90] dictionary];
          [MEMORY[0x1E696AD98] numberWithInt:v83];
          [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
          [dictionary5 setObject:&unk_1F22469D8 forKeyedSubscript:v88];
          [dictionary5 setObject:v594 forKeyedSubscript:v89];
          if (HIDWORD(v553))
          {
            v96 = (v497 >> 7) & 1;
            if (v92)
            {
              v96 = [objc_msgSend(v92 objectForKeyedSubscript:{v560), "BOOLValue"}];
            }

            [MEMORY[0x1E696AD98] numberWithBool:v96];
            [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
            [MEMORY[0x1E696AD98] numberWithInt:v582];
            [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
            [MEMORY[0x1E696AD98] numberWithBool:v580];
            [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
            [MEMORY[0x1E696AD98] numberWithBool:HIDWORD(v538)];
            [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
            [dictionary5 setObject:v541 forKeyedSubscript:v91];
            [(BWFigVideoCaptureDevice *)v584 _ubAddFrameParametersForDepthIfNeeded:dictionary5 captureFlags:v544];
          }

          [array addObject:dictionary5];
          v97 = &v636;
          if (v94)
          {
            v97 = &v637;
          }

          v98 = v83 != DWORD2(v634) || (v550 & 0x80) == 0;
          v99 = *v97;
          v100 = 18;
          if (v98)
          {
            v100 = 2;
          }

          [obj addObject:{+[BWStillImageCaptureTimeMachineFrameInfo infoWithTimeMachineIndex:mainFlags:sifrFlags:](BWStillImageCaptureTimeMachineFrameInfo, "infoWithTimeMachineIndex:mainFlags:sifrFlags:", v83++, v100 | v99, 0)}];
          v37 = v584;
        }

        while (v83 < v87);
      }

      if (v474)
      {
        v38 = v490;
        v101 = array;
        v102 = array2;
        v103 = obj;
        p_cache = (&OBJC_METACLASS___BWEspressoInferenceAdapter + 16);
        if (*(v37 + 2242) == 1)
        {
          v299 = -[BWFigVideoCaptureDevice _ubWhiteBalanceMetadataByPortTypeFromMetadata:](v37, [*(v37 + 3496) objectAtIndexedSubscript:{SDWORD2(v634), v80}]);
          [OUTLINED_FUNCTION_271(v299 v300];
        }

        v530 = 0;
        v564 = 0;
        goto LABEL_224;
      }

      v530 = 0;
      v564 = 0;
      v38 = v490;
      v101 = array;
      v102 = array2;
LABEL_109:
      v103 = obj;
      goto LABEL_223;
    }

    if (v61 | v82 | v471)
    {
      v104 = 0;
    }

    else
    {
      v104 = v79 == 10;
    }

    v105 = !v104 || v582 == 0;
    v106 = !v105;
    LODWORD(v574) = v106;
    v37 = v584;
    if (v105)
    {
      v112 = 0;
      v113 = -1;
      if (!v82 && v79 == 12)
      {
        if (v570)
        {
          if (SHIDWORD(v443) >= 3)
          {
            v113 = v634 + DWORD1(v634) - 1;
            v112 = 0;
            if (DWORD2(v634) != v634)
            {
              if (v113 == DWORD2(v634))
              {
                v113 = v634;
              }

              else if (v113 - DWORD2(v634) <= DWORD2(v634) - v634)
              {
                v113 = v634;
              }
            }
          }
        }
      }
    }

    else
    {
      v630[0] = *off_1E798C7A0;
      v107 = [OUTLINED_FUNCTION_208() numberWithInt:DWORD2(v634)];
      v108 = *off_1E798C698;
      v631[0] = v107;
      v631[1] = &unk_1F22469D8;
      v109 = *off_1E798C630;
      v630[1] = v108;
      v630[2] = v109;
      v110 = (v34 & 0x1000000) == 0;
      v34 = v550;
      v631[2] = [*(v79 + 3480) numberWithBool:v110];
      v630[3] = *off_1E798C5F8;
      v111 = [*(v79 + 3480) numberWithBool:HIDWORD(v538)];
      v630[4] = *off_1E798C658;
      v631[3] = v111;
      v631[4] = v541;
      v112 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v631 forKeys:v630 count:5];
      v113 = -1;
    }

    v435 = v112;
    v520 = v84;
    if (v84 >= 1)
    {
      v585 = *off_1E798C7A0;
      v119 = *off_1E798C698;
      v514 = *off_1E798C630;
      v559 = *off_1E798C690;
      v534 = *off_1E798C668;
      v121 = (v544 & 0x100000) == 0 || HIDWORD(v569) != 13;
      LODWORD(v511) = v121;
      v531 = *off_1E798C5F8;
      v526 = *off_1E798C658;
      v122 = 20;
      if ((v34 & 0x20000000000) == 0)
      {
        v122 = 4;
      }

      v563 = v122;
      v508 = v113;
      v571 = -v85;
      v482 = *off_1E798C640;
      v486 = *off_1E798C620;
      for (i = v83; i < SHIDWORD(v633) + SDWORD2(v633); ++i)
      {
        v86 = DWORD2(v634);
        dictionary6 = [MEMORY[0x1E695DF90] dictionary];
        [MEMORY[0x1E696AD98] numberWithInt:i];
        [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
        [dictionary6 setObject:&unk_1F22469D8 forKeyedSubscript:v119];
        OUTLINED_FUNCTION_372(dictionary6, v125, v126, v127, v128, v129, v130, v131, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505, v508, v511, v514, v517, v520, v523, v526, v531, v534, v538, v541, v544, array, v550, v553, v556, v559, v563, dictionary4, dictionary3, dictionary2, dictionary, v569, v570, v571, v574, array2, obj, v580, v582, v584, v585, v588);
        if (HIDWORD(v553))
        {
          if (v508 == i)
          {
            v132 = 1;
          }

          else
          {
            v132 = v517;
          }

          [MEMORY[0x1E696AD98] numberWithBool:v132];
          [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
          [MEMORY[0x1E696AD98] numberWithInt:v582];
          [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
          [MEMORY[0x1E696AD98] numberWithBool:v580];
          [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
          [MEMORY[0x1E696AD98] numberWithBool:HIDWORD(v538)];
          [OUTLINED_FUNCTION_37_0() setObject:? forKeyedSubscript:?];
          [dictionary6 setObject:v523 forKeyedSubscript:v526];
          if (i != v86)
          {
            dictionary7 = 0;
            goto LABEL_165;
          }

          if ((v34 & 0x10000000) != 0)
          {
            [dictionary6 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v486];
            [dictionary6 setObject:&unk_1F22469D8 forKeyedSubscript:v482];
          }

          [(BWFigVideoCaptureDevice *)v37 _ubAddFrameParametersForDepthIfNeeded:dictionary6 captureFlags:v544];
        }

        dictionary7 = 0;
        if (v570 && i == v86)
        {
          dictionary7 = [MEMORY[0x1E695DF90] dictionary];
          [MEMORY[0x1E696AD98] numberWithInt:HIDWORD(v634)];
          [OUTLINED_FUNCTION_15() setObject:? forKeyedSubscript:?];
          [dictionary7 setObject:&unk_1F22469F0 forKeyedSubscript:v119];
          OUTLINED_FUNCTION_372(dictionary7, v134, v135, v136, v137, v138, v139, v140, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505, v508, v511, v514, v517, v520, v523, v526, v531, v534, v538, v541, v544, array, v550, v553, v556, v559, v563, dictionary4, dictionary3, dictionary2, dictionary, v569, v570, v571, v574, array2, obj, v580, v582, v584, v585, v588);
          if (HIDWORD(v553))
          {
            [dictionary7 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v486];
            [dictionary7 setObject:&unk_1F22469D8 forKeyedSubscript:v482];
            [MEMORY[0x1E696AD98] numberWithInt:v582];
            [OUTLINED_FUNCTION_15() setObject:? forKeyedSubscript:?];
            [MEMORY[0x1E696AD98] numberWithBool:v580];
            [OUTLINED_FUNCTION_15() setObject:? forKeyedSubscript:?];
            [MEMORY[0x1E696AD98] numberWithBool:HIDWORD(v538)];
            [OUTLINED_FUNCTION_15() setObject:? forKeyedSubscript:?];
            [dictionary7 setObject:v478 forKeyedSubscript:v526];
          }

          [(BWFigVideoCaptureDevice *)v37 _ubAddFrameParametersForDepthIfNeeded:dictionary7 captureFlags:v544];
        }

LABEL_165:
        [array count];
        [OUTLINED_FUNCTION_259() insertObject:? atIndex:?];
        if (dictionary7)
        {
          [OUTLINED_FUNCTION_23_12() insertObject:? atIndex:?];
        }

        v142 = v588 > i || v571 + i >= v591;
        v143 = v636;
        if (!v142)
        {
          v143 = v637;
        }

        if (i == v86)
        {
          v34 = v550;
          if ((v550 & 0x20000000000) != 0)
          {
            v144 = 34;
          }

          else
          {
            v144 = 50;
          }
        }

        else
        {
          v34 = v550;
          if ((v511 | v142))
          {
            v145 = v143 | 2;
            goto LABEL_184;
          }

          if (v591 != 2)
          {
            OUTLINED_FUNCTION_64_10();
            os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
            v316 = OUTLINED_FUNCTION_191(os_log_and_send_and_compose_flags_and_os_log_type);
            if (OUTLINED_FUNCTION_5_2(v316))
            {
              v628 = 136315394;
              OUTLINED_FUNCTION_329("[BWFigVideoCaptureDevice _ubStillImageCaptureSettingsWithID:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:deliverOriginalImage:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:]");
              *(v317 + 14) = HIDWORD(v443);
              OUTLINED_FUNCTION_306();
              OUTLINED_FUNCTION_7_4();
              _os_log_send_and_compose_impl();
            }

LABEL_359:
            v38 = v490;
            OUTLINED_FUNCTION_1_4();
            OUTLINED_FUNCTION_16_1();
            goto LABEL_360;
          }

          v144 = 514;
        }

        v145 = v143 | v144;
LABEL_184:
        v146 = SHIDWORD(v634);
        if (i == HIDWORD(v634))
        {
          v147 = v637 | v563;
          if (dictionary7)
          {
            goto LABEL_188;
          }
        }

        else
        {
          [*(v584 + 3496) objectAtIndexedSubscript:i];
          v147 = 0;
          if (dictionary7)
          {
LABEL_188:
            if (v83 > v146 || v146 - v83 >= v520)
            {
              [obj addObject:{+[BWStillImageCaptureTimeMachineFrameInfo infoWithTimeMachineIndex:mainFlags:sifrFlags:](BWStillImageCaptureTimeMachineFrameInfo, "infoWithTimeMachineIndex:mainFlags:sifrFlags:", v146, 0, v637 | v563)}];
            }
          }
        }

        v149 = [BWStillImageCaptureTimeMachineFrameInfo infoWithTimeMachineIndex:i mainFlags:v145 sifrFlags:v147];
        v150 = v149;
        if (i == v86)
        {
          v151 = v574;
        }

        else
        {
          v151 = 0;
        }

        [(BWStillImageCaptureTimeMachineFrameInfo *)v149 setIsNoLongErrorRecoveryFrame:v151];
        [obj addObject:v150];
        v37 = v584;
      }
    }

    v152 = v474;
    if (v474 && *(v37 + 2242) == 1)
    {
      v307 = -[BWFigVideoCaptureDevice _ubWhiteBalanceMetadataByPortTypeFromMetadata:](v37, [*(v37 + 3496) objectAtIndexedSubscript:SDWORD2(v634)]);
      [OUTLINED_FUNCTION_271(v307 v308];
      v152 = v474;
    }

    v101 = array;
    v102 = array2;
    v103 = obj;
    p_cache = (&OBJC_METACLASS___BWEspressoInferenceAdapter + 16);
    if ((v34 & 0x200400000) == 0)
    {
      if (v435)
      {
        [array addObject:?];
      }

      v530 = 0;
      v564 = 0;
      v38 = v490;
      goto LABEL_224;
    }

    v153 = v152;
    dictionary8 = [MEMORY[0x1E695DF90] dictionary];
    v155 = OUTLINED_FUNCTION_249();
    v530 = dictionary8;
    if (v153)
    {
      v169 = 1;
      v170 = [v155 numberWithBool:1];
      v168 = *off_1E798C600;
      [dictionary8 setObject:v170 forKeyedSubscript:*off_1E798C600];
      v157 = *off_1E798C630;
      [dictionary8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C630];
      [dictionary8 setObject:objc_msgSend(v86[435] forKeyedSubscript:{"numberWithBool:", HIDWORD(v538)), *off_1E798C5F8}];
      v158 = *off_1E798C658;
      [dictionary8 setObject:v541 forKeyedSubscript:*off_1E798C658];
      if ((v34 & 0x200000000) != 0)
      {
        [dictionary8 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C5E8];
LABEL_210:
        dictionary9 = [MEMORY[0x1E695DF90] dictionary];
        [dictionary9 setObject:&unk_1F22469D8 forKeyedSubscript:*off_1E798C698];
        [OUTLINED_FUNCTION_132_5() setObject:? forKeyedSubscript:?];
        [dictionary9 setObject:&unk_1F2246990 forKeyedSubscript:*off_1E798C648];
        [dictionary9 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v463), *off_1E798C660}];
        OUTLINED_FUNCTION_372(dictionary9, v172, v173, v174, v175, v176, v177, v178, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505, v508, v511, v514, v517, v520, v523, v526, v530, v534, v538, v541, v544, array, v550, v553, v556, v559, v563, dictionary4, dictionary3, dictionary2, dictionary, v569, v570, v571, v574, array2, obj, v580, v582, v584, v585, v588);
        [dictionary9 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v168];
        if ([v493 hrEnabled] && !objc_msgSend(v530, "objectForKeyedSubscript:", *off_1E798C5E8))
        {
          [dictionary9 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v157];
        }

        [v102 addObject:dictionary9];
        v103 = obj;
        [obj addObject:{+[BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:mainFlags:sifrFlags:](BWStillImageCaptureBracketFrameInfo, "infoWithBracketedCaptureSequenceNumber:mainFlags:sifrFlags:", 1, v637 | 2, 0)}];
        v169 = 2;
        v101 = array;
        goto LABEL_216;
      }

      v103 = obj;
    }

    else
    {
      v156 = [v155 numberWithBool:(v34 & 0x1000000) == 0];
      v157 = *off_1E798C630;
      [dictionary8 setObject:v156 forKeyedSubscript:*off_1E798C630];
      [dictionary8 setObject:objc_msgSend(v86[435] forKeyedSubscript:{"numberWithInt:", HIDWORD(v447)), *off_1E798C690}];
      [dictionary8 setObject:objc_msgSend(v86[435] forKeyedSubscript:{"numberWithInt:", v447), *off_1E798C668}];
      [dictionary8 setObject:objc_msgSend(v86[435] forKeyedSubscript:{"numberWithBool:", HIDWORD(v538)), *off_1E798C5F8}];
      v158 = *off_1E798C658;
      [dictionary8 setObject:v541 forKeyedSubscript:*off_1E798C658];
      OUTLINED_FUNCTION_372(dictionary8, v159, v160, v161, v162, v163, v164, v165, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505, v508, v511, v514, v517, v520, v523, v526, dictionary8, v534, v538, v541, v544, array, v550, v553, v556, v559, v563, dictionary4, dictionary3, dictionary2, dictionary, v569, v570, v571, v574, array2, obj, v580, v582, v584, v585, v588);
      OUTLINED_FUNCTION_375(BWStillImageCaptureBracketFrameInfo, v166, v167, v637 | 0x20);
      [OUTLINED_FUNCTION_28() addObject:?];
      if ((v34 & 0x200000000) != 0)
      {
        v168 = *off_1E798C600;
        goto LABEL_210;
      }

      v169 = 1;
    }

LABEL_216:
    v38 = v490;
    if (!v471)
    {
      v564 = 0;
      goto LABEL_223;
    }

    v179 = v637;
    dictionary10 = [MEMORY[0x1E695DF90] dictionary];
    [dictionary10 setObject:&unk_1F22469D8 forKeyedSubscript:*off_1E798C698];
    [dictionary10 setObject:&unk_1F22469F0 forKeyedSubscript:*off_1E798C918];
    [dictionary10 setObject:&unk_1F2246990 forKeyedSubscript:*off_1E798C648];
    [OUTLINED_FUNCTION_350() setObject:? forKeyedSubscript:?];
    if (HIDWORD(v553))
    {
      [dictionary10 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v582), *off_1E798C690}];
      [dictionary10 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", v580), *off_1E798C668}];
      [MEMORY[0x1E696AD98] numberWithBool:HIDWORD(v538)];
      [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
      [dictionary10 setObject:v455 forKeyedSubscript:v158];
    }

    if (v501)
    {
      do
      {
        [v102 addObject:dictionary10];
        [BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:v169 mainFlags:v179 | 8 sifrFlags:0];
        [OUTLINED_FUNCTION_4() addObject:?];
        v169 = (v169 + 1);
      }

      while (v501 != 1);
      v564 = 0;
      v103 = obj;
      goto LABEL_223;
    }

    v564 = 0;
    goto LABEL_109;
  }

  if (HIDWORD(v569) != 1)
  {
    if (HIDWORD(v569) == 13)
    {
      OUTLINED_FUNCTION_64_10();
      v319 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      v320 = OUTLINED_FUNCTION_191(v319);
      if (OUTLINED_FUNCTION_5_2(v320))
      {
        v628 = 136315138;
        v629 = "[BWFigVideoCaptureDevice _ubStillImageCaptureSettingsWithID:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:deliverOriginalImage:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:]";
        OUTLINED_FUNCTION_43_0();
        OUTLINED_FUNCTION_7_4();
        _os_log_send_and_compose_impl();
      }

      v37 = v584;
      OUTLINED_FUNCTION_8_1();
      OUTLINED_FUNCTION_16_1();
      LOWORD(v635[0].value) = 0;
      OUTLINED_FUNCTION_5_61();
      v322 = _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_11();
      OUTLINED_FUNCTION_10();
      FigCapturePleaseFileRadar(v323, v324, v325, v326, v327, 20391, v328, v329, v635);
      free(v322);
      goto LABEL_360;
    }

    if (HIDWORD(v467))
    {
      [v493 gain];
      v523 = [v38 noiseReductionAndSharpeningConfigurationForType:10 gain:?];
      v455 = 0;
      v478 = 0;
    }

    else
    {
      if (HIDWORD(v569) == 12)
      {
        [v493 gain];
        v523 = [v38 noiseReductionAndSharpeningConfigurationForType:20 gain:?];
        [v493 gain];
        v478 = [v38 noiseReductionAndSharpeningConfigurationForType:21 gain:?];
        [v493 gain];
        v75 = v38;
        v76 = 22;
      }

      else
      {
        [v493 gain];
        if (v582)
        {
          v523 = [v38 noiseReductionAndSharpeningConfigurationForType:11 gain:?];
          [v493 gain];
          v478 = [v38 noiseReductionAndSharpeningConfigurationForType:12 gain:?];
          [v493 gain];
          v75 = v38;
          v76 = 13;
        }

        else
        {
          v523 = [v38 noiseReductionAndSharpeningConfigurationForType:14 gain:?];
          [v493 gain];
          v478 = [v38 noiseReductionAndSharpeningConfigurationForType:15 gain:?];
          [v493 gain];
          v75 = v38;
          v76 = 16;
        }
      }

      v455 = [v75 noiseReductionAndSharpeningConfigurationForType:v76 gain:?];
    }

    goto LABEL_62;
  }

  if ((v34 & 0x80) != 0)
  {
    v71 = v493;
    [v493 gain];
    v541 = [v38 noiseReductionAndSharpeningConfigurationForType:30 gain:?];
    [(BWFigVideoCaptureDevice *)v584 _ubEVZeroCountForCaptureType:v497 sceneFlags:v34 captureFlags:v493 frameStatistics:?];
    OUTLINED_FUNCTION_241();
    if ((v34 & 0x100000000) == 0)
    {
      goto LABEL_78;
    }
  }

  else
  {
    [(BWFigVideoCaptureDevice *)v584 _ubEVZeroCountForCaptureType:v497 sceneFlags:v34 captureFlags:v493 frameStatistics:?];
    OUTLINED_FUNCTION_241();
    if ((v34 & 0x100000000) == 0)
    {
      goto LABEL_81;
    }
  }

LABEL_64:
  if ((v463 & 0x80000000) != 0)
  {
    goto LABEL_81;
  }

LABEL_366:
  v101 = array;
  [array removeAllObjects];
  [array2 removeAllObjects];
  v544 = v34;
  if (v474)
  {
    v381 = -[BWFigVideoCaptureDevice _ubAWBReflowEnabledForCaptureType:primaryPortType:frameStatisticsByPortType:previewMetadata:](v584, HIDWORD(v569), [v38 portType], v505, 0);
    v382 = v34 | 0x8000000000;
    if (!v381)
    {
      v382 = v34;
    }

    v544 = v382;
  }

  p_cache = (&OBJC_METACLASS___BWEspressoInferenceAdapter + 16);
  v575 = v71 > 1;
  if (HIDWORD(v569) == 12 && (v34 & 0x100000000) != 0 && v71 >= 2)
  {
    if (*(v584 + 2242))
    {
      v318 = 1;
      v573 = 1;
      goto LABEL_384;
    }

    goto LABEL_375;
  }

  if (HIDWORD(v569) == 12)
  {
LABEL_375:
    deepFusionBracketedCaptureReferenceFrameIndex = [v50 deepFusionBracketedCaptureReferenceFrameIndex];
    goto LABEL_379;
  }

  deepFusionBracketedCaptureReferenceFrameIndex = 1;
LABEL_379:
  v573 = 0;
  if (deepFusionBracketedCaptureReferenceFrameIndex <= 1)
  {
    v318 = 1;
  }

  else
  {
    v318 = deepFusionBracketedCaptureReferenceFrameIndex;
  }

  if (v318 >= v71)
  {
    v318 = v71;
  }

LABEL_384:
  v564 = v318;
  dictionary11 = [MEMORY[0x1E695DF90] dictionary];
  if (v474)
  {
    v336 = (v544 & 0x800) == 0 || *(v584 + 1560) == 0;
    v564 -= v336;
    [dictionary11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", v336), *off_1E798C600}];
    v534 = *off_1E798C630;
    [dictionary11 setObject:MEMORY[0x1E695E118] forKeyedSubscript:?];
    if (v336)
    {
      [dictionary11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", HIDWORD(v538)), *off_1E798C5F8}];
      [dictionary11 setObject:v541 forKeyedSubscript:*off_1E798C658];
      v337 = 0;
      goto LABEL_396;
    }

    [OUTLINED_FUNCTION_350() setObject:? forKeyedSubscript:?];
    v334 = v636;
  }

  else
  {
    v331 = [MEMORY[0x1E696AD98] numberWithBool:(v34 & 0x1000000) == 0];
    v534 = *off_1E798C630;
    [dictionary11 setObject:v331 forKeyedSubscript:?];
    [dictionary11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", HIDWORD(v447)), *off_1E798C690}];
    [dictionary11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v447), *off_1E798C668}];
    [dictionary11 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", HIDWORD(v538)), *off_1E798C5F8}];
    [dictionary11 setObject:v541 forKeyedSubscript:*off_1E798C658];
    [OUTLINED_FUNCTION_350() setObject:? forKeyedSubscript:?];
    v334 = v637 | 0x20;
  }

  OUTLINED_FUNCTION_375(BWStillImageCaptureBracketFrameInfo, v332, v333, v334);
  [OUTLINED_FUNCTION_28() addObject:?];
  v337 = 1;
LABEL_396:
  v530 = dictionary11;
  [(BWFigVideoCaptureDevice *)v584 _ubAddFrameParametersForDepthIfNeeded:dictionary11 captureFlags:v544];
  if (v71 < 1)
  {
    v342 = 1;
    goto LABEL_462;
  }

  dictionary12 = [MEMORY[0x1E695DF90] dictionary];
  v562 = *off_1E798C698;
  [dictionary12 setObject:&unk_1F22469D8 forKeyedSubscript:?];
  v529 = *off_1E798C918;
  [dictionary12 setObject:&unk_1F22469D8 forKeyedSubscript:?];
  v339 = *off_1E798C648;
  [dictionary12 setObject:&unk_1F2246990 forKeyedSubscript:*off_1E798C648];
  [dictionary12 setObject:v594 forKeyedSubscript:*off_1E798C608];
  if ((v550 & 0x100000000) != 0)
  {
    [dictionary12 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v463), *off_1E798C660}];
    if ((v550 & 0x80) == 0)
    {
      goto LABEL_412;
    }

    v340 = MEMORY[0x1E696AD98];
    [v50 learnedNRUltraHighResolutionExposureBias];
    v341 = [v340 numberWithFloat:?];
LABEL_405:
    [dictionary12 setObject:v341 forKeyedSubscript:v339];
    if (([v493 hrEnabled] & 1) == 0)
    {
      goto LABEL_412;
    }

LABEL_411:
    LODWORD(v343) = *off_1E798C5D8;
    [dictionary12 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithFloat:", v343), *off_1E798C670}];
    [dictionary12 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v534];
    goto LABEL_412;
  }

  if (v550 & 0x80) != 0 && !v570 && (*(v584 + 1568))
  {
    v341 = &unk_1F224A970;
    goto LABEL_405;
  }

  if (HIDWORD(v553))
  {
    [dictionary12 setObject:objc_msgSend(OUTLINED_FUNCTION_301() forKeyedSubscript:{"numberWithInt:", v582), *off_1E798C690}];
    [dictionary12 setObject:objc_msgSend(*(v550 + 3480) forKeyedSubscript:{"numberWithBool:", v580), *off_1E798C668}];
    [dictionary12 setObject:objc_msgSend(*(v550 + 3480) forKeyedSubscript:{"numberWithBool:", HIDWORD(v538)), *off_1E798C5F8}];
    [dictionary12 setObject:v523 forKeyedSubscript:*off_1E798C658];
  }

  if (v517 && [v493 hrEnabled])
  {
    goto LABEL_411;
  }

LABEL_412:
  v587 = dictionary12;
  v344 = [MEMORY[0x1E695DF90] dictionaryWithDictionary:dictionary12];
  v345 = v584;
  v590 = v344;
  [(BWFigVideoCaptureDevice *)v584 _ubAddFrameParametersForDepthIfNeeded:v344 captureFlags:v544];
  if (!HIDWORD(v553))
  {
    goto LABEL_416;
  }

  if ((v550 & 0x60012100000) != 0x2000000)
  {
    if ((v550 & 0x10000000) == 0)
    {
      goto LABEL_416;
    }

    goto LABEL_415;
  }

  HIDWORD(v443) = v71;
  portType3 = [v38 portType];
  OUTLINED_FUNCTION_376(portType3, v384, v385, v386, v387, v388, v389, v390, v424, v428, v431, v435, v439, v443, v447, v36, v455, v459, v463, v467, v471, v474, v478, v482, v486, v38, v493, v497, v501, v505);
  v391 = OUTLINED_FUNCTION_7();
  v393 = [(BWFigVideoCaptureDevice *)v391 _ubGenerateLTMCurveForCaptureStream:v38 frameStatistics:v392];
  if ((v544 & 0x800) == 0 || *(v584 + 3447) != 1 || [a25 count])
  {
    *&v394 = OUTLINED_FUNCTION_269();
    v395[85] = v394;
    v395[84] = v394;
    v395[83] = v394;
    v395[82] = v394;
    v402 = OUTLINED_FUNCTION_280(v396, v397, v626, v625, v398, v399, v400, v401, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505, v508, v511, v514, v517, v520, v523, v529, v530, v534, v538, v541, v544, array, v550, v553, v556);
    if (v402)
    {
      v403 = v402;
      do
      {
        v404 = 0;
        do
        {
          OUTLINED_FUNCTION_49_7();
          if (!v98)
          {
            objc_enumerationMutation(v556);
          }

          if (v393)
          {
            v393 = 1;
          }

          else
          {
            v411 = *(v627 + 8 * v404);
            portType4 = [v411 portType];
            v420 = OUTLINED_FUNCTION_376(portType4, v413, v414, v415, v416, v417, v418, v419, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505);
            v405 = [(BWFigVideoCaptureDevice *)v584 _ubGenerateLTMCurveForCaptureStream:v411 frameStatistics:v420];
            v393 = v405;
          }

          ++v404;
        }

        while (v403 != v404);
        v421 = OUTLINED_FUNCTION_280(v405, v406, v626, v625, v407, v408, v409, v410, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505, v508, v511, v514, v517, v520, v523, v529, v530, v534, v538, v541, v544, array, v550, v553, v556);
        v403 = v421;
      }

      while (v421);
    }
  }

  if (v393 || (*(v584 + 1568) != 1 ? (v422 = 1) : (v422 = *(v584 + 4300) != 0.0), *(v584 + 648) && v70 && (*(v584 + 704) & v422 & 1) != 0 && ([v490 portType], objc_msgSend(*(v584 + 600), "portType"), (objc_msgSend(OUTLINED_FUNCTION_8(), "isEqual:") & 1) == 0)))
  {
    v544 |= 0x10000000uLL;
    v345 = v584;
    v71 = HIDWORD(v443);
LABEL_415:
    [v590 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C620];
    [v590 setObject:&unk_1F22469D8 forKeyedSubscript:*off_1E798C640];
    goto LABEL_416;
  }

  v345 = v584;
  v71 = HIDWORD(v443);
LABEL_416:
  if (v570)
  {
    dictionary13 = [MEMORY[0x1E695DF90] dictionary];
    v347 = *(v345 + 1560);
    [dictionary13 setObject:&unk_1F22469D8 forKeyedSubscript:v529];
    [OUTLINED_FUNCTION_350() setObject:? forKeyedSubscript:?];
    if (*(v345 + 2183) == 1 && ((~v544 & 0x1800) != 0 || !v347))
    {
      [dictionary13 setObject:&unk_1F22469F0 forKeyedSubscript:v562];
      LODWORD(v355) = *off_1E798C5D8;
      v348 = [MEMORY[0x1E696AD98] numberWithFloat:v355];
      v350 = *off_1E798C670;
      v349 = dictionary13;
    }

    else
    {
      [dictionary13 setObject:&unk_1F22469D8 forKeyedSubscript:v562];
      v348 = &unk_1F2246A08;
      v349 = dictionary13;
      v350 = v339;
    }

    [v349 setObject:v348 forKeyedSubscript:v350];
    if ((v550 & 0x100000000) != 0)
    {
      v356 = [MEMORY[0x1E696AD98] numberWithInt:v463];
      v357 = off_1E798C660;
      v354 = v573;
    }

    else
    {
      v354 = v573;
      if (!HIDWORD(v553))
      {
LABEL_428:
        if ((v544 & 0x1000) != 0)
        {
          [(BWFigVideoCaptureDevice *)v584 _ubAddFrameParametersForDepthIfNeeded:dictionary13 captureFlags:v544];
        }

        v38 = v490;
        v352 = HIDWORD(v569);
        v353 = v474;
        v351 = v575;
        goto LABEL_431;
      }

      [dictionary13 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v582), *off_1E798C690}];
      [dictionary13 setObject:MEMORY[0x1E695E118] forKeyedSubscript:*off_1E798C620];
      [dictionary13 setObject:&unk_1F22469D8 forKeyedSubscript:*off_1E798C640];
      [dictionary13 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", v580), *off_1E798C668}];
      [dictionary13 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithBool:", HIDWORD(v538)), *off_1E798C5F8}];
      v357 = off_1E798C658;
      v356 = v478;
    }

    [dictionary13 setObject:v356 forKeyedSubscript:*v357];
    goto LABEL_428;
  }

  v351 = 0;
  dictionary13 = 0;
  v38 = v490;
  v352 = HIDWORD(v569);
  v353 = v474;
  v354 = v573;
LABEL_431:
  v358 = v352 == 12 && v351;
  if (v353)
  {
    v358 = 0;
  }

  v593 = v358;
  if ((v564 - 1) > (v71 - v564))
  {
    v359 = 1;
  }

  else
  {
    v359 = v71;
  }

  v576 = v359;
  v360 = v71 + v337;
  if (v337)
  {
    v361 = 3;
  }

  else
  {
    v361 = 2;
  }

  v362 = *off_1E798C5D8;
  v526 = *off_1E798C670;
  v342 = 1;
  do
  {
    v363 = 48;
    if (v564 != v337)
    {
      v363 = 0;
    }

    if ((v354 & (v337 < v361)) != 0)
    {
      v364 = 256;
    }

    else
    {
      v364 = v363;
    }

    v365 = v637 | v364 | 2;
    if (v564 != v337)
    {
      v371 = v593;
      if (v576 != v337)
      {
        v371 = 0;
      }

      if (v371 == 1)
      {
        v372 = [MEMORY[0x1E695DF90] dictionaryWithDictionary:v587];
        LODWORD(v373) = v362;
        [MEMORY[0x1E696AD98] numberWithFloat:v373];
        [OUTLINED_FUNCTION_36() setObject:? forKeyedSubscript:?];
        [v372 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v534];
      }

      else
      {
        v372 = v587;
      }

      [array2 addObject:v372];
LABEL_455:
      v370 = OUTLINED_FUNCTION_373(BWStillImageCaptureBracketFrameInfo, v366, v342);
      v342 = (v342 + 1);
      goto LABEL_458;
    }

    [array2 addObject:v590];
    if (!dictionary13)
    {
      goto LABEL_455;
    }

    v367 = v637;
    [array2 addObject:dictionary13];
    v369 = (v342 + 1);
    if ([objc_msgSend(dictionary13 objectForKeyedSubscript:{v562), "intValue"}] == 1)
    {
      v370 = [BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:v342 mainFlags:v365 sifrFlags:v367 | 4];
      v342 = (v342 + 1);
    }

    else
    {
      [obj addObject:{OUTLINED_FUNCTION_373(BWStillImageCaptureBracketFrameInfo, v368, v342)}];
      v342 = (v342 + 2);
      v370 = [BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:v369 mainFlags:v367 | 4 sifrFlags:0];
    }

    v38 = v490;
    v354 = v573;
LABEL_458:
    [obj addObject:v370];
    ++v337;
    v101 = array;
  }

  while (v337 < v360);
  v374 = v564;
  if (v354)
  {
    v374 = -1;
  }

  v564 = v374;
  p_cache = &OBJC_METACLASS___BWEspressoInferenceAdapter.cache;
LABEL_462:
  v37 = v584;
  v102 = array2;
  v103 = obj;
  if ((v550 & 0x200000000) != 0)
  {
    dictionary14 = [MEMORY[0x1E695DF90] dictionary];
    [dictionary14 setObject:&unk_1F22469D8 forKeyedSubscript:*off_1E798C698];
    [OUTLINED_FUNCTION_40() setObject:? forKeyedSubscript:?];
    [dictionary14 setObject:&unk_1F2246990 forKeyedSubscript:*off_1E798C648];
    [dictionary14 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithInt:", v463), *off_1E798C660}];
    [dictionary14 setObject:v594 forKeyedSubscript:*off_1E798C608];
    if ([v493 hrEnabled])
    {
      LODWORD(v376) = *off_1E798C5D8;
      [dictionary14 setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithFloat:", v376), *off_1E798C670}];
      [dictionary14 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v534];
    }

    [array2 addObject:dictionary14];
    [BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:v342 mainFlags:v637 | 2 sifrFlags:0];
    [OUTLINED_FUNCTION_28() addObject:?];
    v342 = (v342 + 1);
  }

  if (v471)
  {
    v377 = v637;
    dictionary15 = [MEMORY[0x1E695DF90] dictionary];
    [dictionary15 setObject:&unk_1F22469D8 forKeyedSubscript:*off_1E798C698];
    [dictionary15 setObject:&unk_1F22469F0 forKeyedSubscript:*off_1E798C918];
    [dictionary15 setObject:&unk_1F2246990 forKeyedSubscript:*off_1E798C648];
    [dictionary15 setObject:v594 forKeyedSubscript:*off_1E798C608];
    if ((v550 & 0x100000000) != 0)
    {
      v379 = [MEMORY[0x1E696AD98] numberWithInt:v463];
      v380 = off_1E798C660;
      goto LABEL_471;
    }

    if (HIDWORD(v553))
    {
      [dictionary15 setObject:objc_msgSend(OUTLINED_FUNCTION_208() forKeyedSubscript:{"numberWithInt:", v582), *off_1E798C690}];
      [dictionary15 setObject:objc_msgSend(p_cache[435] forKeyedSubscript:{"numberWithBool:", v580), *off_1E798C668}];
      [dictionary15 setObject:objc_msgSend(p_cache[435] forKeyedSubscript:{"numberWithBool:", HIDWORD(v538)), *off_1E798C5F8}];
      v380 = off_1E798C658;
      v379 = v455;
LABEL_471:
      [dictionary15 setObject:v379 forKeyedSubscript:*v380];
    }

    if (v501)
    {
      [array2 addObject:dictionary15];
      [BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:v342 mainFlags:v377 | 8 sifrFlags:0];
      [OUTLINED_FUNCTION_28() addObject:?];
    }

LABEL_223:
    p_cache = &OBJC_METACLASS___BWEspressoInferenceAdapter.cache;
  }

LABEL_224:
  array3 = v103;
  if (HIDWORD(v463))
  {
    array3 = [MEMORY[0x1E695DF70] array];
    *&v181 = OUTLINED_FUNCTION_269();
    v182[70] = v181;
    v182[71] = v181;
    v182[72] = v181;
    v182[73] = v181;
    if (OUTLINED_FUNCTION_1_0(v183, v184, v623, v622))
    {
      while (2)
      {
        OUTLINED_FUNCTION_21_20();
        if (!v98)
        {
          objc_enumerationMutation(obj);
        }

        v185 = *v624;
        v186 = v636;
        objc_opt_class();
        OUTLINED_FUNCTION_10_29();
        if (objc_opt_isKindOfClass())
        {
          [v185 timeMachineIndex];
          [OUTLINED_FUNCTION_7() infoWithTimeMachineIndex:? mainFlags:? sifrFlags:?];
          [OUTLINED_FUNCTION_18_0() isNoLongErrorRecoveryFrame];
          [OUTLINED_FUNCTION_8() setIsNoLongErrorRecoveryFrame:?];
          goto LABEL_232;
        }

        objc_opt_class();
        OUTLINED_FUNCTION_10_29();
        if (objc_opt_isKindOfClass())
        {
          [v185 bracketedCaptureSequenceNumber];
          v186 = [OUTLINED_FUNCTION_7() infoWithBracketedCaptureSequenceNumber:? mainFlags:? sifrFlags:?];
LABEL_232:
          [array3 addObject:v186];
          p_cache = (&OBJC_METACLASS___BWEspressoInferenceAdapter + 16);
        }

        OUTLINED_FUNCTION_335();
        if (v98 && ![obj countByEnumeratingWithState:v623 objects:v622 count:16])
        {
          v103 = obj;
          break;
        }

        continue;
      }
    }
  }

  if (!v467)
  {
    goto LABEL_255;
  }

  array4 = [MEMORY[0x1E695DF70] array];
  *&v188 = OUTLINED_FUNCTION_269();
  v189[58] = v188;
  v189[59] = v188;
  v189[60] = v188;
  v189[61] = v188;
  v192 = OUTLINED_FUNCTION_1_0(v190, v191, v620, v619);
  if (v192)
  {
    v193 = v192;
    while (1)
    {
      for (j = 0; j != v193; ++j)
      {
        OUTLINED_FUNCTION_30_6();
        if (!v98)
        {
          objc_enumerationMutation(v103);
        }

        v195 = *(v621 + 8 * j);
        mainFlags = [v195 mainFlags];
        if ((mainFlags & 0x10) != 0)
        {
          p_cache = mainFlags;
        }

        else
        {
          p_cache = v636;
        }

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [v195 timeMachineIndex];
          [v195 sifrFlags];
          [OUTLINED_FUNCTION_294() infoWithTimeMachineIndex:? mainFlags:? sifrFlags:?];
          [OUTLINED_FUNCTION_25_0() isNoLongErrorRecoveryFrame];
          [OUTLINED_FUNCTION_7() setIsNoLongErrorRecoveryFrame:?];
        }

        else
        {
          objc_opt_class();
          isKindOfClass = objc_opt_isKindOfClass();
          if ((isKindOfClass & 1) == 0)
          {
            continue;
          }

          [v195 bracketedCaptureSequenceNumber];
          [v195 sifrFlags];
          p_cache = [OUTLINED_FUNCTION_294() infoWithBracketedCaptureSequenceNumber:? mainFlags:? sifrFlags:?];
        }

        isKindOfClass = [OUTLINED_FUNCTION_118_0() addObject:?];
        v103 = obj;
      }

      v193 = OUTLINED_FUNCTION_1_0(isKindOfClass, v198, v620, v619);
      if (!v193)
      {
        v103 = array4;
        v38 = v490;
        v101 = array;
        goto LABEL_255;
      }
    }
  }

  v103 = array4;
LABEL_255:
  obja = v103;
  *&v199 = OUTLINED_FUNCTION_269();
  v200[48] = v199;
  v200[49] = v199;
  v200[46] = v199;
  v200[47] = v199;
  v518 = OUTLINED_FUNCTION_280(v201, v202, v616, v615, v203, v204, v205, v206, v424, v428, v431, v435, v439, v443, v447, v451, v455, v459, v463, v467, v471, v474, v478, v482, v486, v490, v493, v497, v501, v505, v508, v511, v514, v517, v520, v523, v526, v530, v534, v538, v541, v544, array, v550, v553, v556);
  if (v518)
  {
    v207 = HIDWORD(v551) & 1;
    v208 = v545;
    v483 = v545 & 0x10;
    if ((v545 & 0x10) == 0)
    {
      LODWORD(v207) = 1;
    }

    LODWORD(v527) = v207;
    v521 = *v618;
    v515 = v545 & 0xFFFFFFFFFFFF7FFFLL;
    v512 = *off_1E798BD50;
    v209 = BYTE4(v460);
    if ((v551 & 0x80) == 0)
    {
      v209 = 1;
    }

    v581 = v209;
    v210 = *off_1E798C658;
    v592 = *off_1E798C5F8;
    v586 = *off_1E798C698;
    v589 = *off_1E798C660;
    if (v582)
    {
      v211 = 11;
    }

    else
    {
      v211 = 14;
    }

    if (v582)
    {
      v212 = 12;
    }

    else
    {
      v212 = 15;
    }

    if (v582)
    {
      v213 = 13;
    }

    else
    {
      v213 = 16;
    }

    if (HIDWORD(v569) == 12)
    {
      v211 = 20;
    }

    LODWORD(v509) = v211;
    if (HIDWORD(v569) == 12)
    {
      v214 = 21;
    }

    else
    {
      v214 = v212;
    }

    LODWORD(v502) = v214;
    if (HIDWORD(v569) == 12)
    {
      v215 = 22;
    }

    else
    {
      v215 = v213;
    }

    LODWORD(v487) = v215;
    do
    {
      v216 = 0;
      do
      {
        if (*v618 != v521)
        {
          objc_enumerationMutation(v557);
        }

        v217 = *(v617 + 8 * v216);
        if ((v208 & 0x8000) != 0)
        {
          v219 = [objc_msgSend(objc_msgSend(*(v617 + 8 * v216) "stream")];
          if (v219)
          {
            v218 = v208;
          }

          else
          {
            v218 = v515;
          }

          v220 = MEMORY[0x1E695E118];
          if ((v219 & 1) == 0)
          {
            v220 = 0;
          }

          v595 = v220;
        }

        else
        {
          v595 = 0;
          v218 = v208;
        }

        if ((v527 & 1) == 0 && [v217 activeQuadraBinningFactor] != 1)
        {
          v218 &= ~0x10uLL;
        }

        if ((v551 & 0x40) != 0 && [v217 activeSensorDimensions] != *(v37 + 148))
        {
          v218 &= ~0x40uLL;
        }

        [dictionary setObject:objc_msgSend(MEMORY[0x1E696AD98] forKeyedSubscript:{"numberWithUnsignedLongLong:", v218), objc_msgSend(v217, "portType")}];
        [v217 portType];
        v572 = [OUTLINED_FUNCTION_8() objectForKeyedSubscript:?];
        v583 = v217;
        v536 = v216;
        if (!HIDWORD(v554) || v217 == *(v37 + 1560))
        {
          v236 = 0;
        }

        else
        {
          portType5 = [v217 portType];
          v229 = OUTLINED_FUNCTION_376(portType5, v222, v223, v224, v225, v226, v227, v228, v425, v429, v432, v436, v440, v444, v448, v452, v456, v460, v464, v468, v472, v475, v479, v483, v487, v490, v494, v498, v502, v506);
          [v229 gain];
          v230 = [v217 noiseReductionAndSharpeningConfigurationForType:1 gain:(v218 >> 4) & 1 qSub:?];
          v231 = v230;
          if (HIDWORD(v569) == 1)
          {
            v613 = v542;
            v614 = v230;
            v232 = MEMORY[0x1E695DF20];
            v233 = &v614;
            v234 = &v613;
            v235 = 1;
          }

          else if (HIDWORD(v468))
          {
            [v229 gain];
            v237 = [v217 noiseReductionAndSharpeningConfigurationForType:10 gain:?];
            v611[0] = v542;
            v611[1] = v524;
            v612[0] = v231;
            v612[1] = v237;
            v232 = MEMORY[0x1E695DF20];
            v233 = v612;
            v234 = v611;
            v235 = 2;
          }

          else
          {
            [v494 gain];
            [v217 noiseReductionAndSharpeningConfigurationForType:v509 gain:?];
            [OUTLINED_FUNCTION_18_0() gain];
            [v217 noiseReductionAndSharpeningConfigurationForType:v502 gain:?];
            [OUTLINED_FUNCTION_133() gain];
            v238 = [v217 noiseReductionAndSharpeningConfigurationForType:v487 gain:?];
            v609[0] = v542;
            v609[1] = v524;
            v610[0] = v231;
            v610[1] = v229;
            v609[2] = v479;
            v609[3] = v456;
            v610[2] = p_cache;
            v610[3] = v238;
            v232 = MEMORY[0x1E695DF20];
            v233 = v610;
            v234 = v609;
            v235 = 4;
          }

          v236 = [v232 dictionaryWithObjects:v233 forKeys:v234 count:v235];
        }

        p_cache = [MEMORY[0x1E695DF70] array];
        v605 = 0u;
        v606 = 0u;
        v607 = 0u;
        v608 = 0u;
        if (OUTLINED_FUNCTION_37_2(p_cache, v239, &v605, v604))
        {
          v240 = *v606;
          do
          {
            if (*v606 != v240)
            {
              objc_enumerationMutation(v548);
            }

            v241 = **(&v605 + 1);
            v242 = [**(&v605 + 1) mutableCopy];
            [v241 objectForKeyedSubscript:v210];
            [v242 setObject:v595 forKeyedSubscript:v592];
            [OUTLINED_FUNCTION_259() objectForKeyedSubscript:?];
            [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
            [p_cache addObject:v242];

            OUTLINED_FUNCTION_120_0();
          }

          while (!v98 || OUTLINED_FUNCTION_37_2(v243, v244, &v605, v604));
        }

        [dictionary2 setObject:p_cache forKeyedSubscript:{objc_msgSend(v217, "portType")}];
        v245 = [v532 mutableCopy];
        [v245 setObject:v595 forKeyedSubscript:v592];
        [v236 objectForKeyedSubscript:v542];
        [OUTLINED_FUNCTION_8() setObject:? forKeyedSubscript:?];
        [dictionary3 setObject:v245 forKeyedSubscript:{objc_msgSend(v217, "portType")}];
        array5 = [MEMORY[0x1E695DF70] array];
        v600 = 0u;
        v601 = 0u;
        v602 = 0u;
        v603 = 0u;
        OUTLINED_FUNCTION_336();
        v247 = [v102 countByEnumeratingWithState:? objects:? count:?];
        if (v247)
        {
          v248 = v247;
          v249 = 0;
          while (2)
          {
            v250 = 0;
            do
            {
              OUTLINED_FUNCTION_142_0();
              if (!v98)
              {
                objc_enumerationMutation(array2);
              }

              v251 = *(*(&v600 + 1) + 8 * v250);
              p_cache = [v251 mutableCopy];
              v252 = [objc_msgSend(p_cache objectForKeyedSubscript:{v586), "intValue"}];
              if (!v252)
              {
                ++v249;
              }

              v253 = [v251 objectForKeyedSubscript:v210];
              [p_cache setObject:v595 forKeyedSubscript:v592];
              [v236 objectForKeyedSubscript:v253];
              [OUTLINED_FUNCTION_7() setObject:? forKeyedSubscript:?];
              if ([p_cache objectForKeyedSubscript:v589])
              {
                [v583 portType];
                if (([objc_msgSend(OUTLINED_FUNCTION_28() "objectForKeyedSubscript:"intValue"")] & 0x80000000) != 0)
                {
                  goto LABEL_325;
                }

                v598[0] = MEMORY[0x1E69E9820];
                v598[1] = 3221225472;
                v598[2] = __235__BWFigVideoCaptureDevice__ubStillImageCaptureSettingsWithID_userInitiatedRequestPTS_captureType_captureFlags_sceneFlags_frameStatisticsByPortType_metadata_deliverOriginalImage_deliverSushiRaw_bravoConstituentImageDeliveryDeviceTypes___block_invoke;
                v598[3] = &__block_descriptor_36_e45_B32__0__BWStillImageCaptureFrameInfo_8Q16_B24l;
                v599 = v249;
                if ([obja indexOfObjectPassingTest:v598] == 0x7FFFFFFFFFFFFFFFLL)
                {
                  OUTLINED_FUNCTION_64_10();
                  v268 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
                  v269 = OUTLINED_FUNCTION_191(v268);
                  if (OUTLINED_FUNCTION_5_2(v269))
                  {
                    v628 = 136315394;
                    OUTLINED_FUNCTION_329("[BWFigVideoCaptureDevice _ubStillImageCaptureSettingsWithID:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:deliverOriginalImage:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:]");
                    *(v297 + 14) = v249;
                    OUTLINED_FUNCTION_306();
                    OUTLINED_FUNCTION_7_4();
                    _os_log_send_and_compose_impl();
                  }

                  v37 = v584;
                  goto LABEL_359;
                }

                v254 = [OUTLINED_FUNCTION_28() objectAtIndexedSubscript:?];
                v255 = v252 ? [v254 sifrFlags] : objc_msgSend(v254, "mainFlags");
                if ((v636 & v255) != 0 || ([v583 portType], v258 = objc_msgSend(objc_msgSend(OUTLINED_FUNCTION_8(), "objectForKeyedSubscript:"), "intValue"), (v258 & 0x80000000) != 0))
                {
LABEL_325:
                  v256 = 0;
                }

                else
                {
                  v256 = [MEMORY[0x1E696AD98] numberWithInt:v258];
                }

                [p_cache setObject:v256 forKeyedSubscript:v589];
                if ((v581 & 1) == 0 && [p_cache objectForKeyedSubscript:v589])
                {
                  v257 = MEMORY[0x1E696AD98];
                  [v572 learnedNRUltraHighResolutionExposureBias];
                  [v257 numberWithFloat:?];
                  [OUTLINED_FUNCTION_7() setObject:? forKeyedSubscript:?];
                }
              }

              [OUTLINED_FUNCTION_221() addObject:?];

              ++v250;
            }

            while (v248 != v250);
            OUTLINED_FUNCTION_336();
            v259 = [array2 countByEnumeratingWithState:? objects:? count:?];
            v248 = v259;
            if (v259)
            {
              continue;
            }

            break;
          }
        }

        v260 = [dictionary4 setObject:array5 forKeyedSubscript:{objc_msgSend(v583, "portType")}];
        v216 = v536 + 1;
        v37 = v584;
        v102 = array2;
        v208 = v545;
      }

      while (v536 + 1 != v518);
      v518 = OUTLINED_FUNCTION_280(v260, v261, v616, v615, v262, v263, v264, v265, v425, v429, v432, v436, v440, v444, v448, v452, v456, v460, v464, v468, v472, v475, v479, v483, v487, v490, v494, v498, v502, v506, v509, v512, v515, v518, v521, v524, v527, v532, v536, v539, v542, v545, v548, v551, v554, v557);
    }

    while (v518);
    v38 = v490;
    v101 = v548;
    v266 = v483;
    v267 = v515;
  }

  else
  {
    v208 = v545;
    v267 = v545 & 0xFFFFFFFFFFFF7FFFLL;
    v266 = v545 & 0x10;
  }

  array6 = [MEMORY[0x1E695DF70] array];
  if (!HIDWORD(v539))
  {
    v208 = v267;
  }

  if ((v551 & 0x100000000) == 0 && v266 && [v38 activeQuadraBinningFactor] != 1)
  {
    v208 &= ~0x10uLL;
  }

  v271 = -[BWStillImageCaptureStreamSettings initWithPortType:captureType:captureFlags:referenceFrameIndex:timeMachineBracketedCaptureParams:preBracketFrameCaptureParams:unifiedBracketedCaptureParams:frameInfos:]([BWStillImageCaptureStreamSettings alloc], "initWithPortType:captureType:captureFlags:referenceFrameIndex:timeMachineBracketedCaptureParams:preBracketFrameCaptureParams:unifiedBracketedCaptureParams:frameInfos:", [v38 portType], HIDWORD(v569), v208, v564, v101, v532);
  [v38 sensorIDString];
  [OUTLINED_FUNCTION_8() setSensorIDString:?];
  [OUTLINED_FUNCTION_40() addObject:?];

  *&v272 = OUTLINED_FUNCTION_269();
  v273[2] = v272;
  v273[3] = v272;
  *v273 = v272;
  v273[1] = v272;
  OUTLINED_FUNCTION_332();
  v282 = OUTLINED_FUNCTION_280(v274, v275, v276, v277, v278, v279, v280, v281, v102, array3, v432, v436, v440, v444, v448, v452, v456, v460, v464, v468, v472, v475, v479, v483, v487, v490, v494, v498, v502, v506, v509, v512, v515, 0, v521, v524, v527, v532, v535, v539, v542, v545, v548, v551, v554, v557);
  if (v282)
  {
    v283 = v282;
    do
    {
      for (k = 0; k != v283; ++k)
      {
        OUTLINED_FUNCTION_32_10();
        if (!v98)
        {
          objc_enumerationMutation(v558);
        }

        v285 = *(v597 + 8 * k);
        [objc_msgSend(dictionary objectForKeyedSubscript:{objc_msgSend(v285, "portType", v426)), "unsignedLongValue"}];
        [BWStillImageCaptureStreamSettings alloc];
        [v285 portType];
        [dictionary2 objectForKeyedSubscript:{objc_msgSend(v285, "portType")}];
        [dictionary3 objectForKeyedSubscript:{objc_msgSend(v285, "portType")}];
        v426 = [dictionary4 objectForKeyedSubscript:{objc_msgSend(v285, "portType")}];
        v286 = [OUTLINED_FUNCTION_132_5() initWithPortType:? captureType:? captureFlags:? referenceFrameIndex:? timeMachineBracketedCaptureParams:? preBracketFrameCaptureParams:? unifiedBracketedCaptureParams:? frameInfos:?];
        [v285 sensorIDString];
        [OUTLINED_FUNCTION_28() setSensorIDString:?];
        [OUTLINED_FUNCTION_267() addObject:?];
      }

      OUTLINED_FUNCTION_332();
      v283 = OUTLINED_FUNCTION_280(v287, v288, v289, v290, v291, v292, v293, v294, v426, obja, v433, v437, v441, v445, v449, v453, v457, v461, v465, v469, v473, v476, v480, v484, v488, v491, v495, v499, v503, v507, v510, v513, v516, v519, v522, v525, v528, v533, v537, v540, v543, v546, v549, v552, v555, v558);
    }

    while (v283);
  }

  LOBYTE(v426) = a24;
  v295 = [[BWStillImageCaptureSettings alloc] initWithSettingsID:v453 captureType:HIDWORD(v569) captureFlags:v546 sceneFlags:v499 frameStatisticsByPortType:v507 deliverOriginalImage:a23 deliverSushiRaw:v426 captureStreamSettings:array6];
  v296 = v295;
  v37 = v584;
  if ((v546 & 0x2000) != 0)
  {
    [(BWStillImageCaptureSettings *)v295 setTimeMachineReferenceFrameBracketedCaptureSequenceNumber:v564 + 1];
    CMTimeMakeFromDictionary(&v596, [objc_msgSend(*(v584 + 3496) "lastObject")]);
    v635[0] = v596;
    [(BWStillImageCaptureSettings *)v296 setLastTimeMachinePTS:v635];
  }

  v38 = v491;
  if (!v296)
  {
LABEL_360:
    [(BWFigVideoCaptureDevice *)v37 _resumeTimeMachines];
    v296 = 0;
  }

  [v38 portType];
  [OUTLINED_FUNCTION_17() setMasterPortType:?];
  v298 = v296;
LABEL_362:
  OUTLINED_FUNCTION_128_0();
}

- (void)_ubAdaptiveStillImageCaptureSettingsWithSettings:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:
{
  OUTLINED_FUNCTION_60();
  v105 = v7;
  if (v0)
  {
    v8 = v6;
    v9 = v5;
    v10 = v4;
    v11 = v3;
    v12 = v2;
    v13 = v1;
    v14 = v0;
    if (!_FigIsNotCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_2_9();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    if (v11 != 11)
    {
      goto LABEL_113;
    }

    v103 = v12;
    v15 = *(v14 + 1392);
    if (!v15)
    {
      v15 = *(v14 + 600);
    }

    v16 = v13;
    [v15 portType];
    v106 = [OUTLINED_FUNCTION_4() objectForKeyedSubscript:?];
    v17 = [v8 objectForKeyedSubscript:{objc_msgSend(v15, "portType")}];
    if ((v10 & 0x8000000) != 0)
    {
      v18 = 2;
    }

    else
    {
      v18 = 1;
    }

    hasSphere = [v15 hasSphere];
    v20 = (v9 >> 13) & 1;
    v21 = v10 | 0x2000000000;
    if (((v10 >> 35) & v20) == 0)
    {
      v21 = v10;
    }

    if (hasSphere)
    {
      v22 = (v10 >> 35) & ((v9 & 0x2000) != 0);
    }

    else
    {
      v22 = 0;
    }

    if (hasSphere)
    {
      v23 = v21;
    }

    else
    {
      v23 = v10;
    }

    os_unfair_lock_lock((v14 + 2140));
    [v15 portType];
    v24 = [OUTLINED_FUNCTION_7() objectForKeyedSubscript:?];
    if (v24)
    {
      v25 = v22;
      v26 = [v24 adaptiveBracketingParametersForDigitalFlashMode:v18 sphereOffsetEnabled:v22 & 1];
      os_unfair_lock_unlock((v14 + 2140));
      if (v26)
      {
        goto LABEL_25;
      }
    }

    else
    {
      v25 = v22;
      os_unfair_lock_unlock((v14 + 2140));
    }

    if ([*(v14 + 2368) count])
    {
      objectDetector = [v15 objectDetector];
      if (v17)
      {
        [OUTLINED_FUNCTION_244() pts];
      }

      else
      {
        v116 = 0uLL;
        *&v117 = 0;
      }

      [objectDetector objectsForPTS:&v116];
      [v17 finalCropRect];
      v67 = OUTLINED_FUNCTION_1_19();
      v27 = [BWFigVideoCaptureDevice _ubDetectedObjectsForDigitalFlashFromDetectedObjects:v67 finalCropRect:?];
    }

    else
    {
      v27 = 0;
    }

    v26 = [objc_loadWeak((v14 + 2392)) adaptiveBracketingParametersForDigitalFlashMode:v18 frameStatistics:v17 stationary:v20 sphereOffsetEnabled:v25 & 1 detectedObjects:v27];
LABEL_25:
    v119 = 0;
    OUTLINED_FUNCTION_240();
    if (!v28 || ([v15 portType], !objc_msgSend(OUTLINED_FUNCTION_4(), "containsObject:")))
    {
      v46 = 0;
      [v106 digitalFlashHighlightRecoveryEnabled];
      v30 = v25;
      v35 = v16;
      v36 = 0x1E695D000;
LABEL_106:
      [v15 pixelSize];
      activeQuadraBinningFactor = [v15 activeQuadraBinningFactor];
      LODWORD(v88) = 1.0;
      if (activeQuadraBinningFactor >= 1)
      {
        [v15 activeQuadraBinningFactor];
      }

      if (v30)
      {
        v89 = OUTLINED_FUNCTION_84_5();
        [(BWFigVideoCaptureDevice *)v89 _ubSphereOffsetsForAdaptiveBracketingParameters:v90 pixelSize:v91];
      }

      v92 = [BWStillImageCaptureStreamSettings alloc];
      [v15 portType];
      v93 = [OUTLINED_FUNCTION_8() initWithPortType:? captureType:? captureFlags:? referenceFrameIndex:? adaptiveBracketingParameters:? sphereOffsets:?];
      [v15 sensorIDString];
      [OUTLINED_FUNCTION_4() setSensorIDString:?];
      v94 = [BWStillImageCaptureSettings alloc];
      [v35 settingsID];
      v107 = v93;
      LOBYTE(v99) = 0;
      v95 = [OUTLINED_FUNCTION_351() initWithSettingsID:v99 captureType:objc_msgSend(*(v36 + 3784) captureFlags:"arrayWithObjects:count:" sceneFlags:&v107 frameStatisticsByPortType:1) deliverOriginalImage:? deliverSushiRaw:? captureStreamSettings:?];
      [v15 portType];
      [OUTLINED_FUNCTION_8() setMasterPortType:?];
      v96 = OUTLINED_FUNCTION_3_19();
      [(BWFigVideoCaptureDevice *)v96 _ubUpdateCurrentAdaptiveBracketedCaptureParamsForCaptureStreamSettings:v97 frameStatistics:v17 timeMachineFrameSelection:v46];

      goto LABEL_111;
    }

    v104 = v23;
    v29 = [v26 adaptiveBracketingFrameParametersForGroup:1];
    if ([v29 count])
    {
      v30 = v25;
      [objc_msgSend(v29 objectAtIndexedSubscript:{0), "evZeroRatio"}];
      if (v31 >= 2.0)
      {
        LODWORD(v33) = 0;
        v35 = v16;
        v36 = 0x1E695D000uLL;
      }

      else
      {
        v32 = v31;
        v33 = 0;
        v34 = NAN;
        v35 = v16;
        v36 = 0x1E695D000;
        while (v34 == v32 && v33 < *(v14 + 3456))
        {
          if (v32 <= 0.0)
          {
            LODWORD(v33) = 0;
            break;
          }

          [objc_msgSend(v29 objectAtIndexedSubscript:{++v33), "evZeroRatio"}];
          v34 = v32;
          v32 = v37;
          if (v37 >= 2.0)
          {
            break;
          }
        }
      }

      v38 = *(v14 + 3456);
      if (v33 >= v38)
      {
        v39 = v38;
      }

      else
      {
        v39 = v33;
      }

      if (v39 < 1)
      {
        v46 = 0;
        v119 = 18;
      }

      else
      {
        if ([objc_msgSend(v26 adaptiveBracketingFrameParametersForGroup:{2), "count"}])
        {
          if (dword_1ED844350)
          {
            v43 = v30;
            OUTLINED_FUNCTION_254();
            v47 = OUTLINED_FUNCTION_170();
            v48 = OUTLINED_FUNCTION_127_2(v47);
            if (!OUTLINED_FUNCTION_6(v48))
            {
              goto LABEL_70;
            }

            *v108 = 136315138;
            *&v108[4] = "[BWFigVideoCaptureDevice _ubAdaptiveStillImageCaptureSettingsWithSettings:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:]";
            OUTLINED_FUNCTION_43_0();
            OUTLINED_FUNCTION_319();
            goto LABEL_69;
          }

LABEL_71:
          v46 = 0;
          v119 = 21;
          goto LABEL_105;
        }

        if ([v29 count] > v39)
        {
          v40 = 0.0;
          v41 = v39;
          do
          {
            [objc_msgSend(v29 objectAtIndexedSubscript:{v41), "integrationTimeInSeconds"}];
            v40 = v40 + v42;
            ++v41;
          }

          while ([v29 count] > v41);
          if (v40 > 1.0)
          {
            if (dword_1ED844350)
            {
              v43 = v30;
              OUTLINED_FUNCTION_254();
              v44 = OUTLINED_FUNCTION_170();
              v45 = OUTLINED_FUNCTION_127_2(v44);
              if (!OUTLINED_FUNCTION_6(v45))
              {
                goto LABEL_70;
              }

              *v108 = 136315394;
              *&v108[4] = "[BWFigVideoCaptureDevice _ubAdaptiveStillImageCaptureSettingsWithSettings:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:]";
              *&v108[12] = 2048;
              *&v108[14] = v40;
              OUTLINED_FUNCTION_34_16();
              OUTLINED_FUNCTION_319();
LABEL_69:
              OUTLINED_FUNCTION_8_0();
              _os_log_send_and_compose_impl();
LABEL_70:
              OUTLINED_FUNCTION_2_4();
              OUTLINED_FUNCTION_17_8();
              v30 = v43;
              goto LABEL_71;
            }

            goto LABEL_71;
          }
        }

        if (!v119)
        {
          v102 = v39;
          v115 = v15;
          [*(v36 + 3784) arrayWithObjects:&v115 count:1];
          [BWFigVideoCaptureDevice _ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:];
          v50 = v49;
          if (!v119)
          {
            [v15 portType];
            portType = [v15 portType];
            [*(v36 + 3784) arrayWithObjects:&portType count:1];
            v51 = OUTLINED_FUNCTION_210();
            [BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:v51 minimumValidCount:? primaryPortType:? portTypes:? frameStatisticsByPortType:? deliverDepthData:?];
            v119 = v52;
            if (!v52)
            {
              v100 = v17;
              v101 = v15;
              v112 = 0u;
              v113 = 0u;
              v110 = 0u;
              v111 = 0u;
              OUTLINED_FUNCTION_206();
              v57 = OUTLINED_FUNCTION_273(v53, v54, v55, v56);
              if (v57)
              {
                v68 = v57;
                v69 = 0;
                v70 = *off_1E798B2A8;
                v71 = *off_1E798B378;
                v72 = -1.0;
                while (2)
                {
                  for (i = 0; i != v68; ++i)
                  {
                    OUTLINED_FUNCTION_32_10();
                    if (!v28)
                    {
                      objc_enumerationMutation(v50);
                    }

                    v74 = *(*(&v110 + 1) + 8 * i);
                    if (([objc_msgSend(v74 objectForKeyedSubscript:{0x1F216F0F0), "BOOLValue"}] & 1) == 0)
                    {
                      [objc_msgSend(v74 objectForKeyedSubscript:{v70), "doubleValue"}];
                      v76 = v75;
                      if (v72 >= 0.0)
                      {
                        if (vabdd_f64(v75, v72) > 1.79769313e308)
                        {
                          v15 = v101;
                          v17 = v100;
                          if (dword_1ED844350)
                          {
                            OUTLINED_FUNCTION_254();
                            v82 = OUTLINED_FUNCTION_170();
                            v83 = OUTLINED_FUNCTION_127_2(v82);
                            if (OUTLINED_FUNCTION_6(v83))
                            {
                              *v108 = 136315650;
                              *&v108[4] = "[BWFigVideoCaptureDevice _ubAdaptiveStillImageCaptureSettingsWithSettings:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:]";
                              *&v108[12] = 2048;
                              *&v108[14] = v72;
                              *&v108[22] = 2048;
                              v109 = v76;
                              OUTLINED_FUNCTION_29_12();
                              OUTLINED_FUNCTION_319();
                              OUTLINED_FUNCTION_8_0();
                              _os_log_send_and_compose_impl();
                            }

                            OUTLINED_FUNCTION_2_4();
                            OUTLINED_FUNCTION_17_8();
                          }

                          v86 = 19;
                          goto LABEL_101;
                        }

                        v77 = [objc_msgSend(v74 objectForKeyedSubscript:{v71), "BOOLValue"}];
                        if ([v106 digitalFlashHighlightRecoveryEnabled] && ((v69 ^ v77) & 1) != 0)
                        {
                          v15 = v101;
                          v17 = v100;
                          if (dword_1ED844350)
                          {
                            OUTLINED_FUNCTION_254();
                            v84 = OUTLINED_FUNCTION_170();
                            v85 = OUTLINED_FUNCTION_127_2(v84);
                            if (OUTLINED_FUNCTION_6(v85))
                            {
                              *v108 = 136315138;
                              *&v108[4] = "[BWFigVideoCaptureDevice _ubAdaptiveStillImageCaptureSettingsWithSettings:userInitiatedRequestPTS:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:metadata:]";
                              OUTLINED_FUNCTION_43_0();
                              OUTLINED_FUNCTION_319();
                              OUTLINED_FUNCTION_8_0();
                              _os_log_send_and_compose_impl();
                            }

                            OUTLINED_FUNCTION_2_4();
                            OUTLINED_FUNCTION_17_8();
                          }

                          v86 = 20;
LABEL_101:
                          v119 = v86;
                          v36 = 0x1E695D000uLL;
                          goto LABEL_102;
                        }
                      }

                      else
                      {
                        v69 = [objc_msgSend(v74 objectForKeyedSubscript:{v71), "BOOLValue"}];
                        v72 = v76;
                      }
                    }
                  }

                  OUTLINED_FUNCTION_206();
                  v68 = OUTLINED_FUNCTION_273(v78, v79, v80, v81);
                  if (v68)
                  {
                    continue;
                  }

                  break;
                }
              }

              v15 = v101;
              v17 = v100;
              v36 = 0x1E695D000;
              if (!v119)
              {
                v58 = v104;
                v117 = 0u;
                v118 = 0u;
                v116 = 0u;
                [v101 portType];
                v59 = [OUTLINED_FUNCTION_8() objectForKeyedSubscript:?];
                *v108 = *v103;
                *&v108[16] = *(v103 + 16);
                v60 = [(BWFigVideoCaptureDevice *)v14 _ubZeroShutterLagFrameSelectionForCaptureType:v104 | 0x2000 captureFlags:v59 captureParameters:v50 timeMachineFrameMetadata:v102 mainFrameCount:v108 userInitiatedRequestPTS:&v116];
                if ([objc_msgSend(objc_msgSend(v50 objectAtIndexedSubscript:{SDWORD2(v118), v60), "objectForKeyedSubscript:", *off_1E798B378), "BOOLValue"}])
                {
                  v58 = v104;
                }

                v61 = OUTLINED_FUNCTION_210();
                v62 = [BWFigVideoCaptureDevice _ubFramesMetadataHasSIFRSkip:v61];
                v63 = v58 | 0x20;
                if (!v62)
                {
                  v63 = v58;
                }

                if ((v63 & 4) != 0 && *(v14 + 2242) == 1)
                {
                  v64 = OUTLINED_FUNCTION_70();
                  [v105 setPreviewWhiteBalanceMetadataByPortType:{-[BWFigVideoCaptureDevice _ubWhiteBalanceMetadataByPortTypeFromMetadata:](v64, v65)}];
                }

                *(v14 + 3496) = v50;
                v46 = &v116;
                goto LABEL_105;
              }
            }
          }

LABEL_102:
          if (v50)
          {
            [(BWFigVideoCaptureDevice *)v14 _resumeTimeMachines];
          }
        }

        v46 = 0;
      }

LABEL_105:
      [v105 setZeroShutterLagFailureReason:v119];
      goto LABEL_106;
    }

LABEL_113:
    v95 = 0;
LABEL_111:
    v98 = v95;
  }

  OUTLINED_FUNCTION_128_0();
}

- (void)_ubClientBracketStillImageCaptureSettings:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:
{
  OUTLINED_FUNCTION_84();
  v100 = v5;
  if (v0)
  {
    v6 = v4;
    v7 = v3;
    v8 = v2;
    v9 = v1;
    v10 = v0;
    if (!_FigIsNotCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_0_3();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    if (v8 != 7)
    {
      goto LABEL_17;
    }

    v11 = *(v10 + 1392);
    if (!v11)
    {
      v11 = *(v10 + 600);
    }

    array = [MEMORY[0x1E695DF70] array];
    obj = array;
    if (*(v10 + 648))
    {
      if ((v7 & 0x800) != 0)
      {
        [array addObjectsFromArray:-[BWFigVideoCaptureDevice _captureStreamsForDepthDataDeliveryOrStereoPhotoCaptureWithPrimaryCaptureStream:](v10)];
        goto LABEL_12;
      }

      if ([v9 constituentPhotoDeliveryEnabled])
      {
        [obj addObjectsFromArray:{-[BWFigVideoCaptureDevice _captureStreamsForBravoConstituentImageDeliveryDeviceTypes:](v10, objc_msgSend(v9, "bravoConstituentImageDeliveryDeviceTypes"))}];
        if (([obj containsObject:v11] & 1) == 0)
        {
          [obj addObject:v11];
          [v11 portType];
          firstObject = [obj firstObject];
          HIDWORD(v105) = 1;
LABEL_13:
          portType = [firstObject portType];
          bracketType = [v9 bracketType];
          switch(bracketType)
          {
            case 0:
              FigCaptureGetFrameworkRadarComponent();
              OUTLINED_FUNCTION_62();
              OUTLINED_FUNCTION_88_6();
              os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
              v17 = OUTLINED_FUNCTION_108(os_log_and_send_and_compose_flags_and_os_log_type);
              if (OUTLINED_FUNCTION_6(v17))
              {
                v138 = 136315138;
                v139 = "[BWFigVideoCaptureDevice _ubClientBracketStillImageCaptureSettings:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:]";
                OUTLINED_FUNCTION_43_0();
                v90 = &v138;
                OUTLINED_FUNCTION_8_0();
                _os_log_send_and_compose_impl();
                OUTLINED_FUNCTION_297();
              }

              OUTLINED_FUNCTION_5_3();
              OUTLINED_FUNCTION_17_8();
              v140[0] = 0;
              OUTLINED_FUNCTION_16_14();
              OUTLINED_FUNCTION_5_61();
              _os_log_send_and_compose_impl();
              OUTLINED_FUNCTION_13_18();
              v18 = OUTLINED_FUNCTION_6_1();
              FigCapturePleaseFileRadar(v18, v19, v20, v21, v22, 21877, v23, v24, v90);
              free(v140);
LABEL_17:
              v25 = 0;
LABEL_18:
              v26 = v25;
              goto LABEL_19;
            case 1:
              v29 = FigCapturePlatformIdentifier();
              portType2 = portType;
              if (v29 <= 8)
              {
                portType2 = [*(v10 + 600) portType];
              }

              [v100 objectForKeyedSubscript:portType2];
              v31 = OUTLINED_FUNCTION_24_1();
              v110 = [(BWFigVideoCaptureDevice *)v31 _manualExposureBracketParametersForSettings:v9 frameStatistics:v32 use8dot8FixedPointGain:0];
              break;
            case 2:
              [v100 objectForKeyedSubscript:portType];
              v27 = OUTLINED_FUNCTION_24_1();
              v28 = [BWFigVideoCaptureDevice _autoExposureBracketValuesForSettings:v27 frameStatistics:?];
              v110 = 0;
              goto LABEL_28;
            default:
              v110 = 0;
              break;
          }

          v28 = 0;
LABEL_28:
          v96 = v6;
          v136 = 0;
          v137 = 0;
          v33 = [(BWFigVideoCaptureDevice *)v10 _ubEnabledOutputsForCaptureFlags:v7 captureType:7 baseCaptureFrameFlagsOut:&v137 discardCaptureFrameFlagsOut:&v136];
          v126 = v33;
          if (v33)
          {
            v34 = ([v33 intValue] >> 1) & 1;
          }

          else
          {
            v34 = 1;
          }

          v128 = v34;
          v95 = portType;
          array2 = [MEMORY[0x1E695DF70] array];
          v132 = 0u;
          v133 = 0u;
          v134 = 0u;
          v135 = 0u;
          OUTLINED_FUNCTION_336();
          v106 = [obj countByEnumeratingWithState:? objects:? count:?];
          if (!v106)
          {
LABEL_90:
            v88 = [BWStillImageCaptureSettings alloc];
            settingsID = [v9 settingsID];
            LOBYTE(v90) = FigCapturePixelFormatIsBayerRaw([v9 rawOutputFormat]);
            v25 = [(BWStillImageCaptureSettings *)v88 initWithSettingsID:settingsID captureType:7 captureFlags:v7 sceneFlags:v96 frameStatisticsByPortType:v100 deliverOriginalImage:0 deliverSushiRaw:v90 captureStreamSettings:array2];
            [(BWStillImageCaptureSettings *)v25 setMasterPortType:v95];
            goto LABEL_18;
          }

          v101 = *v133;
          if ((v7 & 0x40000000) != 0)
          {
            v35 = 3;
          }

          else
          {
            v35 = 0;
          }

          v97 = v7 & 0xFFFFFFFFFFFF7FFFLL;
          v98 = *off_1E798BD50;
          v125 = *off_1E798C698;
          v124 = *off_1E798C918;
          v121 = *off_1E798C648;
          v123 = *off_1E798C608;
          v127 = *off_1E798C630;
          v116 = *off_1E798C620;
          v115 = *off_1E798C658;
          if ((v7 & 0x20000000) != 0)
          {
            v35 = 2;
          }

          v114 = *off_1E798C5F8;
          if ((v7 & 0x800000) != 0)
          {
            v35 = 1;
          }

          v117 = v35;
          v113 = *off_1E798BAA8;
          v112 = *off_1E798BA90;
          v111 = v28;
          v102 = v11;
          v103 = v9;
LABEL_40:
          v36 = 0;
          while (1)
          {
            if (*v133 != v101)
            {
              objc_enumerationMutation(obj);
            }

            v37 = *(*(&v132 + 1) + 8 * v36);
            if ((v7 & 0x8000) != 0)
            {
              v39 = [objc_msgSend(objc_msgSend(*(*(&v132 + 1) + 8 * v36) "stream")];
              if (v39)
              {
                v38 = v7;
              }

              else
              {
                v38 = v97;
              }

              v40 = MEMORY[0x1E695E118];
              if ((v39 & 1) == 0)
              {
                v40 = 0;
              }

              v120 = v40;
            }

            else
            {
              v120 = 0;
              v38 = v7;
            }

            if ((v38 & 0x100000010) == 0x10 && [v37 activeQuadraBinningFactor] != 1)
            {
              v38 &= 0xFFFFFFFEFFFFFFEFLL;
            }

            v109 = v36;
            v107 = v38;
            if (v37 == *(v10 + 1560))
            {
              v119 = 0;
            }

            else
            {
              [objc_msgSend(v100 objectForKeyedSubscript:{objc_msgSend(v37, "portType")), "gain"}];
              v119 = [v37 noiseReductionAndSharpeningConfigurationForType:1 gain:(v38 >> 4) & 1 qSub:?];
            }

            v41 = v10;
            array3 = [MEMORY[0x1E695DF70] array];
            array4 = [MEMORY[0x1E695DF70] array];
            v122 = array4;
            v108 = v37;
            v44 = &v137;
            if ((BYTE4(v105) & (v37 == v11)) != 0)
            {
              v44 = &v136;
            }

            v45 = *v44;
            v118 = (v7 >> 25) & 1;
            if (v28)
            {
              memset(v131, 0, 64);
              v46 = OUTLINED_FUNCTION_1_0(array4, v43, v131, v130);
              if (v46)
              {
                v47 = v46;
                v48 = 1;
                do
                {
                  v49 = 0;
                  v50 = v48;
                  do
                  {
                    OUTLINED_FUNCTION_89();
                    if (!v51)
                    {
                      objc_enumerationMutation(v111);
                    }

                    v52 = *(*(&v131[0] + 1) + 8 * v49);
                    dictionary = [MEMORY[0x1E695DF90] dictionary];
                    [dictionary setObject:&unk_1F22469D8 forKeyedSubscript:v125];
                    [dictionary setObject:&unk_1F22469D8 forKeyedSubscript:v124];
                    [dictionary setObject:v52 forKeyedSubscript:v121];
                    [dictionary setObject:v126 forKeyedSubscript:v123];
                    [dictionary setObject:MEMORY[0x1E695E110] forKeyedSubscript:v127];
                    if (v128)
                    {
                      [dictionary setObject:MEMORY[0x1E695E110] forKeyedSubscript:v116];
                      [OUTLINED_FUNCTION_301() numberWithInt:v117];
                      [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
                      [qword_1F2247770 numberWithBool:v118];
                      [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
                      [dictionary setObject:v119 forKeyedSubscript:v115];
                      [dictionary setObject:v120 forKeyedSubscript:v114];
                    }

                    [(BWFigVideoCaptureDevice *)v41 _ubAddFrameParametersForDepthIfNeeded:dictionary captureFlags:v7];
                    [array3 addObject:dictionary];
                    v48 = (v50 + 1);
                    [v122 addObject:{+[BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:mainFlags:sifrFlags:](BWStillImageCaptureBracketFrameInfo, "infoWithBracketedCaptureSequenceNumber:mainFlags:sifrFlags:", v50, v45 | 0x80, 0)}];
                    ++v49;
                    v50 = v48;
                  }

                  while (v47 != v49);
                  v47 = [v111 countByEnumeratingWithState:v131 objects:v130 count:16];
                }

                while (v47);
              }
            }

            else
            {
              OUTLINED_FUNCTION_95_0();
              v62 = OUTLINED_FUNCTION_281(v54, v55, v56, v57, v58, v59, v60, v61, v90, v92, v94, v95, v96, v97, v98, obj, v100, v101, v102, v103, array2, v105, v106, v107, v37, v36, v110);
              v63 = v122;
              if (v62)
              {
                v64 = v62;
                v65 = 1;
                do
                {
                  v66 = 0;
                  v67 = v65;
                  do
                  {
                    OUTLINED_FUNCTION_89();
                    if (!v51)
                    {
                      objc_enumerationMutation(v110);
                    }

                    v68 = *(8 * v66);
                    dictionary2 = [MEMORY[0x1E695DF90] dictionary];
                    [dictionary2 setObject:&unk_1F22469D8 forKeyedSubscript:v125];
                    [dictionary2 setObject:&unk_1F22469C0 forKeyedSubscript:v124];
                    [v68 objectForKeyedSubscript:v113];
                    [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
                    [v68 objectForKeyedSubscript:v112];
                    [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
                    [dictionary2 setObject:v126 forKeyedSubscript:v123];
                    [dictionary2 setObject:MEMORY[0x1E695E110] forKeyedSubscript:v127];
                    if (v128)
                    {
                      [dictionary2 setObject:MEMORY[0x1E695E110] forKeyedSubscript:v116];
                      [OUTLINED_FUNCTION_301() numberWithInt:v117];
                      [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
                      v70 = v63[435];
                      v63 = v122;
                      [v70 numberWithBool:v118];
                      [OUTLINED_FUNCTION_47() setObject:? forKeyedSubscript:?];
                      [dictionary2 setObject:v119 forKeyedSubscript:v115];
                      [dictionary2 setObject:v120 forKeyedSubscript:v114];
                    }

                    [(BWFigVideoCaptureDevice *)v41 _ubAddFrameParametersForDepthIfNeeded:dictionary2 captureFlags:v7];
                    [array3 addObject:dictionary2];
                    v65 = (v67 + 1);
                    [BWStillImageCaptureBracketFrameInfo infoWithBracketedCaptureSequenceNumber:v67 mainFlags:v45 | 0x40 sifrFlags:0];
                    [OUTLINED_FUNCTION_8() addObject:?];
                    ++v66;
                    v67 = v65;
                  }

                  while (v64 != v66);
                  OUTLINED_FUNCTION_95_0();
                  v64 = OUTLINED_FUNCTION_281(v71, v72, v73, v74, v75, v76, v77, v78, v91, v93, v94, v95, v96, v97, v98, obj, v100, v101, v102, v103, array2, v105, v106, v107, v108, v109, v110);
                }

                while (v64);
              }
            }

            dictionary3 = [MEMORY[0x1E695DF90] dictionary];
            v10 = v41;
            [(BWFigVideoCaptureDevice *)v41 _ubAddFrameParametersForDepthIfNeeded:dictionary3 captureFlags:v7];
            if (FigCapturePlatformIdentifier() <= 6)
            {
              v11 = v102;
              v9 = v103;
              v82 = v109;
              v83 = v107;
              if (![dictionary3 count])
              {
                constituentPhotoDeliveryEnabled = [v103 constituentPhotoDeliveryEnabled];
                if (!v117 && (constituentPhotoDeliveryEnabled & 1) == 0)
                {
                  dictionary3 = 0;
                  v84 = v122;
                  goto LABEL_84;
                }
              }
            }

            else
            {
              v11 = v102;
              v9 = v103;
              v82 = v109;
              v83 = v107;
              if (v128)
              {
                [dictionary3 setObject:MEMORY[0x1E695E118] forKeyedSubscript:v127];
              }
            }

            v84 = v122;
            [v122 addObject:{OUTLINED_FUNCTION_375(BWStillImageCaptureBracketFrameInfo, v80, v81, v136)}];
LABEL_84:
            v90 = array3;
            v92 = v84;
            v85 = -[BWStillImageCaptureStreamSettings initWithPortType:captureType:captureFlags:referenceFrameIndex:timeMachineBracketedCaptureParams:preBracketFrameCaptureParams:unifiedBracketedCaptureParams:frameInfos:]([BWStillImageCaptureStreamSettings alloc], "initWithPortType:captureType:captureFlags:referenceFrameIndex:timeMachineBracketedCaptureParams:preBracketFrameCaptureParams:unifiedBracketedCaptureParams:frameInfos:", [v108 portType], 7, v83, 0xFFFFFFFFLL, 0, dictionary3);
            [v9 lensStabilizationDuringBracketEnabled];
            [OUTLINED_FUNCTION_8() setLensStabilizationEnabledForClientBracket:?];
            [array2 addObject:v85];

            v36 = v82 + 1;
            v28 = v111;
            if (v36 == v106)
            {
              OUTLINED_FUNCTION_336();
              v87 = [obj countByEnumeratingWithState:? objects:? count:?];
              v106 = v87;
              if (!v87)
              {
                goto LABEL_90;
              }

              goto LABEL_40;
            }
          }
        }

LABEL_12:
        HIDWORD(v105) = 0;
        firstObject = v11;
        goto LABEL_13;
      }

      array = obj;
    }

    [array addObject:v11];
    goto LABEL_12;
  }

LABEL_19:
  OUTLINED_FUNCTION_81();
}

- (void)_ubFlashStillImageCaptureSettingsWithID:(uint64_t)d captureType:(uint64_t)type captureFlags:(uint64_t)flags sceneFlags:(uint64_t)sceneFlags frameStatisticsByPortType:(uint64_t)portType deliverSushiRaw:(uint64_t)raw bravoConstituentImageDeliveryDeviceTypes:(uint64_t)types
{
  OUTLINED_FUNCTION_84();
  a19 = v20;
  a20 = v27;
  v93 = v28;
  v106 = v29;
  if (v21)
  {
    v30 = v26;
    v31 = v25;
    v32 = v24;
    v33 = v23;
    v34 = v22;
    v35 = v21;
    if (!_FigIsNotCurrentDispatchQueue())
    {
      OUTLINED_FUNCTION_2_9();
      OUTLINED_FUNCTION_2_5();
      FigDebugAssert3();
    }

    if (v33 != 2)
    {
      FigCaptureGetFrameworkRadarComponent();
      OUTLINED_FUNCTION_81_2();
      OUTLINED_FUNCTION_68_4();
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      OUTLINED_FUNCTION_58(os_log_and_send_and_compose_flags_and_os_log_type);
      OUTLINED_FUNCTION_115_0();
      if (v69)
      {
        v70 = v68;
      }

      else
      {
        v70 = v30;
      }

      if (v70)
      {
        v115 = 136315394;
        v116 = "[BWFigVideoCaptureDevice _ubFlashStillImageCaptureSettingsWithID:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:]";
        v117 = 2112;
        v118 = BWPhotoEncoderStringFromEncodingScheme(v33);
        OUTLINED_FUNCTION_34_16();
        OUTLINED_FUNCTION_4_4();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_8_1();
      OUTLINED_FUNCTION_13_0();
      v119 = 138412290;
      v120 = BWPhotoEncoderStringFromEncodingScheme(v33);
      OUTLINED_FUNCTION_43_0();
      OUTLINED_FUNCTION_5_61();
      v74 = _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_11();
      OUTLINED_FUNCTION_44();
      OUTLINED_FUNCTION_10();
      FigCapturePleaseFileRadar(v75, v76, v77, v78, v79, 21706, v80, v81, &a19 + 16);
      v82 = v74;
      goto LABEL_60;
    }

    v107 = v35[174];
    if (!v107)
    {
      v107 = v35[75];
    }

    array = [MEMORY[0x1E695DF70] array];
    if (!v35[81])
    {
      goto LABEL_10;
    }

    if ((v32 & 0x800) != 0)
    {
      [BWFigVideoCaptureDevice _captureStreamsForDepthDataDeliveryOrStereoPhotoCaptureWithPrimaryCaptureStream:v35];
      [OUTLINED_FUNCTION_8() addObjectsFromArray:?];
    }

    else
    {
      if (![v93 count])
      {
LABEL_10:
        [array addObject:v107];
        goto LABEL_11;
      }

      v66 = [(BWFigVideoCaptureDevice *)v35 _captureStreamsForBravoConstituentImageDeliveryDeviceTypes:v93];
      [array addObjectsFromArray:v66];
      if (([v66 containsObject:v107] & 1) == 0)
      {
        [array addObject:v107];
        v105 = 1;
        if ((v32 & 8) == 0)
        {
LABEL_12:
          if ([array count] == 1 || v35[195])
          {
            goto LABEL_14;
          }

          FigCaptureGetFrameworkRadarComponent();
          OUTLINED_FUNCTION_81_2();
          OUTLINED_FUNCTION_68_4();
          v71 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          OUTLINED_FUNCTION_58(v71);
          OUTLINED_FUNCTION_115_0();
          if (v69)
          {
            v73 = v72;
          }

          else
          {
            v73 = v30;
          }

          if (v73)
          {
            v115 = 136315394;
            v116 = "[BWFigVideoCaptureDevice _ubFlashStillImageCaptureSettingsWithID:captureType:captureFlags:sceneFlags:frameStatisticsByPortType:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:]";
            v117 = 2112;
            v118 = BWStillImageCaptureFrameFlagsToShortString(v32);
            OUTLINED_FUNCTION_34_16();
            OUTLINED_FUNCTION_4_4();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_8_1();
          OUTLINED_FUNCTION_13_0();
          v119 = 138412290;
          v120 = BWStillImageCaptureFrameFlagsToShortString(v32);
          OUTLINED_FUNCTION_43_0();
          OUTLINED_FUNCTION_5_61();
          _os_log_send_and_compose_impl();
          OUTLINED_FUNCTION_13_18();
          v83 = OUTLINED_FUNCTION_6_1();
          FigCapturePleaseFileRadar(v83, v84, v85, v86, v87, 21738, v88, v89, &a19 + 16);
          v82 = v32;
LABEL_60:
          free(v82);
          v64 = 0;
LABEL_42:
          v65 = v64;
          goto LABEL_43;
        }

LABEL_14:
        v91 = v30;
        v92 = v31;
        v113 = 0;
        v114 = 0;
        v103 = [(BWFigVideoCaptureDevice *)v35 _ubEnabledOutputsForCaptureFlags:v32 captureType:2 baseCaptureFrameFlagsOut:&v114 discardCaptureFrameFlagsOut:&v113];
        array2 = [MEMORY[0x1E695DF70] array];
        OUTLINED_FUNCTION_317();
        firstObject = v107;
        v108 = OUTLINED_FUNCTION_64(v37, v38, v39, v40);
        if (v108)
        {
          v101 = MEMORY[0];
          v94 = v32 & 0xFFFFFFFFFFFF7FFFLL;
          v95 = *off_1E798BD50;
          v100 = *off_1E798C698;
          v98 = *off_1E798C918;
          v42 = *off_1E798C648;
          v102 = v35;
          v99 = v32;
          obj = array;
          v97 = *off_1E798C648;
          v109 = *off_1E798C608;
          do
          {
            v43 = 0;
            do
            {
              if (MEMORY[0] != v101)
              {
                objc_enumerationMutation(obj);
              }

              v110 = v43;
              v44 = *(8 * v43);
              v45 = v103;
              if (v44 == v35[195])
              {
                v45 = &unk_1F22469F0;
              }

              v111 = v45;
              v46 = v32;
              if ((v32 & 0x8000) != 0)
              {
                if ([objc_msgSend(objc_msgSend(v44 "stream")])
                {
                  v46 = v32;
                }

                else
                {
                  v46 = v94;
                }
              }

              if ((v106 & 0x10000000) != 0)
              {
                [firstObject portType];
                v47 = [objc_msgSend(OUTLINED_FUNCTION_37_0() "objectForKeyedSubscript:"macroFlashQSubSwitchingEnabled"")];
              }

              else
              {
                v47 = 0;
              }

              if ((v46 & 0x100000010) == 0x10 && (v47 & 1) == 0 && [v44 activeQuadraBinningFactor] != 1)
              {
                v46 &= 0xFFFFFFFEFFFFFFEFLL;
              }

              array3 = [MEMORY[0x1E695DF70] array];
              array4 = [MEMORY[0x1E695DF70] array];
              v112 = v44;
              if ((v32 & 8) != 0)
              {
                if (v44 != firstObject)
                {
                  [v93 count];
                }

                v53 = 0x1E695D000uLL;
                dictionary = [MEMORY[0x1E695DF90] dictionary];
                v51 = v100;
                [dictionary setObject:&unk_1F22469D8 forKeyedSubscript:v100];
                v52 = v98;
                [dictionary setObject:&unk_1F2246A98 forKeyedSubscript:v98];
                [dictionary setObject:&unk_1F2246990 forKeyedSubscript:v42];
                [dictionary setObject:v111 forKeyedSubscript:v109];
                [array3 addObject:dictionary];
                p_cache = &OBJC_METACLASS___BWEspressoInferenceAdapter.cache;
                OUTLINED_FUNCTION_373(BWStillImageCaptureBracketFrameInfo, v56, 1);
                [OUTLINED_FUNCTION_47() addObject:?];
                v50 = 2;
              }

              else
              {
                v50 = 1;
                v51 = v100;
                v52 = v98;
                v53 = 0x1E695D000;
                p_cache = (&OBJC_METACLASS___BWEspressoInferenceAdapter + 16);
              }

              dictionary2 = [*(v53 + 3984) dictionary];
              [dictionary2 setObject:&unk_1F22469D8 forKeyedSubscript:v51];
              [dictionary2 setObject:&unk_1F2246AB0 forKeyedSubscript:v52];
              [dictionary2 setObject:&unk_1F2246990 forKeyedSubscript:v97];
              [OUTLINED_FUNCTION_86() setObject:? forKeyedSubscript:?];
              [OUTLINED_FUNCTION_39() addObject:?];
              OUTLINED_FUNCTION_373(p_cache + 398, v58, v50);
              [OUTLINED_FUNCTION_47() addObject:?];
              v59 = -[BWStillImageCaptureStreamSettings initWithPortType:captureType:captureFlags:referenceFrameIndex:timeMachineBracketedCaptureParams:preBracketFrameCaptureParams:unifiedBracketedCaptureParams:frameInfos:]([BWStillImageCaptureStreamSettings alloc], "initWithPortType:captureType:captureFlags:referenceFrameIndex:timeMachineBracketedCaptureParams:preBracketFrameCaptureParams:unifiedBracketedCaptureParams:frameInfos:", [v112 portType], 2, v46, 0xFFFFFFFFLL, 0, 0, array3, array4);
              [array2 addObject:v59];

              v43 = v110 + 1;
              firstObject = v107;
              v35 = v102;
              v32 = v99;
              v42 = v97;
            }

            while (v108 != v110 + 1);
            OUTLINED_FUNCTION_317();
            array = obj;
            v108 = OUTLINED_FUNCTION_64(v60, v61, v62, v63);
          }

          while (v108);
        }

        LOBYTE(v90) = v91;
        v64 = [[BWStillImageCaptureSettings alloc] initWithSettingsID:v34 captureType:2 captureFlags:v32 sceneFlags:v106 frameStatisticsByPortType:v92 deliverOriginalImage:0 deliverSushiRaw:v90 captureStreamSettings:array2];
        if (v105)
        {
          firstObject = [array firstObject];
        }

        [firstObject portType];
        [OUTLINED_FUNCTION_17() setMasterPortType:?];
        goto LABEL_42;
      }
    }

LABEL_11:
    v105 = 0;
    if ((v32 & 8) == 0)
    {
      goto LABEL_12;
    }

    goto LABEL_14;
  }

LABEL_43:
  OUTLINED_FUNCTION_81();
}

- (uint64_t)_ubWhiteBalanceMetadataByPortTypeFromFrameStatistics:(uint64_t)statistics masterPortType:(void *)type
{
  dictionary = 0;
  if (statistics)
  {
    if (type)
    {
      dictionary = [MEMORY[0x1E695DF90] dictionary];
      v4 = [OUTLINED_FUNCTION_40() objectForKeyedSubscript:?];
      if (v4)
      {
        v5 = v4;
        awbStable = [v4 awbStable];
        awbLocked = [v5 awbLocked];
        v44[0] = MEMORY[0x1E69E9820];
        v44[1] = 3221225472;
        v45 = __95__BWFigVideoCaptureDevice__ubWhiteBalanceMetadataByPortTypeFromFrameStatistics_masterPortType___block_invoke;
        v46 = &__block_descriptor_34_e41___NSDictionary_16__0__BWFrameStatistics_8l;
        v47 = awbStable;
        v48 = awbLocked;
        OUTLINED_FUNCTION_28_17();
        if (OUTLINED_FUNCTION_37(v8, v9, v10, v11))
        {
          OUTLINED_FUNCTION_125_4();
          v13 = *v12;
          do
          {
            v14 = 0;
            do
            {
              OUTLINED_FUNCTION_4_10();
              if (v15 != v13)
              {
                objc_enumerationMutation(type);
              }

              v16 = [type objectForKeyedSubscript:*(v43 + 8 * v14)];
              v45(v44, v16);
              v17 = [OUTLINED_FUNCTION_17() setObject:? forKeyedSubscript:?];
              v14 = v14 + 1;
            }

            while (v5 != v14);
            v5 = OUTLINED_FUNCTION_1_3(v17, v18, v19, v20, v21, v22, v23, v24, v26, v27, v28, v29, v30, v31, v32, v33, v34, v35, v36, v37, v38, v39, v40, v41, v42);
          }

          while (v5);
        }
      }
    }
  }

  return dictionary;
}

- (BOOL)_ubDeliverDeferredPhotoProxyImageForCaptureType:(uint64_t)type captureFlags:(int)flags autoDeferredProcessingEnabled:
{
  if (result)
  {
    v4 = result;
    result = 0;
    if ((type & 0x40000) == 0)
    {
      if (flags)
      {
        if ((a2 - 12) >= 2)
        {
          if (a2 == 1)
          {
            result = 0;
            if ((type & 0x80) != 0 && (type & 0x10100000000) != 0)
            {
              return (*(v4 + 2260) & 0xA) != 0;
            }
          }

          else
          {
            return 0;
          }
        }

        else
        {
          return 1;
        }
      }
    }
  }

  return result;
}

- (unint64_t)_ubDigitalFlashSceneFlagsForCaptureStream:(uint64_t)stream frameStatisticsByPortType:(int)type sphereAvailable:(int)available fusionEnabled:(int)enabled sceneMonitoring:
{
  if (!self)
  {
    return 0;
  }

  OUTLINED_FUNCTION_54();
  [v11 portType];
  v12 = [OUTLINED_FUNCTION_7() objectForKeyedSubscript:?];
  [v7 portType];
  v13 = [OUTLINED_FUNCTION_36() objectForKeyedSubscript:?];
  [v12 integrationTime];
  v15 = v14;
  [v12 gain];
  v17 = v15 * v16;
  v18 = 1.0;
  if ([v12 aeTarget] && objc_msgSend(v12, "aeAverage"))
  {
    aeTarget = [v12 aeTarget];
    v18 = aeTarget / [v12 aeAverage];
  }

  [v12 exposureBias];
  v21 = v17 * v18 / exp2(v20);
  if (enabled)
  {
    v22 = *(v6 + 2408);
    if (v22 != 0.0 && v21 < v22)
    {
      OUTLINED_FUNCTION_300();
      if (v25 < 0.2)
      {
        v21 = v24;
      }
    }

    *(v6 + 2408) = v21;
  }

  [v13 digitalFlashRecommendRegularFlashSNRThreshold];
  v27 = v26;
  [v13 digitalFlashBacklitRecommendRegularFlashSNRThreshold];
  v29 = v28;
  if (!available)
  {
    [v12 normalizedSNR];
LABEL_18:
    v31 = v30;
    if (!enabled)
    {
      goto LABEL_29;
    }

LABEL_21:
    v33 = *(v6 + 2416);
    if (v33 != 0.0 && v33 < v31)
    {
      OUTLINED_FUNCTION_300();
      if (v36 < 0.15)
      {
        v31 = v35;
      }
    }

    *(v6 + 2416) = v31;
    goto LABEL_29;
  }

  if (type)
  {
    fvcd_estimateOISOutputImageSNR(v12);
    goto LABEL_18;
  }

  [v12 normalizedSNR];
  v31 = v32 + 4.7712;
  if (enabled)
  {
    goto LABEL_21;
  }

LABEL_29:
  [v13 digitalFlashAvailableEffectiveIntegrationTimeThreshold];
  v38 = v37;
  [v13 digitalFlashRecommendedEffectiveIntegrationTimeThreshold];
  if (v21 >= v39)
  {
    v40 = ((v21 >= v38) << 10) | 0x800;
  }

  else
  {
    v40 = (v21 >= v38) << 10;
  }

  if (v31 < v29 && [v12 aeFaceAverage])
  {
    aeFaceAverage = [v12 aeFaceAverage];
    v42 = aeFaceAverage - [v12 aeAverage];
    v43 = v42 / [v12 aeAverage];
    if (enabled)
    {
      v44 = *(v6 + 2432);
      if (v44)
      {
        [v44 addDataPoint:v43];
        [*(v6 + 2432) average];
        v43 = v45;
        v46 = *(v6 + 2424);
        if (v46 != 0.0 && fabs((v46 - v43) / ((v46 + v43) * 0.5)) < 0.1)
        {
          v43 = v46;
        }

        *(v6 + 2424) = v43;
      }
    }

    [v13 digitalFlashBacklitRecommendRegularFlashAERelativeDifferenceThreshold];
    if (v43 <= v47)
    {
      v40 |= 0x20000uLL;
    }
  }

  if (v31 < v27)
  {
    v40 |= 0x8000uLL;
  }

  return v40;
}

- (uint64_t)_ubIsDigitalFlashCaptureForSettings:(__int16)settings sceneFlags:
{
  if (result)
  {
    OUTLINED_FUNCTION_54();
    digitalFlashMode = [v6 digitalFlashMode];
    OUTLINED_FUNCTION_3_19();
    [BWFigVideoCaptureDevice _ubDeliverDepthDataForSettings:speedOverQuality:sceneFlags:];
    v9 = v8;
    result = 0;
    if ((settings & 0x4000) == 0 && digitalFlashMode >= 1)
    {
      constituentPhotoDeliveryEnabled = [v4 constituentPhotoDeliveryEnabled];
      v11 = constituentPhotoDeliveryEnabled;
      result = constituentPhotoDeliveryEnabled ^ 1u;
      if ((v11 & 1) == 0 && ((v9 ^ 1) & 1) == 0)
      {
        return *(v3 + 2488) != 0;
      }
    }
  }

  return result;
}

- (BOOL)_ubIsFlashAvailable
{
  if (!self || *(self + 2172) != 1)
  {
    return 0;
  }

  FigSimpleMutexLock();
  v2 = *(self + 2628) > 0.0;
  FigSimpleMutexUnlock();
  return v2;
}

- (void)_ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:
{
  OUTLINED_FUNCTION_60();
  v123 = v4;
  v127 = v5;
  obj = v6;
  if (!v0)
  {
    goto LABEL_72;
  }

  v7 = v3;
  v8 = v2;
  v9 = v1;
  v10 = v0;
  v213[0] = 0;
  os_unfair_lock_lock(v0 + 678);
  *(v10 + 2224) = [v8 settingsID];
  os_unfair_lock_unlock((v10 + 2712));
  if (v7)
  {
    if ([(BWFigVideoCaptureDevice *)v10 _ubZeroShutterLagCancelWaitingForTimeMachines])
    {
      goto LABEL_75;
    }

    [v9 portType];
    [objc_msgSend(OUTLINED_FUNCTION_4() "objectForKeyedSubscript:"currentFrameRate"")];
    if (v11 == 0.0)
    {
      v91 = 0;
      v116 = 7;
      goto LABEL_66;
    }

    os_unfair_lock_lock((v10 + 2712));
    type.value = *(v10 + 2784);
    type.timescale = *(v10 + 2792);
    v12 = *(v10 + 2796);
    v13 = *(v10 + 2800);
    os_unfair_lock_unlock((v10 + 2712));
    if (v12)
    {
      memset(time, 0, 24);
      CMTimeMake(&v210.start, 1, 1000);
      lhs.value = type.value;
      *&lhs.timescale = __PAIR64__(v12, type.timescale);
      lhs.epoch = v13;
      v14 = CMTimeAdd(&time[0].start, &lhs, &v210.start);
      [v10 setZeroShutterLagEarliestAllowedPTS:{&v210, OUTLINED_FUNCTION_138_2(v14, v15, v16, v17, v18, v19, v20, v21, p_lhs, v121, v123, v125, v127, v129, v133, v138, obj, v144, v149, v151, v153, v155, v157, v159, v161, v163, v165, v167, v169, v171, v173, v175, v177, v179, v181, v183, v185, v187, v189, v191, v193, v195, type.value, *&type.timescale, type.epoch, v198, lhs.value, *&lhs.timescale, lhs.epoch, v200, v201, *(&v201 + 1), v22, time[0].start.value).n128_f64[0]}];
      if (dword_1ED844350)
      {
        OUTLINED_FUNCTION_254();
        v23 = OUTLINED_FUNCTION_170();
        os_log_type_enabled(v23, v211);
        OUTLINED_FUNCTION_30();
        if (v8)
        {
          OUTLINED_FUNCTION_138_2(v24, v25, v26, v27, v28, v29, v30, v31, p_lhs, v121, v123, v125, v127, v130, v134, v139, obj, v145, v149, v151, v153, v155, v157, v159, v161, v163, v165, v167, v169, v171, v173, v175, v177, v179, v181, v183, v185, v187, v189, v191, v193, v195, type.value, *&type.timescale, type.epoch, v198, lhs.value, *&lhs.timescale, lhs.epoch, v200, v201, *(&v201 + 1), v32, time[0].start.value);
          Seconds = CMTimeGetSeconds(&v210.start);
          LODWORD(lhs.value) = 136315394;
          *(&lhs.value + 4) = "[BWFigVideoCaptureDevice _ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:]";
          LOWORD(lhs.flags) = 2048;
          *(&lhs.flags + 2) = Seconds;
          OUTLINED_FUNCTION_34_16();
          p_lhs = &lhs;
          OUTLINED_FUNCTION_8_0();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        fig_log_call_emit_and_clean_up_after_send_and_compose();
      }
    }

    [objc_msgSend(v9 stillImageCaptureDelegate];
    OUTLINED_FUNCTION_35_3();
    if (v36)
    {
      *&v34 = v35;
    }

    if (![*(v10 + 2200) waitUntilCapacity:*(v10 + 3456) timeout:v34])
    {
      v91 = 0;
      v116 = 16;
      goto LABEL_66;
    }
  }

  if (![(BWFigVideoCaptureDevice *)v10 _ubZeroShutterLagCancelWaitingForTimeMachines])
  {
    v37 = FigCapturePlatformIdentifier();
    [*(v10 + 600) stream];
    if (v37 < 10)
    {
      v38 = [OUTLINED_FUNCTION_40() sendCommandProperty:?];
    }

    else
    {
      v208 = *off_1E798C7A8;
      v209 = MEMORY[0x1E695E118];
      [MEMORY[0x1E695DF20] dictionaryWithObjects:&v209 forKeys:&v208 count:1];
      v38 = [OUTLINED_FUNCTION_40() setProperty:? value:?];
    }

    v213[0] = v38;
    if (v38)
    {
      OUTLINED_FUNCTION_1_5();
      FigDebugAssert3();
      v91 = 0;
      v116 = 1;
      goto LABEL_66;
    }

    stream = [v9 stream];
    v146 = *off_1E798C1F8;
    v40 = [stream getProperty:? error:?];
    if (v213[0])
    {
      OUTLINED_FUNCTION_14_21();
      FigDebugAssert3();
      v91 = 0;
      v116 = 2;
      goto LABEL_66;
    }

    v131 = v10;
    memset(&v207, 0, sizeof(v207));
    CMTimeRangeMakeFromDictionary(&v207, v40);
    if (dword_1ED844350)
    {
      LODWORD(lhs.value) = 0;
      LOBYTE(type.value) = 0;
      os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
      value = lhs.value;
      os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
      OUTLINED_FUNCTION_97_0();
      if (v44)
      {
        v45 = v43;
      }

      else
      {
        v45 = value;
      }

      if (v45)
      {
        *&v210.start.value = *&v207.start.value;
        v210.start.epoch = v207.start.epoch;
        v46 = CMTimeGetSeconds(&v210.start);
        OUTLINED_FUNCTION_136_3();
        CMTimeRangeGetEnd(&time[0].start, &v210);
        *&v47 = CMTimeGetSeconds(&time[0].start);
        LODWORD(time[0].start.value) = 136315650;
        *(&time[0].start.value + 4) = "[BWFigVideoCaptureDevice _ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:]";
        LOWORD(time[0].start.flags) = 2048;
        *(&time[0].start.flags + 2) = v46;
        HIWORD(time[0].start.epoch) = 2048;
        time[0].duration.value = v47;
        OUTLINED_FUNCTION_29_12();
        p_lhs = time;
        OUTLINED_FUNCTION_8_0();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_128();
    }

    v205 = 0u;
    v206 = 0u;
    v203 = 0u;
    v204 = 0u;
    OUTLINED_FUNCTION_102_4();
    v48 = [obj countByEnumeratingWithState:? objects:? count:?];
    if (v48)
    {
      v50 = v48;
      *&v49 = 136315906;
      v135 = v49;
      while (2)
      {
        for (i = 0; i != v50; ++i)
        {
          OUTLINED_FUNCTION_42();
          if (!v44)
          {
            objc_enumerationMutation(obj);
          }

          v52 = *(*(&v203 + 1) + 8 * i);
          if (v52 != v9)
          {
            v53 = [objc_msgSend(*(*(&v203 + 1) + 8 * i) "stream")];
            if (v213[0])
            {
              OUTLINED_FUNCTION_14_21();
              FigDebugAssert3();
              v91 = 0;
              v116 = 2;
              goto LABEL_65;
            }

            memset(time, 0, 48);
            CMTimeRangeMakeFromDictionary(time, v53);
            if (dword_1ED844350)
            {
              LODWORD(type.value) = 0;
              v212 = OS_LOG_TYPE_DEFAULT;
              v54 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
              v55 = type.value;
              os_log_type_enabled(v54, v212);
              OUTLINED_FUNCTION_286();
              if (v44)
              {
                v57 = v56;
              }

              else
              {
                v57 = v55;
              }

              if (v57)
              {
                portType = [v52 portType];
                v60 = BWPortTypeToDisplayString(portType, v59);
                OUTLINED_FUNCTION_138_2(v60, v61, v62, v63, v64, v65, v66, v67, p_lhs, v121, v123, v125, v127, v131, v135, *(&v135 + 1), obj, v146, v149, v151, v153, v155, v157, v159, v161, v163, v165, v167, v169, v171, v173, v175, v177, v179, v181, v183, v185, v187, v189, v191, v193, v195, type.value, *&type.timescale, type.epoch, v198, lhs.value, *&lhs.timescale, lhs.epoch, v200, v201, *(&v201 + 1), v68, time[0].start.value);
                v69.n128_f64[0] = CMTimeGetSeconds(&v210.start);
                v70 = v69.n128_u64[0];
                OUTLINED_FUNCTION_290(v71, v72, v73, v74, v75, v76, v77, v78, v119, v122, v124, v126, v128, v132, v136, v140, objb, v147, v150, v152, v154, v156, v158, v160, v162, v164, v166, v168, v170, v172, v174, v176, v178, v180, v182, v184, v186, v188, v190, v192, v194, v196, type.value, *&type.timescale, type.epoch, v198, lhs.value, *&lhs.timescale, lhs.epoch, v200, v201, *(&v201 + 1), *&time[0].start.value, *&time[0].start.epoch, v69);
                CMTimeRangeGetEnd(&lhs, &v210);
                v79 = CMTimeGetSeconds(&lhs);
                LODWORD(lhs.value) = v135;
                *(&lhs.value + 4) = "[BWFigVideoCaptureDevice _ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:]";
                LOWORD(lhs.flags) = 2112;
                *(&lhs.flags + 2) = v60;
                HIWORD(lhs.epoch) = 2048;
                v200 = v70;
                LOWORD(v201) = 2048;
                *(&v201 + 2) = v79;
                LODWORD(v121) = 42;
                p_lhs = &lhs;
                OUTLINED_FUNCTION_13();
                _os_log_send_and_compose_impl();
              }

              OUTLINED_FUNCTION_2_4();
              OUTLINED_FUNCTION_371();
            }

            lhs = v207.start;
            type = time[0].start;
            CMTimeSubtract(&v210.start, &lhs, &type);
            if (fabs(CMTimeGetSeconds(&v210.start)) > 0.004 || (OUTLINED_FUNCTION_136_3(), End = CMTimeRangeGetEnd(&lhs, &v210), OUTLINED_FUNCTION_290(End, v81, v82, v83, v84, v85, v86, v87, p_lhs, v121, v123, v125, v127, v131, v135, *(&v135 + 1), obj, v146, v149, v151, v153, v155, v157, v159, v161, v163, v165, v167, v169, v171, v173, v175, v177, v179, v181, v183, v185, v187, v189, v191, v193, v195, type.value, *&type.timescale, type.epoch, v198, lhs.value, *&lhs.timescale, lhs.epoch, v200, v201, *(&v201 + 1), *&time[0].start.value, *&time[0].start.epoch, v88), CMTimeRangeGetEnd(&type, &v210), CMTimeSubtract(&v210.start, &lhs, &type), fabs(CMTimeGetSeconds(&v210.start)) > 0.004))
            {
              v91 = 0;
              v116 = 12;
              goto LABEL_65;
            }
          }
        }

        OUTLINED_FUNCTION_102_4();
        v50 = [obj countByEnumeratingWithState:? objects:? count:?];
        if (v50)
        {
          continue;
        }

        break;
      }
    }

    v10 = v131;
    if (![(BWFigVideoCaptureDevice *)v131 _ubZeroShutterLagCancelWaitingForTimeMachines])
    {
      v89 = OUTLINED_FUNCTION_136_3();
      v89.n128_u32[0] = 1.0;
      v91 = [v90 metadataForPTSRange:&v210 timeout:v89.n128_f64[0]];
      if ([v91 count])
      {
        if ([v91 count])
        {
          v92 = 0;
          v148 = *off_1E798B720;
          obja = *off_1E798B540;
          v137 = *off_1E798A420;
          do
          {
            v93 = [OUTLINED_FUNCTION_39() objectAtIndexedSubscript:?];
            v94 = [v93 objectForKeyedSubscript:v148];
            v95 = MEMORY[0x1E696AD60];
            v96 = [v93 objectForKeyedSubscript:obja];
            v97 = [v95 stringWithFormat:@"[%@]", __197__BWFigVideoCaptureDevice__ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream_captureStreams_settings_frameStatisticsByPortType_waitForTimeMachineToFill_failureReasonOut___block_invoke(v96, v96, v93)];
            OUTLINED_FUNCTION_346();
            OUTLINED_FUNCTION_59_7();
            v102 = OUTLINED_FUNCTION_273(v98, v99, v100, v101);
            if (v102)
            {
              v103 = v102;
              do
              {
                for (j = 0; j != v103; ++j)
                {
                  OUTLINED_FUNCTION_42();
                  if (!v44)
                  {
                    objc_enumerationMutation(v94);
                  }

                  v105 = *(v183 + 8 * j);
                  v106 = [v94 objectForKeyedSubscript:v105];
                  [v97 appendFormat:@", [%@]", __197__BWFigVideoCaptureDevice__ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream_captureStreams_settings_frameStatisticsByPortType_waitForTimeMachineToFill_failureReasonOut___block_invoke(v106, v105, v106)];
                }

                OUTLINED_FUNCTION_59_7();
                v103 = OUTLINED_FUNCTION_273(v107, v108, v109, v110);
              }

              while (v103);
            }

            memset(&lhs, 0, sizeof(lhs));
            CMTimeMakeFromDictionary(&lhs, [v93 objectForKeyedSubscript:v137]);
            if (dword_1ED844350)
            {
              LODWORD(type.value) = 0;
              v212 = OS_LOG_TYPE_DEFAULT;
              v111 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
              v112 = type.value;
              os_log_type_enabled(v111, v212);
              OUTLINED_FUNCTION_97_0();
              if (v44)
              {
                v114 = v113;
              }

              else
              {
                v114 = v112;
              }

              if (v114)
              {
                v210.start = lhs;
                v115 = CMTimeGetSeconds(&v210.start);
                LODWORD(time[0].start.value) = 136315906;
                *(&time[0].start.value + 4) = "[BWFigVideoCaptureDevice _ubSuspendTimeMachinesAndGetTimeMachineFramesMetadataWithPrimaryCaptureStream:captureStreams:settings:frameStatisticsByPortType:waitForTimeMachineToFill:failureReasonOut:]";
                LOWORD(time[0].start.flags) = 1026;
                *(&time[0].start.flags + 2) = v92;
                WORD1(time[0].start.epoch) = 2050;
                *(&time[0].start.epoch + 4) = v115;
                WORD2(time[0].duration.value) = 2114;
                *(&time[0].duration.value + 6) = v97;
                LODWORD(v121) = 38;
                v120 = time;
                OUTLINED_FUNCTION_11_0();
                _os_log_send_and_compose_impl();
              }

              OUTLINED_FUNCTION_2_4();
              OUTLINED_FUNCTION_128();
            }

            ++v92;
          }

          while ([v91 count] > v92);
          v116 = 0;
LABEL_65:
          v10 = v131;
        }

        else
        {
          v116 = 0;
        }
      }

      else
      {
        v116 = 17;
      }

      goto LABEL_66;
    }
  }

LABEL_75:
  v91 = 0;
  v116 = 15;
LABEL_66:
  os_unfair_lock_lock((v10 + 2712));
  *(v10 + 2224) = 0;
  os_unfair_lock_unlock((v10 + 2712));
  if (v127)
  {
    *v127 = v116;
  }

  if ([v91 count])
  {
    v117 = v91;
  }

  else if (*(v10 + 3448) == 1)
  {
    [*(v10 + 3344) resume];
    [objc_msgSend(*(v10 + 600) "stream")];
  }

LABEL_72:
  OUTLINED_FUNCTION_128_0();
}

- (uint64_t)_ubIsTimeMachineFramesUsableForHDRUsingTimeMachineFramesMetadata:(uint64_t)metadata portTypes:(uint64_t)types sifrFlickerDetectionEnabled:(_BYTE *)enabled sifrFlickerDetected:
{
  if (!result)
  {
    return result;
  }

  if (!a2)
  {
    return 1;
  }

  v6 = result;
  v7 = *(result + 1392);
  if (!v7)
  {
    v7 = *(v6 + 600);
  }

  [v7 portType];
  if (![OUTLINED_FUNCTION_17() objectForKeyedSubscript:?])
  {
    FigCaptureGetFrameworkRadarComponent();
    v28 = 0;
    type[0] = OS_LOG_TYPE_DEFAULT;
    OUTLINED_FUNCTION_116_5();
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v13 = os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
    if (OUTLINED_FUNCTION_6(v13))
    {
      v24 = 136315138;
      v25 = "[BWFigVideoCaptureDevice _ubIsTimeMachineFramesUsableForHDRUsingTimeMachineFramesMetadata:portTypes:sifrFlickerDetectionEnabled:sifrFlickerDetected:]";
      OUTLINED_FUNCTION_43_0();
      v21 = &v24;
      OUTLINED_FUNCTION_8_0();
      _os_log_send_and_compose_impl();
    }

    OUTLINED_FUNCTION_5_3();
    OUTLINED_FUNCTION_17_8();
    v27[0] = 0;
    OUTLINED_FUNCTION_16_14();
    OUTLINED_FUNCTION_5_61();
    _os_log_send_and_compose_impl();
    OUTLINED_FUNCTION_13_18();
    v14 = OUTLINED_FUNCTION_6_1();
    FigCapturePleaseFileRadar(v14, v15, v16, v17, v18, 23041, v19, v20, v21);
    free(v27);
    return 0;
  }

  if (![a2 count])
  {
LABEL_15:
    if (enabled)
    {
      *enabled = 0;
    }

    return 1;
  }

  v8 = 0;
  v23 = *off_1E798B298;
  v9 = *off_1E798B5F0;
  while (1)
  {
    v10 = [OUTLINED_FUNCTION_351() objectAtIndexedSubscript:?];
    if (([objc_msgSend(v10 objectForKeyedSubscript:{0x1F216F0F0), "BOOLValue"}] & 1) == 0)
    {
      break;
    }

    if ([a2 count] <= ++v8)
    {
      goto LABEL_15;
    }
  }

  if ((*(v6 + 2184) & 1) != 0 || ([objc_msgSend(v10 objectForKeyedSubscript:{v23), "doubleValue"}], result = 0, v11 >= 0.0) && v11 <= 0.0)
  {
    result = [v10 objectForKeyedSubscript:v9];
    if (result)
    {
      v28 = 0;
      *type = 0;
      FigCaptureComputeImageGainFromMetadata();
    }
  }

  return result;
}

- (uint64_t)_ubEVZeroCountForCaptureType:(char)type sceneFlags:(int)flags captureFlags:(void *)captureFlags frameStatistics:
{
  if (result)
  {
    switch(a2)
    {
      case 13:
        if ((flags & 0x400000) != 0)
        {
          return 2;
        }

        else
        {
          return 3;
        }

      case 10:
        if ((flags & 0x100000) != 0)
        {
          v6 = 2;
        }

        else
        {
          v6 = 3;
        }

        if (!(flags & 0x100000 | (type & 0xC)))
        {
          if (*(result + 2185))
          {
            if ((flags & 0x400000) != 0)
            {
              return 3;
            }

            else
            {
              return 2;
            }
          }

          v6 = 3;
        }

        if ((flags & 0x40000) != 0)
        {
          v8 = v6;
        }

        else
        {
          v8 = v6 + 1;
        }

        if ((flags & 0x400000) != 0)
        {
          return v6;
        }

        else
        {
          return v8;
        }

      case 12:
        if ((flags & 0x100000) != 0)
        {
          v7 = *(result + 2192);
          [captureFlags portType];
          [OUTLINED_FUNCTION_8() objectForKeyedSubscript:?];
          [OUTLINED_FUNCTION_18_0() eit];
          LODWORD(result) = [v7 deepFusionHDREVZeroCountForEffectiveIntegrationTime:?];
        }

        else
        {
          LODWORD(result) = 3;
        }

        if ((*&flags & 0x400000) != 0)
        {
          return result;
        }

        else
        {
          return (result + 1);
        }

      default:
        return a2 == 1;
    }
  }

  return result;
}

- (void)_ubValidateTimeMachineFramesMetadata:(uint64_t)metadata minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:
{
  if (metadata)
  {
    OUTLINED_FUNCTION_84();
    v2 = v1;
    v4 = v3;
    v6 = v5;
    v8 = v7;
    v10 = v9;
    v12 = v11;
    v14 = v13;
    v15 = [v11 count];
    if (v15 != *(v14 + 3456))
    {
      if (dword_1ED844350)
      {
        v42 = OUTLINED_FUNCTION_80_6();
        os_log_type_enabled(v42, type);
        OUTLINED_FUNCTION_4_0();
        if (v6)
        {
          v43 = [v12 count];
          v44 = *(v14 + 3456);
          LODWORD(time2.value) = 136315650;
          *(&time2.value + 4) = "[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]";
          LOWORD(time2.flags) = 1024;
          *(&time2.flags + 2) = v43;
          WORD1(time2.epoch) = 1024;
          HIDWORD(time2.epoch) = v44;
          OUTLINED_FUNCTION_48_16();
          OUTLINED_FUNCTION_7_4();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        OUTLINED_FUNCTION_39_0();
      }

      goto LABEL_50;
    }

    v153 = v4;
    HIDWORD(v152) = v10;
    v17 = off_1E798B730;
    if (*(v14 + 1560))
    {
      if (v2)
      {
        memset(v209, 0, sizeof(v209));
        v15 = OUTLINED_FUNCTION_64(v15, v16, v209, v208);
        if (v15)
        {
          v18 = v15;
          v19 = *off_1E798B730;
          v20 = *off_1E798B3F8;
          while (2)
          {
            v21 = 0;
            do
            {
              OUTLINED_FUNCTION_32_10();
              if (!v22)
              {
                objc_enumerationMutation(v12);
              }

              [*(*(&v209[0] + 1) + 8 * v21) objectForKeyedSubscript:v19];
              [*(v14 + 1560) portType];
              v23 = [objc_msgSend(objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:{"objectForKeyedSubscript:", v20), "intValue"}")];
              if (v23 != 2)
              {
                if (dword_1ED844350)
                {
                  LODWORD(v189[0]) = 0;
                  OUTLINED_FUNCTION_87_6();
                  v57 = OUTLINED_FUNCTION_152_0();
                  v65 = OUTLINED_FUNCTION_192(v57, v58, v59, v60, v61, v62, v63, v64, v150, v151, v152, v153, v154, v155, v158, v159, v161, v162, v163, v164, v165, v166, v167, v168, v169, v170, v171, v172, v173, v174, v175, v176, v177[0], v177[1], v178, *(&v178 + 1), v179[0], v179[1], v180, *(&v180 + 1), v181, v182, OS_LOG_TYPE_DEFAULT);
                  if (OUTLINED_FUNCTION_5_2(v65))
                  {
                    LODWORD(time2.value) = 136315138;
                    OUTLINED_FUNCTION_183("[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]");
                    OUTLINED_FUNCTION_48_16();
                    OUTLINED_FUNCTION_7_4();
                    _os_log_send_and_compose_impl();
                  }

                  OUTLINED_FUNCTION_2_4();
                  OUTLINED_FUNCTION_16_1();
                }

                goto LABEL_50;
              }

              ++v21;
            }

            while (v18 != v21);
            v15 = OUTLINED_FUNCTION_64(v23, v24, v209, v208);
            v18 = v15;
            v17 = off_1E798B730;
            if (v15)
            {
              continue;
            }

            break;
          }
        }
      }
    }

    v207 = 0u;
    v206 = 0u;
    v205 = 0u;
    v204 = 0u;
    v160 = OUTLINED_FUNCTION_64(v15, v16, &v204, v203);
    if (v160)
    {
      v25 = *off_1E798B540;
      v26 = *v17;
      v156 = *off_1E798B540;
      v158 = *v205;
      v154 = *v17;
      while (2)
      {
        for (i = 0; i != v160; ++i)
        {
          OUTLINED_FUNCTION_30_6();
          if (!v22)
          {
            objc_enumerationMutation(v12);
          }

          v28 = *(*(&v204 + 1) + 8 * i);
          v29 = [v28 objectForKeyedSubscript:v25];
          if (([v8 isEqualToString:v29] & 1) == 0)
          {
            if (dword_1ED844350)
            {
              v66 = OUTLINED_FUNCTION_80_6();
              os_log_type_enabled(v66, type);
              OUTLINED_FUNCTION_115_0();
              if (v22)
              {
                v69 = v68;
              }

              else
              {
                v69 = v189[0];
              }

              if (v69)
              {
                v70 = BWPortTypeToDisplayString(v29, v67);
                BWPortTypeToDisplayString(v8, v71);
                LODWORD(time2.value) = 136315650;
                OUTLINED_FUNCTION_183("[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]");
                LOWORD(time2.flags) = 2112;
                *(v72 + 230) = v70;
                HIWORD(time2.epoch) = 2112;
                v202 = v73;
                OUTLINED_FUNCTION_48_16();
                OUTLINED_FUNCTION_7_4();
                _os_log_send_and_compose_impl();
              }

              OUTLINED_FUNCTION_2_4();
              OUTLINED_FUNCTION_13_0();
            }

            goto LABEL_50;
          }

          v30 = [v28 objectForKeyedSubscript:v26];
          memset(v200, 0, sizeof(v200));
          v32 = OUTLINED_FUNCTION_1_0(v30, v31, v200, v199);
          if (v32)
          {
            v34 = v32;
            while (2)
            {
              v35 = 0;
              do
              {
                OUTLINED_FUNCTION_30_6();
                if (!v22)
                {
                  objc_enumerationMutation(v6);
                }

                v36 = *(*(&v200[0] + 1) + 8 * v35);
                v37 = [v8 isEqualToString:v36];
                if ((v37 & 1) == 0)
                {
                  v37 = [v30 objectForKeyedSubscript:v36];
                  if (!v37)
                  {
                    if (dword_1ED844350)
                    {
                      LODWORD(v189[0]) = 0;
                      OUTLINED_FUNCTION_116_5();
                      v45 = OUTLINED_FUNCTION_152_0();
                      if (OUTLINED_FUNCTION_192(v45, v46, v47, v48, v49, v50, v51, v52, v150, v151, v152, v153, v154, v156, v158, v160, v161, v162, v163, v164, v165, v166, v167, v168, v169, v170, v171, v172, v173, v174, v175, v176, v177[0], v177[1], v178, *(&v178 + 1), v179[0], v179[1], v180, *(&v180 + 1), v181, v182, OS_LOG_TYPE_DEFAULT))
                      {
                        v54 = v12;
                      }

                      else
                      {
                        v54 = v12 & 0xFFFFFFFE;
                      }

                      if (v54)
                      {
                        BWPortTypeToDisplayString(v36, v53);
                        LODWORD(time2.value) = 136315394;
                        OUTLINED_FUNCTION_183("[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]");
                        LOWORD(time2.flags) = 2112;
                        *(v56 + 230) = v55;
                        OUTLINED_FUNCTION_48_16();
                        OUTLINED_FUNCTION_7_4();
                        _os_log_send_and_compose_impl();
                      }

                      OUTLINED_FUNCTION_2_4();
                      OUTLINED_FUNCTION_16_1();
                    }

                    goto LABEL_50;
                  }
                }

                ++v35;
              }

              while (v34 != v35);
              v32 = OUTLINED_FUNCTION_1_0(v37, v38, v200, v199);
              v34 = v32;
              if (v32)
              {
                continue;
              }

              break;
            }
          }

          v26 = v154;
          v25 = v156;
        }

        v160 = OUTLINED_FUNCTION_64(v32, v33, &v204, v203);
        if (v160)
        {
          continue;
        }

        break;
      }
    }

    v39 = [OUTLINED_FUNCTION_221() objectForKeyedSubscript:?];
    memset(&v198, 0, sizeof(v198));
    lastObject = [v12 lastObject];
    v41 = *off_1E798A420;
    CMTimeMakeFromDictionary(&v198, [lastObject objectForKeyedSubscript:*off_1E798A420]);
    if ((v198.flags & 1) == 0)
    {
      goto LABEL_61;
    }

    if (v39)
    {
      [v39 pts];
    }

    else
    {
      memset(v210, 0, 24);
    }

    time2 = v198;
    if (CMTimeCompare(v210, &time2) <= 0)
    {
      v74 = v14;
      v75 = 0;
      v76 = 0;
    }

    else
    {
LABEL_61:
      v74 = v14;
      v75 = v153;
      v76 = v6;
    }

    if (([(BWFigVideoCaptureDevice *)v74 _ubCBAFScanInProgressUsingFrameStatisticsByPortType:v75 portTypes:v76 timeMachineFramesMetadata:v12]& 1) != 0)
    {
      goto LABEL_50;
    }

    v157 = v41;
    v196 = 0u;
    v197 = 0u;
    v194 = 0u;
    v195 = 0u;
    v77 = *(v14 + 656);
    OUTLINED_FUNCTION_314();
    v78 = [v77 countByEnumeratingWithState:? objects:? count:?];
    if (v78)
    {
      v79 = v78;
      dictionary = 0;
      do
      {
        for (j = 0; j != v79; ++j)
        {
          OUTLINED_FUNCTION_142_0();
          if (!v22)
          {
            objc_enumerationMutation(v77);
          }

          v82 = *(*(&v194 + 1) + 8 * j);
          activeQuadraBinningFactor = [v82 activeQuadraBinningFactor];
          if (activeQuadraBinningFactor >= 1)
          {
            v84 = activeQuadraBinningFactor;
            if (!dictionary)
            {
              dictionary = [MEMORY[0x1E695DF90] dictionary];
            }

            v85 = [MEMORY[0x1E696AD98] numberWithInt:v84];
            [v82 portType];
            [OUTLINED_FUNCTION_6_44() setObject:v85 forKeyedSubscript:?];
          }
        }

        OUTLINED_FUNCTION_314();
        v79 = [v77 countByEnumeratingWithState:? objects:? count:?];
      }

      while (v79);
    }

    else
    {
      dictionary = 0;
    }

    v192 = 0u;
    v193 = 0u;
    v190 = 0u;
    v191 = 0u;
    OUTLINED_FUNCTION_332();
    v90 = OUTLINED_FUNCTION_64(v86, v87, v88, v89);
    if (v90)
    {
      v91 = v90;
      LODWORD(v160) = 0;
      v158 = *off_1E798B540;
      while (2)
      {
        for (k = 0; k != v91; ++k)
        {
          OUTLINED_FUNCTION_142_0();
          if (!v22)
          {
            objc_enumerationMutation(v12);
          }

          v93 = *(*(&v190 + 1) + 8 * k);
          if (([objc_msgSend(OUTLINED_FUNCTION_259() "objectForKeyedSubscript:"BOOLValue"")] & 1) == 0)
          {
            LODWORD(v160) = v160 + 1;
            v94 = [objc_msgSend(OUTLINED_FUNCTION_23_12() "objectForKeyedSubscript:"intValue"")];
            if (v94 >= 1)
            {
              v95 = v94;
              v96 = [v93 objectForKeyedSubscript:v158];
              if (v95 != [objc_msgSend(dictionary objectForKeyedSubscript:{v96), "intValue"}])
              {
                if (dword_1ED844350)
                {
                  v101 = OUTLINED_FUNCTION_80_6();
                  os_log_type_enabled(v101, type);
                  OUTLINED_FUNCTION_82_6();
                  if (v22)
                  {
                    v103 = v102;
                  }

                  else
                  {
                    v103 = v189[0];
                  }

                  if (v103)
                  {
                    [objc_msgSend(dictionary objectForKeyedSubscript:{v96), "intValue"}];
                    LODWORD(time2.value) = 136315650;
                    OUTLINED_FUNCTION_183("[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]");
                    LOWORD(time2.flags) = 1024;
                    *(v104 + 230) = v95;
                    WORD1(time2.epoch) = 1024;
                    HIDWORD(time2.epoch) = v105;
                    OUTLINED_FUNCTION_48_16();
                    OUTLINED_FUNCTION_8_0();
                    _os_log_send_and_compose_impl();
                  }

                  OUTLINED_FUNCTION_2_4();
                  OUTLINED_FUNCTION_39_0();
                }

                goto LABEL_50;
              }
            }
          }
        }

        OUTLINED_FUNCTION_332();
        v91 = OUTLINED_FUNCTION_64(v97, v98, v99, v100);
        if (v91)
        {
          continue;
        }

        break;
      }
    }

    else
    {
      LODWORD(v160) = 0;
    }

    v106 = HIDWORD(v152);
    if (*(v14 + 1784))
    {
      array = [MEMORY[0x1E695DF70] array];
      v189[0] = 0;
      *v185 = 0u;
      v186 = 0u;
      *v187 = 0u;
      v188 = 0u;
      if (OUTLINED_FUNCTION_64(array, v108, v185, v184))
      {
        do
        {
          OUTLINED_FUNCTION_49_7();
          if (!v22)
          {
            objc_enumerationMutation(v12);
          }

          [*v185[1] objectForKeyedSubscript:v157];
          [OUTLINED_FUNCTION_28() addObject:?];
          OUTLINED_FUNCTION_335();
        }

        while (!v22 || OUTLINED_FUNCTION_64(v109, v110, v185, v184));
      }

      if (FigSampleBufferAutofocusProcessorCopyTimestampedExposureModes(*(v14 + 1784), array, v189))
      {
        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_87_6();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v149 = OUTLINED_FUNCTION_362(os_log_and_send_and_compose_flags_and_os_log_type, v142, v143, v144, v145, v146, v147, v148, v150, v151, v152, v153, v154, v157, v158, v160, v161, v162, v163, v164, v165, v166, v167, v168, v169, v170, v171, v172, v173, v174, v175, v176, v177[0], v177[1], v178, *(&v178 + 1), v179[0], v179[1], v180, *(&v180 + 1), v181, v182, SBYTE2(v182), OS_LOG_TYPE_DEFAULT, 0);
          if (OUTLINED_FUNCTION_5_2(v149))
          {
            LODWORD(time2.value) = 136315138;
            OUTLINED_FUNCTION_183("[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]");
            OUTLINED_FUNCTION_48_16();
            OUTLINED_FUNCTION_7_4();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_16_1();
        }

        goto LABEL_50;
      }

      v111 = v189[0];
      *&v112 = OUTLINED_FUNCTION_181();
      *v177 = v112;
      v178 = v112;
      *v179 = v112;
      v180 = v112;
      OUTLINED_FUNCTION_19_25();
      v114 = [v113 countByEnumeratingWithState:? objects:? count:?];
      if (v114)
      {
        v115 = v114;
        while (2)
        {
          for (m = 0; m != v115; ++m)
          {
            OUTLINED_FUNCTION_6_30();
            if (!v22)
            {
              objc_enumerationMutation(v14);
            }

            if ([*(v177[1] + 8 * m) intValue] == 4)
            {
              if (dword_1ED844350)
              {
                OUTLINED_FUNCTION_87_6();
                v132 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
                v140 = OUTLINED_FUNCTION_362(v132, v133, v134, v135, v136, v137, v138, v139, v150, v151, v152, v153, v154, v157, v158, v160, v161, v162, v163, v164, v165, v166, v167, v168, v169, v170, v171, v172, v173, v174, v175, v176, v177[0], v177[1], v178, *(&v178 + 1), v179[0], v179[1], v180, *(&v180 + 1), v181, v182, SBYTE2(v182), OS_LOG_TYPE_DEFAULT, 0);
                if (OUTLINED_FUNCTION_5_2(v140))
                {
                  LODWORD(time2.value) = 136315138;
                  OUTLINED_FUNCTION_183("[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]");
                  OUTLINED_FUNCTION_48_16();
                  OUTLINED_FUNCTION_7_4();
                  _os_log_send_and_compose_impl();
                }

                OUTLINED_FUNCTION_2_4();
                OUTLINED_FUNCTION_16_1();
              }

              goto LABEL_50;
            }
          }

          OUTLINED_FUNCTION_19_25();
          v115 = OUTLINED_FUNCTION_37(v117, v118, v119, v120);
          if (v115)
          {
            continue;
          }

          break;
        }
      }
    }

    v121 = v160;
    if (v160 < SHIDWORD(v152) && dword_1ED844350)
    {
      LODWORD(v189[0]) = 0;
      OUTLINED_FUNCTION_87_6();
      v122 = OUTLINED_FUNCTION_152_0();
      v130 = OUTLINED_FUNCTION_192(v122, v123, v124, v125, v126, v127, v128, v129, v150, v151, v152, v153, v154, v157, v158, v160, v161, v162, v163, v164, v165, v166, v167, v168, v169, v170, v171, v172, v173, v174, v175, v176, v177[0], v177[1], v178, *(&v178 + 1), v179[0], v179[1], v180, *(&v180 + 1), v181, v182, OS_LOG_TYPE_DEFAULT);
      if (OUTLINED_FUNCTION_5_2(v130))
      {
        LODWORD(time2.value) = 136315650;
        OUTLINED_FUNCTION_183("[BWFigVideoCaptureDevice _ubValidateTimeMachineFramesMetadata:minimumValidCount:primaryPortType:portTypes:frameStatisticsByPortType:deliverDepthData:]");
        LOWORD(time2.flags) = 1024;
        *(v131 + 230) = v121;
        WORD1(time2.epoch) = 1024;
        HIDWORD(time2.epoch) = v106;
        OUTLINED_FUNCTION_48_16();
        OUTLINED_FUNCTION_7_4();
        _os_log_send_and_compose_impl();
      }

      OUTLINED_FUNCTION_2_4();
      OUTLINED_FUNCTION_16_1();
    }

LABEL_50:
    OUTLINED_FUNCTION_81();
  }
}

- (uint64_t)_ubCBAFScanInProgressUsingFrameStatisticsByPortType:(uint64_t)type portTypes:(void *)types timeMachineFramesMetadata:
{
  if (result)
  {
    OUTLINED_FUNCTION_175();
    OUTLINED_FUNCTION_43_13();
    if (OUTLINED_FUNCTION_122_4(v7, v8, v9, v10, v11, v12, v13, v14, v28, v30, v32, v34, v36, v38, v40, v42, v44, v46, v48, v50, v52, v54, v56, v58, v60, v62, v64, v65, v66, v67, v68, v69, v70))
    {
      OUTLINED_FUNCTION_21_20();
      if (!v15)
      {
        objc_enumerationMutation(v4);
      }

      [objc_msgSend(v5 objectForKeyedSubscript:{*v71), "focusingMethod"}];
      FigCaptureStreamFocusingMethodIsContrastBased();
    }

    OUTLINED_FUNCTION_1_13();
    result = OUTLINED_FUNCTION_2_0(v16, v17, v18, v19, v20, v21, v22, v23, v29, v31, v33, v35, v37, v39, v41, v43, v45, v47, v49, v51, v53, v55, v57, v59, v61);
    if (result)
    {
      OUTLINED_FUNCTION_125_4();
      v25 = *v24;
      v26 = *off_1E798B320;
      OUTLINED_FUNCTION_4_10();
      if (v27 != v25)
      {
        objc_enumerationMutation(types);
      }

      [objc_msgSend(*v63 objectForKeyedSubscript:{v26), "intValue"}];
      FigCaptureStreamFocusingMethodIsContrastBased();
    }
  }

  return result;
}

- (void)_ubSphereOffsetsForAdaptiveBracketingParameters:(float)parameters pixelSize:
{
  if (!self)
  {
    return 0;
  }

  array = [MEMORY[0x1E695DF70] array];
  if (a2 && parameters > 0.0)
  {
    string = [MEMORY[0x1E696AD60] string];
    v7 = [objc_msgSend(a2 adaptiveBracketingFrameParametersForGroup:{1), "count"}];
    v8 = 0;
    if (v7)
    {
      v9 = 2;
      do
      {
        v8 += v7;
        v7 = [objc_msgSend(a2 adaptiveBracketingFrameParametersForGroup:{v9), "count"}];
        v9 = (v9 + 1);
      }

      while (v7);
    }

    v10 = parameters * 4.0;
    v11 = (25.0 / v10);
    v12 = (2 * v11) | 1;
    if (v8 >= v12)
    {
      v13 = 2 * v11 + 1;
    }

    else
    {
      v13 = v8;
    }

    if ((v11 & 0x80000000) == 0)
    {
      v34[0] = MEMORY[0x1E69E9820];
      v34[1] = 3221225472;
      v34[2] = __85__BWFigVideoCaptureDevice__ubSphereOffsetsForAdaptiveBracketingParameters_pixelSize___block_invoke;
      v34[3] = &unk_1E799C410;
      v35 = v10;
      v25 = array;
      v34[4] = array;
      v34[5] = string;
      v30[0] = MEMORY[0x1E69E9820];
      v30[1] = 3221225472;
      v31 = __85__BWFigVideoCaptureDevice__ubSphereOffsetsForAdaptiveBracketingParameters_pixelSize___block_invoke_2;
      v32 = &unk_1E799C438;
      v33 = v34;
      v26[0] = MEMORY[0x1E69E9820];
      v26[1] = 3221225472;
      v27 = __85__BWFigVideoCaptureDevice__ubSphereOffsetsForAdaptiveBracketingParameters_pixelSize___block_invoke_3;
      v28 = &unk_1E799C438;
      v29 = v34;
      if (v8 >= 1)
      {
        v14 = 0;
        v15 = v13 / 2;
        v16 = (v15 - 1);
        v17 = (1 - v15);
        string = -v15;
        v18 = v8;
        do
        {
          v19 = v12 - (v14 != 0);
          if (v18 >= v19)
          {
            v20 = v19;
          }

          else
          {
            v20 = v18;
          }

          if (v14)
          {
            v27(v26, v16, v20);
          }

          else
          {
            if (v14)
            {
              v21 = v17;
            }

            else
            {
              v21 = string;
            }

            v31(v30, v21, v20);
          }

          ++v14;
          v22 = __OFSUB__(v18, v20);
          v18 -= v20;
        }

        while (!((v18 < 0) ^ v22 | (v18 == 0)));
      }

      if (dword_1ED844350)
      {
        OUTLINED_FUNCTION_325();
        os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
        OUTLINED_FUNCTION_4_0();
        array = v25;
        if (string)
        {
          [v25 count];
          OUTLINED_FUNCTION_177();
          OUTLINED_FUNCTION_2_1();
          OUTLINED_FUNCTION_4_4();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        OUTLINED_FUNCTION_39_0();
      }

      else
      {
        return v25;
      }
    }
  }

  return array;
}

- (uint64_t)_ubEnabledOutputsForCaptureFlags:(int)flags captureType:(uint64_t *)type baseCaptureFrameFlagsOut:(unint64_t *)out discardCaptureFrameFlagsOut:
{
  if (result)
  {
    if (*(result + 2242) == 1)
    {
      if ((a2 & 4) != 0)
      {
        if ((a2 & 0x800) != 0 && (*(result + 2268) & 0xFFFFFFFE) == 8 && (flags == 7 || flags == 1 && (a2 & 0x80) == 0))
        {
          v7 = 3;
          v8 = 0xA000000000000000;
          v9 = 0x5000000000000000;
        }

        else
        {
          v7 = 1;
          v8 = 0x8000000000000000;
          v9 = 0x4000000000000000;
        }
      }

      else
      {
        v7 = 2;
        v8 = 0x2000000000000000;
        v9 = 0x1000000000000000;
      }

      result = [MEMORY[0x1E696AD98] numberWithInt:v7];
      if (!type)
      {
        goto LABEL_16;
      }
    }

    else
    {
      result = 0;
      v8 = 0x2000000000000000;
      v9 = 0x1000000000000000;
      if (!type)
      {
LABEL_16:
        if (out)
        {
          *out = v8;
        }

        return result;
      }
    }

    *type = v9;
    goto LABEL_16;
  }

  return result;
}

- (BOOL)_ubAWBReflowEnabledForCaptureType:(uint64_t)type primaryPortType:(void *)portType frameStatisticsByPortType:(void *)byPortType previewMetadata:
{
  if (result)
  {
    v8 = BWStillImageAutoWhiteBalanceReflowMaximumFrameCount();
    if (v8 < 1)
    {
      return 0;
    }

    v9 = v8;
    result = 0;
    if (a2 <= 0xD && ((1 << a2) & 0x3402) != 0)
    {
      if (byPortType)
      {
        if ([objc_msgSend(byPortType objectForKeyedSubscript:{*off_1E798B148), "BOOLValue"}])
        {
          return 0;
        }
      }

      else if ([objc_msgSend(OUTLINED_FUNCTION_118_0() "objectForKeyedSubscript:"awbStable"")])
      {
        return 0;
      }

      return [portType frameCount] < v9;
    }
  }

  return result;
}

- (BOOL)_ubGenerateLTMCurveForCaptureStream:(void *)stream frameStatistics:
{
  if (result)
  {
    memset(&v5[1], 0, sizeof(CMTime));
    if (a2 && ([a2 maxExposureDuration], (v5[1].flags & 0x1D) == 1))
    {
      [stream integrationTime];
      v5[0] = v5[1];
      return v4 + 0.0082 >= CMTimeGetSeconds(v5);
    }

    else
    {
      return 0;
    }
  }

  return result;
}

- (id)_autoExposureBracketValuesForSettings:(id)result frameStatistics:
{
  if (result)
  {
    OUTLINED_FUNCTION_67_8();
    [MEMORY[0x1E695DF70] array];
    if ([OUTLINED_FUNCTION_18_0() bracketImageCount])
    {
      v4 = 0;
      do
      {
        LODWORD(v5) = *([v2 exposureTargetBiases] + 4 * v4);
        if (*&v5 == 3.4028e38)
        {
          [v1 exposureBias];
          *&v5 = v5;
        }

        [MEMORY[0x1E696AD98] numberWithFloat:v5];
        [OUTLINED_FUNCTION_8() addObject:?];
        ++v4;
      }

      while (v4 < [v2 bracketImageCount]);
    }

    v6 = [v3 copy];

    return v6;
  }

  return result;
}

- (id)_manualExposureBracketParametersForSettings:(uint64_t)settings frameStatistics:(int)statistics use8dot8FixedPointGain:
{
  if (result)
  {
    OUTLINED_FUNCTION_175();
    [MEMORY[0x1E695DF70] array];
    if ([OUTLINED_FUNCTION_25_0() bracketImageCount])
    {
      v8 = 0;
      v9 = 0;
      v27 = *off_1E798BAA8;
      v10 = *off_1E798BA90;
      v11 = 0x1E695D000uLL;
      do
      {
        v34 = *([v5 exposureDurations] + v8);
        time1 = v34;
        memset(&time2, 0, sizeof(time2));
        if (CMTimeCompare(&time1, &time2))
        {
          time1 = v34;
          Seconds = CMTimeGetSeconds(&time1);
        }

        else
        {
          [v4 integrationTime];
        }

        v13 = Seconds;
        v14 = *([v5 ISOs] + 4 * v9);
        if (v14 == 3.4028e38)
        {
          [v4 gain];
          v16 = v15;
        }

        else
        {
          [v4 baseISO];
          v16 = v14 / v17;
        }

        v18 = (v13 * 1000000.0);
        if (statistics)
        {
          v19 = v11;
          LODWORD(v11) = vcvts_n_s32_f32(v16, 8uLL);
          v30[0] = v27;
          v20 = [MEMORY[0x1E696AD98] numberWithInt:v18];
          v30[1] = v10;
          v31[0] = v20;
          v21 = v11;
          v11 = v19;
          v31[1] = [MEMORY[0x1E696AD98] numberWithInt:v21];
          v22 = *(v19 + 3872);
          v23 = v31;
          v24 = v30;
        }

        else
        {
          v28[0] = v27;
          v25 = [MEMORY[0x1E696AD98] numberWithInt:v18];
          v28[1] = v10;
          v29[0] = v25;
          *&v26 = v16;
          v29[1] = [MEMORY[0x1E696AD98] numberWithFloat:v26];
          v22 = *(v11 + 3872);
          v23 = v29;
          v24 = v28;
        }

        [v22 dictionaryWithObjects:v23 forKeys:v24 count:2];
        [OUTLINED_FUNCTION_7() addObject:?];
        ++v9;
        v8 += 24;
      }

      while (v9 < [v5 bracketImageCount]);
    }

    return [v6 copy];
  }

  return result;
}

- (uint64_t)_ubAddSensorRawOutputBuffersToUnifiedBracketedCaptureParamsIfNeeded:(void *)needed unifiedBracketedCaptureParamsOut:
{
  if (result)
  {
    v7 = result;
    os_unfair_lock_assert_owner((result + 144));
    if (needed)
    {
      if (*(v7 + 156))
      {
        v4 = 0;
        result = 0;
      }

      else
      {
        v8 = objc_alloc_init(MEMORY[0x1E695DF70]);
        *&v9 = OUTLINED_FUNCTION_181();
        v29[0] = v9;
        v29[1] = v9;
        v29[2] = v9;
        v29[3] = v9;
        result = OUTLINED_FUNCTION_52(v10, v11, v29, v28);
        if (result)
        {
          v12 = result;
          neededCopy = needed;
          OUTLINED_FUNCTION_343();
          v13 = *off_1E798C660;
          v14 = *off_1E798C678;
          while (2)
          {
            v15 = 0;
            do
            {
              OUTLINED_FUNCTION_13_1();
              if (v16 != v3)
              {
                objc_enumerationMutation(a2);
              }

              v17 = *(*(&v29[0] + 1) + 8 * v15);
              if ([v17 objectForKeyedSubscript:v13])
              {
                v18 = [objc_msgSend(*(v7 + 160) objectForKeyedSubscript:{&unk_1F22469C0), "newPixelBuffer"}];
                if (!v18)
                {
                  os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
                  os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
                  OUTLINED_FUNCTION_82_6();
                  if (v25)
                  {
                    v26 = v24;
                  }

                  else
                  {
                    v26 = 0;
                  }

                  if (v26)
                  {
                    [*(v7 + 2720) settingsID];
                    OUTLINED_FUNCTION_75();
                    OUTLINED_FUNCTION_2_1();
                    OUTLINED_FUNCTION_47_2();
                  }

                  needed = neededCopy;
                  OUTLINED_FUNCTION_1_4();
                  OUTLINED_FUNCTION_39_0();

                  v4 = 0;
                  result = 4294954610;
                  goto LABEL_22;
                }

                v19 = v18;
                v20 = [v17 mutableCopy];
                [v20 setObject:v19 forKeyedSubscript:v14];
                [OUTLINED_FUNCTION_6_75() addObject:?];

                CVPixelBufferRelease(v19);
              }

              else
              {
                v21 = [OUTLINED_FUNCTION_6_75() addObject:?];
              }

              ++v15;
            }

            while (v12 != v15);
            result = OUTLINED_FUNCTION_52(v21, v22, v29, v28);
            v12 = result;
            if (result)
            {
              continue;
            }

            break;
          }

          needed = neededCopy;
        }
      }

LABEL_22:
      *needed = v4;
    }

    else
    {
      return 0;
    }
  }

  return result;
}

- (BOOL)_isLowLightSceneUsingFrameStatisticsByPortType:(uint64_t)type
{
  result = 0;
  if (!type || !a2)
  {
    return result;
  }

  [*(type + 600) portType];
  v4 = [OUTLINED_FUNCTION_8() objectForKeyedSubscript:?];
  if ([type isBravoVariant])
  {
    os_unfair_lock_lock((type + 1408));
    v5 = *(type + 1392);
    v6 = *(type + 672);
    os_unfair_lock_unlock((type + 1408));
    if (v5 == v6)
    {
      [*(type + 672) portType];
      v12 = [OUTLINED_FUNCTION_8() objectForKeyedSubscript:?];
      if ((*(type + 3448) & 1) == 0)
      {
        [v4 integrationTime];
        v7 = 2560;
        v4 = v12;
        goto LABEL_7;
      }

      v11 = 1;
      goto LABEL_11;
    }

    if ((*(type + 3448) & 1) == 0)
    {
LABEL_6:
      v7 = 2552;
LABEL_7:
      v8 = *(type + v7);
      [v4 integrationTime];
      return v9 >= v8 + -0.0000999999975;
    }
  }

  else
  {
    OUTLINED_FUNCTION_240();
    if (!v10)
    {
      goto LABEL_6;
    }
  }

  v11 = 0;
  v12 = 0;
LABEL_11:
  v13 = *(type + 3484);
  [v4 gain];
  v15 = v14;
  v16 = *(type + 2552);
  [v4 integrationTime];
  if (v11)
  {
    v13 = *(type + 3488);
    [v12 gain];
    v15 = v18;
    v16 = *(type + 2560);
    [v12 integrationTime];
  }

  return v15 >= v13 || v17 >= v16 + 0.0000999999975;
}

- (void)updateSphereShiftStateWithSampleBuffer:(opaqueCMSampleBuffer *)buffer
{
  v4 = CMGetAttachment(buffer, *off_1E798A3C8, 0);
  v5 = [objc_msgSend(v4 objectForKeyedSubscript:{*off_1E798B708), "intValue"}];
  if ([objc_msgSend(v4 objectForKeyedSubscript:{*off_1E798B710), "BOOLValue"}])
  {
    os_unfair_lock_lock(&self->_sphereShiftStateLock);
    if (v5 > self->_sphereShiftStateLastUpdateCaptureID)
    {
      FigMotionSphereShiftStateUpdateWithMetadata(&self->_sphereShiftState, v4);
      self->_sphereShiftStateLastUpdateCaptureID = v5;
    }

    os_unfair_lock_unlock(&self->_sphereShiftStateLock);
  }
}

- (void)_overCaptureSelectLockedStreamsForRecommendedMasterStream:(float)stream requestedZoomFactor:(float)factor currentFrameRate:
{
  if (self && *(self + 3901) == 1)
  {
    v5 = *(self + 3904);
    if (v5)
    {
      v6 = *(self + 3912) - 1;
      *(self + 3912) = v6;
      if (!v6)
      {

        *(self + 3904) = 0;
        *(self + 3912) = 0;
        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_87_6();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          v8 = os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
          if (OUTLINED_FUNCTION_5_2(v8))
          {
            OUTLINED_FUNCTION_5_6();
            OUTLINED_FUNCTION_7_4();
            _os_log_send_and_compose_impl();
          }

          OUTLINED_FUNCTION_2_4();
LABEL_30:
          fig_log_call_emit_and_clean_up_after_send_and_compose();
        }
      }
    }

    else
    {
      [*(self + 672) baseZoomFactor];
      if (v12 <= stream)
      {
        [*(self + 2952) appliedZoomFactor];
        v14 = v13;
        [*(self + 672) baseZoomFactor];
        if (v14 >= v15)
        {
          v16 = (self + 672);
          v17 = *(self + 688);
          v18 = *(self + 680);
          v19 = v17 != v18 || v18 == a2;
          if (!v19 || (v17 == *v16 ? (v20 = *v16 == a2) : (v20 = 1), !v20))
          {
            if (v17 == v18)
            {
              v26 = *(self + 680);
              v16 = (self + 600);
              v21 = &v26;
            }

            else
            {
              v25 = *(self + 600);
              v21 = &v25;
            }

            v21[1] = *v16;
            *(self + 3904) = [MEMORY[0x1E695DEC8] arrayWithObjects:? count:?];
            *(self + 3912) = FigCaptureRoundFloatToMultipleOf(1, (*(self + 3916) * factor) / 30.0);
            if (dword_1ED844350)
            {
              OUTLINED_FUNCTION_145_1();
              v22 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
              os_log_type_enabled(v22, OS_LOG_TYPE_DEFAULT);
              OUTLINED_FUNCTION_115_0();
              if (v19)
              {
                v24 = v23;
              }

              else
              {
                v24 = 0;
              }

              if (v24)
              {
                [objc_msgSend(*(self + 3904) "firstObject")];
                [objc_msgSend(*(self + 3904) "lastObject")];
                [*(self + 688) portType];
                OUTLINED_FUNCTION_78();
                OUTLINED_FUNCTION_5();
                OUTLINED_FUNCTION_8_0();
                _os_log_send_and_compose_impl();
              }

              OUTLINED_FUNCTION_2_4();
              goto LABEL_30;
            }
          }
        }
      }
    }
  }
}

- (BOOL)_depthDataDeliveryOrStereoPhotoCaptureUseSecondaryStream:(_BOOL8)result primaryStream:
{
  if (result)
  {
    OUTLINED_FUNCTION_80();
    if ((*(v3 + 1568) & 1) != 0 || *(v2 + 218) == 1)
    {
      if ([*(v2 + 664) indexOfObject:?] >= 1)
      {
        v4 = [OUTLINED_FUNCTION_330(*(v2 + 664)) objectAtIndexedSubscript:?];
      }

      else
      {
        v4 = 0;
      }

      return v4 == v1;
    }

    else
    {
      return 0;
    }
  }

  return result;
}

- (float)_nextLargerBaseZoomFactorForRequestedZoomFactor:(uint64_t)factor
{
  v2 = 0.0;
  if (!factor)
  {
    return v2;
  }

  OUTLINED_FUNCTION_6_78();
  v5 = *(v4 + 664);
  v13 = OUTLINED_FUNCTION_131_5(v4, v6, v7, v8, v9, v10, v11, v12, v44, v46, v48, v50, v52, v54, v56, v58, v60, v62, v64, v66, v68, v70, v72, v74, v76, v78, v80, v82, v84, v86, v88, v90, v92);
  if (!v13)
  {
    return v2;
  }

  v14 = v13;
  while (2)
  {
    for (i = 0; i != v14; ++i)
    {
      OUTLINED_FUNCTION_89();
      if (!v16)
      {
        objc_enumerationMutation(v5);
      }

      v17 = *(v94 + 8 * i);
      [v17 baseZoomFactor];
      if (v18 >= a2)
      {
        [v17 baseZoomFactor];
        return v42;
      }

      nondisruptiveSwitchingZoomFactors = [v17 nondisruptiveSwitchingZoomFactors];
      OUTLINED_FUNCTION_43();
      v21 = [v20 countByEnumeratingWithState:? objects:? count:?];
      if (v21)
      {
        OUTLINED_FUNCTION_61_6();
        v30 = *v29;
        while (1)
        {
          OUTLINED_FUNCTION_4_10();
          if (v31 != v30)
          {
            objc_enumerationMutation(nondisruptiveSwitchingZoomFactors);
          }

          v32 = *v79;
          [*v79 floatValue];
          if (v33 >= a2)
          {
            break;
          }

          OUTLINED_FUNCTION_78_0();
          if (v16)
          {
            v21 = OUTLINED_FUNCTION_0_0(v34, v35, v36, v37, v38, v39, v40, v41, v45, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67, v69, v71, v73, v75, v77);
            if (!v21)
            {
              goto LABEL_16;
            }
          }
        }

        [v32 floatValue];
        return v42;
      }

LABEL_16:
      ;
    }

    v14 = OUTLINED_FUNCTION_131_5(v21, v22, v23, v24, v25, v26, v27, v28, v45, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67, v69, v71, v73, v75, v77, v79, v81, v83, v85, v87, v89, v91, v93);
    if (v14)
    {
      continue;
    }

    return v2;
  }
}

- (void)_updateSlaveFrameRateForZoomFactor:(uint64_t)factor masterCaptureStream:
{
  if (!factor)
  {
    return;
  }

  OUTLINED_FUNCTION_357();
  v153 = v1;
  v154 = v3;
  v5 = v4;
  v7 = v6;
  v9 = v8;
  dictionary = [MEMORY[0x1E695DF90] dictionary];
  v145 = [*(v9 + 664) indexOfObject:v5];
  slaveStreamBlockingFocusAndExposureStability = [*(v9 + 1416) slaveStreamBlockingFocusAndExposureStability];
  obj = OUTLINED_FUNCTION_270();
  v11 = [obj countByEnumeratingWithState:? objects:? count:?];
  if (v11)
  {
    v12 = v11;
    v13 = 0;
    v141 = *off_1E798A0C0;
    v144 = *off_1E798C1A8;
    v2 = 30.0;
    while (1)
    {
      for (i = 0; i != v12; ++i)
      {
        OUTLINED_FUNCTION_32_10();
        if (!v25)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(v152 + 8 * i);
        if (v15 == v5)
        {
          portType = [*(v152 + 8 * i) portType];
          v23 = dictionary;
          v24 = &unk_1F2246990;
          goto LABEL_107;
        }

        LODWORD(v16) = *(v9 + 1480);
        [*(v9 + 664) indexOfObject:*(v152 + 8 * i)];
        OUTLINED_FUNCTION_298();
        if (v25)
        {
          v18 = *(v9 + 1560);
          v19 = v18 ? v15 == v18 : v17 + 1 == v145;
          if (v19 && (*(v9 + 3888) & 1) == 0)
          {
            if (*(v9 + 1572) == 0.0)
            {
              LODWORD(v16) = 0x7FFFFFFF;
            }

            else
            {
              maximumFrameRate = [v5 maximumFrameRate];
              v131 = v131 & 0xFFFFFFFF00000000 | v21;
              LODWORD(v16) = vcvtps_s32_f32(FigCaptureFrameRateAsFloat(maximumFrameRate, v131) / *(v9 + 1572));
            }
          }
        }

        v25 = *(v9 + 1508) != 1 || v16 == 1;
        if (!v25 && *(v9 + 1468) <= v7 && *(v9 + 1472) >= v7)
        {
          LODWORD(v16) = 1;
        }

        if (*(v9 + 1545))
        {
          LODWORD(v16) = 1;
        }

        if (*(v9 + 3888) == 1 && (*(v9 + 3900) & 1) == 0 && !*(v9 + 4097))
        {
          LODWORD(v16) = 1;
        }

        if ([v15 firmwareTimeMachineEnabledWhenConfiguredAsSlave])
        {
          v16 = 1;
        }

        else
        {
          v16 = v16;
        }

        [v15 streamingFrameRateForZoomPIPOverlay];
        if (v26 == 0.0)
        {
          if ([v15 streamingRequiredWhenConfiguredAsSlave] && v16 != 1)
          {
            goto LABEL_45;
          }

          if (![v15 visionDataRequiredWhenConfiguredAsSlave] || v16 == 1)
          {
            goto LABEL_62;
          }

          if (*(v9 + 3404))
          {
            v31 = *(v9 + 3400);
            [v15 maximumFrameRate];
            if (v31 <= 0.0)
            {
              OUTLINED_FUNCTION_323();
              v35 = FigCaptureFrameRateAsFloat(v36, v37);
              v34 = v130;
            }

            else
            {
              OUTLINED_FUNCTION_323();
              v34 = v130;
              if (v31 >= FigCaptureFrameRateAsFloat(v32, v33))
              {
                maximumFrameRate2 = [v15 maximumFrameRate];
                v129 = v129 & 0xFFFFFFFF00000000 | v44;
                v35 = FigCaptureFrameRateAsFloat(maximumFrameRate2, v129);
              }

              else
              {
                v35 = *(v9 + 3400);
              }
            }

            maximumFrameRate3 = [v15 maximumFrameRate];
            v16 = v34 & 0xFFFFFFFF00000000 | v46;
            v130 = v16;
            LODWORD(v16) = vcvtps_s32_f32(FigCaptureFrameRateAsFloat(maximumFrameRate3, v16) / v35);
          }

          else
          {
LABEL_45:
            v16 = 1;
          }
        }

        else
        {
          [*(v9 + 2952) appliedZoomFactorWithoutFudge];
          if (*(v9 + 672) == v5 && (v28 = *&v27, v29 = *(v9 + 4292), [objc_msgSend(v15 "portType")]) && (*&v27 = v28 * v29, (v28 * v29) >= *(v9 + 4288)) && *(v9 + 4076) <= 2 && (*(v9 + 4296) & 1) == 0)
          {
            [v15 streamingFrameRateForZoomPIPOverlay];
            v39 = v38;
            maximumFrameRate4 = [v5 maximumFrameRate];
            v128 = v128 & 0xFFFFFFFF00000000 | v41;
            *&v27 = FigCaptureFrameRateAsFloat(maximumFrameRate4, v128) / v39;
            if (v16 >= *&v27)
            {
              v42 = *&v27;
            }

            else
            {
              v42 = v16;
            }

            if (v16)
            {
              v16 = v42;
            }

            else
            {
              v16 = *&v27;
            }

            v30 = 1;
          }

          else
          {
            v30 = 0;
          }

          [v15 setStreamingRequiredWhenConfiguredAsSlave:{v30, v27}];
        }

LABEL_62:
        streamingRequiredWhenConfiguredAsSlave = [v15 streamingRequiredWhenConfiguredAsSlave];
        if (v15 == [*(v9 + 648) cameraControlsStatisticsMasterStream] && v16 != 1)
        {
          if (v16)
          {
            maximumFrameRate5 = [*(v9 + 600) maximumFrameRate];
            v146 = v146 & 0xFFFFFFFF00000000 | v50;
            v51 = FigCaptureFrameRateAsFloat(maximumFrameRate5, v146);
            OUTLINED_FUNCTION_318(v51);
            OUTLINED_FUNCTION_35_3();
            if (!(v53 ^ v54 | v25))
            {
              maximumFrameRate6 = [*(v9 + 600) maximumFrameRate];
              v137 = v137 & 0xFFFFFFFF00000000 | v56;
              v52 = floorf(FigCaptureFrameRateAsFloat(maximumFrameRate6, v137) / 30.0);
            }

            *&v57 = v16;
            if (v52 <= v16)
            {
              maximumFrameRate7 = [*(v9 + 600) maximumFrameRate];
              v138 = v138 & 0xFFFFFFFF00000000 | v59;
              FigCaptureFrameRateAsFloat(maximumFrameRate7, v138);
              *&v57 = OUTLINED_FUNCTION_67_9();
              if (!(v53 ^ v54 | v25))
              {
                maximumFrameRate8 = [*(v9 + 600) maximumFrameRate];
                v62 = v61;
                v132 = v132 & 0xFFFFFFFF00000000 | v61;
                goto LABEL_74;
              }
            }
          }

          else
          {
            maximumFrameRate9 = [*(v9 + 600) maximumFrameRate];
            v142 = v142 & 0xFFFFFFFF00000000 | v64;
            FigCaptureFrameRateAsFloat(maximumFrameRate9, v142);
            *&v57 = OUTLINED_FUNCTION_67_9();
            if (!(v53 ^ v54 | v25))
            {
              maximumFrameRate8 = [*(v9 + 600) maximumFrameRate];
              v62 = v65;
              v135 = v135 & 0xFFFFFFFF00000000 | v65;
LABEL_74:
              v66 = FigCaptureFrameRateAsFloat(maximumFrameRate8, v62);
              *&v57 = OUTLINED_FUNCTION_318(v66);
            }
          }

          v16 = *&v57;
        }

        if (v15 != slaveStreamBlockingFocusAndExposureStability)
        {
          goto LABEL_77;
        }

        if (*(v9 + 707))
        {
          v67 = 1;
        }

        else
        {
          if (*(v9 + 708) != 1)
          {
LABEL_77:
            v67 = 0;
            goto LABEL_82;
          }

          v67 = [objc_msgSend(v5 "portType")];
        }

LABEL_82:
        if (*(v9 + 3888) == 1)
        {
          v67 &= *(v9 + 4097);
        }

        if ((v67 & 1) != 0 && v16 != 1)
        {
          if (v16)
          {
            maximumFrameRate10 = [*(v9 + 600) maximumFrameRate];
            v147 = v147 & 0xFFFFFFFF00000000 | v69;
            v70 = FigCaptureFrameRateAsFloat(maximumFrameRate10, v147);
            OUTLINED_FUNCTION_318(v70);
            OUTLINED_FUNCTION_35_3();
            if (!(v53 ^ v54 | v25))
            {
              maximumFrameRate11 = [*(v9 + 600) maximumFrameRate];
              v139 = v139 & 0xFFFFFFFF00000000 | v73;
              v71 = floorf(FigCaptureFrameRateAsFloat(maximumFrameRate11, v139) / 30.0);
            }

            *&v74 = v16;
            if (v71 <= v16)
            {
              maximumFrameRate12 = [*(v9 + 600) maximumFrameRate];
              v140 = v140 & 0xFFFFFFFF00000000 | v76;
              FigCaptureFrameRateAsFloat(maximumFrameRate12, v140);
              *&v74 = OUTLINED_FUNCTION_67_9();
              if (!(v53 ^ v54 | v25))
              {
                maximumFrameRate13 = [*(v9 + 600) maximumFrameRate];
                v79 = v78;
                v133 = v133 & 0xFFFFFFFF00000000 | v78;
                goto LABEL_94;
              }
            }
          }

          else
          {
            maximumFrameRate14 = [*(v9 + 600) maximumFrameRate];
            v143 = v143 & 0xFFFFFFFF00000000 | v81;
            FigCaptureFrameRateAsFloat(maximumFrameRate14, v143);
            *&v74 = OUTLINED_FUNCTION_67_9();
            if (!(v53 ^ v54 | v25))
            {
              maximumFrameRate13 = [*(v9 + 600) maximumFrameRate];
              v79 = v82;
              v136 = v136 & 0xFFFFFFFF00000000 | v82;
LABEL_94:
              v83 = FigCaptureFrameRateAsFloat(maximumFrameRate13, v79);
              *&v74 = OUTLINED_FUNCTION_318(v83);
            }
          }

          v16 = *&v74;
        }

        v84 = v15 != *(v9 + 1560) || v16 == 1;
        if (v84 || ![objc_msgSend(objc_msgSend(v15 "stream")])
        {
          goto LABEL_106;
        }

        [*(v9 + 600) minimumFrameRate];
        if (!v16)
        {
          OUTLINED_FUNCTION_323();
          goto LABEL_105;
        }

        OUTLINED_FUNCTION_323();
        if (v16 >= FigCaptureFrameRateAsInt(v85, v86))
        {
          minimumFrameRate = [*(v9 + 600) minimumFrameRate];
          v134 = v134 & 0xFFFFFFFF00000000 | v88;
          v89 = v134;
LABEL_105:
          v16 = FigCaptureFrameRateAsInt(minimumFrameRate, v89);
        }

LABEL_106:
        v13 += streamingRequiredWhenConfiguredAsSlave;
        [MEMORY[0x1E696AD98] numberWithInt:v16];
        [v15 portType];
        v23 = OUTLINED_FUNCTION_259();
LABEL_107:
        [v23 setObject:v24 forKeyedSubscript:portType];
      }

      v12 = [obj countByEnumeratingWithState:&v151 objects:v150 count:16];
      if (!v12)
      {
        goto LABEL_111;
      }
    }
  }

  v13 = 0;
LABEL_111:
  if (slaveStreamBlockingFocusAndExposureStability && (*(v9 + 707) & 1) == 0 && (*(v9 + 708) & 1) == 0)
  {
    if (v13 >= *(v9 + 1424))
    {
      v90 = 30.0;
      if (([slaveStreamBlockingFocusAndExposureStability streamingRequiredWhenConfiguredAsSlave] & 1) == 0)
      {
        if (*(v9 + 709) != 1)
        {
          goto LABEL_131;
        }

        v91 = *(v9 + 1500);
        if (!v91)
        {
          goto LABEL_131;
        }

        v90 = v91;
      }
    }

    else
    {
      ++v13;
      v90 = 30.0;
    }

    [slaveStreamBlockingFocusAndExposureStability portType];
    v92 = [objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:"intValue"")];
    if (v92)
    {
      v2 = v92;
      v93 = (v9 + 600);
      maximumFrameRate15 = [*(v9 + 600) maximumFrameRate];
      v96 = floorf(FigCaptureFrameRateAsFloat(maximumFrameRate15, v95) / v90);
      LODWORD(v97) = 1.0;
      if (v96 > 1.0)
      {
        maximumFrameRate16 = [*v93 maximumFrameRate];
        *&v97 = floorf(FigCaptureFrameRateAsFloat(maximumFrameRate16, v99) / v90);
      }

      if (*&v97 > v2)
      {
        goto LABEL_130;
      }

      maximumFrameRate17 = [*v93 maximumFrameRate];
      v102 = FigCaptureFrameRateAsFloat(maximumFrameRate17, v101);
      *&v97 = OUTLINED_FUNCTION_320(v102);
      if (v53 ^ v54 | v25)
      {
        goto LABEL_130;
      }
    }

    else
    {
      maximumFrameRate18 = [*(v9 + 600) maximumFrameRate];
      v105 = FigCaptureFrameRateAsFloat(maximumFrameRate18, v104);
      *&v97 = OUTLINED_FUNCTION_320(v105);
      if (v53 ^ v54 | v25)
      {
LABEL_130:
        [MEMORY[0x1E696AD98] numberWithInt:{v2, v97}];
        [slaveStreamBlockingFocusAndExposureStability portType];
        [OUTLINED_FUNCTION_139_1() setObject:? forKeyedSubscript:?];
        goto LABEL_131;
      }

      v93 = (v9 + 600);
    }

    maximumFrameRate19 = [*v93 maximumFrameRate];
    *&v97 = FigCaptureFrameRateAsFloat(maximumFrameRate19, v107) / v90;
    v2 = floorf(*&v97);
    goto LABEL_130;
  }

LABEL_131:
  if ((v13 < *(v9 + 1424) || *(v9 + 709) == 1) && *(v9 + 1480) != *(v9 + 1488))
  {
    [v5 baseZoomFactor];
    v109 = v108;
    v110 = v145;
    if (v145 >= [*(v9 + 664) count] - 1)
    {
      v111 = 0;
      if (!v145)
      {
        goto LABEL_140;
      }
    }

    else
    {
      v111 = [*(v9 + 664) objectAtIndexedSubscript:v145 + 1];
      if (!v145)
      {
        goto LABEL_140;
      }
    }

    if (v145 >= [*(v9 + 664) count])
    {
      v110 = 0;
      if (v111)
      {
        goto LABEL_141;
      }

      goto LABEL_143;
    }

    v110 = [*(v9 + 664) objectAtIndexedSubscript:v145 - 1];
LABEL_140:
    if (v111)
    {
LABEL_141:
      [v111 baseZoomFactor];
      v113 = v112 - v109;
      goto LABEL_145;
    }

LABEL_143:
    if (!v110)
    {
      v115 = 0.0;
      goto LABEL_146;
    }

    [v110 baseZoomFactor];
    v113 = v109 - v114;
LABEL_145:
    v115 = v109 + (v113 * 0.5);
LABEL_146:
    if (v115 > v7)
    {
      v111 = v110;
    }

    if (v111)
    {
      [v111 portType];
      if ([objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:"intValue"")])
      {
        [v111 portType];
        v116 = [objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:"intValue"")];
        v117 = *(v9 + 1488);
        if (v116 < v117)
        {
          [v111 portType];
          v117 = [objc_msgSend(OUTLINED_FUNCTION_17() "objectForKeyedSubscript:"intValue"")];
        }
      }

      else
      {
        v117 = *(v9 + 1488);
      }

      [MEMORY[0x1E696AD98] numberWithInt:v117];
      [OUTLINED_FUNCTION_25_0() portType];
      [OUTLINED_FUNCTION_118_0() setObject:? forKeyedSubscript:?];
    }
  }

  v118 = *(v9 + 656);
  OUTLINED_FUNCTION_317();
  if (OUTLINED_FUNCTION_37(v119, v120, v121, v122))
  {
    while (1)
    {
      OUTLINED_FUNCTION_21_20();
      if (!v25)
      {
        objc_enumerationMutation(v118);
      }

      [MEMORY[0] portType];
      v123 = [OUTLINED_FUNCTION_17() objectForKeyedSubscript:?];
      if (v123)
      {
        [v123 intValue];
        [OUTLINED_FUNCTION_7() setMasterToSlaveFrameRateRatio:?];
      }

      OUTLINED_FUNCTION_51_11();
      if (v25)
      {
        OUTLINED_FUNCTION_317();
        if (!OUTLINED_FUNCTION_37(v124, v125, v126, v127))
        {
          break;
        }
      }
    }
  }

  OUTLINED_FUNCTION_353();
}

- (uint64_t)_reportCameraSwitchAnalyticsData:(void *)data recommendedMasterStream:(uint64_t)stream frameStatisticsByPortType:(const __CFDictionary *)type metadata:
{
  if (result)
  {
    v10 = result;
    v11 = objc_alloc_init(BWCameraSwitchAnalyticsPayload);
    [*(v10 + 2952) requestedZoomFactor];
    v13 = v12;
    [*(v10 + 1416) lastSelectionReason];
    [OUTLINED_FUNCTION_17() setSwitchReason:?];
    [a2 portType];
    [OUTLINED_FUNCTION_17() setSwitchFromPortType:?];
    [data portType];
    [OUTLINED_FUNCTION_17() setSwitchToPortType:?];
    [a2 portType];
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"afRecommendedPrimaryPortType"")];
    [OUTLINED_FUNCTION_17() setAfRecommendedPortType:?];
    LODWORD(v14) = v13;
    [*(v10 + 2952) removeFudgeFromZoomFactor:v14];
    *&v16 = v15 * *(v10 + 4292);
    [(BWCameraSwitchAnalyticsPayload *)v11 setUiZoom:v16];
    [(BWCameraSwitchAnalyticsPayload *)v11 setClientApplicationID:*(v10 + 88)];
    [(BWCameraSwitchAnalyticsPayload *)v11 setDeviceType:*(v10 + 588)];
    v26 = 0;
    if (!FigMotionGetGravityZ(type, &v26))
    {
      LODWORD(v17) = v26;
      [(BWCameraSwitchAnalyticsPayload *)v11 setGravityZ:v17];
    }

    [(BWCameraSwitchAnalyticsPayload *)v11 setVideoDimensions:*(v10 + 4444)];
    if ([*(v10 + 1416) lastSelectionReason] == 1)
    {
      v18 = mach_absolute_time();
      if (*(v10 + 4696))
      {
        [(BWCameraSwitchAnalyticsPayload *)v11 setTimeSinceLastAutoSwitch:FigHostTimeToNanoseconds() / 0xF4240uLL];
      }

      *(v10 + 4696) = v18;
      [a2 portType];
      [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"afRecommendedPrimaryPortTypeChangeTime"")];
      [(BWCameraSwitchAnalyticsPayload *)v11 setSwitchDelay:FigHostTimeToNanoseconds() / 0xF4240uLL];
      [*(v10 + 1416) switchDelayReasons];
      [OUTLINED_FUNCTION_17() setSwitchDelayReasons:?];
      [*(v10 + 1416) setSwitchDelayReasons:0];
    }

    [a2 portType];
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"tofMeasuredDepth"")];
    [(BWCameraSwitchAnalyticsPayload *)v11 setTofMeasuredDepth:?];
    [a2 portType];
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"tofROIType"")];
    [OUTLINED_FUNCTION_17() setTofROIType:?];
    bravoStreamSelectionEligibleFallbackPortTypes = [v10 bravoStreamSelectionEligibleFallbackPortTypes];
    v20 = [bravoStreamSelectionEligibleFallbackPortTypes containsObject:*off_1E798A0C0];
    if ([bravoStreamSelectionEligibleFallbackPortTypes containsObject:*off_1E798A0D0])
    {
      v21 = v20 | 2;
    }

    else
    {
      v21 = v20;
    }

    [(BWCameraSwitchAnalyticsPayload *)v11 setFallbackCameras:v21];
    dictionary = [MEMORY[0x1E695DF90] dictionary];
    [MEMORY[0x1E695DF90] dictionary];
    dictionary2 = [MEMORY[0x1E695DF90] dictionary];
    [MEMORY[0x1E695DF90] dictionary];
    dictionary3 = [MEMORY[0x1E695DF90] dictionary];
    OUTLINED_FUNCTION_282();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"focusDistance"")];
    [v5 numberWithFloat:?];
    [dictionary setObject:v5 forKeyedSubscript:OUTLINED_FUNCTION_283()];
    OUTLINED_FUNCTION_374();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"focusDistance"")];
    [v5 numberWithFloat:?];
    [dictionary setObject:v5 forKeyedSubscript:{objc_msgSend(OUTLINED_FUNCTION_217(), "portType")}];
    OUTLINED_FUNCTION_282();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"logicalFocusLensPosition"")];
    [OUTLINED_FUNCTION_47() numberWithInt:?];
    OUTLINED_FUNCTION_283();
    [OUTLINED_FUNCTION_67_5() setObject:v5 forKeyedSubscript:?];
    OUTLINED_FUNCTION_374();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"logicalFocusLensPosition"")];
    [OUTLINED_FUNCTION_47() numberWithInt:?];
    [OUTLINED_FUNCTION_217() portType];
    [OUTLINED_FUNCTION_67_5() setObject:v5 forKeyedSubscript:?];
    OUTLINED_FUNCTION_282();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"lastFocusingMethod"")];
    [OUTLINED_FUNCTION_47() numberWithInt:?];
    [dictionary2 setObject:v5 forKeyedSubscript:OUTLINED_FUNCTION_283()];
    OUTLINED_FUNCTION_374();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"lastFocusingMethod"")];
    [OUTLINED_FUNCTION_47() numberWithInt:?];
    [OUTLINED_FUNCTION_217() portType];
    [OUTLINED_FUNCTION_67_5() setObject:v5 forKeyedSubscript:?];
    OUTLINED_FUNCTION_282();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"luxLevel"")];
    [OUTLINED_FUNCTION_47() numberWithUnsignedInt:?];
    OUTLINED_FUNCTION_283();
    [OUTLINED_FUNCTION_322() setObject:? forKeyedSubscript:?];
    OUTLINED_FUNCTION_374();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"luxLevel"")];
    [OUTLINED_FUNCTION_47() numberWithUnsignedInt:?];
    [OUTLINED_FUNCTION_217() portType];
    [OUTLINED_FUNCTION_322() setObject:? forKeyedSubscript:?];
    OUTLINED_FUNCTION_282();
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"currentFrameRate"")];
    [v5 numberWithFloat:?];
    [dictionary3 setObject:v5 forKeyedSubscript:OUTLINED_FUNCTION_283()];
    v24 = MEMORY[0x1E696AD98];
    [data portType];
    [objc_msgSend(OUTLINED_FUNCTION_8() "objectForKeyedSubscript:"currentFrameRate"")];
    [v24 numberWithFloat:?];
    [dictionary3 setObject:stream forKeyedSubscript:{objc_msgSend(OUTLINED_FUNCTION_18_0(), "portType")}];
    [(BWCameraSwitchAnalyticsPayload *)v11 setApsSubjectDistance:dictionary];
    [OUTLINED_FUNCTION_259() setLogicalFocusLensPosition:?];
    [(BWCameraSwitchAnalyticsPayload *)v11 setFocusingMethod:dictionary2];
    [OUTLINED_FUNCTION_23_12() setLuxLevel:?];
    [(BWCameraSwitchAnalyticsPayload *)v11 setFrameRate:dictionary3];
    return [+[BWCoreAnalyticsReporter sharedInstance](BWCoreAnalyticsReporter sendEvent:"sendEvent:", v11];
  }

  return result;
}

- (void)setSupplementalPointCloudCaptureDevice:(id)device
{
  OUTLINED_FUNCTION_176();

  *(v3 + 2488) = 0;
  if (v4)
  {
    v8 = 0;
    [objc_msgSend(objc_msgSend(v4 "captureStream")];
    if (v8)
    {
      OUTLINED_FUNCTION_14_21();
      FigDebugAssert3();
    }

    else
    {
      [OUTLINED_FUNCTION_133() setSupplementalPointCloudCaptureDeviceDelegate:v3];
      *(v3 + 2488) = [[FigWeakReference alloc] initWithReferencedObject:v4];
      *(v3 + 2496) = 0;
      [v5 floatValue];
      *(v3 + 2500) = v7;
      *(v3 + 2476) = 30;
    }
  }
}

- (void)setDepthDataDeliveryEnabled:(BOOL)enabled
{
  if (self->_depthDataDeliveryEnabled != enabled)
  {
    OUTLINED_FUNCTION_176();
    if (([*(v5 + 600) started] & 1) == 0)
    {
      *(v3 + 1568) = v4;
      if (v4)
      {
        v6 = 0;
      }

      else
      {
        v6 = [objc_msgSend(*(v3 + 624) objectForKeyedSubscript:{@"NightMode", "BOOLValue"}];
      }

      *(v3 + 2173) = v6;

      [(BWFigVideoCaptureDevice *)v3 _updateParallaxMitigationBasedOnZoomFactorEnabled];
    }
  }
}

- (void)setMaxContinuousZoomFactorForDepthDataDelivery:(float)delivery
{
  if (*&self->_depthFormatDimensions.height != delivery && ![(BWFigVideoCaptureStream *)self->_captureStream started])
  {
    *&self->_depthFormatDimensions.height = delivery;

    [(BWFigVideoCaptureDevice *)self _updateParallaxMitigationBasedOnZoomFactorEnabled];
  }
}

- (uint64_t)_postSDOFEffectStatus:(uint64_t)result SDOFStagePreviewStatus:
{
  if (result)
  {
    OUTLINED_FUNCTION_176();
    v4 = MEMORY[0x1E695DF90];
    v5 = OUTLINED_FUNCTION_208();
    v7 = [v4 dictionaryWithObjectsAndKeys:{objc_msgSend(v5, "numberWithInt:", v6), @"EffectStatus", 0}];
    if ([v1[202] portraitSceneMonitoringRequiresStageThresholds])
    {
      [v7 setObject:objc_msgSend(*(v3 + 3480) forKeyedSubscript:{"numberWithInt:", v2), @"StagePreviewStatus"}];
    }

    return [v1 _postNotificationWithPayload:@"ShallowDepthOfFieldStatusChanged" notificationPayload:v7];
  }

  return result;
}

- (void)_updateSDOFEffectStatus:(uint64_t)status newStagePreviewStatus:
{
  if (!status)
  {
    return;
  }

  OUTLINED_FUNCTION_80();
  if (v5)
  {
    v6 = v4;
  }

  else
  {
    v6 = 0;
  }

  os_unfair_lock_lock(v3 + 399);
  if (v2[400]._os_unfair_lock_opaque == v1)
  {
    if (v6 == v2[401]._os_unfair_lock_opaque)
    {

      os_unfair_lock_unlock(v2 + 399);
      return;
    }

    goto LABEL_11;
  }

  v2[400]._os_unfair_lock_opaque = v1;
  [BWFigVideoCaptureDevice _updateThermalPressureStatsWithOldSDOFEffectStatus:v2 newSDOFEffectStatus:?];
  if (v6 != v2[401]._os_unfair_lock_opaque)
  {
LABEL_11:
    v2[401]._os_unfair_lock_opaque = v6;
  }

  os_unfair_lock_unlock(v2 + 399);
  v7 = OUTLINED_FUNCTION_44();

  [BWFigVideoCaptureDevice _postSDOFEffectStatus:v7 SDOFStagePreviewStatus:?];
}

- (void)_updateThermalPressureStatsWithOldSDOFEffectStatus:(uint64_t)status newSDOFEffectStatus:
{
  if (status)
  {
    OUTLINED_FUNCTION_54();
    if (v3 == 13)
    {
      *(v1 + 4608) = mach_absolute_time();
    }

    else if (v3 == 6)
    {
      *(v1 + 4601) = 1;
    }

    if (v2 == 13)
    {
      mach_absolute_time();
      v4 = FigHostTimeToNanoseconds() / 0xF4240uLL;
      if (*(v1 + 4604) > v4)
      {
        LODWORD(v4) = *(v1 + 4604);
      }

      *(v1 + 4604) = v4;
    }
  }
}

- (unint64_t)_evaluateSceneForMotionFreezingWithMasterStreamSwitchoverSuspended:(void *)suspended resultOut:
{
  if (self)
  {
    if (*(self + 3377) != 1)
    {
      goto LABEL_6;
    }

    os_unfair_lock_lock((self + 2140));
    if (suspended)
    {
      *suspended = *(self + 3416);
    }

    os_unfair_lock_unlock((self + 2140));
    if (*(self + 3378) == 1)
    {
      v9 = [(BWFigVideoCaptureDevice *)self _captureStreamForFaceDetectionWithMasterStreamSwitchoverSuspended:a2];
      v10 = *(self + 1392);
      if (v10)
      {
        v11 = *(self + 1392);
      }

      else
      {
        v11 = v9;
      }

      if (v10 && (a2 & 1) == 0)
      {
        os_unfair_lock_lock((self + 1408));
        v11 = *(self + 1392);
        os_unfair_lock_unlock((self + 1408));
      }

      [objc_msgSend(v11 "faceDetector")];
      v7 = v12 >= 0.0 && v12 < *(self + 3380);
      v6 = LODWORD(v12) << 32;
    }

    else
    {
LABEL_6:
      v6 = 0;
      v7 = 0;
    }
  }

  else
  {
    v6 = 0;
    v7 = 0;
  }

  return v6 | (v7 << 8) | v7;
}

- (int)setSmartFramingEnabledFieldsOfView:(id)view
{
  if (!view)
  {
    return -12780;
  }

  v4 = [(BWFigVideoCaptureDevice *)self _smartFramingFieldOfViewRectsDictFromFieldsOfView:view];
  os_unfair_lock_lock(&self->_smartFramingLock);

  v5 = v4;
  self->_smartFramingEnabledFieldsOfView = v5;
  smartFramingSceneMonitor = self->_smartFramingSceneMonitor;
  if (smartFramingSceneMonitor)
  {
    [(BWSmartFramingSceneMonitor *)smartFramingSceneMonitor setSmartFramingFieldOfViewRects:v5];
  }

  os_unfair_lock_unlock(&self->_smartFramingLock);
  return 0;
}

- (uint64_t)_captureStreamForFaceDetectionWithMasterStreamSwitchoverSuspended:(uint64_t)suspended
{
  if (!suspended)
  {
    return 0;
  }

  v3 = *(suspended + 1392);
  if (v3)
  {
    v4 = *(suspended + 1392);
  }

  else
  {
    v4 = *(suspended + 600);
  }

  if (v3 && (a2 & 1) == 0)
  {
    os_unfair_lock_lock((suspended + 1408));
    v4 = *(suspended + 1392);
    os_unfair_lock_unlock((suspended + 1408));
  }

  return v4;
}

- (void)zeroShutterLagCancelWaitingForTimeMachinesForSettingsID:(int64_t)d
{
  if (self->_ubCaptureParametersByPortType)
  {
    OUTLINED_FUNCTION_176();
    os_unfair_lock_lock(v5 + 678);
    *(v3 + 2232) = v4;
    os_unfair_lock_unlock((v3 + 2712));
    v6 = *(v3 + 2200);

    [v6 reset];
  }
}

- (__n128)_resetAnalyticsData
{
  if (self)
  {
    v2 = mach_absolute_time();
    *(self + 3576) = v2;
    *(self + 296) = v2;
    *(self + 304) = 0;
    *(self + 264) = v2;
    *(self + 272) = 0;
    *(self + 368) = v2;
    *(self + 376) = 0;
    *(self + 200) = v2;
    *(self + 208) = 0;
    *(self + 4640) = 0u;
    *(self + 4656) = 0u;
    *(self + 4672) = 0;
    *(self + 4680) = v2;
    OUTLINED_FUNCTION_251();
    v3 = MEMORY[0x1E6960C70];
    *(self + 384) = 0;
    *(self + 400) = *v3;
    *(self + 416) = *(v3 + 16);
    v4 = MEMORY[0x1E6960CC0];
    result = *MEMORY[0x1E6960CC0];
    *(self + 424) = *MEMORY[0x1E6960CC0];
    *(self + 440) = *(v4 + 16);
  }

  return result;
}

- (void)setDeskCamActive:(BOOL)active
{
  if (self->_deskCamActive != active)
  {
    OUTLINED_FUNCTION_176();
    v5 = mach_absolute_time();
    if (v4)
    {
      if ((*(v3 + 240) & 1) == 0)
      {
        v6 = v5;
        if (dword_1ED844350)
        {
          OUTLINED_FUNCTION_145_1();
          os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
          os_log_type_enabled(os_log_and_send_and_compose_flags_and_os_log_type, OS_LOG_TYPE_DEFAULT);
          OUTLINED_FUNCTION_82_6();
          if (v9)
          {
            v10 = v8;
          }

          else
          {
            v10 = 0;
          }

          if (v10)
          {
            OUTLINED_FUNCTION_5_6();
            OUTLINED_FUNCTION_47_2();
          }

          OUTLINED_FUNCTION_2_4();
          OUTLINED_FUNCTION_39_0();
        }

        *(v3 + 248) = v6;
      }
    }

    else if (*(v3 + 240))
    {
      if (dword_1ED844350)
      {
        OUTLINED_FUNCTION_201();
        v11 = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
        v12 = os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT);
        if (OUTLINED_FUNCTION_5_24(v12))
        {
          OUTLINED_FUNCTION_5_6();
          OUTLINED_FUNCTION_4_4();
          _os_log_send_and_compose_impl();
        }

        OUTLINED_FUNCTION_2_4();
        OUTLINED_FUNCTION_13_0();
      }

      [(BWFigVideoCaptureDevice *)v3 _reportDeskViewStreamingSessionCoreAnalyticsData];
    }

    *(v3 + 240) = v4;
    [(BWFigVideoCaptureDevice *)v3 _updateSensorRegionOfInterestForActiveFraming];
  }
}

- (void)setUltraWideActive:(BOOL)active
{
  ultraWideActive = self->_ultraWideActive;
  if (ultraWideActive != active)
  {
    if (active && !ultraWideActive)
    {
      [(BWFigVideoCaptureDevice *)self _resetAnalyticsData];
    }

    else if (!active && self->_ultraWideActive)
    {
      [(BWFigVideoCaptureDevice *)self _reportStreamingSessionCoreAnalyticsData];
    }

    self->_ultraWideActive = active;
  }
}

uint64_t __65__BWFigVideoCaptureDevice_setDeskViewAutoExposureAreaOfInterest___block_invoke(double *a1)
{
  if (dword_1ED844350)
  {
    OUTLINED_FUNCTION_18_34();
    os_log_and_send_and_compose_flags_and_os_log_type = fig_log_emitter_get_os_log_and_send_and_compose_flags_and_os_log_type();
    v4 = OUTLINED_FUNCTION_8_5(os_log_and_send_and_compose_flags_and_os_log_type);
    if (OUTLINED_FUNCTION_6(v4))
    {
      v5 = *(a1 + 6);
      v6 = *(a1 + 7);
      v7 = *(a1 + 8);
      v8 = *(a1 + 9);
      v15 = 136316162;
      v16 = "[BWFigVideoCaptureDevice setDeskViewAutoExposureAreaOfInterest:]_block_invoke";
      v17 = 2048;
      v18 = v5;
      v19 = 2048;
      v20 = v6;
      v21 = 2048;
      v22 = v7;
      v23 = 2048;
      v24 = v8;
      OUTLINED_FUNCTION_3_89();
      OUTLINED_FUNCTION_8_0();
      _os_log_send_and_compose_impl();
      OUTLINED_FUNCTION_247();
    }

    OUTLINED_FUNCTION_2_4();
    OUTLINED_FUNCTION_17_8();
  }

  v13[0] = @"x";
  v14[0] = [OUTLINED_FUNCTION_249() numberWithDouble:a1[6]];
  v13[1] = @"y";
  v14[1] = [*(v1 + 3480) numberWithDouble:a1[7]];
  v13[2] = @"w";
  v14[2] = [*(v1 + 3480) numberWithDouble:a1[8]];
  v13[3] = @"h";
  v14[3] = [*(v1 + 3480) numberWithDouble:a1[9]];
  [MEMORY[0x1E695DF20] dictionaryWithObjects:v14 forKeys:v13 count:4];
  v9 = OUTLINED_FUNCTION_348();
  v11 = [(BWFigVideoCaptureDevice *)v9 _setAutofocusProcessorProperty:v10 propertyValue:?];
  return OUTLINED_FUNCTION_93_3(v11);
}

- (void)setCenterStageRectOfInterest:(CGRect)interest
{
  OUTLINED_FUNCTION_9_7();
  v4 = v3;
  *(v3 + 4208) = v5;
  *(v3 + 4216) = v6;
  *(v3 + 4224) = v7;
  *(v3 + 4232) = v8;
  [*(v3 + 4240) referencedObject];
  v9 = OUTLINED_FUNCTION_3_1();
  [v10 didChangeCenterStageRectOfInterest:v9];
  [(BWFigVideoCaptureDevice *)v4 _updateSensorRegionOfInterestForActiveFraming];
  OUTLINED_FUNCTION_1_13();
  v11 = *(v4 + 656);
  v20 = OUTLINED_FUNCTION_2_0(v12, v13, v14, v15, v16, v17, v18, v19, v35, v37, v39, v41, v43, v45, v47, v49, v51, v53, v55, v57, v59, v61, v63, v65, v67);
  if (v20)
  {
    v21 = v20;
    v22 = *v69;
    do
    {
      v23 = 0;
      do
      {
        OUTLINED_FUNCTION_4_10();
        if (v24 != v22)
        {
          objc_enumerationMutation(v11);
        }

        v25 = OUTLINED_FUNCTION_3_1();
        v27 = [v26 setCenterStageRectOfInterest:v25];
        ++v23;
      }

      while (v21 != v23);
      v21 = OUTLINED_FUNCTION_2_0(v27, v28, v29, v30, v31, v32, v33, v34, v36, v38, v40, v42, v44, v46, v48, v50, v52, v54, v56, v58, v60, v62, v64, v66, v68);
    }

    while (v21);
  }
}

uint64_t __61__BWFigVideoCaptureDevice_setManualCinematicFramingDelegate___block_invoke(uint64_t a1)
{
  v2 = [*(*(a1 + 32) + 4240) referencedObject];
  [*(*(a1 + 32) + 4336) referencedObject];
  v3 = OUTLINED_FUNCTION_4();

  return fvcd_handleRegionOfInterestChangedForCameraControlsFromFramingDelegates(v3, v2, v4);
}

void __80__BWFigVideoCaptureDevice__sendInitialValuesToPortraitEffectPropertiesDelegate___block_invoke(uint64_t a1, void *a2)
{
  v3 = [*(a1 + 32) referencedObject];

  [(BWFigVideoCaptureDevice *)v3 _postNotificationWithName:a2 payloadNewPropertyValue:?];
}

void __80__BWFigVideoCaptureDevice__sendInitialValuesToPortraitEffectPropertiesDelegate___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) referencedObject];

  [(BWFigVideoCaptureDevice *)v1 _postNotificationWithName:0 payloadNewPropertyValue:?];
}

- (void)setPortraitEffectStudioLightQuality:(int64_t)quality
{
  if (self)
  {
    selfCopy = self;
    v5 = *&self->_zoomPIPSuspended;
    if (v5)
    {
      self = [v5 referencedObject];
    }

    else if ([selfCopy isBravoVariant])
    {
      self = [selfCopy masterCaptureStream];
    }

    else
    {
      self = selfCopy[75];
    }
  }

  [(BWFigVideoCaptureDevice *)self didChangePortraitEffectStudioLightQuality:quality];
}

- (void)performReactionEffect:(id)effect
{
  if (self)
  {
    selfCopy = self;
    v5 = *&self->_zoomPIPSuspended;
    if (v5)
    {
      self = [v5 referencedObject];
    }

    else if ([selfCopy isBravoVariant])
    {
      self = [selfCopy masterCaptureStream];
    }

    else
    {
      self = selfCopy[75];
    }
  }

  [(BWFigVideoCaptureDevice *)self performReactionEffect:effect];
}

- (void)liveReconfigureForOutputAspectRatioFirstBufferReceived:(id *)received forConfigurationID:(id)d
{
  if (d)
  {
    os_unfair_lock_lock(&self->_longestContinuousPortraitInPhotoPreviewInMS);
    v7 = *MEMORY[0x1E695E480];
    v8 = *received;
    [*&self->_invalidFrameCountAfterFirstValidFrame setObject:CMTimeCopyAsDictionary(&v8 forKeyedSubscript:{v7), d}];
    os_unfair_lock_unlock(&self->_longestContinuousPortraitInPhotoPreviewInMS);
  }
}

- (uint64_t)_teardownAutoFocusSampleBufferProcessor
{
  OUTLINED_FUNCTION_0();
  OUTLINED_FUNCTION_2_5();
  return FigDebugAssert3();
}

uint64_t __115__BWFigVideoCaptureDevice__serviceDeferredAutofocusProcessorPropertiesFromCaptureStream_frameStatisticsByPortType___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_1_5();
  OUTLINED_FUNCTION_2_5();
  return FigDebugAssert3();
}

uint64_t __115__BWFigVideoCaptureDevice__serviceDeferredAutofocusProcessorPropertiesFromCaptureStream_frameStatisticsByPortType___block_invoke_cold_2()
{
  OUTLINED_FUNCTION_1_5();
  OUTLINED_FUNCTION_2_5();
  return FigDebugAssert3();
}

- (uint64_t)_deviceWillStartStreaming
{
  OUTLINED_FUNCTION_175();
  v8 = v7;
  [BWFigVideoCaptureDevice _setMinimumMasterToSlaveFrameRateRatio:];
  [*v5 requestedZoomFactor];
  [BWFigVideoCaptureDevice _updateSlaveFrameRateForZoomFactor:v8];
  [*(v8 + 600) willBecomeMasterStream];
  [*v4 willBecomeSlaveStream];
  [*(v8 + 648) setMasterStream:*(v8 + 600) allStreams:*a4];
  [*(v8 + 600) didBecomeMasterStream];
  return [*v4 didBecomeSlaveStream];
}

uint64_t __80__BWFigVideoCaptureDevice__updateStateUsingVideoSampleBuffer_fromCaptureStream___block_invoke_2_cold_1()
{
  OUTLINED_FUNCTION_80();
  v2 = mach_absolute_time();
  result = [(BWFigVideoCaptureDevice *)*v1 _updateOrientationTotalTimes:v2];
  *(*v1 + 496) = v0;
  *(*v1 + 504) = v2;
  return result;
}

- (uint64_t)_addExifMetadata:(uint64_t)a3 fromTimeMachine:.cold.1(void *a1, uint64_t a2, uint64_t a3)
{
  result = [a1 deviceType];
  if (!result)
  {
    [OUTLINED_FUNCTION_40() setSlaveFocalLengths:?];
    return [a1 setSlaveLensFNumbers:a3];
  }

  return result;
}

- (uint64_t)updateStillImageSensorRawBufferPoolsWithRetainedBufferCount:(uint64_t)a3 zoomBasedRetainedBufferCount:(_DWORD *)a4 ultraHighResolutionRetainedBufferCount:.cold.2(int a1, _DWORD *a2, uint64_t a3, _DWORD *a4)
{
  *a2 = a1;
  updated = [(BWFigVideoCaptureDevice *)a3 _updateSensorRawPool];
  *a4 = updated;
  if (!updated)
  {
    return 1;
  }

  OUTLINED_FUNCTION_1_5();
  FigDebugAssert3();
  return 0;
}

- (void)_resolveStillImageCaptureTypeFromStatisticsByPortType:(uint64_t)a1 masterCaptureStream:(_BYTE *)a2 flashMode:hdrMode:qualityPrioritization:stereoFusionMode:depthDataDeliveryEnabled:bravoConstituentImageDeliveryDeviceTypes:burstQualityCaptureEnabled:clientBracketMode:forSceneMonitoring:captureFlags:.cold.1(uint64_t a1, _BYTE *a2)
{
  v3 = 0;
  [(BWFigVideoCaptureDevice *)a1 _copyAutofocusProcessorProperty:&v3 propertyValueOut:?];
  *a2 = [v3 BOOLValue];
}

- (id)_stillImageCaptureSettingsWithID:captureType:deliverOriginalImage:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:clientBracketSettings:captureFlags:userInitiatedRequestPTS:frameStatisticsByPortType:.cold.1()
{
  OUTLINED_FUNCTION_80();
  [v2 setProvidePreBracketedEV0:1];
  v3 = MEMORY[0x1E695DF70];
  [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(v1, "bracketFrameCount")}];
  if ([OUTLINED_FUNCTION_18_0() bracketFrameCount] >= 1)
  {
    LODWORD(v4) = 0;
    do
    {
      v4 = (v4 + 1);
      [MEMORY[0x1E696AD98] numberWithInt:v4];
      [OUTLINED_FUNCTION_8() addObject:?];
    }

    while (v4 < [v1 bracketFrameCount]);
  }

  result = [v3 copy];
  *v0 = result;
  return result;
}

- (uint64_t)_stillImageCaptureSettingsWithID:(uint64_t)a3 captureType:(void *)a4 deliverOriginalImage:deliverSushiRaw:bravoConstituentImageDeliveryDeviceTypes:clientBracketSettings:captureFlags:userInitiatedRequestPTS:frameStatisticsByPortType:.cold.2(uint64_t a1, uint64_t a2, uint64_t a3, void *a4)
{
  OUTLINED_FUNCTION_175();
  v8 = v7;
  v9 = [BWBracketSettings bracketSettingsForBracketingMode:3];
  *a4 = v9;
  [v9 setProvidePreBracketedEV0:*(v8 + 2685)];
  *v5 = *off_1E798B8D8;
  *v4 = &unk_1F2249B70;
  [MEMORY[0x1E695DF20] dictionaryWithObjects:v4 forKeys:v5 count:1];
  return [OUTLINED_FUNCTION_28() setOisBracketedCaptureParams:?];
}

uint64_t __82__BWFigVideoCaptureDevice__initiateCaptureStillImageNowWithPTS_completionHandler___block_invoke_cold_2(uint64_t a1)
{
  v2 = OUTLINED_FUNCTION_86_3(a1);
  [(BWFigVideoCaptureDevice *)v2 _resumeTimeMachines];
  v3 = *(*(v1 + 40) + 16);

  return v3();
}

- (uint64_t)setContinuousAutoFocusRect:isFocusRectInOverscanSpace:.cold.1()
{
  OUTLINED_FUNCTION_0();
  OUTLINED_FUNCTION_2_5();
  return FigDebugAssert3();
}

uint64_t __62__BWFigVideoCaptureDevice_setRegionOfInterestWithoutOverscan___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_124_5();
  v3 = FigCaptureTransformRectToCoordinateSpaceOfRect(*(*v1 + 1880), *(*v1 + 1888), *(*v1 + 1896), *(*v1 + 1904), v2[5], v2[6], v2[7]);
  v4 = *v0;
  *(v4 + 1880) = OUTLINED_FUNCTION_188(v3, v5, v6, v7);
  *(v4 + 1888) = v8;
  *(v4 + 1896) = v9;
  *(v4 + 1904) = v10;
  v11 = *v0;

  return [BWFigVideoCaptureDevice _updateAutoFocusRectIfNeededForZoomFactor:v11];
}

uint64_t __62__BWFigVideoCaptureDevice_setRegionOfInterestWithoutOverscan___block_invoke_cold_2()
{
  OUTLINED_FUNCTION_124_5();
  v4 = FigCaptureTransformRectToCoordinateSpaceOfRect(*(*v2 + 1840), *(*v2 + 1848), *(*v2 + 1856), *(*v2 + 1864), v3[5], v3[6], v3[7]);
  v8 = OUTLINED_FUNCTION_188(v4, v5, v6, v7);
  OUTLINED_FUNCTION_299(v8, v9, v10, v11);
  v12 = *v0;

  return [(BWFigVideoCaptureDevice *)v12 _updateExposureRectIfNeededForZoomFactor:v1];
}

uint64_t __70__BWFigVideoCaptureDevice__setAutoImageControlMode_completionHandler___block_invoke_cold_1(uint64_t a1, uint64_t a2, uint64_t a3, int a4)
{
  result = [BWFigVideoCaptureDevice _setAutofocusProcessorImageControlModeProperty:a2];
  *(*(*(a3 + 40) + 8) + 24) = result;
  if (!*(*(*(a3 + 40) + 8) + 24))
  {
    *(*(*(a3 + 48) + 8) + 24) = a4;
  }

  return result;
}

- (uint64_t)setFaceDetectionDrivenImageProcessingMode:(uint64_t *)a3 .cold.1(uint64_t a1, uint64_t a2, uint64_t *a3, _DWORD *a4)
{
  OUTLINED_FUNCTION_7_3();
  if ((*(v8 + 544) & 1) != 0 && ([objc_msgSend(*(v5 + 624) objectForKeyedSubscript:{@"Focus", "BOOLValue"}] & 1) != 0 && (*a3 == 0x1F218A530 || *a3 == 0x1F218A550) && (v4 == 0x1F218A510 || v4 == 0x1F218A4F0))
  {
    ++*(v5 + 560);
  }

  if ((*(v5 + 544) & 1) != 0 && ([objc_msgSend(*(v5 + 624) objectForKeyedSubscript:{@"Exposure", "BOOLValue"}] & 1) != 0 && (*a3 == 0x1F218A510 || *a3 == 0x1F218A550) && (v4 == 0x1F218A530 || v4 == 0x1F218A4F0))
  {
    ++*(v5 + 564);
  }

  *a3 = v4;
  result = [(BWFigVideoCaptureDevice *)v5 _setAutofocusProcessorProperty:v4 propertyValue:?];
  *a4 = result;
  return result;
}

- (void)zoomCommandHandler:didApplyZoomFactor:zoomFactorWithoutFudge:targetZoomFactor:rampComplete:rampCommandID:.cold.1()
{
  OUTLINED_FUNCTION_124_5();
  [v0 aspectRatio];
  v1 = OUTLINED_FUNCTION_114_4();
  [BWFigVideoCaptureDevice _updateSmartFramingFieldOfViewWithAspectRatio:v2 zoomFactor:v1];
}

- (void)setAspectRatio:(_DWORD *)a3 .cold.1(uint64_t a1, uint64_t a2, _DWORD *a3, os_unfair_lock_s *a4)
{
  OUTLINED_FUNCTION_80();
  mach_absolute_time();
  v8 = OUTLINED_FUNCTION_10_29();
  [(BWFigVideoCaptureDevice *)v8 _updateDynamicAspectRatioCumulativeTimeForStopTime:v9];
  *a3 = v4;
  [*(v5 + 2952) appliedZoomFactor];
  v10 = OUTLINED_FUNCTION_44();
  [BWFigVideoCaptureDevice _updateSensorRegionsOfInterestBasedOnZoomFactor:v10 aspectRatio:v11];
  [*(v5 + 2200) reset];
  v12 = OUTLINED_FUNCTION_44();
  [(BWFigVideoCaptureDevice *)v12 _configureZoomFudgingWithAspectRatio:v13];
  os_unfair_lock_unlock(a4);
  if (*(v5 + 1672) == 1)
  {
    [*(v5 + 2952) requestedZoomFactorWithoutFudge];
    v14 = OUTLINED_FUNCTION_44();

    [BWFigVideoCaptureDevice _updateSmartFramingFieldOfViewWithAspectRatio:v14 zoomFactor:v15];
  }
}

- (uint64_t)setDepthMaxFrameRate:(float)a3 .cold.1(float *a1, uint64_t a2, float a3)
{
  *a1 = a3;
  [*(a2 + 2952) requestedZoomFactor];
  [BWFigVideoCaptureDevice _updateSlaveFrameRateForZoomFactor:a2];
  v5 = [*(a2 + 4176) referencedObject];
  *&v6 = a3;

  return [v5 didChangeDepthMaxFrameRate:v6];
}

- (uint64_t)updatePortraitSceneMonitoringRequiresStageThresholds:.cold.1()
{
  OUTLINED_FUNCTION_80();
  [BWFigVideoCaptureDevice _postSDOFEffectStatus:v2 SDOFStagePreviewStatus:?];

  return [(BWFigVideoCaptureDevice *)v1 _updateStreamingForegroundSegmentationNetworkUsingStage:?];
}

- (uint64_t)setPortraitEffectPropertiesDelegate:.cold.1()
{
  OUTLINED_FUNCTION_67_8();
  *v0 = [[FigWeakReference alloc] initWithReferencedObject:v1];
  v2 = OUTLINED_FUNCTION_70();

  return [BWFigVideoCaptureDevice _sendInitialValuesToPortraitEffectPropertiesDelegate:v2];
}

@end