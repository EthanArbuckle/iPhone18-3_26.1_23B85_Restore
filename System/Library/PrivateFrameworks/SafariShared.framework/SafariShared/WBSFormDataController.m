@interface WBSFormDataController
+ (BOOL)_password:(id)a3 appearsToBeASixDigitCodeAppendedToPassword:(id)a4;
+ (BOOL)_password:(id)a3 appearsToBeMoreThanOneSymbolAppendedToPassword:(id)a4;
+ (BOOL)canAutocompleteTextField:(id)a3 inForm:(id)a4;
+ (BOOL)convertNumber:(id)a3 toAutoFillFormType:(unint64_t *)a4;
+ (BOOL)formContainsCreditCardData:(id)a3;
+ (BOOL)formContainsCreditCardNumberField:(id)a3;
+ (BOOL)formContainsDateFields:(id)a3 matchingAddressBookMatch:(id)a4;
+ (BOOL)isFieldUnidentified:(id)a3;
+ (BOOL)isNameProperty:(id)a3;
+ (BOOL)isUsernameFieldInLoginFormWithTextFieldMetadata:(id)a3 formMetadata:(id)a4;
+ (BOOL)password:(id)a3 shouldBeConsideredEqualToExistingPassword:(id)a4;
+ (BOOL)shouldDisplayHideMyEmailForControl:(id)a3;
+ (BOOL)shouldDisplayOneTimeCodeForControl:(id)a3 inForm:(id)a4;
+ (BOOL)textFieldLooksLikeCreditCardFormField:(id)a3;
+ (BOOL)textFieldLooksLikeCreditCardNumericFormField:(id)a3;
+ (id)allAddressBookAddressComponentKeys;
+ (id)allAddressBookNonAddressPropertyKeys;
+ (id)allSynonymsForMatch:(id)a3;
+ (id)contactKeyForString:(id)a3;
+ (id)continuingFieldsInFormControls:(id)a3 startingAtIndex:(unint64_t)a4;
+ (id)controlsConsideredByAutoFillInForm:(id)a3;
+ (id)domainFromURL:(id)a3;
+ (id)fieldToFocusBeforeSubmittingForm:(id)a3;
+ (id)lastFieldInControls:(id)a3 inForm:(id)a4;
+ (id)metadataForControlWithUniqueID:(id)a3 inForm:(id)a4;
+ (id)nextFieldAfterControls:(id)a3 inForm:(id)a4;
+ (id)specifierForAddressBookLabel:(id)a3;
+ (id)specifierForControl:(id)a3;
+ (id)stringWithAddressBookValue:(id)a3 key:(id)a4;
+ (id)valueOfControlWithUniqueID:(id)a3 inForm:(id)a4;
+ (id)valuesFromUser:(id)a3 password:(id)a4 forLoginOrChangePasswordForm:(id)a5;
+ (int64_t)availableManualAutoFillActionForTextField:(id)a3 form:(id)a4 outUsernameElementUniqueID:(id *)a5 outPasswordElementUniqueID:(id *)a6 outConfirmPasswordElementUniqueID:(id *)a7;
+ (void)getFormFieldValues:(id *)a3 andFieldToFocus:(id *)a4 andCreditCardDataTypesThatWillBeFilled:(id *)a5 forCreditCardForm:(id)a6 fromCreditCardData:(id)a7;
- (BOOL)_hasAutoFillEventMatchingCriteria:(id)a3;
- (BOOL)_matchHasPreferredIdentifierOrShouldBeFilledInMultiRoundAutoFill:(id)a3 specifier:(id)a4 multiRoundAutoFillManager:(id)a5 contact:(id)a6;
- (BOOL)addressBookHasDataForLabel:(id)a3;
- (BOOL)canApplyAutoFillGracePeriodForUsername:(id)a3 inTabWithID:(id)a4 currentURL:(id)a5;
- (BOOL)canShowSavedAccountHistoryItemInTabWithID:(id)a3 currentURL:(id)a4;
- (BOOL)frameIsKnownToAskForCredentialsFromOtherServicesFromAncestorFrameURLs:(id)a3;
- (BOOL)isControlASelectElement:(id)a3;
- (BOOL)isPasswordFieldForUserCredentialsWithMetadata:(id)a3 formMetadata:(id)a4;
- (BOOL)preferredIdentifierExistsForProperty:(id)a3 withContact:(id)a4;
- (BOOL)shouldSubmitForm:(id)a3 withUser:(id)a4 password:(id)a5 onURL:(id)a6;
- (BOOL)textFieldIsEligibleForAutomaticStrongPassword:(id)a3 form:(id)a4 ignorePreviousDecision:(BOOL)a5 textFieldCurrentlyContainsStrongPassword:(BOOL *)a6;
- (BOOL)textFieldMetadataMeetsRequirementsForAutomaticStrongPasswordTreatment:(id)a3 form:(id)a4;
- (NSLocale)locale;
- (WBSFormDataController)initWithAggressiveKeychainCaching:(BOOL)a3;
- (id)_autoFillSetFromMatches:(id)a3 label:(id)a4 contact:(id)a5 form:(id)a6;
- (id)_cachedLocalizedStringsForBirthdate:(id)a3;
- (id)_completionDB;
- (id)_domainsWithPreviousDataOnInternalQueue;
- (id)_formKeyForMapOfHighLevelDomainToLastAutomaticFormSubmission:(id)a3 formMetadata:(id)a4;
- (id)_keyToLookUpInAnnotationsForPasswordForFormMetadata:(id)a3;
- (id)_knownUsernamesWithPasswordsForURL:(id)a3 inContext:(id)a4;
- (id)_lastUsedUsernameForDomain:(id)a3;
- (id)_matchesForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8;
- (id)_matchesForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 contact:(id)a8 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a9;
- (id)_nextFieldToFocusAfterFillingFieldAtIndex:(unint64_t)a3 inForm:(id)a4;
- (id)_phoneNumberCandidates:(id)a3 fillingMultipleFields:(BOOL)a4;
- (id)_recentlyUsedAutoFillDictionaries;
- (id)_singleFieldPhoneNumberCandidates:(id)a3;
- (id)_valuesForStandardForm:(id)a3 inDomain:(id)a4 autoFillDataType:(unint64_t)a5 matches:(id *)a6 preferredLabel:(id)a7 multiRoundAutoFillManager:(id)a8 wantAllMatches:(BOOL)a9 contact:(id)a10 existingMatches:(id)a11 shouldUseExistingMatchesToFillFocusedField:(BOOL)a12 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a13;
- (id)addressBookMatchesForFullNameForContact:(id)a3;
- (id)addressBookMatchesForProperty:(id)a3 key:(id)a4 label:(id)a5;
- (id)allFormDataForSaving;
- (id)annotationsFromUsername:(id)a3 forLoginOrChangePasswordForm:(id)a4;
- (id)autoGeneratedPasswordForURL:(id)a3 respectingPasswordRequirements:(id)a4 maxLength:(unint64_t)a5;
- (id)bestAddressBookLabelForFormMetadata:(id)a3 formControlValue:(id)a4;
- (id)bestMatchForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8;
- (id)bestMatchForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 contact:(id)a8 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a9;
- (id)cascadingAddressMatchesForMatch:(id)a3 contact:(id)a4;
- (id)contactAutoFillSetForRecentlyUsedAutoFillSet:(id)a3 contact:(id)a4 form:(id)a5;
- (id)domainsWithPreviousData;
- (id)encryptOrDecryptData:(id)a3 encrypt:(BOOL)a4;
- (id)exactFQDNAndOtherSavedAccountMatchesForForm:(id)a3 atURL:(id)a4 webFrameIdentifier:(id)a5 savedAccountContext:(id)a6;
- (id)extractPasswordFromForm:(id)a3 shouldPreferAnnotatedCredentials:(BOOL)a4;
- (id)extractUserNameFromForm:(id)a3 atURL:(id)a4 inContext:(id)a5;
- (id)extractUserNameFromForm:(id)a3 atURL:(id)a4 inContext:(id)a5 updateLastUsedUserName:(BOOL)a6;
- (id)infoForDomain:(id)a3;
- (id)lastUsedUsernameWithPasswordForURL:(id)a3 inContext:(id)a4;
- (id)matchesForControl:(id)a3 atURL:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a7;
- (id)matchesForControl:(id)a3 atURL:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 contact:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8;
- (id)metadataOfActiveFormOrBestFormForPageLevelAutoFill:(id)a3 frame:(OpaqueFormAutoFillFrame *)a4;
- (id)metadataOfActiveFormOrBestFormForPageLevelAutoFill:(id)a3 frameHandle:(id *)a4;
- (id)metadataOfBestFormForStreamlinedLogin:(id)a3 frame:(OpaqueFormAutoFillFrame *)a4;
- (id)metadataOfBestFormForStreamlinedLogin:(id)a3 frameHandle:(id *)a4;
- (id)orderedHomeAndWorkSetsForContact:(id)a3 form:(id)a4;
- (id)preferredIdentifierForProperty:(id)a3 withContact:(id)a4;
- (id)recentlyUsedAutoFillSetsForContact:(id)a3;
- (id)savedAccountFromMostRecentAutoFillEventOfURL:(id)a3;
- (id)savedAccountUsingDomainsToConsiderIdenticalWithUsername:(id)a3 url:(id *)a4 host:(id *)a5;
- (id)uniqueIDOfContact:(id)a3;
- (id)valuesForContactFormWithMetadata:(id)a3 inDomain:(id)a4 matches:(id *)a5 multiRoundAutoFillManager:(id)a6;
- (id)valuesForContactFormWithMetadata:(id)a3 inDomain:(id)a4 matches:(id *)a5 multiRoundAutoFillManager:(id)a6 contact:(id)a7;
- (id)valuesForContactFormWithMetadata:(id)a3 matches:(id *)a4 multiRoundAutoFillManager:(id)a5 existingMatches:(id)a6 contact:(id)a7;
- (id)valuesForContactFormWithMetadata:(id)a3 matches:(id *)a4 multiRoundAutoFillManager:(id)a5 existingMatches:(id)a6 shouldUseExistingMatchesToFillFocusedField:(BOOL)a7 contact:(id)a8;
- (id)valuesForFormWithMetadata:(id)a3 hideMyEmailRecord:(id)a4;
- (id)valuesForStandardForm:(id)a3 inDomain:(id)a4 autoFillDataType:(unint64_t)a5 matches:(id *)a6 preferredLabel:(id)a7 multiRoundAutoFillManager:(id)a8;
- (id)valuesForStandardForm:(id)a3 inDomain:(id)a4 autoFillDataType:(unint64_t)a5 matches:(id *)a6 preferredLabel:(id)a7 multiRoundAutoFillManager:(id)a8 contact:(id)a9 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a10;
- (int64_t)autoFillActionForFormType:(unint64_t)a3 onURL:(id)a4 shouldSubmitAfterFilling:(BOOL)a5;
- (unint64_t)_addMatchesForControl:(id)a3 startingAtIndex:(unint64_t)a4 formMetadata:(id)a5 fromExistingMatches:(id)a6 fromAllMatchesIfNecessary:(id)a7 addToFoundMatches:(id)a8 addToAutoFillValues:(id)a9 multiRoundAutoFillManager:(id)a10 propertyToIdentifierMapForFoundMatches:(id)a11 shouldUseExistingMatchesToFillFocusedField:(BOOL)a12;
- (unint64_t)_indexForControlWithUniqueID:(id)a3 inForm:(id)a4;
- (unint64_t)addValuesForStandardFormControls:(id)a3 startingAtIndex:(unint64_t)a4 fromAutoFillItem:(id)a5 toDictionary:(id)a6 formTextSample:(id)a7 multiRoundAutoFillManager:(id)a8;
- (unint64_t)addValuesForStandardFormControlsInForm:(id)a3 startingAtIndex:(unint64_t)a4 fromAutoFillItem:(id)a5 toDictionary:(id)a6 multiRoundAutoFillManager:(id)a7;
- (void)_currentLocaleDidChange:(id)a3;
- (void)_dropValuesFromRecentlyUsedAutoFillSets;
- (void)_fillPhoneNumber:(id)a3 intoValues:(id)a4 controls:(id)a5 formTextSample:(id)a6 multiRoundAutoFillManager:(id)a7;
- (void)_loadCompletionDBIfNeededOnInternalQueue;
- (void)_processMatchesArray:(id)a3 autoFillSetKey:(id)a4 autoFillSet:(id)a5 madeChanges:(BOOL *)a6;
- (void)_removeExpiredAutoFillEvents:(id)a3;
- (void)_removeStaleEntriesFromMapOfHighLevelDomainToLastAutomaticFormSubmission;
- (void)_setLastUsedUsername:(id)a3 andProtectionSpace:(id)a4 forDomain:(id)a5;
- (void)addABMatchesForValueSpecifier:(id)a3 matchingPartialString:(id)a4 toArray:(id)a5 preferredLabel:(id)a6 contact:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8;
- (void)addAllAddressDataIfNecessary:(id)a3 contactLabel:(id)a4 contact:(id)a5;
- (void)addPreviousDataMatchesForFieldWithName:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 toArray:(id)a6;
- (void)addRecentlyUsedAutoFillSet:(id)a3 appendToTheEnd:(BOOL)a4;
- (void)canAutomaticallyRegisterPasskeyForUsername:(id)a3 inTabWithID:(id)a4 currentURL:(id)a5 completionHandler:(id)a6;
- (void)clearPreviousDataDatabaseItemsAddedAfterDate:(id)a3;
- (void)clearPreviousDataForDomain:(id)a3;
- (void)dealloc;
- (void)didAutomaticallySubmitFormWhenFillingOnURL:(id)a3 formMetadata:(id)a4;
- (void)didFillPasswordForUsername:(id)a3 fromProviderWithBundleIdentifier:(id)a4 inTabWithID:(id)a5 currentURL:(id)a6 isPrivate:(BOOL)a7 formMetadata:(id)a8 requester:(id)a9;
- (void)getFormFieldValues:(id *)a3 andFieldToFocus:(id *)a4 withSingleCreditCardData:(id)a5 inField:(id)a6 inForm:(id)a7;
- (void)getSavedAccountMatchesWithCriteria:(id)a3 synchronously:(BOOL)a4 completionHandler:(id)a5;
- (void)loadCompletionDBIfNeeded;
- (void)pruneCompletionDB;
- (void)saveRecentlyUsedAutoFillSetWithMatchesToFill:(id)a3 matchesForDoNotFill:(id)a4;
- (void)setInfo:(id)a3 forDomain:(id)a4;
- (void)setPreferredIdentifier:(id)a3 forProperty:(id)a4 withContact:(id)a5;
- (void)updateLastUsedUsernameAndExtractUsernameAndPasswordFromForm:(id)a3 shouldPreferAnnotatedCredentials:(BOOL)a4 atURL:(id)a5 username:(id *)a6 password:(id *)a7 inContext:(id)a8;
@end

@implementation WBSFormDataController

+ (BOOL)convertNumber:(id)a3 toAutoFillFormType:(unint64_t *)a4
{
  v5 = a3;
  v6 = v5;
  v7 = 0;
  if (v5 && a4)
  {
    v8 = [v5 unsignedIntegerValue];
    if (v8 > 5)
    {
      v7 = 0;
    }

    else
    {
      *a4 = v8;
      v7 = 1;
    }
  }

  return v7;
}

+ (id)metadataForControlWithUniqueID:(id)a3 inForm:(id)a4
{
  v19 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v6 = [a4 controls];
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = *v15;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v11 = [v10 uniqueID];
          v12 = [v11 isEqualToString:v5];

          if (v12)
          {
            v7 = v10;
            goto LABEL_12;
          }
        }
      }

      v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  return v7;
}

+ (id)valueOfControlWithUniqueID:(id)a3 inForm:(id)a4
{
  v4 = [a1 metadataForControlWithUniqueID:a3 inForm:a4];
  v5 = [v4 value];

  return v5;
}

- (int64_t)autoFillActionForFormType:(unint64_t)a3 onURL:(id)a4 shouldSubmitAfterFilling:(BOOL)a5
{
  v5 = a5;
  v8 = a4;
  v9 = 0;
  if (a3 == 3 && v5)
  {
    v9 = [(WBSAutoFillQuirksManager *)self->_autoFillQuirksManager isAutomaticLoginDisallowedOnURL:v8]^ 1;
  }

  return v9;
}

- (BOOL)shouldSubmitForm:(id)a3 withUser:(id)a4 password:(id)a5 onURL:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a6;
  [(WBSFormDataController *)self _removeStaleEntriesFromMapOfHighLevelDomainToLastAutomaticFormSubmission];
  v13 = [v12 host];
  v14 = [v13 safari_highLevelDomainFromHost];

  if (v14)
  {
    v15 = [(WBSFormDataController *)self _formKeyForMapOfHighLevelDomainToLastAutomaticFormSubmission:v12 formMetadata:v10];
    v16 = [(NSMutableDictionary *)self->_mapOfHighLevelDomainToLastAutomaticFormSubmission objectForKeyedSubscript:v15];
    if (v16 && -[WBSFormDataController _dateIsWithinGracePeriodForNotAutomaticallySubmittingLoginForms:](self, "_dateIsWithinGracePeriodForNotAutomaticallySubmittingLoginForms:", v16) || [v10 type] != 3)
    {
      goto LABEL_9;
    }

    v17 = [v10 isEligibleForAutomaticLogin] ^ 1;
    if (!a5)
    {
      LOBYTE(v17) = 1;
    }

    if (v17)
    {
LABEL_9:
      v18 = 0;
    }

    else
    {
      v18 = [v11 length] != 0;
    }
  }

  else
  {
    v18 = 1;
  }

  return v18;
}

- (void)didAutomaticallySubmitFormWhenFillingOnURL:(id)a3 formMetadata:(id)a4
{
  v11 = a3;
  v6 = a4;
  v7 = [v11 host];
  v8 = [v7 safari_highLevelDomainFromHost];

  if (v8)
  {
    v9 = [(WBSFormDataController *)self _formKeyForMapOfHighLevelDomainToLastAutomaticFormSubmission:v11 formMetadata:v6];
    v10 = [MEMORY[0x1E695DF00] date];
    [(NSMutableDictionary *)self->_mapOfHighLevelDomainToLastAutomaticFormSubmission setObject:v10 forKeyedSubscript:v9];
  }
}

- (id)_formKeyForMapOfHighLevelDomainToLastAutomaticFormSubmission:(id)a3 formMetadata:(id)a4
{
  v29 = *MEMORY[0x1E69E9840];
  v22 = a4;
  v5 = [a3 host];
  v23 = [v5 safari_highLevelDomainFromHost];

  v6 = [v22 userNameElementUniqueID];
  v7 = [v22 passwordElementUniqueID];
  v26 = 0u;
  v27 = 0u;
  v24 = 0u;
  v25 = 0u;
  v8 = [v22 controls];
  v9 = 0;
  v10 = 0;
  v11 = [v8 countByEnumeratingWithState:&v24 objects:v28 count:16];
  if (v11)
  {
    v12 = *v25;
    do
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v25 != v12)
        {
          objc_enumerationMutation(v8);
        }

        v14 = *(*(&v24 + 1) + 8 * i);
        v15 = [v14 uniqueID];
        if ([v6 length] && objc_msgSend(v15, "isEqualToString:", v6))
        {
          v10 = [v14 isVisible];
        }

        else if ([v7 length] && objc_msgSend(v15, "isEqualToString:", v7))
        {
          v9 = [v14 isVisible];
        }
      }

      v11 = [v8 countByEnumeratingWithState:&v24 objects:v28 count:16];
    }

    while (v11);
  }

  v16 = [v6 length];
  v17 = [v7 length];
  if ((v17 != 0) & v9 | !((v16 != 0) & v10))
  {
    v18 = @"%@|U|P";
  }

  else
  {
    v18 = @"%@|U";
  }

  if (!((v17 != 0) & v9) | (v16 != 0) & v10)
  {
    v19 = v18;
  }

  else
  {
    v19 = @"%@|P";
  }

  v20 = [MEMORY[0x1E696AEC0] stringWithFormat:v19, v23];

  return v20;
}

- (void)_removeStaleEntriesFromMapOfHighLevelDomainToLastAutomaticFormSubmission
{
  mapOfHighLevelDomainToLastAutomaticFormSubmission = self->_mapOfHighLevelDomainToLastAutomaticFormSubmission;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __97__WBSFormDataController__removeStaleEntriesFromMapOfHighLevelDomainToLastAutomaticFormSubmission__block_invoke;
  v7[3] = &unk_1E7FC5C90;
  v7[4] = self;
  v4 = [(NSMutableDictionary *)mapOfHighLevelDomainToLastAutomaticFormSubmission safari_mapAndFilterKeysAndObjectsUsingBlock:v7];
  v5 = [v4 mutableCopy];
  v6 = self->_mapOfHighLevelDomainToLastAutomaticFormSubmission;
  self->_mapOfHighLevelDomainToLastAutomaticFormSubmission = v5;
}

void *__97__WBSFormDataController__removeStaleEntriesFromMapOfHighLevelDomainToLastAutomaticFormSubmission__block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v4 = a3;
  if ([*(a1 + 32) _dateIsWithinGracePeriodForNotAutomaticallySubmittingLoginForms:v4])
  {
    v5 = v4;
  }

  else
  {
    v5 = 0;
  }

  v6 = v5;

  return v5;
}

+ (id)fieldToFocusBeforeSubmittingForm:(id)a3
{
  v3 = a3;
  v4 = [v3 passwordElementUniqueID];
  v5 = v4;
  if (v4)
  {
    v6 = v4;
  }

  else
  {
    v6 = [v3 userNameElementUniqueID];
  }

  v7 = v6;

  return v7;
}

- (WBSFormDataController)initWithAggressiveKeychainCaching:(BOOL)a3
{
  v24.receiver = self;
  v24.super_class = WBSFormDataController;
  v3 = [(WBSFormDataController *)&v24 init];
  if (v3)
  {
    v4 = [MEMORY[0x1E696AD88] defaultCenter];
    [v4 addObserver:v3 selector:sel__currentLocaleDidChange_ name:*MEMORY[0x1E695D8F0] object:0];

    v5 = MEMORY[0x1E696AEC0];
    v6 = objc_opt_class();
    v7 = NSStringFromClass(v6);
    v8 = [v5 stringWithFormat:@"com.apple.Safari.%@.%p.internalQueue", v7, v3];
    v9 = dispatch_queue_create([v8 UTF8String], 0);
    internalQueue = v3->_internalQueue;
    v3->_internalQueue = v9;

    v11 = objc_alloc(MEMORY[0x1E69C8820]);
    v12 = [MEMORY[0x1E696AAE8] safari_safariCoreBundle];
    v13 = [v12 URLForResource:@"WBSAutoFillQuirks" withExtension:@"plist"];
    v14 = [MEMORY[0x1E696AC08] defaultManager];
    v15 = [v14 safari_autoFillQuirksDownloadDirectoryURL];
    v16 = [v11 initWithBuiltInQuirksURL:v13 downloadsDirectoryURL:v15 resourceName:@"AutoFillQuirks" resourceVersion:@"1" updateDateDefaultsKey:*MEMORY[0x1E69C8CF8] updateInterval:86400.0];
    autoFillQuirksManager = v3->_autoFillQuirksManager;
    v3->_autoFillQuirksManager = v16;

    [(WBSAutoFillQuirksManager *)v3->_autoFillQuirksManager beginLoadingQuirksFromDisk];
    v18 = objc_alloc_init(MEMORY[0x1E695DF90]);
    mapOfHighLevelDomainToLastAutomaticFormSubmission = v3->_mapOfHighLevelDomainToLastAutomaticFormSubmission;
    v3->_mapOfHighLevelDomainToLastAutomaticFormSubmission = v18;

    v20 = objc_alloc_init(MEMORY[0x1E69C8818]);
    agentProxy = v3->_agentProxy;
    v3->_agentProxy = v20;

    v22 = v3;
  }

  return v3;
}

- (void)dealloc
{
  [(WBSKeychainCredentialNotificationMonitor *)self->_keychainMonitor removeObserverForToken:self->_keychainNotificationRegistrationToken];
  [(WBSAutoFillQuirksManager *)self->_autoFillQuirksManager prepareForTermination];
  if (self->_keybagCallbackToken)
  {
    v3 = [MEMORY[0x1E69C88B0] sharedManager];
    [v3 removeKeyBagLockStatusChangedObserver:self->_keybagCallbackToken];

    keybagCallbackToken = self->_keybagCallbackToken;
    self->_keybagCallbackToken = 0;
  }

  v5.receiver = self;
  v5.super_class = WBSFormDataController;
  [(WBSFormDataController *)&v5 dealloc];
}

- (void)_loadCompletionDBIfNeededOnInternalQueue
{
  p_completionDB = &self->_completionDB;
  if (!self->_completionDB)
  {
    v4 = [(WBSFormDataController *)self completionDBPath];
    v5 = MEMORY[0x1E695DEF0];
    v6 = [MEMORY[0x1E695DFF8] fileURLWithPath:v4 isDirectory:0];
    v7 = [v5 dataWithContentsOfURL:v6];

    if (v7)
    {
      self->_completionDBSize = [v7 length];
      v8 = [(WBSFormDataController *)self encryptOrDecryptData:v7 encrypt:0];
      if (v8)
      {
        v9 = [MEMORY[0x1E696AE40] propertyListWithData:v8 options:1 format:0 error:0];
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          objc_storeStrong(p_completionDB, v9);
        }

        v10 = [(NSMutableDictionary *)*p_completionDB safari_dictionaryForKey:@"Values"];
        valuesDB = self->_valuesDB;
        self->_valuesDB = v10;

        completionDB = self->_completionDB;
        if (self->_valuesDB)
        {
          v13 = [(NSMutableDictionary *)completionDB safari_dictionaryForKey:@"PreferredLabels"];
          preferredLabelsMap = self->_preferredLabelsMap;
          self->_preferredLabelsMap = v13;

          v15 = [(NSMutableDictionary *)self->_completionDB safari_arrayForKey:@"RecentlyUsedAutoFillSets"];
          recentlyUsedAutoFillSets = self->_recentlyUsedAutoFillSets;
          self->_recentlyUsedAutoFillSets = v15;

          v17 = [(NSMutableDictionary *)self->_completionDB safari_dictionaryForKey:@"PreferredLabelsForUniqueIDOfPerson"];
          preferredLabelForUniqueIDOfPersonMap = self->_preferredLabelForUniqueIDOfPersonMap;
          self->_preferredLabelForUniqueIDOfPersonMap = v17;

          [(WBSFormDataController *)self _dropValuesFromRecentlyUsedAutoFillSets];
        }

        else
        {
          self->_completionDB = 0;

          v19 = self->_preferredLabelsMap;
          self->_preferredLabelsMap = 0;

          v20 = self->_recentlyUsedAutoFillSets;
          self->_recentlyUsedAutoFillSets = 0;

          v21 = self->_preferredLabelForUniqueIDOfPersonMap;
          self->_preferredLabelForUniqueIDOfPersonMap = 0;
        }
      }
    }

    if (!*p_completionDB)
    {
      v22 = [MEMORY[0x1E696AC08] defaultManager];
      v23 = [v22 fileExistsAtPath:v4];

      if (v23)
      {
        v24 = WBS_LOG_CHANNEL_PREFIXAutoFill();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
        {
          [WBSFormDataController _loadCompletionDBIfNeededOnInternalQueue];
        }
      }

      v25 = objc_alloc_init(MEMORY[0x1E695DF90]);
      v26 = *p_completionDB;
      *p_completionDB = v25;

      v27 = objc_alloc_init(MEMORY[0x1E695DF90]);
      v28 = self->_valuesDB;
      self->_valuesDB = v27;

      [(NSMutableDictionary *)self->_completionDB setObject:self->_valuesDB forKey:@"Values"];
      self->_completionDBSize = 0;
    }

    if (!self->_preferredLabelsMap)
    {
      v29 = objc_alloc_init(MEMORY[0x1E695DF90]);
      v30 = self->_preferredLabelsMap;
      self->_preferredLabelsMap = v29;

      [(NSMutableDictionary *)self->_completionDB setObject:self->_preferredLabelsMap forKey:@"PreferredLabels"];
    }

    if (!self->_recentlyUsedAutoFillSets)
    {
      v31 = objc_alloc_init(MEMORY[0x1E695DF70]);
      v32 = self->_recentlyUsedAutoFillSets;
      self->_recentlyUsedAutoFillSets = v31;

      [(NSMutableDictionary *)self->_completionDB setObject:self->_recentlyUsedAutoFillSets forKey:@"RecentlyUsedAutoFillSets"];
    }

    if (!self->_preferredLabelForUniqueIDOfPersonMap)
    {
      v33 = objc_alloc_init(MEMORY[0x1E695DF90]);
      v34 = self->_preferredLabelForUniqueIDOfPersonMap;
      self->_preferredLabelForUniqueIDOfPersonMap = v33;

      [(NSMutableDictionary *)self->_completionDB setObject:self->_preferredLabelForUniqueIDOfPersonMap forKey:@"PreferredLabelsForUniqueIDOfPerson"];
    }
  }
}

- (void)loadCompletionDBIfNeeded
{
  internalQueue = self->_internalQueue;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __49__WBSFormDataController_loadCompletionDBIfNeeded__block_invoke;
  block[3] = &unk_1E7FB6F80;
  block[4] = self;
  dispatch_sync(internalQueue, block);
}

- (void)pruneCompletionDB
{
  internalQueue = self->_internalQueue;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __42__WBSFormDataController_pruneCompletionDB__block_invoke;
  block[3] = &unk_1E7FB6F80;
  block[4] = self;
  dispatch_async(internalQueue, block);
}

uint64_t __42__WBSFormDataController_pruneCompletionDB__block_invoke(uint64_t a1)
{
  v1 = a1;
  v45 = *MEMORY[0x1E69E9840];
  v41 = 0;
  v42 = 0;
  [*(a1 + 32) _loadCompletionDBIfNeededOnInternalQueue];
  v39 = 0u;
  v40 = 0u;
  v37 = 0u;
  v38 = 0u;
  obj = [*(v1 + 32) _domainsWithPreviousDataOnInternalQueue];
  v2 = [obj countByEnumeratingWithState:&v37 objects:v44 count:16];
  if (v2)
  {
    v25 = v1;
    v26 = *v38;
    do
    {
      v27 = v2;
      for (i = 0; i != v27; ++i)
      {
        if (*v38 != v26)
        {
          objc_enumerationMutation(obj);
        }

        v4 = *(*(&v37 + 1) + 8 * i);
        v5 = [*(*(v1 + 32) + 32) safari_dictionaryForKey:v4];
        if ([v5 count])
        {
          v35 = 0u;
          v36 = 0u;
          v33 = 0u;
          v34 = 0u;
          v6 = v5;
          v7 = [v6 countByEnumeratingWithState:&v33 objects:v43 count:16];
          if (v7)
          {
            v8 = *v34;
            do
            {
              for (j = 0; j != v7; ++j)
              {
                if (*v34 != v8)
                {
                  objc_enumerationMutation(v6);
                }

                v10 = *(*(&v33 + 1) + 8 * j);
                v30 = 0;
                v31 = 0;
                v30 = v4;
                objc_storeStrong(&v31, v10);
                v11 = [v6 safari_arrayForKey:v10];
                v32 = timestampForCompletionValues(v11);

                if (HIDWORD(v42) == v42)
                {
                  WTF::Vector<SortEntry,0ul,WTF::CrashOnOverflow,16ul,WTF::FastMalloc>::appendSlowCase<(WTF::FailureAction)0,SortEntry&>(&v41, &v30);
                }

                else
                {
                  v12 = v41 + 24 * HIDWORD(v42);
                  *v12 = v30;
                  *(v12 + 8) = v31;
                  *(v12 + 16) = v32;
                  ++HIDWORD(v42);
                }
              }

              v7 = [v6 countByEnumeratingWithState:&v33 objects:v43 count:16];
            }

            while (v7);
          }
        }

        v1 = v25;
      }

      v2 = [obj countByEnumeratingWithState:&v37 objects:v44 count:16];
    }

    while (v2);
  }

  v13 = v1;

  v30 = &__block_literal_global_50;
  v14 = 126 - 2 * __clz(HIDWORD(v42));
  if (HIDWORD(v42))
  {
    v15 = v14;
  }

  else
  {
    v15 = 0;
  }

  std::__introsort<std::_ClassicAlgPolicy,BOOL({block_pointer} {__strong}&)(SortEntry const&,SortEntry const&),SortEntry*,false>(v41, (v41 + 24 * HIDWORD(v42)), &v30, v15, 1);

  LODWORD(v1) = vcvtps_s32_f32(HIDWORD(v42) * 0.1);
  if (v1 < 1)
  {
    v17 = 0;
  }

  else
  {
    v16 = 0;
    v17 = 0;
    v18 = 8;
    do
    {
      if (v16 >= HIDWORD(v42) || (v19 = *(v41 + v18 - 8), [*(*(v13 + 32) + 32) safari_dictionaryForKey:v19], v20 = objc_claimAutoreleasedReturnValue(), v16 >= HIDWORD(v42)))
      {
        __break(0xC471u);
        JUMPOUT(0x1BB7760C8);
      }

      v21 = v20;
      [v20 removeObjectForKey:*(v41 + v18)];
      if (![v21 count])
      {
        [*(*(v13 + 32) + 32) removeObjectForKey:v19];
        v17 = 1;
      }

      ++v16;
      v18 += 24;
    }

    while (v1 != v16);
  }

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __42__WBSFormDataController_pruneCompletionDB__block_invoke_3;
  block[3] = &unk_1E7FB7A40;
  v29 = v17 & 1;
  block[4] = *(v13 + 32);
  dispatch_async(MEMORY[0x1E69E96A0], block);
  return WTF::Vector<SortEntry,0ul,WTF::CrashOnOverflow,16ul,WTF::FastMalloc>::~Vector(&v41, v22);
}

uint64_t __42__WBSFormDataController_pruneCompletionDB__block_invoke_3(uint64_t result)
{
  if (*(result + 40) == 1)
  {
    return [*(result + 32) domainsWithPreviousDataChanged];
  }

  return result;
}

- (id)_completionDB
{
  v6 = 0;
  v7 = &v6;
  v8 = 0x3032000000;
  v9 = __Block_byref_object_copy__13;
  v10 = __Block_byref_object_dispose__13;
  v11 = 0;
  internalQueue = self->_internalQueue;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __38__WBSFormDataController__completionDB__block_invoke;
  v5[3] = &unk_1E7FB8798;
  v5[4] = self;
  v5[5] = &v6;
  dispatch_sync(internalQueue, v5);
  v3 = v7[5];
  _Block_object_dispose(&v6, 8);

  return v3;
}

void __38__WBSFormDataController__completionDB__block_invoke(uint64_t a1)
{
  v2 = [*(*(a1 + 32) + 24) copy];
  v3 = *(*(a1 + 40) + 8);
  v4 = *(v3 + 40);
  *(v3 + 40) = v2;
}

- (id)allFormDataForSaving
{
  if (self->_completionDBSize > 0x7D000)
  {
    [(WBSFormDataController *)self pruneCompletionDB];
  }

  v3 = MEMORY[0x1E696AE40];
  v4 = [(WBSFormDataController *)self _completionDB];
  v11 = 0;
  v5 = [v3 dataWithPropertyList:v4 format:200 options:0 error:&v11];
  v6 = v11;

  if (v5)
  {
    v7 = [(WBSFormDataController *)self encryptOrDecryptData:v5 encrypt:1];
  }

  else
  {
    v8 = WBS_LOG_CHANNEL_PREFIXAutoFill();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      [WBSFormDataController allFormDataForSaving];
    }

    v7 = [MEMORY[0x1E695DEF0] data];
  }

  v9 = v7;

  return v9;
}

- (void)_dropValuesFromRecentlyUsedAutoFillSets
{
  v18 = *MEMORY[0x1E69E9840];
  recentlyUsedAutoFillSets = self->_recentlyUsedAutoFillSets;
  if (recentlyUsedAutoFillSets && [(NSMutableArray *)recentlyUsedAutoFillSets count])
  {
    v16 = 0;
    v12 = 0u;
    v13 = 0u;
    v14 = 0u;
    v15 = 0u;
    v4 = self->_recentlyUsedAutoFillSets;
    v5 = [(NSMutableArray *)v4 countByEnumeratingWithState:&v12 objects:v17 count:16];
    if (v5)
    {
      v6 = *v13;
      do
      {
        v7 = 0;
        do
        {
          if (*v13 != v6)
          {
            objc_enumerationMutation(v4);
          }

          v8 = *(*(&v12 + 1) + 8 * v7);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v9 = [v8 objectForKeyedSubscript:@"recentlyUsedAutoFillSetArray"];
            [(WBSFormDataController *)self _processMatchesArray:v9 autoFillSetKey:@"recentlyUsedAutoFillSetArray" autoFillSet:v8 madeChanges:&v16];

            v10 = [v8 objectForKeyedSubscript:@"recentlyUsedAutoFillSetDoNotFillArray"];
            [(WBSFormDataController *)self _processMatchesArray:v10 autoFillSetKey:@"recentlyUsedAutoFillSetDoNotFillArray" autoFillSet:v8 madeChanges:&v16];
          }

          ++v7;
        }

        while (v5 != v7);
        v5 = [(NSMutableArray *)v4 countByEnumeratingWithState:&v12 objects:v17 count:16];
      }

      while (v5);
    }

    if (v16 == 1)
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __64__WBSFormDataController__dropValuesFromRecentlyUsedAutoFillSets__block_invoke;
      block[3] = &unk_1E7FB6F80;
      block[4] = self;
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }
  }
}

- (void)_processMatchesArray:(id)a3 autoFillSetKey:(id)a4 autoFillSet:(id)a5 madeChanges:(BOOL *)a6
{
  v21 = *MEMORY[0x1E69E9840];
  v7 = a3;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) != 0 && [v7 count])
  {
    v18 = 0u;
    v19 = 0u;
    v16 = 0u;
    v17 = 0u;
    v8 = v7;
    v15 = v7;
    v9 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
    if (v9)
    {
      v10 = *v17;
      do
      {
        v11 = 0;
        do
        {
          if (*v17 != v10)
          {
            objc_enumerationMutation(v8);
          }

          v12 = *(*(&v16 + 1) + 8 * v11);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v13 = [v12 objectForKeyedSubscript:@"Value"];
            v14 = v13 == 0;

            if (!v14)
            {
              *a6 = 1;
              [v12 removeObjectForKey:@"Value"];
            }
          }

          ++v11;
        }

        while (v9 != v11);
        v9 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
      }

      while (v9);
    }

    v7 = v15;
  }
}

- (id)_domainsWithPreviousDataOnInternalQueue
{
  v3 = [(NSMutableDictionary *)self->_valuesDB count];
  if (v3)
  {
    v3 = [(NSMutableDictionary *)self->_valuesDB allKeys];
  }

  return v3;
}

- (id)domainsWithPreviousData
{
  v6 = 0;
  v7 = &v6;
  v8 = 0x3032000000;
  v9 = __Block_byref_object_copy__13;
  v10 = __Block_byref_object_dispose__13;
  v11 = 0;
  internalQueue = self->_internalQueue;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __48__WBSFormDataController_domainsWithPreviousData__block_invoke;
  v5[3] = &unk_1E7FB87C0;
  v5[4] = self;
  v5[5] = &v6;
  dispatch_sync(internalQueue, v5);
  v3 = v7[5];
  _Block_object_dispose(&v6, 8);

  return v3;
}

void __48__WBSFormDataController_domainsWithPreviousData__block_invoke(uint64_t a1)
{
  [*(a1 + 32) _loadCompletionDBIfNeededOnInternalQueue];
  v2 = [*(a1 + 32) _domainsWithPreviousDataOnInternalQueue];
  v3 = *(*(a1 + 40) + 8);
  v4 = *(v3 + 40);
  *(v3 + 40) = v2;
}

- (void)clearPreviousDataForDomain:(id)a3
{
  v4 = a3;
  internalQueue = self->_internalQueue;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __52__WBSFormDataController_clearPreviousDataForDomain___block_invoke;
  v7[3] = &unk_1E7FB7F10;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(internalQueue, v7);
}

void __52__WBSFormDataController_clearPreviousDataForDomain___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _loadCompletionDBIfNeededOnInternalQueue];
  v2 = [*(*(a1 + 32) + 32) objectForKey:*(a1 + 40)];

  if (v2)
  {
    [*(*(a1 + 32) + 32) removeObjectForKey:*(a1 + 40)];
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __52__WBSFormDataController_clearPreviousDataForDomain___block_invoke_2;
    block[3] = &unk_1E7FB6F80;
    block[4] = *(a1 + 32);
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }
}

uint64_t __52__WBSFormDataController_clearPreviousDataForDomain___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) domainsWithPreviousDataChanged];
  v2 = *(a1 + 32);

  return [v2 saveCompletionDBSoon];
}

- (void)clearPreviousDataDatabaseItemsAddedAfterDate:(id)a3
{
  v4 = a3;
  internalQueue = self->_internalQueue;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __70__WBSFormDataController_clearPreviousDataDatabaseItemsAddedAfterDate___block_invoke;
  v7[3] = &unk_1E7FB7F10;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(internalQueue, v7);
}

void __70__WBSFormDataController_clearPreviousDataDatabaseItemsAddedAfterDate___block_invoke(uint64_t a1)
{
  v30 = *MEMORY[0x1E69E9840];
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  obj = [*(a1 + 32) _domainsWithPreviousDataOnInternalQueue];
  v2 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
  if (v2)
  {
    v17 = 0;
    v13 = *v25;
    v14 = v2;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v25 != v13)
        {
          objc_enumerationMutation(obj);
        }

        v15 = *(*(&v24 + 1) + 8 * i);
        v3 = [*(*(a1 + 32) + 32) safari_dictionaryForKey:?];
        if ([v3 count])
        {
          v22 = 0u;
          v23 = 0u;
          v20 = 0u;
          v21 = 0u;
          v4 = [v3 allKeys];
          v5 = [v4 countByEnumeratingWithState:&v20 objects:v28 count:16];
          if (v5)
          {
            v6 = *v21;
            do
            {
              for (j = 0; j != v5; ++j)
              {
                if (*v21 != v6)
                {
                  objc_enumerationMutation(v4);
                }

                v8 = *(*(&v20 + 1) + 8 * j);
                v9 = [v3 safari_arrayForKey:v8];
                v10 = timestampForCompletionValues(v9);

                v11 = [MEMORY[0x1E695DF00] dateWithTimeIntervalSinceReferenceDate:v10];
                if ([v11 compare:*(a1 + 40)] == 1)
                {
                  [v3 removeObjectForKey:v8];
                  v17 = 1;
                }
              }

              v5 = [v4 countByEnumeratingWithState:&v20 objects:v28 count:16];
            }

            while (v5);
          }

          if (![v3 count])
          {
            [*(*(a1 + 32) + 32) removeObjectForKey:v15];
          }
        }

        else
        {
          [*(*(a1 + 32) + 32) removeObjectForKey:v15];
          v17 = 1;
        }
      }

      v14 = [obj countByEnumeratingWithState:&v24 objects:v29 count:16];
    }

    while (v14);
  }

  else
  {
    v17 = 0;
  }

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __70__WBSFormDataController_clearPreviousDataDatabaseItemsAddedAfterDate___block_invoke_2;
  block[3] = &unk_1E7FB7A40;
  v19 = v17 & 1;
  block[4] = *(a1 + 32);
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

uint64_t __70__WBSFormDataController_clearPreviousDataDatabaseItemsAddedAfterDate___block_invoke_2(uint64_t result)
{
  if (*(result + 40) == 1)
  {
    v2 = result;
    [*(result + 32) saveCompletionDBSoon];
    v3 = *(v2 + 32);

    return [v3 domainsWithPreviousDataChanged];
  }

  return result;
}

- (id)infoForDomain:(id)a3
{
  v4 = a3;
  v12 = 0;
  v13 = &v12;
  v14 = 0x3032000000;
  v15 = __Block_byref_object_copy__13;
  v16 = __Block_byref_object_dispose__13;
  v17 = 0;
  internalQueue = self->_internalQueue;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __39__WBSFormDataController_infoForDomain___block_invoke;
  block[3] = &unk_1E7FC5CD8;
  v10 = v4;
  v11 = &v12;
  block[4] = self;
  v6 = v4;
  dispatch_sync(internalQueue, block);
  v7 = v13[5];

  _Block_object_dispose(&v12, 8);

  return v7;
}

void __39__WBSFormDataController_infoForDomain___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _loadCompletionDBIfNeededOnInternalQueue];
  v2 = [*(*(a1 + 32) + 32) safari_dictionaryForKey:*(a1 + 40)];
  v3 = *(*(a1 + 48) + 8);
  v4 = *(v3 + 40);
  *(v3 + 40) = v2;
}

- (void)setInfo:(id)a3 forDomain:(id)a4
{
  v6 = a3;
  v7 = a4;
  internalQueue = self->_internalQueue;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __43__WBSFormDataController_setInfo_forDomain___block_invoke;
  block[3] = &unk_1E7FB7DD0;
  block[4] = self;
  v12 = v6;
  v13 = v7;
  v9 = v7;
  v10 = v6;
  dispatch_async(internalQueue, block);
}

- (id)uniqueIDOfContact:(id)a3
{
  v3 = [a3 identifier];

  return v3;
}

- (void)setPreferredIdentifier:(id)a3 forProperty:(id)a4 withContact:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  internalQueue = self->_internalQueue;
  v15[0] = MEMORY[0x1E69E9820];
  v15[1] = 3221225472;
  v15[2] = __72__WBSFormDataController_setPreferredIdentifier_forProperty_withContact___block_invoke;
  v15[3] = &unk_1E7FC5D00;
  v15[4] = self;
  v16 = v10;
  v17 = v8;
  v18 = v9;
  v12 = v9;
  v13 = v8;
  v14 = v10;
  dispatch_async(internalQueue, v15);
}

void __72__WBSFormDataController_setPreferredIdentifier_forProperty_withContact___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _loadCompletionDBIfNeededOnInternalQueue];
  v5 = [*(a1 + 32) uniqueIDOfContact:*(a1 + 40)];
  v2 = [*(*(a1 + 32) + 72) objectForKeyedSubscript:?];
  v3 = v2;
  if (v2)
  {
    [v2 setObject:*(a1 + 48) forKey:*(a1 + 56)];
  }

  else
  {
    v4 = objc_opt_new();
    [v4 setObject:*(a1 + 48) forKeyedSubscript:*(a1 + 56)];
    v3 = v4;
    [*(*(a1 + 32) + 72) setObject:v4 forKey:v5];
  }
}

- (id)preferredIdentifierForProperty:(id)a3 withContact:(id)a4
{
  v6 = a3;
  v7 = a4;
  v17 = 0;
  v18 = &v17;
  v19 = 0x3032000000;
  v20 = __Block_byref_object_copy__13;
  v21 = __Block_byref_object_dispose__13;
  v22 = 0;
  internalQueue = self->_internalQueue;
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __68__WBSFormDataController_preferredIdentifierForProperty_withContact___block_invoke;
  v13[3] = &unk_1E7FC5D28;
  v13[4] = self;
  v14 = v7;
  v15 = v6;
  v16 = &v17;
  v9 = v6;
  v10 = v7;
  dispatch_sync(internalQueue, v13);
  v11 = v18[5];

  _Block_object_dispose(&v17, 8);

  return v11;
}

void __68__WBSFormDataController_preferredIdentifierForProperty_withContact___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _loadCompletionDBIfNeededOnInternalQueue];
  v2 = *(a1 + 32);
  v3 = v2[9];
  v4 = [v2 uniqueIDOfContact:*(a1 + 40)];
  v8 = [v3 safari_dictionaryForKey:v4];

  v5 = [v8 safari_stringForKey:*(a1 + 48)];
  v6 = *(*(a1 + 56) + 8);
  v7 = *(v6 + 40);
  *(v6 + 40) = v5;
}

- (BOOL)preferredIdentifierExistsForProperty:(id)a3 withContact:(id)a4
{
  v6 = a3;
  v7 = a4;
  v16 = 0;
  v17 = &v16;
  v18 = 0x2020000000;
  v19 = 0;
  internalQueue = self->_internalQueue;
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __74__WBSFormDataController_preferredIdentifierExistsForProperty_withContact___block_invoke;
  v12[3] = &unk_1E7FC5D28;
  v12[4] = self;
  v13 = v7;
  v14 = v6;
  v15 = &v16;
  v9 = v6;
  v10 = v7;
  dispatch_sync(internalQueue, v12);
  LOBYTE(v6) = *(v17 + 24);

  _Block_object_dispose(&v16, 8);
  return v6;
}

void __74__WBSFormDataController_preferredIdentifierExistsForProperty_withContact___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _loadCompletionDBIfNeededOnInternalQueue];
  v2 = *(a1 + 32);
  v3 = v2[9];
  v4 = [v2 uniqueIDOfContact:*(a1 + 40)];
  v6 = [v3 safari_dictionaryForKey:v4];

  v5 = [v6 allKeys];
  *(*(*(a1 + 56) + 8) + 24) = [v5 containsObject:*(a1 + 48)];
}

- (id)_recentlyUsedAutoFillDictionaries
{
  [(WBSFormDataController *)self loadCompletionDBIfNeeded];
  v3 = [(NSMutableArray *)self->_recentlyUsedAutoFillSets copy];

  return v3;
}

- (void)addRecentlyUsedAutoFillSet:(id)a3 appendToTheEnd:(BOOL)a4
{
  v4 = a4;
  v7 = a3;
  [(WBSFormDataController *)self loadCompletionDBIfNeeded];
  recentlyUsedAutoFillSets = self->_recentlyUsedAutoFillSets;
  if (v4)
  {
    [(NSMutableArray *)recentlyUsedAutoFillSets addObject:v7];
    if ([(NSMutableArray *)self->_recentlyUsedAutoFillSets count]>= 2)
    {
      [(NSMutableArray *)self->_recentlyUsedAutoFillSets removeObjectAtIndex:0];
    }
  }

  else
  {
    [(NSMutableArray *)recentlyUsedAutoFillSets insertObject:v7 atIndex:0];
    if ([(NSMutableArray *)self->_recentlyUsedAutoFillSets count]>= 2)
    {
      [(NSMutableArray *)self->_recentlyUsedAutoFillSets removeLastObject];
    }

    [(WBSFormDataController *)self saveCompletionDBSoon];
  }
}

- (id)recentlyUsedAutoFillSetsForContact:(id)a3
{
  v43 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v22 = [MEMORY[0x1E695DF70] array];
  v38 = 0u;
  v39 = 0u;
  v36 = 0u;
  v37 = 0u;
  obj = [(WBSFormDataController *)self _recentlyUsedAutoFillDictionaries];
  v23 = [obj countByEnumeratingWithState:&v36 objects:v42 count:16];
  if (v23)
  {
    v21 = *v37;
    do
    {
      for (i = 0; i != v23; ++i)
      {
        if (*v37 != v21)
        {
          objc_enumerationMutation(obj);
        }

        v5 = *(*(&v36 + 1) + 8 * i);
        v25 = [v5 objectForKeyedSubscript:@"recentlyUsedAutoFillSetArray"];
        v24 = [v5 objectForKeyedSubscript:@"recentlyUsedAutoFillSetDoNotFillArray"];
        v26 = [v5 objectForKeyedSubscript:@"recentlyUsedAutoFillSetLabel"];
        v6 = [MEMORY[0x1E695DF70] array];
        v7 = [MEMORY[0x1E695DF70] array];
        v34 = 0u;
        v35 = 0u;
        v32 = 0u;
        v33 = 0u;
        v8 = v25;
        v9 = [v8 countByEnumeratingWithState:&v32 objects:v41 count:16];
        if (v9)
        {
          v10 = *v33;
          while (2)
          {
            for (j = 0; j != v9; ++j)
            {
              if (*v33 != v10)
              {
                objc_enumerationMutation(v8);
              }

              v12 = [WBSAddressBookMatch addressBookMatchWithContactDictionaryRepresentation:*(*(&v32 + 1) + 8 * j) forContact:v4];
              if (!v12)
              {
                [v6 removeAllObjects];
                goto LABEL_16;
              }

              [v6 addObject:v12];
            }

            v9 = [v8 countByEnumeratingWithState:&v32 objects:v41 count:16];
            if (v9)
            {
              continue;
            }

            break;
          }
        }

LABEL_16:

        v30 = 0u;
        v31 = 0u;
        v28 = 0u;
        v29 = 0u;
        v13 = v24;
        v14 = [v13 countByEnumeratingWithState:&v28 objects:v40 count:16];
        if (v14)
        {
          v15 = *v29;
          while (2)
          {
            for (k = 0; k != v14; ++k)
            {
              if (*v29 != v15)
              {
                objc_enumerationMutation(v13);
              }

              v17 = [WBSAddressBookMatch addressBookMatchWithContactDictionaryRepresentation:*(*(&v28 + 1) + 8 * k) forContact:v4];
              if (!v17)
              {
                [v7 removeAllObjects];
                goto LABEL_26;
              }

              [v7 addObject:v17];
            }

            v14 = [v13 countByEnumeratingWithState:&v28 objects:v40 count:16];
            if (v14)
            {
              continue;
            }

            break;
          }
        }

LABEL_26:

        v18 = [[WBSRecentlyUsedAutoFillSet alloc] initWithFillMatches:v6 skipMatches:v7 label:v26];
        [v22 addObject:v18];
      }

      v23 = [obj countByEnumeratingWithState:&v36 objects:v42 count:16];
    }

    while (v23);
  }

  return v22;
}

+ (BOOL)formContainsCreditCardData:(id)a3
{
  v18 = *MEMORY[0x1E69E9840];
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v4 = [a3 controls];
  v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v5)
  {
    v6 = *v14;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v14 != v6)
        {
          objc_enumerationMutation(v4);
        }

        v8 = *(*(&v13 + 1) + 8 * i);
        v9 = [v8 value];
        if ([v9 length])
        {
          v10 = [v8 classification];
          if (WBSIsEqual() & 1) != 0 || (WBSIsEqual() & 1) != 0 || ([a1 stringLooksLikeCreditCardNumber:v9])
          {

            v11 = 1;
            goto LABEL_16;
          }
        }
      }

      v5 = [v4 countByEnumeratingWithState:&v13 objects:v17 count:16];
      v11 = 0;
      if (v5)
      {
        continue;
      }

      break;
    }
  }

  else
  {
    v11 = 0;
  }

LABEL_16:

  return v11;
}

+ (BOOL)formContainsCreditCardNumberField:(id)a3
{
  v16 = *MEMORY[0x1E69E9840];
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v14 = 0u;
  v3 = [a3 controls];
  v4 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v4)
  {
    v5 = *v12;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v12 != v5)
        {
          objc_enumerationMutation(v3);
        }

        v7 = [*(*(&v11 + 1) + 8 * i) classification];
        v8 = WBSIsEqual();

        if (v8)
        {
          v9 = 1;
          goto LABEL_11;
        }
      }

      v4 = [v3 countByEnumeratingWithState:&v11 objects:v15 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

  v9 = 0;
LABEL_11:

  return v9;
}

- (void)addPreviousDataMatchesForFieldWithName:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 toArray:(id)a6
{
  v20 = a3;
  v10 = a4;
  v11 = a5;
  v12 = a6;
  if ([v20 length] && objc_msgSend(v10, "length"))
  {
    [(WBSFormDataController *)self loadCompletionDBIfNeeded];
    v13 = [(WBSFormDataController *)self infoForDomain:v10];
    v14 = [v13 safari_arrayForKey:v20];
    v15 = v14;
    if (v14)
    {
      v16 = [v14 count];
      if (v16 - 2 >= 0)
      {
        v17 = v16 - 1;
        do
        {
          v18 = [v15 safari_stringAtIndex:--v17];
          if (v18 && !+[WBSFormDataController stringLooksLikeCreditCardNumber:](WBSFormDataController, "stringLooksLikeCreditCardNumber:", v18) && (([v18 safari_hasLocalizedCaseInsensitivePrefix:v11] & 1) != 0 || !objc_msgSend(v11, "length")))
          {
            v19 = [[WBSUserTypedFormString alloc] initWithUserTypedString:v18];
            [v12 insertObject:v19 atIndex:0];
          }
        }

        while (v17 > 0);
      }
    }
  }
}

- (id)addressBookMatchesForProperty:(id)a3 key:(id)a4 label:(id)a5
{
  v5 = [(WBSFormDataController *)self addressBookMatchesForProperty:a3 key:a4 label:a5 partialString:0 contact:0 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:1];

  return v5;
}

- (void)addABMatchesForValueSpecifier:(id)a3 matchingPartialString:(id)a4 toArray:(id)a5 preferredLabel:(id)a6 contact:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8
{
  v8 = a8;
  v88 = *MEMORY[0x1E69E9840];
  v13 = a3;
  v14 = a4;
  v68 = a5;
  v67 = a6;
  v58 = a7;
  v64 = v13;
  v15 = [v13 property];
  v16 = [v15 length];

  if (!v16)
  {
    goto LABEL_58;
  }

  v17 = [v64 label];
  v18 = [v17 length];

  if (v18)
  {

    v67 = 0;
  }

  v19 = [v64 property];
  v20 = [v64 component];
  v21 = [v64 label];
  v22 = [(WBSFormDataController *)self addressBookMatchesForProperty:v19 key:v20 label:v21 partialString:v14 contact:v58 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v8];

  v79 = 0u;
  v80 = 0u;
  v77 = 0u;
  v78 = 0u;
  obj = v22;
  v23 = [obj countByEnumeratingWithState:&v77 objects:v87 count:16];
  if (v23)
  {
    v24 = *v78;
    v62 = *MEMORY[0x1E69C8AB8];
    do
    {
      for (i = 0; i != v23; ++i)
      {
        if (*v78 != v24)
        {
          objc_enumerationMutation(obj);
        }

        v26 = *(*(&v77 + 1) + 8 * i);
        v27 = [v26 stringValue];
        if (![v14 length] || (objc_msgSend(v27, "safari_hasLocalizedCaseInsensitivePrefix:", v14) & 1) != 0)
        {
LABEL_22:
          if ([v67 length])
          {
            v35 = [v26 label];
            if ([v35 length])
            {
              v36 = [v26 label];
              v37 = [v36 isEqualToString:v67];

              if ((v37 & 1) == 0)
              {
                goto LABEL_30;
              }
            }

            else
            {
            }
          }

          v38 = [v26 stringValue];
          v81[0] = MEMORY[0x1E69E9820];
          v81[1] = 3221225472;
          v81[2] = ___ZL17findLiteralStringP7NSArrayP8NSString_block_invoke;
          v81[3] = &unk_1E7FC5F18;
          v82 = v38;
          v39 = v38;
          v40 = [v68 indexOfObjectPassingTest:v81];

          if (v40 == 0x7FFFFFFFFFFFFFFFLL)
          {
            [v68 addObject:v26];
          }

          else
          {
            [v68 replaceObjectAtIndex:v40 withObject:v26];
          }
        }

        else
        {
          v28 = [v64 property];
          v29 = [v28 isEqualToString:v62];

          if (v29)
          {
            v30 = [(WBSFormDataController *)self _singleFieldPhoneNumberCandidates:v27];
            v75 = 0u;
            v76 = 0u;
            v73 = 0u;
            v74 = 0u;
            v31 = v30;
            v32 = [v31 countByEnumeratingWithState:&v73 objects:v86 count:16];
            if (v32)
            {
              v33 = *v74;
              while (2)
              {
                for (j = 0; j != v32; ++j)
                {
                  if (*v74 != v33)
                  {
                    objc_enumerationMutation(v31);
                  }

                  if ([*(*(&v73 + 1) + 8 * j) safari_hasLocalizedCaseInsensitivePrefix:v14])
                  {

                    goto LABEL_22;
                  }
                }

                v32 = [v31 countByEnumeratingWithState:&v73 objects:v86 count:16];
                if (v32)
                {
                  continue;
                }

                break;
              }
            }
          }
        }

LABEL_30:
      }

      v23 = [obj countByEnumeratingWithState:&v77 objects:v87 count:16];
    }

    while (v23);
  }

  v84[0] = @"_$!<Mobile>!$_";
  v84[1] = @"iPhone";
  v85[0] = &unk_1F3A9AD30;
  v85[1] = &unk_1F3A9AD48;
  v84[2] = @"_$!<Home>!$_";
  v84[3] = @"_$!<Work>!$_";
  v85[2] = &unk_1F3A9AD60;
  v85[3] = &unk_1F3A9AD78;
  v63 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v85 forKeys:v84 count:4];
  if ([v68 count])
  {
    goto LABEL_57;
  }

  v41 = [v64 property];
  v42 = [v41 isEqualToString:*MEMORY[0x1E69C8AB8]];

  if ((v42 & 1) == 0)
  {
    goto LABEL_57;
  }

  v71 = 0u;
  v72 = 0u;
  v69 = 0u;
  v70 = 0u;
  v59 = obj;
  v43 = [v59 countByEnumeratingWithState:&v69 objects:v83 count:16];
  if (!v43)
  {

    goto LABEL_55;
  }

  v66 = 0;
  v61 = *v70;
  do
  {
    v44 = v43;
    for (k = 0; k != v44; ++k)
    {
      if (*v70 != v61)
      {
        objc_enumerationMutation(v59);
      }

      v46 = *(*(&v69 + 1) + 8 * k);
      v47 = [v14 length];
      if (v47)
      {
        v42 = [v46 stringValue];
        if (![v42 safari_hasLocalizedCaseInsensitivePrefix:v14])
        {
          v50 = v42;
LABEL_49:

          continue;
        }
      }

      v48 = [v46 label];
      v49 = [v63 objectForKeyedSubscript:v48];

      if (v47)
      {

        if (!v49)
        {
          continue;
        }
      }

      else if (!v49)
      {
        continue;
      }

      if (v66)
      {
        v51 = [v46 label];
        v52 = [v63 objectForKeyedSubscript:v51];
        v53 = [v52 integerValue];
        v54 = [v66 label];
        v55 = [v63 objectForKeyedSubscript:v54];
        LODWORD(v53) = v53 < [v55 integerValue];

        if (!v53)
        {
          continue;
        }
      }

      v56 = v46;
      v50 = v66;
      v66 = v56;
      goto LABEL_49;
    }

    v43 = [v59 countByEnumeratingWithState:&v69 objects:v83 count:16];
  }

  while (v43);

  if (v66)
  {
    [v68 addObject:?];
    v57 = v66;
    goto LABEL_56;
  }

LABEL_55:
  v57 = 0;
LABEL_56:

LABEL_57:
LABEL_58:
}

+ (id)allAddressBookAddressComponentKeys
{
  v4[5] = *MEMORY[0x1E69E9840];
  v4[0] = @"City";
  v4[1] = @"State";
  v4[2] = @"Street";
  v4[3] = @"ZIP";
  v4[4] = @"Country";
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v4 count:5];

  return v2;
}

+ (id)allAddressBookNonAddressPropertyKeys
{
  v8[8] = *MEMORY[0x1E69E9840];
  v2 = *MEMORY[0x1E69C8AC8];
  v8[0] = *MEMORY[0x1E69C8AC0];
  v8[1] = v2;
  v3 = *MEMORY[0x1E69C8AA0];
  v8[2] = *MEMORY[0x1E69C8AD8];
  v8[3] = v3;
  v4 = *MEMORY[0x1E69C8AA8];
  v8[4] = *MEMORY[0x1E69C8AB8];
  v8[5] = v4;
  v5 = *MEMORY[0x1E69C8A98];
  v8[6] = *MEMORY[0x1E69C8AB0];
  v8[7] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:8];

  return v6;
}

+ (id)specifierForAddressBookLabel:(id)a3
{
  v3 = [WBSFormToABBinder specifierForLabel:a3];

  return v3;
}

+ (id)allSynonymsForMatch:(id)a3
{
  v3 = a3;
  v4 = [v3 stringValue];
  v5 = [WBSFormToABBinder allSynonymsForMatch:v3 formAppearsToBeChinese:languageOfTextIsChinese(v4)];

  return v5;
}

+ (BOOL)formContainsDateFields:(id)a3 matchingAddressBookMatch:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = [v5 controls];
  if (v7 && ([v6 dateValue], v8 = objc_claimAutoreleasedReturnValue(), v8, v7, v8))
  {
    v9 = [v5 controls];
    v22 = 0;
    v23 = 0;
    v21 = 0;
    identifyDateFields(v9, &v23, &v22, &v21);
    v10 = v23;
    v11 = v22;
    v12 = v21;

    v13 = [v6 dateValue];
    v14 = [v10 value];
    v15 = stringContainsDateComponentValue(v14, 0, v13);

    if (v15 & 1) != 0 && ([v11 value], v16 = objc_claimAutoreleasedReturnValue(), v17 = stringContainsDateComponentValue(v16, 1, v13), v16, (v17))
    {
      v18 = [v12 value];
      v19 = stringContainsDateComponentValue(v18, 2, v13);
    }

    else
    {
      v19 = 0;
    }
  }

  else
  {
    v19 = 0;
  }

  return v19;
}

- (void)_currentLocaleDidChange:(id)a3
{
  cachedBirthdayAndLocalizedStrings = self->_cachedBirthdayAndLocalizedStrings;
  self->_cachedBirthdayAndLocalizedStrings = 0;
}

- (id)_cachedLocalizedStringsForBirthdate:(id)a3
{
  v4 = a3;
  if (v4)
  {
    cachedBirthdayAndLocalizedStrings = self->_cachedBirthdayAndLocalizedStrings;
    v16 = 0;
    v17 = 0;
    [(WBSPair *)cachedBirthdayAndLocalizedStrings getFirst:&v17 second:&v16];
    v6 = v17;
    v7 = v16;
    if ([v6 isEqualToDate:v4])
    {
      v8 = v7;
    }

    else
    {
      v9 = [MEMORY[0x1E695DF58] safari_localeIdentifiersForMostWidelyUsedLanguages];
      v10 = [MEMORY[0x1E695DF58] currentLocale];
      v11 = [v10 localeIdentifier];
      v12 = [v9 setByAddingObject:v11];

      v8 = [v4 safari_stringsFromDateForLocaleIdentifiers:v12];
      v13 = [objc_alloc(MEMORY[0x1E69C88F0]) initWithFirst:v4 second:v8];
      v14 = self->_cachedBirthdayAndLocalizedStrings;
      self->_cachedBirthdayAndLocalizedStrings = v13;
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (id)bestAddressBookLabelForFormMetadata:(id)a3 formControlValue:(id)a4
{
  v60 = *MEMORY[0x1E69E9840];
  v38 = a3;
  v6 = a4;
  if (!v6)
  {
    v34 = 0;
    goto LABEL_50;
  }

  v32 = [objc_opt_class() addressBookAddressPropertyKey];
  v54 = 0u;
  v55 = 0u;
  v52 = 0u;
  v53 = 0u;
  obj = [objc_opt_class() allAddressBookAddressComponentKeys];
  v28 = [obj countByEnumeratingWithState:&v52 objects:v59 count:16];
  if (!v28)
  {
    goto LABEL_19;
  }

  v33 = *v53;
  do
  {
    for (i = 0; i != v28; ++i)
    {
      if (*v53 != v33)
      {
        objc_enumerationMutation(obj);
      }

      v7 = *(*(&v52 + 1) + 8 * i);
      v48 = 0u;
      v49 = 0u;
      v50 = 0u;
      v51 = 0u;
      v30 = v7;
      v39 = [WBSFormDataController addressBookMatchesForProperty:"addressBookMatchesForProperty:key:label:" key:v32 label:?];
      v8 = [v39 countByEnumeratingWithState:&v48 objects:v58 count:16];
      if (!v8)
      {
        goto LABEL_17;
      }

      v9 = *v49;
      while (2)
      {
        for (j = 0; j != v8; ++j)
        {
          if (*v49 != v9)
          {
            objc_enumerationMutation(v39);
          }

          v11 = *(*(&v48 + 1) + 8 * j);
          v12 = [v11 stringValue];
          v13 = v12;
          if (v12 && ![v12 caseInsensitiveCompare:v6])
          {
            v34 = [v30 lowercaseString];
LABEL_48:

            goto LABEL_49;
          }

          v14 = [objc_opt_class() allSynonymsForMatch:v11];
          v15 = [v14 safari_setByApplyingBlock:&__block_literal_global_195];

          v16 = [v6 lowercaseString];
          v17 = [v16 stringByReplacingOccurrencesOfString:@"." withString:&stru_1F3A5E418];
          v18 = [v15 containsObject:v17];

          if (v18)
          {
            v34 = [v30 lowercaseString];
LABEL_47:

            goto LABEL_48;
          }
        }

        v8 = [v39 countByEnumeratingWithState:&v48 objects:v58 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }

LABEL_17:
    }

    v28 = [obj countByEnumeratingWithState:&v52 objects:v59 count:16];
  }

  while (v28);
LABEL_19:

  v46 = 0u;
  v47 = 0u;
  v44 = 0u;
  v45 = 0u;
  obj = [objc_opt_class() allAddressBookNonAddressPropertyKeys];
  v27 = [obj countByEnumeratingWithState:&v44 objects:v57 count:16];
  if (v27)
  {
    v29 = *v45;
    v37 = *MEMORY[0x1E69C8A98];
    v34 = &stru_1F3A5E418;
    do
    {
      for (k = 0; k != v27; ++k)
      {
        if (*v45 != v29)
        {
          objc_enumerationMutation(obj);
        }

        v19 = *(*(&v44 + 1) + 8 * k);
        v40 = 0u;
        v41 = 0u;
        v42 = 0u;
        v43 = 0u;
        v39 = [(WBSFormDataController *)self addressBookMatchesForProperty:v19 key:0 label:0];
        v20 = [v39 countByEnumeratingWithState:&v40 objects:v56 count:16];
        if (v20)
        {
          v21 = *v41;
          while (2)
          {
            for (m = 0; m != v20; ++m)
            {
              if (*v41 != v21)
              {
                objc_enumerationMutation(v39);
              }

              v23 = *(*(&v40 + 1) + 8 * m);
              v24 = [v23 stringValue];
              v13 = v24;
              if (v24 && ![v24 caseInsensitiveCompare:v6])
              {
                v34 = [v19 lowercaseString];
                goto LABEL_48;
              }

              v15 = [v23 dateValue];
              if (v15 && [v19 isEqualToString:v37])
              {
                v25 = [(WBSFormDataController *)self _cachedLocalizedStringsForBirthdate:v15];
                if ([v25 containsObject:v6] || (objc_msgSend(objc_opt_class(), "formContainsDateFields:matchingAddressBookMatch:", v38, v23) & 1) != 0)
                {
                  v34 = [v19 lowercaseString];

                  goto LABEL_47;
                }
              }
            }

            v20 = [v39 countByEnumeratingWithState:&v40 objects:v56 count:16];
            if (v20)
            {
              continue;
            }

            break;
          }
        }
      }

      v27 = [obj countByEnumeratingWithState:&v44 objects:v57 count:16];
    }

    while (v27);
  }

  else
  {
    v34 = &stru_1F3A5E418;
  }

LABEL_49:

LABEL_50:

  return v34;
}

id __78__WBSFormDataController_bestAddressBookLabelForFormMetadata_formControlValue___block_invoke(uint64_t a1, void *a2)
{
  v2 = [a2 lowercaseString];

  return v2;
}

- (BOOL)addressBookHasDataForLabel:(id)a3
{
  v4 = a3;
  if ([v4 length])
  {
    v5 = objc_opt_class();
    v6 = [v4 lowercaseString];
    v7 = [v5 specifierForAddressBookLabel:v6];

    if (v7)
    {
      v8 = [v7 property];
      v9 = [v7 component];
      v10 = [v7 label];
      v11 = [(WBSFormDataController *)self addressBookMatchesForProperty:v8 key:v9 label:v10];

      v12 = [v11 count] != 0;
    }

    else
    {
      v12 = 0;
    }
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

+ (BOOL)shouldDisplayOneTimeCodeForControl:(id)a3 inForm:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = [v5 value];
  v8 = [v7 length];

  if (!v8)
  {
    if ([v5 looksLikeOneTimeCodeField])
    {
      v9 = 1;
      goto LABEL_14;
    }

    v10 = [v5 uniqueID];
    v11 = [v6 userNameElementUniqueID];
    v12 = [v10 isEqualToString:v11];

    if (v12)
    {
      goto LABEL_6;
    }

    v13 = [v6 passwordElementUniqueID];
    if ([v10 isEqualToString:v13])
    {
      v9 = 0;
    }

    else
    {
      v14 = [v6 oldPasswordElementUniqueID];
      if ([v10 isEqualToString:v14])
      {
        goto LABEL_10;
      }

      v16 = [v6 confirmPasswordElementUniqueID];
      v17 = [v10 isEqualToString:v16];

      if (v17)
      {
LABEL_6:
        v9 = 0;
LABEL_13:

        goto LABEL_14;
      }

      v13 = [WBSFormDataController specifierForControl:v5];
      v18 = [v13 property];
      v19 = [v18 isEqualToString:*MEMORY[0x1E69C8AB8]];

      if (v19)
      {
        v9 = 1;
        goto LABEL_12;
      }

      v14 = [v13 property];
      if (![v14 isEqualToString:*MEMORY[0x1E69C8A90]])
      {
LABEL_10:
        v9 = 0;
      }

      else
      {
        v20 = [v13 component];
        v9 = [v20 isEqualToString:@"ZIP"];
      }
    }

LABEL_12:

    goto LABEL_13;
  }

  v9 = 0;
LABEL_14:

  return v9;
}

+ (BOOL)shouldDisplayHideMyEmailForControl:(id)a3
{
  v3 = a3;
  v4 = [v3 value];
  v5 = [v4 length];

  if (v5)
  {
    LOBYTE(v6) = 0;
  }

  else
  {
    v7 = [WBSFormDataController specifierForControl:v3];
    v8 = [v7 property];
    v6 = [v8 isEqualToString:*MEMORY[0x1E69C8AA0]];
  }

  return v6;
}

+ (id)specifierForControl:(id)a3
{
  v3 = a3;
  v4 = [v3 classification];
  v5 = [v3 classificationHints];
  v6 = [v3 orderedParts];
  v7 = [WBSFormToABBinder specifierForClassification:v4 hints:v5 orderedParts:v6];

  return v7;
}

+ (id)stringWithAddressBookValue:(id)a3 key:(id)a4
{
  v5 = a3;
  v6 = a4;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v5;
LABEL_5:
    v8 = v7;
    goto LABEL_7;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = [v5 objectForKey:v6];
    goto LABEL_5;
  }

  v8 = 0;
LABEL_7:

  return v8;
}

- (id)matchesForControl:(id)a3 atURL:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a7
{
  v12 = a3;
  v13 = a5;
  v14 = [WBSFormDataController domainFromURL:a4];
  LOBYTE(v17) = a7;
  v15 = [(WBSFormDataController *)self _matchesForControl:v12 inDomain:v14 matchingPartialString:v13 autoFillDataType:a6 preferredLabel:0 contact:0 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v17];

  return v15;
}

- (id)matchesForControl:(id)a3 atURL:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 contact:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8
{
  v14 = a3;
  v15 = a5;
  v16 = a7;
  v17 = [WBSFormDataController domainFromURL:a4];
  LOBYTE(v20) = a8;
  v18 = [(WBSFormDataController *)self _matchesForControl:v14 inDomain:v17 matchingPartialString:v15 autoFillDataType:a6 preferredLabel:0 contact:v16 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v20];

  return v18;
}

- (id)_matchesForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8
{
  LOBYTE(v10) = a8;
  v8 = [(WBSFormDataController *)self _matchesForControl:a3 inDomain:a4 matchingPartialString:a5 autoFillDataType:a6 preferredLabel:a7 contact:0 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v10];

  return v8;
}

- (id)_matchesForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 contact:(id)a8 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a9
{
  v11 = a6;
  v15 = a3;
  v16 = a4;
  v17 = a5;
  v18 = a7;
  v19 = a8;
  v20 = [v15 classification];
  if (WBSIsEqual() & 1) != 0 || (WBSIsEqual())
  {
    v21 = 0;
  }

  else
  {
    v21 = [MEMORY[0x1E695DF70] array];
    v37 = [v15 fieldName];
    v22 = ![(WBSFormDataController *)self shouldAutoFillFromPreviousData];
    if ((v11 & 8) == 0)
    {
      LOBYTE(v22) = 1;
    }

    if ((v22 & 1) == 0)
    {
      [(WBSFormDataController *)self addPreviousDataMatchesForFieldWithName:v37 inDomain:v16 matchingPartialString:v17 toArray:v21];
    }

    v23 = ![(WBSFormDataController *)self shouldAutoFillFromAddressBook];
    if ((v11 & 2) == 0)
    {
      LOBYTE(v23) = 1;
    }

    if ((v23 & 1) == 0)
    {
      v24 = [objc_opt_class() specifierForControl:v15];
      if (v24)
      {
        v36 = v24;
        v25 = [v24 property];
        v26 = [v25 isEqualToString:*MEMORY[0x1E69C8AA0]];

        if (v26 & 1 | (([v15 isLabeledUsernameField] & 1) == 0))
        {
          if (v26)
          {
            v27 = [v16 safari_substringFromPrefix:@"."];
            v28 = v27;
            if (!v27)
            {
              v27 = v16;
            }

            v35 = [v27 safari_bestURLForUserTypedString];

            v34 = [objc_alloc(MEMORY[0x1E69C8A58]) initWithString:v17 matchingType:0];
            v32 = objc_alloc(MEMORY[0x1E69C8A30]);
            v29 = [(WBSFormDataController *)self autoFillQuirksManager];
            v30 = [v29 associatedDomainsManager];
            v33 = [v32 initWithURL:v35 options:35 userNameQuery:v34 associatedDomainsManager:v30 webFrameIdentifier:0];

            v38[0] = MEMORY[0x1E69E9820];
            v38[1] = 3221225472;
            v38[2] = __179__WBSFormDataController__matchesForControl_inDomain_matchingPartialString_autoFillDataType_preferredLabel_contact_allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier___block_invoke;
            v38[3] = &unk_1E7FC5D70;
            v39 = v21;
            [(WBSFormDataController *)self getSavedAccountMatchesWithCriteria:v33 synchronously:1 completionHandler:v38];
          }

          [(WBSFormDataController *)self addABMatchesForValueSpecifier:v36 matchingPartialString:v17 toArray:v21 preferredLabel:v18 contact:v19 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:a9];
          v24 = v36;
        }

        else
        {

          v24 = v21;
          v21 = 0;
        }
      }
    }
  }

  return v21;
}

void __179__WBSFormDataController__matchesForControl_inDomain_matchingPartialString_autoFillDataType_preferredLabel_contact_allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier___block_invoke(uint64_t a1, void *a2)
{
  v20 = *MEMORY[0x1E69E9840];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v3 = [a2 matchesForPasswordAutoFill];
  v4 = [v3 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v4)
  {
    v5 = *v16;
    v6 = *MEMORY[0x1E69C8AA0];
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v16 != v5)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v15 + 1) + 8 * i);
        v9 = [v8 user];
        if ([v9 safari_looksLikeEmailAddress])
        {
          v10 = [v8 savedAccount];
          v11 = [v10 credentialTypes];

          if ((v11 - 2) < 2 || v11 == 1)
          {
            v12 = _WBSLocalizedString();
          }

          else
          {
            v12 = 0;
          }

          v13 = *(a1 + 32);
          v14 = [[WBSAddressBookMatch alloc] initWithValue:v9 property:v6 key:0 identifier:0 label:v12];
          [v13 addObject:v14];
        }
      }

      v4 = [v3 countByEnumeratingWithState:&v15 objects:v19 count:16];
    }

    while (v4);
  }
}

- (id)cascadingAddressMatchesForMatch:(id)a3 contact:(id)a4
{
  v21[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [v6 key];
  v9 = [v8 isEqualToString:@"City"];

  if (v9 & 1) != 0 || ([v6 key], v10 = objc_claimAutoreleasedReturnValue(), v11 = objc_msgSend(v10, "isEqualToString:", @"Street"), v10, (v11))
  {
    v12 = [MEMORY[0x1E695DF70] arrayWithObject:v6];
    v13 = [v6 label];
    [(WBSFormDataController *)self addAllAddressDataIfNecessary:v12 contactLabel:v13 contact:v7];

    v14 = [v6 identifier];
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __65__WBSFormDataController_cascadingAddressMatchesForMatch_contact___block_invoke;
    v18[3] = &unk_1E7FC5D98;
    v19 = v14;
    v20 = v9;
    v15 = v14;
    v16 = [v12 safari_filterObjectsUsingBlock:v18];
  }

  else
  {
    v21[0] = v6;
    v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v21 count:1];
  }

  return v16;
}

uint64_t __65__WBSFormDataController_cascadingAddressMatchesForMatch_contact___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 identifier];
  v5 = [v4 isEqualToString:*(a1 + 32)];

  if (v5)
  {
    if (*(a1 + 40) == 1)
    {
      v6 = [v3 key];
      if ([v6 isEqualToString:@"City"] & 1) != 0 || (objc_msgSend(v6, "isEqualToString:", @"State") & 1) != 0 || (objc_msgSend(v6, "isEqualToString:", @"ZIP"))
      {
        v7 = 1;
      }

      else
      {
        v7 = [v6 isEqualToString:@"Country"];
      }
    }

    else
    {
      v7 = 1;
    }
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)bestMatchForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a8
{
  LOBYTE(v10) = a8;
  v8 = [(WBSFormDataController *)self bestMatchForControl:a3 inDomain:a4 matchingPartialString:a5 autoFillDataType:a6 preferredLabel:a7 contact:0 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v10];

  return v8;
}

- (id)bestMatchForControl:(id)a3 inDomain:(id)a4 matchingPartialString:(id)a5 autoFillDataType:(unint64_t)a6 preferredLabel:(id)a7 contact:(id)a8 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a9
{
  LOBYTE(v12) = a9;
  v9 = [(WBSFormDataController *)self _matchesForControl:a3 inDomain:a4 matchingPartialString:a5 autoFillDataType:a6 preferredLabel:a7 contact:a8 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v12];
  if ([v9 count])
  {
    v10 = [v9 objectAtIndex:0];
  }

  else
  {
    v10 = 0;
  }

  return v10;
}

+ (id)continuingFieldsInFormControls:(id)a3 startingAtIndex:(unint64_t)a4
{
  v5 = a3;
  v6 = [MEMORY[0x1E695DF70] arrayWithCapacity:1];
  v7 = [v5 objectAtIndexedSubscript:a4];
  [v6 addObject:v7];
  if ([v7 continuationID])
  {
    while (++a4 < [v5 count])
    {
      v8 = [v5 objectAtIndexedSubscript:a4];
      v9 = [v8 continuationID];
      if (v9 != [v7 continuationID])
      {

        break;
      }

      [v6 addObject:v8];
    }
  }

  return v6;
}

+ (BOOL)canAutocompleteTextField:(id)a3 inForm:(id)a4
{
  v5 = a3;
  v6 = a4;
  if ([v5 isSecureTextField])
  {
    LOBYTE(v7) = 0;
  }

  else
  {
    v8 = [v6 type];
    LOBYTE(v7) = 0;
    if (v8 <= 5 && ((1 << v8) & 0x3A) != 0)
    {
      v7 = [v5 disallowsAutocomplete] ^ 1;
    }
  }

  return v7;
}

+ (int64_t)availableManualAutoFillActionForTextField:(id)a3 form:(id)a4 outUsernameElementUniqueID:(id *)a5 outPasswordElementUniqueID:(id *)a6 outConfirmPasswordElementUniqueID:(id *)a7
{
  v11 = a3;
  v12 = a4;
  v30 = v11;
  v13 = [v11 isSecureTextField];
  if (v13)
  {
    [v11 uniqueID];
  }

  else
  {
    [v12 passwordElementUniqueID];
  }
  v14 = ;
  v15 = [v12 userNameElementUniqueID];
  v16 = v14;
  v17 = [v12 passwordElementUniqueID];
  v18 = [v16 isEqualToString:v17];

  if (v18)
  {
    v19 = [v12 confirmPasswordElementUniqueID];
    if (!v13)
    {
      goto LABEL_6;
    }
  }

  else
  {
    v19 = 0;
    if (!v13)
    {
LABEL_6:
      v20 = 0;
      if (!a6)
      {
        goto LABEL_8;
      }

      goto LABEL_7;
    }
  }

  v25 = [v29 valueOfControlWithUniqueID:v16 inForm:v12];
  if ([v25 length])
  {
    if ([v16 length])
    {
      v26 = [v29 metadataForControlWithUniqueID:v16 inForm:v12];
      v27 = [v26 isAutoFilledTextField];

      v20 = ~v27 & 1;
    }

    else
    {
      v20 = 1;
    }
  }

  else
  {
    v20 = 2;
  }

  if (a6)
  {
LABEL_7:
    v21 = v16;
    *a6 = v16;
  }

LABEL_8:
  if (a5)
  {
    v22 = v15;
    *a5 = v15;
  }

  if (a7)
  {
    v23 = v19;
    *a7 = v19;
  }

  return v20;
}

- (void)addAllAddressDataIfNecessary:(id)a3 contactLabel:(id)a4 contact:(id)a5
{
  v51[5] = *MEMORY[0x1E69E9840];
  v7 = a3;
  v34 = a4;
  v35 = a5;
  v44 = 0u;
  v45 = 0u;
  v46 = 0u;
  v47 = 0u;
  v8 = v7;
  v9 = [v8 countByEnumeratingWithState:&v44 objects:v50 count:16];
  v10 = v8;
  if (v9)
  {
    v11 = *v45;
    obj = @"th";
    v12 = *MEMORY[0x1E69C8A90];
    v13 = 1;
    while (2)
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v45 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v15 = *(*(&v44 + 1) + 8 * i);
        v16 = [v15 stringValue];
        v17 = [v16 safari_bestLanguageTag];

        LODWORD(v16) = [v17 isEqualToString:obj];
        v18 = [v15 property];
        v19 = [v18 isEqualToString:v12];

        v13 &= v16 ^ 1;
        if (v19)
        {

          v42 = 0u;
          v43 = 0u;
          v40 = 0u;
          v41 = 0u;
          if (v13)
          {
            v20 = @"City";
          }

          else
          {
            v20 = @"State";
          }

          v51[0] = @"Street";
          v51[1] = v20;
          if (v13)
          {
            v21 = @"State";
          }

          else
          {
            v21 = @"City";
          }

          v51[2] = v21;
          v51[3] = @"ZIP";
          v51[4] = @"Country";
          v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v51 count:5];
          v22 = [v10 countByEnumeratingWithState:&v40 objects:v49 count:16];
          if (v22)
          {
            obja = v10;
            v23 = 0;
            v24 = *v41;
            do
            {
              for (j = 0; j != v22; ++j)
              {
                if (*v41 != v24)
                {
                  objc_enumerationMutation(obja);
                }

                v26 = [(WBSFormDataController *)self addressBookMatchesForProperty:v12 key:*(*(&v40 + 1) + 8 * j) label:v34 partialString:0 contact:v35 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:1, obja];

                v38 = 0u;
                v39 = 0u;
                v36 = 0u;
                v37 = 0u;
                v23 = v26;
                v27 = [v23 countByEnumeratingWithState:&v36 objects:v48 count:16];
                if (v27)
                {
                  v28 = *v37;
                  do
                  {
                    for (k = 0; k != v27; ++k)
                    {
                      if (*v37 != v28)
                      {
                        objc_enumerationMutation(v23);
                      }

                      v30 = *(*(&v36 + 1) + 8 * k);
                      if (([v8 containsObject:v30] & 1) == 0)
                      {
                        [v8 addObject:v30];
                      }
                    }

                    v27 = [v23 countByEnumeratingWithState:&v36 objects:v48 count:16];
                  }

                  while (v27);
                }
              }

              v22 = [obja countByEnumeratingWithState:&v40 objects:v49 count:16];
            }

            while (v22);

            v10 = obja;
          }

          goto LABEL_33;
        }
      }

      v9 = [v8 countByEnumeratingWithState:&v44 objects:v50 count:16];
      if (v9)
      {
        continue;
      }

      break;
    }

    v10 = v8;
  }

LABEL_33:
}

- (id)_singleFieldPhoneNumberCandidates:(id)a3
{
  v3 = a3;
  v4 = objc_opt_new();
  v5 = phoneNumberWithoutFormatting(v3);
  v6 = unprefixedPhoneNumber(v5);
  if (v6)
  {
    [v4 addObject:v6];
  }

  if ([(NSString *)v5 hasPrefix:@"+"])
  {
    v7 = [(NSString *)v5 substringFromIndex:1];
    [v4 addObject:v7];
  }

  else
  {
    [v4 addObject:v5];
  }

  return v4;
}

- (id)_phoneNumberCandidates:(id)a3 fillingMultipleFields:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  {
    v7 = [WBSFormDataController _phoneNumberCandidates:fillingMultipleFields:]::extensionMarkers;
  }

  else
  {
    v7 = [MEMORY[0x1E696AB08] characterSetWithCharactersInString:{@"xp-, "}];
    [WBSFormDataController _phoneNumberCandidates:fillingMultipleFields:]::extensionMarkers = v7;
  }

  v8 = [v6 rangeOfCharacterFromSet:v7 options:4];
  if (v8 == 0x7FFFFFFFFFFFFFFFLL)
  {
    v9 = 0;
    if (v4)
    {
LABEL_5:
      v10 = [MEMORY[0x1E695DF70] arrayWithCapacity:2];
      v11 = phoneNumberWithoutFormatting(v6);
      v12 = unprefixedPhoneNumber(v11);
      [v10 addObject:v12];

      if (!v9)
      {
        goto LABEL_11;
      }

      v13 = phoneNumberWithoutFormatting(v9);
      v14 = unprefixedPhoneNumber(v13);
      [v10 addObject:v14];

      goto LABEL_10;
    }
  }

  else
  {
    v9 = [v6 substringToIndex:v8];
    if (v4)
    {
      goto LABEL_5;
    }
  }

  v10 = [(WBSFormDataController *)self _singleFieldPhoneNumberCandidates:v6];
  if (!v9)
  {
    goto LABEL_11;
  }

  v13 = [(WBSFormDataController *)self _singleFieldPhoneNumberCandidates:v9];
  [v10 addObjectsFromArray:v13];
LABEL_10:

LABEL_11:

  return v10;
}

- (void)_fillPhoneNumber:(id)a3 intoValues:(id)a4 controls:(id)a5 formTextSample:(id)a6 multiRoundAutoFillManager:(id)a7
{
  v72[1] = *MEMORY[0x1E69E9840];
  v66 = a3;
  v12 = a4;
  v13 = a5;
  v64 = a6;
  v65 = a7;
  IsChinese = languageOfTextIsChinese(v64);
  if (IsChinese)
  {
    v15 = phoneNumberWithoutFormatting(v66);
    v72[0] = v15;
    v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v72 count:1];
  }

  else
  {
    v16 = -[WBSFormDataController _phoneNumberCandidates:fillingMultipleFields:](self, "_phoneNumberCandidates:fillingMultipleFields:", v66, [v13 count] > 1);
  }

  v69 = 0u;
  v70 = 0u;
  v67 = 0u;
  v68 = 0u;
  v17 = v16;
  v18 = [v17 countByEnumeratingWithState:&v67 objects:v71 count:16];
  if (!v18)
  {
    goto LABEL_33;
  }

  v19 = *v68;
  while (2)
  {
    for (i = 0; i != v18; ++i)
    {
      if (*v68 != v19)
      {
        objc_enumerationMutation(v17);
      }

      v21 = *(*(&v67 + 1) + 8 * i);
      if ([v13 count] == 1)
      {
        v22 = [v13 objectAtIndex:0];
        v23 = fillSingleFieldValue(v12, v21, v22);

        if (v23)
        {
          goto LABEL_33;
        }
      }

      if ([v13 count] >= 2 && valueFitsInFields(v21, v13))
      {
        if (IsChinese)
        {
          v24 = v12;
          v25 = v21;
          v61 = v13;
          v26 = v25;
          if ([(NSString *)v26 hasPrefix:@"1"]&& ![(NSString *)v26 hasPrefix:@"10"])
          {
          }

          else
          {

            v27 = [v61 objectAtIndexedSubscript:1];
            v28 = [v27 maxLength];

            if (v28 < 8)
            {
              v29 = 7;
            }

            else
            {
              v29 = 8;
            }

            v30 = [(NSString *)v26 length]- v29;
            if (v30 > 1)
            {
              v31 = [(NSString *)v26 substringWithRange:0, v30];
              v32 = [v61 objectAtIndexedSubscript:0];
              recordValueForTextField(v24, v31, v32);

              v33 = [(NSString *)v26 substringWithRange:v30, v29];
              v34 = [v61 objectAtIndexedSubscript:1];
              recordValueForTextField(v24, v33, v34);
              goto LABEL_24;
            }
          }
        }

        v35 = v12;
        v36 = v21;
        v37 = v13;
        v38 = v36;
        v39 = v37;
        if (([v39 count] == 3 || objc_msgSend(v39, "count") == 4) && -[NSString length](v38, "length") >= 0xA && (objc_msgSend(v39, "objectAtIndexedSubscript:", 0), v40 = objc_claimAutoreleasedReturnValue(), v62 = objc_msgSend(v40, "maxLength"), v40, objc_msgSend(v39, "objectAtIndexedSubscript:", 1), v41 = objc_claimAutoreleasedReturnValue(), v60 = objc_msgSend(v41, "maxLength"), v41, objc_msgSend(v39, "objectAtIndexedSubscript:", 2), v42 = objc_claimAutoreleasedReturnValue(), v43 = objc_msgSend(v42, "maxLength"), v42, v62 >= 3) && v60 >= 3 && v43 >= 4 && (-[NSString length](v38, "length") < 0xB || objc_msgSend(v39, "count") == 4 && (objc_msgSend(v39, "objectAtIndexedSubscript:", 3), v44 = objc_claimAutoreleasedReturnValue(), v45 = objc_msgSend(v44, "maxLength"), v44, v45 >= 1) && v45 >= -[NSString length](v38, "length") - 10))
        {
          if (v62 == 3 && v60 == 3 && v43 == 4)
          {

LABEL_55:
            v54 = [(NSString *)v38 substringWithRange:0, 3];
            v55 = [v39 objectAtIndex:0];
            recordValueForTextField(v35, v54, v55);

            v56 = [(NSString *)v38 substringWithRange:3, 3];
            v57 = [v39 objectAtIndex:1];
            recordValueForTextField(v35, v56, v57);

            v58 = [(NSString *)v38 substringWithRange:6, 4];
            v59 = [v39 objectAtIndex:2];
            recordValueForTextField(v35, v58, v59);

            if ([v39 count] != 4 || -[NSString length](v38, "length") < 0xB)
            {
              goto LABEL_25;
            }

            v33 = [(NSString *)v38 substringFromIndex:10];
            v34 = [v39 objectAtIndex:3];
            recordValueForTextField(v35, v33, v34);
LABEL_24:

LABEL_25:
            goto LABEL_33;
          }

          v46 = [v39 objectAtIndexedSubscript:0];
          v63 = [v46 size];

          v47 = [v39 objectAtIndexedSubscript:1];
          v48 = [v47 size];

          v49 = [v39 objectAtIndexedSubscript:2];
          v50 = [v49 size];

          v53 = v63 == 3 && v48 == 3 && v50 == 4;
          if (v53)
          {
            goto LABEL_55;
          }
        }

        else
        {
        }

        fillMultiFieldValue(v35, v38, v39, v65);
        goto LABEL_33;
      }
    }

    v18 = [v17 countByEnumeratingWithState:&v67 objects:v71 count:16];
    if (v18)
    {
      continue;
    }

    break;
  }

LABEL_33:
}

- (unint64_t)addValuesForStandardFormControlsInForm:(id)a3 startingAtIndex:(unint64_t)a4 fromAutoFillItem:(id)a5 toDictionary:(id)a6 multiRoundAutoFillManager:(id)a7
{
  v12 = a3;
  v13 = a5;
  v14 = a6;
  v15 = a7;
  v16 = [v12 controls];
  v17 = [v12 textSample];
  v18 = [(WBSFormDataController *)self addValuesForStandardFormControls:v16 startingAtIndex:a4 fromAutoFillItem:v13 toDictionary:v14 formTextSample:v17 multiRoundAutoFillManager:v15];

  return v18;
}

- (unint64_t)addValuesForStandardFormControls:(id)a3 startingAtIndex:(unint64_t)a4 fromAutoFillItem:(id)a5 toDictionary:(id)a6 formTextSample:(id)a7 multiRoundAutoFillManager:(id)a8
{
  v86 = *MEMORY[0x1E69E9840];
  v14 = a3;
  v15 = a5;
  v70 = a6;
  v68 = a7;
  v67 = a8;
  v72 = v15;
  v69 = v14;
  if (v15)
  {
    v71 = [v14 objectAtIndexedSubscript:a4];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v17 = v15;
    }

    else
    {
      v17 = 0;
    }

    v65 = v17;
    v66 = [(WBSFormControlMetadata *)v71 selectElementInfo];
    if (isKindOfClass)
    {
      v18 = [v15 property];
      v19 = [v18 isEqualToString:*MEMORY[0x1E69C8A98]];

      if (v19)
      {
        v20 = [v15 dateValue];
        v21 = fillDateUsingClassification(v70, v14, a4, v20);

LABEL_80:
        goto LABEL_81;
      }
    }

    v64 = [(WBSFormControlMetadata *)v71 tagName];
    v22 = [(WBSFormControlMetadata *)v71 isTextField];
    if (([v64 safari_isCaseInsensitiveEqualToString:@"input"] & v22) != 1)
    {
      if ((isKindOfClass & (v66 != 0)) == 1)
      {
        IsChinese = languageOfTextIsChinese(v68);
        v29 = v66;
        v30 = v65;
        v31 = [WBSFormToABBinder allSynonymsForMatch:v30 formAppearsToBeChinese:IsChinese];
        if (!v31)
        {
          v32 = MEMORY[0x1E695DEC8];
          v33 = [v30 stringValue];
          v31 = [v32 arrayWithObject:v33];
        }

        v34 = indexOfItemInSelectElement(v29, v31);

        if (v34 != 0x7FFFFFFFFFFFFFFFLL)
        {
          recordIndexForSelectElement(v70, v34, v71);
        }
      }

      else if ((isKindOfClass & 1) != 0 && [v64 safari_isCaseInsensitiveEqualToString:@"textarea"])
      {
        v35 = [v15 completion];
        recordValueForTextarea(v70, v35, v71);
      }

      v21 = 1;
      goto LABEL_79;
    }

    if (isKindOfClass)
    {
      v23 = [v15 property];
      v24 = [v23 isEqualToString:*MEMORY[0x1E69C8AB8]];

      if (v24)
      {
        v25 = 0;
        v26 = 0;
        v27 = 1;
        goto LABEL_29;
      }

      v36 = [v15 property];
      if (([v36 isEqualToString:*MEMORY[0x1E69C8A90]] & 1) == 0)
      {

        v25 = 0;
LABEL_28:
        v38 = [v72 property];
        v26 = [v38 isEqualToString:*MEMORY[0x1E69C8AA8]];

        v27 = 0;
LABEL_29:
        v63 = [v65 stringValue];
        if ((v27 | v25 | v26))
        {
          v39 = [WBSFormDataController continuingFieldsInFormControls:v14 startingAtIndex:a4];
          if (v63)
          {
            if (v27)
            {
              [(WBSFormDataController *)self _fillPhoneNumber:v63 intoValues:v70 controls:v39 formTextSample:v68 multiRoundAutoFillManager:v67];
            }

            else if (v25)
            {
              fillPostCode(v70, v63, v39, v67);
            }

            else
            {
              fillInstantMessageUsername(v70, v63, v39);
            }
          }

          v21 = [v39 count];

          goto LABEL_78;
        }

        if (isKindOfClass)
        {
          v40 = [v72 property];
          if ([v40 isEqualToString:*MEMORY[0x1E69C8A90]])
          {
            v41 = [v72 key];
            v42 = [v41 isEqualToString:@"Street"];

            if (v42)
            {
              v75 = v70;
              v76 = v63;
              v77 = v67;
              [WBSFormDataController continuingFieldsInFormControls:v14 startingAtIndex:a4];
              v81 = 0u;
              v82 = 0u;
              v79 = 0u;
              obj = v80 = 0u;
              v43 = [obj countByEnumeratingWithState:&v79 objects:v85 count:16];
              if (!v43)
              {
                goto LABEL_71;
              }

              v74 = *v80;
              while (1)
              {
                v78 = v43;
                for (i = 0; i != v78; ++i)
                {
                  if (*v80 != v74)
                  {
                    objc_enumerationMutation(obj);
                  }

                  v45 = *(*(&v79 + 1) + 8 * i);
                  v46 = [v45 orderedParts];
                  v47 = [v46 count];
                  if (v47 == 2)
                  {
                    v49 = 3;
                  }

                  else if (v47 == 1)
                  {
                    v48 = [v46 firstObject];
                    if (WBSIsEqual())
                    {
                      v49 = 0;
                    }

                    else if (WBSIsEqual())
                    {
                      v49 = 1;
                    }

                    else if (WBSIsEqual())
                    {
                      v49 = 2;
                    }

                    else
                    {
                      v49 = 4;
                    }
                  }

                  else
                  {
                    v49 = 4;
                  }

                  v50 = v75;
                  v51 = v76;
                  v52 = v45;
                  v53 = v77;
                  v54 = [(WBSFormControlMetadata *)v52 uniqueID];
                  v55 = v51;
                  v56 = [MEMORY[0x1E695DF70] array];
                  v83[0] = MEMORY[0x1E69E9820];
                  v83[1] = 3221225472;
                  v83[2] = ___ZL22decomposeStreetAddressP8NSString20StreetDecomposeStyle_block_invoke;
                  v83[3] = &unk_1E7FC5F40;
                  v57 = v56;
                  v84 = v57;
                  [v55 enumerateLinesUsingBlock:v83];
                  if (![v57 count])
                  {
                    goto LABEL_65;
                  }

                  if (v49 <= 1)
                  {
                    v58 = v49 != 0;
                    goto LABEL_62;
                  }

                  if (v49 == 2)
                  {
                    v58 = 2;
LABEL_62:
                    if (v58 < [v57 count])
                    {
                      v59 = [v57 objectAtIndex:v58];
                      goto LABEL_64;
                    }

                    goto LABEL_65;
                  }

                  if (v49 != 3)
                  {
                    goto LABEL_60;
                  }

                  if ([v57 count] != 1)
                  {
                    [v57 removeObjectAtIndex:0];
LABEL_60:
                    v59 = [v57 componentsJoinedByString:{@", "}];
LABEL_64:
                    v60 = v59;
                    goto LABEL_66;
                  }

LABEL_65:
                  v60 = &stru_1F3A5E418;
LABEL_66:

                  if ([(__CFString *)v60 length])
                  {
                    recordValueForTextField(v50, &v60->isa, v52);
                  }

                  else
                  {
                    [v53 addControlUniqueIDIgnoredByFollowUpAutoFill:v54];
                  }
                }

                v43 = [obj countByEnumeratingWithState:&v79 objects:v85 count:16];
                if (!v43)
                {
LABEL_71:

                  v21 = [obj count];
                  goto LABEL_78;
                }
              }
            }
          }

          else
          {
          }
        }

        v61 = [v72 completion];
        recordValueForTextField(v70, v61, v71);

        v21 = 1;
LABEL_78:

LABEL_79:
        goto LABEL_80;
      }

      v37 = [v15 key];
      v25 = [v37 isEqualToString:@"ZIP"];

      if ((v25 & 1) == 0)
      {
        goto LABEL_28;
      }
    }

    else
    {
      v25 = 0;
    }

    v27 = 0;
    v26 = 0;
    goto LABEL_29;
  }

  v21 = 0;
LABEL_81:

  return v21;
}

+ (BOOL)textFieldLooksLikeCreditCardFormField:(id)a3
{
  v4 = a3;
  v5 = [v4 classification];
  v6 = WBSIsEqual();

  if (v6 & 1) != 0 || ([v4 classification], v7 = objc_claimAutoreleasedReturnValue(), v8 = WBSIsEqual(), v7, (v8))
  {
    v9 = 1;
  }

  else
  {
    v9 = [a1 textFieldLooksLikeCreditCardNumericFormField:v4];
  }

  return v9;
}

+ (BOOL)textFieldLooksLikeCreditCardNumericFormField:(id)a3
{
  v3 = [a3 classification];
  if (WBSIsEqual())
  {
    v4 = 1;
  }

  else
  {
    v4 = WBSIsEqual();
  }

  return v4;
}

+ (void)getFormFieldValues:(id *)a3 andFieldToFocus:(id *)a4 andCreditCardDataTypesThatWillBeFilled:(id *)a5 forCreditCardForm:(id)a6 fromCreditCardData:(id)a7
{
  v108 = *MEMORY[0x1E69E9840];
  v79 = a6;
  v90 = a7;
  v92 = [MEMORY[0x1E695DF90] dictionary];
  v91 = [MEMORY[0x1E695DF90] dictionary];
  v86 = [v79 controls];
  v8 = [v86 count];
  if (!v8)
  {
    v72 = v92;
    v11 = 0;
    v10 = 0;
    v71 = a4;
    *a3 = v72;
    if (!a4)
    {
      goto LABEL_80;
    }

    goto LABEL_78;
  }

  v85 = v8;
  v83 = 0;
  v9 = 0;
  v80 = 0;
  v81 = 0;
  v10 = 0;
  v11 = 0;
  v12 = 0;
  v82 = 0x7FFFFFFFFFFFFFFFLL;
  do
  {
    v89 = v12;
    v88 = [v86 objectAtIndexedSubscript:?];
    v13 = uniqueIDForAutoFillOfControl(v88, 7);
    v14 = v13 == 0;

    if (!v14)
    {
      v87 = [(WBSFormControlMetadata *)v88 classification];
      if ((v9 & 1) != 0 || ![v87 isEqualToString:@"cc-name"])
      {
        if ((v83 & 0x100000000) != 0 || ![v87 isEqualToString:@"cc-number"])
        {
          if ((v83 & 1) != 0 || ![v87 isEqualToString:@"cc-exp"])
          {
            if ((v81 & 1) != 0 || ![v87 isEqualToString:@"cc-csc"])
            {
              if ((v80 & 1) != 0 || ![v87 isEqualToString:@"cc-type"])
              {
                if (v82 == 0x7FFFFFFFFFFFFFFFLL && ((v9 | HIDWORD(v83)) & 1) != 0)
                {
                  if (!-[WBSFormControlMetadata isTextField](v88, "isTextField") || (-[WBSFormControlMetadata value](v88, "value"), v51 = objc_claimAutoreleasedReturnValue(), v52 = [v51 length] == 0, v51, v52))
                  {
                    v53 = v89;
                  }

                  else
                  {
                    v53 = 0x7FFFFFFFFFFFFFFFLL;
                  }

                  v82 = v53;
                }
              }

              else
              {
                v48 = [v90 cardNumber];
                v49 = fillCreditCardType(v92, v88, v48);

                if (v49)
                {
                  v50 = [(WBSFormControlMetadata *)v88 uniqueID];
                  recordTypeForFieldIfFilled(v92, v91, v50, 4);

                  v80 = 1;
                }

                else
                {
                  v80 = 0;
                }
              }
            }

            else
            {
              v44 = [v90 cardSecurityCode];
              v45 = [v44 length] == 0;

              if (!v45)
              {
                v46 = [v90 cardSecurityCode];
                recordValueForTextField(v92, v46, v88);

                v47 = [(WBSFormControlMetadata *)v88 uniqueID];
                recordTypeForFieldIfFilled(v92, v91, v47, 1);
              }

              v81 = 1;
            }
          }

          else
          {
            v34 = allControlsContinuationStartingAtIndex(v86, v89);
            v35 = [v90 expirationDate];
            v36 = v35 == 0;

            if (!v36)
            {
              v37 = [v90 expirationDate];
              fillDateUsingClassification(v92, v34, 0, v37);

              v95 = 0u;
              v96 = 0u;
              v93 = 0u;
              v94 = 0u;
              v38 = v34;
              v39 = [v38 countByEnumeratingWithState:&v93 objects:v105 count:16];
              if (v39)
              {
                v40 = *v94;
                do
                {
                  for (i = 0; i != v39; ++i)
                  {
                    if (*v94 != v40)
                    {
                      objc_enumerationMutation(v38);
                    }

                    v42 = [*(*(&v93 + 1) + 8 * i) uniqueID];
                    recordTypeForFieldIfFilled(v92, v91, v42, 2);
                  }

                  v39 = [v38 countByEnumeratingWithState:&v93 objects:v105 count:16];
                }

                while (v39);
              }
            }

            v43 = [v34 count];

            v89 = v89 + v43 - 1;
            LOBYTE(v83) = 1;
          }
        }

        else
        {
          v24 = allControlsContinuationStartingAtIndex(v86, v89);
          v25 = [v90 cardNumber];
          v26 = valueFitsInFields(v25, v24);

          if (v26)
          {
            v27 = [v90 cardNumber];
            fillMultiFieldValue(v92, v27, v24, 0);

            v99 = 0u;
            v100 = 0u;
            v97 = 0u;
            v98 = 0u;
            v28 = v24;
            v29 = [v28 countByEnumeratingWithState:&v97 objects:v106 count:16];
            if (v29)
            {
              v30 = *v98;
              do
              {
                for (j = 0; j != v29; ++j)
                {
                  if (*v98 != v30)
                  {
                    objc_enumerationMutation(v28);
                  }

                  v32 = [*(*(&v97 + 1) + 8 * j) uniqueID];
                  recordTypeForFieldIfFilled(v92, v91, v32, 0);
                }

                v29 = [v28 countByEnumeratingWithState:&v97 objects:v106 count:16];
              }

              while (v29);
            }
          }

          v33 = [v24 count];

          v89 = v89 + v33 - 1;
          HIDWORD(v83) = 1;
        }
      }

      else
      {
        v84 = allControlsContinuationStartingAtIndex(v86, v89);
        v15 = [v90 cardholderName];
        v16 = [v15 length] == 0;

        if (v16)
        {
          v68 = v82;
          if (v82 == 0x7FFFFFFFFFFFFFFFLL)
          {
            v68 = v89;
          }

          v82 = v68;
        }

        else if ([v84 count] == 1 && (objc_msgSend(v84, "firstObject"), v17 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v17, "orderedParts"), v18 = objc_claimAutoreleasedReturnValue(), v19 = objc_msgSend(v18, "count") == 3, v18, v17, v19))
        {
          v20 = [v90 cardholderName];
          v21 = [v84 firstObject];
          recordValueForTextField(v92, v20, v21);

          v22 = [v84 firstObject];
          v23 = [v22 uniqueID];
          recordTypeForFieldIfFilled(v92, v91, v23, 3);
        }

        else
        {
          v103 = 0u;
          v104 = 0u;
          v101 = 0u;
          v102 = 0u;
          v54 = v84;
          v55 = [v54 countByEnumeratingWithState:&v101 objects:v107 count:16];
          if (v55)
          {
            v56 = *v102;
            do
            {
              for (k = 0; k != v55; ++k)
              {
                if (*v102 != v56)
                {
                  objc_enumerationMutation(v54);
                }

                v58 = *(*(&v101 + 1) + 8 * k);
                if (!v10 || !v11)
                {
                  v59 = objc_alloc_init(MEMORY[0x1E696ADF8]);

                  [v59 setStyle:3];
                  v60 = [v90 cardholderName];
                  v61 = [v59 personNameComponentsFromString:v60];

                  v11 = v61;
                  v10 = v59;
                }

                v62 = objc_alloc_init(MEMORY[0x1E696ADF0]);
                v63 = [(WBSFormControlMetadata *)v58 orderedParts];
                if ([v63 containsObject:@"given-name"])
                {
                  v64 = [v11 givenName];
                  [v62 setGivenName:v64];
                }

                if ([v63 containsObject:@"additional-name"])
                {
                  v65 = [v11 middleName];
                  [v62 setMiddleName:v65];
                }

                if ([v63 containsObject:@"family-name"])
                {
                  v66 = [v11 familyName];
                  [v62 setFamilyName:v66];
                }

                v67 = [v10 stringFromPersonNameComponents:v62];
                recordValueForTextField(v92, v67, v58);
              }

              v55 = [v54 countByEnumeratingWithState:&v101 objects:v107 count:16];
            }

            while (v55);
          }
        }

        v69 = [v84 count];

        v89 = v89 + v69 - 1;
        v9 = 1;
      }
    }

    v12 = v89 + 1;
  }

  while (v89 + 1 < v85);
  v70 = v92;
  *a3 = v92;
  if (a4)
  {
    if (v82 == 0x7FFFFFFFFFFFFFFFLL)
    {
      v71 = a4;
LABEL_78:
      *v71 = 0;
      goto LABEL_80;
    }

    v73 = [v86 objectAtIndexedSubscript:?];
    v74 = [v73 uniqueID];
    *a4 = v74;
  }

LABEL_80:
  if (a5)
  {
    v75 = v91;
    *a5 = v91;
  }
}

- (unint64_t)_indexForControlWithUniqueID:(id)a3 inForm:(id)a4
{
  v5 = a3;
  v6 = [a4 controls];
  v7 = [v6 count];
  if (v7)
  {
    v8 = 0;
    while (1)
    {
      v9 = [v6 objectAtIndexedSubscript:v8];
      v10 = [v9 uniqueID];
      v11 = [v10 isEqualToString:v5];

      if (v11)
      {
        break;
      }

      if (v7 == ++v8)
      {
        goto LABEL_5;
      }
    }
  }

  else
  {
LABEL_5:
    v8 = 0x7FFFFFFFFFFFFFFFLL;
  }

  return v8;
}

- (id)_nextFieldToFocusAfterFillingFieldAtIndex:(unint64_t)a3 inForm:(id)a4
{
  v5 = [a4 controls];
  v6 = [v5 count];
  v7 = a3 + 1;
  if (a3 + 1 >= v6)
  {
LABEL_4:
    v11 = 0;
  }

  else
  {
    while (1)
    {
      v8 = [v5 objectAtIndexedSubscript:v7];
      v9 = [v8 value];
      v10 = [v9 length];

      if (!v10)
      {
        break;
      }

      if (v6 == ++v7)
      {
        goto LABEL_4;
      }
    }

    v11 = [v8 uniqueID];
  }

  return v11;
}

- (void)getFormFieldValues:(id *)a3 andFieldToFocus:(id *)a4 withSingleCreditCardData:(id)a5 inField:(id)a6 inForm:(id)a7
{
  v49 = *MEMORY[0x1E69E9840];
  v12 = a5;
  v13 = a6;
  v14 = a7;
  v45 = [v14 controls];
  v15 = [(WBSFormControlMetadata *)v13 uniqueID];
  v16 = [(WBSFormDataController *)self _indexForControlWithUniqueID:v15 inForm:v14];

  if (v16 == 0x7FFFFFFFFFFFFFFFLL)
  {
    if (a3)
    {
      *a3 = MEMORY[0x1E695E0F8];
    }

    if (a4)
    {
      *a4 = 0;
    }

    goto LABEL_32;
  }

  v17 = [MEMORY[0x1E695DF90] dictionary];
  v44 = [v12 value];
  v18 = [v12 type];
  if (v18 > 1)
  {
    if (v18 != 2)
    {
      if (v18 != 3)
      {
        if (v18 == 4)
        {
          fillCreditCardType(v17, v13, v44);
        }

        goto LABEL_29;
      }

      goto LABEL_13;
    }

    v38 = v44;
    v39 = WBSLocaleForCreditCardExpirationDate();
    v41 = v17;
    v19 = v45;
    v42 = v38;
    v40 = v19;
    v43 = [WBSFormDataController continuingFieldsInFormControls:v19 startingAtIndex:v16];
    if ([v43 count] >= 4)
    {
      v20 = WBS_LOG_CHANNEL_PREFIXAutoFill();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
      {
        -[WBSFormDataController getFormFieldValues:andFieldToFocus:withSingleCreditCardData:inField:inForm:].cold.3(buf, [v43 count], v20);
      }

      goto LABEL_27;
    }

    if (!v42)
    {
LABEL_27:
      v28 = [v43 count];
LABEL_28:

      v16 = v16 + v28 - 1;
      goto LABEL_29;
    }

    if ([v43 count] == 1)
    {
      v36 = [v43 objectAtIndexedSubscript:0];
      if ([(WBSFormControlMetadata *)v36 isTextField])
      {
        v23 = [(WBSFormControlMetadata *)v36 requiredFormatForDateTimeInput];
        v24 = [v23 length];

        if (v24)
        {
          v25 = objc_alloc_init(MEMORY[0x1E696AB78]);
          v26 = [(WBSFormControlMetadata *)v36 requiredFormatForDateTimeInput];
          [v25 setDateFormat:v26];

          v27 = [v25 stringFromDate:v42];
          recordValueForTextField(v41, v27, v36);
        }

        else
        {
          v33 = WBS_LOG_CHANNEL_PREFIXAutoFill();
          if (os_log_type_enabled(v33, OS_LOG_TYPE_ERROR))
          {
            [WBSFormDataController getFormFieldValues:andFieldToFocus:withSingleCreditCardData:inField:inForm:];
          }
        }
      }

      else
      {
        v32 = WBS_LOG_CHANNEL_PREFIXAutoFill();
        if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
        {
          [WBSFormDataController getFormFieldValues:andFieldToFocus:withSingleCreditCardData:inField:inForm:];
        }
      }

      v28 = 1;
      goto LABEL_28;
    }

    v47 = 0;
    *buf = 0;
    v46 = 0;
    v30 = identifyDateFields(v43, buf, &v47, &v46);
    v37 = *buf;
    v35 = v47;
    v34 = v46;
    if (v30)
    {
      if (v37 && !v35)
      {
        v31 = [v43 count];
LABEL_46:
        v28 = v31;

        goto LABEL_28;
      }

      if (v37)
      {
        recordValueForDateField(v41, 0, v42, v37);
      }

      if (v35)
      {
        recordValueForDateField(v41, 1, v42, v35);
      }

      if (v34)
      {
        recordValueForDateField(v41, 2, v42, v34);
      }
    }

    v31 = [v43 count];
    goto LABEL_46;
  }

  if (!v18)
  {
    v21 = v44;
    v22 = [objc_opt_class() continuingFieldsInFormControls:v45 startingAtIndex:v16];
    if (valueFitsInFields(v21, v22))
    {
      fillMultiFieldValue(v17, v21, v22, 0);
    }

    v16 = v16 + [v22 count] - 1;

    goto LABEL_29;
  }

  if (v18 == 1)
  {
LABEL_13:
    recordValueForTextField(v17, v44, v13);
  }

LABEL_29:
  v29 = v17;
  *a3 = v17;
  if (a4)
  {
    *a4 = [(WBSFormDataController *)self _nextFieldToFocusAfterFillingFieldAtIndex:v16 inForm:v14];
  }

LABEL_32:
}

- (BOOL)isControlASelectElement:(id)a3
{
  v3 = [a3 tagName];
  v4 = [v3 safari_isCaseInsensitiveEqualToString:@"select"];

  return v4;
}

- (NSLocale)locale
{
  locale = self->_locale;
  if (!locale)
  {
    v4 = [MEMORY[0x1E695DF58] currentLocale];
    v5 = self->_locale;
    self->_locale = v4;

    locale = self->_locale;
  }

  return locale;
}

+ (id)domainFromURL:(id)a3
{
  v3 = [a3 host];
  v4 = [v3 _web_domainFromHost];
  v5 = [v4 lowercaseString];

  return v5;
}

+ (id)nextFieldAfterControls:(id)a3 inForm:(id)a4
{
  v27 = *MEMORY[0x1E69E9840];
  v19 = a3;
  v5 = [a4 controls];
  v6 = [MEMORY[0x1E695DFD8] setWithArray:v19];
  v22 = 0u;
  v23 = 0u;
  v20 = 0u;
  v21 = 0u;
  v7 = [v5 reverseObjectEnumerator];
  v8 = [v7 countByEnumeratingWithState:&v20 objects:v26 count:16];
  if (v8)
  {
    v9 = *v21;
LABEL_3:
    v10 = 0;
    while (1)
    {
      if (*v21 != v9)
      {
        objc_enumerationMutation(v7);
      }

      v11 = *(*(&v20 + 1) + 8 * v10);
      v12 = [v11 nextControlUniqueID];
      if (([v6 containsObject:v12] & 1) == 0)
      {
        v13 = [v11 uniqueID];
        v14 = [v6 containsObject:v13];

        if (v14)
        {
          v15 = v12;
          v24[0] = MEMORY[0x1E69E9820];
          v24[1] = 3221225472;
          v24[2] = ___ZL43controlsContainTextFieldWithControlUniqueIDP7NSArrayIP22WBSFormControlMetadataEP8NSString_block_invoke;
          v24[3] = &unk_1E7FC5F68;
          v25 = v15;
          v16 = v15;
          v17 = [v5 indexOfObjectPassingTest:v24] == 0x7FFFFFFFFFFFFFFFLL;

          if (!v17)
          {
            break;
          }
        }
      }

      if (v8 == ++v10)
      {
        v8 = [v7 countByEnumeratingWithState:&v20 objects:v26 count:16];
        if (v8)
        {
          goto LABEL_3;
        }

        goto LABEL_11;
      }
    }
  }

  else
  {
LABEL_11:
    v16 = 0;
  }

  return v16;
}

+ (id)lastFieldInControls:(id)a3 inForm:(id)a4
{
  v21 = *MEMORY[0x1E69E9840];
  v5 = a4;
  v6 = [MEMORY[0x1E695DFD8] setWithArray:a3];
  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  v7 = [v5 controls];
  v8 = [v7 reverseObjectEnumerator];

  v9 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v9)
  {
    v10 = *v17;
    while (2)
    {
      for (i = 0; i != v9; i = i + 1)
      {
        if (*v17 != v10)
        {
          objc_enumerationMutation(v8);
        }

        v12 = *(*(&v16 + 1) + 8 * i);
        v13 = [v12 uniqueID];
        v14 = [v6 containsObject:v13];

        if (v14)
        {
          v9 = [v12 uniqueID];
          goto LABEL_11;
        }
      }

      v9 = [v8 countByEnumeratingWithState:&v16 objects:v20 count:16];
      if (v9)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v9;
}

+ (id)controlsConsideredByAutoFillInForm:(id)a3
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [MEMORY[0x1E695DF70] array];
  v13 = 0u;
  v14 = 0u;
  v11 = 0u;
  v12 = 0u;
  v5 = [v3 controls];
  v6 = [v5 countByEnumeratingWithState:&v11 objects:v15 count:16];
  if (v6)
  {
    v7 = *v12;
    do
    {
      for (i = 0; i != v6; ++i)
      {
        if (*v12 != v7)
        {
          objc_enumerationMutation(v5);
        }

        v9 = uniqueIDForAutoFillOfControl(*(*(&v11 + 1) + 8 * i), 3);
        if (v9)
        {
          [v4 addObject:v9];
        }
      }

      v6 = [v5 countByEnumeratingWithState:&v11 objects:v15 count:16];
    }

    while (v6);
  }

  return v4;
}

+ (BOOL)isNameProperty:(id)a3
{
  v3 = a3;
  {
    v4 = +[WBSFormDataController isNameProperty:]::namePropertiesSet;
  }

  else
  {
    v4 = [MEMORY[0x1E695DFD8] setWithObjects:{*MEMORY[0x1E69C8AC0], *MEMORY[0x1E69C8AD0], *MEMORY[0x1E69C8AC8], *MEMORY[0x1E69C8AD8], 0}];
    +[WBSFormDataController isNameProperty:]::namePropertiesSet = v4;
  }

  v5 = [v4 containsObject:v3];

  return v5;
}

- (id)_autoFillSetFromMatches:(id)a3 label:(id)a4 contact:(id)a5 form:(id)a6
{
  v35 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v28 = a4;
  v26 = a5;
  v27 = a6;
  v29 = v10;
  if (![v10 count])
  {
    v24 = 0;
    goto LABEL_18;
  }

  v11 = [MEMORY[0x1E695DFA8] set];
  v12 = [MEMORY[0x1E695DFA8] set];
  v32 = 0u;
  v33 = 0u;
  v30 = 0u;
  v31 = 0u;
  v13 = v10;
  v14 = [v13 countByEnumeratingWithState:&v30 objects:v34 count:16];
  if (v14)
  {
    v15 = 0;
    v16 = *v31;
    do
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v31 != v16)
        {
          objc_enumerationMutation(v13);
        }

        v18 = [*(*(&v30 + 1) + 8 * i) property];
        [v12 addObject:v18];
        if (![WBSFormDataController isNameProperty:v18])
        {
          v19 = [objc_opt_class() localizedLowercaseContactProperty:v18];
          [v11 addObject:v19];

          v15 = 1;
        }
      }

      v14 = [v13 countByEnumeratingWithState:&v30 objects:v34 count:16];
    }

    while (v14);

    if ((v15 & 1) == 0)
    {
      v24 = 0;
      goto LABEL_17;
    }

    v20 = [WBSRecentlyUsedAutoFillSet alloc];
    v21 = [(WBSRecentlyUsedAutoFillSet *)v20 initWithFillMatches:v13 skipMatches:MEMORY[0x1E695E0F0] label:v28];
    v13 = [(WBSFormDataController *)self valuesForContactFormWithMetadata:v27 matches:0 multiRoundAutoFillManager:0 existingMatches:v21 contact:v26];

    v22 = [WBSContactAutoFillSet alloc];
    v23 = [v11 allObjects];
    v24 = [(WBSContactAutoFillSet *)v22 initWithControlIDToValueMap:v13 label:v28 fillDisplayProperties:v23 skipDisplayProperties:0 propertiesToFillOrSkip:v12];
  }

  else
  {
    v24 = 0;
  }

LABEL_17:
LABEL_18:

  return v24;
}

- (id)orderedHomeAndWorkSetsForContact:(id)a3 form:(id)a4
{
  v40 = *MEMORY[0x1E69E9840];
  v29 = a3;
  v30 = a4;
  v38 = 0;
  v6 = [(WBSFormDataController *)self valuesForContactFormWithMetadata:v30 matches:&v38 multiRoundAutoFillManager:0 existingMatches:0 contact:v29];
  v27 = self;
  v28 = v38;
  v33 = [MEMORY[0x1E695DF70] array];
  v7 = [MEMORY[0x1E695DF70] array];
  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  obj = v28;
  v8 = [obj countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v8)
  {
    v9 = *v35;
    v10 = *MEMORY[0x1E69C8A98];
    v31 = *MEMORY[0x1E69C8AB0];
    do
    {
      v11 = 0;
      do
      {
        if (*v35 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v12 = *(*(&v34 + 1) + 8 * v11);
        v13 = [v12 property];
        if ([WBSFormDataController isNameProperty:v13])
        {

LABEL_9:
          [v33 addObject:v12];
LABEL_10:
          [v7 addObject:v12];
          goto LABEL_11;
        }

        v14 = [v12 property];
        v15 = [v14 isEqualToString:v10];

        if (v15)
        {
          goto LABEL_9;
        }

        v16 = [v12 label];
        v17 = [v16 isEqualToString:@"_$!<Home>!$_"];

        if (v17)
        {
          [v33 addObject:v12];
        }

        v18 = [v12 label];
        if ([v18 isEqualToString:@"_$!<Work>!$_"])
        {

          goto LABEL_10;
        }

        v19 = [v12 property];
        v20 = [v19 isEqualToString:v31];

        if (v20)
        {
          goto LABEL_10;
        }

LABEL_11:
        ++v11;
      }

      while (v8 != v11);
      v21 = [obj countByEnumeratingWithState:&v34 objects:v39 count:16];
      v8 = v21;
    }

    while (v21);
  }

  v22 = [(WBSFormDataController *)v27 _autoFillSetFromMatches:v33 label:@"_$!<Home>!$_" contact:v29 form:v30];
  v23 = [(WBSFormDataController *)v27 _autoFillSetFromMatches:v7 label:@"_$!<Work>!$_" contact:v29 form:v30];
  v24 = [MEMORY[0x1E695DF70] array];
  v25 = v24;
  if (v22)
  {
    [v24 addObject:v22];
  }

  if (v23)
  {
    [v25 addObject:v23];
  }

  return v25;
}

- (id)contactAutoFillSetForRecentlyUsedAutoFillSet:(id)a3 contact:(id)a4 form:(id)a5
{
  v36 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v22 = a4;
  v23 = a5;
  v24 = [v8 fillMatches];
  v9 = [v8 skipMatches];
  [v8 label];
  v26 = v34 = 0;
  v27 = [(WBSFormDataController *)self valuesForContactFormWithMetadata:v23 matches:&v34 multiRoundAutoFillManager:0 existingMatches:v8 contact:v22];
  v10 = v34;
  v28 = [WBSContactAutoFillSet displayStringsForFillMatches:v24 skipMatches:v9 matchesForForm:v10 label:v26 formDataController:self];
  v29 = [WBSContactAutoFillSet displayStringsForSkipMatches:v9 matchesForForm:v10 formDataController:self];
  v25 = [v9 valueForKeyPath:@"@distinctUnionOfObjects.property"];
  v11 = [MEMORY[0x1E695DFA8] setWithArray:?];
  v32 = 0u;
  v33 = 0u;
  v30 = 0u;
  v31 = 0u;
  v12 = v10;
  v13 = [v12 countByEnumeratingWithState:&v30 objects:v35 count:16];
  if (v13)
  {
    v14 = *v31;
    do
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v31 != v14)
        {
          objc_enumerationMutation(v12);
        }

        v16 = [*(*(&v30 + 1) + 8 * i) property];
        [v11 addObject:v16];
      }

      v13 = [v12 countByEnumeratingWithState:&v30 objects:v35 count:16];
    }

    while (v13);
  }

  v17 = [WBSContactAutoFillSet alloc];
  v18 = [v28 allObjects];
  v19 = [v29 allObjects];
  v20 = [(WBSContactAutoFillSet *)v17 initWithControlIDToValueMap:v27 label:v26 fillDisplayProperties:v18 skipDisplayProperties:v19 propertiesToFillOrSkip:v11];

  return v20;
}

- (id)valuesForStandardForm:(id)a3 inDomain:(id)a4 autoFillDataType:(unint64_t)a5 matches:(id *)a6 preferredLabel:(id)a7 multiRoundAutoFillManager:(id)a8 contact:(id)a9 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a10
{
  BYTE1(v13) = a10;
  LOBYTE(v13) = 0;
  LOBYTE(v12) = 0;
  v10 = [(WBSFormDataController *)self _valuesForStandardForm:a3 inDomain:a4 autoFillDataType:a5 matches:a6 preferredLabel:a7 multiRoundAutoFillManager:a8 wantAllMatches:v12 contact:a9 existingMatches:0 shouldUseExistingMatchesToFillFocusedField:v13 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:?];

  return v10;
}

- (id)valuesForStandardForm:(id)a3 inDomain:(id)a4 autoFillDataType:(unint64_t)a5 matches:(id *)a6 preferredLabel:(id)a7 multiRoundAutoFillManager:(id)a8
{
  LOWORD(v11) = 256;
  LOBYTE(v10) = 0;
  v8 = [(WBSFormDataController *)self _valuesForStandardForm:a3 inDomain:a4 autoFillDataType:a5 matches:a6 preferredLabel:a7 multiRoundAutoFillManager:a8 wantAllMatches:v10 contact:0 existingMatches:0 shouldUseExistingMatchesToFillFocusedField:v11 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:?];

  return v8;
}

- (id)_valuesForStandardForm:(id)a3 inDomain:(id)a4 autoFillDataType:(unint64_t)a5 matches:(id *)a6 preferredLabel:(id)a7 multiRoundAutoFillManager:(id)a8 wantAllMatches:(BOOL)a9 contact:(id)a10 existingMatches:(id)a11 shouldUseExistingMatchesToFillFocusedField:(BOOL)a12 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:(BOOL)a13
{
  v88[1] = *MEMORY[0x1E69E9840];
  v82 = a3;
  v66 = a4;
  v67 = a7;
  v18 = a8;
  v69 = a10;
  v70 = a11;
  v19 = [MEMORY[0x1E695DF90] dictionary];
  v20 = [MEMORY[0x1E695DF70] array];
  v21 = v20;
  if (a6)
  {
    v22 = v20;
    *a6 = v21;
  }

  v71 = [v82 type];
  v65 = [v82 userNameElementUniqueID];
  v64 = [v82 passwordElementUniqueID];
  v61 = [v82 confirmPasswordElementUniqueID];
  v63 = [MEMORY[0x1E695DF90] dictionary];
  v77 = [v82 controls];
  v76 = [v77 count];
  v23 = [v70 fillMatches];
  v24 = [v23 count];
  v25 = MEMORY[0x1E69C8AB8];
  if (v24 == 1)
  {
    v26 = [v70 fillMatches];
    v27 = [v26 objectAtIndexedSubscript:0];
    v28 = [v27 property];
    v75 = [v28 isEqualToString:*v25];
  }

  else
  {
    v75 = 0;
  }

  if (v76)
  {
    v60 = 0;
    v29 = 0;
    v72 = *v25;
    v62 = *MEMORY[0x1E69C8AA0];
    while (1)
    {
      v30 = [v77 objectAtIndexedSubscript:v29];
      v81 = v30;
      v80 = [objc_opt_class() specifierForControl:v30];
      if (v75)
      {
        v31 = [v80 property];
        v32 = [v31 isEqualToString:v72];

        v33 = (v32 & 1) != 0 ? 7 : 3;
      }

      else
      {
        v33 = 3;
      }

      v79 = uniqueIDForAutoFillOfControl(v30, v33);
      if (v79)
      {
        if ([v18 currentAutoFillAttemptTrigger] != 1 || (objc_msgSend(v18, "shouldControlBeIgnoredByFollowUpAutoFill:", v79) & 1) == 0)
        {
          break;
        }
      }

      v34 = 1;
LABEL_59:

      v29 += v34;
      if (v29 >= v76)
      {
        goto LABEL_60;
      }
    }

    v78 = [(WBSFormControlMetadata *)v30 uniqueID];
    if (v71 == 4)
    {
      if (([v78 isEqualToString:v65] & 1) != 0 || -[WBSFormControlMetadata isLabeledUsernameField](v30, "isLabeledUsernameField")) && (objc_msgSend(v80, "property"), v35 = objc_claimAutoreleasedReturnValue(), v36 = objc_msgSend(v35, "isEqualToString:", v62), v35, (v36 & 1) == 0) || (objc_msgSend(v78, "isEqualToString:", v64) & 1) != 0 || (objc_msgSend(v78, "isEqualToString:", v61))
      {
        v34 = 1;
LABEL_58:

        goto LABEL_59;
      }
    }

    v74 = [(WBSFormControlMetadata *)v30 tagName];
    if (([v74 safari_isCaseInsensitiveEqualToString:@"input"] & 1) != 0 || (v37 = objc_msgSend(v74, "safari_isCaseInsensitiveEqualToString:", @"textarea"), v38 = &stru_1F3A5E418, v37))
    {
      v38 = [(WBSFormControlMetadata *)v30 value];
    }

    v73 = v38;
    if (a9)
    {
      LOBYTE(v57) = a13;
      v39 = [WBSFormDataController _matchesForControl:"_matchesForControl:inDomain:matchingPartialString:autoFillDataType:preferredLabel:contact:allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:" inDomain:v30 matchingPartialString:v66 autoFillDataType:v57 preferredLabel:? contact:? allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:?];
      LOBYTE(v58) = a13;
      v40 = [(WBSFormDataController *)self _matchesForControl:v30 inDomain:v66 matchingPartialString:&stru_1F3A5E418 autoFillDataType:a5 preferredLabel:v67 contact:v69 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v58];
      v41 = v40;
      if (v39)
      {
        v42 = [MEMORY[0x1E695DFA0] orderedSetWithArray:v39];
        [v42 addObjectsFromArray:v41];
        v43 = [v42 array];
      }

      else
      {
        v41 = v40;
        v43 = v41;
      }

LABEL_44:

      if (v70)
      {
        LOBYTE(v59) = a12;
        v34 = [(WBSFormDataController *)self _addMatchesForControl:v81 startingAtIndex:v29 formMetadata:v82 fromExistingMatches:v70 fromAllMatchesIfNecessary:v43 addToFoundMatches:v21 addToAutoFillValues:v19 multiRoundAutoFillManager:v18 propertyToIdentifierMapForFoundMatches:v63 shouldUseExistingMatchesToFillFocusedField:v59];
LABEL_57:

        goto LABEL_58;
      }

      v85 = 0u;
      v86 = 0u;
      v83 = 0u;
      v84 = 0u;
      v39 = v43;
      v51 = [v39 countByEnumeratingWithState:&v83 objects:v87 count:16];
      if (v51)
      {
        v52 = *v84;
        do
        {
          for (i = 0; i != v51; ++i)
          {
            if (*v84 != v52)
            {
              objc_enumerationMutation(v39);
            }

            v54 = *(*(&v83 + 1) + 8 * i);
            [v21 addObject:v54];
            v55 = [(WBSFormDataController *)self addValuesForStandardFormControlsInForm:v82 startingAtIndex:v29 fromAutoFillItem:v54 toDictionary:v19 multiRoundAutoFillManager:v18];
          }

          v34 = v55;
          v51 = [v39 countByEnumeratingWithState:&v83 objects:v87 count:16];
        }

        while (v51);
      }

      else
      {
        v34 = 1;
      }

      v43 = v39;
LABEL_56:

      goto LABEL_57;
    }

    v44 = [v18 addressSetLabelUsedDuringFirstAutoFillPass];
    v45 = v44;
    v46 = v67;
    if (v44)
    {
      v46 = v44;
    }

    v39 = v46;

    LOBYTE(v57) = a13;
    v41 = [(WBSFormDataController *)self bestMatchForControl:v30 inDomain:v66 matchingPartialString:v73 autoFillDataType:a5 preferredLabel:v39 contact:v69 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:v57];
    v47 = [objc_opt_class() specifierForControl:v81];
    v48 = v47;
    if (!a13)
    {
      v49 = [v47 property];
      v50 = [v49 isEqualToString:v72];

      if (v60 & 1 | ((v50 & 1) == 0))
      {
        if (v50 & v60)
        {
          v60 = 1;
          goto LABEL_41;
        }
      }

      else
      {
        v60 = 1;
      }
    }

    if ([(WBSFormDataController *)self _matchHasPreferredIdentifierOrShouldBeFilledInMultiRoundAutoFill:v41 specifier:v48 multiRoundAutoFillManager:v18 contact:v69])
    {
      if (v41)
      {
        v88[0] = v41;
        v43 = [MEMORY[0x1E695DEC8] arrayWithObjects:v88 count:1];
      }

      else
      {
        v43 = 0;
      }

      goto LABEL_44;
    }

LABEL_41:

    v43 = 0;
    v34 = 1;
    goto LABEL_56;
  }

LABEL_60:

  return v19;
}

- (BOOL)_matchHasPreferredIdentifierOrShouldBeFilledInMultiRoundAutoFill:(id)a3 specifier:(id)a4 multiRoundAutoFillManager:(id)a5 contact:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = v10;
    v15 = [v12 addressBookPropertiesThatCanBeFilled];
    if (v15)
    {
      v16 = [v12 addressBookPropertiesThatCanBeFilled];
      v17 = [v14 property];
      v18 = [v16 containsObject:v17];

      if ((v18 & 1) == 0)
      {
        v25 = 0;
        goto LABEL_14;
      }
    }

    v19 = [v12 addressSetLabelUsedDuringFirstAutoFillPass];
    if (v19 && ([v14 property], v20 = objc_claimAutoreleasedReturnValue(), v21 = objc_msgSend(v20, "isEqualToString:", *MEMORY[0x1E69C8A90]), v20, v19, v21))
    {
      v22 = [v14 label];
      v23 = [v12 addressSetLabelUsedDuringFirstAutoFillPass];
      v24 = [v22 isEqualToString:v23];
    }

    else
    {
      if (!v11 || ([v11 property], v26 = objc_claimAutoreleasedReturnValue(), v27 = -[WBSFormDataController preferredIdentifierExistsForProperty:withContact:](self, "preferredIdentifierExistsForProperty:withContact:", v26, v13), v26, !v27))
      {
        v25 = 1;
        goto LABEL_14;
      }

      v28 = [v11 property];
      v22 = [(WBSFormDataController *)self preferredIdentifierForProperty:v28 withContact:v13];

      v23 = [v14 identifier];
      v24 = [v23 isEqualToString:v22];
    }

    v25 = v24;

LABEL_14:
    goto LABEL_15;
  }

  v25 = 1;
LABEL_15:

  return v25;
}

- (unint64_t)_addMatchesForControl:(id)a3 startingAtIndex:(unint64_t)a4 formMetadata:(id)a5 fromExistingMatches:(id)a6 fromAllMatchesIfNecessary:(id)a7 addToFoundMatches:(id)a8 addToAutoFillValues:(id)a9 multiRoundAutoFillManager:(id)a10 propertyToIdentifierMapForFoundMatches:(id)a11 shouldUseExistingMatchesToFillFocusedField:(BOOL)a12
{
  v123 = *MEMORY[0x1E69E9840];
  v66 = a3;
  v18 = a5;
  v73 = a6;
  v70 = a7;
  v67 = a8;
  v71 = a9;
  v68 = a10;
  v69 = a11;
  v65 = v18;
  if (a12)
  {
    v19 = v18;
    if ([v19 containsActiveElement])
    {
      v112 = 0u;
      v113 = 0u;
      v110 = 0u;
      v111 = 0u;
      v74 = v19;
      v20 = [v19 controls];
      v21 = [v20 countByEnumeratingWithState:&v110 objects:&v117 count:16];
      if (v21)
      {
        v22 = *v111;
        while (2)
        {
          for (i = 0; i != v21; i = i + 1)
          {
            if (*v111 != v22)
            {
              objc_enumerationMutation(v20);
            }

            v24 = *(*(&v110 + 1) + 8 * i);
            if ([v24 isActive])
            {
              v21 = [v24 copy];
              goto LABEL_15;
            }
          }

          v21 = [v20 countByEnumeratingWithState:&v110 objects:&v117 count:16];
          if (v21)
          {
            continue;
          }

          break;
        }
      }

LABEL_15:

      v19 = v74;
    }

    else
    {
      v21 = 0;
    }

    v25 = [v21 uniqueID];
  }

  else
  {
    v25 = 0;
  }

  *&v110 = 0;
  *(&v110 + 1) = &v110;
  *&v111 = 0x2020000000;
  *(&v111 + 1) = 1;
  v117 = 0;
  v118 = &v117;
  v119 = 0x3032000000;
  v120 = __Block_byref_object_copy__13;
  v121 = __Block_byref_object_dispose__13;
  v122 = 0;
  v99[0] = MEMORY[0x1E69E9820];
  v99[1] = 3221225472;
  v99[2] = __268__WBSFormDataController__addMatchesForControl_startingAtIndex_formMetadata_fromExistingMatches_fromAllMatchesIfNecessary_addToFoundMatches_addToAutoFillValues_multiRoundAutoFillManager_propertyToIdentifierMapForFoundMatches_shouldUseExistingMatchesToFillFocusedField___block_invoke;
  v99[3] = &unk_1E7FC5DC0;
  v106 = &v117;
  v107 = &v110;
  v99[4] = self;
  v63 = v65;
  v100 = v63;
  v108 = a4;
  v64 = v68;
  v101 = v64;
  v109 = a12;
  v76 = v66;
  v102 = v76;
  v75 = v25;
  v103 = v75;
  v77 = v67;
  v104 = v77;
  v72 = v69;
  v105 = v72;
  v78 = MEMORY[0x1BFB13CE0](v99);
  v26 = [objc_opt_class() specifierForControl:v76];
  if (!v26 || (v86 = v26, [v26 property], v27 = objc_claimAutoreleasedReturnValue(), v28 = v27 == 0, v27, v26 = v86, v28))
  {
    v50 = *(*(&v110 + 1) + 24);
  }

  else
  {
    v62 = [v73 fillMatches];
    v61 = [v73 skipMatches];
    v80 = [v73 label];
    v29 = [MEMORY[0x1E695DFA8] set];
    v97 = 0u;
    v98 = 0u;
    v95 = 0u;
    v96 = 0u;
    v30 = v61;
    v31 = [v30 countByEnumeratingWithState:&v95 objects:v116 count:16];
    if (v31)
    {
      v32 = *v96;
      do
      {
        for (j = 0; j != v31; ++j)
        {
          if (*v96 != v32)
          {
            objc_enumerationMutation(v30);
          }

          v34 = [*(*(&v95 + 1) + 8 * j) property];
          [v29 addObject:v34];
        }

        v31 = [v30 countByEnumeratingWithState:&v95 objects:v116 count:16];
      }

      while (v31);
    }

    v35 = [v86 property];
    v83 = [v72 objectForKeyedSubscript:v35];

    v93 = 0u;
    v94 = 0u;
    v91 = 0u;
    v92 = 0u;
    obj = v62;
    v36 = [obj countByEnumeratingWithState:&v91 objects:v115 count:16];
    if (v36)
    {
      v81 = 0;
      v82 = *v92;
LABEL_28:
      v84 = v36;
      v37 = 0;
      while (1)
      {
        if (*v92 != v82)
        {
          objc_enumerationMutation(obj);
        }

        v38 = *(*(&v91 + 1) + 8 * v37);
        v39 = [v86 property];
        v40 = [v38 property];
        v41 = [v39 isEqualToString:v40];

        if ((v41 & 1) == 0)
        {
          goto LABEL_41;
        }

        v42 = [v38 identifier];
        v43 = v42;
        if (!v83 || ([v42 isEqualToString:v83] & 1) != 0)
        {
          v44 = v43;

          v81 = v44;
          v45 = [v86 component];
          if (!v45)
          {
            goto LABEL_39;
          }

          v46 = [v38 key];
          if (!v46)
          {

LABEL_39:
            if ((v78)[2](v78, v38))
            {
              [v71 addEntriesFromDictionary:v118[5]];
              v50 = *(*(&v110 + 1) + 24);

              goto LABEL_67;
            }

            goto LABEL_40;
          }

          v47 = [v86 component];
          v48 = [v38 key];
          v49 = [v47 isEqualToString:v48];

          if (v49)
          {
            goto LABEL_39;
          }
        }

LABEL_40:

LABEL_41:
        if (v84 == ++v37)
        {
          v36 = [obj countByEnumeratingWithState:&v91 objects:v115 count:16];
          if (v36)
          {
            goto LABEL_28;
          }

          goto LABEL_47;
        }
      }
    }

    v81 = 0;
LABEL_47:

    v89 = 0u;
    v90 = 0u;
    v87 = 0u;
    v88 = 0u;
    v85 = v70;
    v51 = [v85 countByEnumeratingWithState:&v87 objects:v114 count:16];
    if (v51)
    {
      v52 = *v88;
      while (2)
      {
        for (k = 0; k != v51; ++k)
        {
          if (*v88 != v52)
          {
            objc_enumerationMutation(v85);
          }

          v54 = *(*(&v87 + 1) + 8 * k);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v55 = v54;
            if (![v80 length])
            {
              v56 = [v55 property];
              v57 = [v29 containsObject:v56];

              if (v57)
              {
                [v77 addObject:v55];
              }

              else
              {
                v58 = [v55 identifier];
                v59 = v58;
                if (!v81 || ([v58 isEqualToString:v81]) && (!v83 || objc_msgSend(v59, "isEqualToString:", v83)) && (v78)[2](v78, v55))
                {
                  [v71 addEntriesFromDictionary:v118[5]];
                  v50 = *(*(&v110 + 1) + 24);

                  goto LABEL_67;
                }
              }
            }
          }
        }

        v51 = [v85 countByEnumeratingWithState:&v87 objects:v114 count:16];
        if (v51)
        {
          continue;
        }

        break;
      }
    }

    v50 = *(*(&v110 + 1) + 24);
LABEL_67:

    v26 = v86;
  }

  _Block_object_dispose(&v117, 8);
  _Block_object_dispose(&v110, 8);

  return v50;
}

uint64_t __268__WBSFormDataController__addMatchesForControl_startingAtIndex_formMetadata_fromExistingMatches_fromAllMatchesIfNecessary_addToFoundMatches_addToAutoFillValues_multiRoundAutoFillManager_propertyToIdentifierMapForFoundMatches_shouldUseExistingMatchesToFillFocusedField___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [MEMORY[0x1E695DF90] dictionary];
  v5 = *(*(a1 + 88) + 8);
  v6 = *(v5 + 40);
  *(v5 + 40) = v4;

  *(*(*(a1 + 96) + 8) + 24) = [*(a1 + 32) addValuesForStandardFormControlsInForm:*(a1 + 40) startingAtIndex:*(a1 + 104) fromAutoFillItem:v3 toDictionary:*(*(*(a1 + 88) + 8) + 40) multiRoundAutoFillManager:*(a1 + 48)];
  if (![*(*(*(a1 + 88) + 8) + 40) count])
  {
    if (!*(a1 + 112) || ([*(a1 + 56) uniqueID], v11 = objc_claimAutoreleasedReturnValue(), v12 = objc_msgSend(v11, "isEqualToString:", *(a1 + 64)), v11, (v12 & 1) != 0))
    {
      v7 = 0;
      goto LABEL_13;
    }

    v7 = 0;
LABEL_12:
    *(*(*(a1 + 96) + 8) + 24) = 1;
    goto LABEL_13;
  }

  if (*(a1 + 112))
  {
    if (*(a1 + 64))
    {
      v7 = [*(*(*(a1 + 88) + 8) + 40) objectForKeyedSubscript:?];

      if (!v7)
      {
        goto LABEL_12;
      }
    }
  }

  [*(a1 + 72) addObject:v3];
  v8 = [v3 identifier];
  if (v8)
  {
    v9 = *(a1 + 80);
    v10 = [v3 property];
    [v9 setObject:v8 forKeyedSubscript:v10];
  }

  v7 = 1;
LABEL_13:

  return v7;
}

- (void)saveRecentlyUsedAutoFillSetWithMatchesToFill:(id)a3 matchesForDoNotFill:(id)a4
{
  v33 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = objc_opt_new();
  v27 = 0u;
  v28 = 0u;
  v25 = 0u;
  v26 = 0u;
  v9 = v6;
  v10 = [v9 countByEnumeratingWithState:&v25 objects:v32 count:16];
  if (v10)
  {
    v11 = *v26;
    do
    {
      v12 = 0;
      do
      {
        if (*v26 != v11)
        {
          objc_enumerationMutation(v9);
        }

        v13 = [*(*(&v25 + 1) + 8 * v12) dictionaryRepresentationExcludingValue:1];
        [v8 addObject:v13];

        ++v12;
      }

      while (v10 != v12);
      v10 = [v9 countByEnumeratingWithState:&v25 objects:v32 count:16];
    }

    while (v10);
  }

  v14 = [MEMORY[0x1E695DF70] array];
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  v22 = 0u;
  v15 = v7;
  v16 = [v15 countByEnumeratingWithState:&v21 objects:v31 count:16];
  if (v16)
  {
    v17 = *v22;
    do
    {
      v18 = 0;
      do
      {
        if (*v22 != v17)
        {
          objc_enumerationMutation(v15);
        }

        v19 = [*(*(&v21 + 1) + 8 * v18) dictionaryRepresentationExcludingValue:1];
        [v14 addObject:v19];

        ++v18;
      }

      while (v16 != v18);
      v16 = [v15 countByEnumeratingWithState:&v21 objects:v31 count:16];
    }

    while (v16);
  }

  v29[0] = @"recentlyUsedAutoFillSetArray";
  v29[1] = @"recentlyUsedAutoFillSetDoNotFillArray";
  v30[0] = v8;
  v30[1] = v14;
  v20 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v30 forKeys:v29 count:2];
  [(WBSFormDataController *)self addRecentlyUsedAutoFillSet:v20 appendToTheEnd:0];
}

- (id)valuesForContactFormWithMetadata:(id)a3 inDomain:(id)a4 matches:(id *)a5 multiRoundAutoFillManager:(id)a6
{
  v6 = [(WBSFormDataController *)self valuesForContactFormWithMetadata:a3 inDomain:a4 matches:a5 multiRoundAutoFillManager:a6 contact:0];

  return v6;
}

- (id)valuesForContactFormWithMetadata:(id)a3 inDomain:(id)a4 matches:(id *)a5 multiRoundAutoFillManager:(id)a6 contact:(id)a7
{
  LOWORD(v10) = 0;
  LOBYTE(v9) = 1;
  v7 = [(WBSFormDataController *)self _valuesForStandardForm:a3 inDomain:a4 autoFillDataType:2 matches:a5 preferredLabel:0 multiRoundAutoFillManager:a6 wantAllMatches:v9 contact:a7 existingMatches:0 shouldUseExistingMatchesToFillFocusedField:v10 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:?];

  return v7;
}

- (id)valuesForContactFormWithMetadata:(id)a3 matches:(id *)a4 multiRoundAutoFillManager:(id)a5 existingMatches:(id)a6 contact:(id)a7
{
  v7 = [(WBSFormDataController *)self valuesForContactFormWithMetadata:a3 matches:a4 multiRoundAutoFillManager:a5 existingMatches:a6 shouldUseExistingMatchesToFillFocusedField:0 contact:a7];

  return v7;
}

- (id)valuesForContactFormWithMetadata:(id)a3 matches:(id *)a4 multiRoundAutoFillManager:(id)a5 existingMatches:(id)a6 shouldUseExistingMatchesToFillFocusedField:(BOOL)a7 contact:(id)a8
{
  LOWORD(v11) = a7;
  LOBYTE(v10) = 1;
  v8 = [(WBSFormDataController *)self _valuesForStandardForm:a3 inDomain:0 autoFillDataType:2 matches:a4 preferredLabel:0 multiRoundAutoFillManager:a5 wantAllMatches:v10 contact:a8 existingMatches:a6 shouldUseExistingMatchesToFillFocusedField:v11 allowingIdentifiedAddressBookLabelToOverridePreferredIdentifier:?];

  return v8;
}

- (id)exactFQDNAndOtherSavedAccountMatchesForForm:(id)a3 atURL:(id)a4 webFrameIdentifier:(id)a5 savedAccountContext:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [v10 userNameElementUniqueID];
  if (!v14)
  {
    v16 = 0;
    goto LABEL_9;
  }

  v15 = [objc_opt_class() metadataForControlWithUniqueID:v14 inForm:v10];
  v16 = v15;
  if (!v15)
  {
LABEL_9:
    v20 = &stru_1F3A5E418;
    goto LABEL_10;
  }

  v17 = [v15 value];
  v18 = [v16 isVisible];
  v19 = [v16 isReadOnly];
  if (v19 & 1 | ((v18 & 1) == 0) | [v16 claimsToBeUsernameViaAutocompleteAttribute] & 1 && objc_msgSend(v17, "length") && (objc_msgSend(v17, "hasPrefix:", @"@") & 1) == 0)
  {
    v20 = v17;
  }

  else
  {
    v20 = &stru_1F3A5E418;
  }

LABEL_10:
  v33 = 0;
  v34 = &v33;
  v35 = 0x3032000000;
  v36 = __Block_byref_object_copy__13;
  v37 = __Block_byref_object_dispose__13;
  v38 = 0;
  v27 = 0;
  v28 = &v27;
  v29 = 0x3032000000;
  v30 = __Block_byref_object_copy__13;
  v31 = __Block_byref_object_dispose__13;
  v32 = 0;
  v21 = [objc_alloc(MEMORY[0x1E69C8A58]) initWithString:v20 matchingType:0];
  v22 = [objc_alloc(MEMORY[0x1E69C8A30]) initWithURL:v11 options:3 userNameQuery:v21 associatedDomainsManager:0 webFrameIdentifier:v12];
  [v22 setContext:v13];
  v26[0] = MEMORY[0x1E69E9820];
  v26[1] = 3221225472;
  v26[2] = __114__WBSFormDataController_exactFQDNAndOtherSavedAccountMatchesForForm_atURL_webFrameIdentifier_savedAccountContext___block_invoke;
  v26[3] = &unk_1E7FC5DE8;
  v26[4] = &v33;
  v26[5] = &v27;
  [(WBSFormDataController *)self getSavedAccountMatchesWithCriteria:v22 synchronously:1 completionHandler:v26];
  v23 = objc_alloc(MEMORY[0x1E69C88F0]);
  v24 = [v23 initWithFirst:v34[5] second:v28[5]];

  _Block_object_dispose(&v27, 8);
  _Block_object_dispose(&v33, 8);

  return v24;
}

void __114__WBSFormDataController_exactFQDNAndOtherSavedAccountMatchesForForm_atURL_webFrameIdentifier_savedAccountContext___block_invoke(uint64_t a1, void *a2)
{
  v11 = a2;
  v3 = [v11 exactMatches];
  v4 = *(*(a1 + 32) + 8);
  v5 = *(v4 + 40);
  *(v4 + 40) = v3;

  v6 = [v11 potentialMatches];
  v7 = [v11 associatedDomainMatches];
  v8 = [v6 arrayByAddingObjectsFromArray:v7];
  v9 = *(*(a1 + 40) + 8);
  v10 = *(v9 + 40);
  *(v9 + 40) = v8;
}

+ (id)valuesFromUser:(id)a3 password:(id)a4 forLoginOrChangePasswordForm:(id)a5
{
  v7 = a3;
  v8 = a4;
  v9 = a5;
  v10 = [MEMORY[0x1E695DF90] dictionaryWithCapacity:2];
  v11 = [v9 userNameElementUniqueID];
  v12 = [v9 type];
  if (v12 == 3)
  {
    v13 = [v9 passwordElementUniqueID];
  }

  else
  {
    if (v12 != 5)
    {
      v14 = 0;
      v15 = v10;
      v10 = 0;
      goto LABEL_16;
    }

    v13 = [v9 oldPasswordElementUniqueID];
  }

  v14 = v13;
  if (v11 && [v7 length])
  {
    [v10 setObject:v7 forKeyedSubscript:v11];
  }

  v15 = 0;
  if (v8 && v14)
  {
    v16 = [objc_opt_class() metadataForControlWithUniqueID:v14 inForm:v9];
    if (([v16 isSecureTextField] & 1) == 0)
    {

      v8 = 0;
    }

    if ([v8 length])
    {
      [v10 setObject:v8 forKeyedSubscript:v14];
    }

    v15 = 0;
  }

LABEL_16:

  return v10;
}

- (id)valuesForFormWithMetadata:(id)a3 hideMyEmailRecord:(id)a4
{
  v25[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = v7;
  if (v7 && ![v7 state])
  {
    v10 = [v8 privateEmailAddress];
    v23 = objc_alloc_init(MEMORY[0x1E695CF18]);
    v11 = objc_alloc(MEMORY[0x1E695CEE0]);
    v12 = *MEMORY[0x1E695CB68];
    v25[0] = [v11 initWithLabel:*MEMORY[0x1E695CB68] value:v10];
    v22 = v25[0];
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:1];
    [v23 setEmailAddresses:v13];

    v14 = v23;
    v15 = [WBSAddressBookMatch alloc];
    v16 = [v14 identifier];
    v17 = [(WBSAddressBookMatch *)v15 initWithValue:v10 property:*MEMORY[0x1E69C8AA0] key:0 identifier:v16 label:v12];

    v18 = [WBSRecentlyUsedAutoFillSet alloc];
    v24 = v17;
    v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v24 count:1];
    v20 = [(WBSRecentlyUsedAutoFillSet *)v18 initWithFillMatches:v19 skipMatches:MEMORY[0x1E695E0F0] label:v12];
    v9 = [(WBSFormDataController *)self valuesForContactFormWithMetadata:v6 matches:0 multiRoundAutoFillManager:0 existingMatches:v20 shouldUseExistingMatchesToFillFocusedField:1 contact:v14];
  }

  else
  {
    v9 = objc_alloc_init(MEMORY[0x1E695DF20]);
  }

  return v9;
}

- (id)annotationsFromUsername:(id)a3 forLoginOrChangePasswordForm:(id)a4
{
  v12[1] = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = [v6 userNameElementUniqueID];

  if (v7)
  {
    v8 = 0;
  }

  else
  {
    if (v5)
    {
      v9 = v5;
    }

    else
    {
      v9 = &stru_1F3A5E418;
    }

    v11 = @"Username";
    v12[0] = v9;
    v8 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v12 forKeys:&v11 count:1];
  }

  return v8;
}

- (id)_lastUsedUsernameForDomain:(id)a3
{
  v3 = [(NSMutableDictionary *)self->_domainToLastUsedUsernameAndProtectionSpace objectForKey:a3];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 objectAtIndex:0];
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (void)_setLastUsedUsername:(id)a3 andProtectionSpace:(id)a4 forDomain:(id)a5
{
  v15[2] = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  domainToLastUsedUsernameAndProtectionSpace = self->_domainToLastUsedUsernameAndProtectionSpace;
  if (!domainToLastUsedUsernameAndProtectionSpace)
  {
    v12 = objc_alloc_init(MEMORY[0x1E695DF90]);
    v13 = self->_domainToLastUsedUsernameAndProtectionSpace;
    self->_domainToLastUsedUsernameAndProtectionSpace = v12;

    domainToLastUsedUsernameAndProtectionSpace = self->_domainToLastUsedUsernameAndProtectionSpace;
  }

  v15[0] = v8;
  v15[1] = v9;
  v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:2];
  [(NSMutableDictionary *)domainToLastUsedUsernameAndProtectionSpace setObject:v14 forKey:v10];
}

- (id)lastUsedUsernameWithPasswordForURL:(id)a3 inContext:(id)a4
{
  v5 = a3;
  if ([(WBSFormDataController *)self shouldAutoFillPasswords])
  {
    v6 = [WBSFormDataController domainFromURL:v5];
    if ([v6 length])
    {
      v7 = [(WBSFormDataController *)self _lastUsedUsernameForDomain:v6];
    }

    else
    {
      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)_knownUsernamesWithPasswordsForURL:(id)a3 inContext:(id)a4
{
  v6 = a3;
  v7 = a4;
  v14 = 0;
  v15 = &v14;
  v16 = 0x3032000000;
  v17 = __Block_byref_object_copy__13;
  v18 = __Block_byref_object_dispose__13;
  v19 = 0;
  v8 = objc_alloc(MEMORY[0x1E69C8A30]);
  v9 = [MEMORY[0x1E69C8A58] queryThatMatchesEverything];
  v10 = [v8 initWithURL:v6 options:17 userNameQuery:v9 associatedDomainsManager:0 webFrameIdentifier:0];

  [v10 setContext:v7];
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __70__WBSFormDataController__knownUsernamesWithPasswordsForURL_inContext___block_invoke;
  v13[3] = &unk_1E7FC5E10;
  v13[4] = &v14;
  [(WBSFormDataController *)self getSavedAccountMatchesWithCriteria:v10 synchronously:1 completionHandler:v13];
  v11 = [v15[5] safari_setByApplyingBlock:&__block_literal_global_235];

  _Block_object_dispose(&v14, 8);

  return v11;
}

void __70__WBSFormDataController__knownUsernamesWithPasswordsForURL_inContext___block_invoke(uint64_t a1, void *a2)
{
  v8 = a2;
  v3 = [v8 exactMatches];
  v4 = [v8 potentialMatches];
  v5 = [v3 arrayByAddingObjectsFromArray:v4];
  v6 = *(*(a1 + 32) + 8);
  v7 = *(v6 + 40);
  *(v6 + 40) = v5;
}

id __70__WBSFormDataController__knownUsernamesWithPasswordsForURL_inContext___block_invoke_2(uint64_t a1, void *a2)
{
  v2 = [a2 user];

  return v2;
}

- (void)didFillPasswordForUsername:(id)a3 fromProviderWithBundleIdentifier:(id)a4 inTabWithID:(id)a5 currentURL:(id)a6 isPrivate:(BOOL)a7 formMetadata:(id)a8 requester:(id)a9
{
  v10 = a7;
  v15 = a3;
  v16 = a4;
  v17 = a5;
  v18 = a6;
  v19 = a8;
  v20 = a9;
  if (!self->_recentAutoFillEvents)
  {
    v21 = [MEMORY[0x1E695DF70] array];
    recentAutoFillEvents = self->_recentAutoFillEvents;
    self->_recentAutoFillEvents = v21;
  }

  if (!self->_keybagCallbackToken)
  {
    v23 = [MEMORY[0x1E69C88B0] sharedManager];
    v32[0] = MEMORY[0x1E69E9820];
    v32[1] = 3221225472;
    v32[2] = __141__WBSFormDataController_didFillPasswordForUsername_fromProviderWithBundleIdentifier_inTabWithID_currentURL_isPrivate_formMetadata_requester___block_invoke;
    v32[3] = &unk_1E7FB6F80;
    v32[4] = self;
    v24 = [v23 addKeyBagLockStatusChangedObserverWithHandler:v32];
    keybagCallbackToken = self->_keybagCallbackToken;
    self->_keybagCallbackToken = v24;
  }

  [(WBSFormDataController *)self _removeExpiredAutoFillEvents:self->_recentAutoFillEvents];
  v26 = [v19 passwordElementUniqueID];

  v27 = self->_recentAutoFillEvents;
  v28 = [[WBSAutoFillEvent alloc] initWithUsername:v15 tabID:v17 isPrivateTab:v10 url:v18 providerBundleIdentifier:v16 passwordWasFilled:v26 != 0];
  [(NSMutableArray *)v27 addObject:v28];

  agentProxy = self->_agentProxy;
  v30 = [MEMORY[0x1E696AAE8] mainBundle];
  v31 = [v30 bundleIdentifier];
  [(WBSAuthenticationServicesAgentProxy *)agentProxy didFillCredentialForUsername:v15 forURL:v18 fromProviderWithBundleIdentifier:v16 inBrowserWithBundleIdentifier:v31 externalProviderConditionalRegistrationRequester:v20];
}

void __141__WBSFormDataController_didFillPasswordForUsername_fromProviderWithBundleIdentifier_inTabWithID_currentURL_isPrivate_formMetadata_requester___block_invoke(uint64_t a1)
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __141__WBSFormDataController_didFillPasswordForUsername_fromProviderWithBundleIdentifier_inTabWithID_currentURL_isPrivate_formMetadata_requester___block_invoke_2;
  block[3] = &unk_1E7FB6F80;
  block[4] = *(a1 + 32);
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __141__WBSFormDataController_didFillPasswordForUsername_fromProviderWithBundleIdentifier_inTabWithID_currentURL_isPrivate_formMetadata_requester___block_invoke_2(uint64_t a1)
{
  v2 = [MEMORY[0x1E69C88B0] sharedManager];
  v3 = [v2 keyBagLockStatus];

  if ((v3 - 1) <= 1)
  {
    v4 = *(*(a1 + 32) + 104);

    [v4 removeAllObjects];
  }
}

- (void)canAutomaticallyRegisterPasskeyForUsername:(id)a3 inTabWithID:(id)a4 currentURL:(id)a5 completionHandler:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  LOBYTE(v21) = 0;
  v14 = [[_WBSAutoFillEventMatchingCriteria alloc] initWithUsername:v10 timeInterval:v11 tabID:v12 currentURL:0 shouldAllowPrivateTabs:1 shouldRemoveMatchingEvent:1 shouldIncludeExternalCredentialEvents:300.0 onlyEventsWhenPasswordWasFilled:v21];
  if ([(WBSFormDataController *)self _hasAutoFillEventMatchingCriteria:v14])
  {
    v13[2](v13, 1);
  }

  else
  {
    v15 = [(NSMutableArray *)self->_recentAutoFillEvents lastObject];
    if (v15)
    {
      v16 = [v12 host];
      v17 = [v16 safari_highLevelDomainForPasswordManager];

      agentProxy = self->_agentProxy;
      v19 = [v15 url];
      v20 = [v19 absoluteString];
      v22[0] = MEMORY[0x1E69E9820];
      v22[1] = 3221225472;
      v22[2] = __109__WBSFormDataController_canAutomaticallyRegisterPasskeyForUsername_inTabWithID_currentURL_completionHandler___block_invoke;
      v22[3] = &unk_1E7FC5E58;
      v23 = v13;
      [(WBSAuthenticationServicesAgentProxy *)agentProxy isOrigin:v20 relatedToRelyingPartyIdentifier:v17 completionHandler:v22];
    }

    else
    {
      v13[2](v13, 0);
    }
  }
}

- (BOOL)canApplyAutoFillGracePeriodForUsername:(id)a3 inTabWithID:(id)a4 currentURL:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  LOBYTE(v13) = 0;
  v11 = [[_WBSAutoFillEventMatchingCriteria alloc] initWithUsername:v8 timeInterval:v9 tabID:v10 currentURL:1 shouldAllowPrivateTabs:0 shouldRemoveMatchingEvent:0 shouldIncludeExternalCredentialEvents:60.0 onlyEventsWhenPasswordWasFilled:v13];
  LOBYTE(self) = [(WBSFormDataController *)self _hasAutoFillEventMatchingCriteria:v11];

  return self;
}

- (BOOL)canShowSavedAccountHistoryItemInTabWithID:(id)a3 currentURL:(id)a4
{
  v6 = a3;
  v7 = a4;
  if (([MEMORY[0x1E69C8880] isSavedAccountHistoryInAutoFillEnabled] & 1) != 0 && -[NSMutableArray count](self->_recentAutoFillEvents, "count"))
  {
    v8 = [(NSMutableArray *)self->_recentAutoFillEvents lastObject];
    v9 = [v8 username];

    LOBYTE(v13) = 1;
    v10 = [[_WBSAutoFillEventMatchingCriteria alloc] initWithUsername:v9 timeInterval:v6 tabID:v7 currentURL:0 shouldAllowPrivateTabs:0 shouldRemoveMatchingEvent:0 shouldIncludeExternalCredentialEvents:60.0 onlyEventsWhenPasswordWasFilled:v13];
    v11 = [(WBSFormDataController *)self _hasAutoFillEventMatchingCriteria:v10];
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

- (id)savedAccountFromMostRecentAutoFillEventOfURL:(id)a3
{
  v4 = a3;
  if ([(NSMutableArray *)self->_recentAutoFillEvents count])
  {
    v12 = 0;
    v13 = &v12;
    v14 = 0x3032000000;
    v15 = __Block_byref_object_copy__13;
    v16 = __Block_byref_object_dispose__13;
    v17 = 0;
    v5 = [MEMORY[0x1E69C8A38] sharedStore];
    v6 = [MEMORY[0x1E69C8A30] criteriaForExactFQDNPasswordMatchesOfURL:v4];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __70__WBSFormDataController_savedAccountFromMostRecentAutoFillEventOfURL___block_invoke;
    v11[3] = &unk_1E7FC5E10;
    v11[4] = &v12;
    [v5 getSavedAccountsMatchingCriteria:v6 withSynchronousCompletionHandler:v11];
    v7 = [v13[5] matchesForPasswordAutoFill];
    if ([v7 count])
    {
      v8 = [v7 firstObject];
      v9 = [v8 savedAccount];
    }

    else
    {
      v9 = 0;
    }

    _Block_object_dispose(&v12, 8);
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)_hasAutoFillEventMatchingCriteria:(id)a3
{
  v4 = a3;
  if ([(NSMutableArray *)self->_recentAutoFillEvents count])
  {
    [(WBSFormDataController *)self _removeExpiredAutoFillEvents:self->_recentAutoFillEvents];
    [v4 timeInterval];
    v6 = (v5 * 1000000000.0);
    recentAutoFillEvents = self->_recentAutoFillEvents;
    v12 = MEMORY[0x1E69E9820];
    v13 = 3221225472;
    v14 = __59__WBSFormDataController__hasAutoFillEventMatchingCriteria___block_invoke;
    v15 = &unk_1E7FC5E80;
    v8 = v4;
    v16 = v8;
    v17 = v6;
    v9 = [(NSMutableArray *)recentAutoFillEvents indexOfObjectPassingTest:&v12];
    v10 = v9 != 0x7FFFFFFFFFFFFFFFLL;
    if (v9 != 0x7FFFFFFFFFFFFFFFLL && [v8 shouldRemoveMatchingEvent])
    {
      [(NSMutableArray *)self->_recentAutoFillEvents removeObjectAtIndex:v9];
    }
  }

  else
  {
    v10 = 0;
  }

  return v10;
}

uint64_t __59__WBSFormDataController__hasAutoFillEventMatchingCriteria___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = [v3 username];
  v5 = [*(a1 + 32) username];
  if ([v4 isEqualToString:v5])
  {
    v6 = [v3 tabID];
    v7 = [*(a1 + 32) tabID];
    if (v6 == v7)
    {
      v15 = [v3 url];
      v14 = [v15 host];
      v9 = [v14 safari_highLevelDomainForPasswordManager];
      v10 = [*(a1 + 32) currentURL];
      v11 = [v10 host];
      v12 = [v11 safari_highLevelDomainForPasswordManager];
      if ([v9 isEqualToString:v12] && objc_msgSend(v3, "timeIntervalSinceTimestamp") <= *(a1 + 40) && ((objc_msgSend(*(a1 + 32), "shouldAllowPrivateTabs") & 1) != 0 || (objc_msgSend(v3, "isPrivateTab") & 1) == 0) && (!objc_msgSend(v3, "isExternalCredentialProviderEvent") || objc_msgSend(*(a1 + 32), "shouldIncludeExternalCredentialEvents")))
      {
        if ([*(a1 + 32) onlyEventsWhenPasswordWasFilled])
        {
          v8 = [v3 passwordWasFilled];
        }

        else
        {
          v8 = 1;
        }
      }

      else
      {
        v8 = 0;
      }
    }

    else
    {
      v8 = 0;
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (void)_removeExpiredAutoFillEvents:(id)a3
{
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __54__WBSFormDataController__removeExpiredAutoFillEvents___block_invoke;
  v3[3] = &__block_descriptor_40_e33_B32__0__WBSAutoFillEvent_8Q16_B24l;
  v3[4] = 300000000000;
  [a3 safari_removeObjectsPassingTest:v3];
}

- (id)encryptOrDecryptData:(id)a3 encrypt:(BOOL)a4
{
  v4 = [a3 copy];

  return v4;
}

- (void)getSavedAccountMatchesWithCriteria:(id)a3 synchronously:(BOOL)a4 completionHandler:(id)a5
{
  v6 = a4;
  v11 = a3;
  v8 = a5;
  if ([(WBSFormDataController *)self shouldAutoFillPasswords])
  {
    v9 = [(WBSAutoFillQuirksManager *)self->_autoFillQuirksManager associatedDomainsManager];
    [v11 setAssociatedDomainsManager:v9];

    [MEMORY[0x1E69C8A38] sharedStore];
    if (v6)
      v10 = {;
      [v10 getSavedAccountsMatchingCriteria:v11 withSynchronousCompletionHandler:v8];
    }

    else
      v10 = {;
      [v10 savedAccountsMatchingCriteria:v11 withCompletionHandler:v8];
    }
  }

  else
  {
    v8[2](v8, 0);
  }
}

- (id)metadataOfActiveFormOrBestFormForPageLevelAutoFill:(id)a3 frame:(OpaqueFormAutoFillFrame *)a4
{
  v14 = 0;
  v15 = &v14;
  v16 = 0x2020000000;
  v17 = 0;
  v8 = 0;
  v9 = &v8;
  v10 = 0x3032000000;
  v11 = __Block_byref_object_copy__13;
  v12 = __Block_byref_object_dispose__13;
  v13 = 0;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __82__WBSFormDataController_metadataOfActiveFormOrBestFormForPageLevelAutoFill_frame___block_invoke;
  v7[3] = &unk_1E7FC5EC8;
  v7[4] = &v8;
  v7[5] = &v14;
  [a3 enumerateFormsUsingBlock:v7];
  if (a4)
  {
    *a4 = v15[3];
  }

  v5 = v9[5];
  _Block_object_dispose(&v8, 8);

  _Block_object_dispose(&v14, 8);

  return v5;
}

void __82__WBSFormDataController_metadataOfActiveFormOrBestFormForPageLevelAutoFill_frame___block_invoke(uint64_t a1, uint64_t a2, void *a3, _BYTE *a4)
{
  v8 = a3;
  if ([v8 containsActiveElement])
  {
    objc_storeStrong((*(*(a1 + 32) + 8) + 40), a3);
    *(*(*(a1 + 40) + 8) + 24) = a2;
    *a4 = 1;
  }

  else if ([v8 isBestForPageLevelAutoFill])
  {
    objc_storeStrong((*(*(a1 + 32) + 8) + 40), a3);
    *(*(*(a1 + 40) + 8) + 24) = a2;
  }
}

- (id)metadataOfActiveFormOrBestFormForPageLevelAutoFill:(id)a3 frameHandle:(id *)a4
{
  v14 = 0;
  v15 = &v14;
  v16 = 0x3032000000;
  v17 = __Block_byref_object_copy__13;
  v18 = __Block_byref_object_dispose__13;
  v19 = 0;
  v8 = 0;
  v9 = &v8;
  v10 = 0x3032000000;
  v11 = __Block_byref_object_copy__13;
  v12 = __Block_byref_object_dispose__13;
  v13 = 0;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __88__WBSFormDataController_metadataOfActiveFormOrBestFormForPageLevelAutoFill_frameHandle___block_invoke;
  v7[3] = &unk_1E7FC5EF0;
  v7[4] = &v8;
  v7[5] = &v14;
  [a3 enumerateFormsAndFramesUsingBlock:v7];
  if (a4)
  {
    *a4 = v15[5];
  }

  v5 = v9[5];
  _Block_object_dispose(&v8, 8);

  _Block_object_dispose(&v14, 8);

  return v5;
}

void __88__WBSFormDataController_metadataOfActiveFormOrBestFormForPageLevelAutoFill_frameHandle___block_invoke(uint64_t a1, void *a2, void *a3, _BYTE *a4)
{
  v9 = a2;
  v8 = a3;
  if ([v8 containsActiveElement])
  {
    objc_storeStrong((*(*(a1 + 32) + 8) + 40), a3);
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
    *a4 = 1;
  }

  else if ([v8 isBestForPageLevelAutoFill])
  {
    objc_storeStrong((*(*(a1 + 32) + 8) + 40), a3);
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
  }
}

- (id)metadataOfBestFormForStreamlinedLogin:(id)a3 frame:(OpaqueFormAutoFillFrame *)a4
{
  v14 = 0;
  v15 = &v14;
  v16 = 0x2020000000;
  v17 = 0;
  v8 = 0;
  v9 = &v8;
  v10 = 0x3032000000;
  v11 = __Block_byref_object_copy__13;
  v12 = __Block_byref_object_dispose__13;
  v13 = 0;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __69__WBSFormDataController_metadataOfBestFormForStreamlinedLogin_frame___block_invoke;
  v7[3] = &unk_1E7FC5EC8;
  v7[4] = &v8;
  v7[5] = &v14;
  [a3 enumerateFormsUsingBlock:v7];
  if (a4)
  {
    *a4 = v15[3];
  }

  v5 = v9[5];
  _Block_object_dispose(&v8, 8);

  _Block_object_dispose(&v14, 8);

  return v5;
}

void __69__WBSFormDataController_metadataOfBestFormForStreamlinedLogin_frame___block_invoke(uint64_t a1, uint64_t a2, void *a3, _BYTE *a4)
{
  v8 = a3;
  if ([v8 isBestForStreamlinedLogin])
  {
    objc_storeStrong((*(*(a1 + 32) + 8) + 40), a3);
    *(*(*(a1 + 40) + 8) + 24) = a2;
    *a4 = 1;
  }
}

- (id)metadataOfBestFormForStreamlinedLogin:(id)a3 frameHandle:(id *)a4
{
  v14 = 0;
  v15 = &v14;
  v16 = 0x3032000000;
  v17 = __Block_byref_object_copy__13;
  v18 = __Block_byref_object_dispose__13;
  v19 = 0;
  v8 = 0;
  v9 = &v8;
  v10 = 0x3032000000;
  v11 = __Block_byref_object_copy__13;
  v12 = __Block_byref_object_dispose__13;
  v13 = 0;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __75__WBSFormDataController_metadataOfBestFormForStreamlinedLogin_frameHandle___block_invoke;
  v7[3] = &unk_1E7FC5EF0;
  v7[4] = &v8;
  v7[5] = &v14;
  [a3 enumerateFormsAndFramesUsingBlock:v7];
  if (a4)
  {
    *a4 = v15[5];
  }

  v5 = v9[5];
  _Block_object_dispose(&v8, 8);

  _Block_object_dispose(&v14, 8);

  return v5;
}

void __75__WBSFormDataController_metadataOfBestFormForStreamlinedLogin_frameHandle___block_invoke(uint64_t a1, void *a2, void *a3, _BYTE *a4)
{
  v9 = a2;
  v8 = a3;
  if ([v8 isBestForStreamlinedLogin])
  {
    objc_storeStrong((*(*(a1 + 32) + 8) + 40), a3);
    objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
    *a4 = 1;
  }
}

+ (BOOL)isUsernameFieldInLoginFormWithTextFieldMetadata:(id)a3 formMetadata:(id)a4
{
  v5 = a3;
  v6 = a4;
  if ([v6 type] == 3)
  {
    v7 = [v6 userNameElementUniqueID];
    v8 = [v5 uniqueID];
    v9 = [v7 isEqualToString:v8];
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (BOOL)isPasswordFieldForUserCredentialsWithMetadata:(id)a3 formMetadata:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = [v6 type];
  if ((v7 - 6) >= 0xFFFFFFFFFFFFFFFDLL)
  {
    v9 = [v5 uniqueID];
    v10 = [v5 classification];
    v11 = WBSIsEqual();

    if (v11 & 1) != 0 || ([v6 passwordElementUniqueID], v12 = objc_claimAutoreleasedReturnValue(), v13 = objc_msgSend(v12, "isEqualToString:", v9), v12, (v13))
    {
      v8 = 1;
    }

    else if (v7 == 3)
    {
      v8 = 0;
    }

    else
    {
      v15 = [v6 confirmPasswordElementUniqueID];
      v8 = [v15 isEqualToString:v9];
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (void)updateLastUsedUsernameAndExtractUsernameAndPasswordFromForm:(id)a3 shouldPreferAnnotatedCredentials:(BOOL)a4 atURL:(id)a5 username:(id *)a6 password:(id *)a7 inContext:(id)a8
{
  v12 = a4;
  v16 = a3;
  v14 = a5;
  v15 = a8;
  *a6 = 0;
  *a7 = 0;
  if ([(WBSFormDataController *)self shouldAutoFillPasswords]|| self->_shouldShowPasswordsAppOnboarding)
  {
    *a6 = [(WBSFormDataController *)self extractUserNameFromForm:v16 atURL:v14 inContext:v15 updateLastUsedUserName:1];
    *a7 = [(WBSFormDataController *)self extractPasswordFromForm:v16 shouldPreferAnnotatedCredentials:v12];
  }
}

- (id)extractUserNameFromForm:(id)a3 atURL:(id)a4 inContext:(id)a5
{
  v5 = [(WBSFormDataController *)self extractUserNameFromForm:a3 atURL:a4 inContext:a5 updateLastUsedUserName:0];

  return v5;
}

- (id)extractUserNameFromForm:(id)a3 atURL:(id)a4 inContext:(id)a5 updateLastUsedUserName:(BOOL)a6
{
  v6 = a6;
  v55 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v44 = a4;
  v40 = a5;
  v43 = v10;
  v42 = [v10 userNameElementUniqueID];
  v39 = self;
  v38 = [objc_opt_class() domainFromURL:v44];
  if (![v38 length])
  {
    v49 = 0;
    goto LABEL_56;
  }

  v41 = [MEMORY[0x1E695DFA8] set];
  v36 = [v10 annotations];
  v37 = [v36 safari_stringForKey:@"Username"];
  if (v37)
  {
    [v41 addObject:v37];
  }

  v11 = [(WBSFormDataController *)self _knownUsernamesWithPasswordsForURL:v44 inContext:v40];
  [v41 unionSet:v11];

  if (![v42 length])
  {
    goto LABEL_45;
  }

  v47 = [objc_opt_class() metadataForControlWithUniqueID:v42 inForm:v10];
  v48 = [v47 value];
  if ([v41 containsObject:?])
  {
    v12 = v48;
    goto LABEL_41;
  }

  v52 = 0u;
  v53 = 0u;
  v50 = 0u;
  v51 = 0u;
  obj = v41;
  v13 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
  v35 = v6;
  if (!v13)
  {
    v16 = v48;
    goto LABEL_40;
  }

  v46 = *v51;
  do
  {
    v14 = 0;
    do
    {
      if (*v51 != v46)
      {
        objc_enumerationMutation(obj);
      }

      v15 = *(*(&v50 + 1) + 8 * v14);
      v16 = v48;
      v17 = v15;
      v18 = v47;
      if (([v16 isEqualToString:v17] & 1) != 0 || (v19 = objc_msgSend(v16, "length"), v20 = objc_msgSend(v17, "length"), !v19) || (v21 = v20) == 0)
      {
LABEL_14:

        goto LABEL_15;
      }

      if (v19 == v20)
      {
        v22 = 0;
        v23 = 0;
        do
        {
          v24 = [v16 characterAtIndex:v22];
          v25 = [v17 characterAtIndex:v22];
          if ((v24 != 42 || v25 == 42) && (v24 != 8226 || v25 == 8226))
          {
            if (v24 != v25)
            {
              goto LABEL_14;
            }
          }

          else
          {
            v23 = 1;
          }

          ++v22;
        }

        while (v19 != v22);

        if (v23)
        {
LABEL_38:
          v31 = v17;

          v16 = v31;
          goto LABEL_40;
        }
      }

      else
      {
        v26 = [v18 isUserEditedTextField];
        if (v19 <= v21 + 1)
        {
          v27 = 1;
        }

        else
        {
          v27 = v26;
        }

        if (v27)
        {
          goto LABEL_14;
        }

        v28 = [@"_" stringByAppendingString:v17];
        v29 = [v16 hasSuffix:v28];

        if (v29)
        {
          goto LABEL_38;
        }
      }

LABEL_15:
      ++v14;
    }

    while (v14 != v13);
    v30 = [obj countByEnumeratingWithState:&v50 objects:v54 count:16];
    v13 = v30;
  }

  while (v30);
LABEL_40:

  v12 = v16;
  v6 = v35;
LABEL_41:
  v49 = v12;
  if ([v12 length])
  {
    if (v6)
    {
      v32 = [MEMORY[0x1E695AC58] safari_HTMLFormProtectionSpaceForURL:v44];
      [(WBSFormDataController *)v39 _setLastUsedUsername:v49 andProtectionSpace:v32 forDomain:v38];
      goto LABEL_53;
    }

    goto LABEL_54;
  }

LABEL_45:
  if ([v37 length])
  {
    v49 = v37;
  }

  else
  {
    v47 = [v43 passwordElementUniqueID];
    v32 = [objc_opt_class() metadataForControlWithUniqueID:v47 inForm:v43];
    v33 = [v32 associatedUsername];
    if ([v33 length])
    {
      v49 = v33;
      v33 = 0;
    }

    else if ([v43 type] == 4)
    {
      v49 = 0;
    }

    else
    {
      v49 = [(WBSFormDataController *)v39 lastUsedUsernameWithPasswordForURL:v44 inContext:v40];
    }

LABEL_53:
LABEL_54:
  }

LABEL_56:

  return v49;
}

- (id)extractPasswordFromForm:(id)a3 shouldPreferAnnotatedCredentials:(BOOL)a4
{
  v6 = a3;
  v7 = [v6 annotations];
  v25 = v7;
  v8 = [v6 passwordElementUniqueID];
  v9 = [objc_opt_class() metadataForControlWithUniqueID:v8 inForm:v6];
  v10 = [v9 value];
  if (a4)
  {
    v11 = @"NewPassword";
  }

  else
  {
    v11 = [(WBSFormDataController *)self _keyToLookUpInAnnotationsForPasswordForFormMetadata:v6];
  }

  v12 = v11;
  v13 = [v7 safari_stringForKey:v11];
  v14 = v10;
  v15 = v13;
  v16 = v9;
  if (([v14 isEqualToString:v15] & 1) == 0 && (v18 = objc_msgSend(v14, "length"), v19 = objc_msgSend(v15, "length"), v18) && v19 && v18 == v19)
  {
    if (([v16 isUserEditedTextField] & 1) == 0)
    {
      v26 = 0;
      v20 = [MEMORY[0x1E696AE88] scannerWithString:v14];
      [v20 scanInteger:&v26];
      v21 = [v20 isAtEnd];

      if (v21)
      {

LABEL_21:
        v24 = v15;

        v14 = v24;
        goto LABEL_6;
      }
    }

    v23 = [v14 safari_looksLikeObscuredPassword];

    if (v23)
    {
      goto LABEL_21;
    }
  }

  else
  {
  }

LABEL_6:
  if (a4 || ![v14 length] && v15)
  {
    v17 = v14;
    v14 = v15;
  }

  else
  {

    v17 = 0;
  }

  return v14;
}

- (id)_keyToLookUpInAnnotationsForPasswordForFormMetadata:(id)a3
{
  if (([a3 type] & 0xFFFFFFFFFFFFFFFELL) == 4)
  {
    v3 = WBSFormAnnotationNewPasswordKey;
  }

  else
  {
    v3 = WBSFormAnnotationCurrentPasswordKey;
  }

  v4 = *v3;

  return v4;
}

- (id)savedAccountUsingDomainsToConsiderIdenticalWithUsername:(id)a3 url:(id *)a4 host:(id *)a5
{
  v28 = *MEMORY[0x1E69E9840];
  v6 = [(WBSFormDataController *)self autoFillQuirksManager];
  v7 = [v6 associatedDomainsManager];
  v8 = [v7 domainsToConsiderIdenticalToDomain:*a5];

  v21 = [MEMORY[0x1E696AF20] componentsWithURL:*a4 resolvingAgainstBaseURL:1];
  v25 = 0u;
  v26 = 0u;
  v23 = 0u;
  v24 = 0u;
  v9 = [MEMORY[0x1E69C8A38] sharedStore];
  v10 = [v9 savedAccounts];

  v11 = [v10 countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v11)
  {
    v12 = *v24;
    while (2)
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v24 != v12)
        {
          objc_enumerationMutation(v10);
        }

        v14 = *(*(&v23 + 1) + 8 * i);
        v15 = [MEMORY[0x1E695DFA8] set];
        v16 = [v14 sites];
        [v15 addObjectsFromArray:v16];

        [v15 intersectSet:v8];
        if ([v15 count])
        {
          v18 = [v15 anyObject];
          [v21 setHost:v18];
          *a4 = [v21 URL];
          v19 = v18;
          *a5 = v18;
          v17 = v14;

          goto LABEL_11;
        }
      }

      v11 = [v10 countByEnumeratingWithState:&v23 objects:v27 count:16];
      if (v11)
      {
        continue;
      }

      break;
    }
  }

  v17 = 0;
LABEL_11:

  return v17;
}

- (id)autoGeneratedPasswordForURL:(id)a3 respectingPasswordRequirements:(id)a4 maxLength:(unint64_t)a5
{
  v8 = a3;
  v9 = a4;
  v10 = [(WBSFormDataController *)self autoFillQuirksManager];
  v11 = [v10 passwordGenerationManager];

  if ([v9 count])
  {
    v12 = v9;
  }

  else
  {
    v12 = [v11 defaultRequirementsForURL:v8];
  }

  v13 = v12;
  v14 = [v11 updatedRequirements:v12 respectingMaxLength:a5];

  v15 = [v11 generatedPasswordMatchingRequirements:v14];

  return v15;
}

+ (id)contactKeyForString:(id)a3
{
  v20[12] = *MEMORY[0x1E69E9840];
  v3 = a3;
  {
    v4 = +[WBSFormDataController contactKeyForString:]::map;
  }

  else
  {
    v7 = *MEMORY[0x1E695C360];
    v19[0] = @"Address";
    v19[1] = @"Birthday";
    v8 = *MEMORY[0x1E695C1D0];
    v20[0] = v7;
    v20[1] = v8;
    v9 = *MEMORY[0x1E695C208];
    v19[2] = @"Email";
    v19[3] = @"First";
    v10 = *MEMORY[0x1E695C240];
    v20[2] = v9;
    v20[3] = v10;
    v11 = *MEMORY[0x1E695C2B0];
    v19[4] = @"InstantMessage";
    v19[5] = @"JobTitle";
    v12 = *MEMORY[0x1E695C2C8];
    v20[4] = v11;
    v20[5] = v12;
    v13 = *MEMORY[0x1E695C230];
    v19[6] = @"Last";
    v19[7] = @"Middle";
    v14 = *MEMORY[0x1E695C2F0];
    v20[6] = v13;
    v20[7] = v14;
    v15 = *MEMORY[0x1E695C328];
    v19[8] = @"Organization";
    v19[9] = @"Phone";
    v16 = *MEMORY[0x1E695C330];
    v20[8] = v15;
    v20[9] = v16;
    v17 = *MEMORY[0x1E695C418];
    v18 = *MEMORY[0x1E69C8AD8];
    v19[10] = @"URLs";
    v19[11] = v18;
    v20[10] = v17;
    v20[11] = v18;
    v4 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v20 forKeys:v19 count:12];
    +[WBSFormDataController contactKeyForString:]::map = v4;
  }

  v5 = [v4 objectForKeyedSubscript:v3];

  return v5;
}

- (id)addressBookMatchesForFullNameForContact:(id)a3
{
  v10[1] = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [MEMORY[0x1E695CD80] stringFromContact:v3 style:0];
  if ([v4 length])
  {
    v5 = [WBSAddressBookMatch alloc];
    v6 = [v3 identifier];
    v7 = [(WBSAddressBookMatch *)v5 initWithValue:v4 property:*MEMORY[0x1E69C8AD8] key:0 identifier:0 label:0 uniqueID:v6];
    v10[0] = v7;
    v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v10 count:1];
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (BOOL)textFieldMetadataMeetsRequirementsForAutomaticStrongPasswordTreatment:(id)a3 form:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = v6;
  v8 = 0;
  if (v5 && v6)
  {
    v9 = [v5 classification];
    v10 = [v9 isEqualToString:@"new-password"];

    if ((v10 & 1) != 0 && (v11 = [v5 maxLength], v11 >= objc_msgSend(MEMORY[0x1E69C8970], "minimumPasswordLength")))
    {
      v12 = [v5 value];
      v8 = [v12 length] == 0;
    }

    else
    {
      v8 = 0;
    }
  }

  return v8;
}

- (BOOL)textFieldIsEligibleForAutomaticStrongPassword:(id)a3 form:(id)a4 ignorePreviousDecision:(BOOL)a5 textFieldCurrentlyContainsStrongPassword:(BOOL *)a6
{
  v10 = a3;
  v11 = a4;
  v12 = [v10 autoFillButtonType];
  if (a6)
  {
    *a6 = v12 == 3;
  }

  if (v12 == 3)
  {
    a5 = 1;
  }

  else if ([(WBSFormDataController *)self textFieldMetadataMeetsRequirementsForAutomaticStrongPasswordTreatment:v10 form:v11])
  {
    if ([v10 lastAutoFillButtonType] != 3)
    {
      a5 = 1;
    }
  }

  else
  {
    a5 = 0;
  }

  return a5;
}

- (BOOL)frameIsKnownToAskForCredentialsFromOtherServicesFromAncestorFrameURLs:(id)a3
{
  v4 = a3;
  if ([v4 count] >= 2)
  {
    v6 = [v4 firstObject];
    v7 = [v4 lastObject];
    v8 = [v6 host];
    v9 = [v8 safari_highLevelDomainForPasswordManager];

    v10 = [v7 host];
    v11 = [v10 safari_highLevelDomainForPasswordManager];
    v12 = [v9 isEqualToString:v11];

    if (v12)
    {
      v5 = 0;
    }

    else
    {
      v5 = [(WBSAutoFillQuirksManager *)self->_autoFillQuirksManager isDomainKnownToAskForCredentialsForOtherServicesWhenEmbeddedAsThirdParty:v9];
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

+ (BOOL)password:(id)a3 shouldBeConsideredEqualToExistingPassword:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = ([v5 isEqualToString:v6] & 1) != 0 || +[WBSFormDataController _password:appearsToBeASixDigitCodeAppendedToPassword:](WBSFormDataController, "_password:appearsToBeASixDigitCodeAppendedToPassword:", v5, v6) || +[WBSFormDataController _password:appearsToBeMoreThanOneSymbolAppendedToPassword:](WBSFormDataController, "_password:appearsToBeMoreThanOneSymbolAppendedToPassword:", v5, v6);

  return v7;
}

+ (BOOL)_password:(id)a3 appearsToBeASixDigitCodeAppendedToPassword:(id)a4
{
  v5 = a3;
  v6 = a4;
  if ([v6 length] && !objc_msgSend(v5, "rangeOfString:", v6))
  {
    v9 = [v5 substringFromIndex:v7];
    if ([v9 length] == 6)
    {
      v10 = [MEMORY[0x1E696AB08] decimalDigitCharacterSet];
      v11 = [v10 invertedSet];

      v8 = [v9 rangeOfCharacterFromSet:v11] == 0x7FFFFFFFFFFFFFFFLL;
    }

    else
    {
      v8 = 0;
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

+ (BOOL)_password:(id)a3 appearsToBeMoreThanOneSymbolAppendedToPassword:(id)a4
{
  v24[2] = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  if ([v6 length] && objc_msgSend(v5, "length") && !objc_msgSend(v5, "rangeOfString:", v6))
  {
    v10 = [v5 substringFromIndex:v7];
    if ([v10 length] >= 2)
    {
      v11 = [MEMORY[0x1E696AB08] characterSetWithCharactersInString:@"@"];
      v24[0] = v11;
      v12 = [MEMORY[0x1E696AB08] characterSetWithCharactersInString:@"*"];
      v24[1] = v12;
      v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v24 count:2];

      v21 = 0u;
      v22 = 0u;
      v19 = 0u;
      v20 = 0u;
      v14 = v13;
      v8 = [v14 countByEnumeratingWithState:&v19 objects:v23 count:16];
      if (v8)
      {
        v15 = *v20;
        while (2)
        {
          for (i = 0; i != v8; ++i)
          {
            if (*v20 != v15)
            {
              objc_enumerationMutation(v14);
            }

            v17 = [v10 stringByTrimmingCharactersInSet:{*(*(&v19 + 1) + 8 * i), v19}];
            v18 = [v17 length] == 0;

            if (v18)
            {
              LOBYTE(v8) = 1;
              goto LABEL_18;
            }
          }

          v8 = [v14 countByEnumeratingWithState:&v19 objects:v23 count:16];
          if (v8)
          {
            continue;
          }

          break;
        }
      }

LABEL_18:
    }

    else
    {
      LOBYTE(v8) = 0;
    }
  }

  else
  {
    LOBYTE(v8) = 0;
  }

  return v8;
}

+ (BOOL)isFieldUnidentified:(id)a3
{
  v3 = a3;
  v4 = [v3 classification];
  v5 = [v3 addressBookLabel];
  if (v5 || (WBSIsEqual() & 1) != 0 || (WBSIsEqual() & 1) != 0)
  {
    LOBYTE(v6) = 0;
  }

  else
  {
    v6 = WBSIsEqual() ^ 1;
  }

  return v6;
}

- (void)getFormFieldValues:(os_log_t)log andFieldToFocus:withSingleCreditCardData:inField:inForm:.cold.3(uint8_t *buf, uint64_t a2, os_log_t log)
{
  *buf = 134217984;
  *(buf + 4) = a2;
  _os_log_error_impl(&dword_1BB6F3000, log, OS_LOG_TYPE_ERROR, "Found %lu controls, but expected 3 or fewer.", buf, 0xCu);
}

@end