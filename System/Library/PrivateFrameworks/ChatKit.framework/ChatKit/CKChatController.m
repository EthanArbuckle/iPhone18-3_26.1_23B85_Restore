@interface CKChatController
+ (id)representationFromFileURL:(id)a3;
+ (void)donateStickerToRecents:(id)a3;
+ (void)donateStickerToRecentsWithIdentifier:(id)a3 representations:(id)a4 stickerEffectType:(int64_t)a5 externalURI:(id)a6 name:(id)a7 accessibilityLabel:(id)a8 metadata:(id)a9 ckAttributionInfo:(id)a10;
- (BOOL)_CKRunningInSOSBuddy;
- (BOOL)__shouldHideNavigationBarForThrowBalloonViewAttributesCollection:(id)a3 inContainerView:(id)a4 framesOfAddedChatItems:(id)a5;
- (BOOL)_allowsMultipleSelectionForMessage:(id)a3;
- (BOOL)_anySuggestionPresenterWantsToShowBanner;
- (BOOL)_anyTranscriptBannerIsVisible;
- (BOOL)_backgroundEligibleForTranscriptDocking;
- (BOOL)_balloonViewOfCell:(id)a3 containsPoint:(CGPoint)a4 fromView:(id)a5;
- (BOOL)_canReloadEntryView;
- (BOOL)_canShowBackButtonView;
- (BOOL)_clickyOrbEnabled;
- (BOOL)_displayPreviewItemForMediaObject:(id)a3;
- (BOOL)_dropSessionIsNewSticker:(id)a3;
- (BOOL)_dropSessionIsTargetingEntryView:(id)a3;
- (BOOL)_hasExistingBannerMatchingStyle:(unint64_t)a3 withNicknames:(id)a4;
- (BOOL)_hasJoinableCall;
- (BOOL)_hasPreviewViewControllerForChatItem:(id)a3;
- (BOOL)_isFirstUnreadMessageVisibleForContentOffset:(CGPoint)a3;
- (BOOL)_lastAddressedHandleIsAvailableAsiMessageAlias:(id)a3 SIMID:(id)a4;
- (BOOL)_macShouldShowFaceTimeButtonInToolbar;
- (BOOL)_mediaObjectHasTrimMetadata:(id)a3;
- (BOOL)_mediaObjectNeedsTrimming:(id)a3;
- (BOOL)_noticeIsExpired:(id)a3;
- (BOOL)_point:(CGPoint)a3 visuallyIntersectsBalloonViewInCollectionView:(id)a4;
- (BOOL)_presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:(id)a3 collaborationType:(int64_t)a4;
- (BOOL)_sharingAllowOthersToInviteFromOptionsGroups:(id)a3;
- (BOOL)_shouldCheckWithSafetyMonitor;
- (BOOL)_shouldConfigureChatItemMenuForCommSafety:(id)a3;
- (BOOL)_shouldHideNavigationBarForSendAnimationContext:(id)a3;
- (BOOL)_shouldRestoreDraftState;
- (BOOL)_shouldRestoreFirstResponderAfterDetailsViewDismiss;
- (BOOL)_shouldShowNicknameOnboardingFlow;
- (BOOL)_shouldShowPollDetailsActionForChatItem:(id)a3;
- (BOOL)_shouldShowReadReceiptAlert;
- (BOOL)_shouldShowSaveStickerActionForChatItem:(id)a3;
- (BOOL)_shouldValidatePayloadBeforeSendingPayload:(id)a3;
- (BOOL)_showOrHideNicknameBannerIfNeeded;
- (BOOL)_transcriptScrollsOnEntryViewActivation;
- (BOOL)_wantsCatchUpAffordance;
- (BOOL)_wantsThreeColumnLayout;
- (BOOL)_wantsToShowCollaborationNotices;
- (BOOL)accountCanCreateNickname;
- (BOOL)actionPerformer:(id)a3 transitionToViewController:(id)a4 transitionType:(int64_t)a5;
- (BOOL)allowDebugItems;
- (BOOL)allowEffectPickerToBePresented;
- (BOOL)allowsMentions;
- (BOOL)allowsNavigationBarTitleInteraction;
- (BOOL)appManagerDisplayedInMessages;
- (BOOL)appModalIsDisplayed;
- (BOOL)becomeFirstResponder;
- (BOOL)canBecomeFirstResponder;
- (BOOL)canPerformAction:(SEL)a3 withSender:(id)a4;
- (BOOL)chatFooterViewOffset:(double *)a3;
- (BOOL)chatInputControllerCanSend:(id)a3;
- (BOOL)chatInputControllerShouldShowHandwriting:(id)a3;
- (BOOL)clearCommSafetyCompositionIfNecessary;
- (BOOL)clickInteractionShouldBegin:(id)a3;
- (BOOL)commitStickerAsTapback:(id)a3;
- (BOOL)contextMenuInteractionIsOutsideOfVisibleBalloonCells:(id)a3;
- (BOOL)dragInteraction:(id)a3 sessionIsRestrictedToDraggingApplication:(id)a4;
- (BOOL)dropInteraction:(id)a3 canHandleSession:(id)a4;
- (BOOL)fullScreenBalloonViewControllerShouldShowHightlightButton:(id)a3 forChatItem:(id)a4;
- (BOOL)fullScreenBalloonViewControllerShouldShowReplyButton:(id)a3;
- (BOOL)gestureRecognizer:(id)a3 shouldReceiveTouch:(id)a4;
- (BOOL)gestureRecognizer:(id)a3 shouldRequireFailureOfGestureRecognizer:(id)a4;
- (BOOL)hasSelectedChatItems;
- (BOOL)hasSelectedChatItemsIncludingAssociatedTapback;
- (BOOL)inputAccessoryViewControllerEnabled;
- (BOOL)isChatControllerShowingStandaloneWindow:(id)a3;
- (BOOL)isDetailsNavigationControllerDetached;
- (BOOL)isEditingMessage;
- (BOOL)isFullScreenBalloonViewOnScreen;
- (BOOL)isFunCamPresented;
- (BOOL)isHandwritingLandscape;
- (BOOL)isInlineReply;
- (BOOL)isKeyboardSnapshotVisible;
- (BOOL)isKeyboardSnapshotted;
- (BOOL)isMainTranscript;
- (BOOL)isSafeToMarkAsRead;
- (BOOL)isShowingBusinessOnboarding;
- (BOOL)isShowingOscarChat;
- (BOOL)isShowingReactWithAStickerOverlay;
- (BOOL)isUsingVisibleInputViewHeightWhenUpdatingScrollGeometry;
- (BOOL)keyboardIsQuickPathing;
- (BOOL)messageEditingViewController:(id)a3 balloonHasTailForChatItemGuid:(id)a4;
- (BOOL)messageEntryView:(id)a3 shouldInsertMediaObjects:(id)a4;
- (BOOL)messageEntryViewWidth:(double *)a3 andOffset:(double *)a4;
- (BOOL)needsFooter;
- (BOOL)photosGridFullScreenBalloonViewControllerShouldShowReplyButton:(id)a3;
- (BOOL)photosGridViewPresented;
- (BOOL)photosViewController:(id)a3 didPickAssetReference:(id)a4;
- (BOOL)pluginButtonsEnabled;
- (BOOL)prefersBottomDividerHidden;
- (BOOL)prefersStatusBarHidden;
- (BOOL)presentUpdateBanner;
- (BOOL)previewController:(id)a3 canShareItem:(id)a4;
- (BOOL)previewController:(id)a3 shouldDetectMachineReadableCodeForPreviewItem:(id)a4;
- (BOOL)previewControllerIsInGroupConversation:(id)a3;
- (BOOL)repositionSticker:(id)a3 stickerChatItem:(id)a4 parentMessagePartChatItem:(id)a5 stickerPositioningInfo:(id)a6;
- (BOOL)respondsToSelector:(SEL)a3;
- (BOOL)shouldAutorotate;
- (BOOL)shouldDismissKeyboardWhenShowingFullScreenAcknowledgmentPickerForBalloonChatItem:(id)a3;
- (BOOL)shouldHideInteractionOptions;
- (BOOL)shouldListParticipantsInTitle;
- (BOOL)shouldNotShowGroupBanners;
- (BOOL)shouldOfferTranslateConversationInTranslateMenu;
- (BOOL)shouldPageSelectedChatItem;
- (BOOL)shouldPresentDetailsInInspector;
- (BOOL)shouldQuickLookChatItem:(id)a3;
- (BOOL)shouldQuickLookSelectedChatItem;
- (BOOL)shouldShowAcceptedContactBanner;
- (BOOL)shouldShowAvatarViewInNavBarCanvas;
- (BOOL)shouldShowBanners;
- (BOOL)shouldShowEntryView;
- (BOOL)shouldShowFullScreenAcknowledgmentPickerForChatItem:(id)a3;
- (BOOL)shouldShowReplyButtonForMediaObject:(id)a3 previewController:(id)a4;
- (BOOL)shouldShowTapbackPickerForChatItem:(id)a3;
- (BOOL)shouldShowTipsWithAlignment:(int64_t)a3;
- (BOOL)shouldUseMacConversationAvatarTitleView;
- (BOOL)shouldUseMinimumSafeAreas;
- (BOOL)shouldUseThrowAnimationForComposition:(id)a3;
- (BOOL)shouldViewDetailsForSelectedChatItem;
- (BOOL)showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:(id)a3;
- (BOOL)showGroupBannerUpdateIfNeeded;
- (BOOL)showKeyboardForReply;
- (BOOL)showNicknameSharingOnboardingWithMemoji:(BOOL)a3;
- (BOOL)showSendAlertIfNecessaryForComposition:(id)a3;
- (BOOL)throwAnimationUsesAnimatedReloadForMessages:(id)a3;
- (BOOL)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 shouldSelectChatItem:(id)a5;
- (BOOL)transcriptCollectionViewController:(id)a3 balloonViewDidRequestCommitPayload:(id)a4 forPlugin:(id)a5 allowAllCommits:(BOOL)a6 error:(id *)a7;
- (BOOL)transcriptCollectionViewController:(id)a3 balloonViewDidRequestCommitSticker:(id)a4 forPlugin:(id)a5 allowAllCommits:(BOOL)a6 error:(id *)a7;
- (BOOL)transcriptCollectionViewController:(id)a3 balloonViewDidRequestSendCustomAcknowledgementPayload:(id)a4 forPlugin:(id)a5 error:(id *)a6;
- (BOOL)transcriptCollectionViewController:(id)a3 shouldSetupFullscreenEffectUI:(id)a4;
- (BOOL)transcriptCollectionViewControllerShouldPlayAudio:(id)a3;
- (BOOL)transcriptCollectionViewControllerShouldScrollToBottomForLocalSentMessage:(id)a3;
- (BOOL)transcriptCollectionViewControllerShouldShouldScrollToTopForStatusBarTap:(id)a3;
- (BOOL)transcriptCollectionViewControllerShouldSuppressDockingBehavior:(id)a3;
- (BOOL)wantsMessageRequestsTip;
- (CGAffineTransform)stickerPreviewTransform;
- (CGPoint)contentOffsetForFirstUnreadMessage;
- (CGPoint)fullScreenBalloonViewController:(id)a3 stickerCenterForChatItem:(id)a4;
- (CGPoint)initialContentOffset;
- (CGRect)_convertedNavigationBarFrameInSendAnimationContainerView:(id)a3;
- (CGRect)_keyboardFrameAccountingForSalientTranscriptBackgroundRect:(CGRect)a3;
- (CGRect)_targetStickerFrameFromStickerCell:(id)a3 coordinateSpace:(id)a4;
- (CGRect)effectiveVisibleRectOfCollectionViewForTranscriptCollectionViewController:(id)a3;
- (CGRect)fullScreenBalloonViewController:(id)a3 balloonFrameForChatItem:(id)a4;
- (CGRect)fullScreenBalloonViewController:(id)a3 stickerBoundsForChatItem:(id)a4;
- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)a3;
- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrameIgnoreEntryView:(id)a3;
- (CGRect)inlineReplyController:(id)a3 gradientFrameWithInsets:(UIEdgeInsets)a4;
- (CGRect)inputAccessoryViewFrameForFloatingKeyboard;
- (CGRect)messageEntryView:(id)a3 frameInThrowViewCoordinatesForView:(id)a4;
- (CGRect)photoGridTapbackSnapshotRect;
- (CGRect)photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)a3;
- (CGRect)previewController:(id)a3 frameForPreviewItem:(id)a4 inSourceView:(id *)a5;
- (CGRect)salientTranscriptBackgroundRect;
- (CGRect)screenFrameForNotification:(id)a3;
- (CGRect)throwAnimationWindowFrame:(id)a3;
- (CGSize)lastLaidOutSize;
- (CGSize)messageEntryViewMaxShelfPluginViewSize:(id)a3;
- (CKAggregateAttachmentMessagePartChatItem)photoGridMomentShareChatItem;
- (CKCallButtonStateResolver)callStateResolver;
- (CKChatController)initWithConversation:(id)a3;
- (CKChatControllerSendMenuDelegate)sendMenuDelegate;
- (CKComposition)composition;
- (CKExternalPluginViewControllerProvider)externalPluginControllerProvider;
- (CKMediaObjectAssetDataSourceManager)photoGridDataSourceManager;
- (CKMessageEntryView)entryView;
- (CKNavBarUnifiedCallButton)navBarFaceTimeCallButton;
- (CKOnboardingController)onboardingController;
- (CKTapbackPickerContainerAccessoryView)pickerContainerAccessoryView;
- (CKTranscriptCollectionView)collectionView;
- (CNContactPickerViewController)contactPicker;
- (Class)CKCloudSharingClass;
- (NSArray)internalBarButtonItems;
- (NSArray)keyCommands;
- (OS_dispatch_group)revealAnimationGroup;
- (UIEdgeInsets)_avoidanceInsets;
- (UIEdgeInsets)_contentInsetForSendAnimation;
- (UIEdgeInsets)_marginInsetsForEntryView;
- (UIEdgeInsets)additionalSafeAreaInsets;
- (UIEdgeInsets)adjustedContentInsetsForComputedInsets:(UIEdgeInsets)a3;
- (UIEdgeInsets)bannerInsets;
- (UIEdgeInsets)initialContentInset;
- (UIEdgeInsets)macToolbarInsets;
- (UIEdgeInsets)messageEditingViewController:(id)a3 contentInsetsForChatItemGuid:(id)a4;
- (UIEdgeInsets)parentTranscriptContentInsetsForInlineReplyController:(id)a3;
- (UIEdgeInsets)virtualToolbarContentInsets;
- (UIView)previewSourceView;
- (UIView)recipientsVirtualToolbarItem;
- (UIViewController)walletOrderImportViewController;
- (_TtC7ChatKit29CKNavBarPersistentMenuManager)chatBotPersistentMenuManager;
- (char)messageEditingViewController:(id)a3 colorTypeForChatItemGuid:(id)a4;
- (double)_currentScrollDelta;
- (double)_currentlyVisibleBannerHeight;
- (double)_expectedAppCardAndEntryViewHeight;
- (double)_keyboardHeightFromLayoutGuide;
- (double)_maxEntryViewHeight;
- (double)balloonMaxWidth;
- (double)bottomInsetPadding;
- (double)gradientBottomPlaceholderHeight;
- (double)minimumBottomInset;
- (double)throwAnimationManagerTopHeaderHeight:(id)a3;
- (double)topInsetPadding;
- (double)transcriptCollectionViewController:(id)a3 targetAlphaForChatItem:(id)a4;
- (double)visibleInputViewHeight;
- (id)_addPollDetailsActionForChatItem:(id)a3 parentChatItem:(id)a4 sourceView:(id)a5;
- (id)_addStickerActionForChatItem:(id)a3 parentChatItem:(id)a4 sourceView:(id)a5;
- (id)_animationPropertiesToUseForUpdateAfterHoldForReason:(id)a3;
- (id)_animationPropertiesToUseInUpdateForReasons:(id)a3 followingHoldForReason:(id)a4;
- (id)_assetReferenceForDisplayedGridChatItem:(id)a3 selectionSnapshot:(id)a4;
- (id)_associatedStickerChatItemInInsertedIndexes:(id)a3 matchingSticker:(id)a4;
- (id)_attributionFromHighlight:(id)a3 forChatGUID:(id)a4;
- (id)_audioMessageThrowBalloonsForSendingMessages:(id)a3 audioMessageSourceRect:(CGRect)a4 contextContainerView:(id)a5 audioRecordingPillViewSnapshot:(id)a6;
- (id)_balloonViewForCellAtIndexPath:(id)a3;
- (id)_chatItemForContextMenuWithConfiguration:(id)a3;
- (id)_chatItemForMediaObject:(id)a3;
- (id)_chatItemForReplyingToChatItem:(id)a3 explicitlySelected:(BOOL)a4;
- (id)_chatItemToEdit;
- (id)_compositionForEmojiSticker:(id)a3 mediaObject:(id)a4;
- (id)_copyActionForChatItem:(id)a3 shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)a4;
- (id)_debugSelectedGuidSummary;
- (id)_defaultTranscriptNavBarAppearance;
- (id)_deleteActionForChatItem:(id)a3 shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)a4;
- (id)_deleteActionsForChatItem:(id)a3;
- (id)_deleteMenuForChatItem:(id)a3;
- (id)_downgradeMessageActionForChatItem:(id)a3;
- (id)_dragInteraction:(id)a3 sessionPropertiesForSession:(id)a4;
- (id)_dragItemsForInteraction:(id)a3;
- (id)_dragItemsFromChatItem:(id)a3 balloonView:(id)a4;
- (id)_dragItemsIfRepositioningForInteraction:(id)a3;
- (id)_emojiDetailsActionForChatItem:(id)a3;
- (id)_exportActionForChatItem:(id)a3 shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)a4;
- (id)_exportActionsForChatItem:(id)a3;
- (id)_exportMenuForChatItem:(id)a3;
- (id)_fillColorForColorType:(char)a3 dynamicFillColor:(IMColorComponents)a4;
- (id)_forwardActionForChatItem:(id)a3;
- (id)_forwardAndCopyActionsForChatItem:(id)a3;
- (id)_forwardAndCopyMenuForChatItem:(id)a3;
- (id)_fullScreenBalloonViewControllerForPhotosGridViewWithChatItem:(id)a3 snapshotView:(id)a4 presentTapbackKeyboardInput:(BOOL)a5;
- (id)_fullscreenEffectsManager;
- (id)_gridViewNavigationControllerForMomentShare:(id)a3 chatItem:(id)a4 tapbackManager:(id)a5;
- (id)_groupConversationContainingSharedURL:(id)a3;
- (id)_highlightActionForChatItem:(id)a3;
- (id)_inlineReplyActionForChatItem:(id)a3;
- (id)_interfaceActionsForChatItem:(id)a3;
- (id)_internalMenuForChatItem:(id)a3;
- (id)_itemProvidersFromDragItems:(id)a3;
- (id)_localizedTitleStringForAggregateAction:(int64_t)a3 numberOfPhotos:(int64_t)a4 numberOfVideos:(int64_t)a5 numberOfOther:(int64_t)a6;
- (id)_makeInternalMenu;
- (id)_makeSnapshotForGlassKeyboardTargetView:(id)a3 afterScreenUpdates:(BOOL)a4;
- (id)_makeThrowBalloonsForSendAnimationWithType:(unint64_t)a3 inContainerView:(id)a4 forSendingMessages:(id)a5 shouldUseQuickReplySourceRect:(BOOL)a6 quickReplySourceRect:(CGRect)a7 quickReplySnapshotView:(id)a8 audioMessageSourceRect:(CGRect)a9 audioRecordingPillViewSnapshot:(id)a10;
- (id)_meContact;
- (id)_mediaAttributionActionForChatItem:(id)a3;
- (id)_menuForChatItem:(id)a3 withParentChatItem:(id)a4 menuAppearance:(int64_t)a5;
- (id)_moreActionForChatItem:(id)a3 configureForCommSafety:(BOOL)a4;
- (id)_navigationControllerToPop;
- (id)_newCollaborationPayloadFromPayload:(id)a3 shareURL:(id)a4 updatedMetadata:(id)a5;
- (id)_newImageConfiguredForNSToolbarWithName:(id)a3 tintColor:(id)a4;
- (id)_originalIndexPathForRepositioningDropSession:(id)a3;
- (id)_parentChatItemForIndexPath:(id)a3;
- (id)_previewViewControllerForAssetReference:(id)a3 dataSource:(id)a4 previewDelegate:(id)a5 previewMode:(int64_t)a6;
- (id)_previewViewControllerForAssetReference:(id)a3 photosViewController:(id)a4 previewMode:(int64_t)a5;
- (id)_previewingViewControllerForHitView:(id)a3 indexPath:(id)a4;
- (id)_previewingViewControllerForLocation:(CGPoint)a3 inSourceView:(id)a4;
- (id)_progressBarHostView;
- (id)_recipientHandle;
- (id)_recipientHandleID;
- (id)_regularGridViewNavigationControllerForChatItem:(id)a3 assetReference:(id)a4 tapbackManager:(id)a5;
- (id)_responsesSubmenuForChatItem:(id)a3 withParentChatItem:(id)a4 menuAppearance:(int64_t)a5;
- (id)_retractionActionForChatItem:(id)a3;
- (id)_saveStickerActionForChatItem:(id)a3 sourceView:(id)a4;
- (id)_selectedBalloonFromTouchForDropSession:(id)a3;
- (id)_sendertHandleID;
- (id)_showTimestampsAction;
- (id)_stickerChatItemForDragItem:(id)a3;
- (id)_stickerDetailsActionForChatItem:(id)a3;
- (id)_stickerDragPreviewForDragItem:(id)a3 defaultPreview:(id)a4;
- (id)_stickerDropProposalForItem:(id)a3 inSession:(id)a4;
- (id)_stickerDropProposalForSession:(id)a3;
- (id)_stickerFromChatItem:(id)a3;
- (id)_tapbackStatusManagerForChatItem:(id)a3;
- (id)_throwBalloonAttributesForSendAnimationWithType:(unint64_t)a3 shouldUseQuickReplySourceRect:(BOOL)a4 quickReplySourceRect:(CGRect)a5 isRunningPhotosPlugin:(BOOL)a6 chatItem:(id)a7 isPhotosExtensionMediaPayload:(BOOL)a8 pluginChatItemCounterInOut:(unint64_t *)a9 containerView:(id)a10 isChatItemFromShelf:(BOOL)a11 isLastChatItem:(BOOL)a12 currentBalloonOriginInOut:(CGPoint *)a13 quickReplySnapshotView:(id)a14;
- (id)_transcriptOverlayTransitionContextForAnchoredMessagePart:(id)a3 threadIdentifier:(id)a4 presentKeyboard:(BOOL)a5;
- (id)_transcriptOverlayTransitionContextForModalPresentation;
- (id)_transcriptStickerCellContainingInteraction:(id)a3;
- (id)_updatedFaceTimeToolbarItemImage;
- (id)_viewControllerForModalPresentationOfViewController:(id)a3;
- (id)_visibleChatItemsToScreenFrameMap;
- (id)_votingViewForChatItem:(id)a3 containingViewController:(id)a4;
- (id)actionManager:(id)a3 tapbackElementsForChatItem:(id)a4;
- (id)activeSendMenuPresentationForChatController:(id)a3;
- (id)activeSendMenuPresentationForChatInputController:(id)a3;
- (id)addContactOptionsMenuWithNicknameUpdate:(id)a3;
- (id)addToExistingContactActionWithNicknameUpdate:(id)a3;
- (id)additionalActivitiesTypesForPreviewController:(id)a3;
- (id)buildTapbackMenuElementsForChatItem:(id)a3 sendHandler:(id)a4 emojiKeyboardHandler:(id)a5 detailsHandler:(id)a6;
- (id)cellIndexPathForDragTarget:(id)a3;
- (id)chatInputTranscriptIdentifier;
- (id)chatItems;
- (id)compositionForSticker:(id)a3 mediaObject:(id)a4;
- (id)consumingBundleIdentifiers;
- (id)contactForNickname:(id)a3;
- (id)contextMenuAccessoryViewsForChatItem:(id)a3 containingViewController:(id)a4;
- (id)contextMenuInteraction:(id)a3 configurationForMenuAtLocation:(CGPoint)a4;
- (id)contextMenuInteractionOutsideOfVisibleBalloonCells;
- (id)contextualCKChatItemsForPreviewController:(id)a3;
- (id)contextualCKChatItemsForTapbackPickerViewController:(id)a3;
- (id)createAlertControllerForAccountComposition:(id)a3 completion:(id)a4;
- (id)createAnalyticsDictionaryForCollaborationForType:(int64_t)a3 sharingURL:(id)a4;
- (id)createBannerForGroupUpdates:(id)a3;
- (id)createGroupUpdateWithType:(int64_t)a3;
- (id)createNewContactActionWithNicknameUpdate:(id)a3;
- (id)currentChatController;
- (id)currentDragPreviewContainer;
- (id)currentLocationDeniedAlert;
- (id)currentNavigationBarBasedOnSizeClass;
- (id)currentTopChatItemForAggregateChatItem:(id)a3;
- (id)dateOfNewestVisibleMessageForMessageHistoryViewController:(id)a3;
- (id)deleteAlertFor:(int64_t)a3;
- (id)detailsViewControllerForInspector;
- (id)dragInteraction:(id)a3 itemsForAddingToSession:(id)a4 withTouchAtPoint:(CGPoint)a5;
- (id)dragInteraction:(id)a3 previewForCancellingItem:(id)a4 withDefault:(id)a5;
- (id)dragInteraction:(id)a3 previewForLiftingItem:(id)a4 session:(id)a5;
- (id)dragPreviewParametersForBalloonView:(id)a3;
- (id)dropInteraction:(id)a3 previewForDroppingItem:(id)a4 withDefault:(id)a5;
- (id)dropInteraction:(id)a3 sessionDidUpdate:(id)a4;
- (id)editingToolbarItems;
- (id)excludedActivityTypesForPreviewController:(id)a3;
- (id)firstUnreadMessageItemGUIDForTranscriptCollectionViewController:(id)a3;
- (id)generatedSummary;
- (id)generativeContext;
- (id)getCurrentContext;
- (id)hashKeyForDragItem:(id)a3;
- (id)innermostToolbarItemIdentifier;
- (id)inputAccessoryView;
- (id)inputAccessoryViewController;
- (id)inputContextHistoryForMessageEntryView:(id)a3;
- (id)inputViewController;
- (id)keyboardLayoutGuideForAppCardPresentation;
- (id)lastOutgoingMessagePartItem;
- (id)launchURLForMode:(id)a3;
- (id)makeNavigationBarContext;
- (id)makeThrowAnimationManagerForComposition:(id)a3;
- (id)mediaObjectsFromComposition:(id)a3;
- (id)messageEditingViewController:(id)a3 colorForChatItemGuid:(id)a4;
- (id)messageEditingViewController:(id)a3 originalMessageCompositionForMessageWithGuid:(id)a4;
- (id)messageEntryViewActiveSendMenuPresentation:(id)a3;
- (id)modalInlineReplyControllerForChatItem:(id)a3;
- (id)nameAndPhotoForContact:(id)a3 andNicknameUpdate:(id)a4 withCompletionBlock:(id)a5;
- (id)nameOnlyForContact:(id)a3 andNicknameUpdate:(id)a4 withCompletionBlock:(id)a5;
- (id)nextMediaObjectToTrimInComposition:(id)a3;
- (id)photoOnlyForContact:(id)a3 andNicknameUpdate:(id)a4 withCompletionBlock:(id)a5;
- (id)photosGridViewController;
- (id)photosViewController:(id)a3 accessoriesForContextMenuInteraction:(id)a4 assetReference:(id)a5;
- (id)photosViewController:(id)a3 configurationForContextMenuInteraction:(id)a4 assetReference:(id)a5;
- (id)photosViewController:(id)a3 contextMenuInteraction:(id)a4 styleForMenuWithConfiguration:(id)a5;
- (id)photosViewController:(id)a3 dragItemProviderForAssetReference:(id)a4;
- (id)pickerAccessoryViewForChatItem:(id)a3 containingViewController:(id)a4;
- (id)preferredFocusEnvironments;
- (id)preferredNavigationBarTitleText;
- (id)preferredViewControllerForModalDetailPresentation;
- (id)presentedControllerDoneButtonItem;
- (id)presentingViewControllerForAlertsFromDetailsAdapter:(id)a3;
- (id)presentingViewControllerForOnboardingController:(id)a3;
- (id)previewActionsForPreviewController:(id)a3;
- (id)previewController:(id)a3 transitionViewForPreviewItem:(id)a4 uncroppedSourceFrame:(CGRect *)a5;
- (id)previewItemsForMediaObject:(id)a3 currentItemIndex:(int64_t *)a4 containsRestoring:(BOOL *)a5;
- (id)previewingContext:(id)a3 viewControllerForLocation:(CGPoint)a4;
- (id)progressBar;
- (id)proofReadingInfoForMessageEditingViewController:(id)a3;
- (id)redesignedDetailsViewForConversation:(id)a3;
- (id)representationForRole:(id)a3 sticker:(id)a4;
- (id)selectedBalloonForTarget:(id)a3;
- (id)selectedBalloonIntersectingRect:(CGRect)a3 chatItemForRepositioning:(id)a4;
- (id)selectedChatItems;
- (id)selectedChatItemsIncludingTapbackedChatItem;
- (id)selectedMessagePartItem;
- (id)setBackgroundActionForChatItem:(id)a3;
- (id)shareMetadataWithDugongTokensForCKShare:(id)a3 shareURL:(id)a4;
- (id)smartEmojiResponses:(id)a3 chatItem:(id)a4;
- (id)splitViewController;
- (id)tapbackMenuElementsForChatItem:(id)a3;
- (id)textDroppableView:(id)a3 proposalForDrop:(id)a4;
- (id)textPasteConfigurationSupporting:(id)a3 combineItemAttributedStrings:(id)a4 forRange:(id)a5;
- (id)textPasteConfigurationSupporting:(id)a3 performPasteOfAttributedString:(id)a4 toRange:(id)a5;
- (id)textSelectionActionWithChatItem:(id)a3;
- (id)throwAnimationContainerSuperview:(id)a3;
- (id)transcriptCollectionViewController:(id)a3 accessoriesForContextMenuWithConfiguration:(id)a4;
- (id)transcriptCollectionViewController:(id)a3 addToContactsMenuForSenderChatItem:(id)a4;
- (id)transcriptCollectionViewController:(id)a3 contextMenuConfigurationForItemAtIndexPath:(id)a4 point:(CGPoint)a5 interaction:(id)a6;
- (id)transcriptCollectionViewController:(id)a3 previewForDismissingContextMenuWithConfiguration:(id)a4;
- (id)transcriptCollectionViewController:(id)a3 previewForHighlightingContextMenuWithConfiguration:(id)a4;
- (id)transcriptCollectionViewController:(id)a3 styleForContextMenuWithConfiguration:(id)a4;
- (id)transcriptCollectionViewControllerOuterEffectPresentingView:(id)a3;
- (id)transcriptContextChatItemProvider;
- (id)updateDataSourceForPluginPayload:(id)a3 forGUID:(id)a4 withCollaborationMetadata:(id)a5 shareURL:(id)a6;
- (id)updateOptionsMenuForContact:(id)a3 withNicknameUpdate:(id)a4 withCompletionBlock:(id)a5;
- (id)viewControllerToPresentFrom;
- (id)viewForDragAndChatInputDropTarget;
- (id)viewToInsertTranscriptCollectionViewBelow;
- (id)virtualView;
- (int)dragManager:(id)a3 dropAreaForDragTarget:(id)a4;
- (int64_t)_determineEntryViewPositioningGuideToActivate;
- (int64_t)_sharingAccessTypeFromOptionsGroups:(id)a3;
- (int64_t)_sharingPermissionTypeFromOptionsGroups:(id)a3;
- (int64_t)currentTranscriptNavigationBarMode;
- (int64_t)currentTranscriptNavigationBarTitleDisplayMode;
- (int64_t)entryViewPositioningGuideForCurrentTapbackPickerPresentation;
- (int64_t)preferredStatusBarStyle;
- (int64_t)sceneInterfaceOrientation;
- (int64_t)transcriptCollectionViewControllerWantsCurrentDesiredIntent:(id)a3;
- (unint64_t)_animationOptionsFromCurve:(int64_t)a3;
- (unint64_t)preferredScreenEdgesDeferringSystemGestures;
- (unint64_t)recipientsCount;
- (unint64_t)supportedInterfaceOrientations;
- (void)__raiseGestureRecognized:(id)a3;
- (void)__setEntryViewFrame:(CGRect)a3;
- (void)_actuallyPresentCollaborationFailureAlertForComposition:(id)a3 sharingURL:(id)a4 error:(id)a5 completion:(id)a6;
- (void)_addAppCardBackgroundView;
- (void)_addDefaultButtonToSharingErrorAlertController:(id)a3 sharingURL:(id)a4 defaultButtonAction:(int64_t)a5 completion:(id)a6;
- (void)_addOtherButtonToSharingErrorAlertController:(id)a3 otherButtonAction:(int64_t)a4 completion:(id)a5;
- (void)_addParticipant:(id)a3 toShareBearURL:(id)a4 containerSetupInfo:(id)a5 completionHandler:(id)a6;
- (void)_addParticipant:(id)a3 toShareURL:(id)a4 forChatGUID:(id)a5 completionHandler:(id)a6;
- (void)_addParticipantToShare:(id)a3 withHandle:(id)a4 toCollaboration:(id)a5 containerSetupInfo:(id)a6 completionHandler:(id)a7;
- (void)_applicationDidBecomeActive:(id)a3;
- (void)_applicationWillResignActive:(id)a3;
- (void)_askToTurnOnReadReceiptsIfNeeded;
- (void)_askToTurnOnSMSRelayIfNeeded;
- (void)_autoAcceptNicknameIfNeeded;
- (void)_backbuttonPressed;
- (void)_beginDeferringSystemNavigationPopGestureForPlusButton;
- (void)_callButtonPressed;
- (void)_callButtonPressedWithVideoEnabled:(BOOL)a3;
- (void)_cancelDeletion:(id)a3;
- (void)_catchUpButtonTapped;
- (void)_clearBalloonViewOverlaysWithAnimation:(BOOL)a3;
- (void)_clearCompositionAndPendingConversation;
- (void)_collaborationMetadataForURL:(id)a3 forChatGUID:(id)a4 completionHandler:(id)a5;
- (void)_commitSticker:(id)a3 toCoordinate:(CGPoint)a4 withInitialSize:(CGSize)a5 dropPreviewTransform:(CGAffineTransform *)a6;
- (void)_commitSticker:(id)a3 toCoordinate:(CGPoint)a4 withInitialSize:(CGSize)a5 dropPreviewTransform:(CGAffineTransform *)a6 isRepositioningSticker:(BOOL)a7 localStickerChatItem:(id)a8;
- (void)_configureCallStateResolverForCurrentConversation;
- (void)_configureEditMessageCommand:(id)a3;
- (void)_configureGridControllerForStackTransition:(id)a3 chatItem:(id)a4;
- (void)_configureMacFaceTimeButtonMenu;
- (void)_confirmReadReceiptSettings;
- (void)_contactsListDidChange;
- (void)_conversationJoinStateDidChange:(id)a3;
- (void)_conversationParticipantsChanged:(id)a3;
- (void)_dataDetectorsDidDismissNotification:(id)a3;
- (void)_dataDetectorsWillPresentNotification:(id)a3;
- (void)_dealloc;
- (void)_deleteSelectedMessages:(id)a3;
- (void)_deleteStickerWithTransferGUID:(id)a3;
- (void)_detailsAdapterWantsDismiss:(id)a3;
- (void)_detailsButtonPressed;
- (void)_didSendCompositionInConversation:(id)a3;
- (void)_didTapNavigationBarAvatarView;
- (void)_didTapNavigationBarToDismissReplies;
- (void)_didTapToPresentNewCompose;
- (void)_dismissBannerView:(id)a3 completion:(id)a4;
- (void)_dismissCollaborationPopoverUI;
- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)a3 withSendAnimation:(BOOL)a4 completion:(id)a5;
- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)a3 withSendAnimation:(BOOL)a4 dismissAppCard:(BOOL)a5 completion:(id)a6;
- (void)_dismissPresentedViewController:(id)a3;
- (void)_dismissSendMenuIfNecessaryForChangedPresentationStyle;
- (void)_dismissSentWithSiriUI;
- (void)_displayNameUpdatedNotification:(id)a3;
- (void)_doneButtonPressed;
- (void)_dragInteraction:(id)a3 prepareForSession:(id)a4 completion:(id)a5;
- (void)_dragInteractionDidCancelLiftWithoutDragging:(id)a3;
- (void)_editCancelButtonPressed;
- (void)_editingToolbarSelectedForward:(id)a3;
- (void)_endDeferringSystemNavigationPopGestureForPlusButton;
- (void)_evaluateMetricsForStagingLocation;
- (void)_fetchCollaborationNotices;
- (void)_fetchRecipientCapabilitiesDeferred;
- (void)_finishSendAnimation;
- (void)_gridViewNavigationControllerForChatItem:(id)a3 assetReference:(id)a4 completionHandler:(id)a5;
- (void)_gridViewNavigationControllerForMomentShareURL:(id)a3 chatItem:(id)a4 tapbackManager:(id)a5 completionHandler:(id)a6;
- (void)_handleAddressBookChangedNotification:(id)a3;
- (void)_handleChatItemDidChange:(id)a3;
- (void)_handleCollaborationNoticesChanged:(id)a3;
- (void)_handleContactStoreBatchLoadCompleteNotification:(id)a3;
- (void)_handleDictationStarted:(id)a3;
- (void)_handleGroupNameChanged:(id)a3;
- (void)_handleGroupPhotoChanged:(id)a3;
- (void)_handleInterworkingStateChanged:(id)a3;
- (void)_handleIsFilteredChange;
- (void)_handleIsUnexpectedlyLoggedOutChanged:(id)a3;
- (void)_handleKeyTransparencyShouldRefresh:(id)a3;
- (void)_handleSetAsBackgroundActionForAssetURL:(id)a3;
- (void)_handleTranscriptPluginChatItem:(id)a3 presentationConfiguration:(id)a4;
- (void)_handleTranslationSettingChanged:(id)a3;
- (void)_handleTranslationSupportChanged:(id)a3;
- (void)_hideCatchUpButtonIfNeededAndRemoveOnCompletion:(BOOL)a3;
- (void)_highlightForShareURL:(id)a3 completionHandler:(id)a4;
- (void)_inheritHiddenKeyboardAppearanceIfNeeded;
- (void)_initializeEffectPicker;
- (void)_invalidateChatItemLayoutIfNecessary:(CGSize)a3;
- (void)_invalidateEntryViewConstraints;
- (void)_isShareBearURL:(id)a3 completionHandler:(id)a4;
- (void)_kickPhotoKit;
- (void)_layoutBannerView:(id)a3;
- (void)_layoutEntryViewSuperview;
- (void)_markAsReadIfNecessary;
- (void)_markVisibleMentionsAsRead;
- (void)_messageReceived:(id)a3;
- (void)_passKitUIDismissed:(id)a3;
- (void)_performResume;
- (void)_prepareForDropAnimationWithItem:(id)a3 preview:(id)a4;
- (void)_presentAlertForDebugSummary:(id)a3;
- (void)_presentAppStoreForAdamID:(id)a3;
- (void)_presentBannerView:(id)a3 placingHandlesUnderScrutiny:(id)a4 completion:(id)a5;
- (void)_presentBrowserForPlugin:(id)a3;
- (void)_presentBrowserOrAppStoreForAdamID:(id)a3 url:(id)a4 identifier:(id)a5 isForSticker:(BOOL)a6;
- (void)_presentCollabAddToMessagesGroupAlert:(id)a3 sendBlock:(id)a4 completionHandler:(id)a5;
- (void)_presentCollabAddToMessagesGroupAlertIfNecessary:(id)a3 collaborationType:(int64_t)a4 sendBlock:(id)a5 completionHandler:(id)a6;
- (void)_presentCollaborationAlertsIfNecessaryForPayload:(id)a3 collaborationType:(int64_t)a4 sendBlock:(id)a5 completionHandler:(id)a6;
- (void)_presentDetailsViewControllerAnimated:(BOOL)a3;
- (void)_presentGridForChatItem:(id)a3 assetReference:(id)a4;
- (void)_presentGridForPendingMomentShareChatItem:(id)a3;
- (void)_presentGridViewNavigationController:(id)a3;
- (void)_presentPreviewViewControllerFromPhotosViewController:(id)a3 assetReference:(id)a4;
- (void)_presentSentWithSiriUI;
- (void)_presentTranscriptSharingBannerIfNecessary;
- (void)_presentViewerForChatItem:(id)a3 assetReference:(id)a4;
- (void)_prewarmBalloonPluginViewCacheCompleted:(id)a3;
- (void)_processCollaborationNoticesForBanner:(id)a3;
- (void)_raiseToListenSettingChanged:(id)a3;
- (void)_reduceTransparencyStatusDidChange;
- (void)_registerRepresentationsInItemProvider:(id)a3 sticker:(id)a4;
- (void)_registerSendProgressDelegate;
- (void)_registerStandardRepresentationsInItemProvider:(id)a3 sticker:(id)a4 effectView:(id)a5;
- (void)_reloadMentionsData;
- (void)_removeParticipant:(id)a3 fromShareBearURL:(id)a4 containerSetupInfo:(id)a5 completionHandler:(id)a6;
- (void)_removeParticipant:(id)a3 fromShareURL:(id)a4 forChatGUID:(id)a5 completionHandler:(id)a6;
- (void)_removeSubsharesAndSendFileProviderComposition:(id)a3 shareURL:(id)a4 completion:(id)a5;
- (void)_replaceBannerView:(id)a3 withNewBannerView:(id)a4 placingHandlesUnderScrutiny:(id)a5 completion:(id)a6;
- (void)_reportSelectedMessages:(id)a3;
- (void)_resetEffectPickerViewController;
- (void)_restoreDraftState;
- (void)_retryGroupPhotoUploadIfNecessary;
- (void)_retryTranscriptBackgroundUploadIfNecessary;
- (void)_satelliteStateChangedNotification:(id)a3;
- (void)_saveDraftState;
- (void)_sendAutomaticallyPlacedSticker:(id)a3 stickerReactionSession:(id)a4 forChatItem:(id)a5 forParentChatItem:(id)a6 stickerFrame:(CGRect)a7 animationCompletionHandler:(id)a8;
- (void)_sendCollaborationCompositionForCloudKit:(id)a3 sharingURL:(id)a4 share:(id)a5 completion:(id)a6;
- (void)_sendCollaborationCompositionForFileProvider:(id)a3 sharingURL:(id)a4 share:(id)a5 completion:(id)a6;
- (void)_sendCommSafetyVerifiedSticker:(id)a3 withMediaObject:(id)a4 composition:(id)a5 parentMessagePartChatItem:(id)a6 messageSummaryInfo:(id)a7;
- (void)_sendCompositionForFileProviderCloudDrive:(id)a3 completion:(id)a4;
- (void)_sendCompositionForNewCloudKitShare:(id)a3 completion:(id)a4;
- (void)_sendNewStickerFromDropSession:(id)a3;
- (void)_sendStickerForDragItem:(id)a3 previewSize:(CGSize)a4 dropLocation:(CGPoint)a5;
- (void)_setBannersHidden:(BOOL)a3;
- (void)_setConversationDeferredSetup;
- (void)_setEntryViewFrame:(CGRect)a3 isContentChange:(BOOL)a4 animated:(BOOL)a5 completionHandler:(id)a6;
- (void)_setOverlayForBalloonViewAtIndexPath:(id)a3 animated:(BOOL)a4;
- (void)_setTitle:(id)a3 animated:(BOOL)a4;
- (void)_setUpEntryViewAppCardLayoutConstraint;
- (void)_setUpEntryViewChatFooterViewLayoutConstraint;
- (void)_setupModernTranscriptNavigationBar;
- (void)_showAutoDonationAlertForAppName:(id)a3 bundleID:(id)a4;
- (void)_showCatchUpButtonIfNeededResumingFromBackground:(BOOL)a3;
- (void)_showMapViewerForMediaObject:(id)a3;
- (void)_showPassbookCardViewForMediaObject:(id)a3;
- (void)_showReaderForAggregateChatItem:(id)a3 balloonView:(id)a4;
- (void)_showTapbackReplyOverlayFromPhotosViewController:(id)a3 assetReference:(id)a4 presentTapbackKeyboardInput:(BOOL)a5;
- (void)_showVCalViewerForMediaObject:(id)a3;
- (void)_showVCardViewerForMediaObject:(id)a3;
- (void)_showWalletOrderImportViewForMediaObject:(id)a3;
- (void)_sizeEffectPickerWindow;
- (void)_stageCurrentLocationInEntryViewForURL:(id)a3;
- (void)_stageFindMyLocationRequest;
- (void)_startSharingForURLForFileProviderCloudDrive:(id)a3 completion:(id)a4;
- (void)_stickerTranscriptScrollDisplayLinkFired;
- (void)_switchedAwayFromEmojiKeyboard:(id)a3;
- (void)_switchedToEmojiKeyboard:(id)a3;
- (void)_textInputModeDidChange:(id)a3;
- (void)_traitsAffectingBarAppearanceDidChange;
- (void)_transferCompleted:(id)a3;
- (void)_transferFileTooLarge:(id)a3;
- (void)_transferFinishedNotification:(id)a3;
- (void)_transferRestoredNotification:(id)a3;
- (void)_transferUpdated:(id)a3;
- (void)_updateAccountRegistrationFailureNotification;
- (void)_updateAndSendCompositionForExistingCloudKitShare:(id)a3 share:(id)a4 attempt:(unint64_t)a5 completion:(id)a6;
- (void)_updateAndSendCompositionForFileProvider:(id)a3 share:(id)a4 sharingURL:(id)a5 completion:(id)a6;
- (void)_updateBannerNotifications;
- (void)_updateCatchUpButtonVisibilityResumingFromBackground:(BOOL)a3;
- (void)_updateEntryViewConstraintsIfNeeded;
- (void)_updateEntryViewFrameIfNeeded:(BOOL)a3;
- (void)_updateEntryViewPasteConfiguration;
- (void)_updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:(id)a3;
- (void)_updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:(CGRect)a3;
- (void)_updateForNewPreferredService;
- (void)_updateIndexPathForFirstUnreadMessage;
- (void)_updateLogoutBannerNotification;
- (void)_updateNavigationButtons;
- (void)_updateNotDefaultTextingAppNotification;
- (void)_updateNotificationBannerOfType:(int64_t)a3 show:(BOOL)a4;
- (void)_updatePhotoGridIfNeeded;
- (void)_updatePollSuggestionAvailability;
- (void)_updateRecipientCapabilities;
- (void)_updateShare:(id)a3 containerSetupInfo:(id)a4 completionHandler:(id)a5;
- (void)_updateSuggestionsBanners;
- (void)_updateTitleAnimated:(BOOL)a3;
- (void)_updateToolbarItems;
- (void)_updateTranscriptOffsetForBannerView;
- (void)_validateAndSendComposition:(id)a3 completion:(id)a4;
- (void)_walletOrderImportControllerDismissed;
- (void)_willSendComposition:(id)a3 inConversation:(id)a4;
- (void)actionCancelIsTappedForChatItem:(id)a3;
- (void)actionManager:(id)a3 copyChatItems:(id)a4;
- (void)actionManager:(id)a3 forwardChatItems:(id)a4;
- (void)actionManager:(id)a3 presentInlineReplyControllerForChatItem:(id)a4;
- (void)actionManager:(id)a3 quickLookChatItem:(id)a4;
- (void)actionManager:(id)a3 tapbackChatItem:(id)a4;
- (void)actionMoreIsTappedForChatItem:(id)a3;
- (void)actionRetractIsTappedForChatItem:(id)a3;
- (void)addAppCardBackgroundViewIfNecessary;
- (void)addHEICImage:(id)a3 completion:(id)a4;
- (void)addOrRemoveEntryViewIfNeeded;
- (void)addPNGImage:(id)a3 completion:(id)a4;
- (void)addParticipant:(id)a3 toCollaboration:(id)a4 forChatGUID:(id)a5 containerSetupInfo:(id)a6 completionHandler:(id)a7;
- (void)addPassesViewControllerDidFinish:(id)a3;
- (void)addSuggestionBanner:(id)a3 animated:(BOOL)a4;
- (void)addToCollaboration:(id)a3;
- (void)animateRevealWithInteractionProgress:(id)a3 forPreviewingAtLocation:(CGPoint)a4 inSourceView:(id)a5 containerView:(id)a6;
- (void)animateSendMenuStatusBarAppearanceUpdate;
- (void)animatedDismissalOfKeyboardSnapshot;
- (void)appCardDidChangeEntryViewAlignmentHeight:(double)a3 animated:(BOOL)a4;
- (void)appCardDidDismiss;
- (void)appCardViewStateDidChange:(BOOL)a3;
- (void)appendCompositionFromItemProviders:(id)a3;
- (void)askToShareScreenFromBuddyMenu:(id)a3;
- (void)associatedStickerCells:(id *)a3 stickerChatItems:(id *)a4 chatItemGUID:(id)a5;
- (void)beginHoldingAutorotationForKey:(id)a3;
- (void)beginThrowAnimationForComposition:(id)a3;
- (void)blockUserFromBuddyMenu:(id)a3;
- (void)button:(id)a3 requestsJoinActiveCallWithVideoEnabled:(BOOL)a4;
- (void)button:(id)a3 requestsStartFaceTimeWithScreenShareType:(unint64_t)a4;
- (void)buttonRequestsLeaveJoinedCall:(id)a3;
- (void)buttonRequestsOpenJoinedCall:(id)a3;
- (void)buttonRequestsStartFaceTimeAudio:(id)a3;
- (void)buttonRequestsStartFaceTimeVideo:(id)a3;
- (void)chatAllowedByScreenTimeChanged:(id)a3;
- (void)chatController:(id)a3 didFinishDismissAnimationForSendMenuViewController:(id)a4;
- (void)chatController:(id)a3 requestPresentSendMenu:(id)a4 currentlyPresentedViewController:(id)a5;
- (void)chatControllerWillBeginResizing;
- (void)chatInputController:(id)a3 didFinishDismissAnimationForSendMenuViewController:(id)a4;
- (void)chatInputController:(id)a3 didPresentStickerPickerForChatItem:(id)a4;
- (void)chatInputController:(id)a3 didRequestAppendToCompositionForPayload:(id)a4;
- (void)chatInputController:(id)a3 requestPresentSendMenu:(id)a4;
- (void)chatInputController:(id)a3 willPresentStickerPickerForChatItem:(id)a4;
- (void)chatInputControllerCancelSelectFunCamera:(id)a3;
- (void)chatInputControllerDidDismissCompactBrowserViewController:(id)a3;
- (void)chatInputControllerDidDismissModalBrowserViewController:(id)a3;
- (void)chatInputControllerDidSelectFunCamera:(id)a3;
- (void)chatInputControllerDidSelectRequestLocation:(id)a3;
- (void)chatInputControllerDidTransitionCollapsed:(id)a3;
- (void)chatInputControllerDidTransitionExpanded:(id)a3;
- (void)chatInputControllerRequestInputViewFocusFromFullscreen:(id)a3;
- (void)chatInputControllerWillDismissModalBrowserViewController:(id)a3;
- (void)chatInputControllerWillPresentModalBrowserViewController:(id)a3;
- (void)chatInputControllerWillSelectFunCamera:(id)a3;
- (void)chatInputControllerWillTransitionCollapsed:(id)a3;
- (void)chatInputControllerWillTransitionExpanded:(id)a3;
- (void)chatInputDidSelectEffectPicker;
- (void)chatInputDidSelectPhotoPicker;
- (void)chatInputDidUpdateInputViewShowingBrowser:(BOOL)a3 entryFieldCollapsed:(BOOL)a4 animated:(BOOL)a5;
- (void)chatInputDidUpdateWithNewInputViewController:(id)a3;
- (void)chatInputSentComposition:(id)a3;
- (void)chatInputWillChangeHeightForCompactPresentation:(double)a3;
- (void)checkSuggestionsForBanner;
- (void)cleanUpDarkEffectStyle;
- (void)cleanupPostComposeTransitionWithKBFrame:(CGRect)a3;
- (void)clearEntryViewPasteConfiguration;
- (void)clearHandlesFromScrutiny:(id)a3;
- (void)clearStagedSensitiveContentUsingContextDictionary:(id)a3;
- (void)clearTranslationCache;
- (void)collaborationNoticeSuggestionWillDismiss:(id)a3;
- (void)communicationLimitsDeleteButtonPressed:(id)a3;
- (void)communicationLimitsPreviewMessageButtonPressed:(id)a3;
- (void)composeButtonClicked:(id)a3;
- (void)computedInsetsDidChange;
- (void)configureFooterIfNeeded;
- (void)configureForCurrentTraitCollection;
- (void)configureMacToolbarProperties;
- (void)configureThrowAnimationManagerForAudioSendAnimation:(id)a3;
- (void)configureWithToolbarController:(id)a3;
- (void)contactPicker:(id)a3 didSelectContact:(id)a4;
- (void)contactViewController:(id)a3 didCompleteWithContact:(id)a4;
- (void)contentInsetDidChangeWithAnimationProperties:(id)a3;
- (void)contentInsetWillChange:(UIEdgeInsets)a3 withAnimationProperties:(id)a4;
- (void)contextMenuInteraction:(id)a3 willDisplayMenuForConfiguration:(id)a4 animator:(id)a5;
- (void)contextMenuInteraction:(id)a3 willEndForConfiguration:(id)a4 animator:(id)a5;
- (void)controller:(id)a3 didCompleteClassificationRequest:(id)a4 withResponse:(id)a5;
- (void)copy:(id)a3;
- (void)createCollaborationFailureAlertForFailedMetadataLoadWithFallback:(BOOL)a3 URL:(id)a4;
- (void)createCollaborationFailureAlertForNotice:(id)a3;
- (void)createContactWithNicknameUpdate:(id)a3;
- (void)dealloc;
- (void)delete:(id)a3;
- (void)deleteMediaObjectAttachmentGUIDs:(id)a3 originalStackCount:(int64_t)a4;
- (void)detailsAdapter:(id)a3 shouldComposeConversationWithRecipientAddresses:(id)a4;
- (void)detailsAdapter:(id)a3 wantsToStageComposition:(id)a4;
- (void)detailsAdapterDidDismiss:(id)a3;
- (void)detailsAdapterWantsToPresentKTContactVerificationUI:(id)a3;
- (void)detailsAdapterWillDismiss:(id)a3;
- (void)detailsCoordinatorDidDismiss:(id)a3;
- (void)detailsCoordinatorDidRequestNavigationToConversationList:(id)a3;
- (void)detailsCoordinatorDidRequestNewCompose:(id)a3 addresses:(id)a4;
- (void)detailsCoordinatorRequestedContactsPopover:(id)a3 sourceView:(id)a4 activeHandle:(id)a5 contact:(id)a6;
- (void)determineIfSendMenuShouldElevateCheckInWithCompletion:(id)a3;
- (void)didDismissPreviewViewController:(id)a3 committing:(BOOL)a4;
- (void)didPresentEditorTranscriptBackground:(BOOL)a3;
- (void)didReceiveMemoryWarning;
- (void)didRequestComposeAudio:(id)a3;
- (void)didRequestComposeText:(id)a3 text:(id)a4;
- (void)didRequestComposeVideo:(id)a3;
- (void)didRequestCreateCalendarEvent:(id)a3;
- (void)didRequestLocationPush:(BOOL)a3;
- (void)didRequestOpenWebView:(id)a3;
- (void)didRequestSendDeviceDetails;
- (void)didRequestSendResponseForAction:(id)a3;
- (void)didSelectTranscriptBackground:(id)a3;
- (void)dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:(id)a3;
- (void)disableRotationWhileRecordingAudioMessage;
- (void)disableSendButtonSpinner;
- (void)dismissBusinessOnboardingIfShowing;
- (void)dismissCollaborationNoticeBannersIfNecessary;
- (void)dismissCollaborationNoticeSuggestion:(id)a3;
- (void)dismissContextMenuInteractionMenu;
- (void)dismissController:(id)a3 withCompletion:(id)a4;
- (void)dismissDetailsControllerAnimated:(BOOL)a3;
- (void)dismissDetailsNavigationControllerWithCompletion:(id)a3;
- (void)dismissDetailsView;
- (void)dismissDetailsViewAndShowConversationListWithCompletion:(id)a3;
- (void)dismissEffectPickerAnimated:(BOOL)a3;
- (void)dismissInlineReplyController:(BOOL)a3;
- (void)dismissInlineReplyIfNeededAndScrollToBottom;
- (void)dismissKeyboard;
- (void)dismissMessageEditingViewController:(BOOL)a3;
- (void)dismissTipIfPresented;
- (void)dismissTranscriptOverlayViewController:(id)a3 presentKeyboard:(BOOL)a4;
- (void)dismissViewControllerAnimated:(BOOL)a3 completion:(id)a4;
- (void)documentPicker:(id)a3 didPickDocumentsAtURLs:(id)a4;
- (void)dragInteraction:(id)a3 item:(id)a4 willAnimateCancelWithAnimator:(id)a5;
- (void)dragInteraction:(id)a3 session:(id)a4 didEndWithOperation:(unint64_t)a5;
- (void)dragInteraction:(id)a3 sessionWillBegin:(id)a4;
- (void)dragManager:(id)a3 draggedItemWithTarget:(id)a4;
- (void)dragManagerDidBeginDragging:(id)a3;
- (void)dragManagerDidEndDragging:(id)a3;
- (void)dropInteraction:(id)a3 concludeDrop:(id)a4;
- (void)dropInteraction:(id)a3 item:(id)a4 willAnimateDropWithAnimator:(id)a5;
- (void)dropInteraction:(id)a3 performDrop:(id)a4;
- (void)dropInteraction:(id)a3 sessionDidEnd:(id)a4;
- (void)dropInteraction:(id)a3 sessionDidEnter:(id)a4;
- (void)editingViewController:(id)a3 didFinishWithConfiguration:(id)a4;
- (void)effectPickerViewController:(id)a3 effectWithIdentifierSelected:(id)a4;
- (void)effectPickerViewControllerClose:(id)a3 keepingSideMountContainer:(BOOL)a4 animated:(BOOL)a5;
- (void)emphasizeMessageWithMessageGUID:(id)a3;
- (void)enableAutomaticTranslationForLanguageCode:(id)a3 userTranslationCode:(id)a4 affectedMessageGUIDs:(id)a5;
- (void)enableRotationAfterRecording;
- (void)enableSendButtonSpinner;
- (void)endHoldingAutorotationForKey:(id)a3;
- (void)enforceSendMenuOrderingInWindowSubviews;
- (void)entryViewContainerViewDidLayoutSubviews:(id)a3;
- (void)escButtonPressed:(id)a3;
- (void)faceTimeAudioFromBuddyMenu:(id)a3;
- (void)faceTimeVideoFromBuddyMenu:(id)a3;
- (void)flagSensitiveMediaObjects:(id)a3;
- (void)forciblyUnloadChatInputController;
- (void)fullScreenBalloonViewController:(id)a3 deleteStickerWithTransferGUID:(id)a4;
- (void)fullScreenBalloonViewController:(id)a3 didAppearAnimated:(BOOL)a4;
- (void)fullScreenBalloonViewController:(id)a3 didTapToSaveSticker:(id)a4;
- (void)fullScreenBalloonViewController:(id)a3 replyButtonPressedForChatItem:(id)a4;
- (void)fullScreenBalloonViewController:(id)a3 sendMessageAcknowledgment:(int64_t)a4 forChatItem:(id)a5;
- (void)fullScreenBalloonViewController:(id)a3 sendMessageHighlight:(BOOL)a4 forChatItem:(id)a5;
- (void)fullScreenBalloonViewController:(id)a3 stickerPackTappedWithAdamID:(id)a4;
- (void)fullScreenBalloonViewController:(id)a3 verticallyScrollTranscriptByAmount:(double)a4 animated:(BOOL)a5 duration:(double)a6 completion:(id)a7;
- (void)fullScreenBalloonViewController:(id)a3 willAppearAnimated:(BOOL)a4;
- (void)fullScreenBalloonViewController:(id)a3 willDisappearWithSendAnimation:(BOOL)a4 duration:(double)a5;
- (void)fullScreenBalloonViewControllerDidDisappear:(id)a3;
- (void)fullScreenBalloonViewControllerHandleDismissTap:(id)a3;
- (void)fullScreenBalloonViewControllerWillReturnToSuggestionsPicker:(id)a3;
- (void)fullScreenBalloonViewControllerWillTransitionToKeyboardInput:(id)a3;
- (void)groupPhotoUpdateBanner:(id)a3 dismissedUpdate:(id)a4;
- (void)handleAutomaticallyPlacedStickerCommSafetySendContext:(id)a3;
- (void)handleContentSizeCategoryDidChangeNotification:(id)a3;
- (void)handleStickerDropConfirmCommSafetySendContext:(id)a3;
- (void)handleStickerTapbackConfirmCommSafetySendContext:(id)a3;
- (void)hideAcknowledgmentsAssociatedWithChatItem:(id)a3;
- (void)hideAssociatedCellsForChatItem:(id)a3;
- (void)hideExistingKeyboardSnapshot;
- (void)hideMediaPickerAnimated:(BOOL)a3 completion:(id)a4;
- (void)imagePickerController:(id)a3 didFinishPickingMediaWithInfo:(id)a4;
- (void)inlineReplyControllerIsAppearing:(id)a3;
- (void)inlineReplyControllerRequestsDismissal:(id)a3 presentKeyboard:(BOOL)a4;
- (void)inputController:(id)a3 willDismissPresentationController:(id)a4;
- (void)inputLanguageDidChange:(id)a3;
- (void)insertInitialCompositionIfNeeded;
- (void)interactionProgress:(id)a3 didEnd:(BOOL)a4;
- (void)interactionProgressDidUpdate:(id)a3;
- (void)inviteToShareScreenFromBuddyMenu:(id)a3;
- (void)keyCommandApplyTextEffect:(id)a3;
- (void)keyCommandApplyTextStyle:(id)a3;
- (void)keyCommandDeleteConversation:(id)a3;
- (void)keyCommandEditMessage:(id)a3;
- (void)keyCommandPage:(id)a3;
- (void)keyCommandPrint:(id)a3;
- (void)keyCommandReply:(id)a3 withModifier:(BOOL)a4;
- (void)keyCommandSelectTapback:(id)a3;
- (void)keyCommandShowDetails:(id)a3;
- (void)keyCommandTapback:(id)a3;
- (void)keyCommandToggleDetails;
- (void)keyCommandToggleTimeStamp:(id)a3;
- (void)keyCommandToggleUnreadState;
- (void)keyTransparencyConversationViewControllerDidComplete:(id)a3;
- (void)keyboardDidChangeFrame:(id)a3;
- (void)keyboardDidHide:(id)a3;
- (void)keyboardDidShow:(id)a3;
- (void)keyboardWillChangeFrame:(id)a3;
- (void)keyboardWillHide:(id)a3;
- (void)keyboardWillShow:(id)a3;
- (void)layoutFooterView;
- (void)layoutLockoutView;
- (void)learnMoreButtonTapped;
- (void)loadChatInputController;
- (void)loadView;
- (void)lockoutViewControllerDidFinishDismissing:(id)a3;
- (void)macRecipientsControllerDidUpdateToFieldSizing:(id)a3;
- (void)mentionsControllerDidFinishAnimation:(id)a3;
- (void)messageEditingViewController:(id)a3 confirmedEditWithComposition:(id)a4;
- (void)messageEditingViewController:(id)a3 didUpdateFrameForBalloonView:(id)a4;
- (void)messageEditingViewControllerIsAnimatingIn:(id)a3;
- (void)messageEditingViewControllerIsAnimatingOut:(id)a3;
- (void)messageEntryView:(id)a3 didInsertPluginPayload:(id)a4;
- (void)messageEntryView:(id)a3 didMoveToWindow:(id)a4;
- (void)messageEntryViewDidBeginEditing:(id)a3;
- (void)messageEntryViewDidBeginEditingNotAlreadyActive:(id)a3;
- (void)messageEntryViewDidChange:(id)a3 isTextChange:(BOOL)a4 isShelfChange:(BOOL)a5 isTranslationChange:(BOOL)a6;
- (void)messageEntryViewDidDismissCustomizationPicker:(id)a3;
- (void)messageEntryViewDidPresentCustomizationPicker:(id)a3;
- (void)messageEntryViewPlusButtonHit:(id)a3;
- (void)messageEntryViewPopulateNextSentMessage:(id)a3;
- (void)messageEntryViewPopulatePreviousSentMessage:(id)a3;
- (void)messageEntryViewRaiseGestureAutoSend:(id)a3;
- (void)messageEntryViewRecordingDidChange:(id)a3;
- (void)messageEntryViewRequestsVisionAppMenu:(id)a3 fromButton:(id)a4;
- (void)messageEntryViewSafeAreaInsetsDidChange:(id)a3;
- (void)messageEntryViewSendButtonHit:(id)a3;
- (void)messageEntryViewSendButtonHitWhileDisabled:(id)a3;
- (void)messageEntryViewSendLaterPluginInfoUpdated:(id)a3;
- (void)messageEntryViewSwipeDownGestureRecognized:(id)a3;
- (void)messageEntryViewTextFormattingAnimationsOptionsPresentationInProgress:(BOOL)a3;
- (void)messageEntryViewWantsGenerativePlaygroundPluginPresented:(id)a3 presentationStyle:(unint64_t)a4;
- (void)messageEntryViewWantsSendLaterPickerPresented:(id)a3;
- (void)messageEntryViewWillDismissCustomizationPicker:(id)a3;
- (void)messageEntryViewWillPresentCustomizationPicker:(id)a3;
- (void)messageHistoryViewController:(id)a3 didSelectDate:(id)a4 withMessages:(id)a5;
- (void)nicknameBannerDidInteractWithOnboardingOffer;
- (void)nicknameBannerView:(id)a3 actionButtonTapped:(id)a4 forUpdates:(id)a5;
- (void)nicknameStoreDidChange:(id)a3;
- (void)nicknameUpdatesViewController:(id)a3 selectedAction:(unint64_t)a4 forNicknameUpdate:(id)a5 sourceView:(id)a6;
- (void)onboardingControllerDidFinish:(id)a3;
- (void)openURLInExtensionContextForMode:(id)a3;
- (void)parentControllerDidBecomeActive;
- (void)performAnimatedJunkRecoveryTransition:(id)a3;
- (void)performPlatformSpecificDetailsPresentation:(id)a3;
- (void)performRelayPhoneCall:(id)a3;
- (void)performResumeDeferredSetup;
- (void)persistentMenuManager:(id)a3 selectedChipAction:(id)a4;
- (void)photoGridDisplayedChatItemChanged:(id)a3;
- (void)photosGridFullScreenBalloonViewController:(id)a3 replyButtonPressedForChatItem:(id)a4;
- (void)photosGridFullScreenBalloonViewController:(id)a3 verticallyScrollTranscriptByAmount:(double)a4 animated:(BOOL)a5 duration:(double)a6 completion:(id)a7;
- (void)photosGridFullScreenBalloonViewControllerHandleDismissTap:(id)a3;
- (void)photosViewController:(id)a3 commitPreviewViewControllerForContextMenuInteraction:(id)a4;
- (void)photosViewController:(id)a3 contextMenuInteraction:(id)a4 willEndForConfiguration:(id)a5 animator:(id)a6;
- (void)photosViewController:(id)a3 didDoubleTapAssetReference:(id)a4;
- (void)prepareForSuspend;
- (void)prepareInputForPreviewPresentation;
- (void)prepareToDismissForSecondInstance;
- (void)presentActionMenuForAccountSelection:(id)a3 completion:(id)a4;
- (void)presentAddContactViewController:(id)a3;
- (void)presentAppStoreForURL:(id)a3 fromSourceApplication:(id)a4;
- (void)presentBlockPersonAlertWithHandle:(id)a3;
- (void)presentCollaborationFailureAlertForComposition:(id)a3 sharingURL:(id)a4 error:(id)a5 completion:(id)a6;
- (void)presentCollaborationPopoverUI;
- (void)presentDetailsViewControllerAnimated:(BOOL)a3;
- (void)presentEmojiDetailsControllerWithIndexPath:(id)a3;
- (void)presentLoadingIndicatorCoverIfNeeded;
- (void)presentNicknameUpdatesViewControllerFromView:(id)a3;
- (void)presentPhotosApp;
- (void)presentRedesignedDetailsViewForConversation:(id)a3;
- (void)presentReplaceCompositionAlertWithConfirmationBlock:(id)a3 cancelBlock:(id)a4;
- (void)presentStickerDetailControllerWithIndexPath:(id)a3;
- (void)presentStickerDetailsViewController:(id)a3 fromChatItem:(id)a4;
- (void)presentTranscriptOverlayViewController:(id)a3;
- (void)presentTranslationLanguagePickerWithCompletionHandler:(id)a3;
- (void)presentTrimControllerForMediaObject:(id)a3;
- (void)presentViewController:(id)a3 animated:(BOOL)a4 completion:(id)a5;
- (void)presentationControllerDidDismiss:(id)a3;
- (void)presentedPreviewControllerDidSelectDismissToGrid;
- (void)presentedPreviewControllerDidSelectNavigateToGrid;
- (void)previewController:(id)a3 didTransitionToState:(int64_t)a4;
- (void)previewController:(id)a3 willTransitionToState:(int64_t)a4;
- (void)previewControllerDidCancelDismiss:(id)a3;
- (void)previewControllerDidDismiss:(id)a3;
- (void)previewControllerWillDismiss:(id)a3;
- (void)previewingContext:(id)a3 commitViewController:(id)a4;
- (void)prewarmFunCamera;
- (void)primeTranscriptWithInitialOffset:(CGPoint)a3 inset:(UIEdgeInsets)a4;
- (void)providerWillBeRemovedFromToolbarController:(id)a3;
- (void)purgeAttachmentsForChat:(id)a3;
- (void)quickLookSelectedChatItem;
- (void)raiseGestureRecognized:(id)a3;
- (void)readerViewControllerWillDismiss:(id)a3;
- (void)receivedBalloonEmphasisNotification:(id)a3;
- (void)recoverableDeleteConversation;
- (void)refreshMacToolbar;
- (void)registerChatForScreenTime:(id)a3;
- (void)registerForTextInputPayloadHandling;
- (void)registerForTextinputPayloadHandlingForCheckInForConversation:(id)a3;
- (void)registerNotifications;
- (void)registerNotificationsForConversation:(id)a3;
- (void)relayPhoneCallFromBuddyMenu:(id)a3;
- (void)reloadEntryViewIfNeeded;
- (void)reloadFooterViewControllerIfNecessary;
- (void)removeAppCardBackgroundViewIfNecessary;
- (void)removeFooterView;
- (void)removeFromCollaboration:(id)a3;
- (void)removeLoadingIndicatorCoverIfNeeded;
- (void)removeLockoutControllerIfNeeded;
- (void)removeParticipant:(id)a3 fromCollaboration:(id)a4 forChatGUID:(id)a5 containerSetupInfo:(id)a6 completionHandler:(id)a7;
- (void)removeSuggestionsBanner:(id)a3 animated:(BOOL)a4;
- (void)replyButtonTappedForMediaObject:(id)a3 previewController:(id)a4;
- (void)requestDismissKeyboardSnapshotForEffectPickerIfNeeded;
- (void)requestDismissKeyboardSnapshotForReason:(unint64_t)a3;
- (void)requestShowKeyboardSnapshotForReason:(unint64_t)a3;
- (void)resignFirstResponderOnEntryViewIfNeeded;
- (void)restoreEntryViewAfterPreview;
- (void)restoreEntryViewPasteConfiguration;
- (void)restoreInputAfterPreviewPresentation;
- (void)restoreInputAfterSearchPresentation;
- (void)retractScheduledChatItem:(id)a3;
- (void)retractScheduledChatItems:(id)a3 fromAggregateChatItem:(id)a4;
- (void)revealExistingKeyboardSnapshot;
- (void)saveButtonTappedForMediaObject:(id)a3 previewController:(id)a4;
- (void)saveSticker:(id)a3 sourceRect:(CGRect)a4;
- (void)saveStickerFromChatItem:(id)a3 pluginSourceView:(id)a4 animateFlyIn:(BOOL)a5;
- (void)saveStickerFromDetailViewController:(id)a3 chatItemContainingSticker:(id)a4;
- (void)saveStickerFromEmojiDetails:(id)a3;
- (void)saveStickerFromTapbackAttributionFlow:(id)a3;
- (void)scrollGeometryIsUpdatingForReasons:(id)a3 followingHoldForReason:(id)a4;
- (void)scrollToMessage:(id)a3 atSpecificMessagePartIndex:(int64_t)a4 highlight:(BOOL)a5 withInlineReplyOverlay:(BOOL)a6 alignedWithView:(id)a7 allowOverScroll:(BOOL)a8;
- (void)scrollToMessageGUID:(id)a3 atSpecificMessagePartIndex:(int64_t)a4 highlight:(BOOL)a5 autoDismissHighlight:(BOOL)a6 withInlineReplyOverlay:(BOOL)a7 alignedWithView:(id)a8 allowOverScroll:(BOOL)a9 scrollPosition:(unint64_t)a10;
- (void)scrollToMessageWith:(id)a3 in:(id)a4 withInlineReplyOverlay:(BOOL)a5;
- (void)scrollTranscriptPageUpDirection:(BOOL)a3 toBounds:(BOOL)a4;
- (void)scrollTranscriptToAlignWithMessageEditingBalloonView;
- (void)selectAccountAndSendComposition:(id)a3 completion:(id)a4;
- (void)selectAllForActionManager:(id)a3;
- (void)selectContact;
- (void)selectedQuickLook:(id)a3;
- (void)sendAnalyticsForElapsedSendTimeForType:(int64_t)a3 sharingURL:(id)a4 timeInterval:(double)a5;
- (void)sendAnimationManagerDidStopAnimation:(id)a3 context:(id)a4;
- (void)sendAnimationManagerWillStartAnimation:(id)a3 context:(id)a4;
- (void)sendAutomaticallyPlacedSticker:(id)a3 stickerReactionSession:(id)a4 forChatItem:(id)a5 forParentChatItem:(id)a6 stickerFrame:(CGRect)a7 animationCompletionHandler:(id)a8;
- (void)sendCollaborationCompositionAndSetSendingState:(id)a3;
- (void)sendComposition:(id)a3;
- (void)sendComposition:(id)a3 animations:(id)a4;
- (void)sendCompositionForCloudKit:(id)a3 completion:(id)a4;
- (void)sendCompositionForCollaboration:(id)a3 collaborationType:(int64_t)a4 completion:(id)a5;
- (void)sendCompositionForFileProvider:(id)a3 completion:(id)a4;
- (void)sendCompositionForPendingCollaboration:(id)a3 completion:(id)a4;
- (void)sendCompositionIfAllowed:(id)a3;
- (void)sendCompositionWithoutThrow:(id)a3;
- (void)sendCustomAcknowledgementMessage:(id)a3;
- (void)sendEmailFromBuddyMenu:(id)a3;
- (void)sendFileFromBuddyMenu:(id)a3;
- (void)sendMessageAcknowledgment:(int64_t)a3 chatItem:(id)a4 previewController:(id)a5;
- (void)sendSelectedSuggestedReply:(id)a3 messageGUID:(id)a4;
- (void)sendSticker:(id)a3 toCoordinate:(CGPoint)a4 withInitialSize:(CGSize)a5 dropPreviewTransform:(CGAffineTransform *)a6 isRepositioningSticker:(BOOL)a7 localStickerChatItem:(id)a8;
- (void)sendSticker:(id)a3 withDragTarget:(id)a4 draggedSticker:(id)a5;
- (void)sendSticker:(id)a3 withMediaObject:(id)a4 composition:(id)a5 parentMessagePartChatItem:(id)a6 messageSummaryInfo:(id)a7;
- (void)setCollaborationNoticeSuggestions:(id)a3;
- (void)setCollectionViewController:(id)a3;
- (void)setComposition:(id)a3;
- (void)setConversation:(id)a3 forceReload:(BOOL)a4;
- (void)setCustomAcknowledgementConversation:(id)a3;
- (void)setEditing:(BOOL)a3 animated:(BOOL)a4;
- (void)setEffectPickerIsPresented:(BOOL)a3;
- (void)setEntryView:(id)a3;
- (void)setEntryViewOverrideForNewCompose:(id)a3;
- (void)setIgnoresAutomaticScrollsTowardBottom:(BOOL)a3;
- (void)setKeyboardAlpha:(double)a3;
- (void)setLocalUserIsComposing:(BOOL)a3 withPluginBundleID:(id)a4 typingIndicatorData:(id)a5;
- (void)setPickerContainerAccessoryView:(id)a3;
- (void)setSendingCompositionBackgroundTask:(unint64_t)a3;
- (void)setSendingMessage:(BOOL)a3;
- (void)setShouldShowAudioButtonInEntryView:(BOOL)a3;
- (void)setTargetFirstResponder:(int64_t)a3;
- (void)setUpEntryViewLayoutConstraintsIfNecessary;
- (void)setUpFilteringButtonTapped;
- (void)setUpStyleForDarkEffect;
- (void)setupClickyOrbForConversation:(id)a3;
- (void)setupScrollingForKeyboardInteraction;
- (void)setupStateForLaunchAudio;
- (void)setupStateForLaunchPluginWithBundleID:(id)a3 pluginPayload:(id)a4;
- (void)setupStateForLaunchURL:(id)a3;
- (void)setupThrowBalloonsInSendAnimationContext:(id)a3;
- (void)showAcknowledgmentsAssociatedWithChatItem:(id)a3;
- (void)showAlternateViewerForMediaObject:(id)a3;
- (void)showAssociatedCellsForChatItem:(id)a3 animated:(BOOL)a4 completion:(id)a5;
- (void)showBannerForGroupUpdate:(id)a3;
- (void)showCheckInTips:(id)a3;
- (void)showContactCardFromBuddyMenu:(id)a3;
- (void)showEffectPicker;
- (void)showFullScreenBalloonFocusForChatItem:(id)a3;
- (void)showInlineReplyControllerForChatItem:(id)a3 presentKeyboard:(BOOL)a4;
- (void)showInlineReplyControllerForChatItem:(id)a3 presentKeyboard:(BOOL)a4 replyTransitionProperties:(id)a5;
- (void)showKeyboard;
- (void)showMediaPicker:(id)a3 animated:(BOOL)a4;
- (void)showMessageEditingViewControllerForChatItem:(id)a3 presentKeyboard:(BOOL)a4;
- (void)showMessageHistoryViewController;
- (void)showModalInlineReplyControllerForChatItem:(id)a3 fromViewController:(id)a4;
- (void)showOrHideAcceptedContactBannerIfNeeded;
- (void)showPayloadValidationAlertWithDescription:(id)a3;
- (void)showSMSReportSpamExtensionControllerForMessages:(id)a3;
- (void)showScreenTimeShieldIfNeeded;
- (void)showTranslationTips:(id)a3;
- (void)showUpdatePromptForNicknameUpdate:(id)a3 sourceView:(id)a4 completionBlock:(id)a5;
- (void)showViewerForMediaObject:(id)a3;
- (void)spacePressed:(id)a3;
- (void)stageAssetArchive:(id)a3 skipShelf:(BOOL)a4 completionHandler:(id)a5;
- (void)stageCurrentLocationComposition;
- (void)stageFindMyCompositionWithShareType:(int64_t)a3;
- (void)stageLocationRequestComposition;
- (void)stageSelectedSuggestedReply:(id)a3;
- (void)startCommitPayload:(id)a3 forConversation:(id)a4;
- (void)startDeferredEditingPayload:(id)a3 forConversation:(id)a4;
- (void)startDownloadFor:(NSArray *)a3 completionHandler:(id)a4;
- (void)startDownloadingTranslationAssetsForLanguageCodes:(NSArray *)a3 completion:(id)a4;
- (void)startTrimmingMediaObjectsInComposition:(id)a3;
- (void)stickerDetailViewController:(id)a3 selectedStickerPackWithAdamID:(id)a4;
- (void)stopForcingOrientation;
- (void)suggestionPresenterWantsToHideBanner:(id)a3;
- (void)suggestionPresenterWantsToShowBanner:(id)a3;
- (void)tapGestureRecognized:(id)a3;
- (void)tapbackPickerBalloonParentView:(id)a3 didInsertTapback:(id)a4;
- (void)tapbackPickerBalloonParentView:(id)a3 requestedPresentPlugin:(id)a4 payloadID:(id)a5;
- (void)tapbackPickerBalloonParentViewRequestedAppCardDismiss:(id)a3;
- (void)tapbackPickerViewController:(id)a3 didDeselectTapback:(id)a4;
- (void)tapbackPickerViewController:(id)a3 didSelectTapback:(id)a4;
- (void)tapbackPileViewTapped:(id)a3 asset:(id)a4;
- (void)testEmphasis;
- (void)textDroppableView:(id)a3 dropSessionDidEnd:(id)a4;
- (void)textDroppableView:(id)a3 dropSessionDidEnter:(id)a4;
- (void)textPasteConfigurationSupporting:(id)a3 transformPasteItem:(id)a4;
- (void)throwAnimationManager:(id)a3 canNowSendMessages:(id)a4;
- (void)throwAnimationManagerPrepareForThrowAnimation:(id)a3 context:(id)a4;
- (void)tipManagerDidDismissTranscriptBannerTip;
- (void)tipManagerDidShowTranscriptBannerTip;
- (void)toggleDetailsFromConversationsMenu:(id)a3;
- (void)toggleHideAlerts:(id)a3;
- (void)toggleUnreadState:(id)a3;
- (void)traitCollectionDidChange:(id)a3;
- (void)transcriptCollectionViewController:(id)a3 backgroundScrollVelocityThresholdChanged:(BOOL)a4;
- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 didRequestPresentationStyle:(unint64_t)a5 forChatItem:(id)a6 allowAllStyles:(BOOL)a7;
- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 didRequestReaderViewControllerForChatItem:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 doubleTappedItemAtIndexPath:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 selectedItemAtIndexPath:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 tappedForChatItem:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 balloonViewDidRequestStartEditingPayload:(id)a4 forPlugin:(id)a5 allowAllCommits:(BOOL)a6 completionHandler:(id)a7;
- (void)transcriptCollectionViewController:(id)a3 balloonViewWillDismissEditMenu:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 didEndImpactEffectAnimationWithSendAnimationContext:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 didInsertChatItems:(id)a4 associatedChatItems:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 didScroll:(CGPoint)a4;
- (void)transcriptCollectionViewController:(id)a3 didTapAttributionButtonForChatItem:(id)a4 parentIndexPath:(id)a5 sender:(id)a6;
- (void)transcriptCollectionViewController:(id)a3 didTapAttributionLinkTextForChatItem:(id)a4 atIndexPath:(id)a5 sender:(id)a6;
- (void)transcriptCollectionViewController:(id)a3 didTapIntroductionsButton:(id)a4 ofType:(int64_t)a5;
- (void)transcriptCollectionViewController:(id)a3 didTapPluginStatusButtonForChatItem:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 didTapReplyCountStatusButtonForChatItem:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 didTapTruncatedCaptionForRichCard:(id)a4 onBalloonView:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 saveLastTappedChatItemWithDataDetector:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 selectedChipAction:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 selectedPollAddChoice:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 sendQuickReplyComposition:(id)a4 withSourceView:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 unknownSenderButtonTapped:(id)a4 forChatItem:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 willBeginImpactEffectAnimationWithSendAnimationContext:(id)a4;
- (void)transcriptCollectionViewController:(id)a3 willDisplayBalloonForGUID:(id)a4 withIndexPath:(id)a5 withOriginY:(double)a6;
- (void)transcriptCollectionViewController:(id)a3 willDisplayContextMenuWithConfiguration:(id)a4 animator:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 willEndContextMenuInteractionWithConfiguration:(id)a4 animator:(id)a5;
- (void)transcriptCollectionViewController:(id)a3 willPerformPreviewActionForMenuWithConfiguration:(id)a4 animator:(id)a5;
- (void)transcriptCollectionViewControllerDidChangeAssociatedChatItem:(id)a3 chatItemDiff:(id)a4;
- (void)transcriptCollectionViewControllerDidInset:(id)a3;
- (void)transcriptCollectionViewControllerDidSetChatItems:(id)a3;
- (void)transcriptCollectionViewControllerDidUpdateTranscriptChatItems:(id)a3;
- (void)transcriptCollectionViewControllerDisplaySMSSpamReporting:(id)a3;
- (void)transcriptCollectionViewControllerNeedsChatItemLayoutInvalidation:(id)a3;
- (void)transcriptCollectionViewControllerPerformBatchUpdateCompleted:(id)a3;
- (void)transcriptCollectionViewControllerWillDisplayLastBalloon:(id)a3;
- (void)transcriptCollectionViewControllerWillUpdateTranscriptChatItems:(id)a3;
- (void)transcriptNavigationBar:(id)a3 didTapToPerformAction:(int64_t)a4;
- (void)transcriptOverlayViewController:(id)a3 visibleGUIDsDidChange:(id)a4;
- (void)transcriptOverlayViewControllerDidAnimateIn:(id)a3;
- (void)transcriptOverlayViewControllerDidAnimateOut:(id)a3;
- (void)transcriptOverlayViewControllerIsAnimatingIn:(id)a3;
- (void)transcriptOverlayViewControllerIsAnimatingOut:(id)a3;
- (void)transcriptOverlayViewControllerWillAnimateIn:(id)a3;
- (void)transcriptOverlayViewControllerWillAnimateOut:(id)a3;
- (void)transcriptScrollWithConfiguration:(id)a3;
- (void)transcriptSharingBannerWillDismiss:(id)a3;
- (void)transcriptStopSharingButtonTapped:(id)a3;
- (void)translateConversationForChatItem:(id)a3;
- (void)trimController:(id)a3 didFinishTrimmingMediaObject:(id)a4 withReplacementMediaObject:(id)a5;
- (void)trimControllerDidCancel:(id)a3;
- (void)unregisterChatForScreenTime:(id)a3;
- (void)updateActiveEntryViewPositioningGuide;
- (void)updateChatControllerForRecoveredJunkConversation;
- (void)updateChatItemBalloonViewAndStickerViews:(id)a3 hidden:(BOOL)a4;
- (void)updateCompositionInEntryViewWithComposition:(id)a3;
- (void)updateContact:(id)a3 withHandle:(id)a4;
- (void)updateContact:(id)a3 withNicknameUpdate:(id)a4 updateType:(unint64_t)a5 addHandleToContact:(BOOL)a6 presentationMode:(unint64_t)a7;
- (void)updateContactQuietlyForNicknameUpdate:(id)a3 updateType:(unint64_t)a4;
- (void)updateEmphasis;
- (void)updateEntryViewHeightWithContentChange:(BOOL)a3 animated:(BOOL)a4 completionHandler:(id)a5;
- (void)updateFTButton;
- (void)updateFoundInSuggestionPresenter;
- (void)updateInterfaceSelectedAction:(unint64_t)a3 forUpdate:(id)a4;
- (void)updateNumberOfUnknownChatsOpenedIfNeeded;
- (void)updateQLPreviewControllerBarButtonItemsIfVisible;
- (void)updateQLPreviewControllerIfVisible;
- (void)updateRaiseGesture;
- (void)updateScreenTimeShieldIfNeededForChat:(id)a3;
- (void)updateSendMenuShouldElevateCheckIn;
- (void)updateSendProgress:(double)a3 progressColor:(id)a4 animation:(id)a5;
- (void)updateStyleForCurrentEffect;
- (void)updateSupportedInterfaceOrientations:(unint64_t)a3;
- (void)updateTyping;
- (void)validateCommand:(id)a3;
- (void)viewDidAppear:(BOOL)a3;
- (void)viewDidAppearDeferredSetup;
- (void)viewDidDisappear:(BOOL)a3;
- (void)viewDidLayoutSubviews;
- (void)viewDidLayoutSubviewsForTranscriptCollectionViewController:(id)a3;
- (void)viewDidLoad;
- (void)viewDidMoveToWindow:(id)a3 shouldAppearOrDisappear:(BOOL)a4;
- (void)viewSafeAreaInsetsDidChange;
- (void)viewWillAppear:(BOOL)a3;
- (void)viewWillDisappear:(BOOL)a3;
- (void)viewWillLayoutSubviews;
- (void)viewWillTransitionToSize:(CGSize)a3 withTransitionCoordinator:(id)a4;
- (void)willDismissFunCamera:(id)a3;
- (void)willMoveToParentViewController:(id)a3;
- (void)willPresentPreviewViewController:(id)a3 forLocation:(CGPoint)a4 inSourceView:(id)a5;
- (void)windowDidResignKey:(id)a3;
@end

@implementation CKChatController

- (BOOL)prefersStatusBarHidden
{
  v3 = [(CKCoreChatController *)self inputController];
  v4 = [v3 shouldSuppressStatusBarForHandwriting];

  if (v4)
  {
    return 1;
  }

  v5 = [(CKCoreChatController *)self inputController];
  v6 = [v5 shouldSuppressStatusBarForSendMenu];

  if (v6)
  {
    return 1;
  }

  v8.receiver = self;
  v8.super_class = CKChatController;
  return [(CKChatController *)&v8 prefersStatusBarHidden];
}

- (id)inputViewController
{
  if ([(CKChatController *)self isShowingPreview])
  {
    v3 = 0;
  }

  else
  {
    v4 = [(CKCoreChatController *)self inputController];
    v3 = [v4 inputViewController];
  }

  return v3;
}

- (int64_t)preferredStatusBarStyle
{
  v2 = [(CKCoreChatController *)self inputController];
  v3 = [v2 statusBarStyleViewController];

  if (v3)
  {
    v4 = [v3 preferredStatusBarStyle];
  }

  else
  {
    v5 = +[CKUIBehavior sharedBehaviors];
    v6 = [v5 theme];
    v4 = [v6 statusBarStyle];
  }

  return v4;
}

- (id)inputAccessoryView
{
  v57 = *MEMORY[0x1E69E9840];
  if (-[CKChatController inputAccessoryViewControllerEnabled](self, "inputAccessoryViewControllerEnabled") || -[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView") || (+[CKUIBehavior sharedBehaviors](CKUIBehavior, "sharedBehaviors"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 isEntryViewInputAccessory], v3, !v4))
  {
    v5 = 0;
  }

  else
  {
    if ([(CKChatController *)self shouldShowEntryView])
    {
      v5 = [(CKChatController *)self entryView];
    }

    else
    {
      v5 = 0;
    }

    v7 = [(CKCoreChatController *)self inputController];
    [v7 setEntryView:v5];

    if ([(CKChatController *)self appManagerDisplayedInMessages])
    {
      v8 = [(CKChatController *)self presentedViewController];
      v9 = [v8 isBeingDismissed];

      if ((v9 & 1) == 0)
      {
        if (IMOSLoggingEnabled())
        {
          v10 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAV, -appManagerDisplayedInMessages is YES", buf, 2u);
          }
        }

        v5 = 0;
      }
    }

    if ([(CKChatController *)self appModalIsDisplayed])
    {
      v11 = [(CKCoreChatController *)self inputController];
      v12 = [v11 isDismissingAppModal];

      if ((v12 & 1) == 0)
      {
        if (IMOSLoggingEnabled())
        {
          v13 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAV, -appModalIsDisplayed is YES", buf, 2u);
          }
        }

        v5 = 0;
      }
    }

    v14 = [(CKChatController *)self presentedViewController];
    v15 = v14;
    if (v14 && ([v14 isBeingDismissed] & 1) == 0)
    {
      if (IMOSLoggingEnabled())
      {
        v16 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAV, presenting view controller", buf, 2u);
        }
      }

      v5 = 0;
    }

    if (IMOSLoggingEnabled())
    {
      v17 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = objc_opt_class();
        v38 = NSStringFromClass(v18);
        [v5 alpha];
        v20 = v19;
        [v5 frame];
        v36 = NSStringFromCGRect(v59);
        v34 = [v5 window];
        v21 = objc_opt_class();
        v35 = NSStringFromClass(v21);
        v37 = [v5 window];
        v33 = [(CKChatController *)self view];
        v32 = [v33 window];
        v22 = [v32 firstResponder];
        v23 = objc_opt_class();
        v24 = NSStringFromClass(v23);
        v25 = [(CKChatController *)self view];
        v26 = [v25 window];
        v27 = [v26 firstResponder];
        v28 = [(CKChatController *)self view];
        v29 = [v28 window];
        v30 = [v29 isKeyWindow];
        v31 = @"NO";
        *buf = 138414338;
        v40 = v38;
        v41 = 2048;
        if (v30)
        {
          v31 = @"YES";
        }

        v42 = v5;
        v43 = 2048;
        v44 = v20;
        v45 = 2112;
        v46 = v36;
        v47 = 2112;
        v48 = v35;
        v49 = 2048;
        v50 = v37;
        v51 = 2112;
        v52 = v24;
        v53 = 2048;
        v54 = v27;
        v55 = 2112;
        v56 = v31;
        _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "EntryView Debug - IAV %@ <%p> Alpha %f Frame %@ IAV Window %@ <%p>  Current FR %@ <%p> View window is key - %@", buf, 0x5Cu);
      }
    }
  }

  return v5;
}

- (BOOL)inputAccessoryViewControllerEnabled
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isTranscriptSharingEnabled];

  if (v4 && (-[CKCoreChatController conversation](self, "conversation"), v5 = objc_claimAutoreleasedReturnValue(), [v5 chat], v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(v6, "isStewieSharingChat"), v6, v5, (v7 & 1) != 0))
  {
    LOBYTE(v8) = 0;
  }

  else
  {
    v8 = CKInputAccessoryViewControllerEnabled();
    if (v8)
    {
      LOBYTE(v8) = ![(CKCoreChatController *)self isShowingLockoutView];
    }
  }

  return v8;
}

- (double)_maxEntryViewHeight
{
  v92 = *MEMORY[0x1E69E9840];
  frozenEntryViewHeightDuringDismissAnimation = self->_frozenEntryViewHeightDuringDismissAnimation;
  if (!frozenEntryViewHeightDuringDismissAnimation)
  {
    v5 = [(CKChatController *)self entryView];
    v6 = [(CKChatController *)self view];
    [v6 bounds];
    v80 = v8;
    v81 = v7;
    rect = v9;
    v11 = v10;

    [(CKScrollViewController *)self navigationBarInsets];
    v13 = v12;
    [(CKChatController *)self _entryViewTopInsetPadding];
    v15 = v14;
    if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v94.origin.y = v80;
        v94.origin.x = v81;
        v94.size.width = rect;
        v94.size.height = v11;
        NSStringFromCGRect(v94);
        v17 = COERCE_DOUBLE(objc_claimAutoreleasedReturnValue());
        [(CKScrollViewController *)self navigationBarInsets];
        v19 = v18;
        [(CKChatController *)self _entryViewTopInsetPadding];
        *buf = 138412802;
        v83 = v17;
        v84 = 2048;
        v85 = v19;
        v86 = 2048;
        v87 = v20;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "entryView: Calculating max entry view height. Bounds: %@, navbar top inset: %f, entryView top inset: %f", buf, 0x20u);
      }
    }

    v21 = [(CKChatController *)self catchUpButton];

    v22 = v13 + v15;
    if (v21)
    {
      v23 = [(CKChatController *)self catchUpButton];
      [v23 frame];
      v25 = v24;
      v26 = [(CKChatController *)self catchUpButton];
      [v26 frame];
      v28 = v27;

      if (v22 < v25 + v28)
      {
        v22 = v25 + v28;
      }
    }

    v29 = [(CKChatController *)self view];
    [v29 bounds];
    Width = CGRectGetWidth(v95);

    v31 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v32 = [v31 isModernSplitViewControllerEnabled];

    if (v32)
    {
      v33 = [(CKChatController *)self view];
      [v33 safeAreaInsets];
      v35 = v34;
      v37 = v36;

      Width = Width - (v35 + v37);
    }

    [v5 sizeThatFits:{Width, 1.79769313e308}];
    v39 = v38;
    v40 = [v5 window];
    v41 = v40 == 0;

    if (v41)
    {
      if (IMOSLoggingEnabled())
      {
        v51 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = v39;
          _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "entryView: Entry does not have a window, return maxEntryViewHeight: %f", buf, 0xCu);
        }

        goto LABEL_58;
      }

      goto LABEL_67;
    }

    v42 = [(CKChatController *)self view];
    if ([v5 isDescendantOfView:v42])
    {
      [v5 frame];
      v44 = v43;
      v46 = v45;
      v48 = v47;
      v50 = v49;
    }

    else
    {
      [v5 bounds];
      v53 = v52;
      v55 = v54;
      v57 = v56;
      v59 = v58;
      v60 = [(CKChatController *)self view];
      [v5 convertRect:v60 toView:{v53, v55, v57, v59}];
      v44 = v61;
      v46 = v62;
      v48 = v63;
      v50 = v64;
    }

    if (v46 == 0.0)
    {
      v96.origin.y = v80;
      v96.origin.x = v81;
      v96.size.width = rect;
      v96.size.height = v11;
      MaxY = CGRectGetMaxY(v96);
      if (IMOSLoggingEnabled())
      {
        v66 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
        {
          v97.origin.x = v44;
          v97.origin.y = v46;
          v97.size.width = v48;
          v97.size.height = v50;
          NSStringFromCGRect(v97);
          v67 = COERCE_DOUBLE(objc_claimAutoreleasedReturnValue());
          v98.origin.y = v80;
          v98.origin.x = v81;
          v98.size.width = rect;
          v98.size.height = v11;
          v68 = CGRectGetMaxY(v98);
          *buf = 138412546;
          v83 = v67;
          v84 = 2048;
          v85 = v68;
          _os_log_impl(&dword_19020E000, v66, OS_LOG_TYPE_INFO, "entryView: entryViewCurrentBoundsInViewControllerCoordinates.origin.y (%@) is <= 0, setting entryViewCurrentMaxY to max y: %f", buf, 0x16u);
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v69 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
        {
          v99.origin.x = v44;
          v99.origin.y = v46;
          v99.size.width = v48;
          v99.size.height = v50;
          NSStringFromCGRect(v99);
          v70 = COERCE_DOUBLE(objc_claimAutoreleasedReturnValue());
          v100.origin.x = v44;
          v100.origin.y = v46;
          v100.size.width = v48;
          v100.size.height = v50;
          v71 = CGRectGetMaxY(v100);
          *buf = 138412546;
          v83 = v70;
          v84 = 2048;
          v85 = v71;
          _os_log_impl(&dword_19020E000, v69, OS_LOG_TYPE_INFO, "entryView: entryViewCurrentBoundsInViewControllerCoordinates.origin.y (%@) is not 0, setting entryViewCurrentMaxY to max y: %f", buf, 0x16u);
        }
      }

      v101.origin.x = v44;
      v101.origin.y = v46;
      v101.size.width = v48;
      v101.size.height = v50;
      MaxY = CGRectGetMaxY(v101);
    }

    v72 = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
    v73 = MaxY - v39;
    if (MaxY - v39 > v22)
    {
      if (IMOSLoggingEnabled())
      {
        v51 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = v39;
          _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "entryView: There is still room for the entry view to expand, return maxEntryViewHeight: %f", buf, 0xCu);
        }

LABEL_58:

        goto LABEL_67;
      }

      goto LABEL_67;
    }

    v74 = MaxY - v22;
    if (v73 < 0.0)
    {
      if (IMOSLoggingEnabled())
      {
        v75 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
        {
          if (v74 >= v39)
          {
            v76 = v39;
          }

          else
          {
            v76 = MaxY - v22;
          }

          [(CKScrollViewController *)self keyboardFrameInViewCoordinates];
          v77 = NSStringFromCGRect(v102);
          *buf = 134219010;
          v83 = v73;
          v84 = 2048;
          v85 = v74;
          v86 = 2048;
          v87 = v39;
          v88 = 2048;
          v89 = v76;
          v90 = 2112;
          v91 = v77;
          _os_log_impl(&dword_19020E000, v75, OS_LOG_TYPE_INFO, "entryView: entryViewOriginYAtFittingSize(%f) is negative, return min of availableHeight(%f) and entryViewFittingHeight(%f): %f. KeyboardFrameInViewCoordinates: %@", buf, 0x34u);
        }
      }

      if (v74 >= 0.0)
      {
        if (v74 < v39)
        {
          v39 = v74;
        }

        goto LABEL_67;
      }

      if (IMOSLoggingEnabled())
      {
        v51 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          *buf = 134218240;
          v83 = v74;
          v84 = 2048;
          v85 = v39;
          _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "entryView: availableHeight(%f) is negative, returning entryViewFittingHeight(%f)", buf, 0x16u);
        }

        goto LABEL_58;
      }

LABEL_67:

      return v39;
    }

    if (v72)
    {
      if (IMOSLoggingEnabled())
      {
        v78 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = MaxY - v22;
          _os_log_impl(&dword_19020E000, v78, OS_LOG_TYPE_INFO, "entryView: Is in hardware keyboard mode, return availableHeight: %f", buf, 0xCu);
        }

LABEL_65:
      }
    }

    else
    {
      if (v74 < 0.0)
      {
        v51 = IMLogHandleForCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
        {
          [CKChatController _maxEntryViewHeight];
        }

        goto LABEL_58;
      }

      if (IMOSLoggingEnabled())
      {
        v78 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = MaxY - v22;
          _os_log_impl(&dword_19020E000, v78, OS_LOG_TYPE_INFO, "entryView: Found max height in view controller, return entryViewMaxHeightInViewController: %f", buf, 0xCu);
        }

        goto LABEL_65;
      }
    }

    v39 = MaxY - v22;
    goto LABEL_67;
  }

  [(NSNumber *)frozenEntryViewHeightDuringDismissAnimation doubleValue];
  return result;
}

- (CKMessageEntryView)entryView
{
  v2 = [(CKChatController *)self entryViewController];
  v3 = [v2 entryView];

  return v3;
}

- (CKChatControllerSendMenuDelegate)sendMenuDelegate
{
  WeakRetained = objc_loadWeakRetained(&self->_sendMenuDelegate);

  return WeakRetained;
}

- (BOOL)isUsingVisibleInputViewHeightWhenUpdatingScrollGeometry
{
  v2 = [(CKChatController *)self entryViewContainerView];
  v3 = [v2 entryViewStuckToChatControllerBottomLayoutConstraint];
  v4 = [v3 isActive];

  return v4 ^ 1;
}

- (double)visibleInputViewHeight
{
  if ([(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint isActive])
  {
    entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;

    [(NSLayoutConstraint *)entryViewAppCardLayoutConstraint constant];
  }

  else
  {
    v5 = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
    v6 = [(CKChatController *)self collectionView];
    v7 = [v6 isDragging];

    v8 = [(CKChatController *)self view];
    v9 = [v8 window];
    v10 = [v9 windowScene];
    v11 = [v10 _enhancedWindowingEnabled];

    if (v5 & 1) != 0 || (v7 & 1) != 0 || (([(CKChatController *)self dismissingContextMenu]| v11))
    {

      [(CKChatController *)self _keyboardHeightFromLayoutGuide];
    }

    else
    {
      v12.receiver = self;
      v12.super_class = CKChatController;
      [(CKScrollViewController *)&v12 visibleInputViewHeight];
    }
  }

  return result;
}

- (double)bottomInsetPadding
{
  v3 = +[CKUIBehavior sharedBehaviors];
  v4 = [v3 entryViewFollowsKeyboardLayoutGuide];

  v5 = [(CKChatController *)self entryView];
  v6 = [v5 window];
  v7 = v6;
  if (v4)
  {

    if (v7)
    {
      v8 = [v5 heightConstraint];
      [v8 constant];
      v10 = v9;
    }

    else
    {
      v8 = [(CKChatController *)self view];
      [v8 safeAreaInsets];
      v10 = v12;
    }

    goto LABEL_8;
  }

  v10 = 0.0;
  if (!v7)
  {
    v5 = [(CKChatController *)self view];
    [v5 safeAreaInsets];
    v10 = v11;
LABEL_8:
  }

  return v10;
}

- (double)minimumBottomInset
{
  v3 = [(CKChatController *)self footerViewController];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 view];
    [v5 frame];
    v7 = v6;
    v8 = [(CKChatController *)self view];
    [v8 safeAreaInsets];
    Height = v7 + v9;
LABEL_11:

    goto LABEL_12;
  }

  if ([(CKChatController *)self inputAccessoryViewControllerEnabled])
  {
    v11 = [(CKChatController *)self inputAccessoryViewController];
    v5 = [v11 view];

    if (v5)
    {
LABEL_5:
      [v5 frame];
      Height = CGRectGetHeight(v16);
      goto LABEL_8;
    }
  }

  else
  {
    v5 = [(CKChatController *)self inputAccessoryView];
    if (v5)
    {
      goto LABEL_5;
    }
  }

  Height = 0.0;
LABEL_8:
  v8 = +[CKUIBehavior sharedBehaviors];
  if (![v8 transcriptMinBottomInsetIsEntryViewHeight])
  {
    goto LABEL_11;
  }

  v12 = [(CKChatController *)self entryView];
  v13 = [v12 window];

  if (v13)
  {
    v8 = [(CKChatController *)self entryView];
    [v8 frame];
    Height = v14;
    goto LABEL_11;
  }

LABEL_12:

  return Height;
}

- (void)computedInsetsDidChange
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  [v2 updateDockingMetricsIfNeeded];
}

- (CKTapbackPickerContainerAccessoryView)pickerContainerAccessoryView
{
  WeakRetained = objc_loadWeakRetained(&self->_pickerContainerAccessoryView);

  return WeakRetained;
}

- (CKTranscriptCollectionView)collectionView
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 collectionView];

  return v3;
}

- (double)topInsetPadding
{
  v3 = [(CKChatController *)self tipManager];
  v4 = [v3 presentingTopAlignedTip];

  if (!v4)
  {
    v9 = [(CKChatController *)self nicknameBanner];

    if (v9)
    {
      v39.receiver = self;
      v39.super_class = CKChatController;
      [(CKScrollViewController *)&v39 topInsetPadding];
      v6 = v10;
      v7 = [(CKChatController *)self nicknameBanner];
      [v7 bounds];
      Height = CGRectGetHeight(v41);
      goto LABEL_5;
    }

    v13 = [(CKChatController *)self acceptedContactBanner];

    if (v13)
    {
      v38.receiver = self;
      v38.super_class = CKChatController;
      [(CKScrollViewController *)&v38 topInsetPadding];
      v15 = v14;
      v16 = [(CKChatController *)self acceptedContactBanner];
LABEL_10:
      v7 = v16;
      [v16 frame];
      v11 = v15 + v17;
      goto LABEL_6;
    }

    if ([(CKChatController *)self _anySuggestionPresenterWantsToShowBanner])
    {
      v18 = [(CKChatController *)self collectionView];
      [v18 contentInset];
      v20 = v19;
      v22 = v21;

      v23 = [(CKChatController *)self collectionView];
      [v23 bounds];
      v25 = v24 - v20 - v22;

      v26 = [(CKChatController *)self collectionView];
      [v26 contentSize];
      v28 = v27;

      if (v28 < v25)
      {
        v37.receiver = self;
        v37.super_class = CKChatController;
        [(CKScrollViewController *)&v37 topInsetPadding];
        v30 = v29;
        [(CKChatController *)self suggestionBannerHeight];
        return v30 + v31;
      }
    }

    else
    {
      v32 = [(CKChatController *)self notificationBannerView];

      if (v32)
      {
        v36.receiver = self;
        v36.super_class = CKChatController;
        [(CKScrollViewController *)&v36 topInsetPadding];
        v15 = v33;
        v16 = [(CKChatController *)self notificationBannerView];
        goto LABEL_10;
      }
    }

    v35.receiver = self;
    v35.super_class = CKChatController;
    [(CKScrollViewController *)&v35 topInsetPadding];
    return v34;
  }

  v40.receiver = self;
  v40.super_class = CKChatController;
  [(CKScrollViewController *)&v40 topInsetPadding];
  v6 = v5;
  v7 = [(CKChatController *)self tipManager];
  [v7 tipHeight];
LABEL_5:
  v11 = v6 + Height;
LABEL_6:

  return v11;
}

- (BOOL)_anySuggestionPresenterWantsToShowBanner
{
  v3 = [(CKChatController *)self standardSuggestionPresenter];
  if ([v3 wantsToShowBanner])
  {
    v4 = 1;
  }

  else
  {
    v5 = [(CKChatController *)self foundInSuggestionPresenter];
    v4 = [v5 wantsToShowBanner];
  }

  return v4;
}

- (double)gradientBottomPlaceholderHeight
{
  v2 = [(CKChatController *)self entryView];
  [v2 placeholderHeight];
  v4 = v3;

  return v4;
}

- (void)_updateBannerNotifications
{
  [(CKChatController *)self _updateAccountRegistrationFailureNotification];
  [(CKChatController *)self _updateLogoutBannerNotification];

  [(CKChatController *)self _updateNotDefaultTextingAppNotification];
}

- (void)_updateAccountRegistrationFailureNotification
{
  if (CKIsAppleIDNotUpdated())
  {
    v3 = 0;
    v4 = 3;
  }

  else
  {
    v5 = CKIsWaitingForCloud();
    v3 = v5 ^ 1;
    if (v5)
    {
      v4 = 2;
    }

    else
    {
      v4 = 0;
    }
  }

  if ([(CKChatController *)self notificationBannerType]!= v4 && ([(CKChatController *)self notificationBannerType]& 0xFFFFFFFFFFFFFFFELL) == 2)
  {
    [(CKChatController *)self _updateNotificationBannerOfType:[(CKChatController *)self notificationBannerType] show:0];
  }

  v6 = (v3 & 1) == 0 && [(CKChatController *)self _chatShowsAccountRegistrationFailureBanner];

  [(CKChatController *)self _updateNotificationBannerOfType:v4 show:v6];
}

- (void)_updateLogoutBannerNotification
{
  if (CKIsRunningInMessages() && !CKIsRunningUITests() && !CKIsRunningForDevelopmentOnSimulator())
  {
    v8 = +[CKUIBehavior sharedBehaviors];
    if ([v8 isRunningInStoreDemoMode])
    {
    }

    else
    {
      v3 = [(CKChatController *)self _isRunningPPT];

      if (!v3)
      {
        v4 = [(CKCoreChatController *)self chat];
        v5 = [v4 isStewieChat];

        if ((v5 & 1) == 0)
        {
          if (CKIsUnexpectedlyLoggedOut() && [(CKChatController *)self _chatShowsAccountRegistrationFailureBanner])
          {
            v6 = self;
            v7 = 1;
          }

          else
          {
            v6 = self;
            v7 = 0;
          }

          [(CKChatController *)v6 _updateNotificationBannerOfType:1 show:v7];
        }
      }
    }
  }
}

- (void)_updateNotDefaultTextingAppNotification
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isTextAccessFor3rdPartyEnabled];

  if (v4)
  {
    v14 = [(CKCoreChatController *)self conversation];
    v5 = [v14 chat];
    if (v5)
    {
      v6 = v5;
      v7 = [(CKCoreChatController *)self conversation];
      v8 = [v7 sendingService];

      if (v8)
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) != 0 || !CKIsRunningInMessages())
        {
          v13 = 0;
        }

        else
        {
          v9 = [(CKCoreChatController *)self conversation];
          v10 = [v9 sendingService];
          v11 = [(CKCoreChatController *)self conversation];
          v12 = [v11 chat];
          v13 = [v10 __ck_isSendingAllowedForChat:v12] ^ 1;
        }

        [(CKChatController *)self _updateNotificationBannerOfType:4 show:v13];
      }
    }

    else
    {
    }
  }
}

- (void)scrollTranscriptToAlignWithMessageEditingBalloonView
{
  v3 = [(CKChatController *)self messageEditingViewController];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 transitionContext];
    v6 = [v5 anchorChatItemGUID];

    v7 = [v4 balloonViewForAlignment];
    v8 = [(CKCoreChatController *)self collectionViewController];
    v9 = [v8 chatItemForGUID:v6];

    v10 = v9;
    v11 = [v10 message];
    v12 = [v10 index];
    objc_initWeak(&location, self);
    v13 = [(CKChatController *)self collectionView];
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __72__CKChatController_scrollTranscriptToAlignWithMessageEditingBalloonView__block_invoke;
    v16[3] = &unk_1E72EB918;
    objc_copyWeak(v19, &location);
    v14 = v11;
    v17 = v14;
    v19[1] = v12;
    v15 = v7;
    v18 = v15;
    [v13 performContentOffsetUpdateTemporarilyOverridingHoldStatus:v16];

    objc_destroyWeak(v19);
    objc_destroyWeak(&location);
  }
}

- (void)setupScrollingForKeyboardInteraction
{
  v3 = [(CKCoreChatController *)self collectionViewController];
  v4 = [v3 collectionView];
  [v4 contentSize];
  v6 = v5;

  v7 = [(CKCoreChatController *)self collectionViewController];
  [v7 setScrollAnchor:v6];
}

- (void)_layoutEntryViewSuperview
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 superview];

  [v4 setNeedsLayout];
  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    if (IMOSLoggingEnabled())
    {
      v5 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
      {
        *v6 = 0;
        _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Triggering layout for entry view positioning change", v6, 2u);
      }
    }

    [v4 layoutIfNeeded];
  }
}

- (void)updateActiveEntryViewPositioningGuide
{
  v31 = *MEMORY[0x1E69E9840];
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 window];

  if (!v4)
  {
    return;
  }

  v5 = [(CKChatController *)self _determineEntryViewPositioningGuideToActivate];
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v29 = 134217984;
      v30 = v5;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "positioningGuideToActivate: %lu", &v29, 0xCu);
    }
  }

  if (v5 <= 1)
  {
    if (v5)
    {
      if (v5 != 1)
      {
        return;
      }

      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to follow Keyboard Snapshot", &v29, 2u);
        }
      }

      [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
      v13 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      v14 = [v13 isActive];

      if (v14)
      {
        v15 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
        [v15 setActive:0];
      }

      v16 = [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint isActive];
      [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:1];
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v23 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to follow Keyboard", &v29, 2u);
        }
      }

      [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
      v24 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      v14 = [v24 isActive];

      if (v14)
      {
        v25 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
        [v25 setActive:0];
      }

      entryViewFauxKeyboardLayoutConstraint = self->_entryViewFauxKeyboardLayoutConstraint;
      if (entryViewFauxKeyboardLayoutConstraint)
      {
        v16 = [(NSLayoutConstraint *)entryViewFauxKeyboardLayoutConstraint isActive];
        [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:1];
      }

      else
      {
        v16 = [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint isActive];
        [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:1];
      }
    }

LABEL_60:
    if (((!v16 | v14) & 1) == 0)
    {
      return;
    }

    goto LABEL_61;
  }

  if (v5 == 2)
  {
    if (IMOSLoggingEnabled())
    {
      v17 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to follow App Card", &v29, 2u);
      }
    }

    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
    v18 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
    v14 = [v18 isActive];

    if (v14)
    {
      v19 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      [v19 setActive:0];
    }

    v16 = [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint isActive];
    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:1];
    goto LABEL_60;
  }

  if (v5 == 4)
  {
    if (IMOSLoggingEnabled())
    {
      v20 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to stick to chat footer view", &v29, 2u);
      }
    }

    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
    v21 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
    v14 = [v21 isActive];

    if (v14)
    {
      v22 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      [v22 setActive:0];
    }

    v16 = [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint isActive];
    [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:1];
    goto LABEL_60;
  }

  if (v5 != 3)
  {
    return;
  }

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      LOWORD(v29) = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to align to the bottom of the entry view container", &v29, 2u);
    }
  }

  v8 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
  v9 = [v8 isActive];

  if ((v9 & 1) == 0)
  {
    v10 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
    [v10 setActive:1];
  }

  if ([(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
    v11 = 1;
  }

  else
  {
    v11 = v9 ^ 1;
  }

  if ([(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
    v11 = 1;
  }

  if ([(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
    v11 = 1;
  }

  if ([(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
    p_entryViewChatFooterViewLayoutConstraint = &self->_entryViewChatFooterViewLayoutConstraint;
    if (![(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint isActive])
    {
      goto LABEL_61;
    }
  }

  else
  {
    p_entryViewChatFooterViewLayoutConstraint = &self->_entryViewChatFooterViewLayoutConstraint;
    if (![(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint isActive])
    {
      if (!v11)
      {
        return;
      }

      goto LABEL_61;
    }
  }

  [(NSLayoutConstraint *)*p_entryViewChatFooterViewLayoutConstraint setActive:0];
LABEL_61:
  if (IMOSLoggingEnabled())
  {
    v28 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      LOWORD(v29) = 0;
      _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Active entry view positioning guide did change", &v29, 2u);
    }
  }

  [(CKChatController *)self _layoutEntryViewSuperview];
}

- (int64_t)_determineEntryViewPositioningGuideToActivate
{
  v3 = [(CKCoreChatController *)self inputController];
  v4 = [v3 isAppCardPresented];
  v22 = [v3 isAppCardAppearing];
  v20 = [v3 isAppCardDismissing];
  v21 = [v3 isAppCardUsingSheetPresentation];
  v5 = [(CKScrollViewController *)self isKeyboardVisible];
  v18 = [(CKChatController *)self isKeyboardSnapshotted];
  v6 = v5 | [(CKChatController *)self isKeyboardSnapshotVisible];
  v7 = [(CKChatController *)self traitCollection];
  v19 = [v7 verticalSizeClass];

  v8 = [(CKChatController *)self traitCollection];
  v9 = [v8 horizontalSizeClass];

  v10 = [v3 isAppCardUsingPopoverPresentation];
  v11 = [v3 hasStickerReactionSession];
  v12 = [(CKChatController *)self isFullScreenBalloonViewOnScreen];
  v13 = [(CKChatController *)self chatFooterView];
  if (v13)
  {
    if ((v6 | v4))
    {
      if ([v3 keyboardIsHiding])
      {
        v14 = 4;
      }

      else
      {
        v14 = 0;
      }
    }

    else
    {
      v14 = 4;
    }
  }

  else
  {
    v14 = 0;
  }

  if ((v11 | v10))
  {
    v15 = 3;
  }

  else if (v12)
  {
    v15 = [(CKChatController *)self entryViewPositioningGuideForCurrentTapbackPickerPresentation];
  }

  else if (((v9 != 1 || (v4 & v21 & 1) == 0) | (v22 | v20) & 1 || v19 == 1) && ((v9 != 1 || (v20 & v21 & 1) == 0) | v6 & 1 || v19 == 1))
  {
    if (v18)
    {
      v16 = 1;
    }

    else
    {
      v16 = v14;
    }

    if ((v9 != 1 || (v22 & v21 & 1) == 0) | v6 & 1 | (v19 == 1))
    {
      v15 = v16;
    }

    else
    {
      v15 = 2;
    }
  }

  else
  {
    v15 = 2;
  }

  return v15;
}

- (BOOL)isKeyboardSnapshotted
{
  v2 = [(CKChatController *)self keyboardSnapshotView];
  v3 = v2 != 0;

  return v3;
}

- (BOOL)isKeyboardSnapshotVisible
{
  v2 = [(CKChatController *)self keyboardSnapshotView];
  v3 = v2;
  if (v2)
  {
    v4 = [v2 window];
    [v3 frame];
    v6 = v5;
    [v4 bounds];
    v7 = v6 < CGRectGetMaxY(v9);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)isFullScreenBalloonViewOnScreen
{
  v3 = [(CKChatController *)self inlineReplyController];

  if (v3)
  {
    v4 = [(CKChatController *)self inlineReplyController];
    v5 = [v4 isFullScreenBalloonViewOnScreen];

    return v5;
  }

  else
  {
    v7.receiver = self;
    v7.super_class = CKChatController;
    return [(CKCoreChatController *)&v7 isFullScreenBalloonViewOnScreen];
  }
}

- (void)_inheritHiddenKeyboardAppearanceIfNeeded
{
  v3 = [(CKChatController *)self keyboardSnapshotView];
  if (v3)
  {
    v4 = [(CKChatController *)self keyboardSnapshotView];
    v5 = [v4 window];
    v6 = v5 != 0;
  }

  else
  {
    v6 = 0;
  }

  v7 = [(CKChatController *)self keyboardSnapshotView];
  [v7 alpha];
  v9 = v8;

  if (v6 && v9 > 0.99)
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Keyboard will show while keyboard snapshot is in use. Will hide new keyboard view.", buf, 2u);
      }
    }

    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __60__CKChatController__inheritHiddenKeyboardAppearanceIfNeeded__block_invoke;
    v11[3] = &unk_1E72EBA18;
    v11[4] = self;
    [MEMORY[0x1E69DD250] performWithoutAnimation:v11];
  }
}

- (BOOL)_wantsThreeColumnLayout
{
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 wantsUniversalThreeColumn];

  return v3;
}

- (void)registerForTextInputPayloadHandling
{
  v3 = [(CKCoreChatController *)self inputController];
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v4 chat];
  v6 = [v5 isFiltered] != 0;
  v7 = [(CKCoreChatController *)self conversation];
  v8 = [v7 chat];
  [v3 registerForTextInputPayloadHandling:v6 isGroupChat:{objc_msgSend(v8, "isGroupChat")}];

  v9 = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self registerForTextinputPayloadHandlingForCheckInForConversation:v9];
}

- (void)configureMacToolbarProperties
{
  v3 = objc_alloc_init(CKMacToolBarImageProperties);
  [(CKChatController *)self setMacToolbarFaceTimeButtonProps:v3];

  v4 = objc_alloc_init(CKMacToolBarImageProperties);
  [(CKChatController *)self setMacToolbarDetailsButtonProps:v4];

  [(CKChatController *)self _configureMacFaceTimeButtonMenu];
  [(CKChatController *)self _configureFaceTimeStartCallToolbarItem];
  [(CKChatController *)self _configureMacFaceTimeJoinCallToolbarItem];
  [(CKChatController *)self _configureMacFaceTimeJoinedCallToolbarItem];

  [(CKChatController *)self _configureNewComposeToolbarItem];
}

- (void)_configureMacFaceTimeButtonMenu
{
  v53[1] = *MEMORY[0x1E69E9840];
  objc_initWeak(&location, self);
  v3 = MEMORY[0x1E69DC628];
  v4 = CKFrameworkBundle();
  v5 = [v4 localizedStringForKey:@"FACETIME_AUDIO" value:&stru_1F04268F8 table:@"ChatKit"];
  v6 = +[CKUIBehavior sharedBehaviors];
  v7 = [v6 navBarAudioImage];
  v46[0] = MEMORY[0x1E69E9820];
  v46[1] = 3221225472;
  v46[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke;
  v46[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v47, &location);
  v38 = [v3 actionWithTitle:v5 image:v7 identifier:0 handler:v46];

  v8 = MEMORY[0x1E69DC628];
  v9 = CKFrameworkBundle();
  v10 = [v9 localizedStringForKey:@"FACETIME_VIDEO" value:&stru_1F04268F8 table:@"ChatKit"];
  v11 = +[CKUIBehavior sharedBehaviors];
  v12 = [v11 navBarVideoImage];
  v44[0] = MEMORY[0x1E69E9820];
  v44[1] = 3221225472;
  v44[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_2;
  v44[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v45, &location);
  v39 = [v8 actionWithTitle:v10 image:v12 identifier:0 handler:v44];

  v13 = MEMORY[0x1E69DC628];
  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"INVITE_TO_SHARE_MY_SCREEN" value:&stru_1F04268F8 table:@"ChatKit"];
  v42[0] = MEMORY[0x1E69E9820];
  v42[1] = 3221225472;
  v42[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_3;
  v42[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v43, &location);
  v36 = [v13 actionWithTitle:v15 image:0 identifier:0 handler:v42];

  v16 = MEMORY[0x1E69DC628];
  v17 = CKFrameworkBundle();
  v18 = [v17 localizedStringForKey:@"ASK_TO_SHARE_THEIR_SCREEN" value:&stru_1F04268F8 table:@"ChatKit"];
  v40[0] = MEMORY[0x1E69E9820];
  v40[1] = 3221225472;
  v40[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_4;
  v40[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v41, &location);
  v19 = [v16 actionWithTitle:v18 image:0 identifier:0 handler:v40];

  if (IMDeviceIsGreenTea())
  {
    v20 = [(CKCoreChatController *)self conversation];
    v21 = [v20 isGroupConversation];

    if (v21)
    {
      v22 = MEMORY[0x1E695E0F0];
    }

    else
    {
      v53[0] = v39;
      v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v53 count:1];
    }
  }

  else
  {
    v23 = MEMORY[0x1E69DCC60];
    v52[0] = v38;
    v52[1] = v39;
    v24 = [MEMORY[0x1E695DEC8] arrayWithObjects:v52 count:2];
    v25 = [v23 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v24];

    v26 = MEMORY[0x1E69DCC60];
    v51[0] = v36;
    v51[1] = v19;
    v27 = [MEMORY[0x1E695DEC8] arrayWithObjects:v51 count:2];
    v28 = [v26 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v27];

    v29 = [(CKChatController *)self detailsContactsManager];
    v30 = [(CKCoreChatController *)self conversation];
    v31 = [v30 recipient];
    v32 = [v29 showScreenSharingButtonForEntity:v31];

    if (v32)
    {
      v50[0] = v25;
      v50[1] = v28;
      v33 = v50;
      v34 = 2;
    }

    else
    {
      v49 = v25;
      v33 = &v49;
      v34 = 1;
    }

    v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v33 count:{v34, v36}];
  }

  v35 = [MEMORY[0x1E69DCC60] menuWithChildren:{v22, v36}];
  [(CKChatController *)self setMacFaceTimeButtonMenu:v35];

  objc_destroyWeak(&v41);
  objc_destroyWeak(&v43);

  objc_destroyWeak(&v45);
  objc_destroyWeak(&v47);
  objc_destroyWeak(&location);
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained conversation];
  v2 = [v1 chat];
  [v2 initiateTUConversationWithVideoEnabled:0];
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_2(uint64_t a1)
{
  IsGreenTea = IMDeviceIsGreenTea();
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained conversation];
  v4 = [v3 chat];
  v5 = v4;
  if (IsGreenTea)
  {
    [v4 initiateTUDialRequestWithVideoEnabled:1];
  }

  else
  {
    [v4 initiateTUConversationWithVideoEnabled:1];
  }
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = [WeakRetained detailsContactsManager];
  v3 = objc_loadWeakRetained((a1 + 32));
  v4 = [v3 conversation];
  v5 = [v4 recipient];
  [v2 shareMyScreenWithEntity:v5];
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_4(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = [WeakRetained detailsContactsManager];
  v3 = objc_loadWeakRetained((a1 + 32));
  v4 = [v3 conversation];
  v5 = [v4 recipient];
  [v2 inviteEntityToShareTheirScreen:v5];
}

- (BOOL)shouldUseMacConversationAvatarTitleView
{
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 useMacToolbar];

  return v3;
}

- (id)innermostToolbarItemIdentifier
{
  v3 = @"CKMacToolbarChatDetailsItemIdentifier";
  if ([(CKChatController *)self _macShouldShowFaceTimeButtonInToolbar])
  {
    v4 = [(CKChatController *)self _canStartCall];
    v5 = [(CKChatController *)self _hasJoinableCall];
    v6 = [(CKChatController *)self _hasJoinedCall];
    v7 = @"CKMacToolbarFacetimeJoinedCallItemIdentifier";
    if (!v6)
    {
      v7 = @"CKMacToolbarChatDetailsItemIdentifier";
    }

    if (v5)
    {
      v7 = @"CKMacToolbarFacetimeJoinCallItemIdentifier";
    }

    if (v4)
    {
      return @"CKMacToolbarFacetimeStartCallItemIdentifier";
    }

    else
    {
      return v7;
    }
  }

  return v3;
}

- (void)macRecipientsControllerDidUpdateToFieldSizing:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self macRecipientsController];

  if (v5 == v4)
  {
    v6 = +[CKUIBehavior sharedBehaviors];
    v7 = [v6 useMacToolbar];

    if (v7)
    {
      v8 = [(CKChatController *)self view];
      v9 = [v8 window];
      [v9 frame];
      v11 = v10;
      v13 = v12;
      v15 = v14;
      v17 = v16;

      v18 = [(CKCoreChatController *)self macToolbarController];
      [v18 updateWithFrame:{v11, v13, v15, v17}];
    }
  }
}

- (void)refreshMacToolbar
{
  v3 = [(CKCoreChatController *)self macToolbarController];
  [v3 reloadToolbarItems];

  v4 = [(CKCoreChatController *)self macToolbarController];
  [v4 updateVirtualViewForProvider:self];
}

- (id)_newImageConfiguredForNSToolbarWithName:(id)a3 tintColor:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = +[CKUIBehavior sharedBehaviors];
  v9 = [v8 macToolbarSymbolConfiguration];

  v10 = objc_alloc_init(MEMORY[0x1E69DCA80]);
  v11 = [(CKChatController *)self traitCollection];
  [v11 displayScale];
  [v10 setScale:?];

  v12 = [MEMORY[0x1E69DCAB8] systemImageNamed:v7 withConfiguration:v9];

  v13 = objc_alloc(MEMORY[0x1E69DCA78]);
  [v12 size];
  v14 = [v13 initWithSize:v10 format:?];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __82__CKChatController_MacToolbar___newImageConfiguredForNSToolbarWithName_tintColor___block_invoke;
  v21[3] = &unk_1E72EBBE8;
  v22 = v12;
  v15 = [v14 imageWithActions:v21];
  v16 = [v15 imageWithRenderingMode:2];

  if (v6)
  {
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __82__CKChatController_MacToolbar___newImageConfiguredForNSToolbarWithName_tintColor___block_invoke_2;
    v18[3] = &unk_1E72EBD00;
    v19 = v16;
    v20 = v6;
    v16 = [v14 imageWithActions:v18];
  }

  return v16;
}

void __82__CKChatController_MacToolbar___newImageConfiguredForNSToolbarWithName_tintColor___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) imageWithTintColor:*(a1 + 40)];
  [v1 drawAtPoint:{*MEMORY[0x1E695EFF8], *(MEMORY[0x1E695EFF8] + 8)}];
}

- (id)_updatedFaceTimeToolbarItemImage
{
  v3 = [(CKChatController *)self macToolbarFaceTimeButtonProps];
  v4 = [v3 image];
  v5 = [(CKChatController *)self macJoinStyle];
  if (v5 <= 3)
  {
    if (v5 == 1)
    {
      v6 = +[CKUIBehavior sharedBehaviors];
      v7 = [v6 macToolbarJoinableFaceTimeAudioImageName];
      goto LABEL_10;
    }

    if (v5 == 3)
    {
      v6 = +[CKUIBehavior sharedBehaviors];
      v7 = [v6 macToolbarJoinableFaceTimeVideoImageName];
LABEL_10:
      v10 = v7;
      v8 = 0;
      goto LABEL_13;
    }

LABEL_8:
    v6 = +[CKUIBehavior sharedBehaviors];
    v7 = [v6 macToolbarFaceTimeImageName];
    goto LABEL_10;
  }

  if (v5 == 4)
  {
    v8 = [MEMORY[0x1E69DC888] ckColorNamed:@"CKSystemGreenColor"];
    v6 = +[CKUIBehavior sharedBehaviors];
    v9 = [v6 macToolbarJoinedFaceTimeAudioImageName];
  }

  else
  {
    if (v5 != 6)
    {
      goto LABEL_8;
    }

    v8 = [MEMORY[0x1E69DC888] ckColorNamed:@"CKSystemGreenColor"];
    v6 = +[CKUIBehavior sharedBehaviors];
    v9 = [v6 macToolbarJoinedFaceTimeVideoImageName];
  }

  v10 = v9;
LABEL_13:

  if (!v4)
  {
LABEL_20:
    v18 = [(CKChatController *)self _newImageConfiguredForNSToolbarWithName:v10 tintColor:v8];

    [v3 setTintColor:v8];
    [v3 setImage:v18];
    v4 = v18;
    goto LABEL_21;
  }

  v11 = [v3 tintColor];
  if (![v11 isEqual:v8])
  {
LABEL_19:

    goto LABEL_20;
  }

  v12 = [v3 imageName];
  if (([v12 isEqualToString:v10] & 1) == 0)
  {

    goto LABEL_19;
  }

  v13 = [(CKChatController *)self traitCollection];
  [v13 displayScale];
  v15 = v14;
  [v4 scale];
  v17 = v16;

  if (v15 != v17)
  {
    goto LABEL_20;
  }

LABEL_21:

  return v4;
}

- (void)configureWithToolbarController:(id)a3
{
  v6 = a3;
  v7 = [(CKCoreChatController *)self conversation];
  [v7 isBusinessConversation];

  if ([(CKChatController *)self shouldUseMacRecipientsView])
  {
    v8 = [CKMacRecipientsController alloc];
    v9 = [(CKCoreChatController *)self conversation];
    v10 = [(CKMacRecipientsController *)v8 initWithConversation:v9];
    [(CKChatController *)self setMacRecipientsController:v10];

    v11 = [(CKChatController *)self macRecipientsController];
    [v11 setDelegate:self];
  }

  v18.receiver = self;
  v18.super_class = CKChatController;
  [(CKCoreChatController *)&v18 configureWithToolbarController:v6];
  v12 = [(CKCoreChatController *)self conversation];
  v13 = [v12 chat];
  v14 = [v13 allowedByScreenTime];
  if (v14)
  {
    v15 = 1;
  }

  else
  {
    v3 = [(CKCoreChatController *)self conversation];
    v4 = [v3 chat];
    v15 = v4 == 0;
  }

  v16 = [(CKCoreChatController *)self macToolbarController];
  [v16 setShouldDrawSecondaryBlur:v15];

  if ((v14 & 1) == 0)
  {
  }

  v17 = [(CKCoreChatController *)self macToolbarController];
  [v17 updateVirtualViewForProvider:self];
}

- (void)providerWillBeRemovedFromToolbarController:(id)a3
{
  v4 = [(CKChatController *)self recipientsVirtualToolbarItem];

  if (v4)
  {
    v5 = [(CKChatController *)self recipientsVirtualToolbarItem];
    [v5 removeFromSuperview];
  }
}

- (BOOL)_macShouldShowFaceTimeButtonInToolbar
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 chat];
  v5 = [v4 supportsCapabilities:1024];

  if (!v5)
  {
    return 0;
  }

  v6 = [(CKCoreChatController *)self conversation];
  v7 = [v6 isGroupConversation];

  if (v7)
  {
    if (IMDeviceIsGreenTea())
    {
      return 0;
    }
  }

  else
  {
    v9 = [(CKCoreChatController *)self conversation];
    v10 = [v9 chat];
    v11 = [v10 isSMS];

    if (v11)
    {
      return 0;
    }
  }

  v12 = [(CKCoreChatController *)self conversation];
  if ([v12 isBusinessConversation])
  {
    v8 = 0;
  }

  else
  {
    v13 = [(CKCoreChatController *)self conversation];
    v8 = [CKFaceTimeUtilities isFaceTimeVideoAvailable:v13];
  }

  return v8;
}

- (void)composeButtonClicked:(id)a3
{
  v7 = a3;
  v4 = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    v6 = [(CKCoreChatController *)self delegate];
    [v6 chatController:self didRequestNewComposePresentationWithSender:v7];
  }
}

- (UIEdgeInsets)virtualToolbarContentInsets
{
  v2 = *MEMORY[0x1E69DDCE0];
  v3 = *(MEMORY[0x1E69DDCE0] + 8);
  v4 = *(MEMORY[0x1E69DDCE0] + 16);
  v5 = *(MEMORY[0x1E69DDCE0] + 24);
  result.right = v5;
  result.bottom = v4;
  result.left = v3;
  result.top = v2;
  return result;
}

- (id)virtualView
{
  if (([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled] & 1) == 0)
  {
    [(CKChatController *)self effectPickerIsPresented];
LABEL_6:
    v8 = [(CKCoreChatController *)self macToolbarController];
    [v8 setShouldDrawSecondaryBlur:0];

    goto LABEL_7;
  }

  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    v3 = [(CKCoreChatController *)self conversation];
    v4 = [v3 chat];
    if (v4)
    {
      v5 = [(CKCoreChatController *)self conversation];
      v6 = [v5 chat];
      v7 = [v6 allowedByScreenTime] ^ 1;
    }

    else
    {
      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  if ([(CKChatController *)self effectPickerIsPresented]|| v7)
  {
    goto LABEL_6;
  }

  if (![(CKChatController *)self _shouldUseBusinessToolbarAsVirtualView])
  {
    if ([(CKChatController *)self shouldUseMacRecipientsView])
    {
      v9 = [(CKChatController *)self recipientsVirtualToolbarItem];
      goto LABEL_20;
    }

    [(CKChatController *)self shouldUseMacConversationAvatarTitleView];
LABEL_7:
    v9 = 0;
    goto LABEL_8;
  }

  v11 = [(CKChatController *)self businessMacToolbarController];
  v9 = [v11 view];

LABEL_20:
  v12 = [(CKCoreChatController *)self macToolbarController];
  [v12 setShouldDrawSecondaryBlur:1];

LABEL_8:

  return v9;
}

- (BOOL)prefersBottomDividerHidden
{
  [(CKChatController *)self preferredMacToolbarHeight];
  v4 = v3;
  v5 = +[CKUIBehavior sharedBehaviors];
  [v5 macAppKitToolbarHeight];
  v7 = v6;

  result = [(CKChatController *)self effectPickerIsPresented];
  if (v4 > v7)
  {
    return 1;
  }

  return result;
}

- (BOOL)_hasJoinableCall
{
  if ([(CKChatController *)self currentCallMode]== 3)
  {
    LOBYTE(v3) = 1;
  }

  else
  {
    v3 = [(CKChatController *)self currentCallMode];
    if (v3 != 1)
    {
      LOBYTE(v3) = [(CKChatController *)self currentCallMode]== 5;
    }
  }

  return v3;
}

- (id)transcriptCollectionViewController:(id)a3 contextMenuConfigurationForItemAtIndexPath:(id)a4 point:(CGPoint)a5 interaction:(id)a6
{
  y = a5.y;
  x = a5.x;
  v114 = *MEMORY[0x1E69E9840];
  v92 = a3;
  v11 = a4;
  v12 = a6;
  if ([(CKChatController *)self _clickyOrbEnabled])
  {
    if (CKIsRunningInMacCatalyst() && [(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:v12])
    {
      if (IMOSLoggingEnabled())
      {
        v13 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "clicky orb: enabled - context menu interaction is outside of visible balloonCell", buf, 2u);
        }
      }

      v14 = [(CKChatController *)self contextMenuInteractionOutsideOfVisibleBalloonCells];
      goto LABEL_80;
    }

    v91 = [(CKChatController *)self _parentChatItemForIndexPath:v11];
    v16 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v11];
    v17 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v16];
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = [v91 IMChatItem];
        v20 = [v19 guid];
        v21 = [v91 IMChatItem];
        v22 = [v21 guid];
        *buf = 138413058;
        v105 = v20;
        v106 = 2112;
        v107 = v22;
        v108 = 2112;
        v109 = v16;
        v110 = 2112;
        v111 = v17;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "clicky orb: initial values of chatItem.guid: %@, parentChatItem.guid: %@, parentIndexPath: %@, parentBalloonView: %@", buf, 0x2Au);
      }
    }

    if (!CKIsRunningInMacCatalyst())
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & (v17 != 0)) == 1)
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          if (IMOSLoggingEnabled())
          {
            v23 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "clicky orb: disabled because no context menu for the moment share placeholder item", buf, 2u);
            }
          }

          v14 = 0;
          v24 = v91;
          goto LABEL_79;
        }
      }
    }

    v90 = v92;
    v25 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v26 = [v25 isStickerRepositioningEnabled];

    if (v26 && [v90 pointIntersectsRepositionEnabledSticker:v91 chatItem:{x, y}])
    {
      if (IMOSLoggingEnabled())
      {
        v27 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v27, OS_LOG_TYPE_INFO, "clicky orb: disabled because touch intersects a repositionable sticker", buf, 2u);
        }
      }
    }

    else if (CKIsRunningInMacCatalyst() || ([v90 selectionManager], v73 = objc_claimAutoreleasedReturnValue(), v74 = objc_msgSend(v73, "selectedGuidCount") == 0, v73, v74) || (objc_msgSend(v91, "IMChatItem"), v75 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v75, "guid"), v76 = objc_claimAutoreleasedReturnValue(), v75, objc_msgSend(v90, "selectionManager"), v77 = objc_claimAutoreleasedReturnValue(), LOBYTE(v75) = objc_msgSend(v77, "isMessageGuidSelected:", v76), v77, v76, (v75 & 1) == 0))
    {
      v28 = v91;
      if (!CKIsRunningInMacCatalyst())
      {
        objc_opt_class();
        v28 = v91;
        if ((objc_opt_isKindOfClass() & (v17 != 0)) == 1)
        {
          objc_opt_class();
          v28 = v91;
          if (objc_opt_isKindOfClass())
          {
            v29 = v17;
            v28 = [v29 currentAssetChatItem];

            if (IMOSLoggingEnabled())
            {
              v30 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v105 = v28;
                _os_log_impl(&dword_19020E000, v30, OS_LOG_TYPE_INFO, "clicky orb: found photo stack. updating target chatItem to chatItem: %@", buf, 0xCu);
              }
            }
          }
        }
      }

      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0 || (-[CKChatController collectionView](self, "collectionView"), v31 = objc_claimAutoreleasedReturnValue(), [v17 frame], v33 = v32, v35 = v34, v37 = v36, v39 = v38, objc_msgSend(v17, "superview"), v40 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v31, "convertRect:fromView:", v40, v33, v35, v37, v39), v42 = v41, v44 = v43, v46 = v45, v48 = v47, v40, v31, v118.origin.x = v42, v118.origin.y = v44, v118.size.width = v46, v118.size.height = v48, v116.x = x, v116.y = y, CGRectContainsPoint(v118, v116)) || objc_msgSend(v11, "row") < 1)
      {
        v68 = v17;
        v67 = v16;
        v24 = v28;
      }

      else
      {
        v89 = [MEMORY[0x1E696AC88] indexPathForRow:objc_msgSend(v11 inSection:{"row") - 1, objc_msgSend(v11, "section")}];
        v87 = [(CKChatController *)self _parentChatItemForIndexPath:v89];
        v88 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v89];
        v86 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v88];
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) != 0 && (-[CKChatController collectionView](self, "collectionView"), v49 = objc_claimAutoreleasedReturnValue(), [v86 frame], v51 = v50, v53 = v52, v55 = v54, v57 = v56, objc_msgSend(v86, "superview"), v58 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v49, "convertRect:fromView:", v58, v51, v53, v55, v57), v60 = v59, v62 = v61, v64 = v63, v66 = v65, v58, v49, v119.origin.x = v60, v119.origin.y = v62, v119.size.width = v64, v119.size.height = v66, v117.x = x, v117.y = y, CGRectContainsPoint(v119, v117)))
        {
          v24 = v87;

          v67 = v88;
          v68 = v86;

          if (IMOSLoggingEnabled())
          {
            v69 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v105 = v24;
              _os_log_impl(&dword_19020E000, v69, OS_LOG_TYPE_INFO, "clicky orb: found orangic layout. updating target chatItem to chatItem: %@", buf, 0xCu);
            }
          }
        }

        else
        {
          v68 = v17;
          v67 = v16;
          v24 = v28;
        }
      }

      if (v24)
      {
        v70 = [v24 isReplyContextPreview];
        v71 = IMOSLoggingEnabled();
        if (!v70)
        {
          if (v71)
          {
            v79 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v79, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v79, OS_LOG_TYPE_INFO, "clicky orb: enabled", buf, 2u);
            }
          }

          if (!CKIsRunningInMacCatalyst() && [v12 menuAppearance] == 1)
          {
            [v68 setIsBeingShownAsPreview:1];
          }

          [(CKChatController *)self setClickyOrbChatItem:v24];
          v80 = [(CKChatController *)self entryView];
          v81 = [v80 contentView];
          -[CKChatController setEntryViewWasActiveOnContextMenuPresentation:](self, "setEntryViewWasActiveOnContextMenuPresentation:", [v81 isActive]);

          [(CKChatController *)self hideAssociatedCellsForChatItem:v91];
          objc_initWeak(&location, self);
          v82 = MEMORY[0x1E69DC8D8];
          v98[0] = MEMORY[0x1E69E9820];
          v98[1] = 3221225472;
          v98[2] = __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke;
          v98[3] = &unk_1E72EBEA8;
          v83 = v24;
          v99 = v83;
          objc_copyWeak(&v102, &location);
          v17 = v68;
          v100 = v17;
          v16 = v67;
          v101 = v16;
          v93[0] = MEMORY[0x1E69E9820];
          v93[1] = 3221225472;
          v93[2] = __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke_221;
          v93[3] = &unk_1E72EBED0;
          objc_copyWeak(&v97, &location);
          v24 = v83;
          v94 = v24;
          v95 = v91;
          v96 = v12;
          v14 = [v82 configurationWithIdentifier:v11 previewProvider:v98 actionProvider:v93];
          if (IMOSLoggingEnabled())
          {
            v84 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v84, OS_LOG_TYPE_INFO))
            {
              *buf = 138413314;
              v105 = v14;
              v106 = 2112;
              v107 = v24;
              v108 = 2112;
              v109 = v11;
              v110 = 2112;
              v111 = v16;
              v112 = 2112;
              v113 = v17;
              _os_log_impl(&dword_19020E000, v84, OS_LOG_TYPE_INFO, "clicky orb: configuration:%@ made from chatItem:%@, at indexPath:%@, with parentIndexPath:%@, parentBalloonView:%@", buf, 0x34u);
            }
          }

          objc_destroyWeak(&v97);
          objc_destroyWeak(&v102);

          objc_destroyWeak(&location);
          goto LABEL_78;
        }

        if (v71)
        {
          v72 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v72, OS_LOG_TYPE_INFO, "clicky orb: disabled because chatItem isReplyContextPreview=YES", buf, 2u);
          }
        }
      }

      else
      {
        if (IMOSLoggingEnabled())
        {
          v78 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
          {
            *buf = 138412290;
            v105 = v11;
            _os_log_impl(&dword_19020E000, v78, OS_LOG_TYPE_INFO, "clicky orb: disabled because nil chatItem from indexPath: %@", buf, 0xCu);
          }
        }

        v24 = 0;
      }

      v14 = 0;
      v17 = v68;
      v16 = v67;
LABEL_78:

LABEL_79:
      goto LABEL_80;
    }

    v14 = 0;
    v24 = v91;
    goto LABEL_78;
  }

  if (IMOSLoggingEnabled())
  {
    v15 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "clicky orb: disabled. Returning nil configuration", buf, 2u);
    }
  }

  v14 = 0;
LABEL_80:

  return v14;
}

id __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke(uint64_t a1)
{
  v9 = *MEMORY[0x1E69E9840];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v2 = [*(a1 + 32) mediaObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass() & 1) != 0 && ([v2 needsAnimation])
    {

      v3 = 0;
      goto LABEL_10;
    }
  }

  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = [WeakRetained _previewingViewControllerForHitView:*(a1 + 40) indexPath:*(a1 + 48)];

  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v7 = 138412290;
      v8 = v3;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "clicky orb: providing previewingViewController: %@", &v7, 0xCu);
    }
  }

LABEL_10:

  return v3;
}

id __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke_221(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = [WeakRetained _menuForChatItem:*(a1 + 32) withParentChatItem:*(a1 + 40) menuAppearance:{objc_msgSend(*(a1 + 48), "menuAppearance")}];

  return v3;
}

- (void)transcriptCollectionViewController:(id)a3 willPerformPreviewActionForMenuWithConfiguration:(id)a4 animator:(id)a5
{
  v34 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v10 previewViewController];
  v12 = [v9 identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v14 = [v9 identifier];
    v15 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v14];
    v16 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v15];
    v25 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:v9];
  }

  else
  {
    v25 = 0;
    v16 = 0;
    v15 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v22 = v8;
      v24 = [v25 IMChatItem];
      v23 = [v24 guid];
      v18 = [(CKChatController *)self clickyOrbChatItem];
      v19 = [v18 IMChatItem];
      v20 = [v19 guid];
      *buf = 138412546;
      v31 = v23;
      v32 = 2112;
      v33 = v20;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, " willPerformPreviewActionForMenuWithConfiguration chatItem: %@, self.clickyOrb:%@", buf, 0x16u);

      v8 = v22;
    }
  }

  if (!v11 && v16 && v15)
  {
    v11 = [(CKChatController *)self _previewingViewControllerForHitView:v16 indexPath:v15];
  }

  if (v11)
  {
    v21 = [MEMORY[0x1E69A8168] sharedInstance];
    [v21 trackEvent:*MEMORY[0x1E69A7588]];

    [v10 setPreferredCommitStyle:1];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __135__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willPerformPreviewActionForMenuWithConfiguration_animator___block_invoke;
    v26[3] = &unk_1E72EBEF8;
    v26[4] = self;
    v27 = v11;
    v28 = v15;
    v29 = v25;
    [v10 addCompletion:v26];
  }
}

void __135__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willPerformPreviewActionForMenuWithConfiguration_animator___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setIsShowingPreview:1];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "willPerformPreviewActionForMenuWithConfiguration: Setting showing preview to YES", buf, 2u);
    }
  }

  v3 = *(a1 + 40);
  v4 = [*(a1 + 32) previewController];

  if (v3 == v4)
  {
    v11.receiver = *(a1 + 32);
    v11.super_class = CKChatController;
    objc_msgSendSuper2(&v11, sel_becomeFirstResponder);
    [*(a1 + 32) presentViewController:*(a1 + 40) animated:1 completion:0];
    return;
  }

  [*(a1 + 32) restoreEntryViewAfterPreview];
  if (!*(a1 + 48))
  {
    goto LABEL_13;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_13;
  }

  v5 = *(a1 + 56);
  v6 = [*(a1 + 32) collectionViewController];
  v7 = [v6 transcriptIdentifier];
  v8 = [v5 balloonControllerForContext:v7];

  if ((objc_opt_respondsToSelector() & 1) == 0)
  {

    goto LABEL_13;
  }

  v9 = [v8 handlePresentationAction];

  if ((v9 & 1) == 0)
  {
LABEL_13:
    v10 = [*(a1 + 32) navigationController];
    [v10 pushViewController:*(a1 + 40) animated:0];
  }
}

- (id)transcriptCollectionViewController:(id)a3 previewForHighlightingContextMenuWithConfiguration:(id)a4
{
  v168 = *MEMORY[0x1E69E9840];
  v158 = a3;
  v6 = a4;
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "generating reviewForHighlightingContextMenuWithConfiguration", buf, 2u);
    }
  }

  v8 = [v6 identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v159 = [v6 identifier];
    v156 = [(CKChatController *)self _parentChatItemForIndexPath:v159];
    v157 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v159];
    v10 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v157];
    v11 = [(CKCoreChatController *)self fullScreenBalloonViewController];
    v12 = [v11 displayConfiguration];
    v13 = [v12 type] == 2;

    if (v13)
    {
      v160 = [(CKCoreChatController *)self fullScreenBalloonViewController];
      v14 = [v160 balloonView];
      objc_opt_class();
      v15 = objc_opt_isKindOfClass();

      if ((v15 & 1) == 0)
      {
        v19 = [v160 balloonView];
        [v19 bounds];
        v21 = v20;
        v23 = v22;
        v25 = v24;
        v27 = v26;

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v28 = +[CKUIBehavior sharedBehaviors];
          [v28 dragBalloonTailCropWidth];
          v30 = v29;

          if (!v10 || ([v10 balloonDescriptor], !v161))
          {
            v21 = v21 + v30;
          }

          v25 = v25 - v30;
        }

        v85 = objc_alloc_init(MEMORY[0x1E69DCE28]);
        v132 = +[CKUIBehavior sharedBehaviors];
        [v132 dragBalloonCornerRadius];
        v134 = v133;

        v135 = [MEMORY[0x1E69DC728] bezierPathWithRoundedRect:v21 cornerRadius:{v23, v25, v27, v134}];
        [v85 setVisiblePath:v135];

        v136 = [v160 balloonView];
        v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v136 parameters:v85];
        [v18 _setOverridePositionTrackingView:v136];
        if (objc_opt_respondsToSelector())
        {
          [v18 _setPrefersUnmaskedPlatterStyle:1];
        }

        if (IMOSLoggingEnabled())
        {
          v137 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v137, OS_LOG_TYPE_INFO))
          {
            *buf = 138412546;
            v163 = v18;
            v164 = 2112;
            v165 = v136;
            _os_log_impl(&dword_19020E000, v137, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration returning preview for add sticker configuration: %@, trackingView: %@", buf, 0x16u);
          }
        }

        goto LABEL_114;
      }

      if (v160)
      {
        v16 = [v160 balloonView];
      }

      else
      {
        v16 = v10;
      }
    }

    else
    {
      v16 = v10;
    }

    v160 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:v6];
    if (IMOSLoggingEnabled())
    {
      v31 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        v32 = [v160 IMChatItem];
        v33 = [v32 guid];
        v34 = [(CKChatController *)self clickyOrbChatItem];
        v35 = [v34 IMChatItem];
        v36 = [v35 guid];
        *buf = 138412802;
        v163 = v33;
        v164 = 2112;
        v165 = v36;
        v166 = 2112;
        v167 = v156;
        _os_log_impl(&dword_19020E000, v31, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration contextMenuChatItem: %@, self.clickyOrb:%@, chatItem: %@", buf, 0x20u);
      }
    }

    if (!v160)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v37 = v16;
        [v37 setCanUseOpaqueMask:1];
        [v37 prepareForDisplayIfNeeded];
      }
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v38 = [v158 collectionView];
      [v16 frame];
      v40 = v39;
      v42 = v41;
      v44 = v43;
      v46 = v45;
      v47 = [v16 superview];
      [v38 convertRect:v47 fromView:{v40, v42, v44, v46}];
      v49 = v48;
      v51 = v50;
      v53 = v52;
      v55 = v54;

      v56 = [v38 contextMenuInteraction];
      [v56 locationInView:v38];
      v58 = v57;
      v60 = v59;

      v172.origin.x = v49;
      v172.origin.y = v51;
      v172.size.width = v53;
      v172.size.height = v55;
      v170.x = v58;
      v170.y = v60;
      if (CGRectContainsPoint(v172, v170) || [v159 row] < 1)
      {
        v10 = v16;
      }

      else
      {
        v61 = [MEMORY[0x1E696AC88] indexPathForRow:objc_msgSend(v159 inSection:{"row") - 1, objc_msgSend(v159, "section")}];
        v62 = [(CKChatController *)self _parentChatItemForIndexPath:v61];
        v63 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v61];
        v64 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v63];
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) != 0 && ([v64 frame], v66 = v65, v68 = v67, v70 = v69, v72 = v71, objc_msgSend(v64, "superview"), v73 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v38, "convertRect:fromView:", v73, v66, v68, v70, v72), v75 = v74, v77 = v76, v79 = v78, v81 = v80, v73, v173.origin.x = v75, v173.origin.y = v77, v173.size.width = v79, v173.size.height = v81, v171.x = v58, v171.y = v60, CGRectContainsPoint(v173, v171)))
        {
          v10 = v64;

          if (IMOSLoggingEnabled())
          {
            v82 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v163 = v10;
              _os_log_impl(&dword_19020E000, v82, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration updating parentBalloonView: %@", buf, 0xCu);
            }
          }
        }

        else
        {
          v10 = v16;
        }
      }
    }

    else
    {
      v10 = v16;
    }

    if (v10)
    {
      v83 = [v10 window];
      v84 = v83 == 0;

      if (v84)
      {
        v85 = IMLogHandleForCategory();
        if (os_log_type_enabled(v85, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForHighlightingContextMenuWithConfiguration:];
        }
      }

      else
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v85 = v10;
          if (IMOSLoggingEnabled())
          {
            v86 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v163 = v85;
              _os_log_impl(&dword_19020E000, v86, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generating preview from photoStackBalloonView: %@", buf, 0xCu);
            }
          }

          v87 = [v85 stackView];
          v155 = [v87 currentAssetReference];
          v88 = [v87 regionOfInterestForAssetReference:v155];
          v89 = v88;
          if (v88 && (([v88 placeholderViewFactory], v90 = objc_claimAutoreleasedReturnValue(), v90, v90) && (objc_msgSend(v89, "placeholderViewFactory"), v91 = objc_claimAutoreleasedReturnValue(), (v91)[2](v91, v89), v92 = objc_claimAutoreleasedReturnValue(), v91, v92) || (-[CKChatController view](self, "view"), v93 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v89, "rectInCoordinateSpace:", v93), v95 = v94, v97 = v96, v99 = v98, v101 = v100, v93, -[CKChatController view](self, "view"), v102 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v102, "resizableSnapshotViewFromRect:afterScreenUpdates:withCapInsets:", 0, v95, v97, v99, v101, *MEMORY[0x1E69DDCE0], *(MEMORY[0x1E69DDCE0] + 8), *(MEMORY[0x1E69DDCE0] + 16), *(MEMORY[0x1E69DDCE0] + 24)), v92 = objc_claimAutoreleasedReturnValue(), v102, v92)))
          {
            if ((objc_opt_respondsToSelector() & 1) != 0 && ([v89 trackingContainerView], v154 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v92, "bounds"), v107 = CGRectPxCenterPoint(v103, v104, v105, v106), v154))
            {
              v109 = v107;
              v110 = v108;
              v111 = 0;
            }

            else
            {
              v154 = [(CKChatController *)self view];
              v119 = [v154 coordinateSpace];
              [v89 rectInCoordinateSpace:v119];
              v109 = CGRectPxCenterPoint(v120, v121, v122, v123);
              v110 = v124;

              v111 = 1;
            }

            v125 = [objc_alloc(MEMORY[0x1E69DCE38]) initWithContainer:v154 center:{v109, v110}];
            v126 = objc_alloc_init(MEMORY[0x1E69DCE28]);
            v127 = +[CKUIBehavior sharedBehaviors];
            [v127 dragBalloonCornerRadius];

            v128 = MEMORY[0x1E69DC728];
            [v92 bounds];
            v129 = [v128 bezierPathWithRoundedRect:? cornerRadius:?];
            [v126 setVisiblePath:v129];

            v130 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v92 parameters:v126 target:v125];
            v18 = v130;
            if (v111)
            {
              [v130 _setOverridePositionTrackingView:v85];
            }

            if (objc_opt_respondsToSelector())
            {
              [v18 _setPrefersUnmaskedPlatterStyle:1];
            }

            if (IMOSLoggingEnabled())
            {
              v131 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v131, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v163 = v18;
                _os_log_impl(&dword_19020E000, v131, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generated photoStackBalloonView preview: %@", buf, 0xCu);
              }
            }
          }

          else
          {
            v18 = 0;
          }

          v10 = v85;
          goto LABEL_114;
        }

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          if (IMOSLoggingEnabled())
          {
            v112 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v112, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v163 = v10;
              _os_log_impl(&dword_19020E000, v112, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generated parentBalloonView preview: %@", buf, 0xCu);
            }
          }

          if (((v160 != 0) & [v10 canUseOpaqueMask]) == 1)
          {
            [v10 setCanUseOpaqueMask:0];
            [v10 setNeedsPrepareForDisplay];
            [v10 prepareForDisplayIfNeeded];
            [v10 layoutIfNeeded];
            [MEMORY[0x1E6979518] flush];
          }

          v85 = objc_alloc_init(MEMORY[0x1E69DCE28]);
          v113 = [v10 bezierPathForDragPreview];
          [v85 setVisiblePath:v113];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v114 = [v10 dataSource];
            v115 = [v114 pluginPayload];
            v116 = [v115 pluginBundleID];
            v117 = IMBalloonExtensionIDWithSuffix();
            v118 = [v116 isEqualToString:v117];
          }

          else
          {
            v118 = 0;
          }

          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) != 0 && [v10 shouldProvideDragPreview])
          {
            v138 = v10;
            v139 = [v138 attachmentBalloonViewPreview];
            v140 = v139;
            if (v139)
            {
              v141 = v139;
            }

            else
            {
              v141 = v138;
            }

            v142 = v141;

            v143 = [v138 superview];
            v144 = objc_alloc(MEMORY[0x1E69DCE38]);
            [v138 frame];
            v149 = [v144 initWithContainer:v143 center:{CGRectPxCenterPoint(v145, v146, v147, v148)}];
            v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v142 parameters:v85 target:v149];
            if (IMOSLoggingEnabled())
            {
              v150 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v150, OS_LOG_TYPE_INFO))
              {
                *buf = 138412802;
                v163 = v142;
                v164 = 2112;
                v165 = v143;
                v166 = 2112;
                v167 = v18;
                _os_log_impl(&dword_19020E000, v150, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration previewContentView: %@, containerView: %@, preview: %@", buf, 0x20u);
              }
            }
          }

          else if (v118)
          {
            [v85 setShadowPath:0];
            v151 = [MEMORY[0x1E69DC888] clearColor];
            [v85 setBackgroundColor:v151];

            v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v10 parameters:v85];
          }

          else
          {
            v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v10 parameters:v85];
            if (IMOSLoggingEnabled())
            {
              v152 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v152, OS_LOG_TYPE_INFO))
              {
                *buf = 138412546;
                v163 = v18;
                v164 = 2112;
                v165 = v10;
                _os_log_impl(&dword_19020E000, v152, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generated preview: %@, parentBalloonView: %@", buf, 0x16u);
              }
            }
          }

          [v18 _setOverridePositionTrackingView:v10];
          if (objc_opt_respondsToSelector())
          {
            [v18 _setPrefersUnmaskedPlatterStyle:1];
          }

          goto LABEL_114;
        }

        v85 = IMLogHandleForCategory();
        if (os_log_type_enabled(v85, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForHighlightingContextMenuWithConfiguration:];
        }
      }
    }

    else
    {
      v85 = IMLogHandleForCategory();
      if (os_log_type_enabled(v85, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForHighlightingContextMenuWithConfiguration:];
      }
    }

    v18 = 0;
LABEL_114:

    goto LABEL_115;
  }

  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration unknown indexPath. No preview available", buf, 2u);
    }
  }

  v18 = 0;
LABEL_115:

  return v18;
}

- (id)transcriptCollectionViewController:(id)a3 previewForDismissingContextMenuWithConfiguration:(id)a4
{
  v16 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [(CKChatController *)self pickerContainerAccessoryView];
      v12 = 136315394;
      v13 = "[CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForDismissingContextMenuWithConfiguration:]";
      v14 = 2112;
      v15 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "%s clearing TapbackContainerAccessoryView: %@", &v12, 0x16u);
    }
  }

  [(CKChatController *)self setClickyOrbChatItem:0];
  [(CKChatController *)self setPickerContainerAccessoryView:0];
  v10 = [(CKChatController *)self transcriptCollectionViewController:v6 previewForHighlightingContextMenuWithConfiguration:v7];

  return v10;
}

- (id)contextMenuAccessoryViewsForChatItem:(id)a3 containingViewController:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = objc_alloc_init(MEMORY[0x1E695DF70]);
  if ([(CKChatController *)self shouldShowTapbackPickerForChatItem:v6])
  {
    v9 = [(CKChatController *)self pickerAccessoryViewForChatItem:v6 containingViewController:v7];
    [v8 addObject:v9];
    [(CKChatController *)self setPickerContainerAccessoryView:v9];
  }

  if ([(CKCoreChatController *)self shouldShowTapbackAttributionForChatItem:v6])
  {
    v10 = [(CKChatController *)self _votingViewForChatItem:v6 containingViewController:v7];
    [v8 addObject:v10];
  }

  return v8;
}

- (id)transcriptCollectionViewController:(id)a3 styleForContextMenuWithConfiguration:(id)a4
{
  v65 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:v7];
  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = [v8 IMChatItem];
      v11 = [v10 guid];
      v12 = [(CKChatController *)self clickyOrbChatItem];
      v13 = [v12 IMChatItem];
      v14 = [v13 guid];
      v61 = 138412546;
      v62 = v11;
      v63 = 2112;
      v64 = v14;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, " styleForContextMenuWithConfiguration chatItem: %@, self.clickyOrb:%@", &v61, 0x16u);
    }
  }

  v15 = [MEMORY[0x1E69DD440] defaultStyle];
  v16 = [(CKChatController *)self collectionView];
  [v16 layoutMargins];
  v18 = v17;
  v20 = v19;
  v22 = v21;

  v23 = 0.0;
  if ([(CKChatController *)self shouldShowTapbackPickerForChatItem:v8])
  {
    +[CKTapbackPickerBalloonLayoutTemplate requiredDisplayHeight];
    v25 = v24;
    v26 = +[CKUIBehavior sharedBehaviors];
    [v26 orbPreviewAdditionalTopInsetForTapbackPicker];
    v28 = v27;

    v23 = v25 + v28 + 0.0;
  }

  if ([(CKCoreChatController *)self shouldShowTapbackAttributionForChatItem:v8])
  {
    v29 = +[CKUIBehavior sharedBehaviors];
    [v29 attributionViewHeight];
    v31 = v30;
    v32 = +[CKUIBehavior sharedBehaviors];
    [v32 attributionViewMinPadding];
    v34 = v33;

    v23 = v23 + v31 + v34;
  }

  +[CKTapbackPickerBalloonLayoutTemplate emojiTailBubbleMargin];
  v36 = v35;
  +[CKTapbackPickerBalloonLayoutTemplate selectionTailSize];
  v38 = v37;
  +[CKTapbackPickerBalloonLayoutTemplate emojiTailBubbleMargin];
  v40 = v36 + v38 + v39;
  if (![v8 isFromMe] || (+[CKUIBehavior sharedBehaviors](CKUIBehavior, "sharedBehaviors"), v41 = objc_claimAutoreleasedReturnValue(), v42 = objc_msgSend(v41, "orbPreviewUsesLeftInsetForTapbackPicker"), v41, v43 = v40, (v42 & 1) == 0))
  {
    if (![v8 isFromMe])
    {
      v22 = v40;
    }

    v43 = v18;
  }

  v44 = +[CKUIBehavior sharedBehaviors];
  v45 = [v44 orbPreviewOverridesLeftInsetForSplitView];

  if (v45)
  {
    v46 = [(CKChatController *)self view];
    v47 = [v46 _shouldReverseLayoutDirection];

    if (v47)
    {
      if ([v8 isFromMe])
      {
        v48 = v40;
      }

      else
      {
        v48 = v43;
      }

      v49 = [(CKChatController *)self collectionView];
      [v49 safeAreaInsets];
      v51 = v50;

      v22 = fmax(v22 - v51, 0.0);
    }

    else
    {
      v54 = [(CKChatController *)self collectionView];
      [v54 safeAreaInsets];
      v56 = v55;

      v48 = fmax(v43 - v56, 0.0);
    }
  }

  else
  {
    v52 = [(CKChatController *)self collectionView];
    v53 = [v52 _flipsHorizontalAxis];

    if (v53)
    {
      v48 = v22;
    }

    else
    {
      v48 = v43;
    }

    if (v53)
    {
      v22 = v43;
    }
  }

  [v15 preferredEdgeInsets];
  [v15 setPreferredEdgeInsets:{fmax(v57, v23), v48, v20, v22}];
  v58 = [v6 traitCollection];
  [v15 setPreventPreviewRasterization:{objc_msgSend(v58, "isTranscriptBackgroundActive")}];

  if (objc_opt_respondsToSelector())
  {
    v59 = [objc_alloc(MEMORY[0x1E69DD818]) initWithVariant:0];
    [v59 setSubvariant:@"messagesTapback"];
    [v15 setPreferredMenuMaterial:v59];
  }

  return v15;
}

- (void)transcriptCollectionViewController:(id)a3 balloonViewWillDismissEditMenu:(id)a4
{
  v4 = [(CKCoreChatController *)self chat:a3];
  [v4 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57D8]];
}

- (void)clearEntryViewPasteConfiguration
{
  v2 = [(CKChatController *)self entryView];
  v3 = [v2 contentView];
  v5 = [v3 textView];

  v4 = objc_alloc_init(MEMORY[0x1E69DCD38]);
  [v5 setPasteConfiguration:v4];
}

- (void)restoreEntryViewPasteConfiguration
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 contentView];
  v8 = [v4 textView];

  v5 = [(CKCoreChatController *)self chat];
  LODWORD(v3) = [v5 supportsCapabilities:0x8000];

  v6 = +[CKUIBehavior sharedBehaviors];
  v7 = [v6 pasteConfigurationDisablingKeyboardStickers:v3 ^ 1];

  [v8 setPasteConfiguration:v7];
}

- (void)transcriptCollectionViewController:(id)a3 willEndContextMenuInteractionWithConfiguration:(id)a4 animator:(id)a5
{
  v52 = *MEMORY[0x1E69E9840];
  v39 = a3;
  v8 = a4;
  v9 = a5;
  v10 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:v8];
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = [v10 IMChatItem];
      v13 = [v12 guid];
      v14 = [(CKChatController *)self clickyOrbChatItem];
      v15 = [v14 IMChatItem];
      v16 = [v15 guid];
      *buf = 138412546;
      v49 = v13;
      v50 = 2112;
      v51 = v16;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, " willEndContextMenuInteractionWithConfiguration chatItem: %@, self.clickyOrb:%@", buf, 0x16u);
    }
  }

  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = [(CKChatController *)self entryView];
      v19 = [v18 contentView];
      v20 = [v19 isActive];
      *buf = 67109120;
      LODWORD(v49) = v20;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Was keyboard shown before context menu DISMISSED? %{BOOL}d", buf, 8u);
    }
  }

  v21 = [(CKCoreChatController *)self transcriptBackground];
  v22 = [(CKChatController *)self entryView];
  v23 = [v22 contentView];
  [v21 setKeyboardWasUpBeforeTapbackContext:{objc_msgSend(v23, "isActive")}];

  v24 = [(CKChatController *)self messageEditingViewController];
  v25 = v24 != 0;

  if (v25)
  {
    [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ContextMenu"];
  }

  v26 = [v8 identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v28 = [v8 identifier];
    v29 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v28];
    v30 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v29];
    [v30 setIsBeingShownAsPreview:0];
  }

  else
  {
    v30 = 0;
    v28 = 0;
  }

  [v30 setIsBeingShownAsPreview:0];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke;
  aBlock[3] = &unk_1E72EBF20;
  aBlock[4] = self;
  v43 = v10;
  v47 = v25;
  v44 = v39;
  v31 = v28;
  v45 = v31;
  v32 = v30;
  v46 = v32;
  v33 = v39;
  v34 = v10;
  v35 = _Block_copy(aBlock);
  v40[0] = MEMORY[0x1E69E9820];
  v40[1] = 3221225472;
  v40[2] = __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke_253;
  v40[3] = &unk_1E72EB8D0;
  v40[4] = self;
  v41 = v31;
  v36 = v31;
  v37 = _Block_copy(v40);
  v38 = v37;
  if (v9)
  {
    [v9 addAnimations:v37];
    [v9 addCompletion:v35];
  }

  else
  {
    (*(v37 + 2))(v37);
    v35[2](v35);
  }

  [(CKChatController *)self restoreEntryViewPasteConfiguration];
  [(CKChatController *)self restoreInputAfterPreviewPresentation];
}

void __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = [*(a1 + 32) pickerContainerAccessoryView];
      v16 = 136315394;
      v17 = "[CKChatController(ClickyOrbConformance) transcriptCollectionViewController:willEndContextMenuInteractionWithConfiguration:animator:]_block_invoke";
      v18 = 2112;
      v19 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "%s completion called, clearing TapbackContainerAccessoryView: %@", &v16, 0x16u);
    }
  }

  [*(a1 + 32) setClickyOrbChatItem:0];
  [*(a1 + 32) setPickerContainerAccessoryView:0];
  [*(a1 + 32) setDismissingContextMenu:1];
  if ([*(a1 + 32) acknowledgmentToSend])
  {
    v4 = [*(a1 + 32) chat];
    [v4 sendMessageAcknowledgment:objc_msgSend(*(a1 + 32) forChatItem:{"acknowledgmentToSend"), *(a1 + 40)}];

    [*(a1 + 32) setAcknowledgmentToSend:0];
  }

  v5 = [*(a1 + 32) chat];
  [v5 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5788]];
  if ((*(a1 + 72) & 1) == 0)
  {
    [*(a1 + 32) endHoldingScrollGeometryUpdatesForReason:@"ContextMenu"];
  }

  if ([*(a1 + 32) wasKeyboardShowingWithApp])
  {
    [*(a1 + 32) setWasKeyboardShowingWithApp:0];
    v6 = [*(a1 + 32) presentedViewController];
    if (v6)
    {
    }

    else if (([*(a1 + 32) isEditing] & 1) == 0)
    {
      [*(a1 + 32) reloadInputViews];
      [*(a1 + 32) becomeFirstResponder];
    }

    v7 = [*(a1 + 48) collectionView];
    [v7 endHoldingContentOffsetUpdatesForReason:@"ChatControllerClickyOrb"];
  }

  if ([*(a1 + 32) wantsInlineOverlay])
  {
    if (CKIsRunningInMacCatalyst())
    {
      v8 = [*(a1 + 32) collectionViewController];
      v9 = [v8 selectedChatItems];
      v10 = [v9 firstObject];

      v11 = v10;
      if (!v10)
      {
        v11 = *(a1 + 40);
      }

      v12 = v11;
    }

    else
    {
      v12 = *(a1 + 40);
    }

    [*(a1 + 32) showInlineReplyControllerForChatItem:v12 presentKeyboard:1];
    [*(a1 + 32) setWantsInlineOverlay:0];
  }

  else
  {
    v13 = [*(a1 + 32) wantsStickerDetails];
    v14 = *(a1 + 32);
    if (v13)
    {
      [v14 setWantsStickerDetails:0];
      [*(a1 + 32) presentStickerDetailControllerWithIndexPath:*(a1 + 56)];
    }

    else if ([v14 wantsEmojiDetails])
    {
      [*(a1 + 32) setWantsEmojiDetails:0];
      [*(a1 + 32) presentEmojiDetailsControllerWithIndexPath:*(a1 + 56)];
    }
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = *(a1 + 64);
    [v15 setCanUseOpaqueMask:1];
    [v15 prepareForDisplayIfNeeded];
  }

  [*(a1 + 32) setDismissingContextMenu:0];
}

void __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke_253(uint64_t a1)
{
  v2 = [*(a1 + 32) fullScreenBalloonViewController];
  v3 = [v2 displayConfiguration];
  v4 = [v3 shouldShowStickers];

  if ((v4 & 1) == 0)
  {
    v5 = [*(a1 + 32) _parentChatItemForIndexPath:*(a1 + 40)];
    [*(a1 + 32) showAssociatedCellsForChatItem:v5 animated:1 completion:0];
  }
}

- (void)transcriptCollectionViewController:(id)a3 willDisplayContextMenuWithConfiguration:(id)a4 animator:(id)a5
{
  v27 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  [(CKChatController *)self clearEntryViewPasteConfiguration];
  [(CKChatController *)self prepareInputForPreviewPresentation];
  v11 = [v9 identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v13 = [v9 identifier];
    v14 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v13];
    v15 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v14];
  }

  else
  {
    v15 = 0;
    v13 = 0;
  }

  if ([v15 canUseOpaqueMask])
  {
    [v15 setCanUseOpaqueMask:0];
    [v15 setNeedsPrepareForDisplay];
    [v15 prepareForDisplayIfNeeded];
    [v15 layoutIfNeeded];
    [MEMORY[0x1E6979518] flush];
  }

  v16 = [(CKCoreChatController *)self chat];
  [v16 beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5788]];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ContextMenu"];
  v17 = [(CKCoreChatController *)self delegate];
  v18 = objc_opt_respondsToSelector();

  if (v18)
  {
    v19 = [(CKCoreChatController *)self delegate];
    [v19 willDisplayContextMenuForChatController:self];

    v20 = [(CKCoreChatController *)self transcriptBackground];
    v21 = [(CKChatController *)self entryView];
    v22 = [v21 contentView];
    [v20 setKeyboardWasUpBeforeTapbackContext:{objc_msgSend(v22, "isActive")}];

    if (IMOSLoggingEnabled())
    {
      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        v24 = [(CKChatController *)self entryView];
        v25 = [v24 contentView];
        v26[0] = 67109120;
        v26[1] = [v25 isActive];
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Was keyboard shown before context menu SHOWN? %{BOOL}d", v26, 8u);
      }
    }
  }
}

- (id)transcriptCollectionViewController:(id)a3 accessoriesForContextMenuWithConfiguration:(id)a4
{
  v21 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:v7];
  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = [v8 IMChatItem];
      v11 = [v10 guid];
      v12 = [(CKChatController *)self clickyOrbChatItem];
      v13 = [v12 IMChatItem];
      v14 = [v13 guid];
      v17 = 138412546;
      v18 = v11;
      v19 = 2112;
      v20 = v14;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, " accessoriesForContextMenuWithConfiguration chatItem: %@, self.clickyOrb:%@", &v17, 0x16u);
    }
  }

  v15 = [(CKChatController *)self contextMenuAccessoryViewsForChatItem:v8 containingViewController:self];

  return v15;
}

- (id)_chatItemForContextMenuWithConfiguration:(id)a3
{
  v18 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v7 = [v4 identifier];
    if (v7)
    {
      v8 = [(CKChatController *)self _parentChatItemForIndexPath:v7];
      goto LABEL_6;
    }
  }

  else
  {
    v7 = 0;
  }

  v8 = 0;
LABEL_6:
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v7];
    v10 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v9];
    if (v10)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v11 = [v10 currentAssetChatItem];

        v8 = v11;
      }
    }
  }

  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v14 = 138412546;
      v15 = v8;
      v16 = 2112;
      v17 = v7;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "clickyOrbConformance: found chatItem:%@ at indexPath:%@", &v14, 0x16u);
    }
  }

  return v8;
}

- (void)dismissContextMenuInteractionMenu
{
  if ([(CKChatController *)self photosGridViewPresented])
  {
    v3 = [(CKChatController *)self photosGridViewController];
    v4 = objc_opt_respondsToSelector();

    if ((v4 & 1) == 0)
    {
      return;
    }

    v5 = [(CKChatController *)self photosGridViewController];
  }

  else
  {
    v5 = [(CKChatController *)self collectionView];
  }

  v7 = v5;
  v6 = [v5 contextMenuInteraction];
  [v6 dismissMenu];
}

- (id)_menuForChatItem:(id)a3 withParentChatItem:(id)a4 menuAppearance:(int64_t)a5
{
  v69[1] = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = +[CKUIBehavior sharedBehaviors];
  v11 = [v10 disableTranscriptClickyOrbContextMenu];

  if (v11)
  {
    v12 = 0;
  }

  else
  {
    v13 = [(CKCoreChatController *)self isReadOnly];
    v14 = [MEMORY[0x1E695DF70] array];
    if ([(CKChatController *)self _shouldConfigureChatItemMenuForCommSafety:v8])
    {
      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self _deleteMenuForChatItem:v8];
      }

      else
      {
        [(CKChatController *)self _moreActionForChatItem:v8 configureForCommSafety:1];
      }
      v22 = ;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v22, v22, v14);

      if ([v14 count])
      {
        v12 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 children:v14];
      }

      else
      {
        v12 = 0;
      }
    }

    else
    {
      v15 = [(CKCoreChatController *)self collectionViewController];
      v64 = [v15 balloonViewForChatItem:v9];

      v16 = [(CKChatController *)self _addPollDetailsActionForChatItem:v8 parentChatItem:v9 sourceView:v64];
      v63 = v16;
      v17 = v16;
      if (v16)
      {
        if (CKIsRunningInMessagesViewService())
        {
          [v17 setAttributes:1];
        }

        v18 = MEMORY[0x1E69DCC60];
        v69[0] = v17;
        v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:v69 count:1];
        v20 = [v18 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v19];

        v21 = v20;
      }

      else
      {
        v21 = 0;
      }

      v59 = v21;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v16, v21, v14);
      if (!v13)
      {
        v23 = [(CKChatController *)self _responsesSubmenuForChatItem:v8 withParentChatItem:v9 menuAppearance:a5];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v23, v23, v14);
      }

      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self _exportMenuForChatItem:v8];
      }

      else
      {
        [(CKChatController *)self _exportActionForChatItem:v8 shouldUseTopMostChatItemIfAggregateChatItem:1];
      }
      v62 = ;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v62, v62, v14);
      v61 = [(CKChatController *)self _saveStickerActionForChatItem:v8 sourceView:v64];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v61, v61, v14);
      v60 = [(CKCoreChatController *)self conversation];
      v24 = objc_opt_new();
      v25 = [(CKCoreChatController *)self chat];
      v26 = [v25 supportsCapabilities:1];

      if (((v26 | v13) & 1) != 0 && [v8 canEditMessageText] && !(v13 | ((objc_msgSend(v60, "supportsMessageEditing") & 1) == 0)))
      {
        objc_initWeak(&location, self);
        v58 = MEMORY[0x1E69DC628];
        v27 = CKFrameworkBundle();
        v28 = [v27 localizedStringForKey:@"EDIT_ORB_MENU" value:&stru_1F04268F8 table:@"ChatKit"];
        v29 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"pencil"];
        v65[0] = MEMORY[0x1E69E9820];
        v65[1] = 3221225472;
        v65[2] = __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke_2;
        v65[3] = &unk_1E72EBF48;
        objc_copyWeak(&v67, &location);
        v66 = v8;
        v30 = [v58 actionWithTitle:v28 image:v29 identifier:0 handler:v65];

        [v24 addObject:v30];
        objc_destroyWeak(&v67);
        objc_destroyWeak(&location);
      }

      if ([v8 canRetract] && !(v13 | ((objc_msgSend(v60, "supportsMessageEditing") & 1) == 0)))
      {
        v31 = [(CKChatController *)self _retractionActionForChatItem:v8];
        [v24 addObject:v31];
      }

      if ([v24 count])
      {
        v32 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v24];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v32, v32, v14);
      }

      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self _forwardAndCopyMenuForChatItem:v8];
      }

      else
      {
        [(CKChatController *)self _forwardAndCopyActionsForChatItem:v8];
      }
      v33 = ;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v33, v33, v14);
      if ([MEMORY[0x1E69A8020] supportsSharedWithYou])
      {
        v34 = [(CKChatController *)self _highlightActionForChatItem:v8];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v34, v34, v14);
      }

      if ([CKTranslatorUtilities shouldShowTranslateMenuOption:v8])
      {
        v35 = [CKTranslationMenu translateOrbActionForChatItem:v8 forController:self];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v35, v35, v14);
      }

      v36 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v37 = [v36 isTextSelectionEnabled];

      if (v37 && !CKIsRunningInMacCatalyst())
      {
        v38 = [(CKChatController *)self textSelectionActionWithChatItem:v8];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v38, v38, v14);
      }

      if (CKIsRunningInMacCatalyst())
      {
        v39 = [(CKCoreChatController *)self chat];
        v40 = [v39 isStewieSharingChat];

        if ((v40 & 1) == 0 && [v8 canDelete])
        {
          v41 = [(CKChatController *)self _deleteMenuForChatItem:v8];
          __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v41, v41, v14);
        }

        v42 = [(CKChatController *)self _showTimestampsAction];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v42, v42, v14);
      }

      if (!v13)
      {
        v43 = [(CKChatController *)self _downgradeMessageActionForChatItem:v8];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v43, v43, v14);
      }

      v44 = [(CKChatController *)self _emojiDetailsActionForChatItem:v9];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v44, v44, v14);

      v45 = [(CKChatController *)self _stickerDetailsActionForChatItem:v9];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v45, v45, v14);

      v46 = [(CKChatController *)self _mediaAttributionActionForChatItem:v8];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v46, v46, v14);

      v47 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v48 = [v47 isTranscriptBackgroundsEnabled];

      if (v48)
      {
        v49 = [(CKChatController *)self setBackgroundActionForChatItem:v8];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v49, v49, v14);
      }

      v50 = [(CKChatController *)self _moreActionForChatItem:v8];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v50, v50, v14);

      v51 = [MEMORY[0x1E695E000] standardUserDefaults];
      v52 = [v51 BOOLForKey:@"CKInternalInstallShouldHideDebugMenu"];

      v53 = [MEMORY[0x1E69A60F0] sharedInstance];
      v54 = [v53 isInternalInstall];

      if (!(v52 & 1 | ((v54 & 1) == 0)))
      {
        v55 = [(CKChatController *)self _internalMenuForChatItem:v8];
        [v14 addObject:v55];
      }

      v56 = [v14 count];
      if (v56)
      {
        v56 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 children:v14];
      }

      v12 = v56;
    }
  }

  return v12;
}

void __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v4 = a3;
  if (v5)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [v4 addObjectsFromArray:v5];
    }

    else
    {
      [v4 addObject:v5];
    }
  }
}

void __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionEditIsTappedForChatItem:*(a1 + 32)];
}

- (BOOL)_shouldConfigureChatItemMenuForCommSafety:(id)a3
{
  v39 = *MEMORY[0x1E69E9840];
  v26 = a3;
  v3 = [MEMORY[0x1E69A7FC8] sharedManager];
  v4 = [v3 isFeatureEnabled];

  if (v4 && (([v26 supportsCommunicationSafety] & 1) != 0 || (objc_msgSend(v26, "visibleAssociatedMessageChatItems"), v5 = objc_claimAutoreleasedReturnValue(), v6 = objc_msgSend(v5, "count"), v5, v6)))
  {
    v25 = [MEMORY[0x1E69A5B80] sharedInstance];
    v7 = [v26 commSafetyTransferGUID];
    v24 = [v25 transferForGUID:v7];

    if ([CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:v24])
    {
LABEL_22:
      v22 = 1;
    }

    else
    {
      v36 = 0u;
      v37 = 0u;
      v34 = 0u;
      v35 = 0u;
      v8 = [v26 visibleAssociatedMessageChatItems];
      v9 = [v8 countByEnumeratingWithState:&v34 objects:v38 count:16];
      if (v9)
      {
        v10 = *v35;
        while (2)
        {
          for (i = 0; i != v9; ++i)
          {
            if (*v35 != v10)
            {
              objc_enumerationMutation(v8);
            }

            v12 = *(*(&v34 + 1) + 8 * i);
            v13 = [v12 supportsCommunicationSafety];
            v14 = [v12 commSafetyTransferGUID];
            if (v14)
            {
              v15 = v13;
            }

            else
            {
              v15 = 0;
            }

            if (v15 == 1)
            {
              v16 = [MEMORY[0x1E69A5B80] sharedInstance];
              v17 = [v12 commSafetyTransferGUID];
              v18 = [v16 transferForGUID:v17];

              LOBYTE(v16) = [CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:v18];
              if (v16)
              {

                goto LABEL_22;
              }
            }
          }

          v9 = [v8 countByEnumeratingWithState:&v34 objects:v38 count:16];
          if (v9)
          {
            continue;
          }

          break;
        }
      }

      v30 = 0;
      v31 = &v30;
      v32 = 0x2020000000;
      v33 = 0;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v19 = v26;
        aBlock[0] = MEMORY[0x1E69E9820];
        aBlock[1] = 3221225472;
        aBlock[2] = __84__CKChatController_ClickyOrbConformance___shouldConfigureChatItemMenuForCommSafety___block_invoke;
        aBlock[3] = &unk_1E72EBF70;
        v29 = v25;
        v20 = _Block_copy(aBlock);
        v21 = [v19 text];
        v27[0] = MEMORY[0x1E69E9820];
        v27[1] = 3221225472;
        v27[2] = __84__CKChatController_ClickyOrbConformance___shouldConfigureChatItemMenuForCommSafety___block_invoke_2;
        v27[3] = &unk_1E72EBF98;
        v27[4] = &v30;
        [v21 __im_enumerateAdaptiveImageGlyphFileTransfersUsingFileTransferProvider:v20 block:v27];
      }

      v22 = *(v31 + 24);
      _Block_object_dispose(&v30, 8);
    }
  }

  else
  {
    v22 = 0;
  }

  return v22 & 1;
}

BOOL __84__CKChatController_ClickyOrbConformance___shouldConfigureChatItemMenuForCommSafety___block_invoke_2(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, _BYTE *a5)
{
  result = [CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:a2];
  *(*(*(a1 + 32) + 8) + 24) = result;
  if (*(*(*(a1 + 32) + 8) + 24) == 1)
  {
    *a5 = 1;
  }

  return result;
}

- (id)_highlightActionForChatItem:(id)a3
{
  v4 = a3;
  if ([v4 syndicationBehavior] == 1 && (-[CKCoreChatController chat](self, "chat"), v5 = objc_claimAutoreleasedReturnValue(), v6 = objc_msgSend(v5, "isBusinessChat"), v5, (v6 & 1) == 0))
  {
    v8 = [v4 isHighlighted];
    v9 = CKFrameworkBundle();
    v10 = v9;
    if (v8)
    {
      v11 = @"REMOVE_PIN_ACTION";
    }

    else
    {
      v11 = @"ADD_PIN_ACTION";
    }

    v12 = [v9 localizedStringForKey:v11 value:&stru_1F04268F8 table:@"ChatKit"];

    if ([v4 isHighlighted])
    {
      v13 = @"pin.slash";
    }

    else
    {
      v13 = @"pin";
    }

    v14 = [MEMORY[0x1E69DCAB8] systemImageNamed:v13];
    objc_initWeak(&location, self);
    v15 = MEMORY[0x1E69DC628];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __70__CKChatController_ClickyOrbConformance___highlightActionForChatItem___block_invoke;
    v17[3] = &unk_1E72EBFC0;
    v18 = v4;
    objc_copyWeak(&v20, &location);
    v19 = self;
    v7 = [v15 actionWithTitle:v12 image:v14 identifier:0 handler:v17];
    objc_destroyWeak(&v20);

    objc_destroyWeak(&location);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

void __70__CKChatController_ClickyOrbConformance___highlightActionForChatItem___block_invoke(id *a1)
{
  v2 = [a1[4] isHighlighted];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v4 = [WeakRetained conversation];
  v5 = [v4 chat];
  v6 = [a1[4] IMChatItem];
  v7 = [v6 guid];
  v9 = [a1[4] messagePartRange];
  if (v2)
  {
    v10 = 8;
  }

  else
  {
    v10 = 4;
  }

  [v5 sendSyndicationAction:v10 forMessagePartGUID:v7 syndicatedMessagePartRange:{v9, v8}];

  v11 = [a1[4] IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v13 = [a1[4] IMChatItem];
    v22 = [v13 messageItem];

    v14 = [v22 swyAppName];
    v15 = [v22 swyBundleID];
    v16 = v15;
    if (v14 && v15)
    {
      v17 = [MEMORY[0x1E69A8288] sharedManager];
      v18 = v17;
      if (v2)
      {
        [v17 decrementPinCountForBundleID:v16];
      }

      else
      {
        [v17 incrementPinCountForBundleID:v16];

        v19 = [MEMORY[0x1E69A8288] sharedManager];
        v20 = [v19 getPinCountForBundleID:v16];

        v21 = [MEMORY[0x1E69A8288] isSharedWithYouEnabledForApplicationWithBundleID:v16];
        if (v20 >= 3 && (v21 & 1) == 0)
        {
          [a1[5] _showAutoDonationAlertForAppName:v14 bundleID:v16];
        }
      }
    }
  }
}

- (void)_showAutoDonationAlertForAppName:(id)a3 bundleID:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([v6 length] && objc_msgSend(v7, "length"))
  {
    v8 = MEMORY[0x1E696AEC0];
    v9 = CKFrameworkBundle();
    v10 = [v9 localizedStringForKey:@"SHARED_WITH_YOU_AUTO_DONATION_ALERT" value:&stru_1F04268F8 table:@"ChatKit"];
    v11 = [v8 stringWithFormat:v10, v6, v6];

    v12 = [MEMORY[0x1E69DC668] sharedApplication];
    v13 = [v12 userInterfaceLayoutDirection];

    if (v13 == 1)
    {
      v14 = @"\u200F";
    }

    else
    {
      v14 = @"\u200E";
    }

    v15 = [(__CFString *)v14 stringByAppendingString:v11];

    v16 = [CKAlertController alertControllerWithTitle:v15 message:0 preferredStyle:0];
    v17 = CKFrameworkBundle();
    v18 = [v17 localizedStringForKey:@"SHARED_WITH_YOU_OK_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    v23[0] = MEMORY[0x1E69E9820];
    v23[1] = 3221225472;
    v23[2] = __84__CKChatController_ClickyOrbConformance___showAutoDonationAlertForAppName_bundleID___block_invoke;
    v23[3] = &unk_1E72EBFE8;
    v24 = v7;
    v19 = [CKAlertAction actionWithTitle:v18 style:0 handler:v23];
    [v16 addAction:v19];

    v20 = CKFrameworkBundle();
    v21 = [v20 localizedStringForKey:@"SHARED_WITH_YOU_CANCEL_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    v22 = [CKAlertAction actionWithTitle:v21 style:1 handler:0];
    [v16 addAction:v22];

    [(CKChatController *)self presentViewController:v16 animated:1 completion:0];
  }

  else
  {
    v15 = IMLogHandleForCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      [(CKChatController(ClickyOrbConformance) *)v6 _showAutoDonationAlertForAppName:v7 bundleID:v15];
    }
  }
}

- (id)_responsesSubmenuForChatItem:(id)a3 withParentChatItem:(id)a4 menuAppearance:(int64_t)a5
{
  v8 = a3;
  v9 = MEMORY[0x1E695DF70];
  v10 = a4;
  v11 = [v9 array];
  if (a5 == 2 || CKIsRunningInMacCatalyst())
  {
    v12 = [(CKChatController *)self tapbackMenuElementsForChatItem:v8];
    v13 = v12;
    if (v12 && [v12 count])
    {
      if (CKIsRunningInMacCatalyst())
      {
        [v11 addObjectsFromArray:v13];
      }

      else
      {
        v14 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v13];
        [v11 addObject:v14];
      }
    }
  }

  v15 = [(CKChatController *)self _inlineReplyActionForChatItem:v8];
  if (v15)
  {
    [v11 addObject:v15];
  }

  v16 = [(CKCoreChatController *)self collectionViewController];
  v17 = [v16 balloonViewForChatItem:v10];

  v18 = [(CKChatController *)self _addStickerActionForChatItem:v8 parentChatItem:v10 sourceView:v17];

  if (v18)
  {
    if (CKIsRunningInMessagesViewService())
    {
      [v18 setAttributes:1];
    }

    [v11 addObject:v18];
  }

  if ([v11 count])
  {
    v19 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v11];
  }

  else
  {
    v19 = 0;
  }

  return v19;
}

- (id)_inlineReplyActionForChatItem:(id)a3
{
  v4 = a3;
  if ([(CKCoreChatController *)self wantsReplyButton])
  {
    objc_initWeak(&location, self);
    if (CKIsRunningInMacCatalyst())
    {
      v5 = CKFrameworkBundle();
      [v5 localizedStringForKey:@"INLINE_REPLY_MENU" value:&stru_1F04268F8 table:@"ChatKit"];
    }

    else
    {
      v5 = CKFrameworkBundle();
      [v5 localizedStringForKey:@"INLINE_REPLY_ORB_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    }
    v7 = ;

    v8 = MEMORY[0x1E69DC628];
    v9 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"arrowshape.turn.up.backward"];
    v11 = MEMORY[0x1E69E9820];
    v12 = 3221225472;
    v13 = __72__CKChatController_ClickyOrbConformance___inlineReplyActionForChatItem___block_invoke;
    v14 = &unk_1E72EBCD8;
    objc_copyWeak(&v15, &location);
    v6 = [v8 actionWithTitle:v7 image:v9 identifier:0 handler:&v11];

    if (([v4 canInlineReply] & 1) == 0)
    {
      [v6 setAttributes:1];
    }

    objc_destroyWeak(&v15);

    objc_destroyWeak(&location);
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

void __72__CKChatController_ClickyOrbConformance___inlineReplyActionForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = [WeakRetained collectionViewController];

  if (CKIsRunningInMacCatalyst())
  {
    [v5 hideTranscriptTimestampsIfNeeded];
  }

  v3 = [v5 collectionView];
  [v3 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerClickyOrb"];

  v4 = objc_loadWeakRetained((a1 + 32));
  [v4 setWantsInlineOverlay:1];
}

- (BOOL)_shouldShowSaveStickerActionForChatItem:(id)a3
{
  v3 = [CKUtilities saveableStickerFromChatItem:a3];

  return v3 != 0;
}

- (id)_saveStickerActionForChatItem:(id)a3 sourceView:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([(CKChatController *)self _shouldShowSaveStickerActionForChatItem:v6])
  {
    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"SAVE_TO_STICKERS" value:&stru_1F04268F8 table:@"ChatKit"];

    v10 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"square.and.arrow.down"];
    objc_initWeak(&location, self);
    v11 = MEMORY[0x1E69DC628];
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __83__CKChatController_ClickyOrbConformance___saveStickerActionForChatItem_sourceView___block_invoke;
    v14[3] = &unk_1E72EBFC0;
    v15 = v7;
    objc_copyWeak(&v17, &location);
    v16 = v6;
    v12 = [v11 actionWithTitle:v9 image:v10 identifier:0 handler:v14];

    objc_destroyWeak(&v17);
    objc_destroyWeak(&location);
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

void __83__CKChatController_ClickyOrbConformance___saveStickerActionForChatItem_sourceView___block_invoke(uint64_t a1)
{
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 shouldAnimateStickerOnSave];

  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v4 = *(a1 + 32);
  }

  v5 = v4;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained saveStickerFromChatItem:*(a1 + 40) pluginSourceView:v5 animateFlyIn:v3];
}

- (id)_addStickerActionForChatItem:(id)a3 parentChatItem:(id)a4 sourceView:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v12 = [v11 isReactWithAStickerEnabled];

  if (!v12 || [(CKChatController *)self _shouldShowSaveStickerActionForChatItem:v8])
  {
    goto LABEL_11;
  }

  v13 = [(CKCoreChatController *)self chat];
  if (![v13 supportsCapabilities:0x8000] || !objc_msgSend(v8, "canAttachStickers"))
  {
    goto LABEL_10;
  }

  v14 = [(CKCoreChatController *)self chat];
  if (([v14 canSend] & 1) == 0)
  {

LABEL_10:
    goto LABEL_11;
  }

  v15 = [(CKCoreChatController *)self isReadOnly];

  if (!v15)
  {
    objc_initWeak(&location, self);
    if (CKIsRunningInMacCatalyst())
    {
      v16 = CKFrameworkBundle();
      [v16 localizedStringForKey:@"ATTACH_STICKER_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];
    }

    else
    {
      v16 = CKFrameworkBundle();
      [v16 localizedStringForKey:@"ATTACH_STICKER" value:&stru_1F04268F8 table:@"ChatKit"];
    }
    v19 = ;

    v20 = MEMORY[0x1E69DC628];
    v21 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"sticker.badge.plus"];
    v22[0] = MEMORY[0x1E69E9820];
    v22[1] = 3221225472;
    v22[2] = __97__CKChatController_ClickyOrbConformance___addStickerActionForChatItem_parentChatItem_sourceView___block_invoke;
    v22[3] = &unk_1E72EC010;
    objc_copyWeak(&v26, &location);
    v23 = v8;
    v24 = v9;
    v25 = v10;
    v17 = [v20 actionWithTitle:v19 image:v21 identifier:0 handler:v22];

    objc_destroyWeak(&v26);
    objc_destroyWeak(&location);
    goto LABEL_12;
  }

LABEL_11:
  v17 = 0;
LABEL_12:

  return v17;
}

void __97__CKChatController_ClickyOrbConformance___addStickerActionForChatItem_parentChatItem_sourceView___block_invoke(uint64_t a1)
{
  v2 = IMStickersExtensionIdentifier();
  v22 = IMBalloonExtensionIDWithSuffix();

  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v4 = [WeakRetained inputController];
  v5 = [v4 appPresentationStyleForShowingPluginID:v22];

  v6 = objc_loadWeakRetained((a1 + 56));
  [v6 setIgnoresAutomaticScrollsTowardBottom:1];

  if (!v5)
  {
    v7 = objc_loadWeakRetained((a1 + 56));
    [v7 updateChatItemBalloonViewAndStickerViews:*(a1 + 32) hidden:1];

    v8 = objc_loadWeakRetained((a1 + 56));
    [v8 showFullScreenBalloonFocusForChatItem:*(a1 + 40)];
  }

  v9 = objc_loadWeakRetained((a1 + 56));
  [v9 dismissKeyboard];

  v10 = objc_loadWeakRetained((a1 + 56));
  v11 = [v10 inputController];
  v12 = *(a1 + 32);
  v13 = objc_loadWeakRetained((a1 + 56));
  v14 = [v13 collectionViewController];
  v15 = [v14 cellForChatItem:*(a1 + 32)];
  [v11 beginStickerReactionSessionWithChatItem:v12 cell:v15];

  v16 = objc_loadWeakRetained((a1 + 56));
  v17 = [v16 inputController];
  [v17 showPluginWithExtensionIdentifier:v22 sourceView:*(a1 + 48)];

  v18 = objc_loadWeakRetained((a1 + 56));
  v19 = [v18 inputController];
  [v19 setStickerPickerMessagePartChatItem:*(a1 + 32)];

  v20 = objc_loadWeakRetained((a1 + 56));
  v21 = [v20 inputController];
  [v21 setStickerPickerMessagePartParentChatItem:*(a1 + 40)];
}

- (id)_addPollDetailsActionForChatItem:(id)a3 parentChatItem:(id)a4 sourceView:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v12 = [v11 isPollsEnabled];

  if (v12 && [(CKChatController *)self _shouldShowPollDetailsActionForChatItem:v8])
  {
    objc_initWeak(&location, self);
    v13 = CKFrameworkBundle();
    v14 = [v13 localizedStringForKey:@"POLL_DETAILS" value:&stru_1F04268F8 table:@"ChatKit"];

    v15 = MEMORY[0x1E69DC628];
    v16 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"info.circle"];
    v19[0] = MEMORY[0x1E69E9820];
    v19[1] = 3221225472;
    v19[2] = __101__CKChatController_ClickyOrbConformance___addPollDetailsActionForChatItem_parentChatItem_sourceView___block_invoke;
    v19[3] = &unk_1E72EC038;
    objc_copyWeak(&v22, &location);
    v20 = v8;
    v21 = v10;
    v17 = [v15 actionWithTitle:v14 image:v16 identifier:0 handler:v19];

    objc_destroyWeak(&v22);
    objc_destroyWeak(&location);
  }

  else
  {
    v17 = 0;
  }

  return v17;
}

void __101__CKChatController_ClickyOrbConformance___addPollDetailsActionForChatItem_parentChatItem_sourceView___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained displayPollDetailsForChatItem:*(a1 + 32) sourceView:*(a1 + 40)];
}

- (id)_retractionActionForChatItem:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  if ([v4 scheduleType] == 2 && objc_msgSend(v4, "scheduleState") == 2)
  {
    v5 = CKFrameworkBundle();
    v6 = [v5 localizedStringForKey:@"DELETE_SCHEDULED_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];

    v7 = +[CKUIBehavior sharedBehaviors];
    v8 = [v7 contextMenuCancelScheduledMessageIcon];

    v9 = MEMORY[0x1E69DC628];
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke;
    v20[3] = &unk_1E72EBF48;
    v10 = &v22;
    objc_copyWeak(&v22, &location);
    v21 = v4;
    v11 = [v9 actionWithTitle:v6 image:v8 identifier:0 handler:v20];
    v12 = &v21;
    if (!CKIsRunningInMacCatalyst())
    {
      [v11 setAttributes:2];
    }
  }

  else
  {
    v13 = CKFrameworkBundle();
    v6 = [v13 localizedStringForKey:@"UNDO_SEND_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];

    v14 = +[CKUIBehavior sharedBehaviors];
    v8 = [v14 contextMenuUndoSendIcon];

    v15 = MEMORY[0x1E69DC628];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke_2;
    v17[3] = &unk_1E72EBF48;
    v10 = &v19;
    objc_copyWeak(&v19, &location);
    v18 = v4;
    v11 = [v15 actionWithTitle:v6 image:v8 identifier:0 handler:v17];
    v12 = &v18;
  }

  objc_destroyWeak(v10);
  objc_destroyWeak(&location);

  return v11;
}

void __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionCancelIsTappedForChatItem:*(a1 + 32)];
}

void __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionRetractIsTappedForChatItem:*(a1 + 32)];
}

- (void)showFullScreenBalloonFocusForChatItem:(id)a3
{
  v27 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v25 = 138412290;
      v26 = v4;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "showFullScreenBalloonFocusForChatItem, chatItem: %@", &v25, 0xCu);
    }
  }

  v6 = [(CKCoreChatController *)self chat];
  [v6 beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57A0]];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"FullscreenBalloonMenuVisible"];
  v7 = [(CKCoreChatController *)self inputController];
  v8 = [v7 isAppCardPresented];

  v9 = [CKFullScreenBalloonViewDisplayConfiguration addStickerContextDismissingAppCardOnExit:v8 ^ 1u];
  v10 = [(CKCoreChatController *)self generateFullScreenBalloonViewControllerWithChatItem:v4 displayConfiguration:v9];
  [(CKCoreChatController *)self setFullScreenBalloonViewController:v10];
  v11 = +[CKUIBehavior sharedBehaviors];
  if ([v11 canPresentOverKeyboard])
  {
    v12 = 0;
  }

  else
  {
    v12 = 6;
  }

  [v10 setModalPresentationStyle:v12];

  [(CKChatController *)self addChildViewController:v10];
  v13 = [(CKChatController *)self view];
  v14 = [v10 view];
  [v13 addSubview:v14];

  [v10 didMoveToParentViewController:self];
  v15 = [(CKChatController *)self view];
  [v15 bounds];
  v17 = v16;
  v18 = [(CKChatController *)self view];
  [v18 bounds];
  v20 = v19;
  v21 = [v10 view];
  [v21 setFrame:{0.0, 0.0, v17, v20}];

  v22 = [v10 view];
  [v22 setNeedsLayout];

  v23 = [v10 view];
  [v23 layoutIfNeeded];

  if (![(CKCoreChatController *)self isInline])
  {
    [(CKChatController *)self _updateNavigationButtons];
  }

  if (IMOSLoggingEnabled())
  {
    v24 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      LOWORD(v25) = 0;
      _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "showFullScreenBalloonFocusForChatItem: _fullScreenBalloonViewController has been presented", &v25, 2u);
    }
  }
}

- (id)_forwardAndCopyMenuForChatItem:(id)a3
{
  v3 = [(CKChatController *)self _forwardAndCopyActionsForChatItem:a3];
  if ([v3 count])
  {
    v4 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_forwardAndCopyActionsForChatItem:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E695DF70] array];
  v6 = [(CKChatController *)self _forwardActionForChatItem:v4];
  if (v6)
  {
    [v5 addObject:v6];
  }

  v7 = [(CKChatController *)self _copyActionForChatItem:v4 shouldUseTopMostChatItemIfAggregateChatItem:1];
  if (v7)
  {
    [v5 addObject:v7];
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = [(CKChatController *)self _copyActionForChatItem:v4 shouldUseTopMostChatItemIfAggregateChatItem:0];
      if (v8)
      {
        [v5 addObject:v8];
      }
    }
  }

  return v5;
}

- (id)_forwardActionForChatItem:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  if (CKIsRunningInMacCatalyst() && !-[CKCoreChatController isInline](self, "isInline") && [v4 canForward])
  {
    v5 = MEMORY[0x1E69DC628];
    v6 = CKFrameworkBundle();
    v7 = [v6 localizedStringForKey:@"FORWARD_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];
    v8 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"arrowshape.turn.up.forward"];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __68__CKChatController_ClickyOrbConformance___forwardActionForChatItem___block_invoke;
    v11[3] = &unk_1E72EBF48;
    objc_copyWeak(&v13, &location);
    v12 = v4;
    v9 = [v5 actionWithTitle:v7 image:v8 identifier:0 handler:v11];

    objc_destroyWeak(&v13);
  }

  else
  {
    v9 = 0;
  }

  objc_destroyWeak(&location);

  return v9;
}

void __68__CKChatController_ClickyOrbConformance___forwardActionForChatItem___block_invoke(uint64_t a1)
{
  v25[1] = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setIsShowingPreview:0];

  v3 = +[CKUIBehavior sharedBehaviors];
  v4 = [v3 enableBalloonTextSelection];

  if (v4)
  {
    v5 = objc_loadWeakRetained((a1 + 40));
    v6 = [v5 collectionViewController];
    v7 = [v6 selectedChatItems];

    if (![v7 count])
    {
      v25[0] = *(a1 + 32);
      v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:1];

      v7 = v8;
    }

    v9 = objc_loadWeakRetained((a1 + 40));
    v10 = [v9 entryView];
    v11 = [v10 shouldShowSubject];
    v12 = objc_loadWeakRetained((a1 + 40));
    v13 = [v12 chatInputTranscriptIdentifier];
    v14 = [CKComposition compositionForMessageParts:v7 preserveSubject:v11 contextIdentifier:v13];

    v15 = objc_loadWeakRetained((a1 + 40));
    v16 = [v15 delegate];
    v17 = objc_loadWeakRetained((a1 + 40));
    [v16 chatController:v17 forwardComposition:v14];
  }

  else
  {
    v24 = *(a1 + 32);
    v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v24 count:1];
    v19 = objc_loadWeakRetained((a1 + 40));
    v20 = [v19 entryView];
    v21 = [v20 shouldShowSubject];
    v22 = objc_loadWeakRetained((a1 + 40));
    v23 = [v22 chatInputTranscriptIdentifier];
    v7 = [CKComposition compositionForMessageParts:v18 preserveSubject:v21 contextIdentifier:v23];

    v14 = objc_loadWeakRetained((a1 + 40));
    v15 = [v14 delegate];
    v16 = objc_loadWeakRetained((a1 + 40));
    [v15 chatController:v16 forwardComposition:v7];
  }
}

- (id)_copyActionForChatItem:(id)a3 shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)a4
{
  v4 = a4;
  v35 = *MEMORY[0x1E69E9840];
  v6 = a3;
  if ([v6 canCopy])
  {
    v7 = v6;
    if (v4)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v8 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v7];

        v7 = v8;
      }
    }

    v9 = CKFrameworkBundle();
    v10 = [v9 localizedStringForKey:@"COPY" value:&stru_1F04268F8 table:@"ChatKit"];

    if (!v4)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v26 = self;
        v27 = v10;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        v25 = v7;
        v11 = [v25 mediaObjects];
        v12 = [v11 countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v12)
        {
          v13 = v12;
          v14 = 0;
          v15 = 0;
          v16 = 0;
          v17 = *v31;
          do
          {
            for (i = 0; i != v13; ++i)
            {
              if (*v31 != v17)
              {
                objc_enumerationMutation(v11);
              }

              v19 = *(*(&v30 + 1) + 8 * i);
              if ([v19 mediaType] == 2)
              {
                ++v15;
              }

              else if ([v19 mediaType] == 3)
              {
                ++v14;
              }

              else
              {
                ++v16;
              }
            }

            v13 = [v11 countByEnumeratingWithState:&v30 objects:v34 count:16];
          }

          while (v13);
        }

        else
        {
          v14 = 0;
          v15 = 0;
          v16 = 0;
        }

        v10 = [(CKChatController *)v26 _localizedTitleStringForAggregateAction:0 numberOfPhotos:v14 numberOfVideos:v15 numberOfOther:v16];
      }
    }

    v21 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"doc.on.doc"];
    v22 = MEMORY[0x1E69DC628];
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __109__CKChatController_ClickyOrbConformance___copyActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke;
    v28[3] = &unk_1E72EC060;
    v29 = v7;
    v23 = v7;
    v20 = [v22 actionWithTitle:v10 image:v21 identifier:0 handler:v28];
  }

  else
  {
    v20 = 0;
  }

  return v20;
}

void __109__CKChatController_ClickyOrbConformance___copyActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) pasteboardItemProviders];
  v1 = [MEMORY[0x1E69DCD50] generalPasteboard];
  [v1 setItemProviders:v2];
}

- (id)_deleteMenuForChatItem:(id)a3
{
  v3 = [(CKChatController *)self _deleteActionsForChatItem:a3];
  if ([v3 count])
  {
    v4 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_deleteActionsForChatItem:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E695DF70] array];
  v6 = [(CKChatController *)self _deleteActionForChatItem:v4 shouldUseTopMostChatItemIfAggregateChatItem:1];
  if (v6)
  {
    [v5 addObject:v6];
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = [(CKChatController *)self _deleteActionForChatItem:v4 shouldUseTopMostChatItemIfAggregateChatItem:0];
      if (v7)
      {
        [v5 addObject:v7];
      }
    }
  }

  return v5;
}

- (id)_deleteActionForChatItem:(id)a3 shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)a4
{
  v4 = a4;
  v35 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = v5;
  if (v4)
  {
    objc_opt_class();
    v6 = v5;
    if (objc_opt_isKindOfClass())
    {
      v6 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v5];
    }
  }

  if (v6)
  {
    v7 = CKFrameworkBundle();
    v25 = [v7 localizedStringForKey:@"DELETE_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];

    if (!v4)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        v23 = v6;
        v8 = [v23 mediaObjects];
        v9 = 0;
        v10 = 0;
        v11 = 0;
        v12 = [v8 countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v12)
        {
          v13 = *v31;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v31 != v13)
              {
                objc_enumerationMutation(v8);
              }

              v15 = *(*(&v30 + 1) + 8 * i);
              if ([v15 mediaType] == 2)
              {
                ++v10;
              }

              else if ([v15 mediaType] == 3)
              {
                ++v9;
              }

              else
              {
                ++v11;
              }
            }

            v12 = [v8 countByEnumeratingWithState:&v30 objects:v34 count:16];
          }

          while (v12);
        }

        v16 = [(CKChatController *)self _localizedTitleStringForAggregateAction:1 numberOfPhotos:v9 numberOfVideos:v10 numberOfOther:v11];

        v25 = v16;
      }
    }

    v17 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"trash"];
    objc_initWeak(&location, self);
    v18 = MEMORY[0x1E69DC628];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __111__CKChatController_ClickyOrbConformance___deleteActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke;
    v26[3] = &unk_1E72EBF48;
    objc_copyWeak(&v28, &location);
    v27 = v6;
    v19 = [v18 actionWithTitle:v25 image:v17 identifier:0 handler:v26];
    [v19 setAttributes:2];

    objc_destroyWeak(&v28);
    objc_destroyWeak(&location);

    v20 = v25;
  }

  else
  {
    v21 = IMLogHandleForCategory();
    v20 = v21;
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(ClickyOrbConformance) _deleteActionForChatItem:shouldUseTopMostChatItemIfAggregateChatItem:];
      v19 = 0;
      v20 = v21;
    }

    else
    {
      v19 = 0;
    }
  }

  return v19;
}

void __111__CKChatController_ClickyOrbConformance___deleteActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke(uint64_t a1)
{
  v5[1] = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained collectionViewController];
  v5[0] = *(a1 + 32);
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v5 count:1];
  [v3 deleteChatItems:v4 sender:0];
}

- (id)_exportMenuForChatItem:(id)a3
{
  v3 = [(CKChatController *)self _exportActionsForChatItem:a3];
  if ([v3 count])
  {
    v4 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_exportActionsForChatItem:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E695DF70] array];
  v6 = [(CKChatController *)self _exportActionForChatItem:v4 shouldUseTopMostChatItemIfAggregateChatItem:1];
  if (v6)
  {
    [v5 addObject:v6];
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = [(CKChatController *)self _exportActionForChatItem:v4 shouldUseTopMostChatItemIfAggregateChatItem:0];
      if (v7)
      {
        [v5 addObject:v7];
      }
    }
  }

  return v5;
}

- (id)_exportActionForChatItem:(id)a3 shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)a4
{
  v38 = a4;
  v54 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v40 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"square.and.arrow.down"];
  if (![v4 canExport])
  {
    v9 = 0;
    goto LABEL_49;
  }

  v5 = v4;
  if (v38 && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
  {
    v6 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v5];

    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v53 = v5;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Request to export top-most chat item for chatItem: %@", buf, 0xCu);
      }
    }

    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v53 = v6;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Request to export top-most chat item for chatItemToExport: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    v6 = v5;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v6;
    v37 = [v10 mediaObjects];
    v36 = [v10 momentShareURL];
  }

  else
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v10 = v6;
      v11 = [v10 mediaObject];
      v12 = v11;
      if (v11)
      {
        v51 = v11;
        v37 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v51 count:1];
        v36 = CKMomentShareURLForMediaObjects(v37);
      }

      else
      {
        v13 = IMLogHandleForCategory();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(ClickyOrbConformance) _exportActionForChatItem:shouldUseTopMostChatItemIfAggregateChatItem:];
        }

        v36 = 0;
        v37 = 0;
      }
    }

    else
    {
      v10 = IMLogHandleForCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(ClickyOrbConformance) _exportActionForChatItem:shouldUseTopMostChatItemIfAggregateChatItem:];
      }

      v36 = 0;
      v37 = 0;
    }
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (CKIsRunningInMacCatalyst())
    {
      v48 = 0u;
      v49 = 0u;
      v46 = 0u;
      v47 = 0u;
      v17 = v37;
      v18 = [v17 countByEnumeratingWithState:&v46 objects:v50 count:16];
      if (v18)
      {
        v19 = 0;
        v20 = 0;
        v21 = 0;
        v22 = *v47;
        do
        {
          for (i = 0; i != v18; ++i)
          {
            if (*v47 != v22)
            {
              objc_enumerationMutation(v17);
            }

            v24 = *(*(&v46 + 1) + 8 * i);
            if ([v24 mediaType] == 2)
            {
              ++v20;
            }

            else if ([v24 mediaType] == 3)
            {
              ++v19;
            }

            else
            {
              ++v21;
            }
          }

          v18 = [v17 countByEnumeratingWithState:&v46 objects:v50 count:16];
        }

        while (v18);

        if (v21)
        {
          v16 = CKFrameworkBundle();
          v25 = [v16 localizedStringForKey:@"SAVE_TO_DOWNLOADS" value:&stru_1F04268F8 table:@"ChatKit"];
LABEL_47:
          v15 = v25;
          goto LABEL_48;
        }
      }

      else
      {

        v20 = 0;
        v19 = 0;
      }

      if (!v38)
      {
        if (v20)
        {
          v31 = 1;
        }

        else
        {
          v31 = v19 == 0;
        }

        if (v19 == 0 && v20 != 0)
        {
          v32 = @"_VIDEOS";
        }

        else
        {
          v32 = @"_ITEMS";
        }

        if (v31)
        {
          v33 = v32;
        }

        else
        {
          v33 = @"_PHOTOS";
        }

        v16 = [@"ADD_ALL_TO_PHOTOS_LIBRARY" stringByAppendingFormat:v33];
        v34 = CKFrameworkBundle();
        v15 = [v34 localizedStringForKey:v16 value:&stru_1F04268F8 table:@"ChatKit"];

        v35 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"square.and.arrow.down.on.square"];

        v40 = v35;
        goto LABEL_48;
      }

      v16 = CKFrameworkBundle();
      v25 = [v16 localizedStringForKey:@"ADD_TO_PHOTOS_LIBRARY" value:&stru_1F04268F8 table:@"ChatKit"];
      goto LABEL_47;
    }

    v16 = CKFrameworkBundle();
    v25 = [v16 localizedStringForKey:@"BALLOON_EXPORT_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
    goto LABEL_47;
  }

  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"AUDIO_MESSAGE_SAVE" value:&stru_1F04268F8 table:@"ChatKit"];

  [MEMORY[0x1E69DCAB8] systemImageNamed:@"waveform.badge.plus"];
  v40 = v16 = v40;
LABEL_48:

  v26 = MEMORY[0x1E69DC628];
  v41[0] = MEMORY[0x1E69E9820];
  v41[1] = 3221225472;
  v41[2] = __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke;
  v41[3] = &unk_1E72EC0B0;
  v42 = v6;
  v43 = v37;
  v44 = v36;
  v45 = self;
  v27 = v36;
  v28 = v37;
  v29 = v6;
  v9 = [v26 actionWithTitle:v15 image:v40 identifier:0 handler:v41];

LABEL_49:

  return v9;
}

void __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = [*(a1 + 32) canPerformQuickAction];
  v5 = IMOSLoggingEnabled();
  if (v4)
  {
    if (v5)
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = [*(a1 + 40) count];
        *buf = 134217984;
        v14 = v7;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Will quick save %tu items", buf, 0xCu);
      }
    }

    v8 = [CKUtilities quickSaveConfirmationAlertForMediaObjects:*(a1 + 40) momentShareURL:*(a1 + 48) popoverSource:0 metricsSource:*MEMORY[0x1E69A7658] cancelHandler:0 preSaveHandler:0 postSaveHandler:0 postAnyActionHandler:0];
    if (v8)
    {
      [*(a1 + 56) presentViewController:v8 animated:1 completion:0];
    }
  }

  else
  {
    if (v5)
    {
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = [*(a1 + 40) count];
        *buf = 134217984;
        v14 = v10;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Will save %tu items", buf, 0xCu);
      }
    }

    v8 = [[CKMediaObjectExportManager alloc] initWithMediaObjects:*(a1 + 40)];
    [(CKMediaObjectExportManager *)v8 setMetricsSource:*MEMORY[0x1E69A7658]];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412;
    v11[3] = &unk_1E72EC088;
    v12 = *(a1 + 40);
    [(CKMediaObjectExportManager *)v8 exportQueuedMediaObjectsWithCompletion:v11];
  }
}

void __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412(uint64_t a1, int a2, void *a3)
{
  v11 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (a2)
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = [*(a1 + 32) count];
        v9 = 134217984;
        v10 = v7;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Successfully saved %tu items", &v9, 0xCu);
      }
    }
  }

  else
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412_cold_1(v5, a1, v8);
    }
  }
}

- (id)_downgradeMessageActionForChatItem:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  if (![v4 canSendAsTextMessage])
  {
    v11 = 0;
    goto LABEL_11;
  }

  v5 = [v4 IMChatItem];
  v6 = [v4 IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) == 0)
  {
    v11 = 0;
    goto LABEL_10;
  }

  v8 = [v5 message];
  v9 = objc_loadWeakRetained(&location);
  v10 = [v9 conversation];

  if (!-[CKChatController _smsEnabled](self, "_smsEnabled") || ![v8 isFromMe] || (objc_msgSend(v8, "isDelivered") & 1) != 0)
  {
    goto LABEL_6;
  }

  v13 = [v8 error];
  if (v13)
  {
    v11 = 0;
LABEL_16:

    goto LABEL_7;
  }

  if (([v10 isGroupConversation] & 1) == 0)
  {
    v14 = objc_loadWeakRetained(&location);
    v15 = [v14 collectionViewController];
    v16 = [v15 chatItems];

    v17 = [v8 guid];
    v18 = [v16 __ck_indexesOfPartsOfMessageWithGUID:v17];
    v19 = [v16 objectsAtIndexes:v18];

    v20 = objc_loadWeakRetained(&location);
    v21 = [v20 textInputContextIdentifier];
    v22 = [CKComposition compositionForMessageParts:v19 preserveSubject:1 contextIdentifier:v21];

    LOBYTE(v20) = [v10 canSendComposition:v22 error:0];
    if (v20)
    {
      v13 = [v10 fallbackSendString];
      v23 = MEMORY[0x1E69DC628];
      v24 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"arrow.up.circle"];
      v25[0] = MEMORY[0x1E69E9820];
      v25[1] = 3221225472;
      v25[2] = __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke;
      v25[3] = &unk_1E72EC0D8;
      v26 = v8;
      v27 = v10;
      objc_copyWeak(&v28, &location);
      v11 = [v23 actionWithTitle:v13 image:v24 identifier:0 handler:v25];

      objc_destroyWeak(&v28);
      goto LABEL_16;
    }
  }

LABEL_6:
  v11 = 0;
LABEL_7:

LABEL_10:
LABEL_11:
  objc_destroyWeak(&location);

  return v11;
}

void __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke(id *a1, void *a2)
{
  v22 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    CKLogCStringForType(29);
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = [a1[4] guid];
      v6 = a1[5];
      *buf = 138412546;
      v19 = v5;
      v20 = 2112;
      v21 = v6;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Manually downgrading message with GUID {%@} -- conversation:%@", buf, 0x16u);
    }
  }

  if (os_log_shim_legacy_logging_enabled() && _CKShouldLogExternal())
  {
    v13 = [a1[4] guid];
    v14 = a1[5];
    _CKLogExternal();
  }

  v7 = a1 + 5;
  v8 = [a1[5] chat];
  [v8 downgradeMessage:a1[4] manualDowngrade:1];

  v9 = [a1[4] __ck_downgradedMessage];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v11 = [WeakRetained collectionViewController];
  v15[0] = MEMORY[0x1E69E9820];
  v15[1] = 3221225472;
  v15[2] = __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke_421;
  v15[3] = &unk_1E72EB8D0;
  v16 = *v7;
  v17 = v9;
  v12 = v9;
  [v11 updateTranscript:v15 animated:0 completion:0];
}

void __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke_421(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = [MEMORY[0x1E69A5C90] smsService];
  [v1 sendMessage:v2 onService:v3 newComposition:0];
}

- (id)_stickerDetailsActionForChatItem:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  v5 = [v4 visibleAssociatedMessageChatItems];

  if (v5)
  {
    v6 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v7 = [v4 visibleAssociatedMessageChatItems];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke;
    v17[3] = &unk_1E72EC100;
    v8 = v6;
    v18 = v8;
    [v7 enumerateObjectsUsingBlock:v17];

    if ([v8 count])
    {
      v9 = MEMORY[0x1E69DC628];
      v10 = CKFrameworkBundle();
      v11 = [v10 localizedStringForKey:@"BALLOON_STICKER_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v12 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"info.circle"];
      v15[0] = MEMORY[0x1E69E9820];
      v15[1] = 3221225472;
      v15[2] = __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke_2;
      v15[3] = &unk_1E72EBCD8;
      objc_copyWeak(&v16, &location);
      v13 = [v9 actionWithTitle:v11 image:v12 identifier:0 handler:v15];

      objc_destroyWeak(&v16);
    }

    else
    {
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  objc_destroyWeak(&location);

  return v13;
}

void __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [*(a1 + 32) addObject:v3];
  }
}

void __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setWantsStickerDetails:1];
}

- (id)_emojiDetailsActionForChatItem:(id)a3
{
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
    v6 = [v5 emojiImageMediaObjectsInMessagePartText];
    if ([v6 count])
    {
      v7 = CKFrameworkBundle();
      v8 = [v7 localizedStringForKey:@"EMOJI_DETAILS_CONTEXT_MENU_ACTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v9 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"info.circle"];
      objc_initWeak(&location, self);
      v10 = MEMORY[0x1E69DC628];
      v13[0] = MEMORY[0x1E69E9820];
      v13[1] = 3221225472;
      v13[2] = __73__CKChatController_ClickyOrbConformance___emojiDetailsActionForChatItem___block_invoke;
      v13[3] = &unk_1E72EBCD8;
      objc_copyWeak(&v14, &location);
      v11 = [v10 actionWithTitle:v8 image:v9 identifier:0 handler:v13];
      objc_destroyWeak(&v14);
      objc_destroyWeak(&location);
    }

    else
    {
      v11 = 0;
    }
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

void __73__CKChatController_ClickyOrbConformance___emojiDetailsActionForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setWantsEmojiDetails:1];
}

- (id)_showTimestampsAction
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 toggleTimeStampAction];

  return v3;
}

- (id)_mediaAttributionActionForChatItem:(id)a3
{
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = [v4 mediaObject];
    v6 = [v5 transfer];
    v7 = [v6 attributionInfo];

    if (v7)
    {
      v8 = [v7 objectForKeyedSubscript:@"bundle-id"];
      if ([v8 isEqualToString:@"com.apple.messages.MSMessageExtensionBalloonPlugin:0000000000:com.apple.Stickers.UserGenerated.MessagesExtension"])
      {
        if (IMOSLoggingEnabled())
        {
          v9 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
          {
            LOWORD(buf[0]) = 0;
            _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Not showing media attribution action: user generation sticker plugin", buf, 2u);
          }
        }

        v10 = 0;
      }

      else
      {
        v13 = [v7 __ck_localizedAppNameForTranscriptAttribution];
        if (v13)
        {
          objc_initWeak(buf, self);
          v14 = MEMORY[0x1E69DC628];
          v15 = MEMORY[0x1E696AEC0];
          v16 = CKFrameworkBundle();
          v17 = [v16 localizedStringForKey:@"MEDIA_ATTRIBUTION_TITLE_FORMAT" value:&stru_1F04268F8 table:@"ChatKit"];
          v18 = [v15 stringWithFormat:v17, v13];

          v19 = [MEMORY[0x1E69DC668] sharedApplication];
          v20 = [v19 userInterfaceLayoutDirection];

          if (v20 == 1)
          {
            v21 = @"\u200F";
          }

          else
          {
            v21 = @"\u200E";
          }

          v22 = [(__CFString *)v21 stringByAppendingString:v18];

          v23 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"appstore.capsule"];
          v26[0] = MEMORY[0x1E69E9820];
          v26[1] = 3221225472;
          v26[2] = __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke;
          v26[3] = &unk_1E72EC0D8;
          v27 = v7;
          v28 = v5;
          objc_copyWeak(&v29, buf);
          v10 = [v14 actionWithTitle:v22 image:v23 identifier:0 handler:v26];

          objc_destroyWeak(&v29);
          objc_destroyWeak(buf);
        }

        else
        {
          if (IMOSLoggingEnabled())
          {
            v24 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
            {
              LOWORD(buf[0]) = 0;
              _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "Not showing media attribution action: title is nil", buf, 2u);
            }
          }

          v10 = 0;
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          LOWORD(buf[0]) = 0;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Not showing media attribution action: no attribution", buf, 2u);
        }
      }

      v10 = 0;
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        LOWORD(buf[0]) = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Not showing media attribution action: not a CKAttachmentMessagePartChatItem", buf, 2u);
      }
    }

    v10 = 0;
  }

  return v10;
}

void __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke(id *a1)
{
  v2 = dispatch_time(0, 200000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke_2;
  block[3] = &unk_1E72EC128;
  v4 = a1[4];
  v5 = a1[5];
  objc_copyWeak(&v6, a1 + 6);
  dispatch_after(v2, MEMORY[0x1E69E96A0], block);
  objc_destroyWeak(&v6);
}

void __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke_2(id *a1)
{
  v8 = [a1[4] objectForKey:*MEMORY[0x1E69A6FA0]];
  v2 = [a1[4] objectForKey:*MEMORY[0x1E69A6FB0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = [MEMORY[0x1E696AD98] numberWithLongLong:{objc_msgSend(v8, "longLongValue")}];

    v8 = v3;
  }

  v4 = [a1[4] objectForKey:*MEMORY[0x1E69A6FF0]];
  v5 = [a1[5] transfer];
  v6 = [v5 isSticker];

  WeakRetained = objc_loadWeakRetained(a1 + 6);
  [WeakRetained _presentBrowserOrAppStoreForAdamID:v8 url:v4 identifier:v2 isForSticker:v6];
}

- (id)_moreActionForChatItem:(id)a3 configureForCommSafety:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  if (![v6 wantsMoreMenu])
  {
    v9 = 0;
    goto LABEL_12;
  }

  v7 = objc_initWeak(&location, self);
  v8 = [(CKCoreChatController *)self conversation];
  if ([v8 isPending])
  {
    v9 = 0;
LABEL_10:

    goto LABEL_11;
  }

  v10 = objc_loadWeakRetained(&location);
  v11 = [v10 isInline];

  if ((v11 & 1) == 0)
  {
    v12 = CKFrameworkBundle();
    self = [v12 localizedStringForKey:@"BALLOON_MORE_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];

    v8 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"ellipsis.circle"];
    if (v4)
    {
      v13 = CKFrameworkBundle();
      v14 = [v13 localizedStringForKey:@"DELETE_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];

      self = v14;
    }

    v15 = MEMORY[0x1E69DC628];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __88__CKChatController_ClickyOrbConformance___moreActionForChatItem_configureForCommSafety___block_invoke;
    v17[3] = &unk_1E72EBF48;
    objc_copyWeak(&v19, &location);
    v18 = v6;
    v9 = [v15 actionWithTitle:self image:v8 identifier:0 handler:v17];

    objc_destroyWeak(&v19);
    goto LABEL_10;
  }

  v9 = 0;
LABEL_11:
  objc_destroyWeak(&location);
LABEL_12:

  return v9;
}

void __88__CKChatController_ClickyOrbConformance___moreActionForChatItem_configureForCommSafety___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionMoreIsTappedForChatItem:*(a1 + 32)];
}

- (BOOL)_shouldShowPollDetailsActionForChatItem:(id)a3
{
  v3 = a3;
  v4 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v5 = [v4 isPollsEnabled];

  v9 = 0;
  if (v5)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = [v3 bundleIdentifier];
      v7 = IMBalloonExtensionIDWithSuffix();
      v8 = [v6 isEqualToString:v7];

      if (v8)
      {
        v9 = 1;
      }
    }
  }

  return v9;
}

- (id)_votingViewForChatItem:(id)a3 containingViewController:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [v7 view];
  v9 = [v8 safeAreaLayoutGuide];
  [v9 layoutFrame];
  v11 = v10;
  v13 = v12;
  v15 = v14;
  v17 = v16;

  v18 = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v19 = [(CKChatController *)self presentedViewController];
    v20 = [v19 view];
  }

  else
  {
    v20 = [(CKChatController *)self view];
  }

  v21 = [v20 window];
  v22 = [(CKChatController *)self view];
  [v21 convertRect:v22 fromView:{v11, v13, v15, v17}];
  v48 = v24;
  v49 = v23;
  v46 = v26;
  v47 = v25;

  v27 = [v20 window];
  [v27 bounds];
  v29 = v28;
  v31 = v30;

  [(CKChatController *)self systemMinimumLayoutMargins];
  v33 = v32;
  v35 = v34;
  v36 = [(CKChatController *)self view];
  [v36 effectiveUserInterfaceLayoutDirection];

  v54.origin.x = v11;
  v54.origin.y = v13;
  v54.size.width = v15;
  v54.size.height = v17;
  Width = CGRectGetWidth(v54);
  objc_initWeak(&location, self);
  v38 = +[CKUIBehavior sharedBehaviors];
  [v38 attributionViewHeight];
  v40 = v39;

  v41 = [CKAttributionViewAccessoryView alloc];
  v42 = *MEMORY[0x1E695F058];
  v43 = *(MEMORY[0x1E695F058] + 8);
  v50[0] = MEMORY[0x1E69E9820];
  v50[1] = 3221225472;
  v50[2] = __90__CKChatController_ClickyOrbConformance___votingViewForChatItem_containingViewController___block_invoke;
  v50[3] = &unk_1E72EC150;
  objc_copyWeak(&v51, &location);
  v44 = [(CKAttributionViewAccessoryView *)v41 initWithFrame:v6 chatItem:v50 layoutBounds:v42 windowSize:v43 saveStickerHandler:Width - (v33 + v35), v40, v49, v48, v47, v46, v29, v31];
  objc_destroyWeak(&v51);
  objc_destroyWeak(&location);

  return v44;
}

void __90__CKChatController_ClickyOrbConformance___votingViewForChatItem_containingViewController___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained dismissContextMenuInteractionMenu];

  v5 = objc_loadWeakRetained((a1 + 32));
  [v5 saveStickerFromTapbackAttributionFlow:v3];
}

- (id)_localizedTitleStringForAggregateAction:(int64_t)a3 numberOfPhotos:(int64_t)a4 numberOfVideos:(int64_t)a5 numberOfOther:(int64_t)a6
{
  v8 = @"_ITEMS";
  if (a6 <= 0)
  {
    if (!a4 || a5)
    {
      if (a5)
      {
        v9 = a4 == 0;
      }

      else
      {
        v9 = 0;
      }

      if (v9)
      {
        v8 = @"_VIDEOS";
      }
    }

    else
    {
      v8 = @"_PHOTOS";
    }
  }

  v10 = @"DELETE";
  if (a3 != 1)
  {
    v10 = 0;
  }

  if (a3)
  {
    v11 = v10;
  }

  else
  {
    v11 = @"COPY";
  }

  v12 = a5 + a4 + a6;
  v13 = [(__CFString *)v11 stringByAppendingFormat:v8];
  v14 = MEMORY[0x1E696AEC0];
  v15 = CKFrameworkBundle();
  v16 = [v15 localizedStringForKey:v13 value:&stru_1F04268F8 table:@"ChatKit"];
  v17 = [v14 localizedStringWithFormat:v16, v12];

  v18 = [MEMORY[0x1E69DC668] sharedApplication];
  v19 = [v18 userInterfaceLayoutDirection];

  if (v19 == 1)
  {
    v20 = @"\u200F";
  }

  else
  {
    v20 = @"\u200E";
  }

  v21 = [(__CFString *)v20 stringByAppendingString:v17];

  return v21;
}

- (id)_balloonViewForCellAtIndexPath:(id)a3
{
  v14 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKChatController *)self collectionView];
  v6 = [v5 cellForItemAtIndexPath:v4];

  if (objc_opt_respondsToSelector())
  {
    v7 = [v6 balloonView];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = objc_opt_class();
        v10 = NSStringFromClass(v9);
        v12 = 138412290;
        v13 = v10;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "_balloonViewForCellAtIndexPath will return nil for class: %@", &v12, 0xCu);
      }
    }

    v7 = 0;
  }

  return v7;
}

- (id)_parentChatItemForIndexPath:(id)a3
{
  v24 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v4];
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 chatItems];

  if (v5)
  {
    v8 = [v5 item];
    if (v8 < [v7 count])
    {
      v9 = [(CKCoreChatController *)self collectionViewController];
      v10 = [v9 chatItems];
      v11 = [v10 objectAtIndex:{objc_msgSend(v5, "item")}];

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        goto LABEL_17;
      }

      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v18 = 138412290;
          v19 = v11;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "_parentChatItemForIndexPath will return nil. chatItem: %@ is not of class CKMessagePartChatItem", &v18, 0xCu);
        }
      }
    }
  }

  if (IMOSLoggingEnabled())
  {
    v13 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      if (v5)
      {
        v14 = @"NO";
      }

      else
      {
        v14 = @"YES";
      }

      v15 = [v5 item];
      v16 = [v7 count];
      v18 = 138412802;
      v19 = v14;
      v20 = 2048;
      v21 = v15;
      v22 = 2048;
      v23 = v16;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "_parentChatItemForIndexPath returning nil. ParentIndexPath is nil: %@; ParentIndexPath.item: %ld; chatItems.count: %ld", &v18, 0x20u);
    }
  }

  v11 = 0;
LABEL_17:

  return v11;
}

- (BOOL)_hasPreviewViewControllerForChatItem:(id)a3
{
  v3 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = [v3 mediaObject];
    if ([v4 shouldBeQuickLooked])
    {
      isKindOfClass = 1;
    }

    else
    {
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
    }
  }

  else
  {
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  return isKindOfClass & 1;
}

- (BOOL)_clickyOrbEnabled
{
  v3 = +[CKUIBehavior sharedBehaviors];
  v4 = [v3 disableTranscriptInteractions];

  if (v4)
  {
    v5 = IMOSLoggingEnabled();
    if (v5)
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v17 = 0;
        v7 = "clicky orb: disabled because transcript interactions disabled";
        v8 = &v17;
LABEL_13:
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, v7, v8, 2u);
        goto LABEL_14;
      }

      goto LABEL_14;
    }
  }

  else
  {
    v9 = +[CKUIBehavior sharedBehaviors];
    v10 = [v9 disableTranscriptClickyOrbContextMenu];

    if (v10)
    {
      v5 = IMOSLoggingEnabled();
      if (v5)
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          v16 = 0;
          v7 = "clicky orb: disabled because transcript context menu disabled";
          v8 = &v16;
          goto LABEL_13;
        }

LABEL_14:

        LOBYTE(v5) = 0;
      }
    }

    else if ([(CKChatController *)self isEditing])
    {
      v5 = IMOSLoggingEnabled();
      if (v5)
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          v7 = "clicky orb: disabled because transcript is editing";
          v8 = buf;
          goto LABEL_13;
        }

        goto LABEL_14;
      }
    }

    else
    {
      v11 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v12 = [v11 isModernFilteringEnabled];

      if ((v12 & 1) == 0 && [(CKChatController *)self isShowingOscarChat])
      {
        v5 = IMOSLoggingEnabled();
        if (!v5)
        {
          return v5;
        }

        v6 = OSLogHandleForIMFoundationCategory();
        if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          goto LABEL_14;
        }

        v14 = 0;
        v7 = "clicky orb: disabled because showing oscar chat";
        v8 = &v14;
        goto LABEL_13;
      }

      LOBYTE(v5) = 1;
    }
  }

  return v5;
}

- (BOOL)_balloonViewOfCell:(id)a3 containsPoint:(CGPoint)a4 fromView:(id)a5
{
  y = a4.y;
  x = a4.x;
  v8 = a5;
  v9 = a3;
  v10 = [v9 balloonView];
  [v10 frame];
  [v8 convertRect:v9 fromView:?];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;

  v21.origin.x = v12;
  v21.origin.y = v14;
  v21.size.width = v16;
  v21.size.height = v18;
  v20.x = x;
  v20.y = y;
  LOBYTE(v9) = CGRectContainsPoint(v21, v20);

  return v9;
}

- (BOOL)_point:(CGPoint)a3 visuallyIntersectsBalloonViewInCollectionView:(id)a4
{
  y = a3.y;
  x = a3.x;
  v26 = *MEMORY[0x1E69E9840];
  v7 = a4;
  v8 = [v7 indexPathForItemAtPoint:{x, y}];
  v9 = [v7 cellForItemAtIndexPath:v8];

  v10 = [v7 hitTest:0 withEvent:{x, y}];
  if (v9)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass() & 1) != 0 && v10 && ([v9 balloonView], v11 = objc_claimAutoreleasedReturnValue(), v12 = objc_msgSend(v10, "isDescendantOfView:", v11), v11, (v12))
    {
      v13 = 1;
    }

    else
    {
      v23 = 0u;
      v24 = 0u;
      v21 = 0u;
      v22 = 0u;
      v14 = [v7 visibleCells];
      v15 = [v14 countByEnumeratingWithState:&v21 objects:v25 count:16];
      if (v15)
      {
        v16 = v15;
        v17 = *v22;
        while (2)
        {
          for (i = 0; i != v16; ++i)
          {
            if (*v22 != v17)
            {
              objc_enumerationMutation(v14);
            }

            v19 = *(*(&v21 + 1) + 8 * i);
            objc_opt_class();
            if ((objc_opt_isKindOfClass() & 1) != 0 && [(CKChatController *)self _balloonViewOfCell:v19 containsPoint:v7 fromView:x, y])
            {
              v13 = 1;
              goto LABEL_18;
            }
          }

          v16 = [v14 countByEnumeratingWithState:&v21 objects:v25 count:16];
          if (v16)
          {
            continue;
          }

          break;
        }
      }

      v13 = 0;
LABEL_18:
    }
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

- (BOOL)contextMenuInteractionIsOutsideOfVisibleBalloonCells:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self collectionView];
  [v4 locationInView:v5];
  v7 = v6;
  v9 = v8;

  v10 = [(CKChatController *)self collectionView];
  LOBYTE(self) = [(CKChatController *)self _point:v10 visuallyIntersectsBalloonViewInCollectionView:v7, v9];

  return self ^ 1;
}

- (void)contextMenuInteraction:(id)a3 willDisplayMenuForConfiguration:(id)a4 animator:(id)a5
{
  if ([(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:a3, a4, a5])
  {

    [(CKChatController *)self clearEntryViewPasteConfiguration];
  }
}

- (void)contextMenuInteraction:(id)a3 willEndForConfiguration:(id)a4 animator:(id)a5
{
  if ([(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:a3, a4, a5])
  {

    [(CKChatController *)self restoreEntryViewPasteConfiguration];
  }
}

- (id)contextMenuInteraction:(id)a3 configurationForMenuAtLocation:(CGPoint)a4
{
  v11 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if ([(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:v5])
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v9 = 136315138;
        v10 = "[CKChatController(ClickyOrbConformance) contextMenuInteraction:configurationForMenuAtLocation:]";
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "%s - context menu interaction is outside of visible balloonCell", &v9, 0xCu);
      }
    }

    v7 = [(CKChatController *)self contextMenuInteractionOutsideOfVisibleBalloonCells];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (id)contextMenuInteractionOutsideOfVisibleBalloonCells
{
  v12[1] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E69DCC60];
  v3 = [(CKChatController *)self _showTimestampsAction];
  v12[0] = v3;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:1];
  v5 = [v2 menuWithTitle:&stru_1F04268F8 children:v4];

  v6 = MEMORY[0x1E69DC8D8];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __92__CKChatController_ClickyOrbConformance__contextMenuInteractionOutsideOfVisibleBalloonCells__block_invoke;
  v10[3] = &unk_1E72EC178;
  v11 = v5;
  v7 = v5;
  v8 = [v6 configurationWithIdentifier:@"CKTranscriptContextMenuConfigurationIdentifier" previewProvider:0 actionProvider:v10];

  return v8;
}

- (void)setupClickyOrbForConversation:(id)a3
{
  if (CKIsRunningInMacCatalyst())
  {
    v4 = [(CKCoreChatController *)self collectionViewController];
    v7 = [v4 collectionView];

    v5 = [objc_alloc(MEMORY[0x1E69DC8E0]) initWithDelegate:self];
    v6 = objc_alloc_init(MEMORY[0x1E69DD250]);
    [v7 setBackgroundView:v6];
    [v7 addInteraction:v5];
  }
}

- (CGAffineTransform)stickerPreviewTransform
{
  v4 = MEMORY[0x193AF5EC0](@"_MSStickerDragPreviewContainerView", @"Messages");
  if (v4 && (v5 = v4, (objc_opt_respondsToSelector() & 1) != 0))
  {

    return [v5 targetPreviewTransform];
  }

  else
  {

    return CGAffineTransformMakeScale(retstr, 1.25, 1.25);
  }
}

- (id)_stickerDragPreviewForDragItem:(id)a3 defaultPreview:(id)a4
{
  v31 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self dropSession];
  v9 = [(CKChatController *)self _stickerDropProposalForItem:v6 inSession:v8];

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = [(CKChatController *)self dropSession];
      v12 = [v9 dragItem];
      [v9 previewCenter];
      v13 = NSStringFromCGPoint(v33);
      v14 = [v9 targetBalloonIndex];
      LODWORD(v29[0]) = 138413314;
      *(v29 + 4) = v6;
      WORD2(v29[1]) = 2112;
      *(&v29[1] + 6) = v11;
      HIWORD(v29[2]) = 2112;
      v29[3] = v12;
      *v30 = 2112;
      *&v30[2] = v13;
      *&v30[10] = 2112;
      *&v30[12] = v14;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "_stickerDragPreviewForDragItem: got dropProposal for item: %@, session: %@, dragItem: %@, previewCenter: %@, targetBalloonIndex: %@", v29, 0x34u);
    }
  }

  v15 = [v9 targetBalloonIndex];

  if (v15)
  {
    v16 = [objc_alloc(MEMORY[0x193AF5EC0](@"_MSStickerDragPreviewContainerView" @"Messages"))];
    v17 = [v7 target];
    v18 = objc_alloc(MEMORY[0x1E69DC9A8]);
    v19 = [v17 container];
    [v17 center];
    v21 = v20;
    v23 = v22;
    if (v6)
    {
      [v6 _suggestedTransform];
    }

    else
    {
      *v30 = 0u;
      memset(v29, 0, sizeof(v29));
    }

    v27 = [v18 initWithContainer:v19 center:v29 transform:{v21, v23}];

    v26 = [v7 retargetedPreviewWithTarget:v27];
    [v26 _setPreviewContainer:v16];
    [(CKChatController *)self _prepareForDropAnimationWithItem:v6 preview:v26];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v24 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        v25 = [(CKChatController *)self dropSession];
        LODWORD(v29[0]) = 138412546;
        *(v29 + 4) = v6;
        WORD2(v29[1]) = 2112;
        *(&v29[1] + 6) = v25;
        _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "_stickerDragPreviewForDragItem: Not returning a UITargetedDragPreview which will abort the stick animation. There was no valid target balloon sufficiently close to the drop preview for item: %@, drop session: %@.", v29, 0x16u);
      }
    }

    v26 = 0;
  }

  return v26;
}

- (id)hashKeyForDragItem:(id)a3
{
  if (a3)
  {
    v4 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%lu", objc_msgSend(a3, "hash")];
  }

  else
  {
    v4 = &stru_1F04268F8;
  }

  return v4;
}

- (void)_prepareForDropAnimationWithItem:(id)a3 preview:(id)a4
{
  v23 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = IMLogHandleForCategory();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    v9 = [v7 _previewContainer];
    v17 = 138412802;
    v18 = v6;
    v19 = 2112;
    v20 = v7;
    v21 = 2112;
    v22 = v9;
    _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "_prepareForDropAnimationWithItem dragItem: %@, dragPreview: %@, container: %@", &v17, 0x20u);
  }

  v10 = [(CKChatController *)self hashKeyForDragItem:v6];
  v11 = [(CKChatController *)self activeDropPreviews];
  [v11 setObject:v7 forKey:v10];

  v12 = [v7 _previewContainer];
  v13 = objc_opt_respondsToSelector();

  if (v13)
  {
    v14 = [v7 _previewContainer];
    [v14 setDefersFinalDropAnimationCompletion:1];
  }

  v15 = [v7 _previewContainer];

  if (!v15)
  {
    v16 = IMLogHandleForCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) _prepareForDropAnimationWithItem:preview:];
    }
  }
}

- (id)_stickerDropProposalForSession:(id)a3
{
  v19 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v5 = [v4 items];
  v6 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = 0;
    v9 = *v15;
LABEL_3:
    v10 = 0;
    v11 = v8;
    while (1)
    {
      if (*v15 != v9)
      {
        objc_enumerationMutation(v5);
      }

      v8 = [(CKChatController *)self _stickerDropProposalForItem:*(*(&v14 + 1) + 8 * v10) inSession:v4];

      v12 = [v8 targetBalloonIndex];

      if (v12)
      {
        break;
      }

      ++v10;
      v11 = v8;
      if (v7 == v10)
      {
        v7 = [v5 countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        break;
      }
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (id)_stickerDropProposalForItem:(id)a3 inSession:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(CKCoreChatController *)self collectionViewController];
  v9 = [v8 collectionView];
  v10 = *MEMORY[0x1E695EFF8];
  v11 = *(MEMORY[0x1E695EFF8] + 8);
  if (objc_opt_respondsToSelector() & 1) != 0 && (objc_opt_respondsToSelector())
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      LOWORD(buf.a) = 0;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "_stickerDropProposalForItem:inSession: checking view geometry", &buf, 2u);
    }

    v13 = [(CKChatController *)self view];
    v14 = [v13 window];
    [v7 _previewCenterForVisibleItem:v6 inView:v14];
    v10 = v15;
    v11 = v16;

    [v7 _previewSizeForVisibleItem:v6];
    v18 = v17;
    v20 = v19;
    memset(&buf, 0, sizeof(buf));
    [(CKChatController *)self stickerPreviewTransform];
    CGAffineTransformInvert(&buf, &v32);
    memset(&v32, 0, sizeof(v32));
    if (v6)
    {
      [v6 _suggestedTransform];
    }

    else
    {
      memset(&t2, 0, sizeof(t2));
    }

    t1 = buf;
    CGAffineTransformConcat(&v32, &t1, &t2);
    t2 = v32;
    CGAffineTransformDecompose(&v29, &t2);
    v21 = [(CKChatController *)self selectedBalloonIntersectingRect:v10 - v18 * v29.scale.width * 0.5, v11 - v20 * v29.scale.width * 0.5];
    if (!v21)
    {
      v28 = IMLogHandleForCategory();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        LOWORD(t2.a) = 0;
        _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "_stickerDropProposalForItem:inSession: no view geometry; will try touch rect", &t2, 2u);
      }
    }
  }

  else
  {
    v21 = 0;
  }

  if (!v21)
  {
    if (v9)
    {
      v21 = [v9 window];

      if (v21)
      {
        v22 = IMLogHandleForCategory();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          LOWORD(buf.a) = 0;
          _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "_stickerDropProposalForItem:inSession: no view geometry; trying touch rect", &buf, 2u);
        }

        v21 = [(CKChatController *)self _selectedBalloonFromTouchForDropSession:v7];
        v23 = [v9 window];
        [v7 locationInView:v23];
        v10 = v24;
        v11 = v25;
      }
    }
  }

  v26 = [[CKTranscriptStickerDropProposal alloc] initWithDragItem:v6 previewCenter:v21 targetBalloonIndex:v10, v11];

  return v26;
}

- (id)_selectedBalloonFromTouchForDropSession:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self collectionViewController];
  v6 = [v5 collectionView];
  v7 = v6;
  if (v6 && ([v6 window], v8 = objc_claimAutoreleasedReturnValue(), v8, v8))
  {
    v9 = [v7 window];
    [v4 locationInView:v9];
    v11 = v10;
    v13 = v12;

    v14 = *MEMORY[0x1E695F058];
    v15 = *(MEMORY[0x1E695F058] + 8);
    v20.origin.x = *MEMORY[0x1E695F058];
    v20.origin.y = v15;
    v20.size.width = 44.0;
    v20.size.height = 44.0;
    v16 = v11 - CGRectGetWidth(v20) * 0.5;
    v21.origin.x = v14;
    v21.origin.y = v15;
    v21.size.width = 44.0;
    v21.size.height = 44.0;
    v17 = [(CKChatController *)self selectedBalloonIntersectingRect:v16, v13 - CGRectGetHeight(v21) * 0.5, 44.0, 44.0];
  }

  else
  {
    v17 = 0;
  }

  return v17;
}

- (void)_sendStickerForDragItem:(id)a3 previewSize:(CGSize)a4 dropLocation:(CGPoint)a5
{
  y = a5.y;
  x = a5.x;
  height = a4.height;
  width = a4.width;
  v83 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v84.x = x;
    v84.y = y;
    v12 = NSStringFromCGPoint(v84);
    *buf = 138412546;
    *&buf[4] = v10;
    *&buf[12] = 2112;
    *&buf[14] = v12;
    _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "_sendStickerForDragItem: dragItem: %@, dropLocation %@", buf, 0x16u);
  }

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x5010000000;
  v79 = &unk_190F92BB2;
  v80 = 0u;
  v81 = 0u;
  v82 = 0u;
  if (v10)
  {
    [v10 _suggestedTransform];
  }

  v76[0] = 0;
  v76[1] = v76;
  v76[2] = 0x3032000000;
  v76[3] = __Block_byref_object_copy__5;
  v76[4] = __Block_byref_object_dispose__5;
  v77 = [(CKChatController *)self hashKeyForDragItem:v10];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke;
  aBlock[3] = &unk_1E72ECE40;
  aBlock[4] = self;
  v72 = v76;
  v13 = v10;
  v74 = x;
  v75 = y;
  v71 = v13;
  v73 = buf;
  v14 = _Block_copy(aBlock);
  v15 = [v13 itemProvider];
  v16 = [v15 hasItemConformingToTypeIdentifier:@"com.apple.sticker.mediaPayload"];

  if (v16)
  {
    v17 = MEMORY[0x193AF5EC0](@"_MSMessageMediaPayload", @"Messages");
    v18 = [v13 itemProvider];
    v68[0] = MEMORY[0x1E69E9820];
    v68[1] = 3221225472;
    v68[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275;
    v68[3] = &unk_1E72ECE90;
    v69 = v14;
    v19 = [v18 loadObjectOfClass:v17 completionHandler:v68];
  }

  else
  {
    v20 = [v13 itemProvider];
    v21 = [v20 hasItemConformingToTypeIdentifier:@"com.apple.sticker"];

    if (v21)
    {
      v66[0] = 0;
      v66[1] = v66;
      v66[2] = 0x3032000000;
      v66[3] = __Block_byref_object_copy__5;
      v66[4] = __Block_byref_object_dispose__5;
      v67 = 0;
      v64[0] = 0;
      v64[1] = v64;
      v64[2] = 0x3032000000;
      v64[3] = __Block_byref_object_copy__5;
      v64[4] = __Block_byref_object_dispose__5;
      v65 = 0;
      v62[0] = 0;
      v62[1] = v62;
      v62[2] = 0x3032000000;
      v62[3] = __Block_byref_object_copy__5;
      v62[4] = __Block_byref_object_dispose__5;
      v63 = &stru_1F04268F8;
      v60[0] = 0;
      v60[1] = v60;
      v60[2] = 0x3032000000;
      v60[3] = __Block_byref_object_copy__5;
      v60[4] = __Block_byref_object_dispose__5;
      v61 = 0;
      v22 = [v13 itemProvider];
      v23 = *MEMORY[0x1E6982F28];
      v24 = [*MEMORY[0x1E6982F28] identifier];
      v25 = [v22 hasRepresentationConformingToTypeIdentifier:v24 fileOptions:0];

      v26 = [v13 itemProvider];
      v27 = *MEMORY[0x1E6983020];
      v28 = [*MEMORY[0x1E6983020] identifier];
      v29 = [v26 hasRepresentationConformingToTypeIdentifier:v28 fileOptions:0];

      v58[0] = 0;
      v58[1] = v58;
      v58[2] = 0x2020000000;
      v59 = 0;
      v50[0] = MEMORY[0x1E69E9820];
      v50[1] = 3221225472;
      v50[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_2;
      v50[3] = &unk_1E72ECEB8;
      v52 = v64;
      v53 = v66;
      v54 = v62;
      v55 = v60;
      v51 = v14;
      v56 = width;
      v57 = height;
      v30 = _Block_copy(v50);
      if (v25)
      {
        if (v29)
        {
          v31 = [v13 itemProvider];
          v32 = [v27 identifier];
          v44[0] = MEMORY[0x1E69E9820];
          v44[1] = 3221225472;
          v44[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_282;
          v44[3] = &unk_1E72ECEE0;
          v46 = v60;
          v47 = v62;
          v48 = v58;
          v49 = v25;
          v45 = v30;
          v33 = [v31 loadDataRepresentationForTypeIdentifier:v32 completionHandler:v44];
        }

        v34 = [v13 itemProvider];
        v35 = [v23 identifier];
        v38[0] = MEMORY[0x1E69E9820];
        v38[1] = 3221225472;
        v38[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288;
        v38[3] = &unk_1E72ECF08;
        v40 = v66;
        v41 = v64;
        v42 = v58;
        v43 = v29;
        v39 = v30;
        v36 = [v34 loadFileRepresentationForTypeIdentifier:v35 completionHandler:v38];

        v37 = v39;
      }

      else
      {
        v37 = IMLogHandleForCategory();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(CKChatController_Stickers) _sendStickerForDragItem:previewSize:dropLocation:];
        }
      }

      _Block_object_dispose(v58, 8);
      _Block_object_dispose(v60, 8);

      _Block_object_dispose(v62, 8);
      _Block_object_dispose(v64, 8);

      _Block_object_dispose(v66, 8);
    }
  }

  _Block_object_dispose(v76, 8);
  _Block_object_dispose(buf, 8);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke(uint64_t a1, void *a2, CGFloat a3, CGFloat a4)
{
  v32 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = [*(a1 + 32) activeDropPreviews];
  v9 = [v8 objectForKey:*(*(*(a1 + 48) + 8) + 40)];

  v10 = [v9 _previewContainer];
  if (objc_opt_respondsToSelector())
  {
    v11 = [v9 _previewContainer];

    objc_initWeak(&location, *(a1 + 32));
    if (v11)
    {
      v12 = IMLogHandleForCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v33.width = a3;
        v33.height = a4;
        v13 = NSStringFromCGSize(v33);
        *buf = 138412546;
        v29 = v7;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Scheduling performAfterDropAnimation to commit sticker %@, size: %@", buf, 0x16u);
      }

      goto LABEL_9;
    }
  }

  else
  {

    objc_initWeak(&location, *(a1 + 32));
  }

  v12 = IMLogHandleForCategory();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
  {
    __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_cold_1();
  }

  v11 = 0;
LABEL_9:

  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263;
  v18[3] = &unk_1E72ECE18;
  v14 = v7;
  v19 = v14;
  objc_copyWeak(&v23, &location);
  v15 = *(a1 + 40);
  v16 = *(a1 + 48);
  v24 = *(a1 + 64);
  v25 = a3;
  v26 = a4;
  v17 = *(a1 + 32);
  v20 = v15;
  v21 = v17;
  v22 = vextq_s8(v16, v16, 8uLL);
  [v11 performAfterDropAnimation:v18];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263(uint64_t a1)
{
  v21 = *MEMORY[0x1E69E9840];
  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    v3 = *(a1 + 32);
    LODWORD(v20[0]) = 138412290;
    *(v20 + 4) = v3;
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "performAfterDropAnimation: callback for sticker: %@", v20, 0xCu);
  }

  WeakRetained = objc_loadWeakRetained((a1 + 72));
  [MEMORY[0x1E6979518] begin];
  [MEMORY[0x1E6979518] setDisableActions:1];
  v5 = [*(a1 + 32) stickerPackGUID];

  if (v5)
  {
    v6 = [*(a1 + 32) stickerPackGUID];
    v7 = [v6 length];

    if (!v7)
    {
      v8 = IMLogHandleForCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263_cold_1();
      }
    }

    v9 = *(*(a1 + 56) + 8);
    v10 = *(a1 + 32);
    v11 = [MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(a1 + 40)];
    v12 = [*(a1 + 48) _stickerChatItemForDragItem:*(a1 + 40)];
    v13 = *(a1 + 80);
    v14 = *(a1 + 88);
    v15 = *(a1 + 96);
    v16 = *(a1 + 104);
    v17 = v9[3];
    v20[0] = v9[2];
    v20[1] = v17;
    v20[2] = v9[4];
    [WeakRetained _commitSticker:v10 toCoordinate:v20 withInitialSize:v11 dropPreviewTransform:v12 isRepositioningSticker:v13 localStickerChatItem:{v14, v15, v16}];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263_cold_2((a1 + 32), a1, v12);
    }
  }

  [MEMORY[0x1E6979518] commit];
  v18 = [WeakRetained activeDropPreviews];
  [v18 removeObjectForKey:*(*(*(a1 + 64) + 8) + 40)];

  v19 = [WeakRetained inputController];
  [v19 stickerDropAnimationFinished];

  [WeakRetained setIgnoresAutomaticScrollsTowardBottom:0];
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275(uint64_t a1, void *a2, void *a3)
{
  v5 = a3;
  v6 = a2;
  v7 = IMLogHandleForCategory();
  v8 = v7;
  if (v5)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275_cold_1();
    }
  }

  else if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Finished loading _MSMessageMediaPayload from item provider.", buf, 2u);
  }

  v9 = [MEMORY[0x1E69A82C0] stickerWithMSMessageMediaPayload:v6];
  [v6 sourceFrame];
  v11 = v10;
  v13 = v12;

  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_276;
  v16[3] = &unk_1E72ECE68;
  v14 = *(a1 + 32);
  v17 = v9;
  v18 = v14;
  v19 = v11;
  v20 = v13;
  v15 = v9;
  dispatch_async(MEMORY[0x1E69E96A0], v16);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_2(uint64_t a1)
{
  v2 = objc_alloc(MEMORY[0x1E69A82C0]);
  v3 = *(*(*(a1 + 40) + 8) + 40);
  v4 = [MEMORY[0x1E69A8058] defaultEmojiStickerPackID];
  v5 = [v2 initWithStickerID:v3 stickerPackID:v4 fileURL:*(*(*(a1 + 48) + 8) + 40) accessibilityLabel:*(*(*(a1 + 56) + 8) + 40) accessibilityName:0 searchText:0 sanitizedPrompt:0 moodCategory:0 stickerName:0];

  [v5 setExternalURI:*(*(*(a1 + 64) + 8) + 40)];
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_3;
  block[3] = &unk_1E72ECE68;
  v6 = *(a1 + 32);
  v9 = v5;
  v10 = v6;
  v11 = *(a1 + 72);
  v7 = v5;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_282(uint64_t a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = [MEMORY[0x1E695DF58] currentLocale];
    [v7 localeIdentifier];
    v8 = CEMCreateEmojiLocaleData();

    v9 = [objc_alloc(MEMORY[0x1E696AEC0]) initWithData:v5 encoding:4];
    if (v9)
    {
      v10 = v8 == 0;
    }

    else
    {
      v10 = 1;
    }

    if (v10)
    {
      if (!v8)
      {
        goto LABEL_15;
      }
    }

    else
    {
      v12 = [MEMORY[0x1E696AEC0] stringWithFormat:@"sticker:///emoji/identifier/%@", v9];
      v13 = *(*(a1 + 40) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      v15 = CEMEmojiTokenCreateWithString();
      if (v15)
      {
        v16 = v15;
        v17 = CEMEmojiTokenCopyName();
        v18 = *(*(a1 + 48) + 8);
        v19 = *(v18 + 40);
        *(v18 + 40) = v17;

        CFRelease(v16);
      }
    }

    CFRelease(v8);
LABEL_15:

    goto LABEL_16;
  }

  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    *buf = 138412290;
    v22 = v6;
    _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "emoji sticker drag failed with error: %@", buf, 0xCu);
  }

LABEL_16:
  add = atomic_fetch_add((*(*(a1 + 56) + 8) + 24), 1u);
  if (*(a1 + 64) != 1 || add >= 1)
  {
    (*(*(a1 + 32) + 16))();
  }
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = IMLogHandleForCategory();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v8)
    {
      *buf = 138412290;
      v23 = v5;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "received emoji sticker drag: %@", buf, 0xCu);
    }

    v9 = MEMORY[0x1E696AEC0];
    v10 = [v5 path];
    v11 = IMSharedHelperMD5HashOfFileAtPath();
    v7 = [v9 stringWithFormat:@"%@-sticker", v11];

    v12 = [v5 pathExtension];
    if (v12)
    {
      v13 = [v7 stringByAppendingPathExtension:v12];

      v7 = v13;
    }

    v14 = [MEMORY[0x1E696AC08] defaultManager];
    v15 = [v14 im_randomTemporaryFileURLWithFileName:v7];

    v16 = [MEMORY[0x1E696AC08] defaultManager];
    v21 = 0;
    v17 = [v16 copyItemAtURL:v5 toURL:v15 error:&v21];
    v18 = v21;

    if ((v17 & 1) == 0)
    {
      v19 = IMLogHandleForCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288_cold_1();
      }
    }

    objc_storeStrong((*(*(a1 + 40) + 8) + 40), v15);
    objc_storeStrong((*(*(a1 + 48) + 8) + 40), v7);
    add = atomic_fetch_add((*(*(a1 + 56) + 8) + 24), 1u);
    if (*(a1 + 64) != 1 || add >= 1)
    {
      (*(*(a1 + 32) + 16))();
    }
  }

  else if (v8)
  {
    *buf = 138412290;
    v23 = v6;
    _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "emoji sticker drag failed with error: %@", buf, 0xCu);
  }
}

- (void)_commitSticker:(id)a3 toCoordinate:(CGPoint)a4 withInitialSize:(CGSize)a5 dropPreviewTransform:(CGAffineTransform *)a6
{
  v6 = *&a6->c;
  v7[0] = *&a6->a;
  v7[1] = v6;
  v7[2] = *&a6->tx;
  [(CKChatController *)self _commitSticker:a3 toCoordinate:v7 withInitialSize:0 dropPreviewTransform:0 isRepositioningSticker:a4.x localStickerChatItem:a4.y, a5.width, a5.height];
}

- (void)sendSticker:(id)a3 toCoordinate:(CGPoint)a4 withInitialSize:(CGSize)a5 dropPreviewTransform:(CGAffineTransform *)a6 isRepositioningSticker:(BOOL)a7 localStickerChatItem:(id)a8
{
  v8 = *&a6->c;
  v9[0] = *&a6->a;
  v9[1] = v8;
  v9[2] = *&a6->tx;
  [(CKChatController *)self _commitSticker:a3 toCoordinate:v9 withInitialSize:a7 dropPreviewTransform:a8 isRepositioningSticker:a4.x localStickerChatItem:a4.y, a5.width, a5.height];
}

- (void)_commitSticker:(id)a3 toCoordinate:(CGPoint)a4 withInitialSize:(CGSize)a5 dropPreviewTransform:(CGAffineTransform *)a6 isRepositioningSticker:(BOOL)a7 localStickerChatItem:(id)a8
{
  v9 = a7;
  height = a5.height;
  width = a5.width;
  y = a4.y;
  x = a4.x;
  v32 = *MEMORY[0x1E69E9840];
  v16 = a3;
  v17 = a8;
  v18 = IMLogHandleForCategory();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v33.x = x;
    v33.y = y;
    v19 = NSStringFromCGPoint(v33);
    v34.width = width;
    v34.height = height;
    v20 = NSStringFromCGSize(v34);
    v21 = NSStringFromBOOL();
    LODWORD(buf.a) = 138413058;
    *(&buf.a + 4) = v16;
    WORD2(buf.b) = 2112;
    *(&buf.b + 6) = v19;
    HIWORD(buf.c) = 2112;
    *&buf.d = v20;
    LOWORD(buf.tx) = 2112;
    *(&buf.tx + 2) = v21;
    _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "_commitSticker: %@, coordinate: %@, initialSize: %@ repositioning: %@", &buf, 0x2Au);
  }

  memset(&buf, 0, sizeof(buf));
  [(CKChatController *)self stickerPreviewTransform];
  CGAffineTransformInvert(&buf, &v30);
  t1 = buf;
  memset(&v30, 0, sizeof(v30));
  v22 = *&a6->c;
  *&v28.a = *&a6->a;
  *&v28.c = v22;
  *&v28.tx = *&a6->tx;
  CGAffineTransformConcat(&v30, &t1, &v28);
  v28 = v30;
  memset(&t1, 0, sizeof(t1));
  CGAffineTransformDecompose(&t1, &v28);
  v23 = fmax(t1.a, 0.0);
  if (v23 <= 0.0)
  {
    v24 = 1.0;
  }

  else
  {
    v24 = v23;
  }

  [v16 calculatePreviewScaleWithTargetSize:{width, height}];
  v26 = [CKBrowserDragControllerTarget targetWithScreenCoordinate:0 initialSize:v9 scale:v17 meshScaleFactor:x rotation:y associatedLayoutIntent:width stickerIsRepositioning:height stickerChatItem:v25 * v24, 0.4, t1.d];

  v27 = [(CKCoreChatController *)self inputController];
  [v27 commitSticker:v16 withDragTarget:v26 draggedSticker:0];
}

- (void)_sendNewStickerFromDropSession:(id)a3
{
  v37 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKChatController *)self _stickerDropProposalForSession:v4];
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [(CKChatController *)self dropSession];
      v8 = [v5 dragItem];
      [v5 previewCenter];
      v9 = NSStringFromCGPoint(v38);
      v10 = [v5 targetBalloonIndex];
      v29 = 138413058;
      v30 = v7;
      v31 = 2112;
      v32 = v8;
      v33 = 2112;
      v34 = v9;
      v35 = 2112;
      v36 = v10;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "_sendNewStickerFromDropSession: got dropProposal for session: %@, dragItem: %@, previewCenter: %@, targetBalloonIndex: %@", &v29, 0x2Au);
    }
  }

  v11 = [v5 targetBalloonIndex];

  if (!v11)
  {
    if (IMOSLoggingEnabled())
    {
      v20 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        v21 = [v5 dragItem];
        v22 = [(CKChatController *)self dropSession];
        v29 = 138412546;
        v30 = v21;
        v31 = 2112;
        v32 = v22;
        _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "_sendNewStickerFromDropSession: Aborting the sticker drop because there was no valid target balloon sufficiently close to the drop preview for item: %@, drop session: %@.", &v29, 0x16u);
      }
    }

    v23 = [v5 dragItem];
    v17 = [(CKChatController *)self hashKeyForDragItem:v23];

    v24 = [(CKChatController *)self activeDropPreviews];
    v25 = [v24 objectForKey:v17];

    v26 = [v25 _previewContainer];
    if (objc_opt_respondsToSelector())
    {
      v27 = [v25 _previewContainer];

      if (!v27)
      {
LABEL_16:
        v28 = [(CKChatController *)self activeDropPreviews];
        [v28 removeObjectForKey:v17];

        goto LABEL_17;
      }

      [v27 setDefersFinalDropAnimationCompletion:0];
    }

    else
    {
      v27 = v26;
    }

    goto LABEL_16;
  }

  v12 = [v5 dragItem];
  [v4 _previewSizeForVisibleItem:v12];
  v14 = v13;
  v16 = v15;

  v17 = [v5 dragItem];
  [v5 previewCenter];
  [(CKChatController *)self _sendStickerForDragItem:v17 previewSize:v14 dropLocation:v16, v18, v19];
LABEL_17:
}

- (id)cellIndexPathForDragTarget:(id)a3
{
  v24 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self collectionViewController];
  v6 = [v5 collectionView];

  v7 = [v6 window];
  [v4 screenCoordinate];
  [v7 convertPoint:v6 toView:?];
  v9 = v8;
  v11 = v10;

  v21 = 0u;
  v22 = 0u;
  v19 = 0u;
  v20 = 0u;
  v12 = [v6 indexPathsForVisibleItems];
  v13 = [v12 countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v13)
  {
    v14 = *v20;
    while (2)
    {
      for (i = 0; i != v13; i = i + 1)
      {
        if (*v20 != v14)
        {
          objc_enumerationMutation(v12);
        }

        v16 = *(*(&v19 + 1) + 8 * i);
        if (![v16 section])
        {
          v17 = [v6 cellForItemAtIndexPath:v16];
          [v17 frame];
          v26.x = v9;
          v26.y = v11;
          if (CGRectContainsPoint(v27, v26))
          {
            v13 = v16;

            goto LABEL_13;
          }
        }
      }

      v13 = [v12 countByEnumeratingWithState:&v19 objects:v23 count:16];
      if (v13)
      {
        continue;
      }

      break;
    }
  }

LABEL_13:

  return v13;
}

- (void)sendSticker:(id)a3 withMediaObject:(id)a4 composition:(id)a5 parentMessagePartChatItem:(id)a6 messageSummaryInfo:(id)a7
{
  v37 = *MEMORY[0x1E69E9840];
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  if (v12)
  {
    if (v13)
    {
      if (v14)
      {
        v17 = [(CKCoreChatController *)self conversation];
        v30 = 0;
        v18 = [v17 canSendComposition:v14 error:&v30];
        v19 = v30;

        if (v18)
        {
          v20 = [CKStickerDropCommSafetySendContext contextWithSticker:v12 composition:v14 mediaObject:v13 parentMessagePartChatItem:v15 messageSummaryInfo:v16];
          v21 = [v13 transfer];
          v22 = [v21 fileURL];
          v23[0] = MEMORY[0x1E69E9820];
          v23[1] = 3221225472;
          v23[2] = __132__CKChatController_CKChatController_Stickers__sendSticker_withMediaObject_composition_parentMessagePartChatItem_messageSummaryInfo___block_invoke;
          v23[3] = &unk_1E72ECF30;
          v24 = v12;
          v25 = self;
          v26 = v13;
          v27 = v14;
          v28 = v15;
          v29 = v16;
          [(CKCoreChatController *)self presentCommSafetyInterventionIfNecessaryForFileURL:v22 withSendContext:v20 completion:v23];
        }

        else
        {
          v20 = IMLogHandleForCategory();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412802;
            v32 = v14;
            v33 = 2112;
            v34 = v15;
            v35 = 2112;
            v36 = v19;
            _os_log_error_impl(&dword_19020E000, v20, OS_LOG_TYPE_ERROR, "Unable to send composition: %@ for messageItem: %@ with error: %@", buf, 0x20u);
          }
        }
      }

      else
      {
        v19 = IMLogHandleForCategory();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(CKChatController_Stickers) sendSticker:withMediaObject:composition:parentMessagePartChatItem:messageSummaryInfo:];
        }
      }
    }

    else
    {
      v19 = IMLogHandleForCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(CKChatController_Stickers) sendSticker:withMediaObject:composition:parentMessagePartChatItem:messageSummaryInfo:];
      }
    }
  }

  else
  {
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) sendSticker:withMediaObject:composition:parentMessagePartChatItem:messageSummaryInfo:];
    }
  }
}

void __132__CKChatController_CKChatController_Stickers__sendSticker_withMediaObject_composition_parentMessagePartChatItem_messageSummaryInfo___block_invoke(void *a1, int a2)
{
  v13 = *MEMORY[0x1E69E9840];
  if (a2)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v4 = a1[4];
      v11 = 138412290;
      v12 = v4;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Sticker was sensitive, deferring send for intervention: %@", &v11, 0xCu);
    }
  }

  else
  {
    v6 = a1[4];
    v5 = a1[5];
    v7 = a1[6];
    v8 = a1[7];
    v9 = a1[8];
    v10 = a1[9];

    [v5 _sendCommSafetyVerifiedSticker:v6 withMediaObject:v7 composition:v8 parentMessagePartChatItem:v9 messageSummaryInfo:v10];
  }
}

- (void)handleStickerDropConfirmCommSafetySendContext:(id)a3
{
  v4 = a3;
  v9 = [v4 sticker];
  v5 = [v4 mediaObject];
  v6 = [v4 composition];
  v7 = [v4 parentMessagePartChatItem];
  v8 = [v4 messageSummaryInfo];

  [(CKChatController *)self _sendCommSafetyVerifiedSticker:v9 withMediaObject:v5 composition:v6 parentMessagePartChatItem:v7 messageSummaryInfo:v8];
}

- (void)_sendCommSafetyVerifiedSticker:(id)a3 withMediaObject:(id)a4 composition:(id)a5 parentMessagePartChatItem:(id)a6 messageSummaryInfo:(id)a7
{
  v11 = a5;
  v12 = a6;
  v32 = a7;
  v33 = a4;
  v13 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = [v12 aggregateChatItems];
    v15 = [v14 firstObject];

    v12 = v15;
  }

  v35 = 0;
  v30 = [v11 superFormatText:&v35];
  v16 = v35;
  v29 = objc_alloc(MEMORY[0x1E69A5BD8]);
  v28 = [MEMORY[0x1E695DF00] date];
  v17 = [MEMORY[0x1E696AEC0] stringGUID];
  v18 = [v12 IMChatItem];
  v19 = [v18 guid];
  if ([v13 isEmojiSticker])
  {
    v20 = 1001;
  }

  else
  {
    v20 = 1000;
  }

  v31 = v11;
  v21 = [v12 messagePartRange];
  v23 = v22;
  v24 = [v12 threadIdentifier];
  v25 = [v29 initWithSender:0 time:v28 text:v30 messageSubject:0 fileTransferGUIDs:v16 flags:5 error:0 guid:v17 subject:0 associatedMessageGUID:v19 associatedMessageType:v20 associatedMessageRange:v21 messageSummaryInfo:v23 threadIdentifier:{v32, v24}];

  v26 = [v33 transfer];

  [v26 setIMMessage:v25];
  [CKAssociatedStickerChatItem addDroppedSticker:v13];
  v27 = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self sendMessage:v25 forConversation:v27 newComposition:0];

  [objc_opt_class() donateStickerToRecents:v13];
}

- (BOOL)repositionSticker:(id)a3 stickerChatItem:(id)a4 parentMessagePartChatItem:(id)a5 stickerPositioningInfo:(id)a6
{
  v61[1] = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v58 = a5;
  v59 = a6;
  v12 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  LOBYTE(a5) = [v12 isStickerRepositioningEnabled];

  if (a5)
  {
    v13 = 0;
    if (v10)
    {
      goto LABEL_3;
    }
  }

  else
  {
    v14 = IMLogHandleForCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v13 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:1 userInfo:0];
    if (v10)
    {
LABEL_3:
      if (v11)
      {
        goto LABEL_14;
      }

      goto LABEL_11;
    }
  }

  v15 = IMLogHandleForCategory();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
  {
    [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
  }

  v16 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:2 userInfo:0];

  v13 = v16;
  if (!v11)
  {
LABEL_11:
    v17 = IMLogHandleForCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v18 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:3 userInfo:0];

    v13 = v18;
  }

LABEL_14:
  if (!v59)
  {
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v20 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:4 userInfo:0];

    v13 = v20;
  }

  v21 = IMSharedHelperMissingKeysInStickerUserInfo();
  v57 = v21;
  if ([v21 count])
  {
    v22 = IMLogHandleForCategory();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v23 = [v21 componentsJoinedByString:@" "];
    v24 = MEMORY[0x1E696ABC0];
    v60 = *MEMORY[0x1E696A278];
    v25 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Missing keys: %@", v23];
    v61[0] = v25;
    v26 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v61 forKeys:&v60 count:1];
    v27 = [v24 errorWithDomain:@"CKChatControllerStickerErrorDomain" code:5 userInfo:v26];

    v13 = v27;
  }

  if (v13)
  {
    v28 = [MEMORY[0x1E69A8168] sharedInstance];
    [v28 forceAutoBugCaptureWithSubType:@"Invalid Sticker Reposition" errorPayload:v13];
  }

  else
  {
    v53 = self;
    v29 = [(CKCoreChatController *)self chat];
    v30 = [v11 IMChatItem];
    v31 = [v30 guid];
    v32 = [v31 _stripFZIDPrefix];
    v54 = [v29 messageItemForGUID:v32];

    v33 = [v54 message];
    v34 = [v33 messageSummaryInfo];
    v56 = [v34 mutableCopy];

    [v56 setValue:v59 forKey:*MEMORY[0x1E69A7258]];
    v51 = objc_alloc(MEMORY[0x1E69A5BD8]);
    v50 = [v33 sender];
    v49 = [v33 time];
    v48 = [v33 text];
    v47 = [v33 messageSubject];
    v46 = [v33 fileTransferGUIDs];
    [v33 guid];
    v35 = v55 = v10;
    v36 = [v33 subject];
    v37 = [v33 associatedMessageGUID];
    if ([v55 isEmojiSticker])
    {
      v38 = 1001;
    }

    else
    {
      v38 = 1000;
    }

    v39 = [v58 messagePartRange];
    v41 = v40;
    v42 = [v33 threadIdentifier];
    v52 = [v51 initWithSender:v50 time:v49 text:v48 messageSubject:v47 fileTransferGUIDs:v46 flags:5 error:0 guid:v35 subject:v36 associatedMessageGUID:v37 associatedMessageType:v38 associatedMessageRange:v39 messageSummaryInfo:v41 threadIdentifier:{v56, v42}];

    v10 = v55;
    [CKAssociatedStickerChatItem addDroppedSticker:v55];
    v43 = [(CKCoreChatController *)v53 conversation];
    v44 = [v11 IMChatItem];
    [v43 repositionSticker:v52 associatedChatItem:v44];

    v28 = v54;
  }

  return v13 == 0;
}

- (id)_originalIndexPathForRepositioningDropSession:(id)a3
{
  v19 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v3 = [a3 items];
  v4 = [v3 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v15;
LABEL_3:
    v7 = 0;
    while (1)
    {
      if (*v15 != v6)
      {
        objc_enumerationMutation(v3);
      }

      v8 = *(*(&v14 + 1) + 8 * v7);
      if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:v8])
      {
        v9 = [v8 localObject];
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) == 0)
        {
          goto LABEL_11;
        }

        v11 = [v8 localObject];
        v12 = [v11 objectForKey:@"kStickerDragItemOriginalIndexPathKey"];

        if (v12)
        {
          break;
        }
      }

      if (v5 == ++v7)
      {
        v5 = [v3 countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v5)
        {
          goto LABEL_3;
        }

        goto LABEL_11;
      }
    }
  }

  else
  {
LABEL_11:
    v12 = 0;
  }

  return v12;
}

- (id)_stickerChatItemForDragItem:(id)a3
{
  v3 = a3;
  if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:v3] && (objc_msgSend(v3, "localObject"), v4 = objc_claimAutoreleasedReturnValue(), objc_opt_class(), isKindOfClass = objc_opt_isKindOfClass(), v4, (isKindOfClass & 1) != 0))
  {
    v6 = [v3 localObject];
    v7 = [v6 objectForKey:@"kStickerDragItemChatItemKey"];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)_dropSessionIsNewSticker:(id)a3
{
  v14 = *MEMORY[0x1E69E9840];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v3 = [a3 items];
  v4 = [v3 countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v4)
  {
    v5 = *v10;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v10 != v5)
        {
          objc_enumerationMutation(v3);
        }

        v7 = *(*(&v9 + 1) + 8 * i);
        if ([MEMORY[0x1E69A82C0] dragItemIsSticker:v7] && !objc_msgSend(MEMORY[0x1E69A82C0], "dragItemIsRepositioningSticker:", v7))
        {
          LOBYTE(v4) = 1;
          goto LABEL_12;
        }
      }

      v4 = [v3 countByEnumeratingWithState:&v9 objects:v13 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  return v4;
}

- (void)_registerRepresentationsInItemProvider:(id)a3 sticker:(id)a4
{
  v21 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v6 = [a4 representations];
  v7 = [v6 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v17;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v17 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v16 + 1) + 8 * i);
        v12 = [v11 type];
        v13 = [v5 hasItemConformingToTypeIdentifier:v12];

        if ((v13 & 1) == 0)
        {
          v14 = [v11 type];
          v15[0] = MEMORY[0x1E69E9820];
          v15[1] = 3221225472;
          v15[2] = __94__CKChatController_CKChatController_Stickers___registerRepresentationsInItemProvider_sticker___block_invoke;
          v15[3] = &unk_1E72ECF58;
          v15[4] = v11;
          [v5 registerItemForTypeIdentifier:v14 loadHandler:v15];
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v8);
  }
}

void __94__CKChatController_CKChatController_Stickers___registerRepresentationsInItemProvider_sticker___block_invoke(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

- (void)_registerStandardRepresentationsInItemProvider:(id)a3 sticker:(id)a4 effectView:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = MEMORY[0x193AF5EC0](@"MSSticker", @"Messages");
  v12 = [v9 fileURL];

  if (v12)
  {
    v13 = [*MEMORY[0x1E6982F28] identifier];
    v45[0] = MEMORY[0x1E69E9820];
    v45[1] = 3221225472;
    v45[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke;
    v45[3] = &unk_1E72ECF80;
    v46 = v9;
    v47 = self;
    [v8 registerItemForTypeIdentifier:v13 loadHandler:v45];

    v14 = v46;
  }

  else
  {
    v15 = [v9 representations];
    v14 = [v15 firstObject];

    v16 = [(CKChatController *)self representationForRole:*MEMORY[0x1E69DEA88] sticker:v9];
    v17 = [(CKChatController *)self representationForRole:*MEMORY[0x1E69DEA78] sticker:v9];
    if (v14 && v14 == v16)
    {
      v18 = [v14 type];
      v43[0] = MEMORY[0x1E69E9820];
      v43[1] = 3221225472;
      v43[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_2;
      v43[3] = &unk_1E72ECF58;
      v44 = v14;
      [v8 registerItemForTypeIdentifier:v18 loadHandler:v43];
    }

    if (v17)
    {
      v30 = v11;
      v32 = v16;
      v31 = [v10 effect];
      v19 = MEMORY[0x1E69DCAB8];
      v20 = [v17 data];
      v21 = [v10 window];
      v22 = [v21 screen];
      [v22 scale];
      v23 = [v19 imageWithData:v20 scale:?];

      v24 = [v17 type];
      v25 = [*MEMORY[0x1E6982E00] identifier];
      LODWORD(v21) = [v24 isEqualToString:v25];

      if (v21)
      {
        v26 = [v17 type];
        v37[0] = MEMORY[0x1E69E9820];
        v37[1] = 3221225472;
        v37[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_3;
        v37[3] = &unk_1E72ECFD0;
        v38 = v31;
        v42 = v30;
        v39 = v23;
        v40 = self;
        v41 = v17;
        [v8 registerItemForTypeIdentifier:v26 loadHandler:v37];
      }

      v27 = [*MEMORY[0x1E6982F28] identifier];
      v33[0] = MEMORY[0x1E69E9820];
      v33[1] = 3221225472;
      v33[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_5;
      v33[3] = &unk_1E72ECFF8;
      v34 = v31;
      v35 = v23;
      v36 = self;
      v28 = v23;
      v29 = v31;
      [v8 registerItemForTypeIdentifier:v27 loadHandler:v33];

      v16 = v32;
    }
  }
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x1E69DCAB8];
  v4 = *(a1 + 32);
  v5 = a2;
  v6 = [v4 fileURL];
  v7 = [v6 path];
  v8 = [v3 imageWithContentsOfFile:v7];

  [*(a1 + 40) addPNGImage:v8 completion:v5];
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_2(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_3(uint64_t a1, void *a2, uint64_t a3, void *a4)
{
  v6 = a2;
  v7 = a4;
  if (*(a1 + 32) && [*(a1 + 64) _isHEICSupported])
  {
    v8 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v9 = [v8 isStickersAppEnabled];

    if (v9)
    {
      v10 = *(a1 + 32);
      v11 = *(a1 + 40);
      v13[0] = MEMORY[0x1E69E9820];
      v13[1] = 3221225472;
      v13[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_4;
      v13[3] = &unk_1E72ECFA8;
      v13[4] = *(a1 + 48);
      v14 = v6;
      [v10 applyToImage:v11 completion:v13];
    }
  }

  else
  {
    v12 = [*(a1 + 56) data];
    (*(v6 + 2))(v6, v12, 0);
  }
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_5(uint64_t a1, void *a2, uint64_t a3, void *a4)
{
  v6 = a2;
  v7 = a4;
  if (*(a1 + 32))
  {
    v8 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v9 = [v8 isStickersAppEnabled];

    if (v9)
    {
      v10 = *(a1 + 32);
      v11 = *(a1 + 40);
      v12[0] = MEMORY[0x1E69E9820];
      v12[1] = 3221225472;
      v12[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_6;
      v12[3] = &unk_1E72ECFA8;
      v12[4] = *(a1 + 48);
      v13 = v6;
      [v10 applyToImage:v11 completion:v12];
    }
  }

  else
  {
    [*(a1 + 48) addPNGImage:*(a1 + 40) completion:v6];
  }
}

- (id)representationForRole:(id)a3 sticker:(id)a4
{
  v19 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v6 = [a4 representations];
  v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = *v15;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(v6);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        v11 = [v10 role];
        v12 = [v11 isEqualToString:v5];

        if (v12)
        {
          v7 = v10;
          goto LABEL_11;
        }
      }

      v7 = [v6 countByEnumeratingWithState:&v14 objects:v18 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v7;
}

- (void)addHEICImage:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  [a3 CGImage];
  v8 = IMCreateHEICSImageDataFromCGImageRef();
  v7[2](v7, v8, 0);
}

- (void)addPNGImage:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  [a3 CGImage];
  v8 = IMCreatePNGImageDataFromCGImageRef();
  v7[2](v7, v8, 0);
}

- (void)saveStickerFromChatItem:(id)a3 pluginSourceView:(id)a4 animateFlyIn:(BOOL)a5
{
  v8 = a3;
  v9 = a4;
  if (v8)
  {
    [(CKChatController *)self dismissKeyboard];
    v10 = IMStickersExtensionIdentifier();
    v11 = IMBalloonExtensionIDWithSuffix();

    v12 = [(CKCoreChatController *)self inputController];
    [v12 showPluginWithExtensionIdentifier:v11 sourceView:v9];

    v13 = [(CKCoreChatController *)self collectionViewController];
    v14 = [v13 collectionView];
    v15 = +[CKUIBehavior sharedBehaviors];
    v16 = [v15 shouldScrollToSavedSticker];

    if (v16)
    {
      [v14 setIgnoresAutomaticScrollsTowardBottom:1];
      v17 = [(CKCoreChatController *)self inputController];
      [v17 _appCardHeightWithSafeArea];
      v19 = v18;
      v20 = [(CKChatController *)self entryView];
      [v20 frame];
      v22 = v19 + v21;

      v23 = [(CKCoreChatController *)self collectionViewController];
      v24 = [v23 collectionView];
      [v24 contentInset];
      v26 = v25;
      v28 = v27;
      v30 = v29;

      [v14 bounds];
      v61.origin.x = v28 + v31;
      v32 = 0.0;
      v61.origin.y = v26 + 0.0;
      v61.size.width = v33 - (v28 + v30);
      v61.size.height = v34 - (v22 + v26);
      MidY = CGRectGetMidY(v61);
      v36 = [v13 balloonViewForChatItem:v8];
      if (v36)
      {
        v37 = [(CKChatController *)self view];
        [v36 frame];
        v39 = v38;
        v41 = v40;
        v43 = v42;
        v45 = v44;
        v46 = [v36 superview];
        [v37 convertRect:v46 fromView:{v39, v41, v43, v45}];
        v48 = v47;
        v50 = v49;
        v52 = v51;
        v54 = v53;

        *&v62.origin.x = v48;
        *&v62.origin.y = v50;
        *&v62.size.width = v52;
        *&v62.size.height = v54;
        v32 = CGRectGetMidY(v62) - MidY;
      }

      else
      {
        v48 = *MEMORY[0x1E695F058];
        v50 = *(MEMORY[0x1E695F058] + 8);
        v52 = *(MEMORY[0x1E695F058] + 16);
        v54 = *(MEMORY[0x1E695F058] + 24);
      }

      objc_initWeak(location, self);
      v56[0] = MEMORY[0x1E69E9820];
      v56[1] = 3221225472;
      v56[2] = __101__CKChatController_CKChatController_Stickers__saveStickerFromChatItem_pluginSourceView_animateFlyIn___block_invoke;
      v56[3] = &unk_1E72ED020;
      objc_copyWeak(v58, location);
      v59 = a5;
      v58[1] = v48;
      v58[2] = v50;
      v58[3] = v52;
      v58[4] = v54;
      v58[5] = 0;
      v58[6] = *&MidY;
      v57 = v8;
      [(CKChatController *)self fullScreenBalloonViewController:0 verticallyScrollTranscriptByAmount:1 animated:v56 duration:v32 completion:0.3];

      objc_destroyWeak(v58);
      objc_destroyWeak(location);
    }

    else
    {
      v55 = [CKUtilities saveableStickerFromChatItem:v8];
      [(CKChatController *)self saveSticker:v55 sourceRect:*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)];
    }
  }
}

void __101__CKChatController_CKChatController_Stickers__saveStickerFromChatItem_pluginSourceView_animateFlyIn___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained collectionViewController];
  v4 = [v3 collectionView];
  [v4 setIgnoresAutomaticScrollsTowardBottom:0];

  v5 = (MEMORY[0x1E695F058] + 24);
  v6 = (MEMORY[0x1E695F058] + 16);
  v7 = (MEMORY[0x1E695F058] + 8);
  v8 = (a1 + 48);
  if (*(a1 + 96) == 1)
  {
    v7 = (a1 + 88);
    v6 = (a1 + 64);
    v5 = (a1 + 72);
  }

  else
  {
    v8 = MEMORY[0x1E695F058];
  }

  v9 = *v8;
  v10 = *v5;
  v11 = *v6;
  v12 = *v7;
  v14 = [CKUtilities saveableStickerFromChatItem:*(a1 + 32)];
  v13 = objc_loadWeakRetained((a1 + 40));
  [v13 saveSticker:v14 sourceRect:{v9, v12, v11, v10}];
}

- (void)saveStickerFromTapbackAttributionFlow:(id)a3
{
  v4 = a3;
  v5 = IMStickersExtensionIdentifier();
  v7 = IMBalloonExtensionIDWithSuffix();

  v6 = [(CKCoreChatController *)self inputController];
  [v6 showPluginWithExtensionIdentifier:v7 sourceView:0];

  [(CKChatController *)self saveSticker:v4 sourceRect:*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)];
}

- (void)saveStickerFromEmojiDetails:(id)a3
{
  v4 = a3;
  v5 = IMStickersExtensionIdentifier();
  v7 = IMBalloonExtensionIDWithSuffix();

  v6 = [(CKCoreChatController *)self inputController];
  [v6 showPluginWithExtensionIdentifier:v7 sourceView:0];

  [(CKChatController *)self saveSticker:v4 sourceRect:*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)];
}

- (void)saveSticker:(id)a3 sourceRect:(CGRect)a4
{
  height = a4.size.height;
  width = a4.size.width;
  y = a4.origin.y;
  x = a4.origin.x;
  v9 = a3;
  v10 = v9;
  if (v9)
  {
    v11 = [v9 uiSticker];
    if (v11)
    {
      v24 = 0;
      v25 = &v24;
      v26 = 0x3032000000;
      v27 = __Block_byref_object_copy__5;
      v28 = __Block_byref_object_dispose__5;
      v29 = 0;
      v12 = [(CKCoreChatController *)self inputController];
      v13 = [v12 appCardPresentationOverseer];

      v14 = [v13 browserViewController];
      v15 = v25[5];
      v25[5] = v14;

      if (v25[5])
      {
        v16 = dispatch_time(0, 500000000);
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __70__CKChatController_CKChatController_Stickers__saveSticker_sourceRect___block_invoke;
        block[3] = &unk_1E72ED048;
        block[4] = self;
        v20 = x;
        v21 = y;
        v22 = width;
        v23 = height;
        v18 = v11;
        v19 = &v24;
        dispatch_after(v16, MEMORY[0x1E69E96A0], block);
      }

      _Block_object_dispose(&v24, 8);
    }
  }
}

void __112__CKChatController_CKChatController_Stickers___addStickerToStoreWithUISticker_sourceRect_browserViewController___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v12 = *MEMORY[0x1E69E9840];
  v4 = a2;
  v5 = a3;
  if (v5 && IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [v5 description];
      v10 = 138412290;
      v11 = v7;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Unable to save sticker with error: %@", &v10, 0xCu);
    }
  }

  if (v4 && IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [v4 description];
      v10 = 138412290;
      v11 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Stickers added: %@", &v10, 0xCu);
    }
  }
}

- (id)_stickerFromChatItem:(id)a3
{
  v3 = a3;
  if (v3 && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
  {
    v4 = [v3 mediaObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass() & 1) != 0 || (objc_opt_class(), (objc_opt_isKindOfClass()))
    {
      v5 = [v4 sticker];
    }

    else
    {
      v5 = 0;
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)_dragItemsIfRepositioningForInteraction:(id)a3
{
  v80[4] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v6 = [v5 isStickerRepositioningEnabled];

  if (!v6)
  {
    v33 = 0;
    goto LABEL_18;
  }

  v7 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:v4];
  if (v7)
  {
    v8 = [(CKChatController *)self collectionView];
    v9 = [v8 indexPathForCell:v7];

    v10 = [(CKCoreChatController *)self collectionViewController];
    v11 = [v10 chatItemAtIndexPath:v9];

    v12 = [v7 associatedItemView];
    v13 = [v7 effectView];
    if (!v11 || (objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) || ![v11 itemIsFromMe])
    {
      v34 = 1;
LABEL_13:

      if (v34)
      {
        v33 = 0;
      }

      else
      {
        v33 = self;
      }

      goto LABEL_17;
    }

    v56 = v11;
    v14 = [v56 sticker];
    v15 = [v56 attributionInfo];
    [v14 setAttributionInfo:v15];

    v16 = [v56 attributionInfo];
    v17 = [v16 objectForKey:*MEMORY[0x1E69A6F98]];
    [v14 setAccessibilityLabel:v17];

    v58 = objc_alloc_init(MEMORY[0x1E696ACA0]);
    [v13 bounds];
    v19 = *MEMORY[0x1E695F060];
    if (v20 == *MEMORY[0x1E695F060] && (v21 = *(MEMORY[0x1E695F060] + 8), v18 == v21))
    {
      [v12 bounds];
      if (v23 == v19 && v22 == v21)
      {
        v24 = [v12 superview];
        [v24 frame];
        v26 = v25;
        v28 = v27;
        v30 = v29;
        v32 = v31;

LABEL_24:
        v45 = MEMORY[0x193AF5EC0](@"_MSMessageMediaPayload", @"Messages");
        v46 = objc_opt_class();
        v68[0] = MEMORY[0x1E69E9820];
        v68[1] = 3221225472;
        v68[2] = __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke;
        v68[3] = &unk_1E72ED090;
        v71 = v45;
        v72 = v26;
        v73 = v28;
        v74 = v30;
        v75 = v32;
        v55 = v14;
        v69 = v55;
        v70 = self;
        [v58 registerObjectOfClass:v46 visibility:0 loadHandler:v68];
        [(CKChatController *)self _registerStandardRepresentationsInItemProvider:v58 sticker:v55 effectView:v13];
        [(CKChatController *)self _registerRepresentationsInItemProvider:v58 sticker:v55];
        [v58 registerItemForTypeIdentifier:@"com.apple.sticker" loadHandler:&__block_literal_global_338];
        v62 = 0;
        v63 = &v62;
        v64 = 0x3032000000;
        v65 = __Block_byref_object_copy__5;
        v66 = __Block_byref_object_dispose__5;
        v67 = 0;
        v47 = [(CKCoreChatController *)self collectionViewController];
        v48 = [v47 chatItems];
        v59[0] = MEMORY[0x1E69E9820];
        v59[1] = 3221225472;
        v59[2] = __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_3;
        v59[3] = &unk_1E72ED100;
        v54 = v56;
        v60 = v54;
        v61 = &v62;
        [v48 enumerateObjectsUsingBlock:v59];

        v57 = [objc_alloc(MEMORY[0x1E69DC990]) initWithItemProvider:v58];
        if (v63[5])
        {
          v49 = [(CKCoreChatController *)self collectionViewController];
          v50 = [v49 cellForChatItem:v63[5]];

          v79[0] = @"kStickerDragItemImageViewKey";
          v79[1] = @"kStickerDragItemChatItemKey";
          v80[0] = v12;
          v80[1] = v54;
          v79[2] = @"kStickerDragItemOriginalIndexPathKey";
          v51 = [(CKChatController *)self collectionView];
          v52 = [v51 indexPathForCell:v50];
          v79[3] = @"kStickerIsRepositioningKey";
          v80[2] = v52;
          v80[3] = MEMORY[0x1E695E118];
          v53 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v80 forKeys:v79 count:4];
          [v57 setLocalObject:v53];
        }

        else
        {
          v77[0] = @"kStickerDragItemImageViewKey";
          v77[1] = @"kStickerDragItemChatItemKey";
          v78[0] = v12;
          v78[1] = v54;
          v77[2] = @"kStickerIsRepositioningKey";
          v78[2] = MEMORY[0x1E695E118];
          v50 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v78 forKeys:v77 count:3];
          [v57 setLocalObject:v50];
        }

        v76 = v57;
        self = [MEMORY[0x1E695DEC8] arrayWithObjects:&v76 count:1];

        _Block_object_dispose(&v62, 8);
        v34 = 0;
        goto LABEL_13;
      }

      [v12 center];
      [v12 convertPoint:0 toView:?];
      v37 = v41;
      v39 = v42;
      v40 = v12;
    }

    else
    {
      [v13 center];
      [v13 convertPoint:0 toView:?];
      v37 = v36;
      v39 = v38;
      v40 = v13;
    }

    [v40 bounds];
    v30 = v43;
    v32 = v44;
    v26 = v37 - v43 * 0.5;
    v28 = v39 - v44 * 0.5;
    goto LABEL_24;
  }

  v33 = 0;
LABEL_17:

LABEL_18:

  return v33;
}

uint64_t __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke(uint64_t a1, void *a2)
{
  v3 = *(a1 + 48);
  v4 = a2;
  v5 = [[v3 alloc] initWithIMSticker:*(a1 + 32)];
  [v5 setSourceFrame:{*(a1 + 56), *(a1 + 64), *(a1 + 72), *(a1 + 80)}];
  v6 = [*(a1 + 40) initialFrameIndexForCurrentDrag];
  if (v6 != 0x7FFFFFFFFFFFFFFFLL)
  {
    [v5 setInitialFrameIndex:v6];
  }

  [*(a1 + 40) setInitialFrameIndexForCurrentDrag:0x7FFFFFFFFFFFFFFFLL];
  v4[2](v4, v5, 0);

  return 0;
}

void __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_2(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = MEMORY[0x1E695DEF0];
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

void __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_3(uint64_t a1, void *a2, uint64_t a3, uint64_t a4)
{
  v6 = a2;
  v7 = [v6 visibleAssociatedMessageChatItems];
  v8 = [v7 count];

  if (v8)
  {
    v9 = [v6 visibleAssociatedMessageChatItems];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_4;
    v12[3] = &unk_1E72ED0D8;
    v10 = *(a1 + 32);
    v11 = *(a1 + 40);
    v13 = v10;
    v15 = v11;
    v14 = v6;
    v16 = a4;
    [v9 enumerateObjectsUsingBlock:v12];
  }
}

void __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_4(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  if ([a2 isEqual:*(a1 + 32)])
  {
    objc_storeStrong((*(*(a1 + 48) + 8) + 40), *(a1 + 40));
    **(a1 + 56) = 1;
    *a4 = 1;
  }
}

- (id)_transcriptStickerCellContainingInteraction:(id)a3
{
  v23 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKChatController *)self collectionView];
  v6 = [v5 visibleCells];

  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  v7 = v6;
  v8 = [v7 countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v19;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v19 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v18 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v13 = v12;
          v14 = [v13 associatedItemView];
          v15 = [v14 interactions];
          v16 = [v15 containsObject:v4];

          if (v16)
          {
            goto LABEL_12;
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v9);
  }

  v13 = 0;
LABEL_12:

  return v13;
}

- (void)presentStickerDetailControllerWithIndexPath:(id)a3
{
  v4 = MEMORY[0x1E695DF70];
  v5 = a3;
  v6 = objc_alloc_init(v4);
  v7 = [(CKChatController *)self _parentChatItemForIndexPath:v5];

  v8 = [v7 visibleAssociatedMessageChatItems];

  if (v8)
  {
    v9 = [v7 visibleAssociatedMessageChatItems];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __103__CKChatController_CKStickerDetailViewControllerDelegate__presentStickerDetailControllerWithIndexPath___block_invoke;
    v11[3] = &unk_1E72EC100;
    v12 = v6;
    [v9 enumerateObjectsUsingBlock:v11];
  }

  if ([v6 count])
  {
    v10 = [[CKStickerDetailViewController alloc] initWithStickerChatItems:v6];
    [(CKChatController *)self presentStickerDetailsViewController:v10 fromChatItem:v7];
  }
}

void __103__CKChatController_CKStickerDetailViewControllerDelegate__presentStickerDetailControllerWithIndexPath___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [*(a1 + 32) addObject:v3];
  }
}

- (void)presentEmojiDetailsControllerWithIndexPath:(id)a3
{
  v9 = [(CKChatController *)self _parentChatItemForIndexPath:a3];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = v9;
  if (isKindOfClass)
  {
    v6 = v9;
    v7 = [v6 emojiImageMediaObjectsInMessagePartText];
    if ([v7 count])
    {
      v8 = [[CKStickerDetailViewController alloc] initWithEmojiImageMediaObjects:v7];
      [(CKChatController *)self presentStickerDetailsViewController:v8 fromChatItem:v6];
    }

    v5 = v9;
  }
}

- (void)presentStickerDetailsViewController:(id)a3 fromChatItem:(id)a4
{
  v6 = a4;
  v7 = a3;
  [v7 setDelegate:self];
  v12 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v7];

  if (CKIsRunningInMacCatalyst())
  {
    v8 = 7;
  }

  else
  {
    v8 = 2;
  }

  [v12 setModalPresentationStyle:v8];
  v9 = [(CKCoreChatController *)self collectionViewController];
  v10 = [v9 balloonViewForChatItem:v6];

  if (v10)
  {
    v11 = [v12 popoverPresentationController];
    [v11 setSourceView:v10];

    [(CKChatController *)self presentViewController:v12 animated:1 completion:0];
  }
}

- (void)stickerDetailViewController:(id)a3 selectedStickerPackWithAdamID:(id)a4
{
  v5 = a4;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __117__CKChatController_CKStickerDetailViewControllerDelegate__stickerDetailViewController_selectedStickerPackWithAdamID___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = v5;
  v6 = v5;
  [(CKChatController *)self dismissViewControllerAnimated:1 completion:v7];
}

- (void)saveStickerFromDetailViewController:(id)a3 chatItemContainingSticker:(id)a4
{
  if (a4)
  {
    [(CKChatController *)self saveStickerFromChatItem:a4 pluginSourceView:0 animateFlyIn:0];
  }
}

- (void)_dealloc
{
  v3 = [(CKChatController *)self effectPickerViewController];
  [v3 dismissViewControllerAnimated:0 completion:0];

  v4 = [(CKCoreChatController *)self conversation];
  [v4 updateLastViewedDate];

  v5 = [(CKCoreChatController *)self chat];
  [v5 dismissInlineReplies];

  [(CKScheduledUpdater *)self->_transcriptInlineNotificationUpdater invalidate];
  [(CADisplayLink *)self->_stickerTranscriptScrollDisplayLink invalidate];
  [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
  v6 = [(CKChatController *)self autorotationUpdater];
  [v6 invalidate];

  [(CKChatController *)self setAutorotationUpdater:0];
  v7 = [(CKChatController *)self typingUpdater];
  [v7 invalidate];

  [(CKChatController *)self setTypingUpdater:0];
  [(CKChatController *)self hideMediaPickerAnimated:0];
  v8 = [(CKCoreChatController *)self collectionViewController];
  [v8 setDragInteractionDelegate:0];

  v9 = [MEMORY[0x1E69DC938] currentDevice];
  if ([v9 _supportsForceTouch])
  {
    v10 = +[CKUIBehavior sharedBehaviors];
    v11 = [v10 disableTranscriptOrb];

    if (v11)
    {
      goto LABEL_5;
    }

    v9 = [(CKChatController *)self view];
    [(CKChatController *)self unregisterPreviewSourceView:v9];
  }

LABEL_5:
  v12 = [MEMORY[0x193AF5EC0](@"AFContextManager" @"AssistantServices")];
  [v12 removeContextProvider:self];

  v13 = [(CKChatController *)self funCameraViewController];

  if (v13)
  {
    v14 = [(CKChatController *)self funCameraViewController];
    [v14 dismiss];
  }

  DarwinNotifyCenter = CFNotificationCenterGetDarwinNotifyCenter();
  CFNotificationCenterRemoveObserver(DarwinNotifyCenter, self, @"CKDraftManagerSavedDraft", 0);
  if (!CKIsRunningInMessagesViewService() && !CKIsRunningInMessagesNotificationExtension())
  {
    v16 = +[CKBalloonPluginManager sharedInstance];
    [v16 invalidateAllActivePlugins];

    v17 = +[CKBalloonPluginManager sharedInstance];
    [v17 forceKillRemoteExtensionsWithDelay:1];
  }

  [(CKChatController *)self clearTranslationCache];
}

- (void)dealloc
{
  [(CKChatController *)self _dealloc];
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 dealloc];
}

- (void)prepareToDismissForSecondInstance
{
  v2 = [(CKCoreChatController *)self inputController];
  [v2 dismiss];
}

- (CKChatController)initWithConversation:(id)a3
{
  v48.receiver = self;
  v48.super_class = CKChatController;
  v3 = [(CKCoreChatController *)&v48 initWithConversation:a3];
  v4 = v3;
  if (v3)
  {
    v3->_keyboardSnapshotReason = 0;
    [(CKChatController *)v3 _updateRecipientCapabilities];
    v5 = [objc_alloc(MEMORY[0x1E69A6158]) initWithTarget:v4 action:sel__autorotationUpdaterFired];
    [(CKChatController *)v4 setAutorotationUpdater:v5];
    [(CKChatController *)v4 setTargetFirstResponder:0];
    v6 = [[CKScheduledUpdater alloc] initWithTarget:v4 action:sel_updateTyping];
    [(CKChatController *)v4 setTypingUpdater:v6];
    if (CKIsRunningInMessages())
    {
      v7 = [[CKScheduledUpdater alloc] initWithTarget:v4 action:sel__updateBannerNotifications];
      transcriptInlineNotificationUpdater = v4->_transcriptInlineNotificationUpdater;
      v4->_transcriptInlineNotificationUpdater = v7;

      [(CKScheduledUpdater *)v4->_transcriptInlineNotificationUpdater setUpdateSynchronouslyIfPossible:1];
      v9 = [MEMORY[0x1E696AD88] defaultCenter];
      [v9 addObserver:v4 selector:sel__handleIsUnexpectedlyLoggedOutChanged_ name:@"com.apple.ChatKit.IsUnexpectedlyLoggedOutChanged" object:0];

      v10 = [MEMORY[0x1E696AD88] defaultCenter];
      [v10 addObserver:v4 selector:sel_composeRecipientViewShouldResignFirstResponder name:@"com.apple.ChatKit.CKComposeRecipientView.BecameFirstResponder" object:0];

      v11 = [MEMORY[0x1E696AD88] defaultCenter];
      [v11 addObserver:v4 selector:sel_keyboardShouldShowPredictions_ name:*MEMORY[0x1E69DE048] object:0];

      v12 = [MEMORY[0x1E696AD88] defaultCenter];
      [v12 addObserver:v4 selector:sel_keyboardShouldShowCandidates_ name:*MEMORY[0x1E69DE040] object:0];

      v13 = [MEMORY[0x1E696AD88] defaultCenter];
      [v13 addObserver:v4 selector:sel_keyboardWillBeginInteractiveDismissal_ name:*MEMORY[0x1E69DE010] object:0];

      v14 = [MEMORY[0x1E696AD88] defaultCenter];
      [v14 addObserver:v4 selector:sel_windowDidResignKey_ name:*MEMORY[0x1E69DE7C8] object:0];

      v15 = [MEMORY[0x1E696AD88] defaultCenter];
      [v15 addObserver:v4 selector:sel__balloonPluginExtensionsLoaded_ name:*MEMORY[0x1E69A56C8] object:0];

      v16 = [MEMORY[0x1E696AD88] defaultCenter];
      [v16 addObserver:v4 selector:sel__prewarmBalloonPluginViewCacheCompleted_ name:@"__kCKPrewarmBalloonPluginViewCacheCompletedNotification" object:0];

      v17 = [MEMORY[0x1E696AD88] defaultCenter];
      [v17 addObserver:v4 selector:sel__messageReceived_ name:*MEMORY[0x1E69A5828] object:0];

      v18 = [MEMORY[0x1E696AD88] defaultCenter];
      [v18 addObserver:v4 selector:sel__handleGroupPhotoChanged_ name:@"CKConversationShowGroupPhotoBannersNotification" object:0];

      v19 = [MEMORY[0x1E696AD88] defaultCenter];
      [v19 addObserver:v4 selector:sel__handleGroupNameChanged_ name:@"CKConversationShowGroupNameBannersNotification" object:0];

      v20 = [MEMORY[0x1E696AD88] defaultCenter];
      [v20 addObserver:v4 selector:sel__transferFileTooLarge_ name:@"CKTransferFileTooLargeNotification" object:0];

      v21 = [MEMORY[0x1E696AD88] defaultCenter];
      [v21 addObserver:v4 selector:sel__handleCollaborationNoticesChanged_ name:*MEMORY[0x1E69A5950] object:0];

      v22 = [MEMORY[0x1E696AD88] defaultCenter];
      [v22 addObserver:v4 selector:sel__handleTranslationSupportChanged_ name:*MEMORY[0x1E69A6AC0] object:0];

      v23 = [MEMORY[0x1E696AD88] defaultCenter];
      [v23 addObserver:v4 selector:sel__handleTranslationSettingChanged_ name:*MEMORY[0x1E69A56F0] object:0];

      v24 = [MEMORY[0x1E696AD88] defaultCenter];
      [v24 addObserver:v4 selector:sel__updateForNewPreferredService name:*MEMORY[0x1E69A5908] object:0];

      v25 = [MEMORY[0x1E696AD88] defaultCenter];
      [v25 addObserver:v4 selector:sel__updateForNewPreferredService name:*MEMORY[0x1E69A7050] object:0];

      v26 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v27 = [v26 isIntroductionsEnabled];

      if (v27)
      {
        v28 = [MEMORY[0x1E696AD88] defaultCenter];
        [v28 addObserver:v4 selector:sel__handleIsFilteredChange name:*MEMORY[0x1E69A5740] object:0];
      }

      DarwinNotifyCenter = CFNotificationCenterGetDarwinNotifyCenter();
      CFNotificationCenterAddObserver(DarwinNotifyCenter, v4, _restoreDraftFromMessagesNotificationExtension, @"CKDraftManagerSavedDraft", v4, CFNotificationSuspensionBehaviorDeliverImmediately);
    }

    v30 = [MEMORY[0x1E696AD88] defaultCenter];
    [v30 addObserver:v4 selector:sel__handleDictationStarted_ name:@"UIKeyboardDidBeginDictationNotification" object:0];

    v31 = [MEMORY[0x1E696AD88] defaultCenter];
    [v31 addObserver:v4 selector:sel__handleDictationEnded_ name:*MEMORY[0x1E69DDCC8] object:0];

    v32 = [MEMORY[0x1E696AD88] defaultCenter];
    [v32 addObserver:v4 selector:sel_keyboardWillChangeFrame_ name:*MEMORY[0x1E69DE068] object:0];

    v4->_shouldBecomeFirstResponderWhenDismissingModalBrowser = 1;
    v33 = objc_opt_new();
    standardSuggestionPresenter = v4->_standardSuggestionPresenter;
    v4->_standardSuggestionPresenter = v33;

    [(SGSuggestionPresenter *)v4->_standardSuggestionPresenter setDelegate:v4];
    v35 = +[CKUIBehavior sharedBehaviors];
    v36 = [v35 supportsFoundInSuggestions];

    if (v36)
    {
      v37 = objc_opt_new();
      foundInSuggestionPresenter = v4->_foundInSuggestionPresenter;
      v4->_foundInSuggestionPresenter = v37;

      [(SGFoundInSuggestionPresenter *)v4->_foundInSuggestionPresenter setDelegate:v4];
    }

    v39 = [[_TtC7ChatKit16CKChatTipManager alloc] initWithChatController:v4];
    tipManager = v4->_tipManager;
    v4->_tipManager = v39;

    [(CKChatTipManager *)v4->_tipManager setDelegate:v4];
    v41 = [MEMORY[0x1E69A7FD0] sharedInstance];
    v4->_shouldFetchCollaborationNotices = [v41 isBatchFetchingForLaunchCompleted];

    v42 = [MEMORY[0x1E69A5B28] sharedInstance];
    [(CKChatController *)v4 setEffectPickerIsPresented:0];
    v43 = objc_alloc_init(MEMORY[0x1E695DF90]);
    [(CKChatController *)v4 setFileURLKeyToGuidMapping:v43];

    v44 = [MEMORY[0x1E695DF90] dictionary];
    [(CKChatController *)v4 setActiveDropPreviews:v44];

    v45 = objc_alloc_init(_TtC7ChatKit25CKSuggestedActionsHandler);
    [(CKChatController *)v4 setSuggestedActionsHandler:v45];

    v46 = [(CKChatController *)v4 suggestedActionsHandler];
    [v46 setDelegate:v4];

    [(CKChatController *)v4 setIsWebViewVisible:0];
    [(CKChatController *)v4 setSendingCompositionBackgroundTask:*MEMORY[0x1E69DDBE8]];
  }

  return v4;
}

- (void)_handleGroupPhotoChanged:(id)a3
{
  v28[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 object];
  v6 = [(CKCoreChatController *)self conversation];
  v7 = [v6 shouldDisplayGroupIdentity];

  if (v7)
  {
    v8 = [v5 chatIdentifier];
    v9 = [(CKCoreChatController *)self chat];
    v10 = [v9 chatIdentifier];
    v11 = [v8 isEqualToString:v10];

    if (v11)
    {
      v12 = [v4 userInfo];
      v13 = [v12 valueForKey:@"CKGroupPhotoUpdate"];
      v14 = [(CKChatController *)self groupPhotoUpdateBanner];

      if (v14)
      {
        v15 = [(CKChatController *)self groupPhotoUpdateBanner];
        v16 = [v15 groupUpdates];
        v17 = [v16 firstObject];
        v18 = [v17 handleID];

        v19 = [v13 handleID];
        v20 = [v18 isEqualToString:v19];
        v21 = [(CKChatController *)self groupPhotoUpdateBanner];
        v22 = [v21 updateBannerType];

        if (v22 != 2 && v22 != 4 && v20)
        {
          v23 = [v13 groupUpdateType];
          v24 = 3;
          v25 = 3;
          if (v22 == 5)
          {
            v25 = 6;
          }

          if (v22 == 1)
          {
            v25 = 7;
          }

          v26 = 3;
          if (v22 == 5)
          {
            v26 = 8;
          }

          if (v23 == 2)
          {
            v24 = v26;
          }

          if (v23 == 4)
          {
            v27 = v25;
          }

          else
          {
            v27 = v24;
          }

          [v13 setGroupUpdateType:v27];
        }

        [(CKChatController *)self dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:v13];
      }

      else
      {
        v28[0] = v13;
        v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v28 count:1];
        [(CKChatController *)self showBannerForGroupUpdate:v18];
      }
    }
  }
}

- (void)_handleGroupNameChanged:(id)a3
{
  v30[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 object];
  v6 = [v5 chatIdentifier];
  v7 = [(CKCoreChatController *)self chat];
  v8 = [v7 chatIdentifier];
  v9 = [v6 isEqualToString:v8];

  if (v9)
  {
    [(CKChatController *)self _updateTitleAnimated:1];
    if ([(CKChatController *)self shouldUseMacRecipientsView])
    {
      v10 = [(CKChatController *)self macRecipientsController];
      [v10 refreshRecipients];
    }

    v11 = [v4 userInfo];
    v12 = [v11 valueForKey:@"GroupNameUpdate"];
    if (v12)
    {
      v13 = [MEMORY[0x1E695DFB0] null];

      if (v12 != v13)
      {
        v14 = [(CKChatController *)self groupPhotoUpdateBanner];

        if (v14)
        {
          v15 = [(CKChatController *)self groupPhotoUpdateBanner];
          v16 = [v15 groupUpdates];
          v17 = [v16 firstObject];
          v18 = [v17 handleID];

          v19 = [v12 handleID];
          v20 = [v18 isEqualToString:v19];
          v21 = [(CKChatController *)self groupPhotoUpdateBanner];
          v22 = [v21 updateBannerType];

          if ((v22 & 0xFFFFFFFFFFFFFFFBLL) != 1 && v20)
          {
            v23 = [(CKChatController *)self groupPhotoUpdateBanner];
            v24 = [v23 updateBannerType];

            v25 = [v12 groupUpdateType];
            v26 = 3;
            v27 = 3;
            if (v24 == 4)
            {
              v27 = 6;
            }

            if (v24 == 2)
            {
              v27 = 8;
            }

            v28 = 3;
            if (v24 == 4)
            {
              v28 = 7;
            }

            if (v25 == 1)
            {
              v26 = v28;
            }

            if (v25 == 5)
            {
              v29 = v27;
            }

            else
            {
              v29 = v26;
            }

            [v12 setGroupUpdateType:v29];
          }

          [(CKChatController *)self dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:v12];
        }

        else
        {
          v30[0] = v12;
          v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:1];
          [(CKChatController *)self showBannerForGroupUpdate:v18];
        }
      }
    }
  }
}

- (void)_messageReceived:(id)a3
{
  v28 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 object];
  v6 = [v5 personCentricID];
  v7 = [(CKCoreChatController *)self chat];
  v8 = [v7 personCentricID];
  v9 = [v6 isEqualToString:v8];

  if (v9)
  {
    v10 = [v4 userInfo];
    v11 = [v10 objectForKey:*MEMORY[0x1E69A5928]];

    v12 = [v11 sender];
    v13 = [v12 account];
    v14 = [v13 service];

    if (v14)
    {
      v15 = [(CKCoreChatController *)self conversation];
      v16 = [v15 sendingService];

      if (v14 != v16)
      {
        if (IMOSLoggingEnabled())
        {
          v17 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            v23 = [v11 sender];
            v18 = [v23 account];
            v19 = [v18 service];
            v20 = [(CKCoreChatController *)self conversation];
            v21 = [v20 sendingService];
            *buf = 138412546;
            v25 = v19;
            v26 = 2112;
            v27 = v21;
            _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Refresh service: received a message with service %@ different than current chat service %@", buf, 0x16u);
          }
        }

        v22 = [(CKCoreChatController *)self chat];
        [v22 refreshServiceForSending];
      }
    }
  }
}

- (void)_transferFileTooLarge:(id)a3
{
  v4 = a3;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"FILE_TOO_LARGE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  v7 = [v4 userInfo];

  v8 = [v7 objectForKey:@"kCKTransferFileTooLargeAttachmentURLKey"];
  v9 = [v8 lastPathComponent];

  if (v9)
  {
    v10 = MEMORY[0x1E696AEC0];
    v11 = CKFrameworkBundle();
    v12 = [v11 localizedStringForKey:@"FILE_TOO_LARGE_DESC" value:&stru_1F04268F8 table:@"ChatKit"];
    v13 = [v10 stringWithFormat:v12, v9];

    v14 = [MEMORY[0x1E69DC668] sharedApplication];
    v15 = [v14 userInterfaceLayoutDirection];

    if (v15 == 1)
    {
      v16 = @"\u200F";
    }

    else
    {
      v16 = @"\u200E";
    }

    v17 = [(__CFString *)v16 stringByAppendingString:v13];
  }

  else
  {
    v13 = CKFrameworkBundle();
    v17 = [v13 localizedStringForKey:@"FILE_TOO_LARGE_NO_NAME_DESC" value:&stru_1F04268F8 table:@"ChatKit"];
  }

  v18 = v17;

  v19 = [CKAlertController alertControllerWithTitle:v6 message:v18 preferredStyle:1];
  v20 = CKFrameworkBundle();
  v21 = [v20 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v22 = [CKAlertAction actionWithTitle:v21 style:1 handler:0];

  [v19 addAction:v22];
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __42__CKChatController__transferFileTooLarge___block_invoke;
  block[3] = &unk_1E72EB8D0;
  v25 = v19;
  v26 = self;
  v23 = v19;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

- (void)dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self groupPhotoUpdateBanner];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __72__CKChatController_dimsmissCurrentBannerAndShowNewBannerForGroupUpdate___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  [(CKChatController *)self _dismissBannerView:v5 completion:v7];
}

void __72__CKChatController_dimsmissCurrentBannerAndShowNewBannerForGroupUpdate___block_invoke(uint64_t a1)
{
  v7[1] = *MEMORY[0x1E69E9840];
  [*(a1 + 32) setGroupPhotoUpdateBanner:0];
  [*(a1 + 32) updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];
  v2 = [*(a1 + 32) conversation];
  [v2 setShouldShowGroupNameUpdateBanner:0];

  v3 = [*(a1 + 32) conversation];
  [v3 setShouldShowGroupPhotoUpdateBanner:0];

  v4 = *(a1 + 40);
  if (v4)
  {
    v5 = *(a1 + 32);
    v7[0] = v4;
    v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v7 count:1];
    [v5 showBannerForGroupUpdate:v6];
  }
}

- (id)createBannerForGroupUpdates:(id)a3
{
  v20[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 firstObject];
  v6 = [MEMORY[0x1E69A7FD0] sharedInstance];
  v7 = [v5 handleID];
  v8 = [v6 fetchCNContactForHandleWithID:v7];

  if (v8)
  {
    v20[0] = v8;
    v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
  }

  else
  {
    v9 = MEMORY[0x1E695E0F0];
  }

  v10 = [CKNicknameUtility groupPhotoUpdateTitleForUpdate:v5];
  v11 = [CKNicknameUtility groupPhotoUpdateSubtitleForUpdate:v5];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __48__CKChatController_createBannerForGroupUpdates___block_invoke;
  aBlock[3] = &unk_1E72ED4D8;
  objc_copyWeak(&v18, &location);
  v12 = v5;
  v17 = v12;
  v13 = _Block_copy(aBlock);
  v14 = [(CKNicknameBannerView *)[CKGroupUpdateBannerView alloc] initWithStyle:7 updates:0 useNamedTitles:1 avatarImages:0 contacts:v9 customImage:0 titleString:v10 subtitleString:v11 actionButtonTitle:0 actionButtonHandler:0 actionButtonMenuItems:0 xButtonHandler:v13];
  [(CKGroupUpdateBannerView *)v14 setGroupUpdates:v4];
  -[CKGroupUpdateBannerView setUpdateBannerType:](v14, "setUpdateBannerType:", [v12 groupUpdateType]);

  objc_destroyWeak(&v18);
  objc_destroyWeak(&location);

  return v14;
}

void __48__CKChatController_createBannerForGroupUpdates___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained groupPhotoUpdateBanner:v3 dismissedUpdate:*(a1 + 32)];
}

- (void)showBannerForGroupUpdate:(id)a3
{
  v4 = a3;
  v5 = [v4 firstObject];

  if (v5)
  {
    v6 = [(CKChatController *)self createBannerForGroupUpdates:v4];
    [(CKChatController *)self setGroupPhotoUpdateBanner:v6];
    v7 = [v4 firstObject];
    v8 = [v7 groupUpdateType];
    v9 = [(CKChatController *)self groupPhotoUpdateBanner];
    [v9 setUpdateBannerType:v8];

    [(CKChatController *)self showGroupBannerUpdateIfNeeded];
  }

  else if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *v11 = 0;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Attempting to show banner for group update, but groupUpdates is empty", v11, 2u);
    }
  }
}

- (void)windowDidResignKey:(id)a3
{
  v10 = [(CKCoreChatController *)self inputController];
  if ([v10 isInputViewVisible])
  {
    v4 = [(CKChatController *)self view];
    v5 = [v4 window];
    v6 = [v5 windowScene];
    v7 = [v6 _isKeyWindowScene];

    if (v7)
    {
      return;
    }

    v8 = CKIsAppCardsEnabled();
    v9 = [(CKCoreChatController *)self inputController];
    v10 = v9;
    if (v8)
    {
      [v9 dismissAppCardIfNecessaryAnimated:0 completion:0];
    }

    else
    {
      [v9 forceDismissBrowserWithoutAnimation];
    }
  }
}

- (void)registerChatForScreenTime:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v7 = v4;
    v5 = [MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled];
    v4 = v7;
    if (v5)
    {
      v6 = [MEMORY[0x1E696AD88] defaultCenter];
      [v6 addObserver:self selector:sel_chatAllowedByScreenTimeChanged_ name:*MEMORY[0x1E69A56E8] object:v7];

      [(CKChatController *)self updateScreenTimeShieldIfNeededForChat:v7];
      v4 = v7;
    }
  }
}

- (void)unregisterChatForScreenTime:(id)a3
{
  v5 = a3;
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    [(CKChatController *)self removeLockoutControllerIfNeeded];
    if (v5)
    {
      v4 = [MEMORY[0x1E696AD88] defaultCenter];
      [v4 removeObserver:self name:*MEMORY[0x1E69A56E8] object:v5];
    }
  }
}

- (void)chatAllowedByScreenTimeChanged:(id)a3
{
  v13 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    v5 = [v4 object];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = v5;
      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          v8 = [MEMORY[0x1E696AD98] numberWithBool:{objc_msgSend(v6, "allowedByScreenTime")}];
          v9 = 138412546;
          v10 = v6;
          v11 = 2112;
          v12 = v8;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "chat: %@ received IMChatAllowedByScreenTimeChangedNotification notification, allowed = %@", &v9, 0x16u);
        }
      }

      [(CKChatController *)self updateScreenTimeShieldIfNeededForChat:v6];
    }
  }
}

- (void)updateScreenTimeShieldIfNeededForChat:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = v4;
    if ([(CKChatController *)self isChatAllowedByScreenTime:v4])
    {
      [(CKChatController *)self removeLockoutControllerIfNeeded];
    }

    else
    {
      [(CKChatController *)self showScreenTimeShieldIfNeeded];
    }

    v4 = v5;
  }
}

- (void)lockoutViewControllerDidFinishDismissing:(id)a3
{
  v4 = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    v6 = [(CKCoreChatController *)self delegate];
    [v6 screenTimeOKPressedForChatController:self];
  }

  [(CKChatController *)self _doneButtonPressed];
}

- (void)communicationLimitsDeleteButtonPressed:(id)a3
{
  v4 = [(CKChatController *)self deleteAlertFor:2];
  [(CKChatController *)self presentViewController:v4 animated:1 completion:0];
}

- (void)communicationLimitsPreviewMessageButtonPressed:(id)a3
{
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    if ([(CKCoreChatController *)self isShowingLockoutView])
    {
      [(CKCoreChatController *)self setPreviewingChatForScreenTime:1];
      v4 = [(CKCoreChatController *)self lockoutViewController];
      v5 = [v4 view];
      [v5 removeFromSuperview];

      [v4 removeFromParentViewController];
      [(CKCoreChatController *)self setLockoutViewController:0];
      [(CKChatController *)self setLockoutView:0];
      [(CKCoreChatController *)self setIsShowingLockoutView:0];
      [(CKChatController *)self reloadFooterViewControllerIfNecessary];
      v6 = [(CKCoreChatController *)self conversation];
      v17.receiver = self;
      v17.super_class = CKChatController;
      [(CKCoreChatController *)&v17 setConversation:v6 forceReload:0];

      v7 = [(CKChatController *)self view];
      v8 = [(CKChatController *)self chatFooterView];
      [v7 bringSubviewToFront:v8];

      [(CKCoreChatController *)self setMediaObjectToDownload:0];
      [(CKChatController *)self _updateRecipientCapabilities];
      v9 = [(CKCoreChatController *)self conversation];
      [(CKChatController *)self setupClickyOrbForConversation:v9];

      v10 = [(CKChatController *)self transcriptNavigationBarController];
      v11 = +[_TtC7ChatKit29TranscriptNavigationBarChange conversationChange];
      [v10 applyChange:v11];

      v12 = [MEMORY[0x1E69A7FD0] sharedInstance];
      -[CKChatController setShouldFetchCollaborationNotices:](self, "setShouldFetchCollaborationNotices:", [v12 isBatchFetchingForLaunchCompleted]);

      [(CKChatController *)self setEditing:0 animated:0];
      v13 = [(CKCoreChatController *)self chat];
      v14 = [v13 firstUnreadMessageItem];

      v15 = [v14 guid];
      [(CKChatController *)self setFirstUnreadMessageGUID:v15];

      v16 = [v14 guid];
      [(CKChatController *)self setFirstUnreadMessageGUIDForTextEffects:v16];

      [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
      [(CKChatController *)self becomeFirstResponder];
      [(CKChatController *)self refreshMacToolbar];
      [(CKChatController *)self reloadInputViews];
    }
  }
}

- (void)_stageFindMyLocationRequest
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isWaldoEnabled];

  if (v4)
  {
    v10 = 0;
    v11 = &v10;
    v12 = 0x2050000000;
    v5 = getMSMessageClass_softClass_0;
    v13 = getMSMessageClass_softClass_0;
    if (!getMSMessageClass_softClass_0)
    {
      v9[0] = MEMORY[0x1E69E9820];
      v9[1] = 3221225472;
      v9[2] = __getMSMessageClass_block_invoke_0;
      v9[3] = &unk_1E72EB968;
      v9[4] = &v10;
      __getMSMessageClass_block_invoke_0(v9);
      v5 = v11[3];
    }

    v6 = v5;
    _Block_object_dispose(&v10, 8);
    if (objc_opt_respondsToSelector())
    {
      v7 = [v5 findMyLocationRequestMessage];
      v8 = [CKComposition compositionWithMSMessage:v7 appExtensionIdentifier:*MEMORY[0x1E69A6938]];
      [(CKChatController *)self setComposition:v8];
    }
  }
}

- (void)setConversation:(id)a3 forceReload:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  v7 = [(CKCoreChatController *)self conversation];
  v8 = [v7 chat];
  [(CKChatController *)self unregisterChatForScreenTime:v8];

  v20.receiver = self;
  v20.super_class = CKChatController;
  [(CKCoreChatController *)&v20 setConversation:v6 forceReload:v4];
  [(CKCoreChatController *)self setMediaObjectToDownload:0];
  v9 = [v6 chat];
  [(CKChatController *)self registerChatForScreenTime:v9];

  v10 = [(CKChatController *)self customAcknowledgementDebouncer];

  if (!v10)
  {
    v11 = objc_alloc_init(CKCustomAcknowledgementDebouncer);
    [(CKChatController *)self setCustomAcknowledgementDebouncer:v11];
  }

  v12 = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self setCustomAcknowledgementConversation:v12];

  [(CKChatController *)self _updateRecipientCapabilities];
  [(CKChatController *)self setupClickyOrbForConversation:v6];
  v13 = [(CKChatController *)self transcriptNavigationBarController];
  v14 = +[_TtC7ChatKit29TranscriptNavigationBarChange conversationChange];
  [v13 applyChange:v14];

  v15 = [MEMORY[0x1E69A7FD0] sharedInstance];
  -[CKChatController setShouldFetchCollaborationNotices:](self, "setShouldFetchCollaborationNotices:", [v15 isBatchFetchingForLaunchCompleted]);

  [(CKChatController *)self setEditing:0 animated:0];
  v16 = [(CKCoreChatController *)self chat];
  v17 = [v16 firstUnreadMessageItem];

  v18 = [v17 guid];
  [(CKChatController *)self setFirstUnreadMessageGUID:v18];

  v19 = [v17 guid];
  [(CKChatController *)self setFirstUnreadMessageGUIDForTextEffects:v19];
}

- (id)viewToInsertTranscriptCollectionViewBelow
{
  v3 = [(CKChatController *)self inlineReplyController];

  if (v3)
  {
    v4 = [(CKChatController *)self inlineReplyController];
LABEL_5:
    v6 = v4;
    v7 = [v4 view];

    goto LABEL_6;
  }

  v5 = [(CKChatController *)self messageEditingViewController];

  if (v5)
  {
    v4 = [(CKChatController *)self messageEditingViewController];
    goto LABEL_5;
  }

  v9.receiver = self;
  v9.super_class = CKChatController;
  v7 = [(CKCoreChatController *)&v9 viewToInsertTranscriptCollectionViewBelow];
LABEL_6:

  return v7;
}

- (void)forciblyUnloadChatInputController
{
  v3 = [(CKCoreChatController *)self inputController];
  v4 = [v3 inputViewController];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v6 = [(CKCoreChatController *)self inputController];
    v7 = [v6 inputViewController];
    [v7 setViewController:0];
  }

  [(CKCoreChatController *)self setInputController:0];

  [(CKChatController *)self setEntryView:0];
}

- (BOOL)isHandwritingLandscape
{
  v2 = [(CKCoreChatController *)self inputController];
  v3 = [v2 isHandwritingLandscape];

  return v3;
}

- (void)removeLockoutControllerIfNeeded
{
  v10 = *MEMORY[0x1E69E9840];
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled] && -[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView"))
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        v4 = [(CKCoreChatController *)self chat];
        v8 = 138412290;
        v9 = v4;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "removing ScreenTime blocking shield for chat: %@", &v8, 0xCu);
      }
    }

    v5 = [(CKCoreChatController *)self lockoutViewController];
    v6 = [v5 view];
    [v6 removeFromSuperview];

    [v5 removeFromParentViewController];
    [(CKCoreChatController *)self setLockoutViewController:0];
    [(CKChatController *)self setLockoutView:0];
    [(CKCoreChatController *)self setIsShowingLockoutView:0];
    v7 = [(CKCoreChatController *)self conversation];
    [(CKChatController *)self setConversation:v7];

    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    [(CKChatController *)self becomeFirstResponder];
    [(CKChatController *)self refreshMacToolbar];
    [(CKChatController *)self reloadInputViews];
  }
}

- (void)showScreenTimeShieldIfNeeded
{
  v31 = *MEMORY[0x1E69E9840];
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled] && -[CKChatController shouldPresentBlockingDowntimeViewController](self, "shouldPresentBlockingDowntimeViewController") && !-[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView"))
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        v4 = [(CKCoreChatController *)self chat];
        *buf = 138412290;
        v30 = v4;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "showing ScreenTime blocking shield for chat: %@", buf, 0xCu);
      }
    }

    v5 = [MEMORY[0x1E69A7FD0] sharedInstance];
    v6 = [v5 getContactStore];

    if (!showScreenTimeShieldIfNeeded_CKSTLockoutViewController)
    {
      showScreenTimeShieldIfNeeded_CKSTLockoutViewController = MEMORY[0x193AF5EC0](@"STLockoutViewController", @"ScreenTimeUI");
    }

    v7 = [(CKCoreChatController *)self conversation];
    v8 = [v7 chat];

    if (v8)
    {
      v9 = IMSharedDowntimeController();
      v10 = [(CKCoreChatController *)self conversation];
      v11 = [v10 chat];
      v12 = [v9 conversationContextForChat:v11];
      [(CKChatController *)self setConversationContext:v12];
    }

    else if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Chat is nil when attempting to show screentime shield", buf, 2u);
      }
    }

    v14 = [(CKChatController *)self conversationContext];
    if (v14)
    {
      v15 = v6 == 0;
    }

    else
    {
      v15 = 1;
    }

    v16 = !v15;

    v17 = showScreenTimeShieldIfNeeded_CKSTLockoutViewController;
    if (v16)
    {
      v18 = [(CKChatController *)self conversationContext];
      v19 = [(CKCoreChatController *)self conversation];
      v20 = [v19 contactNameByHandle];
      [v17 lockoutViewControllerWithConversationContext:v18 bundleIdentifier:@"com.apple.MobileSMS" contactStore:v6 applicationName:0 contactNameByHandle:v20];
    }

    else
    {
      v18 = [(CKCoreChatController *)self _handleIDsForCurrentConversation];
      v19 = [(CKCoreChatController *)self conversation];
      v20 = [v19 contactNameByHandle];
      [v17 lockoutViewControllerWithBundleIdentifier:@"com.apple.MobileSMS" contactsHandles:v18 contactNameByHandle:v20];
    }
    v21 = ;

    if ([(CKCoreChatController *)self isCollapsed])
    {
      [v21 setOkButtonAction:1];
    }

    else
    {
      [v21 setOkButtonAlwaysHidden:1];
    }

    [v21 setViewControllerDelegate:self];
    if (objc_opt_respondsToSelector())
    {
      [v21 setCommunicationLimitsDelegate:self];
    }

    v22 = [v21 view];
    [(CKChatController *)self setLockoutView:v22];

    [(CKCoreChatController *)self setLockoutViewController:v21];
    v23 = [(CKChatController *)self view];
    v24 = [(CKChatController *)self lockoutView];
    [v23 addSubview:v24];

    [(CKChatController *)self addChildViewController:v21];
    [(CKCoreChatController *)self setIsShowingLockoutView:1];
    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    v25 = [(CKChatController *)self view];
    [v25 setNeedsLayout];

    v26 = [(CKChatController *)self view];
    [v26 layoutIfNeeded];

    [(CKChatController *)self reloadInputViews];
    objc_initWeak(buf, self);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __48__CKChatController_showScreenTimeShieldIfNeeded__block_invoke;
    block[3] = &unk_1E72EC460;
    objc_copyWeak(&v28, buf);
    dispatch_async(MEMORY[0x1E69E96A0], block);
    [(CKChatController *)self refreshMacToolbar];
    objc_destroyWeak(&v28);
    objc_destroyWeak(buf);
  }
}

void __48__CKChatController_showScreenTimeShieldIfNeeded__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained view];
  v2 = [v1 window];
  v3 = [v2 firstResponder];
  [v3 resignFirstResponder];
}

- (void)setCollectionViewController:(id)a3
{
  v4 = a3;
  v11.receiver = self;
  v11.super_class = CKChatController;
  [(CKCoreChatController *)&v11 setCollectionViewController:v4];
  v5 = [(CKCoreChatController *)self collectionViewController];
  [v5 setDragInteractionDelegate:self];

  v6 = [(CKChatController *)self entryView];
  if (v6)
  {
    v7 = v6;
    v8 = [v4 collectionView];

    if (v8)
    {
      v9 = [(CKChatController *)self entryView];
      v10 = [v4 collectionView];
      [v9 configurePocketInteractionForScrollView:v10];
    }
  }
}

- (void)loadView
{
  v10.receiver = self;
  v10.super_class = CKChatController;
  [(CKCoreChatController *)&v10 loadView];
  v3 = [MEMORY[0x1E69DC938] currentDevice];
  if (![v3 _supportsForceTouch])
  {
    goto LABEL_4;
  }

  v4 = +[CKUIBehavior sharedBehaviors];
  v5 = [v4 disableTranscriptOrb];

  if ((v5 & 1) == 0)
  {
    v3 = [(CKChatController *)self view];
    [(CKChatController *)self registerPreviewSourceView:v3 previewingDelegate:self];
LABEL_4:
  }

  v6 = [(CKChatController *)self navigationItem];
  [v6 setLargeTitleDisplayMode:2];

  [(CKChatController *)self _updateNavigationUI];
  v7 = [objc_alloc(MEMORY[0x1E69DC9B8]) initWithDelegate:self];
  [v7 setAllowsSimultaneousDropSessions:1];
  v8 = [(CKChatController *)self view];
  [v8 addInteraction:v7];

  v9 = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [v9 setNeedsUpdate];
}

- (void)viewDidLoad
{
  v12[1] = *MEMORY[0x1E69E9840];
  v10.receiver = self;
  v10.super_class = CKChatController;
  [(CKCoreChatController *)&v10 viewDidLoad];
  [(CKChatController *)self _prepareNavigationBarOnLoad];
  v3 = +[CKBalloonPluginManager sharedInstance];
  [v3 addExtensionConsumer:self];

  v12[0] = objc_opt_class();
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:1];
  v5 = [(CKChatController *)self registerForTraitChanges:v4 withHandler:&__block_literal_global_30];

  v6 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v7 = [v6 isTranscriptBackgroundsEnabled];

  if (v7)
  {
    v11[0] = objc_opt_class();
    v11[1] = objc_opt_class();
    v11[2] = objc_opt_class();
    v11[3] = objc_opt_class();
    v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:4];
    v9 = [(CKChatController *)self registerForTraitChanges:v8 withHandler:&__block_literal_global_669];
  }
}

void __31__CKChatController_viewDidLoad__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  [v2 _updateEntryViewConstraintsIfNeeded];
  [v2 _setUpEntryViewAppCardLayoutConstraint];
  [v2 updateActiveEntryViewPositioningGuide];
}

- (void)transcriptCollectionViewControllerDidInset:(id)a3
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 transcriptCollectionViewControllerDidInset:a3];
  v4 = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [v4 setNeedsUpdate];

  [(CKChatController *)self scrollTranscriptToAlignWithMessageEditingBalloonView];
}

- (void)_traitsAffectingBarAppearanceDidChange
{
  [(CKChatController *)self _updateNavigationButtons];
  v10 = [(CKChatController *)self traitCollection];
  v3 = [v10 isTranscriptBackgroundActive];
  v4 = [v10 isDiffusedSystemGlassSettingEnabled];
  v5 = 0;
  if (v3 && v4)
  {
    v6 = [(CKChatController *)self traitCollection];
    v5 = [v6 ck_systemUserInterfaceStyle];
  }

  v7 = [(CKChatController *)self transcriptNavigationBarController];
  [v7 setOverrideUserInterfaceStyle:v5];

  v8 = [(CKChatController *)self collectionView];
  v9 = [v8 bottomEdgeEffect];

  if (objc_opt_respondsToSelector())
  {
    [v9 _setFixedUserInterfaceStyle:v5];
  }
}

- (void)_updateNotificationBannerOfType:(int64_t)a3 show:(BOOL)a4
{
  v4 = a4;
  v58 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [MEMORY[0x1E696AD98] numberWithInteger:a3];
      v55[0] = 67109378;
      v55[1] = v4;
      v56 = 2112;
      v57 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Update banner notification show:%d type:%@", v55, 0x12u);
    }
  }

  if (!v4)
  {
    if ([(CKChatController *)self notificationBannerType]!= a3)
    {
      if ([(CKChatController *)self notificationBannerType]!= a3)
      {
        return;
      }

LABEL_17:
      v11 = [(CKChatController *)self notificationBannerView];
      if (v11)
      {
        v12 = [(CKChatController *)self notificationBannerType]== a3;

        if (!v12)
        {
          v13 = [(CKChatController *)self notificationBannerView];
          [v13 removeFromSuperview];

          [(CKChatController *)self setNotificationBannerView:0];
        }
      }

      [(CKChatController *)self setNotificationBannerType:a3];
      v14 = [(CKChatController *)self notificationBannerView];
      v15 = v14 == 0;

      if (!v15)
      {
LABEL_35:
        v21 = [(CKChatController *)self view];
        v22 = [(CKChatController *)self notificationBannerView];
        [v21 bringSubviewToFront:v22];

        v23 = [(CKChatController *)self view];
        [v23 bounds];
        v25 = v24;
        v27 = v26;

        v28 = [(CKChatController *)self view];
        [v28 safeAreaInsets];
        v30 = v29;
        v31 = [(CKChatController *)self view];
        [v31 safeAreaInsets];
        v33 = v32;

        v34 = [(CKChatController *)self view];
        [v34 safeAreaInsets];
        v36 = v35;
        v37 = [(CKChatController *)self view];
        [v37 safeAreaInsets];
        v39 = v38;

        v40 = [(CKChatController *)self notificationBannerView];
        [v40 sizeThatFits:{v25 - (v30 + v33), v27 - (v36 + v39)}];
        v42 = v41;
        v44 = v43;

        v45 = [(CKCoreChatController *)self scrollView];
        [v45 contentInset];
        v47 = v46;

        v48 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        LODWORD(v45) = [v48 isModernSplitViewControllerEnabled];

        v49 = v47 - v44;
        if (v45)
        {
          v50 = [(CKChatController *)self view];
          [v50 safeAreaInsets];
          v52 = v51;
          v53 = [(CKChatController *)self notificationBannerView];
          [v53 setFrame:{v52, v49, v42, v44}];
        }

        else
        {
          v54 = [(CKChatController *)self notificationBannerView];
          [v54 setFrame:{0.0, v49, v42, v44}];
        }

        return;
      }

      if (a3 <= 1)
      {
        if (!a3)
        {
          v16 = [MEMORY[0x1E696AAA8] currentHandler];
          [v16 handleFailureInMethod:a2 object:self file:@"CKChatController.m" lineNumber:2067 description:@"This case should have been already filtered out"];
          goto LABEL_32;
        }

        if (a3 == 1)
        {
          v16 = +[_TtC7ChatKit19CKBannerViewFactory unexpectedlyLoggedOutBanner];
          [(CKChatController *)self setNotificationBannerView:v16];
          goto LABEL_32;
        }
      }

      else
      {
        switch(a3)
        {
          case 4:
            v16 = +[_TtC7ChatKit19CKBannerViewFactory notDefaultTextingAppBanner];
            [(CKChatController *)self setNotificationBannerView:v16];
            goto LABEL_32;
          case 3:
            v16 = +[_TtC7ChatKit19CKBannerViewFactory updateAppleIDSettingsBanner];
            [(CKChatController *)self setNotificationBannerView:v16];
            goto LABEL_32;
          case 2:
            v16 = +[_TtC7ChatKit19CKBannerViewFactory waitingForCloudBanner];
            [(CKChatController *)self setNotificationBannerView:v16];
LABEL_32:

            break;
        }
      }

      v17 = [(CKChatController *)self notificationBannerView];
      v18 = v17 == 0;

      if (v18)
      {
        return;
      }

      v19 = [(CKChatController *)self view];
      v20 = [(CKChatController *)self notificationBannerView];
      [v19 addSubview:v20];

      goto LABEL_35;
    }

LABEL_15:
    v10 = [(CKChatController *)self notificationBannerView];
    [v10 removeFromSuperview];

    [(CKChatController *)self setNotificationBannerView:0];
    [(CKChatController *)self setNotificationBannerType:0];
    return;
  }

  if (!a3)
  {
    goto LABEL_15;
  }

  if ([(CKChatController *)self notificationBannerType]<= a3 && (a3 != 1 || (CKIsAppleIDNotUpdated() & 1) == 0 && (CKIsWaitingForCloud() & 1) == 0 && (IMGetUserIgnoreFailureWaitingForCloudIntent() & 1) == 0 && (IMGetUserIgnoreFailureUpdateAppleIDIntent() & 1) == 0))
  {
    goto LABEL_17;
  }
}

- (void)insertInitialCompositionIfNeeded
{
  v3 = [(CKChatController *)self initialComposition];
  if (v3)
  {
    v4 = v3;
    [(CKChatController *)self setInitialComposition:0];
    [(CKChatController *)self setComposition:v4];
    v3 = v4;
  }
}

- (void)viewDidLayoutSubviews
{
  v3 = [(CKCoreChatController *)self initialLayoutComplete];
  v102.receiver = self;
  v102.super_class = CKChatController;
  [(CKCoreChatController *)&v102 viewDidLayoutSubviews];
  if (__CurrentTestName && (objc_opt_respondsToSelector() & 1) != 0)
  {
    v4 = [MEMORY[0x1E696AD88] defaultCenter];
    [v4 postNotificationName:@"PPTDidLayoutConversationEvent" object:0 userInfo:0];
  }

  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    v5 = [(CKChatController *)self view];
    [v5 bounds];
    [(CKChatController *)self _invalidateChatItemLayoutIfNecessary:v6, v7];
  }

  v8 = +[CKUIBehavior sharedBehaviors];
  if (![v8 useMacToolbar])
  {
    goto LABEL_15;
  }

  v9 = [(CKCoreChatController *)self showingInStandAloneWindow];

  if (v9)
  {
    v10 = [(CKChatController *)self view];
    v11 = [v10 window];
    [v11 frame];
    v13 = v12;
    v15 = v14;
    v17 = v16;
    v19 = v18;

    v20 = [(CKCoreChatController *)self macToolbarController];
    [v20 updateWithFrame:{v13, v15, v17, v19}];

    v21 = [(CKChatController *)self view];
    v22 = [v21 _shouldReverseLayoutDirection];

    v23 = [(CKChatController *)self view];
    [v23 safeAreaInsets];
    if (v22)
    {
      v26 = v17;
    }

    else
    {
      v26 = 0.0;
    }

    if (v22)
    {
      v27 = v24;
    }

    else
    {
      v27 = v17 - v25;
    }

    v8 = [(CKCoreChatController *)self macToolbarController];
    [v8 updateDividersForSidebarPosition:v26 inspectorPosition:v27];
LABEL_15:
  }

  v28 = [(CKCoreChatController *)self collectionViewController];
  v29 = [v28 collectionView];

  v30 = [(CKChatController *)self view];
  [v30 bounds];
  v32 = v31;
  v34 = v33;

  if ([(CKChatController *)self needToEnforceScrollIntent])
  {
    [(CKChatController *)self lastLaidOutSize];
    if (v32 != v36 || v34 != v35)
    {
      [(CKChatController *)self setNeedToEnforceScrollIntent:0];
      v37 = +[CKScrollViewAnimationProperties inheritedAnimation];
      [v29 enforceTranscriptScrollIntentWithAnimationProperties:v37];
    }
  }

  [(CKChatController *)self setLastLaidOutSize:v32, v34];
  [(CKChatController *)self insertInitialCompositionIfNeeded];
  if ([(CKCoreChatController *)self viewIsVisible]&& [(CKChatController *)self targetFirstResponder]== 1)
  {
    [(CKChatController *)self becomeFirstResponder];
  }

  v38 = [(CKChatController *)self inlineReplyController];

  if (v38)
  {
    v39 = [(CKChatController *)self inlineReplyController];
    v40 = [v39 view];
    v41 = [(CKChatController *)self view];
    [v41 bounds];
    [v40 setFrame:?];
  }

  v42 = [(CKChatController *)self messageEditingViewController];

  if (v42)
  {
    v43 = [(CKChatController *)self view];
    [v43 bounds];
    v45 = v44;
    v47 = v46;
    v49 = v48;
    v51 = v50;

    v52 = [(CKChatController *)self messageEditingViewController];
    v53 = [v52 view];
    [v53 setFrame:{v45, v47, v49, v51}];
  }

  v54 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  [v54 layout];
  v55 = [(CKChatController *)self view];
  [v55 bounds];
  v57 = v56;
  v59 = v58;
  v61 = v60;
  v63 = v62;

  v64 = [(CKChatController *)self entryViewContainerView];
  [v64 setFrame:{v57, v59, v61, v63}];

  [(CKChatController *)self _marginInsetsForEntryView];
  v66 = v65;
  v68 = v67;
  v70 = v69;
  v72 = v71;
  v73 = [(CKChatController *)self entryView];
  [v73 setMarginInsets:{v66, v68, v70, v72}];

  v74 = +[CKUIBehavior sharedBehaviors];
  v75 = [v74 entryViewFollowsKeyboardLayoutGuide];

  if ((v75 & 1) == 0)
  {
    v76 = [(CKChatController *)self entryView];
    v77 = [(CKChatController *)self entryView];
    [v77 frame];
    [v76 setFrame:?];
  }

  if (!v3)
  {
    v78 = [(CKChatController *)self scrollBlock];

    if (v78)
    {
      v79 = [(CKChatController *)self scrollBlock];
      v79[2]();

      [(CKChatController *)self setScrollBlock:0];
    }
  }

  v80 = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [v80 setNeedsUpdate];

  v81 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  v82 = +[CKUIBehavior sharedBehaviors];
  v83 = [v82 theme];
  [v81 setBarStyle:{objc_msgSend(v83, "navBarStyle")}];

  v84 = [(CKChatController *)self nicknameBanner];

  if (v84)
  {
    v85 = [(CKChatController *)self nicknameBanner];
  }

  else
  {
    v86 = [(CKChatController *)self groupPhotoUpdateBanner];

    if (v86)
    {
      v85 = [(CKChatController *)self groupPhotoUpdateBanner];
    }

    else
    {
      v87 = [(CKChatController *)self acceptedContactBanner];

      if (!v87)
      {
        goto LABEL_41;
      }

      v85 = [(CKChatController *)self acceptedContactBanner];
    }
  }

  v87 = v85;
  if (v85 && !self->_shouldOverrideBannerFrameOnPopTransition)
  {
    [v85 setNeedsLayout];
    [v87 layoutIfNeeded];
    [(CKChatController *)self _layoutBannerView:v87];
  }

LABEL_41:
  if ([(CKCoreChatController *)self isShowingLockoutView])
  {
    v88 = [(CKChatController *)self lockoutView];

    if (v88)
    {
      [(CKChatController *)self layoutLockoutView];
    }
  }

  [(CKChatController *)self layoutFooterView];
  v89 = [(CKChatController *)self loadingIndicatorCoverView];

  if (v89)
  {
    v90 = [(CKChatController *)self view];
    v91 = [(CKChatController *)self loadingIndicatorCoverView];
    [v90 bringSubviewToFront:v91];

    v92 = [(CKChatController *)self view];
    [v92 bounds];
    v94 = v93;
    v96 = v95;
    v98 = v97;
    v100 = v99;
    v101 = [(CKChatController *)self loadingIndicatorCoverView];
    [v101 setFrame:{v94, v96, v98, v100}];
  }
}

- (void)_layoutBannerView:(id)a3
{
  v15 = a3;
  [(CKCoreChatController *)self calculateTranscriptSafeAreaInsets];
  v5 = v4;
  v7 = v6;
  v8 = [(CKChatController *)self view];
  [v8 bounds];
  v10 = v9 - v5 - v7;

  [v15 sizeThatFits:{v10, 1.79769313e308}];
  v13 = v12;
  if (v11 < v10)
  {
    v10 = v11;
  }

  [(CKScrollViewController *)self navigationBarInsets];
  [v15 setFrame:{v5, v14, v10, v13}];
}

- (void)layoutLockoutView
{
  v4 = [(CKChatController *)self lockoutView];
  v3 = [(CKChatController *)self view];
  [v3 bounds];
  [v4 setFrame:?];
}

- (id)preferredFocusEnvironments
{
  v3 = [MEMORY[0x1E695DF70] array];
  v4 = [(CKChatController *)self entryView];
  v5 = [v4 contentView];
  v6 = [v5 textView];

  if (v6)
  {
    v7 = [(CKChatController *)self entryView];
    v8 = [v7 contentView];
    v9 = [v8 textView];
    [v3 addObject:v9];
  }

  return v3;
}

- (void)transcriptNavigationBar:(id)a3 didTapToPerformAction:(int64_t)a4
{
  v6 = a3;
  if (a4 <= 2)
  {
    switch(a4)
    {
      case 0:
        if (!IMOSLoggingEnabled())
        {
          break;
        }

        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          *v8 = 0;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Navigation bar tried invoking an action that is unknown.", v8, 2u);
        }

LABEL_16:

        break;
      case 1:
        [(CKChatController *)self _didTapNavigationBarAvatarView];
        break;
      case 2:
        [(CKChatController *)self _didTapNavigationBarToDismissReplies];
        break;
    }
  }

  else
  {
    if (a4 <= 4)
    {
      if (a4 == 3)
      {
        [(CKChatController *)self _doneButtonPressed];
      }

      else
      {
        [(CKChatController *)self _editCancelButtonPressed];
      }

      goto LABEL_20;
    }

    if (a4 == 5)
    {
      [(CKChatController *)self _didTapToPresentNewCompose];
      goto LABEL_20;
    }

    if (a4 == 6)
    {
      v7 = IMLogHandleForCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        [CKChatController transcriptNavigationBar:didTapToPerformAction:];
      }

      goto LABEL_16;
    }
  }

LABEL_20:
}

- (void)_didTapNavigationBarAvatarView
{
  v3 = [(CKCoreChatController *)self delegate];
  v4 = [v3 hasDetailsNavigationController];

  if (v4)
  {
    v5 = [(CKCoreChatController *)self delegate];
    [v5 dismissDetailsNavigationController];
  }

  else
  {

    [(CKChatController *)self presentDetailsViewController];
  }
}

- (_TtC7ChatKit29CKNavBarPersistentMenuManager)chatBotPersistentMenuManager
{
  if (!self->_chatBotPersistentMenuManager && !CKIsRunningInMacCatalyst())
  {
    v3 = [(CKCoreChatController *)self conversation];
    v4 = [v3 chat];
    v5 = [v4 persistentMenu];

    if (v5)
    {
      v6 = [[_TtC7ChatKit29CKNavBarPersistentMenuManager alloc] initWithDelegate:self];
      chatBotPersistentMenuManager = self->_chatBotPersistentMenuManager;
      self->_chatBotPersistentMenuManager = v6;
    }
  }

  v8 = self->_chatBotPersistentMenuManager;

  return v8;
}

- (CKCallButtonStateResolver)callStateResolver
{
  callStateResolver = self->_callStateResolver;
  if (!callStateResolver)
  {
    v4 = objc_alloc_init(CKCallButtonStateResolver);
    v5 = self->_callStateResolver;
    self->_callStateResolver = v4;

    callStateResolver = self->_callStateResolver;
  }

  return callStateResolver;
}

- (void)_didTapToPresentNewCompose
{
  v3 = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if (v4)
  {
    v5 = [(CKCoreChatController *)self delegate];
    [v5 chatController:self didRequestNewComposePresentationWithSender:0];
  }
}

- (void)_didTapNavigationBarToDismissReplies
{
  v3 = [(CKChatController *)self inlineReplyController];

  if (v3)
  {
    v4 = [(CKChatController *)self inlineReplyController];
    [v4 dismissController];
  }

  else
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {

      [(CKChatController *)self dismissController];
    }
  }
}

- (void)_setupModernTranscriptNavigationBar
{
  if ([(CKCoreChatController *)self isInline]&& ![(CKChatController *)self isModal])
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Inline Reply Chat Controllers do not need their own bar controller", buf, 2u);
    }
  }

  else if (!self->_transcriptNavigationBarController)
  {
    v3 = [(CKCoreChatController *)self delegate];
    v4 = objc_opt_respondsToSelector();

    if (v4)
    {
      v5 = [(CKCoreChatController *)self delegate];
      v12 = [v5 backNavigationItemForChatController:self];
    }

    else
    {
      v12 = 0;
    }

    v7 = [(CKChatController *)self makeNavigationBarContext];
    v8 = [CKTranscriptNavigationBarController alloc];
    v9 = [(CKChatController *)self navigationItem];
    v10 = [(CKTranscriptNavigationBarController *)v8 initWithDelegate:self contextProviders:v7 navigationItem:v9 backNavigationItem:v12];

    [(CKChatController *)self setTranscriptNavigationBarController:v10];
    v11 = [(CKChatController *)self collectionView];
    [(CKTranscriptNavigationBarController *)v10 configurePocketInteractionForScrollView:v11];
  }
}

- (void)viewWillAppear:(BOOL)a3
{
  v21.receiver = self;
  v21.super_class = CKChatController;
  [(CKCoreChatController *)&v21 viewWillAppear:a3];
  v4 = [(CKChatController *)self view];
  [v4 setNeedsLayout];

  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ViewControllerNotVisible"];
  if (![(CKChatController *)self isTransitioningFromQLPreviewToGrid])
  {
    [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ShowingPhotoGridOverlay"];
  }

  v5 = [(CKChatController *)self navigationController];
  v6 = [v5 navigationBar];
  v7 = [v6 traitCollection];
  v8 = [v7 userInterfaceIdiom];

  if ((v8 - 4) <= 0xFFFFFFFFFFFFFFFDLL)
  {
    v9 = [(CKChatController *)self navigationController];
    v10 = [v9 navigationBar];
    v11 = [(CKChatController *)self navigationController];
    v12 = [v11 navigationBar];
    v13 = [v12 standardAppearance];
    [v10 setScrollEdgeAppearance:v13];
  }

  [(CKChatController *)self _restoreDraftState];
  [(CKChatController *)self registerForTextInputPayloadHandling];
  v14 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  [v14 setAlpha:1.0];

  v15 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  v16 = +[CKUIBehavior sharedBehaviors];
  v17 = [v16 theme];
  [v15 setBarStyle:{objc_msgSend(v17, "navBarStyle")}];

  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  [(CKChatController *)self showOrHideAcceptedContactBannerIfNeeded];
  if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *v20 = 0;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Ready to configure nav bar title view from viewWillAppear:.", v20, 2u);
    }
  }

  [(CKChatController *)self _setupModernTranscriptNavigationBar];
  [(CKChatController *)self _updateNavigationButtons];
  v19 = [(CKChatController *)self collectionView];
  [v19 beginDisablingTranscriptDynamicsForReason:16];

  [(CKChatController *)self presentLoadingIndicatorCoverIfNeeded];
}

- (void)viewWillLayoutSubviews
{
  v13.receiver = self;
  v13.super_class = CKChatController;
  [(CKChatController *)&v13 viewWillLayoutSubviews];
  v3 = +[CKUIBehavior sharedBehaviors];
  if (([v3 isEntryViewInputAccessory] & 1) == 0)
  {
    v4 = [(CKChatController *)self entryView];
    if (v4)
    {
      v5 = v4;
      v6 = [(CKChatController *)self view];
      [v6 bounds];
      v8 = v7;
      v9 = [(CKChatController *)self entryView];
      [v9 bounds];
      v11 = v10;

      if (v8 == v11)
      {
        return;
      }

      [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];
      v12 = [(CKCoreChatController *)self collectionViewController];
      v3 = [v12 collectionView];

      if (v3)
      {
        if ([v3 numberOfItemsInSection:0] >= 1)
        {
          [(CKChatController *)self setNeedToEnforceScrollIntent:1];
        }
      }
    }
  }
}

- (void)viewDidMoveToWindow:(id)a3 shouldAppearOrDisappear:(BOOL)a4
{
  v8.receiver = self;
  v8.super_class = CKChatController;
  [(CKChatController *)&v8 viewDidMoveToWindow:a3 shouldAppearOrDisappear:a4];
  [(CKChatController *)self configureForCurrentTraitCollection];
  v5 = [(CKChatController *)self view];
  [v5 bounds];
  [(CKChatController *)self _invalidateChatItemLayoutIfNecessary:v6, v7];
}

- (void)viewDidAppear:(BOOL)a3
{
  v32[1] = *MEMORY[0x1E69E9840];
  v26.receiver = self;
  v26.super_class = CKChatController;
  [(CKCoreChatController *)&v26 viewDidAppear:a3];
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v4 chat];
  v6 = v5 == 0;

  if (!v6)
  {
    v7 = [(CKCoreChatController *)self currentPosterBundleIdentifier];
    v8 = v7;
    if (v7)
    {
      v31 = @"posterName";
      v32[0] = v7;
      v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v32 forKeys:&v31 count:1];
    }

    else
    {
      v9 = 0;
    }

    v10 = [MEMORY[0x1E695DF00] date];
    [CKPowerLog sendTranscriptVisibilityChangedEvent:v10 event:0 metadata:v9];
  }

  [(CKChatController *)self updateRaiseGesture];
  [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
  if (__CurrentTestName && (objc_opt_respondsToSelector() & 1) != 0)
  {
    v11 = [MEMORY[0x1E696AD88] defaultCenter];
    [v11 postNotificationName:@"PPTDidShowConversationEvent" object:0 userInfo:0];
  }

  if (!CKIsRunningInMacCatalyst())
  {
    v12 = [(CKChatController *)self previewController];
    v13 = v12;
    if (v12 && ([v12 transitionCoordinator], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "isInteractive"), v14, (v15 & 1) == 0))
    {
      [(CKChatController *)self restoreEntryViewAfterPreview];
    }

    else if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v17 = [v13 transitionCoordinator];
        v18 = [v17 isInteractive];
        v19 = @"NO";
        if (v18)
        {
          v19 = @"YES";
        }

        *buf = 138412546;
        v28 = v13;
        v29 = 2112;
        v30 = v19;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "No preview controller: %@ - interactive: %@", buf, 0x16u);
      }
    }
  }

  v20 = [MEMORY[0x1E69DCBB8] activeKeyboard];
  v21 = [(CKChatController *)self effectPickerWindow];
  [v20 setTypingEnabled:v21 == 0];

  v22 = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [v22 setNeedsUpdate];

  if (CKIsRunningInMacCatalyst() && [(CKCoreChatController *)self showingInStandAloneWindow])
  {
    v23 = [(CKChatController *)self entryView];
    v24 = [v23 contentView];
    [v24 makeActive];
  }

  v25 = [(CKChatController *)self collectionView];
  [v25 endDisablingTranscriptDynamicsForReason:16];
}

- (void)viewDidAppearDeferredSetup
{
  v67 = *MEMORY[0x1E69E9840];
  v64.receiver = self;
  v64.super_class = CKChatController;
  [(CKCoreChatController *)&v64 viewDidAppearDeferredSetup];
  v3 = [MEMORY[0x1E69DC938] currentDevice];
  if (![v3 userInterfaceIdiom])
  {
    v33 = +[CKUIBehavior sharedBehaviors];
    v34 = [v33 entryViewFollowsKeyboardLayoutGuide];

    if (v34)
    {
      goto LABEL_3;
    }

    v35 = [(CKChatController *)self view];
    v36 = [v35 window];
    v37 = [v36 windowScene];
    v3 = [v37 keyboardSceneDelegate];

    v38 = [(CKChatController *)self view];
    [v3 visibleFrameInView:v38];
    v40 = v39;
    v42 = v41;
    v44 = v43;
    v46 = v45;

    LOBYTE(v38) = [(CKScrollViewController *)self manuallyUpdateKeyboardScreenFrameWithFrameIfNeeded:0 animationDuration:v40 animationCurve:v42, v44, v46, 0.3];
    if (![(CKScrollViewController *)self isHoldingScrollGeometryUpdates]&& (v38 & 1) != 0)
    {
      v47 = [(CKCoreChatController *)self collectionViewController];
      [v47 scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
    }
  }

LABEL_3:
  v4 = [(CKCoreChatController *)self conversation];
  if (v4 && (CKIsRunningInMacCatalyst() || _CKUIEnhancedMainMenuEnabled()))
  {
    v5 = [[CKDetailsContactsManager alloc] initWithConversation:v4 delegate:self];
    [(CKChatController *)self setDetailsContactsManager:v5];
  }

  else
  {
    [(CKChatController *)self setDetailsContactsManager:0];
  }

  v6 = [v4 chat];
  [v6 watermarkOutForScrutinyMode];

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = [(CKCoreChatController *)self chat];
      v9 = [v8 guid];
      *buf = 138412290;
      v66 = v9;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Reset load attempt count for chat GUID %@", buf, 0xCu);
    }
  }

  v10 = [v4 chat];
  v11 = [v10 isInScrutinyMode];

  if (v11)
  {
    v12 = [v4 chat];
    [v12 clearScrutinyMode];

    if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = [(CKCoreChatController *)self chat];
        v15 = [v14 guid];
        *buf = 138412290;
        v66 = v15;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Clearing scrutiny mode for chat GUID %@", buf, 0xCu);
      }
    }
  }

  [(CKChatController *)self _sizeEffectPickerWindow];
  objc_initWeak(buf, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke;
  aBlock[3] = &unk_1E72EBA18;
  aBlock[4] = self;
  v16 = _Block_copy(aBlock);
  v17 = dispatch_time(0, 200000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2;
  block[3] = &unk_1E72ED520;
  objc_copyWeak(&v62, buf);
  v18 = v16;
  v61 = v18;
  v19 = v4;
  v60 = v19;
  dispatch_after(v17, MEMORY[0x1E69E96A0], block);
  v20 = +[CKPreviewDispatchCache genmojiPreviewCache];
  [v20 resume];

  v21 = +[CKPreviewDispatchCache transcriptPreviewCache];
  [v21 resume];

  v22 = [(CKChatController *)self nicknameBanner];
  LODWORD(v21) = v22 == 0;

  if (v21)
  {
    [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  }

  v23 = [(CKChatController *)self groupPhotoUpdateBanner];
  v24 = v23 == 0;

  if (v24)
  {
    [(CKChatController *)self showGroupBannerUpdateIfNeeded];
  }

  [(CKChatController *)self checkSuggestionsForBanner];
  v25 = [MEMORY[0x193AF5EC0](@"AFContextManager" @"AssistantServices")];
  [v25 addContextProvider:self];

  [(CKChatController *)self _kickPhotoKit];
  v26 = [(CKCoreChatController *)self delegate];
  [v26 prewarmCameraIfNecessaryForChatController:self];

  v27 = [MEMORY[0x1E69DC938] currentDevice];
  -[CKChatController setLastKnownDeviceOrientation:](self, "setLastKnownDeviceOrientation:", [v27 orientation]);

  if ([(CKCoreChatController *)self userInitiatedTranscriptPush])
  {
    [(CKChatController *)self _markMessagesAsReadOnPushIfNeeded];
  }

  [(CKChatController *)self _markVisibleMentionsAsRead];
  [(CKChatController *)self _retryGroupPhotoUploadIfNecessary];
  [(CKChatController *)self _retryTranscriptBackgroundUploadIfNecessary];
  v28 = [(CKChatController *)self transcriptNavigationBarController];
  [v28 configureFindMySessionCoordinatorIfNeededForConversation:v19];

  [(CKChatController *)self updateNumberOfUnknownChatsOpenedIfNeeded];
  v29 = [(CKChatController *)self tipManager];
  [v29 chatControllerDidAppear];

  if ([(CKChatController *)self shouldShowBanners])
  {
    v58[0] = MEMORY[0x1E69E9820];
    v58[1] = 3221225472;
    v58[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_3;
    v58[3] = &unk_1E72ED548;
    v58[4] = self;
    [(CKChatController *)self showCheckInTips:v58];
    v57[0] = MEMORY[0x1E69E9820];
    v57[1] = 3221225472;
    v57[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_4;
    v57[3] = &unk_1E72ED570;
    v57[4] = self;
    [(CKChatController *)self showTranslationTips:v57];
    v30 = [(CKChatController *)self tipManager];
    [v30 setMessageRequestsDelegate:self];

    v31 = [(CKChatController *)self tipManager];
    [v31 presentMessageRequestsTipIfNeeded];
  }

  v55[0] = MEMORY[0x1E69E9820];
  v55[1] = 3221225472;
  v55[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_5;
  v55[3] = &unk_1E72EC460;
  objc_copyWeak(&v56, buf);
  v32 = _Block_copy(v55);
  if ([(CKChatController *)self canShowBusinessOnboarding])
  {
    if (+[CKBusinessOnboardingController shouldShowBusinessOnboarding])
    {
      v32[2](v32);
    }

    else
    {
      v50 = MEMORY[0x1E69E9820];
      v51 = 3221225472;
      v52 = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_741;
      v53 = &unk_1E72ED1F0;
      v54 = v32;
      [CKBusinessOnboardingController checkForBusinessAlertsIDSIssues:&v50];
    }
  }

  [(CKChatController *)self _autoAcceptNicknameIfNeeded:v50];
  v48 = [(CKChatController *)self catchUpButtonManager];
  [v48 animateInResumingFromBackground:0];

  if (__CurrentTestName && (objc_opt_respondsToSelector() & 1) != 0)
  {
    v49 = [MEMORY[0x1E696AD88] defaultCenter];
    [v49 postNotificationName:@"PPTDidExtendedShowConversationEvent" object:0 userInfo:0];
  }

  objc_destroyWeak(&v56);
  objc_destroyWeak(&v62);

  objc_destroyWeak(buf);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) transcriptNavigationBarController];
  v1 = +[_TtC7ChatKit29TranscriptNavigationBarChange nicknameOracleChange];
  [v2 applyChange:v1];
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained mentionsController];
  [v3 deferredSetup];

  v4 = objc_loadWeakRetained((a1 + 48));
  v5 = [v4 entryView];
  [v5 deferredSetup];

  v6 = objc_loadWeakRetained((a1 + 48));
  v7 = [v6 deferredPresentationBlock];

  if (v7)
  {
    v8 = objc_loadWeakRetained((a1 + 48));
    v9 = [v8 deferredPresentationBlock];
    v9[2]();

    v10 = objc_loadWeakRetained((a1 + 48));
    [v10 setDeferredPresentationBlock:0];
  }

  (*(*(a1 + 40) + 16))();
  v11 = [*(a1 + 32) chat];
  v12 = [v11 guid];

  if (v12)
  {
    v14 = [*(a1 + 32) chat];
    v13 = [v14 guid];
    [CKConversationUserInteractionManager enteredConversation:v13];
  }
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_3(uint64_t a1, int a2, void *a3)
{
  if (a2 && [a3 length])
  {
    v4 = *(a1 + 32);
    v5 = [v4 tipManager];
    [v5 setCheckInDelegate:v4];

    v6 = [*(a1 + 32) tipManager];
    [v6 presentCheckInTip];
  }
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_4(uint64_t a1, int a2, void *a3)
{
  v13[1] = *MEMORY[0x1E69E9840];
  if (a2)
  {
    v4 = *(a1 + 32);
    v5 = a3;
    v6 = [v4 tipManager];
    [v6 setTranslationDelegate:v4];

    v7 = [*(a1 + 32) tipManager];
    v8 = [v7 presentTranslationTipWithLanguages:v5];

    v9 = [v5 objectForKeyedSubscript:v8];

    [*(a1 + 32) prewarmTranslationCacheForMessagesWithGUIDs:v9 sourceLanguage:v8];
    v10 = [v8 localeIdentifier];
    v13[0] = v10;
    v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:1];
    v12 = [*(a1 + 32) conversation];
    [v12 setSuggestedTranslationLanguageCodes:v11];
  }
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_5(uint64_t a1)
{
  v2 = [CKBusinessOnboardingController alloc];
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_6;
  v11[3] = &unk_1E72EC460;
  objc_copyWeak(&v12, (a1 + 32));
  v3 = [(CKBusinessOnboardingController *)v2 initWithCompletionHandler:v11];
  v6 = MEMORY[0x1E69E9820];
  v7 = 3221225472;
  v8 = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_738;
  v9 = &unk_1E72EC460;
  objc_copyWeak(&v10, (a1 + 32));
  [(CKBusinessOnboardingController *)v3 setupNotNowWithActionHandler:&v6];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained dismissKeyboard];

  v5 = objc_loadWeakRetained((a1 + 32));
  [v5 presentViewController:v3 animated:1 completion:0];

  objc_destroyWeak(&v10);
  objc_destroyWeak(&v12);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_6(uint64_t a1)
{
  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "CKBusinessOnboardingController => Continue button completion handler called", buf, 2u);
  }

  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_737;
  v4[3] = &unk_1E72EC460;
  objc_copyWeak(&v5, (a1 + 32));
  [WeakRetained dismissViewControllerAnimated:1 completion:v4];

  objc_destroyWeak(&v5);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_737(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained didFinishShowingBusinessOnboarding];
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_738(uint64_t a1)
{
  v17[1] = *MEMORY[0x1E69E9840];
  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "CKBusinessOnboardingController => Not Now button action handler called", buf, 2u);
  }

  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4 = [WeakRetained conversation];
  v5 = [v4 chat];
  if (!v5)
  {
    goto LABEL_6;
  }

  v6 = objc_loadWeakRetained((a1 + 32));
  v7 = [v6 conversation];
  v8 = [v7 chat];
  v9 = [v8 hasSentMessageToBusiness];

  if ((v9 & 1) == 0)
  {
    WeakRetained = +[CKConversationList sharedConversationList];
    v4 = objc_loadWeakRetained((a1 + 32));
    v10 = [v4 conversation];
    v17[0] = v10;
    v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:1];
    v12 = [MEMORY[0x1E695DF00] date];
    [WeakRetained recoverableDeleteForConversations:v11 deleteDate:v12 synchronousQuery:0 completionHandler:0];

LABEL_6:
  }

  v13 = objc_loadWeakRetained((a1 + 32));
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_740;
  v14[3] = &unk_1E72EC460;
  objc_copyWeak(&v15, (a1 + 32));
  [v13 dismissViewControllerAnimated:1 completion:v14];

  objc_destroyWeak(&v15);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_740(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained delegate];
  [v3 cancelNewMessageCompositionAnimated:1];

  v5 = objc_loadWeakRetained((a1 + 32));
  v4 = [v5 delegate];
  [v4 showConversationList];
}

uint64_t __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_741(uint64_t result, int a2)
{
  if (a2)
  {
    return (*(*(result + 32) + 16))();
  }

  return result;
}

void __53__CKChatController__markMessagesAsReadOnPushIfNeeded__block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  v7 = [*(a1 + 32) chat];
  if ([v7 unreadMessageCount])
  {
    v2 = CKIsRunningInMessages();

    if (v2 && (!+[CKStarkManager isCarPlayConnected]|| !CKIsScreenLocked()))
    {
      if (IMOSLoggingEnabled())
      {
        v3 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
        {
          v4 = [*(a1 + 32) chat];
          v5 = [v4 chatIdentifier];
          *buf = 138412290;
          v9 = v5;
          _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Marking chat %@ as read on transcript push as this was a user initiated action", buf, 0xCu);
        }
      }

      v6 = [*(a1 + 32) conversation];
      [v6 markAllMessagesAsRead];
    }
  }

  else
  {
  }
}

- (BOOL)clearCommSafetyCompositionIfNecessary
{
  v3 = [MEMORY[0x1E69A7FC8] sharedManager];
  v4 = [v3 checksForSensitivityOnSend];

  if (!v4)
  {
    return 0;
  }

  v5 = [(CKChatController *)self composition];
  v6 = [v5 text];
  v7 = [v6 string];
  v8 = IMSharedUtilitiesFrameworkBundle();
  v9 = [v8 localizedStringForKey:@"MESSAGE_GROWNUP_BODY" value:&stru_1F04268F8 table:@"CommSafetyLocalizable"];
  v10 = [v7 isEqualToString:v9];

  if (!v10)
  {
    return 0;
  }

  v11 = [(CKCoreChatController *)self conversation];
  [v11 setUnsentComposition:0];

  [(CKChatController *)self setComposition:0];
  return 1;
}

- (void)viewWillDisappear:(BOOL)a3
{
  v24.receiver = self;
  v24.super_class = CKChatController;
  [(CKCoreChatController *)&v24 viewWillDisappear:a3];
  v4 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v5 = [v4 isSendAnimationRefreshEnabled];

  if (v5)
  {
    throwSendAnimationManager = self->_throwSendAnimationManager;
    if (throwSendAnimationManager)
    {
      [(CKThrowAnimationManager *)throwSendAnimationManager sendAnimationContainingViewWillDisappear];
    }
  }

  [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:1];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ViewControllerNotVisible"];
  v7 = [(CKChatController *)self entryView];
  v8 = [v7 contentView];
  [v8 setIgnoreEndEditing:1];

  [(CKChatController *)self resignFirstResponderOnEntryViewIfNeeded];
  v9 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  v10 = v9;
  if (v9)
  {
    [v9 chatControllerWillDisappear:self];
  }

  v11 = [(CKChatController *)self entryView];
  v12 = [v11 isRecording];

  if (v12)
  {
    v13 = [(CKChatController *)self entryView];
    [v13 stopRecording];

    v14 = [(CKChatController *)self entryView];
    v15 = [v14 recorder];
    [v15 setPaused:1];
  }

  if (![(CKChatController *)self clearCommSafetyCompositionIfNecessary])
  {
    [(CKChatController *)self _saveDraftState];
  }

  [(CKChatController *)self updateRaiseGesture];
  v16 = [(CKCoreChatController *)self inputController];
  [v16 unregisterForTextInputPayloadHandling];

  v17 = +[CKBalloonPluginManager sharedInstance];
  [v17 invalidatePhotosPlugin];

  v18 = [MEMORY[0x193AF5EC0](@"AFContextManager" @"AssistantServices")];
  [v18 removeContextProvider:self];

  v19 = [(CKChatController *)self nicknameBanner];
  if (v19)
  {
    v20 = [(CKChatController *)self transitionCoordinator];
    v22[0] = MEMORY[0x1E69E9820];
    v22[1] = 3221225472;
    v22[2] = __38__CKChatController_viewWillDisappear___block_invoke;
    v22[3] = &unk_1E72ED598;
    v22[4] = self;
    v23 = v19;
    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __38__CKChatController_viewWillDisappear___block_invoke_2;
    v21[3] = &unk_1E72EC3E8;
    v21[4] = self;
    [v20 animateAlongsideTransition:v22 completion:v21];
  }

  [(CKChatController *)self dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:0];
  [(CKChatController *)self dismissCollaborationNoticeBannersIfNecessary];
  [(CKChatController *)self dismissBusinessOnboardingIfShowing];
}

void __38__CKChatController_viewWillDisappear___block_invoke(uint64_t a1, void *a2)
{
  v33 = [a2 viewControllerForKey:*MEMORY[0x1E69DE778]];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v4 = v33;
  if (isKindOfClass)
  {
    v5 = v33;
    v6 = [v5 navigationItem];
    [v6 _manualScrollEdgeAppearanceProgress];
    v8 = v7;

    v9 = [*(a1 + 32) view];
    [v9 safeAreaInsets];
    v11 = v10;
    v12 = [v5 view];
    [v12 safeAreaInsets];
    v14 = v13;

    v15 = [*(a1 + 32) view];
    v16 = [v15 window];
    v17 = [v16 windowScene];
    v18 = [v17 interfaceOrientation] - 3;

    if (v18 > 1)
    {
      v19 = 0;
    }

    else
    {
      v19 = 0;
      if (v11 < v14 && v8 == 0.0)
      {
        v19 = [*(a1 + 32) _wantsThreeColumnLayout] ^ 1;
      }
    }

    if (v8 == 1.0 || (([v5 isSearchActive] | v19) & 1) != 0)
    {
      *(*(a1 + 32) + 1392) = 1;
      [*(a1 + 40) frame];
      v21 = v20;
      v23 = v22;
      v25 = v24;
      v26 = [v5 view];
      [v26 safeAreaInsets];
      v28 = v27;

      v29 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v30 = [v29 isModernSplitViewControllerEnabled];

      if (v30)
      {
        v31 = [v5 view];
        [v31 safeAreaInsets];
        v21 = v32;
      }

      [*(a1 + 40) setFrame:{v21, v28, v23, v25}];
    }

    v4 = v33;
  }
}

- (void)viewDidDisappear:(BOOL)a3
{
  v17[1] = *MEMORY[0x1E69E9840];
  v15.receiver = self;
  v15.super_class = CKChatController;
  [(CKViewController *)&v15 viewDidDisappear:a3];
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v4 chat];

  if (v5)
  {
    v6 = [(CKCoreChatController *)self currentPosterBundleIdentifier];
    v7 = v6;
    if (v6)
    {
      v16 = @"posterName";
      v17[0] = v6;
      v8 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v17 forKeys:&v16 count:1];
    }

    else
    {
      v8 = 0;
    }

    v9 = [MEMORY[0x1E695DF00] date];
    [CKPowerLog sendTranscriptVisibilityChangedEvent:v9 event:1 metadata:v8];
  }

  [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:0];
  v10 = +[CKBalloonPluginManager sharedInstance];
  [v10 commitInteractionTimeOrderingChanges];

  [(CKChatController *)self setScrollBlock:0];
  [(CKChatController *)self setEditing:0 animated:0];
  [(CKChatController *)self setIsShowingCamera:0];
  v11 = [(CKChatController *)self tipManager];
  [v11 chatControllerDidDisappear];

  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    [(CKChatController *)self removeLockoutControllerIfNeeded];
  }

  v12 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  v13 = v12;
  if (v12)
  {
    [v12 dismissAnimated:0 completion:0];
  }

  v14 = [(CKChatController *)self transcriptNavigationBarController];
  [v14 transcriptDidDismiss];
}

- (void)parentControllerDidBecomeActive
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 parentControllerDidBecomeActive];
  v3 = [(CKCoreChatController *)self collectionViewController];
  [v3 parentControllerDidBecomeActive];
}

- (void)_performResume
{
  v28[1] = *MEMORY[0x1E69E9840];
  [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:0];
  [(CKChatController *)self setDidComputeInitiallyVisibleIndexPaths:0];
  [(CKChatController *)self setDidDisplayFirstUnreadMessage:0];
  [(CKChatController *)self _updateCatchUpButtonVisibilityResumingFromBackground:1];
  v24.receiver = self;
  v24.super_class = CKChatController;
  [(CKCoreChatController *)&v24 _performResume];
  v3 = [(CKCoreChatController *)self currentPosterBundleIdentifier];
  v4 = v3;
  if (v3)
  {
    v27 = @"posterName";
    v28[0] = v3;
    v5 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  }

  else
  {
    v5 = 0;
  }

  v6 = [MEMORY[0x1E695DF00] date];
  [CKPowerLog sendTranscriptVisibilityChangedEvent:v6 event:0 metadata:v5];

  v7 = [(CKChatController *)self entryView];
  if ([v7 isHidden])
  {
    v8 = [(CKCoreChatController *)self inputController];
    v9 = [v8 appManagerIsDisplayed];

    if (v9)
    {
      goto LABEL_8;
    }

    v10 = [(CKChatController *)self entryView];
    [v10 setHidden:0];

    v7 = [(CKChatController *)self entryView];
    [v7 setAlpha:1.0];
  }

LABEL_8:
  [(CKChatController *)self setEditing:0 animated:0];
  v11 = +[CKDraftManager sharedInstance];
  [v11 flushCache];

  v12 = [(CKCoreChatController *)self conversation];
  v13 = [v12 unsentComposition];

  v14 = [(CKChatController *)self composition];
  v15 = [v14 hasContent];

  if (v15)
  {
    if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Refreshing composition to establish connection to photo browser due to resume", buf, 2u);
      }
    }

    v17 = [(CKCoreChatController *)self inputController];
    v18 = [(CKChatController *)self composition];
    [v17 requestPhotoBrowserInitFromDraft:v18];
  }

  else
  {
    if (![v13 hasContent])
    {
      goto LABEL_21;
    }

    if (IMOSLoggingEnabled())
    {
      v19 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Conversation has unsent content that is not in the current composition, restoring it", buf, 2u);
      }
    }

    [(CKChatController *)self setComposition:v13];
    v17 = [(CKCoreChatController *)self inputController];
    [v17 requestPhotoBrowserInitFromDraft:v13];
  }

LABEL_21:
  if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v26 = "[CKChatController _performResume]";
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", buf, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  [(CKChatController *)self _sizeEffectPickerWindow];
  [(CKChatController *)self _reloadMentionsData];
  v21 = [(CKChatController *)self entryView];
  v22 = [v21 contentView];
  v23 = [v22 pluginEntryViewController];

  if (objc_opt_respondsToSelector())
  {
    [v23 performHostAppResume];
  }
}

- (void)prepareForSuspend
{
  v19 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v18 = "[CKChatController prepareForSuspend]";
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "%s", buf, 0xCu);
    }
  }

  v4 = [(CKCoreChatController *)self currentPosterBundleIdentifier];
  v5 = v4;
  if (v4)
  {
    v15 = @"posterName";
    v16 = v4;
    v6 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v16 forKeys:&v15 count:1];
  }

  else
  {
    v6 = 0;
  }

  v7 = [MEMORY[0x1E695DF00] date];
  [CKPowerLog sendTranscriptVisibilityChangedEvent:v7 event:1 metadata:v6];

  v8 = +[CKPluginExtensionStateObserver sharedInstance];
  v9 = [v8 passKitUIPresented];

  if (v9)
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "prepareForSuspend not doing suspend work as we are suspending due to passkit UI", buf, 2u);
      }

LABEL_12:
    }
  }

  else
  {
    v11 = +[CKPluginExtensionStateObserver sharedInstance];
    v12 = [v11 iTunesStoreDialogPresented];

    if (!v12)
    {
      v14[0] = MEMORY[0x1E69E9820];
      v14[1] = 3221225472;
      v14[2] = __37__CKChatController_prepareForSuspend__block_invoke;
      v14[3] = &unk_1E72EBA18;
      v14[4] = self;
      [MEMORY[0x1E69DD258] _performWithoutDeferringTransitions:v14];
      v13 = +[CKLinkIntentsManager sharedManager];
      [v13 purgeDependencies];

      goto LABEL_19;
    }

    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "prepareForSuspend not doing suspend work as we are suspending due to iTunesStore UI", buf, 2u);
      }

      goto LABEL_12;
    }
  }

LABEL_19:
}

void __37__CKChatController_prepareForSuspend__block_invoke(uint64_t a1)
{
  v2 = [MEMORY[0x1E69A7FC8] sharedManager];
  v3 = [v2 checksForSensitivityOnSend];

  v4 = *(a1 + 32);
  if (v3 && ([v4 composition], v5 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v5, "text"), v6 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v6, "string"), v7 = objc_claimAutoreleasedReturnValue(), IMSharedUtilitiesFrameworkBundle(), v8 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "localizedStringForKey:value:table:", @"MESSAGE_GROWNUP_BODY", &stru_1F04268F8, @"CommSafetyLocalizable"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v7, "isEqualToString:", v9), v9, v8, v7, v6, v5, v4 = *(a1 + 32), v10))
  {
    v11 = [v4 conversation];
    [v11 setUnsentComposition:0];
  }

  else
  {
    [v4 _saveDraftState];
  }

  if (!CKIsRunningInMacCatalyst())
  {
    [*(a1 + 32) setEditing:0 animated:0];
    v12 = [*(a1 + 32) inputController];
    [v12 prepareForSuspend];

    v13 = +[CKBalloonPluginManager sharedInstance];
    [v13 prepareForSuspend];

    v14 = [*(a1 + 32) collectionViewController];
    [v14 prepareForSuspend];

    [*(a1 + 32) dismissContextMenuInteractionMenu];
    if ([*(a1 + 32) isFullScreenBalloonViewOnScreen])
    {
      if (IMOSLoggingEnabled())
      {
        v15 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          *v26 = 0;
          _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Dismissing fullscreen balloon view for suspend", v26, 2u);
        }
      }

      [*(a1 + 32) _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
    }

    v16 = +[CKAdaptivePresentationController sharedInstance];
    [v16 dismissViewControllerAnimated:0 completion:0];

    [*(a1 + 32) hideMediaPickerAnimated:0];
    [*(a1 + 32) updateRaiseGesture];
    v17 = [*(a1 + 32) navigationController];
    v18 = [v17 popToViewController:*(a1 + 32) animated:0];

    v19 = [*(a1 + 32) entryView];

    if (v19)
    {
      if (([*(a1 + 32) isFunCamPresented] & 1) == 0)
      {
        v20 = [*(a1 + 32) entryView];
        v21 = [v20 contentView];
        v22 = [v21 isActive];

        if ((v22 & 1) == 0)
        {
          [*(a1 + 32) becomeFirstResponder];
        }
      }
    }

    [*(a1 + 32) setTargetFirstResponder:0];
    v23 = [*(a1 + 32) entryView];
    v24 = [v23 contentView];
    v25 = [v24 pluginEntryViewController];

    if (objc_opt_respondsToSelector())
    {
      [v25 performHostAppSuspend];
    }
  }
}

- (void)didReceiveMemoryWarning
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKChatController *)&v3 didReceiveMemoryWarning];
  [(CKChatController *)self setPreviewController:0];
}

- (void)viewWillTransitionToSize:(CGSize)a3 withTransitionCoordinator:(id)a4
{
  height = a3.height;
  width = a3.width;
  v7 = a4;
  v26.receiver = self;
  v26.super_class = CKChatController;
  [(CKChatController *)&v26 viewWillTransitionToSize:v7 withTransitionCoordinator:width, height];
  [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
  [(CKChatController *)self setTransitioningSize:1];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ViewControllerSizeTransition"];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke;
  aBlock[3] = &unk_1E72EC3E8;
  aBlock[4] = self;
  v8 = _Block_copy(aBlock);
  v9 = [(CKCoreChatController *)self collectionViewController];
  v10 = [v9 collectionView];

  if (v10 && [v10 numberOfItemsInSection:0] >= 1)
  {
    v11 = [(CKChatController *)self isEditing];
    v12 = v11;
    if (v11)
    {
      v13 = [(CKCoreChatController *)self collectionViewController];
      v14 = [v13 selectedItems];
    }

    else
    {
      v14 = 0;
    }

    v15 = [(CKCoreChatController *)self isCollapsed];
    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_2;
    v21[3] = &unk_1E72ED5E8;
    v23 = v15;
    v24 = v12;
    v21[4] = self;
    v22 = v14;
    v16 = v14;
    [v7 animateAlongsideTransition:v21 completion:v8];
  }

  else
  {
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_4;
    v20[3] = &unk_1E72EC3E8;
    v20[4] = self;
    [v7 animateAlongsideTransition:v20 completion:v8];
  }

  v17 = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (v17)
  {
    v18 = [(CKCoreChatController *)self inputController];
    [v18 endStickerReactionSession];

    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }

  v19 = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [v19 setNeedsUpdate];

  [MEMORY[0x1E6979518] addCommitHandler:&__block_literal_global_783_0 forPhase:2];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setTransitioningSize:0];
  [*(a1 + 32) endHoldingScrollGeometryUpdatesForReason:@"ViewControllerSizeTransition"];
  if ([*(a1 + 32) viewDidMoveToWindowAndNeedsToScrollToInsertionTime])
  {
    [*(a1 + 32) updateScrollGeometryWithInheritedAnimationForReason:@"ViewSizeTransitionCompletion"];
    v2 = [*(a1 + 32) collectionViewController];
    v3 = +[CKScrollViewAnimationProperties unanimated];
    [v2 enforceTranscriptScrollIntentWithAnimationProperties:v3];

    [*(a1 + 32) setViewDidMoveToWindowAndNeedsToScrollToInsertionTime:0];
  }

  [*(a1 + 32) _sizeEffectPickerWindow];
  v4 = [MEMORY[0x1E69DC938] currentDevice];
  v5 = [v4 orientation];

  if ([*(a1 + 32) lastKnownDeviceOrientation] != v5)
  {
    v6 = [*(a1 + 32) inputController];
    [v6 didTransitionFromOrientation:objc_msgSend(*(a1 + 32) toOrientation:{"lastKnownDeviceOrientation"), v5}];

    [*(a1 + 32) setLastKnownDeviceOrientation:v5];
  }

  v7 = [MEMORY[0x1E696AD88] defaultCenter];
  [v7 postNotificationName:@"kPPTChatControllerDidRotateNotification" object:0];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_2(uint64_t a1)
{
  v1 = MEMORY[0x1E69DD250];
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_3;
  v3[3] = &unk_1E72ED5C0;
  v5 = *(a1 + 48);
  v2 = *(a1 + 40);
  v3[4] = *(a1 + 32);
  v4 = v2;
  [v1 performWithoutAnimation:v3];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_3(uint64_t a1)
{
  v2 = +[CKUIBehavior sharedBehaviors];
  if ([v2 canPresentOverKeyboard])
  {
  }

  else
  {
    v3 = *(a1 + 48);
    v4 = [*(a1 + 32) isCollapsed];

    if (v3 != v4)
    {
      v5 = [*(a1 + 32) imagePickerController];

      if (v5)
      {
        [*(a1 + 32) hideMediaPickerAnimated:0];
      }
    }
  }

  [*(a1 + 32) _updateEntryViewFrameIfNeeded:0];
  [*(a1 + 32) setEditing:*(a1 + 49) animated:0];
  v7 = [*(a1 + 32) collectionViewController];
  [v7 setSelectedItems:*(a1 + 40)];
  [*(a1 + 32) reloadFooterViewControllerIfNecessary];
  [*(a1 + 32) updateScrollGeometryWithInheritedAnimationForReason:@"ViewSizeTransitionAnimation"];
  v6 = +[CKScrollViewAnimationProperties unanimated];
  [v7 enforceTranscriptScrollIntentWithAnimationProperties:v6];

  [*(a1 + 32) _showCatchUpButtonIfNeeded];
}

uint64_t __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_4(uint64_t a1)
{
  [*(a1 + 32) _updateEntryViewFrameIfNeeded:0];
  v2 = *(a1 + 32);

  return [v2 updateScrollGeometryWithInheritedAnimationForReason:@"ViewSizeTransitionAnimation"];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_5()
{
  v0 = [MEMORY[0x1E696AD88] defaultCenter];
  [v0 postNotificationName:@"kPPTChatControllerWillRotateNotification" object:0];
}

- (void)presentViewController:(id)a3 animated:(BOOL)a4 completion:(id)a5
{
  v6 = a4;
  v8 = a3;
  v9 = a5;
  v10 = [v8 presentationController];
  v11 = [v10 delegate];

  if (!v11)
  {
    v12 = [v8 presentationController];
    [v12 setDelegate:self];
  }

  [(CKChatController *)self dismissTipIfPresented];
  v13 = [(CKChatController *)self _viewControllerForModalPresentationOfViewController:v8];
  v14 = v13;
  if (v13 == self)
  {
    v15.receiver = self;
    v15.super_class = CKChatController;
    [(CKChatController *)&v15 presentViewController:v8 animated:v6 completion:v9];
  }

  else
  {
    [(CKChatController *)v13 presentViewController:v8 animated:v6 completion:v9];
  }
}

- (id)_viewControllerForModalPresentationOfViewController:(id)a3
{
  v4 = [(CKCoreChatController *)self inputController];
  v5 = [v4 isAppCardPresented];

  if (v5)
  {
    v6 = [(CKChatController *)self presentedViewController];
    v7 = [v6 conformsToProtocol:&unk_1F06826C0];

    if (v7)
    {
      v8 = [(CKCoreChatController *)self inputController];
      v9 = [v8 isAppCardDismissing];

      if ((v9 & 1) == 0)
      {
        v13 = [(CKChatController *)self presentedViewController];
        goto LABEL_7;
      }
    }

    v10 = [(CKChatController *)self activeSendMenuPresentationForChatInputController:0];
    if (v10)
    {
      v11 = v10;
      v12 = [v10 sendMenuViewController];

      goto LABEL_8;
    }
  }

  v13 = self;
LABEL_7:
  v12 = v13;
LABEL_8:

  return v12;
}

- (void)dismissViewControllerAnimated:(BOOL)a3 completion:(id)a4
{
  v4 = a3;
  v6 = a4;
  v7 = [(CKChatController *)self presentedViewController];
  v8 = [(CKChatController *)self nicknameUpdateController];

  if (v7 == v8)
  {
    [(CKChatController *)self setNicknameUpdateController:0];
  }

  v9.receiver = self;
  v9.super_class = CKChatController;
  [(CKChatController *)&v9 dismissViewControllerAnimated:v4 completion:v6];
}

- (void)presentationControllerDidDismiss:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self presentedViewController];

  if (!v5)
  {
    v6 = [(CKChatController *)self entryView];
    v7 = [v6 window];

    if (!v7)
    {
      v8 = IMLogHandleForCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        [(CKChatController *)v4 presentationControllerDidDismiss:v8];
      }

      [(CKChatController *)self reloadInputViews];
    }
  }

  v9 = [v4 presentedViewController];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    [(CKChatController *)self didFinishShowingBusinessOnboarding];
  }

  v11 = [v4 presentedViewController];
  v12 = [(CKChatController *)self walletOrderImportViewController];
  v13 = [v11 isEqual:v12];

  if (v13)
  {
    [(CKChatController *)self _walletOrderImportControllerDismissed];
    v14 = [(CKCoreChatController *)self delegate];
    [v14 stopForcingOrientation];
  }
}

- (void)_reduceTransparencyStatusDidChange
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Reduce Transparency Status Did Change", v7, 2u);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 collectionView];

  v6 = [v5 indexPathsForVisibleItems];
  [v5 reloadItemsAtIndexPaths:v6];
}

- (void)_contactsListDidChange
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Contacts list did change", v4, 2u);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
}

- (void)traitCollectionDidChange:(id)a3
{
  v41 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v36.receiver = self;
  v36.super_class = CKChatController;
  [(CKChatController *)&v36 traitCollectionDidChange:v4];
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = [v4 description];
      *buf = 138412290;
      v38 = v6;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "traitCollectionDidChange | previous: {%@}", buf, 0xCu);
    }
  }

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = [(CKChatController *)self traitCollection];
      v9 = [v8 description];
      *buf = 138412290;
      v38 = v9;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "traitCollectionDidChange | current: {%@}", buf, 0xCu);
    }
  }

  v10 = objc_autoreleasePoolPush();
  [(CKChatController *)self configureForCurrentTraitCollection];
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "traitCollectionDidChange | Returned from configureForCurrentTraitCollection", buf, 2u);
    }
  }

  v12 = [v4 horizontalSizeClass];
  v13 = [(CKChatController *)self traitCollection];
  v14 = [v13 horizontalSizeClass];

  v15 = [v4 verticalSizeClass];
  v16 = [(CKChatController *)self traitCollection];
  v17 = [v16 verticalSizeClass];

  if (v12 != v14 || v15 != v17)
  {
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = @"NO";
        if (v12 == v14)
        {
          v20 = @"NO";
        }

        else
        {
          v20 = @"YES";
        }

        if (v15 != v17)
        {
          v19 = @"YES";
        }

        *buf = 138412546;
        v38 = v20;
        v39 = 2112;
        v40 = v19;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "> Detected a change to the chat controller's size class. horizontalSizeClassDidChange={%@} verticalSizeClassDidChange={%@}", buf, 0x16u);
      }
    }

    [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
    [(CKChatController *)self setNeedsStatusBarAppearanceUpdate];
  }

  if (v12 != v14 && [v4 horizontalSizeClass] == 1)
  {
    if (+[CKUtilities isIpad])
    {
      v21 = [(CKCoreChatController *)self inputController];
      v22 = [v21 presentedAppBypassesSendMenu];

      if ((v22 & 1) == 0)
      {
        v23 = [(CKCoreChatController *)self inputController];
        [v23 dismissAppCardIfNecessaryAnimated:0 completion:0];
      }
    }
  }

  v24 = [(CKChatController *)self keyboardSnapshotView];
  v25 = v24 == 0;

  if (!v25)
  {
    v26 = [(CKChatController *)self traitCollection];
    v27 = [v26 userInterfaceStyle];
    LOBYTE(v27) = v27 == [v4 userInterfaceStyle];

    if ((v27 & 1) == 0)
    {
      v28 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
      v29 = v28;
      if (v28)
      {
        [v28 dismissAnimated:1 completion:0];
      }
    }
  }

  [v4 displayScale];
  v31 = v30;
  v32 = [(CKChatController *)self traitCollection];
  [v32 displayScale];
  v34 = v31 != v33;

  if (v34)
  {
    [(CKChatController *)self refreshMacToolbar];
  }

  [(CKChatController *)self updateStyleForCurrentEffect];
  [(CKChatController *)self _dismissSendMenuIfNecessaryForChangedPresentationStyle];
  if (IMOSLoggingEnabled())
  {
    v35 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v35, OS_LOG_TYPE_INFO, "traitCollectionDidChange | Completed all configuration updates in response to traitCollection change.", buf, 2u);
    }
  }

  objc_autoreleasePoolPop(v10);
}

- (void)configureForCurrentTraitCollection
{
  v9 = [(CKChatController *)self traitCollection];
  v3 = [(CKChatController *)self entryView];
  [v3 setEntryViewTraitCollection:v9];

  [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView setEntryViewTraitCollection:v9];
  v4 = [(CKChatController *)self tipManager];
  v5 = [v4 presentingTip];

  if (v5)
  {
    v6 = [(CKChatController *)self traitCollection];
    v7 = [v6 verticalSizeClass];

    if (v7 == 1)
    {
      v8 = [(CKChatController *)self tipManager];
      [v8 dismissTipIfPresented];
    }
  }
}

- (void)willMoveToParentViewController:(id)a3
{
  if (a3)
  {
    return;
  }

  v12 = [(CKChatController *)self presentedViewController];
  v5 = [v12 _existingPresentationControllerImmediate:1 effective:0];
  v6 = [v5 presentingViewController];

  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (!v12)
  {
    if (v6 != self || ((isKindOfClass ^ 1) & 1) != 0)
    {
      goto LABEL_12;
    }

LABEL_9:
    v9 = v12;
    v10 = [v9 topViewController];
    objc_opt_class();
    v11 = objc_opt_isKindOfClass();

    if (v11)
    {
      [v9 dismissViewControllerAnimated:0 completion:0];
    }

    goto LABEL_13;
  }

  v8 = [(CKChatController *)self inlineReplyController];

  if (v6 == self && ((isKindOfClass ^ 1) & 1) == 0)
  {
    goto LABEL_9;
  }

  if (v12 != v8)
  {
LABEL_12:
    [(CKChatController *)self dismissBusinessOnboardingIfShowing];
    goto LABEL_13;
  }

  [v12 dismissViewControllerAnimated:0 completion:0];
LABEL_13:
}

- (BOOL)isShowingOscarChat
{
  if (!IMIsOscarEnabled())
  {
    return 0;
  }

  v3 = +[CKConversationList sharedConversationList];
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v3 primaryFilterModeForConversation:v4] == 9;

  return v5;
}

- (BOOL)isEditingMessage
{
  v3 = [(CKChatController *)self messageEditingViewController];
  if (v3)
  {
    v4 = 1;
  }

  else
  {
    v5 = [(CKChatController *)self inlineReplyController];
    v6 = [v5 messageEditingViewController];
    v4 = v6 != 0;
  }

  return v4;
}

- (BOOL)isShowingReactWithAStickerOverlay
{
  v3 = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (!v3)
  {
    return 0;
  }

  v4 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  v5 = [v4 displayConfiguration];
  v6 = [v5 type];

  return v6 == 2;
}

- (id)splitViewController
{
  v3 = [(CKChatController *)self presentingViewController];

  if (v3)
  {
    v4 = [(CKChatController *)self presentingViewController];
    v5 = [v4 splitViewController];
  }

  else
  {
    v7.receiver = self;
    v7.super_class = CKChatController;
    v5 = [(CKChatController *)&v7 splitViewController];
  }

  return v5;
}

- (void)chatControllerWillBeginResizing
{
  v3 = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (v3)
  {

    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
  }
}

- (unint64_t)supportedInterfaceOrientations
{
  v3 = +[CKUIBehavior sharedBehaviors];
  v4 = [v3 supportedInterfaceOrientations];
  v5 = [(CKCoreChatController *)self inputController];
  v6 = [v5 browserSupportedInterfaceOrientations];

  return v6 & v4;
}

- (void)performResumeDeferredSetup
{
  v7.receiver = self;
  v7.super_class = CKChatController;
  [(CKViewController *)&v7 performResumeDeferredSetup];
  v3 = [(CKChatController *)self deferredPresentationBlock];

  if (v3)
  {
    v4 = dispatch_time(0, 200000000);
    v5 = [(CKChatController *)self deferredPresentationBlock];
    dispatch_after(v4, MEMORY[0x1E69E96A0], v5);

    [(CKChatController *)self setDeferredPresentationBlock:0];
  }

  v6 = [(CKCoreChatController *)self collectionViewController];
  [v6 performResumeDeferredSetup];
}

- (BOOL)shouldAutorotate
{
  v3 = [(CKChatController *)self autorotationUpdater];
  v4 = [v3 isHoldingUpdates];

  if (v4)
  {
    return 0;
  }

  v6 = [(CKCoreChatController *)self inputController];
  v7 = [v6 browserShouldAutorotate];

  return v7;
}

- (void)beginHoldingAutorotationForKey:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self autorotationUpdater];
  [v5 beginHoldingUpdatesForKey:v4];

  v6 = [(CKChatController *)self autorotationUpdater];
  [v6 setNeedsUpdate];
}

- (void)endHoldingAutorotationForKey:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self autorotationUpdater];
  [v5 endHoldingUpdatesForKey:v4];
}

- (void)sendComposition:(id)a3 animations:(id)a4
{
  v74[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v69 = a4;
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Sending composition from chat controller.", buf, 2u);
    }
  }

  v8 = _chatControllerTelemetryLogHandle();
  if (os_signpost_enabled(v8))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", " enableTelemetry=YES ", buf, 2u);
  }

  v9 = [MEMORY[0x1E69DC668] sharedApplication];
  -[CKChatController setSendingCompositionBackgroundTask:](self, "setSendingCompositionBackgroundTask:", [v9 beginBackgroundTaskWithName:@"CompositionSending" expirationHandler:&__block_literal_global_809]);

  v10 = [(CKCoreChatController *)self inputController];
  [v10 willSendComposition];

  v11 = [(CKCoreChatController *)self inputController];
  [v11 requestPhotoBrowserToPrepareForDraftClearingPhotoShelfViewController:0];

  if (![(CKChatController *)self showSendAlertIfNecessaryForComposition:v6])
  {
    v13 = [(CKCoreChatController *)self inputController];
    [v13 requestPhotoBrowserToAppendFinalImagesToComposition];

    v68 = [(CKCoreChatController *)self conversation];
    [v68 resetCaches];
    if ([(CKComposition *)v6 hasContent])
    {
      v67 = [(CKChatController *)self nextMediaObjectToTrimInComposition:v6];
      if (v67)
      {
        v66 = [(CKComposition *)v6 shelfPluginPayload];
        v14 = [v66 pluginBundleID];
        v15 = [v14 isEqualToString:*MEMORY[0x1E69A6A00]];

        v16 = [v66 pluginBundleID];
        v17 = IMBalloonExtensionIDWithSuffix();
        if ([v16 isEqualToString:v17] && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
        {
          v18 = [v66 shouldSendAsMediaObject];
        }

        else
        {
          v18 = 0;
        }

        if ((v15 | v18))
        {
          v20 = [(CKComposition *)v6 shelfPluginPayload];
          v21 = [v20 __ck_photoCompositionString];

          v22 = [(CKComposition *)v6 text];
          v23 = [v22 mutableCopy];

          if ([v23 length])
          {
            [v23 insertAttributedString:v21 atIndex:0];
          }

          else
          {
            v41 = [objc_alloc(MEMORY[0x1E696AAB0]) initWithAttributedString:v21];
            v42 = [v41 mutableCopy];

            v23 = v42;
          }

          v43 = [CKComposition alloc];
          v44 = [(CKComposition *)v6 subject];
          v40 = [(CKComposition *)v43 initWithText:v23 subject:v44 shelfPluginPayload:0];

          v45 = [(CKChatController *)self entryView];
          [v45 setComposition:v40];

          v46 = [(CKChatController *)self nextMediaObjectToTrimInComposition:v40];

          v67 = v46;
        }

        else
        {
          v40 = v6;
        }

        v65 = [(CKComposition *)v40 mediaObjects];
        if ([v65 count] == 1)
        {
          v47 = [v65 objectAtIndex:0];
          v48 = [v47 mediaType] == 2;

          v49 = CKFrameworkBundle();
          v50 = v49;
          if (v48)
          {
            v64 = [v49 localizedStringForKey:@"TRIM_ONE_VIDEO_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
            v51 = @"TRIM_ONE_VIDEO_MESSAGE";
          }

          else
          {
            v64 = [v49 localizedStringForKey:@"TRIM_ONE_ATTACHMENT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
            v51 = @"TRIM_ONE_ATTACHMENT_MESSAGE";
          }
        }

        else
        {
          v50 = CKFrameworkBundle();
          v64 = [v50 localizedStringForKey:@"TRIM_MANY_ATTACHMENTS_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          v51 = @"TRIM_MANY_ATTACHMENTS_MESSAGE";
        }

        v52 = CKFrameworkBundle();
        v53 = [v52 localizedStringForKey:v51 value:&stru_1F04268F8 table:@"ChatKit"];

        v54 = [CKAlertController alertControllerWithTitle:v64 message:v53 preferredStyle:1];
        v55 = CKFrameworkBundle();
        v56 = [v55 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
        v70[0] = MEMORY[0x1E69E9820];
        v70[1] = 3221225472;
        v70[2] = __47__CKChatController_sendComposition_animations___block_invoke_830;
        v70[3] = &unk_1E72EC710;
        v70[4] = self;
        v6 = v40;
        v71 = v6;
        v57 = [CKAlertAction actionWithTitle:v56 style:0 handler:v70];
        [v54 addAction:v57];

        v58 = CKFrameworkBundle();
        v59 = [v58 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
        v60 = [CKAlertAction actionWithTitle:v59 style:1 handler:0];
        [v54 addAction:v60];

        [v54 presentFromViewController:self animated:1 completion:0];
        if (os_signpost_enabled(v8))
        {
          *buf = 0;
          _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Bad attachment", buf, 2u);
        }

        if (IMOSLoggingEnabled())
        {
          v61 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v61, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v61, OS_LOG_TYPE_INFO, "Bad attachment, not sending message", buf, 2u);
          }
        }

        goto LABEL_62;
      }

      v24 = [(CKChatController *)self _isRunningPPT];
      v25 = [v68 recipients];
      v26 = [v68 canSendToRecipients:v25 alertIfUnable:1];

      if ((v26 | v24))
      {
        v27 = [MEMORY[0x1E69DCBB8] activeKeyboard];
        [v27 removeAutocorrectPrompt];

        v28 = [(CKCoreChatController *)self isSendingMessage];
        [(CKChatController *)self setSendingMessage:1];
        [(CKChatController *)self _updateNavigationButtons];
        [(CKChatController *)self _willSendComposition:v6 inConversation:v68];
        v29 = [(CKComposition *)v6 shelfPluginPayload];
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) == 0 || (-[CKComposition shelfPluginPayload](v6, "shelfPluginPayload"), v31 = objc_claimAutoreleasedReturnValue(), v32 = [v31 useDirectSend], v31, (v32 & 1) == 0))
        {
          [v68 setUnsentComposition:0];
        }

        v33 = [(CKChatController *)self shareSheetHostBundleIdentifier];
        [(CKComposition *)v6 evaluateSendMetricsWithConversation:v68 shareSheetHostBundleIdentifier:v33];

        if (!CKIsRunningInMacCatalyst())
        {
          v34 = [(CKComposition *)v6 proofreadingInfo];
          if ([v34 count])
          {
            v35 = [(CKCoreChatController *)self conversation];
            v36 = [v35 chat];
            v73 = *MEMORY[0x1E69A5860];
            v74[0] = v34;
            v37 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v74 forKeys:&v73 count:1];
            [v36 setProofreadingInfo:v37];
          }
        }

        v38 = [(CKChatController *)self shouldUseThrowAnimationForComposition:v6];
        if (v69)
        {
          v39 = v28;
        }

        else
        {
          v39 = 1;
        }

        if (!v38 || (v39 & 1) != 0)
        {
          if (IMOSLoggingEnabled())
          {
            v62 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v62, OS_LOG_TYPE_INFO, "Sending message without a throw animation.", buf, 2u);
            }
          }

          [(CKChatController *)self sendCompositionWithoutThrow:v6];
        }

        else
        {
          v69[2]();
        }

        [(CKChatController *)self _clearCompositionAndPendingConversation];
        if (IMOSLoggingEnabled())
        {
          v63 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v63, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v63, OS_LOG_TYPE_INFO, "Sending message complete.", buf, 2u);
          }
        }

        if (os_signpost_enabled(v8))
        {
          *buf = 0;
          _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", " enableTelemetry=YES ", buf, 2u);
        }

        goto LABEL_62;
      }

      if (os_signpost_enabled(v8))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Cannot send", buf, 2u);
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_62;
      }

      v19 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Cannot send message to recipients. Not sending message", buf, 2u);
      }
    }

    else
    {
      [(CKChatController *)self messageEntryViewDidChange:0 isTextChange:1 isShelfChange:0 isTranslationChange:0];
      if (os_signpost_enabled(v8))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Empty message content", buf, 2u);
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_62;
      }

      v19 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Composition has no content. Not sending message", buf, 2u);
      }
    }

LABEL_62:
    goto LABEL_63;
  }

  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Cannot send message. Showing send alert instead.", buf, 2u);
    }
  }

LABEL_63:
}

void __47__CKChatController_sendComposition_animations___block_invoke()
{
  v0 = IMLogHandleForCategory();
  if (os_log_type_enabled(v0, OS_LOG_TYPE_ERROR))
  {
    __47__CKChatController_sendComposition_animations___block_invoke_cold_1();
  }
}

- (BOOL)showSendAlertIfNecessaryForComposition:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  v20 = 0;
  v6 = [v5 canSendComposition:v4 error:&v20];

  v7 = v20;
  if ((v6 & 1) != 0 || [(CKChatController *)self _isRunningPPT])
  {
    v8 = 0;
  }

  else
  {
    if (v7)
    {
      v9 = CKFrameworkBundle();
      v10 = [v9 localizedStringForKey:@"CANNOT_SEND_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];

      v11 = CKFrameworkBundle();
      v12 = [v11 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];

      v13 = CKCreateAlertControllerWithError(v7, v10, 0, v12, 0);
      v14 = [(CKChatController *)self effectPickerViewController];
      if (v14)
      {
        v15 = [(CKChatController *)self effectPickerViewController];
      }

      else
      {
        v15 = self;
      }

      v16 = v15;

      [v13 presentFromViewController:v16 animated:1 completion:0];
    }

    v17 = _chatControllerTelemetryLogHandle();
    if (os_signpost_enabled(v17))
    {
      *v19 = 0;
      _os_signpost_emit_with_name_impl(&dword_19020E000, v17, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Cannot send", v19, 2u);
    }

    v8 = 1;
  }

  return v8;
}

- (void)_clearCompositionAndPendingConversation
{
  dropComposition = self->_dropComposition;
  self->_dropComposition = 0;

  v15 = [(CKCoreChatController *)self conversation];
  v4 = [v15 chat];
  v5 = [v4 guid];
  if (v5)
  {
    v6 = v5;
    v7 = [(CKCoreChatController *)self conversation];
    v8 = [v7 chat];
    v9 = [v8 guid];
    v10 = +[CKConversationList sharedConversationList];
    v11 = [v10 pendingConversation];
    v12 = [v11 chat];
    v13 = [v12 guid];
    v14 = [v9 isEqualToString:v13];

    if (!v14)
    {
      return;
    }

    v15 = +[CKConversationList sharedConversationList];
    [v15 unpendConversation];
  }

  else
  {
  }
}

- (void)sendComposition:(id)a3
{
  v4 = a3;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __36__CKChatController_sendComposition___block_invoke;
  v6[3] = &unk_1E72EB8D0;
  v6[4] = self;
  v7 = v4;
  v5 = v4;
  [(CKChatController *)self sendComposition:v5 animations:v6];
}

- (void)beginThrowAnimationForComposition:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      LOWORD(buf[0]) = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Beginning throw animation.", buf, 2u);
    }
  }

  v6 = [(CKChatController *)self makeThrowAnimationManagerForComposition:v4];
  [(CKChatController *)self setThrowSendAnimationManager:v6];
  v7 = [(CKCoreChatController *)self conversation];
  v8 = [v7 messagesFromComposition:v4];
  objc_initWeak(buf, self);
  v9 = [(CKCoreChatController *)self collectionViewController];
  v10 = [v9 updateAnimationGroup];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __54__CKChatController_beginThrowAnimationForComposition___block_invoke;
  v14[3] = &unk_1E72ED610;
  objc_copyWeak(&v18, buf);
  v15 = v4;
  v16 = v6;
  v17 = v8;
  v11 = v8;
  v12 = v6;
  v13 = v4;
  dispatch_group_notify(v10, MEMORY[0x1E69E96A0], v14);

  objc_destroyWeak(&v18);
  objc_destroyWeak(buf);
}

uint64_t __54__CKChatController_beginThrowAnimationForComposition___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained flagSensitiveMediaObjects:*(a1 + 32)];

  [MEMORY[0x1E6979518] begin];
  [*(a1 + 40) animateMessages:*(a1 + 48)];
  v3 = MEMORY[0x1E6979518];

  return [v3 commit];
}

- (void)sendCompositionWithoutThrow:(id)a3
{
  v29 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self flagSensitiveMediaObjects:v4];
  v6 = [v5 messagesFromComposition:v4];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v7 = [v6 countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v24;
    do
    {
      v10 = 0;
      do
      {
        if (*v24 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [(CKChatController *)self sendMessage:*(*(&v23 + 1) + 8 * v10++) forConversation:v5 newComposition:0];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v23 objects:v28 count:16];
    }

    while (v8);
  }

  v11 = [v4 shelfPluginPayload];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) == 0 || ([v4 shelfPluginPayload], v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "useDirectSend"), v13, (v14 & 1) == 0))
  {
    v15 = [(CKChatController *)self entryView];
    [v15 invalidateCompositionForReason:1];
  }

  [(CKChatController *)self _updateNavigationButtons];
  [v5 setIgnoringTypingUpdates:0];
  [(CKChatController *)self setSendingMessage:0];
  [(CKChatController *)self _didSendCompositionInConversation:v5];
  v16 = [v4 expressiveSendStyleID];
  if (![CKImpactEffectManager identifierIsAnimatedImpactEffect:v16])
  {

    goto LABEL_15;
  }

  v17 = [(CKCoreChatController *)self collectionViewController];
  v18 = [(CKCoreChatController *)self transcriptCollectionViewControllerPlaybackForOutgoingEffectsIsAllowed:v17];

  if (!v18)
  {
LABEL_15:
    [(CKChatController *)self dismissEffectPickerAnimated:0];
    goto LABEL_16;
  }

  v19 = [(CKCoreChatController *)self collectionViewController];
  v20 = [v19 impactEffectManager];
  v21 = [v6 lastObject];
  v27 = v21;
  v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v27 count:1];
  [v20 animateMessages:v22];

LABEL_16:
}

- (BOOL)shouldUseThrowAnimationForComposition:(id)a3
{
  v4 = a3;
  if (-[CKCoreChatController shouldDismissAfterSend](self, "shouldDismissAfterSend") || ![v4 isSendAnimated])
  {
    v7 = 0;
  }

  else
  {
    v5 = +[CKUIBehavior sharedBehaviors];
    if ([v5 showsSendAnimation])
    {
      v6 = [v4 expressiveSendStyleID];
      if ([CKImpactEffectManager identifierIsValidImpactEffect:v6])
      {
        v7 = 0;
      }

      else
      {
        v8 = [(CKCoreChatController *)self collectionViewController];
        v7 = v8 != 0;
      }
    }

    else
    {
      v7 = 0;
    }
  }

  return v7;
}

- (void)updateChatControllerForRecoveredJunkConversation
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 chat];
  [v4 _reloadChatItemsForFilteringChange];

  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  [(CKChatController *)self becomeFirstResponder];

  [(CKChatController *)self reloadInputViews];
}

- (void)performAnimatedJunkRecoveryTransition:(id)a3
{
  v45 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKChatController *)self _currentPresentationController];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v44 = self;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Transitioning chatController: %@ to full screen presentation", buf, 0xCu);
      }
    }

    v7 = [(CKCoreChatController *)self collectionViewController];
    [v7 setTransitioningFromComposing:1];

    v8 = v5;
    v9 = +[CKUIBehavior sharedBehaviors];
    [v9 sendAnimationDuration];
    v11 = v10;

    v12 = [v8 containerView];
    _UISheetMinimumTopInset();
    v14 = v13;

    v15 = [(CKChatController *)self collectionView];
    [v15 beginDisablingTranscriptDynamicsForReason:3];
    v16 = [(CKChatController *)self collectionView];
    [v16 contentOffset];
    v18 = v17;
    v20 = v19;

    v21 = [v8 containerView];
    [v21 bounds];
    v23 = v22;
    v25 = v24;
    v27 = v26;
    v29 = v28;

    v30 = [(CKChatController *)self collectionView];
    [v30 setAutoresizingMask:0];

    v31 = [(CKChatController *)self collectionView];
    [v31 setFrame:{v23, v25 - v14, v27, v29}];

    v32 = [(CKChatController *)self collectionView];
    [v32 setContentOffset:{v18, v20 - v14}];

    v33 = [(CKChatController *)self collectionView];
    [v33 layoutIfNeeded];

    v34 = MEMORY[0x1E69DD250];
    v40[0] = MEMORY[0x1E69E9820];
    v40[1] = 3221225472;
    v40[2] = __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke;
    v40[3] = &unk_1E72EB8D0;
    v41 = v8;
    v42 = self;
    v37[0] = MEMORY[0x1E69E9820];
    v37[1] = 3221225472;
    v37[2] = __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke_2;
    v37[3] = &unk_1E72ED638;
    v38 = v15;
    v39 = v4;
    v35 = v15;
    v36 = v8;
    [v34 animateWithDuration:v40 animations:v37 completion:v11];
  }
}

void __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _setWantsFullScreen:{objc_msgSend(*(a1 + 32), "_wantsFullScreen") ^ 1}];
  v2 = [*(a1 + 32) containerView];
  [v2 layoutIfNeeded];

  v3 = [*(a1 + 32) containerView];
  [v3 bounds];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  v12 = [*(a1 + 40) collectionView];
  [v12 setFrame:{v5, v7, v9, v11}];
}

uint64_t __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) endDisablingTranscriptDynamicsForReason:3];
  result = *(a1 + 40);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

- (void)setupStateForLaunchURL:(id)a3
{
  v35 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [v3 scheme];
  v5 = [v4 lowercaseString];
  if ([v5 isEqualToString:@"itms-messages"])
  {
  }

  else
  {
    v6 = [v3 scheme];
    v7 = [v6 lowercaseString];
    v8 = [v7 isEqualToString:@"itms-messagess"];

    if (!v8)
    {
      goto LABEL_9;
    }
  }

  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v34 = "[CKChatController setupStateForLaunchURL:]";
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from (1) %s", buf, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  v10 = [(CKCoreChatController *)self inputController];
  [v10 presentAppStoreForURL:v3];

  v11 = [MEMORY[0x1E69A8168] sharedInstance];
  [v11 trackEvent:*MEMORY[0x1E69A7310]];

LABEL_9:
  v12 = [MEMORY[0x1E696AF20] componentsWithURL:v3 resolvingAgainstBaseURL:0];
  [v12 queryItems];
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v13 = v29 = 0u;
  v14 = [v13 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v14)
  {
    v15 = *v29;
    while (2)
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v29 != v15)
        {
          objc_enumerationMutation(v13);
        }

        v17 = *(*(&v28 + 1) + 8 * i);
        v18 = [v17 name];
        v19 = [v18 isEqualToString:@"inputmode"];

        if (v19)
        {
          if (IMOSLoggingEnabled())
          {
            v20 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
            {
              *buf = 136315138;
              v34 = "[CKChatController setupStateForLaunchURL:]";
              _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from (2) %s", buf, 0xCu);
            }
          }

          [(CKChatController *)self reloadEntryViewIfNeeded];
          v21 = [v17 value];
          if ([v21 isEqualToString:@"photos"])
          {
            v22 = [(CKCoreChatController *)self inputController];
            [v22 showPhotosExtension];
          }

          else if ([v21 isEqualToString:@"camera"])
          {
            v23 = [(CKCoreChatController *)self inputController];
            [v23 showFunCamera];
          }

          else if ([v21 isEqualToString:@"dt"])
          {
            v24 = [(CKCoreChatController *)self inputController];
            [v24 showDTCompose];
          }

          else
          {
            [v21 isEqualToString:@"apps"];
          }

          goto LABEL_30;
        }
      }

      v14 = [v13 countByEnumeratingWithState:&v28 objects:v32 count:16];
      if (v14)
      {
        continue;
      }

      break;
    }
  }

LABEL_30:

  v25 = [v3 ckLaunchURLBalloonPluginBundleID];
  if ([v25 length])
  {
    v26 = [v3 ckLaunchURLBalloonPluginPayload];
    [(CKChatController *)self setupStateForLaunchPluginWithBundleID:v25 pluginPayload:v26];
  }
}

- (void)setupStateForLaunchPluginWithBundleID:(id)a3 pluginPayload:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([v6 length])
  {
    objc_initWeak(&location, self);
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __72__CKChatController_setupStateForLaunchPluginWithBundleID_pluginPayload___block_invoke;
    aBlock[3] = &unk_1E72ED660;
    v12 = v6;
    objc_copyWeak(&v14, &location);
    v13 = v7;
    v8 = _Block_copy(aBlock);
    if (CKIsRunningInMacCatalyst() && [(CKViewController *)self deferredAppeared])
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __72__CKChatController_setupStateForLaunchPluginWithBundleID_pluginPayload___block_invoke_2;
      block[3] = &unk_1E72EBDB8;
      v10 = v8;
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }

    else
    {
      [(CKChatController *)self setDeferredPresentationBlock:v8];
    }

    objc_destroyWeak(&v14);
    objc_destroyWeak(&location);
  }
}

void __72__CKChatController_setupStateForLaunchPluginWithBundleID_pluginPayload___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) isEqualToString:*MEMORY[0x1E69A69C0]];
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained inputController];
  v4 = v3;
  if (v2)
  {
    [v3 showFunCamera];
  }

  else
  {
    [v3 presentPluginWithBundleID:*(a1 + 32) appLaunchPayload:*(a1 + 40)];
  }
}

- (void)setupStateForLaunchAudio
{
  objc_initWeak(&location, self);
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __44__CKChatController_setupStateForLaunchAudio__block_invoke;
  v3[3] = &unk_1E72EC460;
  objc_copyWeak(&v4, &location);
  [(CKChatController *)self setDeferredPresentationBlock:v3];
  objc_destroyWeak(&v4);
  objc_destroyWeak(&location);
}

void __44__CKChatController_setupStateForLaunchAudio__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained inputController];
  v2 = [v1 entryView];
  [v2 startRecordingForAudioButtonInEntryView];
}

- (CKComposition)composition
{
  v3 = [(CKChatController *)self entryView];
  v4 = v3;
  if (v3)
  {
    [v3 composition];
  }

  else
  {
    [(CKChatController *)self initialComposition];
  }
  v5 = ;

  return v5;
}

- (void)setComposition:(id)a3
{
  v13 = *MEMORY[0x1E69E9840];
  v4 = a3;
  [(CKChatController *)self setCollaborationFailureCount:0];
  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    v5 = [(CKChatController *)self entryView];

    if (!v5)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          LOWORD(v11) = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "entry view is nil", &v11, 2u);
        }
      }

      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          v11 = 136315138;
          v12 = "[CKChatController setComposition:]";
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", &v11, 0xCu);
        }
      }

      [(CKChatController *)self reloadEntryViewIfNeeded];
    }
  }

  v8 = [(CKChatController *)self entryView];
  v9 = v8;
  if (v8)
  {
    [v8 setComposition:v4];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        LOWORD(v11) = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "entry view is nil, set initial composition", &v11, 2u);
      }
    }

    [(CKChatController *)self setInitialComposition:v4];
  }
}

- (void)showKeyboard
{
  [(CKChatController *)self setTargetFirstResponder:1];

  [(CKChatController *)self becomeFirstResponder];
}

- (BOOL)showKeyboardForReply
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 contentView];
  v5 = [v4 isActive];

  if ((v5 & 1) == 0)
  {
    [(CKChatController *)self setTargetFirstResponder:1];
    [(CKChatController *)self becomeFirstResponder];
  }

  return v5 ^ 1;
}

- (void)dismissKeyboard
{
  if ([(CKChatController *)self isKeyboardSnapshotted])
  {
    [(CKChatController *)self animatedDismissalOfKeyboardSnapshot];
  }

  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKChatController *)&v3 becomeFirstResponder];
}

- (void)scrollToMessage:(id)a3 atSpecificMessagePartIndex:(int64_t)a4 highlight:(BOOL)a5 withInlineReplyOverlay:(BOOL)a6 alignedWithView:(id)a7 allowOverScroll:(BOOL)a8
{
  v9 = a6;
  v10 = a5;
  v14 = a7;
  v16 = [a3 guid];
  LOBYTE(v15) = a8;
  [(CKChatController *)self scrollToMessageGUID:v16 atSpecificMessagePartIndex:a4 highlight:v10 autoDismissHighlight:1 withInlineReplyOverlay:v9 alignedWithView:v14 allowOverScroll:v15 scrollPosition:2];
}

- (void)scrollToMessageGUID:(id)a3 atSpecificMessagePartIndex:(int64_t)a4 highlight:(BOOL)a5 autoDismissHighlight:(BOOL)a6 withInlineReplyOverlay:(BOOL)a7 alignedWithView:(id)a8 allowOverScroll:(BOOL)a9 scrollPosition:(unint64_t)a10
{
  v10 = a7;
  v11 = a6;
  v12 = a5;
  v16 = a8;
  v17 = a3;
  v18 = objc_opt_new();
  [v18 setMessageGUID:v17];

  [v18 setHighlight:v12];
  [v18 setPartIndex:a4];
  [v18 setAutoDismissHightlight:v11];
  [v18 setInlineReplyOverlay:v10];
  [v18 setViewToAlignWith:v16];

  [v18 setAllowOverScroll:a9];
  [v18 setScrollPosition:a10];
  [(CKChatController *)self transcriptScrollWithConfiguration:v18];
}

- (void)transcriptScrollWithConfiguration:(id)a3
{
  v32 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v31 = v4;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Requested scroll with configuration: %@", buf, 0xCu);
    }
  }

  v6 = [v4 messageGUID];
  v7 = [v4 partIndex];
  v18 = [v4 highlight];
  v17 = [v4 autoDismissHightlight];
  v16 = [v4 inlineReplyOverlay];
  v8 = [v4 viewToAlignWith];
  v9 = [v4 allowOverScroll];
  v10 = [v4 scrollPosition];
  v11 = [v4 animated];
  v12 = [v4 emphasize];
  objc_initWeak(buf, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __54__CKChatController_transcriptScrollWithConfiguration___block_invoke;
  aBlock[3] = &unk_1E72ED688;
  objc_copyWeak(v23, buf);
  v13 = v6;
  v20 = v13;
  v23[1] = v7;
  v14 = v8;
  v24 = v9;
  v23[2] = v10;
  v25 = v11;
  v26 = v18;
  v27 = v17;
  v28 = v12;
  v29 = v16;
  v21 = v14;
  v22 = self;
  v15 = _Block_copy(aBlock);
  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    v15[2](v15);
  }

  else
  {
    [(CKChatController *)self setScrollBlock:v15];
  }

  objc_destroyWeak(v23);
  objc_destroyWeak(buf);
}

void __54__CKChatController_transcriptScrollWithConfiguration___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = WeakRetained;
  if (WeakRetained)
  {
    v4 = [WeakRetained collectionViewController];
    v5 = [v4 collectionView];
    [v5 setTranscriptScrollIntent:2];
    v6 = [[CKTranscriptHighlightedMessageScrollContext alloc] initWithMessageGUID:*(a1 + 32) messagePartIndex:*(a1 + 64) viewToAlignWith:*(a1 + 40) allowOverScroll:*(a1 + 80) scrollPosition:*(a1 + 72)];
    [v5 setHighlightedMessageScrollContext:v6];

    v7 = [v3 indexPathForMessageGUID:*(a1 + 32) messagePartIndex:*(a1 + 64)];
    if (v7)
    {
      if (IMOSLoggingEnabled())
      {
        v8 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
        {
          v9 = *(a1 + 32);
          v16 = 138412546;
          v17 = v9;
          v18 = 2112;
          v19 = v7;
          _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Will scroll to messageGUID: %@, indexPath: %@", &v16, 0x16u);
        }
      }

      [v3 contentOffsetForIndexPath:v7 viewToAlignWith:*(a1 + 40) allowOverScroll:*(a1 + 80) scrollPosition:*(a1 + 72)];
      v11 = v10;
      v13 = v12;
      [v5 beginDisablingTranscriptDynamicsForReason:14];
      [v5 setContentOffset:*(a1 + 81) animated:{v11, v13}];
      [v5 endDisablingTranscriptDynamicsForReason:14];
      if (*(a1 + 82) == 1)
      {
        [v4 highlightItemAtIndexPathWhenDisplayed:v7 animated:1 autoDismiss:*(a1 + 83)];
      }

      else if (*(a1 + 84) == 1)
      {
        [v4 beginEmphasisWithMessageGUID:*(a1 + 32)];
      }

      if (*(a1 + 85) != 1)
      {
        goto LABEL_16;
      }

      v14 = [v4 chatItems];
      v15 = [CKSocialLayerChatController chatItemForMessageGUID:*(a1 + 32) messagePartIndex:*(a1 + 64) chatItems:v14];
      [*(a1 + 48) showInlineReplyControllerForChatItem:v15 presentKeyboard:1];
    }

    else
    {
      v14 = IMLogHandleForCategory();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        __54__CKChatController_transcriptScrollWithConfiguration___block_invoke_cold_1();
      }
    }

LABEL_16:
  }
}

- (void)dismissInlineReplyIfNeededAndScrollToBottom
{
  v3 = [(CKChatController *)self inlineReplyController];

  if (v3)
  {
    v4 = [(CKChatController *)self inlineReplyController];
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __63__CKChatController_dismissInlineReplyIfNeededAndScrollToBottom__block_invoke;
    v6[3] = &unk_1E72EB9C8;
    v6[4] = self;
    [v4 dismissControllerWithCompletion:v6];
  }

  else
  {
    v5 = [(CKCoreChatController *)self collectionViewController];
    [v5 scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
  }
}

void __63__CKChatController_dismissInlineReplyIfNeededAndScrollToBottom__block_invoke(uint64_t a1)
{
  [*(a1 + 32) setInlineReplyController:0];
  v2 = [*(a1 + 32) chat];
  [v2 dismissInlineReplies];

  v3 = [*(a1 + 32) collectionViewController];
  [v3 scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
}

- (void)primeTranscriptWithInitialOffset:(CGPoint)a3 inset:(UIEdgeInsets)a4
{
  right = a4.right;
  bottom = a4.bottom;
  left = a4.left;
  top = a4.top;
  y = a3.y;
  x = a3.x;
  [(CKChatController *)self setPrimeTranscriptWithInitialScrollGeometries:1];
  [(CKChatController *)self setInitialContentOffset:x, y];

  [(CKChatController *)self setInitialContentInset:top, left, bottom, right];
}

- (id)nextMediaObjectToTrimInComposition:(id)a3
{
  v32 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (CKIsRunningInMacCatalyst())
  {
    if (IMOSLoggingEnabled())
    {
      v5 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Do not offer to trim - this is running on Mac.", buf, 2u);
      }
    }

    v6 = 0;
  }

  else
  {
    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    v7 = [v4 mediaObjects];
    v8 = [v7 countByEnumeratingWithState:&v25 objects:v31 count:16];
    if (v8)
    {
      v9 = *v26;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v26 != v9)
          {
            objc_enumerationMutation(v7);
          }

          v11 = *(*(&v25 + 1) + 8 * i);
          if ([(CKChatController *)self _mediaObjectNeedsTrimming:v11])
          {
            v6 = v11;
            goto LABEL_17;
          }
        }

        v8 = [v7 countByEnumeratingWithState:&v25 objects:v31 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

    v6 = 0;
LABEL_17:

    v12 = [v4 shelfPluginPayload];
    v13 = v12;
    if (v6)
    {
      v14 = 1;
    }

    else
    {
      v14 = v12 == 0;
    }

    if (!v14)
    {
      v23 = 0u;
      v24 = 0u;
      v21 = 0u;
      v22 = 0u;
      v15 = [(CKChatController *)self fileURLKeyToGuidMapping];
      v16 = [v13 __ck_photoCompositionMediaObjectsWithKeyToTrasferGUIDMap:v15];

      v6 = [v16 countByEnumeratingWithState:&v21 objects:v30 count:16];
      if (v6)
      {
        v17 = *v22;
        while (2)
        {
          for (j = 0; j != v6; j = j + 1)
          {
            if (*v22 != v17)
            {
              objc_enumerationMutation(v16);
            }

            v19 = *(*(&v21 + 1) + 8 * j);
            if ([(CKChatController *)self _mediaObjectNeedsTrimming:v19])
            {
              v6 = v19;
              goto LABEL_31;
            }
          }

          v6 = [v16 countByEnumeratingWithState:&v21 objects:v30 count:16];
          if (v6)
          {
            continue;
          }

          break;
        }
      }

LABEL_31:
    }
  }

  return v6;
}

- (void)_updateRecipientCapabilities
{
  [MEMORY[0x1E69E58C0] cancelPreviousPerformRequestsWithTarget:self selector:sel__fetchRecipientCapabilitiesDeferred object:0];

  [(CKChatController *)self performSelector:sel__fetchRecipientCapabilitiesDeferred withObject:0 afterDelay:0.0];
}

- (void)_fetchRecipientCapabilitiesDeferred
{
  v11[1] = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E69A5B50] sharedController];
  v4 = [v3 remoteDaemon];
  v10 = *MEMORY[0x1E69A5060];
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v10 count:1];
  v11[0] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:1];
  v7 = [(CKCoreChatController *)self chat];
  v8 = [v7 guid];
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke;
  v9[3] = &unk_1E72ED570;
  v9[4] = self;
  [v4 fetchCommonCapabilities:v6 fromChatWithGUID:v8 reply:v9];
}

void __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke(uint64_t a1, char a2, void *a3)
{
  v5 = a3;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke_2;
  block[3] = &unk_1E72EBBC0;
  v11 = a2;
  v6 = *(a1 + 32);
  v9 = v5;
  v10 = v6;
  v7 = v5;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      if (*(a1 + 48))
      {
        v4 = @"YES";
      }

      else
      {
        v4 = @"NO";
      }

      v6 = 138412546;
      v7 = v4;
      v8 = 2112;
      v9 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Got HEIF response on capabilities: %@ %@", &v6, 0x16u);
    }
  }

  v5 = [*(a1 + 32) objectForKeyedSubscript:*MEMORY[0x1E69A5060]];
  [*(a1 + 40) setRecipientsAreHEIFCapable:{objc_msgSend(v5, "BOOLValue")}];
}

- (BOOL)_mediaObjectHasTrimMetadata:(id)a3
{
  v3 = [a3 transcoderUserInfo];
  v4 = [v3 objectForKey:*MEMORY[0x1E69A6F90]];
  v5 = [v3 objectForKey:*MEMORY[0x1E69A6F68]];
  v6 = [v3 objectForKey:*MEMORY[0x1E69A6F60]];
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 1;
  }

  v9 = !v7 && v6 != 0;

  return v9;
}

- (BOOL)_mediaObjectNeedsTrimming:(id)a3
{
  v34 = *MEMORY[0x1E69E9840];
  v4 = a3;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_16;
  }

  v5 = [(__CFString *)v4 fileURL];
  v6 = IMIsAAVideoURL();

  if (v6)
  {
    if (![(CKChatController *)self recipientsAreHEIFCapable])
    {
      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Not all recipients are HEIF capable, transcoding new media video", buf, 2u);
        }

        goto LABEL_15;
      }

LABEL_16:
      v13 = 0;
      goto LABEL_17;
    }

    if ([(CKChatController *)self _mediaObjectHasTrimMetadata:v4])
    {
      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v29 = v4;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Skipping already trimmed object, %@", buf, 0xCu);
        }

LABEL_15:

        goto LABEL_16;
      }

      goto LABEL_16;
    }

    v15 = [MEMORY[0x1E696AC08] defaultManager];
    v16 = [(__CFString *)v4 fileURL];
    v17 = [v16 path];
    v27 = 0;
    v18 = [v15 attributesOfItemAtPath:v17 error:&v27];
    v19 = v27;

    if (v19)
    {
      if (IMOSLoggingEnabled())
      {
        v20 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          v21 = [(__CFString *)v4 fileURL];
          *buf = 138412546;
          v29 = v21;
          v30 = 2112;
          v31 = v19;
          _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Failed to find new media at %@ to check size, error %@", buf, 0x16u);
        }
      }

      v13 = 0;
    }

    else
    {
      v22 = [v18 fileSize];
      v23 = [(CKChatController *)self _maxAllowedSVSize];
      v13 = v22 > v23;
      if (IMOSLoggingEnabled())
      {
        v24 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          v25 = [(CKChatController *)self _maxAllowedSVSize];
          v26 = @"NO";
          *buf = 138412802;
          if (v22 > v23)
          {
            v26 = @"YES";
          }

          v29 = v26;
          v30 = 2048;
          v31 = v22;
          v32 = 2048;
          v33 = v25;
          _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "Outgoing new media needs trim? %@ size: %lu limit %lu", buf, 0x20u);
        }
      }
    }
  }

  else
  {
    if (CKIsRunningInMacCatalyst())
    {
      goto LABEL_16;
    }

    [(__CFString *)v4 duration];
    v9 = v8;
    v10 = [(CKCoreChatController *)self conversation];
    [v10 maxTrimDurationForMedia:v4];
    v12 = v11;

    if (v9 <= v12)
    {
      goto LABEL_16;
    }

    v13 = 1;
  }

LABEL_17:

  return v13;
}

- (void)startTrimmingMediaObjectsInComposition:(id)a3
{
  v5 = a3;
  v4 = [(CKChatController *)self nextMediaObjectToTrimInComposition:?];
  if (v4)
  {
    [(CKChatController *)self setCompositionBeingTrimmed:v5];
    [(CKChatController *)self presentTrimControllerForMediaObject:v4];
  }

  else
  {
    [(CKChatController *)self setCompositionBeingTrimmed:0];
  }
}

- (void)presentTrimControllerForMediaObject:(id)a3
{
  v24 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 mediaType];
  v6 = [(CKCoreChatController *)self conversation];
  [v6 maxTrimDurationForMedia:v4];
  v8 = v7;

  if (v5 != 1)
  {
    if (v5 == 2)
    {
      v16 = MEMORY[0x1E69E9820];
      v17 = 3221225472;
      v18 = __56__CKChatController_presentTrimControllerForMediaObject___block_invoke;
      v19 = &unk_1E72ED6B0;
      v20 = self;
      v9 = v4;
      v21 = v9;
      v10 = _Block_copy(&v16);
      v11 = [v9 fileURL];
      v12 = IMIsAAVideoURL();

      if (v12)
      {
        v13 = [v9 fileURL];
        v14 = CKAVURLAssetForURLWithWriteAccess(v13);

        [(CKChatController *)self _maxAllowedSVSize];
        IMEstimateDurationForSize();
      }

      else
      {
        v10[2](v10, v8 * 0.95);
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v15 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v23 = v4;
        _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "I don't know how to trim this media object [%@]", buf, 0xCu);
      }
    }
  }
}

void __56__CKChatController_presentTrimControllerForMediaObject___block_invoke(uint64_t a1, double a2)
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_2;
  block[3] = &unk_1E72EBC38;
  v3 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v5 = v3;
  v6 = a2;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  if (!*(v2 + 1904))
  {
    v3 = [[CKVideoTrimController alloc] initWithMediaObject:*(a1 + 40) maxTrimDuration:*(a1 + 48)];
    v4 = *(a1 + 32);
    v5 = *(v4 + 1904);
    *(v4 + 1904) = v3;

    [*(*(a1 + 32) + 1904) setDelegate:?];
    v2 = *(a1 + 32);
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_3;
  aBlock[3] = &unk_1E72EC410;
  aBlock[4] = v2;
  v6 = _Block_copy(aBlock);
  v7 = [*(a1 + 32) view];
  v8 = [v7 window];
  v9 = [v8 windowScene];
  if (([v9 interfaceOrientation] - 3) >= 2)
  {
    v10 = 3;
  }

  else
  {
    v10 = 4;
  }

  v11 = [*(*(a1 + 32) + 1904) editVideoVC];
  v12 = [v11 popoverPresentationController];
  [v12 setPermittedArrowDirections:v10];

  v13 = +[CKAdaptivePresentationController sharedInstance];
  v14 = [*(*(a1 + 32) + 1904) editVideoVC];
  [v13 presentViewController:v14 fromViewController:*(a1 + 32) presentationHandler:v6 dismissalHandler:0 animated:1 completion:0];
}

void __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v10 = [*(a1 + 32) entryView];
  [v10 frame];
  *a2 = v5;
  a2[1] = v6;
  a2[2] = v7;
  a2[3] = v8;
  v9 = v10;
  *a3 = v10;
}

- (void)trimControllerDidCancel:(id)a3
{
  v4 = a3;
  [(CKChatController *)self setCompositionBeingTrimmed:0];
  p_audioTrimController = &self->_audioTrimController;
  audioTrimController = self->_audioTrimController;
  if (audioTrimController == v4 || (p_audioTrimController = &self->_videoTrimController, audioTrimController = self->_videoTrimController, audioTrimController == v4))
  {
    *p_audioTrimController = 0;
  }

  v7 = +[CKAdaptivePresentationController sharedInstance];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __44__CKChatController_trimControllerDidCancel___block_invoke;
  v8[3] = &unk_1E72EBA18;
  v8[4] = self;
  [v7 dismissViewControllerAnimated:1 completion:v8];
}

uint64_t __44__CKChatController_trimControllerDidCancel___block_invoke(uint64_t a1)
{
  [*(a1 + 32) reloadInputViews];
  v2 = *(a1 + 32);

  return [v2 becomeFirstResponder];
}

- (void)trimController:(id)a3 didFinishTrimmingMediaObject:(id)a4 withReplacementMediaObject:(id)a5
{
  v25 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  p_audioTrimController = &self->_audioTrimController;
  audioTrimController = self->_audioTrimController;
  if (audioTrimController == v8 || (p_audioTrimController = &self->_videoTrimController, audioTrimController = self->_videoTrimController, audioTrimController == v8))
  {
    *p_audioTrimController = 0;
  }

  if (v9 && v10)
  {
    v13 = [(CKChatController *)self compositionBeingTrimmed];
    v14 = [v13 compositionByReplacingMediaObject:v9 withMediaObject:v10];

    v15 = [(CKChatController *)self composition];
    v16 = [(CKChatController *)self compositionBeingTrimmed];
    v17 = [v15 isEqual:v16];

    if (v17)
    {
      [(CKChatController *)self setComposition:v14];
    }

    [(CKChatController *)self setCompositionBeingTrimmed:v14];
  }

  else if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      v22 = v9;
      v23 = 2112;
      v24 = v10;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Not replacing [%@] with [%@]", buf, 0x16u);
    }
  }

  v19 = +[CKAdaptivePresentationController sharedInstance];
  v20[0] = MEMORY[0x1E69E9820];
  v20[1] = 3221225472;
  v20[2] = __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke;
  v20[3] = &unk_1E72EBA18;
  v20[4] = self;
  [v19 dismissViewControllerAnimated:1 completion:v20];
}

void __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [v2 compositionBeingTrimmed];
  v4 = [v2 nextMediaObjectToTrimInComposition:v3];

  if (v4)
  {
    [*(a1 + 32) presentTrimControllerForMediaObject:v4];
  }

  else
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke_2;
    aBlock[3] = &unk_1E72ED6D8;
    aBlock[4] = *(a1 + 32);
    v5 = _Block_copy(aBlock);
    v6 = [*(a1 + 32) compositionBeingTrimmed];
    v7 = [*(a1 + 32) composition];
    if (v6 == v7)
    {
      v8 = [*(a1 + 32) entryView];
      v9[0] = MEMORY[0x1E69E9820];
      v9[1] = 3221225472;
      v9[2] = __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke_3;
      v9[3] = &unk_1E72ED700;
      v10 = v5;
      [v8 compositionWithAcceptedAutocorrection:v9];
    }

    else
    {
      (*(v5 + 2))(v5, v6);
    }
  }
}

uint64_t __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke_2(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) sendComposition:a2];
  [*(a1 + 32) setCompositionBeingTrimmed:0];
  [*(a1 + 32) reloadInputViews];
  v3 = *(a1 + 32);

  return [v3 becomeFirstResponder];
}

- (double)balloonMaxWidth
{
  [(CKCoreChatController *)self calculateTranscriptSafeAreaInsets];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;
  [(CKCoreChatController *)self calculateTranscriptMarginInsets];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v19 = [(CKChatController *)self view];
  [v19 bounds];
  v29 = v20;

  v21 = [(CKCoreChatController *)self chat];
  if ([v21 isStewieChat])
  {
    v22 = 1;
  }

  else
  {
    v23 = [(CKCoreChatController *)self conversation];
    v24 = [v23 sendingService];
    v22 = [v24 __ck_isiMessageLite];
  }

  v25 = +[CKUIBehavior sharedBehaviors];
  [v25 balloonMaxWidthForTranscriptWidth:-[CKChatController pluginButtonsEnabled](self marginInsets:"pluginButtonsEnabled") shouldShowPluginButtons:CKShowCharacterCountEnabled(v22) != 0 shouldShowCharacterCount:0 shouldCoverSendButton:v22 isStewieMode:{v29, v4 + v12, v6 + v14, v8 + v16, v10 + v18}];
  v27 = v26;

  return v27;
}

- (void)_setConversationDeferredSetup
{
  v39 = *MEMORY[0x1E69E9840];
  v36.receiver = self;
  v36.super_class = CKChatController;
  [(CKCoreChatController *)&v36 _setConversationDeferredSetup];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v38 = "[CKChatController _setConversationDeferredSetup]";
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", buf, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  [(CKChatController *)self cleanUpDarkEffectStyle];
  [(CKChatController *)self reloadFooterViewControllerIfNecessary];
  if (CKIsRunningInMacCatalyst())
  {
    if ([(CKChatController *)self shouldUseMacRecipientsView])
    {
      macRecipientsController = self->_macRecipientsController;
      if (macRecipientsController)
      {
        v5 = [(CKCoreChatController *)self conversation];
        [(CKMacRecipientsController *)macRecipientsController setConversation:v5];

        v6 = [(CKMacRecipientsController *)self->_macRecipientsController view];
        v7 = [(CKChatController *)self view];
        [v7 bounds];
        [v6 setFrame:?];
      }
    }

    v8 = +[CKUIBehavior sharedBehaviors];
    v9 = [v8 useMacToolbar];

    if (v9)
    {
      v10 = [(CKCoreChatController *)self macToolbarController];
      [v10 updateVirtualViewForProvider:self];
    }
  }

  v11 = [(CKCoreChatController *)self collectionViewController];
  v12 = [v11 collectionView];

  if ([(CKChatController *)self primeTranscriptWithInitialScrollGeometries])
  {
    [v12 layoutIfNeeded];
    [(CKChatController *)self setPrimeTranscriptWithInitialScrollGeometries:0];
    v13 = [(CKCoreChatController *)self collectionViewController];
    [v13 sizeFullTranscriptIfNecessary];

    [v12 beginDisablingTranscriptDynamicsForReason:13];
    [(CKChatController *)self initialContentOffset];
    [v12 setContentOffset:?];
    [(CKChatController *)self initialContentInset];
    [v12 setContentInset:?];
    [v12 endDisablingTranscriptDynamicsForReason:13];
  }

  v14 = [(CKChatController *)self tapGestureRecognizer];
  if (!v14 || (-[CKChatController tapGestureRecognizer](self, "tapGestureRecognizer"), v15 = objc_claimAutoreleasedReturnValue(), [v15 view], v16 = objc_claimAutoreleasedReturnValue(), v17 = v16 == v12, v16, v15, v14, !v17))
  {
    v18 = [(CKChatController *)self tapGestureRecognizer];

    if (v18)
    {
      v19 = [(CKChatController *)self tapGestureRecognizer];
      v20 = [v19 view];
      v21 = [(CKChatController *)self tapGestureRecognizer];
      [v20 removeGestureRecognizer:v21];
    }

    v22 = [objc_alloc(MEMORY[0x1E69DD060]) initWithTarget:self action:sel_tapGestureRecognized_];
    [v22 setDelegate:self];
    [v12 addGestureRecognizer:v22];
    [(CKChatController *)self setTapGestureRecognizer:v22];
  }

  if (+[CKRaiseGesture isRaiseGestureSupported])
  {
    v23 = [(CKChatController *)self raiseGesture];
    v24 = v23 == 0;

    if (v24)
    {
      v25 = [[CKRaiseGesture alloc] initWithTarget:self action:sel_raiseGestureRecognized_];
      [(CKChatController *)self setRaiseGesture:v25];
    }

    [(CKChatController *)self updateRaiseGesture];
  }

  v26 = [(CKChatController *)self view];
  v27 = [v26 window];
  v28 = [v27 isKeyWindow];

  if ((v28 & 1) == 0)
  {
    if (IMOSLoggingEnabled())
    {
      v29 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        v30 = [MEMORY[0x1E69DD2E8] keyWindow];
        *buf = 138412290;
        v38 = v30;
        _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "CKChatController's window is not key, making it key again. Current key is %@", buf, 0xCu);
      }
    }

    v31 = [(CKChatController *)self view];
    v32 = [v31 window];
    [v32 makeKeyWindow];
  }

  v33 = [(CKChatController *)self nicknameBanner];

  if (v33)
  {
    v34 = [(CKChatController *)self view];
    v35 = [(CKChatController *)self nicknameBanner];
    [v34 bringSubviewToFront:v35];
  }

  [(CKChatController *)self _configureCallStateResolverForCurrentConversation];
  [(CKChatController *)self updateSendMenuShouldElevateCheckIn];
  [(CKCoreChatController *)self setPreviewingChatForScreenTime:0];
}

- (void)_invalidateChatItemLayoutIfNecessary:(CGSize)a3
{
  v4 = [CKApplicationState isResizing:a3.width];
  v5 = [(CKCoreChatController *)self collectionViewController];
  if (v5)
  {
    if (!v4)
    {
      [(CKCoreChatController *)self calculateTranscriptMarginInsets];
      v7 = v6;
      v9 = v8;
      v11 = v10;
      v13 = v12;
      [v5 marginInsets];
      v15 = v14;
      v17 = v16;
      v32 = v18;
      v20 = v19;
      [(CKChatController *)self balloonMaxWidth];
      v22 = v21;
      [v5 balloonMaxWidth];
      if (v9 != v17 || v7 != v15 || v13 != v20 || v11 != v32 || vabdd_f64(v22, v23) > 0.001)
      {
        v24 = [v5 collectionView];
        [v24 beginDisablingTranscriptDynamicsForReason:9];
        v25 = [(CKChatController *)self traitCollection];
        [v5 transcriptBackgroundLuminance];
        [v5 invalidateChatItemLayoutWithNewBalloonMaxWidth:v25 marginInsets:v22 traitCollection:v7 transcriptBackgroundLuminance:{v9, v11, v13, v26}];

        v27 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
        [v5 enforceTranscriptScrollIntentWithAnimationProperties:v27];
        v28 = [v27 propertyAnimator];
        [v28 duration];
        v30 = dispatch_time(0, (v29 * 1000000000.0));
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __57__CKChatController__invalidateChatItemLayoutIfNecessary___block_invoke;
        block[3] = &unk_1E72EBA18;
        v34 = v24;
        v31 = v24;
        dispatch_after(v30, MEMORY[0x1E69E96A0], block);
      }
    }
  }
}

- (CGRect)effectiveVisibleRectOfCollectionViewForTranscriptCollectionViewController:(id)a3
{
  v4 = [(CKChatController *)self collectionView];
  [v4 bounds];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  v12 = v11;
  [v4 adjustedContentInset];
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v20 = v19;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v22 = v14 + v21;
  v23 = v8 + v22;
  v24 = v12 - (v18 + v22);

  v25 = v6 + v16;
  v26 = v23;
  v27 = v10 - (v16 + v20);
  v28 = v24;
  result.size.height = v28;
  result.size.width = v27;
  result.origin.y = v26;
  result.origin.x = v25;
  return result;
}

- (id)firstUnreadMessageItemGUIDForTranscriptCollectionViewController:(id)a3
{
  v4 = [(CKChatController *)self firstUnreadMessageGUIDForTextEffects];

  if (v4)
  {
    v5 = [(CKChatController *)self firstUnreadMessageGUIDForTextEffects];
  }

  else
  {
    v6 = [(CKCoreChatController *)self chat];
    v7 = [v6 firstUnreadMessageItem];

    v8 = [v7 guid];
    [(CKChatController *)self setFirstUnreadMessageGUIDForTextEffects:v8];

    v5 = [(CKChatController *)self firstUnreadMessageGUIDForTextEffects];
  }

  return v5;
}

- (void)transcriptCollectionViewControllerNeedsChatItemLayoutInvalidation:(id)a3
{
  v4 = a3;
  [(CKChatController *)self balloonMaxWidth];
  v6 = v5;
  v18 = [(CKCoreChatController *)self collectionViewController];
  [v18 marginInsets];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;
  v15 = [(CKChatController *)self traitCollection];
  v16 = [(CKCoreChatController *)self collectionViewController];
  [v16 transcriptBackgroundLuminance];
  [v4 invalidateChatItemLayoutWithNewBalloonMaxWidth:v15 marginInsets:v6 traitCollection:v8 transcriptBackgroundLuminance:{v10, v12, v14, v17}];
}

- (void)transcriptCollectionViewController:(id)a3 didInsertChatItems:(id)a4 associatedChatItems:(id)a5
{
  v8 = a4;
  v9 = a5;
  v12.receiver = self;
  v12.super_class = CKChatController;
  [(CKCoreChatController *)&v12 transcriptCollectionViewController:a3 didInsertChatItems:v8 associatedChatItems:v9];
  v10 = [(CKChatController *)self insertItemsCallback];

  if (v10)
  {
    v11 = [(CKChatController *)self insertItemsCallback];
    (v11)[2](v11, v8, v9);

    [(CKChatController *)self setInsertItemsCallback:0];
  }
}

- (void)transcriptCollectionViewController:(id)a3 didTapAttributionButtonForChatItem:(id)a4 parentIndexPath:(id)a5 sender:(id)a6
{
  v16 = a3;
  v10 = a5;
  v11 = a6;
  v12 = [a4 IMChatItem];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = v12;
    if ([v13 attributionType] == 6 && !CKIsRunningInMacCatalyst())
    {
      [(CKChatController *)self _presentSentWithSiriUI];
    }

    else if ([v13 isCommSafetySensitiveAttribution])
    {
      [v16 didTapCommSafetyAttributionItemWithIndexPath:v10 sender:v11];
    }

    else
    {
      v14 = [v13 attributionInfo];
      v15 = [v14 objectForKey:*MEMORY[0x1E69A6FA0]];
      if (v15)
      {
        -[CKChatController _presentBrowserOrAppStoreForAdamID:url:identifier:isForSticker:](self, "_presentBrowserOrAppStoreForAdamID:url:identifier:isForSticker:", v15, 0, 0, [v13 attributionType] == 3);
      }
    }
  }
}

- (void)transcriptCollectionViewController:(id)a3 didTapAttributionLinkTextForChatItem:(id)a4 atIndexPath:(id)a5 sender:(id)a6
{
  v11 = a3;
  v9 = a5;
  v10 = a6;
  if ([a4 actionType] == 5)
  {
    [v11 didTapCommSafetyAttributionItemWithIndexPath:v9 sender:v10];
  }
}

- (int64_t)transcriptCollectionViewControllerWantsCurrentDesiredIntent:(id)a3
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 sendLaterPluginInfo];

  if (v4)
  {
    return 6;
  }

  else
  {
    return 0;
  }
}

- (void)transcriptCollectionViewController:(id)a3 didTapPluginStatusButtonForChatItem:(id)a4
{
  v5 = [a4 IMChatItem];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = [v5 dataSource];
    [v4 didTapStatusItem];
  }
}

- (void)transcriptCollectionViewController:(id)a3 didTapReplyCountStatusButtonForChatItem:(id)a4
{
  v6 = a4;
  v7 = [a3 chatItems];
  v9 = [(CKCoreChatController *)self _threadChatItemForReplyCountChatItem:v6 chatItems:v7];

  v8 = v9;
  if (v9)
  {
    [(CKChatController *)self showInlineReplyControllerForChatItem:v9 presentKeyboard:0];
    v8 = v9;
  }
}

- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 tappedForChatItem:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if ([(CKChatController *)self isFullScreenBalloonViewOnScreen])
  {
    goto LABEL_40;
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v11 = [v9 stackView];
        v12 = [(CKTranscriptPluginPresentationConfiguration *)v11 currentAssetReference];
        [(CKChatController *)self _presentViewerForChatItem:v10 assetReference:v12];
LABEL_18:

LABEL_19:
        goto LABEL_40;
      }
    }
  }

  if ([v10 itemIsReplyContextPreview] && (-[CKChatController isEditing](self, "isEditing") & 1) == 0)
  {
LABEL_39:
    [(CKChatController *)self showInlineReplyControllerForChatItem:v10 presentKeyboard:0];
    goto LABEL_40;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = [v10 mediaObject];
    v12 = [(CKTranscriptPluginPresentationConfiguration *)v11 transfer];
    if ([v12 isDownloadable])
    {
      [(CKCoreChatController *)self setMediaObjectToDownload:v11];
      v13 = [(CKCoreChatController *)self conversation];
      v14 = [v12 guid];
      [v13 acceptTransferAndUpdateReasonForTapped:v14];
    }

    else
    {
      if (![(CKTranscriptPluginPresentationConfiguration *)v11 shouldShowViewer])
      {
        goto LABEL_18;
      }

      if ([v12 isRestoring])
      {
        v15 = [(CKTranscriptPluginPresentationConfiguration *)v11 fileURL];
        v16 = [v15 path];

        v17 = +[CKSyncController sharedInstance];
        [v17 prioritizeAttachmentAtPath:v16];
      }

      [(CKChatController *)self showViewerForMediaObject:v11];
      v13 = [MEMORY[0x1E69A8168] sharedInstance];
      [v13 trackEvent:*MEMORY[0x1E69A7588]];
    }

    goto LABEL_18;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass() & 1) != 0 || (objc_opt_class(), (objc_opt_isKindOfClass()) && [v10 isCorrupt])
  {
    [(CKChatController *)self _showReaderForAggregateChatItem:v10 balloonView:v9];
    goto LABEL_40;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    if (!CKIsRunningInMacCatalyst())
    {
      [(CKChatController *)self _handleTranscriptPluginChatItem:v10];
      goto LABEL_40;
    }

    if ([v10 balloonOrientation] == 1)
    {
      v18 = 8;
    }

    else
    {
      v18 = 4;
    }

    v11 = [[CKTranscriptPluginPresentationConfiguration alloc] initWithSourceView:v9 permittedArrowDirections:v18 shouldDisableSnapshotView:1];
    [(CKChatController *)self _handleTranscriptPluginChatItem:v10 presentationConfiguration:v11];
    goto LABEL_19;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (![v10 itemIsReply] || (objc_msgSend(v10, "wantsOverlayLayout") & 1) != 0 || (-[CKChatController isEditing](self, "isEditing")) && (!objc_msgSend(v10, "itemIsThreadOriginator") || (objc_msgSend(v10, "wantsOverlayLayout") & 1) != 0 || CKIsRunningInMacCatalyst() || (-[CKChatController isEditing](self, "isEditing")))
    {
      v19.receiver = self;
      v19.super_class = CKChatController;
      [(CKCoreChatController *)&v19 transcriptCollectionViewController:v8 balloonView:v9 tappedForChatItem:v10];
      goto LABEL_40;
    }

    goto LABEL_39;
  }

  if ([v10 offerState] != 2)
  {
    [(CKChatController *)self presentDetailsViewController];
  }

LABEL_40:
}

- (void)transcriptCollectionViewController:(id)a3 saveLastTappedChatItemWithDataDetector:(id)a4
{
  v7 = a4;
  v5 = [(CKCoreChatController *)self inputController];

  if (v5)
  {
    v6 = [(CKCoreChatController *)self inputController];
    [v6 setLastTappedChatItemWithDataDetector:v7];
  }
}

- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 doubleTappedItemAtIndexPath:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(CKChatController *)self inlineReplyController];

  if (!v11)
  {
    v12.receiver = self;
    v12.super_class = CKChatController;
    [(CKCoreChatController *)&v12 transcriptCollectionViewController:v8 balloonView:v9 doubleTappedItemAtIndexPath:v10];
  }
}

- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 didRequestReaderViewControllerForChatItem:(id)a5
{
  v7 = a4;
  v8 = a5;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = [CKReaderViewController readerViewControllerForAudioChatItem:v8];
    [v9 setDelegate:self];
    if (CKIsRunningInMacCatalyst())
    {
      [v9 setModalPresentationStyle:7];
      v10 = [v9 popoverPresentationController];
      [v10 setSourceView:v7];

      [(CKChatController *)self presentViewController:v9 animated:1 completion:0];
    }

    else
    {
      [(CKChatController *)self showViewController:v9 sender:self];
    }
  }

  else
  {
    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonView:didRequestReaderViewControllerForChatItem:];
    }
  }
}

- (void)viewDidLayoutSubviewsForTranscriptCollectionViewController:(id)a3
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 viewDidLayoutSubviewsForTranscriptCollectionViewController:a3];
  [(CKChatController *)self _updateCatchUpButtonVisibilityResumingFromBackground:0];
}

- (id)transcriptCollectionViewController:(id)a3 addToContactsMenuForSenderChatItem:(id)a4
{
  v25 = *MEMORY[0x1E69E9840];
  v5 = a4;
  if (CKIsRunningInMacCatalyst())
  {
    v6 = 0;
  }

  else
  {
    v7 = [v5 IMChatItem];
    v8 = [v7 handle];

    if (v8)
    {
      v9 = objc_alloc_init(CKNicknameUpdate);
      [(CKNicknameUpdate *)v9 setHandle:v8];
      v10 = [v8 nicknameObject];
      if (v10)
      {
        [(CKNicknameUpdate *)v9 setNickname:v10];
      }

      v11 = [CKNicknameUtility addContactOptionsMenuItemsWithTarget:self update:v9];
      v12 = [MEMORY[0x1E695DF70] array];
      v20 = 0u;
      v21 = 0u;
      v22 = 0u;
      v23 = 0u;
      v13 = v11;
      v14 = [v13 countByEnumeratingWithState:&v20 objects:v24 count:16];
      if (v14)
      {
        v15 = v14;
        v16 = *v21;
        do
        {
          for (i = 0; i != v15; ++i)
          {
            if (*v21 != v16)
            {
              objc_enumerationMutation(v13);
            }

            v18 = [*(*(&v20 + 1) + 8 * i) uiAction];
            if (v18)
            {
              [v12 addObject:v18];
            }
          }

          v15 = [v13 countByEnumeratingWithState:&v20 objects:v24 count:16];
        }

        while (v15);
      }

      v6 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 children:v12];
    }

    else
    {
      v6 = 0;
    }
  }

  return v6;
}

- (void)transcriptCollectionViewController:(id)a3 unknownSenderButtonTapped:(id)a4 forChatItem:(id)a5
{
  v13 = a4;
  v7 = a5;
  if (CKIsRunningInMacCatalyst())
  {
    v8 = [v7 IMChatItem];
    v9 = [v8 handle];

    if (v9)
    {
      v10 = objc_alloc_init(CKNicknameUpdate);
      [(CKNicknameUpdate *)v10 setHandle:v9];
      v11 = [v9 nicknameObject];
      if (v11)
      {
        [(CKNicknameUpdate *)v10 setNickname:v11];
      }

      v12 = [v13 zoomTransitionSourceView];
      [(CKChatController *)self showUnknownContactPopoverForNicknameUpdate:v10 presentingViewController:self sourceView:v12];
    }
  }
}

- (void)transcriptCollectionViewController:(id)a3 backgroundScrollVelocityThresholdChanged:(BOOL)a4
{
  v4 = a4;
  v5 = [(CKCoreChatController *)self transcriptBackground];
  [v5 backgroundIsScrolling:v4];
}

- (void)_handleTranscriptPluginChatItem:(id)a3 presentationConfiguration:(id)a4
{
  v6 = a3;
  v7 = a4;
  v17 = v6;
  v8 = [v17 IMChatItem];
  v9 = [v8 dataSource];

  if (([v9 wantsInteractiveContentView] & 1) == 0)
  {
    if ([v9 wantsReplyFromContentView] && objc_msgSend(v9, "allowedByScreenTime"))
    {
      v10 = [(CKCoreChatController *)self inputController];
      [v10 presentViewControllerWithPluginChatItem:v17 presentationStyle:1 presentationConfiguration:v7];
    }

    else
    {
      v11 = [(CKCoreChatController *)self collectionViewController];
      v12 = [v11 transcriptIdentifier];
      v10 = [v17 balloonControllerForContext:v12];

      if ((objc_opt_respondsToSelector() & 1) == 0 || ([v10 handlePresentationAction] & 1) == 0)
      {
        v13 = [(CKCoreChatController *)self collectionViewController];
        v14 = [v13 transcriptIdentifier];
        v15 = [v17 contentViewControllerForContext:v14];

        if (v15)
        {
          v16 = [(CKChatController *)self navigationController];
          [v16 pushViewController:v15 animated:1];
        }
      }
    }
  }
}

- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 selectedItemAtIndexPath:(id)a5
{
  v6.receiver = self;
  v6.super_class = CKChatController;
  [(CKCoreChatController *)&v6 transcriptCollectionViewController:a3 balloonView:a4 selectedItemAtIndexPath:a5];
  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self becomeFirstResponder];
}

- (BOOL)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 shouldSelectChatItem:(id)a5
{
  v5 = a5;
  v6 = 0;
  if (CKIsRunningInMacCatalyst())
  {
    if (([v5 itemIsReplyContextPreview] & 1) == 0)
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0 || ([v5 mediaObject], v8 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "transfer"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v9, "isDownloadable"), v9, v8, (v10 & 1) == 0))
          {
            v6 = 1;
          }
        }
      }
    }
  }

  return v6;
}

- (BOOL)transcriptCollectionViewControllerShouldShouldScrollToTopForStatusBarTap:(id)a3
{
  v4 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  if (v4 || [(CKChatController *)self isFullScreenBalloonViewOnScreen])
  {
    v5 = 0;
  }

  else
  {
    v7 = IMGetCachedDomainBoolForKeyWithDefaultValue();
    if (v7)
    {
      [(CKChatController *)self showMessageHistoryViewController];
    }

    v5 = v7 ^ 1;
  }

  return v5;
}

- (BOOL)transcriptCollectionViewControllerShouldScrollToBottomForLocalSentMessage:(id)a3
{
  v3 = [(CKChatController *)self inlineReplyController];
  v4 = v3 == 0;

  return v4;
}

- (BOOL)transcriptCollectionViewControllerShouldPlayAudio:(id)a3
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 isRecording];

  return v4 ^ 1;
}

- (void)transcriptCollectionViewControllerDidSetChatItems:(id)a3
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 transcriptCollectionViewControllerDidSetChatItems:a3];
  if ([(CKViewController *)self deferredAppeared])
  {
    [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  }

  [(CKChatController *)self updateRaiseGesture];
  [(CKChatController *)self _updatePhotoGridIfNeeded];
  [(CKChatController *)self updateQLPreviewControllerBarButtonItemsIfVisible];
}

- (void)transcriptCollectionViewControllerDidChangeAssociatedChatItem:(id)a3 chatItemDiff:(id)a4
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 transcriptCollectionViewControllerDidChangeAssociatedChatItem:a3 chatItemDiff:a4];
  [(CKChatController *)self updateQLPreviewControllerBarButtonItemsIfVisible];
}

- (void)_updatePhotoGridIfNeeded
{
  v2 = self;
  v24 = *MEMORY[0x1E69E9840];
  obj = [(CKChatController *)self photoGridDisplayedChatItemGUID];
  if ([obj length])
  {
    v3 = [(CKChatController *)v2 photoGridDataSourceManager];
    if (v3)
    {
    }

    else
    {
      v4 = [(CKChatController *)v2 photoGridMomentShareChatItem];

      if (!v4)
      {
        return;
      }
    }

    v21 = 0u;
    v22 = 0u;
    v19 = 0u;
    v20 = 0u;
    v5 = [(CKCoreChatController *)v2 collectionViewController];
    v6 = [v5 chatItems];

    obja = v6;
    v7 = [v6 countByEnumeratingWithState:&v19 objects:v23 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v20;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v20 != v9)
          {
            objc_enumerationMutation(obja);
          }

          v11 = *(*(&v19 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v12 = [v11 IMChatItem];
            v13 = [v12 guid];
            [(CKChatController *)v2 photoGridDisplayedChatItemGUID];
            v15 = v14 = v2;
            v16 = [v13 isEqualToString:v15];

            v2 = v14;
            if (v16)
            {
              [(CKChatController *)v14 photoGridDisplayedChatItemChanged:v11];
              goto LABEL_19;
            }
          }
        }

        v8 = [obja countByEnumeratingWithState:&v19 objects:v23 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

LABEL_19:
  }

  else
  {
  }
}

- (void)transcriptCollectionViewControllerPerformBatchUpdateCompleted:(id)a3
{
  v12.receiver = self;
  v12.super_class = CKChatController;
  [(CKCoreChatController *)&v12 transcriptCollectionViewControllerPerformBatchUpdateCompleted:a3];
  v4 = [(CKChatController *)self inlineReplyController];

  if (v4)
  {
    v5 = [(CKCoreChatController *)self collectionViewController];
    v6 = [v5 collectionView];
    [v6 setNeedsLayout];

    v7 = [(CKCoreChatController *)self collectionViewController];
    v8 = [v7 collectionView];
    [v8 layoutIfNeeded];

    v9 = [(CKChatController *)self inlineReplyController];
    v10 = [v9 transitionContext];

    v11 = [(CKChatController *)self _visibleChatItemsToScreenFrameMap];
    [v10 setVisibleChatItemToFrameMap:v11];
  }
}

- (void)transcriptCollectionViewController:(id)a3 willBeginImpactEffectAnimationWithSendAnimationContext:(id)a4
{
  v37 = a4;
  if ([v37 isSender])
  {
    [(CKChatController *)self dismissEffectPickerAnimated:1];
  }

  v5 = [v37 impactIdentifier];
  v6 = [CKImpactEffectManager identifierShouldPlayInWindow:v5];

  if (v6)
  {
    v7 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
    v8 = [v7 superview];
    [v7 frame];
    [v8 convertRect:0 toView:?];
    v10 = v9;
    v12 = v11;
    v14 = v13;
    v16 = v15;

    v17 = [v37 throwBalloonViews];
    v18 = [v17 firstObject];

    v19 = [v18 superview];
    [v18 frame];
    [v19 convertRect:0 toView:?];
    v21 = v20;
    v23 = v22;
    v25 = v24;
    v27 = v26;

    v28 = [(CKChatController *)self collectionView];
    [v28 convertRect:0 toView:{v21, v23, v25, v27}];
    v30 = v29;
    v32 = v31;
    v34 = v33;
    v36 = v35;

    v39.origin.x = v10;
    v39.origin.y = v12;
    v39.size.width = v14;
    v39.size.height = v16;
    v40.origin.x = v30;
    v40.origin.y = v32;
    v40.size.width = v34;
    v40.size.height = v36;
    if (CGRectIntersectsRect(v39, v40))
    {
      [v7 setAlpha:0.0];
    }
  }
}

- (void)transcriptCollectionViewController:(id)a3 didEndImpactEffectAnimationWithSendAnimationContext:(id)a4
{
  v4 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass:a3];
  [v4 alpha];
  if (v5 != 1.0)
  {
    v6 = MEMORY[0x1E69DD250];
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __107__CKChatController_transcriptCollectionViewController_didEndImpactEffectAnimationWithSendAnimationContext___block_invoke;
    v7[3] = &unk_1E72EBA18;
    v8 = v4;
    [v6 animateWithDuration:v7 animations:0.25];
  }
}

- (void)transcriptCollectionViewController:(id)a3 balloonView:(id)a4 didRequestPresentationStyle:(unint64_t)a5 forChatItem:(id)a6 allowAllStyles:(BOOL)a7
{
  v15 = a4;
  v10 = a6;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
    if (CKIsRunningInMacCatalyst())
    {
      if ([v11 balloonOrientation] == 1)
      {
        v12 = 8;
      }

      else
      {
        v12 = 4;
      }

      v13 = [[CKTranscriptPluginPresentationConfiguration alloc] initWithSourceView:v15 permittedArrowDirections:v12 shouldDisableSnapshotView:1];
      v14 = [(CKCoreChatController *)self inputController];
      [v14 presentViewControllerWithPluginChatItem:v11 presentationStyle:a5 presentationConfiguration:v13];
    }

    else
    {
      v13 = [(CKCoreChatController *)self inputController];
      [(CKTranscriptPluginPresentationConfiguration *)v13 presentViewControllerWithPluginChatItem:v11 presentationStyle:a5];
    }
  }
}

- (BOOL)transcriptCollectionViewController:(id)a3 balloonViewDidRequestCommitPayload:(id)a4 forPlugin:(id)a5 allowAllCommits:(BOOL)a6 error:(id *)a7
{
  v8 = a6;
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = [v12 isVisiblePlugin:v14];
  v16 = [v12 hasRecentTouchForSendingPlugin:v14];
  if (![v14 length] || !v15)
  {
    if (a7)
    {
      v19 = MEMORY[0x1E696ABC0];
      v20 = 2;
LABEL_9:
      [v19 errorWithDomain:@"CKBrowserErrorDomain" code:v20 userInfo:0];
      *a7 = v18 = 0;
      goto LABEL_11;
    }

LABEL_10:
    v18 = 0;
    goto LABEL_11;
  }

  if (((v8 | v16) & 1) == 0)
  {
    if (a7)
    {
      v19 = MEMORY[0x1E696ABC0];
      v20 = 1;
      goto LABEL_9;
    }

    goto LABEL_10;
  }

  [v12 clearRecentPluginTouch];
  v17 = [(CKCoreChatController *)self inputController];
  v18 = [v17 commitPayloadBypassingValidation:v13 forPlugin:v14];

LABEL_11:
  return v18;
}

- (void)transcriptCollectionViewController:(id)a3 balloonViewDidRequestStartEditingPayload:(id)a4 forPlugin:(id)a5 allowAllCommits:(BOOL)a6 completionHandler:(id)a7
{
  v8 = a6;
  v20 = a4;
  v12 = a5;
  v13 = a7;
  v14 = a3;
  v15 = [v14 isVisiblePlugin:v12];
  v16 = [v14 hasRecentTouchForSendingPlugin:v12];

  if (![v12 length] || !v15)
  {
    if (!v13)
    {
      goto LABEL_11;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = -1;
LABEL_9:
    v17 = [v18 errorWithDomain:@"CKBrowserErrorDomain" code:v19 userInfo:0];
    v13[2](v13, v17);
    goto LABEL_10;
  }

  if (((v8 | v16) & 1) == 0)
  {
    if (!v13)
    {
      goto LABEL_11;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = 1;
    goto LABEL_9;
  }

  v17 = [(CKCoreChatController *)self inputController];
  [v17 startEditingPayloadBypassingValidation:v20 forPlugin:v12 completion:v13];
LABEL_10:

LABEL_11:
}

- (void)transcriptCollectionViewController:(id)a3 selectedPollAddChoice:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [v7 dataSource];
  v9 = [v8 bundleID];
  v10 = IMBalloonExtensionIDWithSuffix();
  v11 = [v9 isEqualToString:v10];

  if (v11)
  {
    v12 = IMBalloonExtensionIDWithSuffix();
    v13 = [v6 isVisiblePlugin:v12];

    v14 = [v7 dataSource];
    v15 = [v14 pluginPayload];

    v16 = [v7 message];
    v17 = [v16 associatedMessageGUID];
    [v15 setAssociatedMessageGUID:v17];

    [v15 setLiveEditableInEntryView:1];
    [v15 setUpdate:1];
    v18 = [CKBrowserItemPayload browserItemPayloadFromIMPluginPayload:v15];
    [v18 setRequiresValidation:1];
    [v18 setUpdate:1];
    v19 = [v7 dataSource];
    v20 = [v19 sessionGUID];
    [v18 setAssociatedMessageGUID:v20];

    v21 = [v7 dataSource];
    v22 = [v21 sessionGUID];
    [v18 setPluginSessionGUID:v22];

    if (v13)
    {
      v23 = [[CKComposition alloc] initWithText:0 subject:0 shelfPluginPayload:v18];
      v24 = [(CKChatController *)self composition];
      v25 = [v24 compositionByAppendingComposition:v23];
      [(CKChatController *)self setComposition:v25];

      [(CKChatController *)self _updateEntryViewConstraintsIfNeeded];
    }
  }

  else
  {
    v26 = IMLogHandleForCategory();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:selectedPollAddChoice:];
    }
  }
}

- (void)chatInputController:(id)a3 didRequestAppendToCompositionForPayload:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self entryView];
  v10 = [v6 composition];

  v7 = [v5 mediaObjectFromPayload];

  v8 = [v10 compositionByAppendingMediaObject:v7];

  if ([v8 hasContent])
  {
    v9 = [(CKChatController *)self entryView];
    [v9 setComposition:v8];

    [(CKChatController *)self _updateEntryViewFrameIfNeeded:1];
  }
}

- (BOOL)transcriptCollectionViewController:(id)a3 balloonViewDidRequestCommitSticker:(id)a4 forPlugin:(id)a5 allowAllCommits:(BOOL)a6 error:(id *)a7
{
  v8 = a6;
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = [v12 isVisiblePlugin:v14];
  v16 = [v12 hasRecentTouchForSendingPlugin:v14];
  if (![v14 length] || !v15)
  {
    if (!a7)
    {
      goto LABEL_10;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = 2;
LABEL_9:
    *a7 = [v18 errorWithDomain:@"CKBrowserErrorDomain" code:v19 userInfo:0];
    goto LABEL_10;
  }

  if (((v8 | v16) & 1) == 0)
  {
    if (!a7)
    {
      goto LABEL_10;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = 1;
    goto LABEL_9;
  }

  [v12 clearRecentPluginTouch];
  v17 = [(CKCoreChatController *)self inputController];
  [v17 commitStickerBypassingValidation:v13 forPlugin:v14 stickerFrame:{*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)}];

LABEL_10:
  return 1;
}

- (BOOL)transcriptCollectionViewController:(id)a3 balloonViewDidRequestSendCustomAcknowledgementPayload:(id)a4 forPlugin:(id)a5 error:(id *)a6
{
  v37 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = [v10 isVisiblePlugin:v12];
  v14 = [v10 hasRecentTouchForSendingPlugin:v12];
  if (![v12 length])
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 4;
    goto LABEL_24;
  }

  if ((v13 & 1) == 0)
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 2;
    goto LABEL_24;
  }

  if ((v14 & 1) == 0)
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 1;
    goto LABEL_24;
  }

  v15 = [(CKCoreChatController *)self conversation];

  if (!v15)
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 6;
    goto LABEL_24;
  }

  [v10 clearRecentPluginTouch];
  v16 = MEMORY[0x1E696AEC0];
  v17 = [v11 associatedMessageGUID];
  v18 = [v16 stringWithFormat:@"bp:%@", v17];

  v32 = [(CKCoreChatController *)self collectionViewController];
  v19 = [v32 chatItemForGUID:v18];
  if (!v19)
  {
    v28 = IMLogHandleForCategory();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 5;
LABEL_24:

    [MEMORY[0x1E696ABC0] errorWithDomain:@"CKBrowserErrorDomain" code:v27 userInfo:0];
    *a6 = v26 = 0;
    goto LABEL_25;
  }

  v20 = [MEMORY[0x1E69A5AE0] configureMessageSummaryInfoForChatItem:v19];
  v21 = MEMORY[0x1E69A5BD8];
  v22 = [v11 data];
  v23 = [v11 associatedMessageGUID];
  v24 = [v21 customAcknowledgementMessageWithPayloadData:v22 associatedMessageGUID:v23 balloonBundleID:v12 messageSummaryInfo:v20 threadIdentifier:0];

  v25 = IMLogHandleForCategory();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    [CKChatController transcriptCollectionViewController:? balloonViewDidRequestSendCustomAcknowledgementPayload:? forPlugin:? error:?];
  }

  [(CKChatController *)self sendCustomAcknowledgementMessage:v24];
  v26 = 1;
LABEL_25:
  if (IMOSLoggingEnabled())
  {
    v29 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
    {
      v30 = @"NO";
      if (v26)
      {
        v30 = @"YES";
      }

      *buf = 136315394;
      v34 = "[CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:]";
      v35 = 2112;
      v36 = v30;
      _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "%s: sent acknowledgement? %@", buf, 0x16u);
    }
  }

  return v26;
}

- (void)transcriptCollectionViewControllerDisplaySMSSpamReporting:(id)a3
{
  v4 = [(CKCoreChatController *)self chat];
  v5 = [v4 allMessagesToReportAsSpam];

  [(CKChatController *)self showSMSReportSpamExtensionControllerForMessages:v5];
}

- (void)transcriptCollectionViewController:(id)a3 willDisplayBalloonForGUID:(id)a4 withIndexPath:(id)a5 withOriginY:(double)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = [(CKChatController *)self firstUnreadMessageGUID];

  if (v13)
  {
    if (![(CKChatController *)self didDisplayFirstUnreadMessage])
    {
      v14 = [(CKChatController *)self firstUnreadMessageGUID];
      v15 = [v11 isEqualToString:v14];

      if (v15)
      {
        [(CKChatController *)self setDidDisplayFirstUnreadMessage:1];
        [(CKChatController *)self setFirstUnreadMessageCellOriginY:a6];
        if (IMOSLoggingEnabled())
        {
          v16 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
          {
            *v17 = 0;
            _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "First unread message has been displayed by collection view.", v17, 2u);
          }
        }
      }
    }
  }
}

- (void)transcriptCollectionViewController:(id)a3 didScroll:(CGPoint)a4
{
  y = a4.y;
  x = a4.x;
  v9 = a3;
  if ([(CKChatController *)self didDisplayFirstUnreadMessage])
  {
    v7 = [(CKChatController *)self catchUpButton];

    if (v7)
    {
      if ([(CKChatController *)self _isFirstUnreadMessageVisibleForContentOffset:x, y])
      {
        [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:1];
        v8 = [(CKChatController *)self indexPathForFirstUnreadMessage];
        [v9 highlightItemAtIndexPathWhenDisplayed:v8 animated:1 autoDismiss:1];
      }
    }
  }
}

- (BOOL)_isFirstUnreadMessageVisibleForContentOffset:(CGPoint)a3
{
  y = a3.y;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v6 = v5;
  v7 = [(CKChatController *)self collectionView];
  [v7 adjustedContentInset];
  v9 = v8;

  if (v9 >= v6)
  {
    v6 = v9;
  }

  [(CKChatController *)self firstUnreadMessageCellOriginY];
  return y <= v10 - v6;
}

- (void)transcriptCollectionViewControllerWillDisplayLastBalloon:(id)a3
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 transcriptCollectionViewControllerWillDisplayLastBalloon:a3];
}

- (double)transcriptCollectionViewController:(id)a3 targetAlphaForChatItem:(id)a4
{
  v5 = a4;
  v6 = -1.0;
  if (([v5 itemIsReplyContextPreview] & 1) == 0)
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0 || (-[CKChatController traitCollection](self, "traitCollection"), v7 = objc_claimAutoreleasedReturnValue(), v8 = [v7 isTranscriptBackgroundActive], v7, v6 = 0.5, v8))
    {
      v9 = [(CKChatController *)self inlineReplyController];
      if (!v9)
      {
        goto LABEL_6;
      }

      v10 = v9;
      v11 = [(CKChatController *)self inlineReplyController];
      v12 = [v11 animatingOut];

      if (v12)
      {
        goto LABEL_6;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass() & 1) != 0 && [v5 color] == 1 || (objc_opt_class(), (objc_opt_isKindOfClass()) && (objc_msgSend(v5, "latestIsFromMe"))
      {
        v6 = 0.699999988;
        goto LABEL_7;
      }

      objc_opt_class();
      v6 = 0.400000006;
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
LABEL_6:
            v6 = 1.0;
          }
        }
      }
    }
  }

LABEL_7:

  return v6;
}

- (void)transcriptCollectionViewController:(id)a3 sendQuickReplyComposition:(id)a4 withSourceView:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [v8 collectionView];
  [v11 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];

  v12 = [(CKChatController *)self makeThrowAnimationManagerForComposition:v9];
  [v10 bounds];
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v20 = v19;
  v21 = [(CKChatController *)self view];
  [v10 convertRect:v21 toView:{v14, v16, v18, v20}];
  v23 = v22;
  v25 = v24;
  v27 = v26;
  v29 = v28;

  [v12 setSourceRect:{v23, v25, v27, v29}];
  v30 = [(CKChatController *)self view];
  v31 = [v8 quickReplySnapshotInView:v30];

  if (v31)
  {
    [v12 setQuickReplySnapshot:v31];
  }

  else if (IMOSLoggingEnabled())
  {
    v32 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v32, OS_LOG_TYPE_INFO, "CKChatController : Throw Animation Manager: No snapshot generated. Attempting graceful failure by continuing send.", buf, 2u);
    }
  }

  [(CKChatController *)self setThrowSendAnimationManager:v12];
  v35[0] = MEMORY[0x1E69E9820];
  v35[1] = 3221225472;
  v35[2] = __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke;
  v35[3] = &unk_1E72EB880;
  v35[4] = self;
  v36 = v9;
  v37 = v12;
  v33 = v12;
  v34 = v9;
  [(CKChatController *)self sendComposition:v34 animations:v35];
}

void __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) conversation];
  v3 = [v2 messagesFromComposition:*(a1 + 40)];

  v4 = [*(a1 + 32) collectionViewController];
  v5 = [v4 updateAnimationGroup];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke_2;
  v8[3] = &unk_1E72EBEF8;
  v6 = *(a1 + 40);
  v8[4] = *(a1 + 32);
  v9 = v6;
  v10 = *(a1 + 48);
  v11 = v3;
  v7 = v3;
  dispatch_group_notify(v5, MEMORY[0x1E69E96A0], v8);
}

uint64_t __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) flagSensitiveMediaObjects:*(a1 + 40)];
  v2 = *(a1 + 48);
  v3 = *(a1 + 56);

  return [v2 animateQuickReplyMessages:v3];
}

- (void)transcriptCollectionViewController:(id)a3 didTapTruncatedCaptionForRichCard:(id)a4 onBalloonView:(id)a5
{
  v10 = a5;
  v7 = [CKReaderViewController readerViewControllerForRichCard:a4];
  v8 = v7;
  if (v7)
  {
    [v7 setDelegate:self];
    if (CKIsRunningInMacCatalyst())
    {
      [v8 setModalPresentationStyle:7];
      v9 = [v8 popoverPresentationController];
      [v9 setSourceView:v10];

      [(CKChatController *)self presentViewController:v8 animated:1 completion:0];
    }

    else
    {
      [(CKChatController *)self showViewController:v8 sender:self];
    }
  }
}

- (void)transcriptCollectionViewController:(id)a3 selectedChipAction:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self suggestedActionsHandler];
  [v6 performChipAction:v5];
}

- (void)transcriptCollectionViewControllerWillUpdateTranscriptChatItems:(id)a3
{
  v9.receiver = self;
  v9.super_class = CKChatController;
  [(CKCoreChatController *)&v9 transcriptCollectionViewControllerWillUpdateTranscriptChatItems:a3];
  v4 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  v5 = [v4 displayConfiguration];
  v6 = [v5 type];

  if (v6 == 2)
  {
    v7 = [(CKCoreChatController *)self collectionViewController];
    v8 = [v7 collectionView];
    [v8 beginHoldingContentOffsetUpdatesForReason:@"TranscriptUpdatingForAddSticker"];
  }
}

- (void)transcriptCollectionViewControllerDidUpdateTranscriptChatItems:(id)a3
{
  v10.receiver = self;
  v10.super_class = CKChatController;
  [(CKCoreChatController *)&v10 transcriptCollectionViewControllerDidUpdateTranscriptChatItems:a3];
  if ([(CKViewController *)self deferredAppeared])
  {
    [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  }

  [(CKChatController *)self updateRaiseGesture];
  [(CKChatController *)self _updatePhotoGridIfNeeded];
  v4 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  v5 = [v4 displayConfiguration];
  v6 = [v5 type];

  if (v6 == 2)
  {
    v7 = [(CKCoreChatController *)self collectionViewController];
    v8 = [v7 collectionView];
    [v8 endHoldingContentOffsetUpdatesForReason:@"TranscriptUpdatingForAddSticker"];

    v9 = [(CKCoreChatController *)self fullScreenBalloonViewController];
    [v9 updateStickersAnimated:0];
  }
}

- (void)prepareInputForPreviewPresentation
{
  v3 = [(CKCoreChatController *)self inputController];
  v4 = [v3 isInputViewVisible];

  if (v4)
  {
    v5 = [(CKChatController *)self entryView];
    v6 = [v5 contentView];
    -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [v6 isActive]);

    v7 = +[CKUIBehavior sharedBehaviors];
    LOBYTE(v6) = [v7 isEntryViewInputAccessory];

    if ((v6 & 1) == 0)
    {
      v8 = [(CKCoreChatController *)self collectionViewController];
      v9 = [v8 collectionView];
      [v9 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerPreviewPresentation"];
    }

    v10.receiver = self;
    v10.super_class = CKChatController;
    [(CKChatController *)&v10 becomeFirstResponder];
  }

  else
  {

    [(CKChatController *)self setWasKeyboardShowingWithApp:0];
  }
}

- (void)restoreInputAfterPreviewPresentation
{
  if ([(CKChatController *)self wasKeyboardShowingWithApp])
  {
    if ([(CKChatController *)self entryViewWasActiveOnPreview])
    {
      [(CKChatController *)self setEntryViewWasActiveOnPreview:0];
      v3 = 1;
    }

    else
    {
      v3 = 0;
    }

    [(CKChatController *)self setTargetFirstResponder:v3];
  }

  v5 = [(CKCoreChatController *)self collectionViewController];
  v4 = [v5 collectionView];
  [v4 endHoldingContentOffsetUpdatesForReason:@"ChatControllerPreviewPresentation"];
}

- (void)restoreInputAfterSearchPresentation
{
  if (CKIsRunningInMacCatalyst() && ![(CKChatController *)self targetFirstResponder])
  {
    [(CKChatController *)self setTargetFirstResponder:1];
  }

  [(CKChatController *)self becomeFirstResponder];
}

- (UIEdgeInsets)_avoidanceInsets
{
  v20.receiver = self;
  v20.super_class = CKChatController;
  [(CKChatController *)&v20 _avoidanceInsets];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;
  v11 = [(CKChatController *)self entryView];
  v12 = v11;
  if (v11)
  {
    v13 = [v11 contentView];
    v14 = [v13 isActive];

    if ((v14 & 1) == 0)
    {
      [v12 frame];
      v8 = v8 + v15;
    }
  }

  v16 = v4;
  v17 = v6;
  v18 = v8;
  v19 = v10;
  result.right = v19;
  result.bottom = v18;
  result.left = v17;
  result.top = v16;
  return result;
}

- (void)_presentSentWithSiriUI
{
  v3 = [CKSentWithSiriViewController alloc];
  v4 = [(CKCoreChatController *)self conversation];
  v9 = [(CKSentWithSiriViewController *)v3 initWithConversation:v4];

  v5 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel__dismissSentWithSiriUI];
  v6 = [(CKSentWithSiriViewController *)v9 navigationItem];
  [v6 setRightBarButtonItem:v5];

  v7 = [[CKFullscreenBrowserNavigationController alloc] initWithRootViewController:v9];
  v8 = +[CKAdaptivePresentationController sharedInstance];
  [v8 presentViewController:v7 fromViewController:self presentationHandler:0 dismissalHandler:0 animated:1 completion:0];
}

- (void)_dismissSentWithSiriUI
{
  v2 = +[CKAdaptivePresentationController sharedInstance];
  [v2 dismissViewControllerAnimated:1 completion:0];
}

- (void)_presentBrowserForPlugin:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self inputController];
  [v5 launchAndShowBrowserForPlugin:v4 dataSource:0 style:0];
}

- (void)_presentBrowserOrAppStoreForAdamID:(id)a3 url:(id)a4 identifier:(id)a5 isForSticker:(BOOL)a6
{
  v6 = a6;
  v32 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = v12;
  if (v10)
  {
    v14 = +[CKBalloonPluginManager sharedInstance];
    v15 = [v14 pluginForAdamID:v10];

    if (v15)
    {
      if (v6)
      {
        v16 = +[CKBalloonPluginManager sharedInstance];
        v17 = [v16 pluginForIdentifier:@"com.apple.messages.MSMessageExtensionBalloonPlugin:0000000000:com.apple.Stickers.UserGenerated.MessagesExtension"];

        if (v17)
        {
          v18 = v17;
        }

        else
        {
          v18 = v15;
        }

        v19 = v18;

        if (IMOSLoggingEnabled())
        {
          v20 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
          {
            v28 = 138412290;
            v29 = v19;
            _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "We have a plugin: %@, we'll launch the stickers ultra extension instead of launching that plugin directly.", &v28, 0xCu);
          }
        }
      }

      else
      {
        v19 = v15;
      }

      [(CKChatController *)self _presentBrowserForPlugin:v19];
    }

    else
    {
      v23 = [(CKCoreChatController *)self inputController];
      [v23 presentAppStoreForAdamID:v10];

      v24 = [MEMORY[0x1E69A8168] sharedInstance];
      [v24 trackEvent:*MEMORY[0x1E69A72F0]];

      v19 = 0;
    }

    if (IMOSLoggingEnabled())
    {
      v25 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v28 = 138412546;
        v29 = v10;
        v30 = 2112;
        v31 = v19;
        _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "presenting browser or app store for ID: %@, plugin: %@", &v28, 0x16u);
      }
    }
  }

  else if (v11)
  {
    v21 = [MEMORY[0x1E695DFF8] URLWithString:v11];
    if (v21)
    {
      [*MEMORY[0x1E69DDA98] openURL:v21 withCompletionHandler:0];
    }

    if (IMOSLoggingEnabled())
    {
      v22 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        v28 = 138412290;
        v29 = v11;
        _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "presenting browser or app store for URL: %@", &v28, 0xCu);
      }
    }
  }

  else if (v12)
  {
    v26 = +[CKBalloonPluginManager sharedInstance];
    v27 = [v26 pluginForIdentifier:v13];

    if (v27)
    {
      [(CKChatController *)self _presentBrowserForPlugin:v27];
    }
  }
}

- (void)presentAppStoreForURL:(id)a3 fromSourceApplication:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [(CKCoreChatController *)self inputController];
  [v8 presentAppStoreForURL:v7 fromSourceApplication:v6];
}

- (void)_updateForNewPreferredService
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 _updateForNewPreferredService];
  v3 = [(CKChatController *)self effectPickerViewController];
  v4 = [(CKCoreChatController *)self conversation];
  [v3 updateColor:{objc_msgSend(v4, "sendButtonColor")}];

  [(CKChatController *)self _updateEntryViewPasteConfiguration];
  [(CKChatController *)self refreshMacToolbar];
}

- (void)_willSendComposition:(id)a3 inConversation:(id)a4
{
  v6 = a3;
  v22.receiver = self;
  v22.super_class = CKChatController;
  [(CKCoreChatController *)&v22 _willSendComposition:v6 inConversation:a4];
  v7 = [v6 shelfPluginPayload];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = [v7 shouldSendAsMediaObject];
  }

  else
  {
    v8 = 0;
  }

  v9 = [v7 pluginBundleID];
  if ([v9 length])
  {
    v10 = [v7 pluginBundleID];
    if ([v10 rangeOfString:*MEMORY[0x1E69A69F0]] == 0x7FFFFFFFFFFFFFFFLL)
    {
      v11 = [v7 pluginBundleID];
      v12 = [v11 rangeOfString:*MEMORY[0x1E69A6A18]];

      if (v12 == 0x7FFFFFFFFFFFFFFFLL)
      {
        if (!v8)
        {
          goto LABEL_19;
        }

        goto LABEL_13;
      }
    }

    else
    {
    }

    if ((v8 & 1) == 0)
    {
      v13 = [v6 shelfPluginPayload];
      [(CKChatController *)self setExtensionPayloadBeingSent:v13];
LABEL_18:

      goto LABEL_19;
    }

LABEL_13:
    v13 = v7;
    v14 = [v13 mediaObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      v16 = [v13 mediaObject];
      v17 = [v16 sticker];

      if (v17)
      {
        v18 = [v16 sticker];
        [CKChatController donateStickerToRecents:v18];
      }
    }

    goto LABEL_18;
  }

  if (v8)
  {
    goto LABEL_13;
  }

LABEL_19:
  v19 = [(CKChatController *)self entryView];
  v20 = [v19 contentView];
  v21 = [v20 pluginEntryViewController];

  if (objc_opt_respondsToSelector())
  {
    [v21 payloadWillSend];
  }
}

- (void)_didSendCompositionInConversation:(id)a3
{
  v22 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v19.receiver = self;
  v19.super_class = CKChatController;
  [(CKCoreChatController *)&v19 _didSendCompositionInConversation:v4];
  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v6 = [v5 isExpressiveTextEnabled];

  if (v6)
  {
    v7 = [(CKChatController *)self entryView];
    v8 = [v7 contentView];
    v9 = [v8 textView];

    [v9 hideTextEffectsPickerIfNeededAndResetTypingAttributes];
  }

  v10 = [(CKChatController *)self extensionPayloadBeingSent];
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v21 = v10;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "_didSendCompositionInConversation: %@", buf, 0xCu);
    }
  }

  if (v10)
  {
    [(CKChatController *)self setExtensionPayloadBeingSent:0];
    v12 = +[CKBalloonPluginManager sharedInstance];
    v13 = [v10 pluginBundleID];
    v14 = [v12 viewControllerForPluginIdentifier:v13];

    if (objc_opt_respondsToSelector())
    {
      v15 = [v4 senderIdentifier];
      [v14 setSender:v15];
    }

    if (objc_opt_respondsToSelector())
    {
      v16 = [(CKCoreChatController *)self conversation];
      v17 = [v16 recipientStrings];

      [v14 setRecipients:v17];
    }

    if (objc_opt_respondsToSelector())
    {
      [v14 didStartSendingPluginPayload:v10];
    }

    v18 = [v14 balloonPluginDataSource];
    [v18 payloadWillSendFromShelf];
  }

  [(CKChatController *)self setSendingCompositionBackgroundTask:*MEMORY[0x1E69DDBE8]];
}

- (void)sendSelectedSuggestedReply:(id)a3 messageGUID:(id)a4
{
  v11 = a4;
  v6 = a3;
  v7 = [_CKSuggestedReplyComposition alloc];
  v8 = [v6 suggestedReplyBody];

  v9 = [(CKComposition *)v7 initWithText:v8 subject:0];
  if (v11)
  {
    v10 = [(CKCoreChatController *)self chat];
    [v10 markRepliedForMessageGUID:v11];
  }

  [(CKChatController *)self sendCompositionIfAllowed:v9];
}

- (void)stageSelectedSuggestedReply:(id)a3
{
  v16[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 suggestion];
  v6 = [v5 displayText];

  v7 = CKFrameworkBundle();
  v8 = [v7 localizedStringForKey:@"SELECTED_OPTION" value:&stru_1F04268F8 table:@"ChatKit"];

  v15 = @"suggestedReplyBody";
  v9 = [v4 suggestedReplyBody];

  v16[0] = v9;
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v16 forKeys:&v15 count:1];
  v11 = [_TtC7ChatKit25CKSuggestedActionsHandler pluginPayloadForShelfCardWithTitle:v6 summary:v8 userInfo:v10];

  v12 = [[CKComposition alloc] initWithText:0 subject:0 shelfPluginPayload:v11];
  v13 = [(CKChatController *)self composition];
  v14 = [v13 compositionByAppendingComposition:v12];
  [(CKChatController *)self setComposition:v14];
}

- (void)_showCatchUpButtonIfNeededResumingFromBackground:(BOOL)a3
{
  v3 = a3;
  if (CKIsCatchUpEnabled())
  {
    if ([(CKChatController *)self _wantsCatchUpAffordance])
    {
      v5 = [(CKChatController *)self catchUpButton];

      if (!v5)
      {
        objc_initWeak(&location, self);
        aBlock[0] = MEMORY[0x1E69E9820];
        aBlock[1] = 3221225472;
        aBlock[2] = __69__CKChatController__showCatchUpButtonIfNeededResumingFromBackground___block_invoke;
        aBlock[3] = &unk_1E72EC460;
        objc_copyWeak(&v39, &location);
        v6 = _Block_copy(aBlock);
        v7 = [[_TtC7ChatKit22CKCatchUpButtonManager alloc] initWithDidTapButton:v6];
        [(CKChatController *)self setCatchUpButtonManager:v7];
        v37 = v6;
        v8 = [(CKCatchUpButtonManager *)v7 catchUpButtonHost];
        v9 = [v8 view];
        [(CKChatController *)self setCatchUpButton:v9];

        [(CKChatController *)self addChildViewController:v8];
        v10 = [(CKChatController *)self view];
        v11 = [(CKChatController *)self catchUpButton];
        [v10 addSubview:v11];

        [v8 didMoveToParentViewController:self];
        v12 = [(CKChatController *)self catchUpButton];
        [v12 setTranslatesAutoresizingMaskIntoConstraints:0];

        v13 = [(CKChatController *)self catchUpButton];
        v14 = [v13 leadingAnchor];
        v15 = [(CKChatController *)self view];
        v16 = [v15 leadingAnchor];
        v17 = [v14 constraintEqualToAnchor:v16];
        [v17 setActive:1];

        v18 = [(CKChatController *)self catchUpButton];
        v19 = [v18 trailingAnchor];
        v20 = [(CKChatController *)self view];
        v21 = [v20 trailingAnchor];
        v22 = [v19 constraintEqualToAnchor:v21];
        [v22 setActive:1];

        v23 = [(CKChatController *)self catchUpButton];
        v24 = [v23 topAnchor];
        v25 = [(CKChatController *)self view];
        v26 = [v25 safeAreaLayoutGuide];
        v27 = [v26 topAnchor];
        v28 = [v24 constraintEqualToAnchor:v27 constant:0.0];
        [(CKChatController *)self setCatchUpButtonTopConstraint:v28];

        v29 = [(CKChatController *)self catchUpButtonTopConstraint];
        [v29 setActive:1];

        objc_destroyWeak(&v39);
        objc_destroyWeak(&location);
      }

      [(CKChatController *)self _currentlyVisibleBannerHeight];
      v31 = v30;
      v32 = [(CKChatController *)self catchUpButtonTopConstraint];
      [v32 setConstant:v31];

      v33 = [(CKChatController *)self catchUpButton];
      [v33 setNeedsUpdateConstraints];

      v34 = [(CKChatController *)self view];
      v35 = [(CKChatController *)self catchUpButton];
      [v34 bringSubviewToFront:v35];

      v36 = [(CKChatController *)self catchUpButtonManager];
      [v36 animateInResumingFromBackground:v3];
    }

    else
    {

      [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:1];
    }
  }
}

void __69__CKChatController__showCatchUpButtonIfNeededResumingFromBackground___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _catchUpButtonTapped];
}

- (void)_hideCatchUpButtonIfNeededAndRemoveOnCompletion:(BOOL)a3
{
  v3 = a3;
  v5 = [(CKChatController *)self catchUpButton];

  if (v5)
  {
    if (v3)
    {
      objc_initWeak(&location, self);
      aBlock[0] = MEMORY[0x1E69E9820];
      aBlock[1] = 3221225472;
      aBlock[2] = __68__CKChatController__hideCatchUpButtonIfNeededAndRemoveOnCompletion___block_invoke;
      aBlock[3] = &unk_1E72EC460;
      objc_copyWeak(&v10, &location);
      v6 = _Block_copy(aBlock);
      v7 = [(CKChatController *)self catchUpButtonManager];
      [v7 animateOutWithCompletion:v6];

      objc_destroyWeak(&v10);
      objc_destroyWeak(&location);
    }

    else
    {
      v8 = [(CKChatController *)self catchUpButtonManager];
      [v8 animateOutWithCompletion:0];
    }
  }

  else
  {
    [(CKChatController *)self setIndexPathForFirstUnreadMessage:0];

    [(CKChatController *)self setFirstUnreadMessageGUID:0];
  }
}

void __68__CKChatController__hideCatchUpButtonIfNeededAndRemoveOnCompletion___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained catchUpButtonManager];
  v10 = [v3 catchUpButtonHost];

  [v10 willMoveToParentViewController:0];
  v4 = [v10 view];
  [v4 removeFromSuperview];

  [v10 removeFromParentViewController];
  v5 = objc_loadWeakRetained((a1 + 32));
  [v5 setCatchUpButton:0];

  v6 = objc_loadWeakRetained((a1 + 32));
  [v6 setCatchUpButtonManager:0];

  v7 = objc_loadWeakRetained((a1 + 32));
  [v7 setIsCatchUpButtonNeededOnFirstLoad:0];

  v8 = objc_loadWeakRetained((a1 + 32));
  [v8 setIndexPathForFirstUnreadMessage:0];

  v9 = objc_loadWeakRetained((a1 + 32));
  [v9 setFirstUnreadMessageGUID:0];
}

- (double)_currentlyVisibleBannerHeight
{
  v3 = [(CKChatController *)self suggestionBannerView];

  if (v3)
  {
    v4 = [(CKChatController *)self suggestionBannerView];
    [v4 frame];
    v6 = v5;

    v7 = fmax(v6, 0.0);
  }

  else
  {
    v7 = 0.0;
  }

  v8 = [(CKChatController *)self nicknameBanner];

  if (v8)
  {
    v9 = [(CKChatController *)self nicknameBanner];
    [v9 frame];
    v11 = v10;

    if (v7 < v11)
    {
      v7 = v11;
    }
  }

  v12 = [(CKChatController *)self groupPhotoUpdateBanner];

  if (v12)
  {
    v13 = [(CKChatController *)self groupPhotoUpdateBanner];
    [v13 frame];
    v15 = v14;

    if (v7 < v15)
    {
      v7 = v15;
    }
  }

  v16 = [(CKChatController *)self acceptedContactBanner];

  if (v16)
  {
    v17 = [(CKChatController *)self acceptedContactBanner];
    [v17 frame];
    v19 = v18;

    if (v7 < v19)
    {
      return v19;
    }
  }

  return v7;
}

- (void)handleContentSizeCategoryDidChangeNotification:(id)a3
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 handleContentSizeCategoryDidChangeNotification:a3];
  [(CKChatController *)self _showCatchUpButtonIfNeeded];
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 setNeedsChatItemLayoutInvalidation];
}

- (void)_catchUpButtonTapped
{
  v12 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v12 collectionView];
  [v3 setTranscriptScrollIntent:2];
  v4 = [CKTranscriptHighlightedMessageScrollContext alloc];
  v5 = [(CKChatController *)self firstUnreadMessageGUID];
  v6 = [(CKTranscriptHighlightedMessageScrollContext *)v4 initWithMessageGUID:v5 messagePartIndex:0x7FFFFFFFFFFFFFFFLL viewToAlignWith:0 allowOverScroll:0 scrollPosition:1];
  [v3 setHighlightedMessageScrollContext:v6];

  [v3 beginDisablingTranscriptDynamicsForReason:14];
  [(CKChatController *)self contentOffsetForFirstUnreadMessage];
  v8 = v7;
  v10 = v9;
  if (_catchUpDecelerationAnimation_onceToken != -1)
  {
    [CKChatController _catchUpButtonTapped];
  }

  [v3 _setContentOffset:1 animated:1 animationCurve:0 animationAdjustsForContentOffsetDelta:_catchUpDecelerationAnimation_spring animation:{v8, v10}];
  [v3 endDisablingTranscriptDynamicsForReason:14];
  v11 = [(CKCoreChatController *)self collectionViewController];
  [v11 highlightItemAtIndexPathWhenDisplayed:self->_indexPathForFirstUnreadMessage animated:1 autoDismiss:1];

  [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:1];
}

- (void)_updateIndexPathForFirstUnreadMessage
{
  v21 = *MEMORY[0x1E69E9840];
  if (CKIsCatchUpEnabled())
  {
    v3 = [(CKChatController *)self firstUnreadMessageGUID];

    if (!v3)
    {
      v4 = [(CKCoreChatController *)self chat];
      v5 = [v4 firstUnreadMessageItem];

      v6 = [v5 guid];
      [(CKChatController *)self setFirstUnreadMessageGUID:v6];
    }

    v7 = [(CKChatController *)self firstUnreadMessageGUID];
    if (v7)
    {
      if (IMOSLoggingEnabled())
      {
        v8 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
        {
          v17 = 138412290;
          v18 = v7;
          _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Determined first unread message GUID %@", &v17, 0xCu);
        }
      }

      v9 = [(CKCoreChatController *)self collectionViewController];
      v10 = [v9 chatItems];
      v11 = [v10 __ck_catchUpScrollTargetForMessageGUID:v7];
      v13 = v12;

      if (v11 != 0x7FFFFFFFFFFFFFFFLL)
      {
        v14 = [MEMORY[0x1E696AC88] indexPathForItem:v13 inSection:0];
        v15 = [MEMORY[0x1E696AC88] indexPathForItem:v11 inSection:0];
        if (v14)
        {
          [(CKCoreChatController *)self contentOffsetForIndexPath:v14 viewToAlignWith:0 allowOverScroll:0 scrollPosition:1];
          [(CKChatController *)self setContentOffsetForFirstUnreadMessage:?];
        }

        if (v15)
        {
          [(CKChatController *)self setIndexPathForFirstUnreadMessage:v15];
        }

        if (IMOSLoggingEnabled())
        {
          v16 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
          {
            v17 = 138412546;
            v18 = v14;
            v19 = 2112;
            v20 = v15;
            _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Determined index path for first unread message: scrollTarget(%@) and highlightTarget(%@)", &v17, 0x16u);
          }
        }
      }
    }
  }
}

- (void)_updateCatchUpButtonVisibilityResumingFromBackground:(BOOL)a3
{
  v3 = a3;
  v66 = *MEMORY[0x1E69E9840];
  if (CKIsCatchUpEnabled() && ![(CKChatController *)self didComputeInitiallyVisibleIndexPaths])
  {
    v47 = v3;
    v52 = [(CKChatController *)self collectionView];
    [v52 bounds];
    v6 = v5;
    v8 = v7;
    v10 = v9;
    obja = v11;
    [(CKScrollViewController *)self computedInsets];
    v13 = v12;
    v15 = v14;
    v17 = v16;
    v19 = v18;
    [(CKChatController *)self _currentlyVisibleBannerHeight];
    v21 = v20;
    v50 = [v52 collectionViewLayout];
    v49 = [v50 layoutAttributesForElementsInRect:{v6 + v15, v8 + v13 + v21, v10 - (v15 + v19), *&obja - (v17 + v13 + v21)}];
    [(CKChatController *)self setDidComputeInitiallyVisibleIndexPaths:1];
    [(CKChatController *)self _updateIndexPathForFirstUnreadMessage];
    v51 = [(CKChatController *)self indexPathForFirstUnreadMessage];
    if (v51)
    {
      v22 = [v52 numberOfItemsInSection:0];
      if ([v51 item] <= v22)
      {
        [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:1];
        v25 = objc_alloc_init(MEMORY[0x1E695DF70]);
        v59 = 0u;
        v60 = 0u;
        v61 = 0u;
        v62 = 0u;
        v26 = v49;
        v27 = 0;
        v28 = [v26 countByEnumeratingWithState:&v59 objects:v65 count:16];
        if (v28)
        {
          v29 = *v60;
          do
          {
            for (i = 0; i != v28; ++i)
            {
              if (*v60 != v29)
              {
                objc_enumerationMutation(v26);
              }

              v31 = *(*(&v59 + 1) + 8 * i);
              v32 = [v31 indexPath];
              [v25 addObject:v32];

              v33 = [(CKChatController *)self indexPathForFirstUnreadMessage];
              v34 = [v31 indexPath];
              LOBYTE(v32) = [v33 isEqual:v34];

              v27 |= v32;
            }

            v28 = [v26 countByEnumeratingWithState:&v59 objects:v65 count:16];
          }

          while (v28);
        }

        v35 = [(CKCoreChatController *)self collectionViewController];
        v48 = [v35 chatItems];

        v36 = [v25 count];
        if ([v48 count] <= v36)
        {
          v37 = v48;
        }

        else
        {
          v37 = [v48 subarrayWithRange:{objc_msgSend(v48, "count") - v36, v36}];
        }

        v57 = 0u;
        v58 = 0u;
        v55 = 0u;
        v56 = 0u;
        obj = v37;
        v38 = [obj countByEnumeratingWithState:&v55 objects:v64 count:16];
        if (v38)
        {
          v39 = *v56;
          while (2)
          {
            for (j = 0; j != v38; ++j)
            {
              if (*v56 != v39)
              {
                objc_enumerationMutation(obj);
              }

              v41 = *(*(&v55 + 1) + 8 * j);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v42 = [v41 message];
                if ([v42 isFromMe])
                {
                  if (IMOSLoggingEnabled())
                  {
                    v46 = OSLogHandleForIMFoundationCategory();
                    if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
                    {
                      *buf = 0;
                      _os_log_impl(&dword_19020E000, v46, OS_LOG_TYPE_INFO, "A message that I sent is visible on screen. Do not show catch up button.", buf, 2u);
                    }

LABEL_42:
                  }

LABEL_43:
                  [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:0];

                  goto LABEL_44;
                }

                if (v27)
                {
                  v43 = [v42 guid];
                  v44 = [(CKChatController *)self firstUnreadMessageGUID];
                  v45 = [v43 isEqualToString:v44];

                  if (v45)
                  {
                    if (IMOSLoggingEnabled())
                    {
                      v46 = OSLogHandleForIMFoundationCategory();
                      if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
                      {
                        *buf = 0;
                        _os_log_impl(&dword_19020E000, v46, OS_LOG_TYPE_INFO, "First unread message is visible on screen. Do not show catch up button.", buf, 2u);
                      }

                      goto LABEL_42;
                    }

                    goto LABEL_43;
                  }
                }
              }
            }

            v38 = [obj countByEnumeratingWithState:&v55 objects:v64 count:16];
            if (v38)
            {
              continue;
            }

            break;
          }
        }

LABEL_44:

        [(CKChatController *)self _showCatchUpButtonIfNeededResumingFromBackground:v47];
      }

      else
      {
        [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:0];
        v23 = IMLogHandleForCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
        {
          [CKChatController _updateCatchUpButtonVisibilityResumingFromBackground:v51];
        }
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v24 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
      }
    }
  }
}

- (BOOL)_wantsCatchUpAffordance
{
  v3 = CKIsCatchUpEnabled();
  if (v3)
  {
    v4 = [(CKChatController *)self tipManager];
    v5 = [v4 presentingTopAlignedTip];

    if (v5)
    {
      goto LABEL_3;
    }

    v6 = [(CKChatController *)self catchUpButton];

    if (v6)
    {
      LOBYTE(v3) = 1;
      return v3;
    }

    v7 = [(CKChatController *)self indexPathForFirstUnreadMessage];

    if (!v7)
    {
LABEL_3:
      LOBYTE(v3) = 0;
    }

    else
    {

      LOBYTE(v3) = [(CKChatController *)self isCatchUpButtonNeededOnFirstLoad];
    }
  }

  return v3;
}

- (BOOL)isSafeToMarkAsRead
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 chat];

  if (v4 && ![v4 allowedByScreenTime])
  {
    v7 = 0;
  }

  else
  {
    v9.receiver = self;
    v9.super_class = CKChatController;
    v5 = [(CKCoreChatController *)&v9 isSafeToMarkAsRead];
    if (+[CKStarkManager isCarPlayConnected])
    {
      v6 = !CKIsScreenLocked();
    }

    else
    {
      LOBYTE(v6) = 1;
    }

    v7 = v5 & v6;
  }

  return v7;
}

- (void)_markAsReadIfNecessary
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 _markAsReadIfNecessary];
  if ([(CKChatController *)self isSafeToMarkAsRead])
  {
    if (![(CKChatController *)self _shouldShowReadReceiptAlert])
    {
      if (CKIsRunningUnitTests())
      {
        [(CKChatController *)self _askToTurnOnSMSRelayIfNeeded];
      }

      else
      {
        [(CKChatController *)self performSelector:sel__askToTurnOnSMSRelayIfNeeded withObject:0 afterDelay:2.0];
      }
    }

    v3 = [(CKChatController *)self catchUpButton];

    if (v3)
    {
      [(CKChatController *)self _updateIndexPathForFirstUnreadMessage];
    }

    [(CKChatController *)self _askToTurnOnReadReceiptsIfNeeded];
  }
}

- (void)_markVisibleMentionsAsRead
{
  v34 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E695DF70] array];
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 chatItems];

  if ([v5 count])
  {
    v6 = [(CKChatController *)self collectionView];
    v7 = [v6 indexPathsForVisibleItems];

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v8 = v7;
    v9 = [v8 countByEnumeratingWithState:&v28 objects:v33 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      do
      {
        v12 = 0;
        do
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(v8);
          }

          v13 = [*(*(&v28 + 1) + 8 * v12) item];
          if (v13 < [v5 count])
          {
            v14 = [v5 objectAtIndex:v13];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v15 = [v14 message];
              if ([v15 hasMention])
              {
                [v3 addObject:v15];
              }
            }
          }

          ++v12;
        }

        while (v10 != v12);
        v10 = [v8 countByEnumeratingWithState:&v28 objects:v33 count:16];
      }

      while (v10);
    }
  }

  v26 = 0u;
  v27 = 0u;
  v24 = 0u;
  v25 = 0u;
  v16 = v3;
  v17 = [v16 countByEnumeratingWithState:&v24 objects:v32 count:16];
  if (v17)
  {
    v18 = v17;
    v19 = *v25;
    do
    {
      v20 = 0;
      do
      {
        if (*v25 != v19)
        {
          objc_enumerationMutation(v16);
        }

        v21 = *(*(&v24 + 1) + 8 * v20);
        v22 = [(CKCoreChatController *)self chat];
        v23 = [v21 guid];
        [v22 removeMentionMessageGUID:v23];

        ++v20;
      }

      while (v18 != v20);
      v18 = [v16 countByEnumeratingWithState:&v24 objects:v32 count:16];
    }

    while (v18);
  }
}

- (void)_retryGroupPhotoUploadIfNecessary
{
  v2 = [(CKCoreChatController *)self chat];
  [v2 retryGroupPhotoUploadIfNecessary];
}

- (CGRect)salientTranscriptBackgroundRect
{
  v30.receiver = self;
  v30.super_class = CKChatController;
  [(CKCoreChatController *)&v30 salientTranscriptBackgroundRect];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v10 = v9;
  if ([(CKScrollViewController *)self isKeyboardVisible])
  {
    v11 = [(CKChatController *)self collectionView];
    [v11 adjustedContentInset];
    v13 = v12;
    v15 = v14;
  }

  else
  {
    [(CKScrollViewController *)self computedInsets];
    v13 = v16;
    v15 = v17;
  }

  v18 = v10 + v13;
  v19 = v8 - v18;
  v20 = +[CKUIBehavior sharedBehaviors];
  v21 = [v20 entryViewlayoutMetrics];
  [v21 defaultEntryViewHeight];
  v23 = v22;

  v24 = [(CKChatController *)self entryView];
  [v24 bounds];
  v25 = v19 - (v23 + v15 - CGRectGetHeight(v31));

  v26 = v4;
  v27 = v18;
  v28 = v6;
  v29 = v25;
  result.size.height = v29;
  result.size.width = v28;
  result.origin.y = v27;
  result.origin.x = v26;
  return result;
}

- (void)_retryTranscriptBackgroundUploadIfNecessary
{
  v3 = [(CKCoreChatController *)self conversation];
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __63__CKChatController__retryTranscriptBackgroundUploadIfNecessary__block_invoke;
  v4[3] = &unk_1E72EB9C8;
  v4[4] = self;
  [v3 generateMissingWatchAssetIfNecessaryWithCompletion:v4];
}

void __63__CKChatController__retryTranscriptBackgroundUploadIfNecessary__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) chat];
  [v1 retryTranscriptBackgroundUploadIfNecessary];
}

- (BOOL)_shouldShowReadReceiptAlert
{
  v34 = *MEMORY[0x1E69E9840];
  v2 = [(CKCoreChatController *)self conversation];
  v3 = [v2 chat];
  v4 = [v3 lastIncomingMessage];

  v5 = CKReadReceiptSettingsConfirmed();
  v6 = CKReadReceiptsEnabled();
  v7 = [v4 __ck_service];
  v8 = [v7 supportsCapability:*MEMORY[0x1E69A7A08]];

  v9 = [v4 isRead];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  v10 = [MEMORY[0x1E69A5A80] sharedInstance];
  v11 = [v4 __ck_service];
  v12 = [v10 accountsForService:v11];

  v13 = [v12 countByEnumeratingWithState:&v19 objects:v33 count:16];
  if (v13)
  {
    v14 = *v20;
    while (2)
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v20 != v14)
        {
          objc_enumerationMutation(v12);
        }

        if ([*(*(&v19 + 1) + 8 * i) _isUsableForSending])
        {
          LODWORD(v13) = 1;
          goto LABEL_11;
        }
      }

      v13 = [v12 countByEnumeratingWithState:&v19 objects:v33 count:16];
      if (v13)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v16 = v9 ^ 1;
  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      *buf = 67110144;
      v24 = v13;
      v25 = 1024;
      v26 = !v5;
      v27 = 1024;
      v28 = !v6;
      v29 = 1024;
      v30 = v8;
      v31 = 1024;
      v32 = v16;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "lastMessageServiceIsActive: %{BOOL}d, readReceiptSettingsNotConfirmed: %{BOOL}d, readReceiptSettingsNotEnabled: %{BOOL}d, lastSupportsReadReceipts: %{BOOL}d, lastMessageNotRead: %{BOOL}d", buf, 0x20u);
    }
  }

  return ((v13 ^ 1 | (v5 || v6)) ^ 1) & v8 & v16 & 1;
}

- (void)_askToTurnOnReadReceiptsIfNeeded
{
  if ([(CKChatController *)self _shouldShowReadReceiptAlert])
  {
    CKSetReadReceiptSettingsConfirmed(1);
    if (CKIsRunningUnitTests())
    {

      [(CKChatController *)self _confirmReadReceiptSettings];
    }

    else
    {
      [MEMORY[0x1E69E58C0] cancelPreviousPerformRequestsWithTarget:self selector:sel__confirmReadReceiptSettings object:0];

      [(CKChatController *)self performSelector:sel__confirmReadReceiptSettings withObject:0 afterDelay:2.0];
    }
  }
}

- (void)_confirmReadReceiptSettings
{
  v3 = CKFrameworkBundle();
  v4 = [v3 localizedStringForKey:@"READ_RECEIPTS_SETTINGS_CONFIRM_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"READ_RECEIPTS_SETTINGS_CONFIRM_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
  v7 = [CKAlertController alertControllerWithTitle:v4 message:v6 preferredStyle:1];

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __47__CKChatController__confirmReadReceiptSettings__block_invoke;
  aBlock[3] = &unk_1E72EBA18;
  aBlock[4] = self;
  v8 = _Block_copy(aBlock);
  v9 = CKFrameworkBundle();
  v10 = [v9 localizedStringForKey:@"NOT_NOW" value:&stru_1F04268F8 table:@"ChatKit"];
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __47__CKChatController__confirmReadReceiptSettings__block_invoke_2;
  v19[3] = &unk_1E72EC218;
  v11 = v8;
  v20 = v11;
  v12 = [CKAlertAction actionWithTitle:v10 style:1 handler:v19];
  [v7 addAction:v12];

  v13 = CKFrameworkBundle();
  v14 = [v13 localizedStringForKey:@"ALLOW" value:&stru_1F04268F8 table:@"ChatKit"];
  v17[0] = MEMORY[0x1E69E9820];
  v17[1] = 3221225472;
  v17[2] = __47__CKChatController__confirmReadReceiptSettings__block_invoke_3;
  v17[3] = &unk_1E72EC218;
  v18 = v11;
  v15 = v11;
  v16 = [CKAlertAction actionWithTitle:v14 style:0 handler:v17];
  [v7 addAction:v16];

  [v7 presentFromViewController:self animated:1 completion:0];
}

void __47__CKChatController__confirmReadReceiptSettings__block_invoke(uint64_t a1)
{
  [*(a1 + 32) _askToTurnOnReadReceiptsIfNeeded];
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 canPresentOverKeyboard];

  if ((v3 & 1) == 0)
  {
    v4 = *(a1 + 32);

    [v4 becomeFirstResponder];
  }
}

uint64_t __47__CKChatController__confirmReadReceiptSettings__block_invoke_3(uint64_t a1)
{
  CKSetReadReceiptsEnabled(1);
  v2 = *(*(a1 + 32) + 16);

  return v2();
}

- (void)_askToTurnOnSMSRelayIfNeeded
{
  v3 = [MEMORY[0x1E69A5CA0] smsService];
  v4 = IMPreferredAccountForService();

  v5 = [MEMORY[0x1E699BE70] sharedInstance];
  v6 = [v5 supportsMMS];

  if ((CKSMSRelaySettingsConfirmed() & 1) == 0)
  {
    v7 = [(CKCoreChatController *)self conversation];
    if (v6 & 1 | (([v7 eligibleToSendWithMadrid] & 1) == 0) || (objc_msgSend(v4, "isSMSRelayCapable") & 1) == 0)
    {
    }

    else
    {
      v8 = [v4 allowsSMSRelay];

      if ((v8 & 1) == 0)
      {
        [MEMORY[0x1E69E58C0] cancelPreviousPerformRequestsWithTarget:self selector:sel__askToTurnOnSMSRelayIfNeeded object:0];
        CKSetSMSRelaySettingsConfirmed(1);
        v9 = +[CKUIBehavior sharedBehaviors];
        v31 = [v9 canPresentOverKeyboard];

        if (CKIsRunningInMacCatalyst())
        {
          v10 = CKFrameworkBundle();
          v11 = [v10 localizedStringForKey:@"SMS_RELAY_ALERT_TITLE_MAC" value:&stru_1F04268F8 table:@"ChatKit"];
        }

        else
        {
          v12 = MEMORY[0x1E696AEC0];
          v13 = CKFrameworkBundle();
          v14 = [v13 localizedStringForKey:@"SMS_RELAY_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          v15 = [MEMORY[0x1E69DC938] currentDevice];
          v16 = [v15 localizedModel];
          v10 = [v12 stringWithFormat:v14, v16];

          v17 = [MEMORY[0x1E69DC668] sharedApplication];
          v18 = [v17 userInterfaceLayoutDirection];

          if (v18 == 1)
          {
            v19 = @"\u200F";
          }

          else
          {
            v19 = @"\u200E";
          }

          v11 = [(__CFString *)v19 stringByAppendingString:v10];
        }

        v20 = v11;

        v21 = CKFrameworkBundle();
        v22 = [v21 localizedStringForKey:@"SMS_RELAY_ALERT_BODY" value:&stru_1F04268F8 table:@"ChatKit"];

        v30 = v22;
        v23 = [CKAlertController alertControllerWithTitle:v20 message:v22 preferredStyle:1];
        v24 = CKFrameworkBundle();
        v25 = [v24 localizedStringForKey:@"SMS_RELAY_NOT_NOW" value:&stru_1F04268F8 table:@"ChatKit"];
        v36[0] = MEMORY[0x1E69E9820];
        v36[1] = 3221225472;
        v36[2] = __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke;
        v36[3] = &unk_1E72ED728;
        v37 = v31;
        v36[4] = self;
        v26 = [CKAlertAction actionWithTitle:v25 style:0 handler:v36];
        [v23 addAction:v26];

        v27 = CKFrameworkBundle();
        v28 = [v27 localizedStringForKey:@"SMS_RELAY_TURN_ON" value:&stru_1F04268F8 table:@"ChatKit"];
        v32[0] = MEMORY[0x1E69E9820];
        v32[1] = 3221225472;
        v32[2] = __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke_2;
        v32[3] = &unk_1E72ED750;
        v35 = v31;
        v33 = v4;
        v34 = self;
        v29 = [CKAlertAction actionWithTitle:v28 style:0 handler:v32];
        [v23 addAction:v29];

        if ((v31 & 1) == 0)
        {
          [(CKChatController *)self setTargetFirstResponder:0];
          [(CKChatController *)self becomeFirstResponder];
        }

        [v23 presentFromViewController:self animated:1 completion:0];
      }
    }
  }
}

uint64_t __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke(uint64_t result)
{
  if ((*(result + 40) & 1) == 0)
  {
    return [*(result + 32) becomeFirstResponder];
  }

  return result;
}

uint64_t __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke_2(uint64_t a1)
{
  result = [*(a1 + 32) enrollSelfDeviceInSMSRelay];
  if ((*(a1 + 48) & 1) == 0)
  {
    v3 = *(a1 + 40);

    return [v3 becomeFirstResponder];
  }

  return result;
}

- (void)keyboardWillShow:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self view];
  v6 = [v5 window];
  if (v6)
  {
    v7 = v6;
    v8 = [(CKChatController *)self view];
    v9 = [v8 window];
    v10 = [MEMORY[0x1E69DC668] sharedApplication];
    v11 = [v10 keyWindow];

    if (v9 != v11)
    {
      goto LABEL_12;
    }
  }

  else
  {
  }

  v12 = [(CKChatController *)self pickerContainerAccessoryView];

  if (!v12)
  {
    v13 = [(CKChatController *)self collectionView];
    v30.receiver = self;
    v30.super_class = CKChatController;
    [(CKScrollViewController *)&v30 keyboardWillShow:v4];
    v14 = [(CKChatController *)self entryView];
    [v14 setKeyboardVisible:1];

    if (![(CKChatController *)self suppressEntryViewKeyboardNotifications])
    {
      v15 = [v4 userInfo];
      v16 = [v15 objectForKeyedSubscript:*MEMORY[0x1E69DDFA0]];
      [v16 CGRectValue];
      v18 = v17;

      v19 = [(CKChatController *)self entryView];
      [v19 frame];
      v21 = v20;

      if (v18 > v21)
      {
        v22 = [(CKChatController *)self presentedViewController];
        if (v22)
        {
          v23 = v22;
          v24 = [(CKChatController *)self entryView];
          v25 = [v24 contentView];
          v26 = [v25 textView];
          v27 = [v26 isFirstResponder];

          if (v27)
          {
            v28 = +[CKScrollViewAnimationProperties inheritedAnimation];
            [v13 enforceTranscriptScrollIntentWithAnimationProperties:v28];
          }
        }
      }
    }

    [v13 beginDisablingTranscriptDynamicsForReason:2];
    [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:v4];
    v29 = [(CKCoreChatController *)self inputController];
    [v29 chatControllerReceivedKeyboardWillShowNotification:v4];
    [(CKChatController *)self _inheritHiddenKeyboardAppearanceIfNeeded];
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:1];
  }

LABEL_12:
}

- (void)keyboardWillHide:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self view];
  v6 = [v5 window];
  v7 = [MEMORY[0x1E69DC668] sharedApplication];
  v8 = [v7 keyWindow];

  if (v6 == v8)
  {
    v11.receiver = self;
    v11.super_class = CKChatController;
    [(CKScrollViewController *)&v11 keyboardWillHide:v4];
    v9 = [(CKChatController *)self entryView];
    [v9 setKeyboardVisible:0];

    [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:v4];
    v10 = [(CKCoreChatController *)self inputController];
    [v10 chatControllerReceivedKeyboardWillHideNotification:v4];
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:1];
  }
}

- (void)keyboardDidShow:(id)a3
{
  v7.receiver = self;
  v7.super_class = CKChatController;
  v4 = a3;
  [(CKScrollViewController *)&v7 keyboardDidShow:v4];
  if ([(CKChatController *)self _appearState:v7.receiver]!= 3)
  {
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:0];
  }

  v5 = [(CKCoreChatController *)self inputController];
  [v5 chatControllerReceivedKeyboardDidShowNotification:v4];

  v6 = [(CKChatController *)self collectionView];
  [v6 endDisablingTranscriptDynamicsForReason:2];
}

- (void)keyboardDidHide:(id)a3
{
  v8.receiver = self;
  v8.super_class = CKChatController;
  v4 = a3;
  [(CKScrollViewController *)&v8 keyboardDidHide:v4];
  if ([(CKChatController *)self _appearState:v8.receiver]!= 3)
  {
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:0];
  }

  if ([(CKChatController *)self isShowingEmojiKeyboard])
  {
    v5 = [MEMORY[0x1E69DCBF0] sharedInputModeController];
    v6 = [(CKChatController *)self savedKeyboardInputMode];
    [v5 setCurrentInputMode:v6];
  }

  v7 = [(CKCoreChatController *)self inputController];
  [v7 chatControllerReceivedKeyboardDidHideNotification:v4];
}

- (void)keyboardDidChangeFrame:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self pickerContainerAccessoryView];

  if (!v5)
  {
    v6.receiver = self;
    v6.super_class = CKChatController;
    [(CKScrollViewController *)&v6 keyboardDidChangeFrame:v4];
    [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:v4];
  }
}

- (CGRect)screenFrameForNotification:(id)a3
{
  v4 = a3;
  if (CKIsAppCardsEnabled())
  {
    v5 = [(CKChatController *)self entryView];
    v6 = [v5 entryViewKeyboardLayoutGuide];

    v7 = [v6 owningView];
    [v6 layoutFrame];
    [v7 convertRect:0 toView:?];
    v9 = v8;
    v11 = v10;
    v13 = v12;
    v15 = v14;
  }

  else
  {
    v24.receiver = self;
    v24.super_class = CKChatController;
    [(CKScrollViewController *)&v24 screenFrameForNotification:v4];
    v9 = v16;
    v11 = v17;
    v13 = v18;
    v15 = v19;
  }

  v20 = v9;
  v21 = v11;
  v22 = v13;
  v23 = v15;
  result.size.height = v23;
  result.size.width = v22;
  result.origin.y = v21;
  result.origin.x = v20;
  return result;
}

- (void)contentInsetDidChangeWithAnimationProperties:(id)a3
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 contentInsetDidChangeWithAnimationProperties:a3];
  v4 = [(CKChatController *)self messageEditingViewController];
  [v4 transcriptContentInsetsDidChange];
}

- (BOOL)keyboardIsQuickPathing
{
  v2 = [MEMORY[0x1E69DCBE0] activeInstance];
  v3 = [v2 continuousPathUnderway];

  return v3;
}

- (void)keyboardWillChangeFrame:(id)a3
{
  [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:a3];

  [(CKChatController *)self updateEntryViewHeightAnimated:0];
}

- (UIEdgeInsets)bannerInsets
{
  v3 = [(CKChatController *)self nicknameBanner];

  if (v3)
  {
    v4 = [(CKChatController *)self nicknameBanner];
    [v4 bounds];
    v6 = v5;

    v7 = 0.0;
    v8 = 0.0;
    v9 = 0.0;
  }

  else
  {
    v6 = *MEMORY[0x1E69DDCE0];
    v7 = *(MEMORY[0x1E69DDCE0] + 8);
    v8 = *(MEMORY[0x1E69DDCE0] + 16);
    v9 = *(MEMORY[0x1E69DDCE0] + 24);
  }

  v10 = v6;
  result.right = v9;
  result.bottom = v8;
  result.left = v7;
  result.top = v10;
  return result;
}

- (UIEdgeInsets)additionalSafeAreaInsets
{
  v22.receiver = self;
  v22.super_class = CKChatController;
  [(CKChatController *)&v22 additionalSafeAreaInsets];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;
  if (CKIsRunningInMacCatalyst())
  {
    [(CKChatController *)self preferredMacToolbarHeight];
    v12 = v11;
    v13 = +[CKUIBehavior sharedBehaviors];
    [v13 macAppKitToolbarHeight];
    v15 = v14;

    if (v12 > v15)
    {
      v16 = +[CKUIBehavior sharedBehaviors];
      [v16 macAppKitToolbarHeight];
      v4 = v12 - v17;
    }
  }

  v18 = v4;
  v19 = v6;
  v20 = v8;
  v21 = v10;
  result.right = v21;
  result.bottom = v20;
  result.left = v19;
  result.top = v18;
  return result;
}

- (UIEdgeInsets)macToolbarInsets
{
  v3 = MEMORY[0x1E69DDCE0];
  v4 = *(MEMORY[0x1E69DDCE0] + 8);
  v5 = *(MEMORY[0x1E69DDCE0] + 16);
  v6 = *(MEMORY[0x1E69DDCE0] + 24);
  v7 = +[CKUIBehavior sharedBehaviors];
  v8 = [v7 useMacToolbar];

  if (v8)
  {
    [(CKChatController *)self preferredMacToolbarHeight];
    v10 = v9;
    v11 = +[CKUIBehavior sharedBehaviors];
    [v11 macAppKitToolbarHeight];
    if (v10 > v12)
    {
      [(CKChatController *)self preferredMacToolbarHeight];
      v15 = v16;
    }

    else
    {
      v13 = +[CKUIBehavior sharedBehaviors];
      [v13 macAppKitToolbarHeight];
      v15 = v14;
    }
  }

  else
  {
    v15 = *v3;
  }

  v17 = v15;
  v18 = v4;
  v19 = v5;
  v20 = v6;
  result.right = v20;
  result.bottom = v19;
  result.left = v18;
  result.top = v17;
  return result;
}

- (id)_animationPropertiesToUseForUpdateAfterHoldForReason:(id)a3
{
  v3 = a3;
  if ([v3 isEqualToString:@"ThrowAnimation"])
  {
    v4 = 0.3;
LABEL_5:
    v5 = [CKScrollViewAnimationProperties animatedWithDuration:0 animationCurve:v4];
    goto LABEL_10;
  }

  if ([v3 isEqualToString:@"MainTranscriptWhileInlineReplyControllerVisible"] || !objc_msgSend(v3, "isEqualToString:", @"ViewControllerNotVisible") && !objc_msgSend(v3, "isEqualToString:", @"NotificationChatControllerFixedLayout") && !objc_msgSend(v3, "isEqualToString:", @"InlineReplyAnimateOut") && !objc_msgSend(v3, "isEqualToString:", @"ViewControllerSizeTransition"))
  {
    v4 = 0.5;
    goto LABEL_5;
  }

  v5 = +[CKScrollViewAnimationProperties unanimated];
LABEL_10:
  v6 = v5;

  return v6;
}

- (id)_animationPropertiesToUseInUpdateForReasons:(id)a3 followingHoldForReason:(id)a4
{
  v22 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];

  if (v8)
  {
    v9 = [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v18 = 138412546;
      v19 = v9;
      v20 = 2112;
      v21 = v7;
      v11 = "Using active keyboard appearance animation properties %@ following hold for reason: %@";
LABEL_7:
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, v11, &v18, 0x16u);
      goto LABEL_8;
    }

    goto LABEL_8;
  }

  if (v7)
  {
    v9 = [(CKChatController *)self _animationPropertiesToUseForUpdateAfterHoldForReason:v7];
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v18 = 138412546;
      v19 = v9;
      v20 = 2112;
      v21 = v7;
      v11 = "Using animation properties %@ following hold for reason: %@";
      goto LABEL_7;
    }

LABEL_8:

    goto LABEL_9;
  }

  if ([v6 count] == 1)
  {
    v10 = [v6 anyObject];
    v9 = [v10 animationProperties];
    v13 = IMLogHandleForCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      v14 = [v10 reasonType];
      v18 = 138412546;
      v19 = v9;
      v20 = 2112;
      v21 = v14;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Using animation properties %@ following update for reasonType: %@", &v18, 0x16u);
    }

    goto LABEL_8;
  }

  v15 = [v6 count];
  v16 = IMLogHandleForCategory();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);
  if (v15 < 2)
  {
    if (v17)
    {
      [CKChatController _animationPropertiesToUseInUpdateForReasons:followingHoldForReason:];
    }
  }

  else if (v17)
  {
    [CKChatController _animationPropertiesToUseInUpdateForReasons:followingHoldForReason:];
  }

  v9 = +[CKScrollViewAnimationProperties unanimated];
LABEL_9:

  return v9;
}

- (void)scrollGeometryIsUpdatingForReasons:(id)a3 followingHoldForReason:(id)a4
{
  v6 = a4;
  v7 = a3;
  v10 = [(CKChatController *)self _animationPropertiesToUseInUpdateForReasons:v7 followingHoldForReason:v6];
  v8 = [(CKScrollViewController *)self scrollGeometryContentInsetIsUpdatingForReasons:v7 followingHoldForReason:v6 withAnimationProperties:?];

  if (v8)
  {
    v9 = [(CKChatController *)self collectionView];
    [v9 enforceTranscriptScrollIntentWithAnimationProperties:v10];
  }
}

- (id)progressBar
{
  v24[4] = *MEMORY[0x1E69E9840];
  v23.receiver = self;
  v23.super_class = CKChatController;
  v3 = [(CKCoreChatController *)&v23 progressBar];
  v4 = [(CKChatController *)self _progressBarHostView];
  v5 = v4;
  if (v3)
  {
    v6 = v4 == 0;
  }

  else
  {
    v6 = 1;
  }

  if (!v6)
  {
    v7 = [v3 superview];

    if (v7 != v5)
    {
      [v3 removeFromSuperview];
      [v5 addSubview:v3];
      [v3 setTranslatesAutoresizingMaskIntoConstraints:0];
      v18 = MEMORY[0x1E696ACD8];
      v22 = [v3 leadingAnchor];
      v21 = [v5 leadingAnchor];
      v20 = [v22 constraintEqualToAnchor:v21];
      v24[0] = v20;
      v19 = [v3 trailingAnchor];
      v8 = [v5 trailingAnchor];
      v9 = [v19 constraintEqualToAnchor:v8];
      v24[1] = v9;
      v10 = [v3 bottomAnchor];
      v11 = [v5 bottomAnchor];
      v12 = [v10 constraintEqualToAnchor:v11];
      v24[2] = v12;
      v13 = [v3 heightAnchor];
      [v3 frame];
      v15 = [v13 constraintEqualToConstant:v14];
      v24[3] = v15;
      v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v24 count:4];
      [v18 activateConstraints:v16];

      [v5 setNeedsLayout];
      [v5 layoutIfNeeded];
    }
  }

  return v3;
}

- (void)updateSendProgress:(double)a3 progressColor:(id)a4 animation:(id)a5
{
  v8 = a5;
  v10 = [_TtC7ChatKit29TranscriptNavigationBarChange sendProgressChange:a4 color:a3];
  v9 = [(CKChatController *)self transcriptNavigationBarController];
  [v9 applyChange:v10 animation:v8];
}

- (id)_progressBarHostView
{
  if (CKIsRunningInMacCatalyst())
  {
    v3 = [(CKChatController *)self macRecipientsController];
    v4 = [v3 view];
  }

  else
  {
    v5 = [(CKChatController *)self navigationItem];
    v3 = [v5 navigationBar];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = [(CKChatController *)self navigationItem];
      v7 = [v6 titleView];

      goto LABEL_7;
    }

    v4 = [v3 _backgroundView];
  }

  v7 = v4;
LABEL_7:

  return v7;
}

- (void)_updateTitleAnimated:(BOOL)a3
{
  v6.receiver = self;
  v6.super_class = CKChatController;
  [(CKCoreChatController *)&v6 _updateTitleAnimated:a3];
  v4 = [(CKChatController *)self transcriptNavigationBarController];
  v5 = +[_TtC7ChatKit29TranscriptNavigationBarChange conversationTitleChange];
  [v4 applyChange:v5];
}

- (void)_updatePollSuggestionAvailability
{
  v2 = [(CKChatController *)self entryView];
  [v2 updateAllowPollSuggestions];
}

- (void)_setTitle:(id)a3 animated:(BOOL)a4
{
  v21 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  v6 = [v5 chat];
  v7 = [v6 valueForChatProperty:*MEMORY[0x1E69A5D50]];
  if ([v7 BOOLValue])
  {
    v8 = [(CKCoreChatController *)self conversation];
    v9 = [v8 chat];
    v10 = [v9 isFiltered] != 0;
  }

  else
  {
    v10 = 0;
  }

  v11 = [(CKCoreChatController *)self conversation];
  if ([v11 wasDetectedAsSMSSpam])
  {
    v12 = !+[CKConversation isSMSSpamFilteringEnabled];
  }

  else
  {
    LOBYTE(v12) = 0;
  }

  v13 = [(CKCoreChatController *)self conversation];
  v14 = [v13 chat];
  if (([v14 isRecovered] & 1) == 0)
  {

    if (((v10 | v12) & 1) == 0)
    {
      goto LABEL_14;
    }

    v15 = MEMORY[0x1E696AEC0];
    v16 = CKFrameworkBundle();
    v17 = [v16 localizedStringForKey:@"MAYBE_JUNK" value:&stru_1F04268F8 table:@"ChatKit"];
    v14 = [v15 stringWithFormat:v17, v21];

    v18 = [MEMORY[0x1E69DC668] sharedApplication];
    v19 = [v18 userInterfaceLayoutDirection];

    if (v19 == 1)
    {
      v20 = @"\u200F";
    }

    else
    {
      v20 = @"\u200E";
    }

    [(__CFString *)v20 stringByAppendingString:v14];
    v21 = v13 = v21;
  }

LABEL_14:
}

- (void)_handleIsFilteredChange
{
  v3 = [(CKCoreChatController *)self conversation];
  [v3 setNeedsUpdatedGroupPhotoForVisualIdentity];

  [(CKChatController *)self _updateTitleAnimated:1];
}

- (void)_updateNavigationButtons
{
  v9 = *MEMORY[0x1E69E9840];
  v3 = +[_TtC7ChatKit29TranscriptNavigationBarChange barButtonsChange];
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = [v3 name];
      v7 = 138412290;
      v8 = v5;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Applying navigation bar configuration change {%@}", &v7, 0xCu);
    }
  }

  v6 = [(CKChatController *)self transcriptNavigationBarController];
  [v6 applyChange:v3];
}

- (BOOL)_canShowBackButtonView
{
  if (CKIsRunningInMacCatalyst() || (IMIsRunningInScreenshotTesting_IsolatedTranscriptUI() & 1) != 0)
  {
    LOBYTE(v3) = 0;
  }

  else
  {
    v3 = [(CKCoreChatController *)self isCollapsed];
    if (v3)
    {
      LOBYTE(v3) = [(CKChatController *)self isEditing]^ 1;
    }
  }

  return v3;
}

- (CKNavBarUnifiedCallButton)navBarFaceTimeCallButton
{
  navBarFaceTimeCallButton = self->_navBarFaceTimeCallButton;
  if (!navBarFaceTimeCallButton)
  {
    v4 = [CKNavBarUnifiedCallButton buttonWithType:1];
    [(CKNavBarUnifiedCallButton *)v4 setDelegate:self];
    v5 = self->_navBarFaceTimeCallButton;
    self->_navBarFaceTimeCallButton = v4;

    navBarFaceTimeCallButton = self->_navBarFaceTimeCallButton;
  }

  return navBarFaceTimeCallButton;
}

- (id)currentNavigationBarBasedOnSizeClass
{
  if (CKIsRunningInMessagesTranscriptExtension() || (-[CKChatController traitCollection](self, "traitCollection"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 horizontalSizeClass], v3, v4 != 1))
  {
    v5 = [(CKChatController *)self navigationController];
    v7 = [v5 navigationBar];
  }

  else
  {
    v5 = [(CKChatController *)self parentViewController];
    v6 = [v5 navigationController];
    v7 = [v6 navigationBar];
  }

  return v7;
}

- (BOOL)shouldShowAvatarViewInNavBarCanvas
{
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 contactPhotosEnabled];

  return v3;
}

- (void)persistentMenuManager:(id)a3 selectedChipAction:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self suggestedActionsHandler];
  [v6 performChipAction:v5];
}

- (BOOL)shouldUseMinimumSafeAreas
{
  v3 = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if ((v4 & 1) == 0)
  {
    return 0;
  }

  v5 = [(CKCoreChatController *)self delegate];
  v6 = [v5 shouldUseMinimumSafeAreas];

  return v6;
}

- (void)keyCommandToggleDetails
{
  if (CKIsRunningInMacCatalyst())
  {

    [(CKChatController *)self _detailsButtonPressed];
  }

  else
  {

    [(CKChatController *)self presentDetailsViewController];
  }
}

- (void)keyCommandToggleUnreadState
{
  v3 = [(CKCoreChatController *)self chat];
  v4 = [v3 unreadMessageCount];

  v5 = [(CKCoreChatController *)self chat];
  v6 = v5;
  if (v4)
  {
    [v5 markAllMessagesAsRead];
  }

  else
  {
    [v5 markLastMessageAsUnread];
  }
}

- (void)_detailsButtonPressed
{
  if (!IMIsOscarEnabled() || ![(CKChatController *)self isShowingOscarChat])
  {

    [(CKChatController *)self presentDetailsViewController];
  }
}

- (void)presentDetailsViewControllerAnimated:(BOOL)a3
{
  v4 = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    v6 = [(CKCoreChatController *)self delegate];
    v7 = [v6 hasDetailsNavigationController];

    if (v7)
    {
      v8 = [(CKCoreChatController *)self delegate];
      v9 = [v8 isDetailsNavigationControllerDetached];

      v10 = [(CKCoreChatController *)self delegate];
      v11 = v10;
      if (v9)
      {
        [v10 dismissAndReopenDetailsNavigationController];
      }

      else
      {
        [v10 dismissDetailsNavigationController];
      }

      return;
    }
  }

  else if (!CKIsRunningInMessagesTranscriptExtension())
  {
    return;
  }

  [(CKChatController *)self _presentDetailsViewControllerAnimated:1];
}

- (void)_presentDetailsViewControllerAnimated:(BOOL)a3
{
  v3 = a3;
  v46[1] = *MEMORY[0x1E69E9840];
  v5 = [MEMORY[0x1E69DD0F0] sharedInstance];
  [v5 setSupportedPayloadIds:MEMORY[0x1E695E0F0]];

  v6 = [MEMORY[0x1E69DD0F0] sharedInstance];
  [v6 setPayloadDelegate:0];

  v7 = [(CKCoreChatController *)self conversation];
  v8 = [v7 chat];
  v9 = [v8 isStewieChat];

  if (v9)
  {
    if (!IMOSLoggingEnabled())
    {
      return;
    }

    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v45[0] = 0;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Do not present Details view in Stewie chats", v45, 2u);
    }

    goto LABEL_5;
  }

  v11 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v12 = [v11 isTranscriptSharingEnabled];

  if (!v12 || (-[CKCoreChatController conversation](self, "conversation"), v13 = objc_claimAutoreleasedReturnValue(), [v13 chat], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "isStewieSharingChat"), v14, v13, !v15))
  {
    v16 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v17 = [v16 isModernSplitViewControllerEnabled];

    if (v17)
    {
      [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
    }

    v18 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v19 = [v18 isRedesignedDetailsViewEnabled];

    if (!v19)
    {
      goto LABEL_23;
    }

    v20 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    if ([v20 isBIAEnabled])
    {
      v21 = [(CKCoreChatController *)self conversation];
      if ([v21 isBusinessConversation])
      {

LABEL_23:
        v24 = [CKDetailsControllerAdapter alloc];
        v25 = [(CKCoreChatController *)self conversation];
        v26 = [(CKDetailsControllerAdapter *)v24 initWithConversation:v25 delegate:self];

        v27 = [(CKDetailsControllerAdapter *)v26 detailsController];
        v28 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        v29 = [v28 isModernDetailsViewEnabled];

        if (v29)
        {
          v30 = [(CKCoreChatController *)self conversation];
          v31 = [v30 isBusinessConversation] ^ 1;
        }

        else
        {
          v31 = 0;
        }

        v32 = [[CKDetailsNavigationController alloc] initWithNavigationBarClass:objc_opt_class() toolbarClass:0 shouldHideNavigationBar:v31];
        [(CKDetailsNavigationController *)v32 setDetailsAdapter:v26];
        if (v27)
        {
          v46[0] = v27;
          v33 = [MEMORY[0x1E695DEC8] arrayWithObjects:v46 count:1];
          [(CKDetailsNavigationController *)v32 setViewControllers:v33];
        }

        else
        {
          [(CKDetailsNavigationController *)v32 setViewControllers:MEMORY[0x1E695E0F0]];
        }

        [(CKDetailsNavigationController *)v32 setDelegate:v27];
        v34 = [(CKCoreChatController *)self delegate];
        [v34 presentDetailsNavigationController:v32];

        v35 = [(CKCoreChatController *)self conversation];
        v36 = [v35 isBusinessConversation];

        if (v36)
        {
          v37 = [(CKDetailsNavigationController *)v32 view];
          v38 = [MEMORY[0x1E69DC888] systemBackgroundColor];
          [v37 setBackgroundColor:v38];
        }

        v39 = [MEMORY[0x1E69DC938] currentDevice];
        v40 = [v39 userInterfaceIdiom];

        if ((v40 & 0xFFFFFFFFFFFFFFFBLL) == 1)
        {
          [(CKDetailsNavigationController *)v32 setModalPresentationStyle:2];
        }

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v41 = +[CKLinkIntentsManager sharedManager];
          [v41 registerDependencyWithDetailsController:v27];
        }

        v42 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        v43 = [v42 isModernSplitViewControllerEnabled];

        if (v43)
        {
          [(CKChatController *)self performPlatformSpecificDetailsPresentation:v32];
        }

        else
        {
          [(CKChatController *)self presentViewController:v32 animated:v3 completion:0];
        }

        return;
      }

      v22 = [(CKCoreChatController *)self conversation];
      v23 = [v22 isChatBot];

      if (v23)
      {
        goto LABEL_23;
      }
    }

    else
    {
    }

    v44 = [(CKCoreChatController *)self conversation];
    [(CKChatController *)self presentRedesignedDetailsViewForConversation:v44];

    return;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v45[0] = 0;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Do not present Details view in Transcript Sharing chats", v45, 2u);
    }

LABEL_5:
  }
}

- (void)_backbuttonPressed
{
  v3 = [(CKChatController *)self _navigationControllerToPop];
  v2 = [v3 popViewControllerAnimated:1];
}

- (id)_navigationControllerToPop
{
  if (-[CKCoreChatController isCollapsed](self, "isCollapsed") && (-[CKChatController navigationController](self, "navigationController"), v3 = objc_claimAutoreleasedReturnValue(), [v3 topViewController], v4 = objc_claimAutoreleasedReturnValue(), v4, v3, v4 == self))
  {
    v7 = [(CKChatController *)self navigationController];
    v5 = [v7 navigationController];
  }

  else
  {
    v5 = [(CKChatController *)self navigationController];
  }

  return v5;
}

- (void)dismissDetailsControllerAnimated:(BOOL)a3
{
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __53__CKChatController_dismissDetailsControllerAnimated___block_invoke;
  v3[3] = &unk_1E72EBA18;
  v3[4] = self;
  [(CKChatController *)self dismissViewControllerAnimated:a3 completion:v3];
}

uint64_t __53__CKChatController_dismissDetailsControllerAnimated___block_invoke(uint64_t a1)
{
  v2 = +[CKLinkIntentsManager sharedManager];
  [v2 purgeDependencies];

  [*(a1 + 32) setTargetFirstResponder:1];
  v3 = *(a1 + 32);

  return [v3 becomeFirstResponder];
}

- (id)detailsViewControllerForInspector
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isRedesignedDetailsViewEnabled];

  if (!v4)
  {
    v7 = 0;
    goto LABEL_11;
  }

  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  if ([v5 isBIAEnabled])
  {
    v6 = [(CKCoreChatController *)self conversation];
    if ([v6 isBusinessConversation])
    {

LABEL_9:
      v12 = [CKDetailsControllerAdapter alloc];
      v13 = [(CKCoreChatController *)self conversation];
      v8 = [(CKDetailsControllerAdapter *)v12 initWithConversation:v13 delegate:self];

      v9 = [(CKDetailsControllerAdapter *)v8 detailsController];
      goto LABEL_10;
    }

    v10 = [(CKCoreChatController *)self conversation];
    v11 = [v10 isChatBot];

    if (v11)
    {
      goto LABEL_9;
    }
  }

  else
  {
  }

  v8 = [(CKCoreChatController *)self conversation];
  v9 = [(CKChatController *)self redesignedDetailsViewForConversation:v8];
LABEL_10:
  v7 = v9;

LABEL_11:

  return v7;
}

- (void)_callButtonPressed
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 chat];
  v5 = [v4 conversation];

  -[CKChatController _callButtonPressedWithVideoEnabled:](self, "_callButtonPressedWithVideoEnabled:", [MEMORY[0x1E69A5B78] conversationIsVideoCall:v5]);
}

- (void)_callButtonPressedWithVideoEnabled:(BOOL)a3
{
  v3 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  v6 = [v5 chat];
  v8 = [v6 conversation];

  if (v8)
  {
    if ([v8 state])
    {
      [CKFaceTimeUtilities showCallControlsForConversation:v8];
      goto LABEL_7;
    }

    v7 = [(CKCoreChatController *)self chat];
    [v7 joinExistingTUConversation];
  }

  else
  {
    v7 = [(CKCoreChatController *)self chat];
    [v7 initiateTUConversationWithVideoEnabled:v3];
  }

LABEL_7:
}

- (CNContactPickerViewController)contactPicker
{
  contactPicker = self->_contactPicker;
  if (!contactPicker)
  {
    v4 = objc_alloc_init(MEMORY[0x1E695D120]);
    v5 = self->_contactPicker;
    self->_contactPicker = v4;

    [(CNContactPickerViewController *)self->_contactPicker setDelegate:self];
    contactPicker = self->_contactPicker;
  }

  return contactPicker;
}

- (BOOL)canPerformAction:(SEL)a3 withSender:(id)a4
{
  v6 = a4;
  v7 = [(CKChatController *)self entryView];
  v8 = [v7 contentView];
  v9 = [v8 textView];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = objc_opt_new();
LABEL_5:
    [v9 setPasteConfiguration:v10];

    goto LABEL_6;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = [(CKCoreChatController *)self chat];
    v12 = [v11 supportsCapabilities:0x8000];

    v13 = +[CKUIBehavior sharedBehaviors];
    v10 = [v13 pasteConfigurationDisablingKeyboardStickers:v12 ^ 1u];

    goto LABEL_5;
  }

LABEL_6:
  v14 = [MEMORY[0x1E69DCC68] sharedMenuController];

  if (v14 == v6 || v9 == v6)
  {
    v26 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v27 = [v26 isTextSelectionEnabled];

    if (!v27 || sel_captureTextFromCamera_ != a3 || [v9 isFirstResponder])
    {
      v28 = [v9 canPerformAction:a3 withSender:v6];
LABEL_22:
      v25 = v28;
      goto LABEL_23;
    }

LABEL_19:
    v25 = 0;
    goto LABEL_23;
  }

  if (sel_copy_ == a3 || sel_delete_ == a3)
  {
    v15 = [(CKChatController *)self selectedChatItems];
    v16 = [v15 count];

    if (!v16)
    {
      goto LABEL_19;
    }
  }

  if (sel_delete_ != a3)
  {
    goto LABEL_21;
  }

  v17 = [(CKChatController *)self selectedChatItems];
  v18 = [v17 count];

  if (v18 != 1)
  {
    goto LABEL_21;
  }

  v19 = [(CKChatController *)self selectedChatItems];
  v20 = [v19 firstObject];

  v21 = [(CKCoreChatController *)self collectionViewController];
  v22 = [v21 balloonViewForChatItem:v20];

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {

LABEL_21:
    v30.receiver = self;
    v30.super_class = CKChatController;
    v28 = [(CKChatController *)&v30 canPerformAction:a3 withSender:v6];
    goto LABEL_22;
  }

  v23 = [v22 textView];
  v24 = [v23 selectedTextRange];
  v25 = v24 == 0;

LABEL_23:
  return v25;
}

- (void)registerNotifications
{
  v29.receiver = self;
  v29.super_class = CKChatController;
  [(CKCoreChatController *)&v29 registerNotifications];
  v3 = [MEMORY[0x1E696AD88] defaultCenter];
  [v3 addObserver:self selector:sel__applicationDidBecomeActive_ name:*MEMORY[0x1E69DDAB0] object:0];

  v4 = [MEMORY[0x1E696AD88] defaultCenter];
  [v4 addObserver:self selector:sel__raiseToListenSettingChanged_ name:CKPreferenceRaiseToListenDidChangeNotification object:0];

  v5 = [MEMORY[0x1E696AD88] defaultCenter];
  [v5 addObserver:self selector:sel__applicationWillResignActive_ name:*MEMORY[0x1E69DDBC8] object:0];

  v6 = [MEMORY[0x1E696AD88] defaultCenter];
  [v6 addObserver:self selector:sel__textInputModeDidChange_ name:*MEMORY[0x1E69DE688] object:0];

  v7 = [MEMORY[0x1E696AD88] defaultCenter];
  [v7 addObserver:self selector:sel__reduceTransparencyStatusDidChange name:*MEMORY[0x1E69DD920] object:0];

  v8 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v9 = [v8 isIntroductionsEnabled];

  if (v9)
  {
    v10 = [MEMORY[0x1E696AD88] defaultCenter];
    [v10 addObserver:self selector:sel__blockListDidChange name:*MEMORY[0x1E69A6A58] object:0];

    v11 = [MEMORY[0x1E696AD88] defaultCenter];
    [v11 addObserver:self selector:sel__contactsListDidChange name:*MEMORY[0x1E69A6828] object:0];
  }

  v12 = [MEMORY[0x1E696AD88] defaultCenter];
  [v12 addObserver:self selector:sel_inputLanguageDidChange_ name:*MEMORY[0x1E69DE6B8] object:0];

  v13 = [MEMORY[0x1E696AD88] defaultCenter];
  [v13 addObserver:self selector:sel_nicknameStoreDidChange_ name:*MEMORY[0x1E69A59E0] object:0];

  v14 = [MEMORY[0x1E696AD88] defaultCenter];
  [v14 addObserver:self selector:sel_nicknameStoreDidChange_ name:*MEMORY[0x1E69A5A10] object:0];

  v15 = [MEMORY[0x1E696AD88] defaultCenter];
  [v15 addObserver:self selector:sel__switchedToEmojiKeyboard_ name:*MEMORY[0x1E69DDF88] object:0];

  v16 = [MEMORY[0x1E696AD88] defaultCenter];
  [v16 addObserver:self selector:sel__switchedAwayFromEmojiKeyboard_ name:*MEMORY[0x1E69DDF80] object:0];

  v17 = [MEMORY[0x1E696AD88] defaultCenter];
  [v17 addObserver:self selector:sel__transferUpdated_ name:@"CKFileTransferUpdatedNotification" object:0];

  v18 = [MEMORY[0x1E696AD88] defaultCenter];
  [v18 addObserver:self selector:sel__transferCompleted_ name:@"CKFileTransferFinishedNotification" object:0];

  v19 = [MEMORY[0x1E696AD88] defaultCenter];
  [v19 addObserver:self selector:sel__handleContactStoreBatchLoadCompleteNotification_ name:*MEMORY[0x1E69A6E10] object:0];

  v20 = [MEMORY[0x1E696AD88] defaultCenter];
  [v20 addObserver:self selector:sel__updateNavigationUI name:*MEMORY[0x1E69A6838] object:0];

  v21 = [MEMORY[0x1E696AD88] defaultCenter];
  [v21 addObserver:self selector:sel_presentCollaborationPopoverUI name:*MEMORY[0x1E69A56C0] object:0];

  v22 = [MEMORY[0x1E696AD88] defaultCenter];
  [v22 addObserver:self selector:sel__updateAccountRegistrationFailureNotification name:*MEMORY[0x1E69A56B0] object:0];

  if (CKIsRunningInMessages())
  {
    if (!registerNotifications__DDDetectionControllerWillPresentActionNotification)
    {
      v23 = MEMORY[0x193AF5ED0]("DDDetectionControllerWillPresentActionNotification", @"DataDetectorsUI");
      if (v23)
      {
        v24 = *v23;
      }

      else
      {
        v24 = 0;
      }

      objc_storeStrong(&registerNotifications__DDDetectionControllerWillPresentActionNotification, v24);
    }

    if (!registerNotifications__DDDetectionControllerDidDismissActionNotification)
    {
      v25 = MEMORY[0x193AF5ED0]("DDDetectionControllerDidDismissActionNotification", @"DataDetectorsUI");
      if (v25)
      {
        v26 = *v25;
      }

      else
      {
        v26 = 0;
      }

      objc_storeStrong(&registerNotifications__DDDetectionControllerDidDismissActionNotification, v26);
    }

    if (registerNotifications__DDDetectionControllerWillPresentActionNotification)
    {
      v27 = [MEMORY[0x1E696AD88] defaultCenter];
      [v27 addObserver:self selector:sel__dataDetectorsWillPresentNotification_ name:registerNotifications__DDDetectionControllerWillPresentActionNotification object:0];
    }

    if (registerNotifications__DDDetectionControllerDidDismissActionNotification)
    {
      v28 = [MEMORY[0x1E696AD88] defaultCenter];
      [v28 addObserver:self selector:sel__dataDetectorsDidDismissNotification_ name:registerNotifications__DDDetectionControllerDidDismissActionNotification object:0];
    }
  }
}

- (void)_registerSendProgressDelegate
{
  v2.receiver = self;
  v2.super_class = CKChatController;
  [(CKCoreChatController *)&v2 _registerSendProgressDelegate];
}

- (void)registerNotificationsForConversation:(id)a3
{
  v16.receiver = self;
  v16.super_class = CKChatController;
  v4 = a3;
  [(CKCoreChatController *)&v16 registerNotificationsForConversation:v4];
  v5 = [MEMORY[0x1E696AD88] defaultCenter];
  [v5 addObserver:self selector:sel__conversationParticipantsChanged_ name:@"CKConversationParticipantsDidChangeNotification" object:v4];

  v6 = [MEMORY[0x1E696AD88] defaultCenter];
  [v6 addObserver:self selector:sel__conversationJoinStateDidChange_ name:@"CKConversationJoinStateDidChangeNotification" object:v4];

  v7 = [MEMORY[0x1E696AD88] defaultCenter];
  v8 = *MEMORY[0x1E69A5748];
  v9 = [v4 chat];
  [v7 addObserver:self selector:sel__handleChatItemDidChange_ name:v8 object:v9];

  v10 = [MEMORY[0x1E696AD88] defaultCenter];
  v11 = *MEMORY[0x1E69A5808];
  v12 = [v4 chat];
  [v10 addObserver:self selector:sel__handleKeyTransparencyShouldRefresh_ name:v11 object:v12];

  v13 = [MEMORY[0x1E696AD88] defaultCenter];
  v14 = *MEMORY[0x1E69A5730];
  v15 = [v4 chat];

  [v13 addObserver:self selector:sel__handleInterworkingStateChanged_ name:v14 object:v15];
}

- (void)_displayNameUpdatedNotification:(id)a3
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 _displayNameUpdatedNotification:a3];
}

- (BOOL)shouldListParticipantsInTitle
{
  if ([(CKChatController *)self shouldShowAvatarViewInNavBarCanvas])
  {
    LOBYTE(v3) = 0;
  }

  else
  {
    v4 = [(CKChatController *)self splitViewController];
    v3 = [v4 isCollapsed] ^ 1;
  }

  return v3;
}

- (void)_transferFinishedNotification:(id)a3
{
  v9 = [a3 object];
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 chatItems];
  v6 = [v5 __ck_indexOfTransfer:v9];

  if (v6 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v7 = [v9 IMMessage];
    if ([v7 isFromMe])
    {
    }

    else
    {
      v8 = [v9 isFileDataReady];

      if (v8)
      {
        [(CKChatController *)self updateQLPreviewControllerIfVisible];
      }
    }
  }
}

- (void)_transferRestoredNotification:(id)a3
{
  v16 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 object];
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 chatItems];
  v8 = [v7 __ck_indexOfTransfer:v5];

  if (v8 != 0x7FFFFFFFFFFFFFFFLL)
  {
    if (IMOSLoggingEnabled())
    {
      CKLogCStringForType(46);
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412546;
        v13 = v5;
        v14 = 2048;
        v15 = v8;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_DEBUG, "Transfer %@ restored. Reload indexes %lu.", buf, 0x16u);
      }
    }

    if (os_log_shim_legacy_logging_enabled() && _CKShouldLog())
    {
      v10 = v5;
      v11 = v8;
      _CKLog();
    }

    [(CKChatController *)self updateQLPreviewControllerIfVisible:v10];
  }
}

- (void)_handleAddressBookChangedNotification:(id)a3
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 _handleAddressBookChangedNotification:a3];
  if ([(CKChatController *)self allowsMentions])
  {
    [(CKChatController *)self _reloadMentionsData];
  }
}

- (void)_reloadMentionsData
{
  v4 = [(CKChatController *)self entryView];
  v2 = [v4 contentView];
  v3 = [v2 textView];
  [v3 reloadMentionsData];
}

- (void)_raiseToListenSettingChanged:(id)a3
{
  [(CKChatController *)self updateRaiseGesture];
  v4 = +[CKConversationList sharedConversationList];
  [v4 setNeedsReload];

  v5 = [(CKCoreChatController *)self conversation];
  [v5 loadAllMessages];
}

- (void)_applicationWillResignActive:(id)a3
{
  [(CKChatController *)self setIsShowingCamera:0];
  v4 = [(CKCoreChatController *)self inputController];
  if ([v4 isInputViewVisible])
  {
    v5 = [(CKChatController *)self entryView];
    v6 = [v5 contentView];
    v7 = [v6 activeView];
    v8 = [v7 isFirstResponder];

    if (v8)
    {
      v9 = 1;
      goto LABEL_7;
    }
  }

  else
  {
  }

  if (![(CKChatController *)self appModalIsDisplayed])
  {
    return;
  }

  v9 = 4;
LABEL_7:

  [(CKChatController *)self setTargetFirstResponder:v9];
}

- (void)_applicationDidBecomeActive:(id)a3
{
  [(CKChatController *)self updateRaiseGesture];
  v4 = [(CKCoreChatController *)self inputController];
  if ([v4 isInputViewVisible])
  {
    v5 = [(CKChatController *)self entryView];
    v6 = [v5 contentView];
    v7 = [v6 activeView];
    v8 = [v7 isFirstResponder];

    if (v8)
    {
      goto LABEL_9;
    }
  }

  else
  {
  }

  if ([(CKChatController *)self targetFirstResponder]!= 1)
  {
LABEL_9:

    [(CKChatController *)self setTargetFirstResponder:0];
    return;
  }

  [(CKChatController *)self becomeFirstResponder];
}

- (void)_conversationParticipantsChanged:(id)a3
{
  [(CKChatController *)self _updateRecipientCapabilities];
  [(CKChatController *)self reloadInputViews];
  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  if ([(CKChatController *)self shouldUseMacRecipientsView])
  {
    v4 = [(CKChatController *)self macRecipientsController];
    [v4 refreshRecipients];
  }

  v5 = [(CKCoreChatController *)self conversation];
  if ([v5 hasLeftGroupChat])
  {
    goto LABEL_6;
  }

  v6 = [(CKCoreChatController *)self conversation];
  if ([v6 isBusinessChatDisabled])
  {

LABEL_6:
LABEL_7:
    v8.receiver = self;
    v8.super_class = CKChatController;
    [(CKChatController *)&v8 becomeFirstResponder];
    goto LABEL_8;
  }

  v7 = [(CKCoreChatController *)self isReadOnly];

  if (v7)
  {
    goto LABEL_7;
  }

  if ([(CKChatController *)self allowsMentions])
  {
    [(CKChatController *)self _reloadMentionsData];
  }

LABEL_8:
  [(CKChatController *)self _updateTitleAnimated:1];
}

- (void)_conversationJoinStateDidChange:(id)a3
{
  [(CKChatController *)self reloadInputViews];
  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  v4 = [(CKCoreChatController *)self conversation];
  if (([v4 hasLeftGroupChat] & 1) == 0)
  {
    v5 = [(CKCoreChatController *)self conversation];
    if (![v5 isBusinessChatDisabled])
    {
      v7 = [(CKCoreChatController *)self isReadOnly];

      if (!v7)
      {
        goto LABEL_6;
      }

      goto LABEL_5;
    }
  }

LABEL_5:
  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self becomeFirstResponder];
LABEL_6:
  if ([(CKChatController *)self shouldUseMacRecipientsView])
  {
    v6 = [(CKChatController *)self macRecipientsController];

    if (v6)
    {
      v8 = [(CKChatController *)self macRecipientsController];
      [v8 refreshRecipients];
    }
  }
}

- (void)_dataDetectorsWillPresentNotification:(id)a3
{
  v4 = [(CKChatController *)self entryView];
  v5 = [v4 contentView];
  self->_entryViewWasActiveBeforePresentingDataDetector = [v5 isActive];

  if (self->_entryViewWasActiveBeforePresentingDataDetector)
  {
    v8 = [(CKChatController *)self entryView];
    v6 = [v8 contentView];
    v7 = [v6 activeView];
    [v7 resignFirstResponder];
  }
}

- (void)_dataDetectorsDidDismissNotification:(id)a3
{
  if (self->_entryViewWasActiveBeforePresentingDataDetector)
  {
    [(CKChatController *)self setTargetFirstResponder:1];
  }

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __57__CKChatController__dataDetectorsDidDismissNotification___block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

- (void)_sizeEffectPickerWindow
{
  v3 = [(CKChatController *)self effectPickerWindow];
  if (v3)
  {
    v4 = [(CKChatController *)self effectPickerViewController];
    if ([MEMORY[0x1E69DC938] __ck_currentDeviceIsPadOrMac])
    {
      v20 = 0.0;
      v21 = 0.0;
      [(CKChatController *)self messageEntryViewWidth:&v21 andOffset:&v20];
      v5 = [(CKChatController *)self view];
      [v5 bounds];
      v7 = v6;
      v9 = v8;

      [v3 setFrame:{v20, v7, v21, v9}];
      v10 = *MEMORY[0x1E69DE330];
      v11 = -1.0;
    }

    else
    {
      v12 = [(CKChatController *)self view];
      v13 = [v12 window];
      [v13 frame];
      [v3 setFrame:?];

      v10 = *MEMORY[0x1E69DE330];
      v11 = 1.0;
    }

    [v3 setLevel:v10 + v11];
    v14 = [v4 view];
    [v3 bounds];
    [v14 setFrame:?];

    v15 = [(CKChatController *)self entryView];
    [v15 sendButtonFrameInScreenCoordinates];
    v17 = v16;

    [v4 setCloseButtonYPosition:v17];
    v18 = [v4 view];
    [v18 setNeedsLayout];

    v19 = [v4 view];
    [v19 layoutIfNeeded];
  }
}

- (void)_switchedToEmojiKeyboard:(id)a3
{
  v4 = [(CKChatController *)self entryView];
  v5 = [v4 contentView];
  v6 = [v5 activeView];
  v7 = [v6 isFirstResponder];

  if (v7)
  {
    v8 = [MEMORY[0x1E69DCBF0] sharedInputModeController];
    v9 = [v8 currentInputModeInPreference];
    [(CKChatController *)self setSavedKeyboardInputMode:v9];

    [(CKChatController *)self setIsShowingEmojiKeyboard:1];
  }
}

- (void)_switchedAwayFromEmojiKeyboard:(id)a3
{
  [(CKChatController *)self setIsShowingEmojiKeyboard:0];
  v4 = [(CKChatController *)self entryView];
  [(CKChatController *)self messageEntryViewDidChange:v4 isTextChange:0 isShelfChange:0 isTranslationChange:0];
}

- (void)_initializeEffectPicker
{
  v3 = [(CKChatController *)self entryView];
  [v3 sendButtonFrameInScreenCoordinates];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  v12 = [(CKCoreChatController *)self gradientReferenceView];
  v13 = [(CKChatController *)self entryView];
  v14 = [v13 contentView];
  v15 = [v14 superview];

  [v15 frame];
  v17 = v16;
  v19 = v18;
  v20 = [v15 superview];
  [v20 convertPoint:0 toView:{v17, v19}];
  v22 = v21;
  v24 = v23;

  v25 = v22 + 1.0;
  if ([MEMORY[0x1E69DC938] __ck_currentDeviceIsPadOrMac])
  {
    v44 = 0.0;
    *buf = 0;
    [(CKChatController *)self messageEntryViewWidth:buf andOffset:&v44];
    v5 = v5 - v44;
    v25 = v25 - v44;
  }

  v26 = v24 + 1.0;
  if (CKIsRunningInMacCatalyst())
  {
    v27 = [CKEffectPickerMacViewController alloc];
    v28 = [(CKChatController *)self entryView];
    v29 = [v28 composition];
    v30 = [(CKCoreChatController *)self conversation];
    v31 = -[CKEffectPickerMacViewController initWithComposition:balloonViewOrigin:color:gradientReferenceView:](v27, "initWithComposition:balloonViewOrigin:color:gradientReferenceView:", v29, [v30 sendButtonColor], v12, v25, v26);

    [(CKEffectPickerMacViewController *)v31 setModalPresentationStyle:6];
    [(CKEffectPickerMacViewController *)v31 setShowingInStandAloneWindow:[(CKCoreChatController *)self showingInStandAloneWindow]];
  }

  else
  {
    v32 = [CKEffectPickerViewController alloc];
    v33 = [(CKChatController *)self entryView];
    v34 = [v33 composition];
    v35 = [(CKChatController *)self entryView];
    v31 = -[CKEffectPickerViewController initWithComposition:sendButtonFrame:balloonViewOrigin:color:gradientReferenceView:](v32, "initWithComposition:sendButtonFrame:balloonViewOrigin:color:gradientReferenceView:", v34, [v35 sendButtonColor], v12, v5, v7, v9, v11, v25, v26);
  }

  [(CKEffectPickerMacViewController *)v31 setDelegate:self];
  [(CKChatController *)self setEffectPickerViewController:v31];
  if (CKIsRunningInMacCatalyst())
  {
    v43[0] = MEMORY[0x1E69E9820];
    v43[1] = 3221225472;
    v43[2] = __43__CKChatController__initializeEffectPicker__block_invoke;
    v43[3] = &unk_1E72EBA18;
    v43[4] = self;
    [(CKChatController *)self presentViewController:v31 animated:0 completion:v43];
  }

  else
  {
    v36 = objc_alloc(MEMORY[0x1E69DD2E8]);
    v37 = [(CKChatController *)self view];
    v38 = [v37 window];
    v39 = [v38 windowScene];
    v40 = [v36 initWithWindowScene:v39];

    [(CKChatController *)self setEffectPickerWindow:v40];
    [v40 setRootViewController:v31];
    [(CKChatController *)self _sizeEffectPickerWindow];
    [v40 setHidden:0];
    v41 = [MEMORY[0x1E69DCBB8] activeKeyboard];
    [v41 setTypingEnabled:0];

    [(CKChatController *)self requestShowKeyboardSnapshotForReason:4];
    if (IMOSLoggingEnabled())
    {
      v42 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v42, OS_LOG_TYPE_INFO, "Hiding entry view", buf, 2u);
      }
    }
  }
}

- (void)_handleIsUnexpectedlyLoggedOutChanged:(id)a3
{
  v3 = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [v3 setNeedsUpdate];
}

- (void)_transferUpdated:(id)a3
{
  v4 = [a3 object];
  if ([v4 updateReason] == 1)
  {
    v5 = 0;
    if (!v4)
    {
      goto LABEL_11;
    }
  }

  else
  {
    v5 = [v4 updateReason] != 2;
    if (!v4)
    {
      goto LABEL_11;
    }
  }

  if (!v5)
  {
    v6 = [(CKCoreChatController *)self collectionViewController];
    v7 = [v6 associatedChatItems];

    v8 = [v7 __ck_indexOfTransfer:v4];
    if (v8 != 0x7FFFFFFFFFFFFFFFLL)
    {
      v9 = [v7 objectAtIndexedSubscript:v8];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v10 = [(CKCoreChatController *)self chat];
        v11 = [v9 IMChatItem];
        [v10 stickerRepositionedForAssociatedChatItem:v11];
      }
    }
  }

LABEL_11:
  v12 = [v4 error];
  if (v12)
  {
    v13 = v12;
    v14 = [v4 updateReason];

    if (v14 == 3)
    {
      v15 = IMLogHandleForCategory();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _transferUpdated:];
      }

      [(CKCoreChatController *)self presentAttachmentDownloadFailedErrorForTransfer:v4];
    }
  }
}

- (void)_transferCompleted:(id)a3
{
  v36 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 object];
  v27 = self;
  v6 = [(CKCoreChatController *)self mediaObjectToDownload];
  v7 = v6;
  if (v6)
  {
    v8 = [v6 transferGUID];
    v9 = [v5 guid];
    v10 = [v8 isEqualToString:v9];

    if (v10)
    {
      [(CKCoreChatController *)self setMediaObjectToDownload:0];
      [(CKChatController *)self showViewerForMediaObject:v7];
    }
  }

  if (v5 && [v5 commSafetySensitive])
  {
    v25 = v7;
    v26 = v4;
    v11 = v5;
    v12 = [v4 object];
    v13 = [v12 guid];

    v14 = [(CKCoreChatController *)v27 collectionViewController];
    v15 = [v14 chatItems];

    v33 = 0u;
    v34 = 0u;
    v31 = 0u;
    v32 = 0u;
    v16 = v15;
    v17 = [v16 countByEnumeratingWithState:&v31 objects:v35 count:16];
    if (v17)
    {
      v18 = v17;
      v19 = *v32;
      do
      {
        for (i = 0; i != v18; ++i)
        {
          if (*v32 != v19)
          {
            objc_enumerationMutation(v16);
          }

          v21 = *(*(&v31 + 1) + 8 * i);
          if ([v21 supportsCommunicationSafety])
          {
            v22 = [v21 commSafetyTransferGUID];
            v23 = [v13 isEqualToString:v22];

            if (v23)
            {
              v24 = dispatch_time(0, 200000000);
              block[0] = MEMORY[0x1E69E9820];
              block[1] = 3221225472;
              block[2] = __39__CKChatController__transferCompleted___block_invoke;
              block[3] = &unk_1E72EB880;
              block[4] = v27;
              v29 = v11;
              v30 = v21;
              dispatch_after(v24, MEMORY[0x1E69E96A0], block);
            }
          }
        }

        v18 = [v16 countByEnumeratingWithState:&v31 objects:v35 count:16];
      }

      while (v18);
    }

    v7 = v25;
    v4 = v26;
    v5 = v11;
  }
}

void __39__CKChatController__transferCompleted___block_invoke(id *a1)
{
  v4 = [a1[4] chat];
  v2 = [a1[5] commSafetySensitive];
  v3 = [a1[6] IMChatItem];
  [v4 updateCommSafety:v2 forChatItem:v3];
}

- (void)_textInputModeDidChange:(id)a3
{
  v15[2] = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [v3 userInfo];
  v5 = [v4 objectForKeyedSubscript:*MEMORY[0x1E69DE698]];

  v6 = [v3 userInfo];
  v7 = [v6 objectForKeyedSubscript:*MEMORY[0x1E69DE6A0]];

  v8 = [v3 userInfo];

  v9 = [v8 objectForKeyedSubscript:*MEMORY[0x1E69DE6A8]];

  if (v5)
  {
    v10 = v7 == 0;
  }

  else
  {
    v10 = 1;
  }

  if (!v10)
  {
    v11 = objc_alloc_init(MEMORY[0x193AF5EC0](@"NPSManager", @"NanoPreferencesSync"));
    v12 = MEMORY[0x1E695DFD8];
    v15[0] = v7;
    v15[1] = v9;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:2];
    v14 = [v12 setWithArray:v13];
    [v11 synchronizeUserDefaultsDomain:v5 keys:v14];
  }
}

- (void)inputLanguageDidChange:(id)a3
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __43__CKChatController_inputLanguageDidChange___block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __43__CKChatController_inputLanguageDidChange___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryView];

  if (v2)
  {
    v3 = *(a1 + 32);

    [v3 updateEntryViewHeightAnimated:0];
  }
}

- (void)_configureCallStateResolverForCurrentConversation
{
  objc_initWeak(&location, self);
  v3 = [(CKChatController *)self callStateResolver];
  v4 = [(CKCoreChatController *)self conversation];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __69__CKChatController__configureCallStateResolverForCurrentConversation__block_invoke;
  v5[3] = &unk_1E72EC460;
  objc_copyWeak(&v6, &location);
  [v3 updateForConversation:v4 completion:v5];

  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __69__CKChatController__configureCallStateResolverForCurrentConversation__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _updateNavigationButtons];

  v3 = objc_loadWeakRetained((a1 + 32));
  [v3 _updateCallStateIfNeeded];
}

- (void)setEntryViewOverrideForNewCompose:(id)a3
{
  v4 = a3;
  [v4 setDelegate:self];
  [(CKChatController *)self setEntryView:v4];
  [v4 _overrideInputAccessoryViewNextResponderWithResponder:self];

  self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft = 1;
}

- (void)cleanupPostComposeTransitionWithKBFrame:(CGRect)a3
{
  [(CKScrollViewController *)self primeWithKeyboardFrame:a3.origin.x, a3.origin.y, a3.size.width, a3.size.height];
  v15 = [(CKChatController *)self entryView];
  [v15 setConversation:0];
  v4 = [(CKCoreChatController *)self conversation];
  [v15 setConversation:v4];

  [v15 setDelegate:self];
  [v15 setClickInteractionDelegate:self];
  v5 = [(CKScrollViewController *)self isKeyboardVisible];
  v6 = [(CKCoreChatController *)self conversation];
  [v15 setConversation:v6];

  [v15 setKeyboardVisible:v5];
  v7 = [v15 contentView];
  v8 = [v7 textView];

  [v8 setTextDropDelegate:self];
  [v8 setPasteDelegate:self];
  v9 = [(CKCoreChatController *)self chat];
  v10 = [v9 supportsCapabilities:0x8000];

  v11 = +[CKUIBehavior sharedBehaviors];
  v12 = [v11 pasteConfigurationDisablingKeyboardStickers:v10 ^ 1u];

  [v8 setPasteConfiguration:v12];
  v13 = [(CKCoreChatController *)self inputController];
  v14 = [(CKChatController *)self entryView];
  [v13 setEntryView:v14];
}

- (void)setEntryView:(id)a3
{
  v6 = a3;
  if (v6)
  {
    v4 = [[CKMessageEntryViewController alloc] initWithEntryView:v6];
    [(CKChatController *)self setEntryViewController:v4];
  }

  else
  {
    [(CKChatController *)self setEntryViewController:0];
  }

  v5 = [(CKChatController *)self entryViewController];
  [v5 setInputAccessoryViewControllerEnabled:{-[CKChatController inputAccessoryViewControllerEnabled](self, "inputAccessoryViewControllerEnabled")}];
}

- (void)resignFirstResponderOnEntryViewIfNeeded
{
  v3 = +[CKUIBehavior sharedBehaviors];
  v4 = [v3 isEntryViewInputAccessory];

  if (v4)
  {
    v5 = [MEMORY[0x1E69DC938] currentDevice];
    v6 = [v5 userInterfaceIdiom];

    v7 = [MEMORY[0x1E69DCBE0] sharedInstance];
    v8 = [v7 isInHardwareKeyboardMode];

    v9 = [(CKCoreChatController *)self isCollapsed];
    v10 = [(CKCoreChatController *)self isInline];
    if (v6 == 1 && v9 && v8 && !v10)
    {
      v13 = [(CKChatController *)self entryView];
      v11 = [v13 contentView];
      v12 = [v11 textView];
      [v12 resignFirstResponder];
    }
  }
}

- (BOOL)appManagerDisplayedInMessages
{
  v3 = CKIsRunningInMessages();
  if (v3)
  {
    v4 = [(CKCoreChatController *)self inputController];
    v5 = [v4 appManagerIsDisplayed];

    if (v5)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *v8 = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "EntryView Debug - App Manager is displayed in Messages", v8, 2u);
        }
      }

      LOBYTE(v3) = 1;
    }

    else
    {
      LOBYTE(v3) = 0;
    }
  }

  return v3;
}

- (BOOL)appModalIsDisplayed
{
  v3 = CKIsRunningInMessages();
  if (v3)
  {
    v4 = [(CKCoreChatController *)self inputController];
    v5 = [v4 appModalIsDisplayed];

    if (v5)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *v8 = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "EntryView Debug - App modal is displayed in Messages", v8, 2u);
        }
      }

      LOBYTE(v3) = 1;
    }

    else
    {
      LOBYTE(v3) = 0;
    }
  }

  return v3;
}

- (id)inputAccessoryViewController
{
  v55 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self inputAccessoryViewControllerEnabled])
  {
    if ([(CKChatController *)self shouldShowEntryView])
    {
      v3 = [(CKChatController *)self entryViewController];
    }

    else
    {
      v3 = 0;
    }

    v4 = [(CKCoreChatController *)self inputController];
    v5 = [v3 entryView];
    [v4 setEntryView:v5];

    if ([(CKChatController *)self appManagerDisplayedInMessages])
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAVC, -appManagerDisplayedInMessages is YES", buf, 2u);
        }
      }

      v3 = 0;
    }

    if ([(CKChatController *)self appModalIsDisplayed])
    {
      v7 = [(CKCoreChatController *)self inputController];
      v8 = [v7 isDismissingAppModal];

      if ((v8 & 1) == 0)
      {
        if (IMOSLoggingEnabled())
        {
          v9 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAVC, -appModalIsDisplayed is YES", buf, 2u);
          }
        }

        v3 = 0;
      }
    }

    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = objc_opt_class();
        v36 = NSStringFromClass(v11);
        v32 = [v3 view];
        [v32 alpha];
        v13 = v12;
        v31 = [v3 view];
        [v31 frame];
        v34 = NSStringFromCGRect(v57);
        v30 = [v3 view];
        v29 = [v30 window];
        v14 = objc_opt_class();
        v33 = NSStringFromClass(v14);
        v28 = [v3 view];
        v35 = [v28 window];
        v27 = [(CKChatController *)self view];
        v15 = [v27 window];
        v16 = [v15 firstResponder];
        v17 = objc_opt_class();
        v18 = NSStringFromClass(v17);
        v19 = [(CKChatController *)self view];
        v20 = [v19 window];
        v21 = [v20 firstResponder];
        v22 = [(CKChatController *)self view];
        v23 = [v22 window];
        v24 = [v23 isKeyWindow];
        v25 = @"NO";
        *buf = 138414338;
        v38 = v36;
        v39 = 2048;
        if (v24)
        {
          v25 = @"YES";
        }

        v40 = v3;
        v41 = 2048;
        v42 = v13;
        v43 = 2112;
        v44 = v34;
        v45 = 2112;
        v46 = v33;
        v47 = 2048;
        v48 = v35;
        v49 = 2112;
        v50 = v18;
        v51 = 2048;
        v52 = v21;
        v53 = 2112;
        v54 = v25;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "EntryView Debug - IAVC %@ <%p> Alpha %f Frame %@ IAV Window %@ <%p>  Current FR %@ <%p> View window is key - %@", buf, 0x5Cu);
      }
    }
  }

  else
  {
    v3 = 0;
  }

  return v3;
}

- (UIEdgeInsets)_marginInsetsForEntryView
{
  [(CKChatController *)self systemMinimumLayoutMargins];
  v4 = v3;
  v29 = v6;
  v31 = v5;
  v8 = v7;
  v9 = [(CKChatController *)self view];
  v10 = [v9 effectiveUserInterfaceLayoutDirection];
  if (v10)
  {
    v11 = v8;
  }

  else
  {
    v11 = v4;
  }

  v27 = v11;
  if (v10)
  {
    v12 = v4;
  }

  else
  {
    v12 = v8;
  }

  v25 = v12;

  v14 = v25;
  v13 = v27;
  v16 = v29;
  v15 = v31;
  v17.f64[0] = v31;
  v17.f64[1] = v27;
  v18.f64[0] = v29;
  v18.f64[1] = v25;
  if (vminv_u16(vmovn_s32(vuzp1q_s32(vceqq_f64(*MEMORY[0x1E69DDCE0], v17), vceqq_f64(*(MEMORY[0x1E69DDCE0] + 16), v18)))))
  {
    v19 = [(CKCoreChatController *)self delegate];

    v14 = v25;
    v13 = v27;
    v16 = v29;
    v15 = v31;
    if (v19)
    {
      v20 = [(CKCoreChatController *)self delegate:v31];
      [v20 initialSystemMinimumLayoutMarginsForChatController:self];
      v30 = v22;
      v32 = v21;
      v26 = v24;
      v28 = v23;

      v14 = v26;
      v13 = v28;
      v16 = v30;
      v15 = v32;
    }
  }

  result.right = v14;
  result.bottom = v16;
  result.left = v13;
  result.top = v15;
  return result;
}

- (void)setSendingMessage:(BOOL)a3
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 setSendingMessage:a3];
  v4 = [(CKChatController *)self entryView];
  [v4 updateEntryView];
}

- (void)_updateEntryViewPasteConfiguration
{
  v16 = *MEMORY[0x1E69E9840];
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 contentView];
  v5 = [v4 textView];

  if (!v5)
  {
    goto LABEL_20;
  }

  v6 = [v5 disableKeyboardStickers];
  v7 = [(CKCoreChatController *)self chat];

  if (v7)
  {
    v8 = [(CKCoreChatController *)self chat];
    v9 = [v8 supportsCapabilities:0x8000] ^ 1;

    if (v6 == v9)
    {
LABEL_14:
      [(CKChatController *)self setShouldUpdateEntryViewPasteConfiguration:0];
      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = @"NO";
          if (v6)
          {
            v13 = @"YES";
          }

          v14 = 138412290;
          v15 = v13;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Configuration of stickers in keyboard has already been updated to hide:(%@). Ignoring paste configuration update.", &v14, 0xCu);
        }
      }

      goto LABEL_20;
    }
  }

  else
  {
    if ((v6 & 1) == 0)
    {
      goto LABEL_14;
    }

    v9 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = @"NO";
      if (v9)
      {
        v11 = @"YES";
      }

      v14 = 138412290;
      v15 = v11;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Updating paste configuration of entry text view to hide stickers:(%@)", &v14, 0xCu);
    }
  }

  [(CKChatController *)self setShouldUpdateEntryViewPasteConfiguration:1];
  [(CKChatController *)self reloadEntryViewIfNeeded];
LABEL_20:
}

- (void)reloadEntryViewIfNeeded
{
  v132 = *MEMORY[0x1E69E9840];
  [CKPPTSubTest start:@"reloadEntryViewIfNeeded"];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v131 = "[CKChatController reloadEntryViewIfNeeded]";
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "CKMessageEntryView - %s", buf, 0xCu);
    }
  }

  v4 = [(CKCoreChatController *)self inputController];
  v5 = v4 == 0;

  if (v5)
  {
    [(CKChatController *)self loadChatInputController];
  }

  v6 = [(CKCoreChatController *)self conversation];

  if (v6)
  {
    v7 = [(CKChatController *)self entryView];
    v8 = v7 == 0;

    if ([(CKChatController *)self needsEntryViewUpdateForDismissedFooter])
    {
      [(CKChatController *)self setNeedsEntryViewUpdateForDismissedFooter:0];
      v8 = 1;
    }

    if (IMOSLoggingEnabled())
    {
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        *buf = 67109120;
        LODWORD(v131) = v8;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "CKMessageEntryView - shouldUpdateEntryView = %d", buf, 8u);
      }
    }

    v10 = [(CKCoreChatController *)self conversation];
    v128 = [v10 lastAddressedHandle];

    v11 = [(CKCoreChatController *)self conversation];
    v127 = [v11 lastAddressedSIMID];

    AddressedHandle = CKShowSubjectEnabledForLastAddressedHandle(v128, v127);
    v13 = [(CKCoreChatController *)self conversation];
    v125 = [v13 isStewieConversation];

    v14 = [(CKCoreChatController *)self conversation];
    v15 = [v14 sendingService];
    if (([v15 __ck_isiMessageLite] & 1) == 0)
    {
      v16 = [(CKCoreChatController *)self conversation];
      v17 = [v16 sendingService];
      if (([v17 __ck_isSatelliteSMS] & 1) == 0)
      {
        v35 = [(CKCoreChatController *)self conversation];
        v36 = [v35 chat];
        v37 = [v36 shouldDisplayOffGridModeStatus];

        if ((v37 & 1) == 0)
        {
          v124 = 0;
          v18 = v125;
          v126 = (v125 ^ 1) & AddressedHandle;
          goto LABEL_19;
        }

LABEL_18:
        v126 = 0;
        v18 = 1;
        v124 = 1;
LABEL_19:
        v19 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        v20 = [v19 isAutomaticOutgoingTranslationEnabled];

        if (v20)
        {
          v21 = [(CKCoreChatController *)self chat];
          v22 = [v21 translationLanguageCode];

          if ([v22 length] && (-[CKCoreChatController chat](self, "chat"), v23 = objc_claimAutoreleasedReturnValue(), v24 = objc_msgSend(v23, "isAutomaticTranslationEnabled"), v23, v24))
          {
            v129 = [MEMORY[0x1E695DF58] localeWithLocaleIdentifier:v22];
          }

          else
          {
            v129 = 0;
          }
        }

        else
        {
          v129 = 0;
        }

        if (v8)
        {
          goto LABEL_77;
        }

        v25 = [(CKChatController *)self entryView];
        v123 = [v25 shouldShowSubject];

        v26 = [(CKChatController *)self entryView];
        v122 = [v26 shouldShowPluginButtons];
        v121 = [(CKChatController *)self pluginButtonsEnabled];

        v27 = [(CKChatController *)self entryView];
        v120 = [v27 shouldShowCharacterCount];
        v119 = CKShowCharacterCountEnabled(v18);

        v28 = [(CKChatController *)self entryView];
        v116 = [v28 shouldDisableAttachments];

        v29 = [(CKChatController *)self entryView];
        v118 = [v29 shouldReloadBackgroundView];

        v30 = [(CKChatController *)self entryView];
        v31 = [v30 translationLanguage];
        if (v31 | v129)
        {
          v32 = [(CKChatController *)self entryView];
          v33 = [v32 translationLanguage];
          v34 = [v33 isEqual:v129];

          v117 = v34 ^ 1;
        }

        else
        {
          v117 = 0;
        }

        v38 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        v39 = [v38 isExpressiveTextEnabled];

        v40 = [(CKChatController *)self entryView];
        v41 = [v40 contentView];
        v42 = [v41 textView];
        v43 = v42;
        if (v39)
        {

          v44 = [v43 ck_containsStaleEntryViewFont];
        }

        else
        {
          v45 = [v42 font];

          v46 = +[CKUIBehavior sharedBehaviors];
          v47 = [v46 balloonTextFont];
          if ([v45 isEqual:v47])
          {
            v44 = 0;
          }

          else
          {
            v48 = +[CKUIBehavior sharedBehaviors];
            v49 = [v48 singleBigEmojiFont];
            if ([v45 isEqual:v49])
            {
              v44 = 0;
            }

            else
            {
              v50 = +[CKUIBehavior sharedBehaviors];
              v51 = [v50 multipleBigEmojiFont];
              v52 = [v45 isEqual:v51];

              v44 = v52 ^ 1;
            }
          }

          v43 = v45;
        }

        if ((v43, (v126 ^ v123 | v122 ^ v121) & 1 | (v119 != v120) | (v44 | v118) & 1 | v117 & 1) || v18 != v116 && ![(CKScrollViewController *)self isKeyboardVisible]|| [(CKChatController *)self reloadEntryViewForStagedPluginMessage]|| [(CKChatController *)self shouldUpdateEntryViewPasteConfiguration]&& ![(CKScrollViewController *)self isKeyboardVisible])
        {
LABEL_77:
          if (IMOSLoggingEnabled())
          {
            v53 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v53, OS_LOG_TYPE_INFO, "CKMessageEntryView - CKChatController is creating a new CKMessageEntryView", buf, 2u);
            }
          }

          [(CKChatController *)self _marginInsetsForEntryView];
          v55 = v54;
          v57 = v56;
          v59 = v58;
          v61 = v60;
          v62 = [(CKChatController *)self entryView];
          v63 = [v62 composition];

          v64 = [(CKChatController *)self entryView];
          [v64 removeFromSuperview];

          v65 = [(CKChatController *)self view];
          [v65 bounds];
          v67 = v66;
          v69 = v68;
          v71 = v70;
          v73 = v72;

          v74 = [(CKCoreChatController *)self chat];

          if (v74)
          {
            v75 = [(CKCoreChatController *)self chat];
            v76 = [v75 supportsCapabilities:0x8000];

            v77 = v76 ^ 1u;
          }

          else
          {
            v77 = 0;
          }

          v78 = [(CKCoreChatController *)self conversation];
          v79 = [v78 supportsPolls];

          if (IMOSLoggingEnabled())
          {
            v80 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v80, OS_LOG_TYPE_INFO))
            {
              v81 = @"NO";
              if (v79)
              {
                v81 = @"YES";
              }

              *buf = 138412290;
              v131 = v81;
              _os_log_impl(&dword_19020E000, v80, OS_LOG_TYPE_INFO, "[Polls] CKMessageEntryView - Allow Poll Suggestions? %@", buf, 0xCu);
            }
          }

          [(CKChatController *)self _invalidateEntryViewConstraints];
          v82 = [CKMessageEntryView alloc];
          v83 = IMIsRunningInMessagesComposeViewService();
          v84 = [(CKChatController *)self pluginButtonsEnabled];
          v85 = CKShowCharacterCountEnabled(v18) != 0;
          v86 = [(CKChatController *)self traitCollection];
          BYTE4(v115) = v79;
          BYTE3(v115) = v77;
          BYTE2(v115) = v124;
          BYTE1(v115) = v125;
          LOBYTE(v115) = v18;
          v87 = [(CKMessageEntryView *)v82 initWithFrame:v83 ^ 1u marginInsets:1 shouldAllowImpact:v126 shouldShowSendButton:v84 shouldShowSubject:v85 shouldShowPluginButtons:v86 shouldShowCharacterCount:v67 traitCollection:v69 shouldDisableAttachments:v71 shouldUseNonEmojiKeyboard:v73 shouldUseNonHandwritingKeyboard:v55 shouldDisableKeyboardStickers:v57 shouldAllowPollSuggestions:v59 translationLanguage:v61, v115, v129];

          v88 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
          LODWORD(v82) = [v88 isEntryViewRefreshEnabled];

          if (v82)
          {
            v89 = [(CKCoreChatController *)self collectionViewController];
            v90 = [v89 collectionView];
            [(CKMessageEntryView *)v87 configurePocketInteractionForScrollView:v90];
          }

          v91 = [CKMentionsController alloc];
          v92 = [(CKMessageEntryView *)v87 contentView];
          v93 = [v92 textView];
          v94 = [(CKCoreChatController *)self conversation];
          v95 = [(CKMentionsController *)v91 initWithEntryTextView:v93 conversation:v94];
          [(CKChatController *)self setMentionsController:v95];

          if (CKShouldUseModernRippleAnimation())
          {
            v96 = [(CKChatController *)self mentionsController];
            [v96 setTextEffectsDelegate:self];
          }

          [(CKChatController *)self setEntryView:v87];
          v97 = [[CKMessageEntryViewContainerView alloc] initWithFrame:v67, v69, v71, v73];
          [(CKMessageEntryViewContainerView *)v97 setEntryViewContainerViewDelegate:self];
          [(CKMessageEntryViewContainerView *)v97 setTranslatesAutoresizingMaskIntoConstraints:1];
          [(CKMessageEntryViewContainerView *)v97 setAutoresizingMask:18];
          [(CKMessageEntryViewContainerView *)v97 addSubview:v87];
          [(CKChatController *)self setEntryViewContainerView:v97];
          v98 = [(CKChatController *)self inlineReplyController];

          if (v98)
          {
            v99 = [(CKChatController *)self inlineReplyController];
            [v99 setEntryView:v87];

            v100 = [(CKChatController *)self inlineReplyController];
            [(CKMessageEntryView *)v87 setDelegate:v100];
          }

          else
          {
            [(CKMessageEntryView *)v87 setDelegate:self];
          }

          [(CKMessageEntryView *)v87 setClickInteractionDelegate:self];
          v101 = [(CKScrollViewController *)self isKeyboardVisible];
          v102 = [(CKCoreChatController *)self conversation];
          [(CKMessageEntryView *)v87 setConversation:v102];

          [(CKMessageEntryView *)v87 setKeyboardVisible:v101];
          v103 = [(CKMessageEntryView *)v87 contentView];
          v104 = [v103 textView];

          [v104 setTextDropDelegate:self];
          [v104 setPasteDelegate:self];
          v105 = +[CKUIBehavior sharedBehaviors];
          v106 = [v105 pasteConfigurationDisablingKeyboardStickers:v77];

          [v104 setPasteConfiguration:v106];
          v107 = [(CKCoreChatController *)self delegate];
          v108 = objc_opt_respondsToSelector();

          if (v108)
          {
            v109 = [(CKCoreChatController *)self delegate];
            v110 = [v109 navigationBarBackdropLayerGroupNameForChatController:self];

            [(CKMessageEntryView *)v87 setBackdropGroupName:v110];
          }

          if ([v63 hasContent])
          {
            [(CKMessageEntryView *)v87 setComposition:v63];
          }

          [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];
          [(CKChatController *)self becomeFirstResponder];
          v111 = [(CKChatController *)self firstResponder];
          [v111 reloadInputViews];

          v112 = [(CKCoreChatController *)self inputController];
          [v112 setEntryView:v87];
        }

        goto LABEL_71;
      }
    }

    goto LABEL_18;
  }

LABEL_71:
  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  [(CKChatController *)self registerForTextInputPayloadHandling];
  v113 = [(CKChatController *)self entryView];
  v114 = [(CKCoreChatController *)self conversation];
  [v113 setConversation:v114];

  [CKPPTSubTest stop:@"reloadEntryViewIfNeeded"];
}

- (void)addOrRemoveEntryViewIfNeeded
{
  v56 = *MEMORY[0x1E69E9840];
  v53 = +[CKUIBehavior sharedBehaviors];
  if (([v53 isEntryViewInputAccessory] & 1) == 0)
  {
    v3 = CKIsRunningUITests();

    if (v3)
    {
      return;
    }

    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "entryView: addOrRemoveEntryViewIfNeeded", buf, 2u);
      }
    }

    v5 = [(CKChatController *)self view];
    v6 = [(CKChatController *)self entryViewContainerView];
    v7 = [MEMORY[0x1E69DC938] currentDevice];
    v8 = [v7 userInterfaceIdiom] == 1;

    v9 = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
    v10 = [(CKChatController *)self shouldShowEntryView];
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = @"NO";
        if (v10)
        {
          v12 = @"YES";
        }

        *buf = 138412290;
        v55 = v12;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "entryView: shouldRemoveEntryView: %@", buf, 0xCu);
      }
    }

    v13 = v9 & v8;
    if (!v10)
    {
      if (v6)
      {
        v18 = [v6 superview];
        v19 = v18 == v5;

        if (v19)
        {
          v20 = [(CKChatController *)self entryViewContainerView];
          [v20 removeFromSuperview];

          v21 = [(CKChatController *)self entryView];
          [v21 setEntryViewKeyboardLayoutGuide:0];

          if (IMOSLoggingEnabled())
          {
            v22 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "entryView: Removed from super view", buf, 2u);
            }
          }
        }
      }

LABEL_34:
      v23 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v24 = [v23 isEntryViewRefreshEnabled];

      if ((v24 & 1) == 0)
      {
        v25 = [(CKChatController *)self entryView];
        v26 = [v25 isInPencilMode];

        keyboardCandidateBarBackgroundView = self->_keyboardCandidateBarBackgroundView;
        if ((v10 & (v13 | v26)) == 1)
        {
          if (keyboardCandidateBarBackgroundView || !v6)
          {
            goto LABEL_52;
          }

          if (IMOSLoggingEnabled())
          {
            v28 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Adding the keyboardCandidateBarBackgroundView", buf, 2u);
            }
          }

          v29 = +[CKUIBehavior sharedBehaviors];
          v30 = [v29 entryViewBackgroundClass];

          v31 = objc_alloc_init(v30);
          v32 = [(CKCoreChatController *)self delegate];
          v33 = objc_opt_respondsToSelector();

          if (v33)
          {
            v34 = [(CKCoreChatController *)self delegate];
            v35 = [v34 navigationBarBackdropLayerGroupNameForChatController:self];

            [v31 setBackdropGroupName:v35];
          }

          v36 = [(CKChatController *)self entryView];
          v37 = [v36 entryViewTraitCollection];
          [v31 setEntryViewTraitCollection:v37];

          [v6 addSubview:v31];
          [v31 setTranslatesAutoresizingMaskIntoConstraints:0];
          v38 = [v6 bottomAnchor];
          v39 = [v31 bottomAnchor];
          v40 = [v38 constraintEqualToAnchor:v39];
          [v40 setActive:1];

          v41 = [v6 leadingAnchor];
          v42 = [v31 leadingAnchor];
          v43 = [v41 constraintEqualToAnchor:v42];
          [v43 setActive:1];

          v44 = [v6 trailingAnchor];
          v45 = [v31 trailingAnchor];
          v46 = [v44 constraintEqualToAnchor:v45];
          [v46 setActive:1];

          v47 = [v6 keyboardLayoutGuide];
          v48 = [v47 topAnchor];
          v49 = [v31 topAnchor];
          v50 = [v48 constraintEqualToAnchor:v49];
          [v50 setActive:1];

          goto LABEL_51;
        }

        if (keyboardCandidateBarBackgroundView)
        {
          if (IMOSLoggingEnabled())
          {
            v51 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "Removing the keyboardCandidateBarBackgroundView", buf, 2u);
            }
          }

          [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView removeFromSuperview];
          v31 = 0;
LABEL_51:
          v52 = self->_keyboardCandidateBarBackgroundView;
          self->_keyboardCandidateBarBackgroundView = v31;
        }
      }

LABEL_52:

      return;
    }

    if (!v6 || ([v5 subviews], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "containsObject:", v6), v14, (v15 & 1) != 0))
    {
LABEL_27:
      [v5 bringSubviewToFront:v6];
      goto LABEL_34;
    }

    [v5 addSubview:v6];
    [(CKChatController *)self setUpEntryViewLayoutConstraintsIfNecessary];
    v16 = +[CKUIBehavior sharedBehaviors];
    if (([v16 isEntryViewFirstResponderOnViewAppearance] & 1) != 0 || self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft)
    {
    }

    else
    {

      if ((v13 & 1) == 0)
      {
LABEL_23:
        [(CKChatController *)self becomeFirstResponder];
        if (IMOSLoggingEnabled())
        {
          v17 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "entryView: added to view", buf, 2u);
          }
        }

        goto LABEL_27;
      }
    }

    [(CKChatController *)self setTargetFirstResponder:1];
    self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft = 0;
    goto LABEL_23;
  }
}

- (BOOL)shouldShowEntryView
{
  if (([(CKChatController *)self isViewLoaded]& 1) == 0)
  {
    if (!IMOSLoggingEnabled())
    {
      return 0;
    }

    v11 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      goto LABEL_31;
    }

    *v23 = 0;
    v12 = "Not inserting entry view because view is nil";
LABEL_30:
    _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, v12, v23, 2u);
    goto LABEL_31;
  }

  v3 = [(CKChatController *)self entryView];

  if (!v3)
  {
    if (!IMOSLoggingEnabled())
    {
      return 0;
    }

    v11 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      goto LABEL_31;
    }

    *v23 = 0;
    v12 = "Not inserting entry view because entryView is nil";
    goto LABEL_30;
  }

  if (![(CKChatController *)self entryViewRequiresCollectionView]|| ([(CKChatController *)self collectionView], v4 = objc_claimAutoreleasedReturnValue(), v4, v4))
  {
    v5 = [(CKCoreChatController *)self conversation];
    v6 = [v5 chat];
    v7 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v8 = [v7 isTranscriptSharingEnabled];

    if (v8 && [v6 isStewieSharingChat])
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v23 = 0;
          v10 = "Hiding entry view for Stewie Transcript Sharing";
LABEL_73:
          _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, v10, v23, 2u);
          goto LABEL_74;
        }

        goto LABEL_74;
      }
    }

    else if ([v6 isStewieEmergencyChat] && (objc_msgSend(MEMORY[0x1E69A5B00], "sharedInstance"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "isStewieEmergencyActive"), v13, (v14 & 1) == 0))
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v23 = 0;
          v10 = "Hiding entry view for Stewie emergency";
          goto LABEL_73;
        }

        goto LABEL_74;
      }
    }

    else if ([v6 isStewieRoadsideChat] && (objc_msgSend(MEMORY[0x1E69A5B00], "sharedInstance"), v15 = objc_claimAutoreleasedReturnValue(), v16 = objc_msgSend(v15, "isStewieRoadsideActive"), v15, (v16 & 1) == 0))
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v23 = 0;
          v10 = "Hiding entry view for Stewie roadside";
          goto LABEL_73;
        }

        goto LABEL_74;
      }
    }

    else
    {
      v17 = [MEMORY[0x1E6994658] sharedSystemShellSwitcher];
      v18 = [v17 isClarityBoardEnabled];

      if ((v18 & 1) == 0)
      {
        if (-[CKChatController isShowingOscarChat](self, "isShowingOscarChat") && ([v6 isSMS] & 1) == 0 && objc_msgSend(v6, "allowsJunkConfiguration"))
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view for Oscar";
              goto LABEL_73;
            }

LABEL_74:
          }
        }

        else if ([v5 hasLeftGroupChat])
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view because the user has left the group chat";
              goto LABEL_73;
            }

            goto LABEL_74;
          }
        }

        else if ([(CKCoreChatController *)self isReadOnly])
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view because the chat is read only";
              goto LABEL_73;
            }

            goto LABEL_74;
          }
        }

        else if ([v5 isBusinessChatDisabled] && (objc_msgSend(v5, "isChatBot") & 1) == 0)
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view because business chat is disabled";
              goto LABEL_73;
            }

            goto LABEL_74;
          }
        }

        else if ([v5 hasReplyEnabled])
        {
          if (v6 && ([v6 allowedByScreenTime] & 1) == 0)
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view because chat is screentime blocked";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else if ([(CKCoreChatController *)self isShowingLockoutView])
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view while the screentime lockout view is being shown";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else if ([(CKChatController *)self isEditing])
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view because the user is editing the chat";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else if ([(CKChatController *)self isShowingPreview])
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view while the user is viewing a preview";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else
          {
            if (![v6 isGroupChat] || (objc_msgSend(v6, "participants"), v21 = objc_claimAutoreleasedReturnValue(), v22 = objc_msgSend(v21, "count"), v21, v22 != 1))
            {
              v19 = 1;
              goto LABEL_76;
            }

            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (!os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                goto LABEL_74;
              }

              *v23 = 0;
              v10 = "Hiding entry view while the user is viewing an unnamed single-participant group";
              goto LABEL_73;
            }
          }
        }

        else if (IMOSLoggingEnabled())
        {
          v9 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
          {
            *v23 = 0;
            v10 = "Hiding entry view because hasReplyEnabled is false";
            goto LABEL_73;
          }

          goto LABEL_74;
        }
      }
    }

    v19 = 0;
LABEL_76:

    return v19;
  }

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *v23 = 0;
      v12 = "Not inserting entry view because collectionView is nil";
      goto LABEL_30;
    }

LABEL_31:
  }

  return 0;
}

- (void)loadChatInputController
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isTranscriptSharingEnabled];

  if (!v4 || (-[CKCoreChatController conversation](self, "conversation"), v5 = objc_claimAutoreleasedReturnValue(), [v5 chat], v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(v6, "isStewieSharingChat"), v6, v5, (v7 & 1) == 0))
  {
    v8 = [(CKCoreChatController *)self inputController];

    if (!v8)
    {
      v10 = objc_alloc_init(CKChatInputController);
      [(CKChatInputController *)v10 set_isRunningPPT:[(CKChatController *)self _isRunningPPT]];
      [(CKCoreChatController *)self setInputController:v10];
      [(CKChatInputController *)v10 setDelegate:self];
      WeakRetained = objc_loadWeakRetained(&self->_externalPluginControllerProvider);
      [(CKChatInputController *)v10 setExternalPluginControllerProvider:WeakRetained];
    }
  }
}

- (BOOL)_CKRunningInSOSBuddy
{
  if (_CKRunningInSOSBuddy_onceToken != -1)
  {
    [CKChatController _CKRunningInSOSBuddy];
  }

  return _CKRunningInSOSBuddy_sIsRunningInSOSBuddy;
}

CFStringRef __40__CKChatController__CKRunningInSOSBuddy__block_invoke()
{
  MainBundle = CFBundleGetMainBundle();
  result = CFBundleGetIdentifier(MainBundle);
  if (result)
  {
    result = CFEqual(result, @"com.apple.SOSBuddy");
    v2 = result != 0;
  }

  else
  {
    v2 = 0;
  }

  _CKRunningInSOSBuddy_sIsRunningInSOSBuddy = v2;
  return result;
}

- (void)viewSafeAreaInsetsDidChange
{
  v6.receiver = self;
  v6.super_class = CKChatController;
  [(CKScrollViewController *)&v6 viewSafeAreaInsetsDidChange];
  [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];
  v3 = [(CKChatController *)self view];
  [v3 bounds];
  [(CKChatController *)self _invalidateChatItemLayoutIfNecessary:v4, v5];
}

- (CGRect)inputAccessoryViewFrameForFloatingKeyboard
{
  v2 = [(CKChatController *)self entryView];
  [v2 frame];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;

  v11 = v4;
  v12 = v6;
  v13 = v8;
  v14 = v10;
  result.size.height = v14;
  result.size.width = v13;
  result.origin.y = v12;
  result.origin.x = v11;
  return result;
}

- (void)_updateEntryViewFrameIfNeeded:(BOOL)a3
{
  v3 = a3;
  v5 = [(CKChatController *)self entryView];
  v30 = [v5 window];

  if (v30)
  {
    v6 = [(CKChatController *)self view];
    [v6 bounds];
    v8 = v7;

    [(CKChatController *)self _maxEntryViewHeight];
    v10 = v9;
    v11 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v12 = [v11 isModernSplitViewControllerEnabled];

    if (v12)
    {
      v13 = [(CKChatController *)self view];
      [v13 safeAreaInsets];
      v15 = v14;
      v16 = [(CKChatController *)self view];
      [v16 safeAreaInsets];
      v18 = v17;
      v19 = [(CKChatController *)self view];
      [v19 safeAreaInsets];
      v8 = v8 - (v18 + v20);
    }

    else
    {
      v15 = 0.0;
    }

    v21 = [(CKChatController *)self entryView];
    [v21 frame];
    v23 = v22;
    v25 = v24;

    if (v23 != v8 || v25 != v10)
    {
      [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
      [(CKChatController *)self setupScrollingForKeyboardInteraction];
      v26 = [(CKScrollViewController *)self isKeyboardFloating];
      [(CKChatController *)self _setEntryViewFrame:v3 animated:v15, 0.0, v8, v10];
      if (v26)
      {
        [(CKScrollViewController *)self inputAccessoryViewFrameUpdatedForFloatingKeyboard];
      }

      v27 = [(CKChatController *)self entryView];
      v28 = [v27 composition];
      v29 = [v28 hasContent];

      if (v29)
      {
        [(CKChatController *)self dismissTipIfPresented];
      }
    }
  }
}

- (void)__setEntryViewFrame:(CGRect)a3
{
  height = a3.size.height;
  width = a3.size.width;
  y = a3.origin.y;
  x = a3.origin.x;
  v20 = [(CKChatController *)self entryView];
  v8 = +[CKUIBehavior sharedBehaviors];
  v9 = [v8 entryViewFollowsKeyboardLayoutGuide];

  if (v9)
  {
    v10 = [v20 heightConstraint];
    [v10 constant];
    if (vabdd_f64(height, v11) <= 0.001)
    {

      goto LABEL_9;
    }

    [v10 setConstant:height];
  }

  else
  {
    v12 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v13 = [v12 isModernSplitViewControllerEnabled];

    if ((v13 & 1) == 0)
    {
      [v20 setFrame:{x, y, width, height}];
      goto LABEL_9;
    }

    [v20 frame];
    v18 = CKRectApproximatelyEqualToRectWithTolerance(v14, v15, v16, v17, x, y, width, height, 0.001);
    [v20 setFrame:{x, y, width, height}];
    v19 = v20;
    if (v18)
    {
      goto LABEL_10;
    }
  }

  [v20 layoutIfNeeded];
  [(CKChatController *)self _layoutEntryViewSuperview];
LABEL_9:
  v19 = v20;
LABEL_10:
}

- (void)_setEntryViewFrame:(CGRect)a3 isContentChange:(BOOL)a4 animated:(BOOL)a5 completionHandler:(id)a6
{
  v6 = a5;
  v7 = a4;
  height = a3.size.height;
  width = a3.size.width;
  y = a3.origin.y;
  x = a3.origin.x;
  v49 = *MEMORY[0x1E69E9840];
  v13 = a6;
  v14 = [(CKChatController *)self entryView];
  if (IMOSLoggingEnabled())
  {
    v15 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v50.origin.x = x;
      v50.origin.y = y;
      v50.size.width = width;
      v50.size.height = height;
      v16 = NSStringFromCGRect(v50);
      *buf = 138412290;
      v48 = v16;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "entryView: setting entry view frame: %@", buf, 0xCu);
    }
  }

  [v14 frame];
  if (v18 != width || v17 != height)
  {
    if (v6)
    {
      if (![(CKChatController *)self isEntryViewResizeAnimationRunning]&& v7)
      {
        v20 = MEMORY[0x1E69DD250];
        v45[0] = MEMORY[0x1E69E9820];
        v45[1] = 3221225472;
        v45[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke;
        v45[3] = &unk_1E72EBA18;
        v46 = v14;
        [v20 performWithoutAnimation:v45];
      }

      [(CKChatController *)self setEntryViewResizeAnimationRunning:1];
      if ([v14 shouldUseLinearResizeForAudioMessage])
      {
        v21 = +[CKUIBehavior sharedBehaviors];
        [v21 audioMessagePeakAnimationDuration];
        v23 = v22;

        v24 = [objc_alloc(MEMORY[0x1E69DC908]) initWithAnimationCurve:3];
      }

      else
      {
        v24 = objc_alloc_init(MEMORY[0x1E69DCF88]);
        [v24 settlingDuration];
        v23 = v26;
      }

      v27 = [objc_alloc(MEMORY[0x1E69DD278]) initWithDuration:v24 timingParameters:v23];
      v44[0] = MEMORY[0x1E69E9820];
      v44[1] = 3221225472;
      v44[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_2;
      v44[3] = &unk_1E72EC7B0;
      v44[4] = self;
      *&v44[5] = x;
      *&v44[6] = y;
      *&v44[7] = width;
      *&v44[8] = height;
      [v27 addAnimations:v44];
      v42[0] = MEMORY[0x1E69E9820];
      v42[1] = 3221225472;
      v42[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_3;
      v42[3] = &unk_1E72ED778;
      v42[4] = self;
      v43 = v13;
      [v27 addCompletion:v42];
      [v27 startAnimation];
    }

    else
    {
      [(CKChatController *)self setEntryViewResizeAnimationRunning:1];
      v25 = MEMORY[0x1E69DD250];
      v41[0] = MEMORY[0x1E69E9820];
      v41[1] = 3221225472;
      v41[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_4;
      v41[3] = &unk_1E72EC7B0;
      v41[4] = self;
      *&v41[5] = x;
      *&v41[6] = y;
      *&v41[7] = width;
      *&v41[8] = height;
      v39[0] = MEMORY[0x1E69E9820];
      v39[1] = 3221225472;
      v39[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_5;
      v39[3] = &unk_1E72ED638;
      v39[4] = self;
      v40 = v13;
      [v25 animateWithDuration:v41 animations:v39 completion:0.0];

      v23 = 0.0;
    }

    [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
    v28 = [(CKChatController *)self entryView];
    v29 = [v28 entryViewKeyboardLayoutGuide];

    [v29 setKeyboardDismissPadding:height];
    v30 = [(CKCoreChatController *)self inputController];
    [v30 setAppCardDismissPadding:height];

    v31 = +[CKUIBehavior sharedBehaviors];
    v32 = [v31 isEntryViewInputAccessory];

    if ((v32 & 1) == 0)
    {
      v33 = [(CKCoreChatController *)self collectionViewController];
      v34 = [v33 collectionView];

      [v34 beginDisablingTranscriptDynamicsForReason:13];
      if (v6)
      {
        [(CKScrollViewController *)self updateScrollGeometryForReason:@"EntryViewFrameChanged" withDuration:3 animationCurve:v23];
        v35 = dispatch_time(0, (v23 * 1000000000.0));
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_6;
        block[3] = &unk_1E72ED1C8;
        v37 = v34;
        v38 = v13;
        dispatch_after(v35, MEMORY[0x1E69E96A0], block);
      }

      else
      {
        [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"EntryViewFrameChanged"];
        [v34 endDisablingTranscriptDynamicsForReason:13];
        v13[2](v13);
      }
    }
  }
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) __setEntryViewFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v3 = [*(a1 + 32) entryView];
  v2 = [v3 contentView];
  [v2 setNeedsLayout];
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_3(uint64_t a1)
{
  [*(a1 + 32) setEntryViewResizeAnimationRunning:0];
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 isEntryViewInputAccessory];

  if (v3)
  {
    v4 = *(*(a1 + 40) + 16);

    v4();
  }
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_4(uint64_t a1)
{
  [*(a1 + 32) __setEntryViewFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v3 = [*(a1 + 32) entryView];
  v2 = [v3 contentView];
  [v2 setNeedsLayout];
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_5(uint64_t a1)
{
  [*(a1 + 32) setEntryViewResizeAnimationRunning:0];
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 isEntryViewInputAccessory];

  if (v3)
  {
    v4 = *(*(a1 + 40) + 16);

    v4();
  }
}

uint64_t __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_6(uint64_t a1)
{
  [*(a1 + 32) endDisablingTranscriptDynamicsForReason:13];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)_setUpEntryViewChatFooterViewLayoutConstraint
{
  v8 = [(CKChatController *)self entryView];
  v3 = [(CKChatController *)self chatFooterView];
  if (v3)
  {
    v4 = [v8 bottomAnchor];
    v5 = [v3 topAnchor];
    v6 = [v4 constraintEqualToAnchor:v5];
    entryViewChatFooterViewLayoutConstraint = self->_entryViewChatFooterViewLayoutConstraint;
    self->_entryViewChatFooterViewLayoutConstraint = v6;
  }

  else
  {
    v4 = self->_entryViewChatFooterViewLayoutConstraint;
    self->_entryViewChatFooterViewLayoutConstraint = 0;
  }
}

- (BOOL)_backgroundEligibleForTranscriptDocking
{
  v14.receiver = self;
  v14.super_class = CKChatController;
  v3 = [(CKCoreChatController *)&v14 _backgroundEligibleForTranscriptDocking];
  if (v3)
  {
    if (([(CKChatController *)self isEditing]& 1) != 0 || [(CKScrollViewController *)self isKeyboardVisible])
    {
      LOBYTE(v3) = 0;
    }

    else
    {
      v4 = [(CKCoreChatController *)self inputController];
      v5 = [v4 isAppCardPresented];

      v6 = [(CKCoreChatController *)self inputController];
      v7 = [v6 isAppCardAppearing];

      v8 = [(CKCoreChatController *)self inputController];
      v9 = [v8 isAppCardDismissing];

      LOBYTE(v3) = 0;
      if ((v5 & 1) == 0 && (v7 & 1) == 0 && (v9 & 1) == 0)
      {
        v10 = [(CKChatController *)self dragSession];

        v11 = [(CKChatController *)self dropSession];
        v12 = v10 | v11;

        LOBYTE(v3) = v12 == 0;
      }
    }
  }

  return v3;
}

- (UIEdgeInsets)adjustedContentInsetsForComputedInsets:(UIEdgeInsets)a3
{
  right = a3.right;
  bottom = a3.bottom;
  left = a3.left;
  top = a3.top;
  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  if ([(CKCoreChatController *)self isTranscriptDockingEnabled])
  {
    v8 = [(CKCoreChatController *)self collectionViewController];
    v9 = [v8 indexPathForLastMessagePart];

    v10 = [(CKChatController *)self collectionView];
    v11 = [v10 collectionViewLayout];
    v12 = [v11 layoutAttributesForItemAtIndexPath:v9];

    v13 = [(CKChatController *)self collectionView];
    v14 = [v13 collectionViewLayout];
    [v14 collectionViewContentSize];
    v16 = v15;
    v18 = v17;

    if (v12 && [(CKCoreChatController *)self _transcriptContentSizeEligibleForTranscriptDocking:v16, v18])
    {
      v19 = [(CKChatController *)self view];
      [v19 bounds];
      Height = CGRectGetHeight(v44);

      v41 = Height - top;
      [v12 frame];
      x = v45.origin.x;
      y = v45.origin.y;
      width = v45.size.width;
      v24 = v45.size.height;
      v43 = right;
      v25 = CGRectGetHeight(v45);
      v26 = +[CKUIBehavior sharedBehaviors];
      [v26 transcriptDockingMaximumBalloonHeight];
      v42 = left;
      v28 = v27;

      if (v25 >= v28)
      {
        v25 = v28;
      }

      v46.origin.x = x;
      v46.origin.y = y;
      v46.size.width = width;
      v46.size.height = v24;
      v29 = v18 - (y + CGRectGetHeight(v46) - v25);
      v30 = [(CKChatController *)self collectionView];
      [v30 bounds];
      v32 = v31;
      v33 = +[CKUIBehavior sharedBehaviors];
      [v33 transcriptDockingMaximumBalloonHeight];
      v35 = v32 - (top + v34 * 3.0);

      if (v29 >= v35)
      {
        v36 = v35;
      }

      else
      {
        v36 = v29;
      }

      left = v42;
      right = v43;
      bottom = v41 - v36;
    }
  }

  v37 = top;
  v38 = left;
  v39 = bottom;
  v40 = right;
  result.right = v40;
  result.bottom = v39;
  result.left = v38;
  result.top = v37;
  return result;
}

- (void)setUpEntryViewLayoutConstraintsIfNecessary
{
  v56 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      LOWORD(v54) = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "setUpEntryViewLayoutConstraintsIfNecessary", &v54, 2u);
    }
  }

  v4 = +[CKUIBehavior sharedBehaviors];
  v5 = [v4 entryViewFollowsKeyboardLayoutGuide];

  if (v5)
  {
    v6 = [(CKChatController *)self entryView];
    v7 = [v6 superview];
    if (v7)
    {
      if (!self->_entryViewLeadingLayoutConstraint)
      {
        v8 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        v9 = [v8 isModernSplitViewControllerEnabled];

        if (v9)
        {
          v10 = [v7 safeAreaLayoutGuide];
          v11 = [v10 leadingAnchor];
        }

        else
        {
          v11 = [v7 leadingAnchor];
        }

        v14 = [v6 leadingAnchor];
        v15 = [v14 constraintEqualToAnchor:v11];
        entryViewLeadingLayoutConstraint = self->_entryViewLeadingLayoutConstraint;
        self->_entryViewLeadingLayoutConstraint = v15;

        [(NSLayoutConstraint *)self->_entryViewLeadingLayoutConstraint setActive:1];
      }

      if (!self->_entryViewTrailingLayoutConstraint)
      {
        v17 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        v18 = [v17 isModernSplitViewControllerEnabled];

        if (v18)
        {
          v19 = [v7 safeAreaLayoutGuide];
          v20 = [v19 trailingAnchor];
        }

        else
        {
          v20 = [v7 trailingAnchor];
        }

        v21 = [v6 trailingAnchor];
        v22 = [v21 constraintEqualToAnchor:v20];
        entryViewTrailingLayoutConstraint = self->_entryViewTrailingLayoutConstraint;
        self->_entryViewTrailingLayoutConstraint = v22;

        [(NSLayoutConstraint *)self->_entryViewTrailingLayoutConstraint setActive:1];
      }

      v24 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v25 = [v24 isEntryViewUsesKeyboardLayoutGuideEnabled];

      if (v25)
      {
        v26 = [v7 keyboardLayoutGuide];
        [v26 setFollowsUndockedKeyboard:0];
        [v26 followUndockedKeyboardOfTypes:28];
        v27 = +[CKUIBehavior sharedBehaviors];
        [v26 setIgnoresSafeArea:{objc_msgSend(v27, "entryFieldShouldUseBackdropView")}];

        v28 = [(CKChatController *)self entryView];
        [v28 setEntryViewKeyboardLayoutGuide:v26];

        entryViewKeyboardLayoutConstraint = self->_entryViewKeyboardLayoutConstraint;
        if (entryViewKeyboardLayoutConstraint)
        {
          [(NSLayoutConstraint *)entryViewKeyboardLayoutConstraint setActive:0];
        }

        v30 = [v6 bottomAnchor];
        v31 = [v26 topAnchor];
        v32 = [v30 constraintEqualToAnchor:v31];
        v33 = self->_entryViewKeyboardLayoutConstraint;
        self->_entryViewKeyboardLayoutConstraint = v32;

        if (self->_entryViewContainerView)
        {
          v34 = [v6 bottomAnchor];
          v35 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView bottomAnchor];
          v36 = [v34 constraintEqualToAnchor:v35];
          [(CKMessageEntryViewContainerView *)self->_entryViewContainerView setEntryViewStuckToChatControllerBottomLayoutConstraint:v36];
        }

        if (IMOSLoggingEnabled())
        {
          v37 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v54 = 138412290;
            v55 = v26;
            _os_log_impl(&dword_19020E000, v37, OS_LOG_TYPE_INFO, "entryView: set entry view to keyboard top anchor: %@", &v54, 0xCu);
          }
        }
      }

      else
      {
        v38 = [v7 bottomAnchor];
        v39 = [v6 bottomAnchor];
        v40 = [v38 constraintEqualToAnchor:v39 constant:0.0];
        entryViewFauxKeyboardLayoutConstraint = self->_entryViewFauxKeyboardLayoutConstraint;
        self->_entryViewFauxKeyboardLayoutConstraint = v40;

        [(CKScrollViewController *)self keyboardFrameInViewCoordinates];
        [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:?];
      }

      [v7 bounds];
      [v6 sizeThatFits:{v42, 1.79769313e308}];
      v44 = v43;
      v45 = [v6 heightConstraint];
      v46 = v45 == 0;

      if (v46)
      {
        v47 = [v6 heightAnchor];
        v48 = [v47 constraintEqualToConstant:v44];
        [v6 setHeightConstraint:v48];
      }

      else
      {
        v47 = [v6 heightConstraint];
        [v47 setConstant:v44];
      }

      if (IMOSLoggingEnabled())
      {
        v49 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
        {
          v50 = MEMORY[0x1E696AD98];
          v51 = [v6 heightConstraint];
          [v51 constant];
          v52 = [v50 numberWithDouble:?];
          v54 = 138412290;
          v55 = v52;
          _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "entryView: heightConstraint.constant: %@", &v54, 0xCu);
        }
      }

      v53 = [v6 heightConstraint];
      [v53 setActive:1];

      [(CKChatController *)self _setUpEntryViewAppCardLayoutConstraint];
      [(CKChatController *)self _setUpEntryViewChatFooterViewLayoutConstraint];
      [(CKChatController *)self updateActiveEntryViewPositioningGuide];
      [v7 layoutIfNeeded];
      [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"EntryViewCreated"];
    }

    else if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        LOWORD(v54) = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "entryView: not in view hierarchy", &v54, 2u);
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      LOWORD(v54) = 0;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "entryView: not using layout constraints", &v54, 2u);
    }
  }
}

- (void)_updateEntryViewConstraintsIfNeeded
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 window];

  if (v4)
  {

    [(CKChatController *)self setUpEntryViewLayoutConstraintsIfNecessary];
  }

  else
  {

    [(CKChatController *)self _invalidateEntryViewConstraints];
  }
}

- (void)_invalidateEntryViewConstraints
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v12 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Invalidating entry view constraints.", v12, 2u);
    }
  }

  [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewLeadingLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewTrailingLayoutConstraint setActive:0];
  v4 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
  [v4 setActive:0];

  entryViewFauxKeyboardLayoutConstraint = self->_entryViewFauxKeyboardLayoutConstraint;
  self->_entryViewFauxKeyboardLayoutConstraint = 0;

  entryViewKeyboardLayoutConstraint = self->_entryViewKeyboardLayoutConstraint;
  self->_entryViewKeyboardLayoutConstraint = 0;

  entryViewKeyboardSnapshotLayoutConstraint = self->_entryViewKeyboardSnapshotLayoutConstraint;
  self->_entryViewKeyboardSnapshotLayoutConstraint = 0;

  entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;
  self->_entryViewAppCardLayoutConstraint = 0;

  entryViewChatFooterViewLayoutConstraint = self->_entryViewChatFooterViewLayoutConstraint;
  self->_entryViewChatFooterViewLayoutConstraint = 0;

  entryViewLeadingLayoutConstraint = self->_entryViewLeadingLayoutConstraint;
  self->_entryViewLeadingLayoutConstraint = 0;

  entryViewTrailingLayoutConstraint = self->_entryViewTrailingLayoutConstraint;
  self->_entryViewTrailingLayoutConstraint = 0;

  [(CKMessageEntryViewContainerView *)self->_entryViewContainerView setEntryViewStuckToChatControllerBottomLayoutConstraint:0];
}

- (void)_setUpEntryViewAppCardLayoutConstraint
{
  v13 = [(CKChatController *)self entryView];
  v3 = [v13 window];
  entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;
  if (v3)
  {
    v5 = [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint firstItem];
    v6 = v5;
    if (v3 == v5)
    {
      v7 = [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint secondItem];
      v8 = [(CKChatController *)self entryView];

      if (v7 == v8)
      {
        goto LABEL_8;
      }
    }

    else
    {
    }

    entryViewAppCardLayoutConstraint = [v3 bottomAnchor];
    v9 = [v13 bottomAnchor];
    v10 = [(CKCoreChatController *)self inputController];
    [v10 _appCardHeightWithSafeArea];
    v11 = [entryViewAppCardLayoutConstraint constraintEqualToAnchor:v9 constant:?];
    v12 = self->_entryViewAppCardLayoutConstraint;
    self->_entryViewAppCardLayoutConstraint = v11;
  }

  else
  {
    self->_entryViewAppCardLayoutConstraint = 0;
  }

LABEL_8:
}

- (double)_expectedAppCardAndEntryViewHeight
{
  v24 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v4 = MEMORY[0x1E696AD98];
      v5 = [(CKCoreChatController *)self inputController];
      [v5 _appCardHeightWithSafeArea];
      v6 = [v4 numberWithDouble:?];
      v7 = MEMORY[0x1E696AD98];
      v8 = [(CKChatController *)self entryView];
      [v8 frame];
      v10 = [v7 numberWithDouble:v9];
      v18 = 136315650;
      v19 = "[CKChatController _expectedAppCardAndEntryViewHeight]";
      v20 = 2112;
      v21 = v6;
      v22 = 2112;
      v23 = v10;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "[Tapbacks] %s, : %@ entryView.frame: %@", &v18, 0x20u);
    }
  }

  v11 = [(CKCoreChatController *)self inputController];
  [v11 _appCardHeightWithSafeArea];
  v13 = v12;
  v14 = [(CKChatController *)self entryView];
  [v14 frame];
  v16 = v15;

  return v13 + v16;
}

- (void)updateChatItemBalloonViewAndStickerViews:(id)a3 hidden:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  v7 = objc_opt_new();
  if (v4)
  {
    v8 = [(CKCoreChatController *)self collectionViewController];
    v9 = [v8 balloonViewForChatItem:v6];
    v10 = [v8 indexPathForBalloonView:v9];
    [v7 addIndex:{objc_msgSend(v10, "row")}];
  }

  v11 = [(CKCoreChatController *)self collectionViewController];
  [v11 setHiddenBalloonViews:v7];

  v12 = [MEMORY[0x1E696AD50] indexSet];
  if (v4)
  {
    v13 = [v6 visibleAssociatedMessageChatItems];
    v15 = MEMORY[0x1E69E9820];
    v16 = 3221225472;
    v17 = __68__CKChatController_updateChatItemBalloonViewAndStickerViews_hidden___block_invoke;
    v18 = &unk_1E72ED7A0;
    v19 = self;
    v20 = v12;
    [v13 enumerateObjectsUsingBlock:&v15];
  }

  v14 = [(CKCoreChatController *)self collectionViewController:v15];
  [v14 setHiddenAssociatedItems:v12];
}

void __68__CKChatController_updateChatItemBalloonViewAndStickerViews_hidden___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = [*(a1 + 32) collectionViewController];
    v4 = [v3 associatedChatItems];
    v5 = [v4 indexOfObject:v6];

    [*(a1 + 40) addIndex:v5];
  }
}

- (void)associatedStickerCells:(id *)a3 stickerChatItems:(id *)a4 chatItemGUID:(id)a5
{
  v8 = a5;
  v9 = [(CKCoreChatController *)self collectionViewController];
  v10 = [v9 chatItemForGUID:v8];

  v11 = [MEMORY[0x1E695DF70] array];
  v12 = [MEMORY[0x1E695DF70] array];
  v13 = [v10 visibleAssociatedMessageChatItems];
  v17[0] = MEMORY[0x1E69E9820];
  v17[1] = 3221225472;
  v17[2] = __73__CKChatController_associatedStickerCells_stickerChatItems_chatItemGUID___block_invoke;
  v17[3] = &unk_1E72ED7C8;
  v18 = v9;
  v14 = v11;
  v19 = v14;
  v15 = v12;
  v20 = v15;
  v16 = v9;
  [v13 enumerateObjectsUsingBlock:v17];

  if (a3)
  {
    *a3 = [v14 copy];
  }

  if (a4)
  {
    *a4 = [v15 copy];
  }
}

void __73__CKChatController_associatedStickerCells_stickerChatItems_chatItemGUID___block_invoke(id *a1, void *a2)
{
  v8 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v4 = v8;
  if (isKindOfClass)
  {
    v5 = v8;
    v6 = [a1[4] cellForAssociatedChatItem:v5];
    v7 = v6;
    if (v5 && v6)
    {
      [a1[5] addObject:v6];
      [a1[6] addObject:v5];
    }

    v4 = v8;
  }
}

- (void)_updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:(CGRect)a3
{
  height = a3.size.height;
  width = a3.size.width;
  y = a3.origin.y;
  x = a3.origin.x;
  v22 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v23.origin.x = x;
      v23.origin.y = y;
      v23.size.width = width;
      v23.size.height = height;
      v9 = NSStringFromCGRect(v23);
      v20 = 138412290;
      v21 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "entryView: updating faux keyboard layout guide with keyboard frame: %@", &v20, 0xCu);
    }
  }

  v10 = +[CKUIBehavior sharedBehaviors];
  v11 = [v10 entryViewFollowsKeyboardLayoutGuide];

  if (v11 && self->_entryViewFauxKeyboardLayoutConstraint)
  {
    v12 = [(CKScrollViewController *)self isKeyboardUndocked];
    v13 = height <= 0.0 || v12;
    v14 = 0.0;
    if ((v13 & 1) == 0)
    {
      v15 = [(CKChatController *)self view];
      [v15 bounds];
      v17 = v16;
      v24.origin.x = x;
      v24.origin.y = y;
      v24.size.width = width;
      v24.size.height = height;
      MinY = CGRectGetMinY(v24);

      v14 = v17 - MinY;
    }

    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint constant];
    if (vabdd_f64(v19, v14) > 0.00000011920929)
    {
      [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setConstant:v14];
    }
  }
}

- (void)_updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:(id)a3
{
  v4 = a3;
  v5 = +[CKUIBehavior sharedBehaviors];
  v6 = [v5 entryViewFollowsKeyboardLayoutGuide];

  if (v6 && ![(CKChatController *)self suppressEntryViewKeyboardNotifications])
  {
    v7 = [v4 userInfo];
    v8 = *MEMORY[0x1E69DDFA0];
    v9 = [v7 objectForKeyedSubscript:*MEMORY[0x1E69DDFA0]];

    if (!v9)
    {
      v30 = IMLogHandleForCategory();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:];
      }

      goto LABEL_20;
    }

    [v9 CGRectValue];
    v11 = v10;
    v13 = v12;
    v15 = v14;
    v17 = v16;
    v18 = [(CKChatController *)self view];
    v19 = [v18 window];
    v20 = [(CKChatController *)self view];
    [v19 convertRect:v20 toView:{v11, v13, v15, v17}];
    v22 = v21;
    v24 = v23;
    v26 = v25;
    v28 = v27;

    v29 = [v4 userInfo];
    v30 = [v29 objectForKeyedSubscript:*MEMORY[0x1E69DDF40]];

    [v30 doubleValue];
    v32 = v31;
    v33 = [v4 userInfo];
    v34 = [v33 objectForKeyedSubscript:*MEMORY[0x1E69DDF38]];

    v35 = [v34 integerValue];
    if ([objc_opt_class() supportsTranscriptBackground])
    {
      v36 = [v4 name];
      v37 = [v36 isEqualToString:*MEMORY[0x1E69DDF68]];

      if (v37)
      {
        v38 = [(CKCoreChatController *)self transcriptBackground];
        [(CKChatController *)self _keyboardFrameAccountingForSalientTranscriptBackgroundRect:v22, v24, v26, v28];
        v40 = v39;
        v41 = v32;
        v42 = v22;
        v43 = v24;
        v44 = v26;
        v45 = v28;
        v144 = v41;
        v46 = v41;
        *&v131 = v46;
        v28 = v45;
        v26 = v44;
        v24 = v43;
        v22 = v42;
        [v38 keyboardFrameDidChange:v35 accountingForSalientRectFrame:-[CKScrollViewController isKeyboardVisible](self duration:"isKeyboardVisible") curve:v42 isVisible:{v24, v26, v28, v40, v47, v48, v49, v131}];
LABEL_13:

        v32 = v144;
        goto LABEL_14;
      }

      v50 = [v4 name];
      v51 = [v50 isEqualToString:*MEMORY[0x1E69DE080]];

      if (v51)
      {
        v132 = [(CKChatController *)self view];
        v52 = [v132 window];
        [v4 userInfo];
        v53 = v142 = v35;
        v54 = [v53 objectForKeyedSubscript:*MEMORY[0x1E69DDF98]];
        [v54 CGRectValue];
        v144 = v32;
        v56 = v55;
        v58 = v57;
        v60 = v59;
        v62 = v61;
        v63 = [(CKChatController *)self view];
        [v52 convertRect:v63 toView:{v56, v58, v60, v62}];
        v134 = v64;
        v136 = v65;
        v138 = v67;
        v140 = v66;

        v68 = [(CKChatController *)self view];
        v69 = [v68 window];
        v70 = [v4 userInfo];
        v71 = [v70 objectForKeyedSubscript:v8];
        [v71 CGRectValue];
        v73 = v72;
        v75 = v74;
        v77 = v76;
        v79 = v78;
        v80 = [(CKChatController *)self view];
        [v69 convertRect:v80 toView:{v73, v75, v77, v79}];
        v82 = v81;
        v84 = v83;
        v86 = v85;
        v88 = v87;

        v35 = v142;
        v38 = [(CKCoreChatController *)self transcriptBackground];
        v89 = v144;
        *&v131 = v89;
        [v38 keyboardWillShowFromFrame:v142 toFrame:1 duration:v134 curve:v140 isVisible:{v138, v136, v82, v84, v86, v88, v131}];
        goto LABEL_13;
      }

      v90 = [v4 name];
      v91 = [v90 isEqualToString:*MEMORY[0x1E69DE078]];

      if (v91)
      {
        v133 = [(CKChatController *)self view];
        v92 = [v133 window];
        v93 = [v4 userInfo];
        [v93 objectForKeyedSubscript:*MEMORY[0x1E69DDF98]];
        v94 = v143 = v35;
        [v94 CGRectValue];
        v144 = v32;
        v96 = v95;
        v98 = v97;
        v100 = v99;
        v102 = v101;
        v103 = [(CKChatController *)self view];
        [v92 convertRect:v103 toView:{v96, v98, v100, v102}];
        v139 = v105;
        v141 = v104;
        v135 = v107;
        v137 = v106;

        v108 = [(CKChatController *)self view];
        v109 = [v108 window];
        v110 = [v4 userInfo];
        v111 = [v110 objectForKeyedSubscript:v8];
        [v111 CGRectValue];
        v113 = v112;
        v115 = v114;
        v117 = v116;
        v119 = v118;
        v120 = [(CKChatController *)self view];
        [v109 convertRect:v120 toView:{v113, v115, v117, v119}];
        v122 = v121;
        v124 = v123;
        v126 = v125;
        v128 = v127;

        v35 = v143;
        v38 = [(CKCoreChatController *)self transcriptBackground];
        v129 = v144;
        *&v131 = v129;
        [v38 keyboardWillHideFromFrame:v143 toFrame:0 duration:v141 curve:v139 isVisible:{v137, v135, v122, v124, v126, v128, v131}];
        goto LABEL_13;
      }
    }

LABEL_14:
    if (self->_entryViewFauxKeyboardLayoutConstraint)
    {
      if (v32 > 0.0 && [(CKCoreChatController *)self viewIsVisible])
      {
        v130 = [(CKChatController *)self _animationOptionsFromCurve:v35];
        v146[0] = MEMORY[0x1E69E9820];
        v146[1] = 3221225472;
        v146[2] = __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke;
        v146[3] = &unk_1E72EC7B0;
        v146[4] = self;
        *&v146[5] = v22;
        *&v146[6] = v24;
        *&v146[7] = v26;
        *&v146[8] = v28;
        [MEMORY[0x1E69DD250] animateWithDuration:v130 | 4 delay:v146 options:&__block_literal_global_1171_0 animations:v32 completion:0.0];
      }

      else
      {
        v145[0] = MEMORY[0x1E69E9820];
        v145[1] = 3221225472;
        v145[2] = __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke_3;
        v145[3] = &unk_1E72EC7B0;
        v145[4] = self;
        *&v145[5] = v22;
        *&v145[6] = v24;
        *&v145[7] = v26;
        *&v145[8] = v28;
        [MEMORY[0x1E69DD250] performWithoutAnimation:v145];
      }
    }

LABEL_20:
  }
}

void __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v2 = [*(a1 + 32) view];
  [v2 setNeedsLayout];

  v3 = [*(a1 + 32) view];
  [v3 layoutIfNeeded];
}

void __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke_3(uint64_t a1)
{
  [*(a1 + 32) _updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v2 = [*(a1 + 32) view];
  [v2 setNeedsLayout];

  v3 = [*(a1 + 32) view];
  [v3 layoutIfNeeded];
}

- (CGRect)_keyboardFrameAccountingForSalientTranscriptBackgroundRect:(CGRect)a3
{
  width = a3.size.width;
  x = a3.origin.x;
  [(CKChatController *)self salientTranscriptBackgroundRect:a3.origin.x];
  height = v15.size.height;
  MaxY = CGRectGetMaxY(v15);
  v8 = [(CKChatController *)self view];
  [v8 frame];
  v10 = v9 - height;

  v11 = x;
  v12 = MaxY;
  v13 = width;
  v14 = v10;
  result.size.height = v14;
  result.size.width = v13;
  result.origin.y = v12;
  result.origin.x = v11;
  return result;
}

- (unint64_t)_animationOptionsFromCurve:(int64_t)a3
{
  if ((a3 - 1) >= 3)
  {
    return 0;
  }

  else
  {
    return ((a3 - 1) << 16) + 0x10000;
  }
}

- (BOOL)pluginButtonsEnabled
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 isStewieConversation];

  if (v4)
  {
    return 0;
  }

  v6 = MEMORY[0x1E69A5CA0];
  v7 = [(CKCoreChatController *)self conversation];
  v8 = [v7 lastAddressedHandle];
  v9 = [(CKCoreChatController *)self conversation];
  v10 = [v9 lastAddressedSIMID];
  LOBYTE(v6) = [v6 mmsEnabledforPhoneNumber:v8 simID:v10];

  return (v6 & 1) != 0 || CKiMessageSupported() != 0;
}

- (void)setTargetFirstResponder:(int64_t)a3
{
  v11 = *MEMORY[0x1E69E9840];
  if (self->_targetFirstResponder != a3)
  {
    if (IMOSLoggingEnabled())
    {
      v5 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
      {
        targetFirstResponder = self->_targetFirstResponder;
        v7 = 134218240;
        v8 = targetFirstResponder;
        v9 = 2048;
        v10 = a3;
        _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Target first responder changing from %lu to %lu", &v7, 0x16u);
      }
    }

    self->_targetFirstResponder = a3;
    self->_becomingFirstResponderInProgress = 0;
  }
}

- (BOOL)canBecomeFirstResponder
{
  v3 = [(CKCoreChatController *)self shouldDisplayTextEntry];
  if (v3)
  {
    LOBYTE(v3) = ![(CKChatController *)self isShowingCamera];
  }

  return v3;
}

- (BOOL)becomeFirstResponder
{
  v24 = *MEMORY[0x1E69E9840];
  if (self->_becomingFirstResponderInProgress)
  {
    LOBYTE(v2) = 0;
    return v2;
  }

  self->_becomingFirstResponderInProgress = 1;
  v4 = [(CKChatController *)self targetFirstResponder];
  v5 = v4;
  switch(v4)
  {
    case 3:
      v9 = [(CKChatController *)self messageEditingViewController];
      v2 = [v9 becomeFirstResponder];

      break;
    case 1:
      if (([(CKChatController *)self isEditing]& 1) == 0)
      {
        v8 = [(CKCoreChatController *)self fullScreenBalloonViewController];

        if (!v8)
        {
          self->_nextEntryViewSafeAreaInsetUpdateIsSynchronous = 1;
          v15 = [(CKChatController *)self entryView];
          v16 = [v15 contentView];
          v17 = [v16 activeView];
          if ([v17 becomeFirstResponder])
          {
            v2 = 1;
          }

          else
          {
            v18.receiver = self;
            v18.super_class = CKChatController;
            v2 = [(CKChatController *)&v18 becomeFirstResponder];
          }

          break;
        }
      }

      break;
    case 0:
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "No target FR, making chat controller FR", buf, 2u);
        }
      }

      v7 = [(CKCoreChatController *)self inputController];
      [v7 clearBrowserViewControllerIfNecessary];

      v19.receiver = self;
      v19.super_class = CKChatController;
      v2 = [(CKChatController *)&v19 becomeFirstResponder];
      break;
    default:
      v2 = 0;
      break;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = [MEMORY[0x1E696AD98] numberWithInteger:v5];
      v12 = v11;
      v13 = @"NO";
      if (v2)
      {
        v13 = @"YES";
      }

      *buf = 138412546;
      v21 = v11;
      v22 = 2112;
      v23 = v13;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "targetFirstResponder: %@, didBecomeFirstResponder: %@", buf, 0x16u);
    }
  }

  self->_becomingFirstResponderInProgress = 0;
  return v2;
}

- (id)consumingBundleIdentifiers
{
  v30 = *MEMORY[0x1E69E9840];
  v3 = [MEMORY[0x1E695DF70] array];
  v4 = [(CKCoreChatController *)self inputController];
  v5 = [v4 browserPlugin];

  if (v5)
  {
    v6 = [v5 identifier];
    [v3 addObject:v6];
  }

  v7 = [(CKChatController *)self entryView];
  v8 = [v7 composition];
  v9 = [v8 shelfPluginPayload];

  if (v9)
  {
    v10 = [v9 pluginBundleID];
    [v3 addObject:v10];
  }

  v11 = [(CKCoreChatController *)self collectionViewController];
  v12 = [v11 chatItems];

  if ([v12 count])
  {
    v24 = v5;
    v13 = [(CKChatController *)self collectionView];
    v14 = [v13 indexPathsForVisibleItems];

    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    v15 = v14;
    v16 = [v15 countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v16)
    {
      v17 = v16;
      v18 = *v26;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v26 != v18)
          {
            objc_enumerationMutation(v15);
          }

          v20 = [*(*(&v25 + 1) + 8 * i) item];
          if (v20 < [v12 count])
          {
            v21 = [v12 objectAtIndex:v20];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v22 = [v21 bundleIdentifier];
              [v3 addObject:v22];
            }
          }
        }

        v17 = [v15 countByEnumeratingWithState:&v25 objects:v29 count:16];
      }

      while (v17);
    }

    v5 = v24;
  }

  return v3;
}

- (id)generatedSummary
{
  v2 = [(CKCoreChatController *)self chat];
  v3 = [v2 chatSummary];
  v4 = [v3 string];

  return v4;
}

- (id)generativeContext
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 generativeContextHistory];

  return v3;
}

- (void)_addAppCardBackgroundView
{
  v30[4] = *MEMORY[0x1E69E9840];
  v3 = +[CKAppCardLoadingViewProvider spinnerViewController];
  [(CKChatController *)self setAppCardBackgroundViewController:v3];

  v4 = [(CKChatController *)self appCardBackgroundViewController];
  [(CKChatController *)self addChildViewController:v4];

  v5 = [(CKChatController *)self view];
  v6 = [(CKChatController *)self appCardBackgroundViewController];
  v7 = [v6 view];
  [v5 addSubview:v7];

  v8 = [(CKChatController *)self appCardBackgroundViewController];
  [v8 didMoveToParentViewController:self];

  v9 = [(CKChatController *)self appCardBackgroundViewController];
  v10 = [v9 view];

  v28 = [v10 topAnchor];
  v29 = [(CKChatController *)self entryView];
  v27 = [v29 bottomAnchor];
  v26 = [v28 constraintEqualToAnchor:v27];
  v30[0] = v26;
  v24 = [v10 leadingAnchor];
  v25 = [(CKChatController *)self view];
  v23 = [v25 leadingAnchor];
  v22 = [v24 constraintEqualToAnchor:v23];
  v30[1] = v22;
  v21 = [v10 trailingAnchor];
  v11 = [(CKChatController *)self view];
  v12 = [v11 trailingAnchor];
  v13 = [v21 constraintEqualToAnchor:v12];
  v30[2] = v13;
  v14 = [v10 bottomAnchor];
  v15 = [(CKChatController *)self view];
  v16 = [v15 bottomAnchor];
  v17 = [v14 constraintEqualToAnchor:v16];
  v30[3] = v17;
  v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:4];
  [(CKChatController *)self setAppCardBackgroundViewConstraints:v18];

  v19 = MEMORY[0x1E696ACD8];
  v20 = [(CKChatController *)self appCardBackgroundViewConstraints];
  [v19 activateConstraints:v20];

  [v10 setTranslatesAutoresizingMaskIntoConstraints:0];
}

- (void)addAppCardBackgroundViewIfNecessary
{
  v3 = [(CKChatController *)self appCardBackgroundViewController];
  if (v3)
  {
  }

  else
  {
    v4 = [(CKChatController *)self entryView];
    v5 = [v4 window];

    if (v5)
    {
      v6 = [(CKCoreChatController *)self inputController];
      v7 = [(CKChatController *)self traitCollection];
      v8 = [v6 determineSendMenuPresentationStyleCompatibleWithTraitCollection:v7];

      if (!v8)
      {

        [(CKChatController *)self _addAppCardBackgroundView];
      }
    }
  }
}

- (void)removeAppCardBackgroundViewIfNecessary
{
  v3 = [(CKChatController *)self appCardBackgroundViewController];

  if (v3)
  {
    v4 = [(CKChatController *)self appCardBackgroundViewController];
    [v4 willMoveToParentViewController:0];

    v5 = [(CKChatController *)self appCardBackgroundViewController];
    v6 = [v5 view];
    [v6 removeFromSuperview];

    v7 = [(CKChatController *)self appCardBackgroundViewController];
    [v7 removeFromParentViewController];

    v8 = MEMORY[0x1E696ACD8];
    v9 = [(CKChatController *)self appCardBackgroundViewConstraints];
    [v8 deactivateConstraints:v9];

    [(CKChatController *)self setAppCardBackgroundViewConstraints:0];

    [(CKChatController *)self setAppCardBackgroundViewController:0];
  }
}

- (void)appCardDidChangeEntryViewAlignmentHeight:(double)a3 animated:(BOOL)a4
{
  entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;
  if (!entryViewAppCardLayoutConstraint || ([(NSLayoutConstraint *)entryViewAppCardLayoutConstraint constant], vabdd_f64(a3, v8) >= 0.001))
  {
    v9 = [(CKCoreChatController *)self collectionViewController];
    v10 = [v9 collectionView];

    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setConstant:a3];
    if (a4)
    {
      v11 = *MEMORY[0x1E69DDFD8];
      v12 = UIViewAnimationCurveForCKAnimationCurve(103);
    }

    else
    {
      [(CKChatController *)self _layoutEntryViewSuperview];
      v11 = 0.0;
      v12 = 3;
    }

    [(CKScrollViewController *)self updateScrollGeometryForReason:@"AppCardChangedHeight" withDuration:v12 animationCurve:v11];
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __70__CKChatController_appCardDidChangeEntryViewAlignmentHeight_animated___block_invoke;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [(CKScrollViewController *)self scrollWithDuration:v12 animationCurve:v14 scrollBlock:v11];
    v13 = [CKScrollViewAnimationProperties animatedWithDuration:v12 animationCurve:v11];
    [v10 enforceTranscriptScrollIntentWithAnimationProperties:v13];
  }
}

void __70__CKChatController_appCardDidChangeEntryViewAlignmentHeight_animated___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _layoutEntryViewSuperview];
  v2 = [*(a1 + 32) view];
  [v2 layoutIfNeeded];
}

- (void)appCardViewStateDidChange:(BOOL)a3
{
  if (a3)
  {
    [(CKChatController *)self removeAppCardBackgroundViewIfNecessary];
  }

  else
  {
    [(CKChatController *)self addAppCardBackgroundViewIfNecessary];
  }
}

- (void)appCardDidDismiss
{
  v3 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  if (([v3 appeared] & 1) == 0)
  {
    goto LABEL_4;
  }

  v4 = [(CKCoreChatController *)self inputController];
  if ([v4 didDismissAppCardForStickerDrag])
  {

LABEL_4:
    goto LABEL_5;
  }

  v5 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  v6 = [v5 displayConfiguration];
  v7 = [v6 shouldDismissWithAppCard];

  if (v7)
  {
    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  }

LABEL_5:
  [(CKChatController *)self updateEntryViewHeightWithContentChange:0 animated:1];
  [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"AppCardDismissed"];

  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
}

- (double)_keyboardHeightFromLayoutGuide
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 entryViewKeyboardLayoutGuide];

  [v4 layoutFrame];
  x = v14.origin.x;
  y = v14.origin.y;
  width = v14.size.width;
  height = v14.size.height;
  v9 = 0.0;
  if (!CGRectEqualToRect(v14, *MEMORY[0x1E695F058]))
  {
    v10 = [v4 owningView];
    v11 = [(CKChatController *)self view];
    [v11 convertRect:v10 fromView:{x, y, width, height}];
    MinY = CGRectGetMinY(v15);
    [v11 bounds];
    v9 = CGRectGetMaxY(v16) - MinY;
  }

  return v9;
}

- (id)activeSendMenuPresentationForChatInputController:(id)a3
{
  v4 = [(CKChatController *)self sendMenuDelegate];
  v5 = [v4 activeSendMenuPresentationForChatController:self];

  return v5;
}

- (void)enforceSendMenuOrderingInWindowSubviews
{
  if (self->_keyboardSnapshotView)
  {
    v3 = [(CKChatController *)self view];
    v4 = [v3 window];
    [v4 bringSubviewToFront:self->_keyboardSnapshotView];
  }

  v5 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  [v5 enforceSendMenuOrderingInWindowSubviews];
}

- (id)chatInputTranscriptIdentifier
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 transcriptIdentifier];

  return v3;
}

- (id)viewForDragAndChatInputDropTarget
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 view];

  return v3;
}

- (id)keyboardLayoutGuideForAppCardPresentation
{
  v2 = [(CKChatController *)self entryView];
  v3 = [v2 entryViewKeyboardLayoutGuide];

  return v3;
}

- (void)chatInputSentComposition:(id)a3
{
  v14 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  v6 = [v5 recipients];
  if ([v6 count])
  {
    v7 = [(CKCoreChatController *)self conversation];
    v11 = 0;
    v8 = [v7 canSendComposition:v4 error:&v11];
    v9 = v11;

    if (v8)
    {
      [(CKChatController *)self sendCompositionIfAllowed:v4];
      goto LABEL_9;
    }
  }

  else
  {

    v9 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v13 = v9;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Failed to send composition with error: %@", buf, 0xCu);
    }
  }

LABEL_9:
}

- (BOOL)chatInputControllerCanSend:(id)a3
{
  v24 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  if ([v5 hasLeftGroupChat])
  {
    goto LABEL_4;
  }

  v6 = [(CKCoreChatController *)self conversation];
  if ([v6 isBusinessChatDisabled])
  {

LABEL_4:
    goto LABEL_5;
  }

  v17 = [(CKCoreChatController *)self isReadOnly];

  if (!v17)
  {
    v15 = 1;
    goto LABEL_19;
  }

LABEL_5:
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v8 = [(CKCoreChatController *)self conversation];
      if ([v8 hasLeftGroupChat])
      {
        v9 = @"YES";
      }

      else
      {
        v9 = @"NO";
      }

      v10 = [(CKCoreChatController *)self conversation];
      v11 = [v10 isBusinessChatDisabled];
      v12 = [(CKCoreChatController *)self isReadOnly];
      if (v11)
      {
        v13 = @"YES";
      }

      else
      {
        v13 = @"NO";
      }

      v18 = 138412802;
      if (v12)
      {
        v14 = @"YES";
      }

      else
      {
        v14 = @"NO";
      }

      v19 = v9;
      v20 = 2112;
      v21 = v13;
      v22 = 2112;
      v23 = v14;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Cannot send, leftGroupChat: %@, isBusinessChatDisabled: %@, readOnlyChat: %@", &v18, 0x20u);
    }
  }

  v15 = 0;
LABEL_19:

  return v15;
}

- (void)sendSticker:(id)a3 withDragTarget:(id)a4 draggedSticker:(id)a5
{
  v73[12] = *MEMORY[0x1E69E9840];
  v7 = a3;
  v8 = a4;
  [v7 prepareToSend];
  v9 = [MEMORY[0x1E69A8168] sharedInstance];
  [v9 trackEvent:*MEMORY[0x1E69A7740]];

  v10 = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
  [v10 invalidate];

  [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
  [v8 screenCoordinate];
  v12 = v11;
  v14 = v13;
  [v8 scale];
  v16 = v15;
  [v8 rotation];
  if (v8)
  {
    v18 = v17;
    v19 = [(CKCoreChatController *)self collectionViewController];
    v20 = [(CKChatController *)self selectedBalloonForTarget:v8];
    if (!v20)
    {
LABEL_21:

      goto LABEL_22;
    }

    v21 = [v19 chatItems];
    v22 = [v21 objectAtIndex:{objc_msgSend(v20, "row")}];

    v23 = [v19 balloonViewForChatItem:v22];
    v24 = v23;
    if (v23)
    {
      v25 = [v23 superview];
      [v24 frame];
      [v25 convertRect:0 toView:?];
      v27 = v26;
      v29 = v28;
      v31 = v30;
      v33 = v32;

      v34 = (v12 - v27) / v31;
      v35 = (v14 - v29) / v33;
      [v22 size];
      v37 = v36;
      v38 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      if ([v38 isStickerRepositioningEnabled])
      {
        v39 = [v8 stickerIsRepositioning];

        if (v39)
        {
          v40 = [v8 stickerChatItem];
          v41 = [v40 stickerPositionVersion];

          v72[0] = *MEMORY[0x1E69A7C98];
          v70 = [v7 stickerGUID];
          v73[0] = v70;
          v72[1] = *MEMORY[0x1E69A7CB0];
          v69 = [v7 stickerPackGUID];
          v73[1] = v69;
          v72[2] = *MEMORY[0x1E69A7CA0];
          v68 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%lu", objc_msgSend(v7, "hash")];
          v42 = *MEMORY[0x1E69A7CA8];
          v73[2] = v68;
          v73[3] = MEMORY[0x1E695E110];
          v43 = *MEMORY[0x1E69A7C88];
          v72[3] = v42;
          v72[4] = v43;
          v67 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(v7, "stickerEffectType")}];
          v73[4] = v67;
          v72[5] = *MEMORY[0x1E69A7CC8];
          v66 = [MEMORY[0x1E696AD98] numberWithDouble:v34];
          v73[5] = v66;
          v72[6] = *MEMORY[0x1E69A7CD0];
          v65 = [MEMORY[0x1E696AD98] numberWithDouble:v35];
          v73[6] = v65;
          v72[7] = *MEMORY[0x1E69A7C78];
          v64 = [MEMORY[0x1E696AD98] numberWithDouble:v16];
          v73[7] = v64;
          v72[8] = *MEMORY[0x1E69A7C70];
          v63 = [MEMORY[0x1E696AD98] numberWithDouble:v18];
          v73[8] = v63;
          v72[9] = *MEMORY[0x1E69A7C68];
          v62 = [MEMORY[0x1E696AD98] numberWithDouble:v37];
          v73[9] = v62;
          v72[10] = *MEMORY[0x1E69A7CB8];
          v44 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:v41 + 1];
          v72[11] = *MEMORY[0x1E69A7C60];
          v73[10] = v44;
          v73[11] = &unk_1F04E78A8;
          v45 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v73 forKeys:v72 count:12];
          v46 = [v45 mutableCopy];

          v47 = [v7 ballonBundleID];

          if (v47)
          {
            v48 = [v7 ballonBundleID];
            [v46 setObject:v48 forKey:*MEMORY[0x1E69A7C80]];
          }

          v49 = [v7 getSafeExternalURI];
          [v46 setObject:v49 forKey:*MEMORY[0x1E69A7C90]];

          v50 = [v8 stickerChatItem];
          if (![(CKChatController *)self repositionSticker:v7 stickerChatItem:v50 parentMessagePartChatItem:v22 stickerPositioningInfo:v46])
          {
            v71 = v46;
            v51 = [(CKCoreChatController *)self collectionViewController];
            v52 = [v51 cellForAssociatedChatItem:v50];

            if (v52)
            {
              v53 = [(CKCoreChatController *)self collectionViewController];
              [v53 setDragManagerCurrentDraggedStickerID:0];

              [v52 setHidden:0];
              [v52 setStickerViewHidden:0];
            }

            v46 = v71;
          }

          goto LABEL_20;
        }
      }

      else
      {
      }

      v54 = MEMORY[0x1E69A82C0];
      v55 = [v7 initialFrameIndex];
      v56 = [v7 getSafeExternalURI];
      v57 = [v54 userInfoDictionaryWithLayoutIntent:0 parentPreviewWidth:v55 xScalar:0 yScalar:v56 scale:v37 rotation:v34 initialFrameIndex:v35 stickerPositionVersion:v16 externalURI:v18];

      v58 = +[CKMediaObjectManager sharedInstance];
      v59 = [v58 mediaObjectWithSticker:v7 stickerUserInfo:v57];

      if (v59)
      {
        v60 = [(CKChatController *)self compositionForSticker:v7 mediaObject:v59];
        [(CKChatController *)self sendSticker:v7 withMediaObject:v59 composition:v60 parentMessagePartChatItem:v22];
      }

      else
      {
        v61 = IMLogHandleForCategory();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
        {
          [CKChatController sendSticker:v7 withDragTarget:? draggedSticker:?];
        }
      }
    }

LABEL_20:

    goto LABEL_21;
  }

LABEL_22:
}

- (id)_compositionForEmojiSticker:(id)a3 mediaObject:(id)a4
{
  v18 = *MEMORY[0x1E69E9840];
  v17 = a4;
  v5 = MEMORY[0x1E695DEC8];
  v6 = a4;
  v7 = a3;
  v8 = [v5 arrayWithObjects:&v17 count:1];
  v9 = [CKComposition stickerCompositionWithMediaObjects:v8, v17, v18];

  v10 = [CKComposition alloc];
  v11 = objc_alloc(MEMORY[0x1E696AAB0]);

  v12 = [v7 emojiString];

  v13 = [v11 initWithString:v12];
  v14 = [(CKComposition *)v10 initWithText:v13 subject:0];

  v15 = [(CKComposition *)v14 compositionByAppendingComposition:v9];

  return v15;
}

- (id)compositionForSticker:(id)a3 mediaObject:(id)a4
{
  v11[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if ([v6 isEmojiSticker])
  {
    v8 = [(CKChatController *)self _compositionForEmojiSticker:v6 mediaObject:v7];
  }

  else
  {
    v11[0] = v7;
    v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:1];
    v8 = [CKComposition stickerCompositionWithMediaObjects:v9];
  }

  return v8;
}

- (void)updateSupportedInterfaceOrientations:(unint64_t)a3
{
  v5 = [(CKCoreChatController *)self delegate];
  v6 = objc_opt_respondsToSelector();

  if (v6)
  {
    v7 = [(CKCoreChatController *)self delegate];
    [v7 updateSupportedInterfaceOrientations:a3];
  }
}

- (void)stopForcingOrientation
{
  v3 = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if (v4)
  {
    v5 = [(CKCoreChatController *)self delegate];
    [v5 stopForcingOrientation];
  }
}

- (int64_t)sceneInterfaceOrientation
{
  v2 = [(CKChatController *)self viewIfLoaded];
  v3 = [v2 window];
  v4 = [v3 windowScene];

  if (v4)
  {
    v5 = [v4 interfaceOrientation];
  }

  else
  {
    v5 = 1;
  }

  return v5;
}

- (unint64_t)recipientsCount
{
  v2 = [(CKCoreChatController *)self conversation];
  v3 = [v2 recipients];
  v4 = [v3 count];

  return v4;
}

- (BOOL)commitStickerAsTapback:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  v6 = [v5 displayConfiguration];
  v7 = [v6 type];

  if (v7 == 1)
  {
    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Inserting sticker as Tapback during double-tap", buf, 2u);
      }
    }

    v9 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  }

  else
  {
    v10 = [(CKChatController *)self pickerContainerAccessoryView];

    if (!v10)
    {
      v13 = 0;
      goto LABEL_14;
    }

    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        *v15 = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Inserting sticker as Tapback during long-press", v15, 2u);
      }
    }

    v12 = [(CKChatController *)self pickerContainerAccessoryView];
    v9 = [v12 pickerBalloonParentView];
  }

  [v9 insertSticker:v4];

  v13 = 1;
LABEL_14:

  return v13;
}

- (void)setPickerContainerAccessoryView:(id)a3
{
  v8 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = 138412290;
      v7 = v4;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "preserving pickerContainerAccessoryView: %@", &v6, 0xCu);
    }
  }

  objc_storeWeak(&self->_pickerContainerAccessoryView, v4);
}

- (BOOL)allowsMentions
{
  v2 = [(CKChatController *)self entryView];
  v3 = [v2 contentView];
  v4 = [v3 textView];
  v5 = [v4 allowsMentions];

  return v5;
}

- (void)_dismissSendMenuIfNecessaryForChangedPresentationStyle
{
  v3 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  v4 = v3;
  if (v3)
  {
    v5 = [v3 presentationStyle];
    v6 = [(CKCoreChatController *)self inputController];
    v7 = [(CKChatController *)self traitCollection];
    v8 = [v6 determineSendMenuPresentationStyleCompatibleWithTraitCollection:v7];

    if (v5 != v8)
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v10 = 0;
          _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Dismissing send menu due to a presentation style change (e.g. resizing the window on an iPad)", v10, 2u);
        }
      }

      [v4 dismissAnimated:0 completion:0];
    }
  }
}

- (id)activeSendMenuPresentationForChatController:(id)a3
{
  v4 = [(CKChatController *)self sendMenuDelegate];
  v5 = [v4 activeSendMenuPresentationForChatController:self];

  return v5;
}

- (void)chatController:(id)a3 requestPresentSendMenu:(id)a4 currentlyPresentedViewController:(id)a5
{
  v17 = a5;
  v8 = MEMORY[0x1E69A8070];
  v9 = a4;
  v10 = a3;
  v11 = [v8 sharedFeatureFlags];
  v12 = [v11 isPopoverSendMenuEnabled];

  v13 = v17;
  if (v12)
  {
    v14 = [(CKChatController *)self presentedViewController];
    v15 = [v14 conformsToProtocol:&unk_1F06826C0];

    v13 = v17;
    if (v15)
    {
      v13 = [(CKChatController *)self presentedViewController];
    }
  }

  v16 = [(CKChatController *)self sendMenuDelegate];
  [v16 chatController:v10 requestPresentSendMenu:v9 currentlyPresentedViewController:v13];
}

- (void)chatController:(id)a3 didFinishDismissAnimationForSendMenuViewController:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [(CKChatController *)self sendMenuDelegate];
  [v8 chatController:v7 didFinishDismissAnimationForSendMenuViewController:v6];
}

- (void)requestShowKeyboardSnapshotForReason:(unint64_t)a3
{
  v72 = *MEMORY[0x1E69E9840];
  if (!+[CKUtilities isIpad])
  {
    if (!a3)
    {
      [CKChatController requestShowKeyboardSnapshotForReason:];
    }

    keyboardSnapshotReason = self->_keyboardSnapshotReason;
    self->_keyboardSnapshotReason = keyboardSnapshotReason | a3;
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:a3];
        *v69 = 138412546;
        *&v69[4] = v8;
        v70 = 1024;
        v71 = keyboardSnapshotReason == 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "request to show keyboardSnapshot with reason: %@, snapshotCreationNeeded: %{BOOL}d", v69, 0x12u);
      }
    }

    if (!keyboardSnapshotReason)
    {
      v9 = [MEMORY[0x1E69DCBB8] activeKeyboard];
      v10 = [(CKCoreChatController *)self inputController];
      v11 = [v10 isInputViewVisible];

      if (v11)
      {
        v12 = [(CKChatController *)self inputViewController];
        v13 = [v12 view];

        v14 = [v13 snapshotViewAfterScreenUpdates:0];
        v15 = [v13 coordinateSpace];
        [v13 bounds];
        v17 = v16;
        v19 = v18;
        v21 = v20;
        v23 = v22;
        v24 = [v13 window];
        v25 = [v24 screen];
        v26 = [v25 coordinateSpace];
        [v15 convertRect:v26 toCoordinateSpace:{v17, v19, v21, v23}];
        v28 = v27;
        v30 = v29;
        v32 = v31;
        v34 = v33;

        [v14 setFrame:{v28, v30, v32, v34}];
      }

      else if ([MEMORY[0x1E69DCBB8] usesInputSystemUI])
      {
        v35 = IMLogHandleForCategory();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
        {
          *v69 = 0;
          _os_log_impl(&dword_19020E000, v35, OS_LOG_TYPE_DEFAULT, "Requesting OOP keyboard snapshot.", v69, 2u);
        }

        v14 = [MEMORY[0x1E69DCBB8] snapshotViewForOptions:1];
        if (v14)
        {
          goto LABEL_27;
        }

        [(CKChatController *)a2 requestShowKeyboardSnapshotForReason:v69];
        v14 = 0;
        v13 = *v69;
      }

      else
      {
        v36 = self->_keyboardSnapshotReason;
        if ((v36 & 0x10) != 0)
        {
          v37 = IMLogHandleForCategory();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT))
          {
            *v69 = 0;
            _os_log_impl(&dword_19020E000, v37, OS_LOG_TYPE_DEFAULT, "Forcing immediate keyboard snapshot for CKKeyboardSnapshotReasonSnapshotFullScreenBalloon", v69, 2u);
          }
        }

        v38 = IMLogHandleForCategory();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
        {
          *v69 = 0;
          _os_log_impl(&dword_19020E000, v38, OS_LOG_TYPE_DEFAULT, "Requesting keyboard snapshot.", v69, 2u);
        }

        v39 = [v9 superview];
        v13 = [v39 superview];

        v40 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        v41 = [v40 isEntryViewRefreshEnabled];

        if (v41)
        {
          [(CKChatController *)self _makeSnapshotForGlassKeyboardTargetView:v13 afterScreenUpdates:(v36 & 0x10) == 0];
        }

        else
        {
          [v13 snapshotViewAfterScreenUpdates:(v36 & 0x10) == 0];
        }
        v14 = ;
      }

LABEL_27:
      [(CKChatController *)self setKeyboardAlpha:0.0];
      [(CKChatController *)self setKeyboardSnapshotView:v14];
      v42 = [(CKChatController *)self keyboardSnapshotView];
      [v42 setUserInteractionEnabled:0];

      v43 = [(CKChatController *)self view];
      v44 = [v43 window];
      v45 = [(CKChatController *)self keyboardSnapshotView];
      [v44 addSubview:v45];

      [(CKChatController *)self enforceSendMenuOrderingInWindowSubviews];
      v46 = [(CKChatController *)self keyboardSnapshotView];
      [v46 frame];
      v48 = v47;
      v50 = v49;
      v52 = v51;
      v54 = v53;

      v55 = [(CKChatController *)self view];
      v56 = [v55 window];
      [v56 bounds];
      Height = CGRectGetHeight(v73);
      v74.origin.x = v48;
      v74.origin.y = v50;
      v74.size.width = v52;
      v74.size.height = v54;
      v58 = CGRectGetHeight(v74);

      v59 = [(CKChatController *)self keyboardSnapshotView];
      [v59 setFrame:{v48, Height - v58, v52, v54}];

      if ((v11 & 1) == 0 && [v9 isMinimized])
      {
        v60 = IMLogHandleForCategory();
        if (os_log_type_enabled(v60, OS_LOG_TYPE_DEFAULT))
        {
          *v69 = 0;
          _os_log_impl(&dword_19020E000, v60, OS_LOG_TYPE_DEFAULT, "UIKeyboard is minimized e.g. due to a hardware keyboard. The snapshot we've taken may include a keyboard, but it is not visible to the user. Hiding the snapshot.", v69, 2u);
        }

        v61 = [(CKChatController *)self keyboardSnapshotView];
        [v61 setHidden:1];
      }

      v62 = [(CKChatController *)self entryView];
      [(CKScrollViewController *)self keyboardFrame];
      v63 = CGRectGetHeight(v75);
      v64 = [v62 window];
      v65 = [v64 bottomAnchor];
      v66 = [v62 bottomAnchor];
      v67 = [v65 constraintEqualToAnchor:v66 constant:v63];
      entryViewKeyboardSnapshotLayoutConstraint = self->_entryViewKeyboardSnapshotLayoutConstraint;
      self->_entryViewKeyboardSnapshotLayoutConstraint = v67;

      [(CKChatController *)self updateActiveEntryViewPositioningGuide];
    }
  }
}

- (id)_makeSnapshotForGlassKeyboardTargetView:(id)a3 afterScreenUpdates:(BOOL)a4
{
  v4 = a4;
  v5 = MEMORY[0x1E69DCEB0];
  v6 = a3;
  v7 = [v5 mainScreen];
  v8 = [v7 snapshotViewAfterScreenUpdates:v4];

  [v6 bounds];
  v10 = v9;
  v12 = v11;
  v14 = v13;
  v16 = v15;

  v17 = objc_alloc_init(MEMORY[0x1E69DD250]);
  [v17 setFrame:{v10, v12, v14, v16}];
  [v17 setClipsToBounds:1];
  [v17 addSubview:v8];
  [v8 bounds];
  v19 = -(v18 - v16);
  [v8 bounds];
  v21 = v20;
  [v8 bounds];
  [v8 setFrame:{0.0, v19, v21}];

  return v17;
}

- (void)setKeyboardAlpha:(double)a3
{
  if ([MEMORY[0x1E69DCBB8] usesInputSystemUI])
  {
    [MEMORY[0x1E6979518] activate];
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __37__CKChatController_setKeyboardAlpha___block_invoke;
    aBlock[3] = &unk_1E72ED810;
    *&aBlock[5] = a3;
    aBlock[4] = self;
    v5 = _Block_copy(aBlock);
    [MEMORY[0x1E6979518] addCommitHandler:v5 forPhase:5];
  }

  else
  {
    [MEMORY[0x1E69DCBB8] setKeyboardAlpha:a3];
    v6 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v7 = [v6 isExpressiveTextEnabled];

    if (v7)
    {
      v10 = [(CKChatController *)self entryView];
      v8 = [v10 contentView];
      v9 = [v8 textView];
      [v9 hideTextEffectsPickerIfNeeded];
    }
  }
}

void __37__CKChatController_setKeyboardAlpha___block_invoke(uint64_t a1)
{
  [MEMORY[0x1E69DCBB8] setKeyboardAlpha:*(a1 + 40)];
  v2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v3 = [v2 isExpressiveTextEnabled];

  if (v3)
  {
    v6 = [*(a1 + 32) entryView];
    v4 = [v6 contentView];
    v5 = [v4 textView];
    [v5 hideTextEffectsPickerIfNeeded];
  }
}

- (void)hideExistingKeyboardSnapshot
{
  v3 = [(CKChatController *)self keyboardSnapshotView];
  [v3 setAlpha:0.0];

  [(CKChatController *)self setKeyboardAlpha:1.0];
}

- (void)revealExistingKeyboardSnapshot
{
  v3 = [(CKChatController *)self keyboardSnapshotView];
  [v3 setAlpha:1.0];

  [(CKChatController *)self setKeyboardAlpha:0.0];
}

- (void)requestDismissKeyboardSnapshotForReason:(unint64_t)a3
{
  v14 = *MEMORY[0x1E69E9840];
  if (!+[CKUtilities isIpad])
  {
    if (!a3)
    {
      [CKChatController requestDismissKeyboardSnapshotForReason:];
    }

    v5 = self->_keyboardSnapshotReason & ~a3;
    self->_keyboardSnapshotReason = v5;
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:a3];
        v10 = 138412546;
        v11 = v7;
        v12 = 1024;
        v13 = v5 == 0;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "request to dismiss keyboardSnapshot with reason: %@, snapshotRemovalNeeded: %{BOOL}d", &v10, 0x12u);
      }
    }

    if (!v5)
    {
      [MEMORY[0x1E69DCBB8] setKeyboardAlpha:1.0];
      v8 = [(CKChatController *)self keyboardSnapshotView];
      [v8 removeFromSuperview];

      [(CKChatController *)self setKeyboardSnapshotView:0];
      [(CKChatController *)self updateActiveEntryViewPositioningGuide];
      entryViewKeyboardSnapshotLayoutConstraint = self->_entryViewKeyboardSnapshotLayoutConstraint;
      self->_entryViewKeyboardSnapshotLayoutConstraint = 0;
    }
  }
}

- (void)animatedDismissalOfKeyboardSnapshot
{
  if (self->_keyboardSnapshotView)
  {
    [(CKChatController *)self requestShowKeyboardSnapshotForReason:8];
    v3 = objc_alloc_init(MEMORY[0x1E69DCF88]);
    v4 = objc_alloc(MEMORY[0x1E69DD278]);
    v5 = [v4 initWithDuration:v3 timingParameters:*MEMORY[0x1E69DDFD8]];
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __55__CKChatController_animatedDismissalOfKeyboardSnapshot__block_invoke;
    v7[3] = &unk_1E72EBA18;
    v7[4] = self;
    [v5 addAnimations:v7];
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __55__CKChatController_animatedDismissalOfKeyboardSnapshot__block_invoke_2;
    v6[3] = &unk_1E72ED838;
    v6[4] = self;
    [v5 addCompletion:v6];
    [v5 startAnimation];
  }
}

uint64_t __55__CKChatController_animatedDismissalOfKeyboardSnapshot__block_invoke(uint64_t a1)
{
  [*(*(a1 + 32) + 2168) frame];
  v3 = v2;
  v5 = v4;
  v7 = v6;
  v8 = [*(a1 + 32) view];
  v9 = [v8 window];
  [v9 bounds];
  Height = CGRectGetHeight(v14);

  [*(*(a1 + 32) + 2168) setFrame:{v3, Height, v5, v7}];
  v11 = *(*(a1 + 32) + 1808);

  return [v11 setConstant:0.0];
}

- (void)requestDismissKeyboardSnapshotForEffectPickerIfNeeded
{
  if ((self->_keyboardSnapshotReason & 4) != 0)
  {
    [(CKChatController *)self requestDismissKeyboardSnapshotForReason:4];
  }
}

+ (void)donateStickerToRecents:(id)a3
{
  v22 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = IMLogHandleForCategory();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = [v4 description];
    *buf = 138412290;
    v21 = v6;
    _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Donating sticker to recents: %@", buf, 0xCu);
  }

  v7 = [v4 representations];
  if (v7)
  {
    goto LABEL_4;
  }

  v16 = [v4 fileURL];

  if (v16)
  {
    v17 = [v4 fileURL];
    v18 = [a1 representationFromFileURL:v17];

    if (v18)
    {
      v19 = v18;
      v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v19 count:1];

LABEL_4:
      v8 = [v4 stickerGUID];
      v9 = [v4 stickerEffectType];
      v10 = [v4 externalURI];
      v11 = [v4 stickerName];
      v12 = [v4 accessibilityLabel];
      v13 = [v4 attributionInfo];
      v14 = v13;
      v15 = MEMORY[0x1E695E0F8];
      if (v13)
      {
        v15 = v13;
      }

      [a1 donateStickerToRecentsWithIdentifier:v8 representations:v7 stickerEffectType:v9 externalURI:v10 name:v11 accessibilityLabel:v12 metadata:0 ckAttributionInfo:v15];

      goto LABEL_7;
    }

    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      [CKChatController donateStickerToRecents:v4];
    }
  }

  else
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      [CKChatController donateStickerToRecents:v4];
    }
  }

LABEL_7:
}

+ (void)donateStickerToRecentsWithIdentifier:(id)a3 representations:(id)a4 stickerEffectType:(int64_t)a5 externalURI:(id)a6 name:(id)a7 accessibilityLabel:(id)a8 metadata:(id)a9 ckAttributionInfo:(id)a10
{
  v60 = *MEMORY[0x1E69E9840];
  v15 = a3;
  v16 = a4;
  v17 = a6;
  v18 = a7;
  v19 = a8;
  v39 = a9;
  v20 = a10;
  v21 = IMLogHandleForCategory();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    LODWORD(buf) = 138412290;
    *(&buf + 4) = v15;
    _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Donating sticker to recents with identifier: %@", &buf, 0xCu);
  }

  v52 = 0;
  v53 = &v52;
  v54 = 0x2050000000;
  v22 = get_STKMessagesObjCStoreFacadeClass_softClass;
  v55 = get_STKMessagesObjCStoreFacadeClass_softClass;
  if (!get_STKMessagesObjCStoreFacadeClass_softClass)
  {
    *&buf = MEMORY[0x1E69E9820];
    *(&buf + 1) = 3221225472;
    v57 = __get_STKMessagesObjCStoreFacadeClass_block_invoke;
    v58 = &unk_1E72EB968;
    v59 = &v52;
    StickersLibraryCore();
    Class = objc_getClass("_STKMessagesObjCStoreFacade");
    *(v59[1] + 24) = Class;
    get_STKMessagesObjCStoreFacadeClass_softClass = *(v59[1] + 24);
    v22 = v53[3];
  }

  v38 = a5;
  v40 = v15;
  v24 = v20;
  v25 = v19;
  v26 = v18;
  v27 = v22;
  _Block_object_dispose(&v52, 8);
  v52 = 0;
  v53 = &v52;
  v54 = 0x2050000000;
  v28 = get_STKStickerUIStickerRepresentationClass_softClass;
  v55 = get_STKStickerUIStickerRepresentationClass_softClass;
  if (!get_STKStickerUIStickerRepresentationClass_softClass)
  {
    *&buf = MEMORY[0x1E69E9820];
    *(&buf + 1) = 3221225472;
    v57 = __get_STKStickerUIStickerRepresentationClass_block_invoke;
    v58 = &unk_1E72EB968;
    v59 = &v52;
    StickersLibraryCore();
    v29 = objc_getClass("_STKStickerUIStickerRepresentation");
    *(v59[1] + 24) = v29;
    get_STKStickerUIStickerRepresentationClass_softClass = *(v59[1] + 24);
    v28 = v53[3];
  }

  v30 = v17;
  v31 = v28;
  _Block_object_dispose(&v52, 8);
  v52 = 0;
  v53 = &v52;
  v54 = 0x2050000000;
  v32 = get_STKStickerAttributionInfoClass_softClass;
  v55 = get_STKStickerAttributionInfoClass_softClass;
  if (!get_STKStickerAttributionInfoClass_softClass)
  {
    *&buf = MEMORY[0x1E69E9820];
    *(&buf + 1) = 3221225472;
    v57 = __get_STKStickerAttributionInfoClass_block_invoke;
    v58 = &unk_1E72EB968;
    v59 = &v52;
    StickersLibraryCore();
    v33 = objc_getClass("_STKStickerAttributionInfo");
    *(v59[1] + 24) = v33;
    get_STKStickerAttributionInfoClass_softClass = *(v59[1] + 24);
    v32 = v53[3];
  }

  v34 = v32;
  _Block_object_dispose(&v52, 8);
  if (v22 && v28 && v32)
  {
    v35 = dispatch_get_global_queue(25, 0);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke;
    block[3] = &unk_1E72ED860;
    v48 = v22;
    v42 = v16;
    v49 = v28;
    v43 = v24;
    v50 = v32;
    v36 = v40;
    v44 = v40;
    v51 = v38;
    v45 = v30;
    v46 = v26;
    v47 = v25;
    dispatch_async(v35, block);

    v37 = v42;
  }

  else
  {
    IMLogHandleForCategory();
    v37 = v36 = v40;
    if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
    {
      +[CKChatController donateStickerToRecentsWithIdentifier:representations:stickerEffectType:externalURI:name:accessibilityLabel:metadata:ckAttributionInfo:];
    }
  }
}

void __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke(uint64_t a1)
{
  v36 = *MEMORY[0x1E69E9840];
  v29 = objc_alloc_init(*(a1 + 80));
  v2 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(*(a1 + 32), "count")}];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v3 = *(a1 + 32);
  v4 = [v3 countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v32;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v32 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v31 + 1) + 8 * i);
        v9 = objc_alloc(*(a1 + 88));
        v10 = [v8 data];
        v11 = [v8 type];
        [v8 size];
        v13 = v12;
        v15 = v14;
        v16 = [v8 role];
        v17 = [v9 initWithData:v10 type:v11 size:v16 role:{v13, v15}];

        [v2 addObject:v17];
      }

      v5 = [v3 countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v5);
  }

  v18 = [*(a1 + 40) objectForKeyedSubscript:*MEMORY[0x1E69A6FA0]];
  v19 = [*(a1 + 40) objectForKeyedSubscript:*MEMORY[0x1E69A6FB0]];
  v20 = [*(a1 + 40) objectForKeyedSubscript:*MEMORY[0x1E69A6FA8]];
  v21 = [objc_alloc(*(a1 + 96)) initWithAdamID:v18 bundleIdentifier:v19 name:v20];
  v22 = *(a1 + 104);
  v23 = *(a1 + 48);
  v24 = *(a1 + 56);
  v25 = *(a1 + 64);
  v26 = *(a1 + 72);
  v30 = 0;
  [v29 donateStickerToRecentsWithIdentifier:v23 representations:v2 stickerEffectEnum:v22 externalURI:v24 name:v25 accessibilityName:v26 metadata:0 attributionInfo:v21 error:&v30];
  v27 = v30;
  if (v27)
  {
    v28 = IMLogHandleForCategory();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke_cold_1();
    }
  }
}

+ (id)representationFromFileURL:(id)a3
{
  v3 = a3;
  v4 = v3;
  if (v3)
  {
    v5 = MEMORY[0x1E69DCAB8];
    v6 = [(__CFURL *)v3 path];
    v7 = [v5 imageWithContentsOfFile:v6];

    if (v7 && (v8 = CGImageSourceCreateWithURL(v4, 0), Type = CGImageSourceGetType(v8), CFRelease(v8), Type))
    {
      v10 = objc_alloc_init(MEMORY[0x1E69DD760]);
      v16 = 0;
      v11 = [MEMORY[0x1E695DEF0] dataWithContentsOfURL:v4 options:1 error:&v16];
      v12 = v16;
      [v10 setData:v11];

      v13 = 0;
      if (!v12)
      {
        v14 = [(__CFString *)Type copy];
        [v10 setType:v14];

        [v7 size];
        [v10 setSize:?];
        v13 = v10;
      }
    }

    else
    {
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

- (void)dragManagerDidBeginDragging:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  v6 = [v4 chat];

  [v6 beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57C8]];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"StickerDrag"];
  [(CKChatController *)self setScrollDownIsValid:0];
  v5 = [(CKChatController *)self collectionView];
  [v5 beginDisablingTranscriptDynamicsForReason:4];
}

- (void)dragManager:(id)a3 draggedItemWithTarget:(id)a4
{
  v32 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 collectionView];

  v8 = [(CKChatController *)self selectedBalloonForTarget:v32];
  [(CKChatController *)self _setOverlayForBalloonViewAtIndexPath:v8 animated:1];
  if (a3)
  {
    goto LABEL_17;
  }

  [v32 screenCoordinate];
  v10 = v9;
  v11 = +[CKUIBehavior sharedBehaviors];
  [v11 dragTranscriptScrollThreshold];
  v13 = v12;

  v14 = [(CKChatController *)self view];
  [v14 bounds];
  Height = CGRectGetHeight(v34);
  [v7 contentInset];
  v17 = Height - v16;

  if (v10 >= v13 && v10 <= v17)
  {
    [(CKChatController *)self setScrollDownIsValid:1];
    goto LABEL_11;
  }

  v19 = +[CKUIBehavior sharedBehaviors];
  [v19 dragTranscriptScrollDisplayLinkMaxDelta];
  v21 = v20;

  if (v10 < v13)
  {
    v22 = (v13 - v10) / v13;
    v23 = -v22;
    v24 = v22 < 1.0;
    v25 = -1.0;
    if (v24)
    {
      v25 = v23;
    }

    goto LABEL_9;
  }

  v26 = 0.0;
  if (v10 > v17)
  {
    if ([(CKChatController *)self scrollDownIsValid])
    {
      v25 = fmin((v10 - v17) / v13, 1.0);
LABEL_9:
      v26 = v25 * v21;
      goto LABEL_15;
    }

    [(CKChatController *)self setStickerTranscriptScrollDelta:0.0];
LABEL_11:
    v27 = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
    [v27 invalidate];

    [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
    goto LABEL_17;
  }

LABEL_15:
  [(CKChatController *)self setStickerTranscriptScrollDelta:v26];
  v28 = [(CKChatController *)self stickerTranscriptScrollDisplayLink];

  if (!v28)
  {
    v29 = [MEMORY[0x1E69DCEB0] mainScreen];
    v30 = [v29 displayLinkWithTarget:self selector:sel__stickerTranscriptScrollDisplayLinkFired];

    v31 = [MEMORY[0x1E695DFD0] mainRunLoop];
    [v30 addToRunLoop:v31 forMode:*MEMORY[0x1E695DA28]];

    [(CKChatController *)self setStickerTranscriptScrollDisplayLink:v30];
  }

LABEL_17:
}

- (void)_stickerTranscriptScrollDisplayLinkFired
{
  v13 = [(CKChatController *)self collectionView];
  [v13 contentOffset];
  v4 = v3;
  v6 = v5;
  stickerTranscriptScrollDelta = self->_stickerTranscriptScrollDelta;
  v8 = [(CKCoreChatController *)self inputController];
  v9 = [v8 stickerPickerMessagePartChatItem];

  if (!v9)
  {
    v10 = v6 + stickerTranscriptScrollDelta;
    [(CKScrollViewController *)self computedInsets];
    [v13 __ck_bottomOffsetWithComputedInsets:?];
    if (v10 < v11)
    {
      [v13 __ck_scrollToTopContentOffset];
      if (v10 > v12)
      {
        [v13 setContentOffset:{v4, v10}];
      }
    }
  }
}

- (id)selectedBalloonForTarget:(id)a3
{
  v4 = a3;
  [v4 screenCoordinate];
  v6 = v5;
  v8 = v7;
  v9 = *MEMORY[0x1E695F058];
  v10 = *(MEMORY[0x1E695F058] + 8);
  [v4 initialSize];
  v12 = v11;
  v14 = v13;
  [v4 scale];
  v16 = v15;
  [v4 meshScaleFactor];
  v18 = v17;

  v19 = v12 * (v16 / v18);
  v20 = v14 * (v16 / v18);
  v25.origin.x = v9;
  v25.origin.y = v10;
  v25.size.width = v19;
  v25.size.height = v20;
  v21 = v6 - CGRectGetWidth(v25) * 0.5;
  v26.origin.x = v9;
  v26.origin.y = v10;
  v26.size.width = v19;
  v26.size.height = v20;
  v22 = v8 - CGRectGetHeight(v26) * 0.5;

  return [(CKChatController *)self selectedBalloonIntersectingRect:v21, v22, v19, v20];
}

- (id)selectedBalloonIntersectingRect:(CGRect)a3 chatItemForRepositioning:(id)a4
{
  height = a3.size.height;
  width = a3.size.width;
  y = a3.origin.y;
  x = a3.origin.x;
  v86 = *MEMORY[0x1E69E9840];
  v63 = a4;
  v88.origin.x = x;
  v88.origin.y = y;
  v88.size.width = width;
  v88.size.height = height;
  MidX = CGRectGetMidX(v88);
  v55 = x;
  v89.origin.x = x;
  v56 = y;
  v57 = width;
  v89.origin.y = y;
  v89.size.width = width;
  v58 = height;
  v89.size.height = height;
  MidY = CGRectGetMidY(v89);
  v9 = [(CKCoreChatController *)self collectionViewController];
  v62 = [v9 collectionView];
  v10 = [v62 indexPathsForVisibleItems];
  v59 = [objc_alloc(MEMORY[0x1E695DF90]) initWithCapacity:{objc_msgSend(v10, "count")}];
  v81 = 0u;
  v82 = 0u;
  v83 = 0u;
  v84 = 0u;
  v11 = v10;
  v12 = [v11 countByEnumeratingWithState:&v81 objects:v85 count:16];
  if (v12)
  {
    v13 = *v82;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v82 != v13)
        {
          objc_enumerationMutation(v11);
        }

        v15 = *(*(&v81 + 1) + 8 * i);
        if (![v15 section])
        {
          v16 = [v9 chatItems];
          v17 = [v16 objectAtIndex:{objc_msgSend(v15, "item")}];

          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) != 0 && (!v63 || [v63 isEqual:v17]))
          {
            v18 = [v62 cellForItemAtIndexPath:v15];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v19 = [v18 balloonView];
              v20 = v19;
              if (v19)
              {
                v21 = [v19 superview];
                [v20 frame];
                [v21 convertRect:v62 toView:?];
                v60 = v23;
                v61 = v22;
                v25 = v24;
                v27 = v26;

                [v62 frame];
                v29 = v28;
                v31 = v30;
                v33 = v32;
                v35 = v34;
                v90.origin.x = v25;
                v90.size.width = v60;
                v90.origin.y = v61;
                v90.size.height = v27;
                MinX = CGRectGetMinX(v90);
                v91.origin.x = v29;
                v91.origin.y = v31;
                v91.size.width = v33;
                v91.size.height = v35;
                v37 = CGRectGetMinX(v91);
                v92.origin.x = v29;
                v92.origin.y = v31;
                v92.size.width = v33;
                v92.size.height = v35;
                MaxX = CGRectGetMaxX(v92);
                v93.origin.x = v25;
                v93.size.width = v60;
                v93.origin.y = v61;
                v93.size.height = v27;
                v39 = CGRectGetMaxX(v93);
                v40 = fmin(MinX - v37, 75.0);
                [v62 convertRect:0 toView:{v25 - v40, v61, v60 + v40 + fmin(MaxX - v39, 75.0), v27 + 0.0}];
                v41 = [MEMORY[0x1E696B098] valueWithCGRect:?];
                [v59 setObject:v41 forKey:v15];
              }
            }
          }
        }
      }

      v12 = [v11 countByEnumeratingWithState:&v81 objects:v85 count:16];
    }

    while (v12);
  }

  v42 = [v59 copy];
  v43 = [v42 allKeys];
  v75[0] = MEMORY[0x1E69E9820];
  v75[1] = 3221225472;
  v75[2] = __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke;
  v75[3] = &unk_1E72ED888;
  v44 = v59;
  v76 = v44;
  v77 = v55;
  v78 = v56;
  v79 = v57;
  v80 = v58;
  [v43 enumerateObjectsUsingBlock:v75];

  v45 = [v44 allKeys];
  v46 = [v45 count];

  if (v46)
  {
    v47 = [v44 allKeys];
    v48 = [v47 count] == 1;

    if (v48)
    {
      v49 = [v44 allKeys];
      v50 = [v49 firstObject];
    }

    else
    {
      v69 = 0;
      v70 = &v69;
      v71 = 0x3032000000;
      v72 = __Block_byref_object_copy__8;
      v73 = __Block_byref_object_dispose__8;
      v74 = 0;
      v51 = [v44 allKeys];
      v64[0] = MEMORY[0x1E69E9820];
      v64[1] = 3221225472;
      v64[2] = __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke_1208;
      v64[3] = &unk_1E72ED8B0;
      v67 = MidX;
      v68 = MidY;
      v65 = v44;
      v66 = &v69;
      [v51 enumerateObjectsUsingBlock:v64];

      v50 = v70[5];
      _Block_object_dispose(&v69, 8);
    }
  }

  else
  {
    v50 = 0;
  }

  return v50;
}

void __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke(uint64_t a1, void *a2)
{
  v12 = a2;
  v3 = [*(a1 + 32) objectForKey:?];
  [v3 CGRectValue];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  v14.origin.x = v5;
  v14.origin.y = v7;
  v14.size.width = v9;
  v14.size.height = v11;
  if (!CGRectIntersectsRect(v14, *(a1 + 40)))
  {
    [*(a1 + 32) removeObjectForKey:v12];
  }
}

void __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke_1208(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v18 = a2;
  v7 = [*(a1 + 32) objectForKey:?];
  [v7 CGRectValue];
  v9 = v8;
  v11 = v10;
  v13 = v12;
  v15 = v14;

  v16 = *(a1 + 56);
  v20.origin.x = v9;
  v20.origin.y = v11;
  v20.size.width = v13;
  v20.size.height = v15;
  if (v16 > CGRectGetMinY(v20))
  {
    v17 = *(a1 + 56);
    v21.origin.x = v9;
    v21.origin.y = v11;
    v21.size.width = v13;
    v21.size.height = v15;
    if (v17 < CGRectGetMaxY(v21))
    {
      objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
      *a4 = 1;
    }
  }
}

- (void)dragManagerDidEndDragging:(id)a3
{
  [(CKChatController *)self _clearBalloonViewOverlaysWithAnimation:1];
  v4 = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
  [v4 invalidate];

  [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
  v5 = [(CKChatController *)self collectionView];
  v6 = [(CKCoreChatController *)self conversation];
  v7 = [v6 chat];

  [v5 endDisablingTranscriptDynamicsForReason:4];
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"StickerDrag"];
  [v7 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57C8]];
  browserDragManager = self->_browserDragManager;
  self->_browserDragManager = 0;

  v9 = [(CKCoreChatController *)self collectionViewController];
  v10 = dispatch_time(0, 250000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __46__CKChatController_dragManagerDidEndDragging___block_invoke;
  block[3] = &unk_1E72EBA18;
  v13 = v9;
  v11 = v9;
  dispatch_after(v10, MEMORY[0x1E69E96A0], block);
}

- (int)dragManager:(id)a3 dropAreaForDragTarget:(id)a4
{
  v5 = a4;
  [v5 screenCoordinate];
  v7 = v6;
  v9 = v8;
  v10 = [(CKCoreChatController *)self inputController];
  v11 = [v10 inputViewController];
  v12 = [v11 view];
  v13 = v12;
  v51 = v9;
  v52 = v7;
  if (v12)
  {
    v14 = v12;
  }

  else
  {
    v15 = [(CKChatController *)self viewControllerForChatInputModalPresentation];
    v16 = [v15 presentedViewController];
    v14 = [v16 view];
  }

  v17 = [v14 superview];
  [v14 frame];
  [v17 convertRect:0 toView:?];
  v49 = v19;
  v50 = v18;
  v47 = v21;
  v48 = v20;

  v22 = [(CKChatController *)self entryView];
  v23 = [v22 superview];
  v24 = [(CKChatController *)self entryView];
  [v24 frame];
  [v23 convertRect:0 toView:?];
  v26 = v25;
  v28 = v27;
  v30 = v29;
  v32 = v31;

  v33 = [(CKChatController *)self collectionView];
  v34 = [v33 superview];
  v35 = [(CKChatController *)self collectionView];
  [v35 frame];
  [v34 convertRect:0 toView:?];
  v37 = v36;
  v39 = v38;
  v41 = v40;
  v43 = v42;

  v44 = [(CKChatController *)self selectedBalloonForTarget:v5];

  v56.origin.x = v26;
  v56.origin.y = v28;
  v56.size.width = v30;
  v56.size.height = v32;
  v53.x = v52;
  v53.y = v51;
  if (CGRectContainsPoint(v56, v53))
  {
    v45 = 2;
  }

  else
  {
    v57.origin.y = v49;
    v57.origin.x = v50;
    v57.size.height = v47;
    v57.size.width = v48;
    v54.x = v52;
    v54.y = v51;
    if (CGRectContainsPoint(v57, v54))
    {
      v45 = 3;
    }

    else if (v44)
    {
      v45 = 4;
    }

    else
    {
      v58.origin.x = v37;
      v58.origin.y = v39;
      v58.size.width = v41;
      v58.size.height = v43;
      v55.x = v52;
      v55.y = v51;
      v45 = CGRectContainsPoint(v58, v55);
    }
  }

  return v45;
}

- (void)setLocalUserIsComposing:(BOOL)a3 withPluginBundleID:(id)a4 typingIndicatorData:(id)a5
{
  v6 = a3;
  v11 = a4;
  v8 = a5;
  v9 = [(CKCoreChatController *)self conversation];
  v10 = v9;
  if (v6)
  {
    [v9 setLocalUserIsComposing:v11 typingIndicatorIcon:v8];
  }

  else
  {
    [v9 setLocalUserIsComposing:0];
  }
}

- (void)chatInputControllerRequestInputViewFocusFromFullscreen:(id)a3
{
  self->_shouldBecomeFirstResponderWhenDismissingModalBrowser = 0;
  [(CKChatController *)self setTargetFirstResponder:1];

  [(CKChatController *)self becomeFirstResponder];
}

- (void)chatInputDidUpdateInputViewShowingBrowser:(BOOL)a3 entryFieldCollapsed:(BOOL)a4 animated:(BOOL)a5
{
  v5 = a3;
  v7 = [(CKChatController *)self entryView:a3];
  v8 = [v7 contentView];
  v9 = [v8 textView];

  if (v5)
  {
    v10 = [(CKChatController *)self view];
    v11 = [v10 window];
    v12 = [v11 isKeyWindow];

    if ((v12 & 1) == 0)
    {
      v13 = [(CKChatController *)self view];
      v14 = [v13 window];
      [v14 makeKeyWindow];
    }

    [v9 becomeFirstResponder];
    [v9 saveKeyboardInputMode];
  }

  v15 = [(CKChatController *)self firstResponder];
  [v15 reloadInputViews];

  v16 = MEMORY[0x1E69DD250];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __91__CKChatController_chatInputDidUpdateInputViewShowingBrowser_entryFieldCollapsed_animated___block_invoke;
  v18[3] = &unk_1E72ED8D8;
  v20 = v5;
  v19 = v9;
  v17 = v9;
  [v16 performWithoutAnimation:v18];
}

uint64_t __91__CKChatController_chatInputDidUpdateInputViewShowingBrowser_entryFieldCollapsed_animated___block_invoke(uint64_t result)
{
  if ((*(result + 40) & 1) == 0)
  {
    return [*(result + 32) restoreKeyboardInputMode];
  }

  return result;
}

- (void)chatInputDidUpdateWithNewInputViewController:(id)a3
{
  v3 = [(CKChatController *)self firstResponder];
  [v3 reloadInputViews];
}

- (void)chatInputControllerWillPresentModalBrowserViewController:(id)a3
{
  v4 = [(CKChatController *)self entryView];
  v5 = [v4 contentView];
  v6 = [v5 isActive];

  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self becomeFirstResponder];
  [(CKChatController *)self setTargetFirstResponder:v6];
  v7 = [(CKChatController *)self collectionView];
  [v7 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerModalBrowser"];

  v8 = [(CKCoreChatController *)self collectionViewController];
  [v8 setAllowsPluginPlayback:0];

  v9 = [(CKCoreChatController *)self collectionViewController];
  [v9 stopPluginPlayback];
}

- (void)chatInputControllerWillDismissModalBrowserViewController:(id)a3
{
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"BrowserTransition"];
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 scrollTranscriptToEntryViewInsertionTimeWithAnimation:0];

  v5 = [(CKCoreChatController *)self collectionViewController];
  [v5 setTranscriptUpdateAnimated:1];
}

- (void)chatInputControllerDidDismissModalBrowserViewController:(id)a3
{
  v4 = [(CKChatController *)self collectionView];
  [v4 endHoldingContentOffsetUpdatesForReason:@"ChatControllerModalBrowser"];

  if (self->_shouldDisplayKeyboardWhenDismissingModalBrowser)
  {
    v5 = [(CKChatController *)self entryView];
    v6 = [v5 contentView];
    v7 = [v6 isActive];

    if ((v7 & 1) == 0)
    {
      [(CKChatController *)self setTargetFirstResponder:1];
    }
  }

  if (self->_shouldBecomeFirstResponderWhenDismissingModalBrowser)
  {
    [(CKChatController *)self becomeFirstResponder];
  }

  [MEMORY[0x1E69DD258] attemptRotationToDeviceOrientation];
  self->_shouldBecomeFirstResponderWhenDismissingModalBrowser = 1;
  v8 = [(CKCoreChatController *)self collectionViewController];
  [v8 setAllowsPluginPlayback:1];

  v9 = [(CKCoreChatController *)self collectionViewController];
  [v9 startPluginPlaybackAfterDelay:0.0];

  v10 = [(CKChatController *)self entryView];
  [v10 setAlpha:1.0];

  v11 = [(CKCoreChatController *)self delegate];
  v12 = objc_opt_respondsToSelector();

  if (v12)
  {
    v13 = [(CKCoreChatController *)self delegate];
    [v13 stopForcingOrientation];
  }
}

- (void)chatInputControllerDidDismissCompactBrowserViewController:(id)a3
{
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];

  v5 = [(CKChatController *)self entryView];
  [v5 setAlpha:1.0];
}

- (void)chatInputController:(id)a3 willPresentStickerPickerForChatItem:(id)a4
{
  v6 = a4;
  if (!CKIsAppCardsEnabled())
  {
    v5 = [(CKCoreChatController *)self collectionViewController];
    [v5 beginPresentingChatItemForKeyboardPresentation:v6 layoutAreaContentInsets:0 completion:{40.0, 0.0, 40.0, 0.0}];
  }
}

- (void)chatInputControllerDidSelectRequestLocation:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self inputController];

  if (v5 == v4)
  {

    [(CKChatController *)self _stageFindMyLocationRequest];
  }
}

- (void)chatInputController:(id)a3 didPresentStickerPickerForChatItem:(id)a4
{
  v6 = a4;
  if (!CKIsAppCardsEnabled())
  {
    v5 = [(CKCoreChatController *)self collectionViewController];
    [v5 endPresentingChatItemForKeyboardPresentation:v6 completion:0];
  }
}

- (void)chatInputDidSelectPhotoPicker
{
  v17[3] = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E69DCAD0]);
  [(CKChatController *)self setImagePickerController:v3];
  [v3 setDelegate:self];
  v4 = *MEMORY[0x1E6963850];
  v17[0] = *MEMORY[0x1E69637F8];
  v17[1] = v4;
  v17[2] = *MEMORY[0x1E6963818];
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:3];
  [v3 setMediaTypes:v5];

  v6 = MEMORY[0x1E695E118];
  [v3 _setValue:MEMORY[0x1E695E118] forProperty:@"_UIImagePickerControllerSkipConfirmation"];
  [v3 _setValue:v6 forProperty:@"_UIImagePickerControllerMessagesLayout"];
  [v3 setSourceType:0];
  [v3 setModalPresentationStyle:7];
  [v3 setAllowsEditing:0];
  v7 = v3;
  v8 = [v7 popoverPresentationController];
  [v8 setPermittedArrowDirections:8];
  v9 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v10 = [v9 isSendMenuEnabled];

  if (v10)
  {
    v11 = [(CKCoreChatController *)self inputController];
    v12 = [v11 entryView];
    v13 = [v12 sendMenuSourceView];
    [v8 setSourceView:v13];

    v14 = [(CKCoreChatController *)self inputController];
    v15 = [v14 entryView];
    v16 = [v15 sendMenuSourceView];
    [v16 bounds];
    [v8 setSourceRect:?];
  }

  else
  {
    v14 = [v7 presentationController];
    v15 = [(CKChatController *)self entryView];
    v16 = [v15 sendMenuSourceView];
    [v14 setSourceView:v16];
  }

  [(CKChatController *)self presentViewController:v7 animated:1 completion:0];
}

- (void)chatInputDidSelectEffectPicker
{
  v3 = [(CKChatController *)self entryView];
  v4 = [v3 composition];
  v5 = [v4 hasContent];

  if (v5)
  {

    [(CKChatController *)self showEffectPicker];
  }

  else
  {
    v6 = [(CKChatController *)self entryView];
    [v6 showMessageEffectsHint];
  }
}

- (void)chatInputControllerWillSelectFunCamera:(id)a3
{
  v4 = a3;
  v5 = +[CKBalloonPluginManager sharedInstance];
  v6 = [v5 isCameraAllowed];

  if (v6)
  {
    v7 = [(CKCoreChatController *)self inputController];
    v8 = [v7 isInputViewVisible];

    if ((v8 & 1) == 0)
    {
      [(CKChatController *)self prewarmFunCamera];
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      *v10 = 0;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "chatInputControllerWillSelectFunCamera: Not attempting to present Camera. Camera restriction in effect.", v10, 2u);
    }
  }
}

- (void)chatInputControllerCancelSelectFunCamera:(id)a3
{
  v4 = +[CKBalloonPluginManager sharedInstance];
  v5 = [(CKChatController *)self funCameraViewController];
  v6 = [v5 balloonPlugin];
  v7 = [v6 identifier];
  v8 = [v4 existingViewControllerForPluginIdentifier:v7];

  [v8 beginAppearanceTransition:0 animated:0];
  [v8 endAppearanceTransition];
}

- (void)chatInputControllerDidSelectFunCamera:(id)a3
{
  v4 = a3;
  if (CKIsRunningInMessagesTranscriptExtension())
  {
    [(CKChatController *)self openURLInExtensionContextForMode:@"photos"];
  }

  else
  {
    v5 = +[CKBalloonPluginManager sharedInstance];
    v6 = [v5 isCameraAllowed];

    if (v6)
    {
      aBlock[0] = MEMORY[0x1E69E9820];
      aBlock[1] = 3221225472;
      aBlock[2] = __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke;
      aBlock[3] = &unk_1E72EBA18;
      aBlock[4] = self;
      v7 = _Block_copy(aBlock);
      v8 = [(CKCoreChatController *)self inputController];
      v9 = [v8 isInputViewVisible];

      if (v9)
      {
        v10 = [(CKCoreChatController *)self inputController];
        [v10 forceDismissBrowserWithoutAnimation];

        v11 = +[CKBalloonPluginManager sharedInstance];
        [v11 forceKillNonCameraRemoteExtensionsImmediately];
      }

      v12 = [(CKChatController *)self funCameraViewController];

      if (v12)
      {
        v7[2](v7);
      }

      else
      {
        v14 = [(CKCoreChatController *)self inputController];
        v15 = [v14 isInputViewVisible];

        if (v15)
        {
          v16 = [(CKCoreChatController *)self inputController];
          [v16 forceDismissBrowserWithoutAnimation];

          v17 = +[CKBalloonPluginManager sharedInstance];
          [v17 forceKillNonCameraRemoteExtensionsImmediately];

          v18 = 50000000;
        }

        else
        {
          v18 = 0;
        }

        v19 = dispatch_time(0, v18);
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke_1216;
        block[3] = &unk_1E72ED1C8;
        block[4] = self;
        v21 = v7;
        dispatch_after(v19, MEMORY[0x1E69E96A0], block);
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "chatInputControllerDidSelectFunCamera: Not attempting to present Camera. Camera restriction in effect.", buf, 2u);
      }
    }
  }
}

void __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke(uint64_t a1)
{
  if ([*(a1 + 32) isShowingCamera])
  {
    if (!IMOSLoggingEnabled())
    {
      return;
    }

    v2 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      goto LABEL_12;
    }

    v17 = 0;
    v3 = "Not presenting FunCam, instance of camera already presented";
    v4 = &v17;
LABEL_11:
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, v3, v4, 2u);
LABEL_12:

    return;
  }

  if (![*(a1 + 32) appeared])
  {
    if (!IMOSLoggingEnabled())
    {
      return;
    }

    v2 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      goto LABEL_12;
    }

    *buf = 0;
    v3 = "Not presenting FunCam, chat controller is dissapearing or dissapeared";
    v4 = buf;
    goto LABEL_11;
  }

  [*(a1 + 32) setIsShowingCamera:1];
  v5 = [*(a1 + 32) entryView];
  v6 = [v5 contentView];
  v7 = [v6 isActive];

  if (v7)
  {
    v8 = [*(a1 + 32) entryView];
    v9 = [v8 contentView];
    v10 = [v9 activeView];
    [v10 resignFirstResponder];
  }

  else if (!CKIsAppCardsEnabled())
  {
    [*(a1 + 32) resignFirstResponder];
  }

  v11 = *(a1 + 32);
  v12 = [v11 funCameraViewController];
  [v12 setDelegate:v11];

  v13 = [*(a1 + 32) funCameraViewController];
  [v13 setModalPresentationStyle:0];

  v14 = *(a1 + 32);
  v15 = [v14 funCameraViewController];
  [v14 presentViewController:v15 animated:1 completion:0];
}

uint64_t __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke_1216(uint64_t a1)
{
  [*(a1 + 32) prewarmFunCamera];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)chatInputController:(id)a3 requestPresentSendMenu:(id)a4
{
  v5 = a4;
  [(CKChatController *)self animateSendMenuStatusBarAppearanceUpdate];
  v6 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v7 = [v6 isPopoverSendMenuEnabled];

  if (v7 && (-[CKChatController presentedViewController](self, "presentedViewController"), v8 = objc_claimAutoreleasedReturnValue(), v9 = [v8 conformsToProtocol:&unk_1F06826C0], v8, v9))
  {
    v11 = [(CKChatController *)self presentedViewController];
  }

  else
  {
    v11 = 0;
  }

  v10 = [(CKChatController *)self sendMenuDelegate];
  [v10 chatController:self requestPresentSendMenu:v5 currentlyPresentedViewController:v11];

  [(CKChatController *)self enforceSendMenuOrderingInWindowSubviews];
}

- (void)chatInputController:(id)a3 didFinishDismissAnimationForSendMenuViewController:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self sendMenuDelegate];
  [v6 chatController:self didFinishDismissAnimationForSendMenuViewController:v5];

  [(CKChatController *)self animateSendMenuStatusBarAppearanceUpdate];
}

- (void)animateSendMenuStatusBarAppearanceUpdate
{
  v3 = +[CKUIBehavior sharedBehaviors];
  v4 = [v3 sendMenuStatusBarAnimator];

  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __60__CKChatController_animateSendMenuStatusBarAppearanceUpdate__block_invoke;
  v5[3] = &unk_1E72EBA18;
  v5[4] = self;
  [v4 addAnimations:v5];
  [v4 startAnimation];
}

- (void)chatInputWillChangeHeightForCompactPresentation:(double)a3
{
  v4 = [(CKChatController *)self collectionView];
  v3 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
  [v4 enforceTranscriptScrollIntentWithAnimationProperties:v3];
}

- (void)chatInputControllerWillTransitionExpanded:(id)a3
{
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 setAllowsPluginPlayback:0];

  v5 = [(CKCoreChatController *)self collectionViewController];
  [v5 stopPluginPlayback];

  self->_shouldDisplayKeyboardWhenDismissingModalBrowser = [(CKScrollViewController *)self isKeyboardVisible];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"BrowserTransition"];
  v6 = [(CKChatController *)self collectionView];
  [v6 beginHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  v7 = [(CKCoreChatController *)self collectionViewController];
  [v7 setTranscriptUpdateAnimated:0];
}

- (void)chatInputControllerDidTransitionExpanded:(id)a3
{
  v6 = [(CKChatController *)self collectionView];
  v4 = [(CKChatController *)self collectionView];
  [v4 endHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  v5 = +[CKScrollViewAnimationProperties unanimated];
  [v6 enforceTranscriptScrollIntentWithAnimationProperties:v5];
}

- (void)chatInputControllerWillTransitionCollapsed:(id)a3
{
  UIKeyboardOrderInAutomaticSkippingAnimation();
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"BrowserTransition"];
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 scrollTranscriptToEntryViewInsertionTimeWithAnimation:0];

  v5 = [(CKChatController *)self collectionView];
  [v5 beginHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  v6 = [(CKCoreChatController *)self collectionViewController];
  [v6 setTranscriptUpdateAnimated:1];

  v7 = [(CKCoreChatController *)self collectionViewController];
  [v7 setAllowsPluginPlayback:1];

  v8 = [(CKCoreChatController *)self collectionViewController];
  [v8 startPluginPlaybackAfterDelay:0.0];
}

- (void)chatInputControllerDidTransitionCollapsed:(id)a3
{
  v4 = [(CKChatController *)self collectionView];
  [v4 endHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  [(CKChatController *)self _updateEntryViewFrameIfNeeded:1];
  v5 = [(CKChatController *)self entryView];
  [v5 setAlpha:1.0];

  v6 = MEMORY[0x1E69DD258];

  [v6 attemptRotationToDeviceOrientation];
}

- (BOOL)chatInputControllerShouldShowHandwriting:(id)a3
{
  v4 = [(CKCoreChatController *)self chat];
  if (v4)
  {
    v5 = [(CKCoreChatController *)self chat];
    v6 = [v5 allowedToShowConversation];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (id)_associatedStickerChatItemInInsertedIndexes:(id)a3 matchingSticker:(id)a4
{
  v6 = a3;
  v7 = a4;
  v14 = 0;
  v15 = &v14;
  v16 = 0x3032000000;
  v17 = __Block_byref_object_copy__8;
  v18 = __Block_byref_object_dispose__8;
  v19 = 0;
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __80__CKChatController__associatedStickerChatItemInInsertedIndexes_matchingSticker___block_invoke;
  v11[3] = &unk_1E72ED900;
  v11[4] = self;
  v8 = v7;
  v12 = v8;
  v13 = &v14;
  [v6 enumerateIndexesUsingBlock:v11];
  v9 = v15[5];

  _Block_object_dispose(&v14, 8);

  return v9;
}

void __80__CKChatController__associatedStickerChatItemInInsertedIndexes_matchingSticker___block_invoke(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v12 = [MEMORY[0x1E696AC88] indexPathForRow:a2 inSection:1];
  v5 = [*(a1 + 32) collectionViewController];
  v6 = [v5 chatItemAtIndexPath:v12];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
    v8 = [v7 sticker];
    v9 = [v8 stickerGUID];
    v10 = [*(a1 + 40) stickerGUID];
    v11 = [v9 hasPrefix:v10];

    if (v11)
    {
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), v6);
      *a3 = 1;
    }
  }
}

- (CGRect)_targetStickerFrameFromStickerCell:(id)a3 coordinateSpace:(id)a4
{
  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  v49 = 0u;
  v50 = 0u;
  v47 = 0u;
  v48 = 0u;
  v5 = a4;
  v6 = a3;
  v7 = [v6 associatedItemView];
  v8 = [v7 layer];
  v9 = v8;
  if (v8)
  {
    [v8 transform];
  }

  else
  {
    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    v49 = 0u;
    v50 = 0u;
    v47 = 0u;
    v48 = 0u;
  }

  v10 = [v6 associatedItemView];
  v11 = [v10 layer];
  v12 = *(MEMORY[0x1E69792E8] + 80);
  v43 = *(MEMORY[0x1E69792E8] + 64);
  v44 = v12;
  v13 = *(MEMORY[0x1E69792E8] + 112);
  v45 = *(MEMORY[0x1E69792E8] + 96);
  v46 = v13;
  v14 = *(MEMORY[0x1E69792E8] + 16);
  v39 = *MEMORY[0x1E69792E8];
  v40 = v14;
  v15 = *(MEMORY[0x1E69792E8] + 48);
  v41 = *(MEMORY[0x1E69792E8] + 32);
  v42 = v15;
  [v11 setTransform:&v39];

  v16 = [v6 associatedItemView];
  [v16 frame];
  [v6 convertRect:v5 toCoordinateSpace:?];
  v18 = v17;
  v20 = v19;
  v22 = v21;
  v24 = v23;

  v35 = v51;
  v36 = v52;
  v37 = v53;
  v38 = v54;
  v31 = v47;
  v32 = v48;
  v33 = v49;
  v34 = v50;
  v25 = [v6 associatedItemView];

  v26 = [v25 layer];
  v43 = v35;
  v44 = v36;
  v45 = v37;
  v46 = v38;
  v39 = v31;
  v40 = v32;
  v41 = v33;
  v42 = v34;
  [v26 setTransform:&v39];

  v27 = v18;
  v28 = v20;
  v29 = v22;
  v30 = v24;
  result.size.height = v30;
  result.size.width = v29;
  result.origin.y = v28;
  result.origin.x = v27;
  return result;
}

- (void)sendAutomaticallyPlacedSticker:(id)a3 stickerReactionSession:(id)a4 forChatItem:(id)a5 forParentChatItem:(id)a6 stickerFrame:(CGRect)a7 animationCompletionHandler:(id)a8
{
  height = a7.size.height;
  width = a7.size.width;
  y = a7.origin.y;
  x = a7.origin.x;
  v17 = a3;
  v18 = a4;
  v19 = a5;
  v20 = a6;
  v21 = a8;
  v22 = [CKAutomaticallyPlacedStickerCommSafetySendContext contextWithAutomaticallyPlacedSticker:v17 stickerReactionSession:v18 chatItem:v19 parentChatItem:v20 stickerFrame:v21 animationCompletionHandler:x, y, width, height];
  v23 = +[CKMediaObjectManager sharedInstance];
  v24 = [v23 mediaObjectWithSticker:v17 stickerUserInfo:0];

  v25 = [v24 transfer];
  v26 = [v25 fileURL];
  v32[0] = MEMORY[0x1E69E9820];
  v32[1] = 3221225472;
  v32[2] = __144__CKChatController_sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke;
  v32[3] = &unk_1E72ED928;
  v33 = v17;
  v34 = self;
  v35 = v18;
  v36 = v19;
  v39 = x;
  v40 = y;
  v41 = width;
  v42 = height;
  v37 = v20;
  v38 = v21;
  v27 = v21;
  v28 = v20;
  v29 = v19;
  v30 = v18;
  v31 = v17;
  [(CKCoreChatController *)self presentCommSafetyInterventionIfNecessaryForFileURL:v26 withSendContext:v22 completion:v32];
}

void __144__CKChatController_sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke(double *a1, int a2)
{
  v17 = *MEMORY[0x1E69E9840];
  if (a2)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v4 = *(a1 + 4);
      v15 = 138412290;
      v16 = v4;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Sticker was sensitive, deferring send for intervention: %@", &v15, 0xCu);
    }
  }

  else
  {
    v6 = *(a1 + 4);
    v5 = *(a1 + 5);
    v7 = *(a1 + 6);
    v8 = *(a1 + 7);
    v9 = *(a1 + 8);
    v10 = *(a1 + 9);
    v11 = a1[10];
    v12 = a1[11];
    v13 = a1[12];
    v14 = a1[13];

    [v5 _sendAutomaticallyPlacedSticker:v6 stickerReactionSession:v7 forChatItem:v8 forParentChatItem:v9 stickerFrame:v10 animationCompletionHandler:{v11, v12, v13, v14}];
  }
}

- (void)_sendAutomaticallyPlacedSticker:(id)a3 stickerReactionSession:(id)a4 forChatItem:(id)a5 forParentChatItem:(id)a6 stickerFrame:(CGRect)a7 animationCompletionHandler:(id)a8
{
  height = a7.size.height;
  width = a7.size.width;
  y = a7.origin.y;
  x = a7.origin.x;
  v48 = *MEMORY[0x1E69E9840];
  v17 = a3;
  v18 = a4;
  v19 = a5;
  v20 = a6;
  v21 = a8;
  v22 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v23 = [v22 isReactWithAStickerEnabled];

  if (v23)
  {
    if (v17)
    {
      v24 = IMLogHandleForCategory();
      v25 = v24;
      if (v20)
      {
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v47 = v17;
          _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "Sending sticker: %@", buf, 0xCu);
        }

        v26 = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
        [v26 invalidate];

        [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
        v25 = [(CKCoreChatController *)self fullScreenBalloonViewController];
        v27 = [(CKCoreChatController *)self collectionViewController];
        v28 = [v27 balloonViewForChatItem:v20];

        if (v28)
        {
          [(CKChatController *)self setAnimatingStickerReaction:1];
          v29 = [(CKCoreChatController *)self conversation];
          v30 = [v29 chat];

          [v30 beginHoldingUpdatesForStickerMoveAnimation];
          [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:1];
          v31 = [(CKChatController *)self collectionView];
          [v31 beginHoldingContentOffsetUpdatesForReason:@"StickerAnimation"];

          objc_initWeak(buf, self);
          v36 = MEMORY[0x1E69E9820];
          v37 = 3221225472;
          v38 = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke;
          v39 = &unk_1E72ED9F0;
          objc_copyWeak(v45, buf);
          v32 = v17;
          v40 = v32;
          v41 = v25;
          v33 = v30;
          v42 = v33;
          v43 = v28;
          v45[1] = *&x;
          v45[2] = *&y;
          v45[3] = *&width;
          v45[4] = *&height;
          v44 = v21;
          [(CKChatController *)self setInsertItemsCallback:&v36];
          [v18 sendSticker:{v32, v36, v37, v38, v39}];

          objc_destroyWeak(v45);
          objc_destroyWeak(buf);
        }

        else
        {
          v34 = IMLogHandleForCategory();
          if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
          {
            [CKChatController _sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:];
          }

          [v18 sendSticker:v17];
          v35 = [(CKCoreChatController *)self inputController];
          [v35 endStickerReactionSession];

          if (v25)
          {
            [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 dismissAppCard:1 completion:0];
          }
        }
      }

      else if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:];
      }
    }

    else
    {
      v25 = IMLogHandleForCategory();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:];
      }
    }
  }
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  v8 = [WeakRetained _associatedStickerChatItemInInsertedIndexes:v6 matchingSticker:*(a1 + 32)];

  if (v8)
  {
    v9 = [v8 guid];
    v10 = objc_loadWeakRetained((a1 + 72));
    v11 = [v10 collectionViewController];
    v12 = [v11 cellForAssociatedChatItem:v8];

    v13 = objc_loadWeakRetained((a1 + 72));
    v14 = [v13 collectionViewController];
    [v14 beginHidingStickerWithGUIDDuringAddStickerAnimation:v9];

    if (*(a1 + 40))
    {
      v37 = v9;
      v38 = v5;
      v15 = objc_loadWeakRetained((a1 + 72));
      v16 = [v15 collectionViewController];
      v17 = [*(a1 + 40) chatItem];
      v18 = [v17 IMChatItem];
      v19 = [v18 guid];
      v20 = [v16 chatItemForGUID:v19];

      v21 = objc_loadWeakRetained((a1 + 72));
      [v21 updateChatItemBalloonViewAndStickerViews:v20 hidden:1];

      [*(a1 + 40) updateStickersAnimated:0];
      v22 = *(a1 + 40);
      v23 = [v8 IMChatItem];
      v24 = [v23 guid];
      [v22 setStickerVisibility:0 forStickerChatItemGUID:v24];

      v25 = objc_loadWeakRetained((a1 + 72));
      v52[0] = MEMORY[0x1E69E9820];
      v52[1] = 3221225472;
      v52[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_1220;
      v52[3] = &unk_1E72ED950;
      objc_copyWeak(v55, (a1 + 72));
      v26 = v20;
      v53 = v26;
      v54 = v12;
      [v25 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 dismissAppCard:0 completion:v52];

      v27 = objc_loadWeakRetained((a1 + 72));
      LODWORD(v17) = [v27 entryViewWasActiveOnContextMenuPresentation];

      if (v17)
      {
        v28 = objc_loadWeakRetained((a1 + 72));
        v29 = [v28 inputController];
        [v29 endStickerReactionSession];

        v30 = objc_loadWeakRetained((a1 + 72));
        [v30 updateActiveEntryViewPositioningGuide];

        v31 = objc_loadWeakRetained((a1 + 72));
        [v31 showKeyboard];
      }

      objc_destroyWeak(v55);
      v9 = v37;
      v5 = v38;
    }

    else
    {
      v33 = dispatch_time(0, 150000000);
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_2;
      block[3] = &unk_1E72EBB98;
      objc_copyWeak(&v51, (a1 + 72));
      v50 = *(a1 + 48);
      dispatch_after(v33, MEMORY[0x1E69E96A0], block);

      objc_destroyWeak(&v51);
    }

    v34 = *(a1 + 32);
    v39[0] = MEMORY[0x1E69E9820];
    v39[1] = 3221225472;
    v39[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_3;
    v39[3] = &unk_1E72ED9C8;
    v40 = *(a1 + 56);
    objc_copyWeak(&v46, (a1 + 72));
    v35 = v12;
    v41 = v35;
    v36 = *(a1 + 96);
    v47 = *(a1 + 80);
    v48 = v36;
    v32 = v9;
    v42 = v32;
    v43 = *(a1 + 48);
    v44 = *(a1 + 40);
    v45 = *(a1 + 64);
    [v34 stickerViewForStickerChatItem:v8 snapshotEffectView:1 completion:v39];

    objc_destroyWeak(&v46);
  }

  else
  {
    v32 = IMLogHandleForCategory();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_cold_1();
    }
  }
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_1220(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained setIgnoresAutomaticScrollsTowardBottom:1];

  v3 = objc_loadWeakRetained((a1 + 48));
  [v3 updateChatItemBalloonViewAndStickerViews:*(a1 + 32) hidden:0];

  v4 = [*(a1 + 40) associatedItemView];
  [v4 setHidden:1];
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained inputController];
  [v3 dismissStickerPickerPreservingChatItem:0 completion:0];

  [*(a1 + 32) beginHoldingUpdatesForStickerMoveAnimation];
  v4 = objc_loadWeakRetained((a1 + 40));
  [v4 setIgnoresAutomaticScrollsTowardBottom:1];

  v6 = objc_loadWeakRetained((a1 + 40));
  v5 = [v6 collectionView];
  [v5 beginHoldingContentOffsetUpdatesForReason:@"StickerPopoverDismiss"];
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_3(uint64_t a1, void *a2)
{
  v81[5] = *MEMORY[0x1E69E9840];
  v3 = a2;
  v57 = [*(a1 + 32) window];
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v5 = [WeakRetained fullScreenBalloonViewController];
  if (v5)
  {
    v6 = objc_loadWeakRetained((a1 + 80));
    v7 = [v6 fullScreenBalloonViewController];
    [v7 preservedBoundsInBalloonWindowAtAppearance];
    v9 = v8;
    v11 = v10;
    v13 = v12;
    v15 = v14;
  }

  else
  {
    v6 = [MEMORY[0x1E69DCEB0] mainScreen];
    [v6 bounds];
    v9 = v16;
    v11 = v17;
    v13 = v18;
    v15 = v19;
  }

  v75 = 0;
  v76 = &v75;
  v77 = 0x3032000000;
  v78 = __Block_byref_object_copy__8;
  v79 = __Block_byref_object_dispose__8;
  v80 = [[CKAnimationOverlayWindow alloc] initWithFrame:v9, v11, v13, v15];
  v20 = v76[5];
  v21 = [v57 windowScene];
  [v20 showInWindowScene:v21];

  [v76[5] addSubview:v3];
  v22 = objc_loadWeakRetained((a1 + 80));
  v23 = [v22 fullScreenBalloonViewController];
  if (v23)
  {
    v24 = objc_loadWeakRetained((a1 + 80));
    v25 = [v24 view];
    v56 = [v25 coordinateSpace];
  }

  else
  {
    v56 = [v76[5] coordinateSpace];
  }

  v26 = objc_loadWeakRetained((a1 + 80));
  [v26 _targetStickerFrameFromStickerCell:*(a1 + 40) coordinateSpace:v56];
  v28 = v27;
  v30 = v29;
  v32 = v31;
  v34 = v33;

  [v3 setFrame:{*(a1 + 88), *(a1 + 96), *(a1 + 104), *(a1 + 112)}];
  v73 = 0u;
  v74 = 0u;
  v71 = 0u;
  v72 = 0u;
  v69 = 0u;
  v70 = 0u;
  v67 = 0u;
  v68 = 0u;
  v35 = [*(a1 + 40) associatedItemView];
  v36 = [v35 layer];
  v37 = v36;
  if (v36)
  {
    [v36 transform];
  }

  else
  {
    v73 = 0u;
    v74 = 0u;
    v71 = 0u;
    v72 = 0u;
    v69 = 0u;
    v70 = 0u;
    v67 = 0u;
    v68 = 0u;
  }

  v66[5] = v72;
  v66[6] = v73;
  v66[7] = v74;
  v66[0] = v67;
  v66[1] = v68;
  v66[2] = v69;
  v66[3] = v70;
  v66[4] = v71;
  v55 = [MEMORY[0x1E6979300] ck_stickerFlyInTransformAnimationTo:v66];
  [v3 bounds];
  v40 = [MEMORY[0x1E6979300] ck_stickerFlyInBoundsAnimationFromSize:v38 toSize:{v39, v32, v34}];
  v41 = [MEMORY[0x1E6979300] ck_stickerFlyInSpringAnimation];
  v42 = [MEMORY[0x1E6979300] ck_stickerFlyInScaleAnimation];
  v43 = [MEMORY[0x1E6979300] ck_stickerFlyInMoveAnimationFromRect:*(a1 + 88) toRect:{*(a1 + 96), *(a1 + 104), *(a1 + 112), v28, v30, v32, v34}];
  v44 = [MEMORY[0x1E6979308] animation];
  [v41 beginTime];
  v46 = v45;
  [v41 duration];
  v48 = v47;
  [v42 duration];
  if (v46 + v48 >= v49)
  {
    v49 = v46 + v48;
  }

  [v44 setDuration:v49];
  v81[0] = v55;
  v81[1] = v43;
  v81[2] = v42;
  v81[3] = v41;
  v81[4] = v40;
  v50 = [MEMORY[0x1E695DEC8] arrayWithObjects:v81 count:5];
  [v44 setAnimations:v50];

  [v44 setFillMode:*MEMORY[0x1E69797E8]];
  [v44 setRemovedOnCompletion:0];
  [MEMORY[0x1E6979518] begin];
  v51 = MEMORY[0x1E6979518];
  [v44 duration];
  [v51 setAnimationDuration:?];
  v52 = MEMORY[0x1E6979518];
  v58[0] = MEMORY[0x1E69E9820];
  v58[1] = 3221225472;
  v58[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_4;
  v58[3] = &unk_1E72ED9A0;
  objc_copyWeak(&v65, (a1 + 80));
  v59 = *(a1 + 48);
  v53 = v3;
  v60 = v53;
  v64 = &v75;
  v61 = *(a1 + 56);
  v62 = *(a1 + 64);
  v63 = *(a1 + 72);
  [v52 setCompletionBlock:v58];
  v54 = [v53 layer];
  [v54 addAnimation:v44 forKey:0];

  [MEMORY[0x1E6979518] commit];
  objc_destroyWeak(&v65);

  _Block_object_dispose(&v75, 8);
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_4(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v3 = [WeakRetained collectionViewController];
  [v3 endHidingStickerWithGUIDDuringAddStickerAnimation:*(a1 + 32)];

  v4 = dispatch_time(0, 100000000);
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_5;
  v7[3] = &unk_1E72ED978;
  v5 = *(a1 + 40);
  v6 = *(a1 + 72);
  v8 = v5;
  v12 = v6;
  v9 = *(a1 + 48);
  objc_copyWeak(&v13, (a1 + 80));
  v10 = *(a1 + 56);
  v11 = *(a1 + 64);
  dispatch_after(v4, MEMORY[0x1E69E96A0], v7);

  objc_destroyWeak(&v13);
}

uint64_t __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_5(uint64_t a1)
{
  [*(a1 + 32) removeFromSuperview];
  [*(*(*(a1 + 64) + 8) + 40) dismiss];
  v2 = *(*(a1 + 64) + 8);
  v3 = *(v2 + 40);
  *(v2 + 40) = 0;

  [*(a1 + 40) endAllHoldsOnChatItemsUpdatesForStickerMoveAnimation];
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  v5 = [WeakRetained entryViewWasActiveOnContextMenuPresentation];

  if (v5)
  {
    v6 = objc_loadWeakRetained((a1 + 72));
    v7 = [v6 inputController];
    [v7 endStickerReactionSession];

    v8 = objc_loadWeakRetained((a1 + 72));
    [v8 showKeyboard];
  }

  else
  {
    v9 = [*(a1 + 48) displayConfiguration];
    v10 = [v9 shouldDismissAppCardOnExit];

    if (!v10)
    {
      goto LABEL_6;
    }

    v11 = objc_loadWeakRetained((a1 + 72));
    v12 = [v11 inputController];
    [v12 dismissAppCardIfNecessary];

    v8 = objc_loadWeakRetained((a1 + 72));
    v13 = [v8 inputController];
    [v13 endStickerReactionSession];
  }

LABEL_6:
  v14 = objc_loadWeakRetained((a1 + 72));
  [v14 setIgnoresAutomaticScrollsTowardBottom:0];

  v15 = objc_loadWeakRetained((a1 + 72));
  v16 = [v15 collectionView];
  [v16 endHoldingContentOffsetUpdatesForReason:@"StickerAnimation"];

  v17 = objc_loadWeakRetained((a1 + 72));
  v18 = [v17 collectionView];
  [v18 endHoldingContentOffsetUpdatesForReason:@"StickerPopoverDismiss"];

  v19 = objc_loadWeakRetained((a1 + 72));
  [v19 setAnimatingStickerReaction:0];

  v20 = objc_loadWeakRetained((a1 + 72));
  [v20 updateActiveEntryViewPositioningGuide];

  result = *(a1 + 56);
  if (result)
  {
    v22 = *(result + 16);

    return v22();
  }

  return result;
}

- (void)prewarmFunCamera
{
  if ([(CKChatController *)self isShowingCamera])
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Not prewarming FunCam, instance of camera already presented", buf, 2u);
      }
    }
  }

  else
  {
    v4 = [CKFunCameraViewController alloc];
    v5 = [(CKCoreChatController *)self conversation];
    v6 = [(CKFunCameraViewController *)v4 initWithConversation:v5];
    [(CKChatController *)self setFunCameraViewController:v6];

    v7 = +[CKBalloonPluginManager sharedInstance];
    v8 = [(CKChatController *)self funCameraViewController];
    v9 = [v8 balloonPlugin];
    v10 = [v9 identifier];
    v11 = [v7 viewControllerForPluginIdentifier:v10];

    [v11 prepareForPresentationWithCompletionHandler:&__block_literal_global_1228];
  }
}

- (BOOL)isFunCamPresented
{
  v3 = [(CKChatController *)self presentedViewController];
  if (v3)
  {
    v4 = [(CKChatController *)self funCameraViewController];
    v5 = v3 == v4;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (void)entryViewContainerViewDidLayoutSubviews:(id)a3
{
  v4 = [(CKChatController *)self sendMenuDelegate];
  v15 = [v4 activeSendMenuPresentationForChatController:self];

  [v15 informSendMenuOfAnchorViewPositionChangeIfNecessary];
  if ([MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode])
  {
    keyboardHeightFromPreviousLayout = self->_keyboardHeightFromPreviousLayout;
    [(CKChatController *)self _keyboardHeightFromLayoutGuide];
    if (vabdd_f64(keyboardHeightFromPreviousLayout, v6) > 0.01)
    {
      self->_keyboardHeightFromPreviousLayout = v6;
      v7 = [(CKCoreChatController *)self collectionViewController];
      v8 = [v7 collectionView];

      [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"CandidateBarHeightChanged"];
      v9 = +[CKScrollViewAnimationProperties unanimated];
      [v8 enforceTranscriptScrollIntentWithAnimationProperties:v9];
    }
  }

  entryViewMaxYFromPreviousLayout = self->_entryViewMaxYFromPreviousLayout;
  v11 = [(CKChatController *)self entryView];
  [v11 frame];
  MaxY = CGRectGetMaxY(v17);

  if (vabdd_f64(entryViewMaxYFromPreviousLayout, MaxY) > 0.01)
  {
    self->_entryViewMaxYFromPreviousLayout = MaxY;
    [(CKChatController *)self updateEntryViewHeightAnimated:0];
  }

  v13 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v14 = [v13 isTranscriptBackgroundsEnabled];

  if (v14)
  {
    [(CKCoreChatController *)self setNeedsPosterSaliencyAndOcclusionRectUpdate];
  }
}

- (id)messageEntryViewActiveSendMenuPresentation:(id)a3
{
  v4 = [(CKChatController *)self sendMenuDelegate];
  v5 = [v4 activeSendMenuPresentationForChatController:self];

  return v5;
}

- (BOOL)_shouldValidatePayloadBeforeSendingPayload:(id)a3
{
  v3 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = [v3 requiresValidation];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)createAlertControllerForAccountComposition:(id)a3 completion:(id)a4
{
  v44 = *MEMORY[0x1E69E9840];
  v28 = a3;
  v27 = a4;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"SEND_WITH_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v26 = [CKAlertController alertControllerWithTitle:v6 message:0 preferredStyle:0];

  v7 = [(CKCoreChatController *)self conversation];
  v8 = [v7 chat];
  v24 = [v8 lastAddressedHandleID];

  v9 = [(CKCoreChatController *)self conversation];
  v10 = [v9 chat];
  v23 = [v10 lastAddressedSIMID];

  v11 = [MEMORY[0x1E69A7F68] sharedInstance];
  v12 = [v11 ctSubscriptionInfo];
  v22 = [v12 __im_subscriptionContextForForSimID:v23 phoneNumber:v24];

  if (IMOSLoggingEnabled())
  {
    v13 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      *buf = 138412802;
      v39 = v23;
      v40 = 2112;
      v41 = v24;
      v42 = 2112;
      v43 = v22;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "FindAccountsForPrompt: lastSIM %@ lastHandle %@ found context %@", buf, 0x20u);
    }
  }

  if (!v22 && ![(CKChatController *)self _lastAddressedHandleIsAvailableAsiMessageAlias:v24 SIMID:v23])
  {
    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    obj = +[CKSenderIdentity senderIdentitiesForFromPicker];
    v14 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
    if (v14)
    {
      v15 = *v34;
      do
      {
        for (i = 0; i != v14; ++i)
        {
          if (*v34 != v15)
          {
            objc_enumerationMutation(obj);
          }

          v17 = *(*(&v33 + 1) + 8 * i);
          v18 = [v17 label];
          if (!v18)
          {
            v19 = CKFrameworkBundle();
            v18 = [v19 localizedStringForKey:@"CURRENT_LINE" value:&stru_1F04268F8 table:@"ChatKit"];
          }

          v30[0] = MEMORY[0x1E69E9820];
          v30[1] = 3221225472;
          v30[2] = __74__CKChatController_createAlertControllerForAccountComposition_completion___block_invoke;
          v30[3] = &unk_1E72EDA18;
          v30[4] = self;
          v30[5] = v17;
          v31 = v28;
          v32 = v27;
          v20 = [CKAlertAction actionWithTitle:v18 style:0 handler:v30];
          [v26 addAction:v20];
        }

        v14 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
      }

      while (v14);
    }
  }

  return v26;
}

void __74__CKChatController_createAlertControllerForAccountComposition_completion___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) conversation];
  v5 = [v2 chat];

  v3 = [*(a1 + 40) handle];
  [v5 setLastAddressedHandleID:v3];

  v4 = [*(a1 + 40) simID];
  [v5 setLastAddressedSIMID:v4];

  [*(a1 + 32) _validateAndSendComposition:*(a1 + 48) completion:*(a1 + 56)];
}

- (BOOL)_lastAddressedHandleIsAvailableAsiMessageAlias:(id)a3 SIMID:(id)a4
{
  v5 = MEMORY[0x1E69A5A80];
  v6 = a4;
  v7 = a3;
  v8 = [v5 sharedInstance];
  v9 = [v8 iMessageAccountForLastAddressedHandle:v7 simID:v6];

  return v9 != 0;
}

- (void)presentActionMenuForAccountSelection:(id)a3 completion:(id)a4
{
  v30 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self createAlertControllerForAccountComposition:v6 completion:v7];
  v9 = [(CKCoreChatController *)self conversation];
  v10 = [v9 sendingService];

  if ([v10 __ck_isiMessage])
  {
    v11 = 0;
  }

  else
  {
    v11 = [v10 __ck_isiMessageLite] ^ 1;
  }

  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = [v8 actions];
      v14 = v13;
      v15 = @"NO";
      *v25 = 138412802;
      if (v11)
      {
        v15 = @"YES";
      }

      *&v25[4] = v15;
      v26 = 2112;
      v27 = v10;
      v28 = 2112;
      v29 = v13;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "AccountSelection shouldShow %@ service %@ actions %@", v25, 0x20u);
    }
  }

  v16 = [v8 actions];
  v17 = [v16 count] != 0;

  if ((v17 & v11) != 0)
  {
    v18 = CKFrameworkBundle();
    v19 = [v18 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
    v20 = [CKAlertAction actionWithTitle:v19 style:1 handler:0];
    [v8 addAction:v20];

    v21 = [(CKChatController *)self effectPickerViewController];
    if (v21)
    {
      v22 = [(CKChatController *)self effectPickerViewController];
    }

    else
    {
      v22 = self;
    }

    v24 = v22;

    [v8 presentFromViewController:v24 animated:1 completion:0];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        *v25 = 0;
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Not showing account selection alert. Validate and send composition instead.", v25, 2u);
      }
    }

    [(CKChatController *)self _validateAndSendComposition:v6 completion:v7];
  }
}

- (void)disableRotationWhileRecordingAudioMessage
{
  if (self->_rotationLockUtility)
  {
    [(CKChatController *)self enableRotationAfterRecording];
  }

  v3 = [(CKChatController *)self view];
  v4 = [v3 window];
  v5 = [v4 windowScene];
  v8 = [v5 keyWindow];

  if (v8)
  {
    v6 = [[CKRotationLockUtility alloc] initWithWindow:v8];
    rotationLockUtility = self->_rotationLockUtility;
    self->_rotationLockUtility = v6;
  }
}

- (void)enableRotationAfterRecording
{
  [(CKRotationLockUtility *)self->_rotationLockUtility releaseRotationLock];
  rotationLockUtility = self->_rotationLockUtility;
  self->_rotationLockUtility = 0;
}

- (void)messageEntryViewSafeAreaInsetsDidChange:(id)a3
{
  if ([(CKChatController *)self nextEntryViewSafeAreaInsetUpdateIsSynchronous])
  {
    self->_nextEntryViewSafeAreaInsetUpdateIsSynchronous = 0;

    [(CKChatController *)self updateEntryViewHeightAnimated:0];
  }

  else
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __60__CKChatController_messageEntryViewSafeAreaInsetsDidChange___block_invoke;
    block[3] = &unk_1E72EBA18;
    block[4] = self;
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }
}

- (void)messageEntryView:(id)a3 didMoveToWindow:(id)a4
{
  [(CKChatController *)self _updateEntryViewConstraintsIfNeeded:a3];
  [(CKChatController *)self _setUpEntryViewAppCardLayoutConstraint];
  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];

  [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"EntryViewMovedToWindow"];
}

- (void)messageEntryViewRequestsVisionAppMenu:(id)a3 fromButton:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = MEMORY[0x1E69DD250];
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke;
  v22[3] = &unk_1E72EBA18;
  v9 = v7;
  v23 = v9;
  [v8 animateWithDuration:v22 animations:0.2];
  objc_initWeak(&location, self);
  v10 = [(CKCoreChatController *)self conversation];
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke_2;
  v19[3] = &unk_1E72EDA40;
  objc_copyWeak(&v20, &location);
  v14 = MEMORY[0x1E69E9820];
  v15 = 3221225472;
  v16 = __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke_3;
  v17 = &unk_1E72EBA18;
  v11 = v9;
  v18 = v11;
  v12 = [_TtC7ChatKit26CKVisionAppMenuViewFactory appMenuViewControllerWithConversation:v10 selectionHandler:v19 dismissHandler:&v14];

  v13 = [v12 popoverPresentationController];
  [v13 setSourceView:v11];

  [(CKChatController *)self presentViewController:v12 animated:1 completion:0];
  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);
}

void __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4 = [WeakRetained inputController];
  [v4 appSelectionInterfaceSelectedItem:v3];
}

- (void)messageEntryViewWantsSendLaterPickerPresented:(id)a3
{
  v3 = [(CKCoreChatController *)self inputController];
  [v3 showSendLater];
}

- (void)messageEntryViewSendLaterPluginInfoUpdated:(id)a3
{
  v4 = [(CKCoreChatController *)self inputController];
  [v4 sendLaterPluginInfoUpdated];

  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __63__CKChatController_messageEntryViewSendLaterPluginInfoUpdated___block_invoke;
  v5[3] = &unk_1E72EBA18;
  v5[4] = self;
  [(CKChatController *)self updateEntryViewHeightWithContentChange:1 animated:1 completionHandler:v5];
}

void __63__CKChatController_messageEntryViewSendLaterPluginInfoUpdated___block_invoke(uint64_t a1)
{
  v6 = [*(a1 + 32) collectionViewController];
  v2 = [CKTranscriptScrollIntentEntryViewChangedTrigger alloc];
  v3 = [*(a1 + 32) entryView];
  v4 = [(CKTranscriptScrollIntentEntryViewChangedTrigger *)v2 initWithEntryView:v3 isTextChange:0 isShelfChange:0 isSendLaterPluginChange:1];
  v5 = [*(a1 + 32) activeKeyboardAppearanceAnimationProperties];
  [v6 updateScrollIntentWithTrigger:v4 activeKeyboardAppearanceAnimationProperties:v5];
}

- (void)messageEntryViewWantsGenerativePlaygroundPluginPresented:(id)a3 presentationStyle:(unint64_t)a4
{
  v13 = IMBalloonExtensionIDWithSuffix();
  v6 = [MEMORY[0x1E69A5AD0] sharedInstance];
  v7 = [v6 balloonPluginForBundleID:v13];

  v8 = [CKTranscriptPluginPresentationConfiguration alloc];
  v9 = [(CKChatController *)self entryView];
  v10 = [v9 sendMenuSourceView];
  v11 = [(CKTranscriptPluginPresentationConfiguration *)v8 initWithSourceView:v10 permittedArrowDirections:8 shouldDisableSnapshotView:0];

  v12 = [(CKCoreChatController *)self inputController];
  [v12 showBrowserForPlugin:v7 dataSource:0 style:a4 presentationConfiguration:v11];
}

- (void)messageEntryViewWillPresentCustomizationPicker:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Will present customization picker", v6, 2u);
    }
  }

  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"LinkCustomizationPicker"];
  [(CKChatController *)self requestShowKeyboardSnapshotForReason:32];
}

- (void)messageEntryViewDidPresentCustomizationPicker:(id)a3
{
  v3 = a3;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Did present customization picker", v5, 2u);
    }
  }
}

- (void)messageEntryViewWillDismissCustomizationPicker:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Will dismiss customization picker", v6, 2u);
    }
  }

  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"LinkCustomizationPicker"];
}

- (void)messageEntryViewDidDismissCustomizationPicker:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Did dismiss customization picker", v6, 2u);
    }
  }

  [(CKChatController *)self requestDismissKeyboardSnapshotForReason:32];
}

- (void)messageEntryViewTextFormattingAnimationsOptionsPresentationInProgress:(BOOL)a3
{
  v3 = a3;
  if (([MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode] & 1) == 0)
  {

    [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:v3];
  }
}

- (void)enableSendButtonSpinner
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __43__CKChatController_enableSendButtonSpinner__block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __43__CKChatController_enableSendButtonSpinner__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 configureForDisplayMode:4];
}

- (void)disableSendButtonSpinner
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __44__CKChatController_disableSendButtonSpinner__block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __44__CKChatController_disableSendButtonSpinner__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 configureForDisplayMode:1];
}

- (int64_t)_sharingAccessTypeFromOptionsGroups:(id)a3
{
  v3 = a3;
  if (v3)
  {
    if (_sharingAccessTypeFromOptionsGroups___pred_CKSharingAccessTypeFromOptionsGroupsCloudKit != -1)
    {
      [CKChatController _sharingAccessTypeFromOptionsGroups:];
    }

    v4 = _sharingAccessTypeFromOptionsGroups___CKSharingAccessTypeFromOptionsGroups(v3);
  }

  else
  {
    v4 = 1;
  }

  return v4;
}

void *__56__CKChatController__sharingAccessTypeFromOptionsGroups___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CKSharingAccessTypeFromOptionsGroups", @"CloudKit");
  _sharingAccessTypeFromOptionsGroups___CKSharingAccessTypeFromOptionsGroups = result;
  return result;
}

- (int64_t)_sharingPermissionTypeFromOptionsGroups:(id)a3
{
  v3 = a3;
  if (v3)
  {
    if (_sharingPermissionTypeFromOptionsGroups___pred_CKSharingPermissionTypeFromOptionsGroupsCloudKit != -1)
    {
      [CKChatController _sharingPermissionTypeFromOptionsGroups:];
    }

    v4 = _sharingPermissionTypeFromOptionsGroups___CKSharingPermissionTypeFromOptionsGroups(v3);
  }

  else
  {
    v4 = 2;
  }

  return v4;
}

void *__60__CKChatController__sharingPermissionTypeFromOptionsGroups___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CKSharingPermissionTypeFromOptionsGroups", @"CloudKit");
  _sharingPermissionTypeFromOptionsGroups___CKSharingPermissionTypeFromOptionsGroups = result;
  return result;
}

- (BOOL)_sharingAllowOthersToInviteFromOptionsGroups:(id)a3
{
  v3 = a3;
  if (v3)
  {
    if (_sharingAllowOthersToInviteFromOptionsGroups___pred_CKSharingAllowOthersToInviteFromOptionsGroupsCloudKit != -1)
    {
      [CKChatController _sharingAllowOthersToInviteFromOptionsGroups:];
    }

    v4 = _sharingAllowOthersToInviteFromOptionsGroups___CKSharingAllowOthersToInviteFromOptionsGroups(v3);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

void *__65__CKChatController__sharingAllowOthersToInviteFromOptionsGroups___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CKSharingAllowOthersToInviteFromOptionsGroups", @"CloudKit");
  _sharingAllowOthersToInviteFromOptionsGroups___CKSharingAllowOthersToInviteFromOptionsGroups = result;
  return result;
}

- (void)sendCollaborationCompositionAndSetSendingState:(id)a3
{
  v4 = a3;
  if (IMIsRunningInMessagesComposeViewService())
  {
    [(CKChatController *)self sendComposition:v4];
  }

  else
  {
    [(CKChatController *)self sendCompositionIfAllowed:v4];
  }

  [(CKChatController *)self setIsSettingUpCollaboration:0];
}

- (void)sendCompositionForFileProvider:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v9 = [v6 shelfPluginPayload];
    v10 = [v9 url];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke;
    v11[3] = &unk_1E72EDB58;
    v11[4] = self;
    v12 = v6;
    v13 = v7;
    v14 = v8;
    [(objc_class *)v8 existingShareForFileOrFolderURL:v10 completionHandler:v11];
  }
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = v9;
  if (!v9)
  {
    v25[0] = MEMORY[0x1E69E9820];
    v25[1] = 3221225472;
    v25[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_2;
    v25[3] = &unk_1E72EDB30;
    v16 = v8;
    v31 = *(a1 + 56);
    v17 = *(a1 + 32);
    v18 = *(a1 + 40);
    v26 = v16;
    v27 = v17;
    v28 = v18;
    v29 = v7;
    v30 = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], v25);

    v15 = v26;
    goto LABEL_14;
  }

  v11 = [v9 domain];
  if ([v11 isEqualToString:*MEMORY[0x1E695B740]])
  {
    v12 = [v10 code];

    if (v12 == 12)
    {
      if (IMOSLoggingEnabled())
      {
        v13 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Sending collaboration composition for file provider.", buf, 2u);
        }
      }

      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1257;
      block[3] = &unk_1E72EDA68;
      v14 = *(a1 + 40);
      block[4] = *(a1 + 32);
      v36 = v14;
      v37 = *(a1 + 48);
      dispatch_async(MEMORY[0x1E69E96A0], block);

      v15 = v36;
      goto LABEL_14;
    }
  }

  else
  {
  }

  v19 = IMLogHandleForCategory();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
  {
    __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_cold_1(v10);
  }

  v20 = *(a1 + 32);
  v21 = *(a1 + 40);
  v32[0] = MEMORY[0x1E69E9820];
  v32[1] = 3221225472;
  v32[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1258;
  v32[3] = &unk_1E72EDA90;
  v22 = *(a1 + 48);
  v23 = *(a1 + 32);
  v24 = *(a1 + 40);
  v34 = v22;
  v32[4] = v23;
  v33 = v24;
  [v20 presentCollaborationFailureAlertForComposition:v21 sharingURL:v7 error:v10 completion:v32];

  v15 = v34;
LABEL_14:
}

uint64_t __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1258(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForFileProvider:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_2(uint64_t a1)
{
  v17 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      *buf = 138412290;
      v16 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Querying for current user's status on share %@", buf, 0xCu);
    }
  }

  v4 = *(a1 + 72);
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259;
  v11[3] = &unk_1E72EDB08;
  v5 = *(a1 + 32);
  *&v6 = v5;
  *(&v6 + 1) = *(a1 + 40);
  v10 = v6;
  v7 = *(a1 + 48);
  v8 = *(a1 + 56);
  *&v9 = v7;
  *(&v9 + 1) = v8;
  v12 = v10;
  v13 = v9;
  v14 = *(a1 + 64);
  [v4 sharingStatusForShare:v5 completionHandler:v11];
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259(uint64_t a1, unint64_t a2, void *a3)
{
  v42 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [*(a1 + 32) recordID];
      *buf = 138412802;
      v37 = v7;
      v38 = 2048;
      v39 = a2;
      v40 = 2112;
      v41 = v5;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Received current user's status for share %@, status: %ld, error: %@", buf, 0x20u);
    }
  }

  if (v5)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259_cold_1();
    }

    v10 = *(a1 + 40);
    v9 = *(a1 + 48);
    v11 = *(a1 + 56);
    v33[0] = MEMORY[0x1E69E9820];
    v33[1] = 3221225472;
    v33[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1260;
    v33[3] = &unk_1E72EDAB8;
    v33[4] = v10;
    v34 = v9;
    v35 = *(a1 + 64);
    [v10 presentCollaborationFailureAlertForComposition:v34 sharingURL:v11 error:v5 completion:v33];
  }

  else if (a2 <= 4 && ((1 << a2) & 0x16) != 0)
  {
    if (IMOSLoggingEnabled())
    {
      v12 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Updating collaboration composition for file provider.", buf, 2u);
      }
    }

    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1261;
    block[3] = &unk_1E72EDAE0;
    v25 = *(a1 + 40);
    v13 = *(a1 + 48);
    v14 = *(a1 + 32);
    v15 = *(a1 + 56);
    *&v16 = v14;
    *(&v16 + 1) = v15;
    *&v17 = v25;
    *(&v17 + 1) = v13;
    v30 = v17;
    v31 = v16;
    v32 = *(a1 + 64);
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v37 = 0;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Can't add people because you are not the owner or the share doesn't allow others to invite. Error: %@", buf, 0xCu);
      }
    }

    v19 = *(a1 + 40);
    v20 = *(a1 + 48);
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1262;
    v26[3] = &unk_1E72EDA90;
    v21 = *(a1 + 56);
    v22 = *(a1 + 64);
    v23 = *(a1 + 40);
    v24 = *(a1 + 48);
    v28 = v22;
    v26[4] = v23;
    v27 = v24;
    [v19 presentCollaborationFailureAlertForComposition:v20 sharingURL:v21 error:0 completion:v26];
  }
}

uint64_t __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1260(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForFileProvider:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1262(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForFileProvider:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (id)createAnalyticsDictionaryForCollaborationForType:(int64_t)a3 sharingURL:(id)a4
{
  v28 = *MEMORY[0x1E69E9840];
  v5 = a4;
  v6 = objc_alloc_init(MEMORY[0x1E69A82D8]);
  [v6 bundleIDsForCollaborationURL:v5];
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v7 = v24 = 0u;
  v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
  if (v8)
  {
    v9 = v8;
    v20 = a3;
    v10 = *v22;
    v11 = @"NA";
    while (2)
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v22 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v13 = *(*(&v21 + 1) + 8 * i);
        v14 = [objc_alloc(MEMORY[0x1E69635F8]) initWithBundleIdentifier:v13 allowPlaceholder:0 error:0];
        if (v14)
        {
          v15 = v14;
          v11 = v13;

          goto LABEL_11;
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
      if (v9)
      {
        continue;
      }

      break;
    }

LABEL_11:
    a3 = v20;
  }

  else
  {
    v11 = @"NA";
  }

  v16 = *MEMORY[0x1E69A72D8];
  v25[0] = *MEMORY[0x1E69A72C8];
  v25[1] = v16;
  v26[0] = v11;
  v17 = [MEMORY[0x1E696AD98] numberWithInteger:a3];
  v26[1] = v17;
  v18 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v26 forKeys:v25 count:2];

  return v18;
}

- (void)sendAnalyticsForElapsedSendTimeForType:(int64_t)a3 sharingURL:(id)a4 timeInterval:(double)a5
{
  v6 = [(CKChatController *)self createAnalyticsDictionaryForCollaborationForType:a3 sharingURL:a4];
  v9 = [v6 mutableCopy];

  v7 = [MEMORY[0x1E696AD98] numberWithDouble:a5];
  [v9 setObject:v7 forKey:*MEMORY[0x1E69A72D0]];

  v8 = [MEMORY[0x1E69A8168] sharedInstance];
  [v8 trackEvent:*MEMORY[0x1E69A7378] withDictionary:v9];
}

- (void)_sendCollaborationCompositionForFileProvider:(id)a3 sharingURL:(id)a4 share:(id)a5 completion:(id)a6
{
  v41 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v27 = a5;
  v12 = a6;
  if (v11)
  {
    v13 = [v10 shelfPluginPayload];
    v14 = [v13 url];
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke;
    aBlock[3] = &unk_1E72EDB80;
    v15 = v13;
    v34 = v15;
    v16 = v11;
    v35 = v16;
    v36 = self;
    v37 = v10;
    v38 = v12;
    v17 = _Block_copy(aBlock);
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v40 = v14;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Starting to perform _SWStartCollaborationAction action for url: %@", buf, 0xCu);
      }
    }

    if (_sendCollaborationCompositionForFileProvider_sharingURL_share_completion___pred_SWPerformActionForDocumentURLSharedWithYouCore != -1)
    {
      [CKChatController _sendCollaborationCompositionForFileProvider:sharingURL:share:completion:];
    }

    v19 = MEMORY[0x1E697B740];
    v20 = [v15 collaborationMetadata];
    v21 = [v19 actionWithMetadata:v20];

    v22 = _sendCollaborationCompositionForFileProvider_sharingURL_share_completion___SWPerformActionForDocumentURL;
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2;
    v28[3] = &unk_1E72EDBA8;
    v29 = v15;
    v30 = v27;
    v31 = v16;
    v32 = v17;
    v23 = v17;
    v24 = v15;
    v25 = _Block_copy(v28);
    v22(v14, v21, v25);
  }

  else if (IMOSLoggingEnabled())
  {
    v26 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Received nil share URL from CloudSharing.", buf, 2u);
    }
  }
}

void __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke(uint64_t a1, void *a2)
{
  v32 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (v3)
  {
    [*(a1 + 32) setCollaborationMetadata:v3];
  }

  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) ckURLByPercentEncodingFragment];
  [v4 setUrl:v5];

  v6 = *(a1 + 32);
  v7 = [MEMORY[0x1E696AEC0] stringGUID];
  [v6 setMessageGUID:v7];

  v8 = *(a1 + 32);
  v9 = [*(a1 + 40) absoluteString];
  if ([v9 length])
  {
    v10 = objc_alloc(MEMORY[0x1E696AAB0]);
    v11 = [*(a1 + 40) absoluteString];
    v12 = [v10 initWithString:v11];
    [v8 setText:v12];
  }

  else
  {
    [v8 setText:0];
  }

  [*(a1 + 32) setPluginBundleID:*MEMORY[0x1E69A6A18]];
  v13 = *(a1 + 48);
  v14 = *(a1 + 32);
  v15 = [v14 messageGUID];
  v16 = [v13 updateDataSourceForPluginPayload:v14 forGUID:v15 withCollaborationMetadata:v3 shareURL:*(a1 + 40)];

  v17 = [CKComposition alloc];
  v18 = [*(a1 + 56) text];
  v19 = [*(a1 + 56) subject];
  v20 = [(CKComposition *)v17 initWithText:v18 subject:v19 shelfPluginPayload:v16];

  if (IMOSLoggingEnabled())
  {
    v21 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = *(a1 + 40);
      v23 = [v16 collaborationMetadata];
      *buf = 138412546;
      v29 = v22;
      v30 = 2112;
      v31 = v23;
      _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Sending the final composition for sharingURL: %@ with CollaborationMetadata:%@", buf, 0x16u);
    }
  }

  [*(a1 + 48) setShareWasCreated:1];
  v24 = [*(a1 + 32) collaborationMetadata];
  [v24 checkSendReadiness];

  [*(*(a1 + 48) + 1512) stopTimingForKey:@"sendGelato"];
  [*(*(a1 + 48) + 1512) totalTimeForKey:@"sendGelato"];
  [*(a1 + 48) sendAnalyticsForElapsedSendTimeForType:1 sharingURL:*(a1 + 40) timeInterval:?];
  if ([MEMORY[0x1E696AF00] isMainThread])
  {
    [*(a1 + 48) sendCollaborationCompositionAndSetSendingState:v20];
  }

  else
  {
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_1276;
    v26[3] = &unk_1E72EB8D0;
    v26[4] = *(a1 + 48);
    v27 = v20;
    dispatch_sync(MEMORY[0x1E69E96A0], v26);
  }

  v25 = *(a1 + 64);
  if (v25)
  {
    (*(v25 + 16))(v25, 1);
  }
}

void *__93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_1278()
{
  result = MEMORY[0x193AF5ED0]("SWPerformActionForDocumentURL", @"SharedWithYouCore");
  _sendCollaborationCompositionForFileProvider_sharingURL_share_completion___SWPerformActionForDocumentURL = result;
  return result;
}

void __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v5;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  if ([v8 success] && (objc_msgSend(v8, "url"), (v9 = objc_claimAutoreleasedReturnValue()) != 0) && (objc_msgSend(v8, "updatedMetadata"), v10 = objc_claimAutoreleasedReturnValue(), v10, v9, v10))
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = [v8 url];
        v13 = [v8 updatedMetadata];
        v20 = 138412546;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Updating the collaborationMetadata for url: %@ with metadata: %@", &v20, 0x16u);
      }
    }

    v14 = [*(a1 + 32) collaborationMetadata];
    v15 = [v8 updatedMetadata];
    v16 = [v14 updatedCollaborationMetadataWithUpdatedMetadata:v15 ckShare:*(a1 + 40) sharingURL:*(a1 + 48)];

    if (!v16)
    {
      v17 = IMLogHandleForCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2_cold_1();
      }
    }

    (*(*(a1 + 56) + 16))();
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v20 = 138412290;
        v21 = v6;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Failed to update the collaborationMetadata. Error: %@", &v20, 0xCu);
      }
    }

    v19 = *(a1 + 56);
    v16 = [*(a1 + 32) collaborationMetadata];
    (*(v19 + 16))(v19, v16);
  }
}

- (void)_sendCompositionForFileProviderCloudDrive:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [v6 shelfPluginPayload];
  v9 = [v8 url];
  v10 = MEMORY[0x1E6994FC0];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke;
  v14[3] = &unk_1E72EDC48;
  v15 = v9;
  v16 = self;
  v17 = v6;
  v18 = v7;
  v11 = v7;
  v12 = v6;
  v13 = v9;
  [v10 sharingStatusForFileOrFolderURL:v13 completionHandler:v14];
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke(id *a1, unint64_t a2, void *a3)
{
  v35 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (v5)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_cold_1();
    }

    v8 = a1[5];
    v7 = a1[6];
    v9 = a1[4];
    v29[0] = MEMORY[0x1E69E9820];
    v29[1] = 3221225472;
    v29[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1289;
    v29[3] = &unk_1E72EDBD0;
    v30 = a1[7];
    [v8 presentCollaborationFailureAlertForComposition:v7 sharingURL:v9 error:v5 completion:v29];
  }

  else
  {
    if (a2 > 6)
    {
      v10 = 0;
      v25 = 0;
    }

    else
    {
      if (a2 == 3)
      {
        [a1[5] _startSharingForURLForFileProviderCloudDrive:a1[6] completion:a1[7]];
        goto LABEL_13;
      }

      v25 = @"CKCollaborationStatusErrorDomain";
      v10 = a2;
    }

    [a1[5] disableSendButtonSpinner];
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = a1[4];
        *buf = 138412546;
        v32 = v12;
        v33 = 2048;
        v34 = a2;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Unable to share %@ with CSUIShareItemStatus: %ld", buf, 0x16u);
      }
    }

    v14 = (a1 + 5);
    v13 = a1[5];
    v15 = a1 + 6;
    v16 = a1[6];
    v18 = a1 + 4;
    v17 = a1[4];
    v19 = [MEMORY[0x1E696ABC0] errorWithDomain:v25 code:v10 userInfo:0];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1290;
    v26[3] = &unk_1E72EDC20;
    v20 = a1[7];
    v24 = *v14;
    v21 = *v15;
    *&v22 = *v18;
    *(&v22 + 1) = v20;
    *&v23 = v24;
    *(&v23 + 1) = v21;
    v27 = v23;
    v28 = v22;
    [v13 presentCollaborationFailureAlertForComposition:v16 sharingURL:v17 error:v19 completion:v26];
  }

LABEL_13:
}

uint64_t __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1289(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1290(uint64_t a1, uint64_t a2)
{
  if (a2 == 2)
  {
    v6 = *(a1 + 32);
    v7 = *(a1 + 40);
    v8 = *(a1 + 56);

    [v6 _startSharingForURLForFileProviderCloudDrive:v7 completion:v8];
  }

  else if (a2 == 3)
  {
    [*(a1 + 32) enableSendButtonSpinner];
    v4 = *(a1 + 32);
    v3 = *(a1 + 40);
    v5 = *(a1 + 48);
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_2;
    v11[3] = &unk_1E72EDBF8;
    v11[4] = v4;
    v12 = v3;
    v13 = *(a1 + 56);
    [v4 _removeSubsharesAndSendFileProviderComposition:v12 shareURL:v5 completion:v11];
  }

  else
  {
    v9 = *(a1 + 56);
    if (v9)
    {
      v10 = *(v9 + 16);

      v10();
    }
  }
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v7 = a2;
  v5 = a3;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v7 && v5)
  {
    [*(a1 + 32) _sendCollaborationCompositionForFileProvider:*(a1 + 40) sharingURL:v7 share:v5 completion:*(a1 + 48)];
  }

  else
  {
    v6 = *(a1 + 48);
    if (v6)
    {
      (*(v6 + 16))(v6, 0);
    }
  }
}

- (void)_startSharingForURLForFileProviderCloudDrive:(id)a3 completion:(id)a4
{
  v38 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v26 = a4;
  v7 = [v6 shelfPluginPayload];
  v27 = [v7 url];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v33 = v27;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Sending composition for iCloudDrive. url = %@", buf, 0xCu);
    }
  }

  v9 = [(CKCoreChatController *)self conversation];
  v10 = [v9 recipientPhoneNumbers];

  v11 = [(CKCoreChatController *)self conversation];
  v12 = [v11 recipientEmailAddresses];

  v13 = [v6 collaborationShareOptions];
  v14 = [v13 optionsGroups];
  v15 = [(CKChatController *)self _sharingAccessTypeFromOptionsGroups:v14];

  v16 = [v13 optionsGroups];
  v17 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:v16];

  v18 = [v13 optionsGroups];
  v19 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:v18];

  if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = @"NO";
      *buf = 134218498;
      v33 = v15;
      if (v19)
      {
        v21 = @"YES";
      }

      v34 = 2048;
      v35 = v17;
      v36 = 2112;
      v37 = v21;
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Invoking the share creation with options: accessType: %ld, permissionType:%ld, allowOthersToInvite=%@", buf, 0x20u);
    }
  }

  v22 = objc_alloc_init(MEMORY[0x1E69A6170]);
  [v22 startTimingForKey:@"shareFileOrFolderURL"];
  v23 = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v24 = [v13 optionsGroups];
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke;
    v28[3] = &unk_1E72EDC70;
    v28[4] = self;
    v29 = v22;
    v30 = v6;
    v31 = v26;
    [(objc_class *)v23 shareFileOrFolderURL:v27 emailAddresses:v12 phoneNumbers:v10 optionsGroups:v24 completionHandler:v28];
  }

  else
  {
    v25 = IMLogHandleForCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_FAULT))
    {
      [CKChatController _startSharingForURLForFileProviderCloudDrive:completion:];
    }
  }
}

void __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke(id *a1, void *a2, void *a3, void *a4)
{
  v29 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [a1[4] disableSendButtonSpinner];
  [a1[5] stopTimingForKey:@"shareFileOrFolderURL"];
  [a1[5] totalTimeForKey:@"shareFileOrFolderURL"];
  v11 = v10;
  v12 = IMLogHandleForCategory();
  v13 = v12;
  if (v9)
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_cold_1();
    }

    v14 = a1[4];
    v24[0] = MEMORY[0x1E69E9820];
    v24[1] = 3221225472;
    v24[2] = __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_1298;
    v24[3] = &unk_1E72EDA90;
    v15 = a1[6];
    v16 = a1[7];
    v17 = a1[4];
    v26 = v16;
    v24[4] = v17;
    v25 = a1[6];
    [v14 presentCollaborationFailureAlertForComposition:v15 sharingURL:v7 error:v9 completion:v24];

    v18 = v26;
  }

  else
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      *buf = 134217984;
      v28 = v11;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "shareFileOrFolderURL finished in %f seconds", buf, 0xCu);
    }

    v19[0] = MEMORY[0x1E69E9820];
    v19[1] = 3221225472;
    v19[2] = __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_1299;
    v19[3] = &unk_1E72EDAE0;
    v19[4] = a1[4];
    v20 = a1[6];
    v21 = v7;
    v22 = v8;
    v23 = a1[7];
    dispatch_async(MEMORY[0x1E69E96A0], v19);

    v18 = v20;
  }
}

uint64_t __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_1298(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) _sendCompositionForFileProviderCloudDrive:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)_updateAndSendCompositionForFileProvider:(id)a3 share:(id)a4 sharingURL:(id)a5 completion:(id)a6
{
  v76 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v48 = a5;
  v49 = a6;
  v50 = v11;
  v51 = v10;
  if (v11)
  {
    if (v10)
    {
      v12 = [(CKCoreChatController *)self conversation];
      v13 = [v12 recipientPhoneNumbers];
      v14 = v13;
      if (v13)
      {
        v15 = v13;
      }

      else
      {
        v15 = [MEMORY[0x1E695DEC8] array];
      }

      v17 = v15;

      v18 = [(CKCoreChatController *)self conversation];
      v19 = [v18 recipientEmailAddresses];
      v20 = v19;
      if (v19)
      {
        v21 = v19;
      }

      else
      {
        v21 = [MEMORY[0x1E695DEC8] array];
      }

      v22 = v21;

      v23 = [v10 shelfPluginPayload];
      v24 = [v23 containerSetupInfo];

      v47 = [v10 collaborationShareOptions];
      v25 = [v47 optionsGroups];
      v26 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:v25];

      v27 = [v47 optionsGroups];
      v28 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:v27];

      if (IMOSLoggingEnabled())
      {
        v29 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
        {
          if (v28)
          {
            v30 = @"YES";
          }

          else
          {
            v30 = @"NO";
          }

          v31 = [v17 componentsJoinedByString:{@", "}];
          v32 = [v22 componentsJoinedByString:{@", "}];
          *buf = 134218754;
          *&buf[4] = v26;
          *&buf[12] = 2112;
          *&buf[14] = v30;
          *&buf[22] = 2112;
          v73 = v31;
          v74 = 2112;
          v75 = v32;
          _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "Updating the share with options: permissionType:%ld, allowOthersToInvite=%@, new phone numbers: %@, new email addresses: %@", buf, 0x2Au);
        }
      }

      v33 = [(CKChatController *)self CKCloudSharingClass];
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x2020000000;
      LOBYTE(v73) = [v50 publicPermission] != 1;
      aBlock[0] = MEMORY[0x1E69E9820];
      aBlock[1] = 3221225472;
      aBlock[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke;
      aBlock[3] = &unk_1E72EDD10;
      v68 = buf;
      aBlock[4] = self;
      v34 = v51;
      v61 = v34;
      v35 = v26;
      v36 = v48;
      v62 = v36;
      v37 = v50;
      v63 = v37;
      v38 = v17;
      v39 = v49;
      v67 = v39;
      v69 = v33;
      v46 = v24;
      v64 = v46;
      v45 = v22;
      v65 = v45;
      v16 = v38;
      v66 = v16;
      v70 = v35;
      v71 = v28;
      v40 = _Block_copy(aBlock);
      v41 = MEMORY[0x1E6994FC0];
      v42 = [v34 shelfPluginPayload];
      v43 = [v42 url];
      v53[0] = MEMORY[0x1E69E9820];
      v53[1] = 3221225472;
      v53[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3;
      v53[3] = &unk_1E72EDD60;
      v54 = v36;
      v55 = self;
      v56 = v34;
      v58 = v39;
      v44 = v40;
      v59 = v44;
      v57 = v37;
      [v41 sharingStatusForFileOrFolderURL:v43 completionHandler:v53];

      _Block_object_dispose(buf, 8);
    }

    else
    {
      v16 = IMLogHandleForCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _updateAndSendCompositionForFileProvider:a2 share:? sharingURL:? completion:?];
      }
    }
  }

  else
  {
    v16 = IMLogHandleForCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      [CKChatController _updateAndSendCompositionForFileProvider:a2 share:? sharingURL:? completion:?];
    }
  }
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke(uint64_t a1)
{
  if (*(*(*(a1 + 96) + 8) + 24) == 1)
  {
    if (IMOSLoggingEnabled())
    {
      v2 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Not calling addParticipants because it's a public share.", buf, 2u);
      }
    }

    [*(a1 + 32) _sendCollaborationCompositionForFileProvider:*(a1 + 40) sharingURL:*(a1 + 48) share:*(a1 + 56) completion:*(a1 + 88)];
  }

  else if (objc_opt_respondsToSelector())
  {
    v3 = *(a1 + 56);
    v4 = *(a1 + 64);
    v5 = *(a1 + 72);
    v6 = *(a1 + 80);
    v7 = *(a1 + 104);
    v8 = *(a1 + 112);
    v9 = *(a1 + 120);
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306;
    v11[3] = &unk_1E72EDCE8;
    v10 = *(a1 + 40);
    v11[4] = *(a1 + 32);
    v12 = v10;
    v14 = *(a1 + 88);
    v13 = *(a1 + 48);
    [v7 addParticipantsToShare:v3 containerSetupInfo:v4 emailAddresses:v5 phoneNumbers:v6 permissionType:v8 allowOthersToInvite:v9 completionHandler:v11];
  }
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v9)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306_cold_1();
    }

    v11 = *(a1 + 32);
    v12 = *(a1 + 40);
    v32[0] = MEMORY[0x1E69E9820];
    v32[1] = 3221225472;
    v32[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1307;
    v32[3] = &unk_1E72EDC98;
    v13 = &v36;
    v14 = *(a1 + 56);
    v15 = *(a1 + 32);
    v16 = *(a1 + 40);
    v36 = v14;
    v32[4] = v15;
    v33 = v16;
    v34 = v8;
    v35 = v7;
    v17 = v7;
    v18 = v8;
    [v11 presentCollaborationFailureAlertForComposition:v12 sharingURL:v17 error:v9 completion:v32];

    v19 = v33;
  }

  else
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2;
    block[3] = &unk_1E72EDCC0;
    v13 = &v26;
    v26 = v7;
    v20 = *(a1 + 48);
    v21 = *(a1 + 32);
    v22 = *(a1 + 40);
    v27 = v20;
    v28 = v21;
    v29 = v22;
    v30 = v8;
    v31 = *(a1 + 56);
    v23 = v7;
    v24 = v8;
    dispatch_async(MEMORY[0x1E69E96A0], block);

    v19 = v27;
  }
}

uint64_t __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1307(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) _updateAndSendCompositionForFileProvider:*(a1 + 40) share:*(a1 + 48) sharingURL:*(a1 + 56) completion:*(a1 + 64)];
  }

  result = *(a1 + 64);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = v2;
  v4 = *(a1 + 40);
  if (v4)
  {
    v6 = v2;
    v5 = v4;

    v3 = v5;
  }

  v7 = v3;
  [*(a1 + 48) _sendCollaborationCompositionForFileProvider:*(a1 + 56) sharingURL:v3 share:*(a1 + 64) completion:*(a1 + 72)];
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3(id *a1, unint64_t a2, void *a3)
{
  v33 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (v5)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3_cold_1();
    }

    v8 = a1[5];
    v7 = a1[6];
    v9 = a1[4];
    v27[0] = MEMORY[0x1E69E9820];
    v27[1] = 3221225472;
    v27[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1309;
    v27[3] = &unk_1E72EDBD0;
    v28 = a1[8];
    [v8 presentCollaborationFailureAlertForComposition:v7 sharingURL:v9 error:v5 completion:v27];
  }

  else if (a2 <= 6)
  {
    if (((1 << a2) & 0x63) != 0)
    {
      [a1[5] disableSendButtonSpinner];
      if (IMOSLoggingEnabled())
      {
        v10 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = a1[4];
          *buf = 134218242;
          v30 = a2;
          v31 = 2112;
          v32 = v11;
          _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "_checkEnclosingShareForFileProviderUpdate received CSUIShareItemStatus: %ld for url: %@", buf, 0x16u);
        }
      }

      v12 = a1[5];
      v13 = a1[6];
      v14 = a1[4];
      v15 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationStatusErrorDomain" code:a2 userInfo:0];
      v22[0] = MEMORY[0x1E69E9820];
      v22[1] = 3221225472;
      v22[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1310;
      v22[3] = &unk_1E72EDD38;
      v25 = a1[8];
      v21 = a1[5];
      v16 = a1[6];
      v17 = a1[7];
      v18 = a1[4];
      *&v19 = v17;
      *(&v19 + 1) = v18;
      *&v20 = v21;
      *(&v20 + 1) = v16;
      v23 = v20;
      v24 = v19;
      v26 = a1[9];
      [v12 presentCollaborationFailureAlertForComposition:v13 sharingURL:v14 error:v15 completion:v22];
    }

    else
    {
      (*(a1[9] + 2))();
    }
  }
}

uint64_t __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1309(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1310(uint64_t a1, uint64_t a2)
{
  if (a2 > 1)
  {
    if (a2 == 2)
    {
      v13 = *(*(a1 + 72) + 16);

      v13();
    }

    else if (a2 == 3)
    {
      [*(a1 + 32) enableSendButtonSpinner];
      v9 = *(a1 + 32);
      v8 = *(a1 + 40);
      v10 = *(a1 + 56);
      v14[0] = MEMORY[0x1E69E9820];
      v14[1] = 3221225472;
      v14[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2_1311;
      v14[3] = &unk_1E72EDBF8;
      v14[4] = v9;
      v15 = v8;
      v16 = *(a1 + 64);
      [v9 _removeSubsharesAndSendFileProviderComposition:v15 shareURL:v10 completion:v14];
    }
  }

  else if (a2)
  {
    if (a2 == 1)
    {
      v3 = *(a1 + 32);
      v4 = *(a1 + 40);
      v5 = *(a1 + 48);
      v6 = *(a1 + 56);
      v7 = *(a1 + 64);

      [v3 _updateAndSendCompositionForFileProvider:v4 share:v5 sharingURL:v6 completion:v7];
    }
  }

  else
  {
    v11 = *(a1 + 64);
    if (v11)
    {
      v12 = *(v11 + 16);

      v12();
    }
  }
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2_1311(uint64_t a1, void *a2, void *a3)
{
  v6 = a2;
  v5 = a3;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v6 && v5)
  {
    [*(a1 + 32) _sendCollaborationCompositionForFileProvider:*(a1 + 40) sharingURL:v6 share:v5 completion:*(a1 + 48)];
  }
}

- (void)_removeSubsharesAndSendFileProviderComposition:(id)a3 shareURL:(id)a4 completion:(id)a5
{
  v47 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v34 = a5;
  v10 = [v8 collaborationShareOptions];
  v11 = [v10 optionsGroups];
  v35 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:v11];

  v12 = [v10 optionsGroups];
  v33 = [(CKChatController *)self _sharingAccessTypeFromOptionsGroups:v12];

  v13 = [(CKCoreChatController *)self conversation];
  v14 = [v13 recipientPhoneNumbers];
  v15 = v14;
  if (v14)
  {
    v16 = v14;
  }

  else
  {
    v16 = [MEMORY[0x1E695DEC8] array];
  }

  v17 = v16;

  v18 = [(CKCoreChatController *)self conversation];
  v19 = [v18 recipientEmailAddresses];
  v20 = v19;
  if (v19)
  {
    v21 = v19;
  }

  else
  {
    v21 = [MEMORY[0x1E695DEC8] array];
  }

  v22 = v21;

  v23 = [v10 optionsGroups];
  v24 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:v23];

  if (IMOSLoggingEnabled())
  {
    v25 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v32 = v9;
      if (v24)
      {
        v26 = @"YES";
      }

      else
      {
        v26 = @"NO";
      }

      v27 = [v17 componentsJoinedByString:{@", "}];
      v28 = [v22 componentsJoinedByString:{@", "}];
      *buf = 134218754;
      v40 = v35;
      v41 = 2112;
      v42 = v26;
      v43 = 2112;
      v44 = v27;
      v45 = 2112;
      v46 = v28;
      _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "_removeSubsharesAndSendFileProviderComposition permissionType:%ld, allowOthersToInvite=%@, new phone numbers: %@, new email addresses: %@", buf, 0x2Au);

      v9 = v32;
    }
  }

  v29 = MEMORY[0x1E6994FC0];
  v36[0] = MEMORY[0x1E69E9820];
  v36[1] = 3221225472;
  v36[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke;
  v36[3] = &unk_1E72EDDB0;
  v36[4] = self;
  v37 = v8;
  v38 = v34;
  v30 = v34;
  v31 = v8;
  [v29 shareFolderRemovingSubshares:v9 emailAddresses:v22 phoneNumbers:v17 accessType:v33 permissionType:v35 allowOthersToInvite:v24 completionHandler:v36];
}

void __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (v9)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_cold_1();
    }

    v11 = *(a1 + 32);
    v12 = *(a1 + 40);
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_1312;
    v18[3] = &unk_1E72EDBD0;
    v13 = &v19;
    v19 = *(a1 + 48);
    [v11 presentCollaborationFailureAlertForComposition:v12 sharingURL:v7 error:v9 completion:v18];
  }

  else
  {
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_3;
    v14[3] = &unk_1E72EDD88;
    v13 = &v17;
    v17 = *(a1 + 48);
    v15 = v7;
    v16 = v8;
    dispatch_async(MEMORY[0x1E69E96A0], v14);
  }
}

void __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_1312(uint64_t a1)
{
  if (*(a1 + 32))
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_2;
    block[3] = &unk_1E72EBDB8;
    v2 = *(a1 + 32);
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }
}

- (id)updateDataSourceForPluginPayload:(id)a3 forGUID:(id)a4 withCollaborationMetadata:(id)a5 shareURL:(id)a6
{
  v31 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a5;
  v12 = a6;
  if (!v9 || (v13 = [v10 length], !v11) || !v13)
  {
    v14 = IMLogHandleForCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v25 = 138412802;
      v26 = v9;
      v27 = 2112;
      v28 = v10;
      v29 = 2112;
      v30 = v11;
      _os_log_error_impl(&dword_19020E000, v14, OS_LOG_TYPE_ERROR, "Not updating data source. pluginPayload: %@ messageGUID: %@ collaborationMetadata: %@", &v25, 0x20u);
    }
  }

  v15 = MEMORY[0x1E696ECD8];
  v16 = [v9 data];
  v17 = [v15 linkWithDataRepresentationWithoutSubstitutingAttachments:v16];

  v18 = [v17 metadata];
  [v18 setOriginalURL:v12];
  [v18 setCollaborationMetadata:v11];
  [v17 setMetadata:v18];
  v19 = [v17 dataRepresentationWithOutOfLineAttachments:0];
  [v9 setData:v19];

  v20 = [MEMORY[0x1E69A5AD0] sharedInstance];
  v21 = [v20 dataSourceForPluginPayload:v9];

  v22 = [MEMORY[0x1E69A5AD0] sharedInstance];
  v23 = [v9 messageGUID];
  [v22 insertDataSource:v21 forGUID:v23];

  return v9;
}

- (void)_sendCollaborationCompositionForCloudKit:(id)a3 sharingURL:(id)a4 share:(id)a5 completion:(id)a6
{
  v44 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v39 = a5;
  v12 = a6;
  if (v11)
  {
    v13 = [v10 shelfPluginPayload];
    v14 = [v13 url];
    v15 = [v14 ckURLByPercentEncodingFragment];
    [v13 setUrl:v15];

    v16 = [MEMORY[0x1E696AEC0] stringGUID];
    [v13 setMessageGUID:v16];

    v17 = [v11 absoluteString];
    if ([v17 length])
    {
      v18 = objc_alloc(MEMORY[0x1E696AAB0]);
      v19 = [v11 absoluteString];
      v20 = [v18 initWithString:v19];
      [v13 setText:v20];
    }

    else
    {
      [v13 setText:0];
    }

    [v13 setPluginBundleID:*MEMORY[0x1E69A6A18]];
    v22 = [v13 messageGUID];
    v23 = [v13 collaborationMetadata];
    v24 = [(CKChatController *)self updateDataSourceForPluginPayload:v13 forGUID:v22 withCollaborationMetadata:v23 shareURL:v11];

    if ([MEMORY[0x1E69A5AC8] isPayloadServiceManatee:v24])
    {
      v25 = [(CKChatController *)self shareMetadataWithDugongTokensForCKShare:v39 shareURL:v11];
      v26 = [v24 datasource];
      v27 = [v26 richLinkMetadata];

      v28 = [v27 specialization];
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      if (isKindOfClass)
      {
        v30 = [v27 specialization];
        v31 = [v30 specialization];

        if (objc_opt_respondsToSelector())
        {
          [v31 setEncodedTokens:v25];
        }
      }
    }

    v32 = [CKComposition alloc];
    v33 = [v10 text];
    v34 = [v10 subject];
    v35 = [(CKComposition *)v32 initWithText:v33 subject:v34 shelfPluginPayload:v24];

    if (IMOSLoggingEnabled())
    {
      v36 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = [v13 url];
        *buf = 138412290;
        v43 = v37;
        _os_log_impl(&dword_19020E000, v36, OS_LOG_TYPE_INFO, "Sending the final composition for CloudKit sharingURL: %@", buf, 0xCu);
      }
    }

    [(CKCoreChatController *)self setShareWasCreated:1];
    v38 = [v13 collaborationMetadata];
    [v38 checkSendReadiness];

    [(IMTimingCollection *)self->_timingCollectionSendGelato stopTimingForKey:@"sendGelato"];
    [(IMTimingCollection *)self->_timingCollectionSendGelato totalTimeForKey:@"sendGelato"];
    [(CKChatController *)self sendAnalyticsForElapsedSendTimeForType:2 sharingURL:v11 timeInterval:?];
    if ([MEMORY[0x1E696AF00] isMainThread])
    {
      [(CKChatController *)self sendCollaborationCompositionAndSetSendingState:v35];
    }

    else
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __89__CKChatController__sendCollaborationCompositionForCloudKit_sharingURL_share_completion___block_invoke;
      block[3] = &unk_1E72EB8D0;
      block[4] = self;
      v41 = v35;
      dispatch_sync(MEMORY[0x1E69E96A0], block);
    }

    if (v12)
    {
      v12[2](v12, 1);
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v21 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Received nil share URL from CloudSharing.", buf, 2u);
    }
  }
}

- (void)_sendCompositionForNewCloudKitShare:(id)a3 completion:(id)a4
{
  v37 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v27 = a4;
  v7 = [v6 shelfPluginPayload];
  v24 = [v7 url];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v32 = v24;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Sending collaboration composition for New CloudKit share. URL = %@", buf, 0xCu);
    }
  }

  v9 = [(CKCoreChatController *)self conversation];
  v26 = [v9 recipientPhoneNumbers];

  v10 = [(CKCoreChatController *)self conversation];
  v25 = [v10 recipientEmailAddresses];

  v11 = [v7 containerSetupInfo];
  v12 = [v7 cloudKitShare];
  v13 = [v6 collaborationShareOptions];
  v14 = [v13 optionsGroups];
  v15 = [(CKChatController *)self _sharingAccessTypeFromOptionsGroups:v14];

  v16 = [v13 optionsGroups];
  v17 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:v16];

  v18 = [v13 optionsGroups];
  v19 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:v18];

  if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = @"NO";
      *buf = 134218498;
      v32 = v15;
      if (v19)
      {
        v21 = @"YES";
      }

      v33 = 2048;
      v34 = v17;
      v35 = 2112;
      v36 = v21;
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Invoking the share creation with options: accessType: %ld permissionType:%ld, allowOthersToInvite=%@", buf, 0x20u);
    }
  }

  v22 = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke;
    v28[3] = &unk_1E72EDDB0;
    v28[4] = self;
    v29 = v6;
    v30 = v27;
    LOBYTE(v23) = v19;
    [(objc_class *)v22 completeShare:v12 containerSetupInfo:v11 emailAddresses:v25 phoneNumbers:v26 accessType:v15 permissionType:v17 allowOthersToInvite:v23 completionHandler:v28];
  }
}

void __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v29 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v9)
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 138412546;
        v26 = v9;
        v27 = 2112;
        v28 = v7;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Error while creating the share URL for CloudKit: %@. Sharing URL: %@", buf, 0x16u);
      }
    }

    v11 = *(a1 + 32);
    v12 = *(a1 + 40);
    v22[0] = MEMORY[0x1E69E9820];
    v22[1] = 3221225472;
    v22[2] = __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_1321;
    v22[3] = &unk_1E72EDA90;
    v13 = *(a1 + 48);
    v14 = *(a1 + 32);
    v15 = *(a1 + 40);
    v24 = v13;
    v22[4] = v14;
    v23 = v15;
    [v11 presentCollaborationFailureAlertForComposition:v12 sharingURL:v7 error:v9 completion:v22];
  }

  else
  {
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_2;
    v17[3] = &unk_1E72EDAE0;
    v16 = *(a1 + 40);
    v17[4] = *(a1 + 32);
    v18 = v16;
    v19 = v7;
    v20 = v8;
    v21 = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], v17);
  }
}

uint64_t __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_1321(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    return [*(a1 + 32) _sendCompositionForNewCloudKitShare:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_2(uint64_t a1)
{
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "CloudSharing API returned without error. Calling send composition.", v4, 2u);
    }
  }

  return [*(a1 + 32) _sendCollaborationCompositionForCloudKit:*(a1 + 40) sharingURL:*(a1 + 48) share:*(a1 + 56) completion:*(a1 + 64)];
}

- (void)_updateAndSendCompositionForExistingCloudKitShare:(id)a3 share:(id)a4 attempt:(unint64_t)a5 completion:(id)a6
{
  v45 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v12 = a6;
  if (v11)
  {
    if (v10)
    {
      v13 = [(CKCoreChatController *)self conversation];
      v14 = [v13 recipientPhoneNumbers];

      v15 = [(CKCoreChatController *)self conversation];
      v16 = [v15 recipientEmailAddresses];

      v17 = [v10 shelfPluginPayload];
      v31 = [v17 containerSetupInfo];

      v18 = [v10 collaborationShareOptions];
      v19 = [v18 optionsGroups];
      v30 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:v19];

      v20 = [v18 optionsGroups];
      v29 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:v20];

      if (IMOSLoggingEnabled())
      {
        v21 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v28 = v16;
          if (v29)
          {
            v22 = @"YES";
          }

          else
          {
            v22 = @"NO";
          }

          v23 = [v14 componentsJoinedByString:@", "];
          v24 = [v28 componentsJoinedByString:{@", "}];
          *buf = 134218754;
          v38 = v30;
          v39 = 2112;
          v40 = v22;
          v41 = 2112;
          v42 = v23;
          v43 = 2112;
          v44 = v24;
          _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Updating the share with options: permissionType:%ld, allowOthersToInvite=%@, new phone numbers: %@, new email addresses: %@", buf, 0x2Au);

          v16 = v28;
        }
      }

      v25 = [(CKChatController *)self CKCloudSharingClass];
      if ([v11 publicPermission] == 1)
      {
        if (objc_opt_respondsToSelector())
        {
          v33[0] = MEMORY[0x1E69E9820];
          v33[1] = 3221225472;
          v33[2] = __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke;
          v33[3] = &unk_1E72EDDD8;
          v33[4] = self;
          v36 = a5;
          v34 = v10;
          v35 = v12;
          [(objc_class *)v25 addParticipantsToShare:v11 containerSetupInfo:v31 emailAddresses:v16 phoneNumbers:v14 permissionType:v30 allowOthersToInvite:v29 completionHandler:v33];
        }
      }

      else
      {
        if (IMOSLoggingEnabled())
        {
          v26 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Not calling addParticipants because it's a public share.", buf, 2u);
          }
        }

        v27 = [v11 URL];
        [(CKChatController *)self _sendCollaborationCompositionForCloudKit:v10 sharingURL:v27 share:v11 completion:v12];
      }
    }

    else
    {
      v14 = IMLogHandleForCategory();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _updateAndSendCompositionForExistingCloudKitShare:a2 share:? attempt:? completion:?];
      }
    }
  }

  else
  {
    v14 = IMLogHandleForCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      [CKChatController _updateAndSendCompositionForExistingCloudKitShare:a2 share:? attempt:? completion:?];
    }
  }
}

void __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v9)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_1();
    }

    v11 = [v9 updatedServerChangedShare];
    v12 = [MEMORY[0x1E69A53F0] sharedInstanceForBagType:1];
    v13 = [v12 objectForKey:@"sharedwithyou-max-retry-attempts" ofClass:objc_opt_class()];
    v14 = v13;
    v15 = &unk_1F04E78C0;
    if (v13)
    {
      v15 = v13;
    }

    v16 = v15;

    v17 = *(a1 + 56);
    v18 = [v16 intValue];

    if (v17 > v18 || v11 == 0)
    {
      v20 = *(a1 + 32);
      v21 = *(a1 + 40);
      v33[0] = MEMORY[0x1E69E9820];
      v33[1] = 3221225472;
      v33[2] = __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_1329;
      v33[3] = &unk_1E72EDC98;
      v22 = *(a1 + 48);
      v23 = *(a1 + 32);
      v24 = *(a1 + 40);
      v37 = v22;
      v33[4] = v23;
      v34 = v24;
      v35 = v11;
      v36 = v8;
      [v20 presentCollaborationFailureAlertForComposition:v21 sharingURL:v7 error:v9 completion:v33];
    }

    else
    {
      v26 = IMLogHandleForCategory();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_2();
      }

      [*(a1 + 32) _updateAndSendCompositionForExistingCloudKitShare:*(a1 + 40) share:v11 attempt:*(a1 + 56) + 1 completion:*(a1 + 48)];
    }
  }

  else
  {
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_2;
    v28[3] = &unk_1E72EDAE0;
    v25 = *(a1 + 40);
    v28[4] = *(a1 + 32);
    v29 = v25;
    v30 = v7;
    v31 = v8;
    v32 = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], v28);
  }
}

uint64_t __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_1329(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    v2 = *(a1 + 48);
    if (!v2)
    {
      v2 = *(a1 + 56);
    }

    return [*(a1 + 32) _updateAndSendCompositionForExistingCloudKitShare:*(a1 + 40) share:v2 completion:*(a1 + 64)];
  }

  else
  {
    result = *(a1 + 64);
    if (result)
    {
      return (*(result + 16))(result, 0);
    }
  }

  return result;
}

- (void)sendCompositionForPendingCollaboration:(id)a3 completion:(id)a4
{
  v57 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Sending collaboration composition for GroupActivity.", buf, 2u);
    }
  }

  v9 = [v6 shelfPluginPayload];
  v10 = objc_alloc(MEMORY[0x1E69D37C0]);
  v36 = [v10 initWithTargetSerialQueue:MEMORY[0x1E69E96A0] synchronous:1];
  v11 = [(CKCoreChatController *)self conversation];
  v12 = [v11 recipientStrings];

  v13 = [objc_alloc(MEMORY[0x1E695DFD8]) initWithArray:v12];
  v14 = [v9 url];
  v15 = [v9 collaborationMetadata];
  v16 = [v6 collaborationShareOptions];
  [v15 setUserSelectedShareOptions:v16];

  v17 = [v14 isFileURL];
  v18 = v17;
  *buf = 0;
  v52 = buf;
  v53 = 0x2020000000;
  if (v17)
  {
    v19 = [v14 startAccessingSecurityScopedResource];
  }

  else
  {
    v19 = 0;
  }

  v54 = v19;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke;
  aBlock[3] = &unk_1E72EDE50;
  v20 = v9;
  v44 = v20;
  v50 = buf;
  v21 = v14;
  v45 = v21;
  v46 = self;
  v22 = v6;
  v47 = v22;
  v23 = v7;
  v49 = v23;
  v24 = v13;
  v48 = v24;
  v25 = _Block_copy(aBlock);
  if (v18)
  {
    if (v52[24])
    {
      v26 = [MEMORY[0x1E69673B0] defaultManager];
      v27 = [v26 itemForURL:v21 error:0];

      if (v27)
      {
        if (IMOSLoggingEnabled())
        {
          v28 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
          {
            if (v52[24])
            {
              v29 = @"YES";
            }

            else
            {
              v29 = @"NO";
            }

            *v55 = 138412290;
            v56 = v29;
            _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Payload appears to be for a file provider. Starting handshake with a file url. did startAccessingSecurityScopedResource: %@", v55, 0xCu);
          }
        }

        [(CKChatController *)self enableSendButtonSpinner];
        v30 = [v20 collaborationMetadata];
        [v36 startCollaborationWithFileURL:v21 metadata:v30 participants:v24 timeout:v25 completion:10.0];
        goto LABEL_31;
      }

      v35 = IMLogHandleForCategory();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        [CKChatController sendCompositionForPendingCollaboration:completion:];
      }

      [(CKChatController *)self disableSendButtonSpinner];
      v33 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationErrorDomain" code:2 userInfo:0];
      v34 = v37;
      v37[0] = MEMORY[0x1E69E9820];
      v37[1] = 3221225472;
      v37[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1337;
      v37[3] = &unk_1E72EDA90;
      v39 = v23;
      v37[4] = self;
      v38 = v22;
      [(CKChatController *)self presentCollaborationFailureAlertForComposition:v38 sharingURL:0 error:v33 completion:v37];
    }

    else
    {
      v32 = IMLogHandleForCategory();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        [CKChatController sendCompositionForPendingCollaboration:completion:];
      }

      [(CKChatController *)self disableSendButtonSpinner];
      v33 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationErrorDomain" code:1 userInfo:0];
      v34 = v40;
      v40[0] = MEMORY[0x1E69E9820];
      v40[1] = 3221225472;
      v40[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1335;
      v40[3] = &unk_1E72EDA90;
      v42 = v23;
      v40[4] = self;
      v41 = v22;
      [(CKChatController *)self presentCollaborationFailureAlertForComposition:v41 sharingURL:0 error:v33 completion:v40];
    }

    v30 = v34[6];
    goto LABEL_31;
  }

  if (IMOSLoggingEnabled())
  {
    v31 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      *v55 = 0;
      _os_log_impl(&dword_19020E000, v31, OS_LOG_TYPE_INFO, "Payload appears to be for a generic 3rd party. Starting handshake with metadata.", v55, 2u);
    }
  }

  [(CKChatController *)self enableSendButtonSpinner];
  v30 = [v20 collaborationMetadata];
  [v36 startCollaborationWithMetadata:v30 participants:v24 timeout:v25 completion:10.0];
LABEL_31:

  _Block_object_dispose(buf, 8);
}

void __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v65 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v48 = a3;
  v47 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [*(a1 + 32) collaborationMetadata];
      *buf = 138412290;
      v62 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Starting collaboration for pending collaboration with metadata: %@", buf, 0xCu);
    }
  }

  if (*(*(*(a1 + 80) + 8) + 24) == 1)
  {
    [*(a1 + 40) stopAccessingSecurityScopedResource];
  }

  if (v7)
  {
    [*(a1 + 32) setUrl:v7];
    v10 = *(a1 + 32);
    v11 = [MEMORY[0x1E696AEC0] stringGUID];
    [v10 setMessageGUID:v11];

    v12 = *(a1 + 32);
    v13 = [v7 absoluteString];
    if ([v13 length])
    {
      v14 = objc_alloc(MEMORY[0x1E696AAB0]);
      v15 = [v7 absoluteString];
      v16 = [v14 initWithString:v15];
      [v12 setText:v16];
    }

    else
    {
      [v12 setText:0];
    }

    [*(a1 + 32) setPluginBundleID:*MEMORY[0x1E69A6A18]];
    [*(a1 + 32) setCollaborationMetadata:v48];
    v24 = *(a1 + 48);
    v25 = *(a1 + 32);
    v26 = [v25 messageGUID];
    v46 = [v24 updateDataSourceForPluginPayload:v25 forGUID:v26 withCollaborationMetadata:v48 shareURL:v7];

    v27 = [CKComposition alloc];
    v28 = [*(a1 + 56) text];
    v29 = [*(a1 + 56) subject];
    v30 = [(CKComposition *)v27 initWithText:v28 subject:v29 shelfPluginPayload:v46];

    [*(a1 + 48) setShareWasCreated:1];
    v31 = [*(a1 + 32) collaborationMetadata];
    [v31 checkSendReadiness];

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_2;
    aBlock[3] = &unk_1E72EDE00;
    v32 = v7;
    v33 = *(a1 + 48);
    v54 = v32;
    v55 = v33;
    v34 = v30;
    v56 = v34;
    v57 = *(a1 + 72);
    v35 = _Block_copy(aBlock);
    v36 = [*(a1 + 64) count];
    v37 = [v48 handleToIdentityMap];
    v38 = [v37 allKeys];
    v39 = [v38 count];

    v40 = v36 + 1;
    if (v39 == v36 + 1)
    {
      v35[2](v35);
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v41 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          *buf = 134218240;
          v62 = v40;
          v63 = 2048;
          v64 = v39;
          _os_log_impl(&dword_19020E000, v41, OS_LOG_TYPE_INFO, "Did not receive all participant identities from sociallayerd, alerting the user. Expected: %lu, actual: %lu", buf, 0x16u);
        }
      }

      if (v39 == 1)
      {
        v42 = 3;
      }

      else
      {
        v42 = 4;
      }

      v43 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationErrorDomain" code:v42 userInfo:0];
      v44 = *(a1 + 48);
      v45 = *(a1 + 56);
      v49[0] = MEMORY[0x1E69E9820];
      v49[1] = 3221225472;
      v49[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1333;
      v49[3] = &unk_1E72EDE28;
      v52 = v42;
      v50 = *(a1 + 72);
      v51 = v35;
      [v44 presentCollaborationFailureAlertForComposition:v45 sharingURL:v32 error:v43 completion:v49];
    }

    v23 = v46;
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v17 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v62 = v47;
        _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Received a nil shareURL when starting a pending collaboration. Error: %@", buf, 0xCu);
      }
    }

    v18 = *(a1 + 48);
    v19 = *(a1 + 56);
    v58[0] = MEMORY[0x1E69E9820];
    v58[1] = 3221225472;
    v58[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1331;
    v58[3] = &unk_1E72EDA90;
    v20 = *(a1 + 72);
    v21 = *(a1 + 48);
    v22 = *(a1 + 56);
    v60 = v20;
    v58[4] = v21;
    v59 = v22;
    [v18 presentCollaborationFailureAlertForComposition:v19 sharingURL:0 error:v47 completion:v58];

    v23 = v60;
  }

  [*(a1 + 48) disableSendButtonSpinner];
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1331(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForPendingCollaboration:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      *buf = 138412290;
      v9 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Sending the final composition for pending conversation for share URL: %@", buf, 0xCu);
    }
  }

  [*(*(a1 + 40) + 1512) stopTimingForKey:@"sendGelato"];
  [*(*(a1 + 40) + 1512) totalTimeForKey:@"sendGelato"];
  [*(a1 + 40) sendAnalyticsForElapsedSendTimeForType:3 sharingURL:*(a1 + 32) timeInterval:?];
  if ([MEMORY[0x1E696AF00] isMainThread])
  {
    [*(a1 + 40) sendCollaborationCompositionAndSetSendingState:*(a1 + 48)];
  }

  else
  {
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1332;
    v6[3] = &unk_1E72EB8D0;
    v4 = *(a1 + 48);
    v6[4] = *(a1 + 40);
    v7 = v4;
    dispatch_sync(MEMORY[0x1E69E96A0], v6);
  }

  result = *(a1 + 56);
  if (result)
  {
    return (*(result + 16))(result, 1);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1333(void *a1)
{
  if (a1[6] != 3)
  {
    return (*(a1[5] + 16))();
  }

  result = a1[4];
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1335(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForPendingCollaboration:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1337(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForPendingCollaboration:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)sendCompositionForCloudKit:(id)a3 completion:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [v6 shelfPluginPayload];
  v9 = [v8 cloudKitShare];
  if (v9)
  {
    v10 = v9;
    v11 = [v6 shelfPluginPayload];
    v12 = [v11 cloudKitShare];
    v13 = [v12 participants];
    v14 = [v13 count];

    if (v14 > 1)
    {
      if (IMOSLoggingEnabled())
      {
        v15 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          *v19 = 0;
          _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Updating collaboration composition for existing Cloud Kit Share.", v19, 2u);
        }
      }

      v16 = [v6 shelfPluginPayload];
      v17 = [v16 cloudKitShare];
      [(CKChatController *)self _updateAndSendCompositionForExistingCloudKitShare:v6 share:v17 completion:v7];

      goto LABEL_14;
    }
  }

  else
  {
  }

  if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "There is no existing share for the shareURL.", buf, 2u);
    }
  }

  [(CKChatController *)self _sendCompositionForNewCloudKitShare:v6 completion:v7];
LABEL_14:
}

- (void)sendCompositionForCollaboration:(id)a3 collaborationType:(int64_t)a4 completion:(id)a5
{
  v28 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a5;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke;
  aBlock[3] = &unk_1E72ED638;
  aBlock[4] = self;
  v10 = v9;
  v25 = v10;
  v11 = _Block_copy(aBlock);
  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      *buf = 134217984;
      v27 = a4;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Collaboration type switch: %ld", buf, 0xCu);
    }
  }

  v20[0] = MEMORY[0x1E69E9820];
  v20[1] = 3221225472;
  v20[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_1338;
  v20[3] = &unk_1E72EDE78;
  v20[4] = self;
  v21 = v8;
  v22 = v11;
  v23 = a4;
  v13 = v11;
  v14 = v8;
  v15 = _Block_copy(v20);
  v16 = [v14 shelfPluginPayload];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_3;
  v18[3] = &unk_1E72ED638;
  v18[4] = self;
  v19 = v15;
  v17 = v15;
  [(CKChatController *)self _presentCollaborationAlertsIfNecessaryForPayload:v16 collaborationType:a4 sendBlock:v17 completionHandler:v18];
}

uint64_t __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setIsSettingUpCollaboration:0];
  result = *(a1 + 40);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

void __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_1338(uint64_t a1)
{
  v2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v3 = [v2 isGelatoAsyncSendingEnabled];

  v4 = *(a1 + 56);
  if (v3)
  {
    if ((v4 - 2) < 2)
    {
LABEL_5:
      [*(a1 + 32) setShareWasCreated:1];
      [*(a1 + 32) setIsSettingUpCollaboration:0];
      if ([MEMORY[0x1E696AF00] isMainThread])
      {
        [*(a1 + 32) sendCollaborationCompositionAndSetSendingState:*(a1 + 40)];
      }

      else
      {
        v16[0] = MEMORY[0x1E69E9820];
        v16[1] = 3221225472;
        v16[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_2;
        v16[3] = &unk_1E72EB8D0;
        v8 = *(a1 + 40);
        v16[4] = *(a1 + 32);
        v17 = v8;
        dispatch_sync(MEMORY[0x1E69E96A0], v16);
      }

      v9 = *(a1 + 48);
      if (v9)
      {
        (*(v9 + 16))(v9, 1);
      }

      return;
    }

    if (v4 != 1)
    {
      if (v4)
      {
        return;
      }

      goto LABEL_5;
    }

    goto LABEL_10;
  }

  switch(v4)
  {
    case 3:
      v13 = *(a1 + 32);
      v14 = *(a1 + 40);
      v15 = *(a1 + 48);

      [v13 sendCompositionForPendingCollaboration:v14 completion:v15];
      break;
    case 2:
      v10 = *(a1 + 32);
      v11 = *(a1 + 40);
      v12 = *(a1 + 48);

      [v10 sendCompositionForCloudKit:v11 completion:v12];
      break;
    case 1:
LABEL_10:
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);

      [v5 sendCompositionForFileProvider:v6 completion:v7];
      return;
    default:
      return;
  }
}

uint64_t __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_3(uint64_t result, char a2)
{
  if ((a2 & 1) == 0)
  {
    v2 = result;
    result = [*(result + 32) isSettingUpCollaboration];
    if ((result & 1) == 0)
    {
      [*(v2 + 32) setIsSettingUpCollaboration:1];
      v3 = *(*(v2 + 40) + 16);

      return v3();
    }
  }

  return result;
}

- (void)_presentCollaborationAlertsIfNecessaryForPayload:(id)a3 collaborationType:(int64_t)a4 sendBlock:(id)a5 completionHandler:(id)a6
{
  v12 = a3;
  v10 = a5;
  v11 = a6;
  if ([(CKChatController *)self _presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:v12 collaborationType:a4])
  {
    v11[2](v11, 1);
  }

  else
  {
    [(CKChatController *)self _presentCollabAddToMessagesGroupAlertIfNecessary:v12 collaborationType:a4 sendBlock:v10 completionHandler:v11];
  }
}

- (BOOL)_presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:(id)a3 collaborationType:(int64_t)a4
{
  if (a4 != 1)
  {
    return 0;
  }

  v5 = MEMORY[0x1E69673B0];
  v6 = a3;
  v7 = [v5 defaultManager];
  v8 = [v6 url];

  v22 = 0;
  v9 = [v7 itemForURL:v8 error:&v22];
  v10 = v22;

  v11 = v9 == 0;
  if (!v9)
  {
    if (v10)
    {
      v12 = IMLogHandleForCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:collaborationType:];
      }
    }

    v13 = CKFrameworkBundle();
    v14 = [v13 localizedStringForKey:@"ALERT_TITLE_COLLAB_INVALID_FILE_PROVIDER_LOCATION" value:&stru_1F04268F8 table:@"ChatKit"];

    v15 = CKFrameworkBundle();
    v16 = [v15 localizedStringForKey:@"ALERT_MESSAGE_COLLAB_INVALID_FILE_PROVIDER_LOCATION" value:&stru_1F04268F8 table:@"ChatKit"];

    v17 = CKFrameworkBundle();
    v18 = [v17 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];

    v19 = [CKAlertController alertControllerWithTitle:v14 message:v16 preferredStyle:CKIsRunningInMacCatalyst() != 0];
    v20 = [CKAlertAction actionWithTitle:v18 style:0 handler:&__block_literal_global_1346];
    [v19 addAction:v20];

    [v19 presentFromViewController:self animated:1 completion:0];
  }

  return v11;
}

- (void)_presentCollabAddToMessagesGroupAlertIfNecessary:(id)a3 collaborationType:(int64_t)a4 sendBlock:(id)a5 completionHandler:(id)a6
{
  v10 = a3;
  v11 = a5;
  v12 = a6;
  v13 = [(CKCoreChatController *)self conversation];
  v14 = [v13 recipientCount];

  if (v14 < 2)
  {
    if (a4 == 1)
    {
      v15 = objc_alloc(MEMORY[0x1E6994900]);
      v16 = [v10 url];
      v17 = [v15 initWithFileURL:v16 documentType:*MEMORY[0x1E69638B8]];

      v19[0] = MEMORY[0x1E69E9820];
      v19[1] = 3221225472;
      v19[2] = __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke;
      v19[3] = &unk_1E72EDEC8;
      v19[4] = self;
      v20 = v12;
      v21 = v11;
      [v17 setCopyShareURLCompletionBlock:v19];
      v18 = objc_alloc_init(MEMORY[0x1E696ADC8]);
      [v18 setMaxConcurrentOperationCount:1];
      [v18 addOperation:v17];
    }

    else
    {
      v17 = [v10 url];
      [(CKChatController *)self _presentCollabAddToMessagesGroupAlert:v17 sendBlock:v11 completionHandler:v12];
    }
  }

  else
  {
    (*(v12 + 2))(v12, 0);
  }
}

void __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke_cold_1();
    }

    (*(*(a1 + 40) + 16))();
  }

  else
  {
    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke_1348;
    v9[3] = &unk_1E72EDEA0;
    v9[4] = *(a1 + 32);
    v10 = v5;
    v11 = *(a1 + 48);
    v12 = *(a1 + 40);
    dispatch_async(MEMORY[0x1E69E96A0], v9);
  }
}

- (void)_presentCollabAddToMessagesGroupAlert:(id)a3 sendBlock:(id)a4 completionHandler:(id)a5
{
  v68 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v50 = a4;
  v52 = a5;
  v49 = v8;
  if (v8)
  {
    v55 = self;
    v51 = [(CKChatController *)self _groupConversationContainingSharedURL:v8];
    if (v51)
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          v10 = [v51 chat];
          v11 = [v10 chatIdentifier];
          *buf = 138412290;
          v67 = v11;
          _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Presenting Group Collaboration alert for chat identifier: %@", buf, 0xCu);
        }
      }

      v63 = 0u;
      v64 = 0u;
      v61 = 0u;
      v62 = 0u;
      obj = [v51 recipients];
      v12 = [obj countByEnumeratingWithState:&v61 objects:v65 count:16];
      if (v12)
      {
        v13 = *v62;
        while (2)
        {
          for (i = 0; i != v12; ++i)
          {
            if (*v62 != v13)
            {
              objc_enumerationMutation(obj);
            }

            v15 = [*(*(&v61 + 1) + 8 * i) defaultIMHandle];
            v16 = [v15 ID];
            v17 = [(CKCoreChatController *)v55 conversation];
            v18 = [v17 recipient];
            v19 = [v18 defaultIMHandle];
            v20 = [v19 ID];
            v21 = [v16 isEqualToString:v20];

            if (v21)
            {
              if (IMOSLoggingEnabled())
              {
                v48 = OSLogHandleForIMFoundationCategory();
                if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
                {
                  *buf = 0;
                  _os_log_impl(&dword_19020E000, v48, OS_LOG_TYPE_INFO, "Recipient is already part of group conversation, sending separately", buf, 2u);
                }
              }

              goto LABEL_34;
            }
          }

          v12 = [obj countByEnumeratingWithState:&v61 objects:v65 count:16];
          if (v12)
          {
            continue;
          }

          break;
        }
      }

      v22 = [(CKCoreChatController *)v55 conversation];
      v23 = [v22 recipient];
      v24 = [v23 name];

      v25 = [v51 displayName];
      if (!v25)
      {
        v25 = [v51 name];
      }

      v26 = CKIsRunningInMacCatalyst() == 0;
      v27 = MEMORY[0x1E696AEC0];
      v28 = CKFrameworkBundle();
      v29 = v28;
      if (v26)
      {
        v30 = @"ALERT_TITLE_ADD_TO_EXISTING_GROUP_CONVERSATION_IOS";
      }

      else
      {
        v30 = @"ALERT_TITLE_ADD_TO_EXISTING_GROUP_CONVERSATION_MAC";
      }

      v31 = [v28 localizedStringForKey:v30 value:&stru_1F04268F8 table:@"ChatKit"];
      v32 = [v27 stringWithFormat:v31, v24, v25, v49];

      v33 = [MEMORY[0x1E69DC668] sharedApplication];
      v34 = [v33 userInterfaceLayoutDirection] == 1;

      if (v34)
      {
        v35 = @"\u200F";
      }

      else
      {
        v35 = @"\u200E";
      }

      obja = [(__CFString *)v35 stringByAppendingString:v32];

      v36 = CKFrameworkBundle();
      v37 = [v36 localizedStringForKey:@"ALERT_ACTION_ADD_TO_GROUP" value:&stru_1F04268F8 table:@"ChatKit"];

      v38 = CKFrameworkBundle();
      v39 = [v38 localizedStringForKey:@"ALERT_ACTION_SHARE_WITH_PARTICIPANT_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];

      v40 = [CKAlertController alertControllerWithTitle:obja message:0 preferredStyle:CKIsRunningInMacCatalyst() != 0];
      v58[0] = MEMORY[0x1E69E9820];
      v58[1] = 3221225472;
      v58[2] = __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke;
      v58[3] = &unk_1E72EDEF0;
      v58[4] = v55;
      v59 = v51;
      v41 = v50;
      v60 = v41;
      v42 = [CKAlertAction actionWithTitle:v37 style:0 handler:v58];
      [v40 addAction:v42];

      v56[0] = MEMORY[0x1E69E9820];
      v56[1] = 3221225472;
      v56[2] = __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke_1363;
      v56[3] = &unk_1E72EC218;
      v57 = v41;
      v43 = [CKAlertAction actionWithTitle:v39 style:0 handler:v56];
      [v40 addAction:v43];

      v44 = CKFrameworkBundle();
      v45 = [v44 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
      v46 = [CKAlertAction actionWithTitle:v45 style:1 handler:&__block_literal_global_1366];
      [v40 addAction:v46];

      [v40 presentFromViewController:v55 animated:1 completion:0];
      v52[2](v52, 1);
    }

    else
    {
LABEL_34:
      v52[2](v52, 0);
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v47 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v47, OS_LOG_TYPE_INFO, "Can't find a group conversation, URL is nil", buf, 2u);
      }
    }

    v52[2](v52, 0);
  }
}

void __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v17[1] = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      LOWORD(v15) = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Add to group and share with recipient", &v15, 2u);
    }
  }

  v5 = [*(a1 + 32) conversation];
  v6 = [v5 recipient];

  v7 = [v6 rawAddress];
  v8 = [*(a1 + 32) conversation];
  v9 = [v8 chat];
  v10 = [v9 account];
  v11 = [v10 imHandleWithID:v7 alreadyCanonical:0];

  if (v11)
  {
    [*(a1 + 32) setConversation:*(a1 + 40)];
    v12 = [*(a1 + 32) conversation];
    v17[0] = v11;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:1];
    [v12 addRecipientHandles:v13];

    (*(*(a1 + 48) + 16))();
  }

  else if (IMOSLoggingEnabled())
  {
    v14 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = 138412290;
      v16 = v6;
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "CKChatController_Collaboration: Couldn't get handle from recipient: %@", &v15, 0xCu);
    }
  }
}

void __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke_1363(uint64_t a1, void *a2)
{
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Share with recipient only", v5, 2u);
    }
  }

  (*(*(a1 + 32) + 16))();
}

void __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke_1364(uint64_t a1, void *a2)
{
  v2 = a2;
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Cancel", v4, 2u);
    }
  }
}

- (id)_groupConversationContainingSharedURL:(id)a3
{
  v32 = *MEMORY[0x1E69E9840];
  v3 = a3;
  if (v3)
  {
    v4 = [MEMORY[0x1E69A5C78] sharedController];
    v26 = 0;
    v5 = [v4 collaborationHighlightForURL:v3 error:&v26];
    v6 = v26;

    if (v6 || !v5)
    {
      if (IMOSLoggingEnabled())
      {
        v17 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          v18 = [v6 localizedDescription];
          *buf = 138412546;
          v29 = v5;
          v30 = 2112;
          v31 = v18;
          _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Could not get collaboration highlight: %@ with error: %@", buf, 0x16u);
        }
      }

      v9 = 0;
      v10 = 0;
    }

    else
    {
      v7 = [MEMORY[0x1E69A5C78] sharedController];
      v21 = [v7 fetchAttributionsForHighlight:v5];

      v24 = 0u;
      v25 = 0u;
      v22 = 0u;
      v23 = 0u;
      v8 = [v21 attributions];
      v9 = 0;
      v10 = [v8 countByEnumeratingWithState:&v22 objects:v27 count:16];
      if (v10)
      {
        v11 = 0;
        v12 = *v23;
        while (2)
        {
          for (i = 0; i != v10; i = i + 1)
          {
            if (*v23 != v12)
            {
              objc_enumerationMutation(v8);
            }

            v14 = *(*(&v22 + 1) + 8 * i);
            if ([v14 isGroupConversation])
            {
              v15 = [v14 conversationIdentifier];

              if (v11 >= 1)
              {
                if (IMOSLoggingEnabled())
                {
                  v19 = OSLogHandleForIMFoundationCategory();
                  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
                  {
                    *buf = 0;
                    _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Found more than 1 group where the url is shared, not returning a conversation", buf, 2u);
                  }
                }

                v9 = 0;
                v10 = 0;
                goto LABEL_31;
              }

              ++v11;
              v9 = v15;
            }
          }

          v10 = [v8 countByEnumeratingWithState:&v22 objects:v27 count:16];
          if (v10)
          {
            continue;
          }

          break;
        }

        if (v9)
        {
          v8 = +[CKConversationList sharedConversationList];
          v10 = [v8 conversationForExistingChatWithGUID:v9];
          goto LABEL_31;
        }

        v10 = 0;
      }

      else
      {
LABEL_31:
      }
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "No URL provided", buf, 2u);
      }
    }

    v10 = 0;
  }

  return v10;
}

- (void)_validateAndSendComposition:(id)a3 completion:(id)a4
{
  v70 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [MEMORY[0x1E696AD88] defaultCenter];
  [v8 addObserver:self selector:sel__passKitUIDismissed_ name:@"CKPluginExtensionStateObserverPassKitUIDismissed" object:0];

  v9 = [v6 shelfPluginPayload];
  v10 = [(CKChatController *)self _shouldValidatePayloadBeforeSendingPayload:v9];
  v11 = [v9 sendAsCopy];
  if ([v9 supportsCollaboration] && (v11 & 1) == 0)
  {
    [(CKChatController *)self enableSendButtonSpinner];
    if (IMOSLoggingEnabled())
    {
      v12 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        *buf = 134217984;
        v69 = [v9 payloadCollaborationType];
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Sending collaboration item for type %ld", buf, 0xCu);
      }
    }

    -[CKChatController sendCompositionForCollaboration:collaborationType:completion:](self, "sendCompositionForCollaboration:collaborationType:completion:", v6, [v9 payloadCollaborationType], v7);
    goto LABEL_40;
  }

  if (v10)
  {
    if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Validating shelf plugin payload", buf, 2u);
      }
    }

    v14 = v9;
    v15 = +[CKBalloonPluginManager sharedInstance];
    v16 = [v14 pluginBundleID];
    v17 = [v14 datasource];
    v57 = [v15 newViewControllerForPluginIdentifier:v16 dataSource:v17];

    v18 = [v6 text];
    v55 = [v18 string];

    v19 = [v55 stringByReplacingOccurrencesOfString:*MEMORY[0x1E69A5F00] withString:&stru_1F04268F8];
    v53 = [v19 stringByReplacingOccurrencesOfString:*MEMORY[0x1E69A5F20] withString:&stru_1F04268F8];

    if (objc_opt_respondsToSelector())
    {
      v20 = [(CKCoreChatController *)self conversation];
      v21 = [v20 senderIdentifier];
      [v57 setSender:v21];
    }

    if (objc_opt_respondsToSelector())
    {
      v22 = [(CKCoreChatController *)self conversation];
      v23 = [v22 recipientStrings];

      [v57 setRecipients:v23];
    }

    [(CKChatController *)self enableSendButtonSpinner];
    v24 = [(CKChatController *)self entryView];
    v25 = [v24 contentView];
    [v25 setClearPluginButtonEnabled:0];

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke;
    aBlock[3] = &unk_1E72EDF68;
    aBlock[4] = self;
    v65 = v6;
    v67 = v7;
    v26 = v14;
    v66 = v26;
    v27 = _Block_copy(aBlock);
    v28 = [(CKChatController *)self entryView];
    v29 = [v28 contentView];
    v30 = [v29 pluginEntryViewController];
    if (v30)
    {
      v31 = [v26 liveEditableInEntryView];

      if (v31)
      {
        if ([(CKScrollViewController *)self isKeyboardVisible])
        {
          [(CKChatController *)self setTargetFirstResponder:1];
          [(CKChatController *)self becomeFirstResponder];
        }

        v32 = [(CKChatController *)self entryView];
        v33 = [v32 contentView];
        v34 = [v33 pluginEntryViewController];
        v61[0] = MEMORY[0x1E69E9820];
        v61[1] = 3221225472;
        v61[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1375;
        v61[3] = &unk_1E72EDF90;
        v62 = v57;
        v63 = v27;
        v35 = v27;
        [v34 fetchInternalMessageStateForDraft:0 completion:v61];

        v36 = &v62;
        goto LABEL_39;
      }
    }

    else
    {
    }

    v59[0] = MEMORY[0x1E69E9820];
    v59[1] = 3221225472;
    v59[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_3;
    v59[3] = &unk_1E72EDFB8;
    v60 = v27;
    v52 = v27;
    [v57 validatePayloadForSending:v26 associatedText:v53 completionHandler:v59];
    v36 = &v60;
LABEL_39:

    goto LABEL_40;
  }

  if (v11 && [v9 payloadCollaborationType] == 2)
  {
    [v6 cleanupCKShareFromComposition];
  }

  v37 = v6;
  v38 = [v9 sendAsCopyURL];
  if (v38)
  {
    v39 = [v9 sendAsCopy];

    if (v39)
    {
      v40 = [v9 sendAsCopyURL];
      [v9 setUrl:v40];

      v41 = [CKComposition alloc];
      v42 = [v37 text];
      v43 = [v37 subject];
      v58 = [v37 translation];
      v56 = [v37 bizIntent];
      v44 = [v37 shelfMediaObject];
      v45 = [v37 proofreadingInfo];
      v54 = v7;
      v46 = [(CKComposition *)v41 initWithText:v42 subject:v43 translation:v58 shelfPluginPayload:v9 bizIntent:v56 shelfMediaObject:v44 proofreadingInfo:v45];

      v37 = v46;
      v7 = v54;
    }
  }

  v47 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v48 = [v47 isExpressiveTextEnabled];

  if (v48)
  {
    v49 = [(CKChatController *)self entryView];
    v50 = [v49 contentView];
    [v50 prepareTextEffectsForImmediateMessageSend];
  }

  if (IMOSLoggingEnabled())
  {
    v51 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "Sending composition if allowed", buf, 2u);
    }
  }

  [(CKChatController *)self sendCompositionIfAllowed:v37];
  if (v7)
  {
    (*(v7 + 2))(v7, 1);
  }

LABEL_40:
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke(uint64_t a1, char a2, void *a3, void *a4)
{
  v7 = a3;
  v8 = a4;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_2;
  block[3] = &unk_1E72EDF40;
  v20 = a2;
  v16 = v7;
  v17 = v8;
  v14 = *(a1 + 32);
  v9 = *(&v14 + 1);
  v10 = *(a1 + 56);
  *&v11 = *(a1 + 48);
  *(&v11 + 1) = v10;
  v18 = v14;
  v19 = v11;
  v12 = v8;
  v13 = v7;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_2(uint64_t a1)
{
  v45 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v4 = [MEMORY[0x1E696AD98] numberWithBool:*(a1 + 80)];
      v5 = *(a1 + 40);
      *buf = 138412802;
      v38 = v3;
      v39 = 2112;
      v40 = v4;
      v41 = 2112;
      v42 = v5;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Received payload validation for payload %@. shouldSend %@. localizedInvalidationDescription %@", buf, 0x20u);
    }
  }

  [*(a1 + 48) disableSendButtonSpinner];
  v6 = [*(a1 + 48) entryView];
  v7 = [v6 contentView];
  [v7 setClearPluginButtonEnabled:1];

  if (*(a1 + 80) == 1)
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_1370;
    aBlock[3] = &unk_1E72EDE00;
    v33 = *(a1 + 32);
    v8 = *(a1 + 56);
    v9 = *(a1 + 48);
    v34 = v8;
    v35 = v9;
    v36 = *(a1 + 72);
    v10 = _Block_copy(aBlock);
    v11 = [*(a1 + 32) pluginBundleID];
    v12 = IMBalloonExtensionIDWithSuffix();
    v13 = [v11 isEqualToString:v12];

    if (IMOSLoggingEnabled())
    {
      v14 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = *(a1 + 32);
        v16 = _Block_copy(v10);
        v17 = MEMORY[0x1E696AD98];
        v18 = +[CKPluginExtensionStateObserver sharedInstance];
        v19 = [v17 numberWithBool:{objc_msgSend(v18, "passKitUIPresented")}];
        v20 = [MEMORY[0x1E696AD98] numberWithBool:v13];
        *buf = 138413058;
        v38 = v15;
        v39 = 2112;
        v40 = v16;
        v41 = 2112;
        v42 = v19;
        v43 = 2112;
        v44 = v20;
        _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Preparing for send after payload validation. payload %@. sendBlock %@. passKitUIPresented %@. isSurf:%@", buf, 0x2Au);
      }
    }

    v21 = +[CKPluginExtensionStateObserver sharedInstance];
    v22 = [v21 passKitUIPresented];

    if (v22 & v13)
    {
      if (IMOSLoggingEnabled())
      {
        v23 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "setting deferred send animation block", buf, 2u);
        }
      }

      [*(a1 + 48) setDeferredSendAnimationBlock:v10];
    }

    else
    {
      v10[2](v10);
    }
  }

  else
  {
    v24 = *(a1 + 40) == 0;
    v25 = IMOSLoggingEnabled();
    if (v24)
    {
      if (v25)
      {
        v30 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v30, OS_LOG_TYPE_INFO, "We should not send this message, restoring the entry view.", buf, 2u);
        }
      }

      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_1373;
      block[3] = &unk_1E72EBA18;
      block[4] = *(a1 + 48);
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }

    else
    {
      if (v25)
      {
        v26 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v27 = [*(a1 + 64) pluginBundleID];
          v28 = *(a1 + 64);
          v29 = *(a1 + 40);
          *buf = 138412802;
          v38 = v27;
          v39 = 2112;
          v40 = v28;
          v41 = 2112;
          v42 = v29;
          _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Payload validation from plugin %@ for payload (%@) failed. reason %@", buf, 0x20u);
        }
      }

      [*(a1 + 48) showPayloadValidationAlertWithDescription:*(a1 + 40)];
    }
  }
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_1370(uint64_t a1)
{
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1371;
  v6[3] = &unk_1E72EDF18;
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v4 = *(a1 + 48);
  v5 = *(a1 + 56);
  v7 = v3;
  v8 = v4;
  v9 = v5;
  [CKComposition compositionWithShelfPluginPayload:v2 completionHandler:v6];
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1371(uint64_t a1, uint64_t a2)
{
  v4 = [*(a1 + 32) compositionByAppendingComposition:a2];
  [*(a1 + 40) sendCompositionIfAllowed:?];
  v3 = *(a1 + 48);
  if (v3)
  {
    (*(v3 + 16))(v3, 1);
  }
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_1373(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 updateEntryView];
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1375(uint64_t a1, uint64_t a2)
{
  v3 = [*(a1 + 32) _itemPayloadFromMSMessage:a2];
  (*(*(a1 + 40) + 16))();
}

- (void)showPayloadValidationAlertWithDescription:(id)a3
{
  v4 = [MEMORY[0x1E69DC650] alertControllerWithTitle:0 message:a3 preferredStyle:1];
  v5 = MEMORY[0x1E69DC648];
  v6 = CKFrameworkBundle();
  v7 = [v6 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __62__CKChatController_showPayloadValidationAlertWithDescription___block_invoke;
  v9[3] = &unk_1E72EBFE8;
  v9[4] = self;
  v8 = [v5 actionWithTitle:v7 style:0 handler:v9];
  [v4 addAction:v8];

  [(CKChatController *)self presentViewController:v4 animated:1 completion:0];
}

- (void)_handleDictationStarted:(id)a3
{
  [(CKChatController *)self setShouldShowAudioButtonInEntryView:0];

  [(CKChatController *)self _updateEntryViewFrameIfNeeded:1];
}

- (void)setShouldShowAudioButtonInEntryView:(BOOL)a3
{
  v3 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  v4 = [v5 chat];
  [v4 setShouldShowAudioButtonInEntryView:v3];
}

- (void)sendCompositionIfAllowed:(id)a3
{
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [(CKChatController *)self setShouldShowAudioButtonInEntryView:1];
  }

  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Checking for sensitive content if necessary", buf, 2u);
    }
  }

  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __45__CKChatController_sendCompositionIfAllowed___block_invoke;
  v7[3] = &unk_1E72EBA18;
  v7[4] = self;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __45__CKChatController_sendCompositionIfAllowed___block_invoke_2;
  v6[3] = &unk_1E72ED6D8;
  v6[4] = self;
  [(CKCoreChatController *)self checkForSensitiveContentAndSendComposition:v4 willPresentInterventionHandler:v7 sendHandler:v6];
}

uint64_t __45__CKChatController_sendCompositionIfAllowed___block_invoke(uint64_t a1)
{
  result = [*(a1 + 32) effectPickerIsPresented];
  if (result)
  {
    v3 = *(a1 + 32);

    return [v3 dismissEffectPickerAnimated:1];
  }

  return result;
}

void __45__CKChatController_sendCompositionIfAllowed___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Checking composition that has been checked for sensitive content", v5, 2u);
    }
  }

  [*(a1 + 32) sendComposition:v3];
}

- (void)handleStickerTapbackConfirmCommSafetySendContext:(id)a3
{
  v4 = a3;
  v7 = [v4 stickerTapback];
  v5 = [v4 parentMessagePartChatItem];

  v6 = [(CKCoreChatController *)self chat];
  [v6 sendTapback:v7 forChatItem:v5];
}

- (void)handleAutomaticallyPlacedStickerCommSafetySendContext:(id)a3
{
  v4 = a3;
  v17 = [v4 sticker];
  v5 = [v4 stickerReactionSession];
  v6 = [v4 chatItem];
  v7 = [v4 parentChatItem];
  [v4 stickerFrame];
  v9 = v8;
  v11 = v10;
  v13 = v12;
  v15 = v14;
  v16 = [v4 animationCompletionHandler];

  [(CKChatController *)self _sendAutomaticallyPlacedSticker:v17 stickerReactionSession:v5 forChatItem:v6 forParentChatItem:v7 stickerFrame:v16 animationCompletionHandler:v9, v11, v13, v15];
}

- (void)clearStagedSensitiveContentUsingContextDictionary:(id)a3
{
  v31 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 objectForKey:@"CKCommSafetyContextKeyiOSSend"];
  v6 = [v5 composition];
  v7 = [v5 sensitiveMediaObjects];
  v8 = [v5 identifiersOfShelvedImages];
  if ([v7 count])
  {
    v9 = [v6 compositionByRemovingMediaObjects:v7];
    v10 = [v9 shelfPluginPayload];
    if (v10)
    {
      v11 = [v6 shelfMediaObject];
      v12 = [v7 containsObject:v11];

      if (v12)
      {
        v25 = [CKComposition alloc];
        v13 = [v9 text];
        v24 = [v9 subject];
        v23 = [v9 translation];
        v14 = [v9 bizIntent];
        v15 = [v9 proofreadingInfo];
        v16 = [(CKComposition *)v25 initWithText:v13 subject:v24 translation:v23 shelfPluginPayload:0 bizIntent:v14 shelfMediaObject:0 proofreadingInfo:v15];
        v26 = v4;
        v17 = v16;

        v9 = v17;
        v4 = v26;
      }
    }

    [(CKChatController *)self setComposition:v9];
  }

  v18 = [(CKCoreChatController *)self inputController];
  [v18 requestPhotoBrowserToUnstageImages:v8];

  if (IMOSLoggingEnabled())
  {
    v19 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      v20 = [(CKCoreChatController *)self conversation];
      v21 = [v20 chat];
      v22 = [v21 chatIdentifier];
      *buf = 138412546;
      v28 = v6;
      v29 = 2112;
      v30 = v22;
      _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Not sending composition %@ for chat %@ since composition flagged as sensitive and user clicked Don't Send", buf, 0x16u);
    }
  }
}

- (id)mediaObjectsFromComposition:(id)a3
{
  v3 = a3;
  v4 = [v3 mediaObjects];
  v5 = [v4 mutableCopy];

  v6 = [v3 shelfPluginPayload];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  v9 = v8;
  if (v8)
  {
    if ([v8 payloadCollaborationType] == 1 && objc_msgSend(v9, "sendAsCopy") && (objc_msgSend(v3, "shelfMediaObject"), v10 = objc_claimAutoreleasedReturnValue(), v10, v10))
    {
      v11 = [v3 shelfMediaObject];
    }

    else
    {
      v12 = [v9 mediaObjectFromPayload];

      if (!v12)
      {
        v13 = [v9 __ck_photoCompositionMediaObjects];
        if ([v13 count])
        {
          [v5 addObjectsFromArray:v13];
        }

LABEL_15:

        goto LABEL_16;
      }

      v11 = [v9 mediaObjectFromPayload];
    }

    v13 = v11;
    if (!v11)
    {
      goto LABEL_16;
    }

    [v5 addObject:v11];
    goto LABEL_15;
  }

LABEL_16:
  v14 = [v5 copy];

  return v14;
}

- (void)flagSensitiveMediaObjects:(id)a3
{
  v47 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [MEMORY[0x1E69A7FC8] sharedManager];
  if ([v5 checksForSensitivityOnSend])
  {
    v37 = v5;
    v38 = v4;
    v6 = [(CKChatController *)self mediaObjectsFromComposition:v4];
    v39 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v7 = [MEMORY[0x1E69A7FC0] sharedManager];
    v36 = self;
    v8 = [(CKCoreChatController *)self conversation];
    v9 = [v8 chat];
    v10 = [v9 chatIdentifier];

    v44 = 0u;
    v45 = 0u;
    v42 = 0u;
    v43 = 0u;
    obj = v6;
    v11 = [obj countByEnumeratingWithState:&v42 objects:v46 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v43;
      do
      {
        v14 = 0;
        v40 = v12;
        do
        {
          if (*v43 != v13)
          {
            objc_enumerationMutation(obj);
          }

          v15 = *(*(&v42 + 1) + 8 * v14);
          v16 = [v15 transfer];
          v17 = [v16 fileURL];

          v18 = [v7 cachedResultForContentAttachment:v17 withChatID:v10];
          v19 = [v15 transfer];
          v20 = [v19 guid];

          if (v18)
          {
            v21 = v20 == 0;
          }

          else
          {
            v21 = 1;
          }

          if (!v21)
          {
            v22 = v10;
            v23 = v7;
            if ([v18 BOOLValue])
            {
              v24 = [MEMORY[0x1E695DEF0] dataWithContentsOfURL:v17];
              if (v24)
              {
                v25 = [objc_alloc(MEMORY[0x1E69A5B38]) initWithIdentifier:v20 imageData:v24];
                [v39 addObject:v25];
              }
            }

            if ([v18 BOOLValue])
            {
              v26 = 2;
            }

            else
            {
              v26 = 0;
            }

            v27 = [MEMORY[0x1E69A5B80] sharedInstance];
            v28 = [v27 transferForGUID:v20];

            [v28 setCommSafetySensitive:v26];
            v7 = v23;
            v10 = v22;
            v12 = v40;
          }

          ++v14;
        }

        while (v12 != v14);
        v12 = [obj countByEnumeratingWithState:&v42 objects:v46 count:16];
      }

      while (v12);
    }

    if ([v39 count])
    {
      v29 = MEMORY[0x1E69A5B30];
      [(CKCoreChatController *)v36 conversation];
      v31 = v30 = v7;
      [v31 chat];
      v33 = v32 = v10;
      v34 = [v33 localTypingMessageGUID];
      v35 = [(CKCoreChatController *)v36 chat];
      [v29 registerEvent:0 eventType:0 messageGUID:v34 chat:v35 forImages:v39];

      v10 = v32;
      v7 = v30;
    }

    v5 = v37;
    v4 = v38;
  }
}

- (void)messageEntryViewDidChange:(id)a3 isTextChange:(BOOL)a4 isShelfChange:(BOOL)a5 isTranslationChange:(BOOL)a6
{
  v6 = a6;
  v7 = a5;
  v8 = a4;
  v31 = a3;
  v10 = [(CKChatController *)self typingUpdater];
  [v10 setNeedsUpdate];

  if (!-[CKChatController isAnimatingMessageSend](self, "isAnimatingMessageSend") || ([v31 contentView], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v11, "textView"), v12 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v12, "text"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "length"), v13, v12, v11, v14))
  {
    v15 = [v31 isShowingAudioRecordingView];
    v16 = [MEMORY[0x1E69A8070] sharedInstance];
    v17 = [v16 isSendMenuEnabled];

    v18 = CKIsRunningInMacCatalyst();
    v19 = [(CKChatController *)self hasFinishedRestoringDraftState]|| CKIsRunningInMessagesViewService() != 0;
    v20 = [(CKCoreChatController *)self delegate];
    v21 = objc_opt_respondsToSelector();

    if (v21)
    {
      v22 = [(CKCoreChatController *)self delegate];
      v23 = [v22 hasDetailsNavigationController];

      if (!v7)
      {
LABEL_8:
        if (((v15 | v23) & 1) != 0 || v6)
        {
          goto LABEL_15;
        }

        goto LABEL_14;
      }
    }

    else
    {
      v23 = 0;
      if (!v7)
      {
        goto LABEL_8;
      }
    }

    if ((v18 == 0) & v17 | (v15 | v23) & 1 || v6)
    {
      goto LABEL_15;
    }

LABEL_14:
    v19 = 0;
LABEL_15:
    [(CKChatController *)self _updateEntryViewFrameIfNeeded:v19];
  }

  [(CKChatController *)self _updatePollSuggestionAvailability];
  v24 = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
  v25 = [(CKCoreChatController *)self collectionViewController];
  v26 = [v25 collectionView];
  v27 = v26;
  if (v24 && [v26 transcriptScrollIntent] == 9)
  {
    [v27 setTranscriptScrollIntent:0];
    v28 = +[CKScrollViewAnimationProperties inheritedAnimation];
    [v27 enforceTranscriptScrollIntentWithAnimationProperties:v28];
  }

  v29 = [[CKTranscriptScrollIntentEntryViewChangedTrigger alloc] initWithEntryView:v31 isTextChange:v8 isShelfChange:v7 isSendLaterPluginChange:0];
  if ([(CKChatController *)self hasFinishedRestoringDraftState])
  {
    [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];
  }

  else
  {
    +[CKScrollViewAnimationProperties unanimated];
  }
  v30 = ;
  [v25 updateScrollIntentWithTrigger:v29 activeKeyboardAppearanceAnimationProperties:v30];
}

- (void)messageEntryViewRecordingDidChange:(id)a3
{
  [MEMORY[0x1E69DD258] attemptRotationToDeviceOrientation];
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 stopPlayingAudio];

  v5 = [(CKChatController *)self typingUpdater];
  [v5 setNeedsUpdate];
}

- (id)inputContextHistoryForMessageEntryView:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  if ([v4 isKnownSender])
  {
    v5 = [(CKCoreChatController *)self collectionViewController];
    v6 = [v5 inputContextHistory];
  }

  else
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *v9 = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Not providing input context history because conversation is with an unknown sender.", v9, 2u);
    }

    v6 = 0;
  }

  return v6;
}

- (BOOL)_transcriptScrollsOnEntryViewActivation
{
  v2 = [(CKChatController *)self collectionView];
  v3 = [v2 transcriptScrollIntent];

  if (CKIsRunningInMacCatalyst() || [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode])
  {
    if (v3)
    {
      v4 = v3 == 6;
    }

    else
    {
      v4 = 1;
    }

    LOBYTE(v5) = v4;
  }

  else
  {
    v5 = 0x47u >> v3;
    if (v3 > 6)
    {
      LOBYTE(v5) = 0;
    }
  }

  return v5 & 1;
}

- (void)messageEntryViewDidBeginEditing:(id)a3
{
  if ([(CKChatController *)self _wantsThreeColumnLayout])
  {
    if (!CKIsRunningInMacCatalyst())
    {
      v4 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v5 = [v4 isModernSplitViewControllerEnabled];

      if ((v5 & 1) == 0)
      {
        v6 = [(CKChatController *)self splitViewController];
        [v6 hideColumn:0];
      }
    }
  }

  [(CKChatController *)self registerForTextInputPayloadHandling];
  if (![(CKChatController *)self hasAlreadyPresentedSatelliteConnectionBanner])
  {
    v7 = [MEMORY[0x1E69A5B00] sharedInstance];
    v8 = [(CKCoreChatController *)self conversation];
    v9 = [v8 chat];
    [v7 presentSatelliteConnectionBannerIfNecessaryWithChat:v9 withReason:*MEMORY[0x1E69A5A50] ignoreTimerLimit:1];

    [(CKChatController *)self setHasAlreadyPresentedSatelliteConnectionBanner:1];
  }
}

- (void)messageEntryViewDidBeginEditingNotAlreadyActive:(id)a3
{
  v4 = a3;
  if ([(CKChatController *)self targetFirstResponder]== 1)
  {
    [(CKChatController *)self setTargetFirstResponder:0];
  }

  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v11 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Learned messageEntryViewDidBeginEditingNotAlreadyActive, updating scrollIntent.", v11, 2u);
    }
  }

  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [[CKTranscriptScrollIntentEntryViewActiveTrigger alloc] initWithChatController:self];
  v8 = [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];
  [v6 updateScrollIntentWithTrigger:v7 activeKeyboardAppearanceAnimationProperties:v8];

  v9 = [(CKChatController *)self inlineReplyController];
  if (v9 || [(CKChatController *)self entryViewWasActiveOnContextMenuPresentation])
  {
  }

  else if (!CKIsRunningInMessagesTranscriptExtension())
  {
    [(CKChatController *)self setupScrollingForKeyboardInteraction];
  }

  [(CKChatController *)self setEntryViewWasActiveOnContextMenuPresentation:0];
  [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
  if (CKIsRunningInMacCatalyst())
  {
    v10 = [(CKCoreChatController *)self collectionViewController];
    [v10 deselectAllBalloons];
  }
}

- (BOOL)messageEntryView:(id)a3 shouldInsertMediaObjects:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [(CKCoreChatController *)self conversation];
  v9 = [v7 composition];

  v10 = [v9 compositionByAppendingMediaObjects:v6];

  LOBYTE(v6) = [v8 canSendComposition:v10 error:0];
  return v6;
}

- (void)messageEntryView:(id)a3 didInsertPluginPayload:(id)a4
{
  v5 = [a4 pluginBundleID];
  v6 = IMBalloonExtensionIDWithSuffix();
  v7 = [v5 isEqualToString:v6];

  if (CKIsRunningInMacCatalyst() && v7)
  {
    v8 = [(CKChatController *)self viewControllerForChatInputModalPresentation];
    [v8 dismissViewControllerAnimated:1 completion:0];

    v9 = [MEMORY[0x1E696AD88] defaultCenter];
    [v9 postNotificationName:@"CKAnimojiStickerPopoverWillHide" object:0];
  }
}

- (void)messageEntryViewSendButtonHit:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self effectPickerWindow];

  if (v5)
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Effect window exists. Drop send button press.", buf, 2u);
      }
    }
  }

  else
  {
    if (CKIsRunningInMacCatalyst())
    {
      v7 = [(CKChatController *)self viewControllerForChatInputModalPresentation];
      [v7 dismissViewControllerAnimated:1 completion:0];
    }

    v8 = +[CKAdaptivePresentationController sharedInstance];
    [v8 dismissViewControllerAnimated:1 completion:0];

    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __50__CKChatController_messageEntryViewSendButtonHit___block_invoke;
    v9[3] = &unk_1E72ED6D8;
    v9[4] = self;
    [v4 compositionWithAcceptedAutocorrection:v9];
  }
}

void __50__CKChatController_messageEntryViewSendButtonHit___block_invoke(uint64_t a1, void *a2)
{
  v9 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = [v3 hasContent];
      v6 = @"NO";
      if (v5)
      {
        v6 = @"YES";
      }

      v7 = 138412290;
      v8 = v6;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Composition with accepted autocorrection returned. In completion block. composition.hasContent: %@", &v7, 0xCu);
    }
  }

  [*(a1 + 32) selectAccountAndSendComposition:v3 completion:0];
}

- (void)selectAccountAndSendComposition:(id)a3 completion:(id)a4
{
  v15 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKCoreChatController *)self chat];
  v9 = [v8 isStewieChat];

  if (v9)
  {
    HasMultipleSubscriptions = 0;
  }

  else
  {
    HasMultipleSubscriptions = IMSharedHelperDeviceHasMultipleSubscriptions();
  }

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = @"NO";
      if (HasMultipleSubscriptions)
      {
        v12 = @"YES";
      }

      v13 = 138412290;
      v14 = v12;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Should present account selection menu on send: %@", &v13, 0xCu);
    }
  }

  if (HasMultipleSubscriptions)
  {
    [(CKChatController *)self presentActionMenuForAccountSelection:v6 completion:v7];
  }

  else
  {
    [(CKChatController *)self _validateAndSendComposition:v6 completion:v7];
  }
}

- (void)messageEntryViewPopulatePreviousSentMessage:(id)a3
{
  v31 = *MEMORY[0x1E69E9840];
  v25 = [(CKCoreChatController *)self collectionViewController];
  v4 = [v25 chatItems];
  v5 = [(CKChatController *)self lastPopulatedMessageGuidFromMe];
  v6 = v5 == 0;

  if (!v5)
  {
    v7 = [(CKChatController *)self entryView];
    v8 = [v7 composition];
    [(CKChatController *)self setOriginalComposition:v8];
  }

  v28 = 0u;
  v29 = 0u;
  v26 = 0u;
  v27 = 0u;
  v9 = [v4 reverseObjectEnumerator];
  v10 = [v9 countByEnumeratingWithState:&v26 objects:v30 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v27;
    while (2)
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v27 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v26 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v15 = [v14 IMChatItem];
          if ([v15 isFromMe])
          {
            v16 = [v15 guid];
            if (v6)
            {
              [(CKChatController *)self setLastPopulatedMessageGuidFromMe:v16];
              v18 = v14;
              v19 = [(CKChatController *)self entryView];
              v20 = [CKComposition alloc];
              v21 = [v18 text];
              v22 = [v18 subject];

              v23 = [(CKComposition *)v20 initWithText:v21 subject:v22 shelfPluginPayload:0];
              [v19 setComposition:v23];

              goto LABEL_17;
            }

            v17 = [(CKChatController *)self lastPopulatedMessageGuidFromMe];
            v6 = [v16 isEqualToString:v17];
          }
        }
      }

      v11 = [v9 countByEnumeratingWithState:&v26 objects:v30 count:16];
      if (v11)
      {
        continue;
      }

      break;
    }
  }

LABEL_17:
}

- (void)messageEntryViewPopulateNextSentMessage:(id)a3
{
  v30 = *MEMORY[0x1E69E9840];
  v4 = [(CKChatController *)self lastPopulatedMessageGuidFromMe];

  if (v4)
  {
    v24 = [(CKCoreChatController *)self collectionViewController];
    [v24 chatItems];
    v25 = 0u;
    v26 = 0u;
    v27 = 0u;
    v5 = v28 = 0u;
    v6 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = 0;
      v9 = *v26;
      while (2)
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v26 != v9)
          {
            objc_enumerationMutation(v5);
          }

          v11 = *(*(&v25 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v12 = [v11 IMChatItem];
            if ([v12 isFromMe])
            {
              v13 = [v12 guid];
              if (v8)
              {
                [(CKChatController *)self setLastPopulatedMessageGuidFromMe:v13];
                v18 = v11;
                v19 = [(CKChatController *)self entryView];
                v20 = [CKComposition alloc];
                v21 = [v18 text];
                v22 = [v18 subject];

                v23 = [(CKComposition *)v20 initWithText:v21 subject:v22 shelfPluginPayload:0];
                [v19 setComposition:v23];

                return;
              }

              v14 = [(CKChatController *)self lastPopulatedMessageGuidFromMe];
              v8 = [v13 isEqualToString:v14];
            }
          }
        }

        v7 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }
  }

  [(CKChatController *)self setLastPopulatedMessageGuidFromMe:0];
  v15 = [(CKChatController *)self originalComposition];

  if (v15)
  {
    v16 = [(CKChatController *)self entryView];
    v17 = [(CKChatController *)self originalComposition];
    [v16 setComposition:v17];

    [(CKChatController *)self setOriginalComposition:0];
  }
}

- (void)_passKitUIDismissed:(id)a3
{
  v20 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = MEMORY[0x1E696AD98];
      v7 = +[CKPluginExtensionStateObserver sharedInstance];
      v8 = [v6 numberWithBool:{objc_msgSend(v7, "passKitUIPresented")}];
      v9 = [(CKChatController *)self deferredSendAnimationBlock];
      v10 = _Block_copy(v9);
      *buf = 138412546;
      v17 = v8;
      v18 = 2112;
      v19 = v10;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "passKit UI dismissed. PassKitUIPresented %@. sendAnimationBlock %@", buf, 0x16u);
    }
  }

  v11 = [(CKChatController *)self deferredSendAnimationBlock];
  if (v11)
  {
    v12 = +[CKPluginExtensionStateObserver sharedInstance];
    v13 = [v12 passKitUIPresented];

    if ((v13 & 1) == 0)
    {
      v14 = [MEMORY[0x1E696AD88] defaultCenter];
      [v14 removeObserver:self name:@"CKPluginExtensionStateObserverPassKitUIDismissed" object:0];

      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __40__CKChatController__passKitUIDismissed___block_invoke;
      block[3] = &unk_1E72EBA18;
      block[4] = self;
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }
  }
}

uint64_t __40__CKChatController__passKitUIDismissed___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) deferredSendAnimationBlock];
  v2[2]();

  v3 = *(a1 + 32);

  return [v3 setDeferredSendAnimationBlock:0];
}

- (void)messageEntryViewSendButtonHitWhileDisabled:(id)a3
{
  v3 = a3;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Send button was hit while it was disabled.", v5, 2u);
    }
  }
}

- (void)messageEntryViewPlusButtonHit:(id)a3
{
  v4 = IMLogHandleForCategory();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    *v5 = 0;
    _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Plus button hit", v5, 2u);
  }

  [(CKChatController *)self _beginDeferringSystemNavigationPopGestureForPlusButton];
}

- (unint64_t)preferredScreenEdgesDeferringSystemGestures
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  result = [(CKChatController *)&v4 preferredScreenEdgesDeferringSystemGestures];
  if (self->_deferSystemNavigationPopGestureForPlusButton)
  {
    result |= 2uLL;
  }

  return result;
}

- (void)_beginDeferringSystemNavigationPopGestureForPlusButton
{
  if (!self->_deferSystemNavigationPopGestureForPlusButton)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Began deferring system navigation pop gesture for PlusButton", v7, 2u);
    }

    self->_deferSystemNavigationPopGestureForPlusButton = 1;
    v4 = [(CKChatController *)self navigationController];
    v5 = [v4 interactivePopGestureRecognizer];
    [v5 setDelaysTouchesBegan:0];

    [(CKChatController *)self setNeedsUpdateOfScreenEdgesDeferringSystemGestures];
    v6 = [(CKCoreChatController *)self delegate];
    [v6 chatControllerDidChangeDeferringSystemNavigationPopGestureForPlusButton:self];
  }
}

- (void)_endDeferringSystemNavigationPopGestureForPlusButton
{
  if (self->_deferSystemNavigationPopGestureForPlusButton)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Ended deferring system navigation pop gesture for PlusButton", v7, 2u);
    }

    self->_deferSystemNavigationPopGestureForPlusButton = 0;
    v4 = [(CKChatController *)self navigationController];
    v5 = [v4 interactivePopGestureRecognizer];
    [v5 setDelaysTouchesBegan:1];

    [(CKChatController *)self setNeedsUpdateOfScreenEdgesDeferringSystemGestures];
    v6 = [(CKCoreChatController *)self delegate];
    [v6 chatControllerDidChangeDeferringSystemNavigationPopGestureForPlusButton:self];
  }
}

- (void)messageEntryViewRaiseGestureAutoSend:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Raise gesture auto send was triggered. Programmatically hit send button.", v6, 2u);
    }
  }

  [(CKChatController *)self messageEntryViewSendButtonHit:v4];
}

- (CGSize)messageEntryViewMaxShelfPluginViewSize:(id)a3
{
  [(CKChatController *)self balloonMaxWidth];
  v4 = v3;
  v5 = +[CKUIBehavior sharedBehaviors];
  [v5 maxTranscriptPortraitHeight];
  v7 = v6;

  v8 = v4;
  v9 = v7;
  result.height = v9;
  result.width = v8;
  return result;
}

- (BOOL)messageEntryViewWidth:(double *)a3 andOffset:(double *)a4
{
  v4 = 0;
  if (a3 && a4)
  {
    v8 = [(CKChatController *)self view];
    v9 = [v8 window];
    v4 = v9 != 0;
    if (!v9)
    {
LABEL_24:

      return v4;
    }

    v10 = v9;
    v11 = [(CKChatController *)self view];
    v12 = [v11 superview];

    if (v12)
    {
      v8 = [(CKChatController *)self splitViewController];
      if (v8)
      {
LABEL_6:
        v13 = 0.0;
        if (!-[CKCoreChatController isCollapsed](self, "isCollapsed") && ![*MEMORY[0x1E69DDA98] userInterfaceLayoutDirection])
        {
          if ([(CKChatController *)self _wantsThreeColumnLayout])
          {
            v14 = [v8 viewControllerForColumn:2];
            v15 = [v14 view];
            [v15 bounds];
            v17 = v16;
            v19 = v18;

            v20 = [v14 view];
            v21 = [(CKChatController *)self view];
            v22 = [v21 window];
            [v20 convertPoint:v22 toView:{v17, v19}];
            v13 = v23;
          }

          else
          {
            [v8 primaryColumnWidth];
            v28 = v27;
            if (CKPixelWidth_once_0 != -1)
            {
              [CKChatController messageEntryViewWidth:andOffset:];
            }

            v13 = v28 + *&CKPixelWidth_sPixel_0;
          }
        }

        goto LABEL_18;
      }

      v24 = [(CKChatController *)self navigationController];
      v25 = [v24 presentingViewController];
      v26 = [v25 presentingViewController];
      v8 = [v26 splitViewController];

      if ([v8 isCollapsed])
      {

        v8 = 0;
      }

      else if (v8)
      {
        goto LABEL_6;
      }

      v13 = 0.0;
LABEL_18:
      v29 = [(CKChatController *)self view];
      [v29 bounds];
      v31 = v30;
      v32 = [(CKChatController *)self view];
      v33 = [v32 window];
      [v33 bounds];
      v35 = v34;

      objc_opt_class();
      if (objc_opt_isKindOfClass() & 1) != 0 || (objc_opt_class(), (objc_opt_isKindOfClass()))
      {
        if (v13 == 0.0 && v31 < v35)
        {
          v36 = [(CKChatController *)self view];
          v37 = [(CKChatController *)self view];
          [v37 origin];
          [v36 convertPoint:0 toView:?];
          v13 = v38;
        }
      }

      v39 = [(CKChatController *)self view];
      [v39 bounds];
      *a3 = v40;

      *a4 = v13;
      goto LABEL_24;
    }

    return 0;
  }

  return v4;
}

- (BOOL)chatFooterViewOffset:(double *)a3
{
  v5 = [(CKChatController *)self needsFooter];
  v6 = 0;
  if (v5)
  {
    v7 = [(CKChatController *)self chatFooterView];
    LODWORD(v8) = 1144750080;
    LODWORD(v9) = 1144750080;
    [v7 systemLayoutSizeFittingSize:*MEMORY[0x1E69DE090] withHorizontalFittingPriority:*(MEMORY[0x1E69DE090] + 8) verticalFittingPriority:{v8, v9}];
    v6 = v10;
  }

  *a3 = v6;
  return v5;
}

- (CGRect)messageEntryView:(id)a3 frameInThrowViewCoordinatesForView:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self throwAnimationContainerSuperview:0];
  [v5 bounds];
  [v5 convertRect:v6 toView:?];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;

  v15 = v8;
  v16 = v10;
  v17 = v12;
  v18 = v14;
  result.size.height = v18;
  result.size.width = v17;
  result.origin.y = v16;
  result.origin.x = v15;
  return result;
}

- (void)openURLInExtensionContextForMode:(id)a3
{
  v4 = [(CKChatController *)self launchURLForMode:a3];
  v3 = [MEMORY[0x1E69DC668] sharedApplication];
  [v3 openURL:v4 options:MEMORY[0x1E695E0F8] completionHandler:0];
}

- (id)launchURLForMode:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E69A5AF8] sharedRegistry];
  v6 = [(CKCoreChatController *)self conversation];
  v7 = [v6 chat];
  v8 = [(CKChatController *)self entryView];
  v9 = [v8 composition];
  v10 = [v9 text];
  v11 = [v10 string];
  v12 = [v5 messagesURLWithChat:v7 orHandles:0 withMessageText:v11];

  v13 = [MEMORY[0x1E696AF20] componentsWithURL:v12 resolvingAgainstBaseURL:0];
  v14 = MEMORY[0x1E695DF70];
  v15 = [v13 queryItems];
  v16 = [v14 arrayWithArray:v15];

  v17 = [(CKChatController *)self messageGUIDForTranscriptExtension];
  v18 = [v17 length];

  if (v18)
  {
    v19 = MEMORY[0x1E696AF60];
    v20 = [(CKChatController *)self messageGUIDForTranscriptExtension];
    v21 = [v19 queryItemWithName:@"message-guid" value:v20];
    [v16 addObject:v21];
  }

  v22 = [MEMORY[0x1E696AF60] queryItemWithName:@"inputmode" value:v4];
  [v16 addObject:v22];

  v23 = [MEMORY[0x1E696AF60] queryItemWithName:@"overlay" value:@"1"];
  [v16 addObject:v23];

  [v13 setQueryItems:v16];
  v24 = [v13 URL];

  return v24;
}

- (void)contentInsetWillChange:(UIEdgeInsets)a3 withAnimationProperties:(id)a4
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 contentInsetWillChange:a4 withAnimationProperties:a3.top, a3.left, a3.bottom, a3.right];
  [(CKChatController *)self setNextEntryViewSafeAreaInsetUpdateIsSynchronous:1];
}

- (void)updateEntryViewHeightWithContentChange:(BOOL)a3 animated:(BOOL)a4 completionHandler:(id)a5
{
  v5 = a4;
  v6 = a3;
  v28 = a5;
  v8 = [(CKChatController *)self view];
  [v8 bounds];
  v10 = v9;

  [(CKChatController *)self _maxEntryViewHeight];
  v12 = v11;
  v13 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v14 = [v13 isModernSplitViewControllerEnabled];

  if (v14)
  {
    v15 = [(CKChatController *)self view];
    [v15 safeAreaInsets];
    v17 = v16;
    v18 = [(CKChatController *)self view];
    [v18 safeAreaInsets];
    v20 = v19;
    v21 = [(CKChatController *)self view];
    [v21 safeAreaInsets];
    v10 = v10 - (v20 + v22);
  }

  else
  {
    v17 = 0.0;
  }

  v23 = [(CKChatController *)self entryView];
  [v23 frame];
  v25 = v24;
  v27 = v26;

  if (v25 != v10 || v27 != v12)
  {
    [(CKChatController *)self _setEntryViewFrame:v6 isContentChange:v5 animated:v28 completionHandler:v17, 0.0, v10, v12];
  }
}

- (void)messageEntryViewSwipeDownGestureRecognized:(id)a3
{
  v9 = a3;
  if (CKIsRunningInMessages())
  {
    v4 = [(CKChatController *)self inputViewController];

    if (v4)
    {
      v5 = [(CKCoreChatController *)self inputController];
      [v5 swipeDismissBrowser];
    }

    else
    {
      v6 = [v9 contentView];
      v7 = [v6 activeView];
      v8 = [v7 isFirstResponder];

      if (!v8)
      {
        goto LABEL_6;
      }
    }

    [(CKChatController *)self dismissKeyboard];
  }

LABEL_6:
}

- (void)updateTyping
{
  v16 = [(CKChatController *)self entryView];
  if ([v16 isRecording])
  {
    v3 = [(CKCoreChatController *)self conversation];
    [v3 setLocalUserIsRecording:1];
    goto LABEL_10;
  }

  v4 = [v16 composition];
  v3 = [v4 shelfPluginPayload];

  if (!v3)
  {
    goto LABEL_7;
  }

  v5 = [v3 pluginBundleID];
  if ([v5 isEqualToIgnoringCase:*MEMORY[0x1E69A6A00]])
  {

LABEL_7:
    v9 = [(CKCoreChatController *)self conversation];
    v10 = [v16 composition];
    [v9 setLocalUserIsTyping:{objc_msgSend(v10, "hasContent")}];
    goto LABEL_8;
  }

  v6 = [v3 pluginBundleID];
  v7 = IMBalloonExtensionIDWithSuffix();
  v8 = [v6 isEqualToIgnoringCase:v7];

  if (v8)
  {
    goto LABEL_7;
  }

  v11 = [v16 composition];
  v12 = [v11 shelfPluginPayload];
  v9 = [v12 pluginBundleID];

  if (!v9 || ([v9 isEqualToString:*MEMORY[0x1E69A69A8]] & 1) != 0)
  {
    goto LABEL_9;
  }

  v13 = [MEMORY[0x1E69A5AD0] sharedInstance];
  v10 = [v13 balloonPluginForBundleID:v9];

  v14 = [v10 __ck_statusJPEGImageDataForTransportWithCompressionFactor:0.2];
  if (v14)
  {
    v15 = [(CKCoreChatController *)self conversation];
    [v15 setLocalUserIsComposing:v9 typingIndicatorIcon:v14];
  }

LABEL_8:
LABEL_9:

LABEL_10:
}

- (void)setEffectPickerIsPresented:(BOOL)a3
{
  if (self->_effectPickerIsPresented == !a3)
  {
    v4 = a3;
    self->_effectPickerIsPresented = a3;
    v8 = [(CKCoreChatController *)self collectionViewController];
    v6 = [(CKCoreChatController *)self conversation];
    v7 = [v6 chat];

    if (v4)
    {
      [v8 addContentAnimationPauseReasons:2];
      [v7 beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5798]];
    }

    else
    {
      [v7 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5798]];
      [v8 removeContentAnimationPauseReasons:2];
    }
  }
}

- (BOOL)gestureRecognizer:(id)a3 shouldRequireFailureOfGestureRecognizer:(id)a4
{
  v5 = a4;
  v6 = a3;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  v8 = 0;
  if (isKindOfClass)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = 1;
    }
  }

  return v8;
}

- (BOOL)gestureRecognizer:(id)a3 shouldReceiveTouch:(id)a4
{
  v5 = [a4 view];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    return 1;
  }

  else
  {
    return [(CKChatController *)self isEditing]^ 1;
  }
}

- (BOOL)allowEffectPickerToBePresented
{
  v3 = [MEMORY[0x1E69DC938] currentDevice];
  v4 = [v3 userInterfaceIdiom];

  if (v4 == 1)
  {
    return 1;
  }

  v6 = [(CKChatController *)self view];
  v7 = [v6 window];
  v8 = [v7 windowScene];
  v5 = ([v8 interfaceOrientation] - 5) < 0xFFFFFFFFFFFFFFFELL;

  return v5;
}

- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)a3
{
  v4 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:v4];
    v6 = v5;
    v8 = v7;
    v10 = v9;
    v12 = v11;
  }

  else
  {
    v26.receiver = self;
    v26.super_class = CKChatController;
    [(CKCoreChatController *)&v26 fullScreenBalloonViewControllerSafeAreaLayoutFrame:v4];
    v6 = v13;
    v8 = v14;
    v10 = v15;
    v17 = v16;

    v4 = [(CKChatController *)self entryView];
    [v4 bounds];
    v19 = v18;
    v20 = [(CKChatController *)self view];
    [v20 safeAreaInsets];
    v12 = v17 - (v19 - v21);
  }

  v22 = v6;
  v23 = v8;
  v24 = v10;
  v25 = v12;
  result.size.height = v25;
  result.size.width = v24;
  result.origin.y = v23;
  result.origin.x = v22;
  return result;
}

- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrameIgnoreEntryView:(id)a3
{
  v4 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:v4];
  }

  else
  {
    v17.receiver = self;
    v17.super_class = CKChatController;
    [(CKCoreChatController *)&v17 fullScreenBalloonViewControllerSafeAreaLayoutFrame:v4];
  }

  v9 = v5;
  v10 = v6;
  v11 = v7;
  v12 = v8;

  v13 = v9;
  v14 = v10;
  v15 = v11;
  v16 = v12;
  result.size.height = v16;
  result.size.width = v15;
  result.origin.y = v14;
  result.origin.x = v13;
  return result;
}

- (BOOL)clickInteractionShouldBegin:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self entryView];
  v6 = [v5 composition];
  v7 = [v6 shelfPluginPayload];

  v8 = [v7 datasource];
  LOBYTE(v6) = [v8 supportsDynamicSize];

  if (v6)
  {
    goto LABEL_8;
  }

  v9 = +[CKUIBehavior sharedBehaviors];
  v10 = [v9 shouldDisableSendButtonClickInteraction];

  if (v10)
  {
    goto LABEL_8;
  }

  v11 = [(CKChatController *)self entryView];
  v12 = [v11 hasRecording];

  if (v12)
  {
    goto LABEL_8;
  }

  v13 = [(CKCoreChatController *)self chat];
  v14 = [v13 supportsCapabilities:0x20000];

  if (!v14)
  {
    goto LABEL_8;
  }

  v15 = [(CKCoreChatController *)self chat];
  if (![v15 canSend])
  {
    v17 = 0;
LABEL_11:

    goto LABEL_9;
  }

  v16 = [(CKCoreChatController *)self isReadOnly];

  if (!v16 && (IMIsRunningInMessagesTranscriptExtension() & 1) == 0)
  {
    if ([(CKChatController *)self allowEffectPickerToBePresented])
    {
      v17 = 1;
      goto LABEL_9;
    }

    [v4 locationInCoordinateSpace:0];
    v20 = v19;
    v22 = v21;
    v23 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v24 = [v23 isEntryViewRefreshEnabled];

    v25 = [(CKChatController *)self entryView];
    v26 = v25;
    if (v24)
    {
      [v25 glassSendButton];
    }

    else
    {
      [v25 sendButton];
    }
    v15 = ;

    v27 = [v15 hitTest:0 withEvent:{v20, v22}];
    v17 = v27 == 0;

    goto LABEL_11;
  }

LABEL_8:
  v17 = 0;
LABEL_9:

  return v17;
}

- (void)showEffectPicker
{
  if (CKIsRunningInMacCatalyst() || (-[CKChatController entryView](self, "entryView"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 isSendButtonEnabled], v3, v4))
  {
    [(CKChatController *)self _initializeEffectPicker];
    v5 = [(CKChatController *)self effectPickerViewController];
    [v5 presentPicker];

    self->_effectPickerIsPresented = 1;
    v6 = [(CKChatController *)self view];
    [v6 setNeedsDisplay];
  }
}

- (void)dismissEffectPickerAnimated:(BOOL)a3
{
  v3 = a3;
  v5 = [(CKChatController *)self effectPickerViewController];
  [(CKChatController *)self effectPickerViewControllerClose:v5 animated:v3];

  v6 = +[CKAdaptivePresentationController sharedInstance];
  [v6 dismissViewControllerAnimated:v3 completion:0];

  [(CKChatController *)self setEffectPickerIsPresented:0];
}

- (void)tapGestureRecognized:(id)a3
{
  v10 = [(CKChatController *)self entryView];
  if (CKIsRunningInMacCatalyst())
  {
    v4 = [(CKCoreChatController *)self collectionViewController];
    [v4 hideTranscriptTimestampsIfNeeded];

    v5 = [(CKCoreChatController *)self collectionViewController];
    [v5 deselectAllBalloons];

    v6 = [v10 contentView];
    v7 = [v6 textView];
    [v7 resignFirstResponder];

    v8 = [v10 contentView];
    v9 = [v8 textView];
    [v9 setHideCaretUntilUserTypes:1];
  }
}

- (void)raiseGestureRecognized:(id)a3
{
  v6 = a3;
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v4 isBlockedByCommunicationLimits];

  if ((v5 & 1) == 0)
  {
    [(CKChatController *)self __raiseGestureRecognized:v6];
  }
}

- (void)__raiseGestureRecognized:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E69DCBF0] sharedInputModeController];
  v6 = [v5 currentInputMode];
  v7 = [v6 identifier];
  v8 = *MEMORY[0x1E69DDFB0];

  if (v7 != v8)
  {
    v9 = [(CKCoreChatController *)self collectionViewController];
    v10 = [v9 canRaiseToListen];

    if (v10)
    {
      v11 = [(CKCoreChatController *)self collectionViewController];
      [v11 raiseGestureRecognized:v4];
    }

    else
    {
      v12 = [(CKCoreChatController *)self conversation];
      v13 = [v12 chat];
      v14 = [v13 supportsCapabilities:0x10000];

      if (v14)
      {
        if ([v4 isRecognized])
        {
          if (IMOSLoggingEnabled())
          {
            v15 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Starting audio recording invoked by raise to record gesture.", buf, 2u);
            }
          }

          v11 = [(CKChatController *)self entryView];
          [v11 startRecordingForRaiseGesture];
        }

        else
        {
          v16 = [v4 gestureState];
          v17 = IMOSLoggingEnabled();
          if (v16 == 2)
          {
            if (v17)
            {
              v18 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Stopping audio recording invoked by raise to record gesture because of failure.", v23, 2u);
              }
            }

            v19 = [(CKChatController *)self entryView];
            v11 = v19;
            v20 = 1;
          }

          else
          {
            if (v17)
            {
              v21 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
              {
                *v22 = 0;
                _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Stopping audio recording invoked by raise to record gesture.", v22, 2u);
              }
            }

            v19 = [(CKChatController *)self entryView];
            v11 = v19;
            v20 = 0;
          }

          [v19 stopRecordingForRaiseGestureWithFailure:v20];
        }
      }

      else
      {
        if (!IMOSLoggingEnabled())
        {
          goto LABEL_5;
        }

        v11 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          *v25 = 0;
          _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Ignoring raise gesture for audio recording because chat does not support capability.", v25, 2u);
        }
      }
    }
  }

LABEL_5:
}

- (void)updateRaiseGesture
{
  v8 = [(CKCoreChatController *)self collectionViewController];
  v3 = [MEMORY[0x1E69DC668] sharedApplication];
  if ([v3 applicationState] || !-[CKViewController appeared](self, "appeared"))
  {
    v5 = 0;
    goto LABEL_6;
  }

  v4 = [(CKChatController *)self imagePickerController];
  if (!v4)
  {
    v7 = [(CKChatController *)self presentedViewController];
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      if ([v8 canRaiseToListen])
      {
        v5 = 1;
        goto LABEL_15;
      }

      if ([v8 canRaiseToTalk])
      {
        v5 = [(CKCoreChatController *)self isReadOnly]^ 1;
        goto LABEL_15;
      }
    }

    v5 = 0;
LABEL_15:

    goto LABEL_16;
  }

  v5 = 0;
LABEL_16:

LABEL_6:
  v6 = [(CKChatController *)self raiseGesture];
  [v6 setEnabled:v5];
}

- (void)_saveDraftState
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = v3;
  if (v3 && (v15 = v3, v5 = IMIsRunningInMessagesComposeViewService(), v4 = v15, !v5))
  {
    v6 = [(CKCoreChatController *)self conversation];
    v7 = [v6 chat];
    v8 = [v7 joinState];

    if (v8 != 1)
    {
      v9 = [(CKCoreChatController *)self conversation];
      if (-[CKChatController isAnimatingMessageSend](self, "isAnimatingMessageSend") || (+[CKConversationList sharedConversationList](CKConversationList, "sharedConversationList"), v10 = objc_claimAutoreleasedReturnValue(), [v10 pendingConversation], v11 = objc_claimAutoreleasedReturnValue(), v11, v10, v11 == v9))
      {
        if (IMOSLoggingEnabled())
        {
          v14 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Skip saving draft state", buf, 2u);
          }
        }
      }

      else
      {
        v12 = [(CKCoreChatController *)self inputController];
        [v12 requestPhotoBrowserToPrepareForDraft];

        v13 = [(CKCoreChatController *)self inputController];
        v17[0] = MEMORY[0x1E69E9820];
        v17[1] = 3221225472;
        v17[2] = __35__CKChatController__saveDraftState__block_invoke;
        v17[3] = &unk_1E72ED6D8;
        v18 = v9;
        [v13 requestPollPluginToPrepareForDraftWithCompletion:v17];
      }
    }
  }

  else
  {
  }
}

void __35__CKChatController__saveDraftState__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Conversation has unsent composition, saving draft state", v5, 2u);
    }
  }

  [*(a1 + 32) setUnsentComposition:v3];
}

- (BOOL)_shouldRestoreDraftState
{
  v2 = [(CKChatController *)self composition];
  if ([v2 hasContent])
  {
    LOBYTE(v3) = 0;
  }

  else
  {
    v3 = !CKBalloonPluginViewCacheNeedsPrewarm();
  }

  return v3;
}

- (void)_prewarmBalloonPluginViewCacheCompleted:(id)a3
{
  [(CKChatController *)self _restoreDraftState];
  v4 = [(CKChatController *)self composition];
  if (v4)
  {
    v9 = v4;
    v5 = [(CKChatController *)self composition];
    if ([v5 hasContent])
    {
      v6 = [(CKChatController *)self composition];
      v7 = [v6 shelfPluginPayload];

      if (!v7)
      {
        return;
      }

      v8 = +[CKBalloonPluginManager sharedInstance];
      [v8 invalidatePhotosViewController];

      v9 = [(CKCoreChatController *)self inputController];
      v5 = [(CKChatController *)self composition];
      [v9 requestPhotoBrowserInitFromDraft:v5];
    }
  }
}

- (void)_restoreDraftState
{
  if ([(CKChatController *)self _shouldRestoreDraftState])
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Composition does not have content, trying to restore draft", buf, 2u);
      }
    }

    if ((IMIsRunningInMessagesComposeViewService() & 1) == 0)
    {
      v4 = [(CKCoreChatController *)self inputController];

      if (!v4)
      {
        [(CKChatController *)self loadChatInputController];
      }

      v5 = [(CKCoreChatController *)self conversation];
      v6 = [v5 unsentComposition];

      if (([v6 hasContent] & 1) != 0 || (objc_msgSend(v6, "bizIntent"), v7 = objc_claimAutoreleasedReturnValue(), v7, v7))
      {
        v8 = [(CKCoreChatController *)self conversation];
        v9 = [v8 chat];
        v10 = [v6 bizIntent];
        [v9 setBizIntent:v10];

        [(CKChatController *)self setComposition:v6];
        v11 = +[CKBalloonPluginManager sharedInstance];
        [v11 invalidatePhotosViewController];

        v12 = [(CKCoreChatController *)self inputController];
        [v12 requestPhotoBrowserInitFromDraft:v6];

        v13 = +[CKUIBehavior sharedBehaviors];
        LODWORD(v9) = [v13 restoringDraftShouldShowKeyboard];

        if (v9)
        {
          [(CKChatController *)self setTargetFirstResponder:1];
          self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft = 1;
        }

        if (IMOSLoggingEnabled())
        {
          v14 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
          {
            *v15 = 0;
            _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Draft composition restored", v15, 2u);
          }
        }
      }

      [(CKChatController *)self setHasFinishedRestoringDraftState:1];
    }
  }
}

- (id)getCurrentContext
{
  v60 = *MEMORY[0x1E69E9840];
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 chat];

  v5 = [v4 lastFinishedMessage];
  if (v5)
  {
    v6 = objc_alloc_init(MEMORY[0x1E69C7A98]);
    v7 = [v5 time];
    [v6 setDateSent:v7];

    v8 = [MEMORY[0x1E696AD98] numberWithBool:{objc_msgSend(v5, "isFromMe")}];
    [v6 setOutgoing:v8];

    if (([v5 isFromMe] & 1) == 0)
    {
      v9 = objc_alloc_init(MEMORY[0x1E69C7938]);
      v10 = [v5 sender];
      v11 = [v10 ID];

      v12 = [v5 sender];
      v13 = [v12 fullName];

      [v9 setData:v11];
      if (v13)
      {
        [v9 setDisplayText:v13];
      }

      else
      {
        v15 = IMFormattedDisplayStringForIDInAddressBook();
        [v9 setDisplayText:v15];
      }

      v16 = CKSAPersonForAddress(v11);
      [v9 setObject:v16];

      [v6 setMsgSender:v9];
    }

    v17 = [(CKCoreChatController *)self conversation];
    v18 = [v17 recipients];

    if (([v5 isFromMe] & 1) != 0 || objc_msgSend(v18, "count") >= 2)
    {
      v47 = v5;
      v48 = v4;
      v19 = [MEMORY[0x1E695DF70] array];
      v54 = 0u;
      v55 = 0u;
      v56 = 0u;
      v57 = 0u;
      v45 = v18;
      v20 = v18;
      v21 = [v20 countByEnumeratingWithState:&v54 objects:v59 count:16];
      if (v21)
      {
        v22 = v21;
        v23 = *v55;
        do
        {
          for (i = 0; i != v22; ++i)
          {
            if (*v55 != v23)
            {
              objc_enumerationMutation(v20);
            }

            v25 = [*(*(&v54 + 1) + 8 * i) rawAddress];
            [v19 addObject:v25];
          }

          v22 = [v20 countByEnumeratingWithState:&v54 objects:v59 count:16];
        }

        while (v22);
      }

      v46 = v6;

      v26 = objc_alloc_init(MEMORY[0x1E695DF70]);
      v50 = 0u;
      v51 = 0u;
      v52 = 0u;
      v53 = 0u;
      obj = v19;
      v27 = [obj countByEnumeratingWithState:&v50 objects:v58 count:16];
      if (v27)
      {
        v28 = v27;
        v29 = *v51;
        do
        {
          for (j = 0; j != v28; ++j)
          {
            if (*v51 != v29)
            {
              objc_enumerationMutation(obj);
            }

            v31 = *(*(&v50 + 1) + 8 * j);
            v32 = [MEMORY[0x1E69A7FD0] sharedInstance];
            v33 = [v32 fetchCNContactForHandleWithID:v31];

            v34 = [MEMORY[0x1E69A7FD0] fullNameForCNContact:v33];
            v35 = objc_alloc_init(MEMORY[0x1E69C7938]);
            [v35 setData:v31];
            if (v34)
            {
              [v35 setDisplayText:v34];
            }

            else
            {
              v36 = IMFormattedDisplayStringForIDInAddressBook();
              [v35 setDisplayText:v36];
            }

            v37 = CKSAPersonForAddress(v31);
            [v35 setObject:v37];

            [v26 addObject:v35];
          }

          v28 = [obj countByEnumeratingWithState:&v50 objects:v58 count:16];
        }

        while (v28);
      }

      v6 = v46;
      [v46 setMsgRecipients:v26];

      v5 = v47;
      v4 = v48;
      v18 = v45;
    }

    v38 = MEMORY[0x1E695DFF8];
    v39 = [MEMORY[0x1E696AEC0] stringWithFormat:@"x-apple-sms:guid=%lld", objc_msgSend(v5, "messageID")];
    v40 = [v38 URLWithString:v39];
    [v6 setIdentifier:v40];

    v41 = [v4 guid];
    [v6 setChatIdentifier:v41];

    v42 = MEMORY[0x1E695DEC8];
    v43 = [v6 dictionary];
    v14 = [v42 arrayWithObject:v43];
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)setEditing:(BOOL)a3 animated:(BOOL)a4
{
  v4 = a4;
  v5 = a3;
  if ([(CKChatController *)self isEditing]== a3)
  {
    v19 = [(CKChatController *)self navigationController];
    [v19 setToolbarHidden:v5 ^ 1 animated:v4];
  }

  else
  {
    v24.receiver = self;
    v24.super_class = CKChatController;
    [(CKChatController *)&v24 setEditing:v5 animated:v4];
    [(CKChatController *)self _updateNavigationButtons];
    if (v5)
    {
      [(CKChatController *)self _updateToolbarItems];
      v7 = [(CKChatController *)self editingToolbarItems];
      [(CKChatController *)self setToolbarItems:v7 animated:0];

      v8 = CKIsAppCardsEnabled();
      v9 = [(CKCoreChatController *)self inputController];
      v10 = v9;
      if (v8)
      {
        [v9 dismissAppCardIfNecessaryAnimated:v4 completion:0];
      }

      else
      {
        [v9 forceDismissBrowserWithoutAnimation];
      }

      [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
      [(CKChatController *)self removeFooterView];
      [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
    }

    else
    {
      if ([(CKViewController *)self appeared])
      {
        [(CKChatController *)self becomeFirstResponder];
        [(CKChatController *)self reloadInputViews];
      }

      [(CKChatController *)self _updateToolbarItems];
      [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
      [(CKChatController *)self reloadFooterViewControllerIfNecessary];
      [(CKChatController *)self _showCatchUpButtonIfNeeded];
    }

    v11 = [(CKCoreChatController *)self collectionViewController];
    v12 = [v11 collectionView];

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __40__CKChatController_setEditing_animated___block_invoke;
    aBlock[3] = &unk_1E72ED8D8;
    v23 = v5;
    aBlock[4] = self;
    v13 = _Block_copy(aBlock);
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __40__CKChatController_setEditing_animated___block_invoke_2;
    v20[3] = &unk_1E72ECCA8;
    v20[4] = self;
    v14 = v12;
    v21 = v14;
    v15 = _Block_copy(v20);
    v16 = +[CKAdaptivePresentationController sharedInstance];
    [v16 dismissViewControllerAnimated:v4 completion:0];

    if (v4)
    {
      [MEMORY[0x1E69DD250] animateWithDuration:4 delay:v13 options:v15 animations:0.300000012 completion:0.0];
    }

    else
    {
      v13[2](v13);
      v15[2](v15, 1);
    }

    v17 = [(CKCoreChatController *)self collectionViewController];
    [v17 setEditing:v5 animated:v4];

    v18 = [(CKChatController *)self navigationController];
    [v18 setToolbarHidden:v5 ^ 1 animated:v4];
  }
}

uint64_t __40__CKChatController_setEditing_animated___block_invoke(uint64_t result)
{
  if ((*(result + 40) & 1) == 0)
  {
    return [*(result + 32) _updateEntryViewFrameIfNeeded:0];
  }

  return result;
}

void __40__CKChatController_setEditing_animated___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) addOrRemoveEntryViewIfNeeded];
  [*(a1 + 32) updateScrollGeometryWithoutAnimationForReason:@"CollectionViewEditModeChanged"];
  v2 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
  [*(a1 + 40) enforceTranscriptScrollIntentWithAnimationProperties:v2];
}

- (id)editingToolbarItems
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v4 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:16 target:self action:sel__deleteSelectedMessages_];
  [v4 setTag:0];
  v5 = +[CKUIBehavior sharedBehaviors];
  v6 = [v5 forwardImage];

  v7 = [objc_alloc(MEMORY[0x1E69DC708]) initWithImage:v6 style:0 target:self action:sel__editingToolbarSelectedForward_];
  [v7 setTag:1];
  [v3 addObject:v4];
  v8 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:5 target:0 action:0];
  v9 = [(CKCoreChatController *)self chat];
  v10 = [v9 chatItems];
  v11 = [v10 arrayByApplyingSelector:sel__item];

  if (!IMSSMSReportSpamShouldShowReportMessagesForItems())
  {
    goto LABEL_11;
  }

  v12 = [(CKCoreChatController *)self chat];
  v13 = [v12 messageCount];

  if (v13 <= 1)
  {
    v15 = [(CKCoreChatController *)self chat];
    v16 = [v15 messageCount];

    if (v16 != 1)
    {
      v18 = 0;
      goto LABEL_8;
    }

    v14 = @"REPORT_SPAM_SMS_BUTTON_TITLE_SINGULAR";
  }

  else
  {
    v14 = @"REPORT_SPAM_SMS_BUTTON_TITLE_MULTIPLE";
  }

  v17 = CKFrameworkBundle();
  v18 = [v17 localizedStringForKey:v14 value:&stru_1F04268F8 table:@"ChatKit"];

LABEL_8:
  if ([v18 length])
  {
    v19 = [objc_alloc(MEMORY[0x1E69DC708]) initWithTitle:v18 style:0 target:self action:sel__reportSelectedMessages_];
    [v19 setTag:2];
    v20 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:5 target:0 action:0];
    [v3 addObject:v20];
    [v3 addObject:v19];
  }

LABEL_11:
  [v3 addObject:v8];
  if ([(CKChatController *)self allowDebugItems])
  {
    v21 = [(CKChatController *)self internalBarButtonItems];
    [v3 addObjectsFromArray:v21];
  }

  [v3 addObject:v7];

  return v3;
}

- (void)_updateToolbarItems
{
  v40 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self isEditing])
  {
    v3 = [(CKCoreChatController *)self collectionViewController];
    v4 = [v3 selectedItems];
    v5 = [v3 chatItems];
    v6 = [v5 objectsAtIndexes:v4];

    if ([v4 count])
    {
      v7 = [(CKCoreChatController *)self conversation];
      v8 = [v7 isUserDeletable];
    }

    else
    {
      v8 = 0;
    }

    v34 = 0u;
    v35 = 0u;
    v9 = [v4 count] != 0;
    v36 = 0u;
    v37 = 0u;
    v10 = v6;
    v11 = [v10 countByEnumeratingWithState:&v34 objects:v39 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v35;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v35 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v34 + 1) + 8 * i);
          v8 = [v15 canDelete] & v8;
          v9 = [v15 canForward] & v9;
        }

        v12 = [v10 countByEnumeratingWithState:&v34 objects:v39 count:16];
      }

      while (v12);
    }

    v16 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v17 = [v16 isTranscriptSharingEnabled];

    if (v17)
    {
      v18 = [(CKCoreChatController *)self conversation];
      v19 = [v18 chat];
      v20 = [v19 isStewieSharingChat];

      v8 = (v20 ^ 1) & v8;
    }

    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    v21 = [(CKChatController *)self toolbarItems];
    v22 = [v21 countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v22)
    {
      v23 = v22;
      v24 = *v31;
      do
      {
        for (j = 0; j != v23; ++j)
        {
          if (*v31 != v24)
          {
            objc_enumerationMutation(v21);
          }

          v26 = *(*(&v30 + 1) + 8 * j);
          v27 = [v26 tag];
          v28 = v8;
          if (v27)
          {
            v29 = [v26 tag];
            v28 = v9;
            if (v29 != 1)
            {
              if ([v26 tag] != 2)
              {
                continue;
              }

              v28 = 1;
            }
          }

          [v26 setEnabled:v28];
        }

        v23 = [v21 countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v23);
    }
  }
}

- (void)_deleteSelectedMessages:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self collectionViewController];
  [v5 deleteSelectedChatItems:v4];
}

- (void)_editingToolbarSelectedForward:(id)a3
{
  v40 = *MEMORY[0x1E69E9840];
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 selectedItems];
  v6 = [v4 chatItems];
  v7 = [v6 objectsAtIndexes:v5];

  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  v8 = v7;
  v9 = [v8 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v35;
    v12 = 1;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v35 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v12 &= [*(*(&v34 + 1) + 8 * i) canForward];
      }

      v10 = [v8 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v10);
  }

  else
  {
    v12 = 1;
  }

  if ([v5 count] && v12)
  {
    v14 = objc_opt_new();
    v29 = v4;
    v15 = [v4 chatItems];
    v16 = [v15 objectsAtIndexes:v5];

    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    v17 = v16;
    v18 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v31;
      do
      {
        for (j = 0; j != v19; ++j)
        {
          if (*v31 != v20)
          {
            objc_enumerationMutation(v17);
          }

          v22 = *(*(&v30 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v23 = [v22 aggregateChatItems];
            [v14 addObjectsFromArray:v23];
          }

          else
          {
            [v14 addObject:v22];
          }
        }

        v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v19);
    }

    v24 = [(CKChatController *)self entryView];
    v25 = [v24 shouldShowSubject];
    v26 = [(CKChatController *)self chatInputTranscriptIdentifier];
    v27 = [CKComposition compositionForMessageParts:v14 preserveSubject:v25 contextIdentifier:v26];

    [(CKChatController *)self setEditing:0 animated:1];
    v28 = [(CKCoreChatController *)self delegate];
    [v28 chatController:self forwardComposition:v27];

    v4 = v29;
  }
}

- (void)_reportSelectedMessages:(id)a3
{
  v10 = [(CKCoreChatController *)self collectionViewController];
  v4 = [v10 selectedItems];
  v5 = [v10 chatItems];
  v6 = [v5 objectsAtIndexes:v4];
  v7 = [v6 arrayByApplyingSelector:sel_IMChatItem];

  v8 = [(CKCoreChatController *)self chat];
  v9 = [v8 messagesToReportAsSpamFromChatItems:v7];

  [(CKChatController *)self showSMSReportSpamExtensionControllerForMessages:v9];
}

- (void)_editCancelButtonPressed
{
  if ([(CKChatController *)self isEditing])
  {

    [(CKChatController *)self setEditing:0 animated:1];
  }

  else if (CKIsRunningInMessagesTranscriptExtension())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {

      [(CKChatController *)self dismissViewControllerAnimated:1 completion:0];
    }
  }
}

- (void)_doneButtonPressed
{
  v3 = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if (v4)
  {
    v5 = [(CKCoreChatController *)self delegate];
    [v5 doneButtonPressedForChatController:self];
  }
}

- (void)recoverableDeleteConversation
{
  v17[1] = *MEMORY[0x1E69E9840];
  v3 = [(CKCoreChatController *)self conversation];
  v17[0] = v3;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:1];

  v5 = [MEMORY[0x1E695DF00] now];
  v11 = MEMORY[0x1E69E9820];
  v12 = 3221225472;
  v13 = __49__CKChatController_recoverableDeleteConversation__block_invoke;
  v14 = &unk_1E72EB8D0;
  v15 = v4;
  v16 = v5;
  v6 = v5;
  v7 = v4;
  v8 = _Block_copy(&v11);
  v9 = objc_opt_new();
  [v9 setPresentationViewController:{self, v11, v12, v13, v14}];
  [v9 setTargetConversations:v7];
  [v9 setAlertsCompletedBlock:v8];
  v10 = [[CKConversationConfirmationAlertsController alloc] initWithConfiguration:v9];
  [(CKConversationConfirmationAlertsController *)v10 presentRecoverableConversationDeletionConfirmations];
}

void __49__CKChatController_recoverableDeleteConversation__block_invoke(uint64_t a1)
{
  v2 = +[CKConversationList sharedConversationList];
  [v2 recoverableDeleteForConversations:*(a1 + 32) deleteDate:*(a1 + 40) synchronousQuery:0 completionHandler:0];
}

- (void)layoutFooterView
{
  v39 = [(CKChatController *)self footerViewController];
  v3 = [(CKChatController *)self view];
  [v3 safeAreaInsets];
  v5 = v4;
  v7 = v6;
  v9 = v8;

  v10 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v11 = [v10 isEntryViewRefreshEnabled];

  if (v11)
  {
    v12 = v5 + v9;
    v13 = [(CKChatController *)self view];
    [v13 bounds];
    v15 = v14;
    v17 = v16;

    v18 = [v39 view];
    [v18 sizeThatFits:{v15 - v12, v17}];
    v20 = v19;
    v22 = v21;

    v23 = [(CKChatController *)self view];
    [v23 bounds];
    v24 = CGRectGetWidth(v41) - v12;

    v25 = v5 + (v24 - v20) * 0.5;
    v26 = [(CKChatController *)self view];
    [v26 bounds];
    v27 = CGRectGetHeight(v42) - v22 - v7;
  }

  else
  {
    v25 = *MEMORY[0x1E695F058];
    v28 = [(CKChatController *)self view];
    [v28 bounds];
    v30 = v29;
    v32 = v31;

    v33 = [v39 view];
    [v33 sizeThatFits:{v30, v32}];
    v20 = v34;
    v22 = v35;

    v26 = [(CKChatController *)self view];
    [v26 bounds];
    v27 = CGRectGetHeight(v43) - v22;
  }

  v36 = [v39 view];
  [v36 setFrame:{v25, v27, v20, v22}];

  v37 = [(CKChatController *)self view];
  v38 = [v39 view];
  [v37 bringSubviewToFront:v38];
}

- (void)removeFooterView
{
  footerViewController = self->_footerViewController;
  if (footerViewController)
  {
    [(UIViewController *)footerViewController willMoveToParentViewController:0];
    v4 = [(UIViewController *)self->_footerViewController view];
    [v4 removeFromSuperview];

    [(UIViewController *)self->_footerViewController removeFromParentViewController];
    v5 = self->_footerViewController;
    self->_footerViewController = 0;
  }
}

- (void)reloadFooterViewControllerIfNecessary
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isTranscriptSharingEnabled];

  if (v4)
  {
    v5 = [(CKCoreChatController *)self conversation];
    v6 = [v5 chat];
    v7 = [v6 isStewieSharingChat];

    if (v7)
    {
      if (!self->_footerViewController)
      {
        v8 = [CKTranscriptSharingFooterViewController alloc];
        v9 = [(CKCoreChatController *)self conversation];
        v10 = [(CKTranscriptSharingFooterViewController *)v8 initWithConversation:v9];

        footerViewController = self->_footerViewController;
        self->_footerViewController = v10;
        v12 = v10;

        [(CKChatController *)self addChildViewController:self->_footerViewController];
        v13 = [(CKChatController *)self view];
        v14 = [(UIViewController *)self->_footerViewController view];
        [v13 addSubview:v14];

        [(UIViewController *)self->_footerViewController didMoveToParentViewController:self];
        v15 = [(CKChatController *)self collectionView];
        [(UIViewController *)v12 configurePocketInteractionForScrollView:v15];

        [(CKChatController *)self layoutFooterView];
      }
    }

    else
    {

      [(CKChatController *)self removeFooterView];
    }
  }
}

- (void)setUpStyleForDarkEffect
{
  v3 = [(CKChatController *)self inlineReplyController];

  if (!v3)
  {
    [(CKChatController *)self setNeedsDarkEffectStyleCleanUp:1];
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *v15 = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Setting style for dark effect", v15, 2u);
      }
    }

    v5 = +[CKUIBehavior sharedBehaviors];
    v6 = [v5 isAppStripInKeyboard];

    if (v6)
    {
      v7 = [(CKChatController *)self entryView];
      [v7 setStyle:1];
    }

    if (CKIsAppCardsEnabled())
    {
      v8 = [(CKChatController *)self entryView];
      [v8 setStyle:1];

      v9 = [(CKChatController *)self _viewControllerForModalPresentation];
      if (v9 != self)
      {
        v10 = [(CKChatController *)self traitCollection];
        v11 = [v10 userInterfaceStyle] == 2;

        [(CKChatController *)v9 setShowingDarkEffect:1 isInDarkMode:v11];
      }
    }

    v12 = [(CKCoreChatController *)self conversation];
    v13 = [v12 isBusinessConversation];

    if ((v13 & 1) == 0)
    {
      v14 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
      [v14 setDarkEffectStyle:1];
    }

    [(CKChatController *)self _setBannersHidden:1];
  }
}

- (void)cleanUpDarkEffectStyle
{
  v3 = [(CKChatController *)self inlineReplyController];

  if (!v3)
  {
    if ([(CKChatController *)self needsDarkEffectStyleCleanUp])
    {
      if (CKIsAppCardsEnabled())
      {
        v4 = [(CKChatController *)self _viewControllerForModalPresentation];
        if (v4 != self && (objc_opt_respondsToSelector() & 1) != 0)
        {
          v5 = [(CKChatController *)self traitCollection];
          v6 = [v5 userInterfaceStyle] == 2;

          [(CKChatController *)v4 setShowingDarkEffect:0 isInDarkMode:v6];
        }
      }

      v12 = [(CKChatController *)self traitCollection];
      v7 = [(CKChatController *)self entryView];
      [v7 setEntryViewTraitCollection:v12 resetStyle:1];

      [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView setEntryViewTraitCollection:v12];
      v8 = [(CKCoreChatController *)self conversation];
      v9 = [v8 isBusinessConversation];

      if ((v9 & 1) == 0)
      {
        v10 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
        [v10 setDarkEffectStyle:0];
      }

      [(CKChatController *)self _setBannersHidden:0];
      [(CKChatController *)self setNeedsDarkEffectStyleCleanUp:0];
    }

    else if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Skipping dark effect style clean up", buf, 2u);
      }
    }
  }
}

- (void)_setBannersHidden:(BOOL)a3
{
  v3 = a3;
  v5 = [(CKChatController *)self nicknameBanner];
  [v5 setHidden:v3];

  v6 = [(CKChatController *)self groupPhotoUpdateBanner];
  [v6 setHidden:v3];

  v7 = [(CKChatController *)self suggestionBannerView];
  [v7 setHidden:v3];
}

- (id)_defaultTranscriptNavBarAppearance
{
  v9[1] = *MEMORY[0x1E69E9840];
  v2 = [(CKChatController *)self navigationItem];
  v3 = [v2 standardAppearance];

  if (CKIsRunningInMacCatalyst())
  {
    v4 = [MEMORY[0x1E69DC730] effectWithStyle:4];
    v5 = +[CKUIBehavior sharedBehaviors];
    v6 = [v5 chatNavbarColor];
    [v3 setBackgroundColor:v6];
  }

  else
  {
    v4 = [MEMORY[0x1E69DC730] effectWithStyle:8];
  }

  v9[0] = v4;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
  [v3 setBackgroundEffects:v7];

  return v3;
}

- (void)updateStyleForCurrentEffect
{
  OUTLINED_FUNCTION_9();
  v0 = objc_opt_class();
  v1 = NSStringFromClass(v0);
  OUTLINED_FUNCTION_10();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0x16u);
}

- (BOOL)transcriptCollectionViewController:(id)a3 shouldSetupFullscreenEffectUI:(id)a4
{
  v18[1] = *MEMORY[0x1E69E9840];
  if ([a4 effectIsDark])
  {
    if (objc_opt_respondsToSelector())
    {
      [(CKChatController *)self setUpStyleForDarkEffect];
    }

    else
    {
      v6 = IMLogHandleForCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        [CKChatController updateStyleForCurrentEffect];
      }

      v7 = [MEMORY[0x1E69A60F0] sharedInstance];
      v8 = [v7 isInternalInstall];

      if (v8)
      {
        v9 = MEMORY[0x1E696AEC0];
        v10 = objc_opt_class();
        v11 = NSStringFromClass(v10);
        v12 = [v9 stringWithFormat:@"<%p> ChatController (class: %@) does not respond to -setUpStyleForDarkEffect. Please file a radar.", self, v11];

        v13 = MEMORY[0x1E696ABC0];
        v17 = *MEMORY[0x1E696A278];
        v18[0] = v12;
        v14 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v18 forKeys:&v17 count:1];
        v15 = [v13 errorWithDomain:@"CKChatControllerErrorDomain" code:0 userInfo:v14];

        v16 = [MEMORY[0x1E69A8168] sharedInstance];
        [v16 forceAutoBugCaptureWithSubType:@"Unexpected method list for CKChatController" errorPayload:v15];
      }
    }
  }

  else
  {
    [(CKChatController *)self cleanUpDarkEffectStyle];
  }

  return 1;
}

- (id)transcriptCollectionViewControllerOuterEffectPresentingView:(id)a3
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  v3 = [(CKCoreChatController *)&v5 transcriptCollectionViewControllerOuterEffectPresentingView:a3];

  return v3;
}

- (id)_interfaceActionsForChatItem:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E695DF70] array];
  objc_initWeak(location, self);
  v6 = &off_190DCE000;
  if (-[CKCoreChatController wantsReplyButton](self, "wantsReplyButton") && [v4 canInlineReply])
  {
    v7 = MEMORY[0x1E69DCB08];
    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"INLINE_REPLY_ORB_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    v107[0] = MEMORY[0x1E69E9820];
    v107[1] = 3221225472;
    v107[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke;
    v107[3] = &unk_1E72EDFE0;
    objc_copyWeak(&v108, location);
    v10 = [v7 actionWithTitle:v9 type:0 handler:v107];

    [v10 setEnabled:{objc_msgSend(v4, "canInlineReply")}];
    [v5 addObject:v10];

    objc_destroyWeak(&v108);
  }

  if ([v4 canRetract])
  {
    if ([v4 scheduleType] == 2)
    {
      v11 = CKFrameworkBundle();
      [v11 localizedStringForKey:@"DELETE_SCHEDULED_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
    }

    else
    {
      v11 = CKFrameworkBundle();
      [v11 localizedStringForKey:@"UNDO_SEND_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
    }
    v12 = ;

    v13 = MEMORY[0x1E69DCB08];
    v104[0] = MEMORY[0x1E69E9820];
    v104[1] = 3221225472;
    v104[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_2;
    v104[3] = &unk_1E72EE008;
    objc_copyWeak(&v106, location);
    v105 = v4;
    v14 = [v13 actionWithTitle:v12 type:0 handler:v104];
    [v5 addObject:v14];

    objc_destroyWeak(&v106);
  }

  if ([v4 canCopy])
  {
    v15 = MEMORY[0x1E69DCB08];
    v16 = CKFrameworkBundle();
    v17 = [v16 localizedStringForKey:@"COPY" value:&stru_1F04268F8 table:@"ChatKit"];
    v102[0] = MEMORY[0x1E69E9820];
    v102[1] = 3221225472;
    v102[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_3;
    v102[3] = &unk_1E72EE030;
    v103 = v4;
    v18 = [v15 actionWithTitle:v17 type:0 handler:v102];
    [v5 addObject:v18];
  }

  if ([v4 syndicationBehavior] == 1)
  {
    v19 = [(CKCoreChatController *)self chat];
    v20 = [v19 isBusinessChat];

    if ((v20 & 1) == 0)
    {
      if ([v4 isHighlighted])
      {
        v21 = CKFrameworkBundle();
        [v21 localizedStringForKey:@"REMOVE_PIN_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
      }

      else
      {
        v21 = CKFrameworkBundle();
        [v21 localizedStringForKey:@"ADD_PIN_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
      }
      v22 = ;

      v23 = MEMORY[0x1E69DCB08];
      v99[0] = MEMORY[0x1E69E9820];
      v99[1] = 3221225472;
      v99[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_4;
      v99[3] = &unk_1E72EE058;
      v100 = v4;
      objc_copyWeak(&v101, location);
      v24 = [v23 actionWithTitle:v22 type:0 handler:v99];
      [v5 addObject:v24];

      objc_destroyWeak(&v101);
    }
  }

  if ([CKTranslatorUtilities shouldShowTranslateMenuOption:v4])
  {
    v25 = [CKTranslationMenu translateActionForChatItem:v4 forController:self];
    [v5 addObject:v25];
  }

  if ([v4 canExport])
  {
    v26 = CKFrameworkBundle();
    v27 = [v26 localizedStringForKey:@"BALLOON_EXPORT_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v28 = CKFrameworkBundle();
      v29 = [v28 localizedStringForKey:@"AUDIO_MESSAGE_SAVE" value:&stru_1F04268F8 table:@"ChatKit"];

      v27 = v29;
    }

    v30 = MEMORY[0x1E69DCB08];
    v97[0] = MEMORY[0x1E69E9820];
    v97[1] = 3221225472;
    v97[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_5;
    v97[3] = &unk_1E72EE030;
    v98 = v4;
    v31 = [v30 actionWithTitle:v27 type:0 handler:v97];
    [v5 addObject:v31];
  }

  if ([v4 canSendAsTextMessage])
  {
    v32 = [v4 IMChatItem];
    v33 = [v4 IMChatItem];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if ((isKindOfClass & 1) == 0)
    {
LABEL_34:

      goto LABEL_35;
    }

    v35 = [v32 message];
    WeakRetained = objc_loadWeakRetained(location);
    v37 = [WeakRetained conversation];

    if (-[CKChatController _smsEnabled](self, "_smsEnabled") && [v35 isFromMe] && (objc_msgSend(v35, "isDelivered") & 1) == 0)
    {
      v38 = [v35 error];
      if (!v38)
      {
        if ([v37 isGroupConversation])
        {
          goto LABEL_33;
        }

        v39 = objc_loadWeakRetained(location);
        v40 = [v39 collectionViewController];
        v81 = [v40 chatItems];

        v41 = [v35 guid];
        v42 = [v81 __ck_indexesOfPartsOfMessageWithGUID:v41];
        v43 = [v81 objectsAtIndexes:v42];

        v44 = [(CKCoreChatController *)self textInputContextIdentifier];
        v45 = [CKComposition compositionForMessageParts:v43 preserveSubject:1 contextIdentifier:v44];

        LOBYTE(v44) = [v37 canSendComposition:v45 error:0];
        v6 = &off_190DCE000;
        if ((v44 & 1) == 0)
        {
          goto LABEL_33;
        }

        v38 = [v37 fallbackSendString];
        v46 = MEMORY[0x1E69DCB08];
        v92[0] = MEMORY[0x1E69E9820];
        v92[1] = 3221225472;
        v92[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_1488;
        v92[3] = &unk_1E72EE080;
        v93 = v35;
        v94 = v37;
        objc_copyWeak(&v96, location);
        v95 = self;
        v47 = [v46 actionWithTitle:v38 type:0 handler:v92];
        [v5 addObject:v47];

        objc_destroyWeak(&v96);
        v6 = &off_190DCE000;
      }
    }

LABEL_33:

    goto LABEL_34;
  }

LABEL_35:
  v48 = [v4 visibleAssociatedMessageChatItems];

  if (v48)
  {
    v49 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v50 = [v4 visibleAssociatedMessageChatItems];
    v90[0] = MEMORY[0x1E69E9820];
    v51 = *(v6 + 189);
    v90[1] = v51;
    v90[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_2_1494;
    v90[3] = &unk_1E72EC100;
    v52 = v49;
    v91 = v52;
    [v50 enumerateObjectsUsingBlock:v90];

    if ([v52 count])
    {
      v53 = MEMORY[0x1E69DCB08];
      v54 = CKFrameworkBundle();
      v55 = [v54 localizedStringForKey:@"BALLOON_STICKER_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v88[0] = MEMORY[0x1E69E9820];
      v88[1] = v51;
      v88[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_3_1498;
      v88[3] = &unk_1E72EE0A8;
      v88[4] = self;
      v89 = v52;
      v56 = [v53 actionWithTitle:v55 type:0 handler:v88];
      [v5 addObject:v56];
    }
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v57 = [v4 mediaObject];
    v58 = [v57 transfer];
    v59 = [v58 attributionInfo];

    if (v59)
    {
      v60 = [v59 __ck_localizedAppNameForTranscriptAttribution];
      if (v60)
      {
        v82 = self;
        v61 = v5;
        v62 = v6;
        v63 = MEMORY[0x1E69DCB08];
        v64 = MEMORY[0x1E696AEC0];
        v65 = CKFrameworkBundle();
        v66 = [v65 localizedStringForKey:@"MEDIA_ATTRIBUTION_TITLE_FORMAT" value:&stru_1F04268F8 table:@"ChatKit"];
        v67 = [v64 stringWithFormat:v66, v60];

        v68 = [MEMORY[0x1E69DC668] sharedApplication];
        v69 = [v68 userInterfaceLayoutDirection];

        if (v69 == 1)
        {
          v70 = @"\u200F";
        }

        else
        {
          v70 = @"\u200E";
        }

        v71 = [(__CFString *)v70 stringByAppendingString:v67];

        v85[0] = MEMORY[0x1E69E9820];
        v85[1] = *(v62 + 189);
        v85[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_4_1502;
        v85[3] = &unk_1E72EE058;
        v86 = v59;
        objc_copyWeak(&v87, location);
        v72 = [v63 actionWithTitle:v71 type:0 handler:v85];
        [v61 addObject:v72];

        objc_destroyWeak(&v87);
        v6 = v62;
        v5 = v61;
        self = v82;
      }
    }
  }

  v73 = objc_loadWeakRetained(location);
  v74 = [v73 conversation];
  if ([v74 isPending])
  {
  }

  else
  {
    v75 = [(CKCoreChatController *)self isInline];

    if (!v75)
    {
      v76 = MEMORY[0x1E69DCB08];
      v77 = CKFrameworkBundle();
      v78 = [v77 localizedStringForKey:@"BALLOON_MORE_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v83[0] = MEMORY[0x1E69E9820];
      v83[1] = *(v6 + 189);
      v83[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_6_1507;
      v83[3] = &unk_1E72EE0A8;
      v83[4] = self;
      v84 = v4;
      v79 = [v76 actionWithTitle:v78 type:0 handler:v83];
      [v5 addObject:v79];
    }
  }

  objc_destroyWeak(location);

  return v5;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setWantsInlineOverlay:1];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_2(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionRetractIsTappedForChatItem:*(a1 + 32)];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_3(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = [MEMORY[0x1E69DCD50] generalPasteboard];
  v6 = [*(a1 + 32) pasteboardItemProviders];
  [v5 setItemProviders:v6];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_4(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = [*(a1 + 32) isHighlighted];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v7 = [WeakRetained conversation];
  v8 = [v7 chat];
  v9 = [*(a1 + 32) IMChatItem];
  v10 = [v9 guid];
  v12 = [*(a1 + 32) messagePartRange];
  if (v5)
  {
    v13 = 0;
  }

  else
  {
    v13 = 4;
  }

  [v8 sendSyndicationAction:v13 forMessagePartGUID:v10 syndicatedMessagePartRange:{v12, v11}];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_5(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v4 = *(a1 + 32);
  v5 = [v4 mediaObject];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [v4 sender];
    v7 = MEMORY[0x1E696AEC0];
    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"AUDIO_MESSAGE_VOICE_MEMO_LABEL" value:&stru_1F04268F8 table:@"ChatKit"];
    if ([v6 hasName])
    {
      [v6 name];
    }

    else
    {
      [v6 displayID];
    }
    v11 = ;
    v12 = [v7 stringWithFormat:v9, v11];

    v13 = [MEMORY[0x1E69DC668] sharedApplication];
    v14 = [v13 userInterfaceLayoutDirection];

    if (v14 == 1)
    {
      v15 = @"\u200F";
    }

    else
    {
      v15 = @"\u200E";
    }

    v10 = [(__CFString *)v15 stringByAppendingString:v12];
  }

  else
  {
    v10 = 0;
  }

  v16 = objc_alloc_init(CKMediaObjectExportManager);
  [(CKMediaObjectExportManager *)v16 setMetricsSource:*MEMORY[0x1E69A7628]];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_6;
  v18[3] = &unk_1E72EC088;
  v19 = v5;
  v17 = v5;
  [(CKMediaObjectExportManager *)v16 exportMediaObject:v17 withFileName:v10 completion:v18];
  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_6(uint64_t a1, int a2, void *a3)
{
  v14 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = IMOSLoggingEnabled();
  if (a2)
  {
    if (v6)
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = *(a1 + 32);
        v10 = 138412290;
        v11 = v8;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Successfully exported media object: %@", &v10, 0xCu);
      }

LABEL_9:
    }
  }

  else if (v6)
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = *(a1 + 32);
      v10 = 138412546;
      v11 = v5;
      v12 = 2112;
      v13 = v9;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Error exporting media object. error: %@, mediaObject: %@", &v10, 0x16u);
    }

    goto LABEL_9;
  }
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_1488(uint64_t a1, void *a2, _BYTE *a3)
{
  v23 = *MEMORY[0x1E69E9840];
  v5 = a2;
  if (IMOSLoggingEnabled())
  {
    CKLogCStringForType(29);
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [*(a1 + 32) guid];
      v8 = *(a1 + 40);
      *buf = 138412546;
      v20 = v7;
      v21 = 2112;
      v22 = v8;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Manually downgrading message with GUID {%@} -- conversation:%@", buf, 0x16u);
    }
  }

  if (os_log_shim_legacy_logging_enabled() && _CKShouldLogExternal())
  {
    v14 = [*(a1 + 32) guid];
    v15 = *(a1 + 40);
    _CKLogExternal();
  }

  v9 = [*(a1 + 40) chat];
  [v9 downgradeMessage:*(a1 + 32) manualDowngrade:1];

  v10 = [*(a1 + 32) __ck_downgradedMessage];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v12 = [WeakRetained collectionViewController];
  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_1492;
  v16[3] = &unk_1E72EB880;
  v16[4] = *(a1 + 48);
  v17 = v10;
  v18 = *(a1 + 40);
  v13 = v10;
  [v12 updateTranscript:v16 animated:0 completion:0];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_1492(void *a1)
{
  v1 = a1[4];
  v2 = a1[5];
  v3 = a1[6];
  v4 = [MEMORY[0x1E69A5C90] smsService];
  [v1 sendMessage:v2 forConversation:v3 onService:v4 newComposition:0];
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_2_1494(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [*(a1 + 32) addObject:v3];
  }
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_3_1498(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = [*(a1 + 32) fullScreenBalloonViewController];
  [v5 presentStickerDetailControllerWithStickers:*(a1 + 40)];

  *a3 = 0;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_4_1502(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = dispatch_time(0, 200000000);
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_5_1503;
  v6[3] = &unk_1E72EE0D0;
  v7 = *(a1 + 32);
  objc_copyWeak(&v8, (a1 + 40));
  dispatch_after(v5, MEMORY[0x1E69E96A0], v6);
  *a3 = 1;
  objc_destroyWeak(&v8);
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_5_1503(uint64_t a1)
{
  v6 = [*(a1 + 32) objectForKey:*MEMORY[0x1E69A6FA0]];
  v2 = [*(a1 + 32) objectForKey:*MEMORY[0x1E69A6FB0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = [MEMORY[0x1E696AD98] numberWithLongLong:{objc_msgSend(v6, "longLongValue")}];

    v6 = v3;
  }

  v4 = [*(a1 + 32) objectForKey:*MEMORY[0x1E69A6FF0]];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained _presentBrowserOrAppStoreForAdamID:v6 url:v4 identifier:v2];
}

uint64_t __49__CKChatController__interfaceActionsForChatItem___block_invoke_6_1507(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  result = [*(a1 + 32) actionMoreIsTappedForChatItem:*(a1 + 40)];
  *a3 = 1;
  return result;
}

- (void)actionCancelIsTappedForChatItem:(id)a3
{
  v7 = a3;
  objc_opt_class();
  v4 = v7;
  if (objc_opt_isKindOfClass())
  {
    v4 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v7];
  }

  v5 = [(CKCoreChatController *)self conversation];
  v6 = [v4 IMChatItem];
  [v5 retractMessagePart:v6];
}

- (void)actionRetractIsTappedForChatItem:(id)a3
{
  v4 = a3;
  objc_opt_class();
  v5 = v4;
  if (objc_opt_isKindOfClass())
  {
    v5 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v4];
  }

  v6 = dispatch_time(0, 500000000);
  v13 = MEMORY[0x1E69E9820];
  v14 = 3221225472;
  v15 = __53__CKChatController_actionRetractIsTappedForChatItem___block_invoke;
  v16 = &unk_1E72EB8D0;
  v17 = self;
  v18 = v5;
  v7 = v5;
  dispatch_after(v6, MEMORY[0x1E69E96A0], &v13);
  v8 = [MEMORY[0x1E69A8168] sharedInstance];
  [v8 trackEvent:*MEMORY[0x1E69A76D0]];

  v9 = [(CKChatController *)self tipManager];
  [v9 undoOrEditMessageUsed];

  v10 = MEMORY[0x1E696AD98];
  [v4 timeIntervalSinceMessageSent];
  v11 = [v10 numberWithDouble:?];
  v12 = [MEMORY[0x1E69A8168] sharedInstance];
  [v12 trackEvent:*MEMORY[0x1E69A76D8] withStatistic:v11];
}

void __53__CKChatController_actionRetractIsTappedForChatItem___block_invoke(uint64_t a1)
{
  v11 = *MEMORY[0x1E69E9840];
  v2 = (a1 + 32);
  v3 = [*(a1 + 32) collectionViewController];
  if ([*v2 transcriptCollectionViewControllerPlaybackForOutgoingEffectsIsAllowed:v3])
  {
    v4 = [v3 impactEffectManager];
    [v4 playUndoSendAnimationForChatItem:*(a1 + 40)];
  }

  v5 = [*(a1 + 32) conversation];
  v6 = [*(a1 + 40) IMChatItem];
  [v5 retractMessagePart:v6];
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = 136315138;
      v10 = "[CKChatController actionRetractIsTappedForChatItem:]_block_invoke";
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "%s requesting purge of default snapshot", &v9, 0xCu);
    }
  }

  v8 = objc_alloc_init(MEMORY[0x1E69D41A0]);
  [v8 deleteSnapshotsForApplicationIdentifier:@"com.apple.MobileSMS"];
  [v8 invalidate];
}

- (void)actionMoreIsTappedForChatItem:(id)a3
{
  v10 = a3;
  [(CKChatController *)self setEditing:1 animated:1];
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 selectionManager];
  [v5 removeAllSelectedMessageGuids];

  if (v10)
  {
    v6 = [(CKCoreChatController *)self collectionViewController];
    [v6 selectChatItem:v10];
  }

  [(CKChatController *)self _updateToolbarItems];
  v7 = [(CKChatController *)self view];
  v8 = [v7 window];
  v9 = [v8 firstResponder];
  [v9 reloadInputViews];
}

- (CGRect)fullScreenBalloonViewController:(id)a3 stickerBoundsForChatItem:(id)a4
{
  v5 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 cellForAssociatedChatItem:v5];

  v8 = [v7 associatedItemView];
  if (v8)
  {
    v9 = [(CKChatController *)self view];
    [v8 bounds];
    v11 = v10;
    v13 = v12;
    v15 = v14;
    v17 = v16;
    v18 = [v8 superview];
    [v9 convertRect:v18 fromView:{v11, v13, v15, v17}];
    v20 = v19;
    v22 = v21;
    v24 = v23;
    v26 = v25;
  }

  else
  {
    v20 = *MEMORY[0x1E695F058];
    v22 = *(MEMORY[0x1E695F058] + 8);
    v24 = *(MEMORY[0x1E695F058] + 16);
    v26 = *(MEMORY[0x1E695F058] + 24);
  }

  v27 = v20;
  v28 = v22;
  v29 = v24;
  v30 = v26;
  result.size.height = v30;
  result.size.width = v29;
  result.origin.y = v28;
  result.origin.x = v27;
  return result;
}

- (CGPoint)fullScreenBalloonViewController:(id)a3 stickerCenterForChatItem:(id)a4
{
  v5 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 cellForAssociatedChatItem:v5];

  v8 = [v7 associatedItemView];
  if (v8)
  {
    v9 = [(CKChatController *)self view];
    [v8 center];
    v11 = v10;
    v13 = v12;
    v14 = [v8 superview];
    [v9 convertPoint:v14 fromView:{v11, v13}];
    v16 = v15;
    v18 = v17;
  }

  else
  {
    v16 = *MEMORY[0x1E695EFF8];
    v18 = *(MEMORY[0x1E695EFF8] + 8);
  }

  v19 = v16;
  v20 = v18;
  result.y = v20;
  result.x = v19;
  return result;
}

- (BOOL)shouldShowFullScreenAcknowledgmentPickerForChatItem:(id)a3
{
  v4 = a3;
  if ([(CKChatController *)self isShowingOscarChat]|| [(CKChatController *)self isEditingMessage])
  {
    v5 = 0;
  }

  else
  {
    v7.receiver = self;
    v7.super_class = CKChatController;
    v5 = [(CKCoreChatController *)&v7 shouldShowFullScreenAcknowledgmentPickerForChatItem:v4];
  }

  return v5;
}

- (BOOL)shouldShowTapbackPickerForChatItem:(id)a3
{
  v4 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass() & 1) != 0 && (v5 = MEMORY[0x1E69A5B80], v6 = v4, [v5 sharedInstance], v7 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v6, "transferGUID"), v8 = objc_claimAutoreleasedReturnValue(), v6, objc_msgSend(v7, "transferForGUID:", v8), v9 = objc_claimAutoreleasedReturnValue(), v8, v7, LOBYTE(v7) = +[CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:](CKCommSafetyHelper, "shouldDisableTranscriptCapabilitiesForFileTransfer:", v9), v9, (v7))
  {
    v10 = 0;
  }

  else
  {
    v12.receiver = self;
    v12.super_class = CKChatController;
    v10 = [(CKCoreChatController *)&v12 shouldShowTapbackPickerForChatItem:v4];
  }

  return v10;
}

- (BOOL)shouldDismissKeyboardWhenShowingFullScreenAcknowledgmentPickerForBalloonChatItem:(id)a3
{
  [(CKChatController *)self fullScreenBalloonViewController:0 balloonFrameForChatItem:a3];
  MaxY = CGRectGetMaxY(v19);
  v5 = [(CKChatController *)self view];
  [v5 bounds];
  Height = CGRectGetHeight(v20);
  v7 = [(CKChatController *)self collectionView];
  [v7 contentInset];
  v9 = v8;

  v10 = [(CKCoreChatController *)self isCollapsed];
  v11 = +[CKUIBehavior sharedBehaviors];
  v12 = [v11 canPresentOverKeyboard];
  if (MaxY <= Height - v9)
  {
    v13 = v12;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13 & v10;
  if ((v13 & v10 & 1) == 0)
  {
    v15 = [(CKChatController *)self entryView];
    v16 = [v15 contentView];
    v17 = [v16 isActive];

    if (v17)
    {
      [(CKChatController *)self setEntryViewWasActiveOnContextMenuPresentation:1];
      [(CKChatController *)self setTargetFirstResponder:1];
    }
  }

  return v14 ^ 1;
}

- (void)fullScreenBalloonViewController:(id)a3 didTapToSaveSticker:(id)a4
{
  v5 = a4;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __72__CKChatController_fullScreenBalloonViewController_didTapToSaveSticker___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = v5;
  v6 = v5;
  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v7];
}

- (void)fullScreenBalloonViewControllerWillTransitionToKeyboardInput:(id)a3
{
  [(CKChatController *)self hideExistingKeyboardSnapshot];

  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
}

- (void)fullScreenBalloonViewControllerWillReturnToSuggestionsPicker:(id)a3
{
  [(CKChatController *)self revealExistingKeyboardSnapshot];

  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
}

- (BOOL)showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:(id)a3
{
  v4 = a3;
  if (!v4)
  {
LABEL_8:
    LOBYTE(v7) = 0;
    goto LABEL_14;
  }

  if (![(CKCoreChatController *)self isInline])
  {
    v5 = [(CKChatController *)self inlineReplyController];

    if (v5)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Not presenting tapback picker: inlineReplyController active", buf, 2u);
        }
      }

      goto LABEL_8;
    }
  }

  v8 = [(CKCoreChatController *)self collectionViewController];
  v9 = [v8 chatItems];
  v10 = [v9 objectAtIndex:{objc_msgSend(v4, "item")}];

  v13.receiver = self;
  v13.super_class = CKChatController;
  v7 = [(CKCoreChatController *)&v13 showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:v4];
  if (v7)
  {
    if ([(CKChatController *)self shouldDismissKeyboardWhenShowingFullScreenAcknowledgmentPickerForBalloonChatItem:v10])
    {
      v11 = [(CKCoreChatController *)self inputController];
      [v11 dismissBrowserViewController];

      [(CKChatController *)self dismissKeyboard];
    }

    [(CKChatController *)self hideAssociatedCellsForChatItem:v10];
    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }

LABEL_14:
  return v7;
}

- (void)hideAssociatedCellsForChatItem:(id)a3
{
  v21 = *MEMORY[0x1E69E9840];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  obj = [a3 visibleAssociatedMessageChatItems];
  v3 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v17;
    do
    {
      v6 = 0;
      do
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v16 + 1) + 8 * v6);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        objc_opt_class();
        v9 = objc_opt_isKindOfClass();
        v10 = +[CKUIBehavior sharedBehaviors];
        v11 = [v10 longPressHidesAssociatedAcknowledgments];

        if (isKindOfClass & 1) != 0 || (v9 & v11)
        {
          v12 = [(CKCoreChatController *)self collectionViewController];
          v13 = [v12 cellForAssociatedChatItem:v7];

          [v13 performHide:0];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v4);
  }
}

- (void)setIgnoresAutomaticScrollsTowardBottom:(BOOL)a3
{
  v3 = a3;
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 collectionView];

  [v5 setIgnoresAutomaticScrollsTowardBottom:v3];
}

- (void)showSMSReportSpamExtensionControllerForMessages:(id)a3
{
  v48 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = MEMORY[0x193AF5EC0](@"ILMessageCommunication", @"IdentityLookup");
  v33 = MEMORY[0x193AF5EC0](@"ILMessageClassificationRequest", @"IdentityLookup");
  v6 = MEMORY[0x193AF5EC0](@"ILClassificationUIExtensionHostViewController", @"IdentityLookupUI");
  if (v5 && v33 && v6)
  {
    v29 = v6;
    v32 = v4;
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "SMS Report Spam classes exist -- going to display controller", buf, 2u);
      }
    }

    v31 = self;
    v8 = [(CKCoreChatController *)self chat];
    v9 = [v8 participants];
    v36 = [v9 firstObject];

    v35 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v43 = 0u;
    v44 = 0u;
    v41 = 0u;
    v42 = 0u;
    obj = v32;
    v10 = [obj countByEnumeratingWithState:&v41 objects:v47 count:16];
    if (v10)
    {
      v11 = *v42;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v42 != v11)
          {
            objc_enumerationMutation(obj);
          }

          v13 = *(*(&v41 + 1) + 8 * i);
          if ([v13 hasDataDetectorResults])
          {
            v14 = [v13 body];
            v15 = [v14 string];
          }

          else
          {
            v15 = [v13 plainBody];
          }

          v16 = [v5 alloc];
          v17 = [v36 ID];
          v18 = [v17 im_stripCategoryLabel];
          v19 = [v13 time];
          v20 = [v16 initWithSender:v18 dateReceived:v19 messageBody:v15];

          [v35 addObject:v20];
        }

        v10 = [obj countByEnumeratingWithState:&v41 objects:v47 count:16];
      }

      while (v10);
    }

    if (IMOSLoggingEnabled())
    {
      v21 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v46 = v35;
        _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Going to report the following communications: %@", buf, 0xCu);
      }
    }

    v22 = [[v33 alloc] initWithMessageCommunications:v35];
    v23 = [v30 alloc];
    v24 = [v36 ID];
    v25 = [v36 countryCode];
    v26 = [v23 initUnactivatedVCWithRequest:v22 sender:v24 isoCountryCode:v25];

    [v26 setDelegate:v31];
    v37[0] = MEMORY[0x1E69E9820];
    v37[1] = 3221225472;
    v37[2] = __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke;
    v37[3] = &unk_1E72EE0F8;
    v38 = v22;
    v39 = v31;
    v40 = v26;
    v27 = v26;
    v28 = v22;
    [v27 activateExtensionWithCompletion:v37];

    v4 = v32;
  }
}

void __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke(uint64_t a1)
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke_2;
  block[3] = &unk_1E72EB880;
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v4 = *(a1 + 48);
  v6 = v2;
  v7 = v3;
  v8 = v4;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

uint64_t __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke_2(uint64_t a1)
{
  v7 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v5 = 138412290;
      v6 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Going to display spam extension for message classification request: %@", &v5, 0xCu);
    }
  }

  return [*(a1 + 40) presentViewController:*(a1 + 48) animated:1 completion:0];
}

- (CGRect)fullScreenBalloonViewController:(id)a3 balloonFrameForChatItem:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v6 balloonFrameForChatItem:v7];
LABEL_10:
    v16 = v8;
    v18 = v9;
    v20 = v10;
    v22 = v11;
    goto LABEL_11;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = [(CKCoreChatController *)self collectionViewController];
    v13 = [v12 balloonViewForChatItem:v7];

    v14 = [(CKChatController *)self view];
    [v13 ck_identityTransformFrameInView:v14];
    v16 = v15;
    v18 = v17;
    v20 = v19;
    v22 = v21;
  }

  else
  {
    v23 = [v6 supplementaryLayoutChatItem];
    if (!v23 || (v24 = v23, [v6 supplementaryLayoutChatItem], v25 = objc_claimAutoreleasedReturnValue(), objc_opt_class(), isKindOfClass = objc_opt_isKindOfClass(), v25, v24, (isKindOfClass & 1) == 0))
    {
      v39.receiver = self;
      v39.super_class = CKChatController;
      [(CKCoreChatController *)&v39 fullScreenBalloonViewController:v6 balloonFrameForChatItem:v7];
      goto LABEL_10;
    }

    v27 = [(CKChatController *)self view];
    v13 = [v27 coordinateSpace];

    v28 = [(CKCoreChatController *)self collectionViewController];
    v29 = [v6 supplementaryLayoutChatItem];
    v30 = [v28 balloonViewForChatItem:v29];

    [v30 currentAssetFrameInCoordinateSpace:v13];
    v16 = v31;
    v18 = v32;
    v20 = v33;
    v22 = v34;
  }

LABEL_11:
  v35 = v16;
  v36 = v18;
  v37 = v20;
  v38 = v22;
  result.size.height = v38;
  result.size.width = v37;
  result.origin.y = v36;
  result.origin.x = v35;
  return result;
}

- (void)fullScreenBalloonViewControllerHandleDismissTap:(id)a3
{
  v4 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerHandleDismissTap:v4];
  }

  else
  {
    v5.receiver = self;
    v5.super_class = CKChatController;
    [(CKCoreChatController *)&v5 fullScreenBalloonViewControllerHandleDismissTap:v4];
  }
}

- (BOOL)fullScreenBalloonViewControllerShouldShowReplyButton:(id)a3
{
  v4 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    v5 = [(CKChatController *)self photosGridFullScreenBalloonViewControllerShouldShowReplyButton:v4];
  }

  else
  {
    v8.receiver = self;
    v8.super_class = CKChatController;
    v5 = [(CKCoreChatController *)&v8 fullScreenBalloonViewControllerShouldShowReplyButton:v4];
  }

  v6 = v5;

  return v6;
}

- (BOOL)fullScreenBalloonViewControllerShouldShowHightlightButton:(id)a3 forChatItem:(id)a4
{
  v6 = a4;
  v7 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    v8 = [(CKChatController *)self photosGridFullScreenBalloonViewControllerShouldShowHightlightButton:v7 forChatItem:v6];
  }

  else
  {
    v11.receiver = self;
    v11.super_class = CKChatController;
    v8 = [(CKCoreChatController *)&v11 fullScreenBalloonViewControllerShouldShowHightlightButton:v7 forChatItem:v6];
  }

  v9 = v8;

  return v9;
}

- (void)fullScreenBalloonViewController:(id)a3 sendMessageHighlight:(BOOL)a4 forChatItem:(id)a5
{
  v5 = a4;
  v8 = a5;
  v9 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v9 sendMessageHighlight:v5 forChatItem:v8];
  }

  else
  {
    v10.receiver = self;
    v10.super_class = CKChatController;
    [(CKCoreChatController *)&v10 fullScreenBalloonViewController:v9 sendMessageHighlight:v5 forChatItem:v8];
  }
}

- (void)fullScreenBalloonViewController:(id)a3 willAppearAnimated:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v6 didAppearAnimated:v4];
  }

  else
  {
    v7 = [(CKChatController *)self collectionView];
    [v7 setTranscriptScrollIntent:8];

    v10.receiver = self;
    v10.super_class = CKChatController;
    [(CKCoreChatController *)&v10 fullScreenBalloonViewController:v6 willAppearAnimated:v4];
    v8 = [v6 displayConfiguration];
    v9 = [v8 type];

    if (v9 == 1)
    {
      [(CKChatController *)self requestShowKeyboardSnapshotForReason:16];
    }

    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }
}

- (void)fullScreenBalloonViewController:(id)a3 didAppearAnimated:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v6 didAppearAnimated:v4];
  }

  else
  {
    v7 = [(CKCoreChatController *)self collectionViewController];
    v8 = [v7 collectionView];
    [v8 contentOffset];
    self->_startingScrollOffset.x = v9;
    self->_startingScrollOffset.y = v10;

    v11.receiver = self;
    v11.super_class = CKChatController;
    [(CKCoreChatController *)&v11 fullScreenBalloonViewController:v6 didAppearAnimated:v4];
    [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationFullScreenBubble"];
    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }
}

- (double)_currentScrollDelta
{
  v3 = [(CKCoreChatController *)self collectionViewController];
  v4 = [v3 collectionView];
  [v4 contentOffset];
  v6 = v5;

  return self->_startingScrollOffset.y - v6;
}

- (void)fullScreenBalloonViewController:(id)a3 willDisappearWithSendAnimation:(BOOL)a4 duration:(double)a5
{
  v6 = a4;
  v8 = a3;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v8 willDisappearWithSendAnimation:v6];
  }

  else
  {
    v18.receiver = self;
    v18.super_class = CKChatController;
    [(CKCoreChatController *)&v18 fullScreenBalloonViewController:v8 willDisappearWithSendAnimation:v6 duration:a5];
    [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:0];
    [(CKChatController *)self _currentScrollDelta];
    if (v9 != 0.0)
    {
      v10 = v9;
      v11 = [(CKCoreChatController *)self fullScreenBalloonViewController];
      v12 = [v11 displayConfiguration];
      v13 = [v12 type];

      if (v13 == 2)
      {
        v14 = [v8 chatItem];
        [(CKChatController *)self updateChatItemBalloonViewAndStickerViews:v14 hidden:1];
      }

      v15 = [v8 displayConfiguration];
      v16 = [v15 shouldReturnToStartingScrollOffset];

      if (v16)
      {
        v17 = [(CKCoreChatController *)self collectionViewController];
        [v17 verticallyScrollTranscriptByAmount:1 animated:0 duration:v10 completion:a5];
      }
    }
  }
}

- (void)fullScreenBalloonViewController:(id)a3 sendMessageAcknowledgment:(int64_t)a4 forChatItem:(id)a5
{
  v8 = a3;
  v9 = a5;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v8 sendMessageAcknowledgment:a4 forChatItem:v9];
  }

  else
  {
    v10 = [(CKChatController *)self revealAnimationGroup];
    dispatch_group_enter(v10);

    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke;
    v11[3] = &unk_1E72EBC38;
    v11[4] = self;
    v13 = a4;
    v12 = v9;
    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:1 completion:v11];
  }
}

void __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) revealAnimationGroup];
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke_2;
  block[3] = &unk_1E72EBC38;
  v4 = *(a1 + 40);
  v3 = *(a1 + 48);
  block[4] = *(a1 + 32);
  v8 = v3;
  v7 = v4;
  dispatch_group_notify(v2, MEMORY[0x1E69E96A0], block);

  v5 = [*(a1 + 32) revealAnimationGroup];
  dispatch_group_leave(v5);
}

void __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) chat];
  [v2 sendMessageAcknowledgment:*(a1 + 48) forChatItem:*(a1 + 40)];

  if (([*(a1 + 32) showingInStandAloneWindow] & 1) == 0)
  {
    v3 = [*(a1 + 32) delegate];
    if (v3)
    {
      v4 = v3;
      v5 = [*(a1 + 32) delegate];
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      if (isKindOfClass)
      {
        v9 = [*(a1 + 32) delegate];
        v7 = [v9 conversationListController];
        v8 = [*(a1 + 32) conversation];
        [v7 updateConversationListForMessageSentToConversation:v8];
      }
    }
  }
}

- (void)fullScreenBalloonViewControllerDidDisappear:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v6 = [v5 isExpressiveTextEnabled];

  if (v6)
  {
    v7 = [(CKCoreChatController *)self collectionViewController];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [v7 setTextEffectCoordinatorPaused:0 reason:@"fullscreen view controller did disappear"];
    }
  }

  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerDidDisappear:v4];
  }

  else
  {
    v8 = [v4 supplementaryLayoutChatItem];
    v9 = v8;
    if (v8)
    {
      v10 = v8;
    }

    else
    {
      v10 = [v4 chatItem];
    }

    v11 = v10;

    v12 = [(CKCoreChatController *)self collectionViewController];
    v13 = [v4 chatItem];
    v14 = [v12 balloonViewForChatItem:v13];

    [v14 setInvisibleInkEffectPaused:0];
    if (([v4 willPresentInlineReplies] & 1) == 0)
    {
      v15 = [v4 chatItem];
      [(CKChatController *)self updateChatItemBalloonViewAndStickerViews:v15 hidden:0];
    }

    v20 = MEMORY[0x1E69E9820];
    v21 = 3221225472;
    v22 = __64__CKChatController_fullScreenBalloonViewControllerDidDisappear___block_invoke;
    v23 = &unk_1E72EB8D0;
    v16 = v4;
    v24 = v16;
    v25 = self;
    v17 = _Block_copy(&v20);
    v18 = [v16 displayConfiguration];
    v19 = [v18 shouldShowStickers];

    [(CKChatController *)self showAssociatedCellsForChatItem:v11 animated:v19 ^ 1u completion:v17];
  }
}

void __64__CKChatController_fullScreenBalloonViewControllerDidDisappear___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v11.receiver = *(a1 + 40);
  v11.super_class = CKChatController;
  objc_msgSendSuper2(&v11, sel_fullScreenBalloonViewControllerDidDisappear_, v2);
  [*(a1 + 40) endHoldingAutorotationForKey:@"CKAutorotationFullScreenBubble"];
  if ([*(a1 + 40) targetFirstResponder] == 1)
  {
    [*(a1 + 40) becomeFirstResponder];
  }

  v3 = [*(a1 + 40) collectionViewController];
  [v3 updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];

  v4 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
  v5 = [*(a1 + 40) collectionViewController];
  v6 = [v5 collectionView];
  [v6 enforceTranscriptScrollIntentWithAnimationProperties:v4];

  [*(a1 + 40) setRevealAnimationGroup:0];
  if (([*(a1 + 40) isAnimatingStickerReaction] & 1) == 0)
  {
    v7 = [*(a1 + 40) inputController];
    [v7 endStickerReactionSession];

    [*(a1 + 40) updateActiveEntryViewPositioningGuide];
  }

  v8 = [*(a1 + 32) view];
  [v8 removeFromSuperview];

  v9 = [*(a1 + 32) displayConfiguration];
  v10 = [v9 type];

  if (v10 == 1)
  {
    [*(a1 + 40) requestDismissKeyboardSnapshotForReason:16];
  }
}

- (void)showAssociatedCellsForChatItem:(id)a3 animated:(BOOL)a4 completion:(id)a5
{
  v30 = a4;
  v44 = *MEMORY[0x1E69E9840];
  v6 = a3;
  block = a5;
  v27 = v6;
  v28 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  obj = [v6 visibleAssociatedMessageChatItems];
  v7 = [obj countByEnumeratingWithState:&v38 objects:v43 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v39;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v39 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v38 + 1) + 8 * i);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        objc_opt_class();
        v13 = objc_opt_isKindOfClass();
        v14 = +[CKUIBehavior sharedBehaviors];
        v15 = [v14 longPressHidesAssociatedAcknowledgments];

        if (isKindOfClass & 1) != 0 || (v13 & v15)
        {
          [v28 addObject:v11];
        }
      }

      v8 = [obj countByEnumeratingWithState:&v38 objects:v43 count:16];
    }

    while (v8);
  }

  v16 = [(CKChatController *)self revealAnimationGroup];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v17 = v28;
  v18 = [v17 countByEnumeratingWithState:&v34 objects:v42 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v35;
    do
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v35 != v20)
        {
          objc_enumerationMutation(v17);
        }

        v22 = *(*(&v34 + 1) + 8 * j);
        v23 = [(CKCoreChatController *)self collectionViewController];
        v24 = [v23 cellForAssociatedChatItem:v22];

        if (v24)
        {
          dispatch_group_enter(v16);
          aBlock[0] = MEMORY[0x1E69E9820];
          aBlock[1] = 3221225472;
          aBlock[2] = __71__CKChatController_showAssociatedCellsForChatItem_animated_completion___block_invoke;
          aBlock[3] = &unk_1E72EBA18;
          v33 = v16;
          v25 = _Block_copy(aBlock);
          [v24 performRevealAnimated:v30 completion:v25];
        }
      }

      v19 = [v17 countByEnumeratingWithState:&v34 objects:v42 count:16];
    }

    while (v19);
  }

  if (block)
  {
    dispatch_group_notify(v16, MEMORY[0x1E69E96A0], block);
  }
}

- (OS_dispatch_group)revealAnimationGroup
{
  revealAnimationGroup = self->_revealAnimationGroup;
  if (!revealAnimationGroup)
  {
    v4 = dispatch_group_create();
    v5 = self->_revealAnimationGroup;
    self->_revealAnimationGroup = v4;

    revealAnimationGroup = self->_revealAnimationGroup;
  }

  return revealAnimationGroup;
}

- (void)fullScreenBalloonViewController:(id)a3 verticallyScrollTranscriptByAmount:(double)a4 animated:(BOOL)a5 duration:(double)a6 completion:(id)a7
{
  v9 = a5;
  v14 = a3;
  v12 = a7;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v14 verticallyScrollTranscriptByAmount:v9 animated:v12 duration:a4 completion:a6];
  }

  else
  {
    v13 = [(CKCoreChatController *)self collectionViewController];
    [v13 verticallyScrollTranscriptByAmount:v9 animated:v12 duration:a4 completion:a6];
  }
}

- (void)fullScreenBalloonViewController:(id)a3 stickerPackTappedWithAdamID:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v6 stickerPackTappedWithAdamID:v7];
  }

  else
  {
    v8 = dispatch_time(0, 300000000);
    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __80__CKChatController_fullScreenBalloonViewController_stickerPackTappedWithAdamID___block_invoke;
    v9[3] = &unk_1E72EB8D0;
    v9[4] = self;
    v10 = v7;
    dispatch_after(v8, MEMORY[0x1E69E96A0], v9);
  }
}

- (void)_presentAppStoreForAdamID:(id)a3
{
  v10 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v8 = 138412290;
      v9 = v4;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "present app store for ID: %@", &v8, 0xCu);
    }
  }

  v6 = [(CKCoreChatController *)self inputController];
  [v6 presentAppStoreForAdamID:v4];

  v7 = [MEMORY[0x1E69A8168] sharedInstance];
  [v7 trackEvent:*MEMORY[0x1E69A7300]];
}

- (void)fullScreenBalloonViewController:(id)a3 deleteStickerWithTransferGUID:(id)a4
{
  v7 = a3;
  v6 = a4;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v7 deleteStickerWithTransferGUID:v6];
  }

  else
  {
    [(CKChatController *)self _deleteStickerWithTransferGUID:v6];
  }
}

- (void)_deleteStickerWithTransferGUID:(id)a3
{
  v11[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self chat];
  v11[0] = v4;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:1];
  [v5 deleteTransfers:v6];

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = 136315138;
      v10 = "[CKChatController _deleteStickerWithTransferGUID:]";
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "%s requesting purge of default snapshot", &v9, 0xCu);
    }
  }

  v8 = objc_alloc_init(MEMORY[0x1E69D41A0]);
  [v8 deleteSnapshotsForApplicationIdentifier:@"com.apple.MobileSMS"];
  [v8 invalidate];
}

- (void)fullScreenBalloonViewController:(id)a3 replyButtonPressedForChatItem:(id)a4
{
  v6 = a3;
  v7 = a4;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:v6 replyButtonPressedForChatItem:v7];
  }

  else
  {
    v8[0] = MEMORY[0x1E69E9820];
    v8[1] = 3221225472;
    v8[2] = __82__CKChatController_fullScreenBalloonViewController_replyButtonPressedForChatItem___block_invoke;
    v8[3] = &unk_1E72EB8D0;
    v9 = v7;
    v10 = self;
    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v8];
  }
}

uint64_t __82__CKChatController_fullScreenBalloonViewController_replyButtonPressedForChatItem___block_invoke(uint64_t result)
{
  v1 = *(result + 32);
  if (v1)
  {
    return [*(result + 40) showInlineReplyControllerForChatItem:v1 presentKeyboard:1];
  }

  return result;
}

- (id)chatItems
{
  v2 = [(CKCoreChatController *)self chat];
  v3 = [v2 chatItems];

  return v3;
}

- (BOOL)_anyTranscriptBannerIsVisible
{
  v3 = [(CKChatController *)self transcriptSharingBannerSuggestion];

  if (v3)
  {
    return 1;
  }

  v5 = [(CKChatController *)self nicknameBanner];
  if (v5)
  {
    v4 = 1;
  }

  else
  {
    v6 = [(CKChatController *)self groupPhotoUpdateBanner];
    if (v6)
    {
      v4 = 1;
    }

    else
    {
      v7 = [(CKChatController *)self notificationBannerView];
      if (v7)
      {
        v4 = 1;
      }

      else
      {
        v8 = [(CKChatController *)self suggestionBannerView];
        if (v8)
        {
          v4 = 1;
        }

        else
        {
          v9 = [(CKChatController *)self acceptedContactBanner];
          v4 = v9 != 0;
        }
      }
    }
  }

  return v4;
}

- (BOOL)_wantsToShowCollaborationNotices
{
  v2 = [(CKChatController *)self collaborationNoticeSuggestions];
  v3 = [v2 count] != 0;

  return v3;
}

- (void)suggestionPresenterWantsToShowBanner:(id)a3
{
  v9 = a3;
  v4 = [(CKChatController *)self suggestionBannerView];
  v5 = v4 == 0;

  v6 = [v9 banner];
  [(CKChatController *)self setSuggestionBannerView:v6];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = [(CKChatController *)self transitionContext];
    v5 = [v7 isParentChatControllerShowingBanner] ^ 1;
  }

  v8 = [v9 banner];
  [(CKChatController *)self addSuggestionBanner:v8 animated:v5];
}

- (void)suggestionPresenterWantsToHideBanner:(id)a3
{
  v12 = a3;
  v4 = [(CKChatController *)self standardSuggestionPresenter];
  if (v4 == v12)
  {
  }

  else
  {
    v5 = [(CKChatController *)self foundInSuggestionPresenter];

    v6 = v12;
    if (v5 != v12)
    {
      goto LABEL_11;
    }
  }

  v7 = [(CKChatController *)self standardSuggestionPresenter];
  if (v7 == v12)
  {
    [(CKChatController *)self foundInSuggestionPresenter];
  }

  else
  {
    [(CKChatController *)self standardSuggestionPresenter];
  }
  v8 = ;

  v9 = [v12 banner];
  [(CKChatController *)self removeSuggestionsBanner:v9 animated:1];

  [(CKChatController *)self setSuggestionBannerView:0];
  if ([v8 wantsToShowBanner])
  {
    v10 = [v12 banner];
    [(CKChatController *)self setSuggestionBannerView:v10];

    v11 = [v8 banner];
    [(CKChatController *)self addSuggestionBanner:v11 animated:1];
  }

  v6 = v12;
LABEL_11:
}

- (void)removeSuggestionsBanner:(id)a3 animated:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  if (v4)
  {
    v7 = [(CKChatController *)self view];
    [v7 layoutIfNeeded];

    v8 = MEMORY[0x1E69DD250];
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __53__CKChatController_removeSuggestionsBanner_animated___block_invoke;
    v14[3] = &unk_1E72EB8D0;
    v15 = v6;
    v16 = self;
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __53__CKChatController_removeSuggestionsBanner_animated___block_invoke_2;
    v11[3] = &unk_1E72ECCA8;
    v12 = v15;
    v13 = self;
    [v8 animateWithDuration:v14 animations:v11 completion:0.3];
  }

  else
  {
    v9 = [(CKChatController *)self suggestionBannerTopConstraint];
    [v6 removeConstraint:v9];

    suggestionBannerTopConstraint = self->_suggestionBannerTopConstraint;
    self->_suggestionBannerTopConstraint = 0;

    [v6 removeFromSuperview];
    [(CKChatController *)self _updateTranscriptOffsetForBannerView];
  }
}

uint64_t __53__CKChatController_removeSuggestionsBanner_animated___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setAlpha:0.0];
  [*(a1 + 40) suggestionBannerHeight];
  v3 = -v2;
  v4 = [*(a1 + 40) suggestionBannerTopConstraint];
  [v4 setConstant:v3];

  [*(a1 + 32) setNeedsUpdateConstraints];
  v5 = [*(a1 + 40) view];
  [v5 layoutIfNeeded];

  v6 = *(a1 + 40);

  return [v6 _updateTranscriptOffsetForBannerView];
}

uint64_t __53__CKChatController_removeSuggestionsBanner_animated___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) suggestionBannerTopConstraint];
  [v2 removeConstraint:v3];

  v4 = *(a1 + 40);
  v5 = *(v4 + 1632);
  *(v4 + 1632) = 0;

  v6 = *(a1 + 32);

  return [v6 removeFromSuperview];
}

- (void)addSuggestionBanner:(id)a3 animated:(BOOL)a4
{
  v4 = a4;
  v53 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = [(CKCoreChatController *)self chat];
  v8 = [v7 canSuggestRecipientContact];

  if (v6)
  {
    if (v8)
    {
      v9 = CFPreferencesCopyAppValue(@"AppCanShowSiriSuggestionsBlacklist", @"com.apple.suggestions");
      v10 = [v9 containsObject:@"com.apple.MobileSMS"];

      if ((v10 & 1) == 0)
      {
        v11 = [v6 superview];

        if (v11)
        {
          [(CKChatController *)self removeSuggestionsBanner:v6 animated:0];
        }

        [v6 intrinsicContentSize];
        self->_suggestionBannerHeight = v12;
        [v6 setTranslatesAutoresizingMaskIntoConstraints:0];
        v13 = [(CKChatController *)self view];
        [v13 addSubview:v6];

        v14 = [v6 superview];
        v15 = [(CKChatController *)self view];

        if (v14 == v15)
        {
          v19 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
          v20 = [v19 isModernSplitViewControllerEnabled];

          v21 = [v6 leadingAnchor];
          v22 = [(CKChatController *)self view];
          v23 = v22;
          if (v20)
          {
            v24 = [v22 layoutMarginsGuide];
            v25 = [v24 leadingAnchor];
            v26 = [v21 constraintEqualToAnchor:v25];
            [v26 setActive:1];

            v27 = [v6 trailingAnchor];
            v28 = [(CKChatController *)self view];
            v29 = [v28 layoutMarginsGuide];
            v30 = [v29 trailingAnchor];
            v31 = [v27 constraintEqualToAnchor:v30];
            [v31 setActive:1];
          }

          else
          {
            v32 = [v22 leadingAnchor];
            v33 = [v21 constraintEqualToAnchor:v32];
            [v33 setActive:1];

            v27 = [v6 trailingAnchor];
            v28 = [(CKChatController *)self view];
            v29 = [v28 trailingAnchor];
            v30 = [v27 constraintEqualToAnchor:v29];
            [v30 setActive:1];
          }

          v34 = [v6 topAnchor];
          v35 = [(CKChatController *)self view];
          v36 = [v35 safeAreaLayoutGuide];
          v37 = [v36 topAnchor];
          if (v4)
          {
            [(CKChatController *)self suggestionBannerHeight];
            v39 = [v34 constraintEqualToAnchor:v37 constant:-v38];
            [(CKChatController *)self setSuggestionBannerTopConstraint:v39];

            v40 = [(CKChatController *)self suggestionBannerTopConstraint];
            [v40 setActive:1];

            [v6 setAlpha:0.0];
            v41 = [(CKChatController *)self view];
            [v41 layoutIfNeeded];

            v42 = MEMORY[0x1E69DD250];
            v46[0] = MEMORY[0x1E69E9820];
            v46[1] = 3221225472;
            v46[2] = __49__CKChatController_addSuggestionBanner_animated___block_invoke;
            v46[3] = &unk_1E72EB8D0;
            v47 = v6;
            v48 = self;
            [v42 animateWithDuration:v46 animations:0.3];
          }

          else
          {
            v43 = [v34 constraintEqualToAnchor:v37 constant:0.0];
            [(CKChatController *)self setSuggestionBannerTopConstraint:v43];

            v44 = [(CKChatController *)self suggestionBannerTopConstraint];
            [v44 setActive:1];

            v45 = [(CKChatController *)self view];
            [v45 layoutIfNeeded];

            [(CKChatController *)self _updateTranscriptOffsetForBannerView];
          }
        }

        else
        {
          if (IMOSLoggingEnabled())
          {
            v16 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              v17 = [v6 superview];
              v18 = [(CKChatController *)self view];
              *buf = 138412546;
              v50 = v17;
              v51 = 2112;
              v52 = v18;
              _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "CKChatController - Not displaying suggestions banner, banner superview: %@ isn't the chat controller's view: %@ after insertion", buf, 0x16u);
            }
          }

          [v6 removeFromSuperview];
        }
      }
    }
  }
}

uint64_t __49__CKChatController_addSuggestionBanner_animated___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setAlpha:1.0];
  v2 = [*(a1 + 40) suggestionBannerTopConstraint];
  [v2 setConstant:0.0];

  [*(a1 + 32) setNeedsUpdateConstraints];
  v3 = [*(a1 + 40) view];
  [v3 layoutIfNeeded];

  v4 = *(a1 + 40);

  return [v4 _updateTranscriptOffsetForBannerView];
}

- (void)_updateTranscriptOffsetForBannerView
{
  v3 = [(CKChatController *)self collectionView];
  [v3 contentOffset];
  v5 = v4;
  v7 = v6;

  v8 = [(CKChatController *)self collectionView];
  [v8 contentInset];
  v10 = v9;

  [(CKScrollViewController *)self updateScrollGeometryWithInheritedAnimationForReason:@"BannerChangedSize"];
  v11 = [(CKChatController *)self collectionView];
  [v11 contentInset];
  v13 = v12;

  v14 = [(CKChatController *)self collectionView];
  [v14 setContentOffset:{v5, v7 - (v13 - v10)}];
}

- (void)_handleChatItemDidChange:(id)a3
{
  v4 = a3;
  [(CKChatController *)self removeLoadingIndicatorCoverIfNeeded];
  [(CKChatController *)self checkSuggestionsForBanner];
  v5 = [v4 userInfo];
  v6 = [v5 objectForKey:*MEMORY[0x1E69A5750]];

  v7 = [MEMORY[0x1E695DF70] array];
  v8 = [(CKCoreChatController *)self conversation];
  v9 = [v8 chat];
  v10 = [v9 chatItems];
  v11 = [v10 count];

  v21 = 0;
  v22 = &v21;
  v23 = 0x2020000000;
  v24 = 0;
  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __45__CKChatController__handleChatItemDidChange___block_invoke;
  v16[3] = &unk_1E72EE120;
  v20 = v11;
  v16[4] = self;
  v12 = v7;
  v17 = v12;
  v19 = &v21;
  v13 = v6;
  v18 = v13;
  [v13 enumerateIndexesUsingBlock:v16];
  if (*(v22 + 24) == 1 && [(CKChatController *)self shouldShowBanners])
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __45__CKChatController__handleChatItemDidChange___block_invoke_1559;
    v15[3] = &unk_1E72ED570;
    v15[4] = self;
    [(CKChatController *)self showTranslationTips:v15];
  }

  v14 = [(CKCoreChatController *)self inputController];
  [v14 notifyBrowserViewControllerOfMatchingNewMessages:v12];

  _Block_object_dispose(&v21, 8);
}

void __45__CKChatController__handleChatItemDidChange___block_invoke(uint64_t a1, unint64_t a2)
{
  v17 = *MEMORY[0x1E69E9840];
  if (*(a1 + 64) <= a2)
  {
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = [*(a1 + 48) count];
        v9 = *(a1 + 64);
        v11 = 134218496;
        v12 = a2;
        v13 = 2048;
        v14 = v8;
        v15 = 2048;
        v16 = v9;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Index out of bounds for inserted index %ld. Inserted Index count = %ld, chat items count = %ld", &v11, 0x20u);
      }
    }
  }

  else
  {
    v4 = [*(a1 + 32) conversation];
    v5 = [v4 chat];
    v6 = [v5 chatItems];
    v10 = [v6 objectAtIndex:a2];

    [*(a1 + 40) addObject:v10];
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && ([v10 isFromMe] & 1) == 0)
    {
      *(*(*(a1 + 56) + 8) + 24) = 1;
    }
  }
}

void __45__CKChatController__handleChatItemDidChange___block_invoke_1559(uint64_t a1, int a2, void *a3)
{
  if (a2)
  {
    v4 = *(a1 + 32);
    v5 = a3;
    v6 = [v4 tipManager];
    [v6 setTranslationDelegate:v4];

    v7 = [*(a1 + 32) tipManager];
    v9 = [v7 presentTranslationTipWithLanguages:v5];

    v8 = [v5 objectForKeyedSubscript:v9];

    [*(a1 + 32) prewarmTranslationCacheForMessagesWithGUIDs:v8 sourceLanguage:v9];
  }
}

- (void)_handleKeyTransparencyShouldRefresh:(id)a3
{
  v3 = [(CKCoreChatController *)self chat];
  [v3 refreshServiceForSending];
}

- (void)_handleInterworkingStateChanged:(id)a3
{
  v3 = [(CKChatController *)self entryView];
  [v3 updateEntryView];
}

- (BOOL)_hasExistingBannerMatchingStyle:(unint64_t)a3 withNicknames:(id)a4
{
  v16 = *MEMORY[0x1E69E9840];
  v6 = a4;
  v7 = [(CKChatController *)self nicknameBanner];
  v8 = v7;
  if (v7 && [v7 style] == a3 && (objc_msgSend(v8, "nicknameUpdates"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v9, "isEqualToArray:", v6), v9, v10))
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v14 = 138412290;
        v15 = v8;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Asked to represent identical banner, bailing! Existing is %@", &v14, 0xCu);
      }
    }

    v12 = 1;
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

- (void)clearHandlesFromScrutiny:(id)a3
{
  v15 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v11;
    do
    {
      v7 = 0;
      do
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v10 + 1) + 8 * v7);
        v9 = [MEMORY[0x1E69A5C10] sharedInstance];
        [v9 clearHandleFromScrutiny:v8];

        ++v7;
      }

      while (v5 != v7);
      v5 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v5);
  }
}

- (BOOL)shouldNotShowGroupBanners
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 groupIdentityUpdateHandleID];
  if (v4)
  {
    v5 = [(CKCoreChatController *)self conversation];
    if ([v5 isGroupConversation] && !-[CKCoreChatController isInline](self, "isInline"))
    {
      v7 = +[CKUIBehavior sharedBehaviors];
      if ([v7 areBannersSupported])
      {
        v6 = IMIsRunningInScreenshotTesting_IsolatedTranscriptUI();
      }

      else
      {
        v6 = 1;
      }
    }

    else
    {
      v6 = 1;
    }
  }

  else
  {
    v6 = 1;
  }

  return v6;
}

- (BOOL)showGroupBannerUpdateIfNeeded
{
  v15[1] = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self shouldNotShowGroupBanners])
  {
    return 0;
  }

  v3 = [(CKChatController *)self groupPhotoUpdateBanner];

  if (!v3)
  {
    v4 = [(CKCoreChatController *)self conversation];
    v5 = [v4 conversationVisualIdentityWithKeys:MEMORY[0x1E695E0F0] requestedNumberOfContactsToFetch:0];
    v6 = [v5 groupPhoto];
    v7 = [v5 groupName];
    if ([v4 shouldDisplayGroupIdentity] && objc_msgSend(v4, "shouldShowGroupPhotoUpdateBanner") && objc_msgSend(v4, "shouldShowGroupNameUpdateBanner"))
    {
      if ([v6 length] && objc_msgSend(v7, "length"))
      {
        v8 = 3;
      }

      else if ([v6 length])
      {
        v8 = 8;
      }

      else if ([v7 length])
      {
        v8 = 7;
      }

      else
      {
        v8 = 6;
      }
    }

    else if ([v4 shouldDisplayGroupIdentity] && objc_msgSend(v4, "shouldShowGroupNameUpdateBanner") && objc_msgSend(v7, "length"))
    {
      v8 = 1;
    }

    else if ([v4 shouldDisplayGroupIdentity] && objc_msgSend(v4, "shouldShowGroupNameUpdateBanner") && !objc_msgSend(v7, "length"))
    {
      v8 = 5;
    }

    else if ([v4 shouldDisplayGroupIdentity] && objc_msgSend(v4, "shouldShowGroupPhotoUpdateBanner") && objc_msgSend(v6, "length"))
    {
      v8 = 2;
    }

    else
    {
      if (![v4 shouldDisplayGroupIdentity] || !objc_msgSend(v4, "shouldShowGroupPhotoUpdateBanner") || v6)
      {
        goto LABEL_32;
      }

      v8 = 4;
    }

    v9 = [(CKChatController *)self createGroupUpdateWithType:v8];
    if (v9)
    {
      v10 = v9;
      v15[0] = v9;
      v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
      v12 = [(CKChatController *)self createBannerForGroupUpdates:v11];
      [(CKChatController *)self setGroupPhotoUpdateBanner:v12];
    }

LABEL_32:
  }

  v13 = [(CKChatController *)self groupPhotoUpdateBanner];

  if (v13)
  {
    return [(CKChatController *)self presentUpdateBanner];
  }

  return 0;
}

- (id)createGroupUpdateWithType:(int64_t)a3
{
  v5 = [CKGroupUpdate alloc];
  v6 = [(CKCoreChatController *)self conversation];
  v7 = [v6 groupIdentityUpdateHandleID];
  v8 = [(CKGroupUpdate *)v5 initWithType:a3 handleID:v7];

  return v8;
}

- (BOOL)presentUpdateBanner
{
  v3 = [(CKChatController *)self view];
  v4 = [(CKChatController *)self groupPhotoUpdateBanner];
  [v3 addSubview:v4];

  v5 = [(CKChatController *)self groupPhotoUpdateBanner];
  [(CKChatController *)self _presentBannerView:v5 completion:0];

  return 1;
}

- (BOOL)accountCanCreateNickname
{
  v2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v3 = [v2 isAllowMultiplePhoneNumbersSNaPEnabled];

  v4 = IMSharedHelperNickNameEnabled();
  if (v3)
  {
    if (v4)
    {
      v5 = [MEMORY[0x1E69A5C10] sharedInstance];
      LOBYTE(v6) = [v5 iCloudSignedInToUseNicknames];
LABEL_9:

      return v6;
    }
  }

  else if (v4)
  {
    v5 = [MEMORY[0x1E69A5C10] sharedInstance];
    if ([v5 iCloudSignedInToUseNicknames])
    {
      v6 = [MEMORY[0x1E69A5C10] multiplePhoneNumbersTiedToAppleID] ^ 1;
    }

    else
    {
      LOBYTE(v6) = 0;
    }

    goto LABEL_9;
  }

  LOBYTE(v6) = 0;
  return v6;
}

- (BOOL)shouldShowAcceptedContactBanner
{
  v3 = [(CKCoreChatController *)self chat];
  v4 = [v3 recipient];
  v5 = [v4 cnContactWithKeys:MEMORY[0x1E695E0F0]];

  if (![v5 isCoreRecentsAccepted])
  {
    goto LABEL_4;
  }

  v6 = [(CKCoreChatController *)self chat];
  v7 = [v6 isStewieChat];

  if ((v7 & 1) != 0 || [(CKChatController *)self isShowingOscarChat])
  {
    goto LABEL_4;
  }

  v10 = [(CKCoreChatController *)self conversation];
  if ([v10 isWithMyself])
  {
    LOBYTE(v8) = 0;
LABEL_8:

    goto LABEL_5;
  }

  v11 = [(CKCoreChatController *)self conversation];
  v12 = [v11 chat];
  v13 = [v12 isGroupChat];

  if ((v13 & 1) == 0)
  {
    v14 = [(CKCoreChatController *)self chat];
    v15 = [v14 allowedByScreenTime];

    if (v15)
    {
      v16 = [(CKCoreChatController *)self conversation];
      v17 = [v16 chat];
      v10 = [v17 valueForChatProperty:*MEMORY[0x1E69A6AE8]];

      if (v10)
      {
        v8 = [v10 BOOLValue] ^ 1;
      }

      else
      {
        LOBYTE(v8) = 1;
      }

      goto LABEL_8;
    }
  }

LABEL_4:
  LOBYTE(v8) = 0;
LABEL_5:

  return v8;
}

- (void)showOrHideAcceptedContactBannerIfNeeded
{
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke;
  aBlock[3] = &unk_1E72EC460;
  objc_copyWeak(&v20, &location);
  v3 = _Block_copy(aBlock);
  if ([(CKChatController *)self shouldShowAcceptedContactBanner])
  {
    v4 = [(CKCoreChatController *)self chat];
    v5 = [v4 recipient];

    if (v5)
    {
      v6 = [v5 nameThatIsNotHandle];
      if (v6)
      {
        v16 = [v5 nameThatIsNotHandle];
      }

      else
      {
        v8 = CKFrameworkBundle();
        v16 = [v8 localizedStringForKey:@"NEW_SENDER_BANNER_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
      }

      v15 = [v5 displayID];
      v9 = objc_alloc_init(CKNicknameUpdate);
      [(CKNicknameUpdate *)v9 setHandle:v5];
      v10 = [v5 nicknameObject];
      if (v10)
      {
        [(CKNicknameUpdate *)v9 setNickname:v10];
      }

      if (CKIsRunningInMacCatalyst())
      {
        v11 = MEMORY[0x1E695E0F0];
      }

      else
      {
        v11 = [CKNicknameUtility addContactOptionsMenuItemsWithTarget:self update:v9];
      }

      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_3;
      v17[3] = &unk_1E72EE148;
      objc_copyWeak(&v18, &location);
      v12 = _Block_copy(v17);
      v13 = [[_TtC7ChatKit25AcceptedContactBannerView alloc] initWithTitle:v16 subtitle:v15 update:v9 actionButtonHandler:v12 actionButtonMenuItems:v11 xButtonHandler:v3];
      v14 = [(CKChatController *)self acceptedContactBanner];

      if (!v14)
      {
        [(CKChatController *)self setAcceptedContactBanner:v13];
        [(CKChatController *)self _presentBannerView:v13 completion:0];
        [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"GroupPhotoBannerChangedSize"];
      }

      objc_destroyWeak(&v18);
    }
  }

  else
  {
    v7 = [(CKChatController *)self acceptedContactBanner];

    if (v7)
    {
      v3[2](v3);
    }
  }

  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);
}

void __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke(uint64_t a1)
{
  v2 = objc_loadWeakRetained((a1 + 32));
  v3 = [v2 acceptedContactBanner];
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_2;
  v4[3] = &unk_1E72EC460;
  objc_copyWeak(&v5, (a1 + 32));
  [v2 _dismissBannerView:v3 completion:v4];

  objc_destroyWeak(&v5);
}

void __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setAcceptedContactBanner:0];

  v3 = objc_loadWeakRetained((a1 + 32));
  [v3 updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];

  v6 = objc_loadWeakRetained((a1 + 32));
  v4 = [v6 conversation];
  v5 = [v4 chat];
  [v5 setValue:MEMORY[0x1E695E118] forChatProperty:*MEMORY[0x1E69A6AE8]];
}

void __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained conversation];
  v2 = [v1 chat];
  [v2 setValue:MEMORY[0x1E695E118] forChatProperty:*MEMORY[0x1E69A6AE8]];
}

- (BOOL)_showOrHideNicknameBannerIfNeeded
{
  v52 = *MEMORY[0x1E69E9840];
  v3 = [(CKCoreChatController *)self chat];
  v4 = [v3 isStewieChat];

  if ((v4 & 1) == 0 && ![(CKChatController *)self isAnimatingMessageSend]&& ![(CKChatController *)self isShowingOscarChat])
  {
    v5 = [(CKCoreChatController *)self conversation];
    v6 = [v5 isWithMyself];

    if ((v6 & 1) == 0)
    {
      v7 = [(CKCoreChatController *)self chat];
      v8 = [v7 canSuggestRecipientContact];

      if (v8)
      {
        v47 = 0;
        v9 = [(CKCoreChatController *)self _retrieveNicknameBannerUpdatesIfNeeded:&v47];
        if (v9)
        {
          if (!v47 || [(CKChatController *)self _wantsToShowCollaborationNotices])
          {
            v10 = [(CKChatController *)self nicknameBanner];

            if (v10)
            {
              v11 = [(CKChatController *)self nicknameBanner];
              v40[0] = MEMORY[0x1E69E9820];
              v40[1] = 3221225472;
              v40[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_7;
              v40[3] = &unk_1E72EBA18;
              v40[4] = self;
              [(CKChatController *)self _dismissBannerView:v11 completion:v40];
            }

            v12 = [v9 count] != 0;
            goto LABEL_16;
          }

          if (![(CKChatController *)self _hasExistingBannerMatchingStyle:v47 withNicknames:v9])
          {
            if (IMOSLoggingEnabled())
            {
              v14 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
              {
                *buf = 134218242;
                v49 = v47;
                v50 = 2112;
                v51 = v9;
                _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Will present nickname banner with state %lu, and updates %@", buf, 0x16u);
              }
            }

            if (v47 == 4)
            {
              v15 = 0;
            }

            else
            {
              v16 = [(CKCoreChatController *)self conversation];
              v15 = [v16 isGroupConversation];
            }

            objc_initWeak(buf, self);
            v17 = [v9 firstObject];
            v39 = [v17 contact];
            if (CKIsRunningInMacCatalyst() || v39 || (v47 - 4) < 3)
            {
              v38 = 0;
              if (v47 == 3 && v39)
              {
                v38 = [CKNicknameUtility updateNameAndPhotoMenuItemsWithTarget:self update:v17];
              }
            }

            else
            {
              v38 = [CKNicknameUtility addContactOptionsMenuItemsWithTarget:self update:v17];
            }

            aBlock[0] = MEMORY[0x1E69E9820];
            aBlock[1] = 3221225472;
            aBlock[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke;
            aBlock[3] = &unk_1E72EE198;
            v46[1] = v47;
            objc_copyWeak(v46, buf);
            v18 = v9;
            v45 = v18;
            v37 = _Block_copy(aBlock);
            v36 = [CKNicknameUtility bannerTitleTextWithUpdates:v18 style:v47 useNamedTitles:v15];
            v35 = [CKNicknameUtility bannerSubtitleTextWithUpdates:v18 style:v47];
            v34 = [CKNicknameUtility bannerActionButtonStringWithUpdates:v18 style:v47];
            v41[0] = MEMORY[0x1E69E9820];
            v41[1] = 3221225472;
            v41[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_4;
            v41[3] = &unk_1E72EE1C0;
            objc_copyWeak(&v43, buf);
            v19 = v18;
            v42 = v19;
            v20 = _Block_copy(v41);
            v21 = [CKNicknameUtility avatarContactsForUpdates:v19 style:v47];
            v22 = [CKNicknameUtility customImageForUpdate:v17 style:v47];
            v23 = [CKNicknameBannerView alloc];
            v24 = [(CKNicknameBannerView *)v23 initWithStyle:v47 updates:v19 useNamedTitles:v15 avatarImages:0 contacts:v21 customImage:v22 titleString:v36 subtitleString:v35 actionButtonTitle:v34 actionButtonHandler:v20 actionButtonMenuItems:v38 xButtonHandler:v37];
            if ([(CKChatController *)self _anySuggestionPresenterWantsToShowBanner])
            {
              v25 = [(CKChatController *)self suggestionBannerView];
              v26 = v25 == 0;

              if (!v26)
              {
                v27 = [(CKChatController *)self suggestionBannerView];
                [(CKChatController *)self removeSuggestionsBanner:v27 animated:1];
              }
            }

            v28 = [(CKChatController *)self nicknameBanner];

            if (v28)
            {
              v29 = [(CKChatController *)self nicknameBanner];
              v30 = [v29 nicknameUpdates];
              v31 = [v30 __imArrayByApplyingBlock:&__block_literal_global_1571];

              v32 = [(CKChatController *)self nicknameBanner];
              [(CKChatController *)self _replaceBannerView:v32 withNewBannerView:v24 placingHandlesUnderScrutiny:v31 completion:0];

              [(CKChatController *)self setNicknameBanner:v24];
            }

            else
            {
              [(CKChatController *)self setNicknameBanner:v24];
              v33 = [(CKNicknameBannerView *)v24 nicknameUpdates];
              v31 = [v33 __imArrayByApplyingBlock:&__block_literal_global_1573];

              [(CKChatController *)self _presentBannerView:v24 placingHandlesUnderScrutiny:v31 completion:0];
            }

            objc_destroyWeak(&v43);
            objc_destroyWeak(v46);

            objc_destroyWeak(buf);
            v12 = 1;
            goto LABEL_16;
          }
        }

        v12 = 0;
LABEL_16:

        return v12;
      }
    }
  }

  return 0;
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke(id *a1, void *a2)
{
  v3 = a2;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_2;
  aBlock[3] = &unk_1E72EE170;
  v17[1] = a1[6];
  objc_copyWeak(v17, a1 + 5);
  v16 = a1[4];
  v4 = _Block_copy(aBlock);
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  [WeakRetained setNicknameBanner:0];

  v6 = objc_loadWeakRetained(a1 + 5);
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_3;
  v12[3] = &unk_1E72EC1F0;
  v7 = v4;
  v13 = v7;
  objc_copyWeak(&v14, a1 + 5);
  [v6 _dismissBannerView:v3 completion:v12];

  v8 = objc_loadWeakRetained(a1 + 5);
  if (![v8 _anySuggestionPresenterWantsToShowBanner])
  {
    goto LABEL_4;
  }

  v9 = objc_loadWeakRetained(a1 + 5);
  v10 = [v9 suggestionBannerView];

  if (v10)
  {
    v8 = objc_loadWeakRetained(a1 + 5);
    v11 = [v8 suggestionBannerView];
    [v8 addSuggestionBanner:v11 animated:1];

LABEL_4:
  }

  objc_destroyWeak(&v14);

  objc_destroyWeak(v17);
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_2(uint64_t a1)
{
  v21 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 48);
  if (v2 == 5)
  {
    v15 = [MEMORY[0x1E69A5C10] sharedInstance];
    WeakRetained = objc_loadWeakRetained((a1 + 40));
    v4 = [WeakRetained conversation];
    v5 = [v4 chat];
    v6 = [v5 participants];
    [v15 denyHandlesForNicknameSharing:v6];

    goto LABEL_5;
  }

  if (v2 == 6)
  {
    v15 = objc_loadWeakRetained((a1 + 40));
    [v15 nicknameBannerDidInteractWithOnboardingOffer];
LABEL_5:

    return;
  }

  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  v7 = *(a1 + 32);
  v8 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v17;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v17 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v16 + 1) + 8 * i);
        v13 = [MEMORY[0x1E69A5C10] sharedInstance];
        v14 = [v12 handle];
        [v13 clearPendingNicknameUpdatesForHandle:v14 forceClear:1];
      }

      v9 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v9);
  }
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_3(uint64_t a1)
{
  (*(*(a1 + 32) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setNicknameBanner:0];

  v3 = objc_loadWeakRetained((a1 + 40));
  [v3 updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];

  v4 = objc_loadWeakRetained((a1 + 40));
  [v4 updateFoundInSuggestionPresenter];
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_4(uint64_t a1, void *a2, void *a3)
{
  v5 = a3;
  v6 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained nicknameBannerView:v6 actionButtonTapped:v5 forUpdates:*(a1 + 32)];
}

uint64_t __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_7(uint64_t a1)
{
  [*(a1 + 32) setNicknameBanner:0];
  v2 = *(a1 + 32);

  return [v2 updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];
}

- (void)nicknameStoreDidChange:(id)a3
{
  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];

  [(CKChatController *)self _autoAcceptNicknameIfNeeded];
}

- (void)_autoAcceptNicknameIfNeeded
{
  v28[1] = *MEMORY[0x1E69E9840];
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 handles];
  v5 = [v4 firstObject];
  v6 = [v5 ID];

  if (![(CKChatController *)self shouldShowAvatarViewInNavBarCanvas])
  {
    v7 = [(CKCoreChatController *)self conversation];
    v8 = [v7 isGroupConversation];

    if ((v8 & 1) == 0)
    {
      if (v6)
      {
        v9 = [MEMORY[0x1E69A5C10] sharedInstance];
        v10 = MEMORY[0x1E695DFD8];
        v28[0] = v6;
        v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v28 count:1];
        v12 = [v10 setWithArray:v11];
        v13 = [v9 pendingNicknameForHandleIDs:v12];
        v14 = v13 == 0;

        if (v14)
        {
          if (IMOSLoggingEnabled())
          {
            v21 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Not auto-updating, no pending nickname available.", buf, 2u);
            }
          }
        }

        else
        {
          v15 = [MEMORY[0x1E69A5C10] sharedInstance];
          v27 = v6;
          v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v27 count:1];
          v17 = [v15 createSharedProfileStateOracleForHandles:v16];

          if ([v17 effectiveStateForContact] == 1 || objc_msgSend(v17, "effectiveStateForContact") == 3)
          {
            v22 = 0;
            v18 = [v17 updateContactAndNicknamesForAutoUpdateWithError:&v22];
            v19 = v22;
            if (IMOSLoggingEnabled())
            {
              v20 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
              {
                *buf = 138412546;
                v24 = v6;
                v25 = 2112;
                v26 = v19;
                _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Updated contact and nicknames for recipient: %@, error: %@", buf, 0x16u);
              }
            }
          }
        }
      }
    }
  }
}

- (void)_presentBannerView:(id)a3 placingHandlesUnderScrutiny:(id)a4 completion:(id)a5
{
  v50 = *MEMORY[0x1E69E9840];
  v35 = a3;
  v37 = a4;
  v34 = a5;
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v49 = v35;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Present update banner view %@", buf, 0xCu);
    }
  }

  if ([v37 count])
  {
    v45 = 0u;
    v46 = 0u;
    v44 = 0u;
    v43 = 0u;
    v8 = v37;
    v9 = [v8 countByEnumeratingWithState:&v43 objects:v47 count:16];
    if (v9)
    {
      v10 = *v44;
      while (2)
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v44 != v10)
          {
            objc_enumerationMutation(v8);
          }

          v12 = *(*(&v43 + 1) + 8 * i);
          v13 = [MEMORY[0x1E69A5C10] sharedInstance];
          v14 = [v13 handlesForNicknamesUnderScrutiny];
          v15 = [v12 ID];
          v16 = [v14 containsObject:v15];

          v17 = IMOSLoggingEnabled();
          if (v16)
          {
            if (v17)
            {
              v30 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
              {
                v31 = [v12 ID];
                *buf = 138412290;
                v49 = v31;
                _os_log_impl(&dword_19020E000, v30, OS_LOG_TYPE_INFO, "CKChatController - Skipping handling %@, under scrutiny;  now clearing from scrutiny", buf, 0xCu);
              }
            }

            v32 = [MEMORY[0x1E69A5C10] sharedInstance];
            [v32 ignorePendingNicknameUpdatesForHandle:v12];

            v33 = [MEMORY[0x1E69A5C10] sharedInstance];
            [v33 clearHandleFromScrutiny:v12];

            goto LABEL_39;
          }

          if (v17)
          {
            v18 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
            {
              v19 = [v12 ID];
              *buf = 138412290;
              v49 = v19;
              _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Placing %@ under scrutiny", buf, 0xCu);
            }
          }

          v20 = [MEMORY[0x1E69A5C10] sharedInstance];
          [v20 markHandleUnderScrutiny:v12];
        }

        v9 = [v8 countByEnumeratingWithState:&v43 objects:v47 count:16];
        if (v9)
        {
          continue;
        }

        break;
      }
    }
  }

  [v35 setAlpha:0.0];
  if (-[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView") && (-[CKCoreChatController lockoutViewController](self, "lockoutViewController"), v21 = objc_claimAutoreleasedReturnValue(), [v21 view], v8 = objc_claimAutoreleasedReturnValue(), v21, v8))
  {
    v22 = [(CKChatController *)self view];
    [v22 insertSubview:v35 belowSubview:v8];
  }

  else
  {
    v22 = [(CKChatController *)self view];
    [v22 addSubview:v35];
    v8 = 0;
  }

  if ([v37 count])
  {
    if (IMOSLoggingEnabled())
    {
      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v49 = v37;
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Removing from scrutiny after presenting banner: %@", buf, 0xCu);
      }
    }

    [(CKChatController *)self clearHandlesFromScrutiny:v37];
  }

  [(CKChatController *)self _layoutBannerView:v35];
  v24 = [(CKChatController *)self inlineReplyController];

  if (!v24)
  {
    v25 = [(CKChatController *)self transitionCoordinator];

    if (v25)
    {
      v26 = [(CKChatController *)self transitionCoordinator];
      v41[0] = MEMORY[0x1E69E9820];
      v41[1] = 3221225472;
      v41[2] = __78__CKChatController__presentBannerView_placingHandlesUnderScrutiny_completion___block_invoke;
      v41[3] = &unk_1E72EC3E8;
      v27 = v35;
      v42 = v27;
      v28 = [v26 animateAlongsideTransition:v41 completion:0];

      if ((v28 & 1) == 0)
      {
        v29 = MEMORY[0x1E69DD250];
        v39[0] = MEMORY[0x1E69E9820];
        v39[1] = 3221225472;
        v39[2] = __78__CKChatController__presentBannerView_placingHandlesUnderScrutiny_completion___block_invoke_2;
        v39[3] = &unk_1E72EBA18;
        v40 = v27;
        v38[0] = MEMORY[0x1E69E9820];
        v38[1] = 3221225472;
        v38[2] = __78__CKChatController__presentBannerView_placingHandlesUnderScrutiny_completion___block_invoke_3;
        v38[3] = &unk_1E72EB9C8;
        v38[4] = self;
        [v29 animateWithDuration:v39 animations:v38 completion:0.1];
      }
    }

    else
    {
      [v35 setAlpha:1.0];
      [(CKChatController *)self _showCatchUpButtonIfNeeded];
    }
  }

LABEL_39:
}

- (void)_dismissBannerView:(id)a3 completion:(id)a4
{
  v23 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v22 = v6;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Dismiss banner view %@", buf, 0xCu);
    }
  }

  v9 = [(CKChatController *)self collectionView];
  v10 = [v9 __ck_isScrolledToTop];

  v11 = MEMORY[0x1E69DD250];
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __50__CKChatController__dismissBannerView_completion___block_invoke;
  v19[3] = &unk_1E72EBA18;
  v20 = v6;
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __50__CKChatController__dismissBannerView_completion___block_invoke_2;
  v14[3] = &unk_1E72EE208;
  v15 = v20;
  v16 = self;
  v18 = v10;
  v17 = v7;
  v12 = v7;
  v13 = v20;
  [v11 animateWithDuration:v19 animations:v14 completion:0.1];
}

uint64_t __50__CKChatController__dismissBannerView_completion___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) removeFromSuperview];
  [*(a1 + 32) setAlpha:1.0];
  [*(a1 + 40) updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];
  if (*(a1 + 56) == 1)
  {
    v2 = [*(a1 + 40) collectionView];
    [v2 __ck_scrollToTop:1];
  }

  v3 = *(a1 + 48);
  if (v3)
  {
    (*(v3 + 16))();
  }

  v4 = *(a1 + 40);

  return [v4 _showCatchUpButtonIfNeeded];
}

- (void)_replaceBannerView:(id)a3 withNewBannerView:(id)a4 placingHandlesUnderScrutiny:(id)a5 completion:(id)a6
{
  v34 = self;
  v58 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v39 = a4;
  v38 = a5;
  v37 = a6;
  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      *&buf[4] = v9;
      *&buf[12] = 2112;
      *&buf[14] = v39;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Replace nickname banner view %@ with new banner view %@", buf, 0x16u);
    }
  }

  v36 = v9;
  if (v9 == v39)
  {
    if (IMOSLoggingEnabled())
    {
      v33 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v33, OS_LOG_TYPE_INFO, "Nickname banners are equal, not replacing", buf, 2u);
      }
    }
  }

  else
  {
    v51 = 0u;
    v52 = 0u;
    v50 = 0u;
    v49 = 0u;
    v11 = v38;
    v12 = [v11 countByEnumeratingWithState:&v49 objects:v57 count:16];
    if (v12)
    {
      v13 = *v50;
      while (2)
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v50 != v13)
          {
            objc_enumerationMutation(v11);
          }

          v15 = *(*(&v49 + 1) + 8 * i);
          v16 = [MEMORY[0x1E69A5C10] sharedInstance];
          v17 = [v16 handlesForNicknamesUnderScrutiny];
          v18 = [v15 ID];
          v19 = [v17 containsObject:v18];

          v20 = IMOSLoggingEnabled();
          if (v19)
          {
            if (v20)
            {
              v29 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
              {
                v30 = [v15 ID];
                *buf = 138412290;
                *&buf[4] = v30;
                _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "CKChatController - Skipping handling %@, under scrutiny;  now clearing from scrutiny", buf, 0xCu);
              }
            }

            v31 = [MEMORY[0x1E69A5C10] sharedInstance];
            [v31 ignorePendingNicknameUpdatesForHandle:v15];

            v32 = [MEMORY[0x1E69A5C10] sharedInstance];
            [v32 clearHandleFromScrutiny:v15];

            goto LABEL_34;
          }

          if (v20)
          {
            v21 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = [v15 ID];
              *buf = 138412290;
              *&buf[4] = v22;
              _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Placing %@ under scrutiny", buf, 0xCu);
            }
          }

          v23 = [MEMORY[0x1E69A5C10] sharedInstance];
          [v23 markHandleUnderScrutiny:v15];
        }

        v12 = [v11 countByEnumeratingWithState:&v49 objects:v57 count:16];
        if (v12)
        {
          continue;
        }

        break;
      }
    }

    [(CKChatController *)v34 _layoutBannerView:v39];
    [v39 setAlpha:0.0];
    v24 = [(CKChatController *)v34 view];
    [v24 addSubview:v39];

    if ([v11 count])
    {
      if (IMOSLoggingEnabled())
      {
        v25 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          *&buf[4] = v11;
          _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "Removing from scrutiny after replacing banner: %@", buf, 0xCu);
        }
      }

      [(CKChatController *)v34 clearHandlesFromScrutiny:v11, v34];
    }

    v26 = [(CKChatController *)v34 collectionView];
    v27 = [v26 __ck_isScrolledToTop];

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v54 = __Block_byref_object_copy__8;
    v55 = __Block_byref_object_dispose__8;
    v56 = v36;
    v28 = MEMORY[0x1E69DD250];
    v46[0] = MEMORY[0x1E69E9820];
    v46[1] = 3221225472;
    v46[2] = __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke;
    v46[3] = &unk_1E72EB8D0;
    v47 = v56;
    v48 = v39;
    v40[0] = MEMORY[0x1E69E9820];
    v40[1] = 3221225472;
    v40[2] = __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke_2;
    v40[3] = &unk_1E72EE230;
    v44 = buf;
    v41 = v47;
    v42 = v35;
    v45 = v27;
    v43 = v37;
    [v28 animateWithDuration:v46 animations:v40 completion:0.1];

    _Block_object_dispose(buf, 8);
  }

LABEL_34:
}

uint64_t __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setAlpha:0.0];
  v2 = *(a1 + 40);

  return [v2 setAlpha:1.0];
}

uint64_t __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) removeFromSuperview];
  v2 = *(*(a1 + 56) + 8);
  v3 = *(v2 + 40);
  *(v2 + 40) = 0;

  [*(a1 + 40) updateScrollGeometryWithoutAnimationForReason:@"BannerChangedSize"];
  if (*(a1 + 64) == 1)
  {
    v4 = [*(a1 + 40) collectionView];
    [v4 __ck_scrollToTop:1];
  }

  result = *(a1 + 48);
  if (result)
  {
    v6 = *(result + 16);

    return v6();
  }

  return result;
}

- (void)groupPhotoUpdateBanner:(id)a3 dismissedUpdate:(id)a4
{
  v6 = a3;
  v7 = [a4 groupUpdateType];
  if ((v7 & 0xFFFFFFFFFFFFFFFBLL) == 1)
  {
    v8 = [(CKCoreChatController *)self conversation];
    [v8 setShouldShowGroupNameUpdateBanner:0];
LABEL_8:

    goto LABEL_9;
  }

  if (v7 <= 8)
  {
    if (((1 << v7) & 0x1C8) != 0)
    {
      v9 = [(CKCoreChatController *)self conversation];
      [v9 setShouldShowGroupNameUpdateBanner:0];

LABEL_7:
      v8 = [(CKCoreChatController *)self conversation];
      [v8 setShouldShowGroupPhotoUpdateBanner:0];
      goto LABEL_8;
    }

    if (((1 << v7) & 0x14) != 0)
    {
      goto LABEL_7;
    }
  }

LABEL_9:
  v10 = [(CKCoreChatController *)self conversation];
  [v10 setGroupIdentityUpdateHandleID:0];

  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __59__CKChatController_groupPhotoUpdateBanner_dismissedUpdate___block_invoke;
  v11[3] = &unk_1E72EBA18;
  v11[4] = self;
  [(CKChatController *)self _dismissBannerView:v6 completion:v11];
}

uint64_t __59__CKChatController_groupPhotoUpdateBanner_dismissedUpdate___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setGroupPhotoUpdateBanner:0];
  v2 = *(a1 + 32);

  return [v2 updateScrollGeometryWithoutAnimationForReason:@"GroupPhotoBannerChangedSize"];
}

- (void)nicknameBannerView:(id)a3 actionButtonTapped:(id)a4 forUpdates:(id)a5
{
  v34 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  v10 = a5;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke;
  aBlock[3] = &unk_1E72EBA18;
  v11 = v10;
  v28 = v11;
  v12 = _Block_copy(aBlock);
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_2;
  v22[3] = &unk_1E72EE280;
  objc_copyWeak(&v26, &location);
  v13 = v8;
  v23 = v13;
  v14 = v12;
  v24 = self;
  v25 = v14;
  v15 = _Block_copy(v22);
  v16 = [v11 firstObject];
  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = [v13 style];
      *buf = 138412546;
      v31 = v16;
      v32 = 2048;
      v33 = v18;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Performing action for update %@, with style: %lu", buf, 0x16u);
    }
  }

  v19 = [v13 style];
  if (v19 <= 4)
  {
    if (v19 == 1)
    {
      v20 = 4;
    }

    else
    {
      if (v19 != 2)
      {
        if (v19 == 4)
        {
          [(CKChatController *)self presentNicknameUpdatesViewControllerFromView:v9];
        }

        goto LABEL_17;
      }

      v20 = 2;
    }

    [(CKChatController *)self updateContactQuietlyForNicknameUpdate:v16 updateType:v20];
    v15[2](v15, 0);
    goto LABEL_17;
  }

  if ((v19 - 5) < 2)
  {
    if ([v13 style] == 6)
    {
      [(CKChatController *)self nicknameBannerDidInteractWithOnboardingOffer];
      [(CKChatController *)self showNicknameSharingOnboardingWithMemoji:1];
    }

    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_1575;
    v21[3] = &unk_1E72EBA18;
    v21[4] = self;
    (v15)[2](v15, v21);
  }

LABEL_17:

  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);
}

void __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x1E69E9840];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v1 = *(a1 + 32);
  v2 = [v1 countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v10;
    do
    {
      v5 = 0;
      do
      {
        if (*v10 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v6 = *(*(&v9 + 1) + 8 * v5);
        v7 = [MEMORY[0x1E69A5C10] sharedInstance];
        v8 = [v6 handle];
        [v7 clearPendingNicknameUpdatesForHandle:v8 forceClear:0];

        ++v5;
      }

      while (v3 != v5);
      v3 = [v1 countByEnumeratingWithState:&v9 objects:v13 count:16];
    }

    while (v3);
  }
}

void __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = [WeakRetained nicknameBanner];
  v6 = *(a1 + 32);

  if (v5 == v6)
  {
    v7 = objc_loadWeakRetained((a1 + 56));
    v8 = *(a1 + 32);
    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_3;
    v9[3] = &unk_1E72EE258;
    v10 = v3;
    v11 = *(a1 + 48);
    objc_copyWeak(&v12, (a1 + 56));
    v9[4] = *(a1 + 40);
    [v7 _dismissBannerView:v8 completion:v9];

    objc_destroyWeak(&v12);
  }

  else
  {
    if (v3)
    {
      v3[2](v3);
    }

    (*(*(a1 + 48) + 16))();
  }
}

uint64_t __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_3(uint64_t a1)
{
  v2 = *(a1 + 40);
  if (v2)
  {
    (*(v2 + 16))();
  }

  (*(*(a1 + 48) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained setNicknameBanner:0];

  [*(a1 + 32) updateScrollGeometryWithoutAnimationForReason:@"BannerChangedSize"];
  v4 = *(a1 + 32);

  return [v4 updateFoundInSuggestionPresenter];
}

void __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_1575(uint64_t a1)
{
  v9 = [MEMORY[0x1E69A5C10] sharedInstance];
  v2 = [*(a1 + 32) conversation];
  v3 = [v2 chat];
  v4 = [v3 participants];
  v5 = [*(a1 + 32) conversation];
  v6 = [v5 chat];
  v7 = [*(a1 + 32) conversation];
  v8 = [v7 lastAddressedHandle];
  [v9 allowHandlesForNicknameSharing:v4 forChat:v6 fromHandle:v8 forceSend:0];
}

- (void)presentNicknameUpdatesViewControllerFromView:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v10 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Presenting updates controller!", v10, 2u);
    }
  }

  v6 = [(CKCoreChatController *)self _nicknameBannerUpdatesAndStyle:0];
  v7 = [CKNicknameUpdateListViewFactory listViewWithUpdates:v6 delegate:self];
  [(CKChatController *)self setNicknameUpdateController:v7];
  v8 = v7;
  if (CKIsRunningInMacCatalyst())
  {
    [v8 setModalPresentationStyle:7];
    v9 = [v8 popoverPresentationController];
    [v9 setSourceView:v4];
  }

  [(CKChatController *)self presentViewController:v8 animated:1 completion:0];
}

- (void)nicknameBannerDidInteractWithOnboardingOffer
{
  v2 = [MEMORY[0x1E69A8108] sharedInstance];
  if (([v2 wasSharingEverEnabled] & 1) == 0 && (objc_msgSend(v2, "sharingEnabled") & 1) == 0)
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        *v4 = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "User interacted with outgoing share CTA. Disabling.", v4, 2u);
      }
    }

    [v2 setSharingEnabled:0];
  }
}

- (void)updateInterfaceSelectedAction:(unint64_t)a3 forUpdate:(id)a4
{
  v6 = a4;
  v9 = [(CKChatController *)self nicknameUpdateController];
  v7 = [(CKChatController *)self nicknameUpdateController];
  v8 = [v7 view];
  [(CKChatController *)self nicknameUpdatesViewController:v9 selectedAction:a3 forNicknameUpdate:v6 sourceView:v8];
}

- (void)nicknameUpdatesViewController:(id)a3 selectedAction:(unint64_t)a4 forNicknameUpdate:(id)a5 sourceView:(id)a6
{
  v24 = a3;
  v10 = a5;
  v11 = a6;
  if (a4 <= 2)
  {
    if (!a4)
    {
      v19 = [MEMORY[0x1E69A5C10] sharedInstance];
      v20 = [v10 handle];
      [v19 clearPendingNicknameUpdatesForHandle:v20 forceClear:1];
LABEL_16:

      goto LABEL_17;
    }

    if (a4 == 1)
    {
      v23 = [v10 contact];
      [(CKChatController *)self updateContact:v23 withNicknameUpdate:v10 updateType:2 addHandleToContact:0 presentationMode:3];

      v19 = [MEMORY[0x1E69A5C10] sharedInstance];
      v20 = [v10 handle];
      v22 = [v20 ID];
      [v19 acceptPendingNicknameForHandleID:v22 updateType:2];
      goto LABEL_15;
    }

    if (a4 != 2)
    {
      goto LABEL_17;
    }

    v12 = [v10 contact];
    [(CKChatController *)self updateContact:v12 withNicknameUpdate:v10 updateType:4 addHandleToContact:0 presentationMode:3];

    v13 = [MEMORY[0x1E69A5C10] sharedInstance];
    v14 = [v10 handle];
    v15 = [v14 ID];
    v16 = v13;
    v17 = v15;
    v18 = 4;
LABEL_13:
    [v16 acceptPendingNicknameForHandleID:v17 updateType:v18];

    v19 = [MEMORY[0x1E69A5C10] sharedInstance];
    v20 = [v10 handle];
    v22 = [v20 ID];
    [v19 markTransitionAsObservedForHandleID:v22 isAutoUpdate:0];
LABEL_15:

    goto LABEL_16;
  }

  switch(a4)
  {
    case 3uLL:
      v21 = [v10 contact];
      [(CKChatController *)self updateContact:v21 withNicknameUpdate:v10 updateType:6 addHandleToContact:0 presentationMode:3];

      v13 = [MEMORY[0x1E69A5C10] sharedInstance];
      v14 = [v10 handle];
      v15 = [v14 ID];
      v16 = v13;
      v17 = v15;
      v18 = 6;
      goto LABEL_13;
    case 4uLL:
      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self showUnknownContactPopoverForNicknameUpdate:v10 presentingViewController:v24 sourceView:v11];
      }

      else
      {
        [(CKChatController *)self updateContact:0 withNicknameUpdate:v10 updateType:*MEMORY[0x1E69A77E8] addHandleToContact:1 presentationMode:1];
      }

      [(CKChatController *)self setCurrentNicknameUpdate:v10];
      break;
    case 5uLL:
      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self showUnknownContactPopoverForNicknameUpdate:v10 presentingViewController:v24 sourceView:v11];
      }

      else
      {
        [(CKChatController *)self setCurrentNicknameUpdate:v10];
        [(CKChatController *)self selectContact];
      }

      break;
  }

LABEL_17:
}

- (BOOL)shouldShowBanners
{
  v21 = *MEMORY[0x1E69E9840];
  v3 = [(CKCoreChatController *)self chat];
  v4 = v3;
  if (v3 && ([v3 allowedToShowConversation] & 1) == 0)
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = [MEMORY[0x1E695DF00] date];
        [v12 timeIntervalSince1970];
        v14 = v13;
        v15 = [(CKCoreChatController *)self chat];
        v17 = 134218242;
        v18 = v14;
        v19 = 2112;
        v20 = v15;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Bypassing checking checkSuggestionsForBanner due to downtime being on and chat containing nonallowlisted participants:   - %f %@", &v17, 0x16u);
      }
    }

    goto LABEL_12;
  }

  if ([v4 isStewieChat])
  {
    [(CKChatController *)self _presentTranscriptSharingBannerIfNecessary];
LABEL_12:
    v10 = 0;
    goto LABEL_13;
  }

  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v6 = [v5 isIntroductionsEnabled];

  if (v6)
  {
    v7 = +[CKConversationList sharedConversationList];
    v8 = [(CKCoreChatController *)self conversation];
    v9 = [v7 primaryFilterModeForConversation:v8];

    if (v9 == 9)
    {
      goto LABEL_12;
    }
  }

  v10 = 1;
LABEL_13:

  return v10;
}

- (void)_updateSuggestionsBanners
{
  v9 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self _anyTranscriptBannerIsVisible]|| [(CKChatController *)self _wantsToShowCollaborationNotices])
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        LOWORD(v7) = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Bypassing checkSuggestionsForBanner, another banner is already up", &v7, 2u);
      }
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        v5 = [MEMORY[0x1E695DF00] date];
        [v5 timeIntervalSince1970];
        v7 = 134217984;
        v8 = v6;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Handling _updateSuggestionsBanners - %f ", &v7, 0xCu);
      }
    }

    [(CKChatController *)self updateFoundInSuggestionPresenter];
  }
}

- (void)checkSuggestionsForBanner
{
  v9 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self shouldShowBanners])
  {
    if ([(CKChatController *)self _supportsCollaborationNotices]&& [(CKChatController *)self shouldFetchCollaborationNotices])
    {
      [(CKChatController *)self _fetchCollaborationNotices];

      [(CKChatController *)self setShouldFetchCollaborationNotices:0];
    }

    else if ([(CKChatController *)self _anyTranscriptBannerIsVisible]|| [(CKChatController *)self _wantsToShowCollaborationNotices])
    {
      if (IMOSLoggingEnabled())
      {
        v3 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
        {
          LOWORD(v7) = 0;
          _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Bypassing checkSuggestionsForBanner, another banner is already up", &v7, 2u);
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v4 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
        {
          v5 = [MEMORY[0x1E695DF00] date];
          [v5 timeIntervalSince1970];
          v7 = 134217984;
          v8 = v6;
          _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Handling checkSuggestionsForBanner - %f ", &v7, 0xCu);
        }
      }

      [(CKChatController *)self _updateSuggestionsBanners];
    }
  }
}

- (void)_handleCollaborationNoticesChanged:(id)a3
{
  v19 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = MEMORY[0x1E695DFD8];
  v6 = [v4 object];
  v7 = [v5 setWithArray:v6];

  v8 = MEMORY[0x1E695DFD8];
  v9 = [MEMORY[0x1E69A5AF8] sharedRegistry];
  v10 = [(CKCoreChatController *)self conversation];
  v11 = [v10 chat];
  v12 = [v9 allGUIDsForChat:v11];
  v13 = [v8 setWithArray:v12];

  LODWORD(v9) = [v7 intersectsSet:v13];
  v14 = IMOSLoggingEnabled();
  if (v9)
  {
    if (v14)
    {
      v15 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v17 = 138412290;
        v18 = v13;
        _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Fetching CollaborationNotices in response to change notification for guids: %@.", &v17, 0xCu);
      }
    }

    [(CKChatController *)self setShouldFetchCollaborationNotices:1];
    [(CKChatController *)self checkSuggestionsForBanner];
  }

  else if (v14)
  {
    v16 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      LOWORD(v17) = 0;
      _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Ignoring CollaborationNotices change notification, not relevant to displayed chat.", &v17, 2u);
    }
  }
}

- (void)_handleTranslationSettingChanged:(id)a3
{
  v4 = [a3 object];
  if (v4)
  {
    v5 = v4;
    [(CKChatController *)self reloadEntryViewIfNeeded];
    v4 = v5;
  }
}

- (void)_handleTranslationSupportChanged:(id)a3
{
  v4 = [a3 object];
  if (v4)
  {
    v5 = v4;
    [(CKChatController *)self reloadEntryViewIfNeeded];
    v4 = v5;
  }
}

- (void)_handleContactStoreBatchLoadCompleteNotification:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Fetching CollaborationNotices in response to contact store load completion", v6, 2u);
    }
  }

  [(CKChatController *)self setShouldFetchCollaborationNotices:1];
  [(CKChatController *)self checkSuggestionsForBanner];
}

- (void)_fetchCollaborationNotices
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __46__CKChatController__fetchCollaborationNotices__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __46__CKChatController__fetchCollaborationNotices__block_invoke_2;
  v6[3] = &unk_1E72EB8D0;
  v4 = *(a1 + 32);
  v7 = v3;
  v8 = v4;
  v5 = v3;
  dispatch_async(MEMORY[0x1E69E96A0], v6);
}

uint64_t __46__CKChatController__fetchCollaborationNotices__block_invoke_2(uint64_t a1)
{
  v9 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v7 = 138412290;
      v8 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Received CollaborationNotices: %@", &v7, 0xCu);
    }
  }

  v5 = *(a1 + 40);
  v4 = (a1 + 40);
  [v5 _processCollaborationNoticesForBanner:*(v4 - 1)];
  return [*v4 _updateSuggestionsBanners];
}

- (void)_processCollaborationNoticesForBanner:(id)a3
{
  v20 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [MEMORY[0x1E695DF70] array];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v6 = v4;
  v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v16;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v16 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v15 + 1) + 8 * i);
        if ([(CKChatController *)self _noticeIsExpired:v11, v15])
        {
          v14 = [MEMORY[0x1E69A5B28] sharedInstance];
          [v14 dismissNotice:v11];

          goto LABEL_11;
        }

        objc_opt_class();
        v12 = [CKCollaborationNoticeSuggestion suggestionWithNotice:v11 delegate:self wantsInlineReplyStyle:objc_opt_isKindOfClass() & 1];
        [v5 addObject:v12];
      }

      v8 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  v13 = [v5 copy];
  [(CKChatController *)self setCollaborationNoticeSuggestions:v13];

  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
LABEL_11:
}

- (void)setCollaborationNoticeSuggestions:(id)a3
{
  v27 = *MEMORY[0x1E69E9840];
  v5 = a3;
  objc_storeStrong(&self->_collaborationNoticeSuggestions, a3);
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [v5 count];
      v8 = [(CKChatController *)self standardSuggestionPresenter];
      *buf = 134218242;
      v24 = v7;
      v25 = 2112;
      v26 = v8;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "setCollaborationNoticeSuggestions invoked with %lu suggestions. standardSuggestionPresenter %@", buf, 0x16u);
    }
  }

  v9 = [(CKChatController *)self standardSuggestionPresenter];
  [v9 setSuggestions:v5];

  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  v10 = v5;
  v11 = [v10 countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v11)
  {
    v12 = *v19;
    do
    {
      v13 = 0;
      do
      {
        if (*v19 != v12)
        {
          objc_enumerationMutation(v10);
        }

        v14 = [*(*(&v18 + 1) + 8 * v13) notice];
        v15 = [v14 dateViewed];
        v16 = v15 == 0;

        if (v16)
        {
          v17 = [MEMORY[0x1E69A5B28] sharedInstance];
          [v17 markAsViewedForNotice:v14];
        }

        ++v13;
      }

      while (v11 != v13);
      v11 = [v10 countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v11);
  }
}

- (BOOL)_noticeIsExpired:(id)a3
{
  v3 = a3;
  v4 = [v3 date];
  [v4 timeIntervalSinceNow];
  v6 = v5;

  v7 = [v3 dateViewed];
  if (v7)
  {
    v8 = [v3 dateViewed];
    [v8 timeIntervalSinceNow];
    v10 = -v9;
  }

  else
  {
    v10 = 0.0;
  }

  v11 = IMGetCachedDomainIntForKeyWithDefaultValue();
  v12 = v10 >= IMGetCachedDomainIntForKeyWithDefaultValue() || -v6 >= v11;

  return v12;
}

- (void)dismissCollaborationNoticeBannersIfNecessary
{
  v26 = *MEMORY[0x1E69E9840];
  v20 = [(CKChatController *)self standardSuggestionPresenter];
  v3 = [v20 banner];
  v4 = [(CKChatController *)self suggestionBannerView];
  v5 = v4;
  if (v3 == v4)
  {
    v6 = [(CKChatController *)self suggestionBannerView];
    v7 = [v6 window];

    if (!v7)
    {
      return;
    }

    v8 = [(CKChatController *)self standardSuggestionPresenter];
    v9 = [v8 suggestions];

    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v10 = v9;
    v11 = [v10 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (!v11)
    {
      goto LABEL_19;
    }

    v12 = v11;
    v13 = *v22;
    while (1)
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v22 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v21 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v16 = v15;
          v17 = [v16 notice];
          if ([v17 wantsEphemeralDismissal])
          {

            goto LABEL_15;
          }

          v18 = [v16 notice];
          v19 = [(CKChatController *)self _noticeIsExpired:v18];

          if (v19)
          {
LABEL_15:
            [(CKChatController *)self dismissCollaborationNoticeSuggestion:v16];
          }

          continue;
        }
      }

      v12 = [v10 countByEnumeratingWithState:&v21 objects:v25 count:16];
      if (!v12)
      {
LABEL_19:

        return;
      }
    }
  }
}

- (void)dismissCollaborationNoticeSuggestion:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self standardSuggestionPresenter];
  [v5 removeSuggestion:v4];

  v7 = [MEMORY[0x1E69A5B28] sharedInstance];
  v6 = [v4 notice];

  [v7 dismissNotice:v6];
}

- (id)_newCollaborationPayloadFromPayload:(id)a3 shareURL:(id)a4 updatedMetadata:(id)a5
{
  v6 = a5;
  v7 = a3;
  v8 = [CKBrowserItemPayload browserItemPayloadFromIMPluginPayload:v7];
  v9 = StringGUID();
  [v8 setMessageGUID:v9];

  v10 = StringGUID();
  [v8 setPluginSessionGUID:v10];

  [v8 setAttachments:0];
  [v8 setPayloadCollaborationType:{objc_msgSend(v7, "payloadCollaborationType")}];
  [v8 setCollaborationMetadata:v6];

  v11 = [v7 cloudKitShare];

  [v8 setCloudKitShare:v11];
  return v8;
}

- (void)addToCollaboration:(id)a3
{
  v47 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 notice];
  v31 = [v5 senderHandle];

  v6 = [v4 notice];
  v7 = [v6 metadata];
  v8 = [v7 contentURL];

  v9 = [v4 notice];
  v10 = [v9 metadata];
  v32 = [v10 messageGUID];

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 138412802;
      v42 = v31;
      v43 = 2112;
      v44 = v8;
      v45 = 2112;
      v46 = v32;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Adding handle: %@ to share URL: %@ with messageGUID: %@", buf, 0x20u);
    }
  }

  v12 = [MEMORY[0x1E69A5AD0] sharedInstance];
  v30 = [v12 existingDataSourceForMessageGUID:v32 bundleID:*MEMORY[0x1E69A6A18]];

  v13 = [v30 pluginPayload];
  v14 = MEMORY[0x1E696ECD8];
  v15 = [v13 data];
  v16 = [v14 linkWithDataRepresentationWithoutSubstitutingAttachments:v15];

  v17 = [v16 metadata];
  v18 = [v17 collaborationMetadata];
  v19 = [v18 containerSetupInfo];

  v20 = [v19 containerOptions];
  [v20 setAccountOverrideInfo:0];

  v21 = [v19 containerOptions];
  [v21 setPersonaIdentifier:0];

  if (IMOSLoggingEnabled())
  {
    v22 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      v42 = v13;
      v43 = 2112;
      v44 = v19;
      _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Adding - PluginPayload: %@, Container Setup Info: %@", buf, 0x16u);
    }
  }

  objc_initWeak(buf, self);
  v23 = [(CKCoreChatController *)self chat];
  v24 = [v23 guid];
  v35[0] = MEMORY[0x1E69E9820];
  v35[1] = 3221225472;
  v35[2] = __39__CKChatController_addToCollaboration___block_invoke;
  v35[3] = &unk_1E72EE320;
  v25 = v17;
  v36 = v25;
  objc_copyWeak(&v40, buf);
  v26 = v13;
  v37 = v26;
  v27 = v8;
  v38 = v27;
  v28 = v4;
  v39 = v28;
  [(CKChatController *)self addParticipant:v31 toCollaboration:v27 forChatGUID:v24 containerSetupInfo:v19 completionHandler:v35];

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __39__CKChatController_addToCollaboration___block_invoke_2_1583;
  block[3] = &unk_1E72EB8D0;
  block[4] = self;
  v34 = v28;
  v29 = v28;
  dispatch_async(MEMORY[0x1E69E96A0], block);

  objc_destroyWeak(&v40);
  objc_destroyWeak(buf);
}

void __39__CKChatController_addToCollaboration___block_invoke(uint64_t a1, int a2, void *a3)
{
  v5 = a3;
  v6 = v5;
  if (a2)
  {
    if (v5)
    {
      v7 = v5;
    }

    else
    {
      v7 = [*(a1 + 32) collaborationMetadata];
    }

    v8 = v7;
    WeakRetained = objc_loadWeakRetained((a1 + 64));
    v10 = [WeakRetained _newCollaborationPayloadFromPayload:*(a1 + 40) shareURL:*(a1 + 48) updatedMetadata:v8];

    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __39__CKChatController_addToCollaboration___block_invoke_2;
    v16[3] = &unk_1E72EE2F8;
    v17 = *(a1 + 48);
    objc_copyWeak(&v20, (a1 + 64));
    v11 = v10;
    v18 = v11;
    v12 = v8;
    v19 = v12;
    [CKComposition compositionWithShelfPluginPayload:v11 completionHandler:v16];

    objc_destroyWeak(&v20);
  }

  else
  {
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __39__CKChatController_addToCollaboration___block_invoke_1581;
    v13[3] = &unk_1E72EBB98;
    objc_copyWeak(&v15, (a1 + 64));
    v14 = *(a1 + 56);
    dispatch_async(MEMORY[0x1E69E96A0], v13);

    objc_destroyWeak(&v15);
  }
}

void __39__CKChatController_addToCollaboration___block_invoke_2(id *a1, void *a2)
{
  v3 = a2;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __39__CKChatController_addToCollaboration___block_invoke_3;
  block[3] = &unk_1E72EE2D0;
  v6 = a1[4];
  objc_copyWeak(&v10, a1 + 7);
  v7 = a1[5];
  v8 = a1[6];
  v9 = v3;
  v4 = v3;
  dispatch_async(MEMORY[0x1E69E96A0], block);

  objc_destroyWeak(&v10);
}

void __39__CKChatController_addToCollaboration___block_invoke_3(uint64_t a1)
{
  v17 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v15 = 138412290;
      v16 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Sending the final composition for sharingURL: %@", &v15, 0xCu);
    }
  }

  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = *(a1 + 40);
  v6 = [v5 messageGUID];
  v7 = [WeakRetained updateDataSourceForPluginPayload:v5 forGUID:v6 withCollaborationMetadata:*(a1 + 48) shareURL:*(a1 + 32)];

  v8 = [v7 datasource];
  [v8 setPayloadInShelf:1];

  v9 = [v7 datasource];
  [v9 payloadWillEnterShelf];

  v10 = [CKComposition alloc];
  v11 = [*(a1 + 56) text];
  v12 = [*(a1 + 56) subject];
  v13 = [(CKComposition *)v10 initWithText:v11 subject:v12 shelfPluginPayload:v7];

  v14 = objc_loadWeakRetained((a1 + 64));
  [v14 sendCompositionIfAllowed:v13];
}

void __39__CKChatController_addToCollaboration___block_invoke_1581(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained createCollaborationFailureAlertForNotice:*(a1 + 32)];
}

void __39__CKChatController_addToCollaboration___block_invoke_2_1583(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  [v2 removeSuggestion:*(a1 + 40)];
}

- (void)removeFromCollaboration:(id)a3
{
  v41 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 notice];
  v28 = [v5 senderHandle];

  v6 = [v4 notice];
  v7 = [v6 metadata];
  v27 = [v7 contentURL];

  v8 = [v4 notice];
  v9 = [v8 metadata];
  v29 = [v9 messageGUID];

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *buf = 138412802;
      v36 = v28;
      v37 = 2112;
      v38 = v27;
      v39 = 2112;
      v40 = v29;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Removing handle: %@ from share URL: %@ with messageGUID: %@", buf, 0x20u);
    }
  }

  v11 = [MEMORY[0x1E69A5AD0] sharedInstance];
  v12 = [v11 existingDataSourceForMessageGUID:v29 bundleID:*MEMORY[0x1E69A6A18]];

  v13 = [v12 pluginPayload];
  v14 = MEMORY[0x1E696ECD8];
  v15 = [v13 data];
  v16 = [v14 linkWithDataRepresentationWithoutSubstitutingAttachments:v15];

  v17 = [v16 metadata];
  v18 = [v17 collaborationMetadata];
  v19 = [v18 containerSetupInfo];

  v20 = [v19 containerOptions];
  [v20 setAccountOverrideInfo:0];

  v21 = [v19 containerOptions];
  [v21 setPersonaIdentifier:0];

  if (IMOSLoggingEnabled())
  {
    v22 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      v36 = v13;
      v37 = 2112;
      v38 = v19;
      _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Removing - PluginPayload: %@, Container Setup Info: %@", buf, 0x16u);
    }
  }

  objc_initWeak(buf, self);
  v23 = [(CKCoreChatController *)self chat];
  v24 = [v23 guid];
  v32[0] = MEMORY[0x1E69E9820];
  v32[1] = 3221225472;
  v32[2] = __44__CKChatController_removeFromCollaboration___block_invoke;
  v32[3] = &unk_1E72EE348;
  objc_copyWeak(&v34, buf);
  v25 = v4;
  v33 = v25;
  [(CKChatController *)self removeParticipant:v28 fromCollaboration:v27 forChatGUID:v24 containerSetupInfo:v19 completionHandler:v32];

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __44__CKChatController_removeFromCollaboration___block_invoke_3;
  block[3] = &unk_1E72EB8D0;
  block[4] = self;
  v31 = v25;
  v26 = v25;
  dispatch_async(MEMORY[0x1E69E96A0], block);

  objc_destroyWeak(&v34);
  objc_destroyWeak(buf);
}

void __44__CKChatController_removeFromCollaboration___block_invoke(uint64_t a1, char a2)
{
  if ((a2 & 1) == 0)
  {
    v3[0] = MEMORY[0x1E69E9820];
    v3[1] = 3221225472;
    v3[2] = __44__CKChatController_removeFromCollaboration___block_invoke_2;
    v3[3] = &unk_1E72EBB98;
    objc_copyWeak(&v5, (a1 + 40));
    v4 = *(a1 + 32);
    dispatch_async(MEMORY[0x1E69E96A0], v3);

    objc_destroyWeak(&v5);
  }
}

void __44__CKChatController_removeFromCollaboration___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained createCollaborationFailureAlertForNotice:*(a1 + 32)];
}

void __44__CKChatController_removeFromCollaboration___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  [v2 removeSuggestion:*(a1 + 40)];
}

- (void)collaborationNoticeSuggestionWillDismiss:(id)a3
{
  v4 = a3;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __61__CKChatController_collaborationNoticeSuggestionWillDismiss___block_invoke;
  v6[3] = &unk_1E72EB8D0;
  v6[4] = self;
  v7 = v4;
  v5 = v4;
  dispatch_async(MEMORY[0x1E69E96A0], v6);
}

- (void)_satelliteStateChangedNotification:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v6 = [v5 stewieEnabled];

  if (v6)
  {
    v12.receiver = self;
    v12.super_class = CKChatController;
    [(CKCoreChatController *)&v12 _satelliteStateChangedNotification:v4];
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *v11 = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Satellite state changed, determining whether to show or hide entry view and updating chat items.", v11, 2u);
      }
    }

    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    v8 = [(CKCoreChatController *)self chat];
    [v8 _reloadChatItemsForSatelliteStateChangeIfRequired:@"Satellite status changed"];

    v9 = [(CKCoreChatController *)self conversation];
    v10 = [v9 isStewieConversation];

    if (v10)
    {
      [(CKChatController *)self checkSuggestionsForBanner];
    }
  }
}

- (void)_presentTranscriptSharingBannerIfNecessary
{
  v3 = [MEMORY[0x1E69A5B00] sharedInstance];
  v4 = [v3 isStewieEmergencyActive];

  if (v4)
  {
    v5 = [(CKCoreChatController *)self chat];
    v6 = [v5 transcriptSharingState];

    if (!v6)
    {
      return;
    }

    v7 = [(CKChatController *)self standardSuggestionPresenter];
    v8 = [v7 suggestions];
    v9 = [v8 count];

    if (v9)
    {
      return;
    }

    v10 = [CKTranscriptSharingSuggestion bannerWithState:v6];
    [(CKChatController *)self setTranscriptSharingBannerSuggestion:v10];

    v11 = [(CKChatController *)self transcriptSharingBannerSuggestion];
    [v11 setDelegate:self];

    v16 = [(CKChatController *)self standardSuggestionPresenter];
    v12 = [(CKChatController *)self transcriptSharingBannerSuggestion];
    [v16 addSuggestion:v12];
  }

  else
  {
    v13 = [(CKChatController *)self standardSuggestionPresenter];
    v14 = [v13 suggestions];
    v15 = [v14 count];

    if (!v15)
    {
      return;
    }

    v16 = [(CKChatController *)self standardSuggestionPresenter];
    v12 = [(CKChatController *)self transcriptSharingBannerSuggestion];
    [v16 removeSuggestion:v12];
  }
}

- (void)transcriptSharingBannerWillDismiss:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self chat];
  [v5 updateTranscriptSharingState:0];

  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __55__CKChatController_transcriptSharingBannerWillDismiss___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  dispatch_async(MEMORY[0x1E69E96A0], v7);
}

void __55__CKChatController_transcriptSharingBannerWillDismiss___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  [v2 removeSuggestion:*(a1 + 40)];
}

- (void)transcriptStopSharingButtonTapped:(id)a3
{
  v4 = a3;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"TS_ALERT_TITLE_STOP_SHARING" value:&stru_1F04268F8 table:@"TranscriptSharing-SYDROB_FEATURES"];
  v7 = [CKAlertController alertControllerWithTitle:v6 message:0 preferredStyle:1];

  v8 = CKFrameworkBundle();
  v9 = [v8 localizedStringForKey:@"TS_STOP_SHARING_ACTION_ALERT" value:&stru_1F04268F8 table:@"TranscriptSharing-SYDROB_FEATURES"];
  v15 = MEMORY[0x1E69E9820];
  v16 = 3221225472;
  v17 = __54__CKChatController_transcriptStopSharingButtonTapped___block_invoke;
  v18 = &unk_1E72EC710;
  v19 = self;
  v20 = v4;
  v10 = v4;
  v11 = [CKAlertAction actionWithTitle:v9 style:2 handler:&v15];

  [v7 addAction:{v11, v15, v16, v17, v18, v19}];
  v12 = CKFrameworkBundle();
  v13 = [v12 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v14 = [CKAlertAction actionWithTitle:v13 style:1 handler:0];

  [v7 addAction:v14];
  [v7 presentFromViewController:self animated:1 completion:0];
}

void __54__CKChatController_transcriptStopSharingButtonTapped___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) chat];
  [v2 updateTranscriptSharingState:3];

  v3 = [*(a1 + 32) standardSuggestionPresenter];
  [v3 removeSuggestion:*(a1 + 40)];

  v6 = [CKTranscriptSharingSuggestion bannerWithState:3];
  [v6 setDelegate:*(a1 + 32)];
  v4 = [*(a1 + 32) standardSuggestionPresenter];
  [v4 addSuggestion:v6];

  v5 = [*(a1 + 32) chat];
  [v5 stopTranscriptSharingWithChat];
}

- (void)updateFoundInSuggestionPresenter
{
  v67 = *MEMORY[0x1E69E9840];
  v49 = [MEMORY[0x1E695DF70] array];
  v57 = 0u;
  v58 = 0u;
  v55 = 0u;
  v56 = 0u;
  v2 = [(CKCoreChatController *)self chat];
  v3 = [v2 chatItems];
  obj = [v3 reverseObjectEnumerator];

  v54 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
  if (v54)
  {
    v53 = *v56;
    v50 = *MEMORY[0x1E695C2B0];
    v5 = 20;
    *&v4 = 138412546;
    v48 = v4;
    do
    {
      for (i = 0; i != v54; ++i)
      {
        if (*v56 != v53)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v55 + 1) + 8 * i);
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & (v5 > 0)) == 1)
        {
          v8 = v7;
          v9 = [v8 message];
          v10 = [v9 guid];

          if (v10)
          {
            v11 = objc_alloc_init(MEMORY[0x1E6964E90]);
            v12 = [v8 message];
            v13 = [v12 sender];
            v14 = [v13 hasName];

            if (v14)
            {
              v15 = [v8 message];
              v16 = [v15 sender];
              v17 = [v16 name];
            }

            else
            {
              v17 = 0;
            }

            v18 = objc_alloc_init(MEMORY[0x1E695DF70]);
            v19 = [v8 message];
            v20 = [v19 sender];
            v21 = [v20 ID];

            if (v21)
            {
              v22 = [v8 message];
              v23 = [v22 sender];
              v24 = [v23 ID];
              [v18 addObject:v24];
            }

            else if (IMOSLoggingEnabled())
            {
              v25 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
              {
                v26 = [v8 message];
                *buf = v48;
                v60 = v8;
                v61 = 2112;
                v62 = v26;
                _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "sending id is nil. partChatItem: %@ =, message: %@", buf, 0x16u);
              }
            }

            v27 = [objc_alloc(MEMORY[0x1E6964E50]) initWithDisplayName:v17 handles:v18 handleIdentifier:v50];
            v65 = v27;
            v28 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v65 count:1];
            [v11 setAuthors:v28];

            if ([v8 isFromMe])
            {
              [v11 setAccountHandles:v18];
            }

            v29 = [v8 message];
            v30 = [v29 time];

            if (v30)
            {
              v31 = [v8 message];
              v32 = [v31 time];
              [v11 setContentCreationDate:v32];
            }

            v33 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(v8, "index")}];
            v34 = [MEMORY[0x1E69A7FF8] partIndexKey];
            [v11 setValue:v33 forCustomKey:v34];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v35 = [v8 text];
              v36 = [v35 string];
              v37 = [v36 copy];
              [v11 setTextContent:v37];
            }

            v38 = objc_alloc(MEMORY[0x1E6964E80]);
            v39 = [(CKCoreChatController *)self chat];
            v40 = [v39 guid];
            v41 = [v38 initWithUniqueIdentifier:v10 domainIdentifier:v40 attributeSet:v11];

            if (v41)
            {
              v42 = [MEMORY[0x1E696AAE8] mainBundle];
              v43 = [v42 bundleIdentifier];
              [v41 setBundleID:v43];

              [v49 addObject:v41];
            }
          }

          --v5;
        }

        else if (v5 < 1)
        {
          goto LABEL_33;
        }
      }

      v54 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
    }

    while (v54);
  }

  else
  {
    v5 = 20;
  }

LABEL_33:

  if (IMOSLoggingEnabled())
  {
    v44 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v44, OS_LOG_TYPE_INFO))
    {
      v45 = [v49 count];
      v46 = [(CKChatController *)self foundInSuggestionPresenter];
      *buf = 134218498;
      v60 = (20 - v5);
      v61 = 2048;
      v62 = v45;
      v63 = 2112;
      v64 = v46;
      _os_log_impl(&dword_19020E000, v44, OS_LOG_TYPE_INFO, "checkCSSearchableItemSuggestionsForBanner for %lu sliced searchables from %lu. foundInSuggestionPresenter %@", buf, 0x20u);
    }
  }

  v47 = [(CKChatController *)self foundInSuggestionPresenter];
  [v47 addSuggestionsFromSearchableItems:v49 options:0 filter:&__block_literal_global_1607];
}

id __52__CKChatController_updateFoundInSuggestionPresenter__block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x1E69E9840];
  v2 = a2;
  v14 = objc_opt_new();
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v3 = v2;
  v4 = [v3 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v4)
  {
    v5 = *v17;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(v3);
        }

        v7 = *(*(&v16 + 1) + 8 * i);
        MEMORY[0x193AF5EC0](@"SGRealtimeEvent", @"CoreSuggestions");
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
          if ([v8 state] == 4 || objc_msgSend(v8, "state") == 5)
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *buf = 0;
                _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Filtered out Duplicate event", buf, 2u);
              }

              goto LABEL_12;
            }

            goto LABEL_20;
          }

          v11 = [v8 event];
          v12 = [v11 isNaturalLanguageEvent];

          if (v12)
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *buf = 0;
                _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Filtered out Natural Language event", buf, 2u);
              }

LABEL_12:
            }

LABEL_20:

            continue;
          }

          goto LABEL_26;
        }

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
          if ([v8 updatedFields])
          {
            if (IMOSLoggingEnabled())
            {
              v10 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
              {
                *buf = 0;
                _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Filtered out Suggestions realtime contact", buf, 2u);
              }
            }

            goto LABEL_20;
          }

LABEL_26:
        }

        [v14 addObject:v7];
      }

      v4 = [v3 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v4);
  }

  return v14;
}

- (CKOnboardingController)onboardingController
{
  onboardingController = self->_onboardingController;
  if (!onboardingController)
  {
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *v8 = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Creating onboarding in CKChatController", v8, 2u);
      }
    }

    v5 = objc_alloc_init(CKOnboardingController);
    v6 = self->_onboardingController;
    self->_onboardingController = v5;

    [(CKOnboardingController *)self->_onboardingController setDelegate:self];
    onboardingController = self->_onboardingController;
  }

  return onboardingController;
}

- (id)presentingViewControllerForOnboardingController:(id)a3
{
  v11 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKChatController *)self onboardingController];

  if (v5 == v4)
  {
    v7 = self;
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v9 = 138412290;
        v10 = v4;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Unexpected instance of onboardingController %@", &v9, 0xCu);
      }
    }

    v7 = 0;
  }

  return v7;
}

- (void)onboardingControllerDidFinish:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Finishing onboarding in CKChatController", v6, 2u);
    }
  }

  [(CKChatController *)self setOnboardingController:0];
}

- (BOOL)_shouldShowNicknameOnboardingFlow
{
  if (IMSharedHelperNickNameEnabled())
  {
    v2 = [MEMORY[0x1E69A5C10] sharedInstance];
    if ([v2 iCloudSignedInToUseNicknames])
    {
      v3 = [MEMORY[0x1E69A5C10] multiplePhoneNumbersTiedToAppleID] ^ 1;
    }

    else
    {
      LOBYTE(v3) = 0;
    }
  }

  else
  {
    LOBYTE(v3) = 0;
  }

  return v3;
}

- (BOOL)showNicknameSharingOnboardingWithMemoji:(BOOL)a3
{
  v3 = a3;
  if (![(CKChatController *)self _shouldShowNicknameOnboardingFlow])
  {
    return 0;
  }

  v5 = [MEMORY[0x1E69A8108] sharedInstance];
  v6 = [v5 sharingEnabled];
  if ((v6 & 1) == 0)
  {
    v7 = [(CKChatController *)self onboardingController];
    [v7 presentNicknameSharingSetupFlowWithMemoji:v3 forUserInitiatedEdit:1];
  }

  v8 = v6 ^ 1;

  return v8;
}

- (id)_meContact
{
  v2 = [MEMORY[0x1E69A7FD0] sharedInstance];
  v3 = [MEMORY[0x1E69A7FD0] keysForNicknameHandling];
  v4 = [v2 fetchMeContactWithKeys:v3];

  return v4;
}

- (id)textDroppableView:(id)a3 proposalForDrop:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self entryView];
  if ([v6 displayMode] == 2)
  {

LABEL_4:
    v9 = 0;
    goto LABEL_8;
  }

  v7 = [(CKChatController *)self entryView];
  v8 = [v7 displayMode];

  if (v8 == 3)
  {
    goto LABEL_4;
  }

  if ([v5 isSameView])
  {
    v9 = 3;
  }

  else
  {
    v9 = 2;
  }

LABEL_8:
  v10 = [objc_alloc(MEMORY[0x1E69DD0A0]) initWithDropOperation:v9];
  [v10 setDropAction:0];
  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController textDroppableView:proposalForDrop:];
  }

  return v10;
}

- (void)textDroppableView:(id)a3 dropSessionDidEnter:(id)a4
{
  v14 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [v7 items];
      v10 = 138412546;
      v11 = v7;
      v12 = 2048;
      v13 = [v9 count];
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "textDroppableView:dropSessionDidEnter: %@ %lu", &v10, 0x16u);
    }
  }

  [(CKChatController *)self setCurrentDropSession:v7];
}

- (void)textDroppableView:(id)a3 dropSessionDidEnd:(id)a4
{
  v11 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = 138412290;
      v10 = v7;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "textDroppableView:dropSessionDidEnd: %@", &v9, 0xCu);
    }
  }

  [(CKChatController *)self setCurrentDropSession:0];
}

- (void)textPasteConfigurationSupporting:(id)a3 transformPasteItem:(id)a4
{
  v6 = a3;
  v7 = a4;
  if (!self->_dropComposition)
  {
    v8 = +[CKComposition composition];
    dropComposition = self->_dropComposition;
    self->_dropComposition = v8;
  }

  v10 = [(CKCoreChatController *)self conversation];
  v11 = objc_alloc_init(_TtC7ChatKit27CKCompositionBuilderContext);
  -[CKCompositionBuilderContext setIsInLockdownMode:](v11, "setIsInLockdownMode:", [MEMORY[0x1E69A8020] deviceIsLockedDown]);
  v12 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v13 = [v12 isExpressiveTextEnabled];

  if (v13)
  {
    v14 = [v10 chat];
    -[CKCompositionBuilderContext setSupportsExpressiveText:](v11, "setSupportsExpressiveText:", [v14 supportsCapabilities:0x100000]);
  }

  -[CKCompositionBuilderContext setConversationSupportsInlineAdaptiveImageGlyphs:](v11, "setConversationSupportsInlineAdaptiveImageGlyphs:", [v10 supportsInlineAdaptiveImageGlyphs]);
  [(CKCompositionBuilderContext *)v11 setCanUseRichTextAttributes:1];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke;
  aBlock[3] = &unk_1E72EE370;
  aBlock[4] = self;
  v15 = v7;
  v29 = v15;
  v16 = _Block_copy(aBlock);
  v17 = [(CKChatController *)self currentDropSession];
  v18 = [v17 items];
  v19 = [v18 count];

  v20 = [v15 itemProvider];
  if (v19 < 2)
  {
    v24[0] = MEMORY[0x1E69E9820];
    v24[1] = 3221225472;
    v24[2] = __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke_2;
    v24[3] = &unk_1E72ED700;
    v21 = &v25;
    v25 = v16;
    v23 = v16;
    [CKComposition requestCompositionFromItemProvider:v20 builderContext:v11 completion:v24];
  }

  else
  {
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke_1622;
    v26[3] = &unk_1E72ED700;
    v21 = &v27;
    v27 = v16;
    v22 = v16;
    [CKComposition requestCompositionFromItemProviderForNonCollaboration:v20 builderContext:v11 completion:v26];
  }
}

void __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    v5 = [*(*(a1 + 32) + 1384) compositionByAppendingComposition:v4];
    v6 = *(a1 + 32);
    v7 = *(v6 + 1384);
    *(v6 + 1384) = v5;

    if ([v4 isAudioComposition])
    {
      objc_storeStrong((*(a1 + 32) + 1384), a2);
    }

    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke_cold_1();
    }

    [*(a1 + 40) setNoResult];
  }
}

- (id)textPasteConfigurationSupporting:(id)a3 combineItemAttributedStrings:(id)a4 forRange:(id)a5
{
  v52 = *MEMORY[0x1E69E9840];
  v9 = a3;
  v10 = a4;
  v11 = a5;
  if (self->_dropComposition)
  {
    v12 = [(CKChatController *)self entryView];
    v13 = [v12 pasteBoardTextFromComposition:self->_dropComposition];

    v14 = [(CKComposition *)self->_dropComposition isAudioComposition];
    if (v14)
    {
    }

    else if (v13)
    {
      dropComposition = self->_dropComposition;
      self->_dropComposition = 0;

      goto LABEL_25;
    }

    v20 = [(CKComposition *)self->_dropComposition shelfPluginPayload];
    if (v20)
    {
    }

    else
    {
      v21 = [(CKComposition *)self->_dropComposition shelfMediaObject];
      v22 = v21 == 0;

      if (v22 & ~v14)
      {
LABEL_24:
        v13 = 0;
        goto LABEL_25;
      }
    }

    v41 = 0;
    v42 = &v41;
    v43 = 0x3032000000;
    v44 = __Block_byref_object_copy__8;
    v45 = __Block_byref_object_dispose__8;
    v23 = [(CKChatController *)self entryView];
    v46 = [v23 composition];

    v37 = 0;
    v38 = &v37;
    v39 = 0x2020000000;
    v24 = [v42[5] shelfPluginPayload];
    v25 = v24 != 0;

    v40 = v25;
    v26 = v38;
    v27 = *(v38 + 24);
    if (v14 && (v38[3] & 1) == 0)
    {
      v27 = [v42[5] hasContent];
      v26 = v38;
    }

    *(v26 + 24) = v27 & 1;
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke;
    aBlock[3] = &unk_1E72EE3C0;
    aBlock[4] = self;
    aBlock[5] = &v37;
    aBlock[6] = &v41;
    v28 = _Block_copy(aBlock);
    v29 = v28;
    if (*(v38 + 24) == 1)
    {
      v34[0] = MEMORY[0x1E69E9820];
      v34[1] = 3221225472;
      v34[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_3;
      v34[3] = &unk_1E72EBDB8;
      v35 = v28;
      v32[0] = MEMORY[0x1E69E9820];
      v32[1] = 3221225472;
      v32[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_4;
      v32[3] = &unk_1E72EBDB8;
      v33 = v35;
      [(CKChatController *)self presentReplaceCompositionAlertWithConfirmationBlock:v34 cancelBlock:v32];
    }

    else
    {
      (*(v28 + 2))(v28, 1);
    }

    _Block_object_dispose(&v37, 8);
    _Block_object_dispose(&v41, 8);

    goto LABEL_24;
  }

  v13 = objc_alloc_init(MEMORY[0x1E696AD40]);
  v47 = 0u;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v15 = v10;
  v16 = [v15 countByEnumeratingWithState:&v47 objects:v51 count:16];
  if (v16)
  {
    v17 = *v48;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v48 != v17)
        {
          objc_enumerationMutation(v15);
        }

        [v13 appendAttributedString:*(*(&v47 + 1) + 8 * i)];
      }

      v16 = [v15 countByEnumeratingWithState:&v47 objects:v51 count:16];
    }

    while (v16);
  }

LABEL_25:
  v30 = IMLogHandleForCategory();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController textPasteConfigurationSupporting:a2 combineItemAttributedStrings:? forRange:?];
  }

  return v13;
}

void __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke(uint64_t a1, char a2)
{
  if (*(*(*(a1 + 40) + 8) + 24) != 1 || (a2 & 1) != 0)
  {
    v5 = *(*(a1 + 48) + 8);
    v6 = *(v5 + 40);
    v7 = *(*(a1 + 32) + 1384);
    if (v6)
    {
      v8 = [v6 compositionByAppendingComposition:v7];
      v9 = *(*(a1 + 48) + 8);
      v10 = *(v9 + 40);
      *(v9 + 40) = v8;
    }

    else
    {
      v11 = v7;
      v10 = *(v5 + 40);
      *(v5 + 40) = v11;
    }

    if ([*(*(a1 + 32) + 1384) isAudioComposition])
    {
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), *(*(a1 + 32) + 1384));
    }

    objc_initWeak(&location, *(a1 + 32));
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_2;
    block[3] = &unk_1E72EE398;
    objc_copyWeak(&v15, &location);
    block[4] = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], block);
    v12 = *(a1 + 32);
    v13 = *(v12 + 1384);
    *(v12 + 1384) = 0;

    objc_destroyWeak(&v15);
    objc_destroyWeak(&location);
  }

  else
  {
    v3 = *(a1 + 32);
    v4 = *(v3 + 1384);
    *(v3 + 1384) = 0;
  }
}

void __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained entryView];
  [v2 setComposition:*(*(*(a1 + 32) + 8) + 40)];
}

uint64_t __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_4(uint64_t a1)
{
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Do not replace composition, return.", v4, 2u);
    }
  }

  return (*(*(a1 + 32) + 16))();
}

- (id)textPasteConfigurationSupporting:(id)a3 performPasteOfAttributedString:(id)a4 toRange:(id)a5
{
  v8 = a3;
  [v8 handlePastedString:a4 toRange:a5];
  v9 = IMLogHandleForCategory();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController textPasteConfigurationSupporting:a2 performPasteOfAttributedString:? toRange:?];
  }

  v10 = [v8 selectedTextRange];

  return v10;
}

- (void)_dragInteractionDidCancelLiftWithoutDragging:(id)a3
{
  v4 = a3;
  WeakRetained = objc_loadWeakRetained(&self->_currentDragPreviewContainer);

  if (WeakRetained)
  {
    v6 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:v4];
    if (v6)
    {
      v7 = [(CKChatController *)self collectionView];
      [v7 setScrollEnabled:0];

      v8 = objc_loadWeakRetained(&self->_currentDragPreviewContainer);
      v9[0] = MEMORY[0x1E69E9820];
      v9[1] = 3221225472;
      v9[2] = __65__CKChatController__dragInteractionDidCancelLiftWithoutDragging___block_invoke;
      v9[3] = &unk_1E72EB8D0;
      v9[4] = self;
      v10 = v4;
      [v8 _animateLiftCancellationAlongsideAnimator:0 completion:v9];

      objc_storeWeak(&self->_currentDragPreviewContainer, 0);
    }
  }
}

void __65__CKChatController__dragInteractionDidCancelLiftWithoutDragging___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionView];
  [v2 setScrollEnabled:1];

  v3 = [*(a1 + 32) _transcriptStickerCellContainingInteraction:*(a1 + 40)];
  if (v3)
  {
    v4 = v3;
    [v3 setStickerViewHidden:0];
    v3 = v4;
  }
}

- (void)_dragInteraction:(id)a3 prepareForSession:(id)a4 completion:(id)a5
{
  v9 = a3;
  v6 = a5;
  v7 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v8 = [v7 isStickerRepositioningEnabled];

  if (v8)
  {
    [v9 _setLiftMoveHysteresis:0.0];
  }

  v6[2](v6);
}

- (id)_dragInteraction:(id)a3 sessionPropertiesForSession:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = objc_alloc_init(MEMORY[0x1E69DD480]);
  v9 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v10 = [v9 isStickerRepositioningEnabled];

  if (v10 && [v7 hasItemsConformingToTypeIdentifiers:&unk_1F04E6840])
  {
    [v8 set_wantsElasticEffects:1];
    [v8 set_resizable:1];
    [v8 set_rotatable:1];
    v11 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:v6];
    if (v11)
    {
      v12 = [(CKCoreChatController *)self collectionViewController];
      v13 = [v12 chatItemForCell:v11];

      if (v13 && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
      {
        v14 = MEMORY[0x1E69A82C0];
        v15 = v13;
        v16 = [(CKChatController *)self collectionView];
        [v16 bounds];
        [v14 calculatedRecentsItemWidthFromStickersUltraExtensionForStickerChatItem:v15 collectionViewWidth:v17];
        v19 = v18;
        v21 = v20;
      }

      else
      {
        v21 = 48.0;
        v19 = 48.0;
      }
    }

    else
    {
      v21 = 48.0;
      v19 = 48.0;
    }

    [v8 set_minimumResizableSize:{v19, v21}];
    v22 = +[CKUIBehavior sharedBehaviors];
    [v22 stickerDropPreviewMaxDimension];
    v24 = v23;
    v25 = +[CKUIBehavior sharedBehaviors];
    [v25 stickerDropPreviewMaxDimension];
    [v8 set_maximumResizableSize:{v24, v26}];
  }

  return v8;
}

- (BOOL)dragInteraction:(id)a3 sessionIsRestrictedToDraggingApplication:(id)a4
{
  v16 = *MEMORY[0x1E69E9840];
  v4 = a4;
  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  LODWORD(v6) = [v5 isStickerRepositioningEnabled];

  if (v6)
  {
    v13 = 0u;
    v14 = 0u;
    v11 = 0u;
    v12 = 0u;
    v7 = [v4 items];
    v6 = [v7 countByEnumeratingWithState:&v11 objects:v15 count:16];
    if (v6)
    {
      v8 = *v12;
      while (2)
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v12 != v8)
          {
            objc_enumerationMutation(v7);
          }

          if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(*(&v11 + 1) + 8 * i)])
          {
            LOBYTE(v6) = 1;
            goto LABEL_12;
          }
        }

        v6 = [v7 countByEnumeratingWithState:&v11 objects:v15 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  return v6;
}

- (id)dragInteraction:(id)a3 itemsForAddingToSession:(id)a4 withTouchAtPoint:(CGPoint)a5
{
  v29 = *MEMORY[0x1E69E9840];
  v7 = a3;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v8 = [a4 items];
  v9 = [v8 countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v24;
    v12 = MEMORY[0x1E695E0F0];
LABEL_3:
    v13 = 0;
    while (1)
    {
      if (*v24 != v11)
      {
        objc_enumerationMutation(v8);
      }

      if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(*(&v23 + 1) + 8 * v13)])
      {
        break;
      }

      if (v10 == ++v13)
      {
        v10 = [v8 countByEnumeratingWithState:&v23 objects:v28 count:16];
        if (v10)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }
  }

  else
  {
LABEL_9:

    [(CKChatController *)self _dragItemsForInteraction:v7];
    v19 = 0u;
    v20 = 0u;
    v21 = 0u;
    v8 = v22 = 0u;
    v14 = [v8 countByEnumeratingWithState:&v19 objects:v27 count:16];
    if (v14)
    {
      v15 = v14;
      v16 = *v20;
      while (2)
      {
        for (i = 0; i != v15; ++i)
        {
          if (*v20 != v16)
          {
            objc_enumerationMutation(v8);
          }

          if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:{*(*(&v19 + 1) + 8 * i), v19}])
          {

            v12 = MEMORY[0x1E695E0F0];
            goto LABEL_19;
          }
        }

        v15 = [v8 countByEnumeratingWithState:&v19 objects:v27 count:16];
        if (v15)
        {
          continue;
        }

        break;
      }
    }

    v8 = v8;
    v12 = v8;
  }

LABEL_19:

  return v12;
}

- (id)dragInteraction:(id)a3 previewForLiftingItem:(id)a4 session:(id)a5
{
  v7 = a3;
  v8 = a4;
  v9 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  if (![v9 isStickerRepositioningEnabled])
  {

LABEL_13:
    v29 = [v8 localObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if ((isKindOfClass & 1) == 0)
    {
      v25 = 0;
      goto LABEL_47;
    }

    v12 = [v8 localObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v31 = [v12 stackView];
      v32 = [v31 currentAssetReference];
      v33 = [v31 regionOfInterestForAssetReference:v32];
      v25 = [v33 placeholderViewFactory];
      if (v25)
      {
        v83 = v7;
        v34 = [v33 placeholderViewFactory];
        v35 = (v34)[2](v34, v33);

        if (v35)
        {
          v36 = [(CKChatController *)self view];
          [v33 rectInCoordinateSpace:v36];
          v79 = v38;
          v81 = v37;
          v75 = v40;
          v77 = v39;

          v41 = objc_alloc(MEMORY[0x1E69DCE38]);
          v42 = [(CKChatController *)self view];
          v43 = *(MEMORY[0x1E695F058] + 16);
          if (CKMainScreenScale_once_12 != -1)
          {
            v74 = *(MEMORY[0x1E695F058] + 16);
            [CKChatController dragInteraction:previewForLiftingItem:session:];
            v43 = v74;
          }

          v44 = CKMainScreenScale_sMainScreenScale_12;
          if (*&CKMainScreenScale_sMainScreenScale_12 == 0.0)
          {
            *&v44 = 1.0;
          }

          v45.f64[0] = v77;
          v45.f64[1] = v75;
          __asm { FMOV            V2.2D, #0.5 }

          v51 = vmulq_f64(vsubq_f64(v45, v43), _Q2);
          _Q2.f64[0] = v81;
          _Q2.f64[1] = v79;
          v52 = [v41 initWithContainer:v42 center:{vdivq_f64(vrndmq_f64(vmulq_n_f64(vaddq_f64(_Q2, v51), *&v44)), vdupq_lane_s64(v44, 0)), *&v74}];

          v53 = objc_alloc_init(MEMORY[0x1E69DCE28]);
          v25 = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:v35 parameters:v53 target:v52];
        }

        else
        {
          v25 = 0;
        }

        v7 = v83;
      }
    }

    else
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0 || ![v12 shouldProvideDragPreview])
      {
        goto LABEL_45;
      }

      v31 = [(CKChatController *)self dragPreviewParametersForBalloonView:v12];
      v54 = objc_alloc(MEMORY[0x1E69DCE38]);
      v55 = [v12 superview];
      [v12 frame];
      v60 = *(MEMORY[0x1E695F058] + 16);
      if (CKMainScreenScale_once_12 != -1)
      {
        v82 = v57;
        v84 = v56.f64[0];
        v78 = v59;
        v80 = v58.f64[0];
        v76 = *(MEMORY[0x1E695F058] + 16);
        [CKChatController dragInteraction:previewForLiftingItem:session:];
        v60 = v76;
        v59 = v78;
        v58.f64[0] = v80;
        v57 = v82;
        v56.f64[0] = v84;
      }

      *&v61 = 1.0;
      if (*&CKMainScreenScale_sMainScreenScale_12 != 0.0)
      {
        v61 = CKMainScreenScale_sMainScreenScale_12;
      }

      v58.f64[1] = v59;
      v62 = vsubq_f64(v58, v60);
      __asm { FMOV            V2.2D, #0.5 }

      v56.f64[1] = v57;
      v32 = [v54 initWithContainer:v55 center:{vdivq_f64(vrndmq_f64(vmulq_n_f64(vaddq_f64(v56, vmulq_f64(v62, _Q2)), *&v61)), vdupq_lane_s64(v61, 0))}];

      v64 = [v12 attachmentBalloonViewPreview];
      v65 = v64;
      if (v64)
      {
        v66 = v64;
      }

      else
      {
        v66 = v12;
      }

      v33 = v66;

      v25 = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:v33 parameters:v31 target:v32];
    }

    if (v25)
    {
      goto LABEL_46;
    }

LABEL_45:
    [v12 setCanUseOpaqueMask:0];
    [v12 prepareForDisplayIfNeeded];
    v72 = [(CKChatController *)self dragPreviewParametersForBalloonView:v12];
    v25 = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:v12 parameters:v72];

    goto LABEL_46;
  }

  v10 = [MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:v8];

  if (!v10)
  {
    goto LABEL_13;
  }

  v11 = [v8 localObject];
  v12 = [v11 objectForKey:@"kStickerDragItemImageViewKey"];

  if (v12)
  {
    v13 = objc_alloc_init(MEMORY[0x1E69DC9A0]);
    v14 = objc_alloc_init(MEMORY[0x1E69DC728]);
    [v13 setShadowPath:v14];

    v15 = [MEMORY[0x1E69DC888] clearColor];
    [v13 setBackgroundColor:v15];

    v16 = MEMORY[0x193AF5EC0](@"_MSStickerDragPreviewContainerView", @"Messages");
    if (v16 && (objc_opt_respondsToSelector() & 1) != 0)
    {
      v17 = [v16 shadowPropertiesForDrag];
      if (v17 && (objc_opt_respondsToSelector() & 1) != 0)
      {
        [v13 _setShadowProperties:v17];
      }
    }

    v18 = [v12 superview];
    [v12 center];
    [v18 convertPoint:v18 toView:?];
    v20 = v19;
    v22 = v21;
    v23 = objc_alloc(MEMORY[0x1E69DC9A8]);
    [(CKChatController *)self stickerPreviewTransform];
    v24 = [v23 initWithContainer:v18 center:v85 transform:{v20, v22}];
    v25 = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:v12 parameters:v13 target:v24];
    v26 = [[v16 alloc] initWithIsDropAnimation:0];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v27 = v7;
      v28 = [v12 currentFrameIndex];
    }

    else
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
LABEL_37:
        [v25 _setPreviewContainer:v26];
        [(CKChatController *)self setCurrentDragPreviewContainer:v26];
        v69 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:v7];
        if (v69)
        {
          v70 = v7;
          v71 = IMLogHandleForCategory();
          if (os_log_type_enabled(v71, OS_LOG_TYPE_DEBUG))
          {
            [CKChatController dragInteraction:previewForLiftingItem:session:];
          }

          [v69 setGestureRecognizersEnabled:0];
          v7 = v70;
        }

        goto LABEL_46;
      }

      v27 = v7;
      v67 = v12;
      v28 = 0;
    }

    [(CKChatController *)self setInitialFrameIndexForCurrentDrag:v28];
    v68 = [v12 image];

    [v26 setImage:v68];
    v7 = v27;
    goto LABEL_37;
  }

  v25 = 0;
LABEL_46:

LABEL_47:

  return v25;
}

- (void)dragInteraction:(id)a3 sessionWillBegin:(id)a4
{
  v11 = a3;
  [(CKChatController *)self setDragSession:a4];
  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  v6 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v7 = [v6 isStickerRepositioningEnabled];

  v8 = v11;
  if (v7)
  {
    v9 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:v11];
    v10 = v9;
    if (v9)
    {
      [v9 setHidden:1];
      [v10 setStickerViewHidden:1];
    }

    v8 = v11;
  }
}

- (void)dragInteraction:(id)a3 session:(id)a4 didEndWithOperation:(unint64_t)a5
{
  v6 = a3;
  [(CKChatController *)self setDragSession:0];
  [(CKChatController *)self setCurrentDragPreviewContainer:0];
  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  v7 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:v6];

  if (v7)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dragInteraction:session:didEndWithOperation:];
    }

    [v7 setGestureRecognizersEnabled:1];
  }
}

- (id)dragInteraction:(id)a3 previewForCancellingItem:(id)a4 withDefault:(id)a5
{
  v7 = a3;
  v8 = a5;
  v9 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v10 = [v9 isStickerRepositioningEnabled];

  if (v10)
  {
    v11 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:v7];
    v12 = v11;
    if (v11)
    {
      v13 = [v11 associatedItemView];
      v14 = [(CKChatController *)self view];
      [v13 frameInView:v14];
      v16 = v15;
      v18 = v17;
      v20 = v19;
      v22 = v21;

      v23 = v16 + v20 * 0.5;
      v34 = 0u;
      v35 = 0u;
      v24 = v18 + v22 * 0.5;
      v33 = 0u;
      v25 = [v12 associatedItemView];
      v26 = v25;
      if (v25)
      {
        [v25 transform];
      }

      else
      {
        v34 = 0u;
        v35 = 0u;
        v33 = 0u;
      }

      v28 = objc_alloc(MEMORY[0x1E69DC9A8]);
      v29 = [(CKChatController *)self view];
      v32[0] = v33;
      v32[1] = v34;
      v32[2] = v35;
      v30 = [v28 initWithContainer:v29 center:v32 transform:{v23, v24}];
      v27 = [v8 retargetedPreviewWithTarget:v30];
    }

    else
    {
      v27 = 0;
    }
  }

  else
  {
    v27 = 0;
  }

  return v27;
}

- (void)dragInteraction:(id)a3 item:(id)a4 willAnimateCancelWithAnimator:(id)a5
{
  v7 = a3;
  v8 = a5;
  v9 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v10 = [v9 isStickerRepositioningEnabled];

  if (v10)
  {
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __71__CKChatController_dragInteraction_item_willAnimateCancelWithAnimator___block_invoke;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [v8 addAnimations:v14];
    v11 = [(CKChatController *)self collectionView];
    [v11 setScrollEnabled:0];

    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __71__CKChatController_dragInteraction_item_willAnimateCancelWithAnimator___block_invoke_2;
    v12[3] = &unk_1E72EE3E8;
    v12[4] = self;
    v13 = v7;
    [v8 addCompletion:v12];
  }
}

void __71__CKChatController_dragInteraction_item_willAnimateCancelWithAnimator___block_invoke_2(uint64_t a1, uint64_t a2)
{
  if (!a2)
  {
    v4 = [*(a1 + 32) collectionView];
    [v4 setScrollEnabled:1];

    v5 = [*(a1 + 32) _transcriptStickerCellContainingInteraction:*(a1 + 40)];
    if (v5)
    {
      v6 = v5;
      [v5 setHidden:0];
      [v6 setStickerViewHidden:0];
      v5 = v6;
    }
  }
}

- (id)_dragItemsForInteraction:(id)a3
{
  v4 = a3;
  if (-[CKChatController isShowingOscarChat](self, "isShowingOscarChat") || (+[CKUIBehavior sharedBehaviors](CKUIBehavior, "sharedBehaviors"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 disableTranscriptInteractions], v5, (v6 & 1) != 0))
  {
    v7 = 0;
    goto LABEL_12;
  }

  v8 = [(CKChatController *)self collectionView];
  v9 = [v8 visibleCells];

  v10 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v11 = [v10 isStickerRepositioningEnabled];

  if (!v11)
  {
    goto LABEL_7;
  }

  v7 = [(CKChatController *)self _dragItemsIfRepositioningForInteraction:v4];
  if (![v7 count])
  {

LABEL_7:
    v30 = 0;
    v31 = &v30;
    v32 = 0x3032000000;
    v33 = __Block_byref_object_copy__8;
    v34 = __Block_byref_object_dispose__8;
    v35 = 0;
    v24 = 0;
    v25 = &v24;
    v26 = 0x3032000000;
    v27 = __Block_byref_object_copy__8;
    v28 = __Block_byref_object_dispose__8;
    v29 = 0;
    v16 = MEMORY[0x1E69E9820];
    v17 = 3221225472;
    v18 = __45__CKChatController__dragItemsForInteraction___block_invoke;
    v19 = &unk_1E72EE410;
    v20 = v4;
    v21 = self;
    v22 = &v30;
    v23 = &v24;
    [v9 enumerateObjectsUsingBlock:&v16];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = 0;
    }

    else
    {
      v12 = [(CKCoreChatController *)self collectionViewController:v16];
      v13 = [v12 chatItems];
      v14 = [v13 objectAtIndex:{objc_msgSend(v31[5], "item")}];

      v7 = [(CKChatController *)self _dragItemsFromChatItem:v14 balloonView:v25[5]];
    }

    _Block_object_dispose(&v24, 8);
    _Block_object_dispose(&v30, 8);
  }

LABEL_12:

  return v7;
}

void __45__CKChatController__dragItemsForInteraction___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v14 = a2;
  if (objc_opt_respondsToSelector())
  {
    v6 = [v14 balloonView];
    if (objc_opt_respondsToSelector())
    {
      v7 = [v14 isReplyContextPreview] ^ 1;
    }

    else
    {
      v7 = 1;
    }

    v8 = [v6 interactions];
    v9 = [v8 containsObject:*(a1 + 32)];

    if (v9 && v7)
    {
      v10 = [*(a1 + 40) collectionView];
      v11 = [v10 indexPathForCell:v14];
      v12 = *(*(a1 + 48) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;

      objc_storeStrong((*(*(a1 + 56) + 8) + 40), v6);
      *a4 = 1;
    }
  }
}

- (id)_itemProvidersFromDragItems:(id)a3
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = v3;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        v10 = [*(*(&v13 + 1) + 8 * i) itemProvider];
        [v4 addObject:v10];
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = [v4 copy];

  return v11;
}

- (id)_dragItemsFromChatItem:(id)a3 balloonView:(id)a4
{
  v25[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    v13 = [MEMORY[0x1E695DEC8] array];
    goto LABEL_21;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = [(CKCoreChatController *)self collectionViewController];
    v9 = [v8 balloonViewForChatItem:v6];

    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      v11 = [v9 currentAssetChatItem];
      v12 = [v11 dragItemProvider];
    }

    else
    {
      v12 = 0;
    }

    v18 = isKindOfClass ^ 1;

    if (v12)
    {
LABEL_12:
      v19 = [objc_alloc(MEMORY[0x1E69DC990]) initWithItemProvider:v12];
      [v19 setLocalObject:v7];
      if (v18)
      {
        objc_initWeak(&location, self);
        v21[0] = MEMORY[0x1E69E9820];
        v21[1] = 3221225472;
        v21[2] = __55__CKChatController__dragItemsFromChatItem_balloonView___block_invoke_2;
        v21[3] = &unk_1E72EE438;
        objc_copyWeak(&v23, &location);
        v22 = v7;
        [v19 setPreviewProvider:v21];

        objc_destroyWeak(&v23);
        objc_destroyWeak(&location);
      }

      v25[0] = v19;
      v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:1];

      goto LABEL_20;
    }
  }

  else
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v6;
      v15 = [MEMORY[0x1E69A5B80] sharedInstance];
      v16 = [v14 transferGUID];
      v17 = [v15 transferForGUID:v16];

      if ([v17 commSafetySensitive])
      {

        v13 = 0;
        goto LABEL_21;
      }

      v12 = [v14 dragItemProvider];
      if ([v7 isAudioMessage])
      {
        [v12 registerItemForTypeIdentifier:@"com.apple.messages.audioMessage" loadHandler:&__block_literal_global_1664];
      }
    }

    else
    {
      v12 = [v6 dragItemProvider];
    }

    v18 = 1;
    if (v12)
    {
      goto LABEL_12;
    }
  }

  v13 = 0;
LABEL_20:

LABEL_21:

  return v13;
}

void __55__CKChatController__dragItemsFromChatItem_balloonView___block_invoke(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = MEMORY[0x1E695DEF0];
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

id __55__CKChatController__dragItemsFromChatItem_balloonView___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));

  if (WeakRetained)
  {
    v3 = objc_loadWeakRetained((a1 + 40));
    v4 = [v3 dragPreviewParametersForBalloonView:*(a1 + 32)];

    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && [*(a1 + 32) shouldProvideDragPreview])
    {
      v5 = [*(a1 + 32) attachmentBalloonViewPreview];
      v6 = v5;
      if (!v5)
      {
        v6 = *(a1 + 32);
      }

      v7 = v6;

      v8 = [objc_alloc(MEMORY[0x1E69DC998]) initWithView:v7 parameters:v4];
    }

    else
    {
      v8 = [objc_alloc(MEMORY[0x1E69DC998]) initWithView:*(a1 + 32) parameters:v4];
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (id)dragPreviewParametersForBalloonView:(id)a3
{
  v3 = a3;
  v4 = objc_alloc_init(MEMORY[0x1E69DC9A0]);
  v5 = [v3 bezierPathForDragPreview];
  if (v5)
  {
    [v4 setVisiblePath:v5];
    [v4 setShadowPath:v5];
  }

  else
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      [CKChatController dragPreviewParametersForBalloonView:];
    }
  }

  return v4;
}

- (BOOL)dropInteraction:(id)a3 canHandleSession:(id)a4
{
  v38 = *MEMORY[0x1E69E9840];
  v5 = a4;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  v6 = [v5 items];
  v7 = [v6 countByEnumeratingWithState:&v32 objects:v37 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v33;
LABEL_3:
    v10 = 0;
    while (1)
    {
      if (*v33 != v9)
      {
        objc_enumerationMutation(v6);
      }

      v11 = [*(*(&v32 + 1) + 8 * v10) itemProvider];
      v12 = [v11 hasItemConformingToTypeIdentifier:@"com.apple.messages.audioMessage"];

      if (v12)
      {
        goto LABEL_27;
      }

      if (v8 == ++v10)
      {
        v8 = [v6 countByEnumeratingWithState:&v32 objects:v37 count:16];
        if (v8)
        {
          goto LABEL_3;
        }

        break;
      }
    }
  }

  v13 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v14 = [v13 isStickerRepositioningEnabled];

  if (v14)
  {
    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v6 = [v5 items];
    v15 = [v6 countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (v15)
    {
      v16 = v15;
      v17 = *v29;
LABEL_12:
      v18 = 0;
      while (1)
      {
        if (*v29 != v17)
        {
          objc_enumerationMutation(v6);
        }

        if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(*(&v28 + 1) + 8 * v18)])
        {
          break;
        }

        if (v16 == ++v18)
        {
          v16 = [v6 countByEnumeratingWithState:&v28 objects:v36 count:16];
          if (v16)
          {
            goto LABEL_12;
          }

          goto LABEL_18;
        }
      }

LABEL_27:
      v26 = 1;
      goto LABEL_32;
    }

LABEL_18:
  }

  v6 = [v5 localDragSession];
  v19 = [(CKChatController *)self dragSession];

  v20 = [v6 localContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v21 = v20;
  }

  else
  {
    v21 = 0;
  }

  v22 = v21;
  v23 = [v22 isEqualToString:@"CKConversationListDragContext"];
  v24 = [v22 isEqualToString:@"CKMessageEntryContentViewDragContext"];

  if (v6 && (v6 == v19) | v23 & 1 | v24 & 1)
  {
    v25 = IMLogHandleForCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:canHandleSession:];
    }

    v26 = 0;
  }

  else
  {
    v25 = IMLogHandleForCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:canHandleSession:];
    }

    v26 = 1;
  }

LABEL_32:
  return v26;
}

- (void)dropInteraction:(id)a3 sessionDidEnter:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self dropSession];

  v7 = IMLogHandleForCategory();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG);
  if (v6 == v5)
  {
    if (v8)
    {
      [CKChatController dropInteraction:sessionDidEnter:];
    }
  }

  else
  {
    if (v8)
    {
      [CKChatController dropInteraction:sessionDidEnter:];
    }

    [(CKChatController *)self setDropSession:v5];
    [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  }
}

- (id)dropInteraction:(id)a3 sessionDidUpdate:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self entryView];
  if ([v8 displayMode] == 2)
  {

LABEL_4:
    v11 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:0];
    goto LABEL_5;
  }

  v9 = [(CKChatController *)self entryView];
  v10 = [v9 displayMode];

  if (v10 == 3)
  {
    goto LABEL_4;
  }

  v29 = [(CKChatController *)self entryView];
  v30 = [v29 window];

  if (v30)
  {
    v11 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:2];
    v12 = 1;
    goto LABEL_6;
  }

  if (IMOSLoggingEnabled())
  {
    v32 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      *v34 = 0;
      _os_log_impl(&dword_19020E000, v32, OS_LOG_TYPE_INFO, "Drop proposal is forbidden because the entry view is not in a window. UIDragPreviewTarget requires that its container (the entry view in this case) be in a window.", v34, 2u);
    }
  }

  v11 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
  v33 = IMLogHandleForCategory();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:sessionDidUpdate:];
  }

LABEL_5:
  v12 = 0;
LABEL_6:
  if (!-[CKChatController _dropSessionIsNewSticker:](self, "_dropSessionIsNewSticker:", v7) && ![MEMORY[0x1E69A82C0] dropSessionIsRepositioningSticker:v7])
  {
    v19 = v11;
    goto LABEL_31;
  }

  v13 = [(CKChatController *)self _selectedBalloonFromTouchForDropSession:v7];
  if (v13)
  {
    v14 = [(CKCoreChatController *)self collectionViewController];
    v15 = [v14 chatItems];
    v16 = [v15 objectAtIndex:{objc_msgSend(v13, "row")}];

    if (([v16 canAttachStickers] & 1) == 0)
    {
      v17 = IMLogHandleForCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        [CKChatController dropInteraction:sessionDidUpdate:];
      }

      v18 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
      v12 = 0;
      v11 = v18;
    }

    v19 = v11;

    v11 = v14;
  }

  else
  {
    v20 = IMLogHandleForCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:sessionDidUpdate:];
    }

    v19 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
  }

  v21 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v22 = [v21 isStickerRepositioningEnabled];

  if (!v22)
  {
    [v19 _setPreferredBadgeStyle:1];

    if (!v12)
    {
      goto LABEL_31;
    }

    goto LABEL_27;
  }

  v23 = [(CKChatController *)self _originalIndexPathForRepositioningDropSession:v7];
  if (v23)
  {
    v24 = [v13 section];
    if (v24 != [v23 section] || (v25 = objc_msgSend(v13, "item"), v25 != objc_msgSend(v23, "item")))
    {
      v26 = IMLogHandleForCategory();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        [CKChatController dropInteraction:sessionDidUpdate:];
      }

      v27 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
      [(CKChatController *)self _clearBalloonViewOverlaysWithAnimation:1];
      LOBYTE(v12) = 0;
      v19 = v27;
    }
  }

  [v19 _setPreferredBadgeStyle:1];
  if (v12)
  {
LABEL_27:
    v28 = [(CKChatController *)self _selectedBalloonFromTouchForDropSession:v7];
    [(CKChatController *)self _setOverlayForBalloonViewAtIndexPath:v28 animated:1];
  }

LABEL_31:

  return v19;
}

- (void)dropInteraction:(id)a3 performDrop:(id)a4
{
  v5 = a4;
  v6 = IMLogHandleForCategory();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:performDrop:];
  }

  if (-[CKChatController _dropSessionIsNewSticker:](self, "_dropSessionIsNewSticker:", v5) || [MEMORY[0x1E69A82C0] dropSessionIsRepositioningSticker:v5] && (objc_msgSend(MEMORY[0x1E69A8070], "sharedFeatureFlags"), v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isStickerRepositioningEnabled"), v7, v8))
  {
    [(CKChatController *)self _sendNewStickerFromDropSession:v5];
  }

  else
  {
    v9 = [v5 items];
    v10 = [(CKChatController *)self _itemProvidersFromDragItems:v9];

    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:v10 performDrop:?];
    }

    if ([v10 count])
    {
      [(CKChatController *)self appendCompositionFromItemProviders:v10];
    }
  }
}

- (void)dropInteraction:(id)a3 item:(id)a4 willAnimateDropWithAnimator:(id)a5
{
  v6 = a5;
  v7 = IMLogHandleForCategory();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:item:willAnimateDropWithAnimator:];
  }

  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke;
  v10[3] = &unk_1E72EBA18;
  v10[4] = self;
  [v6 addAnimations:v10];
  v8 = [(CKChatController *)self collectionView];
  [v8 setScrollEnabled:0];

  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke_2;
  v9[3] = &unk_1E72ED838;
  v9[4] = self;
  [v6 addCompletion:v9];
}

void __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) collectionView];
  [v1 setScrollEnabled:1];

  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_DEBUG))
  {
    __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke_2_cold_1();
  }
}

- (void)dropInteraction:(id)a3 concludeDrop:(id)a4
{
  v4 = IMLogHandleForCategory();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:concludeDrop:];
  }
}

- (void)dropInteraction:(id)a3 sessionDidEnd:(id)a4
{
  v5 = IMLogHandleForCategory();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:sessionDidEnd:];
  }

  [(CKChatController *)self setDropSession:0];
  v6 = [(CKCoreChatController *)self inputController];
  [v6 stickerDropAnimationFinished];

  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
}

- (id)dropInteraction:(id)a3 previewForDroppingItem:(id)a4 withDefault:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:previewForDroppingItem:withDefault:];
  }

  if ([MEMORY[0x1E69A82C0] dragItemIsSticker:v9] || (objc_msgSend(MEMORY[0x1E69A8070], "sharedFeatureFlags"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "isStickerRepositioningEnabled"), v13, v14) && objc_msgSend(MEMORY[0x1E69A82C0], "dragItemIsRepositioningSticker:", v9))
  {
    v12 = [(CKChatController *)self _stickerDragPreviewForDragItem:v9 defaultPreview:v10];
  }

  else
  {
    v15 = [(CKChatController *)self entryView];
    v16 = [v15 window];

    if (v16)
    {
      v17 = [(CKChatController *)self dropSession];
      v18 = [(CKChatController *)self view];
      [v17 locationInView:v18];
      v20 = v19;
      v22 = v21;

      v23 = IMLogHandleForCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
      {
        [CKChatController dropInteraction:previewForDroppingItem:withDefault:];
      }

      v24 = objc_alloc(MEMORY[0x1E69DC9A8]);
      CGAffineTransformMakeScale(&v29, 0.00000011920929, 0.00000011920929);
      v25 = [v24 initWithContainer:v15 center:&v29 transform:{v20, v22}];
      v12 = [v10 retargetedPreviewWithTarget:v25];
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v26 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29.a) = 0;
          _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Drop preview generation failed because the entry view is not in a window. UIDragPreviewTarget requires that its container (the entry view in this case) be in a window.", &v29, 2u);
        }
      }

      v12 = 0;
    }

    v27 = IMLogHandleForCategory();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:previewForDroppingItem:withDefault:];
    }
  }

  return v12;
}

- (BOOL)_dropSessionIsTargetingEntryView:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self entryView];
  v6 = [v5 contentView];
  v7 = [v6 textView];

  [v4 locationInView:v7];
  v9 = v8;
  v11 = v10;

  [v7 bounds];
  v13.x = v9;
  v13.y = v11;
  LOBYTE(v5) = CGRectContainsPoint(v14, v13);

  return v5;
}

- (void)_clearBalloonViewOverlaysWithAnimation:(BOOL)a3
{
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 collectionView];

  v6 = [v5 visibleCells];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __59__CKChatController__clearBalloonViewOverlaysWithAnimation___block_invoke;
  v7[3] = &__block_descriptor_33_e63_v32__0__UICollectionViewCell_CKTranscriptCellProtocol__8Q16_B24l;
  v8 = a3;
  [v6 enumerateObjectsUsingBlock:v7];
}

void __59__CKChatController__clearBalloonViewOverlaysWithAnimation___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (objc_opt_respondsToSelector())
  {
    v3 = [v4 balloonView];
    [v3 setHasHighlightOverlay:0 animated:*(a1 + 32) autoDismiss:0];
  }
}

- (void)_setOverlayForBalloonViewAtIndexPath:(id)a3 animated:(BOOL)a4
{
  v6 = a3;
  v7 = [(CKCoreChatController *)self collectionViewController];
  v8 = [v7 collectionView];

  v9 = [v8 visibleCells];
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __66__CKChatController__setOverlayForBalloonViewAtIndexPath_animated___block_invoke;
  v12[3] = &unk_1E72EE480;
  v13 = v8;
  v14 = v6;
  v15 = a4;
  v10 = v6;
  v11 = v8;
  [v9 enumerateObjectsUsingBlock:v12];
}

void __66__CKChatController__setOverlayForBalloonViewAtIndexPath_animated___block_invoke(uint64_t a1, void *a2)
{
  v10 = a2;
  v3 = objc_opt_respondsToSelector();
  v4 = v10;
  if (v3)
  {
    v5 = v10;
    v6 = [*(a1 + 32) indexPathForCell:v5];
    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = [v7 isEqual:v6];
    }

    else
    {
      v8 = 0;
    }

    v9 = [v5 balloonView];
    [v9 setHasHighlightOverlay:v8 animated:*(a1 + 48) autoDismiss:0];

    v4 = v10;
  }
}

- (void)detailsAdapter:(id)a3 wantsToStageComposition:(id)a4
{
  v6 = a4;
  [(CKChatController *)self _detailsAdapterWantsDismiss:a3];
  [(CKChatController *)self setComposition:v6];
}

- (void)_detailsAdapterWantsDismiss:(id)a3
{
  v13 = [a3 detailsController];
  if (CKIsRunningInMacCatalyst())
  {
    v4 = [(CKCoreChatController *)self delegate];
    if (objc_opt_respondsToSelector())
    {
      v5 = [(CKCoreChatController *)self delegate];
      if ([v5 hasDetailsNavigationController])
      {
        v6 = [(CKCoreChatController *)self delegate];
        v7 = objc_opt_respondsToSelector();

        v8 = v13;
        if ((v7 & 1) == 0)
        {
          goto LABEL_13;
        }

        v9 = [(CKCoreChatController *)self delegate];
        [v9 dismissDetailsNavigationController];

        goto LABEL_12;
      }
    }

    goto LABEL_11;
  }

  v8 = v13;
  if (!v13)
  {
    goto LABEL_13;
  }

  v4 = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
LABEL_11:

    goto LABEL_12;
  }

  v10 = [(CKChatController *)self presentedViewController];
  v11 = [v10 viewControllers];
  v12 = [v11 containsObject:v13];

  v8 = v13;
  if (!v12)
  {
    goto LABEL_13;
  }

  [(CKChatController *)self dismissDetailsControllerAnimated:1];
LABEL_12:
  v8 = v13;
LABEL_13:
}

- (void)detailsAdapter:(id)a3 shouldComposeConversationWithRecipientAddresses:(id)a4
{
  v17 = a4;
  v6 = [a3 detailsController];
  if (CKIsRunningInMacCatalyst())
  {
    v7 = [(CKCoreChatController *)self delegate];
    if (objc_opt_respondsToSelector())
    {
      v8 = [(CKCoreChatController *)self delegate];
      if ([v8 hasDetailsNavigationController])
      {
        v9 = [(CKCoreChatController *)self delegate];
        v10 = objc_opt_respondsToSelector();

        if ((v10 & 1) == 0)
        {
          goto LABEL_12;
        }

        v7 = [(CKCoreChatController *)self delegate];
        [v7 dismissDetailsNavigationController];
      }

      else
      {
      }
    }

LABEL_11:

    goto LABEL_12;
  }

  if (!v6)
  {
    goto LABEL_12;
  }

  v7 = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_11;
  }

  v11 = [(CKChatController *)self presentedViewController];
  v12 = [v11 viewControllers];
  v13 = [v12 containsObject:v6];

  if (v13)
  {
    [(CKChatController *)self dismissDetailsControllerAnimated:1];
  }

LABEL_12:
  v14 = [(CKCoreChatController *)self delegate];
  v15 = objc_opt_respondsToSelector();

  if (v15)
  {
    v16 = [(CKCoreChatController *)self delegate];
    [v16 chatController:self shouldComposeConversationWithRecipientAddresses:v17];
  }
}

- (id)presentingViewControllerForAlertsFromDetailsAdapter:(id)a3
{
  if (CKIsRunningInMacCatalyst())
  {
    v4 = self;
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (BOOL)transcriptCollectionViewControllerShouldSuppressDockingBehavior:(id)a3
{
  v4 = a3;
  if ([(CKScrollViewController *)self isKeyboardVisible])
  {
    v5 = [v4 collectionView];
    [v5 contentSize];
    v6 = [(CKCoreChatController *)self _transcriptContentSizeEligibleForTranscriptDocking:?];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)detailsAdapterWantsToPresentKTContactVerificationUI:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  [CKKeyTransparencyErrorUtilities showKTContactVerificationUIForConversation:v4 fromViewController:self];
}

- (void)detailsAdapterWillDismiss:(id)a3
{
  v3 = +[CKLinkIntentsManager sharedManager];
  [v3 purgeDependencies];
}

- (void)detailsAdapterDidDismiss:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v4 chat];
  [v5 fetchKTStatus];

  if ([(CKChatController *)self _shouldRestoreFirstResponderAfterDetailsViewDismiss])
  {

    [(CKChatController *)self becomeFirstResponder];
  }
}

- (void)dismissDetailsNavigationControllerWithCompletion:(id)a3
{
  v7 = a3;
  v4 = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    v6 = [(CKCoreChatController *)self delegate];
    [v6 dismissDetailsNavigationControllerWithCompletion:v7];
  }
}

- (void)dismissDetailsViewAndShowConversationListWithCompletion:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self delegate];
  [v5 dismissDetailsViewAndShowConversationListWithCompletion:v4];
}

- (BOOL)isDetailsNavigationControllerDetached
{
  v2 = [(CKCoreChatController *)self delegate];
  v3 = [v2 isDetailsNavigationControllerDetached];

  return v3;
}

- (BOOL)_shouldRestoreFirstResponderAfterDetailsViewDismiss
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 hasLeftGroupChat];
  v5 = [(CKCoreChatController *)self isReadOnly];
  v6 = [v3 isBusinessChatDisabled];
  v7 = [(CKChatController *)self isFirstResponder];
  v8 = [(CKChatController *)self entryView];
  v9 = [v8 contentView];
  v10 = [v9 isActive];

  return (((v4 | v7 | v10) | (v6 | v5)) & 1) == 0;
}

- (void)keyTransparencyConversationViewControllerDidComplete:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v4 chat];
  [v5 fetchKTStatus];

  [(CKChatController *)self dismissViewControllerAnimated:1 completion:&__block_literal_global_1686];
}

- (void)showModalInlineReplyControllerForChatItem:(id)a3 fromViewController:(id)a4
{
  v7 = a4;
  v6 = [(CKChatController *)self modalInlineReplyControllerForChatItem:a3];
  if (v6)
  {
    [v7 presentViewController:v6 animated:1 completion:0];
  }
}

- (id)modalInlineReplyControllerForChatItem:(id)a3
{
  v25 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKChatController *)self inlineReplyController];
  if (v5)
  {

LABEL_4:
    if (!IMOSLoggingEnabled())
    {
LABEL_8:
      v7 = 0;
      goto LABEL_9;
    }

    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      LOWORD(v21) = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Inline reply controller already presented/presenting, bailing!", &v21, 2u);
    }

LABEL_7:

    goto LABEL_8;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    goto LABEL_4;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (!IMOSLoggingEnabled())
    {
      goto LABEL_8;
    }

    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      LOWORD(v21) = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Grid asked to present non-message part item, bailing", &v21, 2u);
    }

    goto LABEL_7;
  }

  v9 = v4;
  v10 = [CKUtilities threadIdentifierForMessagePart:v9];
  v11 = [CKUtilities threadOriginatorForMessagePart:v9];
  v12 = [MEMORY[0x1E69A5AE0] configureMessageSummaryInfoForChatItem:v9];
  v13 = [v9 message];
  v14 = [v13 guid];

  if (IMOSLoggingEnabled())
  {
    v15 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v21 = 138412546;
      v22 = v10;
      v23 = 2112;
      v24 = v11;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Creating reply modal for grid with thread identifier %@ originator %@", &v21, 0x16u);
    }
  }

  v16 = [(CKCoreChatController *)self chat];
  [v16 loadInlineRepliesForThreadIdentifier:v10 threadOriginator:v11 messageGuid:v14];

  v17 = [(CKChatController *)self _transcriptOverlayTransitionContextForModalPresentation];
  v18 = [CKInlineReplyChatController alloc];
  v19 = [(CKCoreChatController *)self conversation];
  v20 = [(CKInlineReplyChatController *)v18 initWithConversation:v19 threadIdentifier:v10 threadOriginator:v11 transitionContext:v17 originatorMessageSummaryInfo:v12 parentChatController:self];

  [(CKChatController *)v20 setSendMenuDelegate:self];
  v7 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v20];
  [v7 setModalPresentationStyle:6];
  if (CKIsRunningInMacCatalyst())
  {
    [v7 setNavigationBarHidden:1];
  }

LABEL_9:

  return v7;
}

- (void)showInlineReplyControllerForChatItem:(id)a3 presentKeyboard:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  v7 = +[CKInlineReplyTransitionProperties defaultProperties];
  [(CKChatController *)self showInlineReplyControllerForChatItem:v6 presentKeyboard:v4 replyTransitionProperties:v7];
}

- (void)showInlineReplyControllerForChatItem:(id)a3 presentKeyboard:(BOOL)a4 replyTransitionProperties:(id)a5
{
  v6 = a4;
  v55 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a5;
  v10 = [(CKChatController *)self collectionView];
  [v10 _setHiddenPocketEdges:15];

  v11 = [(CKChatController *)self inlineReplyController];
  if (v11)
  {
  }

  else
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      goto LABEL_6;
    }
  }

  if (!CKIsRunningInMacCatalyst())
  {
    if (IMOSLoggingEnabled())
    {
      v22 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Inline reply controller already presented/presenting, bailing!", buf, 2u);
      }
    }

    goto LABEL_37;
  }

  [(CKChatController *)self dismissInlineReplyController:0];
LABEL_6:
  if ([v8 canInlineReply])
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"MainTranscriptWhileInlineReplyControllerVisible"];
      v12 = [(CKChatController *)self collectionView];
      [v12 setScrollEnabled:0];

      v13 = [(CKChatController *)self collectionView];
      [v13 endHoldingContentOffsetUpdatesForAllReasons];

      v14 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v15 = [v14 isExpressiveTextEnabled];

      if (v15)
      {
        v16 = [(CKCoreChatController *)self collectionViewController];
        [v16 updateTextEffectsState:&__block_literal_global_1691];
      }

      if ([v8 itemIsReplyContextPreview])
      {
        v17 = [(CKCoreChatController *)self collectionViewController];
        v18 = [v17 chatItems];

        for (i = [v18 indexOfObject:v8]; i < objc_msgSend(v18, "count"); ++i)
        {
          v20 = [v18 objectAtIndex:i];
          if ([v20 itemIsReply])
          {
            goto LABEL_24;
          }
        }

        v20 = 0;
LABEL_24:
      }

      else
      {
        v20 = v8;
      }

      v23 = [(CKChatController *)self _threadIdentifierForMessagePart:v20];
      v50 = [(CKChatController *)self _threadOriginatorForMessagePart:v20];
      v48 = [MEMORY[0x1E69A5AE0] configureMessageSummaryInfoForChatItem:v20];
      v24 = [v20 message];
      v49 = [v24 guid];

      if (IMOSLoggingEnabled())
      {
        v25 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
        {
          *buf = 138412546;
          v52 = v23;
          v53 = 2112;
          v54 = v50;
          _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "Creating reply overlay,\n\tthreadIdentifier: %@\n\toriginator: %@", buf, 0x16u);
        }
      }

      v26 = [(CKCoreChatController *)self chat];
      [v26 loadInlineRepliesForThreadIdentifier:v23 threadOriginator:v50 messageGuid:v49];

      v27 = [(CKChatController *)self _transcriptOverlayTransitionContextForAnchoredMessagePart:v20 threadIdentifier:v23 presentKeyboard:v6];
      v28 = [(CKChatController *)self collaborationNoticeSuggestions];
      [v27 setIsParentChatControllerShowingBanner:{objc_msgSend(v28, "count") != 0}];

      [v27 setReplyTransitionProperties:v9];
      v29 = [CKInlineReplyChatController alloc];
      v30 = [(CKCoreChatController *)self conversation];
      v31 = [(CKInlineReplyChatController *)v29 initWithConversation:v30 threadIdentifier:v23 threadOriginator:v50 transitionContext:v27 originatorMessageSummaryInfo:v48 parentChatController:self];

      [(CKChatController *)v31 setMessageGUIDForTranscriptExtension:v49];
      [(CKInlineReplyChatController *)v31 setInteractionDelegate:self];
      [(CKInlineReplyChatController *)v31 setTranscriptOverlayTransitionDelegate:self];
      v32 = v8;
      v33 = [v32 messageItem];
      v34 = [v33 scheduleType] == 2;

      if (v34)
      {
        v35 = [(CKCoreChatController *)self inputController];
        v36 = [v35 sendLaterPluginInfo];

        v37 = [v32 time];
        [v36 setSelectedDate:v37];

        v38 = [(CKChatController *)self entryView];
        [v38 setSendLaterPluginInfo:v36 animated:0];
      }

      v39 = [(CKChatController *)self entryView];
      [(CKChatController *)v31 setEntryView:v39];

      [(CKScrollViewController *)self keyboardFrame];
      [(CKScrollViewController *)v31 primeWithKeyboardFrame:?];
      [(CKChatController *)v31 setSendMenuDelegate:self];
      if ([(CKScrollViewController *)self isKeyboardFloating])
      {
        [(CKInlineReplyChatController *)v31 setShouldReloadInsetsForFloatingKeyboard:1];
      }

      v40 = [(CKChatController *)self entryView];
      [v40 setDelegate:v31];

      v41 = [(CKChatController *)self entryView];
      [v41 setClickInteractionDelegate:v31];

      v42 = [(CKCoreChatController *)self inputController];
      [v42 setDelegate:v31];

      [(CKChatController *)self setInlineReplyController:v31];
      [(CKChatController *)self presentTranscriptOverlayViewController:v31];
      v43 = [(CKChatController *)self traitCollection];
      v44 = [v43 userInterfaceStyle] == 2;

      v45 = [(CKChatController *)self entryView];
      v46 = v45;
      if (v44)
      {
        v47 = 7;
      }

      else
      {
        v47 = 8;
      }

      [v45 setStyle:v47];

      [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
      [(CKCoreChatController *)self removeTapbackBackdropCaptureView];
    }
  }

  else
  {
    v21 = IMLogHandleForCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      [CKChatController showInlineReplyControllerForChatItem:presentKeyboard:replyTransitionProperties:];
    }
  }

LABEL_37:
}

- (void)showMessageEditingViewControllerForChatItem:(id)a3 presentKeyboard:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  v7 = [(CKChatController *)self tipManager];
  [v7 undoOrEditMessageUsed];

  if (!CKIsAppCardsEnabled())
  {
    v8 = [(CKCoreChatController *)self inputController];
    [v8 forceDismissBrowserWithoutAnimation];
  }

  [(CKChatController *)self hideAcknowledgmentsAssociatedWithChatItem:v6];
  v18 = [(CKChatController *)self _transcriptOverlayTransitionContextForAnchoredMessagePart:v6 threadIdentifier:0 presentKeyboard:v4];
  v9 = [CKMessageEditingViewController alloc];
  v10 = [(CKCoreChatController *)self conversation];
  v11 = [(CKMessageEditingViewController *)v9 initWithTransitionContext:v18 conversation:v10];

  [(CKMessageEditingViewController *)v11 setTranscriptOverlayTransitionDelegate:self];
  [(CKMessageEditingViewController *)v11 setInteractionDelegate:self];
  v12 = [(CKCoreChatController *)self collectionViewController];
  v13 = [v12 balloonViewForChatItem:v6];
  v14 = [v6 IMChatItem];

  v15 = [v14 guid];

  [v13 frame];
  v17 = [objc_alloc(MEMORY[0x1E69B1828]) initWithEditedMessageGuid:v15 editedMessageHeight:v16];
  [v12 setMessageEditingContext:v17];
  [(CKChatController *)self presentTranscriptOverlayViewController:v11];
  [(CKChatController *)self setMessageEditingViewController:v11];
  [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
}

- (void)hideAcknowledgmentsAssociatedWithChatItem:(id)a3
{
  v16 = a3;
  v4 = [v16 visibleAssociatedMessageChatItems];
  v5 = [v4 indexOfObjectPassingTest:&__block_literal_global_1696];

  v6 = v16;
  if (v5 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v7 = [v16 visibleAssociatedMessageChatItems];
    v8 = [v7 objectAtIndex:v5];

    v9 = [(CKCoreChatController *)self collectionViewController];
    v10 = [v9 cellForAssociatedChatItem:v8];

    v11 = [(CKCoreChatController *)self collectionViewController];
    v12 = [v11 collectionView];
    v13 = [v12 indexPathForCell:v10];

    if (v13)
    {
      v14 = [MEMORY[0x1E696AC90] indexSetWithIndex:{objc_msgSend(v13, "item")}];
      v15 = [(CKCoreChatController *)self collectionViewController];
      [v15 setHiddenAssociatedItemsForMessageEditing:v14];
    }

    v6 = v16;
  }
}

uint64_t __62__CKChatController_hideAcknowledgmentsAssociatedWithChatItem___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)showAcknowledgmentsAssociatedWithChatItem:(id)a3
{
  v18 = a3;
  v4 = [v18 visibleAssociatedMessageChatItems];
  v5 = [v4 indexOfObjectPassingTest:&__block_literal_global_1699];

  v6 = v18;
  if (v5 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v7 = [v18 visibleAssociatedMessageChatItems];
    v8 = [v7 objectAtIndex:v5];

    v9 = [(CKCoreChatController *)self collectionViewController];
    v10 = [v9 cellForAssociatedChatItem:v8];

    v11 = [(CKCoreChatController *)self collectionViewController];
    v12 = [v11 collectionView];
    v13 = [v12 indexPathForCell:v10];

    if (v13)
    {
      v14 = [(CKCoreChatController *)self collectionViewController];
      v15 = [v14 hiddenAssociatedItems];
      v16 = [v15 mutableCopy];

      [v16 removeIndex:{objc_msgSend(v13, "item")}];
      v17 = [(CKCoreChatController *)self collectionViewController];
      [v17 setHiddenAssociatedItemsForMessageEditing:v16];
    }

    v6 = v18;
  }
}

uint64_t __62__CKChatController_showAcknowledgmentsAssociatedWithChatItem___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)presentTranscriptOverlayViewController:(id)a3
{
  v4 = a3;
  [(CKChatController *)self addChildViewController:v4];
  v5 = [(CKChatController *)self view];
  v6 = [v4 view];
  [v5 addSubview:v6];

  [v4 didMoveToParentViewController:self];
  v7 = +[CKUIBehavior sharedBehaviors];
  LOBYTE(v5) = [v7 isEntryViewInputAccessory];

  if ((v5 & 1) == 0)
  {
    v9 = [(CKChatController *)self view];
    v8 = [(CKChatController *)self entryViewContainerView];
    [v9 bringSubviewToFront:v8];
  }
}

- (id)_transcriptOverlayTransitionContextForAnchoredMessagePart:(id)a3 threadIdentifier:(id)a4 presentKeyboard:(BOOL)a5
{
  v5 = a5;
  v7 = a3;
  v8 = objc_alloc_init(CKTranscriptOverlayTransitionContext);
  v9 = [v7 IMChatItem];

  v10 = [v9 guid];
  [(CKTranscriptOverlayTransitionContext *)v8 setAnchorChatItemGUID:v10];

  v11 = [(CKChatController *)self _visibleChatItemsToScreenFrameMap];
  [(CKTranscriptOverlayTransitionContext *)v8 setVisibleChatItemToFrameMap:v11];

  if (v5)
  {
    [(CKTranscriptOverlayTransitionContext *)v8 setPresentWithKeyboard:1];
  }

  else
  {
    v12 = [(CKChatController *)self entryView];
    v13 = [v12 contentView];
    -[CKTranscriptOverlayTransitionContext setPresentWithKeyboard:](v8, "setPresentWithKeyboard:", [v13 isActive]);
  }

  v14 = [(CKChatController *)self entryView];
  v15 = [v14 contentView];
  -[CKTranscriptOverlayTransitionContext setKeyboardWasUpInMainTranscript:](v8, "setKeyboardWasUpInMainTranscript:", [v15 isActive]);

  v16 = [(CKCoreChatController *)self collectionViewController];
  v17 = [v16 view];
  [v17 frame];
  [(CKTranscriptOverlayTransitionContext *)v8 setParentCollectionViewFrame:?];

  v18 = [(CKCoreChatController *)self collectionViewController];
  [v18 marginInsets];
  [(CKTranscriptOverlayTransitionContext *)v8 setTranscriptMarginInsets:?];

  v19 = [(CKCoreChatController *)self collectionViewController];
  v20 = [v19 view];
  [v20 safeAreaInsets];
  [(CKTranscriptOverlayTransitionContext *)v8 setTranscriptSafeAreaInsets:?];

  if (CKIsRunningInMessagesTranscriptExtension())
  {
    [(CKTranscriptOverlayTransitionContext *)v8 setWantsUnanimatedPresentation:1];
  }

  return v8;
}

- (id)_transcriptOverlayTransitionContextForModalPresentation
{
  v2 = objc_alloc_init(CKTranscriptOverlayTransitionContext);
  [(CKTranscriptOverlayTransitionContext *)v2 setWantsModalPresentation:1];
  [(CKTranscriptOverlayTransitionContext *)v2 setPresentWithKeyboard:1];

  return v2;
}

- (id)_visibleChatItemsToScreenFrameMap
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 chatItems];
  v15[0] = MEMORY[0x1E69E9820];
  v15[1] = 3221225472;
  v15[2] = __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke;
  v15[3] = &unk_1E72EE4E8;
  v15[4] = self;
  v6 = v3;
  v16 = v6;
  [v5 enumerateObjectsUsingBlock:v15];

  v7 = [(CKCoreChatController *)self collectionViewController];
  v8 = [v7 associatedChatItems];
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke_2;
  v13[3] = &unk_1E72EE4E8;
  v13[4] = self;
  v9 = v6;
  v14 = v9;
  [v8 enumerateObjectsUsingBlock:v13];

  v10 = v14;
  v11 = v9;

  return v9;
}

void __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = [MEMORY[0x1E696AC88] indexPathForRow:a3 inSection:0];
  v7 = [*(a1 + 32) collectionView];
  v8 = [v7 collectionViewLayout];
  v9 = [v8 layoutAttributesForItemAtIndexPath:v6];

  v10 = [*(a1 + 32) view];
  [v9 frame];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v19 = [*(a1 + 32) collectionView];
  [v10 convertRect:v19 fromView:{v12, v14, v16, v18}];
  v21 = v20;
  v23 = v22;
  v25 = v24;
  v27 = v26;

  v28 = [v5 IMChatItem];
  v29 = [v28 guid];

  if (v29 && [v5 supportsInlineReplyTransition])
  {
    v30 = *(a1 + 40);
    v32[0] = v21;
    v32[1] = v23;
    v32[2] = v25;
    v32[3] = v27;
    v31 = [MEMORY[0x1E696B098] valueWithBytes:v32 objCType:"{CGRect={CGPoint=dd}{CGSize=dd}}"];
    [v30 setObject:v31 forKey:v29];
  }
}

void __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = [MEMORY[0x1E696AC88] indexPathForRow:a3 inSection:1];
  v7 = [*(a1 + 32) collectionView];
  v8 = [v7 collectionViewLayout];
  v9 = [v8 layoutAttributesForItemAtIndexPath:v6];

  v10 = [*(a1 + 32) view];
  [v9 frame];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v19 = [*(a1 + 32) collectionView];
  [v10 convertRect:v19 fromView:{v12, v14, v16, v18}];
  v21 = v20;
  v23 = v22;
  v25 = v24;
  v27 = v26;

  v28 = [v5 IMChatItem];
  v29 = [v28 guid];

  if (v29 && [v5 supportsInlineReplyTransition])
  {
    v30 = *(a1 + 40);
    v32[0] = v21;
    v32[1] = v23;
    v32[2] = v25;
    v32[3] = v27;
    v31 = [MEMORY[0x1E696B098] valueWithBytes:v32 objCType:"{CGRect={CGPoint=dd}{CGSize=dd}}"];
    [v30 setObject:v31 forKey:v29];
  }
}

- (void)dismissInlineReplyController:(BOOL)a3
{
  v3 = a3;
  v7 = [(CKChatController *)self inlineReplyController];
  [(CKChatController *)self setInlineReplyController:0];
  v5 = [(CKCoreChatController *)self chat];
  [v5 dismissInlineReplies];

  v6 = [(CKCoreChatController *)self collectionViewController];
  [v6 updateTargetAlphaForVisibleChatItems];

  [(CKChatController *)self dismissTranscriptOverlayViewController:v7 presentKeyboard:v3];
  [(CKChatController *)self _showCatchUpButtonIfNeeded];
  [(CKCoreChatController *)self configureTapbackBackdropCaptureView];
}

- (void)dismissMessageEditingViewController:(BOOL)a3
{
  v3 = a3;
  v22 = [(CKChatController *)self messageEditingViewController];
  [(CKChatController *)self setMessageEditingViewController:0];
  v5 = [(CKCoreChatController *)self collectionViewController];
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 messageEditingContext];

  [v5 setMessageEditingContext:0];
  [v5 balloonMaxWidth];
  v9 = v8;
  [v5 marginInsets];
  v11 = v10;
  v13 = v12;
  v15 = v14;
  v17 = v16;
  v18 = [(CKChatController *)self traitCollection];
  [v5 transcriptBackgroundLuminance];
  [v5 invalidateChatItemLayoutWithNewBalloonMaxWidth:v18 marginInsets:v9 traitCollection:v11 transcriptBackgroundLuminance:{v13, v15, v17, v19}];

  [v5 updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];
  [(CKChatController *)self dismissTranscriptOverlayViewController:v22 presentKeyboard:v3];
  v20 = [v7 editedMessageGuid];
  v21 = [v5 chatItemForGUID:v20];

  [(CKChatController *)self showAcknowledgmentsAssociatedWithChatItem:v21];
  [(CKChatController *)self _showCatchUpButtonIfNeeded];
}

- (void)dismissTranscriptOverlayViewController:(id)a3 presentKeyboard:(BOOL)a4
{
  v5 = a3;
  v6 = [(CKChatController *)self standardSuggestionPresenter];
  v7 = [v6 banner];
  [v7 setHidden:0];

  v8 = [(CKChatController *)self standardSuggestionPresenter];
  v9 = [v8 banner];
  [v9 setAlpha:1.0];

  if (v5)
  {
    [v5 willMoveToParentViewController:0];
    [(CKChatController *)self removeChildViewController:v5];
    v10 = [v5 view];
    [v10 removeFromSuperview];
  }

  v11 = [(CKChatController *)self entryView];
  [v11 setDelegate:self];

  v12 = [(CKChatController *)self entryView];
  [v12 setClickInteractionDelegate:self];

  v13 = [(CKChatController *)self entryView];
  if (v13)
  {
    v14 = v13;
    v15 = [(CKCoreChatController *)self collectionViewController];
    v16 = [v15 collectionView];

    if (v16)
    {
      v17 = [(CKChatController *)self entryView];
      v18 = [(CKCoreChatController *)self collectionViewController];
      v19 = [v18 collectionView];
      [v17 configurePocketInteractionForScrollView:v19];
    }
  }

  v20 = [(CKChatController *)self traitCollection];
  v21 = [(CKChatController *)self entryView];
  [v21 setEntryViewTraitCollection:v20 resetStyle:1];

  [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView setEntryViewTraitCollection:v20];
  v22 = [(CKCoreChatController *)self inputController];
  [v22 setDelegate:self];

  v23 = [(CKCoreChatController *)self collectionViewController];
  v24 = objc_opt_new();
  [v23 setHiddenItems:v24];

  v25 = [(CKCoreChatController *)self collectionViewController];
  v26 = objc_opt_new();
  [v25 setHiddenAssociatedItems:v26];

  v27 = [(CKCoreChatController *)self collectionViewController];
  v28 = objc_opt_new();
  [v27 setHiddenBalloonViews:v28];

  v29 = [(CKChatController *)self collectionView];
  [v29 setScrollEnabled:1];

  v30 = [(CKChatController *)self collectionView];
  [v30 endHoldingContentOffsetUpdatesForReason:@"TranscriptOverlayViewController"];

  [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"InlineReplyDismissal"];
  [(CKChatController *)self _updateNavigationButtons];
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"MainTranscriptWhileInlineReplyControllerVisible"];
  if ([(CKScrollViewController *)self isKeyboardFloating])
  {
    [(CKScrollViewController *)self inputAccessoryViewFrameUpdatedForFloatingKeyboard];
  }

  v31 = [(CKChatController *)self groupPhotoUpdateBanner];

  if (v31)
  {
    v32 = +[CKUIBehavior sharedBehaviors];
    [v32 replyTranscriptUpdateBannerAnimateInTime];
    v34 = v33;

    v42[0] = MEMORY[0x1E69E9820];
    v42[1] = 3221225472;
    v42[2] = __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke;
    v42[3] = &unk_1E72EBA18;
    v42[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v42 animations:0 completion:v34];
  }

  v35 = [(CKChatController *)self nicknameBanner];

  if (v35)
  {
    v36 = +[CKUIBehavior sharedBehaviors];
    [v36 replyTranscriptUpdateBannerAnimateInTime];
    v38 = v37;

    v41[0] = MEMORY[0x1E69E9820];
    v41[1] = 3221225472;
    v41[2] = __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_2;
    v41[3] = &unk_1E72EBA18;
    v41[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v41 animations:0 completion:v38];
  }

  v39 = dispatch_time(0, 100000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_3;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_after(v39, MEMORY[0x1E69E96A0], block);
}

void __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) groupPhotoUpdateBanner];
  [v1 setAlpha:1.0];
}

void __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) nicknameBanner];
  [v1 setAlpha:1.0];
}

void __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_3(uint64_t a1)
{
  v6 = [*(a1 + 32) collectionView];
  v2 = [*(a1 + 32) transcriptWasScrolledToBottomBeforeInlinePresentation];
  v3 = *(a1 + 32);
  if (v2)
  {
    [v3 setTranscriptWasScrolledToBottomBeforeInlinePresentation:0];
    v4 = [*(a1 + 32) collectionViewController];
    [v4 scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
  }

  else
  {
    v5 = [v3 collectionViewController];
    [v5 updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];

    v4 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
    [v6 enforceTranscriptScrollIntentWithAnimationProperties:v4];
  }
}

- (void)messageEditingViewController:(id)a3 confirmedEditWithComposition:(id)a4
{
  v6 = a3;
  v7 = a4;
  if (v7)
  {
    v8 = [v6 transitionContext];
    v28 = [v8 anchorChatItemGUID];

    v9 = [(CKCoreChatController *)self collectionViewController];
    v10 = [v9 chatItemForGUID:v28];

    v11 = v10;
    v12 = [v11 messageItem];
    v13 = [v11 index];
    v14 = [(CKCoreChatController *)self conversation];
    [v14 editMessageItem:v12 partIndex:v13 withNewComposition:v7];
    v15 = [(CKCoreChatController *)self conversation];
    v16 = [v15 chat];
    [v16 setProofreadingInfo:0];

    v17 = [v12 historyForMessagePart:v13];
    v18 = [v17 count] - 1;
    v19 = [MEMORY[0x1E69A8168] sharedInstance];
    v20 = *MEMORY[0x1E69A73C0];
    v21 = [MEMORY[0x1E696AD98] numberWithInteger:v18];
    [v19 trackEvent:v20 withCount:v21];

    v22 = MEMORY[0x1E696AD98];
    [v11 timeIntervalSinceMessageSent];
    v24 = v23;

    v25 = [v22 numberWithDouble:v24];
    v26 = [MEMORY[0x1E69A8168] sharedInstance];
    [v26 trackEvent:*MEMORY[0x1E69A73D0] withStatistic:v25];
  }

  else if (IMOSLoggingEnabled())
  {
    v27 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v27, OS_LOG_TYPE_INFO, "Confirmed edit with no changes to the original message, aborting edit.", buf, 2u);
    }
  }
}

- (void)messageEditingViewControllerIsAnimatingIn:(id)a3
{
  v4 = a3;
  [(CKChatController *)self setTargetFirstResponder:3];
  [(CKChatController *)self reloadInputViews];
  v5 = [v4 becomeFirstResponder];

  if (v5)
  {
    [(CKChatController *)self setTargetFirstResponder:4];
  }

  v6 = [(CKCoreChatController *)self inputController];
  [v6 setShouldBlurForMessageEditing:1];
}

- (void)messageEditingViewControllerIsAnimatingOut:(id)a3
{
  [(CKChatController *)self setTargetFirstResponder:1];
  if ([(CKChatController *)self becomeFirstResponder])
  {
    [(CKChatController *)self setTargetFirstResponder:4];
  }

  v4 = [(CKCoreChatController *)self inputController];
  [v4 setShouldBlurForMessageEditing:0];
}

- (id)messageEditingViewController:(id)a3 originalMessageCompositionForMessageWithGuid:(id)a4
{
  v28 = *MEMORY[0x1E69E9840];
  v24 = a3;
  v25 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 chatItemForGUID:v25];

  v8 = v7;
  v9 = [v8 index];
  v10 = [v8 message];
  v11 = [v10 messageSubject];
  v12 = [v10 text];
  v13 = [v12 __im_messagePartMatchingPartIndex:v9];
  v14 = [v13 messagePartBody];
  v15 = [v8 messageItem];
  v16 = [v15 translationsForMessagePart:v9];

  v17 = objc_alloc(MEMORY[0x1E69A8308]);
  v18 = [v16 firstObject];
  v19 = [v17 initWithDictionaryRepresentation:v18];

  v20 = [v19 translatedText];
  if (IMOSLoggingEnabled())
  {
    v21 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v27 = v20;
      _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Translation: %@", buf, 0xCu);
    }
  }

  v22 = [[CKComposition alloc] initWithText:v14 subject:v11 translation:v20 shelfPluginPayload:0 bizIntent:0 shelfMediaObject:0 proofreadingInfo:0];

  return v22;
}

- (void)messageEditingViewController:(id)a3 didUpdateFrameForBalloonView:(id)a4
{
  v6 = a4;
  v7 = [a3 transitionContext];
  v26 = [v7 anchorChatItemGUID];

  v8 = [(CKCoreChatController *)self collectionViewController];
  [v6 frame];
  v10 = v9;

  v11 = [objc_alloc(MEMORY[0x1E69B1828]) initWithEditedMessageGuid:v26 editedMessageHeight:v10];
  v12 = [v8 messageEditingContext];
  v13 = [v11 isEqualToContext:v12];

  if ((v13 & 1) == 0)
  {
    [v8 setMessageEditingContext:v11];
    [v8 balloonMaxWidth];
    v15 = v14;
    [v8 marginInsets];
    v17 = v16;
    v19 = v18;
    v21 = v20;
    v23 = v22;
    v24 = [(CKChatController *)self traitCollection];
    [v8 transcriptBackgroundLuminance];
    [v8 invalidateChatItemLayoutWithNewBalloonMaxWidth:v24 marginInsets:v15 traitCollection:v17 transcriptBackgroundLuminance:{v19, v21, v23, v25}];
  }

  [(CKChatController *)self scrollTranscriptToAlignWithMessageEditingBalloonView];
}

void __72__CKChatController_scrollTranscriptToAlignWithMessageEditingBalloonView__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained scrollToMessage:*(a1 + 32) atSpecificMessagePartIndex:*(a1 + 56) highlight:0 withInlineReplyOverlay:0 alignedWithView:*(a1 + 40) allowOverScroll:1];
}

- (UIEdgeInsets)messageEditingViewController:(id)a3 contentInsetsForChatItemGuid:(id)a4
{
  v5 = a4;
  v6 = *MEMORY[0x1E69DDCE0];
  v7 = *(MEMORY[0x1E69DDCE0] + 8);
  v8 = *(MEMORY[0x1E69DDCE0] + 16);
  v9 = *(MEMORY[0x1E69DDCE0] + 24);
  v10 = [(CKCoreChatController *)self collectionViewController];
  v11 = [v10 chatItemForGUID:v5];

  if (v11)
  {
    v12 = [(CKCoreChatController *)self collectionViewController];
    v13 = [v12 cellForChatItem:v11];

    if (v13)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        [v13 contentAlignmentInsets];
        v6 = v14;
        v7 = v15;
        v8 = v16;
        v9 = v17;
        goto LABEL_12;
      }

      v18 = IMLogHandleForCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        [CKChatController messageEditingViewController:contentInsetsForChatItemGuid:];
      }
    }

    else
    {
      v18 = IMLogHandleForCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        [CKChatController messageEditingViewController:contentInsetsForChatItemGuid:];
      }
    }

    goto LABEL_12;
  }

  v13 = IMLogHandleForCategory();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    [CKChatController messageEditingViewController:contentInsetsForChatItemGuid:];
  }

LABEL_12:

  v19 = v6;
  v20 = v7;
  v21 = v8;
  v22 = v9;
  result.right = v22;
  result.bottom = v21;
  result.left = v20;
  result.top = v19;
  return result;
}

- (BOOL)messageEditingViewController:(id)a3 balloonHasTailForChatItemGuid:(id)a4
{
  v5 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 chatItemForGUID:v5];

  LOBYTE(v6) = [v7 hasTail];
  return v6;
}

- (char)messageEditingViewController:(id)a3 colorTypeForChatItemGuid:(id)a4
{
  v5 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 chatItemForGUID:v5];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = [v7 color];
  }

  else
  {
    v8 = 1;
  }

  return v8;
}

- (id)_fillColorForColorType:(char)a3 dynamicFillColor:(IMColorComponents)a4
{
  alpha = a4.alpha;
  blue = a4.blue;
  green = a4.green;
  red = a4.red;
  v8 = a3;
  if (IMColorComponentsIsZero())
  {
    v9 = +[CKUIBehavior sharedBehaviors];
    v10 = [v9 theme];
    v11 = [v10 balloonColorsForColorType:v8];
    v12 = [v11 lastObject];
  }

  else
  {
    v12 = [MEMORY[0x1E69DC888] ck_colorWithIMColorComponents:{red, green, blue, alpha}];
  }

  return v12;
}

- (id)messageEditingViewController:(id)a3 colorForChatItemGuid:(id)a4
{
  v5 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  v7 = [v6 chatItemForGUID:v5];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
    v9 = v8;
    v15 = 0;
    if (!v8)
    {
      goto LABEL_5;
    }

    [v8 balloonDescriptor];
    if (BYTE2(v15) <= 5u)
    {
      if (((1 << SBYTE2(v15)) & 0x15) == 0)
      {
        if (((1 << SBYTE2(v15)) & 0xA) != 0 || (-[CKChatController traitCollection](self, "traitCollection"), v12 = objc_claimAutoreleasedReturnValue(), v13 = [v12 isTranscriptBackgroundActive], v12, !v13))
        {
          v10 = [MEMORY[0x1E69DC888] clearColor];
          goto LABEL_8;
        }
      }

LABEL_5:
      v10 = -[CKChatController _fillColorForColorType:dynamicFillColor:](self, "_fillColorForColorType:dynamicFillColor:", [v9 color], 0, 0);
LABEL_8:
      v11 = v10;

      goto LABEL_13;
    }
  }

  v11 = [MEMORY[0x1E69DC888] clearColor];
LABEL_13:

  return v11;
}

- (id)proofReadingInfoForMessageEditingViewController:(id)a3
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 chat];
  v5 = [v4 proofreadingInfo];

  return v5;
}

- (void)inlineReplyControllerRequestsDismissal:(id)a3 presentKeyboard:(BOOL)a4
{
  [(CKChatController *)self dismissInlineReplyController:a4];

  [(CKChatController *)self _registerSendProgressDelegate];
}

- (void)transcriptOverlayViewController:(id)a3 visibleGUIDsDidChange:(id)a4
{
  v5 = a4;
  v6 = objc_opt_new();
  v7 = objc_opt_new();
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __74__CKChatController_transcriptOverlayViewController_visibleGUIDsDidChange___block_invoke;
  v12[3] = &unk_1E72EC738;
  v12[4] = self;
  v13 = v6;
  v14 = v7;
  v8 = v7;
  v9 = v6;
  [v5 enumerateObjectsUsingBlock:v12];

  v10 = [(CKCoreChatController *)self collectionViewController];
  [v10 setHiddenItems:v9];

  v11 = [(CKCoreChatController *)self collectionViewController];
  [v11 setHiddenAssociatedItems:v8];
}

void __74__CKChatController_transcriptOverlayViewController_visibleGUIDsDidChange___block_invoke(id *a1, void *a2)
{
  v13 = a2;
  v3 = [a1[4] collectionViewController];
  v4 = [v3 chatItemForGUID:v13];

  if (v4)
  {
    if ([v4 supportsInlineReplyTransition])
    {
      v5 = [a1[4] collectionViewController];
      v6 = [v5 chatItems];
      v7 = [v6 indexOfObject:v4];

      [a1[5] addIndex:v7];
    }
  }

  else
  {
    v8 = [a1[4] collectionViewController];
    v9 = [v8 associatedChatItemForGUID:v13];

    if (v9)
    {
      v10 = [a1[4] collectionViewController];
      v11 = [v10 associatedChatItems];
      v12 = [v11 indexOfObject:v9];

      [a1[6] addIndex:v12];
    }
  }
}

- (CGRect)inlineReplyController:(id)a3 gradientFrameWithInsets:(UIEdgeInsets)a4
{
  bottom = a4.bottom;
  v6 = [(CKChatController *)self collectionView:a3];
  [v6 contentInset];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;

  if (v12 >= bottom)
  {
    v15 = v12;
  }

  else
  {
    v15 = bottom;
  }

  [(CKCoreChatController *)self gradientFrameWithInsets:v8, v10, v15, v14];
  result.size.height = v19;
  result.size.width = v18;
  result.origin.y = v17;
  result.origin.x = v16;
  return result;
}

- (void)inlineReplyControllerIsAppearing:(id)a3
{
  v4 = [(CKChatController *)self collectionView];
  v5 = [v4 transcriptScrollIntent];
  if (v5 <= 3)
  {
    if (v5 && v5 != 3)
    {
      goto LABEL_11;
    }

LABEL_7:
    [(CKChatController *)self setTranscriptWasScrolledToBottomBeforeInlinePresentation:1];
    goto LABEL_11;
  }

  if (v5 != 4)
  {
    if (v5 != 6)
    {
      goto LABEL_11;
    }

    goto LABEL_7;
  }

  v6 = IMLogHandleForCategory();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    [CKChatController inlineReplyControllerIsAppearing:];
  }

LABEL_11:
  [v4 setTranscriptScrollIntent:4];
}

- (void)transcriptOverlayViewControllerWillAnimateIn:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self groupPhotoUpdateBanner];

  if (v5)
  {
    v6 = +[CKUIBehavior sharedBehaviors];
    [v6 replyTranscriptUpdateBannerAnimateOutTime];
    v8 = v7;

    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke;
    v15[3] = &unk_1E72EBA18;
    v15[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v15 animations:0 completion:v8];
  }

  v9 = [(CKChatController *)self nicknameBanner];

  if (v9)
  {
    v10 = +[CKUIBehavior sharedBehaviors];
    [v10 replyTranscriptUpdateBannerAnimateOutTime];
    v12 = v11;

    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke_2;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v14 animations:0 completion:v12];
  }

  if ([v4 wantsBackingTranscriptToIgnoreContentOffsetChanges])
  {
    v13 = [(CKChatController *)self collectionView];
    [v13 beginHoldingContentOffsetUpdatesForReason:@"TranscriptOverlayViewController"];
  }
}

void __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) groupPhotoUpdateBanner];
  [v1 setAlpha:0.0];
}

void __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) nicknameBanner];
  [v1 setAlpha:0.0];
}

- (void)transcriptOverlayViewControllerIsAnimatingIn:(id)a3
{
  [(CKChatController *)self _updateNavigationButtons];
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 updateTargetAlphaForVisibleChatItems];

  v8 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v8 collectionView];
  v6 = +[CKUIBehavior sharedBehaviors];
  v7 = [v6 theme];
  [v7 transcriptOverlayBackingCollectionViewOpacity];
  [v5 setAlpha:?];
}

- (void)transcriptOverlayViewControllerDidAnimateIn:(id)a3
{
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke;
  v8[3] = &unk_1E72EBA18;
  v8[4] = self;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke_2;
  v7[3] = &unk_1E72EB9C8;
  v7[4] = self;
  [MEMORY[0x1E69DD250] animateWithDuration:v8 animations:v7 completion:0.3];
  v4 = [(CKChatController *)self entryViewContainerView];
  [v4 setNeedsLayout];

  v5 = [(CKCoreChatController *)self collectionViewController];
  [v5 updateTextEffectsState:&__block_literal_global_1707];
  v6 = [(CKCoreChatController *)self->_inlineReplyController collectionViewController];
  [v6 updateTextEffectsState:&__block_literal_global_1709];
}

void __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  v1 = [v2 banner];
  [v1 setAlpha:0.0];
}

void __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  v1 = [v2 banner];
  [v1 setHidden:1];
}

void __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke_4(uint64_t a1, void *a2)
{
  v2 = a2;
  [v2 setInTransition:0];
  [v2 setIsReady:1];
}

- (void)transcriptOverlayViewControllerWillAnimateOut:(id)a3
{
  if (self->_inlineReplyController == a3)
  {
    v4 = [(CKChatController *)self collectionView];
    [v4 _setHiddenPocketEdges:0];

    v6 = [(CKCoreChatController *)self collectionViewController];
    [v6 updateTextEffectsState:&__block_literal_global_1711];
    v5 = [(CKCoreChatController *)self->_inlineReplyController collectionViewController];
    [v5 updateTextEffectsState:&__block_literal_global_1713];
  }
}

- (void)transcriptOverlayViewControllerIsAnimatingOut:(id)a3
{
  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 updateTargetAlphaForVisibleChatItems];

  v6 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v6 collectionView];
  [v5 setAlpha:1.0];
}

- (void)transcriptOverlayViewControllerDidAnimateOut:(id)a3
{
  if (self->_inlineReplyController == a3)
  {
    v5 = [(CKCoreChatController *)self collectionViewController];
    [v5 updateTextEffectsState:&__block_literal_global_1715];
    v4 = [(CKCoreChatController *)self->_inlineReplyController collectionViewController];
    [v4 updateTextEffectsState:&__block_literal_global_1717];
  }
}

- (UIEdgeInsets)parentTranscriptContentInsetsForInlineReplyController:(id)a3
{
  v3 = [(CKChatController *)self collectionView];
  [v3 contentInset];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  v12 = v5;
  v13 = v7;
  v14 = v9;
  v15 = v11;
  result.right = v15;
  result.bottom = v14;
  result.left = v13;
  result.top = v12;
  return result;
}

- (void)imagePickerController:(id)a3 didFinishPickingMediaWithInfo:(id)a4
{
  v20[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [v7 objectForKey:*MEMORY[0x1E69DDE18]];
  v9 = [v8 localIdentifier];

  if (v9)
  {
    v10 = [v8 photoLibrary];
    v11 = [v10 librarySpecificFetchOptions];

    v12 = MEMORY[0x1E6978630];
    v13 = [v8 localIdentifier];
    v20[0] = v13;
    v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
    v15 = [v12 fetchAssetsWithLocalIdentifiers:v14 options:v11];
    v16 = [v15 firstObject];

    if (v16)
    {
      objc_initWeak(&location, self);
      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __72__CKChatController_imagePickerController_didFinishPickingMediaWithInfo___block_invoke;
      v17[3] = &unk_1E72EE510;
      objc_copyWeak(&v18, &location);
      [CKComposition mediaObjectFromPhotosAsset:v16 completion:v17];
      objc_destroyWeak(&v18);
      objc_destroyWeak(&location);
    }
  }
}

void __72__CKChatController_imagePickerController_didFinishPickingMediaWithInfo___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = [WeakRetained composition];
  v7 = [v5 compositionByAppendingMediaObject:v3];

  v6 = objc_loadWeakRetained((a1 + 32));
  [v6 setComposition:v7];
}

- (void)appendCompositionFromItemProviders:(id)a3
{
  v4 = a3;
  objc_initWeak(&location, self);
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __55__CKChatController_appendCompositionFromItemProviders___block_invoke;
  v5[3] = &unk_1E72EE538;
  objc_copyWeak(&v6, &location);
  v5[4] = self;
  [CKComposition requestCompositionFromItemProviders:v4 completion:v5];
  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __55__CKChatController_appendCompositionFromItemProviders___block_invoke_2;
  block[3] = &unk_1E72ED660;
  v6 = v3;
  v4 = v3;
  objc_copyWeak(&v8, (a1 + 40));
  v7 = *(a1 + 32);
  dispatch_async(MEMORY[0x1E69E96A0], block);
  objc_destroyWeak(&v8);
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke_2(id *a1)
{
  v19 = 0;
  v20 = &v19;
  v21 = 0x3032000000;
  v22 = __Block_byref_object_copy__8;
  v23 = __Block_byref_object_dispose__8;
  v24 = a1[4];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v3 = [WeakRetained composition];

  if (([v20[5] isAudioComposition] & 1) == 0)
  {
    v4 = a1[4];
    if (v3)
    {
      v4 = [v3 compositionByAppendingComposition:a1[4]];
    }

    objc_storeStrong(v20 + 5, v4);
    if (v3)
    {
    }

    v5 = [a1[4] collaborationShareOptions];
    v6 = [v20[5] compositionWithCollaborationShareOptions:v5];
    v7 = v20[5];
    v20[5] = v6;
  }

  v8 = [a1[5] delegate];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v10 = [a1[5] delegate];
  }

  else
  {
    v10 = 0;
  }

  if (([v10 isComposingMessage] & 1) == 0 && (objc_msgSend(a1[5], "composition"), v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v11, "shelfPluginPayload"), v12 = objc_claimAutoreleasedReturnValue(), v12, v11, v12) || objc_msgSend(v20[5], "isAudioComposition") && (objc_msgSend(a1[5], "composition"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "hasContent"), v13, v14))
  {
    v15 = a1[5];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __55__CKChatController_appendCompositionFromItemProviders___block_invoke_3;
    v17[3] = &unk_1E72EE398;
    objc_copyWeak(&v18, a1 + 6);
    v17[4] = &v19;
    [v15 presentReplaceCompositionAlertWithConfirmationBlock:v17 cancelBlock:&__block_literal_global_1721];
    objc_destroyWeak(&v18);
  }

  else
  {
    v16 = objc_loadWeakRetained(a1 + 6);
    [v16 setComposition:v20[5]];
  }

  _Block_object_dispose(&v19, 8);
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setComposition:*(*(*(a1 + 32) + 8) + 40)];
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke_4()
{
  if (IMOSLoggingEnabled())
  {
    v0 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v0, OS_LOG_TYPE_INFO))
    {
      *v1 = 0;
      _os_log_impl(&dword_19020E000, v0, OS_LOG_TYPE_INFO, "Do not replace composition. Return early.", v1, 2u);
    }
  }
}

- (id)presentedControllerDoneButtonItem
{
  v2 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel_dismissPresentedViewController_];

  return v2;
}

- (void)startDeferredEditingPayload:(id)a3 forConversation:(id)a4
{
  v6 = a3;
  v7 = a4;
  objc_initWeak(&location, self);
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke;
  v9[3] = &unk_1E72EE560;
  v9[4] = self;
  objc_copyWeak(&v11, &location);
  v8 = v6;
  v10 = v8;
  [CKComposition compositionWithShelfPluginPayload:v8 completionHandler:v9];

  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);
}

void __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] conversation];
  [v7 setUnsentComposition:v5];

  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke_2;
  v8[3] = &unk_1E72EBB98;
  objc_copyWeak(&v10, a1 + 6);
  v9 = a1[5];
  [a1[4] setDeferredPresentationBlock:v8];

  objc_destroyWeak(&v10);
}

void __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained inputController];
  [v2 startEditingPayload:*(a1 + 32)];
}

- (void)startCommitPayload:(id)a3 forConversation:(id)a4
{
  v5 = a3;
  [v5 setIsFromMe:1];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __55__CKChatController_startCommitPayload_forConversation___block_invoke;
  v7[3] = &unk_1E72EE588;
  v7[4] = self;
  v8 = v5;
  v6 = v5;
  [CKComposition compositionWithShelfPluginPayload:v6 completionHandler:v7];
}

void __55__CKChatController_startCommitPayload_forConversation___block_invoke(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) chatInputSentComposition:a2];
  v4 = +[CKBalloonPluginManager sharedInstance];
  v3 = [*(a1 + 40) pluginBundleID];
  [v4 updateInteractionTimeForPlugin:v3];
}

- (void)willDismissFunCamera:(id)a3
{
  v8 = *MEMORY[0x1E69E9840];
  v4 = a3;
  [(CKChatController *)self setIsShowingCamera:0];
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = 136315138;
      v7 = "[CKChatController willDismissFunCamera:]";
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", &v6, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  [(CKChatController *)self becomeFirstResponder];
}

- (void)stageAssetArchive:(id)a3 skipShelf:(BOOL)a4 completionHandler:(id)a5
{
  v8 = a3;
  v9 = a5;
  objc_initWeak(&location, self);
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __66__CKChatController_stageAssetArchive_skipShelf_completionHandler___block_invoke;
  v12[3] = &unk_1E72EE5B0;
  objc_copyWeak(&v15, &location);
  v10 = v8;
  v13 = v10;
  v16 = a4;
  v11 = v9;
  v14 = v11;
  [(CKChatController *)self setDeferredPresentationBlock:v12];

  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);
}

void __66__CKChatController_stageAssetArchive_skipShelf_completionHandler___block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained inputController];

  if (objc_opt_respondsToSelector())
  {
    [v3 stageAssetArchive:*(a1 + 32) skipShelf:*(a1 + 56) completionHandler:*(a1 + 40)];
  }

  else if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = objc_loadWeakRetained((a1 + 48));
      v6 = 138412546;
      v7 = v5;
      v8 = 2112;
      v9 = v3;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Failed to dispatch to input controller %@ %@ -stageAssetArchive:skipShelf:completionHandler: as it doesn't implement that method!", &v6, 0x16u);
    }
  }
}

- (void)presentPhotosApp
{
  v2 = [(CKCoreChatController *)self inputController];
  [v2 presentPluginWithBundleID:*MEMORY[0x1E69A6A08] appLaunchPayload:0];
}

- (void)controller:(id)a3 didCompleteClassificationRequest:(id)a4 withResponse:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "didCompleteClassificationRequest -- di", buf, 2u);
    }
  }

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke;
  block[3] = &unk_1E72EB880;
  v15 = v8;
  v16 = v10;
  v17 = self;
  v12 = v10;
  v13 = v8;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke(uint64_t a1)
{
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke_2;
  v5[3] = &unk_1E72EB8D0;
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v4 = *(a1 + 48);
  v6 = v3;
  v7 = v4;
  [v2 dismissViewControllerAnimated:1 completion:v5];
}

uint64_t __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = IMOSLoggingEnabled();
  if (v2)
  {
    if (v3)
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Classification request complete, deleting and reporting junk.", buf, 2u);
      }
    }

    v5 = [*(a1 + 40) delegate];
    v6 = *(a1 + 40);
    v7 = [v6 conversation];
    [v5 chatController:v6 didReportSpamForConversation:v7];
  }

  else
  {
    if (!v3)
    {
      return [*(a1 + 40) becomeFirstResponder];
    }

    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v9 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Classification request was cancelled, not going to delete or report junk.", v9, 2u);
    }
  }

  return [*(a1 + 40) becomeFirstResponder];
}

- (UIView)recipientsVirtualToolbarItem
{
  v3 = [(CKChatController *)self macRecipientsController];
  v4 = [v3 view];

  if (v4 && self->_recipientsVirtualToolbarItem != v4)
  {
    objc_storeStrong(&self->_recipientsVirtualToolbarItem, v4);
  }

  recipientsVirtualToolbarItem = self->_recipientsVirtualToolbarItem;
  v6 = recipientsVirtualToolbarItem;

  return recipientsVirtualToolbarItem;
}

- (void)dismissBusinessOnboardingIfShowing
{
  if ([(CKChatController *)self isShowingBusinessOnboarding])
  {

    [(CKChatController *)self dismissViewControllerAnimated:0 completion:0];
  }
}

- (void)dismissTipIfPresented
{
  v2 = [(CKChatController *)self tipManager];
  [v2 dismissTipIfPresented];
}

- (BOOL)isShowingBusinessOnboarding
{
  v2 = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)inputController:(id)a3 willDismissPresentationController:(id)a4
{
  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  if (![(CKChatController *)self isAnimatingStickerReaction])
  {

    [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:0];
  }
}

- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)a3 withSendAnimation:(BOOL)a4 completion:(id)a5
{
  v5 = a4;
  v6 = a3;
  v11 = a5;
  v8 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  v9 = [v8 displayConfiguration];
  v10 = [v9 shouldDismissAppCardOnExit];

  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:v6 withSendAnimation:v5 dismissAppCard:v10 completion:v11];
}

- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)a3 withSendAnimation:(BOOL)a4 dismissAppCard:(BOOL)a5 completion:(id)a6
{
  v6 = a5;
  v7 = a4;
  v8 = a3;
  v21 = *MEMORY[0x1E69E9840];
  v10 = a6;
  v11 = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (v11)
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __111__CKChatController__dismissFullScreenBubbleViewControllerAnimated_withSendAnimation_dismissAppCard_completion___block_invoke;
    aBlock[3] = &unk_1E72EE5D8;
    aBlock[4] = self;
    v18 = v10;
    v12 = _Block_copy(aBlock);
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v13 = [(CKCoreChatController *)self inputController];
      [v13 showKeyboard];
    }

    else if ([(CKChatController *)self entryViewWasActiveOnContextMenuPresentation])
    {
      [(CKChatController *)self showKeyboard];
    }

    else if (v6)
    {
      v15 = [(CKCoreChatController *)self inputController];
      [v15 dismissAppCardIfNecessaryAnimated:1 completion:0];
    }

    v16.receiver = self;
    v16.super_class = CKChatController;
    [(CKCoreChatController *)&v16 _dismissFullScreenBubbleViewControllerAnimated:v8 withSendAnimation:v7 completion:v12];
  }

  else if (IMOSLoggingEnabled())
  {
    v14 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v20 = "[CKChatController _dismissFullScreenBubbleViewControllerAnimated:withSendAnimation:dismissAppCard:completion:]";
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "[%s] called but fullScreenBalloonViewController is nil", buf, 0xCu);
    }
  }
}

uint64_t __111__CKChatController__dismissFullScreenBubbleViewControllerAnimated_withSendAnimation_dismissAppCard_completion___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 40);
  if (v2)
  {
    (*(v2 + 16))();
  }

  if (CKIsRunningInMacCatalyst())
  {
    v3 = [*(a1 + 32) entryView];
    v4 = [v3 contentView];
    [v4 makeActive];
  }

  result = [*(a1 + 32) isInline];
  if ((result & 1) == 0)
  {
    v6 = *(a1 + 32);

    return [v6 _updateNavigationButtons];
  }

  return result;
}

- (void)registerForTextinputPayloadHandlingForCheckInForConversation:(id)a3
{
  v13 = a3;
  v4 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v5 = [v4 isZelkovaEnabled];

  if (v5)
  {
    v6 = [v13 chat];
    v7 = [v6 isGroupChat];

    if ((v7 & 1) == 0)
    {
      v8 = [v13 senderIdentifier];
      v9 = [v13 recipients];
      v10 = [v9 firstObject];

      if (v10)
      {
        v11 = [v10 rawAddress];
      }

      else
      {
        v11 = 0;
      }

      v12 = [(CKCoreChatController *)self inputController];
      [v12 registerForTextInputPayloadHandlingForSenderHandleID:v8 receiverHandleID:v11];
    }
  }
}

- (void)learnMoreButtonTapped
{
  v8 = [*MEMORY[0x1E69A69F0] stringByAppendingFormat:@":%@:%@", @"0000000000", *MEMORY[0x1E69A6930]];
  v3 = [MEMORY[0x1E69A8218] sharedCoordinator];
  v4 = [v3 appPayloadID];

  v5 = [MEMORY[0x1E69A8218] sharedCoordinator];
  v6 = [v5 appPayload];

  v7 = [(CKCoreChatController *)self inputController];
  [v7 handleTextInputPayload:v6 withPayloadID:v4 forPlugin:v8];
}

- (void)tipManagerDidShowTranscriptBannerTip
{
  v3 = +[CKUIBehavior sharedBehaviors];
  [v3 updateTranscriptInsetsAnimationDuration];
  [(CKScrollViewController *)self updateScrollGeometryForReason:@"BannerChangedSize" withDuration:3 animationCurve:?];
}

- (void)tipManagerDidDismissTranscriptBannerTip
{
  v3 = +[CKUIBehavior sharedBehaviors];
  [v3 updateTranscriptInsetsAnimationDuration];
  [(CKScrollViewController *)self updateScrollGeometryForReason:@"BannerChangedSize" withDuration:3 animationCurve:?];
}

- (void)setUpFilteringButtonTapped
{
  v4 = [[CKUnknownSendersOnboardingController alloc] initUnknownSendersOnboardingController];
  v3 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v4];
  [(CKChatController *)self presentViewController:v3 animated:1 completion:&__block_literal_global_1737];
}

- (void)didRequestSendResponseForAction:(id)a3
{
  v4 = MEMORY[0x1E69A5BD8];
  v5 = a3;
  v6 = [v4 alloc];
  v7 = [MEMORY[0x1E695DF00] date];
  v8 = [v5 suggestedActionBody];

  v9 = [MEMORY[0x1E696AEC0] stringGUID];
  v11 = [v6 initWithSender:0 time:v7 text:v8 messageSubject:0 fileTransferGUIDs:0 flags:5 error:0 guid:v9 subject:0 balloonBundleID:0 payloadData:0 expressiveSendStyleID:0 threadIdentifier:0 scheduleType:0 scheduleState:0];

  v10 = [(CKCoreChatController *)self chat];
  [v10 sendMessage:v11];
}

- (void)didRequestLocationPush:(BOOL)a3
{
  v3 = [(CKCoreChatController *)self inputController];
  [v3 showLocationPlugin];
}

- (void)didRequestComposeText:(id)a3 text:(id)a4
{
  v22[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = MEMORY[0x1E696AAB0];
  v8 = a4;
  v9 = [[v7 alloc] initWithString:v8];

  v10 = [[CKComposition alloc] initWithText:v9 subject:0];
  v11 = [(CKCoreChatController *)self chat];
  v12 = [v11 participants];
  if ([v12 count] != 1)
  {

    goto LABEL_5;
  }

  [(CKCoreChatController *)self chat];
  v21 = v9;
  v14 = v13 = v6;
  v15 = [v14 participants];
  v16 = [v15 firstObject];
  v17 = [v16 ID];
  v18 = [v17 isEqualToString:v13];

  v6 = v13;
  v9 = v21;

  if (!v18)
  {
LABEL_5:
    v19 = [(CKCoreChatController *)self delegate];
    v22[0] = v6;
    v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v22 count:1];
    [v19 chatController:self shouldComposeConversationWithRecipientAddresses:v20 composition:v10];

    goto LABEL_6;
  }

  [(CKChatController *)self setComposition:v10];
LABEL_6:
}

- (void)didRequestComposeAudio:(id)a3
{
  v16[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self chat];
  v6 = [v5 participants];
  if ([v6 count] != 1)
  {

    goto LABEL_5;
  }

  v7 = [(CKCoreChatController *)self chat];
  v8 = [v7 participants];
  v9 = [v8 firstObject];
  v10 = [v9 ID];
  v11 = [v10 isEqualToString:v4];

  if (!v11)
  {
LABEL_5:
    v14 = [(CKCoreChatController *)self delegate];
    v16[0] = v4;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v16 count:1];
    [v14 chatController:self shouldComposeAudioMessageWithRecipientAddresses:v15];

    goto LABEL_6;
  }

  v12 = [(CKCoreChatController *)self inputController];
  v13 = [v12 entryView];
  [v13 startRecordingForAudioButtonInEntryView];

LABEL_6:
}

- (void)didRequestComposeVideo:(id)a3
{
  v15[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKCoreChatController *)self chat];
  v6 = [v5 participants];
  if ([v6 count] != 1)
  {

    goto LABEL_5;
  }

  v7 = [(CKCoreChatController *)self chat];
  v8 = [v7 participants];
  v9 = [v8 firstObject];
  v10 = [v9 ID];
  v11 = [v10 isEqualToString:v4];

  if (!v11)
  {
LABEL_5:
    v13 = [(CKCoreChatController *)self delegate];
    v15[0] = v4;
    v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
    [v13 chatController:self shouldComposeVideoMessageWithRecipientAddresses:v14];

    goto LABEL_6;
  }

  v12 = [(CKCoreChatController *)self inputController];
  [v12 showFunCamera];

LABEL_6:
}

- (void)didRequestCreateCalendarEvent:(id)a3
{
  if (a3)
  {
    v4 = a3;
    [v4 setEditViewDelegate:self];
    [(CKChatController *)self presentViewController:v4 animated:1 completion:0];
  }
}

- (void)didRequestOpenWebView:(id)a3
{
  v37 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = MEMORY[0x1E695DFF8];
  v6 = [v4 url];
  v7 = [v5 URLWithString:v6];

  if (!v7)
  {
    goto LABEL_18;
  }

  v8 = [v7 scheme];
  if ([v8 isEqualToString:@"http"])
  {

LABEL_5:
    gotLoadHelper_x8__OBJC_CLASS___SFSafariViewController(v9);
    v13 = [objc_alloc(*(v12 + 2104)) initWithURL:v7];
    [v13 setDelegate:self];
    [v13 setModalPresentationStyle:2];
    v14 = [v13 sheetPresentationController];
    v15 = [(CKChatController *)self view];
    [v15 bounds];
    v17 = v16;

    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __42__CKChatController_didRequestOpenWebView___block_invoke;
    v28[3] = &__block_descriptor_40_e64_d16__0___UISheetPresentationControllerDetentResolutionContext__8l;
    v28[4] = v17;
    v18 = [MEMORY[0x1E69DCF58] customDetentWithIdentifier:@"OpenWebViewControllerFullDetent" resolver:v28];
    v27[0] = MEMORY[0x1E69E9820];
    v27[1] = 3221225472;
    v27[2] = __42__CKChatController_didRequestOpenWebView___block_invoke_2;
    v27[3] = &__block_descriptor_40_e64_d16__0___UISheetPresentationControllerDetentResolutionContext__8l;
    v27[4] = v17;
    v19 = [MEMORY[0x1E69DCF58] customDetentWithIdentifier:@"OpenWebViewControllerTallDetent" resolver:v27];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __42__CKChatController_didRequestOpenWebView___block_invoke_3;
    v26[3] = &__block_descriptor_40_e64_d16__0___UISheetPresentationControllerDetentResolutionContext__8l;
    v26[4] = v17;
    v20 = [MEMORY[0x1E69DCF58] customDetentWithIdentifier:@"OpenWebViewControllerHalfDetent" resolver:v26];
    v21 = [v4 mode];
    if (v21 == 2)
    {
      v31[0] = v19;
      v31[1] = v18;
      v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v31 count:2];
    }

    else if (v21 == 1)
    {
      v30[0] = v20;
      v30[1] = v18;
      v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:2];
    }

    else
    {
      if (v21)
      {
        v29 = v18;
        [MEMORY[0x1E695DEC8] arrayWithObjects:&v29 count:1];
      }

      else
      {
        v32 = v18;
        [MEMORY[0x1E695DEC8] arrayWithObjects:&v32 count:1];
      }
      v22 = ;
    }

    v25 = v22;
    [v14 setPrefersGrabberVisible:0];
    [v14 setDetents:v25];
    [(CKChatController *)self presentViewController:v13 animated:1 completion:0];
    [(CKChatController *)self setIsWebViewVisible:1];

    goto LABEL_18;
  }

  v10 = [v7 scheme];
  v11 = [v10 isEqualToString:@"https"];

  if (v11)
  {
    goto LABEL_5;
  }

  if (IMOSLoggingEnabled())
  {
    v23 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      v24 = [v7 scheme];
      *buf = 136315394;
      v34 = "[CKChatController didRequestOpenWebView:]";
      v35 = 2112;
      v36 = v24;
      _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "[%s] called with an invalid URL scheme: %@", buf, 0x16u);
    }
  }

LABEL_18:
}

- (void)didRequestSendDeviceDetails
{
  v18 = MGCopyAnswer();
  v3 = MEMORY[0x1E696AEC0];
  v4 = [MEMORY[0x1E69DC938] currentDevice];
  v5 = [v4 systemName];
  v6 = [MEMORY[0x1E69DC938] currentDevice];
  v7 = [v6 systemVersion];
  v8 = [v3 stringWithFormat:@"%@ %@", v5, v7];

  v9 = MEMORY[0x1E696AEC0];
  v10 = [MEMORY[0x1E69DC938] currentDevice];
  v11 = [v10 systemVersion];
  v12 = [v9 stringWithFormat:@"Apple Messages %@", v11];

  v13 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@\n%@", v8, v12];
  v14 = [_TtC7ChatKit25CKSuggestedActionsHandler pluginPayloadForShelfCardWithTitle:v18 summary:v13 userInfo:&unk_1F04E9078];
  v15 = [[CKComposition alloc] initWithText:0 subject:0 shelfPluginPayload:v14];
  v16 = [(CKChatController *)self composition];
  v17 = [v16 compositionByAppendingComposition:v15];
  [(CKChatController *)self setComposition:v17];
}

- (void)setSendingCompositionBackgroundTask:(unint64_t)a3
{
  sendingCompositionBackgroundTask = self->_sendingCompositionBackgroundTask;
  v6 = [MEMORY[0x1E69DC668] sharedApplication];
  [v6 endBackgroundTask:sendingCompositionBackgroundTask];

  self->_sendingCompositionBackgroundTask = a3;
}

- (void)mentionsControllerDidFinishAnimation:(id)a3
{
  v4 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v5 = [v4 isModernMentionsAndEmojiAnimationsEnabled];

  if (v5)
  {
    v9 = [(CKChatController *)self entryView];
    v6 = [v9 contentView];
    v7 = [v6 textView];
    v8 = [v7 textStorage];
    [v8 ck_addDisplayableAttributeForIMTextEffectAttribute];

    [v9 setTextEffectCoordinatorPaused:0 reason:@"resuming because mentions controller did finish animation."];
  }
}

- (id)preferredViewControllerForModalDetailPresentation
{
  v3 = [(CKChatController *)self _viewControllerForModalPresentation];
  v4 = v3;
  if (v3 == self)
  {
    v5 = 0;
  }

  else
  {
    v5 = v3;
  }

  return v5;
}

- (CKExternalPluginViewControllerProvider)externalPluginControllerProvider
{
  WeakRetained = objc_loadWeakRetained(&self->_externalPluginControllerProvider);

  return WeakRetained;
}

- (CGSize)lastLaidOutSize
{
  width = self->_lastLaidOutSize.width;
  height = self->_lastLaidOutSize.height;
  result.height = height;
  result.width = width;
  return result;
}

- (CGPoint)contentOffsetForFirstUnreadMessage
{
  x = self->_contentOffsetForFirstUnreadMessage.x;
  y = self->_contentOffsetForFirstUnreadMessage.y;
  result.y = y;
  result.x = x;
  return result;
}

- (CGPoint)initialContentOffset
{
  x = self->_initialContentOffset.x;
  y = self->_initialContentOffset.y;
  result.y = y;
  result.x = x;
  return result;
}

- (UIEdgeInsets)initialContentInset
{
  top = self->_initialContentInset.top;
  left = self->_initialContentInset.left;
  bottom = self->_initialContentInset.bottom;
  right = self->_initialContentInset.right;
  result.right = right;
  result.bottom = bottom;
  result.left = left;
  result.top = top;
  return result;
}

- (UIView)previewSourceView
{
  WeakRetained = objc_loadWeakRetained(&self->_previewSourceView);

  return WeakRetained;
}

- (id)currentDragPreviewContainer
{
  WeakRetained = objc_loadWeakRetained(&self->_currentDragPreviewContainer);

  return WeakRetained;
}

- (UIViewController)walletOrderImportViewController
{
  WeakRetained = objc_loadWeakRetained(&self->_walletOrderImportViewController);

  return WeakRetained;
}

- (CGRect)photoGridTapbackSnapshotRect
{
  x = self->_photoGridTapbackSnapshotRect.origin.x;
  y = self->_photoGridTapbackSnapshotRect.origin.y;
  width = self->_photoGridTapbackSnapshotRect.size.width;
  height = self->_photoGridTapbackSnapshotRect.size.height;
  result.size.height = height;
  result.size.width = width;
  result.origin.y = y;
  result.origin.x = x;
  return result;
}

- (CKAggregateAttachmentMessagePartChatItem)photoGridMomentShareChatItem
{
  WeakRetained = objc_loadWeakRetained(&self->_photoGridMomentShareChatItem);

  return WeakRetained;
}

- (CKMediaObjectAssetDataSourceManager)photoGridDataSourceManager
{
  WeakRetained = objc_loadWeakRetained(&self->_photoGridDataSourceManager);

  return WeakRetained;
}

- (id)selectedChatItems
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 selectedChatItems];

  return v3;
}

- (id)selectedChatItemsIncludingTapbackedChatItem
{
  v15[1] = *MEMORY[0x1E69E9840];
  v3 = [(CKChatController *)self selectedChatItems];
  if (![v3 count])
  {
    v4 = [(CKChatController *)self inlineReplyController];
    v5 = v4;
    if (v4)
    {
      v6 = v4;
    }

    else
    {
      v6 = self;
    }

    v7 = v6;

    v8 = [(CKChatController *)v7 clickyOrbChatItem];

    if (v8)
    {
      v9 = [(CKChatController *)v7 clickyOrbChatItem];

      v15[0] = v9;
      [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
      v3 = v10 = v3;
    }

    else
    {
      v9 = [(CKCoreChatController *)v7 fullScreenBalloonViewController];

      v11 = [v9 chatItem];
      v10 = v11;
      if (v11)
      {
        v14 = v11;
        v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v14 count:1];

        v3 = v12;
      }
    }
  }

  return v3;
}

- (BOOL)hasSelectedChatItems
{
  v2 = [(CKChatController *)self selectedChatItems];
  v3 = [v2 count] != 0;

  return v3;
}

- (BOOL)hasSelectedChatItemsIncludingAssociatedTapback
{
  v2 = [(CKChatController *)self selectedChatItemsIncludingTapbackedChatItem];
  v3 = [v2 count] != 0;

  return v3;
}

- (id)selectedMessagePartItem
{
  v3 = [(CKChatController *)self inlineReplyController];
  v4 = v3;
  if (v3)
  {
    v5 = v3;
  }

  else
  {
    v5 = self;
  }

  v6 = v5;

  v7 = [(CKChatController *)v6 selectedChatItemsIncludingTapbackedChatItem];

  if ([v7 count] == 1)
  {
    v8 = [v7 firstObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = v8;
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (id)lastOutgoingMessagePartItem
{
  v3 = [(CKChatController *)self inlineReplyController];
  v4 = v3;
  if (v3)
  {
    v5 = v3;
  }

  else
  {
    v5 = self;
  }

  v6 = v5;

  v12 = 0;
  v13 = &v12;
  v14 = 0x3032000000;
  v15 = __Block_byref_object_copy__12;
  v16 = __Block_byref_object_dispose__12;
  v17 = 0;
  v7 = [(CKCoreChatController *)v6 collectionViewController];
  v8 = [v7 chatItems];
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __66__CKChatController_ChatItemSelection__lastOutgoingMessagePartItem__block_invoke;
  v11[3] = &unk_1E72EEC48;
  v11[4] = &v12;
  [v8 enumerateObjectsWithOptions:2 usingBlock:v11];

  v9 = v13[5];
  _Block_object_dispose(&v12, 8);

  return v9;
}

void __66__CKChatController_ChatItemSelection__lastOutgoingMessagePartItem__block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v10 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = v10;
  if (isKindOfClass)
  {
    v9 = v10;
    if ([v9 itemIsFromMe] && (objc_msgSend(v9, "itemIsReplyContextPreview") & 1) == 0)
    {
      objc_storeStrong((*(*(a1 + 32) + 8) + 40), a2);
      *a4 = 1;
    }

    v8 = v10;
  }
}

- (BOOL)allowDebugItems
{
  v2 = [MEMORY[0x1E69A60F0] sharedInstance];
  v3 = [v2 isInternalInstall];

  v4 = [MEMORY[0x1E695E000] standardUserDefaults];
  v5 = [v4 BOOLForKey:@"showTranscriptDebugButton"];

  return v3 & v5;
}

- (NSArray)internalBarButtonItems
{
  v9[2] = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self allowDebugItems])
  {
    v3 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"wrench.and.screwdriver.fill"];
    v4 = [(CKChatController *)self _makeInternalMenu];
    v5 = [objc_alloc(MEMORY[0x1E69DC708]) initWithImage:v3 menu:v4];
    [v5 setTag:100];
    v6 = [MEMORY[0x1E69DC708] flexibleSpaceItem];
    v9[0] = v5;
    v9[1] = v6;
    v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:2];
  }

  else
  {
    v7 = MEMORY[0x1E695E0F0];
  }

  return v7;
}

- (id)_makeInternalMenu
{
  v17[2] = *MEMORY[0x1E69E9840];
  objc_initWeak(&location, self);
  v2 = MEMORY[0x1E69DC628];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __44__CKChatController_Debug___makeInternalMenu__block_invoke;
  v14[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v15, &location);
  v3 = [v2 actionWithTitle:@"Show GUID Summary" image:0 identifier:0 handler:v14];
  v4 = MEMORY[0x1E69DC628];
  v9 = MEMORY[0x1E69E9820];
  v10 = 3221225472;
  v11 = __44__CKChatController_Debug___makeInternalMenu__block_invoke_2;
  v12 = &unk_1E72EBCD8;
  objc_copyWeak(&v13, &location);
  v5 = [v4 actionWithTitle:@"Chat Item Summary" image:0 identifier:0 handler:&v9];
  v17[0] = v5;
  v17[1] = v3;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:{2, v9, v10, v11, v12}];
  v7 = [MEMORY[0x1E69DCC60] menuWithTitle:@"[Internal]" image:0 identifier:0 options:1 children:v6];

  objc_destroyWeak(&v13);
  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);

  return v7;
}

void __44__CKChatController_Debug___makeInternalMenu__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4 = [WeakRetained _debugSelectedGuidSummary];

  v3 = objc_loadWeakRetained((a1 + 32));
  [v3 _presentAlertForDebugSummary:v4];
}

void __44__CKChatController_Debug___makeInternalMenu__block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained collectionViewController];

  v4 = [v3 selectedItems];
  v5 = [v3 chatItems];
  v6 = [v5 objectsAtIndexes:v4];

  v7 = [MEMORY[0x1E695DF70] array];
  v15[0] = MEMORY[0x1E69E9820];
  v15[1] = 3221225472;
  v15[2] = __44__CKChatController_Debug___makeInternalMenu__block_invoke_3;
  v15[3] = &unk_1E72EFBB0;
  v8 = v7;
  v16 = v8;
  [v4 enumerateIndexesUsingBlock:v15];
  v9 = objc_loadWeakRetained((a1 + 32));
  v10 = [v9 view];
  v11 = [v10 window];
  v12 = [v11 windowScene];
  v13 = [v12 delegate];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = [v8 copy];
    [v13 showInspectorViewForChatItems:v6 parallelIndexes:v14];
  }
}

void __44__CKChatController_Debug___makeInternalMenu__block_invoke_3(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  v3 = [MEMORY[0x1E696AD98] numberWithInteger:a2];
  [v2 addObject:v3];
}

- (void)_presentAlertForDebugSummary:(id)a3
{
  v4 = a3;
  v5 = [MEMORY[0x1E69DC650] alertControllerWithTitle:&stru_1F04268F8 message:v4 preferredStyle:1];
  v6 = MEMORY[0x1E69DC648];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __56__CKChatController_Debug___presentAlertForDebugSummary___block_invoke;
  v10[3] = &unk_1E72EBFE8;
  v11 = v4;
  v7 = v4;
  v8 = [v6 actionWithTitle:@"Copy" style:0 handler:v10];
  v9 = [MEMORY[0x1E69DC648] actionWithTitle:@"Cancel" style:1 handler:0];
  [v5 addAction:v8];
  [v5 addAction:v9];
  [(CKChatController *)self presentViewController:v5 animated:1 completion:0];
}

void __56__CKChatController_Debug___presentAlertForDebugSummary___block_invoke(uint64_t a1)
{
  v2 = [MEMORY[0x1E69DCD50] generalPasteboard];
  [v2 setString:*(a1 + 32)];
}

- (id)_debugSelectedGuidSummary
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 selectedItems];
  v4 = [v2 chatItems];
  v5 = [v4 objectsAtIndexes:v3];

  v6 = [MEMORY[0x1E696AD60] string];
  if ([v5 count])
  {
    v7 = 0;
    do
    {
      v8 = [v5 objectAtIndexedSubscript:v7];
      v9 = [v8 IMChatItem];
      v10 = [v9 guid];
      [v6 appendString:v10];

      if (v7 < [v5 count] - 1)
      {
        [v6 appendString:@"\n\n"];
      }

      ++v7;
    }

    while (v7 < [v5 count]);
  }

  v11 = [v6 copy];

  return v11;
}

- (id)_internalMenuForChatItem:(id)a3
{
  v61[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v44 = self;
  objc_initWeak(&location, self);
  v5 = objc_alloc(MEMORY[0x1E69A8148]);
  v6 = [v4 IMChatItem];
  v7 = [v6 guid];
  v8 = [v5 initWithEncodedMessagePartGUID:v7];
  v9 = [v8 messageGUID];

  v10 = MEMORY[0x1E69DC628];
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"Message Details" value:&stru_1F04268F8 table:@"ChatKit"];
  v13 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"info.circle"];
  v57[0] = MEMORY[0x1E69E9820];
  v57[1] = 3221225472;
  v57[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke;
  v57[3] = &unk_1E72EBF48;
  objc_copyWeak(&v59, &location);
  v14 = v4;
  v58 = v14;
  v45 = [v10 actionWithTitle:v12 image:v13 identifier:0 handler:v57];

  v15 = MEMORY[0x1E69DC628];
  v16 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"info.circle"];
  v54[0] = MEMORY[0x1E69E9820];
  v54[1] = 3221225472;
  v54[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2;
  v54[3] = &unk_1E72EBF48;
  objc_copyWeak(&v56, &location);
  v17 = v14;
  v55 = v17;
  v46 = [v15 actionWithTitle:@"Chat Item Details" image:v16 identifier:0 handler:v54];

  v18 = MEMORY[0x1E69DC628];
  v19 = CKFrameworkBundle();
  v20 = [v19 localizedStringForKey:@"Copy GUID" value:&stru_1F04268F8 table:@"ChatKit"];
  v21 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"tag"];
  v52[0] = MEMORY[0x1E69E9820];
  v52[1] = 3221225472;
  v52[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_268;
  v52[3] = &unk_1E72EC060;
  v22 = v9;
  v53 = v22;
  v23 = [v18 actionWithTitle:v20 image:v21 identifier:0 handler:v52];

  v24 = MEMORY[0x1E69DC628];
  v25 = CKFrameworkBundle();
  v26 = [v25 localizedStringForKey:@"Copy Link" value:&stru_1F04268F8 table:@"ChatKit"];
  v27 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"link"];
  v50[0] = MEMORY[0x1E69E9820];
  v50[1] = 3221225472;
  v50[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2_275;
  v50[3] = &unk_1E72EC060;
  v28 = v22;
  v51 = v28;
  v29 = [v24 actionWithTitle:v26 image:v27 identifier:0 handler:v50];

  v30 = MEMORY[0x1E69DC628];
  v31 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"ant"];
  v47[0] = MEMORY[0x1E69E9820];
  v47[1] = 3221225472;
  v47[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_3;
  v47[3] = &unk_1E72EFBD8;
  v32 = v17;
  v48 = v32;
  v49 = v44;
  v33 = [v30 actionWithTitle:@"Tap-to-Radar" image:v31 identifier:0 handler:v47];

  v34 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v35 = [v32 message];
  LOBYTE(v4) = v35 == 0;

  if ((v4 & 1) == 0)
  {
    [v34 addObject:v33];
    [v34 addObject:v45];
  }

  [v34 addObject:v46];
  [v34 addObject:v23];
  [v34 addObject:v29];
  v36 = MEMORY[0x1E69DCC60];
  v37 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"apple.logo"];
  v38 = [v34 copy];
  v39 = [v36 menuWithTitle:@"Internal" image:v37 identifier:0 options:0 children:v38];

  v40 = MEMORY[0x1E69DCC60];
  v61[0] = v39;
  v41 = [MEMORY[0x1E695DEC8] arrayWithObjects:v61 count:1];
  v42 = [v40 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v41];

  objc_destroyWeak(&v56);
  objc_destroyWeak(&v59);

  objc_destroyWeak(&location);

  return v42;
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained view];
  v4 = [v3 window];
  v5 = [v4 windowScene];
  v10 = [v5 delegate];

  v6 = [*(a1 + 32) message];
  if (v6)
  {
    v7 = v6;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      v9 = [*(a1 + 32) message];
      [v10 showInspectorViewForMessage:v9];
    }
  }
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2(uint64_t a1)
{
  v15[1] = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained collectionViewController];

  v4 = [v3 chatItems];
  v5 = [v4 indexOfObject:*(a1 + 32)];

  if (v5 == 0x7FFFFFFFFFFFFFFFLL)
  {
    v6 = &unk_1F04E7AB8;
  }

  else
  {
    v6 = [MEMORY[0x1E696AD98] numberWithInteger:v5];
  }

  v7 = objc_loadWeakRetained((a1 + 40));
  v8 = [v7 view];
  v9 = [v8 window];
  v10 = [v9 windowScene];
  v11 = [v10 delegate];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15[0] = *(a1 + 32);
    v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
    v14 = v6;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v14 count:1];
    [v11 showInspectorViewForChatItems:v12 parallelIndexes:v13];
  }
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_268(uint64_t a1)
{
  v2 = [MEMORY[0x1E69DCD50] generalPasteboard];
  [v2 setString:*(a1 + 32)];
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2_275(uint64_t a1)
{
  v4 = [MEMORY[0x1E69DCD50] generalPasteboard];
  v2 = [MEMORY[0x1E696AEC0] stringWithFormat:@"messages://open?message-guid=%@", *(a1 + 32)];
  v3 = [MEMORY[0x1E695DFF8] URLWithString:v2];
  [v4 setURL:v3];
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) message];
  v3 = [_TtC7ChatKit19TTRSheetViewFactory ttrSheetView:v2];

  [*(a1 + 40) presentViewController:v3 animated:1 completion:0];
}

- (void)effectPickerViewControllerClose:(id)a3 keepingSideMountContainer:(BOOL)a4 animated:(BOOL)a5
{
  v7 = a3;
  v8 = [(CKChatController *)self effectPickerViewController];

  if (v8 == v7)
  {
    v9 = [(CKChatController *)self entryView];
    v10 = [v9 composition];
    v11 = [v10 isAudioComposition];

    if ((v11 & 1) == 0)
    {
      v12 = [(CKChatController *)self entryView];
      v13 = [v12 contentView];
      [v13 setHidden:0];
    }

    v14 = [(CKChatController *)self effectPickerViewController];
    [v14 setDelegate:0];

    [(CKChatController *)self setEffectPickerViewController:0];
    [(CKChatController *)self setEffectPickerIsPresented:0];
    if (CKIsRunningInMacCatalyst())
    {
      v18[0] = MEMORY[0x1E69E9820];
      v18[1] = 3221225472;
      v18[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke;
      v18[3] = &unk_1E72EBA18;
      v18[4] = self;
      [v7 dismissViewControllerAnimated:0 completion:v18];
      v15 = [MEMORY[0x1E69DCBB8] activeKeyboard];
      [v15 setTypingEnabled:1];
    }

    else
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_2;
      block[3] = &unk_1E72ED8D8;
      v17 = a5;
      block[4] = self;
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }
  }
}

uint64_t __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_2(uint64_t a1)
{
  if (*(a1 + 40) == 1)
  {
    objc_initWeak(&location, *(a1 + 32));
    v2 = MEMORY[0x1E69DD250];
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_3;
    v7[3] = &unk_1E72EBA18;
    v7[4] = *(a1 + 32);
    v5[0] = MEMORY[0x1E69E9820];
    v5[1] = 3221225472;
    v5[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_4;
    v5[3] = &unk_1E72EE728;
    objc_copyWeak(&v6, &location);
    [v2 animateWithDuration:32 delay:v7 options:v5 animations:0.2 completion:0.0];
    objc_destroyWeak(&v6);
    objc_destroyWeak(&location);
  }

  else
  {
    [*(a1 + 32) _resetEffectPickerViewController];
  }

  v3 = [MEMORY[0x1E69DCBB8] activeKeyboard];
  [v3 setTypingEnabled:1];

  return [*(a1 + 32) requestDismissKeyboardSnapshotForReason:4];
}

void __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_3(uint64_t a1)
{
  v1 = [*(a1 + 32) effectPickerWindow];
  [v1 setAlpha:0.0];
}

void __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_4(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _resetEffectPickerViewController];
}

- (void)_resetEffectPickerViewController
{
  v3 = [(CKChatController *)self effectPickerWindow];
  [v3 setAlpha:0.0];

  v4 = [(CKChatController *)self effectPickerWindow];
  [v4 setRootViewController:0];

  v5 = [(CKChatController *)self effectPickerWindow];
  [v5 setHidden:1];

  [(CKChatController *)self setEffectPickerWindow:0];
}

- (void)effectPickerViewController:(id)a3 effectWithIdentifierSelected:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self entryView];
  v7 = [v6 contentView];
  [v7 setHidden:0];

  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __96__CKChatController_ImpactEffectPicker__effectPickerViewController_effectWithIdentifierSelected___block_invoke;
  v9[3] = &unk_1E72EE370;
  v10 = v5;
  v11 = self;
  v8 = v5;
  [v6 compositionWithAcceptedAutocorrection:v9];
}

void __96__CKChatController_ImpactEffectPicker__effectPickerViewController_effectWithIdentifierSelected___block_invoke(uint64_t a1, void *a2)
{
  v4 = [a2 compositionWithExpressiveSendStyleID:*(a1 + 32)];
  [*(a1 + 40) selectAccountAndSendComposition:v4 completion:&__block_literal_global_60];
  v3 = [MEMORY[0x1E69DCBB8] activeKeyboard];
  [v3 setTypingEnabled:1];
}

- (BOOL)isMainTranscript
{
  v2 = [(CKCoreChatController *)self delegate];
  if (v2)
  {
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  else
  {
    isKindOfClass = 0;
  }

  return isKindOfClass & 1;
}

- (BOOL)isInlineReply
{
  v3 = [(CKCoreChatController *)self delegate];
  if (v3)
  {
    isKindOfClass = 0;
  }

  else
  {
    v5 = [(CKChatController *)self parentViewController];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  return isKindOfClass & 1;
}

- (BOOL)isChatControllerShowingStandaloneWindow:(id)a3
{
  v3 = [a3 delegate];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)validateCommand:(id)a3
{
  v4 = a3;
  if (!CKIsRunningInMacCatalyst() && (_CKUIEnhancedMainMenuEnabled() & 1) == 0)
  {
    if ([v4 action] == sel_keyCommandApplyTextStyle_)
    {
      v12 = [(CKChatController *)self entryView];
      v13 = [v12 contentView];
      v14 = [v13 canApplyTextStyleFromKeyCommand];
    }

    else
    {
      if ([v4 action] != sel_keyCommandApplyTextEffect_)
      {
        v105.receiver = self;
        v105.super_class = CKChatController;
        [(CKChatController *)&v105 validateCommand:v4];
        goto LABEL_84;
      }

      v12 = [(CKChatController *)self entryView];
      v13 = [v12 contentView];
      v14 = [v13 canApplyTextEffectFromKeyCommand];
    }

LABEL_53:
    v33 = v14;

    v34 = [v4 attributes];
    if (v33)
    {
LABEL_54:
      v21 = v34 & 0xFFFFFFFFFFFFFFFELL;
LABEL_82:
      v20 = v4;
      goto LABEL_83;
    }

    goto LABEL_81;
  }

  v104.receiver = self;
  v104.super_class = CKChatController;
  [(CKChatController *)&v104 validateCommand:v4];
  if ([v4 action] == sel_keyCommandDeleteConversation_)
  {
    v5 = [(CKCoreChatController *)self conversation];

    if (!v5)
    {
      v20 = v4;
      v21 = 1;
LABEL_83:
      [v20 setAttributes:v21];
      goto LABEL_84;
    }
  }

  if ([v4 action] == sel_keyCommandSend_)
  {
    v12 = [(CKChatController *)self entryView];
    v13 = [v12 composition];
    v14 = [v13 hasContent];
    goto LABEL_53;
  }

  if ([v4 action] == sel_keyCommandReply_)
  {
    v15 = [(CKChatController *)self inlineReplyController];
    if (v15)
    {
LABEL_40:

      goto LABEL_41;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
LABEL_41:
      [v4 setAttributes:{objc_msgSend(v4, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
      v22 = CKFrameworkBundle();
      v6 = v22;
      v23 = @"HIDE_REPLIES";
LABEL_42:
      v24 = [v22 localizedStringForKey:v23 value:&stru_1F04268F8 table:@"ChatKit"];
      [v4 setTitle:v24];

      goto LABEL_43;
    }

    v16 = [(CKChatController *)self selectedChatItems];
    v17 = [v16 count];

    if (v17 <= 1)
    {
      v18 = [(CKCoreChatController *)self conversation];
      v19 = [v18 chat];
      if ([v19 isBusinessChat])
      {
      }

      else
      {
        v54 = [(CKChatController *)self isShowingOscarChat];

        if (!v54)
        {
          [v4 setAttributes:{objc_msgSend(v4, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
          v6 = CKFrameworkBundle();
          if (v17 == 1)
          {
            v23 = @"REPLY_TO_MESSAGE";
          }

          else
          {
            v23 = @"REPLY_TO_LAST_MESSAGE";
          }

          goto LABEL_105;
        }
      }
    }

    v34 = [v4 attributes];
LABEL_81:
    v21 = v34 | 1;
    goto LABEL_82;
  }

  if ([v4 action] == sel_keyCommandReplyAlternate_)
  {
    v15 = [(CKChatController *)self inlineReplyController];
    if (!v15)
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        v98 = 0;
        v99 = &v98;
        v100 = 0x3032000000;
        v101 = __Block_byref_object_copy__21;
        v102 = __Block_byref_object_dispose__21;
        v103 = 0;
        v35 = [(CKCoreChatController *)self collectionViewController];
        v36 = [v35 chatItems];
        v97[0] = MEMORY[0x1E69E9820];
        v97[1] = 3221225472;
        v97[2] = __45__CKChatController_MenuBar__validateCommand___block_invoke;
        v97[3] = &unk_1E72EEC48;
        v97[4] = &v98;
        [v36 enumerateObjectsWithOptions:2 usingBlock:v97];

        v37 = CKFrameworkBundle();
        v38 = [v37 localizedStringForKey:@"REPLY_TO_REPLY" value:&stru_1F04268F8 table:@"ChatKit"];
        [v4 setTitle:v38];

        if (v99[5] && ![(CKChatController *)self isShowingOscarChat])
        {
          v39 = [v4 attributes] & 0xFFFFFFFFFFFFFFFELL;
        }

        else
        {
          v39 = [v4 attributes] | 1;
        }

        [v4 setAttributes:v39];
        _Block_object_dispose(&v98, 8);

        goto LABEL_84;
      }

      goto LABEL_41;
    }

    goto LABEL_40;
  }

  if ([v4 action] == sel_keyCommandTapback_)
  {
    v25 = [(CKChatController *)self inlineReplyController];
    v26 = v25;
    if (v25)
    {
      v27 = v25;
    }

    else
    {
      v27 = self;
    }

    v28 = v27;

    if ([(CKChatController *)v28 isFullScreenBalloonViewOnScreen])
    {
      [v4 setAttributes:{objc_msgSend(v4, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
      v29 = CKFrameworkBundle();
      v30 = v29;
      v31 = @"HIDE_TAPBACKS";
    }

    else
    {
      v40 = [(CKChatController *)self selectedChatItems];
      v41 = [v40 count];

      if (v41 > 1 || [(CKChatController *)self isShowingOscarChat])
      {
        goto LABEL_62;
      }

      [v4 setAttributes:{objc_msgSend(v4, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
      if (v41 == 1)
      {
        v49 = [(CKChatController *)self selectedChatItems];
        v30 = [v49 firstObject];

        if ([v30 itemIsReplyContextPreview])
        {
          [v4 setAttributes:{objc_msgSend(v4, "attributes") | 1}];
        }

        v32 = CKFrameworkBundle();
        v50 = [v32 localizedStringForKey:@"TAPBACK_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        [v4 setTitle:v50];

        goto LABEL_51;
      }

      v29 = CKFrameworkBundle();
      v30 = v29;
      v31 = @"TAPBACK_LAST_MESSAGE";
    }

LABEL_50:
    v32 = [v29 localizedStringForKey:v31 value:&stru_1F04268F8 table:@"ChatKit"];
    [v4 setTitle:v32];
LABEL_51:

LABEL_68:
    goto LABEL_84;
  }

  if ([v4 action] == sel_keyCommandEditMessage_)
  {
    [(CKChatController *)self _configureEditMessageCommand:v4];
    goto LABEL_84;
  }

  if ([v4 action] == sel_showContactCardFromBuddyMenu_)
  {
    v44 = [(CKCoreChatController *)self conversation];
    v28 = [v44 chat];

    if (!v28 || [(CKChatController *)v28 isBusinessChat])
    {
      v43 = v4;
      v42 = 1;
      goto LABEL_67;
    }

    v51 = [(CKChatController *)v28 chatStyle];
    [v4 setAttributes:v51 != 45];
    if (v51 != 45)
    {
      goto LABEL_68;
    }

    v52 = [(CKChatController *)self _recipientHandle];
    v53 = [v52 isContact];

    if (v53)
    {
      goto LABEL_68;
    }

    v29 = CKFrameworkBundle();
    v30 = v29;
    v31 = @"ADD_TO_CONTACTS";
    goto LABEL_50;
  }

  if ([v4 action] == sel_toggleDetailsFromConversationsMenu_)
  {
    v45 = [(CKCoreChatController *)self conversation];
    v46 = [v45 allowsShowingDetailsView];

    v21 = v46 ^ 1u;
    goto LABEL_82;
  }

  if ([v4 action] == sel_toggleUnreadState_)
  {
    v47 = [(CKCoreChatController *)self conversation];
    v48 = [v47 hasUnreadMessages];

    v6 = CKFrameworkBundle();
    if (v48)
    {
      v23 = @"MARK_AS_READ";
    }

    else
    {
      v23 = @"MARK_AS_UNREAD";
    }

LABEL_105:
    v22 = v6;
    goto LABEL_42;
  }

  if ([v4 action] == sel_toggleHideAlerts_)
  {
    v55 = [(CKCoreChatController *)self conversation];
    v6 = v55;
    if (v55)
    {
      [v4 setState:{objc_msgSend(v55, "isMuted")}];
      v56 = [v4 attributes] & 0xFFFFFFFFFFFFFFFELL;
    }

    else
    {
      [v4 setState:0];
      v56 = [v4 attributes] | 1;
    }

    [v4 setAttributes:v56];
    goto LABEL_43;
  }

  if ([v4 action] == sel_blockUserFromBuddyMenu_)
  {
    v57 = [(CKCoreChatController *)self conversation];
    v28 = [v57 chat];

    if (v28 && ([(CKChatController *)v28 isBusinessChat]& 1) == 0 && [(CKChatController *)v28 chatStyle]== 45)
    {
      v58 = [(CKChatController *)self _recipientHandle];
      v59 = [v58 isLoginIMHandle];
      v60 = [v4 attributes];
      if (v59)
      {
        [v4 setAttributes:v60 | 1];
        v61 = 0;
      }

      else
      {
        [v4 setAttributes:v60 & 0xFFFFFFFFFFFFFFFELL];
        v61 = [(CKChatController *)self handleIsBlocked:v58];
      }

      [v4 setState:v61];
    }

    else
    {
      [v4 setAttributes:{objc_msgSend(v4, "attributes") | 1}];
      [v4 setState:0];
    }

    goto LABEL_68;
  }

  if ([v4 action] == sel_sendEmailFromBuddyMenu_)
  {
    v28 = [(CKCoreChatController *)self conversation];
    v62 = [(CKChatController *)self _recipientHandle];
    v63 = [v62 email];
    if (v63)
    {
      v64 = v63;
      v65 = [(CKChatController *)v28 recipients];
      v66 = [v65 count];

      if (v66 == 1)
      {
        goto LABEL_109;
      }
    }

    else
    {
    }

    goto LABEL_62;
  }

  if ([v4 action] == sel_sendFileFromBuddyMenu_)
  {
    v71 = [(CKCoreChatController *)self conversation];
    v28 = [v71 chat];

    v42 = v28 == 0;
    goto LABEL_63;
  }

  if ([v4 action] == sel_askToShareScreenFromBuddyMenu_ || objc_msgSend(v4, "action") == sel_inviteToShareScreenFromBuddyMenu_)
  {
    v67 = [(CKCoreChatController *)self conversation];
    v28 = [v67 recipient];

    if (!v28)
    {
      goto LABEL_62;
    }

    v68 = [(CKChatController *)self detailsContactsManager];
    v69 = [v68 showScreenSharingButtonForEntity:v28];
    goto LABEL_108;
  }

  if ([v4 action] == sel_faceTimeAudioFromBuddyMenu_ || objc_msgSend(v4, "action") == sel_faceTimeVideoFromBuddyMenu_)
  {
    v72 = [(CKCoreChatController *)self conversation];
    v73 = [v72 isGroupConversation];

    v74 = [(CKCoreChatController *)self conversation];
    v28 = [v74 chat];

    if (!v73)
    {
      if (v28)
      {
        v42 = [(CKChatController *)v28 isBusinessChat];
      }

      else
      {
        v42 = 1;
      }

      goto LABEL_63;
    }

    if ([v4 action] == sel_faceTimeAudioFromBuddyMenu_)
    {
      v83 = CKFrameworkBundle();
      v84 = [v83 localizedStringForKey:@"GROUP_FACETIME_AUDIO" value:&stru_1F04268F8 table:@"ChatKit"];
      [v4 setTitle:v84];

      if (!v28 || ([(CKChatController *)v28 isBusinessChat]& 1) != 0)
      {
        goto LABEL_62;
      }

      v68 = [(CKCoreChatController *)self conversation];
      v69 = [CKFaceTimeUtilities isFaceTimeAudioAvailable:v68];
    }

    else
    {
      if ([v4 action] != sel_faceTimeVideoFromBuddyMenu_)
      {
        goto LABEL_68;
      }

      v75 = CKFrameworkBundle();
      v76 = [v75 localizedStringForKey:@"GROUP_FACETIME_VIDEO" value:&stru_1F04268F8 table:@"ChatKit"];
      [v4 setTitle:v76];

      if (!v28 || ([(CKChatController *)v28 isBusinessChat]& 1) != 0)
      {
        goto LABEL_62;
      }

      v68 = [(CKCoreChatController *)self conversation];
      v69 = [CKFaceTimeUtilities isFaceTimeVideoAvailable:v68];
    }

LABEL_108:
    v70 = v69;

    if (v70)
    {
LABEL_109:
      v42 = [v4 attributes] & 0xFFFFFFFFFFFFFFFELL;
      goto LABEL_63;
    }

LABEL_62:
    v42 = [v4 attributes] | 1;
LABEL_63:
    v43 = v4;
LABEL_67:
    [v43 setAttributes:v42];
    goto LABEL_68;
  }

  if ([v4 action] == sel_keyCommandApplyTextEffect_)
  {
    v77 = [(CKChatController *)self entryView];
    v6 = [v77 contentView];

    [v4 setAttributes:{objc_msgSend(v4, "attributes") & 0xFFFFFFFFFFFFFFFELL | objc_msgSend(v6, "canApplyTextEffectFromKeyCommand") ^ 1}];
    [v4 setState:0];
    v78 = [v4 propertyList];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      v80 = [v4 propertyList];
      v81 = [v80 integerValue];

      v82 = v81 == [v6 activeTextEffectTypeInSelectedRange];
LABEL_138:
      [v4 setState:v82];
      goto LABEL_43;
    }

    goto LABEL_43;
  }

  if ([v4 action] == sel_keyCommandApplyTextStyle_)
  {
    v85 = [(CKChatController *)self entryView];
    v6 = [v85 contentView];

    [v4 setState:0];
    v86 = [v4 propertyList];
    objc_opt_class();
    v87 = objc_opt_isKindOfClass();

    if (v87)
    {
      v88 = [v4 propertyList];
      v89 = [v88 integerValue];

      v90 = [v6 canApplyTextStyleFromKeyCommand];
      if (v89 == 2 && v90)
      {
        v91 = +[CKUIBehavior sharedBehaviors];
        v92 = [v91 balloonTextFont];

        v93 = [v6 selectedText];
        v94 = [v92 ck_canToggleItalicTraitInText:v93];

        if ((v94 & 1) == 0)
        {
LABEL_132:
          v95 = [v4 attributes] | 1;
LABEL_137:
          [v4 setAttributes:v95];
          v82 = ([v6 activeTextStylesInSelectedRange] & v89) != 0;
          goto LABEL_138;
        }
      }

      else if (!v90)
      {
        goto LABEL_132;
      }

      v95 = [v4 attributes] & 0xFFFFFFFFFFFFFFFELL;
      goto LABEL_137;
    }

LABEL_43:

    goto LABEL_84;
  }

  if ([v4 action] == sel_selectedQuickLook_)
  {
    v96 = [(CKChatController *)self shouldQuickLookSelectedChatItem];
    v34 = [v4 attributes];
    if (!v96)
    {
      goto LABEL_81;
    }

    goto LABEL_54;
  }

  if ([v4 action] == sel_keyCommandToggleTimeStamp_)
  {
    v6 = [(CKCoreChatController *)self collectionViewController];
    v7 = [v6 isShowingTranscriptTimestamps];
    v8 = CKFrameworkBundle();
    v9 = v8;
    if (v7)
    {
      v10 = @"HIDE_TRANSCRIPT_TIMESTAMPS";
    }

    else
    {
      v10 = @"SHOW_TRANSCRIPT_TIMESTAMPS";
    }

    v11 = [v8 localizedStringForKey:v10 value:&stru_1F04268F8 table:@"ChatKit"];
    [v4 setTitle:v11];

    goto LABEL_43;
  }

LABEL_84:
}

void __45__CKChatController_MenuBar__validateCommand___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v10 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = v10;
  if (isKindOfClass)
  {
    v9 = v10;
    if ([v9 itemIsReply])
    {
      objc_storeStrong((*(*(a1 + 32) + 8) + 40), a2);
      *a4 = 1;
    }

    v8 = v10;
  }
}

- (id)_recipientHandle
{
  v2 = [(CKCoreChatController *)self conversation];
  v3 = v2;
  if (v2 && ([v2 recipient], (v4 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v5 = v4;
    v6 = [v4 defaultIMHandle];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)toggleUnreadState:(id)a3
{
  v5 = a3;
  v4 = self;
  if (v4 && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)v4 keyCommandToggleUnreadState];
  }
}

- (void)blockUserFromBuddyMenu:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  v5 = [v4 recipient];
  v8 = [v5 defaultIMHandle];

  if (([v8 isLoginIMHandle] & 1) == 0)
  {
    if ([(CKChatController *)self handleIsBlocked:v8])
    {
      v6 = [MEMORY[0x1E69A7F20] sharedBlockList];
      v7 = [v8 cnContact];
      [v6 unblockContact:v7];
    }

    else
    {
      [(CKChatController *)self presentBlockPersonAlertWithHandle:v8];
    }
  }
}

- (void)presentBlockPersonAlertWithHandle:(id)a3
{
  v3 = a3;
  v4 = MEMORY[0x1E696AEC0];
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"BLOCK_PERSON_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v7 = [v3 name];
  v8 = [v4 stringWithFormat:v6, v7];

  v9 = [MEMORY[0x1E69DC668] sharedApplication];
  v10 = [v9 userInterfaceLayoutDirection];

  if (v10 == 1)
  {
    v11 = @"\u200F";
  }

  else
  {
    v11 = @"\u200E";
  }

  v12 = [(__CFString *)v11 stringByAppendingString:v8];

  v13 = MEMORY[0x1E696AEC0];
  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"BLOCK_PERSON_ALERT_TEXT" value:&stru_1F04268F8 table:@"ChatKit"];
  v16 = [v3 nameAndID];
  v17 = [v13 stringWithFormat:v15, v16];

  v18 = [MEMORY[0x1E69DC668] sharedApplication];
  v19 = [v18 userInterfaceLayoutDirection];

  if (v19 == 1)
  {
    v20 = @"\u200F";
  }

  else
  {
    v20 = @"\u200E";
  }

  v21 = [(__CFString *)v20 stringByAppendingString:v17];

  v22 = [MEMORY[0x1E69DC650] alertControllerWithTitle:v12 message:v21 preferredStyle:1];
  v23 = CKFrameworkBundle();
  v24 = [v23 localizedStringForKey:@"BLOCK" value:&stru_1F04268F8 table:@"ChatKit"];
  v31[0] = MEMORY[0x1E69E9820];
  v31[1] = 3221225472;
  v31[2] = __63__CKChatController_MenuBar__presentBlockPersonAlertWithHandle___block_invoke;
  v31[3] = &unk_1E72EBFE8;
  v32 = v3;
  v25 = v3;
  v26 = [CKAlertAction actionWithTitle:v24 style:0 handler:v31];
  [v22 addAction:v26];

  v27 = CKFrameworkBundle();
  v28 = [v27 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v29 = [CKAlertAction actionWithTitle:v28 style:1 handler:0];
  [v22 addAction:v29];

  [(CKChatController *)self presentViewController:v22 animated:1 completion:0];
}

void __63__CKChatController_MenuBar__presentBlockPersonAlertWithHandle___block_invoke(uint64_t a1)
{
  v3 = [MEMORY[0x1E69A7F20] sharedBlockList];
  v2 = [*(a1 + 32) cnContact];
  [v3 blockContact:v2];
}

- (void)toggleDetailsFromConversationsMenu:(id)a3
{
  v5 = a3;
  v4 = self;
  if (v4 && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)v4 keyCommandToggleDetails];
  }
}

- (void)sendEmailFromBuddyMenu:(id)a3
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 recipient];
  v5 = [v4 defaultIMHandle];

  if (v5)
  {
    v6 = MEMORY[0x1E695DFF8];
    v7 = MEMORY[0x1E696AEC0];
    v8 = [v5 email];
    v9 = [v7 stringWithFormat:@"mailto:%@", v8];
    v10 = [v6 URLWithString:v9];

    v11 = [MEMORY[0x1E69DC668] sharedApplication];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __52__CKChatController_MenuBar__sendEmailFromBuddyMenu___block_invoke;
    v13[3] = &unk_1E72EB9C8;
    v14 = v10;
    v12 = v10;
    [v11 openURL:v12 options:MEMORY[0x1E695E0F8] completionHandler:v13];
  }
}

void __52__CKChatController_MenuBar__sendEmailFromBuddyMenu___block_invoke(uint64_t a1, int a2)
{
  v11 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = @"NO";
      v6 = *(a1 + 32);
      if (a2)
      {
        v5 = @"YES";
      }

      v7 = 138412546;
      v8 = v6;
      v9 = 2112;
      v10 = v5;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Opened URL: %@ successfully: %@", &v7, 0x16u);
    }
  }
}

- (void)showContactCardFromBuddyMenu:(id)a3
{
  v20 = [(CKChatController *)self _recipientHandle];
  v4 = [v20 cnContact];
  if (!v4)
  {
    goto LABEL_8;
  }

  v5 = v4;
  v6 = [v20 cnContact];
  v7 = [v6 identifier];
  if (!v7)
  {
    goto LABEL_7;
  }

  v8 = v7;
  v9 = [v20 cnContact];
  v10 = [v9 identifier];
  if (![v10 length])
  {

LABEL_7:
    goto LABEL_8;
  }

  v11 = [v20 cnContact];
  v12 = [v11 hasBeenPersisted];

  if (v12)
  {
    v13 = [MEMORY[0x1E6963608] defaultWorkspace];
    v14 = MEMORY[0x1E695DFF8];
    v15 = MEMORY[0x1E696AEC0];
    v16 = [v20 cnContact];
    v17 = [v16 identifier];
    v18 = [v15 stringWithFormat:@"contact://show?id=%@", v17];
    v19 = [v14 URLWithString:v18];
    [v13 openSensitiveURL:v19 withOptions:0];

    goto LABEL_9;
  }

LABEL_8:
  v13 = [v20 cnContactWithKeys:MEMORY[0x1E695E0F0]];
  [(CKChatController *)self presentAddContactViewController:v13];
LABEL_9:
}

- (void)presentAddContactViewController:(id)a3
{
  v4 = a3;
  if (v4)
  {
    v5 = [MEMORY[0x1E695D148] viewControllerForNewContact:v4];
    v6 = [MEMORY[0x1E69A7FD0] sharedInstance];
    v7 = [v6 getContactStore];
    [v5 setContactStore:v7];

    [v5 setDelegate:self];
    v8 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v5];
    v9 = self;
    v10 = [(CKChatController *)v9 presentedViewController];

    if (v10)
    {
      v11 = [(CKChatController *)v9 presentedViewController];

      v9 = v11;
    }

    [(CKChatController *)v9 presentViewController:v8 animated:1 completion:0];
  }

  else
  {
    if (!IMOSLoggingEnabled())
    {
      goto LABEL_6;
    }

    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v12 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Could not add CNContact because it was nil", v12, 2u);
    }
  }

LABEL_6:
}

- (void)sendFileFromBuddyMenu:(id)a3
{
  v4 = objc_alloc(MEMORY[0x1E69DC968]);
  v5 = +[CKUIBehavior sharedBehaviors];
  v6 = [v5 acceptableUTIs];
  v7 = [v4 initWithDocumentTypes:v6 inMode:0];

  [v7 setDelegate:self];
  [v7 setAllowsMultipleSelection:0];
  [(CKChatController *)self presentViewController:v7 animated:1 completion:0];
}

- (void)faceTimeAudioFromBuddyMenu:(id)a3
{
  v5 = a3;
  v4 = self;
  if (v4 && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)v4 beginFacetimeCallWithVideo:0];
  }
}

- (void)faceTimeVideoFromBuddyMenu:(id)a3
{
  v5 = a3;
  v4 = self;
  if (v4 && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)v4 beginFacetimeCallWithVideo:1];
  }
}

- (void)relayPhoneCallFromBuddyMenu:(id)a3
{
  v7 = a3;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = v7;
  if (isKindOfClass)
  {
    v6 = [v7 propertyList];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [(CKChatController *)self performRelayPhoneCall:v6];
    }

    v5 = v7;
  }
}

- (void)performRelayPhoneCall:(id)a3
{
  v17 = *MEMORY[0x1E69E9840];
  v3 = a3;
  if ([v3 _appearsToBePhoneNumber])
  {
    v4 = objc_alloc_init(MEMORY[0x1E69D8A90]);
    v5 = objc_alloc(MEMORY[0x1E69D8BD0]);
    v6 = [v4 defaultProvider];
    v7 = [v5 initWithProvider:v6];

    v8 = [objc_alloc(MEMORY[0x1E69D8C00]) initWithType:2 value:v3];
    [v7 setHandle:v8];
    v9 = [v7 URL];
    if (v9)
    {
      v10 = [MEMORY[0x1E69DC668] sharedApplication];
      v13[0] = MEMORY[0x1E69E9820];
      v13[1] = 3221225472;
      v13[2] = __51__CKChatController_MenuBar__performRelayPhoneCall___block_invoke;
      v13[3] = &unk_1E72EB9C8;
      v14 = v9;
      [v10 openURL:v14 options:MEMORY[0x1E695E0F8] completionHandler:v13];
    }

    else if (IMOSLoggingEnabled())
    {
      v12 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v16 = 0;
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Couldn't get URL from dial request: %@", buf, 0xCu);
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v16 = v3;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Attempting to perform a relay phone call with string: %@, which does not appear to be a phone number", buf, 0xCu);
    }
  }
}

void __51__CKChatController_MenuBar__performRelayPhoneCall___block_invoke(uint64_t a1, int a2)
{
  v11 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = @"NO";
      v6 = *(a1 + 32);
      if (a2)
      {
        v5 = @"YES";
      }

      v7 = 138412546;
      v8 = v6;
      v9 = 2112;
      v10 = v5;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Opened Phone Call: %@ successfully: %@", &v7, 0x16u);
    }
  }
}

- (void)selectedQuickLook:(id)a3
{
  if (objc_opt_respondsToSelector())
  {

    [(CKChatController *)self quickLookSelectedChatItem];
  }
}

- (void)toggleHideAlerts:(id)a3
{
  v3 = [(CKCoreChatController *)self conversation];
  if (v3)
  {
    v5 = v3;
    if ([v3 isMuted])
    {
      [v5 unmute];
    }

    else
    {
      v4 = [MEMORY[0x1E695DF00] distantFuture];
      [v5 setMutedUntilDate:v4];
    }

    v3 = v5;
  }
}

- (BOOL)shouldQuickLookSelectedChatItem
{
  v15 = *MEMORY[0x1E69E9840];
  [(CKChatController *)self selectedChatItems];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v3 = v13 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v11;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(v3);
        }

        if ([(CKChatController *)self shouldQuickLookChatItem:*(*(&v10 + 1) + 8 * i), v10])
        {
          v8 = 1;
          goto LABEL_11;
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

  v8 = 0;
LABEL_11:

  return v8;
}

- (BOOL)shouldPageSelectedChatItem
{
  v2 = [(CKChatController *)self selectedChatItems];
  if ([v2 count] == 1)
  {
    v3 = [v2 firstObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  else
  {
    isKindOfClass = 0;
  }

  return isKindOfClass & 1;
}

- (BOOL)shouldViewDetailsForSelectedChatItem
{
  v2 = [(CKChatController *)self selectedChatItems];
  if ([v2 count] == 1)
  {
    v3 = [v2 firstObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  else
  {
    isKindOfClass = 0;
  }

  return isKindOfClass & 1;
}

- (BOOL)shouldQuickLookChatItem:(id)a3
{
  v3 = a3;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      goto LABEL_7;
    }

LABEL_9:
    v6 = 0;
    goto LABEL_10;
  }

  v4 = [v3 mediaObject];
  v5 = v4;
  if (!v4 || ![v4 shouldBeQuickLooked] || (objc_msgSend(v5, "shouldShowViewer") & 1) == 0)
  {

    goto LABEL_9;
  }

LABEL_7:
  v6 = 1;
LABEL_10:

  return v6;
}

- (void)quickLookSelectedChatItem
{
  v2 = self;
  v28 = *MEMORY[0x1E69E9840];
  v3 = [(CKChatController *)self selectedChatItems];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v24;
    v7 = *MEMORY[0x1E69A7588];
    v8 = 0x1E69A8000uLL;
    v22 = v2;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v24 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v10 = *(*(&v23 + 1) + 8 * i);
        if ([(CKChatController *)v2 shouldQuickLookChatItem:v10])
        {
          v11 = [v10 mediaObject];
          v12 = [v11 transfer];
          if ([v12 isRestoring])
          {
            v13 = [v11 fileURL];
            [v13 path];
            v14 = v5;
            v15 = v6;
            v16 = v7;
            v17 = v3;
            v19 = v18 = v8;

            v20 = +[CKSyncController sharedInstance];
            [v20 prioritizeAttachmentAtPath:v19];

            v8 = v18;
            v3 = v17;
            v7 = v16;
            v6 = v15;
            v5 = v14;
            v2 = v22;
          }

          [(CKChatController *)v2 showViewerForMediaObject:v11];
          v21 = [*(v8 + 360) sharedInstance];
          [v21 trackEvent:v7];
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v23 objects:v27 count:16];
    }

    while (v5);
  }
}

- (void)scrollTranscriptPageUpDirection:(BOOL)a3 toBounds:(BOOL)a4
{
  v4 = a4;
  v5 = a3;
  v7 = [(CKCoreChatController *)self collectionViewController];
  v23 = [v7 collectionView];

  if ([v23 _isAnimatingScroll])
  {
    goto LABEL_20;
  }

  v8 = 1;
  if (v4 && !v5)
  {
    v9 = [(CKChatController *)self entryView];
    v10 = [v9 sendLaterPluginInfo];

    if (v10)
    {
      v8 = 6;
    }

    else
    {
      v8 = 0;
    }
  }

  [v23 setTranscriptScrollIntent:v8];
  [v23 bounds];
  v12 = v11;
  [v23 contentInset];
  v15 = v12 - (v13 + v14);
  [v23 __ck_bottomOffset];
  v17 = v16;
  if (v5)
  {
    v18 = 0.0;
    if (v4)
    {
      goto LABEL_13;
    }

    [v23 contentOffset];
    v18 = fmax(v19 - v15, 0.0);
  }

  else
  {
    v18 = v16;
    if (!v4)
    {
      [v23 contentOffset];
      v18 = fmin(v17, v15 + v20);
    }
  }

  if (v18 >= 20.0)
  {
    [v23 setContentOffset:1 animated:{0.0, v18}];
    goto LABEL_15;
  }

LABEL_13:
  v21 = [MEMORY[0x1E696AC88] indexPathForItem:0 inSection:0];
  [v23 scrollToItemAtIndexPath:v21 atScrollPosition:1 animated:1];

LABEL_15:
  if (v18 <= 0.0 || v18 >= v17)
  {
    v22 = [(CKCoreChatController *)self collectionViewController];
    if (objc_opt_respondsToSelector())
    {
      [v22 loadMessagesIfNeededSkipValidation];
    }
  }

LABEL_20:
}

- (void)keyCommandApplyTextEffect:(id)a3
{
  v11 = a3;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = v11;
  if (isKindOfClass)
  {
    v6 = [v11 propertyList];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = [v6 integerValue];
      v8 = [(CKChatController *)self messageEditingViewController];

      if (v8)
      {
        v9 = [(CKChatController *)self messageEditingViewController];
        [v9 modifySelectedTextByTogglingTextEffectType:v7];
      }

      else
      {
        v9 = [(CKChatController *)self entryView];
        v10 = [v9 contentView];
        [v10 applyTextEffect:v7];
      }
    }

    v5 = v11;
  }
}

- (void)keyCommandApplyTextStyle:(id)a3
{
  v11 = a3;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = v11;
  if (isKindOfClass)
  {
    v6 = [v11 propertyList];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = [v6 unsignedIntegerValue];
      v8 = [(CKChatController *)self messageEditingViewController];

      if (v8)
      {
        v9 = [(CKChatController *)self messageEditingViewController];
        [v9 modifySelectedTextByTogglingTextStyle:v7];
      }

      else
      {
        v9 = [(CKChatController *)self entryView];
        v10 = [v9 contentView];
        [v10 applyTextStyle:v7];
      }
    }

    v5 = v11;
  }
}

- (void)askToShareScreenFromBuddyMenu:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  if (v4)
  {
    v7 = v4;
    v5 = [(CKChatController *)self detailsContactsManager];
    v6 = [v7 recipient];
    [v5 inviteEntityToShareTheirScreen:v6];

    v4 = v7;
  }
}

- (void)inviteToShareScreenFromBuddyMenu:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  if (v4)
  {
    v7 = v4;
    v5 = [(CKChatController *)self detailsContactsManager];
    v6 = [v7 recipient];
    [v5 shareMyScreenWithEntity:v6];

    v4 = v7;
  }
}

- (void)spacePressed:(id)a3
{
  v4 = [(CKChatController *)self selectedChatItems];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __42__CKChatController_MenuBar__spacePressed___block_invoke;
  v5[3] = &unk_1E72F0918;
  v5[4] = self;
  [v4 enumerateObjectsWithOptions:2 usingBlock:v5];
}

void __42__CKChatController_MenuBar__spacePressed___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v15 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [*(a1 + 32) collectionViewController];
    v7 = [v6 balloonViewForChatItem:v15];

    if (!v15 || !v7)
    {
      goto LABEL_11;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [v7 pausePlayback];
    }

    v8 = *(a1 + 32);
    v9 = [v8 collectionViewController];
    [v8 transcriptCollectionViewController:v9 balloonView:v7 tappedForChatItem:v15];
    goto LABEL_10;
  }

  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v11 = v15;
  if ((isKindOfClass & 1) == 0)
  {
    goto LABEL_12;
  }

  v12 = [*(a1 + 32) collectionViewController];
  v7 = [v12 balloonViewForChatItem:v15];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = [v7 currentAssetReference];
    v13 = *(a1 + 32);
    v14 = [v13 collectionViewController];
    [v13 transcriptCollectionViewController:v14 didTapPhotoStackForChatItem:v15 assetReference:v9];

LABEL_10:
  }

LABEL_11:
  *a4 = 1;

  v11 = v15;
LABEL_12:
}

- (id)_chatItemForReplyingToChatItem:(id)a3 explicitlySelected:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  objc_opt_class();
  v7 = v6;
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
    if (v4)
    {
      v7 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v6];
    }
  }

  return v7;
}

- (void)keyCommandReply:(id)a3 withModifier:(BOOL)a4
{
  if (![(CKChatController *)self isShowingOscarChat])
  {
    v6 = [(CKCoreChatController *)self chat];
    v7 = [v6 supportsCapabilities:4];

    if (v7)
    {
      v11[0] = MEMORY[0x1E69E9820];
      v11[1] = 3221225472;
      v11[2] = __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke;
      v11[3] = &unk_1E72ED8D8;
      v12 = a4;
      v11[4] = self;
      v8 = _Block_copy(v11);
      v9 = [(CKChatController *)self inlineReplyController];

      if (v9)
      {
        v10 = [(CKChatController *)self inlineReplyController];
        [v10 dismissController];
      }

      else
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [(CKChatController *)self dismissController];
        }

        else if ([(CKChatController *)self isFullScreenBalloonViewOnScreen])
        {
          [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v8];
        }

        else
        {
          v8[2](v8);
        }
      }
    }
  }
}

void __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke(uint64_t a1)
{
  v2 = CKIsRunningInMacCatalyst();
  if ((*(a1 + 40) & 1) != 0 || ([*(a1 + 32) selectedChatItems], v3 = objc_claimAutoreleasedReturnValue(), v4 = objc_msgSend(v3, "count"), v3, v4 != 1))
  {
    v14 = 0;
    v15 = &v14;
    v16 = 0x3032000000;
    v17 = __Block_byref_object_copy__21;
    v18 = __Block_byref_object_dispose__21;
    v19 = 0;
    v7 = [*(a1 + 32) collectionViewController];
    v8 = [v7 chatItems];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke_2;
    v12[3] = &unk_1E72F0940;
    v13 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    v12[5] = &v14;
    [v8 enumerateObjectsWithOptions:2 usingBlock:v12];

    if (v15[5])
    {
      [*(a1 + 32) showInlineReplyControllerForChatItem:? presentKeyboard:?];
    }

    else if (IMOSLoggingEnabled())
    {
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "CKChatController_MenuBar: Unable to identify a visible cell that's eligible for reply", buf, 2u);
      }
    }

    _Block_object_dispose(&v14, 8);
  }

  else
  {
    v5 = [*(a1 + 32) selectedChatItems];
    v10 = [v5 firstObject];

    v6 = [*(a1 + 32) _chatItemForReplyingToChatItem:v10 explicitlySelected:1];
    if ([v6 canInlineReply])
    {
      [*(a1 + 32) showInlineReplyControllerForChatItem:v6 presentKeyboard:v2 == 0];
    }
  }
}

void __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke_2(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v13 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v7 = v13;
  if (isKindOfClass)
  {
    v8 = v13;
    v9 = v8;
    if ((*(a1 + 48) & 1) == 0)
    {
      if (![v8 itemIsFromMe])
      {
        goto LABEL_8;
      }

      if ((*(a1 + 48) & 1) == 0)
      {
        goto LABEL_11;
      }
    }

    if (![v9 itemIsReply])
    {
LABEL_11:

      v7 = v13;
      goto LABEL_12;
    }

LABEL_8:
    if ([v9 canInlineReply])
    {
      v10 = [*(a1 + 32) _chatItemForReplyingToChatItem:v9 explicitlySelected:0];
      v11 = *(*(a1 + 40) + 8);
      v12 = *(v11 + 40);
      *(v11 + 40) = v10;
    }

    *a4 = 1;
    goto LABEL_11;
  }

LABEL_12:
}

- (void)keyCommandTapback:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self inlineReplyController];
  v6 = v5;
  if (v5)
  {
    v7 = v5;
  }

  else
  {
    v7 = self;
  }

  v8 = v7;

  v9 = [(CKCoreChatController *)v8 collectionViewController];
  v10 = [v9 collectionView];
  if ([(CKChatController *)v8 isFullScreenBalloonViewOnScreen])
  {
    [(CKChatController *)v8 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  }

  else
  {
    if (!CKIsRunningInMacCatalyst() && (-[CKChatController clickyOrbChatItem](v8, "clickyOrbChatItem"), (v18 = objc_claimAutoreleasedReturnValue()) != 0) && (v19 = v18, [v10 contextMenuInteraction], v20 = objc_claimAutoreleasedReturnValue(), v20, v19, v20))
    {
      v11 = [v10 contextMenuInteraction];
      [v11 dismissMenu];
    }

    else
    {
      v11 = [(CKChatController *)self selectedChatItems];
      if ([v11 count] == 1)
      {
        v12 = [v11 firstObject];
        if (([v12 itemIsReplyContextPreview] & 1) == 0 && (objc_msgSend(v12, "isEditedMessageHistory") & 1) == 0)
        {
          v13 = [v9 selectedItems];
          v14 = [v13 firstIndex];

          v15 = [MEMORY[0x1E696AC88] indexPathForItem:v14 inSection:0];
          [(CKChatController *)v8 showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:v15];
        }
      }

      else
      {
        v12 = [v9 chatItems];
        v22 = 0;
        v23 = &v22;
        v24 = 0x3032000000;
        v25 = __Block_byref_object_copy__21;
        v26 = __Block_byref_object_dispose__21;
        v27 = 0;
        v21[0] = MEMORY[0x1E69E9820];
        v21[1] = 3221225472;
        v21[2] = __47__CKChatController_MenuBar__keyCommandTapback___block_invoke;
        v21[3] = &unk_1E72EEC48;
        v21[4] = &v22;
        [v12 enumerateObjectsWithOptions:2 usingBlock:v21];
        v16 = [v9 cellForChatItem:v23[5]];
        v17 = [v10 indexPathForCell:v16];
        [(CKChatController *)v8 showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:v17];

        _Block_object_dispose(&v22, 8);
      }
    }
  }
}

void __47__CKChatController_MenuBar__keyCommandTapback___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v10 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = v10;
  if (isKindOfClass)
  {
    v9 = v10;
    if (([v9 itemIsFromMe] & 1) == 0 && (objc_msgSend(v9, "itemIsReplyContextPreview") & 1) == 0)
    {
      objc_storeStrong((*(*(a1 + 32) + 8) + 40), a2);
      *a4 = 1;
    }

    v8 = v10;
  }
}

- (void)_configureEditMessageCommand:(id)a3
{
  v23 = a3;
  v4 = [(CKChatController *)self currentChatController];
  v5 = [v4 conversation];
  v6 = [v5 supportsMessageEditing];

  if (v6)
  {
    v7 = [v4 messageEditingViewController];

    if (!v7)
    {
      v11 = [(CKChatController *)self hasSelectedChatItemsIncludingAssociatedTapback];
      v12 = CKFrameworkBundle();
      v13 = v12;
      if (v11)
      {
        v14 = [v12 localizedStringForKey:@"EDIT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        [v23 setTitle:v14];

        [(CKChatController *)self selectedMessagePartItem];
      }

      else
      {
        v15 = [v12 localizedStringForKey:@"EDIT_LAST_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        [v23 setTitle:v15];

        [(CKChatController *)self lastOutgoingMessagePartItem];
      }
      v16 = ;
      if (v16 && ([v4 conversation], v17 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v17, "chat"), v18 = objc_claimAutoreleasedReturnValue(), v19 = objc_msgSend(v18, "supportsCapabilities:", 1), v18, v17, (v19 & 1) != 0))
      {
        v20 = [v16 canEditMessageText];
        v21 = [v23 attributes];
        if (v20)
        {
          v22 = v21 & 0xFFFFFFFFFFFFFFFELL;
        }

        else
        {
          v22 = v21 | 1;
        }
      }

      else
      {
        v22 = [v23 attributes] | 1;
      }

      [v23 setAttributes:v22];

      goto LABEL_6;
    }

    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"CANCEL_EDIT" value:&stru_1F04268F8 table:@"ChatKit"];
    [v23 setTitle:v9];

    v10 = [v23 attributes] & 0xFFFFFFFFFFFFFFFELL;
  }

  else
  {
    v10 = [v23 attributes] | 1;
  }

  [v23 setAttributes:v10];
LABEL_6:
}

- (void)keyCommandEditMessage:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self currentChatController];
  v6 = [v5 messageEditingViewController];

  if (v6)
  {
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Edit Message Shortcut pressed. Dismissing message editing.", buf, 2u);
      }
    }

    v8 = [v5 messageEditingViewController];
    [v8 dismissAndRejectChanges];
  }

  else
  {
    v8 = [(CKChatController *)self _chatItemToEdit];
    if (v8)
    {
      v12 = MEMORY[0x1E69E9820];
      v13 = 3221225472;
      v14 = __51__CKChatController_MenuBar__keyCommandEditMessage___block_invoke;
      v15 = &unk_1E72EB8D0;
      v9 = v5;
      v16 = v9;
      v8 = v8;
      v17 = v8;
      v10 = _Block_copy(&v12);
      if ([v9 isFullScreenBalloonViewOnScreen])
      {
        [v9 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v10];
      }

      else
      {
        v10[2](v10);
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Unable to identify an eligible item for editing. No op.", buf, 2u);
      }
    }
  }
}

uint64_t __51__CKChatController_MenuBar__keyCommandEditMessage___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionView];
  v3 = [v2 contextMenuInteraction];

  if (v3)
  {
    v4 = [*(a1 + 32) collectionView];
    v5 = [v4 contextMenuInteraction];
    [v5 dismissMenu];
  }

  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      *v8 = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Edit Message Shortcut pressed. Showing message editing.", v8, 2u);
    }
  }

  return [*(a1 + 32) showMessageEditingViewControllerForChatItem:*(a1 + 40) presentKeyboard:1];
}

- (id)_chatItemToEdit
{
  v3 = [(CKChatController *)self selectedMessagePartItem];
  if (v3)
  {
    v4 = v3;
    if (([v3 canEditMessageText] & 1) == 0)
    {
      v5 = 0;
      goto LABEL_10;
    }
  }

  else
  {
    v6 = [(CKChatController *)self lastOutgoingMessagePartItem];
    v7 = v6;
    if (v6 && [v6 canEditMessageText])
    {
      v4 = v7;
    }

    else
    {
      v4 = 0;
    }
  }

  v4 = v4;
  v5 = v4;
LABEL_10:

  return v5;
}

- (id)currentChatController
{
  v2 = self;
  v3 = [(CKChatController *)self inlineReplyController];
  v4 = v3;
  if (v3)
  {
    v2 = v3;
  }

  v5 = v2;

  return v2;
}

- (void)keyCommandPrint:(id)a3
{
  v3 = [(CKCoreChatController *)self collectionViewController];
  objc_opt_class();
  if (objc_opt_isKindOfClass() & 1) != 0 && (objc_opt_respondsToSelector())
  {
    [v3 performSelector:sel_printTranscript];
  }
}

- (void)keyCommandDeleteConversation:(id)a3
{
  v7 = a3;
  v4 = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    v6 = [(CKCoreChatController *)self delegate];
    [v6 keyCommandDeleteConversation:v7];
  }

  else
  {
    [(CKChatController *)self recoverableDeleteConversation];
  }
}

- (void)_cancelDeletion:(id)a3
{
  if (a3)
  {
    (*(a3 + 2))(a3, 0);
  }
}

- (void)keyCommandPage:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self selectedChatItems];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __44__CKChatController_MenuBar__keyCommandPage___block_invoke;
  v7[3] = &unk_1E72EE4E8;
  v7[4] = self;
  v8 = v4;
  v6 = v4;
  [v5 enumerateObjectsWithOptions:2 usingBlock:v7];
}

void __44__CKChatController_MenuBar__keyCommandPage___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = [*(a1 + 32) collectionViewController];
    v8 = [v7 balloonViewForChatItem:v6];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v10 = *(a1 + 40);
      v9 = (a1 + 40);
      v11 = [v10 input];
      v12 = [v11 isEqualToString:*MEMORY[0x1E69DDF28]];

      if (v12)
      {
        [v8 pageRightAnimated:1];
      }

      else
      {
        v13 = [*v9 input];
        v14 = [v13 isEqualToString:*MEMORY[0x1E69DDF10]];

        if (v14)
        {
          [v8 pageLeftAnimated:1];
        }

        else
        {
          v15 = IMLogHandleForCategory();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
          {
            __44__CKChatController_MenuBar__keyCommandPage___block_invoke_cold_1(v9, v15);
          }
        }
      }
    }

    *a4 = 1;
  }
}

- (void)keyCommandShowDetails:(id)a3
{
  v4 = [(CKChatController *)self selectedChatItems];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __51__CKChatController_MenuBar__keyCommandShowDetails___block_invoke;
  v5[3] = &unk_1E72F0918;
  v5[4] = self;
  [v4 enumerateObjectsWithOptions:2 usingBlock:v5];
}

void __51__CKChatController_MenuBar__keyCommandShowDetails___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v11 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [*(a1 + 32) collectionViewController];
    v7 = [v6 balloonViewForChatItem:v11];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = [v7 currentAssetReference];
      v9 = *(a1 + 32);
      v10 = [v9 collectionViewController];
      [v9 transcriptCollectionViewController:v10 didTapPhotoStackButtonForChatItem:v11 assetReference:v8];
    }

    *a4 = 1;
  }
}

- (void)escButtonPressed:(id)a3
{
  v4 = [(CKChatController *)self inlineReplyController];
  v5 = v4;
  if (v4)
  {
    v6 = v4;
  }

  else
  {
    v6 = self;
  }

  v9 = v6;

  if ([(CKChatController *)v9 isFullScreenBalloonViewOnScreen])
  {
    [(CKChatController *)v9 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  }

  else
  {
    v7 = [(CKChatController *)v9 messageEditingViewController];

    if (v7)
    {
      v8 = [(CKChatController *)v9 messageEditingViewController];
      [v8 dismissAndRejectChanges];
    }

    else
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        [(CKChatController *)v9 dismissController];
      }

      else
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [(CKChatController *)v9 cancelCompose];
        }
      }
    }
  }
}

- (void)delete:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self collectionViewController];
  [v5 deleteSelectedChatItems:v4];
}

- (void)copy:(id)a3
{
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Copying selected transcript balloons to pasteboard", v7, 2u);
    }
  }

  v6 = [(CKCoreChatController *)self collectionViewController];
  [v6 copySelectedChatItemsToPasteboard];
}

- (void)updateCompositionInEntryViewWithComposition:(id)a3
{
  v4 = a3;
  v7 = [(CKChatController *)self entryView];
  v5 = [v7 composition];
  v6 = [v5 compositionByAppendingComposition:v4];

  [v7 setComposition:v6];
}

- (void)documentPicker:(id)a3 didPickDocumentsAtURLs:(id)a4
{
  v15[1] = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if ([v7 count] == 1)
  {
    v8 = objc_alloc(MEMORY[0x1E696ACA0]);
    v9 = [v7 objectAtIndexedSubscript:0];
    v10 = [v8 initWithContentsOfURL:v9];

    objc_initWeak(&location, self);
    v15[0] = v10;
    v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke;
    v12[3] = &unk_1E72F0968;
    objc_copyWeak(&v13, &location);
    [CKComposition requestCompositionFromItemProviders:v11 completion:v12];

    objc_destroyWeak(&v13);
    objc_destroyWeak(&location);
  }
}

void __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke_2;
  v5[3] = &unk_1E72EBB98;
  objc_copyWeak(&v7, (a1 + 32));
  v6 = v3;
  v4 = v3;
  dispatch_async(MEMORY[0x1E69E96A0], v5);

  objc_destroyWeak(&v7);
}

void __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained updateCompositionInEntryViewWithComposition:*(a1 + 32)];
}

- (void)purgeAttachmentsForChat:(id)a3
{
  v4 = [(CKCoreChatController *)self chat];
  v5 = [v4 guid];

  v6 = [CKAlertController alertControllerWithTitle:@"Purge attachments for this chat?" message:@"This will delete attachment files on disk but you can re-download them. Be sure to imtool kim after running this." preferredStyle:1];
  v7 = CKFrameworkBundle();
  v8 = [v7 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __53__CKChatController_MenuBar__purgeAttachmentsForChat___block_invoke;
  v14[3] = &unk_1E72EBFE8;
  v15 = v5;
  v9 = v5;
  v10 = [CKAlertAction actionWithTitle:v8 style:0 handler:v14];
  [v6 addAction:v10];

  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"Cancel" value:&stru_1F04268F8 table:@"ChatKit"];
  v13 = [CKAlertAction actionWithTitle:v12 style:0 handler:0];
  [v6 addAction:v13];

  [v6 presentFromViewController:self animated:1 completion:0];
}

void __53__CKChatController_MenuBar__purgeAttachmentsForChat___block_invoke(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = *(a1 + 32);
      v8 = 138412290;
      v9 = v5;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Purging attachments for chatGUID: %@", &v8, 0xCu);
    }
  }

  v6 = [MEMORY[0x1E69A5B50] sharedController];
  v7 = [v6 remoteDaemon];
  [v7 purgeAttachmentsForChatGUID:*(a1 + 32)];
}

- (void)showMessageHistoryViewController
{
  v13 = objc_alloc_init(CKMessageHistoryViewController);
  [(CKMessageHistoryViewController *)v13 setMessageHistoryDelegate:self];
  v3 = [(CKCoreChatController *)self conversation];
  [(CKMessageHistoryViewController *)v13 setMessageHistoryDataSource:v3];
  v4 = [MEMORY[0x1E69DC938] currentDevice];
  v5 = [v4 userInterfaceIdiom];

  if (v5 == 1)
  {
    [(CKMessageHistoryViewController *)v13 setModalPresentationStyle:7];
    v6 = [(CKChatController *)self navigationController];
    v7 = [v6 navigationBar];

    v8 = [(CKMessageHistoryViewController *)v13 presentationController];
    [v8 setSourceView:v7];

    [(CKChatController *)self presentViewController:v13 animated:1 completion:0];
  }

  else
  {
    v7 = [MEMORY[0x1E69DC650] alertControllerWithTitle:0 message:0 preferredStyle:0];
    [v7 _setSeparatedHeaderContentViewController:v13];
    v9 = MEMORY[0x1E69DC648];
    v10 = CKFrameworkBundle();
    v11 = [v10 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
    v12 = [v9 actionWithTitle:v11 style:1 handler:0];

    [v7 addAction:v12];
    [(CKChatController *)self presentViewController:v7 animated:1 completion:0];
  }
}

- (void)messageHistoryViewController:(id)a3 didSelectDate:(id)a4 withMessages:(id)a5
{
  v21 = *MEMORY[0x1E69E9840];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v6 = a5;
  v7 = [v6 countByEnumeratingWithState:&v16 objects:v20 count:16];
  v8 = v6;
  if (v7)
  {
    v9 = v7;
    v10 = *v17;
LABEL_3:
    v11 = 0;
    while (1)
    {
      if (*v17 != v10)
      {
        objc_enumerationMutation(v6);
      }

      v12 = *(*(&v16 + 1) + 8 * v11);
      if ([v12 messagePartCount] > 0)
      {
        break;
      }

      if (v9 == ++v11)
      {
        v9 = [v6 countByEnumeratingWithState:&v16 objects:v20 count:16];
        if (v9)
        {
          goto LABEL_3;
        }

        v8 = v6;
        goto LABEL_12;
      }
    }

    v8 = v12;

    if (!v8)
    {
      goto LABEL_13;
    }

    v13 = [v8 guid];
    v14 = [(CKCoreChatController *)self conversation];
    v15 = [v14 ensureMessageWithGUIDIsLoaded:v13];
    [(CKChatController *)self scrollToMessageGUID:v13 partIndex:0x7FFFFFFFFFFFFFFFLL highlight:1 scrollPosition:1];
  }

LABEL_12:

LABEL_13:
}

- (id)dateOfNewestVisibleMessageForMessageHistoryViewController:(id)a3
{
  v33 = *MEMORY[0x1E69E9840];
  v27 = a3;
  v4 = [(CKChatController *)self collectionView];
  v25 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v25 chatItems];
  v26 = v4;
  v6 = [v4 indexPathsForVisibleItems];
  v28 = 0u;
  v29 = 0u;
  v30 = 0u;
  v31 = 0u;
  v7 = [v6 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = 0;
    v10 = *v29;
    v11 = off_1E72E5000;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v29 != v10)
        {
          objc_enumerationMutation(v6);
        }

        v13 = *(*(&v28 + 1) + 8 * i);
        if (![v13 section])
        {
          v14 = [v13 item];
          if (v14 < [v5 count])
          {
            v15 = [v5 objectAtIndex:v14];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v16 = v15;
              v17 = [v16 time];
              v18 = v17;
              if (v17 && (!v9 || [v17 compare:v9] == 1))
              {
                v19 = v18;
                v20 = v9;
                v21 = v11;
                v22 = v19;

                v23 = v22;
                v11 = v21;
                v9 = v23;
              }
            }
          }
        }
      }

      v8 = [v6 countByEnumeratingWithState:&v28 objects:v32 count:16];
    }

    while (v8);
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (void)sendAnimationManagerWillStartAnimation:(id)a3 context:(id)a4
{
  v5 = a4;
  v75[0] = MEMORY[0x1E69E9820];
  v75[1] = 3221225472;
  v75[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke;
  v75[3] = &unk_1E72EBA18;
  v75[4] = self;
  [MEMORY[0x1E69DD250] performWithoutAnimation:v75];
  v6 = [(CKChatController *)self entryView];
  v7 = [(CKChatController *)self collectionView];
  [v6 placeholderHeight];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_2;
  aBlock[3] = &unk_1E72EBC38;
  v74 = v8;
  v9 = v6;
  v72 = v9;
  v73 = self;
  v10 = _Block_copy(aBlock);
  if ([(CKChatController *)self _shouldHideNavigationBarForSendAnimationContext:v5])
  {
    v70[0] = MEMORY[0x1E69E9820];
    v70[1] = 3221225472;
    v70[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_3;
    v70[3] = &unk_1E72EBA18;
    v70[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:0x10000 delay:v70 options:0 animations:0.2 completion:0.0];
  }

  [v5 throwAnimationSourceRect];
  v11 = CGRectEqualToRect(v76, *MEMORY[0x1E695F058]);
  if (!v11)
  {
    [v7 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];
  }

  v12 = !v11;
  [v7 setScrollEnabled:0];
  [(CKChatController *)self _contentInsetForSendAnimation];
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v20 = v19;
  [v7 contentInset];
  v22 = v21;
  [(CKScrollViewController *)self computedInsets];
  v24 = v23 - (v22 - v18);
  [v7 setContentInset:{v14, v16, v18, v20}];
  [(CKScrollViewController *)self updateComputedInsetsForSendAnimation:v14, v16, v24, v20];
  [(CKScrollViewController *)self computedInsets];
  v26 = v25;
  v28 = v27;
  v30 = v29;
  v32 = v31;
  v33 = [v5 messages];
  v34 = [v33 firstObject];
  v35 = [v34 scheduleType];

  if (v35 == 2)
  {
    [v7 __ck_bottomOffsetWithComputedInsets:{v26, v28, v30, v32}];
    v37 = v36;
    v39 = v38;
  }

  else
  {
    v40 = [(CKCoreChatController *)self collectionViewController];
    v41 = [v40 latestScheduledMessageIndexPath];
    [v7 __ck_bottomOffsetHidingIndexPath:v41 computedInsets:{v26, v28, v30, v32}];
    v37 = v42;
    v39 = v43;
  }

  v44 = [v5 sendAnimationType];
  if (!v44)
  {
    v53 = MEMORY[0x1E69DD250];
    v60[0] = MEMORY[0x1E69E9820];
    v60[1] = 3221225472;
    v60[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_5;
    v60[3] = &unk_1E72F2540;
    v61 = v7;
    v62 = v37;
    v63 = v39;
    v64 = v12;
    [v53 animateWithDuration:v60 animations:0.3];

    goto LABEL_14;
  }

  if (v44 != 1)
  {
LABEL_14:
    v10[2](v10);
    goto LABEL_15;
  }

  v45 = MEMORY[0x1E69DD250];
  v65[0] = MEMORY[0x1E69E9820];
  v65[1] = 3221225472;
  v65[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_4;
  v65[3] = &unk_1E72F2540;
  v66 = v7;
  v67 = v37;
  v68 = v39;
  v69 = v12;
  [v45 animateWithSpringDuration:6 bounce:v65 initialSpringVelocity:0 delay:0.3 options:0.0 animations:0.0 completion:0.0];

  v46 = MEMORY[0x1E69DD250];
  v58[0] = MEMORY[0x1E69E9820];
  v58[1] = 3221225472;
  v58[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_6;
  v58[3] = &unk_1E72EBA18;
  v47 = v9;
  v59 = v47;
  [v46 performWithoutAnimation:v58];
  v48 = [MEMORY[0x1E695E000] standardUserDefaults];
  v49 = [v48 ck_isUsingSpecialGlassDuringSendAnimationEnabled];

  if (v49)
  {
    v50 = MEMORY[0x1E69DD250];
    v56[0] = MEMORY[0x1E69E9820];
    v56[1] = 3221225472;
    v56[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_7;
    v56[3] = &unk_1E72EBA18;
    v57 = v47;
    [v50 animateWithDuration:v56 animations:0.05];
  }

  v51 = [objc_alloc(MEMORY[0x1E69DCF88]) initWithMass:2.0 stiffness:447.0 damping:49.0 initialVelocity:{0.0, 0.0}];
  v52 = [objc_alloc(MEMORY[0x1E69DD278]) initWithDuration:v51 timingParameters:0.63636];
  v54[0] = MEMORY[0x1E69E9820];
  v54[1] = 3221225472;
  v54[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_8;
  v54[3] = &unk_1E72EBDB8;
  v55 = v10;
  [v52 addAnimations:v54];
  [v52 startAnimation];

LABEL_15:
}

void __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 invalidateCompositionForReason:1];
}

uint64_t __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) frame];
  v2 = *(a1 + 40);

  return [v2 _setEntryViewFrame:0 animated:?];
}

void __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_3(uint64_t a1)
{
  v1 = [*(a1 + 32) currentNavigationBarBasedOnSizeClass];
  [v1 setAlpha:0.0];
}

uint64_t __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_4(uint64_t a1)
{
  result = [*(a1 + 32) setContentOffset:{*(a1 + 40), *(a1 + 48)}];
  if (*(a1 + 56) == 1)
  {
    v3 = *(a1 + 32);

    return [v3 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];
  }

  return result;
}

uint64_t __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_5(uint64_t a1)
{
  result = [*(a1 + 32) setContentOffset:{*(a1 + 40), *(a1 + 48)}];
  if (*(a1 + 56) == 1)
  {
    v3 = *(a1 + 32);

    return [v3 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];
  }

  return result;
}

- (UIEdgeInsets)_contentInsetForSendAnimation
{
  v3 = [(CKChatController *)self entryView];
  v4 = [(CKChatController *)self collectionView];
  [v4 contentInset];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  [v3 bounds];
  v12 = v11;
  [v3 placeholderHeight];
  v14 = v8 - (v12 - v13);
  [(CKScrollViewController *)self navigationBarInsetsWithoutPalette];
  v16 = v15;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v18 = v16 + v17;

  v19 = v18;
  v20 = v6;
  v21 = v14;
  v22 = v10;
  result.right = v22;
  result.bottom = v21;
  result.left = v20;
  result.top = v19;
  return result;
}

- (void)sendAnimationManagerDidStopAnimation:(id)a3 context:(id)a4
{
  v5 = a4;
  v6 = MEMORY[0x1E69DD250];
  v10 = MEMORY[0x1E69E9820];
  v11 = 3221225472;
  v12 = __80__CKChatController_SendAnimation__sendAnimationManagerDidStopAnimation_context___block_invoke;
  v13 = &unk_1E72EB8D0;
  v14 = self;
  v15 = v5;
  v7 = v5;
  [v6 animateWithDuration:0x20000 delay:&v10 options:0 animations:0.2 completion:0.0];
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ThrowAnimation", v10, v11, v12, v13, v14];
  [(CKChatController *)self setIsAnimatingMessageSend:1];
  v8 = [(CKChatController *)self _fullscreenEffectsManager];
  [v8 endHoldingUpdatesForKey:@"CKFullscreenUpdatesSendAnimation"];

  v9 = [(CKChatController *)self collectionView];
  [v9 endHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];

  [(CKChatController *)self setThrowSendAnimationManager:0];
  [(CKChatController *)self _finishSendAnimation];
}

void __80__CKChatController_SendAnimation__sendAnimationManagerDidStopAnimation_context___block_invoke(uint64_t a1)
{
  if ([*(a1 + 32) _shouldHideNavigationBarForSendAnimationContext:*(a1 + 40)])
  {
    v2 = [*(a1 + 32) currentNavigationBarBasedOnSizeClass];
    [v2 setAlpha:1.0];
  }

  v3 = [*(a1 + 32) entryView];
  [v3 applyDefaultGlass];
}

- (id)_fullscreenEffectsManager
{
  v2 = [(CKCoreChatController *)self collectionViewController];
  v3 = [v2 fullscreenEffectManager];

  return v3;
}

- (void)_finishSendAnimation
{
  v3 = [(CKCoreChatController *)self conversation];
  [v3 setIgnoringTypingUpdates:0];

  if (![(CKChatController *)self isAnimatingMessageSend])
  {
    return;
  }

  v4 = [(CKCoreChatController *)self collectionViewController];
  [v4 setHiddenItems:0];

  v5 = [(CKCoreChatController *)self conversation];
  v6 = [v5 chat];
  v7 = [v6 guid];
  if (v7)
  {
    v8 = v7;
    v40 = [(CKCoreChatController *)self conversation];
    v9 = [v40 chat];
    v10 = [v9 guid];
    v11 = +[CKConversationList sharedConversationList];
    v12 = [v11 pendingConversation];
    v13 = [v12 chat];
    v14 = [v13 guid];
    v38 = [v10 isEqualToString:v14];

    if (!v38)
    {
      goto LABEL_7;
    }

    v5 = +[CKConversationList sharedConversationList];
    [v5 unpendConversation];
  }

  else
  {
  }

LABEL_7:
  v15 = [(CKCoreChatController *)self conversation];
  v16 = [(CKCoreChatController *)self conversation];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v18 = +[CKConversationList sharedConversationList];
    v19 = [v15 chat];
    v20 = [v18 conversationForExistingChat:v19];

    if (v20)
    {
      v21 = v20;

      v15 = v21;
    }
  }

  [(CKChatController *)self _didSendCompositionInConversation:v15];
  v22 = [(CKCoreChatController *)self collectionViewController];
  v23 = [v22 collectionView];
  [(CKChatController *)self setSendingMessage:0];
  [(CKChatController *)self setIsAnimatingMessageSend:0];
  [(CKChatController *)self endHoldingAutorotationForKey:@"CKHoldingRotationReasonThrowAnimation"];
  [v23 endDisablingTranscriptDynamicsForReason:5];
  [v23 setScrollEnabled:1];
  v24 = [(CKCoreChatController *)self conversation];
  v25 = [v24 chat];
  v26 = [v25 guid];
  if (!v26)
  {

    goto LABEL_15;
  }

  v27 = v26;
  v37 = [(CKCoreChatController *)self conversation];
  v36 = [v37 chat];
  v28 = [v36 guid];
  +[CKConversationList sharedConversationList];
  v29 = v41 = v15;
  [v29 pendingConversation];
  v30 = v39 = v22;
  v31 = [v30 chat];
  v32 = [v31 guid];
  v35 = [v28 isEqualToString:v32];

  v22 = v39;
  v15 = v41;

  if (v35)
  {
    v24 = +[CKConversationList sharedConversationList];
    [v24 unpendConversation];
LABEL_15:
  }

  [(CKChatController *)self _updateNavigationButtons];
  v33 = [v22 chat];
  [v33 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57E0]];
  [MEMORY[0x1E69DD258] attemptRotationToDeviceOrientation];
  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  if ([v23 transcriptScrollIntent] == 3)
  {
    v34 = IMLogHandleForCategory();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      [(CKChatController(SendAnimation) *)v34 _finishSendAnimation];
    }

    [v22 updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];
  }
}

- (BOOL)__shouldHideNavigationBarForThrowBalloonViewAttributesCollection:(id)a3 inContainerView:(id)a4 framesOfAddedChatItems:(id)a5
{
  v27 = *MEMORY[0x1E69E9840];
  v7 = a5;
  [(CKChatController *)self _convertedNavigationBarFrameInSendAnimationContainerView:a4];
  v9 = v8;
  v11 = v10;
  v13 = v12;
  v15 = v14;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v16 = v7;
  v17 = [v16 countByEnumeratingWithState:&v22 objects:v26 count:16];
  if (v17)
  {
    v18 = *v23;
    while (2)
    {
      for (i = 0; i != v17; ++i)
      {
        if (*v23 != v18)
        {
          objc_enumerationMutation(v16);
        }

        [*(*(&v22 + 1) + 8 * i) CGRectValue];
        MinY = CGRectGetMinY(v28);
        v29.origin.x = v9;
        v29.origin.y = v11;
        v29.size.width = v13;
        v29.size.height = v15;
        if (MinY < CGRectGetMaxY(v29))
        {
          LOBYTE(v17) = 1;
          goto LABEL_11;
        }
      }

      v17 = [v16 countByEnumeratingWithState:&v22 objects:v26 count:16];
      if (v17)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v17;
}

- (BOOL)_shouldHideNavigationBarForSendAnimationContext:(id)a3
{
  v4 = a3;
  v5 = [v4 sendAnimationType];
  v6 = [v4 throwBalloonViewAttributesCollection];
  if (v5 == 1)
  {
    v7 = [v4 behindGlassContainerView];
  }

  else
  {
    if (v5)
    {
      v8 = 0;
      goto LABEL_7;
    }

    v7 = [v4 containerView];
  }

  v8 = v7;
LABEL_7:
  v9 = [v4 framesOfAddedChatItems];
  v10 = [(CKChatController *)self __shouldHideNavigationBarForThrowBalloonViewAttributesCollection:v6 inContainerView:v8 framesOfAddedChatItems:v9];

  return v10;
}

- (CGRect)_convertedNavigationBarFrameInSendAnimationContainerView:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  v6 = [v5 superview];
  [v5 frame];
  [v6 convertRect:v4 toView:?];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;

  v15 = v8;
  v16 = v10;
  v17 = v12;
  v18 = v14;
  result.size.height = v18;
  result.size.width = v17;
  result.origin.y = v16;
  result.origin.x = v15;
  return result;
}

- (BOOL)throwAnimationUsesAnimatedReloadForMessages:(id)a3
{
  v20 = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v5 = [v4 isDiffableTranscriptDataSourceEnabled];

  if (v5)
  {
    v6 = 0;
  }

  else
  {
    v17 = 0u;
    v18 = 0u;
    v15 = 0u;
    v16 = 0u;
    v7 = v3;
    v8 = [v7 countByEnumeratingWithState:&v15 objects:v19 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v16;
      while (2)
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v16 != v10)
          {
            objc_enumerationMutation(v7);
          }

          v12 = [*(*(&v15 + 1) + 8 * i) balloonBundleID];
          v13 = [v12 length];

          if (v13)
          {
            v6 = 0;
            goto LABEL_13;
          }
        }

        v9 = [v7 countByEnumeratingWithState:&v15 objects:v19 count:16];
        if (v9)
        {
          continue;
        }

        break;
      }
    }

    v6 = 1;
LABEL_13:
  }

  return v6;
}

- (void)throwAnimationManager:(id)a3 canNowSendMessages:(id)a4
{
  v5 = a4;
  v6 = [(CKChatController *)self throwAnimationUsesAnimatedReloadForMessages:v5];
  v7 = [(CKCoreChatController *)self collectionViewController];
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __76__CKChatController_SendAnimation__throwAnimationManager_canNowSendMessages___block_invoke;
  v9[3] = &unk_1E72EB8D0;
  v9[4] = self;
  v10 = v5;
  v8 = v5;
  [v7 updateTranscript:v9 animated:v6 completion:0];
}

void __76__CKChatController_SendAnimation__throwAnimationManager_canNowSendMessages___block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) conversation];
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  obj = *(a1 + 40);
  v3 = [obj countByEnumeratingWithState:&v13 objects:v21 count:16];
  if (v3)
  {
    v5 = *v14;
    *&v4 = 138412546;
    v11 = v4;
    do
    {
      v6 = 0;
      do
      {
        if (*v14 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v13 + 1) + 8 * v6);
        if (IMOSLoggingEnabled())
        {
          v8 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
          {
            v9 = [v7 guid];
            v10 = [v2 uniqueIdentifier];
            *buf = v11;
            v18 = v9;
            v19 = 2112;
            v20 = v10;
            _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Throw animation is now sending message: %@ in conversation: %@", buf, 0x16u);
          }
        }

        [*(a1 + 32) sendMessage:v7 forConversation:v2 newComposition:{0, v11}];
        ++v6;
      }

      while (v3 != v6);
      v3 = [obj countByEnumeratingWithState:&v13 objects:v21 count:16];
    }

    while (v3);
  }
}

- (CGRect)throwAnimationWindowFrame:(id)a3
{
  v3 = [(CKChatController *)self navigationController];
  v4 = [v3 view];
  [v4 frame];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  v12 = v11;

  v13 = v6;
  v14 = v8;
  v15 = v10;
  v16 = v12;
  result.size.height = v16;
  result.size.width = v15;
  result.origin.y = v14;
  result.origin.x = v13;
  return result;
}

- (id)throwAnimationContainerSuperview:(id)a3
{
  v3 = [(CKChatController *)self view];
  v4 = [v3 window];

  return v4;
}

- (double)throwAnimationManagerTopHeaderHeight:(id)a3
{
  [(CKScrollViewController *)self navigationBarInsetsWithoutPalette];
  v5 = v4;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  return v5 + v6;
}

- (void)throwAnimationManagerPrepareForThrowAnimation:(id)a3 context:(id)a4
{
  [(CKChatController *)self setIsAnimatingMessageSend:1, a4];
  v7 = [(CKChatController *)self collectionView];
  [v7 beginDisablingTranscriptDynamicsForReason:5];
  [(CKChatController *)self beginHoldingAutorotationForKey:@"CKHoldingRotationReasonThrowAnimation"];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ThrowAnimation"];
  v5 = [(CKCoreChatController *)self chat];
  [v5 beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57E0]];
  v6 = [(CKChatController *)self _fullscreenEffectsManager];
  [v6 beginHoldingUpdatesForKey:@"CKFullscreenUpdatesSendAnimation"];
}

- (id)_audioMessageThrowBalloonsForSendingMessages:(id)a3 audioMessageSourceRect:(CGRect)a4 contextContainerView:(id)a5 audioRecordingPillViewSnapshot:(id)a6
{
  height = a4.size.height;
  width = a4.size.width;
  y = a4.origin.y;
  x = a4.origin.x;
  v36[1] = *MEMORY[0x1E69E9840];
  v13 = a6;
  v14 = a5;
  v15 = a3;
  v16 = [(CKCoreChatController *)self collectionViewController];
  v17 = [v16 chatItems];

  v18 = [v17 __ck_indexesOfPartsOfMessages:v15];

  v19 = [v17 objectAtIndexedSubscript:{objc_msgSend(v18, "firstIndex")}];
  v20 = CKBalloonViewForClass([v19 balloonViewClass]);
  [v20 configureForMessagePart:v19];
  [v20 setIsBeingUsedInThrowAnimation:1];
  [v20 setCanUseOpaqueMask:0];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v21 = v20;
    v22 = [(CKCoreChatController *)self gradientReferenceView];
    [v21 setGradientReferenceView:v22];
  }

  [v20 prepareForDisplayIfNeeded];
  v23 = [objc_alloc(MEMORY[0x1E69DD250]) initWithFrame:{x, y, width, height}];
  v24 = [MEMORY[0x1E69DC888] clearColor];
  [v23 setBackgroundColor:v24];

  [v14 addSubview:v23];
  v25 = *MEMORY[0x1E695EFF8];
  v26 = *(MEMORY[0x1E695EFF8] + 8);
  [v19 size];
  v28 = width - v27;
  [v19 size];
  [v20 setFrame:{v28, 0.0, v29, v30}];
  [v20 layoutIfNeeded];
  [v23 addSubview:v20];
  v31 = v13;
  [v31 setFrame:{v25, v26, width, height}];
  [v23 insertSubview:v31 aboveSubview:v20];
  v32 = objc_alloc_init(CKSendAnimationSupplementaryViews);
  [(CKSendAnimationSupplementaryViews *)v32 setTextViewContainerView:v23];
  [(CKSendAnimationSupplementaryViews *)v32 setAudioMessagePillViewSnapshot:v31];

  v33 = objc_alloc_init(CKThrowBalloonViewAttributes);
  [(CKThrowBalloonViewAttributes *)v33 setSupplementaryViews:v32];
  [(CKThrowBalloonViewAttributes *)v33 setThrowBalloonView:v20];
  v36[0] = v33;
  v34 = [MEMORY[0x1E695DEC8] arrayWithObjects:v36 count:1];

  return v34;
}

- (id)_throwBalloonAttributesForSendAnimationWithType:(unint64_t)a3 shouldUseQuickReplySourceRect:(BOOL)a4 quickReplySourceRect:(CGRect)a5 isRunningPhotosPlugin:(BOOL)a6 chatItem:(id)a7 isPhotosExtensionMediaPayload:(BOOL)a8 pluginChatItemCounterInOut:(unint64_t *)a9 containerView:(id)a10 isChatItemFromShelf:(BOOL)a11 isLastChatItem:(BOOL)a12 currentBalloonOriginInOut:(CGPoint *)a13 quickReplySnapshotView:(id)a14
{
  v15 = a8;
  width = a5.size.width;
  v206 = a4;
  v19 = a7;
  v20 = a10;
  v21 = a14;
  v211 = self;
  v217 = [(CKChatController *)self entryView];
  v22 = [v217 contentView];
  v216 = [v22 pluginView];
  if (a6 || v15)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v23 = 0;
      v24 = v216;
      v25 = v217;
      goto LABEL_88;
    }
  }

  v208 = v22;
  v219[0] = 0;
  v218 = 1.0;
  v26 = +[CKUIBehavior sharedBehaviors];
  [v26 balloonMaskTailSizeForTailShape:1];
  v28 = v27;

  v210 = objc_alloc_init(CKThrowBalloonViewAttributes);
  v215 = objc_alloc_init(CKSendAnimationSupplementaryViews);
  v29 = v19;
  v30 = CKBalloonViewForClass([v29 balloonViewClass]);
  objc_opt_class();
  v209 = v19;
  if (objc_opt_isKindOfClass())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      r1 = v20;
      v31 = v29;
      v32 = v30;
      v33 = [v31 bundleIdentifier];
      v34 = IMBalloonExtensionIDWithSuffix();
      v35 = [v33 isEqualToString:v34];

      if (v35)
      {
        v36 = [(CKCoreChatController *)v211 collectionViewController];
        v37 = [v36 transcriptIdentifier];
        [v32 configureForTranscriptPlugin:v31 context:v37];

        [v32 setShouldPerformSendAnimationOnAppear];
        v38 = objc_alloc(MEMORY[0x1E69DD648]);
        v39 = [v32 pluginView];
        v40 = [v38 initWithSourceView:v39];

        [v40 setHidesSourceView:1];
        [v40 setMatchesTransform:1];
        [v32 pluginInsets];
        [v40 setLayoutMargins:?];
        v41 = [MEMORY[0x1E69DC888] clearColor];
        [v40 setBackgroundColor:v41];
      }

      else
      {
        v42 = [(CKChatController *)v211 entryView];
        v43 = [v42 contentView];
        v40 = [v43 pluginSnapshotViewForPluginAtIndex:*a9 isFromTextAttachment:v219 startingScaleMultiplier:&v218];

        v41 = [(CKCoreChatController *)v211 collectionViewController];
        v44 = [v41 transcriptIdentifier];
        [v32 configureForTranscriptPlugin:v31 context:v44];
      }

      [v32 setPluginSnapshotViewForThrowAnimation:v40];
      v20 = r1;
      v25 = v217;
    }

    else
    {
      objc_opt_class();
      v25 = v217;
      if (objc_opt_isKindOfClass())
      {
        [v30 configureForTranscriptPlugin:v29];
      }
    }

    if (a9)
    {
      ++*a9;
    }
  }

  else
  {
    objc_opt_class();
    v25 = v217;
    if (objc_opt_isKindOfClass())
    {
      [v30 configureForMessagePart:v29];
    }

    else
    {
      [v30 configureForChatItem:v29];
    }
  }

  [v30 setIsBeingUsedInThrowAnimation:1];
  [v30 setCanUseOpaqueMask:0];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (a3)
    {
      if (a3 == 1)
      {
        [v20 insertSubview:v30 atIndex:0];
      }
    }

    else
    {
      [v20 addSubview:v30];
    }
  }

  [v29 size];
  v46 = v45;
  v48 = v47;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v49 = v30;
    v50 = [(CKCoreChatController *)v211 gradientReferenceView];
    [v49 setGradientReferenceView:v50];
  }

  [v30 prepareForDisplayIfNeeded];
  [v30 tailInsetsForPillSize:{v46, v48}];
  v53 = v46 + v51 + v52;
  v201 = v48;
  v56 = v48 + v54 + v55;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (isKindOfClass)
  {
    v58 = v21;
    v59 = v20;
    [v30 setFrame:{*MEMORY[0x1E695EFF8], *(MEMORY[0x1E695EFF8] + 8), v53, v56}];
    [v30 layoutIfNeeded];
    v60 = v30;
    v61 = [v60 textView];
    [v61 frame];
    x = v62;
    y = v64;
    v67 = v66;
    r1a = v68;

    v69 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v70 = [v69 isAutomaticOutgoingTranslationEnabled];

    v196 = width;
    v198 = v56;
    v194 = v53;
    v195 = v46;
    v193 = v28;
    v199 = v67;
    if (v70 && ([MEMORY[0x1E69A8070] sharedFeatureFlags], v71 = objc_claimAutoreleasedReturnValue(), v72 = objc_msgSend(v71, "isSendAnimationRefreshEnabled"), v71, v72))
    {
      v73 = [v60 translationSecondaryTextView];
      v74 = v73;
      if (v73 && ([v73 isHidden] & 1) == 0)
      {
        [v74 frame];
        v231.origin.x = v75;
        v231.origin.y = v76;
        v231.size.width = v77;
        v231.size.height = v78;
        v221.origin.x = x;
        v221.origin.y = y;
        v221.size.width = v67;
        v221.size.height = r1a;
        v222 = CGRectUnion(v221, v231);
        x = v222.origin.x;
        y = v222.origin.y;
        v199 = v222.size.width;
        r1a = v222.size.height;
      }

      v20 = v59;

      v21 = v58;
      v25 = v217;
    }

    else
    {
      v20 = v59;
      v21 = v58;
    }

    [v60 bounds];
    v81 = v223.origin.x;
    v82 = v223.origin.y;
    v83 = v223.size.width;
    height = v223.size.height;
    v214 = y - v223.origin.y;
    MaxY = CGRectGetMaxY(v223);
    v224.origin.x = x;
    v224.origin.y = y;
    v224.size.width = v199;
    v224.size.height = r1a;
    v79 = MaxY - CGRectGetMaxY(v224);
    v225.origin.x = v81;
    v225.origin.y = v82;
    v225.size.width = v83;
    v225.size.height = height;
    CGRectGetMaxX(v225);
    v226.origin.x = x;
    v226.origin.y = y;
    v226.size.width = v199;
    v226.size.height = r1a;
    [v25 coverViewWidth];
    v87 = v193 + v86;
    if (v206)
    {
      v80 = v196;
    }

    else
    {
      v80 = v87;
    }

    v56 = v198;
    v53 = v194;
    v46 = v195;
  }

  else
  {
    v214 = *MEMORY[0x1E69DDCE0];
    v79 = *(MEMORY[0x1E69DDCE0] + 16);
    v80 = *(MEMORY[0x1E695F058] + 16);
  }

  v88 = a13->x;
  v89 = a13->y - v214;
  v90 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v91 = [v90 isAutomaticOutgoingTranslationEnabled];

  if (v91)
  {
    v92 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v93 = [v92 isSendAnimationRefreshEnabled];

    if (v93)
    {
      objc_opt_class();
      if (isKindOfClass & objc_opt_isKindOfClass())
      {
        v94 = v29;
        v95 = v30;
        v96 = [v94 alternateTranscriptText];
        v97 = v96;
        if (v96)
        {
          v98 = [v96 length];
          if (([v94 showTranslationAlternateText] & 1) == 0 && v98)
          {
            v99 = [v95 textView];
            [v99 frame];
            v89 = v89 + CGRectGetMaxY(v227);
          }
        }

        else
        {
          [v94 showTranslationAlternateText];
        }

        v25 = v217;
      }
    }
  }

  objc_opt_class();
  v100 = objc_opt_isKindOfClass();
  v23 = v210;
  if (!a11)
  {
    v118 = v100;
    v119 = v219[0];
    if ([v30 isAudioMessage])
    {
      [v20 convertRect:v25 fromView:{v88, v89, v53, v56}];
      [v30 setFrame:?];
      [v30 layoutIfNeeded];
      [v30 prepareForDisplayIfNeeded];
      v19 = v209;
      v24 = v216;
      goto LABEL_87;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v207 = v79;
      v120 = v30;
      v228.origin.x = v88;
      v228.origin.y = v89;
      v228.size.width = v53;
      v228.size.height = v56;
      v121 = CGRectGetHeight(v228);
      v122 = [objc_alloc(MEMORY[0x1E69DD250]) initWithFrame:{v88, v89, v80, v121}];
      v123 = [MEMORY[0x1E69DC888] clearColor];
      [v122 setBackgroundColor:v123];

      if (a3)
      {
        if (a3 == 1)
        {
          [v20 insertSubview:v122 atIndex:0];
        }
      }

      else
      {
        [v20 addSubview:v122];
      }

      [(CKSendAnimationSupplementaryViews *)v215 setTextViewContainerView:v122];
      [v120 frame];
      v137 = v136;
      v139 = v138;
      v229.origin.x = v88;
      v229.origin.y = v89;
      v229.size.width = v80;
      v229.size.height = v121;
      v140 = CGRectGetWidth(v229);
      [v120 frame];
      v141 = v140 - CGRectGetWidth(v230);
      v200 = [objc_alloc(MEMORY[0x1E69DD250]) initWithFrame:{v141, 0.0, v137, v139}];
      [v122 addSubview:?];
      [v120 setFrame:{v141, 0.0, v137, v139}];
      [v122 addSubview:v120];
      [v120 prepareForDisplayIfNeeded];
      v142 = CKBalloonViewForClass([v29 balloonViewClass]);
      [v142 configureForMessagePart:v29];
      if (([v142 balloonStyle] - 3) <= 1u)
      {
        [v142 setBalloonStyle:0];
      }

      if (a3 == 1)
      {
        v143 = 1;
      }

      else
      {
        if (a3)
        {
LABEL_77:
          r1b = v20;
          [v142 setIsBeingUsedInThrowAnimation:1];
          [v142 setCanUseOpaqueMask:0];
          [v142 prepareForDisplayIfNeeded];
          v144 = [v142 textView];
          v145 = [MEMORY[0x1E69DC888] labelColor];
          v146 = [v29 sendAnimationTextWithColor:v145];
          [v144 setAttributedText:v146];

          [v142 setFrame:{v141, 0.0, v137, v139}];
          [v142 layoutIfNeeded];
          if (a3 == 1)
          {
            [v142 setAlpha:0.0];
            [v120 setAlpha:0.0];
            [v142 setHidden:1];
          }

          v213 = v122;
          [v122 insertSubview:v142 aboveSubview:v120];
          [(CKSendAnimationSupplementaryViews *)v215 setWhiteTextFadeView:v142];
          v147 = [v120 textView];
          v148 = [v147 text];
          v149 = [v148 _isNaturallyRTL];

          if (v149)
          {
            v150 = [v120 textView];
            [v150 setHidden:1];

            v151 = [v142 textView];
            [v151 setHidden:1];

            v202 = v120;
            v152 = objc_alloc_init(MEMORY[0x1E69DD168]);
            v153 = [v29 transcriptText];
            [v152 setAttributedText:v153];

            v154 = [MEMORY[0x1E69DC888] clearColor];
            [v152 setBackgroundColor:v154];

            [v152 setTextAlignment:2];
            v155 = [v202 textView];
            [v155 textContainerInset];
            [v152 setTextContainerInset:?];

            v156 = [v25 contentView];
            v197 = [v156 textView];

            [v197 bounds];
            [v197 convertRect:v122 toView:?];
            v158 = v157;
            v160 = v159;
            v162 = v161;
            v164 = v163;
            [v152 setFrame:?];
            [v122 addSubview:v152];
            v165 = objc_alloc_init(MEMORY[0x1E69DD168]);
            v166 = [MEMORY[0x1E69DC888] labelColor];
            v167 = [v29 sendAnimationTextWithColor:v166];
            [v165 setAttributedText:v167];

            v168 = [MEMORY[0x1E69DC888] clearColor];
            [v165 setBackgroundColor:v168];

            [v165 setFrame:{v158, v160, v162, v164}];
            [v165 setTextAlignment:2];
            v169 = [v202 textView];
            [v169 textContainerInset];
            [v165 setTextContainerInset:?];

            [v122 addSubview:v165];
            [(CKSendAnimationSupplementaryViews *)v215 setWhiteTextFadeViewRTL:v165];
            [(CKSendAnimationSupplementaryViews *)v215 setBlueTextFadeViewRTL:v152];

            v25 = v217;
            v120 = v202;
          }

          if (v206)
          {
            v170 = v21;
            v171 = [(CKChatController *)v211 view];
            v172 = [(CKChatController *)v211 collectionView];
            [v171 insertSubview:v170 belowSubview:v172];

            [(CKSendAnimationSupplementaryViews *)v215 setQuickReplySnapshot:v170];
            v19 = v209;
          }

          else
          {
            v173 = [v25 sendButton];
            v170 = [v173 button];

            [v170 frame];
            v175 = v174;
            v177 = v176;
            v179 = v178;
            v181 = v180;
            v182 = [v170 superview];
            [v122 convertRect:v182 fromView:{v175, v177, v179, v181}];
            v184 = v183;
            v186 = v185;
            v188 = v187;
            v190 = v189;

            v191 = [v170 snapshotViewAfterScreenUpdates:0];
            [v191 setFrame:{v184, v186, v188, v190}];
            [v122 insertSubview:v191 aboveSubview:v142];
            [(CKSendAnimationSupplementaryViews *)v215 setSendButtonSnapshot:v191];
            v19 = v209;
            if (!a12)
            {
              [v191 setHidden:1];
            }
          }

          a13->y = v56 - (v207 + v214) + a13->y;
          v20 = r1b;
          v24 = v216;
          v23 = v210;
          goto LABEL_87;
        }

        v143 = 8;
      }

      [v142 setColor:v143];
      goto LABEL_77;
    }

    v124 = v118 & v119;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      objc_opt_class();
      v19 = v209;
      v24 = v216;
      if (!(v124 & 1 | ((objc_opt_isKindOfClass() & 1) == 0)))
      {
LABEL_57:
        [v30 setFrame:{v88, v89, v53, v56}];
        [v30 layoutIfNeeded];
        [v30 prepareForDisplayIfNeeded];
        v125 = v56 - (v79 + v214);
LABEL_68:
        a13->y = v125 + a13->y;
        goto LABEL_87;
      }
    }

    else
    {
      v19 = v209;
      v24 = v216;
      if ((v124 & 1) == 0)
      {
        goto LABEL_57;
      }
    }

    v126 = +[CKUIBehavior sharedBehaviors];
    [v25 coverViewWidth];
    [v126 composeBalloonMaxWidthForEntryContentViewWidth:?];
    v127 = v53;
    v128 = v79;
    v130 = v129 / v46;

    v131 = v46 * v130;
    v132 = v201 * v130;
    if (v130 >= 1.0)
    {
      v132 = v56;
      v131 = v127;
    }

    if (v218 >= 1.0)
    {
      v133 = v132;
    }

    else
    {
      v133 = v201 * v218;
    }

    if (v218 >= 1.0)
    {
      v134 = v131;
    }

    else
    {
      v134 = v46 * v218;
    }

    [v25 marginInsets];
    [v30 setFrame:{v88 + v135, v89, v134, v133}];
    [v30 layoutIfNeeded];
    [v30 prepareForDisplayIfNeeded];
    v125 = v133 - (v128 + v214);
    goto LABEL_68;
  }

  v24 = v216;
  [v216 frame];
  v102 = v101;
  v104 = v103;
  v106 = v105;
  v108 = v107;
  v109 = [v216 superview];
  [v20 convertRect:v109 fromView:{v102, v104, v106, v108}];
  v111 = v110;
  v113 = v112;
  v115 = v114;
  v117 = v116;

  [v30 setFrame:{v111, v113, v115, v117}];
  [v30 layoutIfNeeded];
  [v30 prepareForDisplayIfNeeded];
  v19 = v209;
LABEL_87:
  [(CKThrowBalloonViewAttributes *)v23 setSupplementaryViews:v215];
  [(CKThrowBalloonViewAttributes *)v23 setThrowBalloonView:v30];

  v22 = v208;
LABEL_88:

  return v23;
}

- (void)setupThrowBalloonsInSendAnimationContext:(id)a3
{
  v28 = a3;
  v4 = [v28 messages];
  v5 = [v28 shouldUseQuickReplySourceRect];
  [v28 quickReplySourceRect];
  v7 = v6;
  v9 = v8;
  v11 = v10;
  v13 = v12;
  v14 = [v28 quickReplySnapshotView];
  v15 = [v28 sendAnimationType];
  [v28 audioMessageSourceRect];
  v17 = v16;
  v19 = v18;
  v21 = v20;
  v23 = v22;
  v24 = [v28 audioRecordingPillViewSnapshot];
  if (v15 == 1)
  {
    v25 = [v28 behindGlassContainerView];
    goto LABEL_5;
  }

  if (!v15)
  {
    v25 = [v28 containerView];
LABEL_5:
    v26 = v25;
    goto LABEL_7;
  }

  v26 = 0;
LABEL_7:
  v27 = [(CKChatController *)self _makeThrowBalloonsForSendAnimationWithType:v15 inContainerView:v26 forSendingMessages:v4 shouldUseQuickReplySourceRect:v5 quickReplySourceRect:v14 quickReplySnapshotView:v24 audioMessageSourceRect:v7 audioRecordingPillViewSnapshot:v9, v11, v13, v17, v19, v21, v23];
  [v28 setThrowBalloonViewAttributesCollection:v27];
}

- (id)_makeThrowBalloonsForSendAnimationWithType:(unint64_t)a3 inContainerView:(id)a4 forSendingMessages:(id)a5 shouldUseQuickReplySourceRect:(BOOL)a6 quickReplySourceRect:(CGRect)a7 quickReplySnapshotView:(id)a8 audioMessageSourceRect:(CGRect)a9 audioRecordingPillViewSnapshot:(id)a10
{
  v68 = a6;
  height = a9.size.height;
  width = a9.size.width;
  y = a9.origin.y;
  x = a9.origin.x;
  v17 = a7.size.height;
  v18 = a7.size.width;
  v19 = a7.origin.y;
  v20 = a7.origin.x;
  v22 = a4;
  v23 = a5;
  v71 = a8;
  v67 = a10;
  v24 = [(CKCoreChatController *)self collectionViewController];
  v25 = [(CKChatController *)self entryView];
  v26 = [v25 contentView];
  v27 = [v25 contentView];
  v69 = [v27 pluginView];

  v28 = [(CKChatController *)self composition];
  v29 = [v28 shelfPluginPayload];

  v30 = [v29 pluginBundleID];
  v64 = [v30 isEqualToString:*MEMORY[0x1E69A6A00]];

  v31 = [v29 pluginBundleID];
  v32 = IMBalloonExtensionIDWithSuffix();
  v72 = v22;
  if ([v31 isEqualToString:v32] && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
  {
    v63 = [v29 shouldSendAsMediaObject];
  }

  else
  {
    v63 = 0;
  }

  v33 = [v23 lastObject];
  v66 = v24;
  v34 = [v24 chatItems];
  v35 = [v34 __ck_indexesOfPartsOfMessages:v23];
  v36 = [v33 isAudioMessage];
  v70 = v35;
  v37 = [v35 firstIndex];
  if (v37 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v38 = v37;
    if (v37 < [v34 count])
    {
      v39 = [v34 objectAtIndexedSubscript:v38];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        CKBalloonViewForClass([v39 balloonViewClass]);
        v40 = v29;
        v41 = v25;
        v42 = v23;
        v44 = v43 = v33;
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        v33 = v43;
        v23 = v42;
        v25 = v41;
        v29 = v40;

        if ((v36 & isKindOfClass) == 1)
        {
          v45 = v72;
          v46 = v67;
          v47 = [(CKChatController *)self _audioMessageThrowBalloonsForSendingMessages:v23 audioMessageSourceRect:v72 contextContainerView:v67 audioRecordingPillViewSnapshot:x, y, width, height];
          goto LABEL_19;
        }
      }

      else
      {
      }
    }
  }

  v97 = 0;
  v98 = &v97;
  v99 = 0x3010000000;
  v101 = 0;
  v102 = 0;
  v100 = &unk_190F92BB2;
  [v26 bounds];
  [v26 convertRect:v72 toView:?];
  v101 = v48;
  v102 = v49;
  [v26 contentOffset];
  v98[5] = v98[5] - v50;
  v51 = [v23 firstObject];
  v52 = [v51 scheduleType];

  if ([v25 shouldShowSubject] && (objc_msgSend(v33, "subject"), v53 = objc_claimAutoreleasedReturnValue(), v53, !v53) || v69 || v52 == 2)
  {
    v59 = [v26 textView];
    [v59 frame];
    v54 = v29;
    v55 = v25;
    v56 = v23;
    v57 = v33;
    v98[5] = v60 + v98[5];
  }

  else
  {
    v54 = v29;
    v55 = v25;
    v56 = v23;
    v57 = v33;
    if (v68)
    {
      v58 = v98;
      v98[4] = v20;
      v58[5] = v19;
    }
  }

  v96[0] = 0;
  v96[1] = v96;
  v96[2] = 0x2020000000;
  v96[3] = 0;
  v90 = 0;
  v91 = &v90;
  v92 = 0x3032000000;
  v93 = __Block_byref_object_copy__32;
  v94 = __Block_byref_object_dispose__32;
  v95 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v73[0] = MEMORY[0x1E69E9820];
  v73[1] = 3221225472;
  v73[2] = __241__CKChatController_SendAnimation___makeThrowBalloonsForSendAnimationWithType_inContainerView_forSendingMessages_shouldUseQuickReplySourceRect_quickReplySourceRect_quickReplySnapshotView_audioMessageSourceRect_audioRecordingPillViewSnapshot___block_invoke;
  v73[3] = &unk_1E72F2568;
  v74 = v70;
  v75 = v26;
  v76 = self;
  v87 = v68;
  v83 = v20;
  v84 = v19;
  v85 = v18;
  v86 = v17;
  v88 = v64;
  v89 = v63;
  v82 = a3;
  v79 = v96;
  v45 = v72;
  v77 = v72;
  v80 = &v97;
  v78 = v71;
  v81 = &v90;
  [v34 enumerateObjectsAtIndexes:v74 options:0 usingBlock:v73];
  v47 = [v91[5] copy];

  _Block_object_dispose(&v90, 8);
  _Block_object_dispose(v96, 8);
  _Block_object_dispose(&v97, 8);
  v46 = v67;
  v33 = v57;
  v23 = v56;
  v25 = v55;
  v29 = v54;
LABEL_19:

  return v47;
}

void __241__CKChatController_SendAnimation___makeThrowBalloonsForSendAnimationWithType_inContainerView_forSendingMessages_shouldUseQuickReplySourceRect_quickReplySourceRect_quickReplySnapshotView_audioMessageSourceRect_audioRecordingPillViewSnapshot___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = *(a1 + 32);
  v6 = a2;
  if ([v5 firstIndex] == a3)
  {
    v7 = [*(a1 + 40) pluginView];
    v8 = v7 != 0;
  }

  else
  {
    v8 = 0;
  }

  BYTE1(v12) = [*(a1 + 32) lastIndex] != a3;
  LOBYTE(v12) = v8;
  v13 = [*(a1 + 48) _throwBalloonAttributesForSendAnimationWithType:*(a1 + 96) shouldUseQuickReplySourceRect:*(a1 + 136) quickReplySourceRect:*(a1 + 137) isRunningPhotosPlugin:v6 chatItem:*(a1 + 138) isPhotosExtensionMediaPayload:*(*(a1 + 72) + 8) + 24 pluginChatItemCounterInOut:*(a1 + 104) containerView:*(a1 + 112) isChatItemFromShelf:*(a1 + 120) isLastChatItem:*(a1 + 128) currentBalloonOriginInOut:*(a1 + 56) quickReplySnapshotView:{v12, *(*(a1 + 80) + 8) + 32, *(a1 + 64)}];

  v9 = *(*(a1 + 88) + 8);
  v10 = *(v9 + 40);
  if (v13)
  {
    [*(v9 + 40) addObject:v13];
  }

  else
  {
    v11 = [MEMORY[0x1E695DFB0] null];
    [v10 addObject:v11];
  }
}

- (id)previewItemsForMediaObject:(id)a3 currentItemIndex:(int64_t *)a4 containsRestoring:(BOOL *)a5
{
  v8 = a3;
  if (v8)
  {
    v9 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v35 = 0;
    v36 = &v35;
    v37 = 0x2020000000;
    v38 = 0x7FFFFFFFFFFFFFFFLL;
    v31 = 0;
    v32 = &v31;
    v33 = 0x2020000000;
    v34 = 0;
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke;
    aBlock[3] = &unk_1E72F3128;
    v10 = v9;
    v27 = v10;
    v11 = v8;
    v28 = v11;
    v29 = &v35;
    v30 = &v31;
    v12 = _Block_copy(aBlock);
    v13 = [(CKChatController *)self _chatItemForMediaObject:v11];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
      v15 = [v14 layoutGroupIdentifier];
    }

    else
    {
      v15 = 0;
    }

    v17 = [(CKCoreChatController *)self collectionViewController];
    v18 = [v17 chatItems];

    v23[0] = MEMORY[0x1E69E9820];
    v23[1] = 3221225472;
    v23[2] = __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke_2;
    v23[3] = &unk_1E72F3150;
    v19 = v15;
    v24 = v19;
    v20 = v12;
    v25 = v20;
    [v18 enumerateObjectsUsingBlock:v23];
    if (a4)
    {
      *a4 = v36[3];
    }

    if (a5)
    {
      *a5 = *(v32 + 24);
    }

    v21 = v25;
    v16 = v10;

    _Block_object_dispose(&v31, 8);
    _Block_object_dispose(&v35, 8);
  }

  else
  {
    v16 = 0;
  }

  return v16;
}

void __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke(uint64_t a1, void *a2)
{
  v10 = a2;
  v3 = [v10 shouldBeQuickLooked];
  v4 = v10;
  if (v3)
  {
    v5 = [v10 transfer];
    v6 = [v5 isRestoring];
    if ((v6 & 1) != 0 || [v5 isFileDataReady])
    {
      [*(a1 + 32) addObject:v10];
      v7 = [v10 transferGUID];
      v8 = [*(a1 + 40) transferGUID];
      v9 = [v7 isEqualToString:v8];

      if (v9)
      {
        *(*(*(a1 + 48) + 8) + 24) = [*(a1 + 32) count] - 1;
      }

      if (v6)
      {
        *(*(*(a1 + 56) + 8) + 24) = 1;
      }
    }

    v4 = v10;
  }
}

void __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke_2(uint64_t a1, void *a2)
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (([v3 itemIsReplyContextPreview] & 1) == 0)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      if (![*(a1 + 32) length] || (v4 = *(a1 + 32), objc_msgSend(v3, "layoutGroupIdentifier"), v5 = objc_claimAutoreleasedReturnValue(), LODWORD(v4) = objc_msgSend(v4, "isEqualToString:", v5), v5, v4))
      {
        v6 = [v3 mediaObject];
        (*(*(a1 + 40) + 16))();
LABEL_16:
      }
    }

    else
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        if (![*(a1 + 32) length] || (v7 = *(a1 + 32), objc_msgSend(v3, "layoutGroupIdentifier"), v8 = objc_claimAutoreleasedReturnValue(), LODWORD(v7) = objc_msgSend(v7, "isEqualToString:", v8), v8, v7))
        {
          v6 = [v3 mediaObjects];
          v13 = 0u;
          v14 = 0u;
          v15 = 0u;
          v16 = 0u;
          v9 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
          if (v9)
          {
            v10 = v9;
            v11 = *v14;
            do
            {
              v12 = 0;
              do
              {
                if (*v14 != v11)
                {
                  objc_enumerationMutation(v6);
                }

                (*(*(a1 + 40) + 16))();
                ++v12;
              }

              while (v10 != v12);
              v10 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
            }

            while (v10);
          }

          goto LABEL_16;
        }
      }
    }
  }
}

- (void)updateQLPreviewControllerIfVisible
{
  v3 = [(CKChatController *)self navigationController];
  v4 = [v3 visibleViewController];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
    v6 = [v5 currentPreviewItem];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = 0x7FFFFFFFFFFFFFFFLL;
      v11 = 0;
      v7 = [(CKChatController *)self previewItemsForMediaObject:v6 currentItemIndex:&v12 containsRestoring:&v11];
      v8 = [v5 dataSource];
      [v8 setPreviewItems:v7];

      if (v11 == 1)
      {
        v9 = CKFrameworkBundle();
        v10 = [v9 localizedStringForKey:@"RESTORING" value:&stru_1F04268F8 table:@"ChatKit"];
        [v5 setLoadingTextForMissingFiles:v10];
      }

      else
      {
        [v5 setLoadingTextForMissingFiles:&stru_1F04268F8];
      }

      [v5 reloadData];
      [v5 setCurrentPreviewItemIndex:v12];
      [v5 refreshCurrentPreviewItem];
    }

    else
    {
      if (!IMOSLoggingEnabled())
      {
LABEL_11:

        goto LABEL_12;
      }

      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "currentPreviewItem could not be cast as CKMediaObject", buf, 2u);
      }
    }

    goto LABEL_11;
  }

LABEL_12:
}

- (void)updateQLPreviewControllerBarButtonItemsIfVisible
{
  v2 = [(CKChatController *)self previewController];
  [v2 updateBarButtonItems];
}

- (BOOL)_displayPreviewItemForMediaObject:(id)a3
{
  v30 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = +[CKUIBehavior sharedBehaviors];
  v6 = [v5 isSizeConstrained];

  if (v6)
  {
    v7 = [(CKChatController *)self _displayMediaObjectFullscreen:v4];
  }

  else
  {
    v27 = 0x7FFFFFFFFFFFFFFFLL;
    v26 = 0;
    v8 = [(CKChatController *)self previewItemsForMediaObject:v4 currentItemIndex:&v27 containsRestoring:&v26];
    v9 = [v8 count];
    v7 = v9 != 0;
    if (v9)
    {
      v10 = [(CKChatController *)self previewController];
      v11 = v10 == 0;

      if (v11 && !CKIsRunningInMacCatalyst())
      {
        v12 = objc_alloc_init(CKQLPreviewController);
        [(CKChatController *)self setPreviewController:v12];
      }

      v13 = [(CKChatController *)self previewController];
      [v13 setDelegate:self];
      v14 = objc_alloc_init(CKQLPreviewControllerDataSource);
      [(CKChatController *)self setQlPreviewDataSource:v14];

      v15 = [(CKChatController *)self qlPreviewDataSource];
      [v15 setPreviewItems:v8];

      v16 = [(CKChatController *)self qlPreviewDataSource];
      [v13 setDataSource:v16];

      [v13 reloadData];
      [v13 setCurrentPreviewItemIndex:v27];
      [v13 refreshCurrentPreviewItem];
      if (!CKIsRunningInMacCatalyst())
      {
        [v13 setModalPresentationStyle:0];
        if (v26 == 1)
        {
          v17 = CKFrameworkBundle();
          v18 = [v17 localizedStringForKey:@"RESTORING" value:&stru_1F04268F8 table:@"ChatKit"];
          [v13 setLoadingTextForMissingFiles:v18];
        }
      }

      v19 = [(CKChatController *)self entryView];
      v20 = [v19 contentView];
      -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [v20 isActive]);

      v25.receiver = self;
      v25.super_class = CKChatController;
      [(CKChatController *)&v25 becomeFirstResponder];
      if (CKIsRunningInMacCatalyst())
      {
        [v13 presentPreview];
      }

      else
      {
        if (IMOSLoggingEnabled())
        {
          v21 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            *buf = 134217984;
            v29 = v4;
            _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "will display preview for media object: %p", buf, 0xCu);
          }
        }

        [(CKChatController *)self setIsShowingPreview:1];
        v22 = [(CKCoreChatController *)self collectionViewController];
        v23 = [v22 collectionView];
        [v23 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];

        [(CKChatController *)self presentViewController:v13 animated:1 completion:0];
      }
    }
  }

  return v7;
}

- (void)_showReaderForAggregateChatItem:(id)a3 balloonView:(id)a4
{
  v9 = a4;
  v6 = [CKReaderViewController readerViewControllerForChatItem:a3];
  [v6 setDelegate:self];
  if (CKIsRunningInMacCatalyst())
  {
    [v6 setModalPresentationStyle:7];
    v7 = [v6 popoverPresentationController];
    [v7 setSourceView:v9];

    [(CKChatController *)self presentViewController:v6 animated:1 completion:0];
  }

  else
  {
    [(CKChatController *)self showViewController:v6 sender:self];
    v8 = [(CKCoreChatController *)self inputController];
    [v8 dismissAppCardIfNecessary];
  }
}

- (BOOL)_canReloadEntryView
{
  v2 = [(CKChatController *)self entryView];
  v3 = [v2 window];
  v4 = v3 != 0;

  return v4;
}

- (void)readerViewControllerWillDismiss:(id)a3
{
  v3 = a3;
  v9 = +[CKReaderViewController readerScrollPositionCache];
  v4 = MEMORY[0x1E696B098];
  v5 = [v3 visibleRange];
  v7 = [v4 valueWithRange:{v5, v6}];
  v8 = [v3 messageGUID];

  [v9 setObject:v7 forKey:v8];
}

- (void)_dismissPresentedViewController:(id)a3
{
  v4 = CKIsRunningInMacCatalyst();
  v5 = [(CKChatController *)self presentedViewController];
  v6 = v5;
  if (v4)
  {
    [v5 dismissPreview];
  }

  else
  {
    [v5 dismissViewControllerAnimated:1 completion:0];
  }

  [(CKChatController *)self becomeFirstResponder];
}

- (void)showViewerForMediaObject:(id)a3
{
  v33 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [(CKChatController *)self navigationController];
  v6 = [v5 visibleViewController];

  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = [v6 conformsToProtocol:&unk_1F06826C0];
  v9 = [(CKChatController *)self previewController];
  v10 = [v9 presentingViewController];

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = @"NO";
      if (isKindOfClass)
      {
        v13 = @"YES";
      }

      else
      {
        v13 = @"NO";
      }

      if (v8)
      {
        v14 = @"YES";
      }

      else
      {
        v14 = @"NO";
      }

      v27 = 138412802;
      v28 = v13;
      v29 = 2112;
      v30 = v14;
      if (v10)
      {
        v12 = @"YES";
      }

      v31 = 2112;
      v32 = v12;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "isChatControllerOnTop={%@} isAppCardOnTop={%@} isPreviewControllerAlreadyPresented={%@}", &v27, 0x20u);
    }
  }

  if (((isKindOfClass | v8) & (v10 == 0)) != 0)
  {
    v15 = [(CKChatController *)self entryView];
    v16 = [v15 contentView];
    -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [v16 isActive]);

    if (CKIsRunningInMacCatalyst())
    {
      if ([v4 shouldBeQuickLooked])
      {
LABEL_16:
        [(CKChatController *)self _displayPreviewItemForMediaObject:v4];
      }
    }

    else
    {
      if ([v4 mediaType] != 5)
      {
        if ([v4 mediaType] == 4)
        {
          [(CKChatController *)self _showVCardViewerForMediaObject:v4];
          goto LABEL_21;
        }

        if ([v4 mediaType] == 7)
        {
          [(CKChatController *)self _showPassbookCardViewForMediaObject:v4];
          goto LABEL_21;
        }

        if ([v4 mediaType] == 9)
        {
          [(CKChatController *)self _showWalletOrderImportViewForMediaObject:v4];
          goto LABEL_21;
        }

        if (![v4 shouldBeQuickLooked])
        {
          goto LABEL_21;
        }

        goto LABEL_16;
      }

      v24 = +[CKUIBehavior sharedBehaviors];
      v25 = [v24 opensLocationsInMapsApp];

      if (v25)
      {
        v26 = [v4 mapItem];
        [v26 openInMapsWithLaunchOptions:0];
      }

      else
      {
        [(CKChatController *)self _showMapViewerForMediaObject:v4];
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = objc_opt_class();
      v19 = NSStringFromClass(v18);
      v20 = [(CKChatController *)self navigationController];
      v21 = [v20 topViewController];
      v22 = objc_opt_class();
      v23 = NSStringFromClass(v22);
      v27 = 138412546;
      v28 = v19;
      v29 = 2112;
      v30 = v23;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Criteria not met to show mediaObject. Transcript/AppCard isn't visibleViewController. visibleVC={%@} topVC={%@}", &v27, 0x16u);
    }
  }

LABEL_21:
}

- (void)showAlternateViewerForMediaObject:(id)a3
{
  v6 = a3;
  if ([v6 mediaType] == 5)
  {
    v4 = +[CKUIBehavior sharedBehaviors];
    v5 = [v4 showsPlaceCardForBalloonViewTitleTap];

    if (v5)
    {
      [(CKChatController *)self _showVCardViewerForMediaObject:v6];
    }
  }
}

- (void)_showPassbookCardViewForMediaObject:(id)a3
{
  v4 = a3;
  if ([MEMORY[0x193AF5EC0](@"PKPassLibrary" @"PassKit")])
  {
    v5 = [v4 pass];
    v6 = [CKPassKitHelper addPassesViewControllerForPass:v5];
    v7 = v6;
    if (v6)
    {
      [v6 performSelector:sel_setDelegate_ withObject:self];
      [(CKChatController *)self setTargetFirstResponder:[(CKChatController *)self entryViewWasActiveOnPreview]];
      v11.receiver = self;
      v11.super_class = CKChatController;
      [(CKChatController *)&v11 becomeFirstResponder];
      v8 = [(CKCoreChatController *)self collectionViewController];
      v9 = [v8 collectionView];
      [v9 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];

      v10 = [(CKChatController *)self navigationController];
      [v10 presentViewController:v7 animated:1 completion:0];
    }
  }
}

- (void)addPassesViewControllerDidFinish:(id)a3
{
  v4 = [(CKChatController *)self navigationController];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __64__CKChatController_QuickLook__addPassesViewControllerDidFinish___block_invoke;
  v5[3] = &unk_1E72EBA18;
  v5[4] = self;
  [v4 dismissViewControllerAnimated:1 completion:v5];
}

void __64__CKChatController_QuickLook__addPassesViewControllerDidFinish___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryViewWasActiveOnPreview];
  v3 = *(a1 + 32);
  if (v2)
  {
    [v3 setEntryViewWasActiveOnPreview:0];
    v3 = *(a1 + 32);
    v4 = 1;
  }

  else
  {
    v4 = 0;
  }

  [v3 setTargetFirstResponder:v4];
  [*(a1 + 32) becomeFirstResponder];
  v5 = [*(a1 + 32) firstResponder];
  [v5 reloadInputViews];

  v7 = [*(a1 + 32) collectionViewController];
  v6 = [v7 collectionView];
  [v6 endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
}

- (void)_showWalletOrderImportViewForMediaObject:(id)a3
{
  v50 = *MEMORY[0x1E69E9840];
  v4 = a3;
  getFKOrderImportPreviewControllerProviderClass();
  v5 = objc_opt_class();
  if ((objc_opt_respondsToSelector() & 1) != 0 && [v5 canProvidePreviewControllerForMessages])
  {
    v43 = 0;
    v44 = &v43;
    v45 = 0x2050000000;
    v6 = getFKOrderMessagesPreviewMetadataClass_softClass;
    v46 = getFKOrderMessagesPreviewMetadataClass_softClass;
    if (!getFKOrderMessagesPreviewMetadataClass_softClass)
    {
      *buf = MEMORY[0x1E69E9820];
      *&buf[8] = 3221225472;
      *&buf[16] = __getFKOrderMessagesPreviewMetadataClass_block_invoke;
      v48 = &unk_1E72EB968;
      v49 = &v43;
      __getFKOrderMessagesPreviewMetadataClass_block_invoke(buf);
      v6 = v44[3];
    }

    v7 = v6;
    _Block_object_dispose(&v43, 8);
    v8 = objc_opt_class();
    if ((objc_opt_respondsToSelector() & 1) != 0 && ([v4 fileURL], v9 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "walletDeepLinkForExistingOrderAtURL:", v9), v10 = objc_claimAutoreleasedReturnValue(), v9, v10))
    {
      if (IMOSLoggingEnabled())
      {
        v11 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          v12 = [v10 absoluteString];
          *buf = 138412290;
          *&buf[4] = v12;
          _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Order file is already tracked, viewing in Wallet with url: %@", buf, 0xCu);
        }
      }

      v13 = [MEMORY[0x1E69DC668] sharedApplication];
      [v13 openURL:v10];
    }

    else
    {
      FKOrderImportPreviewControllerProviderClass = getFKOrderImportPreviewControllerProviderClass();
      v15 = [v4 fileURL];
      v41 = 0;
      v42[0] = MEMORY[0x1E69E9820];
      v42[1] = 3221225472;
      v42[2] = __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke;
      v42[3] = &unk_1E72F3178;
      v42[4] = self;
      v16 = [FKOrderImportPreviewControllerProviderClass makeViewControllerWithOrderURL:v15 completion:v42 error:&v41];
      v10 = v41;

      if (v10)
      {
        if (IMOSLoggingEnabled())
        {
          v17 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            v18 = [v4 fileURL];
            *buf = 138412546;
            *&buf[4] = v18;
            *&buf[12] = 2112;
            *&buf[14] = v10;
            _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Failed to create Add to Wallet VC for order at %@: %@", buf, 0x16u);
          }
        }

        if ([v10 code] == 1)
        {
          v19 = MEMORY[0x193AF5ED0]("PKCreateAlertControllerForWalletUninstalled", @"PassKitUI");
          _showWalletOrderImportViewForMediaObject__makeWalletUninstalledAlert = v19;
          if (v19)
          {
            v20 = v19(0);
            v21 = [(CKChatController *)self navigationController];
            [v21 presentViewController:v20 animated:1 completion:0];
          }

          else if (IMOSLoggingEnabled())
          {
            v38 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v38, OS_LOG_TYPE_INFO, "Unable to show Wallet Uninstalled alert because weak-link of PKCreateAlertControllerForWalletUninstalled() failed.", buf, 2u);
            }
          }
        }

        else
        {
          v27 = MEMORY[0x1E69DC650];
          v28 = CKFrameworkBundle();
          v29 = [v28 localizedStringForKey:@"WALLET_ORDER_INVALID_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          v30 = CKFrameworkBundle();
          v31 = [v30 localizedStringForKey:@"WALLET_ORDER_INVALID_DESCRIPTION" value:&stru_1F04268F8 table:@"ChatKit"];
          v32 = [v27 alertControllerWithTitle:v29 message:v31 preferredStyle:1];

          v33 = MEMORY[0x1E69DC648];
          v34 = CKFrameworkBundle();
          v35 = [v34 localizedStringForKey:@"DISMISS" value:&stru_1F04268F8 table:@"ChatKit"];
          v36 = [v33 actionWithTitle:v35 style:0 handler:0];
          [v32 addAction:v36];

          v37 = [(CKChatController *)self navigationController];
          [v37 presentViewController:v32 animated:1 completion:0];
        }
      }

      else if (v16)
      {
        [(CKChatController *)self setWalletOrderImportViewController:v16];
        v22 = [v16 presentationController];
        [v22 setDelegate:self];

        v23 = [(CKCoreChatController *)self collectionViewController];
        v24 = [v23 collectionView];
        [v24 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];

        v25 = [(CKCoreChatController *)self delegate];
        [v25 updateSupportedInterfaceOrientations:2];

        v26 = dispatch_time(0, 100000000);
        v39[0] = MEMORY[0x1E69E9820];
        v39[1] = 3221225472;
        v39[2] = __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_324;
        v39[3] = &unk_1E72EB8D0;
        v39[4] = self;
        v40 = v16;
        dispatch_after(v26, MEMORY[0x1E69E96A0], v39);
      }
    }
  }
}

void __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v13 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = IMOSLoggingEnabled();
  if (v4)
  {
    if (v5)
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v12 = v4;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "CKChatController_QuickLook failed to add order file to Wallet: %@", buf, 0xCu);
      }

LABEL_9:
    }
  }

  else if (v5)
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Finished adding order file to Wallet", buf, 2u);
    }

    goto LABEL_9;
  }

  v8 = *(a1 + 32);
  v7 = (a1 + 32);
  [v8 _walletOrderImportControllerDismissed];
  v9 = [*v7 navigationController];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_307;
  v10[3] = &unk_1E72EBA18;
  v10[4] = *v7;
  [v9 dismissViewControllerAnimated:1 completion:v10];
}

void __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_307(uint64_t a1)
{
  v1 = [*(a1 + 32) delegate];
  [v1 stopForcingOrientation];
}

void __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_324(uint64_t a1)
{
  v2 = [*(a1 + 32) navigationController];
  [v2 presentViewController:*(a1 + 40) animated:1 completion:0];
}

- (void)_showMapViewerForMediaObject:(id)a3
{
  v27 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (_showMapViewerForMediaObject___pred_CLLocationCoordinate2DIsValidCoreLocation != -1)
  {
    [CKChatController(QuickLook) _showMapViewerForMediaObject:];
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
    if ((_showMapViewerForMediaObject___CLLocationCoordinate2DIsValid)([(__CFString *)v5 coordinate]))
    {
      v6 = MEMORY[0x193AF5EC0](@"MUPlaceViewController", @"MapsUI");
      if (v6)
      {
        v7 = [v6 alloc];
        v8 = [(__CFString *)v5 mapItem];
        v9 = [v7 initWithMapItem:v8];

        v10 = +[CKUIBehavior sharedBehaviors];
        v11 = [v10 usesPopovers];

        if (v11)
        {
          v12 = [(CKChatController *)self entryView];
          v13 = [v12 contentView];
          v14 = [v13 isActive];

          [(CKChatController *)self setTargetFirstResponder:v14];
          v15 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel_dismissPresentedViewController_];
          v16 = [v9 navigationItem];
          [v16 setLeftBarButtonItem:v15];

          v17 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v9];
          v18 = [v17 navigationBar];
          v19 = +[CKUIBehavior sharedBehaviors];
          v20 = [v19 theme];
          [v18 setBarStyle:{objc_msgSend(v20, "navBarStyle")}];

          [v17 setModalPresentationStyle:3];
          [(CKChatController *)self presentViewController:v17 animated:1 completion:0];
        }

        else
        {
          [(CKChatController *)self showViewController:v9 sender:self];
        }
      }

      else if (IMOSLoggingEnabled())
      {
        v22 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = 138412546;
          v24 = @"MUPlaceViewController";
          v25 = 2112;
          v26 = @"MapsUI";
          _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Failed weak linking %@ from %@.", &v23, 0x16u);
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v21 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v23 = 138412290;
          v24 = v5;
          _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "The location for this media object is invalid. [%@]", &v23, 0xCu);
        }
      }

      [(CKChatController *)self _showVCardViewerForMediaObject:v5];
    }
  }
}

void *__60__CKChatController_QuickLook___showMapViewerForMediaObject___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CLLocationCoordinate2DIsValid", @"CoreLocation");
  _showMapViewerForMediaObject___CLLocationCoordinate2DIsValid = result;
  return result;
}

- (void)_showVCardViewerForMediaObject:(id)a3
{
  v21 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [v4 data];
  if (!v5)
  {
    v5 = objc_alloc_init(MEMORY[0x1E695DEF0]);
  }

  v17 = 0;
  v6 = [MEMORY[0x1E695CE30] contactsWithData:v5 error:&v17];
  v7 = v17;
  if (!v6 || ![v6 count])
  {
    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v20 = v7;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Couldn't get contacts out of vcard data: %@", buf, 0xCu);
      }
    }

    v9 = objc_alloc_init(MEMORY[0x1E695CF18]);
    v18 = v9;
    v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v18 count:1];

    v6 = v10;
  }

  v11 = [objc_alloc(MEMORY[0x1E695D1D8]) initWithContacts:v6 contactStore:0];
  v12 = objc_alloc_init(MEMORY[0x1E69DCCC8]);
  [v12 configureWithTransparentBackground];
  v13 = [v11 viewController];
  v14 = [v13 navigationItem];
  [v14 setStandardAppearance:v12];

  v15 = [(CKCoreChatController *)self inputController];
  [v15 dismissAppCardIfNecessary];

  v16 = [v11 viewController];
  [(CKChatController *)self showViewController:v16 sender:self];
}

- (void)_showVCalViewerForMediaObject:(id)a3
{
  v10 = a3;
  v4 = +[CKUIBehavior sharedBehaviors];
  if ([v4 showsVCalViewer] && EKEventStoreClass())
  {
    v5 = EKICSPreviewControllerClass();

    if (!v5)
    {
      goto LABEL_6;
    }

    v4 = objc_alloc_init(EKEventStoreClass());
    v6 = objc_alloc(EKICSPreviewControllerClass());
    v7 = [v10 data];
    v8 = [v6 initWithData:v7 eventStore:v4 options:2147483649];

    v9 = [v8 viewController];
    [(CKChatController *)self showViewController:v9 sender:self];
  }

LABEL_6:
}

- (void)restoreEntryViewAfterPreview
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Calling restoreEntryViewAfterPreview", buf, 2u);
    }
  }

  if ([(CKChatController *)self isShowingPreview])
  {
    [(CKChatController *)self setIsShowingPreview:0];
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *v6 = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "restoreEntryViewAfterPreview: Setting showing preview to NO", v6, 2u);
      }
    }

    if ([(CKChatController *)self entryViewWasActiveOnPreview])
    {
      [(CKChatController *)self setEntryViewWasActiveOnPreview:0];
      v5 = 1;
    }

    else
    {
      v5 = 0;
    }

    [(CKChatController *)self setTargetFirstResponder:v5];
    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    [(CKChatController *)self becomeFirstResponder];
  }
}

- (BOOL)previewController:(id)a3 shouldDetectMachineReadableCodeForPreviewItem:(id)a4
{
  v4 = [(CKCoreChatController *)self chat:a3];
  v5 = [v4 isFiltered] == 0;

  return v5;
}

- (id)excludedActivityTypesForPreviewController:(id)a3
{
  v9[1] = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [v3 currentPreviewItem];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) != 0 && ([v4 mediaType] & 0xFFFFFFFE) == 2)
  {
    v9[0] = *MEMORY[0x1E69CDAF8];
    v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *v8 = 0;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Will exclude system UIActivityTypeSaveToCameraRoll from ShareSheet.", v8, 2u);
      }
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)additionalActivitiesTypesForPreviewController:(id)a3
{
  v14[1] = *MEMORY[0x1E69E9840];
  v3 = a3;
  v4 = [v3 currentPreviewItem];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = v4;
    if (([v5 mediaType] & 0xFFFFFFFE) == 2)
    {
      v6 = [[CKSaveToPhotosActivity alloc] initWithMediaObject:v5 presenterViewController:v3];
      v14[0] = v6;
      v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v14 count:1];
    }

    else
    {
      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [v7 count];
      v10 = &stru_1F04268F8;
      if (!v9)
      {
        v10 = @" NOT";
      }

      v12 = 138412290;
      v13 = v10;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Will%@ present additional activities on ShareSheet.", &v12, 0xCu);
    }
  }

  return v7;
}

- (void)previewControllerWillDismiss:(id)a3
{
  v4 = a3;
  v5 = +[CKUIBehavior sharedBehaviors];
  v6 = [v5 presentsQuickLookController];

  if (v6)
  {
    v7 = [(CKCoreChatController *)self collectionViewController];
    v8 = [v7 collectionView];
    v9 = [v7 chatItems];
    v10 = [v4 currentPreviewItem];
    v11 = [v9 __ck_indexOfMediaObject:v10];

    if (v11 != 0x7FFFFFFFFFFFFFFFLL)
    {
      v12 = [MEMORY[0x1E696AC88] indexPathForRow:v11 inSection:0];
      v13 = [v8 cellForItemAtIndexPath:v12];
      if (!v13)
      {
        [v8 beginDisablingTranscriptDynamicsForReason:6];
        v14 = [(CKChatController *)self collectionView];
        v15[0] = MEMORY[0x1E69E9820];
        v15[1] = 3221225472;
        v15[2] = __60__CKChatController_QuickLook__previewControllerWillDismiss___block_invoke;
        v15[3] = &unk_1E72EB8D0;
        v16 = v8;
        v17 = v12;
        [v14 performContentOffsetUpdateTemporarilyOverridingHoldStatus:v15];
      }
    }
  }
}

void __60__CKChatController_QuickLook__previewControllerWillDismiss___block_invoke(uint64_t a1)
{
  [MEMORY[0x1E6979518] begin];
  v2 = MEMORY[0x1E6979518];
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __60__CKChatController_QuickLook__previewControllerWillDismiss___block_invoke_2;
  v3[3] = &unk_1E72EBA18;
  v4 = *(a1 + 32);
  [v2 setCompletionBlock:v3];
  [*(a1 + 32) scrollToItemAtIndexPath:*(a1 + 40) atScrollPosition:2 animated:0];
  [MEMORY[0x1E6979518] commit];
}

- (void)previewControllerDidDismiss:(id)a3
{
  v8 = *MEMORY[0x1E69E9840];
  v4 = a3;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = 136315138;
      v7 = "[CKChatController(QuickLook) previewControllerDidDismiss:]";
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Dismissing %s", &v6, 0xCu);
    }
  }

  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self setPreviewController:0];
  [(CKChatController *)self restoreEntryViewAfterPreview];
}

- (BOOL)previewController:(id)a3 canShareItem:(id)a4
{
  v4 = a4;
  if (objc_opt_respondsToSelector())
  {
    v5 = [v4 canShareItem];
  }

  else
  {
    v5 = 1;
  }

  return v5;
}

- (void)previewController:(id)a3 willTransitionToState:(int64_t)a4
{
  v6 = +[CKUIBehavior sharedBehaviors];
  v7 = [v6 presentsQuickLookController];

  if (a4 == 3 && v7)
  {
    v10 = [(CKCoreChatController *)self collectionViewController];
    v8 = [v10 collectionView];
    v9 = [v8 window];
    [v9 layoutIfNeeded];
  }
}

- (void)previewController:(id)a3 didTransitionToState:(int64_t)a4
{
  if (a4 == 3)
  {
    v18 = [a3 currentPreviewItem];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = [(CKCoreChatController *)self collectionViewController];
      v7 = [v6 chatItems];
      v8 = [v7 __ck_indexOfMediaObject:v18];

      if (v8 != 0x7FFFFFFFFFFFFFFFLL)
      {
        v9 = [MEMORY[0x1E696AC88] indexPathForRow:v8 inSection:0];
        v10 = [(CKCoreChatController *)self collectionViewController];
        v11 = [v10 collectionView];

        v12 = [v11 cellForItemAtIndexPath:v9];
        if (v12)
        {
          v13 = [v11 cellForItemAtIndexPath:v9];
          v14 = [v13 balloonView];
          v15 = +[CKUIBehavior sharedBehaviors];
          [v14 setCanUseOpaqueMask:{objc_msgSend(v15, "transcriptCanUseOpaqueMask")}];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            [v14 removeTransitionView];
          }
        }
      }
    }

    v16 = [(CKCoreChatController *)self collectionViewController];
    v17 = [v16 collectionView];
    [v17 endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
  }
}

- (CGRect)previewController:(id)a3 frameForPreviewItem:(id)a4 inSourceView:(id *)a5
{
  v5 = 0.0;
  v6 = 0.0;
  v7 = 1.0;
  v8 = 1.0;
  result.size.height = v8;
  result.size.width = v7;
  result.origin.y = v6;
  result.origin.x = v5;
  return result;
}

- (id)previewController:(id)a3 transitionViewForPreviewItem:(id)a4 uncroppedSourceFrame:(CGRect *)a5
{
  v64 = *MEMORY[0x1E69E9840];
  v8 = a3;
  v9 = a4;
  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = objc_opt_class();
      v12 = NSStringFromClass(v11);
      *buf = 138412546;
      *&buf[4] = v12;
      *&buf[12] = 2048;
      *&buf[14] = v9;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "QuickLook did request preview view for transition to item <%@: %p>.", buf, 0x16u);
    }
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_16;
  }

  if (IMOSLoggingEnabled())
  {
    v13 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "> Item is found to be a CKMediaObject.", buf, 2u);
    }
  }

  v14 = [(CKCoreChatController *)self collectionViewController];
  v15 = [v14 collectionView];
  v16 = [v14 chatItems];
  v17 = [v16 __ck_indexOfMediaObject:v9];

  if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *buf = 134217984;
      *&buf[4] = v17;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "> Media Object is found to be at row {%ld) in the transcript.", buf, 0xCu);
    }
  }

  if (v17 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v58 = [MEMORY[0x1E696AC88] indexPathForRow:v17 inSection:0];
    v21 = [v15 cellForItemAtIndexPath:v58];
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      v22 = IMLogHandleForCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(QuickLook) previewController:v21 transitionViewForPreviewItem:v58 uncroppedSourceFrame:v22];
      }

      v20 = 0;
      goto LABEL_52;
    }

    v22 = v21;
    v23 = [v22 balloonView];
    [v23 setHidden:0];
    [v23 setCanUseOpaqueMask:0];
    [v23 prepareForDisplayIfNeeded];
    [v22 layoutIfNeeded];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v24 = v23;
      [v24 uncroppedSourceFrame];
      a5->origin.x = v25;
      a5->origin.y = v26;
      a5->size.width = v27;
      a5->size.height = v28;
      if (IMOSLoggingEnabled())
      {
        v29 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
        {
          log = v29;
          v57 = [v24 uncroppedSourceView];
          v30 = objc_opt_class();
          v31 = NSStringFromClass(v30);
          v32 = [v24 uncroppedSourceView];
          *buf = 138412546;
          v55 = v31;
          *&buf[4] = v31;
          *&buf[12] = 2048;
          *&buf[14] = v32;
          _os_log_impl(&dword_19020E000, log, OS_LOG_TYPE_INFO, "> For a CKAttachmentBalloonView, we are returning <%@: %p>.", buf, 0x16u);

          v29 = log;
        }
      }

      v20 = [v24 uncroppedSourceView];

      goto LABEL_51;
    }

    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v35 = *(MEMORY[0x1E695F058] + 16);
        *buf = *MEMORY[0x1E695F058];
        *&buf[16] = v35;
        v20 = [v23 transitionViewForCurrentItem:v9 sourceFrame:buf];
        v36 = *&buf[16];
        a5->origin = *buf;
        a5->size = v36;
        if (IMOSLoggingEnabled())
        {
          v37 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v38 = objc_opt_class();
            v39 = NSStringFromClass(v38);
            *v59 = 138412546;
            v60 = v39;
            v61 = 2048;
            v62 = v20;
            _os_log_impl(&dword_19020E000, v37, OS_LOG_TYPE_INFO, "> For a CKPhotoStackBalloonView, we are returning <%@: %p>.", v59, 0x16u);
          }
        }

        goto LABEL_51;
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_50;
      }

      v49 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
      {
        v52 = objc_opt_class();
        v53 = NSStringFromClass(v52);
        *buf = 138412546;
        *&buf[4] = v53;
        *&buf[12] = 2048;
        *&buf[14] = v23;
        _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "> For all other balloonView types, we are returning <%@: %p>.", buf, 0x16u);
      }

      goto LABEL_49;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [v9 originalSize];
    }

    else
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
LABEL_42:
        if (!IMOSLoggingEnabled())
        {
LABEL_50:
          v20 = v23;
LABEL_51:

LABEL_52:
          goto LABEL_53;
        }

        v49 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
        {
          v50 = objc_opt_class();
          v51 = NSStringFromClass(v50);
          *buf = 138412546;
          *&buf[4] = v51;
          *&buf[12] = 2048;
          *&buf[14] = v23;
          _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "> For a CKImageBalloonView, we are returning <%@: %p>.", buf, 0x16u);
        }

LABEL_49:

        goto LABEL_50;
      }

      [v9 pxSize];
    }

    v40 = v33;
    v41 = v34;
    [v23 bounds];
    a5->origin.x = AdaptSizeToRect(v42, v43, v44, v45, v40, v41);
    a5->origin.y = v46;
    a5->size.width = v47;
    a5->size.height = v48;
    goto LABEL_42;
  }

LABEL_16:
  if (IMOSLoggingEnabled())
  {
    v19 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
    }
  }

  v20 = 0;
LABEL_53:

  return v20;
}

- (id)_previewingViewControllerForHitView:(id)a3 indexPath:(id)a4
{
  v58 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKCoreChatController *)self collectionViewController];
  v9 = [v8 balloonViewAtIndexPath:v7];

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        goto LABEL_50;
      }

      v35 = +[CKUIBehavior sharedBehaviors];
      v36 = [v35 disableTranscriptClickyOrbContextMenu];

      if (v36)
      {
        goto LABEL_50;
      }
    }
  }

  v10 = [(CKCoreChatController *)self collectionViewController];
  v11 = [v10 chatItems];

  if (v7)
  {
    if (![v7 section])
    {
      v12 = [v7 item];
      if (v12 < [v11 count])
      {
        v52 = [v11 objectAtIndex:{objc_msgSend(v7, "item")}];
        objc_opt_class();
        v13 = v52;
        if (objc_opt_isKindOfClass())
        {
          v14 = [v52 mediaObject];
          v15 = v14;
          if ([v14 shouldBeQuickLooked])
          {
            v53 = 0;
            v16 = [(CKChatController *)self previewItemsForMediaObject:v14 currentItemIndex:&v53 containsRestoring:0];
            v17 = [(CKChatController *)self previewController];
            v18 = v17 == 0;

            if (v18)
            {
              v19 = objc_alloc_init(CKQLPreviewController);
              [(CKChatController *)self setPreviewController:v19];

              v20 = [(CKChatController *)self previewController];
              [v20 setDelegate:self];
            }

            v21 = [(CKChatController *)self qlPreviewDataSource];
            v22 = [v21 previewItems];
            v23 = [v16 isEqualToArray:v22];

            if ((v23 & 1) == 0)
            {
              v24 = objc_alloc_init(CKQLPreviewControllerDataSource);
              [(CKChatController *)self setQlPreviewDataSource:v24];

              v25 = [(CKChatController *)self qlPreviewDataSource];
              [v25 setPreviewItems:v16];
            }

            v26 = [(CKChatController *)self previewController];
            v27 = [(CKChatController *)self qlPreviewDataSource];
            [v26 setDataSource:v27];

            v28 = [(CKChatController *)self previewController];
            [v28 setCurrentPreviewItemIndex:v53];

            v29 = [(CKChatController *)self previewController];
            [v29 refreshCurrentPreviewItem];

            objc_opt_class();
            if ((objc_opt_isKindOfClass() & 1) != 0 && [v6 invisibleInkEffectEnabled])
            {
              v30 = [v6 invisibleInkEffectController];
              [(CKChatController *)self setPreviewInvisibleInkEffectController:v30];
              if (([v30 isSuspended] & 1) == 0)
              {
                v31 = CKBalloonViewForClass([v52 balloonViewClass]);
                [v31 configureForMessagePart:v52];
                [v31 setInvisibleInkEffectEnabled:0];
                [v31 setCanUseOpaqueMask:0];
                [v31 prepareForDisplayIfNeeded];
                [(CKChatController *)self setPreviewRevealView:v31];
              }
            }

            if (IMOSLoggingEnabled())
            {
              v32 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
              {
                v33 = [(CKChatController *)self previewController];
                *buf = 138412290;
                v55 = v33;
                _os_log_impl(&dword_19020E000, v32, OS_LOG_TYPE_INFO, "clicky orb: providing previewController: %@", buf, 0xCu);
              }
            }

            v34 = [(CKChatController *)self previewController];

            goto LABEL_22;
          }

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            if (_previewingViewControllerForHitView_indexPath___pred_CLLocationCoordinate2DIsValidCoreLocation != -1)
            {
              [CKChatController(QuickLook) _previewingViewControllerForHitView:indexPath:];
              v15 = v14;
            }

            if ((_previewingViewControllerForHitView_indexPath___CLLocationCoordinate2DIsValid)([v15 coordinate]))
            {
              v44 = MEMORY[0x193AF5EC0](@"MUPlaceViewController", @"MapsUI");
              if (v44)
              {
                v45 = [v44 alloc];
                v46 = [v15 mapItem];
                v34 = [v45 initWithMapItem:v46];

                v47 = [v14 title];
                [(__CFString *)v34 setTitle:v47];

                if (IMOSLoggingEnabled())
                {
                  v48 = OSLogHandleForIMFoundationCategory();
                  if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
                  {
                    *buf = 138412290;
                    v55 = v34;
                    _os_log_impl(&dword_19020E000, v48, OS_LOG_TYPE_INFO, "clicky orb: providing placeViewController: %@", buf, 0xCu);
                  }
                }
              }

              else
              {
                if (!IMOSLoggingEnabled())
                {
                  v34 = 0;
                  goto LABEL_37;
                }

                v51 = OSLogHandleForIMFoundationCategory();
                if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
                {
                  *buf = 138412546;
                  v55 = @"MUPlaceViewController";
                  v56 = 2112;
                  v57 = @"MapsUI";
                  _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "Failed weak linking %@ from %@.", buf, 0x16u);
                }

                v34 = 0;
              }

LABEL_22:
              v15 = v14;
LABEL_37:

              goto LABEL_55;
            }
          }

          v13 = v52;
        }

        else
        {
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v15 = [v52 dataSource];
            v37 = v9;
            v38 = [v37 stackView];
            v39 = [v38 currentAssetReference];
            v34 = [(CKChatController *)self _previewViewControllerForAssetReference:v39 dataSource:v15 previewDelegate:self previewMode:2];
            [(__CFString *)v34 setChatItem:v52];
            if (IMOSLoggingEnabled())
            {
              v40 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v55 = v34;
                _os_log_impl(&dword_19020E000, v40, OS_LOG_TYPE_INFO, "clicky orb: providing previewViewController: %@", buf, 0xCu);
              }
            }

            goto LABEL_37;
          }

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            v15 = v52;
            v41 = [(CKCoreChatController *)self collectionViewController];
            v42 = [v41 transcriptIdentifier];
            v34 = [v15 contentViewControllerForContext:v42];

            if (IMOSLoggingEnabled())
            {
              v43 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v55 = v34;
                _os_log_impl(&dword_19020E000, v43, OS_LOG_TYPE_INFO, "clicky orb: providing peekVC: %@", buf, 0xCu);
              }
            }

            goto LABEL_37;
          }
        }
      }
    }
  }

LABEL_50:
  if (IMOSLoggingEnabled())
  {
    v49 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "clicky orb: not providing any previewingViewController", buf, 2u);
    }
  }

  v34 = 0;
LABEL_55:

  return v34;
}

void *__77__CKChatController_QuickLook___previewingViewControllerForHitView_indexPath___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CLLocationCoordinate2DIsValid", @"CoreLocation");
  _previewingViewControllerForHitView_indexPath___CLLocationCoordinate2DIsValid = result;
  return result;
}

- (id)_previewingViewControllerForLocation:(CGPoint)a3 inSourceView:(id)a4
{
  y = a3.y;
  x = a3.x;
  v7 = a4;
  v8 = [v7 hitTest:0 withEvent:{x, y}];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = [v8 superview];

    v8 = v9;
  }

  v10 = [(CKCoreChatController *)self collectionViewController];
  v11 = [v10 collectionView];

  [v11 convertPoint:v7 fromView:{x, y}];
  v13 = v12;
  v15 = v14;

  v16 = [v11 indexPathForItemAtPoint:{v13, v15}];
  v17 = [(CKChatController *)self _previewingViewControllerForHitView:v8 indexPath:v16];

  return v17;
}

- (id)previewingContext:(id)a3 viewControllerForLocation:(CGPoint)a4
{
  y = a4.y;
  x = a4.x;
  v7 = a3;
  v8 = +[CKUIBehavior sharedBehaviors];
  v9 = [v8 disableTranscriptOrb];

  if (v9)
  {
    v10 = 0;
  }

  else
  {
    v11 = [v7 sourceView];
    v10 = [(CKChatController *)self _previewingViewControllerForLocation:v11 inSourceView:x, y];
  }

  return v10;
}

- (void)willPresentPreviewViewController:(id)a3 forLocation:(CGPoint)a4 inSourceView:(id)a5
{
  y = a4.y;
  x = a4.x;
  v9 = a5;
  v10 = a3;
  v11 = [(CKCoreChatController *)self collectionViewController];
  v12 = [v11 collectionView];
  [v12 convertPoint:v9 fromView:{x, y}];
  v14 = v13;
  v16 = v15;

  v17 = [(CKCoreChatController *)self collectionViewController];
  v18 = [v17 collectionView];
  v19 = [v18 indexPathForItemAtPoint:{v14, v16}];

  v20 = [(CKCoreChatController *)self collectionViewController];
  v21 = [v20 collectionView];
  v22 = [v21 cellForItemAtIndexPath:v19];

  v23 = v22;
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"PreviewController"];
  v24 = objc_opt_respondsToSelector();
  v25 = v23;
  if (v24)
  {
    v31 = [v23 balloonView];
    [v31 setCanUseOpaqueMask:0];
    [v31 prepareForDisplayIfNeeded];

    v25 = v31;
  }

  v32 = v25;
  [(CKChatController *)self setPreviewSourceView:v25];
  v26 = [v10 presentationController];

  [v26 setSourceView:v32];
  [v32 bounds];
  [v26 setSourceRect:?];
  v27 = [(CKChatController *)self entryView];
  v28 = [v27 contentView];
  -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [v28 isActive]);

  v29 = [(CKCoreChatController *)self collectionViewController];
  v30 = [v29 collectionView];
  [v30 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
}

- (void)previewingContext:(id)a3 commitViewController:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [MEMORY[0x1E69A8168] sharedInstance];
  [v8 trackEvent:*MEMORY[0x1E69A7588]];

  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "commitViewController: Setting showing preview to YES", buf, 2u);
    }
  }

  [(CKChatController *)self setIsShowingPreview:1];
  v10 = [(CKChatController *)self previewController];
  v11 = [(CKChatController *)self previewController];

  if (v11 != v7)
  {
    [(CKChatController *)self restoreEntryViewAfterPreview];
    v12 = [(CKChatController *)self previewSourceView];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v13 = [(CKCoreChatController *)self collectionViewController];
      v14 = [(CKChatController *)self previewSourceView];
      v15 = [v13 indexPathForBalloonView:v14];

      if (v15)
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v16 = [v12 pluginViewController];
          if ([v16 conformsToProtocol:&unk_1F06F8A18] && (objc_opt_respondsToSelector() & 1) != 0)
          {
            v17 = [v16 handlePresentationAction];

            if (v17)
            {
              goto LABEL_19;
            }

            goto LABEL_18;
          }
        }
      }
    }

LABEL_18:
    [(CKChatController *)self showViewController:v7 sender:self];
LABEL_19:

    goto LABEL_20;
  }

  v18.receiver = self;
  v18.super_class = CKChatController;
  [(CKChatController *)&v18 becomeFirstResponder];
  if (CKIsRunningInMacCatalyst())
  {
    [v10 presentPreview];
  }

  else
  {
    [(CKChatController *)self presentViewController:v10 animated:1 completion:0];
  }

LABEL_20:
}

- (void)didDismissPreviewViewController:(id)a3 committing:(BOOL)a4
{
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"PreviewController"];
  v11 = [(CKChatController *)self previewSourceView];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = +[CKUIBehavior sharedBehaviors];
    [v11 setCanUseOpaqueMask:{objc_msgSend(v6, "transcriptCanUseOpaqueMask")}];

    [v11 prepareForDisplayIfNeeded];
  }

  [(CKChatController *)self setPreviewSourceView:0];
  v7 = [(CKChatController *)self previewInvisibleInkEffectController];
  [v7 returnBorrowedEffectView];

  v8 = [(CKChatController *)self previewInvisibleInkEffectController];
  [v8 setSuspended:0];

  [(CKChatController *)self setPreviewInvisibleInkEffectController:0];
  if (!a4)
  {
    v9 = [(CKCoreChatController *)self collectionViewController];
    v10 = [v9 collectionView];
    [v10 endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
  }
}

- (id)previewActionsForPreviewController:(id)a3
{
  v4 = MEMORY[0x1E695DF70];
  v5 = a3;
  v6 = [v4 array];
  v7 = [v5 currentPreviewItem];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
    v9 = [(CKCoreChatController *)self collectionViewController];
    v10 = [v9 chatItems];
    v11 = [v10 __ck_indexOfMediaObject:v8];

    v12 = [(CKCoreChatController *)self collectionViewController];
    v13 = [v12 chatItems];
    v14 = [v13 objectAtIndex:v11];

    if ([v14 canCopy])
    {
      v15 = MEMORY[0x1E69DCE00];
      v16 = CKFrameworkBundle();
      v17 = [v16 localizedStringForKey:@"COPY" value:&stru_1F04268F8 table:@"ChatKit"];
      v36[0] = MEMORY[0x1E69E9820];
      v36[1] = 3221225472;
      v36[2] = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke;
      v36[3] = &unk_1E72F31A0;
      v37 = v8;
      v18 = [v15 actionWithTitle:v17 style:0 handler:v36];
      [v6 addObject:v18];
    }

    if ([v14 canExport])
    {
      v19 = MEMORY[0x1E69DCE00];
      v20 = CKFrameworkBundle();
      v21 = [v20 localizedStringForKey:@"BALLOON_EXPORT_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v34[0] = MEMORY[0x1E69E9820];
      v34[1] = 3221225472;
      v34[2] = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_2;
      v34[3] = &unk_1E72F31A0;
      v35 = v8;
      v22 = [v19 actionWithTitle:v21 style:0 handler:v34];
      [v6 addObject:v22];
    }

    if ([v14 canForward])
    {
      v23 = MEMORY[0x1E69DCE00];
      v24 = CKFrameworkBundle();
      v25 = [v24 localizedStringForKey:@"FORWARD" value:&stru_1F04268F8 table:@"ChatKit"];
      v28 = MEMORY[0x1E69E9820];
      v29 = 3221225472;
      v30 = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_515;
      v31 = &unk_1E72F31C8;
      v32 = self;
      v33 = v14;
      v26 = [v23 actionWithTitle:v25 style:0 handler:&v28];
      [v6 addObject:{v26, v28, v29, v30, v31, v32}];
    }
  }

  return v6;
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke(uint64_t a1)
{
  v5[1] = *MEMORY[0x1E69E9840];
  v2 = [MEMORY[0x1E69DCD50] generalPasteboard];
  v3 = [*(a1 + 32) pasteboardItemProvider];
  v5[0] = v3;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v5 count:1];
  [v2 setItemProviders:v4];
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_2(uint64_t a1)
{
  v2 = [[CKMediaObjectExportManager alloc] initWithMediaObject:*(a1 + 32)];
  [(CKMediaObjectExportManager *)v2 setMetricsSource:*MEMORY[0x1E69A7640]];
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_3;
  v3[3] = &unk_1E72EC088;
  v4 = *(a1 + 32);
  [(CKMediaObjectExportManager *)v2 exportQueuedMediaObjectsWithCompletion:v3];
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_3(uint64_t a1, int a2, void *a3)
{
  v14 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = IMOSLoggingEnabled();
  if (a2)
  {
    if (v6)
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = *(a1 + 32);
        v10 = 138412290;
        v11 = v8;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Successfully quick saved media object: %@", &v10, 0xCu);
      }

LABEL_9:
    }
  }

  else if (v6)
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = *(a1 + 32);
      v10 = 138412546;
      v11 = v5;
      v12 = 2112;
      v13 = v9;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Error quick saving media object. error: %@, mediaObject: %@", &v10, 0x16u);
    }

    goto LABEL_9;
  }
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_515(uint64_t a1)
{
  v8[1] = *MEMORY[0x1E69E9840];
  [*(a1 + 32) setIsShowingPreview:0];
  v8[0] = *(a1 + 40);
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:1];
  v3 = [*(a1 + 32) entryView];
  v4 = [v3 shouldShowSubject];
  v5 = [*(a1 + 32) textInputContextIdentifier];
  v6 = [CKComposition compositionForMessageParts:v2 preserveSubject:v4 contextIdentifier:v5];

  v7 = [*(a1 + 32) delegate];
  [v7 chatController:*(a1 + 32) forwardComposition:v6];
}

- (BOOL)shouldShowReplyButtonForMediaObject:(id)a3 previewController:(id)a4
{
  v5 = [(CKChatController *)self _chatItemForMediaObject:a3, a4];
  if (v5)
  {
    v6 = [(CKCoreChatController *)self conversation];
    v7 = [v6 canReplyToChatItem:v5];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)replyButtonTappedForMediaObject:(id)a3 previewController:(id)a4
{
  v7 = a4;
  v6 = [(CKChatController *)self _chatItemForMediaObject:a3];
  if (v6)
  {
    [(CKChatController *)self showModalInlineReplyControllerForChatItem:v6 fromViewController:v7];
  }
}

- (void)saveButtonTappedForMediaObject:(id)a3 previewController:(id)a4
{
  v9[1] = *MEMORY[0x1E69E9840];
  v5 = [(CKChatController *)self chatItemForMediaObject:a3 previewController:a4];
  v6 = v5;
  if (v5)
  {
    v9[0] = v5;
    v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
    [CKChatItem unloadSizesOfChatItems:v7];

    v8 = [(CKCoreChatController *)self chat];
    [v8 _reloadChatItemsForPhotoSaveStatusChange];
  }
}

- (BOOL)shouldHideInteractionOptions
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 hasLeftGroupChat];

  v5 = [(CKCoreChatController *)self isReadOnly];
  v6 = [(CKCoreChatController *)self conversation];
  v7 = [v6 isBusinessChatDisabled];

  return ([(CKChatController *)self isEditing]& 1) != 0 || (v4 & 1) != 0 || v7 & 1 | ![(CKCoreChatController *)self shouldDisplayTextEntry]| v5;
}

- (BOOL)previewControllerIsInGroupConversation:(id)a3
{
  v3 = [(CKCoreChatController *)self conversation];
  v4 = [v3 isGroupConversation];

  return v4;
}

- (void)sendMessageAcknowledgment:(int64_t)a3 chatItem:(id)a4 previewController:(id)a5
{
  v7 = a4;
  v8 = [(CKCoreChatController *)self chat];
  [v8 sendMessageAcknowledgment:a3 forChatItem:v7];
}

- (id)contextualCKChatItemsForPreviewController:(id)a3
{
  v3 = [(CKCoreChatController *)self collectionViewController];
  v4 = [v3 chatItems];

  return v4;
}

- (void)previewControllerDidCancelDismiss:(id)a3
{
  v3 = [(CKCoreChatController *)self collectionViewController];
  [v3 endHoldingUpdatesAfterQuicklookCancelsDismiss];
}

- (id)_chatItemForMediaObject:(id)a3
{
  v42 = *MEMORY[0x1E69E9840];
  v31 = a3;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  v4 = [(CKCoreChatController *)self collectionViewController];
  v5 = [v4 chatItems];

  v30 = [v5 countByEnumeratingWithState:&v36 objects:v41 count:16];
  if (!v30)
  {
    goto LABEL_22;
  }

  v6 = *v37;
  v26 = *v37;
  v27 = v5;
  do
  {
    for (i = 0; i != v30; ++i)
    {
      if (*v37 != v6)
      {
        objc_enumerationMutation(v5);
      }

      v8 = *(*(&v36 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v9 = v8;
        v10 = [v9 mediaObject];
        v11 = [v10 transferGUID];
        v12 = [v31 transferGUID];
        v13 = [v11 isEqualToString:v12];

        if (v13)
        {
          goto LABEL_23;
        }

        goto LABEL_8;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v28 = v8;
        v14 = v8;
        v32 = 0u;
        v33 = 0u;
        v34 = 0u;
        v35 = 0u;
        v29 = v14;
        v15 = [v14 aggregateChatItems];
        v16 = [v15 countByEnumeratingWithState:&v32 objects:v40 count:16];
        if (!v16)
        {
LABEL_18:

          v6 = v26;
          v5 = v27;
          v8 = v28;
LABEL_8:

          continue;
        }

        v17 = v16;
        v18 = *v33;
LABEL_12:
        v19 = 0;
        while (1)
        {
          if (*v33 != v18)
          {
            objc_enumerationMutation(v15);
          }

          v20 = *(*(&v32 + 1) + 8 * v19);
          v21 = [v20 mediaObject];
          v22 = [v21 transferGUID];
          v23 = [v31 transferGUID];
          v24 = [v22 isEqualToString:v23];

          if (v24)
          {
            break;
          }

          if (v17 == ++v19)
          {
            v17 = [v15 countByEnumeratingWithState:&v32 objects:v40 count:16];
            if (v17)
            {
              goto LABEL_12;
            }

            goto LABEL_18;
          }
        }

        v9 = v20;

        v6 = v26;
        v5 = v27;
        if (v9)
        {
          goto LABEL_23;
        }
      }
    }

    v30 = [v5 countByEnumeratingWithState:&v36 objects:v41 count:16];
  }

  while (v30);
LABEL_22:
  v9 = 0;
LABEL_23:

  return v9;
}

- (BOOL)respondsToSelector:(SEL)a3
{
  if (sel_animateRevealWithInteractionProgress_forPreviewingAtLocation_inSourceView_containerView_ == a3)
  {
    v4 = [(CKChatController *)self previewRevealView];
    v3 = v4 != 0;
  }

  else
  {
    v6.receiver = self;
    v6.super_class = CKChatController;
    return [(CKChatController *)&v6 respondsToSelector:?];
  }

  return v3;
}

- (void)animateRevealWithInteractionProgress:(id)a3 forPreviewingAtLocation:(CGPoint)a4 inSourceView:(id)a5 containerView:(id)a6
{
  v24 = a3;
  v8 = a5;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) != 0 && ([v24 didEnd] & 1) == 0)
  {
    v9 = [MEMORY[0x1E69DC668] sharedApplication];
    v10 = [v9 keyWindow];

    [v8 bounds];
    [v8 convertRect:v10 toView:?];
    v12 = v11;
    v14 = v13;
    v16 = v15;
    v18 = v17;
    v19 = [(CKChatController *)self previewRevealView];
    [v10 addSubview:v19];

    v20 = [(CKChatController *)self previewRevealView];
    [v20 setFrame:{v12, v14, v16, v18}];

    v21 = [(CKChatController *)self previewRevealView];
    v22 = [(CKChatController *)self previewInvisibleInkEffectController];
    v23 = [v22 borrowEffectView];
    [v21 addSubview:v23];

    [v24 addProgressObserver:self];
  }

  else
  {
    [(CKChatController *)self setPreviewRevealView:0];
  }
}

- (void)interactionProgressDidUpdate:(id)a3
{
  v4 = MEMORY[0x1E69793D0];
  v5 = *MEMORY[0x1E6979EB8];
  v6 = a3;
  v7 = [v4 functionWithName:v5];
  [v6 percentComplete];
  v9 = v8;

  *&v10 = v9;
  [v7 _solveForInput:v10];
  v12 = v11 * 0.0175 + 1.0;
  v13 = [(CKChatController *)self previewRevealView];
  CGAffineTransformMakeScale(&v14, v12, v12);
  [v13 setTransform:&v14];
}

- (void)interactionProgress:(id)a3 didEnd:(BOOL)a4
{
  v6 = a3;
  v5 = [(CKChatController *)self previewRevealView];
  [v5 removeFromSuperview];

  [(CKChatController *)self setPreviewRevealView:0];
  [v6 removeProgressObserver:self];
}

- (void)updateFTButton
{
  v5 = [(CKChatController *)self callStateResolver];
  v3 = [(CKChatController *)self navBarFaceTimeCallButton];
  v4 = [v5 updateCallStateForCallButton:v3];
}

- (void)button:(id)a3 requestsJoinActiveCallWithVideoEnabled:(BOOL)a4
{
  v4 = a4;
  v6 = a3;
  v7 = [(CKChatController *)self navBarFaceTimeCallButton];

  if (v7 == v6)
  {
    v8 = [(CKCoreChatController *)self conversation];
    v9 = [v8 chat];
    v10 = [v9 conversation];

    if (v10)
    {
      v14 = [(CKCoreChatController *)self conversation];
      v11 = [v14 chat];
      [v11 joinExistingTUConversation];
    }

    else
    {
      IsGreenTea = IMDeviceIsGreenTea();
      v14 = [(CKCoreChatController *)self conversation];
      v13 = [v14 chat];
      v11 = v13;
      if (IsGreenTea)
      {
        [v13 initiateTUDialRequestWithVideoEnabled:v4];
      }

      else
      {
        [v13 initiateTUConversationWithVideoEnabled:v4];
      }
    }
  }
}

- (void)buttonRequestsOpenJoinedCall:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self navBarFaceTimeCallButton];

  if (v5 == v4)
  {
    v6 = [(CKCoreChatController *)self conversation];
    v7 = [v6 chat];
    v10 = [v7 conversation];

    if (v10 && [v10 state] && objc_msgSend(v10, "state") != 1)
    {
      [CKFaceTimeUtilities showCallControlsForConversation:v10];
    }

    else
    {
      v8 = [(CKCoreChatController *)self conversation];
      v9 = [v8 chat];
      [v9 joinExistingTUConversation];
    }
  }
}

- (void)buttonRequestsStartFaceTimeAudio:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self navBarFaceTimeCallButton];

  if (v5 == v4)
  {
    v7 = [(CKCoreChatController *)self conversation];
    v6 = [v7 chat];
    [v6 initiateTUConversationWithVideoEnabled:0];
  }
}

- (void)buttonRequestsStartFaceTimeVideo:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self navBarFaceTimeCallButton];

  if (v5 == v4)
  {
    v7 = [(CKCoreChatController *)self conversation];
    v6 = [v7 chat];
    [v6 initiateTUConversationWithVideoEnabled:1];
  }
}

- (void)buttonRequestsLeaveJoinedCall:(id)a3
{
  v4 = [(CKCoreChatController *)self conversation];
  v3 = [v4 chat];
  [v3 leaveCurrentTUCall];
}

- (void)button:(id)a3 requestsStartFaceTimeWithScreenShareType:(unint64_t)a4
{
  v13 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = [(CKChatController *)self navBarFaceTimeCallButton];

  if (v7 == v6)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v11 = 134217984;
      v12 = a4;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Request to start screenShare call detected type={%ld).", &v11, 0xCu);
    }

    v9 = [(CKCoreChatController *)self conversation];
    v10 = [v9 chat];
    [v10 initiateTUConversationWithScreenShareType:a4];
  }
}

- (void)presentCollaborationPopoverUI
{
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke;
  aBlock[3] = &unk_1E72F3CB0;
  aBlock[4] = self;
  v3 = _Block_copy(aBlock);
  if (CKIsRunningInMacCatalyst() && ([MEMORY[0x1E6994FD0] instancesRespondToSelector:sel_initWithCollaborationSharingOptions_layoutMargins_userDidChangeOption_contentSizeDidChange_] & 1) != 0)
  {
    v4 = 0;
  }

  else
  {
    v5 = [MEMORY[0x1E6994FD0] instancesRespondToSelector:sel_initWithCollaborationSharingOptionsView_userDidChangeOption_];
    v6 = objc_alloc(MEMORY[0x1E6994FD0]);
    v7 = [(CKChatController *)self composition];
    v8 = [v7 collaborationShareOptions];
    v9 = v8;
    if (v5)
    {
      v4 = [v6 initWithCollaborationSharingOptionsView:v8 userDidChangeOption:v3];
    }

    else
    {
      v10 = [v8 optionsGroups];
      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke_2;
      v17[3] = &unk_1E72F3CD8;
      v17[4] = self;
      v4 = [v6 initWithSharingOptionsView:v10 userDidChangeOption:v17];
    }
  }

  [v4 setModalPresentationStyle:1];
  [v4 setModalTransitionStyle:0];
  v11 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel__dismissCollaborationPopoverUI];
  v12 = [v4 navigationItem];
  [v12 setRightBarButtonItem:v11];

  v13 = [[CKFullscreenBrowserNavigationController alloc] initWithRootViewController:v4];
  v14 = [(CKFullscreenBrowserNavigationController *)v13 navigationBar];
  [v14 setTranslucent:0];
  [v14 _setShadowAlpha:0.0];
  v15 = [MEMORY[0x1E69DC888] systemGroupedBackgroundColor];
  [v14 _setBackgroundColor:v15];

  v16 = +[CKAdaptivePresentationController sharedInstance];
  [v16 presentViewController:v13 fromViewController:self presentationHandler:0 dismissalHandler:0 animated:1 completion:0];
}

void __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, void *a5)
{
  v6 = *(a1 + 32);
  v7 = a5;
  v8 = [v6 composition];
  v12 = [v8 shelfPluginPayload];

  [v12 setSkipConfigurePlugin:0];
  v9 = [v7 summary];
  [v12 setCollaborationOptionsSummary:v9];

  v10 = [*(a1 + 32) composition];
  v11 = [v10 compositionByAppendingText:0 shelfPluginPayload:v12 shelfMediaObject:0 collaborationShareOptions:v7];

  [*(a1 + 32) setComposition:v11];
}

void __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke_2(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5)
{
  v8 = [MEMORY[0x1E697B720] shareOptionsWithOptionsGroups:a5];
  v6 = [*(a1 + 32) composition];
  v7 = [v6 compositionWithCollaborationShareOptions:v8];
  [*(a1 + 32) setComposition:v7];
}

- (void)_dismissCollaborationPopoverUI
{
  v2 = +[CKAdaptivePresentationController sharedInstance];
  [v2 dismissViewControllerAnimated:1 completion:0];
}

- (void)presentCollaborationFailureAlertForComposition:(id)a3 sharingURL:(id)a4 error:(id)a5 completion:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  if ([MEMORY[0x1E696AF00] isMainThread])
  {
    [(CKChatController *)self _actuallyPresentCollaborationFailureAlertForComposition:v10 sharingURL:v11 error:v12 completion:v13];
  }

  else
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __110__CKChatController_Collaboration__presentCollaborationFailureAlertForComposition_sharingURL_error_completion___block_invoke;
    block[3] = &unk_1E72EDAE0;
    block[4] = self;
    v15 = v10;
    v16 = v11;
    v17 = v12;
    v18 = v13;
    dispatch_sync(MEMORY[0x1E69E96A0], block);
  }
}

- (void)_actuallyPresentCollaborationFailureAlertForComposition:(id)a3 sharingURL:(id)a4 error:(id)a5 completion:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = v10;
  v14 = v12;
  v15 = a6;
  v16 = [v10 sourceApplicationID];
  LODWORD(v10) = [v16 isEqual:@"com.apple.FaceTime"];

  if (v10)
  {
    v17 = [MEMORY[0x1E695DFF8] URLWithString:@"messages://"];
    TUOpenURL();
  }

  v198 = v15;
  v199 = self;
  if (!v14)
  {
    goto LABEL_24;
  }

  v18 = [v14 domain];
  v19 = [v18 isEqualToString:*MEMORY[0x1E695B740]];

  if (v19)
  {
    v20 = [(CKChatController *)self composition];
    v21 = [v20 shelfPluginPayload];

    v22 = [v21 collaborationMetadata];
    v23 = [v22 initiatorHandle];

    v24 = [v14 code];
    v195 = v23;
    if (v24 > 109)
    {
      if (v24 == 110)
      {
        v122 = CKFrameworkBundle();
        v115 = v21;
        v27 = [v122 localizedStringForKey:@"COLLABORATION_ERROR_PRIVATE_MANATEE_UNAVAILABLE_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

        v116 = CKFrameworkBundle();
        v29 = v116;
        v117 = @"COLLABORATION_ERROR_PRIVATE_MANATEE_UNAVAILABLE_ALERT_MESSAGE";
LABEL_74:
        v21 = v115;
        v37 = [v116 localizedStringForKey:v117 value:&stru_1F04268F8 table:@"ChatKit"];
        v34 = 1;
        v36 = 1;
        goto LABEL_106;
      }

      if (v24 == 111)
      {
LABEL_31:
        v29 = [MEMORY[0x1E69A8288] sharedManager];
        v65 = [v29 appNameFromSharingURL:v11];
        if (v65)
        {
          v66 = MEMORY[0x1E696AEC0];
          CKFrameworkBundle();
          v67 = v190 = v21;
          [v67 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v186 = v65;
          v69 = v68 = v14;
          v70 = [MEMORY[0x1E69A8288] sharedManager];
          v71 = [v70 appNameFromSharingURL:v11];
          v72 = [v66 stringWithFormat:v69, v71];

          v14 = v68;
          v65 = v186;

          v21 = v190;
          v73 = [MEMORY[0x1E69DC668] sharedApplication];
          v74 = [v73 userInterfaceLayoutDirection];

          if (v74 == 1)
          {
            v75 = @"\u200F";
          }

          else
          {
            v75 = @"\u200E";
          }

          v76 = [(__CFString *)v75 stringByAppendingString:v72];
        }

        else
        {
          v72 = CKFrameworkBundle();
          v76 = [v72 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        }

        v37 = v76;

        v34 = 0;
        v27 = 0;
LABEL_65:
        v36 = 3;
        goto LABEL_106;
      }

      if (v24 != 140)
      {
LABEL_75:
        v29 = [MEMORY[0x1E69A8288] sharedManager];
        v123 = [v29 appNameFromSharingURL:v11];
        if (v123)
        {
          v124 = MEMORY[0x1E696AEC0];
          CKFrameworkBundle();
          v125 = v192 = v21;
          [v125 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v188 = v123;
          v127 = v126 = v14;
          v128 = [MEMORY[0x1E69A8288] sharedManager];
          v129 = [v128 appNameFromSharingURL:v11];
          v130 = [v124 stringWithFormat:v127, v129];

          v14 = v126;
          v123 = v188;

          v21 = v192;
          v131 = [MEMORY[0x1E69DC668] sharedApplication];
          v132 = [v131 userInterfaceLayoutDirection];

          if (v132 == 1)
          {
            v133 = @"\u200F";
          }

          else
          {
            v133 = @"\u200E";
          }

          v134 = [(__CFString *)v133 stringByAppendingString:v130];
        }

        else
        {
          v130 = CKFrameworkBundle();
          v134 = [v130 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        }

        v37 = v134;

        v34 = 0;
        v36 = 0;
        v27 = 0;
        goto LABEL_106;
      }

LABEL_28:
      v55 = CKFrameworkBundle();
      v56 = v21;
      v27 = [v55 localizedStringForKey:@"COLLABORATION_ERROR_NOT_ENOUGH_SPACE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v57 = MEMORY[0x1E696AEC0];
      CKFrameworkBundle();
      v59 = v58 = v14;
      v60 = [v59 localizedStringForKey:@"COLLABORATION_ERROR_NOT_ENOUGH_SPACE_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
      v61 = [MEMORY[0x1E696AAF0] stringFromByteCount:objc_msgSend(v13 countStyle:{"mediaObjectsFileSize"), 3}];
      v29 = [v57 stringWithFormat:v60, v61];

      v21 = v56;
      v14 = v58;
      v62 = [MEMORY[0x1E69DC668] sharedApplication];
      v63 = [v62 userInterfaceLayoutDirection];

      if (v63 == 1)
      {
        v64 = @"\u200F";
      }

      else
      {
        v64 = @"\u200E";
      }

LABEL_58:
      v97 = [(__CFString *)v64 stringByAppendingString:v29];
    }

    else
    {
      switch(v24)
      {
        case 3:
        case 4:
          v25 = CKFrameworkBundle();
          v26 = v21;
          v27 = [v25 localizedStringForKey:@"COLLABORATION_ERROR_NO_INTERNET_CONNECTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          v29 = v28;
          v30 = @"COLLABORATION_ERROR_NO_INTERNET_CONNECTION_MESSAGE";
          goto LABEL_70;
        case 6:
          v118 = CKFrameworkBundle();
          v26 = v21;
          v27 = [v118 localizedStringForKey:@"COLLABORATION_ERROR_ICLOUD_UNAVAILABLE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          v29 = v28;
          v30 = @"COLLABORATION_ERROR_TRY_AGAIN_LATER";
          goto LABEL_70;
        case 7:
        case 23:
        case 34:
          goto LABEL_31;
        case 9:
          v114 = CKFrameworkBundle();
          v115 = v21;
          v27 = [v114 localizedStringForKey:@"COLLABORATION_ERROR_NOT_AUTHENTICATED_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v116 = CKFrameworkBundle();
          v29 = v116;
          v117 = @"COLLABORATION_ERROR_NOT_AUTHENTICATED_ALERT_MESSAGE";
          goto LABEL_74;
        case 18:
          v98 = [MEMORY[0x1E69A8288] sharedManager];
          v99 = [v98 appNameFromSharingURL:v11];
          if (v99)
          {
            v100 = MEMORY[0x1E696AEC0];
            CKFrameworkBundle();
            v101 = v187 = v98;
            [v101 localizedStringForKey:@"COLLABORATION_ERROR_INCOMPATIBLE_VERSION_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
            v191 = v21;
            v103 = v102 = v14;
            v104 = [MEMORY[0x1E69A8288] sharedManager];
            [v104 appNameFromSharingURL:v11];
            v106 = v105 = v99;
            v107 = [v100 stringWithFormat:v103, v106];

            v99 = v105;
            v14 = v102;
            v21 = v191;

            v108 = [MEMORY[0x1E69DC668] sharedApplication];
            v109 = [v108 userInterfaceLayoutDirection];

            v110 = v109 == 1;
            v98 = v187;
            if (v110)
            {
              v111 = @"\u200F";
            }

            else
            {
              v111 = @"\u200E";
            }

            v112 = [(__CFString *)v111 stringByAppendingString:v107];
          }

          else
          {
            v107 = CKFrameworkBundle();
            v112 = [v107 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          }

          v27 = v112;

          v29 = CKFrameworkBundle();
          v37 = [v29 localizedStringForKey:@"COLLABORATION_ERROR_INCOMPATIBLE_VERSION_ALERT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v36 = 2;
          v34 = 1;
          goto LABEL_106;
        case 25:
          goto LABEL_28;
        case 27:
          v119 = CKFrameworkBundle();
          v26 = v21;
          v27 = [v119 localizedStringForKey:@"COLLABORATION_ERROR_LIMIT_EXCEEDED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          v29 = v28;
          v30 = @"COLLABORATION_ERROR_LIMIT_EXCEEDED_MESSAGE";
          goto LABEL_70;
        case 29:
          v120 = CKFrameworkBundle();
          v26 = v21;
          v27 = [v120 localizedStringForKey:@"COLLABORATION_ERROR_TOO_MANY_PARTICIPANTS_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          v29 = v28;
          v30 = @"COLLABORATION_ERROR_TOO_MANY_PARTICIPANTS_ALERT_MESSAGE";
LABEL_70:
          v21 = v26;
          v97 = [v28 localizedStringForKey:v30 value:&stru_1F04268F8 table:@"ChatKit"];
          break;
        case 32:
          v84 = MEMORY[0x1E696AEC0];
          v85 = CKFrameworkBundle();
          v86 = [v85 localizedStringForKey:@"COLLABORATION_ERROR_RESTRICTION_ENABLED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          [v84 stringWithFormat:v86, v23];
          v88 = v87 = v14;

          v89 = [MEMORY[0x1E69DC668] sharedApplication];
          v90 = [v89 userInterfaceLayoutDirection];

          if (v90 == 1)
          {
            v91 = @"\u200F";
          }

          else
          {
            v91 = @"\u200E";
          }

          v27 = [(__CFString *)v91 stringByAppendingString:v88];

          v92 = MEMORY[0x1E696AEC0];
          v93 = CKFrameworkBundle();
          v94 = [v93 localizedStringForKey:@"COLLABORATION_ERROR_RESTRICTION_ENABLED_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v29 = [v92 stringWithFormat:v94, v23];

          v14 = v87;
          v95 = [MEMORY[0x1E69DC668] sharedApplication];
          v96 = [v95 userInterfaceLayoutDirection];

          if (v96 == 1)
          {
            v64 = @"\u200F";
          }

          else
          {
            v64 = @"\u200E";
          }

          goto LABEL_58;
        case 33:
          v113 = CKFrameworkBundle();
          v27 = [v113 localizedStringForKey:@"COLLABORATION_ERROR_PARTICIPANT_MAY_NEED_VERIFICATION_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v29 = CKFrameworkBundle();
          v37 = [v29 localizedStringForKey:@"COLLABORATION_ERROR_PARTICIPANT_MAY_NEED_VERIFICATION_ALERT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v34 = 0;
          goto LABEL_65;
        case 36:
          v121 = CKFrameworkBundle();
          v115 = v21;
          v27 = [v121 localizedStringForKey:@"COLLABORATION_ERROR_ACCOUNT_TEMPORARILY_UNAVAILABLE_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v116 = CKFrameworkBundle();
          v29 = v116;
          v117 = @"COLLABORATION_ERROR_ACCOUNT_TEMPORARILY_UNAVAILABLE_ALERT_MESSAGE";
          goto LABEL_74;
        default:
          goto LABEL_75;
      }
    }

    v37 = v97;
    v34 = 0;
    v36 = 0;
LABEL_106:

    v35 = 0;
    goto LABEL_107;
  }

  v31 = [v14 domain];
  v32 = [v31 isEqualToString:@"CKCollaborationErrorDomain"];

  if (!v32)
  {
    v42 = [v14 domain];
    v43 = [v42 isEqualToString:@"CKCollaborationStatusErrorDomain"];

    if (v43)
    {
      v44 = [v14 code];
      v27 = 0;
      v45 = @"COLLABORATION_ERROR_FOLDER_UNMODIFIABLE_SUBITEM_MESSAGE";
      v46 = @"COLLABORATION_ERROR_FOLDER_UNMODIFIABLE_SUBITEM_TITLE";
      v36 = 4;
      if (v44 <= 2)
      {
        if (!v44)
        {
          v47 = CKFrameworkBundle();
          v48 = v47;
          v49 = @"COLLABORATION_ERROR_ITEM_CANNOT_BE_SHARED_TITLE";
          goto LABEL_90;
        }

        if (v44 != 1)
        {
          v36 = 0;
          v34 = 0;
          if (v44 == 2)
          {
            v47 = CKFrameworkBundle();
            v48 = v47;
            v49 = @"COLLABORATION_ERROR_ITEM_IS_ALREADY_SHARED_BY_ANOTHER_TITLE";
            goto LABEL_90;
          }

          goto LABEL_95;
        }
      }

      else
      {
        if (v44 <= 4)
        {
          if (v44 == 3)
          {
            v153 = IMLogHandleForCategory();
            if (os_log_type_enabled(v153, OS_LOG_TYPE_ERROR))
            {
              [CKChatController(Collaboration) _actuallyPresentCollaborationFailureAlertForComposition:sharingURL:error:completion:];
            }

            v27 = 0;
            goto LABEL_94;
          }

          v47 = CKFrameworkBundle();
          v48 = v47;
          v49 = @"COLLABORATION_ERROR_ITEM_IS_ALREADY_SHARED_BY_ME_TITLE";
LABEL_90:
          v27 = [v47 localizedStringForKey:v49 value:&stru_1F04268F8 table:@"ChatKit"];

LABEL_94:
          v36 = 0;
          v34 = 0;
          goto LABEL_95;
        }

        if (v44 != 5)
        {
          v36 = 0;
          v34 = 0;
          if (v44 == 6)
          {
            v45 = @"COLLABORATION_ERROR_FOLDER_HAS_SHARED_SUBITEM_MESSAGE";
            v36 = 5;
            v46 = @"COLLABORATION_ERROR_FOLDER_HAS_SHARED_SUBITEM_TITLE";
            goto LABEL_50;
          }

LABEL_95:
          v196 = [MEMORY[0x1E69A8288] sharedManager];
          v193 = [v196 appNameFromSharingURL:v11];
          if (v193)
          {
            v154 = MEMORY[0x1E696AEC0];
            v189 = CKFrameworkBundle();
            v155 = [v189 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
            v156 = [MEMORY[0x1E69A8288] sharedManager];
            [v156 appNameFromSharingURL:v11];
            v158 = v157 = v14;
            v159 = [v154 stringWithFormat:v155, v158];

            v14 = v157;
            v160 = [MEMORY[0x1E69DC668] sharedApplication];
            v161 = [v160 userInterfaceLayoutDirection];

            if (v161 == 1)
            {
              v162 = @"\u200F";
            }

            else
            {
              v162 = @"\u200E";
            }

            v163 = [(__CFString *)v162 stringByAppendingString:v159];
          }

          else
          {
            v159 = CKFrameworkBundle();
            v163 = [v159 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          }

          v37 = v163;
          self = v199;

          v35 = 0;
          goto LABEL_108;
        }
      }

LABEL_50:
      v82 = CKFrameworkBundle();
      v27 = [v82 localizedStringForKey:v46 value:&stru_1F04268F8 table:@"ChatKit"];

      v83 = CKFrameworkBundle();
      v37 = [v83 localizedStringForKey:v45 value:&stru_1F04268F8 table:@"ChatKit"];

      v34 = 2;
      if (v37)
      {
        v35 = 0;
LABEL_107:
        self = v199;
        goto LABEL_108;
      }

      goto LABEL_95;
    }

    v54 = IMLogHandleForCategory();
    if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(Collaboration) _actuallyPresentCollaborationFailureAlertForComposition:sharingURL:error:completion:];
    }

LABEL_24:
    v35 = 0;
    v34 = 0;
    v36 = 0;
    v37 = 0;
    v27 = 0;
    goto LABEL_108;
  }

  v33 = [v14 code];
  v34 = 0;
  v35 = 0;
  if (v33 > 2)
  {
    if (v33 == 3)
    {
      v78 = [(CKCoreChatController *)self conversation];
      v79 = [v78 chat];
      v80 = [v79 isGroupChat];

      if (!v80)
      {
        v135 = [(CKCoreChatController *)self conversation];
        v136 = [v135 recipient];
        v137 = [v136 abbreviatedDisplayName];

        v138 = MEMORY[0x1E696AEC0];
        v139 = CKFrameworkBundle();
        [v139 localizedStringForKey:@"COLLABORATION_ERROR_SINGLE_RECIPIENT_CANNOT_JOIN_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
        v141 = v140 = v14;
        v142 = [v138 stringWithFormat:v141, v137];

        v143 = [MEMORY[0x1E69DC668] sharedApplication];
        v144 = [v143 userInterfaceLayoutDirection];

        if (v144 == 1)
        {
          v145 = @"\u200F";
        }

        else
        {
          v145 = @"\u200E";
        }

        v27 = [(__CFString *)v145 stringByAppendingString:v142];

        v146 = MEMORY[0x1E696AEC0];
        v147 = CKFrameworkBundle();
        v148 = [v147 localizedStringForKey:@"COLLABORATION_ERROR_SINGLE_RECIPIENT_CANNOT_JOIN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        v149 = [v146 stringWithFormat:v148, v137];

        v14 = v140;
        v150 = [MEMORY[0x1E69DC668] sharedApplication];
        v151 = [v150 userInterfaceLayoutDirection];

        if (v151 == 1)
        {
          v152 = @"\u200F";
        }

        else
        {
          v152 = @"\u200E";
        }

        v37 = [(__CFString *)v152 stringByAppendingString:v149];

        self = v199;
        goto LABEL_87;
      }

      v81 = CKFrameworkBundle();
      v27 = [v81 localizedStringForKey:@"COLLABORATION_ERROR_ALL_RECIPIENTS_CANNOT_JOIN_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v51 = CKFrameworkBundle();
      v52 = v51;
      v53 = @"COLLABORATION_ERROR_ALL_RECIPIENTS_CANNOT_JOIN_MESSAGE";
    }

    else
    {
      v36 = 0;
      v37 = 0;
      v27 = 0;
      if (v33 != 4)
      {
        goto LABEL_108;
      }

      v50 = CKFrameworkBundle();
      v27 = [v50 localizedStringForKey:@"COLLABORATION_ERROR_SOME_RECIPIENTS_CANNOT_JOIN_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v51 = CKFrameworkBundle();
      v52 = v51;
      v53 = @"COLLABORATION_ERROR_SOME_RECIPIENTS_CANNOT_JOIN_MESSAGE";
    }

    v37 = [v51 localizedStringForKey:v53 value:&stru_1F04268F8 table:@"ChatKit"];

    self = v199;
LABEL_87:
    v34 = 0;
    v36 = 0;
    v35 = 1;
    goto LABEL_108;
  }

  if (v33 == 1)
  {
    v77 = CKFrameworkBundle();
    v27 = [v77 localizedStringForKey:@"COLLABORATION_ERROR_URL_INACCESSABLE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

    v39 = CKFrameworkBundle();
    v40 = v39;
    v41 = @"COLLABORATION_ERROR_URL_INACCESSABLE_MESSAGE";
    goto LABEL_41;
  }

  v36 = 0;
  v37 = 0;
  v27 = 0;
  if (v33 == 2)
  {
    v38 = CKFrameworkBundle();
    v27 = [v38 localizedStringForKey:@"COLLABORATION_ERROR_MISSING_FILE_FOR_URL_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

    v39 = CKFrameworkBundle();
    v40 = v39;
    v41 = @"COLLABORATION_ERROR_MISSING_FILE_FOR_URL_MESSAGE";
LABEL_41:
    v37 = [v39 localizedStringForKey:v41 value:&stru_1F04268F8 table:@"ChatKit"];

    self = v199;
    v35 = 0;
    v34 = 0;
    v36 = 0;
  }

LABEL_108:
  v164 = [(CKChatController *)self collaborationFailureCount];
  [(CKChatController *)self setCollaborationFailureCount:v164 + 1];
  if ((v35 & 1) != 0 || v164 < 3)
  {
    if (v27)
    {
      if (v37)
      {
        goto LABEL_123;
      }
    }

    else
    {
      v183 = CKFrameworkBundle();
      v27 = [v183 localizedStringForKey:@"COLLABORATION_ERROR_OCCURRED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      if (v37)
      {
        goto LABEL_123;
      }
    }

    v197 = v14;
    v167 = CKFrameworkBundle();
    v182 = [v167 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
  }

  else
  {
    v197 = v14;
    v165 = CKFrameworkBundle();
    v166 = [v165 localizedStringForKey:@"COLLABORATION_ERROR_OCCURRED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

    v167 = [MEMORY[0x1E69A8288] sharedManager];
    v168 = [v167 appNameFromSharingURL:v11];
    if (v168)
    {
      v169 = MEMORY[0x1E696AEC0];
      v170 = CKFrameworkBundle();
      v171 = [v170 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
      v172 = [MEMORY[0x1E69A8288] sharedManager];
      [v172 appNameFromSharingURL:v11];
      v194 = v37;
      v173 = v166;
      v174 = v11;
      v176 = v175 = v13;
      v177 = [v169 stringWithFormat:v171, v176];

      v178 = [MEMORY[0x1E69DC668] sharedApplication];
      v179 = [v178 userInterfaceLayoutDirection];

      v110 = v179 == 1;
      v13 = v175;
      v11 = v174;
      v166 = v173;
      v180 = v194;
      if (v110)
      {
        v181 = @"\u200F";
      }

      else
      {
        v181 = @"\u200E";
      }

      v182 = [(__CFString *)v181 stringByAppendingString:v177];
    }

    else
    {
      v180 = CKFrameworkBundle();
      v182 = [v180 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
      v177 = v37;
    }

    v34 = 0;
    v36 = 0;
    v27 = v166;
  }

  v37 = v182;
  v14 = v197;
  self = v199;
LABEL_123:
  v184 = IMLogHandleForCategory();
  if (os_log_type_enabled(v184, OS_LOG_TYPE_ERROR))
  {
    [CKChatController(Collaboration) _actuallyPresentCollaborationFailureAlertForComposition:sharingURL:error:completion:];
  }

  v185 = [CKAlertController alertControllerWithTitle:v27 message:v37 preferredStyle:1];
  [v185 setWantsWindowedPresentation:0];
  [(CKChatController *)self _addDefaultButtonToSharingErrorAlertController:v185 sharingURL:v11 defaultButtonAction:v36 completion:v198];
  [(CKChatController *)self _addOtherButtonToSharingErrorAlertController:v185 otherButtonAction:v34 completion:v198];

  [v185 presentFromViewController:self animated:1 completion:0];
}

- (void)_addOtherButtonToSharingErrorAlertController:(id)a3 otherButtonAction:(int64_t)a4 completion:(id)a5
{
  v8 = a3;
  v9 = a5;
  if (a4 == 1)
  {
    v10 = @"NOT_NOW";
  }

  else
  {
    if (a4 != 2)
    {
      goto LABEL_7;
    }

    v10 = @"CANCEL";
  }

  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:v10 value:&stru_1F04268F8 table:@"ChatKit"];

  if (v12)
  {
    v14 = MEMORY[0x1E69E9820];
    v15 = 3221225472;
    v16 = __109__CKChatController_Collaboration___addOtherButtonToSharingErrorAlertController_otherButtonAction_completion___block_invoke;
    v17 = &unk_1E72F35A0;
    v18 = self;
    v19 = v9;
    v13 = [CKAlertAction actionWithTitle:v12 style:1 handler:&v14];
    [v8 addAction:{v13, v14, v15, v16, v17, v18}];
  }

LABEL_7:
}

uint64_t __109__CKChatController_Collaboration___addOtherButtonToSharingErrorAlertController_otherButtonAction_completion___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryView];
  [v2 configureForDisplayMode:1];

  v3 = [*(a1 + 32) entryView];
  v4 = [v3 sendButton];
  [v4 setEnabled:1];

  v5 = [*(a1 + 32) entryView];
  [v5 updateEntryView];

  v6 = IMLogHandleForCategory();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    *v8 = 0;
    _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "User tapped other alert button", v8, 2u);
  }

  result = *(a1 + 40);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)_addDefaultButtonToSharingErrorAlertController:(id)a3 sharingURL:(id)a4 defaultButtonAction:(int64_t)a5 completion:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a6;
  if (a5 > 5)
  {
    v15 = 0;
  }

  else
  {
    v13 = off_1E72F3ED8[a5];
    v14 = CKFrameworkBundle();
    v15 = [v14 localizedStringForKey:v13 value:&stru_1F04268F8 table:@"ChatKit"];
  }

  v19 = MEMORY[0x1E69E9820];
  v20 = 3221225472;
  v21 = __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke;
  v22 = &unk_1E72F3D00;
  v23 = v11;
  v24 = self;
  v25 = v12;
  v26 = a5;
  v16 = v12;
  v17 = v11;
  v18 = [CKAlertAction actionWithTitle:v15 style:0 handler:&v19];
  [v10 addAction:{v18, v19, v20, v21, v22}];
}

void __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke(uint64_t a1, void *a2)
{
  v31 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = 0;
  v5 = *(a1 + 56);
  if (v5 <= 2)
  {
    if (v5 == 1)
    {
      v12 = [MEMORY[0x1E6963608] defaultWorkspace];
      v13 = [MEMORY[0x1E695DFF8] URLWithString:@"prefs:root=APPLE_ACCOUNT&path=APPLE_ACCOUNT_CONTACT"];
      v28 = 0;
      [v12 openSensitiveURL:v13 withOptions:0 error:&v28];
      v7 = v28;

      v14 = IMLogHandleForCategory();
      v9 = v14;
      if (v7)
      {
        if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
        {
          __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke_cold_1();
        }
      }

      else if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Opened user apple account settings page ok", buf, 2u);
      }
    }

    else
    {
      if (v5 != 2)
      {
        goto LABEL_24;
      }

      v6 = [MEMORY[0x1E69A8288] sharedManager];
      v7 = [v6 appStoreURLFromSharingURL:*(a1 + 32)];

      if (v7)
      {
        v8 = [MEMORY[0x1E6963608] defaultWorkspace];
        v27 = 0;
        [v8 openSensitiveURL:v7 withOptions:0 error:&v27];
        v9 = v27;

        v10 = IMLogHandleForCategory();
        v11 = v10;
        if (v9)
        {
          if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
          {
            __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke_cold_2();
          }
        }

        else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Opened App Store updates page ok", buf, 2u);
        }
      }

      else
      {
        v9 = IMLogHandleForCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
        {
          __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke_cold_3(a1 + 32, v9, v15, v16, v17, v18, v19, v20);
        }
      }
    }

    v4 = 0;
  }

  else if (v5 == 5)
  {
    v4 = 3;
  }

  else if (v5 == 4)
  {
    v4 = 2;
  }

  else
  {
    v4 = v5 == 3;
  }

LABEL_24:
  v21 = [*(a1 + 40) entryView];
  [v21 configureForDisplayMode:1];

  v22 = [*(a1 + 40) entryView];
  v23 = [v22 sendButton];
  [v23 setEnabled:1];

  v24 = [*(a1 + 40) entryView];
  [v24 updateEntryView];

  v25 = IMLogHandleForCategory();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
  {
    *buf = 134217984;
    v30 = v4;
    _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "User tapped default alert button, action: %ld", buf, 0xCu);
  }

  v26 = *(a1 + 48);
  if (v26)
  {
    (*(v26 + 16))(v26, v4);
  }
}

- (id)shareMetadataWithDugongTokensForCKShare:(id)a3 shareURL:(id)a4
{
  v29 = *MEMORY[0x1E69E9840];
  v21 = a3;
  v22 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  obj = [v21 participants];
  v4 = [obj countByEnumeratingWithState:&v24 objects:v28 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v25;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v25 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v24 + 1) + 8 * i);
        v9 = [v8 userIdentity];
        v10 = [v9 lookupInfo];
        v11 = [v10 phoneNumber];
        v12 = v11;
        if (v11)
        {
          v13 = v11;
        }

        else
        {
          v14 = [v8 userIdentity];
          v15 = [v14 lookupInfo];
          v13 = [v15 emailAddress];
        }

        v16 = [v8 invitationToken];
        v17 = v16;
        if (v13)
        {
          v18 = v16 == 0;
        }

        else
        {
          v18 = 1;
        }

        if (!v18)
        {
          if (MEMORY[0x193AF5D40](v13))
          {
            v19 = IMCanonicalizeFormattedString();

            v13 = v19;
          }

          [v22 setObject:v17 forKey:v13];
        }
      }

      v5 = [obj countByEnumeratingWithState:&v24 objects:v28 count:16];
    }

    while (v5);
  }

  return v22;
}

- (void)addParticipant:(id)a3 toCollaboration:(id)a4 forChatGUID:(id)a5 containerSetupInfo:(id)a6 completionHandler:(id)a7
{
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __120__CKChatController_GroupCollaboration__addParticipant_toCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke;
  v22[3] = &unk_1E72F3D28;
  v22[4] = self;
  v23 = v12;
  v24 = v13;
  v25 = v15;
  v26 = v14;
  v27 = v16;
  v17 = v14;
  v18 = v16;
  v19 = v15;
  v20 = v13;
  v21 = v12;
  [(CKChatController *)self _isShareBearURL:v20 completionHandler:v22];
}

uint64_t __120__CKChatController_GroupCollaboration__addParticipant_toCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke(void *a1, int a2)
{
  v3 = a1[4];
  v4 = a1[5];
  v5 = a1[6];
  v6 = a1[9];
  if (a2)
  {
    return [v3 _addParticipant:v4 toShareBearURL:v5 containerSetupInfo:a1[7] completionHandler:v6];
  }

  else
  {
    return [v3 _addParticipant:v4 toShareURL:v5 forChatGUID:a1[8] completionHandler:v6];
  }
}

- (void)removeParticipant:(id)a3 fromCollaboration:(id)a4 forChatGUID:(id)a5 containerSetupInfo:(id)a6 completionHandler:(id)a7
{
  v12 = a3;
  v13 = a4;
  v14 = a5;
  v15 = a6;
  v16 = a7;
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __125__CKChatController_GroupCollaboration__removeParticipant_fromCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke;
  v22[3] = &unk_1E72F3D28;
  v22[4] = self;
  v23 = v12;
  v24 = v13;
  v25 = v15;
  v26 = v14;
  v27 = v16;
  v17 = v14;
  v18 = v16;
  v19 = v15;
  v20 = v13;
  v21 = v12;
  [(CKChatController *)self _isShareBearURL:v20 completionHandler:v22];
}

uint64_t __125__CKChatController_GroupCollaboration__removeParticipant_fromCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke(void *a1, int a2)
{
  v3 = a1[4];
  v4 = a1[5];
  v5 = a1[6];
  v6 = a1[9];
  if (a2)
  {
    return [v3 _removeParticipant:v4 fromShareBearURL:v5 containerSetupInfo:a1[7] completionHandler:v6];
  }

  else
  {
    return [v3 _removeParticipant:v4 fromShareURL:v5 forChatGUID:a1[8] completionHandler:v6];
  }
}

- (void)_addParticipant:(id)a3 toShareBearURL:(id)a4 containerSetupInfo:(id)a5 completionHandler:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke;
    v15[3] = &unk_1E72F3D50;
    v20 = v13;
    v16 = v11;
    v17 = self;
    v18 = v10;
    v19 = v12;
    [(objc_class *)v14 ckMetadataFromShareURL:v16 containerSetupInfo:v19 completionHandler:v15];
  }
}

void __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke(void *a1, void *a2, void *a3)
{
  v15 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (v6 || ([v5 share], v8 = objc_claimAutoreleasedReturnValue(), v8, !v8))
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke_cold_1();
    }

    (*(a1[8] + 16))();
  }

  else
  {
    v9 = IMLogHandleForCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = a1[4];
      v13 = 138412290;
      v14 = v10;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Fetching share for URL: %@", &v13, 0xCu);
    }

    v11 = a1[5];
    v12 = [v5 share];
    [v11 _addParticipantToShare:v12 withHandle:a1[6] toCollaboration:a1[4] containerSetupInfo:a1[7] completionHandler:a1[8]];
  }
}

- (void)_addParticipantToShare:(id)a3 withHandle:(id)a4 toCollaboration:(id)a5 containerSetupInfo:(id)a6 completionHandler:(id)a7
{
  v63 = *MEMORY[0x1E69E9840];
  v11 = a3;
  v12 = a4;
  v13 = a5;
  v47 = a6;
  v14 = a7;
  v15 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v16 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v17 = [MEMORY[0x1E69A7FD0] sharedInstance];
  v18 = [v17 fetchCNContactForHandleWithID:v12];

  if (v18)
  {
    v42 = v14;
    v43 = v13;
    v44 = v12;
    v45 = v11;
    v59 = 0u;
    v60 = 0u;
    v57 = 0u;
    v58 = 0u;
    v19 = [v18 phoneNumbers];
    v20 = [v19 countByEnumeratingWithState:&v57 objects:v62 count:16];
    if (v20)
    {
      v21 = v20;
      v22 = *v58;
      do
      {
        v23 = 0;
        do
        {
          if (*v58 != v22)
          {
            objc_enumerationMutation(v19);
          }

          v24 = [*(*(&v57 + 1) + 8 * v23) value];
          v25 = [v24 stringValue];
          v26 = IMNormalizeFormattedString();

          [v15 addObject:v26];
          ++v23;
        }

        while (v21 != v23);
        v21 = [v19 countByEnumeratingWithState:&v57 objects:v62 count:16];
      }

      while (v21);
    }

    v55 = 0u;
    v56 = 0u;
    v53 = 0u;
    v54 = 0u;
    v27 = [v18 emailAddresses];
    v28 = [v27 countByEnumeratingWithState:&v53 objects:v61 count:16];
    v11 = v45;
    if (v28)
    {
      v29 = v28;
      v30 = *v54;
      do
      {
        v31 = 0;
        do
        {
          if (*v54 != v30)
          {
            objc_enumerationMutation(v27);
          }

          v32 = [*(*(&v53 + 1) + 8 * v31) value];
          v33 = IMNormalizeFormattedString();

          [v16 addObject:v33];
          ++v31;
        }

        while (v29 != v31);
        v29 = [v27 countByEnumeratingWithState:&v53 objects:v61 count:16];
      }

      while (v29);
    }

    v13 = v43;
    v12 = v44;
    v14 = v42;
  }

  if (![v15 count] && !objc_msgSend(v16, "count"))
  {
    v34 = IMNormalizeFormattedString();
    IsEmail = IMStringIsEmail();

    if (IsEmail)
    {
      v36 = v16;
    }

    else
    {
      v36 = v15;
    }

    [v36 addObject:v12];
  }

  v37 = [(CKChatController *)self CKCloudSharingClass];
  v48[0] = MEMORY[0x1E69E9820];
  v48[1] = 3221225472;
  v48[2] = __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke;
  v48[3] = &unk_1E72EDC70;
  v49 = v13;
  v50 = v16;
  v51 = v15;
  v52 = v14;
  v38 = v14;
  v39 = v15;
  v40 = v16;
  v41 = v13;
  [(objc_class *)v37 addParticipantsToShare:v11 containerSetupInfo:v47 emailAddresses:v40 phoneNumbers:v39 completionHandler:v48];
}

void __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v16 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (!v7 || !v8)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_1();
    }
  }

  v11 = IMLogHandleForCategory();
  v12 = v11;
  if (v9)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_2();
    }

    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_3();
    }
  }

  else if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v13 = *(a1 + 32);
    v14 = 138412290;
    v15 = v13;
    _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Successfully added participant to share: %@", &v14, 0xCu);
  }

  (*(*(a1 + 56) + 16))();
}

- (void)_removeParticipant:(id)a3 fromShareBearURL:(id)a4 containerSetupInfo:(id)a5 completionHandler:(id)a6
{
  v53 = *MEMORY[0x1E69E9840];
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v15 = [MEMORY[0x1E69A7FD0] sharedInstance];
  v16 = [v15 fetchCNContactForHandleWithID:v10];

  if (v16)
  {
    v33 = self;
    v34 = v13;
    v35 = v12;
    v36 = v11;
    v49 = 0u;
    v50 = 0u;
    v47 = 0u;
    v48 = 0u;
    v17 = [v16 phoneNumbers];
    v18 = [v17 countByEnumeratingWithState:&v47 objects:v52 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v48;
      do
      {
        v21 = 0;
        do
        {
          if (*v48 != v20)
          {
            objc_enumerationMutation(v17);
          }

          v22 = [*(*(&v47 + 1) + 8 * v21) value];
          v23 = [v22 stringValue];
          v24 = IMNormalizeFormattedString();

          [v14 addObject:v24];
          ++v21;
        }

        while (v19 != v21);
        v19 = [v17 countByEnumeratingWithState:&v47 objects:v52 count:16];
      }

      while (v19);
    }

    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    v25 = [v16 emailAddresses];
    v26 = [v25 countByEnumeratingWithState:&v43 objects:v51 count:16];
    if (v26)
    {
      v27 = v26;
      v28 = *v44;
      do
      {
        v29 = 0;
        do
        {
          if (*v44 != v28)
          {
            objc_enumerationMutation(v25);
          }

          v30 = [*(*(&v43 + 1) + 8 * v29) value];
          v31 = IMNormalizeFormattedString();

          [v14 addObject:v31];
          ++v29;
        }

        while (v27 != v29);
        v27 = [v25 countByEnumeratingWithState:&v43 objects:v51 count:16];
      }

      while (v27);
    }

    v12 = v35;
    v11 = v36;
    self = v33;
    v13 = v34;
  }

  if (![v14 count])
  {
    [v14 addObject:v10];
  }

  v32 = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v37[0] = MEMORY[0x1E69E9820];
    v37[1] = 3221225472;
    v37[2] = __113__CKChatController_GroupCollaboration___removeParticipant_fromShareBearURL_containerSetupInfo_completionHandler___block_invoke;
    v37[3] = &unk_1E72F3D50;
    v42 = v13;
    v38 = v10;
    v39 = v14;
    v40 = self;
    v41 = v12;
    [(objc_class *)v32 ckMetadataFromShareURL:v11 containerSetupInfo:v41 completionHandler:v37];
  }
}

void __113__CKChatController_GroupCollaboration___removeParticipant_fromShareBearURL_containerSetupInfo_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v51 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = IMLogHandleForCategory();
  v8 = v7;
  if (!v5 || v6)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke_cold_1();
    }

    (*(*(a1 + 64) + 16))();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = *(a1 + 32);
      *buf = 138412290;
      v50 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Removing participant: %@ from share", buf, 0xCu);
    }

    v10 = [v5 share];
    [v10 participants];
    v43 = 0u;
    v44 = 0u;
    v45 = 0u;
    v11 = v46 = 0u;
    v36 = [v11 countByEnumeratingWithState:&v43 objects:v48 count:16];
    if (v36)
    {
      v12 = *v44;
      v35 = v5;
      v37 = v11;
      v38 = a1;
      v33 = *v44;
      v34 = v10;
      do
      {
        v13 = 0;
        do
        {
          if (*v44 != v12)
          {
            objc_enumerationMutation(v11);
          }

          v14 = *(*(&v43 + 1) + 8 * v13);
          v15 = [v14 userIdentity];
          v16 = [v15 lookupInfo];
          v17 = [v16 phoneNumber];
          v18 = v17;
          if (v17)
          {
            v19 = v17;
          }

          else
          {
            v20 = [v14 userIdentity];
            v21 = [v20 lookupInfo];
            v19 = [v21 emailAddress];
          }

          v41 = 0u;
          v42 = 0u;
          v39 = 0u;
          v40 = 0u;
          v22 = *(a1 + 40);
          v23 = [v22 countByEnumeratingWithState:&v39 objects:v47 count:16];
          if (v23)
          {
            v24 = v23;
            v25 = *v40;
            while (2)
            {
              for (i = 0; i != v24; ++i)
              {
                if (*v40 != v25)
                {
                  objc_enumerationMutation(v22);
                }

                v27 = *(*(&v39 + 1) + 8 * i);
                v28 = [v19 lowercaseString];
                v29 = [v27 lowercaseString];
                v30 = [v28 isEqualToString:v29];

                if (v30)
                {
                  v10 = v34;
                  [v34 removeParticipant:v14];

                  v11 = v37;
                  [*(v38 + 48) _updateShare:v34 containerSetupInfo:*(v38 + 56) completionHandler:*(v38 + 64)];
                  v6 = 0;
                  v5 = v35;
                  goto LABEL_30;
                }
              }

              v24 = [v22 countByEnumeratingWithState:&v39 objects:v47 count:16];
              if (v24)
              {
                continue;
              }

              break;
            }
          }

          ++v13;
          v11 = v37;
          a1 = v38;
          v12 = v33;
        }

        while (v13 != v36);
        v6 = 0;
        v5 = v35;
        v10 = v34;
        v36 = [v37 countByEnumeratingWithState:&v43 objects:v48 count:16];
      }

      while (v36);
    }

    v31 = IMLogHandleForCategory();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      v32 = *(a1 + 32);
      *buf = 138412290;
      v50 = v32;
      _os_log_impl(&dword_19020E000, v31, OS_LOG_TYPE_INFO, "Participant: %@ is already removed from the share", buf, 0xCu);
    }

    (*(*(a1 + 64) + 16))();
LABEL_30:
  }
}

- (void)_addParticipant:(id)a3 toShareURL:(id)a4 forChatGUID:(id)a5 completionHandler:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a6;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke;
  aBlock[3] = &unk_1E72F3D78;
  v13 = v12;
  v27 = v13;
  v14 = a5;
  v15 = _Block_copy(aBlock);
  v20[0] = MEMORY[0x1E69E9820];
  v20[1] = 3221225472;
  v20[2] = __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289;
  v20[3] = &unk_1E72F3DC8;
  v25 = 0;
  v21 = v10;
  v22 = v11;
  v23 = v13;
  v24 = v15;
  v16 = v15;
  v17 = v11;
  v18 = v10;
  v19 = v13;
  [(CKChatController *)self _collaborationMetadataForURL:v17 forChatGUID:v14 completionHandler:v20];
}

void __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = IMLogHandleForCategory();
  v8 = v7;
  if (!v5 || v6)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_cold_1();
    }

    v9 = *(*(a1 + 32) + 16);
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *v10 = 0;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Added to Collaboration", v10, 2u);
    }

    v9 = *(*(a1 + 32) + 16);
  }

  v9();
}

void __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289(uint64_t a1, void *a2)
{
  v20[1] = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (v3)
  {
    v4 = objc_alloc(MEMORY[0x1E695DFD8]);
    v20[0] = *(a1 + 32);
    v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
    v6 = [v4 initWithArray:v5];

    v7 = objc_alloc(MEMORY[0x1E69D37C0]);
    v8 = MEMORY[0x1E69E96A0];
    v9 = [v7 initWithTargetSerialQueue:MEMORY[0x1E69E96A0] synchronous:0];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_293;
    v13[3] = &unk_1E72F3DA0;
    v19 = *(a1 + 64);
    v14 = v9;
    v15 = v6;
    v16 = *(a1 + 40);
    v17 = v3;
    v18 = *(a1 + 56);
    v10 = v6;
    v11 = v9;
    dispatch_async(v8, v13);
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289_cold_1();
    }

    (*(*(a1 + 48) + 16))();
  }
}

uint64_t __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_293(uint64_t a1)
{
  v2 = *(a1 + 72);
  v3 = IMLogHandleForCategory();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_INFO);
  if (v2 == 1)
  {
    if (v4)
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Add Handshake: Using the URL to add participant", buf, 2u);
    }

    return [*(a1 + 32) addParticipantHandles:*(a1 + 40) withFileURL:*(a1 + 48) metadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }

  else
  {
    if (v4)
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Add Handshake: Using metadata to add participant", v6, 2u);
    }

    return [*(a1 + 32) addParticipantHandles:*(a1 + 40) withMetadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }
}

- (void)_removeParticipant:(id)a3 fromShareURL:(id)a4 forChatGUID:(id)a5 completionHandler:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke;
  v18[3] = &unk_1E72F3E18;
  v18[4] = self;
  v19 = v12;
  v21 = v11;
  v22 = v13;
  v23 = 0;
  v20 = v10;
  v14 = v11;
  v15 = v10;
  v16 = v13;
  v17 = v12;
  [(CKChatController *)self _highlightForShareURL:v14 completionHandler:v18];
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke(uint64_t a1, uint64_t a2)
{
  v42[1] = *MEMORY[0x1E69E9840];
  v3 = [*(a1 + 32) _attributionFromHighlight:a2 forChatGUID:*(a1 + 40)];
  v4 = [v3 uniqueIdentifier];
  v5 = [v3 collaborationMetadata];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_2;
  aBlock[3] = &unk_1E72F3DF0;
  v6 = v4;
  v38 = v6;
  v41 = *(a1 + 64);
  v39 = *(a1 + 48);
  v40 = *(a1 + 40);
  v7 = _Block_copy(aBlock);
  if (v5)
  {
    v8 = [v5 handleToIdentityMap];
    v9 = v8;
    if (v8)
    {
      v10 = [v8 objectForKeyedSubscript:*(a1 + 48)];
      v11 = v10;
      if (v10)
      {
        v12 = MEMORY[0x1E695DFD8];
        v42[0] = v10;
        v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v42 count:1];
        v14 = [v12 setWithArray:v13];

        v15 = objc_alloc(MEMORY[0x1E69D37C0]);
        v16 = MEMORY[0x1E69E96A0];
        v17 = [v15 initWithTargetSerialQueue:MEMORY[0x1E69E96A0] synchronous:0];
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_296;
        block[3] = &unk_1E72F3DA0;
        v36 = *(a1 + 72);
        v31 = v17;
        v32 = v14;
        v33 = *(a1 + 56);
        v34 = v5;
        v35 = v7;
        v18 = v14;
        v19 = v17;
        dispatch_async(v16, block);
      }

      else
      {
        v22 = IMLogHandleForCategory();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_1(v22, v23, v24, v25, v26, v27, v28, v29);
        }

        (*(*(a1 + 64) + 16))();
      }
    }

    else
    {
      v21 = IMLogHandleForCategory();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_2();
      }

      (*(*(a1 + 64) + 16))();
    }
  }

  else
  {
    v20 = IMLogHandleForCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_3();
    }

    (*(*(a1 + 64) + 16))();
  }
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_2(void *a1, void *a2, void *a3)
{
  v15 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v5 && !v6 && a1[4])
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = a1[5];
      v13 = 138412290;
      v14 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Removing %@ from Collaboration", &v13, 0xCu);
    }

    v10 = [MEMORY[0x1E69A5AF8] sharedRegistry];
    v11 = [v10 existingChatWithGUID:a1[6]];

    if (v11)
    {
      [v11 sendUpdatedCollaborationMetadata:v5 forMessageGUID:a1[4]];
    }

    (*(a1[7] + 16))();
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_2_cold_1();
    }

    (*(a1[7] + 16))();
  }
}

uint64_t __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_296(uint64_t a1)
{
  v2 = *(a1 + 72);
  v3 = IMLogHandleForCategory();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_INFO);
  if (v2 == 1)
  {
    if (v4)
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Remove Handshake: Using the URL to remove participant", buf, 2u);
    }

    return [*(a1 + 32) removeParticipantIdentities:*(a1 + 40) withFileURL:*(a1 + 48) metadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }

  else
  {
    if (v4)
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Remove Handshake: Using metadata to remove participant", v6, 2u);
    }

    return [*(a1 + 32) removeParticipantIdentities:*(a1 + 40) withMetadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }
}

- (Class)CKCloudSharingClass
{
  if (CKCloudSharingClass_onceToken != -1)
  {
    [CKChatController(GroupCollaboration) CKCloudSharingClass];
  }

  v3 = CKCloudSharingClass_CKCloudSharingClass;

  return v3;
}

uint64_t __59__CKChatController_GroupCollaboration__CKCloudSharingClass__block_invoke()
{
  result = MEMORY[0x193AF5EC0](@"CSCloudSharing", @"CloudSharing");
  CKCloudSharingClass_CKCloudSharingClass = result;
  return result;
}

- (void)_updateShare:(id)a3 containerSetupInfo:(id)a4 completionHandler:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __90__CKChatController_GroupCollaboration___updateShare_containerSetupInfo_completionHandler___block_invoke;
    v12[3] = &unk_1E72F3E40;
    v13 = v10;
    [(objc_class *)v11 updateShare:v8 containerSetupInfo:v9 completionHandler:v12];
  }
}

void __90__CKChatController_GroupCollaboration___updateShare_containerSetupInfo_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v21 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = v9;
  if (v8)
  {
    v11 = v9 == 0;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;
  v13 = IMLogHandleForCategory();
  v14 = v13;
  if (v12)
  {
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      LOWORD(v15) = 0;
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Successfully updated share", &v15, 2u);
    }
  }

  else if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    v15 = 138412802;
    v16 = v8;
    v17 = 2112;
    v18 = v7;
    v19 = 2112;
    v20 = v10;
    _os_log_error_impl(&dword_19020E000, v14, OS_LOG_TYPE_ERROR, "Error while updating CKShare: %@ for URL: %@ error: %@", &v15, 0x20u);
  }

  (*(*(a1 + 32) + 16))();
}

- (void)_highlightForShareURL:(id)a3 completionHandler:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = [MEMORY[0x1E69A5C78] sharedController];
  v15 = 0;
  v8 = [v7 collaborationHighlightForURL:v5 error:&v15];
  v9 = v15;

  if (v9)
  {
    v10 = 1;
  }

  else
  {
    v10 = v8 == 0;
  }

  if (v10)
  {
    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _highlightForShareURL:completionHandler:];
    }

    v6[2](v6, 0);
  }

  else
  {
    v12 = [MEMORY[0x1E69A5C78] sharedController];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __80__CKChatController_GroupCollaboration___highlightForShareURL_completionHandler___block_invoke;
    v13[3] = &unk_1E72F3E68;
    v14 = v6;
    [v12 fetchAttributionsForHighlight:v8 completionHandler:v13];
  }
}

- (id)_attributionFromHighlight:(id)a3 forChatGUID:(id)a4
{
  v30 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = [v5 attributions];
  v8 = [v7 count];

  if (v8)
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v9 = [v5 attributions];
    v10 = [v9 countByEnumeratingWithState:&v21 objects:v29 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v22;
LABEL_4:
      v13 = 0;
      while (1)
      {
        if (*v22 != v12)
        {
          objc_enumerationMutation(v9);
        }

        v14 = *(*(&v21 + 1) + 8 * v13);
        v15 = [v14 conversationIdentifier];
        v16 = [v15 isEqualToString:v6];

        if (v16)
        {
          break;
        }

        if (v11 == ++v13)
        {
          v11 = [v9 countByEnumeratingWithState:&v21 objects:v29 count:16];
          if (v11)
          {
            goto LABEL_4;
          }

          goto LABEL_10;
        }
      }

      v17 = v14;
      v18 = IMLogHandleForCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        *buf = 138412546;
        v26 = v17;
        v27 = 2112;
        v28 = v5;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Found matching attribution (%@) for highlight (%@)", buf, 0x16u);
      }

      if (v17)
      {
        goto LABEL_19;
      }
    }

    else
    {
LABEL_10:
    }

    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _attributionFromHighlight:forChatGUID:];
    }
  }

  else
  {
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _attributionFromHighlight:forChatGUID:];
    }
  }

  v17 = 0;
LABEL_19:

  return v17;
}

- (void)_collaborationMetadataForURL:(id)a3 forChatGUID:(id)a4 completionHandler:(id)a5
{
  v7 = a3;
  v8 = a4;
  v9 = a5;
  v10 = [MEMORY[0x1E69A5C78] sharedController];
  v22 = 0;
  v11 = [v10 collaborationHighlightForURL:v7 error:&v22];
  v12 = v22;

  if (v12 || !v11)
  {
    v13 = IMLogHandleForCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _highlightForShareURL:completionHandler:];
    }

    v9[2](v9, 0);
  }

  v14 = [MEMORY[0x1E69A5C78] sharedController];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke;
  v18[3] = &unk_1E72F3E90;
  v20 = v8;
  v21 = v9;
  v19 = v7;
  v15 = v8;
  v16 = v9;
  v17 = v7;
  [v14 fetchAttributionsForHighlight:v11 completionHandler:v18];
}

void __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke(void *a1, void *a2)
{
  v28 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = [v3 attributions];
  v5 = [v4 count];

  if (!v5)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke_cold_1();
    }

    (*(a1[6] + 16))();
  }

  v21 = 0u;
  v22 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = [v3 attributions];
  v8 = [v7 countByEnumeratingWithState:&v19 objects:v27 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v20;
LABEL_7:
    v11 = 0;
    while (1)
    {
      if (*v20 != v10)
      {
        objc_enumerationMutation(v7);
      }

      v12 = *(*(&v19 + 1) + 8 * v11);
      v13 = [v12 conversationIdentifier];
      v14 = [v13 isEqualToString:a1[5]];

      if (v14)
      {
        break;
      }

      if (v9 == ++v11)
      {
        v9 = [v7 countByEnumeratingWithState:&v19 objects:v27 count:16];
        if (v9)
        {
          goto LABEL_7;
        }

        goto LABEL_13;
      }
    }

    v15 = [v12 collaborationMetadata];
    v16 = IMLogHandleForCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = a1[4];
      *buf = 138412546;
      v24 = v15;
      v25 = 2112;
      v26 = v17;
      _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Found collaboration metadata (%@) for URL (%@)", buf, 0x16u);
    }

    if (v15)
    {
      goto LABEL_20;
    }
  }

  else
  {
LABEL_13:
  }

  v18 = IMLogHandleForCategory();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke_cold_2();
  }

  (*(a1[6] + 16))();
  v15 = 0;
LABEL_20:
  (*(a1[6] + 16))();
}

- (void)_isShareBearURL:(id)a3 completionHandler:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = MEMORY[0x1E69635C0];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke;
  v10[3] = &unk_1E72F3EB8;
  v11 = v5;
  v12 = v6;
  v8 = v6;
  v9 = v5;
  [v7 getAppLinkWithURL:v9 completionHandler:v10];
}

void __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke_cold_1();
    }
  }

  v9 = [v5 targetApplicationRecord];
  v10 = [v9 bundleIdentifier];

  LODWORD(v9) = [v10 isEqualToString:@"com.apple.CloudKit.ShareBear"];
  v11 = IMLogHandleForCategory();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v9)
  {
    if (v12)
    {
      v16 = 0;
      v13 = "ShareBear identifier: CloudKit or iCloud Drive app";
      v14 = &v16;
LABEL_11:
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, v13, v14, 2u);
    }
  }

  else if (v12)
  {
    v15 = 0;
    v13 = "Share URL is coming from a 3rd party app";
    v14 = &v15;
    goto LABEL_11;
  }

  (*(*(a1 + 40) + 16))(*(a1 + 40));
}

- (void)createCollaborationFailureAlertForNotice:(id)a3
{
  v4 = a3;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"FAILED_COLLABORATION_UPDATE_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  if (!v4)
  {
    v15 = 0;
    v12 = 0;
    v16 = 0;
    goto LABEL_16;
  }

  v7 = [v4 notice];
  v8 = [v7 metadata];
  v9 = [v8 contentTitle];

  v10 = [v4 notice];
  v11 = [v10 metadata];
  v12 = [v11 bundleIdentifier];

  v58 = 0;
  v13 = [MEMORY[0x1E6963620] bundleRecordWithBundleIdentifier:v12 allowPlaceholder:0 error:&v58];
  v14 = v13;
  if (!v58)
  {
    v17 = v6;
    v15 = [v13 localizedName];
    v18 = [v4 notice];
    v19 = [v18 metadata];
    v20 = [v19 type];

    if (v20 == 8)
    {
      v21 = @"FAILED_COLLABORATION_ADD_UPDATE_ALERT_MESSAGE";
    }

    else
    {
      v22 = [v4 notice];
      v23 = [v22 metadata];
      v24 = [v23 type];

      if (v24 != 9)
      {
        v16 = 0;
LABEL_14:
        v6 = v17;
        goto LABEL_15;
      }

      v21 = @"FAILED_COLLABORATION_REMOVE_UPDATE_ALERT_MESSAGE";
    }

    v25 = MEMORY[0x1E696AEC0];
    v26 = CKFrameworkBundle();
    v27 = [v26 localizedStringForKey:v21 value:&stru_1F04268F8 table:@"ChatKit"];
    v28 = [v25 stringWithFormat:v27, v9, v15];

    v29 = [MEMORY[0x1E69DC668] sharedApplication];
    v30 = [v29 userInterfaceLayoutDirection];

    if (v30 == 1)
    {
      v31 = @"\u200F";
    }

    else
    {
      v31 = @"\u200E";
    }

    v16 = [(__CFString *)v31 stringByAppendingString:v28];

    goto LABEL_14;
  }

  v15 = 0;
  v16 = 0;
LABEL_15:

LABEL_16:
  v32 = [CKAlertController alertControllerWithTitle:v6 message:v16 preferredStyle:1];
  v33 = 0x1E72E4000;
  v34 = self;
  if ([v15 length])
  {
    v35 = MEMORY[0x1E696AEC0];
    v36 = CKFrameworkBundle();
    [v36 localizedStringForKey:@"FAILED_COLLABORATION_OPEN_IN_APP" value:&stru_1F04268F8 table:@"ChatKit"];
    v37 = v32;
    v38 = v34;
    v39 = v16;
    v40 = v4;
    v41 = v12;
    v43 = v42 = v6;
    v44 = [v35 stringWithFormat:v43, v15];

    v6 = v42;
    v12 = v41;
    v4 = v40;
    v16 = v39;
    v34 = v38;
    v32 = v37;

    v45 = [MEMORY[0x1E69DC668] sharedApplication];
    v46 = [v45 userInterfaceLayoutDirection];

    v47 = v46 == 1;
    v33 = 0x1E72E4000uLL;
    if (v47)
    {
      v48 = @"\u200F";
    }

    else
    {
      v48 = @"\u200E";
    }

    v49 = [(__CFString *)v48 stringByAppendingString:v44];

    v55[0] = MEMORY[0x1E69E9820];
    v55[1] = 3221225472;
    v55[2] = __81__CKChatController_GroupCollaboration__createCollaborationFailureAlertForNotice___block_invoke;
    v55[3] = &unk_1E72EC710;
    v56 = v12;
    v57 = v34;
    v50 = [CKAlertAction actionWithTitle:v49 style:0 handler:v55];
    [v32 addAction:v50];
  }

  v51 = *(v33 + 1824);
  v52 = CKFrameworkBundle();
  v53 = [v52 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v54 = [v51 actionWithTitle:v53 style:0 handler:&__block_literal_global_323_0];
  [v32 addAction:v54];

  [v32 presentFromViewController:v34 animated:1 completion:0];
}

void __81__CKChatController_GroupCollaboration__createCollaborationFailureAlertForNotice___block_invoke(uint64_t a1)
{
  if ([*(a1 + 32) length])
  {
    v2 = [MEMORY[0x1E6963608] defaultWorkspace];
    [v2 openApplicationWithBundleID:*(a1 + 32)];
  }

  v3 = [*(a1 + 40) entryView];
  [v3 configureForDisplayMode:1];

  v4 = [*(a1 + 40) entryView];
  [v4 updateEntryView];
}

- (void)createCollaborationFailureAlertForFailedMetadataLoadWithFallback:(BOOL)a3 URL:(id)a4
{
  v4 = a3;
  v5 = a4;
  v6 = CKFrameworkBundle();
  v27 = [v6 localizedStringForKey:@"FAILED_COLLABORATION_METADATA_ALERT_MESSAGE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  v7 = [MEMORY[0x1E69A8288] sharedManager];
  v8 = [v7 appNameFromSharingURL:v5];
  if (v8)
  {
    v9 = MEMORY[0x1E696AEC0];
    v10 = CKFrameworkBundle();
    v11 = [v10 localizedStringForKey:@"FAILED_COLLABORATION_METADATA_ALERT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
    v12 = [MEMORY[0x1E69A8288] sharedManager];
    v13 = [v12 appNameFromSharingURL:v5];
    v14 = [v9 stringWithFormat:v11, v13];

    v15 = [MEMORY[0x1E69DC668] sharedApplication];
    v16 = [v15 userInterfaceLayoutDirection];

    if (v16 == 1)
    {
      v17 = @"\u200F";
    }

    else
    {
      v17 = @"\u200E";
    }

    v18 = [(__CFString *)v17 stringByAppendingString:v14];
  }

  else
  {
    v14 = CKFrameworkBundle();
    v18 = [v14 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
  }

  v19 = v18;

  if (v4)
  {
    v20 = CKFrameworkBundle();
    v21 = [v20 localizedStringForKey:@"FAILED_COLLABORATION_FALLBACK_SENDASCOPY" value:&stru_1F04268F8 table:@"ChatKit"];

    v22 = [v19 stringByAppendingString:v21];

    v19 = v22;
  }

  v23 = CKFrameworkBundle();
  v24 = [v23 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];

  v25 = [CKAlertController alertControllerWithTitle:v27 message:v19 preferredStyle:1];
  v29[0] = MEMORY[0x1E69E9820];
  v29[1] = 3221225472;
  v29[2] = __109__CKChatController_GroupCollaboration__createCollaborationFailureAlertForFailedMetadataLoadWithFallback_URL___block_invoke;
  v29[3] = &unk_1E72EBFE8;
  v29[4] = self;
  v26 = [CKAlertAction actionWithTitle:v24 style:0 handler:v29];
  [v25 addAction:v26];

  [v25 presentFromViewController:self animated:1 completion:0];
}

void __109__CKChatController_GroupCollaboration__createCollaborationFailureAlertForFailedMetadataLoadWithFallback_URL___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryView];
  [v2 configureForDisplayMode:1];

  v3 = [*(a1 + 32) entryView];
  [v3 updateEntryView];
}

- (void)presentReplaceCompositionAlertWithConfirmationBlock:(id)a3 cancelBlock:(id)a4
{
  v5 = a3;
  v6 = a4;
  v7 = CKFrameworkBundle();
  v8 = [v7 localizedStringForKey:@"SHELF_REPLACE_ITEM_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v9 = CKFrameworkBundle();
  v10 = [v9 localizedStringForKey:@"SHELF_REPLACE_ITEM" value:&stru_1F04268F8 table:@"ChatKit"];
  v11 = [CKAlertController alertControllerWithTitle:v8 message:v10 preferredStyle:1];

  v12 = CKFrameworkBundle();
  v13 = [v12 localizedStringForKey:@"SHELF_REPLACE_ITEM_OK_ACTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v23[0] = MEMORY[0x1E69E9820];
  v23[1] = 3221225472;
  v23[2] = __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke;
  v23[3] = &unk_1E72EC218;
  v24 = v5;
  v14 = v5;
  v15 = [CKAlertAction actionWithTitle:v13 style:0 handler:v23];
  [v11 addAction:v15];

  v16 = CKFrameworkBundle();
  v17 = [v16 localizedStringForKey:@"SHELF_REPLACE_ITEM_CANCEL_ACTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke_2;
  v21[3] = &unk_1E72EC218;
  v22 = v6;
  v18 = v6;
  v19 = [CKAlertAction actionWithTitle:v17 style:0 handler:v21];
  [v11 addAction:v19];

  [v11 presentFromViewController:self animated:1 completion:0];
}

uint64_t __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

uint64_t __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (BOOL)shouldShowTipsWithAlignment:(int64_t)a3
{
  if (!a3 && (-[CKChatController _anyTranscriptBannerIsVisible](self, "_anyTranscriptBannerIsVisible") || -[CKChatController _anySuggestionPresenterWantsToShowBanner](self, "_anySuggestionPresenterWantsToShowBanner")) || (-[CKChatController traitCollection](self, "traitCollection"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 verticalSizeClass], v4, v5 == 1))
  {
    v6 = 0;
  }

  else
  {
    objc_opt_class();
    v6 = objc_opt_isKindOfClass() ^ 1;
  }

  return v6 & 1;
}

- (void)determineIfSendMenuShouldElevateCheckInWithCompletion:(id)a3
{
  v4 = a3;
  if ([(CKChatController *)self _shouldCheckWithSafetyMonitor])
  {
    v5 = [(CKChatController *)self _recipientHandleID];
    if ([v5 length])
    {
      v6 = [MEMORY[0x1E69A8218] sharedCoordinator];
      v7[0] = MEMORY[0x1E69E9820];
      v7[1] = 3221225472;
      v7[2] = __89__CKChatController_SafetyMonitor__determineIfSendMenuShouldElevateCheckInWithCompletion___block_invoke;
      v7[3] = &unk_1E72ED1F0;
      v8 = v4;
      [v6 checkPreferredHandlesCacheForReceiverWith:v5 completion:v7];
    }
  }

  else
  {
    (*(v4 + 2))(v4, 0);
  }
}

void __89__CKChatController_SafetyMonitor__determineIfSendMenuShouldElevateCheckInWithCompletion___block_invoke(uint64_t a1, char a2)
{
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __89__CKChatController_SafetyMonitor__determineIfSendMenuShouldElevateCheckInWithCompletion___block_invoke_2;
  v3[3] = &unk_1E72ED478;
  v4 = *(a1 + 32);
  v5 = a2;
  dispatch_async(MEMORY[0x1E69E96A0], v3);
}

- (void)updateSendMenuShouldElevateCheckIn
{
  v2[0] = MEMORY[0x1E69E9820];
  v2[1] = 3221225472;
  v2[2] = __69__CKChatController_SafetyMonitor__updateSendMenuShouldElevateCheckIn__block_invoke;
  v2[3] = &unk_1E72EB9C8;
  v2[4] = self;
  [(CKChatController *)self determineIfSendMenuShouldElevateCheckInWithCompletion:v2];
}

void __69__CKChatController_SafetyMonitor__updateSendMenuShouldElevateCheckIn__block_invoke(uint64_t a1, uint64_t a2)
{
  v3 = [*(a1 + 32) conversation];
  [v3 setElevateCheckIn:a2];
}

- (void)showCheckInTips:(id)a3
{
  v4 = a3;
  if (CKIsRunningInMacCatalyst() || ![(CKChatController *)self _shouldCheckWithSafetyMonitor])
  {
    (*(v4 + 2))(v4, 0, 0);
  }

  else
  {
    v5 = [(CKChatController *)self _sendertHandleID];
    v11 = 0;
    v12 = &v11;
    v13 = 0x3032000000;
    v14 = __Block_byref_object_copy__45;
    v15 = __Block_byref_object_dispose__45;
    v16 = [(CKChatController *)self _recipientHandleID];
    if ([v5 length] && objc_msgSend(v12[5], "length"))
    {
      v6 = [MEMORY[0x1E69A8218] sharedCoordinator];
      v7 = v12[5];
      v8[0] = MEMORY[0x1E69E9820];
      v8[1] = 3221225472;
      v8[2] = __51__CKChatController_SafetyMonitor__showCheckInTips___block_invoke;
      v8[3] = &unk_1E72F4B80;
      v9 = v4;
      v10 = &v11;
      [v6 shouldShowTipKitSuggestionForInitiator:v5 andReceiver:v7 completion:v8];
    }

    _Block_object_dispose(&v11, 8);
  }
}

void __51__CKChatController_SafetyMonitor__showCheckInTips___block_invoke(uint64_t a1, char a2)
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __51__CKChatController_SafetyMonitor__showCheckInTips___block_invoke_2;
  block[3] = &unk_1E72F4B58;
  v4 = *(a1 + 32);
  v9 = a2;
  v5 = *(a1 + 40);
  v7 = v4;
  v8 = v5;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

- (BOOL)_shouldCheckWithSafetyMonitor
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isZelkovaEnabled];

  if (!v4)
  {
    return 0;
  }

  v5 = [(CKCoreChatController *)self conversation];
  v6 = [v5 isGroupConversation];

  if (v6)
  {
    return 0;
  }

  v8 = [(CKCoreChatController *)self conversation];
  v9 = [v8 sendingService];
  v10 = [v9 __ck_isSMS];

  return v10 ^ 1;
}

- (id)_recipientHandleID
{
  v19 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v2 = [(CKCoreChatController *)self conversation];
  v3 = [v2 recipients];

  v4 = [v3 countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = 0;
    v7 = *v15;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(v3);
        }

        v9 = *(*(&v14 + 1) + 8 * i);
        if (([v9 isMe] & 1) == 0)
        {
          v10 = [v9 defaultIMHandle];
          v11 = [v10 ID];
          v12 = [v11 im_stripCategoryLabel];

          v6 = v12;
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v5);
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (id)_sendertHandleID
{
  v2 = [(CKCoreChatController *)self conversation];
  v3 = [v2 senderIdentifier];
  v4 = [v3 im_stripCategoryLabel];

  return v4;
}

- (void)_kickPhotoKit
{
  if (CKIsRunningInMessages())
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __45__CKChatController_MediaInput___kickPhotoKit__block_invoke;
    block[3] = &unk_1E72EBA18;
    block[4] = self;
    if (_kickPhotoKit_onceToken != -1)
    {
      dispatch_once(&_kickPhotoKit_onceToken, block);
    }
  }
}

void __45__CKChatController_MediaInput___kickPhotoKit__block_invoke(uint64_t a1)
{
  v2 = dispatch_get_global_queue(17, 0);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __45__CKChatController_MediaInput___kickPhotoKit__block_invoke_2;
  block[3] = &unk_1E72EBA18;
  block[4] = *(a1 + 32);
  dispatch_async(v2, block);
}

void __45__CKChatController_MediaInput___kickPhotoKit__block_invoke_2(uint64_t a1)
{
  v2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v3 = [v2 isRedesignedDetailsViewEnabled];

  if (v3)
  {
    [MEMORY[0x1E69789A8] openPhotoLibraryWithWellKnownIdentifier:1 error:0];
  }

  else
  {
    [MEMORY[0x1E69789A8] sharedPhotoLibrary];
  }
  v4 = ;
  [v4 registerChangeObserver:*(a1 + 32)];
  [v4 unregisterChangeObserver:*(a1 + 32)];
}

- (void)showMediaPicker:(id)a3 animated:(BOOL)a4
{
  v5 = a3;
  [(CKChatController *)self setImagePickerController:v5];
  [(CKChatController *)self updateRaiseGesture];
  v6 = [(CKChatController *)self entryView];
  v7 = [v6 contentView];
  v8 = [v7 isActive];

  v9 = [v5 sourceType];
  if (!CKIsRunningInMessagesViewService())
  {
    if (v9 == 1)
    {
      v10 = +[CKUIBehavior sharedBehaviors];
      v11 = [v10 canPresentOverKeyboard];

      [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
      if (!v11)
      {
        goto LABEL_3;
      }
    }

    else
    {
      [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
    }

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke;
    aBlock[3] = &unk_1E72EC410;
    aBlock[4] = self;
    v12 = _Block_copy(aBlock);
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke_2;
    v16[3] = &unk_1E72EC438;
    v16[4] = self;
    v13 = _Block_copy(v16);
    v14 = +[CKAdaptivePresentationController sharedInstance];
    [v14 presentViewController:v5 fromViewController:self presentationHandler:v12 dismissalHandler:v13 animated:1 completion:0];

    goto LABEL_9;
  }

  [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
LABEL_3:
  v15.receiver = self;
  v15.super_class = CKChatController;
  [(CKChatController *)&v15 becomeFirstResponder];
  [(CKChatController *)self presentViewController:v5 animated:1 completion:0];
  [(CKChatController *)self setTargetFirstResponder:v8];
LABEL_9:
}

id __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v6 = [*(a1 + 32) view];
  [v6 frame];
  *a2 = v7;
  a2[1] = v8;
  a2[2] = v9;
  a2[3] = v10;

  result = [*(a1 + 32) view];
  *a3 = result;
  return result;
}

void __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) hideMediaPickerAnimated:0];
  v2 = [*(a1 + 32) entryView];
  v3 = [v2 contentView];
  v4 = [v3 isActive];

  if ((v4 & 1) == 0)
  {
    v5 = *(a1 + 32);

    [v5 becomeFirstResponder];
  }
}

- (void)hideMediaPickerAnimated:(BOOL)a3 completion:(id)a4
{
  v4 = a3;
  v6 = a4;
  v7 = [(CKChatController *)self imagePickerController];
  v8 = v7;
  if (v7)
  {
    v9 = [v7 sourceType];
    v10 = CKScrollViewHoldingScrollGeometryReasonTypeCameraOverlay;
    if (v9 != 1)
    {
      v10 = CKScrollViewHoldingScrollGeometryReasonTypePhotoLibraryOverlay;
    }

    v11 = *v10;
    v12 = [v8 presentingViewController];

    [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:v11];
    if (v12)
    {
      v17 = MEMORY[0x1E69E9820];
      v18 = 3221225472;
      v19 = __67__CKChatController_MediaInput__hideMediaPickerAnimated_completion___block_invoke;
      v20 = &unk_1E72EE5D8;
      v21 = self;
      v22 = v6;
      v13 = _Block_copy(&v17);
      v14 = [CKAdaptivePresentationController sharedInstance:v17];
      v15 = [v14 presentedViewController];

      if (v15 == v8)
      {
        +[CKAdaptivePresentationController sharedInstance];
      }

      else
      {
        [v8 presentingViewController];
      }
      v16 = ;
      [v16 dismissViewControllerAnimated:v4 completion:v13];
    }
  }

  [(CKChatController *)self endHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
  [(CKChatController *)self setImagePickerController:0];
  [(CKChatController *)self updateRaiseGesture];
}

void __67__CKChatController_MediaInput__hideMediaPickerAnimated_completion___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 40);
  if (v2)
  {
    (*(v2 + 16))();
  }

  v3 = [*(a1 + 32) entryView];
  v4 = [v3 contentView];
  v5 = [v4 isActive];

  if ((v5 & 1) == 0)
  {
    v6 = *(a1 + 32);

    [v6 becomeFirstResponder];
  }
}

- (id)makeThrowAnimationManagerForComposition:(id)a3
{
  v4 = MEMORY[0x1E69A8070];
  v5 = a3;
  v6 = [v4 sharedFeatureFlags];
  v7 = [v6 isSendAnimationRefreshEnabled];

  if (v7)
  {
    +[CKThrowAnimationManager glassThrowSendAnimationManager];
  }

  else
  {
    +[CKThrowAnimationManager nonGlassThrowSendAnimationManager];
  }
  v8 = ;
  [v8 setThrowManagerDelegate:self];
  [v8 setSendAnimationManagerDelegate:self];
  [v8 setSendAnimationBalloonProvider:self];
  v9 = [v5 isAudioComposition];

  if (v9)
  {
    [(CKChatController *)self configureThrowAnimationManagerForAudioSendAnimation:v8];
  }

  return v8;
}

- (void)configureThrowAnimationManagerForAudioSendAnimation:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self entryView];
  [v5 audioRecordingPillViewFrameInThrowViewCoordinates];
  v7 = v6;
  v9 = v8;
  v11 = v10;
  v13 = v12;

  [v4 setAudioMessageSourceRect:{v7, v9, v11, v13}];
  v14 = [(CKChatController *)self entryView];
  v15 = [v14 audioRecordingPillViewSnapshot];

  [v4 setAudioRecordingPillViewSnapshot:v15];
}

- (void)photoGridDisplayedChatItemChanged:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self photosGridViewController];
  if (v5)
  {
    v6 = [(CKChatController *)self photoGridMomentShareChatItem];

    if (v6)
    {
      v7 = [(CKChatController *)self _tapbackStatusManagerForChatItem:v4];
      [(CKChatController *)self setPhotoGridMomentShareChatItem:v4];
      v8 = [v5 viewModel];
      v12[0] = MEMORY[0x1E69E9820];
      v12[1] = 3221225472;
      v12[2] = __69__CKChatController_PhotosSupport__photoGridDisplayedChatItemChanged___block_invoke;
      v12[3] = &unk_1E72F6F78;
      v13 = v7;
      v9 = v7;
      [v8 performChanges:v12];
    }

    else
    {
      v10 = [(CKChatController *)self photoGridDataSourceManager];
      v11 = [v4 dataSource];
      [v10 setMediaObjectDataSource:v11];
    }
  }
}

void __69__CKChatController_PhotosSupport__photoGridDisplayedChatItemChanged___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (objc_opt_respondsToSelector())
  {
    [v3 setTapbackStatusManager:*(a1 + 32)];
  }
}

- (void)_presentGridForPendingMomentShareChatItem:(id)a3
{
  v4 = a3;
  v5 = [v4 momentShareURL];
  if (v5)
  {
    v6 = [MEMORY[0x1E69A5B50] sharedController];
    v7 = [v6 remoteDaemon];
    v8 = [v4 message];
    v9 = [v8 guid];
    v10 = [(CKCoreChatController *)self chat];
    v11 = [v10 guid];
    [v7 upgradeCompleteMyMomentLinkToStackWithMessageGUID:v9 chatGUID:v11];

    [(CKChatController *)self setMomentShareFetchGeneration:[(CKChatController *)self momentShareFetchGeneration]+ 1];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke;
    v13[3] = &unk_1E72F6FA0;
    v13[4] = self;
    v14 = v4;
    [(CKChatController *)self _gridViewNavigationControllerForMomentShareURL:v5 chatItem:v14 tapbackManager:0 completionHandler:v13];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) _presentGridForPendingMomentShareChatItem:];
    }
  }
}

void __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  if (v5)
  {
    [*(a1 + 32) _presentGridViewNavigationController:v5];
  }

  else if (a3 != 1)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke_cold_1(a1, a3);
    }
  }
}

- (void)_presentGridForChatItem:(id)a3 assetReference:(id)a4
{
  v6 = a3;
  v7 = a4;
  [(CKChatController *)self setPhotoGridMomentShareChatItem:0];
  [(CKChatController *)self setPhotoGridDataSourceManager:0];
  [(CKChatController *)self setPhotoGridDisplayedChatItemGUID:0];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke;
  v10[3] = &unk_1E72F6FC8;
  v10[4] = self;
  v11 = v6;
  v12 = v7;
  v8 = v7;
  v9 = v6;
  [(CKChatController *)self _gridViewNavigationControllerForChatItem:v9 assetReference:v8 completionHandler:v10];
}

void __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  if (v5)
  {
    [*(a1 + 32) _presentGridViewNavigationController:v5];
  }

  else if (a3 != 1)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke_cold_1(a1, a3);
    }
  }
}

- (void)_presentGridViewNavigationController:(id)a3
{
  v4 = a3;
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ShowingPhotoGridOverlay"];
  [(CKChatController *)self presentViewController:v4 animated:1 completion:&__block_literal_global_243];
}

- (void)_gridViewNavigationControllerForMomentShareURL:(id)a3 chatItem:(id)a4 tapbackManager:(id)a5 completionHandler:(id)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = a6;
  v14 = [(CKChatController *)self momentShareFetchGeneration];
  v15 = IMLogHandleForCategory();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController(PhotosSupport) _gridViewNavigationControllerForMomentShareURL:chatItem:tapbackManager:completionHandler:];
  }

  v16 = [(CKCoreChatController *)self chat];
  v17 = [v16 momentShareCache];

  v18 = [v10 absoluteString];
  v23[0] = MEMORY[0x1E69E9820];
  v23[1] = 3221225472;
  v23[2] = __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke;
  v23[3] = &unk_1E72F6FF0;
  v27 = v13;
  v28 = v14;
  v23[4] = self;
  v24 = v10;
  v25 = v11;
  v26 = v12;
  v19 = v12;
  v20 = v11;
  v21 = v10;
  v22 = v13;
  [v17 momentShareForURLString:v18 completionHandler:v23];
}

void __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v25 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = [*(a1 + 32) momentShareFetchGeneration];
  if (*(a1 + 72) != v7)
  {
    v14 = v7;
    v15 = IMLogHandleForCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = *(a1 + 72);
      *v22 = 134218240;
      *&v22[4] = v16;
      *&v22[12] = 2048;
      *&v22[14] = v14;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_DEFAULT, "Cancelled fetch with generation: %td, current: %td", v22, 0x16u);
    }

    v17 = *(*(a1 + 64) + 16);
    goto LABEL_20;
  }

  v8 = IMLogHandleForCategory();
  v9 = v8;
  if (!v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v20 = *(a1 + 40);
      v21 = *(a1 + 72);
      *v22 = 138412802;
      *&v22[4] = v20;
      *&v22[12] = 2048;
      *&v22[14] = v21;
      *&v22[22] = 2112;
      v23 = v6;
      _os_log_error_impl(&dword_19020E000, v9, OS_LOG_TYPE_ERROR, "Failed to fetch moment share for URL: %@, generation: %td, error: %@", v22, 0x20u);
    }

    IsPermanent = IMMomentShareCacheErrorIsPermanent();
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
    {
      __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_3(IsPermanent, v19);
    }

    v17 = *(*(a1 + 64) + 16);
LABEL_20:
    v17();
    goto LABEL_21;
  }

  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
  {
    __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_1();
  }

  v10 = v5;
  if ([v10 status] == 2)
  {
    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *v22 = 138412290;
      *&v22[4] = v10;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_DEFAULT, "Will accept moment share: %@", v22, 0xCu);
    }

    *v22 = MEMORY[0x1E69E9820];
    *&v22[8] = 3221225472;
    *&v22[16] = ___AcceptMomentShareIfNecessary_block_invoke;
    v23 = &unk_1E72EC088;
    v24 = v10;
    [v24 acceptMomentShareWithCompletion:v22];
  }

  v12 = IMLogHandleForCategory();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
  {
    __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_2();
  }

  v13 = [*(a1 + 32) _gridViewNavigationControllerForMomentShare:v10 chatItem:*(a1 + 48) tapbackManager:*(a1 + 56)];
  (*(*(a1 + 64) + 16))();

LABEL_21:
}

- (id)_gridViewNavigationControllerForMomentShare:(id)a3 chatItem:(id)a4 tapbackManager:(id)a5
{
  v8 = a4;
  v9 = a5;
  v10 = a3;
  if ([v10 status] == 1)
  {
    v11 = 3;
  }

  else
  {
    v11 = 2;
  }

  v12 = [objc_alloc(MEMORY[0x1E69C33A0]) initWithMomentShare:v10 activityType:v11 sourceType:1];

  v13 = objc_alloc_init(MEMORY[0x1E69C33A8]);
  if (objc_opt_respondsToSelector())
  {
    v14 = [v12 createSession];
    v15 = [CKCMMAssetActionManager assetActionManagerWithCMMSession:v14 chatItem:v8 presentedFromInlineReply:[(CKCoreChatController *)self isInline] chatActionHelper:self performerDelegate:self];
    v16 = objc_opt_class();
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke;
    v26[3] = &unk_1E72F7018;
    v26[4] = self;
    v27 = v9;
    v17 = [v13 workflowViewControllerWithSession:v14 embedInNavigationControllerOfClass:v16 assetActionManager:v15 assetCollectionActionManager:0 photosViewConfigurationBlock:v26];
  }

  else
  {
    v18 = objc_opt_class();
    v20 = MEMORY[0x1E69E9820];
    v21 = 3221225472;
    v22 = __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke_2;
    v23 = &unk_1E72F7018;
    v24 = self;
    v25 = v9;
    v17 = [v13 workflowViewControllerWithContext:v12 embedInNavigationControllerOfClass:v18 photosViewConfigurationBlock:&v20];
  }

  [v17 setModalPresentationStyle:{3, v20, v21, v22, v23, v24}];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [(CKChatController *)self _configureGridControllerForStackTransition:v17 chatItem:v8];
  }

  return v17;
}

void __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  _ApplyCommonGridConfiguration(v3, *(a1 + 32));
  [v3 setAllowsDragAndDrop:0];
  [v3 setAllowedBehaviors:{objc_msgSend(v3, "allowedBehaviors") | 0x200}];
  if ([*(a1 + 32) isInline])
  {
    [v3 setAllowedActions:{objc_msgSend(v3, "allowedActions") & 0xFFFFFFFFFFFEFFDFLL}];
  }

  [v3 setAllowedBehaviors:{objc_msgSend(v3, "allowedBehaviors") & 0xFFFFFFFFFFFFFFBFLL}];
  [v3 setTapbackStatusManager:*(a1 + 40)];
}

void __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  _ApplyCommonGridConfiguration(v4, v3);
  [v4 setAllowsDragAndDrop:0];
  [v4 setTapbackStatusManager:*(a1 + 40)];
}

- (void)_gridViewNavigationControllerForChatItem:(id)a3 assetReference:(id)a4 completionHandler:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  [(CKChatController *)self setMomentShareFetchGeneration:[(CKChatController *)self momentShareFetchGeneration]+ 1];
  v11 = [(CKChatController *)self _tapbackStatusManagerForChatItem:v8];
  v12 = [v8 momentShareURL];
  if (v12)
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __109__CKChatController_PhotosSupport___gridViewNavigationControllerForChatItem_assetReference_completionHandler___block_invoke;
    v15[3] = &unk_1E72F7040;
    v15[4] = self;
    v16 = v8;
    v17 = v9;
    v18 = v11;
    v19 = v10;
    [(CKChatController *)self _gridViewNavigationControllerForMomentShareURL:v12 chatItem:v16 tapbackManager:v18 completionHandler:v15];
  }

  else
  {
    v13 = IMLogHandleForCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController(PhotosSupport) _gridViewNavigationControllerForChatItem:assetReference:completionHandler:];
    }

    v14 = [(CKChatController *)self _regularGridViewNavigationControllerForChatItem:v8 assetReference:v9 tapbackManager:v11];
    (*(v10 + 2))(v10, v14, 0);
  }
}

void __109__CKChatController_PhotosSupport___gridViewNavigationControllerForChatItem_assetReference_completionHandler___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = v5;
  if (v5 || a3 != 3)
  {
    if (v5)
    {
      [*(a1 + 32) setPhotoGridMomentShareChatItem:*(a1 + 40)];
      v9 = *(a1 + 32);
      v10 = [*(a1 + 40) IMChatItem];
      v11 = [v10 guid];
      [v9 setPhotoGridDisplayedChatItemGUID:v11];
    }

    (*(*(a1 + 64) + 16))();
  }

  else
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      __109__CKChatController_PhotosSupport___gridViewNavigationControllerForChatItem_assetReference_completionHandler___block_invoke_cold_1();
    }

    v8 = [*(a1 + 32) _regularGridViewNavigationControllerForChatItem:*(a1 + 40) assetReference:*(a1 + 48) tapbackManager:*(a1 + 56)];
    (*(*(a1 + 64) + 16))();
  }
}

- (id)_regularGridViewNavigationControllerForChatItem:(id)a3 assetReference:(id)a4 tapbackManager:(id)a5
{
  v7 = a3;
  v8 = a5;
  v29 = [v7 dataSource];
  v9 = [[CKMediaObjectAssetDataSourceManager alloc] initWithDataSource:v29];
  v10 = [v7 IMChatItem];
  v11 = [v10 guid];
  [(CKChatController *)self setPhotoGridDisplayedChatItemGUID:v11];

  [(CKChatController *)self setPhotoGridDataSourceManager:v9];
  v12 = [objc_alloc(MEMORY[0x1E69C45C8]) initWithDataSourceManager:v9];
  v13 = [[CKMediaObjectAssetActionManager alloc] initWithChatItem:v7 presentedFromInlineReply:[(CKCoreChatController *)self isInline] chatActionHelper:self selectionManager:v12];
  v14 = objc_alloc(MEMORY[0x1E69A2908]);
  v15 = objc_alloc_init(CKMediaObjectImageProvider);
  v28 = v13;
  v16 = [v14 initWithDataSourceManager:v9 mediaProvider:v15 selectionManager:v12 assetActionManager:v13 assetCollectionActionManager:0];

  v17 = objc_alloc_init(CKImportStatusManager);
  [v16 setAssetImportStatusManager:v17];

  _ApplyCommonGridConfiguration(v16, self);
  [v16 setTapbackStatusManager:v8];

  [v16 setAllowedActions:{objc_msgSend(v16, "allowedActions") | 0x1A000}];
  [v16 setAllowedActions:{objc_msgSend(v16, "allowedActions") & 0xFFFFFFFFFFFFFB7FLL}];
  [v16 setAllowedBehaviors:{objc_msgSend(v16, "allowedBehaviors") | 0x80}];
  if (-[CKCoreChatController isInline](self, "isInline") || ([v7 message], v18 = objc_claimAutoreleasedReturnValue(), v19 = -[CKChatController _allowsMultipleSelectionForMessage:](self, "_allowsMultipleSelectionForMessage:", v18), v18, !v19))
  {
    [v16 setAllowedActions:{objc_msgSend(v16, "allowedActions") & 0xFFFFFFFFFFFFFFDFLL}];
  }

  [v16 setWantsTabBarHidden:1];
  [v16 setPrefersActionsInToolbar:1];
  v20 = [v7 message];
  if ([v20 isFromMe])
  {
    v21 = 0;
  }

  else
  {
    v22 = MEMORY[0x1E69A5C30];
    v23 = [v7 IMChatItem];
    v21 = [v22 photosSyndicationIdentifiersForMessage:v20 transcriptChatItem:v23];
  }

  v24 = [[CKPhotosGridFooterViewModel alloc] initAssetsDataSourceManager:v9 syndicationIdentifiers:v21];
  [v16 setFooterViewModel:v24];
  [v16 setFooterVisibilityStyle:2];
  v25 = [objc_alloc(MEMORY[0x1E69C38F8]) initWithConfiguration:v16];
  [v25 setCk_chatController:self];
  v26 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v25];
  [v26 setModalPresentationStyle:3];
  [(CKChatController *)self _configureGridControllerForStackTransition:v26 chatItem:v7];

  return v26;
}

- (BOOL)_allowsMultipleSelectionForMessage:(id)a3
{
  v3 = a3;
  v4 = [v3 scheduleType] != 2 || objc_msgSend(v3, "scheduleState") != 1;

  return v4;
}

- (void)_configureGridControllerForStackTransition:(id)a3 chatItem:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [(CKCoreChatController *)self collectionViewController];
  v9 = [v8 balloonViewForChatItem:v6];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = [v9 stackView];
  }

  else
  {
    v10 = 0;
  }

  v12 = v10;
  v11 = [v10 gridTransitioningDelegate];
  [v7 setTransitioningDelegate:v11];
}

- (void)_presentViewerForChatItem:(id)a3 assetReference:(id)a4
{
  v15 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [v7 asset];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ShowingPhotoGridOverlay"];
    v10 = [v6 dataSource];
    v11 = [(CKChatController *)self _previewViewControllerForAssetReference:v7 dataSource:v10 previewDelegate:self previewMode:2];

    [v11 setChatItem:v6];
    [(CKChatController *)self presentViewController:v11 animated:1 completion:0];
  }

  else if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = 136315138;
      v14 = "[CKChatController(PhotosSupport) _presentViewerForChatItem:assetReference:]";
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "%s got non-CKMediaObjectBackedAsset PXDisplayAsset!", &v13, 0xCu);
    }
  }
}

- (id)_tapbackStatusManagerForChatItem:(id)a3
{
  v4 = a3;
  v5 = objc_alloc_init(CKMediaObjectTapbackManager);
  [(CKMediaObjectTapbackManager *)v5 setChatItem:v4];

  v6 = [(CKChatController *)self view];
  [(CKMediaObjectTapbackManager *)v5 setGradientReferenceView:v6];

  [(CKMediaObjectTapbackManager *)v5 setOriginatedFromGridView:1];
  [(CKMediaObjectTapbackManager *)v5 setInvertTapbackTailDirection:1];
  [(CKMediaObjectTapbackManager *)v5 setPhotoGridTapbackPileDelegate:self];

  return v5;
}

- (void)presentedPreviewControllerDidSelectNavigateToGrid
{
  v13 = [(CKChatController *)self previewController];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = [(CKChatController *)self previewController];
    v4 = [v3 chatItem];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      v6 = [(CKChatController *)self previewController];
      v7 = [v6 chatItem];
      v8 = [v7 dataSource];
      v9 = [v6 currentPreviewItem];
      v10 = [v8 assetReferenceForMediaObject:v9];

      v14[0] = MEMORY[0x1E69E9820];
      v14[1] = 3221225472;
      v14[2] = __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke;
      v14[3] = &unk_1E72F6FC8;
      v14[4] = self;
      v15 = v7;
      v16 = v10;
      v11 = v10;
      v12 = v7;
      [(CKChatController *)self _gridViewNavigationControllerForChatItem:v12 assetReference:v11 completionHandler:v14];
    }
  }

  else
  {
  }
}

void __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  if (v5)
  {
    v6 = [*(a1 + 32) previewController];
    v7 = [v6 view];
    v8 = [v7 window];

    v9 = [v8 snapshotViewAfterScreenUpdates:0];
    v10 = [*(a1 + 32) view];
    [v8 bounds];
    [v10 convertRect:v8 fromCoordinateSpace:?];
    [v9 setFrame:?];

    v11 = [*(a1 + 32) view];
    [v11 addSubview:v9];

    [*(a1 + 32) setIsTransitioningFromQLPreviewToGrid:1];
    v12 = [*(a1 + 32) previewController];
    [v12 dismissViewControllerAnimated:0 completion:0];

    v13 = *(a1 + 32);
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_2;
    v15[3] = &unk_1E72EB8D0;
    v15[4] = v13;
    v16 = v9;
    v14 = v9;
    [v13 presentViewController:v5 animated:1 completion:v15];

LABEL_6:
    goto LABEL_7;
  }

  if (a3 != 1)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_cold_1(a1, a3);
    }

    goto LABEL_6;
  }

LABEL_7:
}

uint64_t __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) setIsTransitioningFromQLPreviewToGrid:0];
  v2 = *(a1 + 40);

  return [v2 removeFromSuperview];
}

- (void)presentedPreviewControllerDidSelectDismissToGrid
{
  v2 = [(CKChatController *)self previewController];
  [v2 dismissViewControllerAnimated:1 completion:0];
}

- (id)_previewViewControllerForAssetReference:(id)a3 photosViewController:(id)a4 previewMode:(int64_t)a5
{
  v8 = a4;
  v9 = a3;
  v10 = [v8 viewModel];
  v11 = [v10 currentDataSource];

  v12 = [(CKChatController *)self _previewViewControllerForAssetReference:v9 dataSource:v11 previewDelegate:v8 previewMode:a5];

  return v12;
}

- (id)_previewViewControllerForAssetReference:(id)a3 dataSource:(id)a4 previewDelegate:(id)a5 previewMode:(int64_t)a6
{
  v10 = a3;
  v11 = a4;
  v12 = a5;
  v13 = objc_alloc_init(CKQLPreviewController);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [(CKQLPreviewController *)v13 setChatControllerPreviewDelegate:self];
  }

  [(QLPreviewController *)v13 setDelegate:v12];
  v14 = objc_alloc_init(CKQLPreviewControllerDataSource);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = [v11 mediaObjects];
    [(CKQLPreviewControllerDataSource *)v14 setPreviewItems:v15];

    [(QLPreviewController *)v13 setDataSource:v14];
    [(CKChatController *)self setQlPreviewDataSource:v14];
    if (v10)
    {
      [v10 indexPath];
      v16 = v28;
    }

    else
    {
      v16 = 0;
      v27[1] = 0u;
      v28 = 0u;
    }

    [(QLPreviewController *)v13 setCurrentPreviewItemIndex:v16];
    [(CKChatController *)self setPreviewController:v13];
    v19 = [(CKChatController *)self entryView];
    v20 = [v19 contentView];
    -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [v20 isActive]);

    if (![(CKChatController *)self photosGridViewPresented])
    {
      v27[0].receiver = self;
      v27[0].super_class = CKChatController;
      [(objc_super *)v27 becomeFirstResponder];
    }

    v21 = objc_alloc(MEMORY[0x1E69DC708]);
    v22 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"square.grid.2x2"];
    v23 = &selRef_presentedPreviewControllerDidSelectNavigateToGrid;
    if (a6 != 2)
    {
      v23 = &selRef_presentedPreviewControllerDidSelectDismissToGrid;
    }

    v24 = [v21 initWithImage:v22 style:0 target:self action:*v23];

    v25 = [(CKQLPreviewController *)v13 navigationItem];
    [v25 setLeftBarButtonItem:v24];

    v18 = v13;
  }

  else
  {
    v17 = IMLogHandleForCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) _previewViewControllerForAssetReference:dataSource:previewDelegate:previewMode:];
    }

    v18 = 0;
  }

  return v18;
}

- (void)_presentPreviewViewControllerFromPhotosViewController:(id)a3 assetReference:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self _previewViewControllerForAssetReference:v7 photosViewController:v6 previewMode:0];
  if (v8)
  {
    [v6 presentViewController:v8 animated:1 completion:0];
  }

  else
  {
    v9 = IMLogHandleForCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) _presentPreviewViewControllerFromPhotosViewController:assetReference:];
    }
  }
}

- (BOOL)photosViewController:(id)a3 didPickAssetReference:(id)a4
{
  v6 = a3;
  v7 = a4;
  [(CKChatController *)self _presentPreviewViewControllerFromPhotosViewController:v6 assetReference:v7];

  return 1;
}

- (void)_showTapbackReplyOverlayFromPhotosViewController:(id)a3 assetReference:(id)a4 presentTapbackKeyboardInput:(BOOL)a5
{
  v5 = a5;
  v8 = a4;
  v9 = a3;
  v10 = [v9 regionOfInterestForAssetReference:v8 image:0 shouldSnapshotPlaceholder:0];
  v11 = [v9 view];

  [v10 rectInCoordinateSpace:v11];
  v13 = v12;
  v15 = v14;
  v17 = v16;
  v19 = v18;

  v20 = [v10 placeholderViewFactory];

  if (v20)
  {
    v21 = [v10 placeholderViewFactory];
    v20 = (v21)[2](v21, v10);
  }

  [(CKChatController *)self setPhotoGridTapbackSnapshotRect:v13, v15, v17, v19];
  v22 = [(CKChatController *)self photoGridMomentShareChatItem];

  if (v22)
  {
    v23 = [(CKChatController *)self photoGridMomentShareChatItem];
    v24 = [v23 dataSource];
    v25 = [v24 chatItemForAssetReference:v8];

    if (v25)
    {
      goto LABEL_8;
    }

    v26 = [(CKChatController *)self photoGridMomentShareChatItem];
    v27 = [v26 dataSource];
    v25 = [v27 temporaryChatItemForAssetReference:v8];
  }

  else
  {
    v26 = [v8 asset];
    v25 = [v26 chatItem];
  }

LABEL_8:
  v28 = [(CKChatController *)self _fullScreenBalloonViewControllerForPhotosGridViewWithChatItem:v25 snapshotView:v20 presentTapbackKeyboardInput:v5];
  [(CKCoreChatController *)self setFullScreenBalloonViewController:v28];
  v29 = IMLogHandleForCategory();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
  {
    *v31 = 0;
    _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_DEFAULT, "_fullScreenBalloonViewController has been set", v31, 2u);
  }

  [v28 setModalPresentationStyle:6];
  v30 = [(CKChatController *)self presentedViewController];
  [v30 presentViewController:v28 animated:0 completion:0];
}

- (void)photosViewController:(id)a3 didDoubleTapAssetReference:(id)a4
{
  v7 = a3;
  v6 = a4;
  if ([(CKCoreChatController *)self _shouldAllowReply])
  {
    [(CKChatController *)self _showTapbackReplyOverlayFromPhotosViewController:v7 assetReference:v6 presentTapbackKeyboardInput:0];
  }
}

- (id)photosViewController:(id)a3 dragItemProviderForAssetReference:(id)a4
{
  v4 = [a4 asset];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = [v4 chatItem];
    v6 = [v5 dragItemProvider];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)actionManager:(id)a3 presentInlineReplyControllerForChatItem:(id)a4
{
  v6 = [(CKChatController *)self modalInlineReplyControllerForChatItem:a4];
  v5 = [(CKChatController *)self photosGridViewController];
  if (v5 && v6)
  {
    [v5 presentViewController:v6 animated:1 completion:0];
  }
}

- (void)retractScheduledChatItem:(id)a3
{
  v4 = a3;
  v5 = [v4 IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v7 = [(CKCoreChatController *)self conversation];
    v8 = [v4 IMChatItem];
    [v7 retractMessagePart:v8];
  }

  else
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) retractScheduledChatItem:];
    }
  }
}

- (void)retractScheduledChatItems:(id)a3 fromAggregateChatItem:(id)a4
{
  v33 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [v7 IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v23 = self;
    v24 = v7;
    v10 = [MEMORY[0x1E695DF70] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v25 = v6;
    v11 = v6;
    v12 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
    if (v12)
    {
      v13 = v12;
      v14 = *v29;
      do
      {
        for (i = 0; i != v13; ++i)
        {
          if (*v29 != v14)
          {
            objc_enumerationMutation(v11);
          }

          v16 = *(*(&v28 + 1) + 8 * i);
          v17 = [v16 IMChatItem];
          objc_opt_class();
          v18 = objc_opt_isKindOfClass();

          if (v18)
          {
            v19 = [v16 IMChatItem];
            [v10 addObject:v19];
          }

          else
          {
            v19 = IMLogHandleForCategory();
            if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
            {
              [(CKChatController(PhotosSupport) *)&buf retractScheduledChatItems:v27 fromAggregateChatItem:v19];
            }
          }
        }

        v13 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
      }

      while (v13);
    }

    v20 = [(CKCoreChatController *)v23 conversation];
    v7 = v24;
    v21 = [v24 IMChatItem];
    if (v21 && [v10 count])
    {
      [v20 retractScheduledMessageParts:v10 fromAggregateChatItem:v21];
    }

    else
    {
      v22 = IMLogHandleForCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(PhotosSupport) retractScheduledChatItems:fromAggregateChatItem:];
      }
    }

    v6 = v25;
  }

  else
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) retractScheduledChatItems:fromAggregateChatItem:];
    }
  }
}

- (void)deleteMediaObjectAttachmentGUIDs:(id)a3 originalStackCount:(int64_t)a4
{
  v12 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = IMLogHandleForCategory();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v10 = 138412290;
    v11 = v6;
    _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_DEFAULT, "deleting media object attachments %@", &v10, 0xCu);
  }

  v8 = [(CKCoreChatController *)self chat];
  [v8 deleteTransfers:v6];

  v9 = a4 - [v6 count];
  if (v9 <= [MEMORY[0x1E69A5BF8] _attachmentStackAggregationThreshold])
  {
    [(CKChatController *)self dismissViewControllerAnimated:1 completion:0];
  }
}

- (id)_assetReferenceForDisplayedGridChatItem:(id)a3 selectionSnapshot:(id)a4
{
  v22 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self photosGridViewController];
  v9 = [v8 viewModel];
  v10 = [v9 currentDataSource];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = v10;
    v12 = [v6 mediaObject];
    v13 = [v11 assetReferenceForMediaObject:v12];
    if (!v13)
    {
      v14 = IMLogHandleForCategory();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(PhotosSupport) _assetReferenceForDisplayedGridChatItem:v12 selectionSnapshot:?];
      }
    }
  }

  else
  {
    v15 = [(CKChatController *)self photoGridMomentShareChatItem];
    if (v15 && (v16 = v15, objc_opt_class(), isKindOfClass = objc_opt_isKindOfClass(), v16, (isKindOfClass & 1) != 0))
    {
      if (v7)
      {
        [v7 cursorIndexPath];
      }

      else
      {
        v20 = 0u;
        v21 = 0u;
      }

      v13 = [v10 assetReferenceAtItemIndexPath:&v20];
      if (v13)
      {
        goto LABEL_15;
      }

      v11 = IMLogHandleForCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        if (v7)
        {
          [v7 cursorIndexPath];
        }

        else
        {
          v20 = 0u;
          v21 = 0u;
        }

        v19 = PXSimpleIndexPathDescription();
        LODWORD(v20) = 138543362;
        *(&v20 + 4) = v19;
        _os_log_error_impl(&dword_19020E000, v11, OS_LOG_TYPE_ERROR, "nil asset reference for data source at index path %{public}@", &v20, 0xCu);
      }
    }

    else
    {
      v11 = IMLogHandleForCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(PhotosSupport) _assetReferenceForDisplayedGridChatItem:selectionSnapshot:];
      }
    }

    v13 = 0;
  }

LABEL_15:

  return v13;
}

- (void)actionManager:(id)a3 quickLookChatItem:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [(CKChatController *)self photosGridViewController];
  v9 = [v7 selectionManager];

  v10 = [v9 selectionSnapshot];
  v11 = [(CKChatController *)self _assetReferenceForDisplayedGridChatItem:v6 selectionSnapshot:v10];

  if (v11)
  {
    [(CKChatController *)self _presentPreviewViewControllerFromPhotosViewController:v8 assetReference:v11];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) actionManager:quickLookChatItem:];
    }
  }
}

- (void)actionManager:(id)a3 tapbackChatItem:(id)a4
{
  v6 = a4;
  v7 = a3;
  v8 = [(CKChatController *)self photosGridViewController];
  v9 = [v7 selectionManager];

  v10 = [v9 selectionSnapshot];
  v11 = [(CKChatController *)self _assetReferenceForDisplayedGridChatItem:v6 selectionSnapshot:v10];

  if (v11)
  {
    [(CKChatController *)self _showTapbackReplyOverlayFromPhotosViewController:v8 assetReference:v11 presentTapbackKeyboardInput:0];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) actionManager:tapbackChatItem:];
    }
  }
}

- (id)actionManager:(id)a3 tapbackElementsForChatItem:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self photosGridViewController];
  v9 = [v6 selectionManager];
  v10 = [v9 selectionSnapshot];
  v11 = [(CKChatController *)self _assetReferenceForDisplayedGridChatItem:v7 selectionSnapshot:v10];

  objc_initWeak(location, self);
  if (v11)
  {
    v25[0] = MEMORY[0x1E69E9820];
    v25[1] = 3221225472;
    v25[2] = __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke;
    v25[3] = &unk_1E72F7068;
    objc_copyWeak(&v26, location);
    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_2;
    v21[3] = &unk_1E72F7090;
    objc_copyWeak(&v24, location);
    v12 = v8;
    v22 = v12;
    v13 = v11;
    v23 = v13;
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_3;
    v17[3] = &unk_1E72F7090;
    objc_copyWeak(&v20, location);
    v18 = v12;
    v19 = v13;
    v14 = [(CKChatController *)self buildTapbackMenuElementsForChatItem:v7 sendHandler:v25 emojiKeyboardHandler:v21 detailsHandler:v17];

    objc_destroyWeak(&v20);
    objc_destroyWeak(&v24);
    objc_destroyWeak(&v26);
  }

  else
  {
    v15 = IMLogHandleForCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) actionManager:tapbackChatItem:];
    }

    v14 = MEMORY[0x1E695E0F0];
  }

  objc_destroyWeak(location);

  return v14;
}

void __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v7 = a3;
  v8 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained sendTapback:v8 chatItem:v7 isRemoval:a4];
}

void __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained _showTapbackReplyOverlayFromPhotosViewController:*(a1 + 32) assetReference:*(a1 + 40) presentTapbackKeyboardInput:1];
}

void __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained _showTapbackReplyOverlayFromPhotosViewController:*(a1 + 32) assetReference:*(a1 + 40) presentTapbackKeyboardInput:0];
}

- (void)actionManager:(id)a3 copyChatItems:(id)a4
{
  v5 = a4;
  v6 = [(CKCoreChatController *)self collectionViewController];
  [v6 copyChatItemsToPasteboard:v5];
}

- (void)actionManager:(id)a3 forwardChatItems:(id)a4
{
  v5 = a4;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self dismissViewControllerAnimated:0 completion:0];
  }

  v6 = [(CKChatController *)self entryView];
  v7 = [v6 shouldShowSubject];
  v8 = [(CKChatController *)self chatInputTranscriptIdentifier];
  v10 = [CKComposition compositionForMessageParts:v5 preserveSubject:v7 contextIdentifier:v8];

  v9 = [(CKCoreChatController *)self delegate];
  [v9 chatController:self forwardComposition:v10];
}

- (void)selectAllForActionManager:(id)a3
{
  v4 = a3;
  v5 = [(CKChatController *)self photosGridViewController];
  v6 = [v5 viewModel];
  v9 = 0;
  v10 = &v9;
  v11 = 0x2020000000;
  v12 = [v6 isInSelectMode];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __61__CKChatController_PhotosSupport__selectAllForActionManager___block_invoke;
  v8[3] = &unk_1E72F70B8;
  v8[4] = &v9;
  [v6 performChanges:v8];
  if ((v10[3] & 1) == 0)
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) selectAllForActionManager:];
    }
  }

  _Block_object_dispose(&v9, 8);
}

void __61__CKChatController_PhotosSupport__selectAllForActionManager___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = v3;
  v6 = v3;
  if ((*(*(*(a1 + 32) + 8) + 24) & 1) == 0)
  {
    v5 = [v3 canEnterSelectMode];
    v4 = v6;
    if (v5)
    {
      [v6 setIsInSelectMode:1];
      v4 = v6;
      *(*(*(a1 + 32) + 8) + 24) = 1;
    }
  }

  if (*(*(*(a1 + 32) + 8) + 24) == 1)
  {
    [v4 selectAll];
    v4 = v6;
  }
}

- (BOOL)actionPerformer:(id)a3 transitionToViewController:(id)a4 transitionType:(int64_t)a5
{
  v8 = a3;
  v9 = a4;
  if (a5 == 1)
  {
    v12 = [(CKChatController *)self presentedViewController];
    v10 = [v12 navigationController];

    v11 = v10 != 0;
    if (v10)
    {
      v11 = 1;
      [v10 pushViewController:v9 animated:1];
    }
  }

  else
  {
    if (a5 != 2)
    {
      v11 = 0;
      goto LABEL_8;
    }

    v10 = [(CKChatController *)self presentedViewController];
    v11 = 1;
    [v10 presentViewController:v9 animated:1 completion:0];
  }

LABEL_8:
  return v11;
}

- (BOOL)photosGridViewPresented
{
  v2 = [(CKChatController *)self photosGridViewController];
  v3 = v2 != 0;

  return v3;
}

- (id)photosGridViewController
{
  v17 = *MEMORY[0x1E69E9840];
  v3 = [(CKChatController *)self presentedViewController];
  if (v3)
  {
    v4 = [(CKChatController *)self presentedViewController];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      v14 = 0u;
      v15 = 0u;
      v12 = 0u;
      v13 = 0u;
      v6 = [(CKChatController *)self presentedViewController];
      v7 = [v6 viewControllers];

      v3 = [v7 countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (v3)
      {
        v8 = *v13;
        while (2)
        {
          for (i = 0; i != v3; i = i + 1)
          {
            if (*v13 != v8)
            {
              objc_enumerationMutation(v7);
            }

            v10 = *(*(&v12 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v3 = v10;
              goto LABEL_14;
            }
          }

          v3 = [v7 countByEnumeratingWithState:&v12 objects:v16 count:16];
          if (v3)
          {
            continue;
          }

          break;
        }
      }

LABEL_14:
    }

    else
    {
      v3 = 0;
    }
  }

  return v3;
}

- (id)_fullScreenBalloonViewControllerForPhotosGridViewWithChatItem:(id)a3 snapshotView:(id)a4 presentTapbackKeyboardInput:(BOOL)a5
{
  v5 = a5;
  v8 = a4;
  v9 = a3;
  if (v5)
  {
    +[CKFullScreenBalloonViewDisplayConfiguration tapbackKeyboardInputContext];
  }

  else
  {
    +[CKFullScreenBalloonViewDisplayConfiguration tapbackPickerContext];
  }
  v10 = ;
  [v10 setShouldHideBalloonTail:1];
  [v10 setSnapshotView:v8];

  v11 = [CKFullScreenBalloonViewControllerPhone alloc];
  v12 = [(CKChatController *)self _interfaceActionsForChatItem:v9];
  v13 = [(CKFullScreenBalloonViewControllerPhone *)v11 initWithChatItem:v9 interfaceActions:v12 displayConfiguration:v10 delegate:self];

  return v13;
}

- (id)currentTopChatItemForAggregateChatItem:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self collectionViewController];
  v6 = [v5 balloonViewForChatItem:v4];

  objc_opt_class();
  v7 = v4;
  if (objc_opt_isKindOfClass())
  {
    v8 = [v6 stackView];
    v9 = [v8 currentAssetReference];
    v10 = [v9 asset];
    v7 = [v10 chatItem];
  }

  return v7;
}

- (void)photosGridFullScreenBalloonViewControllerHandleDismissTap:(id)a3
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 fullScreenBalloonViewControllerHandleDismissTap:a3];
}

- (void)photosGridFullScreenBalloonViewController:(id)a3 verticallyScrollTranscriptByAmount:(double)a4 animated:(BOOL)a5 duration:(double)a6 completion:(id)a7
{
  if (a7)
  {
    (*(a7 + 2))(a7, a4, a6);
  }
}

- (void)photosGridFullScreenBalloonViewController:(id)a3 replyButtonPressedForChatItem:(id)a4
{
  v6 = a3;
  v7 = a4;
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __107__CKChatController_PhotosSupport__photosGridFullScreenBalloonViewController_replyButtonPressedForChatItem___block_invoke;
  v10[3] = &unk_1E72EB880;
  v10[4] = self;
  v11 = v7;
  v12 = v6;
  v8 = v6;
  v9 = v7;
  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v10];
}

- (BOOL)photosGridFullScreenBalloonViewControllerShouldShowReplyButton:(id)a3
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  return [(CKCoreChatController *)&v4 fullScreenBalloonViewControllerShouldShowReplyButton:a3];
}

- (CGRect)photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)a3
{
  v3 = [(CKChatController *)self presentedViewController];
  v4 = [v3 safeAreaLayoutGuide];
  [v4 layoutFrame];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  v12 = v11;

  v13 = v6;
  v14 = v8;
  v15 = v10;
  v16 = v12;
  result.size.height = v16;
  result.size.width = v15;
  result.origin.y = v14;
  result.origin.x = v13;
  return result;
}

- (id)photosViewController:(id)a3 configurationForContextMenuInteraction:(id)a4 assetReference:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = v8;
  objc_initWeak(&location, self);
  v12 = MEMORY[0x1E69DC8D8];
  v23[0] = MEMORY[0x1E69E9820];
  v23[1] = 3221225472;
  v23[2] = __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke;
  v23[3] = &unk_1E72F70E0;
  objc_copyWeak(&v26, &location);
  v13 = v10;
  v24 = v13;
  v14 = v11;
  v25 = v14;
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke_2;
  v19[3] = &unk_1E72F7108;
  objc_copyWeak(&v22, &location);
  v15 = v13;
  v20 = v15;
  v16 = v14;
  v21 = v16;
  v17 = [v12 configurationWithIdentifier:0 previewProvider:v23 actionProvider:v19];

  objc_destroyWeak(&v22);
  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);

  return v17;
}

id __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained _previewViewControllerForAssetReference:*(a1 + 32) photosViewController:*(a1 + 40) previewMode:1];

  return v3;
}

id __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke_2(id *a1)
{
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (!WeakRetained)
  {
    goto LABEL_5;
  }

  v3 = [a1[4] asset];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = [a1[4] asset];
    v5 = [(CKMediaObjectAssetActionManager *)v4 chatItem];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = [a1[5] viewModel];
      v7 = [v6 isInSelectMode];

      if (v7)
      {
LABEL_5:
        v8 = 0;
        goto LABEL_11;
      }

      v9 = [a1[4] asset];
      v3 = [v9 chatItem];

      v4 = -[CKMediaObjectAssetActionManager initWithChatItem:presentedFromInlineReply:chatActionHelper:selectionManager:]([CKMediaObjectAssetActionManager alloc], "initWithChatItem:presentedFromInlineReply:chatActionHelper:selectionManager:", v3, [WeakRetained isInline], WeakRetained, 0);
      [WeakRetained setPhotoGridClickyOrbChatItem:v3];
      [(PXActionManager *)v4 setPerformerDelegate:WeakRetained];
      v8 = [(CKMediaObjectAssetActionManager *)v4 actionContextMenu];
    }

    else
    {

      v8 = 0;
    }
  }

  else
  {
    v8 = 0;
  }

LABEL_11:

  return v8;
}

- (void)photosViewController:(id)a3 commitPreviewViewControllerForContextMenuInteraction:(id)a4
{
  v6 = a3;
  v5 = [(CKChatController *)self previewController];
  if (v5)
  {
    [v6 presentViewController:v5 animated:0 completion:0];
  }
}

- (id)photosViewController:(id)a3 accessoriesForContextMenuInteraction:(id)a4 assetReference:(id)a5
{
  v7 = a3;
  v8 = a5;
  v9 = [v8 asset];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) != 0 && ([v8 asset], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v11, "chatItem"), v12 = objc_claimAutoreleasedReturnValue(), v11, v12))
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v13 = v7;
    }

    else
    {
      v13 = self;
    }

    v14 = [(CKChatController *)self contextMenuAccessoryViewsForChatItem:v12 containingViewController:v13];
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)photosViewController:(id)a3 contextMenuInteraction:(id)a4 willEndForConfiguration:(id)a5 animator:(id)a6
{
  if ([(CKChatController *)self acknowledgmentToSend:a3])
  {
    v7 = [(CKCoreChatController *)self chat];
    v8 = [(CKChatController *)self acknowledgmentToSend];
    v9 = [(CKChatController *)self photoGridClickyOrbChatItem];
    [v7 sendMessageAcknowledgment:v8 forChatItem:v9];

    [(CKChatController *)self setAcknowledgmentToSend:0];
  }

  [(CKChatController *)self setPhotoGridClickyOrbChatItem:0];
}

- (id)photosViewController:(id)a3 contextMenuInteraction:(id)a4 styleForMenuWithConfiguration:(id)a5
{
  v5 = a3;
  v6 = [MEMORY[0x1E69DD440] defaultStyle];
  v7 = v5;
  v8 = [v7 view];
  [v8 layoutMargins];
  v10 = v9;
  v12 = v11;
  v14 = v13;

  v15 = [v7 view];

  v16 = [v15 window];
  [v16 safeAreaInsets];
  v18 = v17;
  v19 = +[CKUIBehavior sharedBehaviors];
  [v19 messageAcknowledgmentPickerBarSize];
  v21 = v18 + v20;

  v22 = +[CKUIBehavior sharedBehaviors];
  [v22 attributionViewHeight];
  v24 = v23;
  v25 = +[CKUIBehavior sharedBehaviors];
  [v25 attributionViewMinPadding];
  v27 = v21 + v24 + v26;

  [v6 preferredEdgeInsets];
  [v6 setPreferredEdgeInsets:{fmax(v28, v27), v10, v12, v14}];

  return v6;
}

- (void)tapbackPileViewTapped:(id)a3 asset:(id)a4
{
  v17 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v15 = 138412290;
      v16 = v6;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Detected tap on view: %@", &v15, 0xCu);
    }
  }

  v9 = [(CKChatController *)self photosGridViewController];
  v10 = [v9 viewModel];
  v11 = [v10 currentDataSource];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = v11;
    v13 = [v7 mediaObject];
    v14 = [v12 assetReferenceForMediaObject:v13];

    [(CKChatController *)self _showTapbackReplyOverlayFromPhotosViewController:v9 assetReference:v14 presentTapbackKeyboardInput:0];
  }
}

- (id)addContactOptionsMenuWithNicknameUpdate:(id)a3
{
  v4 = MEMORY[0x1E695DF70];
  v5 = a3;
  v6 = objc_alloc_init(v4);
  v7 = [(CKChatController *)self createNewContactActionWithNicknameUpdate:v5];
  [v6 addObject:v7];

  v8 = [(CKChatController *)self addToExistingContactActionWithNicknameUpdate:v5];

  [v6 addObject:v8];
  v9 = MEMORY[0x1E69DCC60];
  v10 = [v6 copy];
  v11 = [v9 menuWithTitle:&stru_1F04268F8 children:v10];

  return v11;
}

- (id)createNewContactActionWithNicknameUpdate:(id)a3
{
  v4 = a3;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"CREATE_NEW_CONTACT" value:&stru_1F04268F8 table:@"ChatKit"];

  v7 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"person.crop.circle"];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __71__CKChatController_Contacts__createNewContactActionWithNicknameUpdate___block_invoke;
  aBlock[3] = &unk_1E72EBF48;
  objc_copyWeak(&v14, &location);
  v8 = v4;
  v13 = v8;
  v9 = _Block_copy(aBlock);
  v10 = [MEMORY[0x1E69DC628] actionWithTitle:v6 image:v7 identifier:v6 handler:v9];

  objc_destroyWeak(&v14);
  objc_destroyWeak(&location);

  return v10;
}

void __71__CKChatController_Contacts__createNewContactActionWithNicknameUpdate___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained createContactWithNicknameUpdate:*(a1 + 32)];
}

- (id)addToExistingContactActionWithNicknameUpdate:(id)a3
{
  v4 = a3;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"ADD_TO_EXISTING_CONTACT" value:&stru_1F04268F8 table:@"ChatKit"];

  v7 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"person.crop.circle.badge.plus"];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __75__CKChatController_Contacts__addToExistingContactActionWithNicknameUpdate___block_invoke;
  aBlock[3] = &unk_1E72EBF48;
  objc_copyWeak(&v14, &location);
  v8 = v4;
  v13 = v8;
  v9 = _Block_copy(aBlock);
  v10 = [MEMORY[0x1E69DC628] actionWithTitle:v6 image:v7 identifier:v6 handler:v9];

  objc_destroyWeak(&v14);
  objc_destroyWeak(&location);

  return v10;
}

void __75__CKChatController_Contacts__addToExistingContactActionWithNicknameUpdate___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setCurrentNicknameUpdate:v2];

  v4 = objc_loadWeakRetained((a1 + 40));
  [v4 selectContact];
}

- (void)showUpdatePromptForNicknameUpdate:(id)a3 sourceView:(id)a4 completionBlock:(id)a5
{
  v8 = a3;
  v9 = a5;
  v49 = a4;
  v10 = CKFrameworkBundle();
  v50 = [v10 localizedStringForKey:@"UPDATE_PHOTO_AND_NAME_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  v11 = [CKAlertController alertControllerWithTitle:v50 message:0 preferredStyle:0];
  v12 = [v8 nickname];
  v13 = [(CKChatController *)self contactForNickname:v12];

  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"NAME_AND_PHOTO" value:&stru_1F04268F8 table:@"ChatKit"];
  v61[0] = MEMORY[0x1E69E9820];
  v61[1] = 3221225472;
  v61[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke;
  v61[3] = &unk_1E72EDA18;
  v61[4] = self;
  v16 = v13;
  v62 = v16;
  v17 = v8;
  v63 = v17;
  v18 = v9;
  v64 = v18;
  v19 = [CKAlertAction actionWithTitle:v15 style:0 handler:v61];
  [v11 addAction:v19];

  v20 = CKFrameworkBundle();
  v21 = [v20 localizedStringForKey:@"PHOTO_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];
  v57[0] = MEMORY[0x1E69E9820];
  v57[1] = 3221225472;
  v57[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_2;
  v57[3] = &unk_1E72EDA18;
  v57[4] = self;
  v22 = v16;
  v58 = v22;
  v23 = v17;
  v59 = v23;
  v24 = v18;
  v60 = v24;
  v25 = [CKAlertAction actionWithTitle:v21 style:0 handler:v57];
  [v11 addAction:v25];

  v26 = CKFrameworkBundle();
  v27 = [v26 localizedStringForKey:@"NAME_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];
  v53[0] = MEMORY[0x1E69E9820];
  v53[1] = 3221225472;
  v53[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_3;
  v53[3] = &unk_1E72EDA18;
  v53[4] = self;
  v54 = v22;
  v55 = v23;
  v28 = v24;
  v56 = v28;
  v29 = v23;
  v30 = v22;
  v31 = [CKAlertAction actionWithTitle:v27 style:0 handler:v53];
  [v11 addAction:v31];

  v32 = CKFrameworkBundle();
  v33 = [v32 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v51[0] = MEMORY[0x1E69E9820];
  v51[1] = 3221225472;
  v51[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_4;
  v51[3] = &unk_1E72EC218;
  v52 = v28;
  v34 = v28;
  v35 = [CKAlertAction actionWithTitle:v33 style:1 handler:v51];
  [v11 addAction:v35];

  v36 = [v11 popoverPresentationController];
  v37 = [(CKChatController *)self view];
  [v36 setSourceView:v37];

  v38 = [v11 popoverPresentationController];
  v39 = [(CKChatController *)self view];
  [v49 frame];
  v41 = v40;
  v43 = v42;
  v45 = v44;
  v47 = v46;
  v48 = [v49 superview];

  [v39 convertRect:v48 fromView:{v41, v43, v45, v47}];
  [v38 setSourceRect:?];

  [v11 presentFromViewController:self animated:1 completion:0];
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke(uint64_t a1)
{
  [*(a1 + 32) updateContact:*(a1 + 40) withNicknameUpdate:*(a1 + 48) updateType:6 addHandleToContact:0 presentationMode:3];
  result = *(a1 + 56);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) updateContact:*(a1 + 40) withNicknameUpdate:*(a1 + 48) updateType:4 addHandleToContact:0 presentationMode:3];
  result = *(a1 + 56);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_3(uint64_t a1)
{
  [*(a1 + 32) updateContact:*(a1 + 40) withNicknameUpdate:*(a1 + 48) updateType:2 addHandleToContact:0 presentationMode:3];
  result = *(a1 + 56);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_4(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)updateContactQuietlyForNicknameUpdate:(id)a3 updateType:(unint64_t)a4
{
  v6 = a3;
  v7 = [v6 nickname];
  v8 = [(CKChatController *)self contactForNickname:v7];

  [(CKChatController *)self updateContact:v8 withNicknameUpdate:v6 updateType:a4 addHandleToContact:0 presentationMode:3];
}

- (id)updateOptionsMenuForContact:(id)a3 withNicknameUpdate:(id)a4 withCompletionBlock:(id)a5
{
  v8 = MEMORY[0x1E695DF70];
  v9 = a5;
  v10 = a4;
  v11 = a3;
  v12 = objc_alloc_init(v8);
  v13 = [(CKChatController *)self nameAndPhotoForContact:v11 andNicknameUpdate:v10 withCompletionBlock:v9];
  [v12 addObject:v13];

  v14 = [(CKChatController *)self nameOnlyForContact:v11 andNicknameUpdate:v10 withCompletionBlock:v9];
  [v12 addObject:v14];

  v15 = [(CKChatController *)self photoOnlyForContact:v11 andNicknameUpdate:v10 withCompletionBlock:v9];

  [v12 addObject:v15];
  v16 = MEMORY[0x1E69DCC60];
  v17 = [v12 copy];
  v18 = [v16 menuWithTitle:&stru_1F04268F8 children:v17];

  return v18;
}

- (id)nameAndPhotoForContact:(id)a3 andNicknameUpdate:(id)a4 withCompletionBlock:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"NAME_AND_PHOTO" value:&stru_1F04268F8 table:@"ChatKit"];

  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __91__CKChatController_Contacts__nameAndPhotoForContact_andNicknameUpdate_withCompletionBlock___block_invoke;
  aBlock[3] = &unk_1E72F77A0;
  objc_copyWeak(&v23, &location);
  v13 = v8;
  v20 = v13;
  v14 = v9;
  v21 = v14;
  v15 = v10;
  v22 = v15;
  v16 = _Block_copy(aBlock);
  v17 = [MEMORY[0x1E69DC628] actionWithTitle:v12 image:0 identifier:v12 handler:v16];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);

  return v17;
}

uint64_t __91__CKChatController_Contacts__nameAndPhotoForContact_andNicknameUpdate_withCompletionBlock___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained updateContact:*(a1 + 32) withNicknameUpdate:*(a1 + 40) updateType:6 addHandleToContact:0 presentationMode:3];

  v3 = *(*(a1 + 48) + 16);

  return v3();
}

- (id)nameOnlyForContact:(id)a3 andNicknameUpdate:(id)a4 withCompletionBlock:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"NAME_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];

  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __87__CKChatController_Contacts__nameOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke;
  aBlock[3] = &unk_1E72F77A0;
  objc_copyWeak(&v23, &location);
  v13 = v8;
  v20 = v13;
  v14 = v9;
  v21 = v14;
  v15 = v10;
  v22 = v15;
  v16 = _Block_copy(aBlock);
  v17 = [MEMORY[0x1E69DC628] actionWithTitle:v12 image:0 identifier:v12 handler:v16];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);

  return v17;
}

uint64_t __87__CKChatController_Contacts__nameOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained updateContact:*(a1 + 32) withNicknameUpdate:*(a1 + 40) updateType:2 addHandleToContact:0 presentationMode:3];

  v3 = *(*(a1 + 48) + 16);

  return v3();
}

- (id)photoOnlyForContact:(id)a3 andNicknameUpdate:(id)a4 withCompletionBlock:(id)a5
{
  v8 = a3;
  v9 = a4;
  v10 = a5;
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"PHOTO_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];

  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __88__CKChatController_Contacts__photoOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke;
  aBlock[3] = &unk_1E72F77A0;
  objc_copyWeak(&v23, &location);
  v13 = v8;
  v20 = v13;
  v14 = v9;
  v21 = v14;
  v15 = v10;
  v22 = v15;
  v16 = _Block_copy(aBlock);
  v17 = [MEMORY[0x1E69DC628] actionWithTitle:v12 image:0 identifier:v12 handler:v16];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);

  return v17;
}

uint64_t __88__CKChatController_Contacts__photoOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained updateContact:*(a1 + 32) withNicknameUpdate:*(a1 + 40) updateType:4 addHandleToContact:0 presentationMode:3];

  v3 = *(*(a1 + 48) + 16);

  return v3();
}

- (id)contactForNickname:(id)a3
{
  v3 = MEMORY[0x1E69A7FD0];
  v4 = a3;
  v5 = [v3 sharedInstance];
  v6 = [v4 handle];

  v7 = [v5 fetchCNContactForHandleWithID:v6];

  v8 = [MEMORY[0x1E69A7FD0] sharedInstance];
  v9 = [MEMORY[0x1E69A7FD0] keysForNicknameHandling];
  v10 = [v8 completedContact:v7 withKeys:v9];

  return v10;
}

- (void)createContactWithNicknameUpdate:(id)a3
{
  if (a3)
  {
    [(CKChatController *)self updateContact:0 withNicknameUpdate:a3 updateType:*MEMORY[0x1E69A77E8] addHandleToContact:1 presentationMode:1];
  }
}

- (void)updateContact:(id)a3 withNicknameUpdate:(id)a4 updateType:(unint64_t)a5 addHandleToContact:(BOOL)a6 presentationMode:(unint64_t)a7
{
  v8 = a6;
  v33 = *MEMORY[0x1E69E9840];
  v12 = a3;
  v13 = a4;
  if (v13)
  {
    v14 = [(CKCoreChatController *)self createMutableContact:v12 withNicknameUpdate:v13 updateType:a5 addHandleToContact:v8];
    if (a7 <= 1)
    {
      if (a7)
      {
        if (a7 == 1)
        {
          v15 = [MEMORY[0x1E695D148] viewControllerForNewContact:v14];
          v16 = [MEMORY[0x1E69A7FD0] sharedInstance];
          v17 = [v16 getContactStore];
          [v15 setContactStore:v17];

          [v15 setDelegate:self];
          v18 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v15];
          v19 = [(CKChatController *)self viewControllerToPresentFrom];
LABEL_23:
          v26 = v19;
          [v19 presentViewController:v18 animated:1 completion:0];

          goto LABEL_24;
        }

        goto LABEL_24;
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_24;
      }

      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "CKContactController_Nicknames: invalid presentation mode for updating contact!", &v29, 2u);
      }

LABEL_21:

      goto LABEL_24;
    }

    if (a7 == 2)
    {
      v15 = [MEMORY[0x1E695D148] viewControllerForUpdatingContact:v12 withPropertiesFromContact:v14];
      v24 = [MEMORY[0x1E69A7FD0] sharedInstance];
      v25 = [v24 getContactStore];
      [v15 setContactStore:v25];

      [v15 setDelegate:self];
      v18 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v15];
      v19 = [(CKChatController *)self viewControllerToPresentFrom];
      goto LABEL_23;
    }

    if (a7 != 3)
    {
LABEL_24:

      goto LABEL_25;
    }

    [(CKCoreChatController *)self saveContact:v14 shouldUpdate:v12 != 0];
    if ((~a5 & 6) != 0)
    {
      v27 = IMOSLoggingEnabled();
      if ((a5 & 2) != 0)
      {
        if (!v27)
        {
          goto LABEL_24;
        }

        v23 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Contact update mode silent with name update", &v29, 2u);
        }

        goto LABEL_21;
      }

      if (v27)
      {
        v28 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Contact update mode silent", &v29, 2u);
        }
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v20 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Contact update mode silent with name and photo update", &v29, 2u);
      }
    }

    v21 = [MEMORY[0x1E69A5C10] sharedInstance];
    v22 = [v13 handle];
    [v21 clearPendingNicknameUpdatesForHandle:v22 forceClear:1];

    goto LABEL_24;
  }

  if (IMOSLoggingEnabled())
  {
    v14 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v29 = 138412546;
      v30 = v12;
      v31 = 2112;
      v32 = 0;
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "CKChatController_Nicknames: unable to update contact %@ with nickname update %@", &v29, 0x16u);
    }

    goto LABEL_24;
  }

LABEL_25:
}

- (void)contactViewController:(id)a3 didCompleteWithContact:(id)a4
{
  v6 = a3;
  v7 = [(CKChatController *)self acceptedContactBanner];

  if (v7)
  {
    [(CKChatController *)self dismissController:v6 withCompletion:0];

    v8 = [(CKCoreChatController *)self conversation];
    v9 = [v8 chat];
    [v9 setValue:MEMORY[0x1E695E118] forChatProperty:*MEMORY[0x1E69A6AE8]];

    [(CKChatController *)self showOrHideAcceptedContactBannerIfNeeded];
  }

  else
  {
    v10 = [v6 presentingViewController];

    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __75__CKChatController_Contacts__contactViewController_didCompleteWithContact___block_invoke;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [v10 dismissViewControllerAnimated:1 completion:v14];

    if (a4)
    {
      v11 = [MEMORY[0x1E69A5C10] sharedInstance];
      v12 = [(CKChatController *)self currentNicknameUpdate];
      v13 = [v12 handle];
      [v11 clearPendingNicknameUpdatesForHandle:v13 forceClear:1];
    }

    [(CKChatController *)self becomeFirstResponder];
  }
}

uint64_t __75__CKChatController_Contacts__contactViewController_didCompleteWithContact___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _showOrHideNicknameBannerIfNeeded];
  v2 = *(a1 + 32);

  return [v2 showOrHideAcceptedContactBannerIfNeeded];
}

- (void)selectContact
{
  v4 = [(CKChatController *)self viewControllerToPresentFrom];
  v3 = [(CKChatController *)self contactPicker];
  [v4 presentViewController:v3 animated:1 completion:0];
}

- (id)viewControllerToPresentFrom
{
  v2 = self;
  v3 = [(CKChatController *)v2 presentedViewController];

  if (v3)
  {
    v4 = [(CKChatController *)v2 presentedViewController];

    v2 = v4;
  }

  return v2;
}

- (void)dismissController:(id)a3 withCompletion:(id)a4
{
  v5 = a4;
  v6 = [a3 presentingViewController];
  [v6 dismissViewControllerAnimated:1 completion:v5];
}

- (void)contactPicker:(id)a3 didSelectContact:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = [(CKChatController *)self acceptedContactBanner];

  if (v8)
  {
    v9 = objc_alloc_init(CKNicknameUpdate);
    v10 = [(CKCoreChatController *)self chat];
    v11 = [v10 recipient];
    [(CKNicknameUpdate *)v9 setHandle:v11];

    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __61__CKChatController_Contacts__contactPicker_didSelectContact___block_invoke_2;
    v15[3] = &unk_1E72EB880;
    v15[4] = self;
    v16 = v7;
    v17 = v9;
    v12 = v9;
    v13 = v7;
    [(CKChatController *)self dismissController:v6 withCompletion:v15];
  }

  else
  {
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __61__CKChatController_Contacts__contactPicker_didSelectContact___block_invoke;
    v18[3] = &unk_1E72EB8D0;
    v18[4] = self;
    v19 = v7;
    v14 = v7;
    [(CKChatController *)self dismissController:v6 withCompletion:v18];
  }
}

void __61__CKChatController_Contacts__contactPicker_didSelectContact___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = [v1 currentNicknameUpdate];
  [v1 updateContact:v2 withNicknameUpdate:v3 updateType:6 addHandleToContact:1 presentationMode:2];
}

- (void)updateContact:(id)a3 withHandle:(id)a4
{
  v15[1] = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = a4;
  v7 = v6;
  if (v5 && [v6 length])
  {
    if ([v7 _appearsToBeEmail])
    {
      v8 = [MEMORY[0x1E695CEE0] labeledValueWithLabel:*MEMORY[0x1E695CB60] value:v7];
      v9 = [v5 emailAddresses];

      if (!v9)
      {
        v15[0] = v8;
        v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
        [v5 setEmailAddresses:v10];
LABEL_12:

        goto LABEL_13;
      }

      v10 = [v5 emailAddresses];
      v11 = [v10 arrayByAddingObject:v8];
      [v5 setEmailAddresses:v11];
LABEL_11:

      goto LABEL_12;
    }

    if ([v7 _appearsToBePhoneNumber])
    {
      v8 = [objc_alloc(MEMORY[0x1E695CF50]) initWithStringValue:v7];
      v10 = [MEMORY[0x1E695CEE0] labeledValueWithLabel:*MEMORY[0x1E695CB90] value:v8];
      v12 = [v5 phoneNumbers];

      if (v12)
      {
        v11 = [v5 phoneNumbers];
        v13 = [v11 arrayByAddingObject:v10];
        [v5 setPhoneNumbers:v13];
      }

      else
      {
        v14 = v10;
        v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v14 count:1];
        [v5 setPhoneNumbers:v11];
      }

      goto LABEL_11;
    }
  }

LABEL_13:
}

- (void)_walletOrderImportControllerDismissed
{
  [(CKChatController *)self setWalletOrderImportViewController:0];
  [(CKChatController *)self becomeFirstResponder];
  v3 = [(CKChatController *)self firstResponder];
  [v3 reloadInputViews];

  v5 = [(CKCoreChatController *)self collectionViewController];
  v4 = [v5 collectionView];
  [v4 endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
}

- (void)stageLocationRequestComposition
{
  v3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v4 = [v3 isWaldoEnabled];

  if (v4)
  {
    MSMessageClass_0 = getMSMessageClass_0();
    if (objc_opt_respondsToSelector())
    {
      v7 = [MSMessageClass_0 findMyLocationRequestMessage];
      v6 = [CKComposition compositionWithMSMessage:v7 appExtensionIdentifier:*MEMORY[0x1E69A6938]];
      [(CKChatController *)self _evaluateMetricsForStagingLocation];
      [(CKChatController *)self setComposition:v6];
    }
  }
}

- (void)stageFindMyCompositionWithShareType:(int64_t)a3
{
  v5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v6 = [v5 isWaldoEnabled];

  if (v6)
  {
    MSMessageClass_0 = getMSMessageClass_0();
    if (objc_opt_respondsToSelector())
    {
      v9 = [MSMessageClass_0 findMyLocationShareMessageWithDuration:a3];
      v8 = [CKComposition compositionWithMSMessage:v9 appExtensionIdentifier:*MEMORY[0x1E69A6938]];
      [(CKChatController *)self _evaluateMetricsForStagingLocation];
      [(CKChatController *)self setComposition:v8];
    }
  }
}

- (void)stageCurrentLocationComposition
{
  v3 = [MEMORY[0x1E69A5BC0] sharedInstance];
  v4 = [v3 currentLocation];
  if (v4 && [v3 locationAuthorizationDetermined] && (objc_msgSend(v3, "locationAuthorizationDenied") & 1) == 0)
  {
    v5 = [(CKCoreChatController *)self conversation];
    v6 = [_TtC7ChatKit33CKDetailsControllerLocationHelper mapURLFor:v4 in:v5];

    [(CKChatController *)self _stageCurrentLocationInEntryViewForURL:v6];
  }

  else
  {
    objc_initWeak(&location, self);
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __61__CKChatController_Location__stageCurrentLocationComposition__block_invoke_2;
    v7[3] = &unk_1E72EC8F0;
    v8 = v4;
    objc_copyWeak(&v9, &location);
    [v3 startUpdatingCurrentLocationWithAuthorizedHandler:&__block_literal_global_268 updateHandler:v7];
    objc_destroyWeak(&v9);

    objc_destroyWeak(&location);
  }
}

void __61__CKChatController_Location__stageCurrentLocationComposition__block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v6 && [v6 code] != 42)
  {
    if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = 138412290;
        v15 = v7;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Received unknown error while trying to send current location: %@. Aborting _stageCurrentLocation.", &v14, 0xCu);
      }
    }
  }

  else
  {
    v8 = *(a1 + 32);
    WeakRetained = objc_loadWeakRetained((a1 + 40));
    v10 = [WeakRetained conversation];
    v11 = [_TtC7ChatKit33CKDetailsControllerLocationHelper mapURLFor:v8 in:v10];

    v12 = objc_loadWeakRetained((a1 + 40));
    [v12 _stageCurrentLocationInEntryViewForURL:v11];
  }
}

- (void)_stageCurrentLocationInEntryViewForURL:(id)a3
{
  v4 = a3;
  v5 = [(CKCoreChatController *)self conversation];
  v6 = [v5 chat];

  if ([v6 authorizationToSendCurrentLocationMessageDenied])
  {
    v7 = [(CKChatController *)self currentLocationDeniedAlert];
    [v7 presentFromViewController:self animated:1 completion:0];
  }

  else if ([v6 canSendCurrentLocationMessage])
  {
    v8 = objc_alloc_init(MEMORY[0x1E696ECE0]);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke;
    block[3] = &unk_1E72EB880;
    v11 = v8;
    v12 = v4;
    v13 = self;
    v9 = v8;
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }
}

void __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke_2;
  v3[3] = &unk_1E72EC940;
  v2 = *(a1 + 40);
  v4 = vextq_s8(v2, v2, 8uLL);
  [v1 startFetchingMetadataForURL:v2.i64[0] completionHandler:v3];
}

void __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 conversation];
  v6 = [v5 chat];
  v7 = [v6 account];
  v8 = [v7 loginIMHandle];

  v9 = [v8 name];
  [v4 setTitle:v9];

  [v4 setURL:*(a1 + 40)];
  v10 = [CKBrowserItemPayload createBrowserItemPayloadWithRichLinkMetadata:v4];

  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke_3;
  v11[3] = &unk_1E72EC918;
  v11[4] = *(a1 + 32);
  [CKComposition compositionWithShelfPluginPayload:v10 completionHandler:v11];
}

- (id)currentLocationDeniedAlert
{
  v2 = CKFrameworkBundle();
  v3 = [v2 localizedStringForKey:@"TURN_ON_LOCATION_SERVICES_TO_SEND_LOCATION" value:&stru_1F04268F8 table:@"ChatKit"];
  v4 = [CKAlertController alertControllerWithTitle:v3 message:0 preferredStyle:1];

  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v7 = [CKAlertAction actionWithTitle:v6 style:1 handler:0];
  [v4 addAction:v7];

  v8 = CKFrameworkBundle();
  v9 = [v8 localizedStringForKey:@"SETTINGS" value:&stru_1F04268F8 table:@"ChatKit"];
  v10 = [CKAlertAction actionWithTitle:v9 style:0 handler:&__block_literal_global_257_0];

  [v4 addAction:v10];

  return v4;
}

void __56__CKChatController_Location__currentLocationDeniedAlert__block_invoke()
{
  v1 = [MEMORY[0x1E6963608] defaultWorkspace];
  v0 = [MEMORY[0x1E695DFF8] URLWithString:@"prefs:root=Privacy&path=LOCATION"];
  [v1 openSensitiveURL:v0 withOptions:0];
}

- (void)_evaluateMetricsForStagingLocation
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF90]);
  [v3 setValue:&unk_1F04E8550 forKey:*MEMORY[0x1E69A77A0]];
  [v3 setValue:*MEMORY[0x1E69A6938] forKey:*MEMORY[0x1E69A77A8]];
  v2 = [MEMORY[0x1E69A8168] sharedInstance];
  [v2 trackEvent:*MEMORY[0x1E69A7570] withDictionary:v3];
}

- (void)_handleSetAsBackgroundActionForAssetURL:(id)a3
{
  v30[1] = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = [MEMORY[0x1E69C07E8] ck_temporaryImageDirectoryURL];
  v6 = [v5 path];

  v7 = [MEMORY[0x1E696AC08] defaultManager];
  v29 = 0;
  v8 = [v7 createDirectoryAtPath:v6 withIntermediateDirectories:1 attributes:0 error:&v29];
  v9 = v29;

  if (v8)
  {
    v10 = MEMORY[0x1E695DFF8];
    v11 = [v4 path];
    v12 = [v11 lastPathComponent];
    v13 = [v6 stringByAppendingPathComponent:v12];
    v14 = [v10 fileURLWithPath:v13];

    v15 = [MEMORY[0x1E696AC08] defaultManager];
    v28 = 0;
    [v15 copyItemAtURL:v4 toURL:v14 error:&v28];

    if (v14)
    {
      v16 = MEMORY[0x193AF5EC0](@"PFPosterMediaURLImage", @"PhotosFormats");
      if (v16)
      {
        v17 = v16;
        v18 = [objc_alloc(MEMORY[0x1E69C07E8]) initWithConfigurationType:0];
        v26 = [[v17 alloc] initWithImageAtURL:v14];
        v30[0] = v26;
        v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:1];
        v25 = v18;
        [v18 setMedia:v19];

        v27 = 0;
        v20 = [v18 ck_newPosterKitPosterConfigurationForPlayground:0 withError:&v27];
        v21 = [(CKCoreChatController *)self conversation];
        v22 = [_TtC7ChatKit22CKPosterEditingHelpers makeEditingViewControllerConfigurationForPosterContents:v20 conversation:v21];

        v23 = [[CKPRUISPosterEditingViewController alloc] initWithEditingConfiguration:v22];
        [(CKPRUISPosterEditingViewController *)v23 setDelegate:self];
        v24 = [(CKChatController *)self traitCollection];
        [(CKPRUISPosterEditingViewController *)v23 setModalPresentationStyle:[_TtC7ChatKit22CKPosterEditingHelpers preferredEditorModalPresentationStyleForTraitCollection:v24]];

        [(CKChatController *)self presentViewController:v23 animated:1 completion:0];
      }
    }
  }

  else
  {
    v14 = 0;
  }
}

- (void)editingViewController:(id)a3 didFinishWithConfiguration:(id)a4
{
  v25 = *MEMORY[0x1E69E9840];
  v6 = a3;
  v7 = a4;
  [v6 dismissViewControllerAnimated:1 completion:0];
  if (v7)
  {
    Helper_x8__OBJC_CLASS___PRSPosterArchiver = gotLoadHelper_x8__OBJC_CLASS___PRSPosterArchiver(v8);
    v11 = *(v10 + 4088);
    v22 = 0;
    v12 = [v11 archiveConfiguration:v7 format:1 error:{&v22, Helper_x8__OBJC_CLASS___PRSPosterArchiver}];
    v13 = v22;
    v14 = v13;
    if (v12)
    {
      if (v13 && IMOSLoggingEnabled())
      {
        v15 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v24 = v14;
          _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Poster archiver provided final URL but emitted error. Trying to send anyway. Error: %@", buf, 0xCu);
        }
      }

      v16 = [v7 providerBundleIdentifier];
      v17 = [MEMORY[0x1E696AFB0] UUID];
      v18 = [v17 UUIDString];

      v19 = [[_TtC7ChatKit22CKTranscriptBackground alloc] initWithPosterFileURL:v12 fileName:v18 backgroundIdentifier:v18 extensionIdentifier:v16 extensionIsPlayground:0];
      [(CKCoreChatController *)self setNewTranscriptBackground:v19];
    }

    else if (IMOSLoggingEnabled())
    {
      v21 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v24 = v14;
        _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Failed to archive poster configuration, no persisted URL. Error: %@", buf, 0xCu);
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "No configuration returned", buf, 2u);
    }
  }
}

- (void)receivedBalloonEmphasisNotification:(id)a3
{
  v4 = sub_190D50FB0();
  v5 = *(v4 - 8);
  MEMORY[0x1EEE9AC00](v4);
  v7 = &v9 - ((v6 + 15) & 0xFFFFFFFFFFFFFFF0);
  sub_190D50F60();
  v8 = self;
  sub_19086A504();

  (*(v5 + 8))(v7, v4);
}

- (void)emphasizeMessageWithMessageGUID:(id)a3
{
  v4 = a3;
  v8 = self;
  v5 = [(CKCoreChatController *)v8 collectionViewController];
  objc_opt_self();
  v6 = swift_dynamicCastObjCClass();
  if (v6)
  {
    [v6 beginEmphasisWithMessageGUID_];
    v7 = v5;
  }

  else
  {
    v7 = v4;
    v4 = v8;
    v8 = v5;
  }
}

- (void)updateEmphasis
{
  v5 = self;
  v2 = [(CKCoreChatController *)v5 collectionViewController];
  objc_opt_self();
  v3 = swift_dynamicCastObjCClass();
  if (v3)
  {
    [v3 updateEmphasis];
    v4 = v2;
  }

  else
  {
    v4 = v5;
    v5 = v2;
  }
}

- (void)testEmphasis
{
  v2 = self;
  sub_19086ABE0();
}

- (id)makeNavigationBarContext
{
  v2 = self;
  v3 = sub_1908709C4();

  return v3;
}

- (id)preferredNavigationBarTitleText
{
  v2 = self;
  v3 = [(CKCoreChatController *)v2 conversation];
  v4 = [(CKConversation *)v3 displayNameForDisplayContext:1];

  if (v4)
  {
    sub_190D56F10();

    v5 = sub_190D56ED0();
  }

  else
  {

    v5 = 0;
  }

  return v5;
}

- (BOOL)allowsNavigationBarTitleInteraction
{
  v2 = self;
  v3 = [(CKCoreChatController *)v2 conversation];
  v4 = [(CKConversation *)v3 allowsShowingDetailsView];

  return v4;
}

- (int64_t)currentTranscriptNavigationBarMode
{
  v2 = self;
  v3 = sub_1908725C0();

  return v3;
}

- (int64_t)currentTranscriptNavigationBarTitleDisplayMode
{
  if ([(CKChatController *)self shouldShowAvatarViewInTranscriptNavigationBar])
  {
    return 0;
  }

  else
  {
    return 3;
  }
}

- (int64_t)entryViewPositioningGuideForCurrentTapbackPickerPresentation
{
  v2 = self;
  v3 = sub_19089DBFC();

  return v3;
}

- (id)pickerAccessoryViewForChatItem:(id)a3 containingViewController:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = self;
  v9 = sub_19089DE64(v6, v7);

  return v9;
}

- (void)tapbackPickerBalloonParentView:(id)a3 didInsertTapback:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = self;
  CKChatController.tapbackPickerBalloonParentView(_:didInsertTapback:)(v6, v7);
}

- (void)tapbackPickerBalloonParentView:(id)a3 requestedPresentPlugin:(id)a4 payloadID:(id)a5
{
  if (a4)
  {
    v7 = sub_190D56D90();
  }

  else
  {
    v7 = 0;
  }

  v8 = a5;
  v12 = self;
  v9 = [(CKCoreChatController *)v12 inputController];
  if (v9)
  {
    v10 = v9;
    if (v7)
    {
      v11 = sub_190D56D60();
    }

    else
    {
      v11 = 0;
    }

    [(CKChatInputController *)v10 _presentPluginIfNecessaryWithPayload:v11 withPayloadID:v8];
  }

  else
  {
  }
}

- (void)tapbackPickerBalloonParentViewRequestedAppCardDismiss:(id)a3
{
  v4 = a3;
  v5 = self;
  _sSo16CKChatControllerC7ChatKitE53tapbackPickerBalloonParentViewRequestedAppCardDismissyyAC07TapbackfghI0CF_0();
}

- (id)tapbackMenuElementsForChatItem:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_19089EE74(v4);

  sub_1902188FC(0, &unk_1EAD45090);
  v6 = sub_190D57160();

  return v6;
}

- (id)buildTapbackMenuElementsForChatItem:(id)a3 sendHandler:(id)a4 emojiKeyboardHandler:(id)a5 detailsHandler:(id)a6
{
  v10 = _Block_copy(a4);
  v11 = _Block_copy(a5);
  v12 = _Block_copy(a6);
  if (v10)
  {
    v13 = swift_allocObject();
    v13[2] = v10;
    v10 = sub_1908A1C54;
    if (v11)
    {
      goto LABEL_3;
    }

LABEL_6:
    v14 = 0;
    if (v12)
    {
      goto LABEL_4;
    }

    goto LABEL_7;
  }

  v13 = 0;
  if (!v11)
  {
    goto LABEL_6;
  }

LABEL_3:
  v14 = swift_allocObject();
  *(v14 + 16) = v11;
  v11 = sub_1908A1DE0;
  if (v12)
  {
LABEL_4:
    v15 = swift_allocObject();
    *(v15 + 16) = v12;
    v12 = sub_19084CED8;
    goto LABEL_8;
  }

LABEL_7:
  v15 = 0;
LABEL_8:
  v16 = a3;
  v17 = self;
  sub_19089F36C(v16, v10, v13, v11, v14, v12, v15);
  sub_19022123C(v12);
  sub_19022123C(v11);
  sub_19022123C(v10);

  sub_1902188FC(0, &unk_1EAD45090);
  v18 = sub_190D57160();

  return v18;
}

- (void)tapbackPickerViewController:(id)a3 didSelectTapback:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = self;
  CKChatController.tapbackPickerViewController(_:didSelectTapback:)(v6, v7);
}

- (void)tapbackPickerViewController:(id)a3 didDeselectTapback:(id)a4
{
  v6 = a3;
  v7 = a4;
  v8 = self;
  CKChatController.tapbackPickerViewController(_:didDeselectTapback:)(v6, v7);
}

- (id)contextualCKChatItemsForTapbackPickerViewController:(id)a3
{
  v3 = self;
  v4 = [(CKCoreChatController *)v3 contextualChatItemsForTapbackPicker];
  if (!v4)
  {
    sub_1902188FC(0, &qword_1EAD450F0);
    sub_190D57180();
    v4 = sub_190D57160();
  }

  return v4;
}

- (id)smartEmojiResponses:(id)a3 chatItem:(id)a4
{
  v6 = a4;
  v7 = self;
  sub_190A37388(a4);

  v8 = sub_190D57160();

  return v8;
}

- (void)configureFooterIfNeeded
{
  v2 = self;
  CKChatController.configureFooterIfNeeded()();
}

- (void)transcriptCollectionViewController:(id)a3 didTapIntroductionsButton:(id)a4 ofType:(int64_t)a5
{
  v8 = a3;
  v9 = a4;
  v10 = self;
  sub_190991AA0(a4, a5);
}

- (id)deleteAlertFor:(int64_t)a3
{
  v4 = self;
  v5 = CKChatController.deleteAlert(for:)(a3);

  return v5;
}

- (BOOL)wantsMessageRequestsTip
{
  v2 = self;
  v3 = CKChatController.wantsMessageRequestsTip()();

  return v3;
}

- (void)updateNumberOfUnknownChatsOpenedIfNeeded
{
  v2 = self;
  CKChatController.updateNumberOfUnknownChatsOpenedIfNeeded()();
}

- (BOOL)needsFooter
{
  v2 = self;
  v3 = CKChatController.needsFooter()();

  return v3;
}

- (void)setCustomAcknowledgementConversation:(id)a3
{
  v4 = a3;
  v6 = self;
  v5 = [(CKChatController *)v6 customAcknowledgementDebouncer];
  [(CKCustomAcknowledgementDebouncer *)v5 setConversation:v4];
}

- (void)sendCustomAcknowledgementMessage:(id)a3
{
  v4 = a3;
  v6 = self;
  v5 = [(CKChatController *)v6 customAcknowledgementDebouncer];
  sub_19099B204(v4);
}

- (NSArray)keyCommands
{
  v2 = self;
  v3 = CKChatController.keyCommands.getter();

  if (v3)
  {
    sub_1909DB4E4();
    v4 = sub_190D57160();
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)keyCommandSelectTapback:(id)a3
{
  v4 = a3;
  v5 = self;
  sub_1909DB180(v4);
}

- (void)keyCommandToggleTimeStamp:(id)a3
{
  v6 = self;
  v3 = [(CKCoreChatController *)v6 collectionViewController];
  objc_opt_self();
  v4 = swift_dynamicCastObjCClass();
  if (v4)
  {
    [v4 toggleTimeStamp];
    v5 = v3;
  }

  else
  {
    v5 = v6;
    v6 = v3;
  }
}

- (void)presentLoadingIndicatorCoverIfNeeded
{
  v2 = self;
  CKChatController.presentLoadingIndicatorCoverIfNeeded()();
}

- (void)removeLoadingIndicatorCoverIfNeeded
{
  v2 = self;
  CKChatController.removeLoadingIndicatorCoverIfNeeded()();
}

- (void)clearTranslationCache
{
  v2 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v2 - 8);
  v4 = &v9 - v3;
  v5 = sub_190D572E0();
  (*(*(v5 - 8) + 56))(v4, 1, 1, v5);
  sub_190D572A0();
  v6 = sub_190D57290();
  v7 = swift_allocObject();
  v8 = MEMORY[0x1E69E85E0];
  *(v7 + 16) = v6;
  *(v7 + 24) = v8;
  sub_190857E08(0, 0, v4, &unk_190DEB9F0, v7);
}

- (void)showTranslationTips:(id)a3
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v5 - 8);
  v7 = &v14 - v6;
  v8 = _Block_copy(a3);
  v9 = swift_allocObject();
  *(v9 + 16) = v8;
  *(v9 + 24) = self;
  v10 = sub_190D572E0();
  (*(*(v10 - 8) + 56))(v7, 1, 1, v10);
  v11 = swift_allocObject();
  v11[2] = 0;
  v11[3] = 0;
  v11[4] = &unk_190DEB9D0;
  v11[5] = v9;
  v12 = swift_allocObject();
  v12[2] = 0;
  v12[3] = 0;
  v12[4] = &unk_190DEB9D8;
  v12[5] = v11;
  v13 = self;
  sub_190C798DC(0, 0, v7, &unk_190DEB9E0, v12);
}

- (void)startDownloadingTranslationAssetsForLanguageCodes:(NSArray *)a3 completion:(id)a4
{
  v7 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v7 - 8);
  v9 = &v17 - v8;
  v10 = _Block_copy(a4);
  v11 = swift_allocObject();
  v11[2] = a3;
  v11[3] = v10;
  v11[4] = self;
  v12 = sub_190D572E0();
  (*(*(v12 - 8) + 56))(v9, 1, 1, v12);
  v13 = swift_allocObject();
  v13[2] = 0;
  v13[3] = 0;
  v13[4] = &unk_190DEB960;
  v13[5] = v11;
  v14 = swift_allocObject();
  v14[2] = 0;
  v14[3] = 0;
  v14[4] = &unk_190DEB968;
  v14[5] = v13;
  v15 = a3;
  v16 = self;
  sub_190C798DC(0, 0, v9, &unk_190DEB970, v14);
}

- (void)startDownloadFor:(NSArray *)a3 completionHandler:(id)a4
{
  v7 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v7 - 8);
  v9 = &v17 - v8;
  v10 = _Block_copy(a4);
  v11 = swift_allocObject();
  v11[2] = a3;
  v11[3] = v10;
  v11[4] = self;
  v12 = sub_190D572E0();
  (*(*(v12 - 8) + 56))(v9, 1, 1, v12);
  v13 = swift_allocObject();
  v13[2] = 0;
  v13[3] = 0;
  v13[4] = &unk_190DEB938;
  v13[5] = v11;
  v14 = swift_allocObject();
  v14[2] = 0;
  v14[3] = 0;
  v14[4] = &unk_190DEB940;
  v14[5] = v13;
  v15 = a3;
  v16 = self;
  sub_190C798DC(0, 0, v9, &unk_190DEB948, v14);
}

- (void)enableAutomaticTranslationForLanguageCode:(id)a3 userTranslationCode:(id)a4 affectedMessageGUIDs:(id)a5
{
  v7 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v7 - 8);
  v9 = &v21 - v8;
  v10 = sub_190D56F10();
  v12 = v11;
  if (a4)
  {
    a4 = sub_190D56F10();
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = sub_190D57180();
  v16 = sub_190D572E0();
  (*(*(v16 - 8) + 56))(v9, 1, 1, v16);
  sub_190D572A0();
  v17 = self;
  v18 = sub_190D57290();
  v19 = swift_allocObject();
  v20 = MEMORY[0x1E69E85E0];
  v19[2] = v18;
  v19[3] = v20;
  v19[4] = v17;
  v19[5] = v10;
  v19[6] = v12;
  v19[7] = a4;
  v19[8] = v14;
  v19[9] = v15;
  sub_190857E08(0, 0, v9, &unk_190DEB928, v19);
}

- (BOOL)shouldOfferTranslateConversationInTranslateMenu
{
  v2 = self;
  v3 = sub_190A757BC();

  return v3 & 1;
}

- (void)translateConversationForChatItem:(id)a3
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v5 - 8);
  v7 = &v15 - v6;
  v8 = sub_190D572E0();
  (*(*(v8 - 8) + 56))(v7, 1, 1, v8);
  sub_190D572A0();
  v9 = a3;
  v10 = self;
  v11 = v9;
  v12 = sub_190D57290();
  v13 = swift_allocObject();
  v14 = MEMORY[0x1E69E85E0];
  v13[2] = v12;
  v13[3] = v14;
  v13[4] = v10;
  v13[5] = v11;
  sub_190857E08(0, 0, v7, &unk_190DEB908, v13);
}

- (void)presentTranslationLanguagePickerWithCompletionHandler:(id)a3
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v5 - 8);
  v7 = &v14 - v6;
  v8 = _Block_copy(a3);
  v9 = swift_allocObject();
  *(v9 + 16) = v8;
  *(v9 + 24) = self;
  v10 = sub_190D572E0();
  (*(*(v10 - 8) + 56))(v7, 1, 1, v10);
  v11 = swift_allocObject();
  v11[2] = 0;
  v11[3] = 0;
  v11[4] = &unk_190DEB8F0;
  v11[5] = v9;
  v12 = swift_allocObject();
  v12[2] = 0;
  v12[3] = 0;
  v12[4] = &unk_190DD75C0;
  v12[5] = v11;
  v13 = self;
  sub_190C798DC(0, 0, v7, &unk_190DD75C8, v12);
}

- (id)textSelectionActionWithChatItem:(id)a3
{
  v4 = a3;
  v5 = self;
  CKChatController.textSelectionAction(chatItem:)(v6, v4);
  v8 = v7;

  return v8;
}

- (id)setBackgroundActionForChatItem:(id)a3
{
  v5 = a3;
  v6 = self;
  CKChatController.setBackgroundAction(chatItem:)(v7, a3);
  v9 = v8;

  return v9;
}

- (void)presentRedesignedDetailsViewForConversation:(id)a3
{
  v4 = a3;
  v6 = self;
  v5 = [(CKChatController *)v6 redesignedDetailsViewForConversation:v4];
  [(CKChatController *)v6 performPlatformSpecificDetailsPresentation:v5];
}

- (id)redesignedDetailsViewForConversation:(id)a3
{
  v4 = a3;
  v5 = self;
  CKChatController.redesignedDetailsView(for:)(v6, v4);
  v8 = v7;

  return v8;
}

- (void)performPlatformSpecificDetailsPresentation:(id)a3
{
  v4 = a3;
  v5 = self;
  CKChatController.performPlatformSpecificDetailsPresentation(_:)(v4);
}

- (void)detailsCoordinatorDidRequestNewCompose:(id)a3 addresses:(id)a4
{
  v5 = sub_190D57180();
  v6 = swift_allocObject();
  swift_unknownObjectWeakInit();
  v7 = swift_allocObject();
  *(v7 + 16) = v6;
  *(v7 + 24) = v5;
  v10[4] = sub_190B72FA8;
  v10[5] = v7;
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 1107296256;
  v10[2] = sub_190840E6C;
  v10[3] = &block_descriptor_30_3;
  v8 = _Block_copy(v10);
  v9 = self;

  [(CKChatController *)v9 dismissDetailsViewAndShowConversationListWithCompletion:v8];

  _Block_release(v8);
}

- (void)detailsCoordinatorDidRequestNavigationToConversationList:(id)a3
{
  v5[4] = nullsub_10;
  v5[5] = 0;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 1107296256;
  v5[2] = sub_190840E6C;
  v5[3] = &block_descriptor_22_0;
  v4 = _Block_copy(v5);
  [(CKChatController *)self dismissDetailsViewAndShowConversationListWithCompletion:v4];
  _Block_release(v4);
}

- (void)dismissDetailsView
{
  v2 = self;
  CKChatController.dismissDetailsView()();
}

- (void)detailsCoordinatorDidDismiss:(id)a3
{
  v4 = a3;
  v5 = self;
  CKChatController.detailsCoordinatorDidDismiss(_:)(v4);
}

- (void)detailsCoordinatorRequestedContactsPopover:(id)a3 sourceView:(id)a4 activeHandle:(id)a5 contact:(id)a6
{
  if (!a4)
  {
    v6 = a3;
    v7 = [v6 view];
    if (v7)
    {
    }

    else
    {
      __break(1u);
    }
  }
}

- (void)didSelectTranscriptBackground:(id)a3
{
  v5 = a3;
  v6 = self;
  CKChatController.didSelectTranscriptBackground(_:)(a3);
}

- (id)transcriptContextChatItemProvider
{
  v2 = self;
  v3 = [(CKCoreChatController *)v2 collectionViewController];
  v4 = [(CKCoreTranscriptControllerProtocol *)v3 chatItems];

  sub_1902188FC(0, &qword_1EAD450F0);
  sub_190D57180();

  v5 = sub_190D57160();

  return v5;
}

- (void)didPresentEditorTranscriptBackground:(BOOL)a3
{
  v4 = self;
  CKChatController.didPresentEditorTranscriptBackground(_:)(a3);
}

- (BOOL)shouldPresentDetailsInInspector
{
  v2 = self;
  v3 = CKChatController.shouldPresentDetailsInInspector.getter();

  return v3 & 1;
}

- (void)scrollToMessageWith:(id)a3 in:(id)a4 withInlineReplyOverlay:(BOOL)a5
{
  v8 = sub_190D56F10();
  v10 = v9;
  v11 = a4;
  v12 = self;
  sub_190BD8A4C(v8, v10, a5);
}

void __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412_cold_1(uint64_t a1, uint64_t a2, NSObject *a3)
{
  *v3 = 138412546;
  *&v3[4] = a1;
  *&v3[12] = 2112;
  *&v3[14] = *(a2 + 32);
  OUTLINED_FUNCTION_2(&dword_19020E000, a2, a3, "Error saving media objects: %@. mediaObjects: %@", *v3, *&v3[8], *&v3[16], *MEMORY[0x1E69E9840]);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263_cold_2(void *a1, uint64_t a2, NSObject *a3)
{
  *v3 = 138412546;
  *&v3[4] = *a1;
  *&v3[12] = 2112;
  *&v3[14] = *(a2 + 40);
  OUTLINED_FUNCTION_2(&dword_19020E000, a2, a3, "Missing stickerPackGUID for sticker: %@ loaded from drag item: %@. Aborting sticker send to avoid a blastdoor explosion for the recipient.", *v3, *&v3[8], *&v3[16], *MEMORY[0x1E69E9840]);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)transcriptNavigationBar:didTapToPerformAction:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)presentationControllerDidDismiss:(NSObject *)a3 .cold.1(uint64_t a1, void *a2, NSObject *a3)
{
  v17 = *MEMORY[0x1E69E9840];
  v6 = [a2 entryView];
  v7 = [v6 recursiveDescription];
  v8 = [a2 entryView];
  v9 = [v8 isFirstResponder];
  v10 = @"NO";
  v11 = 138412802;
  v12 = a1;
  v13 = 2112;
  if (v9)
  {
    v10 = @"YES";
  }

  v14 = v7;
  v15 = 2112;
  v16 = v10;
  _os_log_error_impl(&dword_19020E000, a3, OS_LOG_TYPE_ERROR, "Returned to transcript without an entry view window. PresentationController: %@, entryView.recursiveDescription: %@, entryView.isFirstResponder: %@", &v11, 0x20u);
}

void __47__CKChatController_sendComposition_animations___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __54__CKChatController_transcriptScrollWithConfiguration___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)transcriptCollectionViewController:balloonView:didRequestReaderViewControllerForChatItem:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)transcriptCollectionViewController:selectedPollAddChoice:.cold.1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)transcriptCollectionViewController:(void *)a1 balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:.cold.3(void *a1)
{
  v1 = [a1 conversation];
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0x16u);
}

- (void)_updateCatchUpButtonVisibilityResumingFromBackground:(void *)a1 .cold.1(void *a1)
{
  [a1 item];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v1, v2, v3, v4, v5, 0x16u);
}

- (void)_animationPropertiesToUseInUpdateForReasons:followingHoldForReason:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_animationPropertiesToUseInUpdateForReasons:followingHoldForReason:.cold.2()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)_transferUpdated:.cold.1()
{
  OUTLINED_FUNCTION_9();
  v2 = [v1 error];
  v3 = [v0 error];
  [v3 code];
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v4, v5, v6, v7, v8, 0x16u);
}

- (void)_updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:.cold.1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)sendSticker:(void *)a1 withDragTarget:draggedSticker:.cold.1(void *a1)
{
  v1 = [a1 description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)requestShowKeyboardSnapshotForReason:.cold.1()
{
  OUTLINED_FUNCTION_9();
  v2 = [MEMORY[0x1E696AAA8] currentHandler];
  [v2 handleFailureInMethod:v1 object:v0 file:@"CKChatController.m" lineNumber:9115 description:{@"Invalid parameter not satisfying: %@", @"reason != CKKeyboardSnapshotReasonNone"}];
}

- (uint64_t)requestShowKeyboardSnapshotForReason:(void *)a3 .cold.2(uint64_t a1, uint64_t a2, void *a3)
{
  v6 = [MEMORY[0x1E696AAA8] currentHandler];
  *a3 = v6;
  return [v6 handleFailureInMethod:a1 object:a2 file:@"CKChatController.m" lineNumber:9161 description:@"+[UIKeyboard snapshotViewForOptions:UIKBSnapshotOptionWindow] returned nil. Unexpected."];
}

- (void)requestDismissKeyboardSnapshotForReason:.cold.1()
{
  OUTLINED_FUNCTION_9();
  v2 = [MEMORY[0x1E696AAA8] currentHandler];
  [v2 handleFailureInMethod:v1 object:v0 file:@"CKChatController.m" lineNumber:9259 description:{@"Invalid parameter not satisfying: %@", @"reason != CKKeyboardSnapshotReasonNone"}];
}

+ (void)donateStickerToRecents:(void *)a1 .cold.1(void *a1)
{
  v1 = [a1 fileURL];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

+ (void)donateStickerToRecents:(void *)a1 .cold.2(void *a1)
{
  v1 = [a1 description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

+ (void)donateStickerToRecentsWithIdentifier:representations:stickerEffectType:externalURI:name:accessibilityLabel:metadata:ckAttributionInfo:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)_sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:.cold.2()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:.cold.3()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_cold_1(void *a1)
{
  v1 = [a1 description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_cold_1()
{
  v2 = 138412546;
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "_sendCompositionForFileProviderCloudDrive: Received unexpected error getting sharing status for url: %@, error: %@", v2);
}

void __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)_updateAndSendCompositionForFileProvider:(const char *)a1 share:sharingURL:completion:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)_updateAndSendCompositionForFileProvider:(const char *)a1 share:sharingURL:completion:.cold.2(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3_cold_1()
{
  v2 = 138412546;
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "_checkCloudSharingStatusUpdateAndSendCompositionForFileProvider: Received unexpected error while getting sharing status for url: %@, error: %@", v2);
}

void __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)_updateAndSendCompositionForExistingCloudKitShare:(const char *)a1 share:attempt:completion:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)_updateAndSendCompositionForExistingCloudKitShare:(const char *)a1 share:attempt:completion:.cold.2(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

void __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_1()
{
  v2 = 134218242;
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "addParticipantsToShare to share failed attempt: %ld error: %@", v2);
}

void __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_2()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)sendCompositionForPendingCollaboration:completion:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)sendCompositionForPendingCollaboration:completion:.cold.2()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:collaborationType:.cold.1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)textPasteConfigurationSupporting:(const char *)a1 combineItemAttributedStrings:forRange:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_8(&dword_19020E000, v2, v3, "returned from %@", v4, v5, v6, v7, v8);
}

- (void)textPasteConfigurationSupporting:(const char *)a1 performPasteOfAttributedString:toRange:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_8(&dword_19020E000, v2, v3, "performed paste in %@", v4, v5, v6, v7, v8);
}

- (void)dragInteraction:previewForLiftingItem:session:.cold.3()
{
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_6();
  _os_log_debug_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)dragInteraction:session:didEndWithOperation:.cold.1()
{
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_6();
  _os_log_debug_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)dragPreviewParametersForBalloonView:.cold.1()
{
  v0 = [objc_opt_class() description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v1, v2, v3, v4, v5, 0xCu);
}

- (void)dropInteraction:(void *)a1 performDrop:.cold.2(void *a1)
{
  [a1 count];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_8(&dword_19020E000, v1, v2, "Perform drop with %ld itemProviders", v3, v4, v5, v6, v7);
}

- (void)dropInteraction:previewForDroppingItem:withDefault:.cold.2()
{
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_6();
  _os_log_debug_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)showInlineReplyControllerForChatItem:presentKeyboard:replyTransitionProperties:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)messageEditingViewController:contentInsetsForChatItemGuid:.cold.1()
{
  v0 = objc_opt_class();
  v1 = NSStringFromClass(v0);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)messageEditingViewController:contentInsetsForChatItemGuid:.cold.2()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)messageEditingViewController:contentInsetsForChatItemGuid:.cold.3()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)inlineReplyControllerIsAppearing:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __44__CKChatController_MenuBar__keyCommandPage___block_invoke_cold_1(id *a1, NSObject *a2)
{
  v6 = *MEMORY[0x1E69E9840];
  v3 = [*a1 input];
  v4 = 138412290;
  v5 = v3;
  _os_log_error_impl(&dword_19020E000, a2, OS_LOG_TYPE_ERROR, "Unexpected input key for paging key command %@", &v4, 0xCu);
}

void __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_6_1(*MEMORY[0x1E69E9840]);
  OUTLINED_FUNCTION_0_1();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "Error while adding participant to shareURL: %@ - share: %@");
}

void __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_3()
{
  OUTLINED_FUNCTION_0_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0x16u);
}

void __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_2()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_3()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_6_1(*MEMORY[0x1E69E9840]);
  OUTLINED_FUNCTION_0_1();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "Unable to get app link for url: %@, error: %@");
}

void __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke_cold_1(uint64_t a1, uint64_t a2)
{
  v2 = @"No Error";
  if (a2 == 3)
  {
    v2 = @"Permanent";
  }

  if (a2 == 2)
  {
    v2 = @"Transient";
  }

  v8 = v2;
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v3, v4, v5, v6, v7, 0x16u);
}

void __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke_cold_1(uint64_t a1, uint64_t a2)
{
  v2 = @"No Error";
  if (a2 == 3)
  {
    v2 = @"Permanent";
  }

  if (a2 == 2)
  {
    v2 = @"Transient";
  }

  v3 = v2;
  OUTLINED_FUNCTION_3_4();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v4, v5, v6, v7, v8, 0x20u);
}

void __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_3(char a1, NSObject *a2)
{
  v3 = *MEMORY[0x1E69E9840];
  v2[0] = 67109120;
  v2[1] = a1 & 1;
  _os_log_debug_impl(&dword_19020E000, a2, OS_LOG_TYPE_DEBUG, "Failed to create and return a CMM grid view navigation controller (permanent: %d)", v2, 8u);
}

void __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_cold_1(uint64_t a1, uint64_t a2)
{
  v2 = @"No Error";
  if (a2 == 3)
  {
    v2 = @"Permanent";
  }

  if (a2 == 2)
  {
    v2 = @"Transient";
  }

  v3 = v2;
  OUTLINED_FUNCTION_3_4();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v4, v5, v6, v7, v8, 0x20u);
}

@end